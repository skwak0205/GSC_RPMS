define("DS/WAfrDebug/mod_Performances",[],function(){"use strict";var e="[WAFR][STD]",t="[WAFR][INC]",n=e+"b_",r=e+"e_",i=t+"b_",o=t+"e_";function a(){this._private=Object.create(null),this._private._probes=[]}function s(n){var r,a=performance.getEntriesByType("measure").filter(function(t){return-1!==t.name.indexOf(e)}).map(function(t){var r=t.name.replace(e,"");if(n&&n.removeTimestamp){var i=r.split("_");i.pop(),r=i.join("_")}return{name:r,startTime:t.startTime,duration:t.duration}}),s=performance.getEntriesByType("mark").filter(function(e){return-1!==e.name.indexOf(t)}),d=(r="name",s.reduce(function(e,t){const n=t[r];return e[n]=e[n]||[],e[n].push(t),e},{}));return{stdMeasures:a,incMeasures:Object.keys(d).filter(function(e){return-1!==e.indexOf(i)}).map(function(e){var t=e.replace(i,"");if(n&&n.removeTimestamp){var r=t.split("_");r.pop(),t=r.join("_")}var a={name:t,count:d[e].length},s=e.replace(i,o),c=d[e],l=c.length,p=d[s],h=p.length,u=Math.min(l,h);if(h>l)throw new Error("Internal Error");for(var m=0,_=0;_<u;++_)m+=p[_].startTime-c[_].startTime;return a.totalTime=m,a})}}return a.prototype.isProdMode=function(){var e=!0;return"true"===localStorage.getItem("wafr_log_performances")&&(e=!1),e},a.prototype.start=function(e){if(!this.isProdMode()){var t=this._private._probes,r=t.length,i=(new Date).valueOf(),o={label:e,timestamp:i},a=n+e+"_"+i;performance.mark(a);var s=performance.getEntriesByName(a);return o.start=s[s.length-1],t[r]=o,r}},a.prototype.stop=function(t){if(!this.isProdMode()){var i=this._private._probes[t];if(!i||!i.start)throw new Error("Trying to stop a measure without a corresponding start item");var o=i.label+"_"+i.timestamp,a=r+o,s=e+o;performance.mark(a);var d=performance.getEntriesByName(a);i.stop=d[d.length-1],performance.measure(s,n+o,a),d=performance.getEntriesByName(s),i.measure=d[d.length-1]}},a.prototype.log=function(e){if(!this.isProdMode())for(var t=0,n=this._private._probes,r=n.length,i=null;t<r;++t)(i=n[t]).measure?e.log(i):"INCREMENTAL"!==i.type||void 0===i.isActive||i.isActive||e.log(i)},a.prototype.startIncrementalProbe=function(e){if(!this.isProdMode()){var t=this._private._probes,n=t.length,r={label:e,timestamp:(new Date).valueOf(),type:"INCREMENTAL",totalTime:0,isActive:!0,count:0};return t[n]=r,n}},a.prototype.startIncrement=function(e){if(!this.isProdMode()){var t=this._private._probes[e];if(!t||t.lastStart||!t.isActive)throw new Error("Trying to start to increment a probe without defining it OR without stoping the previous increment transaction.");var n=t.label+"_"+t.timestamp,r=i+n;performance.mark(r);var o=performance.getEntriesByName(r);t.lastStart=o[o.length-1]}},a.prototype.stopIncrement=function(e){if(!this.isProdMode()){var t=this._private._probes[e];if(!(t&&t.lastStart&&t.isActive))throw new Error("Trying to stop to increment a probe without defining it OR without staring it.");var n=t.label+"_"+t.timestamp,r=o+n;performance.mark(r);var i=performance.getEntriesByName(r),a=i[i.length-1];t.totalTime+=a.startTime-t.lastStart.startTime,delete t.lastStart,++t.count}},a.prototype.stopIncrementalProbe=function(e){if(!this.isProdMode()){var t=this._private._probes[e];if(!t||!t.totalTime)throw new Error("Trying to stop a probe which does not exist");console.debug("⏱️",t.label+"_"+t.timestamp,"count:",t.count,"duration:",t.totalTime,"ms"),t.isActive=!1}},{Performances:a,logProbes:function(){var e=s(),t=e.stdMeasures,n=e.incMeasures;-1===window.navigator.userAgent.indexOf("MSIE ")&&-1===window.navigator.userAgent.indexOf("Trident/")&&(console.groupCollapsed("[WAFR] Performances"),console.groupCollapsed("[WAFR] Performances - Standard"),console.table(t,["name","startTime","duration"]),console.groupEnd("[WAFR] Performances - Standard"),console.groupCollapsed("[WAFR] Performances - Incremental"),console.table(n,["name","count","totalTime"]),console.groupEnd("[WAFR] Performances - Incremental"),console.groupEnd("[WAFR] Performances"));return{stdMeasures:t,incMeasures:n}},getProbes:s}}),define("DS/WAfrModelEvents/mod_ModelEvents",["UWA/Core","DS/CoreEvents/ModelEvents"],function(e,t){"use strict";var n=function(){this._modelEvents=new t,this._applicativeModelEvents=new t};return n.DEFAULT_COMPONENT_NAME="AFR_ModelEvents",n.prototype.initialize=function(){var t=this.getExecutionContext();if(t){var n=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp","onDidContextualComponentsUpdate"].forEach(function(e){t[e]=function(t){n.publish({event:e,scope:"ALL",data:t})}})}return e.Class.Promise.resolve()},n.prototype.subscribe=function(e,t){return this._modelEvents.subscribe(e,t)},n.prototype.subscribeOnce=function(e,t){this._modelEvents.subscribeOnce(e,t)},n.prototype.unsubscribe=function(e){this._modelEvents.unsubscribe(e)},n.prototype.unsubscribeAll=function(e){this._modelEvents.unsubscribeAll(e)},n.prototype.publish=function(e){if("ALL"===e.scope)return this._modelEvents.publish(e),void this._applicativeModelEvents.publish(e);this._modelEvents.publish(e)},n.prototype.destroy=function(){return this._modelEvents.destroy(),this._applicativeModelEvents.destroy(),e.Class.Promise.resolve()},n.prototype.createExposedComponent=function(){return{subscribe:this._applicativeModelEvents.subscribe.bind(this._applicativeModelEvents),subscribeOnce:this._applicativeModelEvents.subscribeOnce.bind(this._applicativeModelEvents),unsubscribe:this._applicativeModelEvents.unsubscribe.bind(this._applicativeModelEvents),unsubscribeAll:this._applicativeModelEvents.unsubscribeAll.bind(this._applicativeModelEvents),publish:this._applicativeModelEvents.publish.bind(this._applicativeModelEvents)}},n}),define("DS/WAfrUtils/Logger",[],function(){"use strict";var e=Object.create(null);return e.log=function(e){0},e.warn=function(e){0},e.severe=function(e){0},e}),define("DS/WAfrHandlers/private/private_Utilities",[],function(){"use strict";let e=Object.create(null);return e.enums=Object.create(null),e.enums.HandlerType={},e.executeHandlerFunctions=[],e.registerLeafHandler=function(t,n){const r=e.enums.HandlerType;if(r.hasOwnProperty(t))throw new Error("There already are a handler registered using the same handlerId",t);if(!n||!n.executeFunc)throw new Error("Missing parameters");let i=-1;for(let e in r)r.hasOwnProperty(e)&&(i=i>r[e]?i:r[e]);++i,r[t]=i,e.executeHandlerFunctions[i]=n.executeFunc},e.publishHandlerAvailability=function(e){const t=e.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",e);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=e.getId();if(!r)throw new Error("handlerIdentfier has to be a non empty string.");setTimeout(function(){n.publish({event:r+"/AVAILABILITY",data:{newValue:e.isAvailable()}})},0)},e.computeArgs=function(e,t){const n=e.getArgs();if(t&&n)for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e]);else n&&(t=n);return t},e}),define("DS/WAfrExecutionContext/mod_ExecutionContextInterpreter",["UWA/Class/Promise"],function(e){"use strict";class t{constructor(){this._executionContext=void 0,this._components=[],this._UIModel=void 0}interpret(t,n,r){this._executionContext=n,this._components=t.components,this._UIModel=t.UIModel;var i=this;let o=!1;return this._components&&this._components.forEach(function(e){e&&"mod_WelcomeScreen"===e.key?(o=!0,i._executionContext._WSComponents.push(e.key)):e.options&&e.options.welcomeScreen&&i._executionContext._WSComponents.push(e.key)}),this._components&&o&&!this._executionContext.getSourceApp()?this._executionContext._doIWantToBeInWSContext=!0:o||(this._executionContext._doIWantToBeInWSContext=!1,this._executionContext.WSState=!1),e.resolve()}}var n={generateExecutionContextInterpreter:function(e){return new t}};return n}),define("DS/WAfrExecutionContext/mod_Component",["UWA/Core"],function(e){"use strict";var t=Object.create(null),n=function(){};function r(e,t){if("object"!=typeof t)throw new Error("target obj to update must be an object");var n;n=e.prototype,Object.keys(n).forEach(function(e){t.hasOwnProperty(e)||Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}function i(e,t){if("function"!=typeof t)throw new Error("parameters must be constructors (i.e. functions)");r(e,t.prototype)}t.Component=n,n.implementsBy=function(e){i(n,e)},n.mixinProperties=function(e){r(n,e)},n.prototype.getExecutionContext=function(){return this._private._executionContext},n.prototype.setExecutionContext=function(e){this._private=this._private||Object.create(null),this._private._executionContext=e},n.prototype.getRegisteredIdentifier=function(){return this._private._identifier},n.prototype.setRegisteredIdentifier=function(e){this._private=this._private||Object.create(null),this._private._identifier=e},n.prototype.initialize=function(){return e.Class.Promise.resolve()},n.prototype.clean=function(){return e.Class.Promise.resolve()},n.prototype.destroy=function(){return e.Class.Promise.resolve()},n.prototype.canBeParallelized=function(){return!0};var o=function(){};t.StandardComponent=o,n.implementsBy(o),o.implementsBy=function(e){i(o,e)},o.prototype.configure=function(){return e.Class.Promise.resolve()},o.prototype.getExposedComponentCtor=function(){return null},o.prototype.getExposedComponent=function(){return this._private?this._private._publicComponent:null},o.prototype.setExposedComponent=function(e){this._private=this._private||Object.create(null),this._private._publicComponent=e},o.prototype.generateInterpreter=function(e){return null},o.prototype.getCurrentInterpreter=function(){return this._private._currentInterpreter},o.prototype.setCurrentInterpreter=function(e){this._private=this._private||Object.create(null),this._private._currentInterpreter=e};var a=function(){};return t.Interpreter=a,a.prototype.interpret=function(e,t){throw new Error("Not implemented")},a.prototype.commit=function(e,t){throw new Error("Not implemented")},a.prototype.enrich=function(e,t){},t}),define("DS/WAfrCommandsArchitecture/mod_CommandsInterpreter",["UWA/Class/Promise"],function(e){"use strict";var t=function(){};t.prototype.interpret=function(t,n){var r=!1,i=function(e,t){Object.keys(e).some(function(n){n===t&&!0===e[n]?r=!0:e[n]&&"object"==typeof e[n]&&i(e[n],t)})};return i(t,"computeServer"),r&&n.setContext("usingCS",!0),e.resolve(r)};var n=Object.create(null);return n.generateInterpreter=function(){return new t},n}),define("DS/WAfrHandlers/mod_Handler",[],function(){"use strict";function e(e,t){if(!e)throw new Error("clients must be defined");if(void 0===t)throw new Error("value must be defined.");for(const n in e)e[n](t)}let t=Object.create(null);return t.Handler=class{constructor(e){if(this._private||(this._private=Object.create(null)),this._private._currentAvailability=!0,this._private._isEnabled=!0,this._private._isEnabledChangeClients={},this._private._isEnabledNextClientUid=0,!e)throw new Error("Missing parameters. Please see the Handler documentation to see the required parameters.");if(!e.id)throw new Error("Missing parameter. id has to be defined.");this._private._id=e.id,e.i18n&&(this._private._i18n=e.i18n),e.accelerator&&(this._private._accelerator=e.accelerator)}getAccelerator(){return this._private._accelerator}getId(){return this._private._id}setI18n(e){if(!(e&&e.title&&e.shortHelpImage&&e.shortHelpImage.uri&&e.longHelpImage&&e.longHelpImage.uri))throw new Error("One or many parameters are missing.");e&&(this._private._i18n=e)}getI18n(){return this._private._i18n}beingInitialized(){let e=!1;const t=this.getHandlerComponent();return t&&t.getInitializedState()&&(e=!0),e}getHandlerComponent(){throw new Error("getHandlerComponent has to be implemented on subclasses.")}onAvailabilityChanged(){throw new Error("onAvailabilityChanged has to be implemented on subclasses")}onAvailabilityEvent(e){if(!e||"function"!=typeof e)throw new Error("cb has to be a function",e);const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=this.getId();if(!r)throw new Error("handlerIdentifier has to be a non empty string.");return n.subscribe({event:r+"/AVAILABILITY"},e)}removeAvailabilityEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this Handler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}isAvailable(){return this._private._currentAvailability}isEnabled(){return this._private._isEnabled}disable(){this._private._isEnabled&&(this._private._isEnabled=!1,e(this._private._isEnabledChangeClients,!1))}enable(){this._private._isEnabled||(this._private._isEnabled=!0,e(this._private._isEnabledChangeClients,!0))}isExecutable(){return this.isAvailable()&&this.isEnabled()}onIsEnabledChangeEvent(e){if(!e||"function"!=typeof e)throw new TypeError("cb must be a function.");const t=this._private._isEnabledNextClientUid++;return this._private._isEnabledChangeClients[t]=e,t}removeIsEnabledChangeEventSubscription(e){const t=this._private._isEnabledChangeClients;if(!t.hasOwnProperty(e))throw new Error("No element registered with this token",e);delete t[e]}destroy(){this._private._isEnabledChangeClients&&delete this._private._isEnabledChangeClients}},t}),define("DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent",["text!DS/WAfrAvailabilityModes/assets/afr/availabilitymodes/AFR_DEFAULT_AVAILABILITY_MODES.json"],function(e){"use strict";const t="DEACTIVATED",n=JSON.parse(e);let r=Object.create(null);r.DEFAULT_COMPONENT_NAME="AFR_AvailabilityModesComponent";const i="[AVAILABILITY_MODE]";let o=!1;r.setDebugMode=function(e){if(void 0!==e&&"boolean"==typeof e&&o!==e){let t;(o=e)?((t=new Error("Debug mode activated - DO NOT USE IN PRODUCTION")).name="Warning",console.warn(t.stack)):((t=new Error("Debug mode deactivated - DO NOT USE IN PRODUCTION")).name="Warning",console.warn(t.stack))}};const a="[DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent]",s=a+"_b_",d=a+"_e_",c=a+"_m_";let l=!1;function p(e,t){if(null==e||null==t)throw new Error("probesId and identifier has to be defined");l&&window.performance.mark(s+t+e)}function h(e,t){if(null==e||null==t)throw new Error("probesId and identifier has to be defined");if(l){window.performance.mark(d+t+e);const a=c+t+e;if(window.performance.measure(a,s+t+e,d+t+e),o){var n=window.performance.getEntriesByName(a),r=n[n.length-1];console.log(i+" [PROBES] "+t,r)}}}function u(e){for(let t in e)e.hasOwnProperty(t)&&delete e[t]}function m(){return Promise.resolve()}function _(e,t){let n=Promise.resolve();const r=e._private._defaultModesValues,o=e._private._currentModes,a=t.getAvailabilityModesInfo();if(!a||void 0===a.currentAvailability)throw new Error("Cannot retrieve availabilityModes information for this client",t);let s=null,d=null;s=a.modes||{},d=a.currentAvailability;const c=function(e,t){let n=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(t));for(let e in r)if(r.hasOwnProperty(e)){if(!n[e])throw new Error(i+" Unsupported availability mode ("+e+")");let t=n[e].values,o=r[e].values;for(let e in o)o.hasOwnProperty(e)&&o[e]!==t[e]&&(t[e]=o[e])}return n}(r,s);let l=null,p=null,h=!1;for(l in o)if(o.hasOwnProperty(l)&&(p=o[l],!1===c[l].values[p.selected])){h=!0,d&&(n=Promise.resolve().then(t.onAvailabilityChanged.bind(t,!1,{mode:p,value:p.selected})));break}return h||d||(n=Promise.resolve().then(t.onAvailabilityChanged.bind(t,!0))),n}r.setProbeMode=function(e){if(void 0!==e&&"boolean"==typeof e&&l!==e){let t;(l=e)?((t=new Error("Probe mode activated - DO NOT USE IN PRODUCTION")).name="Warning",console.warn(t.stack)):((t=new Error("Probe mode deactivated - DO NOT USE IN PRODUCTION")).name="Warning",console.warn(t.stack))}};return r.AvailabilityModesComponent=class{constructor(){this._private=Object.create(null),this._private._probesId=(new Date).valueOf()}initialize(){p(this._private._probesId,"AvailabilityModesComponent.prototype.initialize"),this._private._currentModes={},this._private._clients={},this._private._nextClientUid=0;const e=this;return this._private._defaultModesValues?(h(this._private._probesId,"AvailabilityModesComponent.prototype.initialize"),Promise.resolve()):Promise.resolve(n).then(function(t){return e._private._defaultModesValues=t,h(e._private._probesId,"AvailabilityModesComponent.prototype.initialize"),Promise.resolve()},function(e){throw e})}clean(){if(p(this._private._probesId,"AvailabilityModesComponent.prototype.clean"),!this._private||!this._private._clients||!this._private._currentModes)throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize");return u(this._private._currentModes),u(this._private._clients),this._private._nextClientUid=0,h(this._private._probesId,"AvailabilityModesComponent.prototype.clean"),Promise.resolve()}destroy(){if(p(this._private._probesId,"AvailabilityModesComponent.prototype.destroy"),!this._private||!this._private._clients||!this._private._currentModes)throw new Error("AvailabilityModeComponent state is corrupted. You may have call clean before initialize");return delete this._private._currentModes,delete this._private._clients,delete this._private._nextClientUid,delete this._private._defaultModesValues,h(this._private._probesId,"AvailabilityModesComponent.prototype.destroy"),Promise.resolve()}canBeParallelized(){return!1}getExposedComponentCtor(){function e(){}return p(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor"),e.prototype.initialize=m,e.prototype.clean=m,e.prototype.destroy=m,e.prototype.subscribe=this.subscribe.bind(this),e.prototype.unsubscribe=this.unsubscribe.bind(this),e.prototype.publish=this.publish.bind(this),e.prototype.canBeParallelized=this.canBeParallelized.bind(this),e.prototype.getCurrentModeValue=this.getCurrentModeValue.bind(this),h(this._private._probesId,"AvailabilityModesComponent.prototype.getExposedComponentCtor"),e}subscribe(e,t){p(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe"),t||console.warn("[DEPRECATED] Usage of AvailabilityModesComponent.prototype.subscribe must not be used in a synchronous way. Please refer to its documentation in order to migrate your code.");let n=Promise.resolve();!function(e){if(!e||!e.getAvailabilityModesInfo||"function"!=typeof e.getAvailabilityModesInfo||!e.onAvailabilityChanged||"function"!=typeof e.onAvailabilityChanged)throw new Error("element is not defined or it does not implement required methods")}(e);const r=this._private._clients;for(var i in r)if(r.hasOwnProperty(i)&&r[i]===e){let n=new Error("Trying to subscribe an element which is already registered",e);if(t)return Promise.reject(n);throw n}if(r.hasOwnProperty(this._private._nextClientUid))throw new Error("Internal Error");var o;return r[this._private._nextClientUid]=e,++this._private._nextClientUid,o=this._private._nextClientUid-1,n=_(this,e).then(function(){return o}),h(this._private._probesId,"AvailabilityModesComponent.prototype.subscribe"),t?n:this._private._nextClientUid-1}unsubscribe(e){p(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe");const t=this._private._clients;if(!t.hasOwnProperty(e))throw new Error("No element registered with this token",e);delete t[e],h(this._private._probesId,"AvailabilityModesComponent.prototype.unsubscribe")}publish(e){o&&console.log(i+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - Before computation",this._private._currentModes),p(this._private._probesId,"AvailabilityModesComponent.prototype.publish");let n=e.mode,r=e.data,a=e.value;if(!n||void 0===a)throw new Error("settings.mode, settings.value has to be defined");if(!function(e,n,r){let i=!1;const o=e._private._defaultModesValues;return o.hasOwnProperty(n)&&(o[n].values.hasOwnProperty(r)||r===t)&&(i=!0),i}(this,n,a))throw new Error("INVALID MODE OR VALUE",n,a);let s=!1;this._private._currentModes.hasOwnProperty(n)?this._private._currentModes[n].value!==a&&(a===t?delete this._private._currentModes[n]:this._private._currentModes[n]={selected:a,data:r},s=!0):a!==t&&(this._private._currentModes[n]={selected:a,data:r},s=!0);let d=Promise.resolve();return s&&(d=function(e){o&&console.log(i+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - Begin computation",e._private._clients),p(e._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync");let t=[];const n=e._private._clients;for(let r in n)n.hasOwnProperty(r)&&t.push(_(e,n[r]));return h(e._private._probesId,"AvailabilityModesComponent~computeAvailabilityAndPublishAsync"),o&&console.log(i+" [AVAILABILITY_COMPUTATION] AvailabilityModesComponent~computeAvailabilityAndPublishAsync - End computation",e._private._clients),Promise.all(t)}(this)),o&&console.log(i+" [MODES_ARRAY] AvailabilityModesComponent.prototype.publish - After computation",this._private._currentModes),h(this._private._probesId,"AvailabilityModesComponent.prototype.publish"),d}getCurrentModeValue(e){let t="DEACTIVATED";return this._private._currentModes.hasOwnProperty(e)&&(t=this._private._currentModes[e].selected),t}},r.AvailabilityModesComponent.DEFAULT_COMPONENT_NAME=r.DEFAULT_COMPONENT_NAME,r}),define("DS/WAfrUtils/PerformanceHelper",[],function(){"use strict";window.performance.mark=window.performance.mark||function(){},window.performance.measure=window.performance.measure||function(){};var e=Object.create(null),t=Object.create(null);return e.checkpoint=function(e){t[e]?(window.performance.mark("WAfr_Mark_"+e+"_end"),window.performance.measure("WAfr_Measure_"+e,"WAfr_Mark_"+e+"_start","WAfr_Mark_"+e+"_end"),delete t[e]):(window.performance.mark("WAfr_Mark_"+e+"_start"),t[e]=!0)},e}),define("DS/WAfrContainer/App",["UWA/Core","UWA/Class"],function(e,t){"use strict";var n=t.extend({defaultOptions:{id:null,appTitle:null,title:null,brand:null,appConfig:{afrVersion:"0.1",afrCode:null,afrFamily:null,afrTransitionsFrom:{},afrTransitionsTo:{},afrTransitionsFromFamily:{},afrTransitionsToFamily:{}}},disposeOptions:{disposeFrameWindow:!0},init:function(t){t=t||{},this.options=e.extend(e.clone(this.defaultOptions),t),this.options.id||(this.options.id=this.options.appConfig.appId||this.options.appConfig.afrAppId,this.options.appConfig.appId&&delete this.options.appConfig.appId,this.options.appConfig.afrAppId&&delete this.options.appConfig.afrAppId),this.options.appTitle||(this.options.appTitle=this.options.appConfig.appTitle||this.options.appConfig.title,this.options.appConfig.appTitle&&delete this.options.appConfig.appTitle),this.options.brand||(this.options.brand=this.options.appConfig.brand,this.options.appConfig.brand&&delete this.options.appConfig.brand),this._parent(this.options),this._frmWindow=void 0,this._disposeCalled=!1,this._executionContext=void 0},getIdCard:function(){return this.options.appConfig},getTransitionFrom:function(e){return this.options.appConfig.afrTransitionsFrom?this.options.appConfig.afrTransitionsFrom[e]:null},getTransitionFromFamily:function(e){return this.options.appConfig.afrTransitionsFromFamily?this.options.appConfig.afrTransitionsFromFamily[e]:null},getExecutionContext:function(){return this._executionContext},getFrameWindow:function(){return this._frmWindow},getId:function(){return this.options.id},getTitle:function(){return this.options.appTitle},getBrand:function(){return this.options.brand},getFamily:function(){return this.options.appConfig.afrFamily},onWillEnter:function(t){return e.Class.Promise.resolve()},onWillLeave:function(t){return e.Class.Promise.resolve()},setUp:function(e){e.done&&e.done()},setUpWS:function(t){return t.done?t.done():e.Class.Promise.resolve()},isDisposeCalled:function(){return this._disposeCalled},dispose:function(t){e.extend(e.clone(this.disposeOptions),t).disposeFrameWindow&&this._frmWindow&&(this._frmWindow.dispose(),this._frmWindow=void 0),this._disposeCalled=!0},getContainer:function(){return this._container},setContainer:function(e){this._container&&this._container.removeEvent&&(this._container.removeEvent("onDestroy"),this._container.removeEvent("onRefresh")),this._container=e,this._container&&this._container.addEvent&&(this._container.addEvent("onDestroy",this.onContainerDestroy.bind(this)),this._container.addEvent("onRefresh",this.onContainerRefresh.bind(this)))},onContainerDestroy:function(e){this.dispose()},onContainerRefresh:function(e){},switchApp:function(e){"ENOR3D_AP"!==this.options.id&&"ENX3DIR_AP"!==this.options.id&&"ENOI3D_AP"!==this.options.id||this._executionContext.switchApp(e)}});return n.inherits=function(e){e.prototype=Object.create(n.prototype,{constructor:{value:e,enumerable:!1}})},n});var wafrVersion="WAFR2.0";define("DS/WAfrAppManager/mod_AppManager",["UWA/Class/Promise","DS/WAfrUtils/Logger","i18n!DS/WAfrContainer/assets/nls/Notification"],function(e,t,n){"use strict";var r=Object.create(null),i=function(e){this._options=e};return i.DEFAULT_COMPONENT_NAME="AFR_AppManager",i.prototype.setCurrentConfig=function(e){this._config=e},i.prototype.initialize=function(){this._executionContext=this.getExecutionContext(),this._container=this._executionContext._container;var t=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);if(t){var n=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp"].forEach(function(e){t.subscribeOnce({event:e},n[e].bind(n))})}return e.resolve()},i.prototype.onWillLoadApp=function(e){this._appId=e,this._sourceApp=this._executionContext.getSourceApp()},i.prototype.onDidLoadApp=function(){var e=this._executionContext.getSourceApp();void 0===e.options.brand&&(this._container._view.getValue("brand")?e.options.brand=this._container._view.getValue("brand"):this._container._view.getTitleHeader().brand&&(e.options.brand=this._container._view.getTitleHeader().brand));var t=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);this._appId=e.getId();var r=this._sourceApp?this._sourceApp.getTitle()||this._container._view.getTitleHeader().appTitle||this._sourceApp.getId():null,i=this._container._view.getValue("afrExecutionContexts");if(!i)throw new Error("The persisted contexts must not be undefined");i[this._container._currentExecutionContext].currentappId=e.getId(),this._container._view.setValue("afrCode",e.getIdCard().afrCode),this._container._view.setValue("afrExecutionContexts",i.slice()),this._container._view.setValue("afrCurrentExecutionContextIdx",this._container._currentExecutionContext),this._container._view.setValue("afrAppId",e.getId()),this._container._view.setValue("appId",e.getId()),this._container._view.setBrand(e.options.brand),this._container._view.setValue("appTitle",e.getTitle()),this._container.updateAppTitle(e.getTitle()),this._container.updateTitle({title:this._container.productTitle},e),this._container._view.setValue("brand",e.getBrand()||this._container._view.getValue("brand")),this._container._view.setValue("afrFamily",e.getIdCard().afrFamily),this._container._view.setValue("afrTransitionsFrom",e.getIdCard().afrTransitionsFrom),this._container._view.setValue("afrTransitionsFromFamily",e.getIdCard().afrTransitionsFromFamily),this._container._view.setValue("afrTransitionsTo",e.getIdCard().afrTransitionsTo),this._container._view.setValue("afrTransitionsToFamily",e.getIdCard().afrTransitionsToFamily);var o=e.getTitle(),a={containerId:this._container.id,contextId:this._executionContext.getId(),targetApp:{options:e.options}};a.targetApp.options.appConfig.appId=e.getId(),this._container.publish("onAppReady."+this._appId,a);var s="",d={};if(r){s="WAfrTransitionSuccessful",d[0]=o,d[1]=r;var c=n.get(s+".message"),l=n.get(s+".title");d&&c&&(c=n.replace(c,d)),t&&t.notifySuccess({title:l,message:c})}this._appId=null,this._sourceApp=null},i.prototype.onDidFailToLoadApp=function(e){var r=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager),i=this._executionContext.getTargetApp()&&this._executionContext.getTargetApp().getTitle(),o={containerId:this._container.id,contextId:this._executionContext.getId()},a="WAfrTransitionFailed",s={0:i};if(i){s[1]=e&&e.message||"";var d=n.get(a+".message");d=n.replace(d,s);var c=n.get(a+".title");r&&r.notifyError({title:c,message:d})}e&&(t.severe("Error when loading configuration \n"+e.stack),o.error={name:e?e.name:"Error",message:e?e.message:""}),this._container.publish("onAppFail."+this._appId,o)},i.prototype.createExposedComponent=function(){return{launchApp:this.getExecutionContext()._container.launchApp.bind(this.getExecutionContext()._container)}},r.AppManager=i,r}),define("DS/WAfrHandlers/private/private_CheckHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],function(e,t){"use strict";let n=Object.create(null);return n.executeCheckHandler=function(n,r){if(!n)throw new Error("checkHandler has to be defined and cannot be null");const i=n.getHandlerComponent();if(!i)throw new Error("handlerComponent must be defined.");if(!i.getExecutionContext())throw new Error("Execution Context not found.");if(!r||void 0===r.action||"boolean"!=typeof r.action)throw new Error("Wrong parameters");let o=!0;(n.beingInitialized()||n._private._isChecked!==r.action)&&(n._private._isChecked=r.action,function(e){const t=e.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this CheckHandler",e);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");const r=e.getId();if(!r)throw new Error("handlerIdentfier has to be a non empty string.");const i=e._private._isChecked?"/CHECK":"/UNCHECK";n.publish({event:r+i})}(n),n._private._isChecked?n._private._check&&void 0!==n._private._check._private._type&&(o=!1,t.executeHandlerFunctions[n._private._check._private._type]({handler:n._private._check,cb:r.cb,args:r.args})):n._private._uncheck&&void 0!==n._private._uncheck._private._type&&(o=!1,t.executeHandlerFunctions[n._private._uncheck._private._type]({handler:n._private._uncheck,cb:r.cb,args:r.args}))),o&&r.cb&&setTimeout(function(){const t=e.getErrorManager(),n=e.createReturnObject(t.SUCCEEDED);r.cb(n)},0)},n}),define("DS/WAfrHandlers/mod_HandlerComponent",["DS/CoreUtilities/ErrorManagement","DS/CoreEvents/ModelEvents","DS/WAfrHandlers/private/private_Utilities","DS/WAfrDebug/mod_Performances"],function(e,t,n,r){"use strict";var i=r.Performances,o="[DS/WAfrHandlers/mod_HandlerComponent]",a=Object.create(null);function s(t){if(!(this&&this.resolve&&this.reject&&t))throw new Error;e.hasSucceeded(t)?this.resolve(t):this.reject(t)}a.DEFAULT_COMPONENT_NAME="AFR_HandlerComponent";var d=Object.create(null);function c(e,t,n){if(!(e&&t&&n&&e._private.hasOwnProperty(t)))throw new Error;const r=e._private[t],i=n.getId();if(!r||!i)throw new Error;if(!n.setHandlerComponent(e))throw new Error;r[i]=n}function l(e,t,n){if(!(e&&t&&n&&e._private.hasOwnProperty(t)))throw new Error;const r=e._private[t],i=n.getId();if(!r||!i)throw new Error;if(!n.setHandlerComponent(null))throw new Error;delete r[i]}function p(){return Promise.resolve()}function h(e){if(!e)throw new Error("handlerComponent has to be defined");const t=e._perf,n=t.start([o,"manageDefaultCommand"].join(" ")),r=e._private._defaultCommandIdentifier;return new Promise(function(i,o){if(r){const a=e.getExecutionContext();if(a){require(["DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent"],function(s){const d=a.getComponent(s.CommandsManagerComponent.DEFAULT_COMPONENT_NAME);d?(d.subscribeOnceToCmdState(r,"begin",function(){return t.stop(n),i()}),d.setDefaultCommand(r),delete e._private._defaultCommandIdentifier):(t.stop(n),o(new Error("No commandsManagerComponent found using this executionContext",a)))},function(){t.stop(n),o(new Error("Require failed (DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent)"))})}else t.stop(n),o(new Error("executionContext is undefined"))}else t.stop(n),i()})}function u(e,t){const n=e._perf.start([o,"cleanUpHandlers"].join(" ")),r=d.HandlerMap;for(var i in r)if(r.hasOwnProperty(i)){const n=r[i],o=e._private[n];for(let e in o)o.hasOwnProperty(e)&&o[e].destroy();delete e._private[n],t&&(e._private[n]={})}e._perf.stop(n)}function m(e,t){let n={};if(void 0!==t&&e&&e._private&&e._private._hdlrMap){const i=e._private._hdlrMap;for(var r in i)if(i.hasOwnProperty(r)){const o=i[r]._private._type;e._private._hdlrMap.hasOwnProperty(r)&&o===t&&(n[r]=e._private._hdlrMap[r])}}return n}d.HandlerMap={HANDLER:"_hdlrMap",CHECK_HANDLER:"_chkHdlrMap",RADIO_HANDLER:"_radioHdlrMap"};class _{constructor(){this._perf=new i,this._private={};var e=d.HandlerMap;for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._private[n]={}}}getExposedComponentCtor(){function e(){}return e.prototype.initialize=p,e.prototype.clean=p,e.prototype.destroy=p,e.prototype.executeHandler=this.executeHandler.bind(this),e.prototype.toggleCheck=this.toggleCheck.bind(this),e.prototype.setCheckState=this.setCheckState.bind(this),e.prototype.getCheckState=this.getCheckState.bind(this),e.prototype.toggleRadioItemState=this.toggleRadioItemState.bind(this),e.prototype.setRadioItemState=this.setRadioItemState.bind(this),e.prototype.getRadioItemState=this.getRadioItemState.bind(this),e.prototype.enableHandler=this.enableHandler.bind(this),e.prototype.disableHandler=this.disableHandler.bind(this),e.prototype.isHandlerExecutable=this.isHandlerExecutable.bind(this),e.prototype.enableCheck=this.enableCheck.bind(this),e.prototype.disableCheck=this.disableCheck.bind(this),e.prototype.isCheckExecutable=this.isCheckExecutable.bind(this),e.prototype.enableRadio=this.enableRadio.bind(this),e.prototype.disableRadio=this.disableRadio.bind(this),e.prototype.isRadioExecutable=this.isRadioExecutable.bind(this),e}initialize(){return this._private._eventChannel=new t,Promise.resolve()}configure(){const e=this,t={ActionHandler:"executeHandler",CommandHandler:"executeHandler",CheckHandler:"setCheckState",RadioHandler:"setRadioItemState"},n=this._private._initializationData;return!n||n.length<=0?h(e):function e(t,n,r){return t(r)?n(r).then(e.bind(null,t,n)):r}(function(e){return e<n.length},function(r){const i=n[r],o=t[i.type];return e[o](i).then(function(){return++r},function(e){if(e&&e.getError&&"NOT_EXECUTABLE"===e.getReturnValue().internalValue)return++r;throw e})},0).then(function(){return h(e)}).catch(function(e){return Promise.reject(e)})}clean(){return u(this,!0),this._private._eventChannel.destroy(),this._private._eventChannel=new t,this._private._availabilityModesComponent=null,this._private._defaultCommandIdentifier=void 0,Promise.resolve()}destroy(){return u(this,!1),this._private._eventChannel.destroy(),delete this._private._eventChannel,delete this._private._availabilityModesComponent,Promise.resolve()}getEventChannel(){return this._private._eventChannel}setInitializedState(e){if(void 0===e)throw new Error("state has to be defined");this._private._initializedState=e}setInitializationDefaultCommand(e){if(!e||"string"!=typeof e)throw new Error("commandIdentifier has to be a string");this._private._defaultCommandIdentifier=e}getInitializedState(){return Boolean(this._private._initializedState)}setInitializationData(e){if(!Array.isArray(e))throw new Error("data has to be an array");this._private._initializationData=e}addInitializationData(e){if(!Array.isArray(e))throw new Error("data has to be an array");this._private._initializationData?this._private._initializationData=this._private._initializationData.concat(e):this._private._initializationData=e}setAvailabilityModesComponent(e){if(void 0===e)throw new Error("component has to be defined");if(null!==e&&this._private._availabilityModesComponent)throw new Error("There is already one AvailabilityModesComponent attached to this HandlerComponent");this._private._availabilityModesComponent=e}getAvailabilityModesComponent(){return this._private._availabilityModesComponent}addHandler(e){c(this,d.HandlerMap.HANDLER,e)}removeHandler(e){l(this,d.HandlerMap.HANDLER,e)}addCheckHandler(e){c(this,d.HandlerMap.CHECK_HANDLER,e)}removeCheckHandler(e){l(this,d.HandlerMap.CHECK_HANDLER,e)}addRadioHandler(e){c(this,d.HandlerMap.RADIO_HANDLER,e)}removeRadioHandler(e){l(this,d.HandlerMap.RADIO_HANDLER,e)}executeHandler(t){if(t&&t.cb)throw new Error;const n=this;return new Promise(function(r,i){var o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id;a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),n._private._hdlrMap.hasOwnProperty(a)?n._private._hdlrMap[a].execute({cb:s.bind({resolve:r,reject:i}),args:t.args}):i(e.createReturnObject(o.FAILED,{description:"No Handler corresponding to the following id: "+a}))})}toggleCheck(t){if(t&&t.cb)throw new Error;const n=this;return new Promise(function(r,i){const o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.args;if(a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),n._private._chkHdlrMap.hasOwnProperty(a)){const e=n._private._chkHdlrMap[a],t=e.getState();e.setState({state:!t,cb:s.bind({resolve:r,reject:i}),args:d})}else i(e.createReturnObject(o.FAILED,{description:"No CheckHandler corresponding to the following id: "+a}))})}setCheckState(t){if(t&&t.cb)throw new Error;const n=this;return new Promise(function(r,i){const o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.state,c=t.args;a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),void 0!==d&&"boolean"==typeof d||i(new Error),n._private._chkHdlrMap.hasOwnProperty(a)?n._private._chkHdlrMap[a].setState({state:d,cb:s.bind({resolve:r,reject:i}),args:c}):i(e.createReturnObject(o.FAILED,{description:"No CheckHandler corresponding to the following id: "+a}))})}getCheckState(e){if(!e)throw new Error;const t=e.id;if(!t||"string"!=typeof t)throw new Error;if(!this._private._chkHdlrMap.hasOwnProperty(t))throw new Error;return this._private._chkHdlrMap[t].getState()}toggleRadioItemState(t){if(t&&t.cb)throw new Error;const n=this;return new Promise(function(r,i){const o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.radioId,c=t.args;a&&"string"==typeof a||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),d&&"string"==typeof d||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.radioId has to be defined"}));const l=n._private._radioHdlrMap;if(l.hasOwnProperty(d)){const e=!l[d].getRadioItemState(a);l[d].setRadioItemState({radioHdlrItemId:a,state:e,cb:s.bind({resolve:r,reject:i}),args:c})}else i(e.createReturnObject(o.FAILED,{description:"No item corresponding to the following id: "+d}))})}setRadioItemState(t){if(t&&t.cb)throw new Error;const n=this;return new Promise(function(r,i){var o=e.getErrorManager();t||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters has to be defined"}));const a=t.id,d=t.radioId,c=t.state,l=t.args;a&&"string"==typeof a||i(new Error),d&&"string"==typeof d||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.id has to be defined"})),void 0!==c&&"boolean"==typeof c||i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"parameters.state has to be defined"}));var p=n._private._radioHdlrMap;p.hasOwnProperty(d)?p[d].setRadioItemState({radioHdlrItemId:a,state:c,cb:s.bind({resolve:r,reject:i}),args:l}):i(e.createReturnObject(o.MISSING_PARAMETERS,{description:"No CheckHandler corresponding to the following id: "+a}))})}getRadioItemState(e){if(!e)throw new Error;const t=e.id,n=e.radioId;if(!t||"string"!=typeof t)throw new Error;if(!n||"string"!=typeof n)throw new Error;const r=this._private._radioHdlrMap;if(!r.hasOwnProperty(n))throw new Error;return r[n].getRadioItemState(t)}enableHandler(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] enableHandler - id has to be defined.");const t=this._private._hdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] enableHandler - Handler not found: ${e}`);t[e].enable()}disableHandler(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] disableHandler - id has to be defined.");const t=this._private._hdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] disableHandler - Handler not found: ${e}`);t[e].disable()}isHandlerExecutable(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] isHandlerExecutable - id has to be defined.");const t=this._private._hdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] isHandlerExecutable - Handler not found: ${e}`);return t[e].isExecutable()}enableCheck(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] enableCheck - id has to be defined.");const t=this._private._chkHdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] enableCheck - Handler not found: ${e}`);t[e].enable()}disableCheck(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] disableCheck - id has to be defined.");const t=this._private._chkHdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] disableCheck - Handler not found: ${e}`);t[e].disable()}isCheckExecutable(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] isCheckExecutable - id has to be defined.");const t=this._private._chkHdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] isCheckExecutable - Handler not found: ${e}`);return t[e].isExecutable()}enableRadio(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] enableRadio - id has to be defined.");const t=this._private._radioHdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] enableRadio - Handler not found: ${e}`);t[e].enable()}disableRadio(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] disableRadio - id has to be defined.");const t=this._private._radioHdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] disableRadio - Handler not found: ${e}`);t[e].disable()}isRadioExecutable(e){if(!e||"string"!=typeof e)throw new TypeError("[HandlerComponent] isRadioExecutable - id has to be defined.");const t=this._private._radioHdlrMap;if(!t.hasOwnProperty(e))throw new Error(`[HandlerComponent] isRadioExecutable - Handler not found: ${e}`);return t[e].isExecutable()}getActionHandlerMap(){return m(this,n.enums.HandlerType.ACTION_HANDLER)}getCommandHandlerMap(){return m(this,n.enums.HandlerType.COMMAND_HANDLER)}getLeafHandlerMaps(){let e=Object.create(null);if(e.actionHandlers={},e.commandHandlers={},this._private&&this._private._hdlrMap){const r=this._private._hdlrMap;for(var t in r)if(r.hasOwnProperty(t)){const i=r[t]._private._type;i===n.enums.HandlerType.ACTION_HANDLER?e.actionHandlers[t]=r[t]:i===n.enums.HandlerType.COMMAND_HANDLER?e.commandHandlers[t]=r[t]:console.warn("Unknown LeafHandler type",r[t]._private._type)}}return e}getCheckHandlerMap(){return this._private[d.HandlerMap.CHECK_HANDLER]}getRadioHandlerMap(){return this._private[d.HandlerMap.RADIO_HANDLER]}}return _.DEFAULT_COMPONENT_NAME=a.DEFAULT_COMPONENT_NAME,a.HandlerComponent=_,a}),define("DS/WAfrHandlers/private/private_RadioHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_CheckHandlerUtilities"],function(e,t){"use strict";let n=Object.create(null);return n.fireEvent=function(e,t,n){if(!e||!t||void 0===n)throw new Error("radioHandler, itemIdentifier and state has to be defined");const r=e.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this RadioHandler",e);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=e.getId();if(!o)throw new Error("radioHandlerIdentifier has to be a non empty string.");const a="/"+t,s=n?"/SELECT":"/UNSELECT";i.publish({event:o+a+s})},n.checkOnUncheck=function(r){if(!(this&&this.manager&&this.manageable&&r))throw new Error("Internal error. Manageable has to be defined");if(e.hasSucceeded(r))n.fireEvent(this.manager,this.manageable.getId(),!0),t.executeCheckHandler(this.manageable,{cb:this.cb,action:!0,args:this.args});else{if(!this.cb)throw r.getError();this.cb(r)}},n.isManagedByRadioHandler=function(e,t){let n=!1,r=0;const i=t._private._elements.length;for(;!n&&r<i;)t._private._elements[r]===e&&(n=!0),++r;return n},n}),define("DS/WAfrHandlers/mod_LeafHandler",["DS/WAfrHandlers/mod_Handler","DS/CoreUtilities/ErrorManagement"],function(e,t){"use strict";const n=e.Handler;class r{constructor(e,t){if(!e||!t)throw new Error("handler and manager have to be defined");this._handler=e,this._manager=t}execute(e){return this._manager.handleExecute({cb:e.cb,manageable:this._handler,args:e.args})}setHandlerComponent(){return console.warn("Impossible to set a HandlerComponent to a LeafHandler which is managed."),!1}getHandlerComponent(){return this._manager.getHandlerComponent()}onAvailabilityChanged(e,t){const n=this._handler;return this._manager.handleOnAvailabilityChanged({manageable:n,args:{newValue:e,info:t}})}isExecutable(){return this._manager.handleIsExecutable({manageable:this._handler})}disable(){throw new Error("Impossible to disable a Managed Handler")}enable(){throw new Error("Impossible to enable a Managed Handler")}onIsEnabledChangeEvent(){throw new Error("Impossible to subscribe to isEnabledChangeEvent from a Managed Handler")}removeIsEnabledChangeEventSubscription(){throw new Error("Impossible to unsubscribe to isEnabledChangeEvent from a Managed Handler")}}let i=Object.create(null);return i.LeafHandler=class extends n{constructor(e){if(super(e),!e)throw new Error("Missing parameters. Please see the LeafHandler documentation to see the required parameters.");e.availabilityMode&&(this._private._availabilityMode=e.availabilityMode),this._private._currentAvailability=!0,e.icon&&e.icon.uri&&(this._private._icon=e.icon)}initAvailabilityModesSubscription(){const e=this.getHandlerComponent();if(!e)throw new Error("Impossible to retrieve the HandlerComponent.");const t=e.getAvailabilityModesComponent();if(!t)throw new Error("Impossible to retrieve the AvailabilityModesComponent.");return t.subscribe(this,!0).then(function(e){this._private._availabilityModesSubscriptionToken=e}.bind(this))}destroy(){super.destroy();const e=this.getHandlerComponent();if(!e)throw new Error("Impossible to retrieve the HandlerComponent.");const t=e.getAvailabilityModesComponent();t&&t.unsubscribe(this._private._availabilityModesSubscriptionToken)}getAvailabilityModesInfo(){return{modes:this._private._availabilityMode,currentAvailability:this._private._currentAvailability}}onAvailabilityChanged(e,t){return this._private._currentAvailability=e,this._private._handlerState.onAvailabilityChanged(e,t)}getIcon(){return this._private._icon}makeManaged(e){if(this._private._handlerState instanceof r)throw new Error("Call makeManaged method on an LeafHandler which is already managed");this._private._handlerState=new r(this,e)}isExecutable(){return this._private._handlerState.isExecutable()}disable(){return this._private._handlerState.disable()}enable(){return this._private._handlerState.enable()}onIsEnabledChangeEvent(e){return this._private._handlerState.onIsEnabledChangeEvent(e)}removeIsEnabledChangeEventSubscription(e){return this._private._handlerState.removeIsEnabledChangeEventSubscription(e)}execute(e){if(e&&"object"!=typeof e)throw new Error("parameters has to be an object if defined");if(this.isExecutable())return this._private._handlerState.execute(e);e&&e.cb?setTimeout(function(){const n=t.getErrorManager(),r=t.createReturnObject(n.NOT_EXECUTABLE,{description:"This LeafHandler is not executable"});e.cb(r)},0):console.warn("This LeafHandler is not executable",this.getId())}setArgs(e){if("object"!=typeof e)throw new Error("args has to be an object");this._private._args=e}getArgs(){return this._private._args}},i.StandaloneLeafHandlerState=class{constructor(e){if(!e)throw new Error("handler has to be defined");this._handler=e}execute(){throw new Error("execute has to be implemented on subclasses")}setHandlerComponent(e){if(void 0===e)throw new Error("component has to be defined");return this._handler._private._handlerComponent=e,!0}getHandlerComponent(){return this._handler._private._handlerComponent}onAvailabilityChanged(e){const t=this._handler;t._private._currentAvailability=e;const n=t.getHandlerComponent();if(!n)throw new Error("There is no HandlerComponent related to this LeafHandler",t);const r=n.getEventChannel();if(!r)throw new Error("Retrieved eventChannel is undefined");const i=t.getId();if(!i)throw new Error("handlerIdentfier has to be a non empty string.");r.publish({event:i+"/AVAILABILITY",data:{newValue:e}})}isExecutable(){return n.prototype.isExecutable.call(this._handler)}disable(...e){return n.prototype.disable.call(this._handler,...e)}enable(...e){return n.prototype.enable.call(this._handler,...e)}onIsEnabledChangeEvent(...e){return n.prototype.onIsEnabledChangeEvent.call(this._handler,...e)}removeIsEnabledChangeEventSubscription(...e){return n.prototype.removeIsEnabledChangeEventSubscription.call(this._handler,...e)}},i.ManagedLeafHandlerState=r,i}),define("DS/WAfrHandlers/private/private_CommandHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],function(e,t){"use strict";let n=Object.create(null);return n.CmdMode={EXCLUSIVE:0,NESTED:1},n.RepeatMode={NEVER:0,STANDARD:1,ALWAYS:2},n.LifeCycleEvents={BEGIN:"BEGIN",PAUSE:"PAUSE",RESUME:"RESUME",CANCEL:"CANCEL",END:"END"},n.HandlerState={EXECUTING:"EXECUTING",PAUSED:"PAUSED",CANCELED:"CANCELED",ENDING:"ENDING",ENDED:"ENDED"},n.isValidHandlerState=function(e){return Boolean(e)&&this.HandlerState.hasOwnProperty(e)},n.executeCommandHandler=function(r){if(!r||!r.handler)throw new Error("parameters.handler has to be defined");r.args=t.computeArgs(r.handler,r.args),r.handler._private._cmdsManager.stackCommandExecutionRequest(function(t){if(!this)throw new Error("this (commandHandler) is undefined.");if(this.getState()!==n.HandlerState.ENDED)throw new Error("The command ended with the status Stated");if(!t||!t.notStarted)for(let n=0;n<this._private._appCB.length;n++)if(this._private._appCB[n]&&"function"==typeof this._private._appCB[n]){if(!t){const n=e.getErrorManager();t=e.createReturnObject(n.SUCCEEDED)}this._private._appCB[n](t)}}.bind(r.handler),r)},n}),define("DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent",["DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_HandlerComponent","DS/CoreEvents/ModelEvents","DS/CoreEvents/Events","DS/CoreUtilities/ErrorManagement","UWA/Class/Promise"],function(e,t,n,r,i,o){"use strict";let a=[i.generateReturnValue("COMMAND_NOT_STARTED",!1)],s=i.getErrorManager(a,{merge:!1});var d={exclusiveCmdCalled:0,secondExecuteCalled:1,killedByInfra:2,askedByCmd:3},c=!1;function l(e,t){c&&console.log(t+" : "+e)}var p=!1;function h(e){if(e.commandHandlerId){if(!e.executionCtx)throw new Error("mod_commandsManagerComponent.js cannot execute a command without an execution context");var n=e.executionCtx.getComponent(t.DEFAULT_COMPONENT_NAME);if(!n)throw new Error("mod_commandsManagerComponent.js cannot execute a command without a handler component registered on the execution context");n.executeHandler({id:e.commandHandlerId})}}function u(t){if(t.cmdsManager._private._runningCmd)throw new Error("CmdsManager.runNextCmd a command is already running");if(t.cmdsManager._private._currentExecutionDone){var n;if(t.cmdsManager._private._executionChain.length>0&&(n=t.cmdsManager._private._executionChain[0].caller.cmdHandler),t.cmdsManager._private._pausedCmds.length>0&&(!t.cmdsManager._private._waitingExecution||n===t.cmdsManager._private._pausedCmds[0]||n.getMode()!==e.CmdMode.NESTED)){var r=Object.create(null);return r.cmdsManager=t.cmdsManager,r.cmdHandler=t.cmdsManager._private._pausedCmds.pop(),void function(t){l("resume",t.cmdHandler.getId()),t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.EXECUTING,event:e.LifeCycleEvents.RESUME}),t.cmdsManager._private._runningCmd=t.cmdHandler,t.cmdHandler._private._command._instance.resumeExecute?(t.cmdHandler._private._command._instance.done=H.bind(t),g({callback:t.cmdHandler._private._command._instance.resumeExecute,caller:t.cmdHandler._private._command._instance})):g({callback:H,caller:t});g({callback:function(){t.cmdsManager._private._currentExecutionDone&&m(t.cmdHandler)&&E.call(t.cmdsManager)}}),t.cmdsManager._private._modelEvents.publish({event:t.cmdHandler.getId()+"/resume"}),t.cmdsManager._private._modelEvents.publish({event:"resume",data:t.cmdHandler.getId()})}(r)}if(0===t.cmdsManager._private._waitingExecution&&t.cmdsManager._private._currentExecutionDone){var i=t.cmdsManager.getDefaultCommand();i&&h({commandHandlerId:i,executionCtx:t.cmdsManager.getExecutionContext()})}setTimeout(function(){t.cmdsManager._private._waitingExecution?E.call(t.cmdsManager):t.cmdsManager._private._currentExecution&&t.cmdsManager._private._currentExecutionDone&&(t.cmdsManager._private._currentExecution=null)},0)}}function m(t){return t.getState()===e.HandlerState.EXECUTING}var _=new Array(50),f=0;function v(){for(var e=0;e<f;e+=3){var t=_[e],n=_[e+1],r=_[e+2];t.call(n,r),_[e]=void 0,_[e+1]=void 0,_[e+2]=void 0}f=0}function g(e){_[f]=e.callback,_[f+1]=e.caller,_[f+2]=e.arg,3===(f+=3)&&setTimeout(v,0)}function C(e){if(!e.caller.cmdsManager._private._currentExecutionDone)throw new Error("begin forbidden");return e.caller.cmdsManager._private._waitingExecution--,e.caller.cmdsManager._private._currentExecutionDone=!1,setTimeout(function(){e.callback.call(void 0,e.caller)},0),e.caller}function b(t){var n;if(t.caller.cmdHandler.getState()!==e.HandlerState.PAUSED)return t.caller.cmdsManager._private._runningCmd&&t.caller.cmdsManager._private._runningCmd!==t.caller.cmdHandler&&m(t.caller.cmdsManager._private._runningCmd)&&(t.caller.cmdsManager._private._waitingExecution++,(n=Object.create(null)).caller=Object.create(null),n.caller.cmdsManager=t.caller.cmdsManager,n.caller.cmdHandler=t.caller.cmdsManager._private._runningCmd,t.caller.cmdHandler.getMode()===e.CmdMode.EXCLUSIVE||!0===t.caller.cmdsManager._private._runningCmd._private._command._instance.cancelWhenPaused?(n.callback=M,n.caller.cmdHandler._private._command._instance.params=Object.create(null),n.caller.cmdHandler._private._command._instance.params.cancelReason=d.exclusiveCmdCalled):t.caller.cmdHandler.getMode()===e.CmdMode.NESTED&&(n.callback=y)),n}function E(){if(this._private._currentExecutionDone)if(0===this._private._executionChain.length)this._private._waitingExecution=0,this._private._executionChain=[],this._private._currentExecution=null,this._private._currentExecutionDone=!0,this._private._runningCmd||u({cmdsManager:this,cmdHandler:void 0});else{var e=b(this._private._executionChain[0]);e||(e=this._private._executionChain.shift()),this._private._currentExecution=C(e)}}function w(){this.cmdHandler._private._command._instance.done=function(){},l("paused",this.cmdHandler.getId()),this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/paused"}),this.cmdsManager._private._modelEvents.publish({event:"paused",data:this.cmdHandler.getId()}),this.cmdsManager._private._runningCmd=null,this.cmdsManager._private._currentExecution&&(this.cmdsManager._private._currentExecutionDone=!0);var e=this;setTimeout(function(){E.call(e.cmdsManager)},0)}function y(t){if(!t||!t.cmdsManager||!t.cmdHandler)throw new Error("pauseCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance");if(t.cmdsManager._private._unstackingCommand&&t.cmdsManager._private._unstackingCommand.length>0)return t.cmdsManager._private._currentExecutionDone=!0,t.cmdsManager._private._unstackingCommand=[],void setTimeout(function(){E.call(t.cmdsManager)},0);m(t.cmdHandler)&&(l("pause",t.cmdHandler.getId()),t.cmdsManager._private._modelEvents.publish({event:t.cmdHandler.getId()+"/pause"}),t.cmdsManager._private._modelEvents.publish({event:"pause",data:t.cmdHandler.getId()}),t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.PAUSED,event:e.LifeCycleEvents.PAUSE}),t.cmdsManager._private._pausedCmds.push(t.cmdHandler),t.cmdHandler._private._command._instance.pauseExecute?(t.cmdHandler._private._command._instance.done=w.bind(t),g({callback:t.cmdHandler._private._command._instance.pauseExecute,caller:t.cmdHandler._private._command._instance})):g({callback:w,caller:t}))}function A(t){var n,r=this.cmdsManager.getExecutionContext().getComponent("AFR_UndoRedoComponent");r&&!0===this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested&&(r._stopConcatenateUS(this.cmdsManager._private._runningCmd._private._command._instance._undoGroupID),this.cmdsManager._private._runningCmd._private._command._instance._endUndoGroupingRequested=!1);var o=this.cmdsManager._private._runningCmd._private._command._instance;if(n=function(e){var t=!1;if(!e._dirtyUndoStack)return t;var n=this.cmdsManager.getExecutionContext(),r=n.getComponent("AFR_UndoRedoComponent");if(r){var o=r.getLastStepId();if(e._previousUndoId<o){var a=!0;"shared"===e._mode&&e._executeUndoAtEnd&&(a=!1);var s=r._createUndoStep({undoTitle:e.getId(),exclusivity:a,redoEnabled:!e._executeUndoAtEnd});r.registerAction(s);var d=r.groupSteps(s.getId(),e._previousUndoId+1,n);if(i.hasSucceeded(d))t=!0;else{var c=r.removeStepWithId(r.getLastStepId());i.hasSucceeded(c)||i.logResult(c)}}}return t}.call(this,o),o.params&&o.params.undoOnEnd&&n){var a=!1;this.cmdsManager&&"WAFRRedoCmd"===this.cmdsManager.getRunningCommand()&&(a=!0),0===r.getUndoStack().getSize()||a||r.undo()}this.cmdsManager._private._runningCmd=null,this.cmdsManager._private._currentExecution&&(this.cmdsManager._private._currentExecutionDone=!0);var s=this.cmdHandler.getState()===e.HandlerState.CANCELED,d=this.cmdHandler.getRepeatMode()===e.RepeatMode.ALWAYS&&!s&&0===this.cmdsManager._private._waitingExecution;if(this.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDED,event:e.LifeCycleEvents.END,repeated:d,canceled:s}),l("end",this.cmdHandler.getId()),this.cmdsManager._private._modelEvents.publish({event:this.cmdHandler.getId()+"/end",data:{repeated:d,canceled:s}}),this.cmdsManager._private._modelEvents.publish({event:"end",data:{handlerId:this.cmdHandler.getId(),repeated:d,canceled:s}}),this.cmdHandler._private._cb&&"function"==typeof this.cmdHandler._private._cb&&(this.cmdHandler._private._cb(t?t.error:void 0),d||(this.cmdHandler._private._appCB=[],this.cmdHandler._private._cbIfCommandNotStarted=null)),this.cmdHandler._private._command._instance.destroy&&this.cmdHandler._private._command._instance.destroy(),this.cmdHandler._private._command._instance=null,d)this.cmdHandler.execute(),E.call(this.cmdsManager);else{var c=this;setTimeout(function(){c.cmdsManager._private._runningCmd||u(c)},0)}}function x(t){t&&t.undoOnEnd&&(this.cmdsManager._private._runningCmd._private._command._instance.params||(this.cmdsManager._private._runningCmd._private._command._instance.params={}),this.cmdsManager._private._runningCmd._private._command._instance.params.undoOnEnd=t.undoOnEnd);var n=this.cmdsManager.getExecutionContext();if(this.cmdHandler._private._command._instance.done=function(){},this.cmdHandler.getState()!==e.HandlerState.CANCELED&&this.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDING}),this.cmdHandler.isUsingComputeServer()){var r={from:this.cmdHandler._private._command._instance},i=n.getComponent("AFR_CSComponent");i&&i.sendStopCommand(r)}else{var o=this;setTimeout(function(){A.call(o,t)},0)}}function H(e){this.cmdHandler._private._command._instance.done=function(){},this.cmdsManager._private._runningCmd===this.cmdHandler&&m(this.cmdHandler)?(e&&e.error&&(this.cmdHandler._private._command._instance.params.error=e.error),e&&e.cancel?(this.cmdHandler._private._command._instance.params.cancelReason=d.askedByCmd,e.undoOnEnd&&(this.cmdHandler._private._command._instance.params.undoOnEnd=e.undoOnEnd),M(this)):x.call(this)):l("done execute callback called but command paused/canceled in between",this.cmdHandler.getId())}function S(e){if(!(e&&e.cmdsManager&&e.cmdHandler&&e.cmdHandler._private._command._instance&&e.cmdHandler._private._cb&&e.cmdHandler._private._cb))throw new Error("executeCmd require the parameter capsuleObject with a valid CommandsManager and cmdHandler with a valid command instance");if(l("begin",e.cmdHandler.getId()),e.cmdsManager._private._modelEvents.publish({event:e.cmdHandler.getId()+"/begin"}),e.cmdsManager._private._modelEvents.publish({event:"begin",data:e.cmdHandler.getId()}),e.cmdsManager._private._runningCmd=e.cmdHandler,!e.cmdHandler._private._command._instance.beginExecute&&!0!==e.cmdHandler._private._command._instance.stateGraph)throw new Error("mod_CommandsManagerComponent.executeCmd : Cannot execute a command without a beginExecute method defined on it. It has no sense. BAD Command : "+e.cmdHandler._private._command._module);var t=e.cmdsManager.getExecutionContext(),n=t.getComponent("AFR_UndoRedoComponent");if(n&&(e.cmdHandler._private._command._instance._previousUndoId=n.getLastCreatedUndoStepId()),e.cmdHandler.isUsingComputeServer()){var r={from:e.cmdHandler._private._command._instance},i=t.getComponent("AFR_CSComponent");i&&i.sendStartCommand(r)}!0!==e.cmdHandler._private._command._instance.stateGraph?(e.cmdHandler._private._command._instance.done=H.bind(e),g({callback:e.cmdHandler._private._command._instance.beginExecute,caller:e.cmdHandler._private._command._instance})):(!0===e.cmdHandler._private._command._instance.asyncGraph?e.cmdHandler._private._command._instance.done=function(){this.cmdHandler._private._command._instance.done=H.bind(this),this.cmdsManager._private._runningCmd===this.cmdHandler&&m(this.cmdHandler)?g({callback:this.cmdHandler._private._command._instance._initGraph,caller:this.cmdHandler._private._command._instance}):l("done execute callback called but command paused/canceled in between",this.cmdHandler.getId())}.bind(e):e.cmdHandler._private._command._instance.done=H.bind(e),g({callback:e.cmdHandler._private._command._instance.buildGraph,caller:e.cmdHandler._private._command._instance}),!0!==e.cmdHandler._private._command._instance.asyncGraph&&g({callback:e.cmdHandler._private._command._instance._initGraph,caller:e.cmdHandler._private._command._instance})),e.cmdsManager._private._currentExecution&&(e.cmdsManager._private._currentExecutionDone=!0),g({callback:function(){e.cmdsManager._private._currentExecutionDone&&m(e.cmdHandler)&&E.call(e.cmdsManager)}})}function M(t){if(!(t&&t.cmdsManager&&t.cmdHandler&&t.cmdHandler._private._cb))throw new Error("cancelCmd require the parameter capsuleObject with a valid cmdsManager and cmdHandler with a valid command instance");m(t.cmdHandler)&&(t.cmdHandler.setStateAndSendEvent({state:e.HandlerState.CANCELED,event:e.LifeCycleEvents.CANCEL}),l("canceling",t.cmdHandler.getId()),t.cmdsManager._private._modelEvents.publish({event:t.cmdHandler.getId()+"/canceling"}),t.cmdsManager._private._modelEvents.publish({event:"canceling",data:t.cmdHandler.getId()}),t.cmdHandler._private._command._instance.cancelExecute?(t.cmdHandler._private._command._instance.done=x.bind(t),g({callback:t.cmdHandler._private._command._instance.cancelExecute,caller:t.cmdHandler._private._command._instance,arg:t.cmdHandler._private._command._instance.params})):g({callback:x,caller:t}))}var I=Object.create(null);return I.CommandsManagerComponent=function(){var e=this;this._private||(this._private=Object.create(null)),this._private._defaultCommand=null,this._private._runningCmd=null,this._private._pausedCmds=[],this._private._executionChain=[],this._private._currentExecution=null,this._private._currentExecutionDone=!0,this._private._waitingExecution=0,this._private._modelEvents=new n,r.subscribe({event:"COMMAND_MANAGER/Ending_Commands"},function(){e.endAll(void 0)})},I.CommandsManagerComponent.DEFAULT_COMPONENT_NAME="AFR_CommandsManager",I.CommandsManagerComponent.prototype.initialize=function(e){return p=!1,e&&this.cmdsManager.getExecutionContext().setContext("usingCS",!0),o.resolve()},I.CommandsManagerComponent.prototype.clean=function(){var e=this;return p=!0,this.endAll().then(function(){e.setDefaultCommand(null)})},I.CommandsManagerComponent.prototype.isCmdExecuting=function(t){return t.getState()===e.HandlerState.EXECUTING},I.CommandsManagerComponent.prototype.setDefaultCommand=function(e){if(void 0===e||e&&"string"!=typeof e)throw new Error("CommandsManagerComponent.setDefaultCommand can only take null or a string (commandHandlerID) as input parameter");e&&null===this._private._runningCmd&&0===this._private._pausedCmds.length&&0===this._private._waitingExecution&&this._private._currentExecutionDone&&h({commandHandlerId:e,executionCtx:this._private._executionContext});this._private._defaultCommand=e},I.CommandsManagerComponent.prototype.getDefaultCommand=function(){return this._private._defaultCommand},I.CommandsManagerComponent.prototype.subscribeToCmdState=function(e,t,n){var r;return r=""===e?t:e+"/"+t,this._private._modelEvents.subscribe({event:r},function(e){n(e)})},I.CommandsManagerComponent.prototype.subscribeOnceToCmdState=function(e,t,n){var r;return r=""===e?t:e+"/"+t,this._private._modelEvents.subscribeOnce({event:r},function(e){n(e)})},I.CommandsManagerComponent.prototype.unsubscribeToCmdState=function(e){this._private._modelEvents.unsubscribe(e)},I.CommandsManagerComponent.prototype.getRunningCommand=function(){return this._private._runningCmd?this._private._runningCmd.getId():null},I.CommandsManagerComponent.prototype.getExposedComponentCtor=function(){function e(){this.cancelReason=d}return e.prototype.getDefaultCommand=this.getDefaultCommand.bind(this),e.prototype.getRunningCommand=this.getRunningCommand.bind(this),e.prototype.setDefaultCommand=this.setDefaultCommand.bind(this),e.prototype.isCmdExecuting=this.isCmdExecuting.bind(this),e.prototype.subscribeToCmdState=this.subscribeToCmdState.bind(this),e.prototype.unsubscribeToCmdState=this.unsubscribeToCmdState.bind(this),e.prototype.subscribeOnceToCmdState=this.subscribeOnceToCmdState.bind(this),e},I.CommandsManagerComponent.prototype.stackCommandExecutionRequest=function(t,n){var r=Object.create(null);r.cmdsManager=this,r.cmdHandler=n.handler;var o=n.cb;r.cmdHandler._private._cbIfCommandNotStarted=o,function(t){if(t.caller.cmdsManager._private._waitingExecution++,t.caller.cmdsManager._private._currentExecution||!t.caller.cmdsManager._private._currentExecutionDone||t.caller.cmdsManager._private._runningCmd&&!m(t.caller.cmdsManager._private._runningCmd))if(t.caller.cmdsManager._private._executionChain.length>0){t.caller.cmdsManager._private._waitingExecution--;var n=t.caller.cmdsManager._private._executionChain.pop();if(n.caller.cmdHandler.setStateAndSendEvent({state:e.HandlerState.ENDED,event:e.LifeCycleEvents.END,notStarted:!0}),n.caller.cmdHandler._private._cb&&"function"==typeof n.caller.cmdHandler._private._cb){const e=i.createReturnObject(s.COMMAND_NOT_STARTED,{description:"Can't start the command as another one has been started as the same time."});n.caller.cmdHandler._private._cbIfCommandNotStarted&&n.caller.cmdHandler._private._appCB.push(n.caller.cmdHandler._private._cbIfCommandNotStarted),n.caller.cmdHandler._private._cb(e),n.caller.cmdHandler._private._appCB=[]}n.caller.cmdHandler===t.caller.cmdHandler?t.caller.cmdsManager._private._waitingExecution--:(t.caller.cmdsManager._private._unstackingCommand=[],t.caller.cmdsManager._private._unstackingCommand.push({discardedCommand:n,newCommandToExecute:t}),t.caller.cmdsManager._private._executionChain.push(t))}else t.caller.cmdsManager._private._executionChain.push(t);else{var r=b(t);r?(t.caller.cmdsManager._private._executionChain.push(t),r.caller.cmdsManager._private._currentExecution=C(r)):t.caller.cmdsManager._private._currentExecution=C(t)}}({callback:function(r){if(!r)throw new Error("mod_CommandsManagerComponent.js callback in chainNewExecution cannot start a command is no capsuleObject is passed");if(!p){if(null!==o&&"function"==typeof o||(o=void 0),r.cmdHandler.getState()===e.HandlerState.PAUSED)return r.cmdsManager._private._currentExecution&&(r.cmdsManager._private._currentExecutionDone=!0),void setTimeout(function(){E.call(r.cmdsManager)},0);m(r.cmdHandler)?(r.cmdHandler._private._appCB||(r.cmdHandler._private._appCB=[]),o&&r.cmdHandler._private._appCB.push(o),r.cmdHandler._private._command._instance.params=Object.create(null),r.cmdHandler._private._command._instance.params.cancelReason=d.secondExecuteCalled,M(r)):(r.cmdHandler.setStateAndSendEvent({state:e.HandlerState.EXECUTING,event:e.LifeCycleEvents.BEGIN}),require([r.cmdHandler._private._command._module],function(e){if(!e)throw new Error("Failed to load the module related to the command",r.cmdHandler._private._id);var i=null,a=r.cmdsManager.getExecutionContext();a&&((i=a.applicationContext).ID=r.cmdsManager._private._executionContext.getId()),n.args||(n.args=Object.create(null)),n.args.cmdLifeCyleEventsChanel=r.cmdsManager._private._modelEvents,n.ID=r.cmdHandler.getId(),e.prototype.isNewInfraActivated=function(){return!0};var s=new e({args:n.args,executionContext:i,ID:n.ID});if(!s)throw E.call(r.cmdsManager),new Error("Call to "+r.cmdHandler._private._command._module+" constructor returned undefined");r.cmdHandler.isUsingComputeServer()&&(s.getCSIdentifier=function(){return s},s.hasDecalredCS=function(){return!0},s.onCmdEnded=function(e){return A.call(r,e)}),s.getId=function(){return r.cmdHandler.getId()},s.askForUndoGroupingAtEnd=function(e,t){s._endUndoGroupingRequested=!0,s._concatenateServerStep=t,s._undoGroupID=e},s._evtID=i.ID+n.ID,r.cmdHandler._private._command._instance=s,r.cmdHandler._private._command._instance.params={},r.cmdHandler._private._cb=t,r.cmdHandler._private._appCB||(r.cmdHandler._private._appCB=[]),o&&r.cmdHandler._private._appCB.push(o),S(r)},function(){var e=new Error("Require failed ("+r.cmdHandler._private._command._module+")");if(!o||"function"!=typeof o)throw e;o(e),E.call(r.cmdsManager)}))}},caller:r})},I.CommandsManagerComponent.prototype.endAll=function(){var e=this;return new UWA.Promise(function(t,n){var i=e._private._pausedCmds.length;if(i>0)var o=e.subscribeToCmdState("","resume",function(n){var a=Object.create(null);if(a.cmdsManager=e,a.cmdHandler=e._private._runningCmd,M(a),0===--i)return e.unsubscribeToCmdState(o),r.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),t()});if(e._private._runningCmd&&("WAFRUndoCmd"!==e._private._runningCmd._private._id||"Undo"!==e._private._runningCmd._private._id)){var a=Object.create(null);a.cmdsManager=e,a.cmdHandler=e._private._runningCmd,M(a)}if(0===i)return r.publish({event:"COMMAND_MANAGER/ALL_CMD_ENDED"}),t()})},I}),define("DS/WAfrHandlers/mod_CommandHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CommandHandlerUtilities","DS/WAfrHandlers/mod_LeafHandler"],function(e,t,n){"use strict";const r=n.LeafHandler,i=n.StandaloneLeafHandlerState,o="COMMAND_HANDLER";e.registerLeafHandler(o,{executeFunc:t.executeCommandHandler});let a=Object.create(null);function s(e){return Boolean(e)&&a.LifeCycleEvents.hasOwnProperty(e)}a.CmdMode={EXCLUSIVE:t.CmdMode.EXCLUSIVE,NESTED:t.CmdMode.NESTED},a.RepeatMode={NEVER:t.RepeatMode.NEVER,STANDARD:t.RepeatMode.STANDARD,ALWAYS:t.RepeatMode.ALWAYS},a.LifeCycleEvents={BEGIN:t.LifeCycleEvents.BEGIN,PAUSE:t.LifeCycleEvents.PAUSE,RESUME:t.LifeCycleEvents.RESUME,CANCEL:t.LifeCycleEvents.CANCEL,END:t.LifeCycleEvents.END};class d extends i{constructor(e){super(e)}execute(e){const n=e?e.cb:void 0,r=e?e.args:void 0;return t.executeCommandHandler({handler:this._handler,cb:n,args:r})}}return a.CommandHandler=class extends r{constructor(t){if(super(t),!t)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters has to be defined");if(!t.module||"string"!=typeof t.module)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters.module has to be defined and to be a non empty string");if(!t.cmdsManager||"object"!=typeof t.cmdsManager)throw new Error("DS/WAfrHandlers/mod_CommandHandler.CommandHandler: parameters.cmdsManager has to be defined and to be Object of type DS/WAfrCommandsArchitecture/mod_CommandsManagerComponent");this._private||(this._private=Object.create(null)),this._private._type=e.enums.HandlerType[o],this._private._command=Object.create(null),this._private._command._module=t.module,this._private._command._instance=null,this._private._command._mode=t.cmdMode?t.cmdMode:a.CmdMode.EXCLUSIVE,this._private._repeatMode=t.repeatMode?t.repeatMode:a.RepeatMode.NEVER,this._private._cmdsManager=t.cmdsManager,this._private._useComputeServer=!!t.computeServer&&t.computeServer,this._private._cb=null,this._private._cbIfCommandNotStarted=null,this._private._handlerState=new d(this)}makeStandalone(){if(this._private._handlerState instanceof d)throw new Error("Call makeStandalone method on an CommandHandler which is already a standalone item");this._private._handlerState=new d(this)}execute(e){super.execute(e)}getMode(){return this._private._command._mode}setMode(e){if("string"!=typeof e&&"number"!=typeof e||!t.CmdMode.hasOwnProperty(e)&&(e<0||e>t.CmdMode.NESTED))throw new Error("CommandHandler.setMode : command mode value illegal. The command mode must be defined on mod_CommandHandler.CmdMode");if(this._private._command._instance)throw new Error("CommandHandler.setMode : command mode cannot be changed durring command execution");this._private._command._mode=e}getRepeatMode(){return this._private._repeatMode}setRepeatMode(e){if("number"!=typeof e||e<0||e>t.RepeatMode.ALWAYS)throw new Error("CommandHandler.setRepeatMode : command repeat mode value illegal. The command repeat mode must be defined on mod_CommandHandler.RepeatMode");this._private._repeatMode=e}getCSIdentifier(){return this._private._command._instance}isUsingComputeServer(){return this._private._useComputeServer}setHandlerComponent(e){return this._private._handlerState.setHandlerComponent(e)}getHandlerComponent(){return this._private._handlerState.getHandlerComponent()}setStateAndSendEvent(e){if(!e||!e.state)throw new Error("parameters has to be defined with a non empty and valid state property (mod_CommandHandler.HandlerState) ");const n=e.state.toUpperCase();if(!t.isValidHandlerState(e.state))throw new Error("There is no state corresponding to the event "+e.state+" for a CommandHandler");if(this._private._command._state=t.HandlerState[n],e.event){const n=e.event.toUpperCase();if(s(n)){const r=this.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this CommandHandler",this);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=this.getId();if(!o)throw new Error("handlerIdentifier has to be a non empty string.");i.publish({event:o+"/"+t.LifeCycleEvents[n],data:{repeated:e.repeated,canceled:e.canceled,notStarted:e.notStarted}})}}}getState(){return this._private._command._state}onLifeCycleEvent(e,t){if(!e||"string"!=typeof e)throw new Error("identifier has to be a non empty string");const n=e.toUpperCase();if(!s(n))throw new Error("The given identifier is not supported by an CommandHandler",e);if(!t||"function"!=typeof t)throw new Error("cb has to be a function",t);const r=this.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this CommandHandler",this);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=this.getId();if(!o)throw new Error("handlerIdentifier has to be a non empty string.");return i.subscribe({event:o+"/"+n},t)}removeLifeCycleEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this CommandHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}},a}),define("DS/WAfrExecutionContext/mod_ExecutionContext",["UWA/Utils","UWA/Core","DS/WAfrExecutionContext/mod_Component","UWA/Class/Promise","DS/WAfrExecutionContext/mod_ExecutionContextInterpreter","DS/WAfrUtils/Logger","DS/WAfrContainer/App","DS/WAfrDebug/mod_Performances","i18n!DS/WAfrContainer/assets/nls/Notification","DS/Controls/ModalContainer","DS/Controls/Loader","i18n!DS/WAfrExecutionContext/assets/nls/Transition","DS/WebUAUtils/WebUAUtils"],function(e,t,n,r,i,o,a,s,d,c,l,p,h){"use strict";var u=s.Performances,m=Object.create(null);function _(e){var t={},n=function(e){var n=e.split("==");if(2!==n.length)throw new Error("Bad syntax, expected expression like A == B, found "+e);var r=n[0].trim(),i=n[1].trim();if(r.indexOf('"')>=0||i.indexOf('"')>=0)throw new Error('Bad syntax, key and value should not contain double quote ", found '+e);if(r.indexOf(" ")>=0||i.indexOf(" ")>=0)throw new Error("Bad syntax, key and value should not contain space, found "+e);t[r]=i};if(e.indexOf("&&")>=0){var r=e.split("&&");if(r.length<2)throw new Error("Bad syntax, expected expression like A == B && C == D, found "+e);r.forEach(n)}else n(e);return t}function f(e,t,n){var r=!0;return Object.keys(t.when).forEach(function(n){r=r&&t.when[n]===e[n]}),r&&!t.fit?(t.fit=!0,!n&&t.onDidFitContext&&t.onDidFitContext(t.element)):r||(t.fit=!1,!n&&t.onDidUnfitContext&&t.onDidUnfitContext(t.element)),t.fit}function v(e){return{current:0,next:function(){return this.current>=e.length?null:e[this.current++]}}}function g(e){for(var t=n.Component.prototype,r=Object.keys(t),i=0;i<r.length;i++){const t=r[i];if(!e.hasOwnProperty(t))return!1}return!0}function C(e,t,n){return e(n)?t(n).then(C.bind(null,e,t)):n}function b(e){var t=e.iterator,n=e.action,i=e.generatedData,o=e.inverse;if(null===n||"function"!=typeof n)throw new Error("The action cannot be null and must be a function returning a promise");for(var a=[],s=[],d=[],c=[],l=t.next(),p=null,h=0;l;)p=i?i[h]:null,l.canBeParallelized()?(a.push(l),d.push(p)):o?(s.unshift(l),c.unshift(p)):(s.push(l),c.push(p)),l=t.next(),h+=1;var u=function(){return!s||s.length<=0?r.resolve():C(function(e){return e<s.length},function(e){return n(s[e],c[e]).then(function(){return++e})},0).then(function(e){return r.resolve(e)}).catch(function(e){return r.reject(e)})},m=function(){var e=a.length,t=null,i=[];for(h=o?e-1:0;o?h>=0:h<e;o?--h:++h)p=d[h],t=n(a[h],p),i.push(t);return r.all(i)};return o?m().then(u):u().then(m)}function E(e,t){return{current:0,next:function(){for(var n;this.current<e.length&&!n;){var r=e[this.current];n=t[r]?t[r].component:void 0,this.current+=1}return n}}}function w(e,t,n){var r,i,o=e._appComponents.length+e._stdComponents.length;if(n)for(i=o-1;i>=0;i--)r=i>=e._appComponents.length?e._stdComponents[i-e._appComponents.length]:e._appComponents[i],t(e._components[r],r);else for(i=0;i<o;i++)r=i>=e._stdComponents.length?e._appComponents[i-e._stdComponents.length]:e._stdComponents[i],t(e._components[r],r)}function y(e,t,r){return r?n.Component.implementsBy(e):n.StandardComponent.implementsBy(e),new e(t)}function A(e,t){return Boolean(e&&t&&e.stdConf&&e.stdConf[t])}function x(e){const t=e.getComponent("mod_WelcomeScreen");t&&e.a2xConfig.isWelcomeScreenLoaded&&(t.hideWelcomeScreen(),e.a2xConfig.isWelcomeScreenLoaded=!1),e._doIWantToBeInWSContext=!1}m.hasConfigurationFor=A,m.getConfigurationFor=function(e,t){let n;return e&&t&&e.stdConf&&e.stdConf[t]&&(n=e.stdConf[t]),n};var H=function(n){var a=this;this._perf=new u,n=t.merge(n||{},{config:{components:[],interpreters:[]}}),this._id=n.id||e.getUUID(),this._config=n.config,this._config.interpreters=this._config.interpreters||[],this._interpreter=i.generateExecutionContextInterpreter(),this._components=Object.create(null),this._stdComponents=[],this._appComponents=[],this._contextualElements=[],this._WSComponents=[],this._handlers={},this.exposedApi=function(e){return{getId:e.getId.bind(e),getComponent:function(t){return e.getComponent(t,!0)},registerComponent:function(t,n){e.registerApplicationComponent(t,n)},createAndRegisterComponent:e.createAndRegisterApplicationComponent.bind(e),unregisterComponent:e.unregisterApplicationComponent.bind(e),isRegisteredComponent:e.isRegisteredComponent.bind(e),recycleComponent:e.recycleComponent.bind(e),getData:function(){},getSourceApp:e.getSourceApp.bind(e),getTargetApp:e.getTargetApp.bind(e),getComponents:function(t){return e.getComponents(t,!0)},getContext:function(){return t.clone(e._contexts)},setContext:e.setContext.bind(e),switchApp:function(t){require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Data"],function(n,r){n.getAppInfo({appId:t,onComplete:function(n){var i="";n.brand&&"string"==typeof n.brand&&"3DEXPERIENCE"!==n.brand&&"SOLIDWORKS"!==n.brand&&(i=n.brand),window.widget.setMetas({brand:i});var o=function(o){r.request(o,{type:"json",responseType:"json",onComplete:function(r){for(var o in r)window.widget.data[o]=r[o];return r.appId=t,r.title=n.title,r.brand=i,e.load(r),!0}})};if(n.config)o(n.config);else for(var a=0;a<n.platforms.length;a++)if(n.platforms[a].id===n.platformId&&n.platforms[a].config){o(n.platforms[a].config);break}}})})},gotoWelcomeScreen:function(){return e.gotoWelcomeScreen()},gotoApp:function(){return e.gotoApp()},getWelcomeScreenState:function(){return e.getWelcomeScreenState()}}}(this),this.applicationContext=this.exposedApi,this._version=null,this._container=n.container,this._contexts=Object.create(null),this.onWillLoadApp=null,this.onDidLoadApp=null,this.onDidFailToLoadApp=null,this.onDidContextualComponentsUpdate=null,this._container=n.container,this._loader=null,this._container&&(this._container.subscribe("onReuseContext."+this.getId(),function(e){let t=10*parseFloat(e.afrVersion);t!==a._container._view._version/10?require([t>=2?"DS/WAfrContainerAsWidget/default_config":"DS/WAfrContainerAsWidget/old_config"],function(t){a._container._config=t,a._config=t,a.load(e)}):a.load(e)}),this._container.subscribe("displayAfrLoader",function(e){a.displayLoader(e)}),this._container.subscribe("hideAfrLoader",function(){a.hideLoader()})),this.applicativeMainUIComponentAvailability=!0,this._doIWantToBeInWSContext=!1,this.WSState=!1,this.isA2X=!1,this._isConfigured=!1,this._initExecutionContext=function(e,n,r){return this._interpreter.interpret(e,a).then(function(){return a.registerStandardComponents()}).then(function(){return a.loadApp(e)}).then(function(e){if(a._targetApp=e.app,!a._targetApp)throw new Error("Not found a target app !");return a.prepareTransition(e)}).then(function(r){a._isConfigured=!1,a._components=t.merge(a._components,r.metaDatas),Object.keys(r.metaDatas).forEach(e=>{a._components[e].resetInfo&&!a._components[e].ctor&&(delete a._components[e],a._components[e]=r.metaDatas[e])}),a._appComponents=r.componentsKeys;var i=!1;for(var s in a._handlers){i=!1;for(var d=0;d<e.handlers.check.length;d++)e.handlers.check[d].identifier===s&&(e.handlers.check[d].defaultState=a._handlers[s],i=!0);if(!i)for(var c=0;c<e.radioGroup.items.length;c++)e.radioGroup.items[c].identifier===s&&(e.radioGroup.items[c].default=a._handlers[s])}return a.callAllInterpreters(e,n).then(function(e){return o.log("[Execution context] Initialize standard components"),a.initializeStandardComponents({generatedData:e})}).then(function(){return r})})},this._welcomeScreenPromiseSequence=function(e){return o.log("[Execution context] Initialize WS applicative components"),a.initializeWSApplicativeComponents(e).then(function(){return o.log("[Execution context] Initialize application"),a.initializeWelcomeScreen()}).then(function(){o.log("[Execution context] Set Up the application Home Screen"),a.WSState=!0})},this._appPromiseSequence=function(e){let t=[],n=[],i=[];return e&&0!==Object.keys(e).length&&e.componentsKeys&&e.componentsKeys.forEach(function(e){a._components[e].component&&n.push(a._components[e].component)}),w(a,function(e,r){e.standard||(e.context?e.context.fit&&!e.component&&(e.ctor?(a.registerComponentThruMetaData(r,e),n.push(e.component)):(i.push(e.module),t.push(r))):e.component||(e.ctor?(a.registerComponentThruMetaData(r,e),n.push(e.component)):(i.push(e.module),t.push(r))))}),a.appModules=i,new r(function(e,r){let o,s,d,c;require(i,function(){for(arguments.length!=a.appModules.length&&e(),o=0;o<arguments.length;o++)s=arguments[o],d=t[o],(c=a._components[d]).ctor=s,a.registerComponentThruMetaData(d,c),n.push(c.component);e()},r)}).then(function(){return a.initializeApplicativeComponents({iterator:v(n)})}).then(function(){return o.log("[Execution context] Configure standard components"),a._isConfigured?Promise.resolve():a.configureComponents()}).then(function(){return o.log("[Execution context] Initialize application"),a.initializeApp()}).then(function(e){return o.log("[Execution context] set the target app "+a._targetApp+" as source app"),e&&(o.warn("[WARNING] App should use the UIFrame component to add UI to their App"),e.inject(a.getUiContainer())),a.WSState=!1,r.resolve()})},this._launchA2XNativeApp=function(e){if(!e.appId)throw new Error("Missing parameter appId!");return function(e,t){if(!e||!t)throw new Error("Missing parameters. Please provide modules to require and thier corresponding keys");let n=[].concat(t),r=[].concat(e);return new Promise(function(e,t){require(r,function(){let t=Object.create(null);for(let e=0;e<arguments.length;e++)t[n[e]]=arguments[e];e(t)},function(e){t(new Error(`Unable to load module : ${e.requireModules}. Please check your packaging`))})})}("DS/WAfrA2XLoader/WAfrA2XAppLoader","AppLoader").then(t=>t.AppLoader.loadA2XApp({appId:e.appId,clientNode:this._container.getA2XClient()}))},this._addNativeContent=function(e){return this.enrichStandardComponents(e).then(()=>{const e=this.getComponent("Afr_UIComponent");return e&&e.showMainComponent(),x(this),this._appPromiseSequence()})},this._subscribeToNativeTransitionEvent=function(){let e=Promise.resolve();const t=this._container.getA2XClient();this.a2xConfig.subscriptionToken=t.subscribe("AfrA2XTransitionEvent",t=>{const n=t.readString("wkName"),r=t.readString("appContent");if(n&&r){const t=JSON.parse(r);if(this.getSourceApp().getId()===`${n}_AP`)e=this._addNativeContent(t);else{this.a2xConfig.loadedFromNative=!0;const r=`${n}_AP`;e=this._container.getApplicationJSON({appId:r}).then(e=>(x(this),this.load(e))).then(()=>this._addNativeContent(t))}}else{const t=new Error("Impossible to retrieve the application name or the application content.");console.error(t),e=Promise.reject(t)}return e})}};return m.ExecutionContext=H,H.prototype.setUiContainer=function(e){this._view=e},H.prototype.getUiContainer=function(){return this._view},H.prototype.getTargetApp=function(){return this._targetApp},H.prototype.getSourceApp=function(){return this._sourceApp},H.prototype.getId=function(){return this._id},H.prototype.getComponent=function(e,t){if(null==e)throw new Error("Invalid identifier "+e);var n=void 0;if(this._components&&(n=this._components[e]),n){var r=n.component;if(r){if(t&&r.getExposedComponent&&r.getExposedComponent())return r.getExposedComponent();if(!t||!n.standard)return r}}},H.prototype.cleanComponent=function(e,t){if(!e)throw new Error("Component must be defined ");var n=e.getRegisteredIdentifier();if(null==n||"string"!=typeof n)throw new Error("Invalid identifier "+n);var i=this._components[n];if(!i)throw new Error("The MetaData for this component do not exists");var a=this;if(o.log("[Execution context] clean component "+n),i.new)return i.new=!1,r.resolve();var s=e.clean()||r.resolve();return i.recycled&&i.context&&(i.recycled=f(a._contexts,i.context,!0)),!i.recycled&&!i.standard||i.standard&&i.clear||i.welcomeScreen?s.then(function(){return o.log("[Execution context] destroy component "+n),e.destroy()}).then(function(){return o.log("[Execution context] Remove component "+n+" from execution context"),t=!!i.clear||t&&!i.standard,a.removeComponent(i,t),r.resolve(e)}):(i.recycled=!1,s.then(function(){return r.resolve(e)}))},H.prototype.unregisterComponent=function(e,t){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);if(void 0!==this._components[e]){var n=this._components[e];if(n.standard&&t)throw new Error("Invalid access, try to unregister a standard component from application side");var i=n.component,a=this;return o.log("[Execution context] clean component "+e),(i.clean()||r.resolve()).then(function(){return o.log("[Execution context] destroy component "+e),i.destroy()}).then(function(){return o.log("[Execution context] Remove component "+e+" from execution context"),a.removeComponent(n,!0),r.resolve(i)})}return r.resolve()},H.prototype.isRegisteredComponent=function(e){if(!e)throw new Error("The component is null or undefined");var t=!1,n=e.getRegisteredIdentifier(),r=this._components[n];return r&&r.component&&(r.component===e||r.component.getExposedApi&&r.component.getExposedApi()===e)&&(t=!0),t},H.prototype.cleanComponents=function(e){var t=this;return b({action:function(n){return t.cleanComponent(n,!!e&&e.removeForGood)},inverse:!0,iterator:e&&e.iterator?e.iterator:E(t._appComponents.concat(t._stdComponents),t._components)})},H.prototype.destroyComponents=function(e){var t=this;return b({action:function(e){o.log("[Execution context] destroy component "+e.getRegisteredIdentifier());var n=t._components[e.getRegisteredIdentifier()];return e.destroy().then(function(){return t.removeComponent(n,n.clear)})},inverse:!0,iterator:e&&e.iterator?e.iterator:E(that._appComponents.concat(that._stdComponents),that._components)})},H.prototype.recycleComponent=function(e,t){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);var n=this._components[e];if(!n)return!1;if(n.standard)throw new Error("Cannot recycle a standard component");if(n.recycled)return!1;var r=!0;if(t){var i=this._targetApp.options.appConfig.components.find(t=>t.key==e);n.options=i.options,n.component&&(n.component.options=i.options),i.when?(n.context={element:i.key,when:_(i.when),onDidFitContext:this.onDidFitContextForComponent.bind(this),onDidUnfitContext:this.onDidUnFitContextForComponent.bind(this)},r=f(this._contexts,n.context,!0)):delete n.context}return r&&(n.recycled=!0),!0},H.prototype.isComponentRecycled=function(e){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);var t=this._components[e];return!!t&&t.recycled},H.prototype.getComponents=function(e,t){if(!e)throw new Error("Predicate function is mandatory");var n,r=[],i=this;return w(this,function(o,a){(n=i.getComponent(a,t))&&e(n)&&r.push(n)}),r},H.prototype.registerComponent=function(e,t,n,r){if(null==e||"string"!=typeof e)throw new Error("Invalid identifier "+e);if(null==t)throw new Error("Component cannot be null");if(r&&!g(Object.getPrototypeOf(t))&&!g(t))throw new Error("the given component do not contains some methods of DS/WAfrExecutionContext/mod_Component");if("setExecutionContext"in t==!1||"setRegisteredIdentifier"in t==!1)throw new Error("The component do not implements module:DS/WAfrExecutionContext/mod_Component~Component. Use applyComponentMixin first from the context.");if(this._components[e])throw new Error("An component has already been registered with this identifier "+e);var i=n?this._appComponents:this._stdComponents,o={standard:!n,position:i.length};this._components[e]=o,i.push(e),this.registerComponentThruMetaData(e,o,t)},H.prototype.removeComponent=function(e,t){if(!e)throw new Error("You must provide a metaData");if(!e.component)throw new Error("The component is already removed");var n=e.component.getRegisteredIdentifier();if(e.component.setExecutionContext(null),e.component.setRegisteredIdentifier(null),delete e.component,t){var r=e.standard?this._stdComponents:this._appComponents,i=r.indexOf(n);if(i>=0&&r.splice(i,1),!e.standard){let e=this._WSComponents.findIndex(function(e){return e===n});-1!==e&&this._WSComponents.splice(e,1)}delete this._components[n]}},H.prototype.registerComponentThruMetaData=function(e,t,r){if(!t)throw new Error("The metaData do not exist: the module may not be required");if(t.component)throw new Error("The component: "+t.component._private._identifier+" is already created");if(!r){if(!t.ctor)throw new Error("The Component constructor must be defined.");if("function"!=typeof t.ctor)throw new Error(" Component constructor must be a constructor (i.e. functions)");r=y(t.ctor,t.options,!t.standard)}t.component=r;var i=t.standard?this:this.exposedApi;t.component.setExecutionContext(i),t.component.setRegisteredIdentifier(e);var o=t.component.createExposedComponent&&t.component.createExposedComponent();if(o)n.Component.mixinProperties(o),o.setExecutionContext(this.exposedApi),o.setRegisteredIdentifier(e),t.component.setExposedComponent(o);else{var a=t.component.getExposedComponentCtor&&t.component.getExposedComponentCtor();if(a){var s=y(a,void 0,!0);s.setExecutionContext(this.exposedApi),s.setRegisteredIdentifier(e),t.component.setExposedComponent(s)}}return t.component},H.prototype.createAndRegisterComponent=function(e,t,n,r){if(!this._components[e]){var i=y(t,n,r);if(this.registerComponent(e,i,r),!this._components[e])throw new Error("The metaData for component do not exist !");return this._components[e].ctor=t,i}},H.prototype.requireStandardComponents=function(e,t){var n,i,o,a,s,d=this;if(e.length!==t.length)throw new Error("Modules and keys do not have the same size !");return new r(function(r,c){require(e,function(){var e;for(n=0;n<arguments.length;n+=1)i=arguments[n],o=t[n],e=d._components[o],a=e.ctorImport,s=a?i[a]:i,e.ctor=s,d.registerComponentThruMetaData(o,e);r()},c)})},H.prototype.registerStandardComponents=function(){o.log("[Execution context] Register standard components if need ");var e=this;if(e._stdComponents.length>0){var n,r=[],i=[],a=[],s=[],d=Array.from(e._config.components);if(w(this,function(t,o){if(e._stdComponents.length!=e._config.components.length&&t.standard){0==d.length&&(t.component?(a.push(t.component),t.clear=!0):delete e._components[o]);for(let n=0;n<d.length;n++){if(d[n].key===o){d.splice(n,1);break}n===d.length-1&&(t.component?(a.push(t.component),t.clear=!0):delete e._components[o])}}t.standard&&t.context&&(n=f(e._contexts,t.context,!0),t.component?!n&&t.component&&(a.push(t.component),s.push(t.component)):n&&(r.push(t.module),i.push(o)))}),e._stdComponents.length!=e._config.components.length){var c=e.parseComponents(d,!1,!0);e._components=t.merge(e._components,c.metaDatas),e._stdComponents=e._config.components.map(e=>e.key),r=r.concat(c.readyModules),i=i.concat(c.readyKeys)}return e.cleanComponents({iterator:v(a)}).then(function(){return e.destroyComponents({iterator:v(s)})}).then(function(){return e.requireStandardComponents(r,i)})}var l=e.parseComponents(e._config.components);return e._components=t.merge(e._components,l.metaDatas),e._stdComponents=l.componentsKeys,e.requireStandardComponents(l.readyModules,l.readyKeys)},H.prototype.initializeStandardComponents=function(e){var t=this,n=null;return b({action:function(e,r){(n=e.getCurrentInterpreter&&e.getCurrentInterpreter())&&n.commit&&n.commit(t,{componentId:e.getRegisteredIdentifier()});let i=t._perf.start("WAFR: initialize std :"+e._private._identifier);return e.initialize(r).then(function(){t._perf.stop(i)})},generatedData:e.generatedData,iterator:e&&e.iterator?e.iterator:E(this._stdComponents,this._components)})},H.prototype.enrichStandardComponents=function(e){const t=this._interpreters,n=this;let r=Promise.resolve();return this._interpreters.length>0&&(r=C(function(e){return e<t.length},function(r){const i=t[r];let o=Promise.resolve();return i.enrich&&(o=i.enrich(e,n).then(function(){},function(e){throw e})),o.then(()=>++r)},0)),r},H.prototype.initializeWSApplicativeComponents=function(e){var t=this;return b({action:function(e,n){let r=t._perf.start("WAFR: initialize "+e._private._identifier);var i=e.initialize(n);if(i)return i.then(function(){t._perf.stop(r)});t._perf.stop(r)},iterator:e&&e.iterator?e.iterator:E(this._WSComponents,this._components)})},H.prototype.configureComponents=function(e){var t=this;return b({action:function(e){return e.configure()},iterator:e&&e.iterator?e.iterator:E(this._stdComponents,this._components)}).then(function(){t._isConfigured=!0})},H.prototype.cleanStandardComponents=function(){return b({action:function(e){return e.clean()},iterator:E(this._stdComponents,this._components)})},H.prototype.parseApplicativeComponents=function(e){return this._appConfig={components:e},this.parseComponents(e,!0)},H.prototype.registerApplicationComponent=function(e,t){if(!t)throw new Error("Component is null");return this.registerComponent(e,t,!0,!0)},H.prototype.createAndRegisterApplicationComponent=function(e,t,n){if(!t)throw new Error("Component is null");return this.createAndRegisterComponent(e,t,n,!0)},H.prototype.createAndRegisterApplicationComponentsList=function(e){if(o.log("[Execution Context] Register Application Components :"+e),e)for(var t=0;t<e.length;t++){var n=e[t];this.createAndRegisterApplicationComponent(n.key,n.mod,n.options)}},H.prototype.getApplicationComponent=function(e){return this.getComponent(e,!0)},H.prototype.unregisterApplicationComponent=function(e){return this.unregisterComponent(e,!0)},H.prototype.isRegisteredApplicationComponent=function(e){return this.isRegisteredComponent(e)},H.prototype.recycleApplicationComponent=function(e,t,n){if(t&&!t.metaDatas[e])throw new Error('The App "'+this._targetApp.getId()+'" has requested to recyle the component "'+e+'" but do not declare it in its list of components :\n'+JSON.stringify(t.metaDatas,null,2));return this.recycleComponent(e,n)},H.prototype.isApplicationComponentRecycled=function(e){return this.isComponentRecycled(e)},H.prototype.prepareTransition=function(e){var t,n,i=this,o=0;return this._sourceApp?this._sourceApp.onWillLeave(this._targetApp).then(function(){return i._targetApp.onWillEnter(i._sourceApp)}).then(function(){var r=!0,a=i._targetApp.getTransitionFrom(i._sourceApp.getId());if(a||(a=i._targetApp.getTransitionFromFamily(i._sourceApp.getFamily())),a){var s=a.components||{},d=a.handlers||{};if(null!=a.resetInfo&&(r=a.resetInfo),s.keep)if("@all"===s.keep)for(t in i.applicationContext._components)i.recycleApplicationComponent(t,e,r);else if(Array.isArray(s.keep))for(;o<s.keep.length;o++)n=s.keep[o],i.recycleApplicationComponent(n,e,r);if(d.keep&&Array.isArray(d.keep)){var c=i._sourceApp.options.appConfig.handlers.check,l=e.app.options.appConfig.handlers.check,p=i._sourceApp.options.appConfig.radioGroup.items,h=e.app.options.appConfig.radioGroup.items,u="",m=u,_=u,f=i.getComponent(WAfrStandardComponentKey.HandlerComponent);for(o=0;o<d.keep.length;o++){_=d.keep[o],u=m="";for(var v=0;v<c.length;v++)if(c[v].identifier==_){u=c[v].identifier+"-"+c[v].check.identifier+"-"+c[v].uncheck.identifier;break}for(v=0;v<l.length;v++)if(l[v].identifier===_){m=l[v].identifier+"-"+l[v].check.identifier+"-"+l[v].uncheck.identifier;break}if(m===u&&""!=u){var g=f.getCheckState({id:_});i._handlers[_]=g}else{for(v=0;v<p.length;v++)if(p[v].identifier==_)for(var C=0;C<p[v].items.length;C++)1==f.getRadioItemState({radioId:p[v].identifier,id:p[v].items[C].identifier})&&(u=p[v].identifier+"-"+p[v].items[C].identifier+"-"+p[v].items[C].check.identifier+"-"+p[v].items[C].uncheck.identifier);for(v=0;v<h.length;v++)if(h[v].identifier==_)for(C=0;C<h[v].items.length;C++)if((m=h[v].identifier+"-"+h[v].items[C].identifier+"-"+h[v].items[C].check.identifier+"-"+h[v].items[C].uncheck.identifier)==u){g=h[v].items[C].identifier;i._handlers[_]=g;break}}}}}return i.cleanComponents({removeForGood:!0})}).then(function(){return r.resolve(e)}):r.resolve(e)},H.prototype.initializeApplicativeComponents=function(e){var t=this;return b({action:function(e,n){let r=t._perf.start("WAFR: initialize "+e._private._identifier);var i=e.initialize(n);if(i)return i.then(function(){t._perf.stop(r)});t._perf.stop(r)},iterator:e&&e.iterator?e.iterator:E(this._appComponents,this._components)})},H.prototype.load=function(e,t){var n=this;if(!e.appId&&!e.afrAppId)throw new Error("Not found a valid App id from the current Id Card ");h.setAppid(e.appId||e.afrAppId),this.onWillLoadApp&&this.onWillLoadApp(e.appId||e.afrAppId),n._perf.start("WAFR:  load entire App "),t||(t=e.afrVersion||"0.1"),o.log("[Execution context] load new app "+e.appId),this.isA2X=A(e,"a2x"),this.isA2X&&!this.a2xConfig&&(this.a2xConfig={subscribedToNative:!1,loadedFromNative:!1,subscriptionToken:null,isWelcomeScreenLoaded:!1});let i=this.isA2X?{...e.initialContext,a2x:!0}:e.initialContext;n.setInitialContext(i);var a=void 0;if(n._sourceApp&&e.afrTransitionsFrom&&((a=e.afrTransitionsFrom[n._sourceApp.getId()])||(a=e.afrTransitionsFromFamily?e.afrTransitionsFromFamily[n._sourceApp.getFamily()]:null),a&&"ReuseContext"===a.type)){var s=a.components||{};if(s.keep){if("@all"===s.keep)throw"TODO";if(Array.isArray(s.keep)){for(var d={},c=0;c<s.keep.length;c++){var l=s.keep[c],p=n._components[l];p&&p.context&&!0===p.context.fit&&Object.keys(p.context.when).forEach(function(e){d[e]=p.context.when[e]})}Object.keys(d).forEach(function(e){var t=d[e];null!=t&&(n._contexts[e]=String(t))})}}}return this.isA2X&&!this.a2xConfig.subscribedToNative&&(this.a2xConfig.subscribedToNative=!0,this._subscribeToNativeTransitionEvent()),this._initExecutionContext(e,t,a).then(function(e){if(n._doIWantToBeInWSContext)return n._welcomeScreenPromiseSequence(e);if(!n.isA2X)return n._appPromiseSequence(e);if(!n.a2xConfig.loadedFromNative&&n.getTargetApp()){const e=n.getTargetApp().getId();return n._launchA2XNativeApp({appId:e})}}).then(function(){n.getSourceApp()&&!n.getSourceApp().isDisposeCalled()&&n.getSourceApp().dispose(),n._sourceApp=n._targetApp,n._targetApp=null,n.hideLoader(),n.onDidLoadApp&&n.onDidLoadApp()}).catch(function(e){return n.hideLoader(),n.onDidFailToLoadApp&&n.onDidFailToLoadApp(e),r.reject(e)})},H.prototype.loadApp=function(e){var t=this;return new r(function(n,r){var i=e.afrCode;i||(i="DS/WAfrAppManager/App"),i=i.replace(/\./g,"/");var s,d,c,l,p,h,u=t.parseComponents(e.components||[],!0),m=[i].concat(u.readyModules);o.log("[Execution Context] Require modules "+m),require(m,function(){var i=arguments[0];if(arguments.length!==u.readyKeys.length+1)throw new Error("The count of arguments and components do not fit");for(s=0;s<u.readyKeys.length;s++)d=u.readyKeys[s],c=u.metaDatas[d],l=arguments[s+1],p=c.ctorImport,h=p?l[p]:l,c.ctor=h,t.registerComponentThruMetaData(d,c);var m=new i({appConfig:e});m instanceof a!=!1?m.getId()?(o.log("[App Interpreter] Success require App and components "),n({app:m,metaDatas:u.metaDatas,componentsKeys:u.componentsKeys})):r(new Error("The app loaded do not have an id")):r(new Error("The app loaded is not an instance of DS/WAfrAppManager/App"))},r)})},H.prototype.callAllInterpreters=function(e,t){o.log("[Execution context] Start interpret id card");var n,i=[],a=this._version!==t;if(!this._interpreters||this._config.interpreters.length!=this._interpreters.length){for(this._interpreters=[],n=0;n<this._config.interpreters.length;n++){var s=this._config.interpreters[n].module;this._interpreters.push(s.generateInterpreter(t))}a=!1}for(n=0;n<this._interpreters.length;n++){var d=this._interpreters[n];a&&(d=this._config.interpreters[n].module.generateInterpreter(t),this._interpreters[n]=d);var c=this._config.interpreters[n].target,l=c?this.getComponent(c):void 0;if(l&&l.setCurrentInterpreter(d),d){var p=d.interpret(e,this,{componentId:this._config.interpreters[n].target});i.push(p)}else i.push(r.resolve(null))}return r.all(i)},H.prototype.initializeApp=function(){var e=this.getTargetApp();if(!e&&!(e=this.getSourceApp()))return r.reject(new Error("No app has been loaded by the interpreter !"));var t=this;return e._executionContext=this.exposedApi,e.setContainer(t._container?t._container._view:null),new r(function(n,r){if(e){var i=e.setUp({sourceApp:t._sourceApp,done:function(e){n(e)},failure:function(e){r(e)}});i&&i.then(n,r)}})},H.prototype.initializeWelcomeScreen=function(){var e=this.getTargetApp();if(!e&&!(e=this.getSourceApp()))return r.reject(new Error("No app has been loaded by the interpreter !"));var t=this;e._executionContext=this.exposedApi,e.getContainer()||e.setContainer(t._container?t._container._view:null);var n=new r(function(n,r){if(e){var i=e.setUpWS({sourceApp:t._sourceApp,done:function(e){n(e)},failure:function(e){r(e)}});i&&i.then(n,r)}});return this.isA2X&&(this.a2xConfig.isWelcomeScreenLoaded=!0),n},H.prototype.dispose=function(){this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment);var e=this;if(this._sourceApp&&this._sourceApp.dispose(),w(this,function(t){t.component&&(t.component.clean(!0),t.component.destroy(!0),t.component.setExecutionContext(null),e.removeComponent(t))},!0),this.isA2X){const e=this._container.getA2XClient();e&&null!=this.a2xConfig.subscriptionToken&&null!=this.a2xConfig.subscriptionToken&&e.unsubscribe(this.a2xConfig.subscriptionToken),delete this.a2xConfig.loadedFromNative,delete this.a2xConfig.subscribedToNative,delete this.a2xConfig.subscriptionToken,delete this.a2xConfig,delete this.isA2X}return delete this._components,delete this._stdComponents,delete this._appComponents,delete this.exposedApi,delete this._contexts,this.onWillLoadApp=null,this.onDidLoadApp=null,this.onDidFailToLoadApp=null,this.onDidContextualComponentsUpdate=null,this._container=null,r.resolve()},H.prototype.registerContextualElement=function(e,t){if(!e||!e.when)throw new Error("The contextual element must be defined and must contain a when expression");t=t||{};var n={element:e,when:_(e.when),onDidFitContext:t.onDidFitContext,onDidUnfitContext:t.onDidUnfitContext};return this._contextualElements.push(n),f(this._contexts,n),n},H.prototype.onDidChangeContext=function(){this._timerHandle=null;var e=this._contexts;w(this,function(t){t.context&&f(e,t.context)}),this._contextualElements.forEach(function(t){f(e,t)})},H.prototype.parseComponents=function(e,t,n){var r,i,o=[],a=[],s={},d=[],c=this;return e.forEach(function(e){r=!0,i={module:e.code,ctorImport:e.ctor,options:e.options,standard:!t,position:d.length,new:1==n,resetInfo:e.resetInfo},"mod_WelcomeScreen"===e.key&&(i.welcomeScreen=!0),s[e.key]=i,d.push(e.key),e.when&&(i.context={element:e.key,when:_(e.when),onDidFitContext:c.onDidFitContextForComponent.bind(c),onDidUnfitContext:c.onDidUnFitContextForComponent.bind(c)},r=f(c._contexts,i.context,!0)),c._doIWantToBeInWSContext&&t&&(c._WSComponents.includes(e.key)||(r=r&&!c._doIWantToBeInWSContext)),r&&(o.push(e.code),a.push(e.key))}),{readyModules:o,readyKeys:a,metaDatas:s,componentsKeys:d}},H.prototype.onDidFitContextForComponent=function(e){var t=this._components[e];if(t&&t.context){if(!t.context.fit)throw new Error("Unexpected state of context");this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment),this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)}},H.prototype.onDidUnFitContextForComponent=function(e){var t=this._components[e];if(t&&t.context){if(t.context.fit)throw new Error("Unexpected state of context");this._timerHandleTreatment&&clearTimeout(this._timerHandleTreatment),this._timerHandleTreatment=setTimeout(this.onDidProcessContextualComponent.bind(this),0)}},H.prototype.setInitialContext=function(e){var t,n=Object.create(null);Object.keys(e||n).forEach(function(r){null!=(t=e[r])&&(n[r]=String(t))}),this._contexts=n},H.prototype.setContext=function(e,t){return this._contexts[e]!==t&&(t?this._contexts[e]=String(t):delete this._contexts[e],this._timerHandle&&clearTimeout(this._timer),this._timerHandle=setTimeout(this.onDidChangeContext.bind(this,this._contexts),0)),this},H.prototype.onDidProcessContextualComponent=function(){var e=[],t=[],n=[],i=[],o=[],a=[],s=this;return w(this,function(r,d){if(r.context){var c=!0;r.standard||s._WSComponents.includes(d)||(c=c&&!s.WSState),c&&r.context.fit&&!r.component?r.ctor?(s.registerComponentThruMetaData(d,r),r.standard?o.push(r.component):a.push(r.component)):(e.push(r.module),t.push(d)):r.context.fit||r.component&&(n.push(r.component),r.standard&&i.push(r.component))}}),this._timerHandleTreatment=null,s.modules=e,new r(function(n,r){var i,d,c,l;require(e,function(){if(arguments.length!==s.modules.length)return n();for(i=0;i<arguments.length;i++)d=arguments[i],c=t[i],(l=s._components[c]).ctor=d,l=s._components[c],s.registerComponentThruMetaData(c,l),l.standard?o.push(l.component):a.push(l.component);n()},r)}).then(function(){return s.cleanComponents({iterator:v(n)})}).then(function(){return s.destroyComponents({iterator:v(i)})}).then(function(){return s.initializeStandardComponents({iterator:v(o)})}).then(function(){return s.initializeApplicativeComponents({iterator:v(a)})}).then(function(){return s.getWelcomeScreenState()||s._doIWantToBeInWSContext?Promise.resolve():s.configureComponents({iterator:v(o)})}).then(function(){return s.onDidContextualComponentsUpdate&&s.onDidContextualComponentsUpdate(),r.resolve()})},H.prototype.displayLoader=function(e){if(this._container.id==e.id&&!this._loader){this._loader=new l;var t=p.get("WAfrTransitionLaunched.title");this._loader.on(t+e.appTitle+"..."),c.createModal(this._view,this._loader.elements.container)}},H.prototype.hideLoader=function(){this._loader&&this._view&&(this._loader.off(),c.removeModal(this._view),this._loader=null)},H.prototype.gotoWelcomeScreen=function(){var e=this;return e._doIWantToBeInWSContext=!0,this.initializeWelcomeScreen().then(function(){return e.WSState=!0,Promise.resolve()})},H.prototype.gotoApp=function(){this._doIWantToBeInWSContext=!1;Promise.resolve();if(this.isA2X&&this.getSourceApp()){let e=this.getSourceApp().getId();return this._launchA2XNativeApp({appId:e})}return this._appPromiseSequence()},H.prototype.getWelcomeScreenState=function(){return this.WSState},m}),define("DS/WAfrContainer/Container",["UWA/Core","UWA/Class/Promise","DS/Core/Core","DS/WAfrExecutionContext/mod_ExecutionContext","DS/PlatformAPI/PlatformAPI","DS/WAfrUtils/Logger","DS/WAfrUtils/PerformanceHelper","WebappsUtils/WebappsUtils","DS/WAFData/WAFData"],function(e,t,n,r,i,o,a,s,d){"use strict";var c=r.ExecutionContext,l=function(t){var n,r={view:null,debug:!1,infraComponents:[],proxified:!1,baseUrl:s.getWebappsBaseUrl()};if(n=e.extend(e.clone(r),t),this._proxified=n.proxified,this._view=n.view,!this._view)throw new Error("A view must be defined for the container");this.id=this._view.getId(),this._executionContexts=[],this._currentExecutionContext=-1,this._config=n.config,this._forceProxy=n.forceProxy,this._registeredInfraComponents=n.standardComponents,this._baseUrl=n.baseUrl,this._version=null;var i=this.destroy.bind(this);this._view.addEvent("onDestroy",i),this._restoreContextsIfNeed();var o=this;this.subscribe("onCreateContext."+this.id,function(e){o.createNewExecutionContext(),o.loadCurrentConfig(e)}),Object.defineProperty(this,"currentApp",{get:function(){var e=this.getCurrentExecutionContext();if(e){var t=e.getSourceApp();if(t)return t}}}),Object.defineProperty(this,"lang",{get:function(){return this._view.getLanguage()}}),Object.defineProperty(this,"productTitle",{get:function(){return this._view.getValue("afrProductTitle")}})};return l.prototype.destroy=function(){return this._executionContexts.map(function(e){return e.dispose()}),this._executionContexts=[],this._currentExecutionContext=-1,this._view.setValues({afrCode:void 0,afrAppId:void 0,appId:void 0,title:void 0,appTitle:void 0,afrDebug:void 0,components:void 0}),this._view.destroy(),sessionStorage.removeItem("WAfrABV3FirstLaunch"),t.resolve()},l.prototype._restoreContextsIfNeed=function(){var e=this._view.getValue("afrExecutionContexts")||[],t=this._view.getValue("afrCurrentExecutionContextIdx")||0,n=this._view.getValue("afrAppId");if(e.length>0&&!n&&(o.warn("A context has been found "+JSON.stringify({contexts:e})+" but the app id is null,Ignore the restoration of the saved context"),e=[]),0===e.length){var r=this.createNewExecutionContext();e.push({id:r.getId(),currentappId:null}),t=this._currentExecutionContext}else{var i=0;for(i=0;i<e.length;i++)this.createNewExecutionContext(e[i].id);if(t<0||t>=e.length)throw new Error("The current context index must be in the range of the list of contexts");this._currentExecutionContext=t}this._view.setValue("afrExecutionContexts",e.slice()),this._view.setValue("afrCurrentExecutionContextIdx",t),this._view.setValue("afrAppId",n)},l.prototype.createNewExecutionContext=function(e){var t=new c({id:e,container:this,config:this._config});return this._executionContexts.push(t),this._currentExecutionContext=this._executionContexts.length-1,this._view.addExecutionContextView(t,this.onChangeExecutionContext.bind(this)),t},l.prototype.onChangeExecutionContext=function(e){},l.prototype.getApplicationJSON=function(e){var t=e||this.getCurrentConfig();return new Promise(function(e,n){require(["text!DS/WebAfr/Applications/"+t.appId+"_"+widget.lang+".json"],function(t){return e(JSON.parse(t))},function(e){return n(e)})})},l.prototype.requestWAfrService=function(e,n){var r,i=this;if(!this._configService)return t.resolve();if(n&&!e)throw new Error("Must provide an app id to call the transition service");e=e||this._configService.afrAppId||this._configService.appId;var o,a=this._configService.afrService,s="GET";if(n&&(a=a.replace("/apps","/transition"),s="POST",o={containers:[{id:this.id,contexts:this._view.getValue("afrExecutionContexts"),currentIndex:this._view.getValue("afrCurrentExecutionContextIdx")}],currentIndex:0}),!(a+=e).startsWith("http")){var c=this._baseUrl.split("/");if(c.length>=2){var l=c[2].split(":"),p=l[0],h="";l.length>1&&!this._configService.afrServicePort&&(h=":"+l[1]),this._configService.afrServicePort&&(h=":"+this._configService.afrServicePort),a=c[0]+"//"+p+h+"/"+a}}this.lang&&(a+="?lang="+this.lang);var u=this._proxified?this._forceProxy?"proxifiedRequest":"authenticatedRequest":"request";return r=i._executionContexts[i._currentExecutionContext]._perf.start("WAFR: request the App data from WAfr Server"),new t(function(e,t){d[u](a,{type:"json",responseType:"json",method:s,data:o,onComplete:function(t){i._executionContexts[i._currentExecutionContext]._perf.stop(r),e(t)},onFailure:function(e){e.url=a,t(e)}})}).catch(function(e){if(e.message.contains("NetworkError"))return i.getApplicationJSON()})},l.prototype.loadCurrentConfig=function(e){a.checkpoint("requestWAfrService");var t=e||this.getCurrentConfig();this._configService=null,t.appTitle&&"Apps supporting transition"!==t.appTitle||(t.appTitle=this._view.getTitleHeader().appTitle);var n=this.getCurrentExecutionContext();let i=null;return t.afrService?(this._configService=t,i=this.requestWAfrService()):i=t.afrVersion?Promise.resolve(null):this.getApplicationJSON(),i.then(e=>{return r.hasConfigurationFor(e||t,"a2x")?this.initializeA2XSession(e||t).then(()=>Promise.resolve(e)):Promise.resolve(e)}).then(e=>n.load(e||t))},l.prototype.initializeA2XSession=function(e){var t=this;let n=null;n=this._a2xClient?Promise.resolve():new Promise(function(e,n){require(["DS/WAfrA2XCommunication/mod_WAfrA2XClient"],function(n){t._a2xClient=new n.WAfrA2XClient,e()},n)});const r=localStorage.getItem("A2XTemporaryLoginHack");return null!==r&&"string"==typeof r&&"true"===r?n.then(()=>t.processA2XConfig(e)).then(e=>{if(!t._a2xClient.isConnected())return t._a2xClient.initialize(e)}).then(()=>{return new Promise((e,n)=>{require(["DS/DSYA2XLoginCmp/DSYA2XAppLogin"],function(r){r.loginToDatabase({clientNode:t._a2xClient}).then(e,n)})})}).catch(e=>{throw e}):n.then(()=>t.processA2XConfig(e)).then(e=>{if(!t._a2xClient.isConnected())return t._a2xClient.initialize(e)}).catch(e=>{throw e})},l.prototype.processA2XConfig=function(e){const t="default",n="custom",r={hypervisorUrl:"ws://localhost:2097",poolName:"A2XPool"};let i=e.stdConf.a2x.configurationName;return new Promise(function(o,a){if(i)if(i===t)o(r);else if(i===n){let t=e.stdConf.a2x,n=t.configurationFile;n?require([n],e=>{o(JSON.parse(e))},e=>{a(e)}):o(t)}else require(["text!DS/WAfrContainer/assets/wafra2x/"+i+".json"],e=>{o(JSON.parse(e))},e=>{a(e)});else a(new Error("The configurationName property cannot be empty"))})},l.prototype.getA2XClient=function(){if(this._a2xClient)return this._a2xClient},l.prototype.launchApp=function(n,r){var i=this.id;return new t(function(t,o){require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(a){a.subscribe("launchAppCallback",function(e){"COMPLETE"===e.response?t():o()});var s={widgetId:i,appId:n};s=e.extend(s,r),a.publish("launchApp",s)})})},l.prototype.getCurrentConfig=function(){var t=e.clone(this._view.getValues());return t.appId=this._view.getValue("afrAppId")||this._view.getValue("appId"),t.version=this._view._version,t},l.prototype.publish=function(e,t){i.publish(e,t)},l.prototype.subscribe=function(e,t){i.unsubscribe(e),i.subscribe(e,t)},l.prototype.getCurrentExecutionContext=function(){return this._currentExecutionContext<0?null:this._executionContexts[this._currentExecutionContext]},l.prototype.registerInfraComponents=function(e){for(var t=0;t<this._registeredInfraComponents.length;t++){var n=this._registeredInfraComponents[t],r=n.DEFAULT_COMPONENT_NAME;e.createAndRegisterComponent(r,n,{container:this})}},l.prototype.updateTitle=function(e,t){if(!t){const e=this.getCurrentExecutionContext();e&&(t=e.getTargetApp()||e.getSourceApp())}t&&(e.appTitle=e.appTitle||t.getTitle()||this._view.getValue("appTitle"),e.brand=e.brand||t.getBrand()||this._view.getValue("brand")),this._view.setValue("afrProductTitle",e.title),this._view.setValue("title",e.title),this._view.setTitleHeader(e)},l.prototype.updateAppTitle=function(e){const t=this._view.getId(),n=window.top.UWA?window.top.UWA.Widgets?window.top.UWA.Widgets.instances:[]:void 0;if(n&&n.length){let r=n.findIndex(e=>t===e.id);if(-1!==r){const t=n[r]?n[r].environment:void 0;t&&t.wp&&t.wp.originalTitle&&(t.wp.originalTitle=e)}}},l}),define("DS/WAfrHandlers/private/private_ActionHandlerUtilities",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities"],function(e,t){"use strict";let n=Object.create(null);return n.ImplementationTypes={EXPORTED_FUNCTION:"EXPORTED_FUNCTION",COMPONENT_METHOD:"COMPONENT_METHOD"},n.executeActionHandler=function(r){const i=r.handler;let o=r.cb;if(!i)throw new Error("actionHandler has to be defined and cannot be null");var a=i.getHandlerComponent();if(!a)throw console.warn("NO HANDLER COMPONENT SET"),new Error;if(!a.getExecutionContext())throw console.warn("NO EXECUTION CONTEXT SET"),new Error;null!==o&&"function"==typeof o||(o=void 0);let s=null;(s=i._private._implementationType===n.ImplementationTypes.EXPORTED_FUNCTION?new Promise((t,n)=>{require([i._private._action._module],function(r){const o=e.getErrorManager();let a;if(r){const s=r[i._private._action._func];return s&&"function"==typeof s?t(s):(a=e.createReturnObject(o.FAILED,{description:`Unknown function ${i._private._action._func} in ${i._private._action._module}`}),n(a))}return a=e.createReturnObject(o.WRONG_VALUE,{description:"Module require return undefined"}),n(a)},function(){const t=e.getErrorManager(),r=e.createReturnObject(t.FAILED,{description:`Require failed (${i._private._action._module})`});return n(r)})}):new Promise((t,n)=>{if(!(a=i.getHandlerComponent()))throw new Error("There is no HandlerComponent related to this ActionHandler",i);const r=a.getExecutionContext().applicationContext,o=i._private._action._component,s=r.getComponent(o);if(!s){const t=e.getErrorManager();return n(e.createReturnObject(t.FAILED,{description:`Impossible to retrieve the component (${o})`}))}if(!s[i._private._action._func]){const t=e.getErrorManager();return n(e.createReturnObject(t.FAILED,{description:`No function ${i._private._action._func} exposed by ${o}`}))}return t(s[i._private._action._func].bind(s))})).then(function(s){let d=Object.create(null);if(d.cb=o,d.actionHandler=i,!(a=i.getHandlerComponent()))throw new Error("There is no HandlerComponent related to this ActionHandler",i);let c=Object.create(null);i._private._implementationType!==n.ImplementationTypes.COMPONENT_METHOD&&(c.executionContext=a.getExecutionContext().applicationContext),c.args=t.computeArgs(i,r.args);const l=a.getEventChannel();if(!l)throw new Error("Retrieved eventChannel is undefined");const p=i.getId();if(!p)throw new Error("handlerIdentfier has to be a non empty string.");l.publish({event:p+"/BEGIN"});const h=function(t){if(!this.actionHandler)throw new Error("this.action is undefined. A problem occurred when calling this function.");const n=this.actionHandler,r=n.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this ActionHandler",n);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=n.getId();if(!o)throw new Error("handlerIdentfier has to be a non empty string.");if(i.publish({event:o+"/END"}),!t){const n=e.getErrorManager();t=e.createReturnObject(n.SUCCEEDED)}if(this.cb&&"function"==typeof this.cb)this.cb(t);else if(t&&!e.hasSucceeded(t))throw t.getError()}.bind(d);i._private._implementationType===n.ImplementationTypes.EXPORTED_FUNCTION?s(h,c):s(c).then(h).catch(h)},function(t){if(t)if(o)o(t);else if(!e.hasSucceeded(t))throw t.getError()})},n}),define("DS/WAfrHandlers/mod_ActionHandler",["DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_ActionHandlerUtilities","DS/WAfrHandlers/mod_LeafHandler","DS/WAfrHandlers/mod_HandlerComponent"],function(e,t,n){"use strict";let r=Object.create(null);const i=n.LeafHandler,o=n.StandaloneLeafHandlerState,a="ACTION_HANDLER";e.registerLeafHandler(a,{executeFunc:t.executeActionHandler}),r.LifeCycleEvents={BEGIN:"BEGIN",END:"END"},r.ImplementationTypes=t.ImplementationTypes;class s extends o{constructor(e){super(e)}execute(e){const n=e?e.cb:void 0,r=e?e.args:void 0;return t.executeActionHandler({handler:this._handler,cb:n,args:r})}}return r.ActionHandler=class extends i{constructor(t){if(super(t),this._private||(this._private=Object.create(null)),!t)throw new Error("parameters has to be defined");if(this._private._type=e.enums.HandlerType[a],this._private._action=Object.create(null),this._private._implementationType=r.ImplementationTypes.EXPORTED_FUNCTION,void 0!==t.implementationType){if(n=t.implementationType,!Boolean(n)||!r.ImplementationTypes.hasOwnProperty(n))throw new Error(`parameters.implementationType value is not a valid one. (${t.implementationType})`);this._private._implementationType=t.implementationType}var n;if(this._private._implementationType===r.ImplementationTypes.EXPORTED_FUNCTION){if(!t.module||"string"!=typeof t.module)throw new Error('parameters.module has to be defined and to be a non empty string in case of "EXPORTED_FUNCTION"');this._private._action._module=t.module}else{if(!t.component||"string"!=typeof t.component)throw new Error('parameters.component has to be defined and to be a non empty string in case of "COMPONENT_METHOD"');this._private._action._component=t.component}if(!t.func||"string"!=typeof t.func)throw new Error("parameters.func has to be defined and to be a non empty string");this._private._action._func=t.func,this._private._handlerState=new s(this)}makeStandalone(){if(this._private._handlerState instanceof s)throw new Error("Call makeStandalone method on an ActionHandler which is already a standalone item");this._private._handlerState=new s(this)}execute(e){super.execute(e)}setHandlerComponent(e){return this._private._handlerState.setHandlerComponent(e)}getHandlerComponent(){return this._private._handlerState.getHandlerComponent()}onLifeCycleEvent(e,t){if(!e)throw new Error("identifier has to be a non empty string");const n=e.toUpperCase();if(!function(e){return Boolean(e)&&r.LifeCycleEvents.hasOwnProperty(e)}(n))throw new Error("The given identifier is not supported by an ActionHandler",e);if(!t||"function"!=typeof t)throw new Error("cb has to be a function",t);const i=this.getHandlerComponent();if(!i)throw new Error("There is no HandlerComponent related to this ActionHandler",this);const o=i.getEventChannel();if(!o)throw new Error("Retrieved eventChannel is undefined");const a=this.getId();if(!a)throw new Error("handlerIdentfier has to be a non empty string.");return o.subscribe({event:a+"/"+n},t)}removeLifeCycleEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this ActionHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentfier has to be a non empty string.");return n.unsubscribe(e)}},r}),define("DS/WAfrHandlers/mod_CheckHandler",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/mod_Handler","DS/WAfrHandlers/mod_ActionHandler","DS/WAfrHandlers/mod_CommandHandler"],function(e,t,n,r,i,o){"use strict";const a=r.Handler,s=i.ActionHandler,d=o.CommandHandler;let c=Object.create(null);function l(e,t){let n=!1;return e.beingInitialized()?n=!0:(t===e._private._check&&!e._private._isChecked||t===e._private._uncheck&&e._private._isChecked)&&(n=!0),n}function p(e){let t=!1;var n=!0;return(e._private._check&&!e._private._check.isAvailable()||e._private._uncheck&&!e._private._uncheck.isAvailable())&&(n=!1),e.isAvailable()!==n&&(e._private._currentAvailability=n,t=!0),t}c.StateEvents={CHECK:"CHECK",UNCHECK:"UNCHECK"};class h{constructor(e,t){if(!e||!t)throw new Error("manageable and handlerManager have to be define");this._checkHandler=e,this._manager=t}handleExecute(t){if(!t)throw new Error("Wrong parameters");{const n=t.cb,r=t.manageable,i=t.args;if(r!==this._checkHandler._private._check&&r!==this._checkHandler._private._uncheck)throw new Error("Internal error. The manageable calling handle is not managed by this manager.");l(this._checkHandler,r)?this._manager.handleExecute({cb:t.cb,manageable:this._checkHandler,action:!this._checkHandler._private._isChecked,args:i}):n&&"function"==typeof n&&setTimeout(function(){const t=e.getErrorManager();n(e.createReturnObject(t.SUCCEEDED))},0)}}handleOnAvailabilityChanged(e){const t=this._checkHandler,n=this._manager;p(t)&&(e.args.newValue=t.isAvailable(),e.manageable=t,n.handleOnAvailabilityChanged(e))}isExecutable(){return this.handleIsExecutable()}handleIsExecutable(){return this._manager.handleIsExecutable({manageable:this._checkHandler})}setState(){throw new Error("You can not directly change the state of a CheckHandler which is managed")}setHandlerComponent(){return console.warn("Impossible to set a HandlerComponent to a CheckHandler which is managed."),!1}getHandlerComponent(){return this._manager.getHandlerComponent()}disable(){throw new Error("Impossible to disable a Managed Handler")}enable(){throw new Error("Impossible to enable a Managed Handler")}onIsEnabledChangeEvent(){throw new Error("Impossible to subscribe to isEnabledChangeEvent from a Managed Handler")}removeIsEnabledChangeEventSubscription(){throw new Error("Impossible to unsubscribe to isEnabledChangeEvent from a Managed Handler")}}class u{constructor(e){if(!e)throw new Error("checkHandler has to be defined");this._checkHandler=e}handleExecute(t){if(!t)throw new Error("Wrong parameters");{const r=t.cb,i=t.manageable,o=t.args;if(i!==this._checkHandler._private._check&&i!==this._checkHandler._private._uncheck)throw new Error("Internal error. The manageable calling handleExecute is not managed by this manager.");l(this._checkHandler,i)?n.executeCheckHandler(this._checkHandler,{cb:r,action:!this._checkHandler._private._isChecked,args:o}):r&&"function"==typeof r&&setTimeout(function(){const t=e.getErrorManager();r(e.createReturnObject(t.SUCCEEDED))},0)}}setState(t){const n=t.state,r=t.cb,i=t.args;if(n!==this._checkHandler._private._isChecked){let e;e=this._checkHandler._private._isChecked?this._checkHandler._private._uncheck:this._checkHandler._private._check,this.handleExecute({cb:r,manageable:e,args:i})}else setTimeout(function(){const t=e.getErrorManager();r(e.createReturnObject(t.SUCCEEDED))},0)}setHandlerComponent(e){if(void 0===e)throw new Error("component has to be defined");return this._checkHandler._private._handlerComponent=e,!0}getHandlerComponent(){return this._checkHandler._private._handlerComponent}handleOnAvailabilityChanged(){const e=this._checkHandler;p(e)&&t.publishHandlerAvailability(e)}isExecutable(){return this.handleIsExecutable()}handleIsExecutable(){return a.prototype.isExecutable.call(this._checkHandler)}disable(...e){return a.prototype.disable.call(this._checkHandler,...e)}enable(...e){return a.prototype.enable.call(this._checkHandler,...e)}onIsEnabledChangeEvent(...e){return a.prototype.onIsEnabledChangeEvent.call(this._checkHandler,...e)}removeIsEnabledChangeEventSubscription(...e){return a.prototype.removeIsEnabledChangeEventSubscription.call(this._checkHandler,...e)}}return c.CheckHandler=class extends a{constructor(e){if(super(e),this._private._check=null,this._private._uncheck=null,!e||!e.id)throw new Error("Wrong parameters");this._private._id=e.id,this._private._isChecked=!1,this._private._handlerState=new u(this)}makeStandalone(){if(this._private._handlerState instanceof u)throw new Error("Call makeStandalone method on an CheckHandler which is already a standalone item");this._private._handlerState=new u(this)}makeManaged(e){if(this._private._handlerState instanceof h)throw new Error("Call makeManaged method on an CheckHandler which is already managed");this._private._handlerState=new h(this,e),delete this._private._handlerComponent}validateElement(e){return e instanceof s||e instanceof d}addElement(e,t){let n=!1;if(!e||!t||!t.state||"check"!==t.state&&"uncheck"!==t.state)throw new Error("Imcompatible parameters");const r="_"+t.state;return this.validateElement(e)&&!this._private[r]&&(this._private[r]=e,e.makeManaged(this),this._private._handlerState.handleOnAvailabilityChanged({manageable:this,args:{newValue:e.isAvailable()}}),n=!0),n}handleExecute(e){return this._private._handlerState.handleExecute(e)}isExecutable(){return this._private._handlerState.isExecutable()}handleIsExecutable(e){if(!e||!e.manageable)throw new Error("Wrong parameters");if(e.manageable!==this._private._check&&e.manageable!==this._private._uncheck)throw new Error("The given manageable is not managed by this CheckHandler");return this._private._handlerState.handleIsExecutable()}getCheckHandler(){return this._private._check}getUncheckHandler(){return this._private._uncheck}setState(t){if(this.isExecutable())this._private._handlerState.setState(t);else{const n=e.getErrorManager(),r=e.createReturnObject(n.NOT_EXECUTABLE,{description:"This CheckHandler is not executable"});if(!t||!t.cb)throw r.getError();setTimeout(function(){t.cb(r)},0)}}getState(){return this._private._isChecked}setHandlerComponent(e){return this._private._handlerState.setHandlerComponent(e)}getHandlerComponent(){return this._private._handlerState.getHandlerComponent()}handleOnAvailabilityChanged(e){if(!e||!e.manageable||!e.args||void 0===e.args.newValue)throw new Error("handleExecute was called using wrong parameters",e);return this._private._handlerState.handleOnAvailabilityChanged(e)}onStateEvent(e,t){if(!e)throw new Error("identifier has to be a non empty string");const n=e.toUpperCase();if(!function(e){return Boolean(e)&&c.StateEvents.hasOwnProperty(e)}(n))throw new Error("The given identifier is not supported by a CheckHandler",e);if(!t||"function"!=typeof t)throw new Error("cb has to be a function",t);const r=this.getHandlerComponent();if(!r)throw new Error("There is no HandlerComponent related to this CheckHandler",this);const i=r.getEventChannel();if(!i)throw new Error("Retrieved eventChannel is undefined");const o=this.getId();if(!o)throw new Error("handlerIdentfier has to be a non empty string.");return i.subscribe({event:o+"/"+n},t)}removeStateEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this CheckHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}disable(){return this._private._handlerState.disable()}enable(){return this._private._handlerState.enable()}onIsEnabledChangeEvent(e){return this._private._handlerState.onIsEnabledChangeEvent(e)}removeIsEnabledChangeEventSubscription(e){return this._private._handlerState.removeIsEnabledChangeEventSubscription(e)}destroy(){super.destroy(),this._private._check&&this._private._check.destroy(),this._private._uncheck&&this._private._uncheck.destroy()}},c}),define("DS/WAfrHandlers/mod_RadioHandler",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_Utilities","DS/WAfrHandlers/mod_Handler","DS/WAfrHandlers/mod_CheckHandler"],function(e,t,n,r){"use strict";const i=n.Handler,o=r.CheckHandler;let a=Object.create(null);a.ItemStateEvents={SELECT:"SELECT",UNSELECT:"UNSELECT"};return a.RadioHandler=class extends i{constructor(e){super(e),this._private._checkedElement=null,this._private._elements=[]}validateElement(e){return e instanceof o}addElement(e){let t=!1;if(!e||e===this||!e.makeManaged||"function"!=typeof e.makeManaged)throw new Error;if(!this.validateElement(e))throw new Error("elt is not a valide element to add to a RadioHandler");return this._private._elements.push(e),e.makeManaged(this),this.handleOnAvailabilityChanged({manageable:this,args:{newValue:e.isAvailable()}}),t=!0}getElements(){if(!this._private||!this._private._elements||!Array.isArray(this._private._elements))throw new Error("Internal error");return this._private._elements}getElementById(e){const t=this._private._elements.length;let n=0,r=!1,i=null;for(;!r&&n<t;){const t=this._private._elements[n];t.getId()===e&&(r=!0,i=t),++n}return i}getSelectedItem(){let e=null;const t=this.getSelectedItemId();return t&&(e=this.getElementById(t)),e}setRadioItemState(t){const n=t.radioHdlrItemId,r=t.state,i=t.cb,o=t.args,a=e.getErrorManager();let s,d,c=0;const l=this._private._elements.length;for(c=0;c<l;++c)this._private._elements[c].getId()===n&&(d=this._private._elements[c]);if(d)if(this.isExecutable()){let e=Object.create(null);e.cb=i,e.manageable=d,e.action=r,e.args=o,this.handleExecute(e)}else{if(s=e.createReturnObject(a.NOT_EXECUTABLE,{description:"This RadioHandler is not executable"}),!t||!t.cb)throw s;setTimeout(function(){i(s)},0)}else{if(s=e.createReturnObject(a.FAILED,{description:"Unknown item: "+n}),!i)throw s.getError();setTimeout(function(){i(s)},0)}}getRadioItemState(e){if(!e||"string"!=typeof e)throw new Error("itemId has to be a non empty string");let t;const n=this._private._elements.length;for(let r=0;r<n;++r)this._private._elements[r].getId()===e&&(t=this._private._elements[r].getState());if(void 0===t)throw new Error("This item does not belong to this RadioHandler");return t}getSelectedItemId(){let e;return this._private._checkedElement&&(e=this._private._checkedElement.getId()),e}setHandlerComponent(e){if(void 0===e)throw new Error("component has to be define");return this._private._handlerComponent=e,!0}getHandlerComponent(){return this._private._handlerComponent}handleOnAvailabilityChanged(e){if(!e||!e.manageable||!e.args||void 0===e.args.newValue)throw new Error("handleExecute was called using wrong parameters",e);(function(e){for(var t=!1,n=!0,r=e._private._elements,i=r.length,o=0;o<i&&n;)n=r[o].isAvailable(),++o;return n!==e.isAvailable()&&(e._private._currentAvailability=n,t=!0),t})(this)&&t.publishHandlerAvailability(this)}handleIsExecutable(e){if(!e||!e.manageable)throw new Error("Wrong parameters");return this.isExecutable()}onItemStateEvent(e,t,n){if(!e)throw new Error("identifier has to be a non empty string");if(!t)throw new Error("itemIdentifier has to be a non empty string");const r=e.toUpperCase();if(!function(e){return Boolean(e)&&a.ItemStateEvents.hasOwnProperty(e)}(r))throw new Error("The given identifier is not supported by an RadioHandler",e);if(!n||"function"!=typeof n)throw new Error("cb has to be a function",n);const i=this.getHandlerComponent();if(!i)throw new Error("There is no HandlerComponent related to this RadioHandler",this);const o=i.getEventChannel();if(!o)throw new Error("Retrieved eventChannel is undefined");const s=this.getId();if(!s)throw new Error("handlerIdentfier has to be a non empty string.");return o.subscribe({event:s+"/"+t+"/"+r},n)}removeItemStateEventSubscription(e){if(void 0===e)throw new Error("token has to be defined");const t=this.getHandlerComponent();if(!t)throw new Error("There is no HandlerComponent related to this RadioHandler",this);const n=t.getEventChannel();if(!n)throw new Error("Retrieved eventChannel is undefined");if(!this.getId())throw new Error("handlerIdentifier has to be a non empty string.");return n.unsubscribe(e)}destroy(){super.destroy();const e=this._private._elements,t=this._private._elements.length;for(var n=0;n<t;++n)e[n].destroy()}},a}),define("DS/WAfrAppManager/App",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/WAfrContainer/App"],function(e,t,n,r){"use strict";var i=function(e){r.call(this,e),this._frmWindow=void 0,this._disposeCalled=!1,this._executionContext=void 0};return r.inherits(i),i.prototype.onWillEnter=function(e){return n.resolve()},i.prototype.setUp=function(e){return n.resolve()},i.prototype.dispose=function(e){},i.inherits=function(e){e.prototype=Object.create(i.prototype,{constructor:{value:e,enumerable:!1}})},i.Extend=function(){var e=function(e){i.call(this,e)};return i.inherits(e),e},i}),define("DS/WAfrHandlers/mod_RadioHandlerONE",["DS/CoreUtilities/ErrorManagement","DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/private/private_RadioHandlerUtilities","DS/WAfrHandlers/mod_RadioHandler"],function(e,t,n,r){"use strict";const i=r.RadioHandler;let o=Object.create(null);return o.RadioHandlerONE=class extends i{constructor(e){super(e)}isUnselectAuthorized(){return!1}handleExecute(r){if(!r||!r.manageable)throw new Error("Wrong parameters");{const i=r.manageable;if(!n.isManagedByRadioHandler(i,this))throw new Error("Internal error. The manageable calling handleExecute is not managed by this RadioHandler.");if(!r.action){const t=e.getErrorManager(),n=e.createReturnObject(t.FAILED,{description:"It is impossible to uncheck the checked element for RadioHandler of type ONE"});if(!r.cb||"function"!=typeof r.cb)throw n.getError();setTimeout(function(){r.cb(n)},0)}if(this._private._checkedElement)if(r.manageable!==this._private._checkedElement){let e=Object.create(null);e.cb=r.cb,e.manageable=r.manageable,e.manager=this,e.args=r.args,n.fireEvent(this,this._private._checkedElement.getId(),!1),t.executeCheckHandler(this._private._checkedElement,{cb:n.checkOnUncheck.bind(e),action:!1}),this._private._checkedElement=r.manageable}else this.beingInitialized()&&(n.fireEvent(this,r.manageable.getId(),!0),t.executeCheckHandler(r.manageable,{cb:r.cb,action:!0,args:r.args}),this._private._checkedElement=r.manageable);else n.fireEvent(this,r.manageable.getId(),!0),t.executeCheckHandler(r.manageable,{cb:r.cb,action:!0,args:r.args}),this._private._checkedElement=r.manageable}}},o}),define("DS/WAfrHandlers/mod_RadioHandlerZERO",["DS/WAfrHandlers/private/private_CheckHandlerUtilities","DS/WAfrHandlers/private/private_RadioHandlerUtilities","DS/WAfrHandlers/mod_RadioHandler"],function(e,t,n){"use strict";const r=n.RadioHandler;let i=Object.create(null);return i.RadioHandlerZERO=class extends r{constructor(e){super(e)}isUnselectAuthorized(){return!0}handleExecute(n){if(!n||!n.manageable)throw new Error("Wrong parameters");{const r=n.manageable;if(!t.isManagedByRadioHandler(r,this))throw new Error("Internal error. The manageable calling handleExecute is not managed by this RadioHandler.");if(n.action)if(this._private._checkedElement){if(this._private._checkedElement!==n.manageable){let r=Object.create(null);r.cb=n.cb,r.manager=this,r.manageable=n.manageable,r.args=n.args,t.fireEvent(this,this._private._checkedElement.getId(),!1),e.executeCheckHandler(this._private._checkedElement,{cb:t.checkOnUncheck.bind(r),action:!1}),this._private._checkedElement=n.manageable}}else t.fireEvent(this,n.manageable.getId(),n.action),e.executeCheckHandler(n.manageable,{cb:n.cb,action:n.action,args:n.args}),this._private._checkedElement=n.manageable;else n.manageable.getState()!==n.action&&(t.fireEvent(this,n.manageable.getId(),n.action),e.executeCheckHandler(n.manageable,{cb:n.cb,action:n.action,args:n.args}),this._private._checkedElement=null)}}},i}),define("DS/WAfrHandlers/mod_HandlerInterpreter",["DS/WAfrHandlers/mod_ActionHandler","DS/WAfrHandlers/mod_CommandHandler","DS/WAfrHandlers/mod_CheckHandler","DS/WAfrHandlers/mod_RadioHandlerZERO","DS/WAfrHandlers/mod_RadioHandlerONE","DS/WAfrHandlers/mod_HandlerComponent","DS/WAfrAvailabilityModes/mod_AvailabilityModesComponent"],function(e,t,n,r,i,o,a){"use strict";var s=e.ActionHandler,d=t.CommandHandler,c=n.CheckHandler,l=r.RadioHandlerZERO,p=i.RadioHandlerONE;const h={AC_NOT_FOUND:"AC_NOT_FOUND"};var u={};function m(e){return{id:e.identifier,i18n:e.internationalization,icon:e.icon,availabilityMode:e.availability,accelerator:e.accelerator}}function _(e){return{id:e.identifier,i18n:e.internationalization,icon:e.icon,availabilityMode:e.availability,accelerator:e.accelerator}}function f(n,r,i){var o,a=null;if(r.declerr&&Array.isArray(r.declerr))for(let e=0,t=r.declerr,n=t.length;e<n;++e){let n=t[e];if(n.id===h.AC_NOT_FOUND)throw new Error(`[HandlerInterpreter] ${n.args.itemName} was not found.`)}if("Action"===r.type)o=function(t,n){var r=n(t);return r.implementationType=t.code.type,void 0===r.implementationType||r.implementationType===e.ImplementationTypes.EXPORTED_FUNCTION?r.module=t.code.module:r.component=t.code.component,r.func=t.code.func,r.args=t.argument,r}(r,i),a=new s(o);else{if("Command"!==r.type)throw new Error("Unknown handler type",r.type);o=function(e,n,r){var i=r(n);i.module=n.code.module;var o=e.getComponent("AFR_CommandsManager");return i.cmdsManager=o,i.cmdMode=t.CmdMode[n.mode],i.repeatMode=t.RepeatMode[n.repeatability],i.args=n.argument,i.computeServer=n.computeServer,i}(n,r,i),a=new d(o)}return o&&o.args&&a.setArgs(o.args),a}function v(e,t){let n=a.DEFAULT_COMPONENT_NAME;return t&&t[a.DEFAULT_COMPONENT_NAME]&&(n=t[a.DEFAULT_COMPONENT_NAME]),e.getComponent(n)}class g{constructor(){this._initializationValues=[],this._handler=[],this._chkHandler=[],this._radioHandler=[]}interpretLeafHandler(e,t){if(!t)return;const n=t.length;let r,i;for(let o=0;o<n;++o)i=f(e,r=t[o],m),this._handler.push(i),this.addToAvailabilityModesSubscribers(i)}interpretCheckHandler(e,t){if(!t)return;const n=t.length;let r,i,o,a,s;for(let d=0;d<n;++d)if(r=t[d],i=new c({id:r.identifier}),r.accelerator&&(r.check.accelerator=r.accelerator,r.uncheck.accelerator=r.accelerator),o=f(e,r.check,_),i.addElement(o,{state:"check"}),this.addToAvailabilityModesSubscribers(o),a=f(e,r.uncheck,_),i.addElement(a,{state:"uncheck"}),this.addToAvailabilityModesSubscribers(a),this._chkHandler.push(i),void 0!==r.defaultState&&"string"==typeof r.defaultState&&(r.defaultState="true"===r.defaultState),void 0!==r.defaultState&&r.defaultState){let e=!1;(r.check&&r.check.argument&&r.check.argument.isA2X||r.uncheck&&r.uncheck.argument&&r.uncheck.argument.isA2X)&&(e=!0),e||(s={type:"CheckHandler",id:r.identifier,state:!0},this._initializationValues.push(s))}}interpretRadioHandler(e,t){if(!t)return;const n=t.items;if(!Array.isArray(n))return;if(0===n.length)return;const r=n.length;let i,o,a,s,d=0;for(d=0;d<r;++d){if(i={id:(a=n[d]).identifier},"ONE"===a.radioType)o=new p(i);else{if("ZERO"!==a.radioType)throw new Error;o=new l(i)}let t,r,h,u,m=0,v=a.items,g=v.length;for(m=0;m<g;++m)r=v[m],t=new c({id:r.identifier}),r.accelerator&&(r.check.accelerator=r.accelerator,r.uncheck.accelerator=r.accelerator),r.check&&(h=f(e,r.check,_),t.addElement(h,{state:"check"}),this.addToAvailabilityModesSubscribers(h)),r.uncheck&&(u=f(e,r.uncheck,_),t.addElement(u,{state:"uncheck"}),this.addToAvailabilityModesSubscribers(u)),o.addElement(t);this._radioHandler.push(o),a.default&&(s={type:"RadioHandler",id:a.default,radioId:a.identifier,state:!0},this._initializationValues.push(s))}}interpret(e,t,n){if(!e||!t)throw new Error("Missing parameters");var r=o.DEFAULT_COMPONENT_NAME;if(n&&n.componentId?r=n.componentId:console.warn("Caution! You are using the default component name. This is not recommended"),this._executionContext=t,this._handlerComponent=t.getComponent(r),!this._handlerComponent)throw new Error("HandlerComponent not found");if(e){if(e.handlers){if(e.handlers&&e.handlers.default){var i=e.handlers.default;this.interpretLeafHandler(t,i)}if(e.handlers&&e.handlers.check){var a=e.handlers.check;this.interpretCheckHandler(t,a)}e.handlers.defaultCommand&&(this._defaultCommandIdentifier=e.handlers.defaultCommand)}if(e.radioGroup){var s=e.radioGroup;this.interpretRadioHandler(t,s)}}return Promise.resolve()}commitHandlers(){let e=this._handler.length,t=0,n=null;for(t=0;t<e;++t)n=this._handler[t],this._handlerComponent.addHandler(n);for(this._handler.splice(0,e),delete this._handler,e=this._chkHandler.length,t=0;t<e;++t)n=this._chkHandler[t],this._handlerComponent.addCheckHandler(n);for(this._chkHandler.splice(0,e),delete this._chkHandler,e=this._radioHandler.length,t=0;t<e;++t)n=this._radioHandler[t],this._handlerComponent.addRadioHandler(n);this._radioHandler.splice(0,e),delete this._radioHandler}commit(e){this.commitHandlers(),this._handlerComponent.setInitializationData(this._initializationValues),this._defaultCommandIdentifier&&this._handlerComponent.setInitializationDefaultCommand(this._defaultCommandIdentifier);let t=Promise.resolve();const n=v(this._executionContext,e);return n&&(this._handlerComponent.setAvailabilityModesComponent(n),this._availabilityModesSubscribers&&this._availabilityModesSubscribers.length>0&&(t=this.commitAvailabilityModesSubscribers())),t.then(()=>{delete this._handlerComponent,delete this._executionContext,delete this._initializationValues,delete this._availabilityModesSubscribers})}commitEnrich(e){this.commitHandlers(),this._handlerComponent.addInitializationData(this._initializationValues);let t=Promise.resolve();return v(this._executionContext,e)&&(t=this.commitAvailabilityModesSubscribers()),t.then(()=>{delete this._handlerComponent,delete this._executionContext,delete this._initializationValues,delete this._availabilityModesSubscribers})}enrich(e,t,n){if(!e||!t)throw new Error("Missing parameters");if(void 0!==this._handler||void 0!==this._chkHandler||void 0!==this._radioHandler||void 0!==this._executionContext||void 0!==this._handlerComponent||void 0!==this._initializationValues||void 0!==this._availabilityModesSubscribers)throw new Error('Enrich was called whereas internal variables are still defined. Possible cause: enrich was called before an "interpret"-"commit" sequence.');return this._handler=[],this._chkHandler=[],this._radioHandler=[],this._initializationValues=[],this.interpret(e,t).then(this.commitEnrich.bind(this,n)).then(()=>{delete this._handler,delete this._chkHandler,delete this._radioHandler,delete this._handlerComponent,delete this._executionContext,delete this._initializationValues,delete this._availabilityModesSubscribers})}addToAvailabilityModesSubscribers(e){if(!e||!this._executionContext)throw new Error("element and this._executionContext has to be defined");this._availabilityModesSubscribers||(this._availabilityModesSubscribers=[]),this._availabilityModesSubscribers.push(e)}commitAvailabilityModesSubscribers(){let e=[],t=0,n=0,r=null;if(this._availabilityModesSubscribers)for(n=this._availabilityModesSubscribers.length,t=0;t<n;++t)r=this._availabilityModesSubscribers[t],e.push(r.initAvailabilityModesSubscription());return Promise.all(e)}}var C=Object.create(null);return C.generateInterpreter=function(e){var t=g;return void 0!==u[e]&&(t=u[e]),new t},C});