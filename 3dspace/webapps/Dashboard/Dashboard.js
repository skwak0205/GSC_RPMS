define("DS/Dashboard/ManageDashboard/Views/SortMenu",["UWA/Core","i18n!DS/Dashboard/assets/nls/manage_modal"],function(e,t){"use strict";return{currentSorting:"",container:"",sortList:{"title-a":{id:"title-a",field:"title",asc:!0,type:"alpha"},"title-d":{id:"title-d",field:"title",asc:!1,type:"alpha"},"role-a":{id:"role-a",field:"role",asc:!0,type:"alpha"},"role-d":{id:"role-d",field:"role",asc:!1,type:"alpha"},"lastUpdate-a":{id:"lastUpdate-a",field:"lastUpdate",asc:!0,type:"date"},"lastUpdate-d":{id:"lastUpdate-d",field:"lastUpdate",asc:!1,type:"date"},"deletedDate-a":{id:"deletedDate-a",field:"deletedDate",asc:!0,type:"date"},"deletedDate-d":{id:"deletedDate-d",field:"deletedDate",asc:!1,type:"date"}},getClassNamesBySort:function(e,t){var n,a=this.sortList[e],i=a.type;return n="fonticon fonticon-"+i+"-sorting-",a.asc?n+="date"!==i?"a-z":"1-31":n+="date"!==i?"z-a":"31-1",t&&(n+=" selected"),n},toggleSelection:function(e){e.parentElement.parentElement.querySelector(".selected").classList.remove("selected"),e.addClassName("selected")},buildSortIcon:function(e){return{tag:"span","data-sort":e,class:e+" sort-item "+this.getClassNamesBySort(e,this.currentSorting===e)}},buildSortView:function(){return this.currentSorting="title-a",e.createElement("div",{class:"sort-view-ctn",html:[{tag:"ul",class:"customdropdown-menu-wrap",html:[{tag:"li",class:"item sort-modification-date",html:[{tag:"span",class:"item-text modification-date-label",text:t.modificationDate},this.buildSortIcon("lastUpdate-a"),this.buildSortIcon("lastUpdate-d")]},{tag:"li",class:"item sort-name",html:[{tag:"span",class:"item-text name-label",text:t.sortTitleLabel},this.buildSortIcon("title-a"),this.buildSortIcon("title-d")]},{tag:"li",class:"item sort-role",html:[{tag:"span",class:"item-text role-label",text:t.userRights},this.buildSortIcon("role-a"),this.buildSortIcon("role-d")]},{tag:"li",class:"item sort-deletion-date hidden",html:[{tag:"span",class:"item-text date-label",text:t.deletionDate},this.buildSortIcon("deletedDate-a"),this.buildSortIcon("deletedDate-d")]}]}]})}}}),define("DS/Dashboard/UIKITUtils",["DS/UIKIT/Mask","i18n!DS/Dashboard/assets/nls/main"],function(e,t){"use strict";return{maskBody:function(n){var a=document.body;a.addClassName("ifwe-mask"),e.mask(a,n||t.loadingMessage)},unmaskBody:function(){var t=document.body;t.removeClassName("ifwe-mask"),e.unmask(t)}}}),define("DS/Dashboard/CollectionViewFilter",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({_taggerQuery:null,_stringQuery:null,_collectionView:null,_tagNavProxy:null,_tagUriAttribute:null,_searchFilterHelper:null,init:function(e){var t=e||{};if(!(t.collectionView||t.searchFilterHelper||t.tagUriAttribute||t.tagNavProxy))throw new Error("Wrong parameters.");this._tagNavProxy=t.tagNavProxy,this._collectionView=t.collectionView,this._tagUriAttribute=t.tagUriAttribute,this._searchFilterHelper=t.searchFilterHelper||this._searchFilterHelper},filter:function(t){!function(t,n){if(t._tagNavProxy){var a,i=[],o=[],r=t._collectionView,s=t._taggerQuery,d=t._stringQuery,l=t._tagUriAttribute,c=r.collection,u=e.is(n,"object"),h=u?n.allfilters||{}:null;u?s=e.Object.keys(h).length>0?n.filteredSubjectList:null:d=n,o=d&&d.length>0?o.concat(c.filter(function(e){return t._searchFilterHelper(e,d)})):null,i=s?i.concat(s):null,r.filter(o||i?function(e){return function(e,t,n){var a,i,o=(t=t||{}).tagMatches,r=t.stringMatches;return a=!o||-1!==o.indexOf(e.get(n)),i=!r||-1!==r.indexOf(e),a&&i}(e,{tagMatches:i,stringMatches:o},l)}:null),u||(o&&(a={},o.forEach(function(e){var t=e.get(l);a[t]=c.tags[t]})),t._tagNavProxy.setSubjectsTags(a||c.tags)),t._stringQuery=d,t._taggerQuery=s}}(this,t)},destroy:function(){this._taggerQuery=null,this._stringQuery=null,this._collectionView=null,this._tagNavProxy=null,this._tagUriAttribute=null,this._searchFilterHelper=null}})}),define("DS/Dashboard/TopBar/CmdProvider",["UWA/Core","UWA/Controls/Abstract","DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/Menu","DS/TopBarProxy/MenuItem"],function(e,t,n,a,i){"use strict";return t.extend({defaultOptions:{providerId:"default",commands:{}},topBarProxy:null,init:function(t){this._parent(e.merge(t,this.defaultOptions)),this.topBarProxy=new n({id:this.options.providerId})},setCommands:function(e){this.topBarProxy.setContent(e)},addCommands:function(e){this.topBarProxy.addContent(e)},createMenuItem:function(e){return new i(e)},createMenu:function(e){var t=new a;return e.forEach(function(e){t.add(e)}),t},createGroup:function(e){return new i({label:"",submenu:e,group:!0})}})}),define("DS/Dashboard/ManageDashboard/Events",[],function(){"use strict";return{MY_FAVORITES_PANEL:"myFavorites",ALL_DASHBOARD_PANEL:"all",RECYCLE_BIN_PANEL:"recycleBinDashboards",BUSINESS_EXP_INS_PANEL:"businessexperiencesinstances",TOP_BAR:"TOP_BAR",TILE_VIEW:"TILE_VIEW",TABLE_VIEW:"TABLE_VIEW",COLLAPSED_ICON:"COLLAPSED_ICON",DETAIL_VIEW:"DETAIL_VIEW",TOP_PANEL:"TOP_PANEL"}}),define("DS/Dashboard/Views/PanelButton",["UWA/Class/View","DS/UIKIT/Tooltip"],function(e,t){"use strict";return e.extend({tagName:"span",className:"wp-panel-button",setup:function(e){(e=e||{}).icon&&(this.container.addClassName("fonticon"),this.container.addClassName("fonticon-"+e.icon)),this.mainClassName=e.mainClassName,this.mainClassName&&this.container.addClassName(this.mainClassName),this.elements={tooltip:e.tooltip&&new t(Object.assign({target:this.container},e.tooltip))},this.events=e.events||{},this.events.onClick&&this.container.addEvent("click",this.events.onClick),this.setActive(e.active||!1)},render:function(){this._updateClassName(),this._updateTooltip()},setActive:function(e){this.active=e,this.render()},isActive:function(){return this.active},destroy:function(){this.elements.tooltip&&this.elements.tooltip.destroy(),this.events.onClick&&this.container.removeEvent("click",this.events.onClick)},_getClassName:function(e){return(e="boolean"==typeof e?e:this.active)?"active":"inactive"},_updateClassName:function(){this.container.removeClassName(this._getClassName(!this.active)),this.container.addClassName(this._getClassName(this.active))},_updateTooltip:function(){this.elements.tooltip&&this.elements.tooltip.updatePosition()}})}),define("DS/Dashboard/UsageTracker",["UWA/Core","DS/Usage/TrackerAPI"],function(e,t){"use strict";var n={dashboard:{create:"dashboard.create",duplicate:"dashboard.create.duplicate",use:"dashboard.use",read:"dashboard.read",manageDashboard:"dashboard.manageDashboard",update:"dashboard.update",rename:"dashboard.update.rename",background:{set:"dashboard.update.background.set",reset:"dashboard.update.background.reset"},thumbnail:{set:"dashboard.update.thumbnail.set",reset:"dashboard.update.thumbnail.reset"},member:"dashboard.update.member",tenant:"dashboard.update.tenant",delete:"dashboard.delete",trash:"dashboard.trash",share:"dashboard.share",topBarMenu:"dashboard.topbarMenu",addModal:"dashboard.addModal",deleteModal:"dashboard.deleteModal",renameModal:"dashboard.renameModal",touModal:"dashboard.touModal",accessDeniedModal:"dashboard.accessDeniedModal",story:"dashboard.story",favorite:"dashboard.favorite"},tab:{create:"tab.create",duplicate:"tab.create.duplicate",read:"tab.read",update:"tab.update",rename:"tab.update.rename",layout:"tab.update.layout",delete:"tab.delete",share:"tab.share",menu:"tab.menu",deleteModal:"tab.deleteModal"},widget:{create:"widget.create",duplicate:"widget.create.duplicate",read:"widget.read",update:"widget.update",resize:"widget.update.resize",drag:"widget.update.drag",drop:"widget.update.drop",preferences:"widget.update.preferences",delete:"widget.delete",share:"widget.share",menu:"widget.menu",fullscreenMenu:"widget.fullscreenMenu",add:{modal:{platformselect:"widget.add.modal.platform-select"}}},widgetPreview:{fullscreenMenu:"widgetPreview.fullscreenMenu",addinmodeLockedappFullscreenMenu:"widgetPreview.addinmodeLockedappFullscreenMenu"},preview:{modal:"preview.modal",use:"preview.use"},manageDashboard:{modal:"manageDashboard.modal",use:"manageDashboard.use",tileMenu:"manageDashboard.tileMenu",idCardAction:"manageDashboard.idCardAction",skeleton:"manageDashboard.skeleton",member:"manageDashboard.member",tenant:"manageDashboard.settings.tenant",background:"manageDashboard.settings.background",thumbnail:"manageDashboard.settings.thumbnail",settingsFacet:"manageDashboard.settingsFacet",detailView:"manageDashboard.detailView",dashboard:{untrash:"manageDashboard.dashboard.untrash",delete:"manageDashboard.dashboard.delete",deleteMultiple:"manageDashboard.dashboard.deleteMultiple",trash:"manageDashboard.dashboard.trash",goto:"manageDashboard.dashboard.goto"}},share:{modal:{link:"share.link.modal",article:"share.article.modal",module:"share.widget.modal",widget:"share.widget.modal",tab:"share.tab.modal",dashboard:"share.dashboard.modal",cockpit:"share.cockpit.modal"},read:{live:"share.read.dashboard.live"},create:{copy:{article:"share.create.copy.article",module:"share.create.copy.widget",widget:"share.create.copy.widget",tab:"share.create.copy.tab",dashboard:"share.create.copy.dashboard",cockpit:"share.create.copy.cockpit"},live:"share.create.live"},update:{live:"share.update.live"},delete:{live:"share.delete.live"}},unshare:{modal:{dashboard:"unshare.dashboard.modal"},remove:{live:"unshare.remove.live"}},trashDashboard:{modal:"trashDashboard.modal",use:"trashDashboard.use",tileMenu:"trashDashboard.tileMenu",idCardAction:"trashDashboard.idCardAction",dashboard:{untrash:"trashDashboard.dashboard.untrash",delete:"trashDashboard.dashboard.delete",emptyTrash:"trashDashboard.dashboard.emptyTrash",trash:"trashDashboard.dashboard.trash",goto:"trashDashboard.dashboard.goto"}},subscribe:{modal:{article:"subscribe.widget.modal",widget:"subscribe.widget.modal",multiWidget:"subscribe.widget.modal",tab:"subscribe.tab.modal",dashboard:"subscribe.dashboard.modal",cockpit:"subscribe.cockpit.modal"},consume:{widget:"subscribe.consume.widget",multiWidget:"subscribe.consume.widgets",tab:"subscribe.consume.tab",dashboard:"subscribe.consume.dashboard",cockpit:"subscribe.consume.cockpit"},read:"subscribe.read"},searchIn:{widget:"searchIn.widget",widgetPreview:"searchIn.widgetPreview",multiWidgetPreview:"searchIn.multiWidgetPreview",tab:"searchIn.tab"}};return{track:function(a){a.options=a.options||{},a.options.appID=a.appId,a.options.tenant=a.platformId,t.trackPageEvent(function(t){var a,i,o=n,r=(t||"").split(".").filter(function(e){return!!e}),s=r.length;for(a=0;a<s;a++){if(i=r[a],!(e.is(o,"object")&&i in o)){o=null;break}o=o[i]}return e.is(o,"string")||(o="",e.log('Tracker Id: "'+t+'", does not exist !')),o||t}(a.category),a.action,a.label,a.value,a.persDim,a.options)}}}),define("DS/Dashboard/ManageDashboard/Views/ManageBody",["UWA/Core","UWA/Class/View"],function(e,t){"use strict";return t.extend({tagName:"div",className:"manage-body",elements:{},manageBody:null,setup:function(e){e=e||{},this.manageBody=e.manageBody},render:function(){return this.initBody(),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)},initBody:function(){var t=this.elements,n=e.createElement,a=n("div",{class:"manage-dashboard-top-panel"}),i=n("div",{class:"tile-view-skeleton-container"}),o=n("div",{class:"dashboard-details-container hidden"}),r=n("div",{class:"action-bar-container"});t.topPanelContiner=a,t.tileViewSkeletonContainer=i,t.dashboardDetailViewContainer=o,t.actionBarContainer=r,t.topPanelContiner.inject(this.manageBody,"top"),t.actionBarContainer.inject(this.manageBody),t.tileViewSkeletonContainer.inject(this.manageBody),t.dashboardDetailViewContainer.inject(this.manageBody)}})}),define("DS/Dashboard/TopBar/DDMenu/AddinModeMenu",["UWA/Core","UWA/Event","DS/UWPClientCode/I18n","DS/UIKIT/DropdownMenu","i18n!DS/Dashboard/assets/nls/main","i18n!DS/Dashboard/assets/nls/dd_menu"],function(e,t,n,a,i,o){"use strict";var r,s,d={searchInWidget:{icon:"search",text:o.searchInWidget},preferences:{icon:"cog",text:i.preferencesItem},refresh:{icon:"refresh refresh-icon",text:i.refreshItem},expand:{icon:"window",text:i.expand},close:{icon:"cancel-circled",text:i.closeAppItem}},l={events:{onClick:function(n){var a,i,o=this.options.callbacks,r=t.getElement(n);r.dataset.action||(r=r.getParent());a=r.dataset.action,["open","close"].indexOf(a)>=0&&(i=r.dataset.appid);e.is(o[a],"function")&&o[a](i)},onShow:function(){this.options.target.addClassName("active")},onHide:function(){this.options.target.removeClassName("active")},onClickOutside:function(){this.hide()}},className:"ifwe-header-dd app-switcher-dd-menu",renderTo:document.body,offset:{x:8,y:-6},position:"bottom left",bound:!0,responsiveMode:!1};return r={_actions:[],create:function(t){var n={target:t.target,widgets:t.widgets,callbacks:t.callbacks},o=[],d=t.widgets;return r._actions=t.actions||[],d.length&&(o.push(function(e){var t=[];return e.forEach(function(e){var n=e.appId;t.push({className:"widget-item",template:'<span class="item-text widget-title" data-action="open" data-appid="'+n+'">'+e.title+'</span><span class="widget-actions">'+r._getActionsTemplate({widget:e})+"</span>",attributes:{"data-action":"open","data-appid":n},selectable:!0,selected:e.active})}),t}(d)),o.push({className:"more-apps js-not-selectable",template:'<span class="more-apps-logo"></span><span class="more-apps-text">'+i.moreAppsRoles+"</span>",handler:function(){this.options.callbacks["more-apps"]()}})),n.items=o,(s=new a(e.merge(n,l))).getActionElement=function(e){var t;if(e){try{t=s.getContent().getElement(".selected ."+e)}catch(e){console.error(e),t=void 0}return t}},s},destroy:function(){s&&s.destroy(),s=null},_getActionsTemplate:function(t){var a=(t=t||{}).widget;return r._actions.map(function(t){if(!("expand"===t&&function(t){return t.data&&e.is(t.data.addinHideOpenInDashboard)}(a)||"close"===t&&function(t){return t.data&&e.is(t.data.addinHideClose)}(a)))return function(e,t){var a=d[e],i=a.text,o=t.appId;return"close"===e&&(i=n.replace(i,{appName:t.title})),'<span class="item-icon fonticon fonticon-'+a.icon+" "+e+'" data-action="'+e+'" data-appid="'+o+'" title="'+i+'"></span>'}(t,a)}).join("")}}}),define("DS/Dashboard/CompassManager",["DS/i3DXCompass/i3DXCompass","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,t,n){"use strict";var a,i={_isOpen:!1,_onOpenCallbacks:[],_onCloseCallbacks:[],serviceNames:{businessexperience:{compass:"businessexperience",registry:"BUSINESSEXPERIENCE"},compass:{compass:"3DCompass",registry:"3DCOMPASS"},dashboard:{compass:"3DDashboard",registry:"3DDASHBOARD"},help:{compass:"x3dhelp",registry:"X3DHELP"},mepreferences:{compass:"mepreferences",registry:"MEPREFERENCES"},passport:{compass:"3DPassport",registry:"3DPASSPORT"},search:{startup:"search",compass:"3DSearch",registry:"3DSEARCH"},smaexecloudndb:{startup:"hpc",compass:"smaexecloudndb",registry:"SMAExeCloudNDB"},space:{startup:"cstorage",compass:"3DSpace",registry:"3DSPACE"},swym:{startup:"swym",compass:"3DSwym",registry:"3DSWYM"},tagger:{startup:"tagger",compass:"6WTags",registry:"6WTAG"},usersgroup:{compass:"usersgroup",registry:"USERSGROUP"}},appIds:{globViewer:"X3DGLOB_AP",mail:"X3DMAIL_AP",mediaLinks:"X3DMELI_AP",quickLinks:"X3DLINK_AP",runYourApp:"X3DRYAP_AP",webNotes:"X3DNOTE_AP",webPageReader:"X3DWEBP_AP",x3DPlay:"X3DPLAW_AP",x3DSearch:"X3DSEAR_AP"},init:function(){n.subscribe("compassPanelOnShow",function(){i._isOpen=!0,i._onOpenCallbacks.forEach(function(e){e()})}),n.subscribe("compassPanelOnHide",function(){i._isOpen=!1,i._onCloseCallbacks.forEach(function(e){e()})})},isInitialized:function(){return e.isInitialized()},open:function(){e.showAccordion(!0)},close:function(){e.hideAccordion(!0)},isOpen:function(){return i._isOpen},showHideCloseBtn:function(e){var t="boolean"==typeof(e=e||{}).hide?e.hide:void 0;t=t||"boolean"==typeof e.show?!e.show:void 0,document.body.toggleClassName("ifwe-hide-compass-close-btn",t)},onPostInitialized:function(){return i.isInitialized()?Promise.resolve():new Promise(function(e,t){require(["DS/i3DXCompass/EventManager"],function(t){i.isInitialized()?e():t.addEventOnce("onCompassLoaded",function(){e()})},t)})},subscribeOnOpen:function(e){i._onOpenCallbacks.push(e)},subscribeOnClose:function(e){i._onCloseCallbacks.push(e)},getAppInfo:function(t){var n=(t=t||{}).appId,a=t.onComplete;if(!n||!a)throw"Missing parameters";e.getAppInfo({appId:n,onComplete:function(e){e?a(e):require("DS/Dashboard/UserPlatformAccess").fetchAppUrlById(n,a,function(){console.error("Could not get "+n+" App Config from MyApps"),t.onFailure&&t.onFailure()})}})},getAppIcon:(a={},function(e){return new Promise(function(t,n){var o=e.appId,r=a[o];function s(n){t(e.pngFormat?function(e){var t=e.lastIndexOf(".svg"),n=e;return-1!==t&&(n=e.substring(0,t)+".png"+e.substring(t+".png".length)),n}(n):n)}if(r)return s(r);i.getAppInfo({appId:o,onComplete:function(e){var t=e.icon||"";a[o]=t,s(t)},onFailure:function(){console.error("Fail to fetch app with appId:",o),n()}})})}),getServiceUrl:function(e){return new Promise(function(n,a){var i="string"==typeof e.serviceName?e.serviceName:e.serviceName.compass;function o(){a('No service url found for service name: "'+i+'".')}t.getServiceUrl({serviceName:i,platformId:e.platformId,config:e.config,onComplete:function(e){return"string"==typeof e?n(e):Array.isArray(e)&&e.length?n(e):o()},onFailure:a})})},getPlatformConfig:function(e){return new Promise(function(n,a){t.getPlatformConfig({key:e.key,platformId:e.platformId,onComplete:n,onFailure:a})})},getPlatformServices:function(e){return e=e||{},new Promise(function(n,a){t.getPlatformServices({platformId:e.platformId,config:e.config,onComplete:function(t){var a=e.serviceName;return e.platformId?n(t||{}):(t=t||[],a?(a="string"==typeof a?a:a.compass,n(t.filter(function(e){return e[a]}))):n(t))},onFailure:a})})},getServicesByPlatform:function(e){e=e||{};var t=require("DS/Dashboard/PublicAPI"),n=require("DS/UWPClientCode/PublicAPI");return t._getApplicationConfigurationBoolean("app.build.isCloud")?new Promise(function(t,a){require(["DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient"],function(i){var o=Object.assign({url:n.getApplicationConfiguration("app.urls.registry")},e.config);return o.url?i.getServicesByPlatform({platforms:e.platforms,services:e.services.map(function(e){return"string"==typeof e?e:e.registry}),config:o}).then(t).catch(a):(console.error("### Empty registry URL."),t([]))},function(){console.error("### Fail to require i3DXCompassRegistryClient."),t([])})}):Promise.resolve([])}};return i}),define("DS/Dashboard/Views/My3DExperience/Cockpit",["UWA/Core","UWA/Class/View"],function(e,t){"use strict";var n=t.extend({setup:function(){var t;n._bootstrapped||(t=this.container,require(["UWA/Utils","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/Navigation","DS/Dashboard/Bootstrap","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation"],function(n,a,i,o,r,s){o.setMode(r.MY3DEXPERIENCE_MODE),o.setMainContainer(t),s.firstPart=s.parts.east,a.getWidgetInstancePublicTree({serviceName:r._getServiceName(),success:function(t){var a,r,s,d;(a=function(e){var t={};return function e(t,n){var a=function(t){var a={};n.children.push(a),e(t,a)};for(var i in t)["id","name","parentId","urlHandler","urlPart"].indexOf(i)>-1?n[i]=t[i]:"children"===i&&(n.children=[],t.children.forEach(a))}(e,t),t}(t)).children.forEach(function(e){"Dashboard"===e.name&&(e.urlHandler="DS/Dashboard/Navigation/Cockpit",e.urlPart="cockpit")}),i.setHierarchy(a),e.is(o.onNavigateSuccess,"function")&&i.setNavigateSuccessHandler(o.onNavigateSuccess),e.is(o.preNavigate,"function")&&i.setPreNavigateHandler(o.preNavigate),e.is(o.beforeNavigationStarts,"function")&&o.beforeNavigationStarts(),(r={newURL:window.location.href},s=window.location.hash,(d=n.parseUrl(r.newURL))&&d.anchor&&(s=d.anchor),i.historyChanged(s)).then(o.start)},cacheId:wap.widgetInstancesCacheId})}),n._bootstrapped=!0)}});return n}),define("DS/Dashboard/Models/Member",["UWA/Class/Model","DS/UWPClientCode/PublicAPI"],function(e,t){"use strict";var n=e.extend({defaults:{id:"",type:"",role:"",owner:!1,actions:void 0},actions:null,setup:function(e){e=e||{},this.actions=e.actions},parseMember:function(e){var t=(e.role||"").toLowerCase();return e.type=(e.type||"").toUpperCase(),e.role=t,e.owner=!!e.owner||"owner"===t,e},isGroup:function(){return"GROUP"===this.get("type")},isUser:function(){return"USER"===this.get("type")},isOwner:function(){return!(!this.get("owner")&&"owner"!==this.get("role"))},getId:function(){return this.get("id")},getRole:function(){return this.get("role")},setRole:function(e){e=(e||"").toLowerCase(),this.set("role",e),this.set("owner","owner"===e)},getName:function(){var e,t,n="";return this.isGroup()?n=this.getGroupName():(e=this.getFirstName(),t=this.getLastName(),n=e&&t?e+" "+t:this.getLogin()),n},isCurrentUser:function(){return this.isUser()&&this.getLogin()===t.getCachedCurrentUser().login}});return n.USER_TYPE="USER",n.GROUP_TYPE="GROUP",n.OWNER_ROLE="owner",n.READER_ROLE="reader",n.CONTRIBUTOR_ROLE="contributor",n.isOwnerRole=function(e){return"owner"===(e||"").toLowerCase()},n.isContributorRole=function(e){return"contributor"===(e||"").toLowerCase()},n.isReaderRole=function(e){return"reader"===(e||"").toLowerCase()},n.isUserType=function(e){return"USER"===(e||"").toUpperCase()},n.isGroupType=function(e){return"GROUP"===(e||"").toUpperCase()},n}),define("DS/Dashboard/Views/SearchableMemberSet",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Text","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/W3DXComponents/MemberSet","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n,a,i,o,r){"use strict";var s="hide",d=o.extend({setup:function(t){this._filterView=new l(e.extend({collection:this.collection},(t.contents||{}).filterViewOptions)),this._parent.apply(this,arguments),["tile","table"].forEach(function(t){var n=this.contentsViews[t].nestedView,a=n.onRender,i=e.createElement("div",{class:"no-results",text:r.searchNoResults}).inject(n.container),o=!1;n.onRender=function(){var e=0===this.collection.length;a.apply(this,arguments),i[e&&o?"show":s](),o=!0}.bind(n)},this)},onRender:function(){var e,t=this,n=t.container;t._parent.apply(t,arguments),(e=n.getElement(".member-set-switcher")).parentElement.insertBefore(t._filterView.render().container,e),e.getElements(".switcher-button").forEach(function(e){e.addEventListener("click",function(e){t._toggleState(e)})}),new i({position:"bottom",target:n.getElement(".tile-title"),body:n.getElement(".tile-title").innerText})},onPostInject:function(){var e;e=this.container.getElement(".member-set-switcher").getElements(".switcher-button"),"tile"===this.currentViewId.toLowerCase()?(e[0].addClassName(s),e[1].removeClassName(s)):(e[1].addClassName(s),e[0].removeClassName(s))},_toggleState:function(e){var t,n=e.currentTarget.getElement("input").defaultValue;t=this.container.getElement(".member-set-switcher").getElements(".switcher-button"),"tile"===n.toLowerCase()?(t[0].addClassName(s),t[1].removeClassName(s)):(t[1].addClassName(s),t[0].removeClassName(s))}}),l=t.extend({tagName:"div",className:"filter-view-container",setup:function(e){(e=e||{}).search&&this._buildSearchAction(e.search),e.filter&&this._buildFilterAction(e.filter)},render:function(){return this.elements.searchAction&&this.elements.searchAction.inject(this.container),this.elements.filterAction&&this.elements.filterAction.inject(this.container),this},_buildSearchAction:function(t){var a,o=this,r=o.container;function s(e,t){return new i({target:o.elements.searchAction.getElement(".filter-view-search-"+e),body:t,position:"bottom"})}function d(){return s("apply",t.tooltips.search)}o.elements.searchAction=e.createElement("div",{class:"filter-view-search-container",html:[{tag:"span",class:"filter-view-action filter-view-search-apply fonticon fonticon-2x fonticon-search",events:{click:function(){r.hasClassName("toggled")||(r.addClassName("toggled"),a.destroy(),o.elements.searchInput.focus())}}},{tag:"span",class:"filter-view-action filter-view-search-cancel fonticon fonticon-2x fonticon-cancel-squared",events:{click:function(){a=d(),r.removeClassName("toggled"),o.elements.searchAction.removeClassName("active"),o.elements.searchInput.setValue(""),o.elements.searchInput.dispatchOnChange()}}}]}),o.elements.searchInput=new n({placeholder:t.placeholder,events:{onKeyDown:function(){setTimeout(function(){o.elements.searchAction.toggleClassName("active",!!o.elements.searchInput.getValue()),t.onChange&&t.onChange.call(o)})},onChange:t.onChange&&t.onChange.bind(o)}}).inject(o.elements.searchAction,"top"),a=d(),s("cancel",t.tooltips.clear)},_buildFilterAction:function(t){var n=this,o=[];n.elements.filterAction=e.createElement("span",{class:"filter-view-action filter-view-filter fonticon fonticon-2x fonticon-filter"}),n.elements.filterInput=new a({target:n.elements.filterAction,multiSelect:!0,closeOnClick:!0,items:t.items.map(function(t){return e.extend({selectable:!0},t)}),events:{onClick:function(){setTimeout(function(){var e=this.getSelectedItems().filter(function(e){var t=-1===o.indexOf(e.name);return t||this.toggleSelection(e),t},this).map(function(e){return e.name});n.elements.filterAction.toggleClassName("active",!!e.length),e.join(",")!==o.join(",")&&(o=e,t.onChange&&t.onChange.call(n))}.bind(this))}}}),new i({target:n.elements.filterAction,body:t.tooltip,position:"bottom"})}});return d}),define("DS/Dashboard/ManageDashboard/Views/DashboardDetailView",["DS/W3DXComponents/IdCard"],function(e){"use strict";return e.extend({tagName:"div",className:"dashboard-detail-view-container id-card",elements:{},setup:function(e){this.model=e.model,this.facets=e.facets,this.actions=e.actions,this.attributesMapping=e.attributesMapping,this.selectedFacet=e.selectedFacet||0},render:function(){return this._parent.apply(this,arguments),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/Dashboard/Views/SearchInput",["UWA/Event","UWA/Element","UWA/Class/View","DS/UIKIT/Tooltip","DS/UIKIT/Input/Text","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n,a,i,o){"use strict";return n.extend({className:"ifwe-search-input",tagName:"div",_events:{onSearch:function(){},onClear:function(){},onClose:function(){},onFocus:function(){},onBlur:function(){},onKeyUp:function(){}},_focusMap:{},_lastSearch:"",_inputTextPlaceholder:"",_dense:!1,_elevated:!1,setup:function(e){e=e||{};this._events=Object.assign({},this._events,e.events||{}),this._focusMap={},this._inputTextPlaceholder=e.inputTextPlaceholder||"",this._dense=!!e.dense,this._elevated=!!e.elevated,this.options.value=e.value||""},destroy:function(){this._events=null,this._focusMap=null,this._lastSearch=null,this._inputTextPlaceholder=null,this._parent.apply(this,arguments)},render:function(){var n,r,s,d,l=this.container,c=this.elements;return(n=c.inputSearch=new i({className:"input-search",value:this.options.value,attributes:{tabindex:0},placeholder:this._inputTextPlaceholder})).elements.input.addEvent("keyup",this._onKeyUp.bind(this)),n.elements.input.addEvent("focus",this._onFocus.bind(this,"inputSearch")),n.elements.input.addEvent("blur",this._onBlur.bind(this,"inputSearch")),r=c.searchBtn=new t("span",{class:"search-btn my-btn fonticon fonticon-search",tabindex:0,events:{click:this._onSearch.bind(this),keyup:this._onKeyUp.bind(this),focus:this._onFocus.bind(this,"searchBtn"),blur:this._onBlur.bind(this,"searchBtn")}}),s=c.clearBtn=new t("span",{class:"clear-btn my-btn fonticon fonticon-clear",tabindex:0,events:{click:this._onClear.bind(this),keyup:this._onKeyUp.bind(this),focus:this._onFocus.bind(this,"clearBtn"),blur:this._onBlur.bind(this,"clearBtn")}}),d=c.closeBtn=new t("span",{class:"close-btn my-btn fonticon fonticon-close",tabindex:0,events:{click:this._onClose.bind(this),keyup:this._onKeyUp.bind(this),focus:this._onFocus.bind(this,"closeBtn"),blur:this._onBlur.bind(this,"closeBtn")}}),l.addContent([n,r,s,d]),l.addEvent("click",function(t){e.stopPropagation(t)}),c.searchBtnTooltip=new a({position:"bottom",target:r,body:o.searchBtn,offset:{x:0,y:-4}}),c.clearBtnTooltip=new a({position:"bottom",target:s,body:o.clearBtn,offset:{x:0,y:-4}}),c.closeBtnTooltip=new a({position:"bottom",target:d,body:o.closeBtn,offset:{x:0,y:-4}}),s.hide(),this._setStyles(),this},focus:function(){return this._focusInputSearch(),this},search:function(e){return this._onSearch(e),this},clear:function(e){return this._onClear(e),this},close:function(e){return this._onClose(e),this},getValue:function(){return this.elements.inputSearch.getValue()},setValue:function(e){return this.elements.inputSearch.setValue(e),this},hasFocus:function(){return this._hasFocus()},hasLastSearch:function(){return!!this._lastSearch},_showSearchBtn:function(){var e=this.elements;e.clearBtn.hide(),e.searchBtn.show()},_showClearBtn:function(){var e=this.elements;e.searchBtn.hide(),e.clearBtn.show()},_focusInputSearch:function(){var e=this;setTimeout(function(){e.elements.inputSearch.focus()})},_hasFocus:function(){return Object.values(this._focusMap).some(function(e){return e})},_setStyles:function(){var e="dense-view",t="elevated-view",n=this.container;[e,t].forEach(function(e){n.removeClassName(e)}),this._dense&&n.addClassName(e),this._elevated&&n.addClassName(t)},_onSearch:function(e){e=e||{};var t=this.getValue();t?(this._showClearBtn(),!e.silent&&this._events.onSearch(t),!e.noFocus&&this._focusInputSearch(),this._lastSearch=t):this._onClear(e)},_onClear:function(e){e=e||{};var t=this.elements;this._showSearchBtn(),t.inputSearch.setValue(""),!e.silent&&this._events.onClear(),!e.noFocus&&this._focusInputSearch(),this._lastSearch=""},_onClose:function(e){!(e=e||{}).silent&&this._events.onClose()},_onKeyUp:function(e){e=e||{};var t,n=this.elements,a=n.inputSearch,i=n.searchBtn,o=n.clearBtn,r=n.closeBtn,s=e.target,d=e.key;s===a.elements.input||s===i?"Enter"===d?this._onSearch():(t=this.getValue(),this._lastSearch===t&&t?this._showClearBtn():this._showSearchBtn()):s===o?"Enter"===d&&this._onClear():s===r&&"Enter"===d&&this._onClose(),this._events.onKeyUp(e)},_onFocus:function(e){this._focusMap[e]=!0,this.container.addClassName("has-focus"),this._events.onFocus()},_onBlur:function(e){var t;this._focusMap[e]=!1,t=this._hasFocus(),this.container.toggleClassName("has-focus",t),!t&&this._events.onBlur()}})}),define("DS/Dashboard/Bootstrap",["UWA/Core","UWA/String","UWA/Utils","UWA/Promise","DS/Logger/Logger","DS/PubSub/PubSub","DS/UWPClientCode/Bootstrap","DS/UWPClientCode/WidgetFactory","DS/UWPClientCode/WidgetCatalog","DS/UWPClientCode/Navigation","DS/UWPClientCode/PublicAPI","DS/UWPClientControls/Utils","DS/UWPClientControls/PlatformNotify","DS/WebappsUtils/WebappsUtils","DS/WebappsUtils/Performance","DS/Dashboard/InitUserDashboards","DS/Dashboard/Navigation","DS/Dashboard/Intercom","DS/Dashboard/Shortcuts","DS/Dashboard/UserPlatformAccess","DS/Dashboard/PublicAPI","DS/Dashboard/TopFrameManager","DS/Dashboard/GridManager","DS/Dashboard/UsageTracker","DS/Dashboard/CompassManager","DS/Dashboard/Utils","DS/Dashboard/UIKITUtils","DS/Dashboard/Environment","DS/Dashboard/WidgetLinkManager","DS/Dashboard/Search","DS/Dashboard/Models/Member","DS/Dashboard/DashboardManager","DS/Dashboard/WidgetPreviewManager","DS/Dashboard/ManageDashboardManager","DS/Dashboard/StoryManager","DS/TopFrame/TopFrame","DS/TagNavigator/TagNavigator","DS/TopBar/model/MainMenuBar","DS/PlatformAPI/PlatformAPI","i18n!DS/Dashboard/assets/nls/main","css!DS/Dashboard/Dashboard.css"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w,D,_,C,I,S,y,E,T,A,P,x,M,k,N,W,L,U,O,F,B){"use strict";var R,V=!1,H=!1,z="",j="",G={},K=!1;function q(e,n){I.track({category:"dashboard.use",action:"on"+t.ucfirst(n||"")+"Panel"+t.ucfirst(e||"")+"-bootstrap"}),"open"===e?o.dispatch(D.events.panel.open,arguments):"change"===e?o.dispatch(D.events.panel.change,arguments):"close"===e&&(o.dispatch(D.events.panel.close,arguments),"right"===n&&p.routeTo({keepAll:!0,discards:p.parts.sidepanel})),C.update()}function Y(t){return t||(t={}),new a(function(n){var r=L.PROFILE_TOPMENU_ID,s=L.ADD_TOPMENU_ID,d=L.SHARE_TOPMENU_ID,l=L.HELP_TOPMENU_ID,u=L.CONTENT_TOPMENU_ID,h=L.SOCIAL_TOPMENU_ID,g=L.NOTIFICATION_TOPMENU_ID,f=0,b=c.getApplicationConfiguration.bind(c),v={serviceName:D.SERVICE_NAME_3DD,userName:"",brand:"3DDashboard",lang:dsLang,application:" ",topMenus:[r,D._getApplicationConfigurationBoolean("app.notifications.enable")?g:"",s,d,u,l,h].filter(function(e){return e}),hideTenantDisplay:!1,addinMode:p.getAddinModeValue(),activateSearch:!K,lockedAppMode:p.isLockedAppMode(),showCoachmark:!0,xappsMode:!0,dashboardSwitch:!0,renderFooter:!1,activateGDPR:D._getApplicationConfigurationBoolean("app.gpdr.enable"),baseAppletPath:m.getWebappsAssetUrl("i3DXCompass","applet/"),baseHtmlPath:m.getWebappsBaseUrl()+"i3DXCompass/",baseImgPath:m.getWebappsAssetUrl("i3DXCompass","images/"),baseNlsPath:m.getWebappsAssetUrl("i3DXCompass","lang/"),proxyTicketUrl:dsBaseUrl.replace(/\/$/g,"")+"/api/passport/ticket?url=V6",showWidgetApps:!0,tagsServerUrl:"",enableWidgetDrag:function(e,t){var n={tenantAware:t.tenantAware,x3dPlatformId:t.platformId};c.enableDragAndInstantiation({noHandler:!0,element:e,appId:t.id,icon:t.icon,url:t.launchInfos,dataUrl:t.config,data:JSON.stringify(n),title:t.title,trusted:t.trusted,token:t.checksum,apps:JSON.stringify(t.apps)})},getContextIdFromWidgetId:function(e){var t;return"ManageDashboardsId"===e?"ManageDashboardsContext":(t=D._getTabByModuleId(e))&&t.navContext?t.navContext:t?t.wp.id:-1!==e.indexOf("preview")?"RightPanelContext":void 0},displayFilteredState:function(e,t){var n=D._getWidget(e);n&&n.environment&&n.environment.setFiltered&&n.environment.setFiltered({from:P.from.tagger,clear:!t})},onAcceptLegal:function(){t.onComplete&&t.onComplete(),n()},onCoachmarkDNSAChange:function(e){I.track({category:"dashboard.use",action:"onCoachmarkDNSAChange-bootstrap"}),w.updateStartupCache({coachmarkDNSA:e})},onRightPanelMinimize:function(){o.dispatch(D.events.rightpanel.minimized,null,!0)},onRightPanelMaximize:function(){o.dispatch(D.events.rightpanel.maximized,null,!0)},onRightPanelChange:function(){q("change","right")},onUserContextClick:function(){o.dispatch(D.events.topbar.userContextClick,null,!0)},onTenantChange:function(e){var t=(e=e||{}).from||{},n=e.to||{},a=n[D.SERVICE_NAME_3DD];a&&t.platformId!==n.platformId&&D.redirectToPlatformAwareUrl({platformId:n.platformId,url:a,clearAnchor:!0})},getAllTenants:_.getTopBarUserPlatforms};function C(n){function a(e,t){return e.filter(function(e){return!t.includes(e)})}e.extend(v,n),f>=2?(v.addinMode&&(v.topMenus=a(v.topMenus,[u,h,s,d]),v.hiddenTopBar=!0),v.lockedAppMode&&(v.topMenus=a(v.topMenus,[g,u,h,s,d,l,r])),p.isBELayoutEditorMode()&&(v.topMenus=a(v.topMenus,[d,g])),D._getCurrentMode()===D.STANDALONE_MODE?(L.init(v),L.removeResizeEvent(),L.getApplicationContainer().setStyle("height"),document.body.addClassName("ifwe")):t.onComplete&&t.onComplete()):f++}function E(e){e&&e.login||(e=c.getCachedCurrentUser()),C({firstName:e.firstName,lastName:e.lastName||"",userName:e.firstName+" "+(e.lastName||""),userId:e.login})}v.contentApps={},v.contentApps[L.CONTENT_XAPP_TAG]=D._getApplicationConfigurationBoolean("app.3DDrive.enable"),v.contentApps[L.PARTSUPPLY_XAPP_TAG]=!0,c.callbacks.loadExternalWidget=function(t,n){var a=t.appId;function o(){I.track({category:"dashboard.use",action:"loadExternalWidgetFail-bootstrap",appId:a}),n({userNotAllowed:!0})}S.getAppInfo({appId:a,onComplete:function(r){var s,d,l,c,u,h,m,g=(r=r||{}).platforms,f=g&&g[0],p=D._getGlobalPlatformId();if(p&&r.platforms&&r.platforms.forEach(function(e){e.id===p&&(m=e,f=e)}),r.checksum&&r.launchInfos||f&&f.checksum&&f.launchInfos){if((d=(t.parsedData||{}).x3dPlatformId)&&g&&g.length){if(!(l=(l=g.find(function(e){return d.replace(y.ignoredTenantSuffixesPattern,"")===e.id}))||f))return void o();s=l.launchInfos,c=l.isolationLevel,u=l.title,h=l.checksum}else p&&m&&(s=m.launchInfos,c=m.isolationLevel,u=m.title,h=m.checksum);s||(s=e.is(r.launchInfos)?r.launchInfos:f&&f.launchInfos,h=e.is(r.checksum)?r.checksum:f&&f.checksum),c||(c=e.is(r.isolationLevel)?r.isolationLevel:f&&f.isolationLevel),u||(u=e.is(r.title)?r.title:f&&f.title),n({widgetId:s,isolationLevel:c,name:u,title:u,token:h}),I.track({category:"dashboard.use",action:"loadExternalWidgetSuccess-bootstrap",appId:a,platformId:d})}else i.error("Could not get valid Config from MyApps for the App "+a),o()},onFailure:o})},c.callbacks.beforeWidgetLaunch=function(t){var n,a,i,o={},r=t.environment;r&&r.wp&&r.wp.isContainer||(n=t.id,O._removeProvider(n),D._getAllTabs().forEach(function(t){e.is(t)&&U.get6WTagger(t.id).removeProxiesOfCC(n)}),n&&n.indexOf("preview")>=0||(a=D._getActiveContextModelId(),i=D._isReaderContext(a),T=D._getGlobalPlatformId(),t.addEventOnce("onLoad",function(){!i&&t.getValue("x3dPlatformId")||(o.x3dPlatformId=T),t.setValues(o),r.updatePlatformInfoIcon()})))},c.callbacks.consistencyCheckFailure=function(){o.dispatch(D.events.dashboard.inconsistency)};var T=D._getGlobalPlatformId(),A=D._getSwymPlatform();C({passportUrl:b("app.urls.passport")||"",myAppsBaseURL:w.getMyAppsBaseUrl(),tagsServerUrl:b("app.urls.tagging_collab")||"",brandAbout:b("app.build.brand")||"",appNameAbout:b("app.build.name")||"",numberAbout:b("app.build.number")||"",communityUrl:b("app.urls.support_community"),supportPublicCloudUrl:b("app.urls.support_public_cloud"),getStartedUrl:w.getMyAppsBaseUrl(),tenant:T,swymUrl:A&&A.url,isCloud:b("app.build.isCloud"),cloudType:b("app.build.cloudType")}),c.getUserAsync({success:E,failure:E}),function(){var e,t,n=[S.serviceNames.swym,S.serviceNames.search,S.serviceNames.space,S.serviceNames.tagger,S.serviceNames.smaexecloudndb];function i(e,t,n){n=n||[];var a=t.filter(function(t){return t[e]&&!n.some(function(e){return e.id===t.platformId})}).map(function(t){return{displayName:t.displayName||t.platformId,url:t[e],id:t.platformId}});return n.concat(a)}return w.fetchUserStartupParams().then(function(o){return D._getApplicationConfigurationBoolean("app.fix.fetchagnosticstartup.disabled")?a.resolve(o):((e=JSON.parse(JSON.stringify(o))).active_tenant=D._getGlobalPlatformId(),D.getPlatforms({config:{myAppsBaseUrl:w.getMyAppsBaseUrl(),lang:dsLang,userId:window.dsUserExternalId}}).then(function(a){t=a;var o={};return n.forEach(function(e){o[e.startup]=e.compass}),Object.keys(o).forEach(function(t){e[t]=i(o[t],a,e[t])}),S.getServicesByPlatform({platforms:a.map(function(e){return e.platformId}),services:n}).then(function(a){return(a||[]).forEach(function(a){var o=a.id;(a.services||[]).forEach(function(a){var r=n.find(function(e){return e.registry.toLowerCase()===a.id.toLowerCase()});if(r){var s=r.startup,d=r.compass,l={platformId:o,displayName:function(e,t){return((t||{}).find(function(t){return t.platformId===e})||{}).displayName}(o,t)};l[d]=a.url,e[s]=i(d,[l],e[s])}})}),e}).catch(function(){return e})}).catch(function(){return e}))}).catch(function(){throw new Error("Fail to fetch startup params.")})}().then(function(e){["cstorage","search","swym"].filter(function(t){return e[t]}).forEach(function(t){e[t]=e[t].filter(function(e){return"R1132100503382"!==e.id})}),C({startupParams:e,legal:e.legal})})})}function X(){W.start({id:$(p.parts.story)})}function Q(t){require(["DS/UWPClientCode/Data/NotificationModel"],function(n){function a(e){require([e.action.replace(/_/g,"/")],function(t){t(e)})}n.fetch({serviceName:D._getServiceName(),force:!0,success:function(n){var i=n.getById(t);e.is(i,"object")?a(i):n.getPublic({id:t,success:function(e){e?a(e):require(["i18n!DS/Dashboard/assets/nls/navigation"],function(e){h.error(e.notificationAccessUnauthorized)})}}),I.track({category:"subscribe.read",action:"success-notificationNavigation"})},failure:function(n){e.log("unable to get the notification with ID : "+t),e.log(n),I.track({category:"subscribe.read",action:"failure-notificationNavigation"})}})})}function J(){var e=p.getSidepanelDecodedParameter(),t=G[e]||[];a.all(t.map(function(e){return a.resolve(e.beforeNavigate&&e.beforeNavigate())})).then(function(){var e=t.reduce(function(e,t){return t.transformData?t.transformData(e):e},p.getContentDecodedParameter());return L.openPanel("right",{appId:p.getSidepanelDecodedParameter(),data:e})}).then(function(){return a.all(t.map(function(e){return a.resolve(e.afterNavigate&&e.afterNavigate())}))})}function Z(){N.open({contextModelId:$(p.parts.dashboard),facet:$(p.parts.manage)})}function $(e){return p.getUrlParameter(e)}var ee=u.debounce(function(e,t,n,a){p.isAddinMode()||document.body.getElement(".wp-tabview-panel")?V?y.apply(e,t,n,a):o.addOnce("loadedTopFrameManager",function(){y.apply(e,t,n,a)}):o.addOnce(D.events.tab.change,function(){setTimeout(function(){y.apply(e,t,n,a)},800)})},1e3,!0);function te(e){return w.redirectToRightGrantingError(e),a.reject()}var ne={setMode:function(e){D._setCurrentMode(e),D._setServiceName(D.SERVICE_NAME_3DD)},setMainContainer:function(e){R=e},start:function(){return new a(function(t){Y({onComplete:function(){var e,n=p.isAddinMode();!n&&L.addEvents({onLeftPanelOpened:q,onLeftPanelClosed:q,onRightPanelOpened:q,onRightPanelClosed:q,onRightPanelResized:q}),A.init(),b.init(),!n&&(e=function(){var e=r.getStartPageMode(),t={};switch(e[0]){case"instance":t.id=e[1];break;case"widget":t.data=e[1].data,t.title=e[1].name,t.parent=!1,t.widgetId=e[1].id;break;default:t.id=e[1]}return t}(),g.mark("DS_Dashboard_Bootsrap_loadwidget"),e.el=R||L.getApplicationContainer(),e.el.addClassName("module"),s.load(e,null,T)),S.init(),_.init(),M.init(),N.init(),W.init(),o.dispatch("loadedTopFrameManager"),V=!0,!n&&E.unmaskBody(),t()}}),d.init(document.body,function(e){e(D._getActiveTab().id)}),v.init(),F.subscribe("webinwin:web:notification",function(t,n){if("undefined"!=typeof dscef)try{t="string"!=typeof t?JSON.stringify(t):t,n&&n.originalTopic?dscef.sendString(t,n.originalTopic):dscef.sendString(t)}catch(e){console.error("unable to send message through dscef",e)}else e.log(t)}),"undefined"!=typeof dscef&&(dscef.receivedString=function(e,t){t=t||"webinwin:win:notification",F.publish(t,e)}),D.initContextApiBaseUrl(),D._initBackgroundApiBaseUrl(),(n.Client.Platform.ios||n.Client.Platform.ipad)&&"safari"===n.Client.Engine.name&&window.addEventListener("scroll",function(){window.innerHeight===document.body.scrollHeight&&(document.body.querySelector(".app-content").scrollTop=0)})})},beforeNavigationStarts:function(){var t=a.resolve();return e.extendElement(document.body),E.maskBody(),D._isPlatformAwareUrl()&&(t=ne._initUrls()),t=t.then(function(){w.init()})},preNavigate:function(e){function t(){return H?a.resolve():f.init().then(function(){H=!0,D.setLastVisitedPlatformId(D._getGlobalPlatformId())})}e=e||[],p.init(),(K=p.isSWAMode())&&document.body.addClassName("ifwe-is-3dd-swa-mode");var n=(l.getPreviousAdress()[0]||{}).name;return"myapps"===(e[0]||{}).name&&$("myapps")?a.resolve():D._isPlatformAwareUrl()?0===e.length?(p.isAddinMode()?n===p.parts.app?k.close():l.historyChanged(" "):p.start(),a.resolve()):w.isUserGranted()?t():w.checkUserGranted().then(function(e){return e.granted?t():a.reject(e)}).catch(te):(D.fetchAllPlatformAwareUrls().then(ne._handleRedirectionToPlatformAwareUrl,function(){return w.clearStartupCache(),w.checkUserGranted({noPlatform:!0}).then(function(e){if(!e.granted)return a.reject(e)}).then(D.fetchAllPlatformAwareUrls).then(ne._handleRedirectionToPlatformAwareUrl)}).catch(w.redirectToRightGrantingError).finally(E.unmaskBody),new a(function(){}))},onNavigateSuccess:function(){var e,t,n,i,o,r,s,d;if(e=$(p.parts.dashboard)||$(p.parts.cockpit),t=$(p.parts.app),e||p.isAddinMode())n=$(p.parts.notification),i=$(p.parts.sidepanel),o=$(p.parts.manage),r=$(p.parts.story),t||(z="",j=""),t?ee(ne._onAppNavigation,null,null,!0):n?ee(Q,null,[n],!0):i?ee(J,null,null,!0):o?ee(Z,null,null,!0):r&&ee(X,null,null,!0);else{if((s=p.getContentDecodedParameter())&&s.X3DContentId)try{d=JSON.parse(s.X3DContentId)}catch(e){d=null,s=null}if(s&&d&&!t){var l=(((d.data||{}).items||[])[0]||{}).objectId;l&&p.routeTo({dashboard:l,discards:p.parts.content})}}return a.resolve()},addSidePanelNavigationHook:function(e,t){G[e]=(G[e]||[]).concat([t])},_handleRedirectionToPlatformAwareUrl:function(e){if(!e.length)return a.reject();var t,n,i,o;if(1===e.length&&(t=e[0]),!t){var r=(n="dashboard",i={},(window.location.hash||"").substring(1).split("/").forEach(function(e){var t=(e||"").split(":");i[t[0]]=t[1]}),i[n]);r&&(t=e.find(function(e){return c.contexts.find(function(t){return t.modelId===r&&t.platform===e.platformId})}))}return t||(t=(o=D._getLastVisitedPlatformId())&&e.find(function(e){return e.platformId===o})),t||(t=e.find(function(e){return c.contexts.find(function(t){return t.platform===e.platformId})})),t?D.redirectToPlatformAwareUrl({platformId:t.platformId,url:t[D.SERVICE_NAME_3DD],replaceLocation:!0}):(E.unmaskBody(),ne._showPlatformSelectModal({platforms:e}).then(function(e){return E.maskBody(),D.redirectToPlatformAwareUrl({platformId:e.platformId,url:e[D.SERVICE_NAME_3DD],replaceLocation:!0})}))},_showPlatformSelectModal:function(e){return new a(function(t,n){require(["DS/Dashboard/Modals/PlatformSelect","i18n!DS/Dashboard/assets/nls/modal"],function(n,a){n.show({message:a.noPlatformSelectContent,closable:!1,platforms:e.platforms,onConfirm:t})},n)})},_onAppNavigation:function(){var e,t,n=p.getAppDecodedParameter(),i=p.getContentDecodedParameter();if(n!==z||i!==j)return z=n,j=i,((e=y.getParsedQuery()).wii?(t=e.wii,new a(function(e,n){c.getWidgetInstance({serviceName:D._getServiceName(),id:t,withAccess:!0,success:e,failure:n})})).then(function(e){var t=e.data;if(e.role){var n=JSON.parse(t||"{}");n.wpData=n.wpData||{},n.wpData.editable=!x.isReaderRole(e.role),t=JSON.stringify(n)}return{contentParam:{URLTransientData:t}}}).catch(function(){var t="Fail to fetch wii: "+e.wii;return console.error("Fail to fetch wii: ",e.wii),{error:t}}):a.resolve({contentParam:i})).then(function(e){if((e=e||{}).error)return M.showAlert({messages:[{className:"error",message:B.widgetInstanceNotFound}]}),document.body.addClassName("with-app"),E.unmaskBody(),!0;k.show({appId:n,data:e.contentParam}),I.track({category:"dashboard.use",action:"showPreview-appNavigation"})})},_initUrls:function(){var e="app.urls.myapps",t=[e,"app.urls.passport","app.urls.passport.cas","app.urls.passport.wsdl","app.urls.tagging_collab"],n=[S.serviceNames.dashboard,S.serviceNames.compass,S.serviceNames.passport];function a(n){n=n||{};var a="development"===c.getApplicationConfiguration("app.profile"),i=c.getApplicationConfiguration("app.dev.urls.myapps");a&&i&&(n[e]=i),c.applicationConfigurations.forEach(function(e){var a,i=e.propertyKey;t.includes(i)&&(a=n[i])&&(e.propertyValue=a)})}function i(e){console.error("### Fail to init app.properties urls from Registry:",e)}function o(e){i(e),a()}return S.getServicesByPlatform({platforms:[D._getGlobalPlatformId()],services:n}).then(function(t){var n={},r=t[0],s=!1,d=!1,l=!1,c=[];r&&(r.services||[]).length?(r.services.forEach(function(t){var a=t.id.toLowerCase(),i=t.url;S.serviceNames.compass.registry.toLowerCase()===a?(n[e]=i,s=!!i):S.serviceNames.passport.registry.toLowerCase()===a?(n["app.urls.passport"]=i,n["app.urls.passport.cas"]=y.buildPath(i,"cas"),n["app.urls.passport.wsdl"]=y.buildPath(i,"api/wsdl"),d=!!i):S.serviceNames.dashboard.registry.toLowerCase()===a&&(n["app.urls.tagging_collab"]=i,l=!!i)}),s||c.push("Compass"),d||c.push("Passport"),l||c.push("Dashboard"),c.length&&i("Missing following services: "+c.join(" | ")),a(n)):o("No services found for the current platform.")}).catch(function(e){o(e)})}};return ne}),define("ifwe/layout/MyApps",["DS/Dashboard/Layout/PlatformManagement","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/layout/MyApps` since it is deprecated in favor of `DS/Dashboard/Layout/PlatformManagement`"),e}),define("ifwe/layout/dashboard",["DS/Dashboard/Layout/Dashboard","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/layout/dashboard` since it is deprecated in favor of `DS/Dashboard/Layout/Dashboard`"),e}),define("ifwe/layout/ColumnsContainer",["DS/Dashboard/Layout/Tab","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/layout/ColumnsContainer` since it is deprecated in favor of `DS/Dashboard/Layout/Tab`"),e}),define("ifwe/Notification/Handlers/ShareWidget",["DS/Dashboard/Notification/Handlers/ShareWidget","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/Notification/Handlers/ShareWidget` since it is deprecated in favor of `DS/Dashboard/Notification/Handlers/ShareWidget`"),e}),define("ifwe/Notification/Handlers/ShareArticle",["DS/Dashboard/Notification/Handlers/ShareArticle","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/Notification/Handlers/ShareArticle` since it is deprecated in favor of `DS/Dashboard/Notification/Handlers/ShareArticle`"),e}),define("ifwe/Notification/Handlers/ShareTab",["DS/Dashboard/Notification/Handlers/ShareTab","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/Notification/Handlers/ShareTab` since it is deprecated in favor of `DS/Dashboard/Notification/Handlers/ShareTab`"),e}),define("ifwe/Notification/Handlers/ShareDashboard",["DS/Dashboard/Notification/Handlers/ShareDashboard","DS/Logger/Logger"],function(e,t){"use strict";return t.warn("Please do not use `ifwe/Notification/Handlers/ShareDashboard` since it is deprecated in favor of `DS/Dashboard/Notification/Handlers/ShareDashboard`"),e}),define("DS/Dashboard/Modal",["UWA/Core","UWA/Element","UWA/Utils","DS/UIKIT/Modal","DS/WebappsUtils/Utils"],function(e,t,n,a,i){"use strict";var o=!1;n.Client.Engine.safari7&&(o=!0);var r={viewportHeight:0,resizeHandler:null,TAB_HEIGHT:39,init:function(t){var n="context-modal "+(t.className||""),a=e.merge({renderTo:t.renderTo||document.body,className:n},t||{});this.resizeHandler=this.resize.bind(this),this._parent(a)},onPostInject:function(){this._parent.apply(this,arguments),this.resize()},show:function(){this.initResizeEvent(),this.options.renderTo.setStyle("overflow","hidden"),this._parent.apply(this,arguments),n.Client.Features.touchEvents&&(o&&(document.body.addClassName("no-fix-viewport-height-ios7"),window.scrollTo(0,0)),this.resize())},hide:function(){var e=this.options||{};this.removeResizeEvent(),e.renderTo&&e.renderTo.setStyle("overflow",""),this._parent.apply(this,arguments),o&&(document.body.removeClassName("no-fix-viewport-height-ios7"),window.scrollTo(0,0))},initResizeEvent:function(){t.addEvent.call(window,"resize",this.resizeHandler)},removeResizeEvent:function(){t.removeEvent.call(window,"resize",this.resizeHandler)},resize:function(){var e,t,a,o,r=this.elements,s=this.options.renderTo,d=window.innerHeight||document.documentElement.clientHeight;n.Client.Features.touchEvents&&i.isVirtualKeyboardOpen()||(t=s.getBoundingClientRect(),e=s.getOffsets(),o=s.getScrolls(),a=t.top-e.y,r.content.setStyle("height",d-2*e.y-this.TAB_HEIGHT+"px"),r.content.setStyle("top",Math.abs(a)+o.top+this.TAB_HEIGHT+"px"),r.container.setStyle("height",o.height),r.overlay.setStyle("height",o.height),this.viewportHeight=d)},destroy:function(){this.removeResizeEvent(),this._parent.apply(this,arguments)}};return a.extend(r)}),define("DS/Dashboard/Modals/ExportDashboard",["UWA/Core","UWA/String","UWA/Element","DS/UWPClientCode/I18n","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o,r,s){"use strict";var d={superModal:void 0,elements:void 0,buildCallback:function(t,n,a){return t?function(){var t=[];e.is(n,"function")&&(d.elements.defaultInput.isChecked()?t.push("default"):d.elements.templateInput.isChecked()&&t.push("template"),n.apply(null,t)),l.hide(!0)}:function(){e.is(a,"function")&&a.call(),l.hide(!0)}},buildModal:function(){var e,a,l,c,u,h=[];e=new o({name:"export",type:"radio",className:"primary default",value:"default",label:t.ucfirst(s.defaultDashboard),events:{onClick:d.toggle.bind(null,"default")}}),a=new n("p",{text:r.exportAsDefaultArea,class:"default-area"}),l=new o({name:"export",type:"radio",className:"primary template",value:"template",label:t.ucfirst(s.templateDashboard),events:{onClick:d.toggle.bind(null,"template")}}),c=new n("p",{text:r.exportAsTemplateArea,class:"template-area"}),h.push(e),h.push(a),h.push(l),h.push(c),u=new n("div",{html:h}),d.elements={defaultInput:e,templateInput:l,defaultArea:a,templateArea:c,body:u},h.length>0&&(h[0].check(),h[0].options.events.onClick()),d.superModal=new i({className:"export-modal",renderTo:document.body,closable:!0})},toggle:function(e){var t=d.elements;switch(e){case"default":t.templateArea.hide(),t.defaultArea.show();break;case"template":t.defaultArea.hide(),t.templateArea.show()}}},l={show:function(e){var t=[];d.buildModal(),t.push({className:"default",value:r.cancelBtn,action:d.buildCallback(!1,e.confirm,e.cancel)}),t.push({className:"primary",value:r.exportBtn,action:d.buildCallback(!0,e.confirm,e.cancel)}),d.superModal.dialog({body:d.elements.body,title:a.replace(r.exportTitle,{title:e.title}),buttons:t})},hide:function(e){d.superModal.modals.current.hide(),e&&d.superModal.destroy()}};return l}),define("DS/Dashboard/Models/Tab",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{title:"",order:void 0,wiId:void 0,wiData:{}},setup:function(e){},parse:function(e){}})}),define("DS/Dashboard/Utils",["UWA/Core","UWA/Utils","UWA/Class/Model","DS/Dashboard/Models/Member","DS/UWPClientCode/PublicAPI","DS/UWPClientCode/Data/Utils","DS/UWPClientCode/I18n","DS/UWPClientControls/Utils","DS/WebappsUtils/WebappsUtils","i18n!DS/Dashboard/assets/nls/environment"],function(e,t,n,a,i,o,r,s,d,l){"use strict";var c={breakpoints:{topbar:{tiny:550,small:700,medium:959,large:1356}},ignoredTenantSuffixesPattern:/WU$/,customRolePattern:/^RAP-.+/,buildPath:o.buildPath,apply:function(t,n,a,i){e.is(t,"function")&&(i?setTimeout(function(){t.apply(n,a)}):t.apply(n,a))},toQueryString:function(t,n){var a,i,o;return e.is(t,"string")?o=t:e.is(t.toQueryString,"function")?o=t.toQueryString():(o=[],Object.keys(t).forEach(function(r){a=t[r],n&&(r=n+"["+r+"]"),e.is(a)&&(e.is(a,"object")||e.is(a,"array")?i=e.Utils.toQueryString(a,r):e.is(a,"function")||(i=a?e.Utils.encodeUrl(r)+"="+e.Utils.encodeUrl(a):e.Utils.encodeUrl(r))),i&&o.push(i),i=void 0}),o=o.join("&")),o},getParsedQuery:function(e){var n,a="string"==typeof e?e:window.location.search||"";return delete(n=t.parseQuery(a))[""],n},getViolationMessageFromError:function(e){if(e&&e.violations)switch((e.violations[0]||{}).name){case"SafeHtmlJson":return l.editWidgetSafeHtmlJsonVioliation;default:return l.editWidgetGenericVioliation}},getHelpInfoPath:function(e){var t,n;if(n=((e.widget||{}).metas||{}).helpPath,t=e.embedded&&e.embedded.url||"",n){var a=0!==n.indexOf("http"),i=a&&function(e){if(!e)return d.getWebappsBaseUrl();var t=e.substring(0,e.indexOf("/webapps/"));return t=t?t+"/webapps":""}(t);if(a&&!i)return"";var o=[n,"/help_en.json"];a&&o.unshift(i),n=c.buildPath.apply(null,o)}else{if(!t)return"";var r=t.substring(0,t.lastIndexOf("/"));if(!r)return"";n=c.buildPath(r,"/assets/help/help_en.json")}return n},formatUrl:function(e){if(!(e=(e||"").trim())||e.test(/^\/\//))return e;var t=new RegExp("^.+?:"),n=e.match(t),a=n&&(n[0]||"").toLowerCase();return!a||["javascript:"].indexOf(a)>=0?"http://"+e:e.replace(t,a)},sanitizeMapping:function(e,t){var a={};return Object.keys(t).forEach(function(i){var o=t[i];a[i]="function"==typeof o?function(){if(!this||(!(this instanceof n)||this instanceof e)&&(!this.model||this.model instanceof e))return o.apply(this,arguments)}:o}),a},getStrongerAccessRight:function(e){return(e=e.map(function(e){return e.role.toLowerCase()})).indexOf(a.OWNER_ROLE)>=0?a.OWNER_ROLE:e.indexOf(a.CONTRIBUTOR_ROLE)>=0?a.CONTRIBUTOR_ROLE:a.READER_ROLE},isEditionFriendlyDevice:function(){return Math.min(document.documentElement.clientWidth,document.documentElement.clientHeight)>1280||!s.hasTouch()},formatDate:function(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")},cloneDeep:function(e){return JSON.parse(JSON.stringify(e))},localeCompare:function(e,t,n){return n=n||r.getCurrentLanguage(),r.getDebugLanguages()[n]&&(n="en"),e.localeCompare(t,n)},getRegisteredWidgetInstance:function(t){return e.Widgets.instances.find(function(e){return e.id===t})},removeItems:function(e,t){return e.filter(function(e){return!t.includes(e)})}};return c}),define("DS/Dashboard/Navigation",["UWA/Core","DS/UWPClientCode/Navigation","DS/Dashboard/Utils"],function(e,t,n){"use strict";var a,i=[],o=["debug","lang","addinmode","swamode","lockedapp","belayouteditor"];function r(e){return a.getUrlParameter(e)}function s(){return"PATH"===t.navigationMode}return a={firstPart:"dashboard",modes:{debug:"debug",addinmode:"addinmode",lockedapp:"lockedapp",swamode:"swamode",belayouteditor:"belayouteditor"},parts:{east:"east",cockpit:"cockpit",dashboard:"dashboard",tab:"tab",app:"app",story:"story",notification:"notification",sidepanel:"sidepanel",content:"content",manage:"manage",fullscreen:"fullscreen"},init:function(){a.getUrlParameter=t.getUrlParameter.bind(t)},start:function(){t.routeTo(a.firstPart+(s()?a.buildQueryParams():""))},routeTo:function(n){n=n||{};var i=a.buildRoute(e.merge(n,{excludeNavChar:!0,outside:n.outside||a.isAddinMode()})),o=s(),r=a.buildQueryParams({add:n.params,remove:n.paramsToRemove});t.routeTo(i),!o&&r&&i&&(window.location.search=r),n.reload&&window.location.reload()},logout:function(e){window.location.assign(a.buildLogoutUrl(window.location.href,e||{}))},hasPart:function(e){return t.getCurrentAdress().some(function(t){return t.name===e})},getContentDecodedParameter:function(){var e=r(a.parts.content);return e?n.getParsedQuery("?"+e):null},getAppDecodedParameter:function(){return decodeURIComponent(r(a.parts.app))},getSidepanelDecodedParameter:function(){return decodeURIComponent(r(a.parts.sidepanel))},getPlatformManagementId:function(){return"e88a79f9-b86c-449d-b438-dca5445d4a9b"},getMembersManagementId:function(){return"e88a79f9-b86c-449d-b438-dca5445d4a9c"},getAddinModeValue:function(){var e=n.getParsedQuery(),t=e.addinmode;return a.isSWAMode()?{value:"catiav5"}:"addinmode"in e?{value:t||"catiav5"}:void 0},isAddinMode:function(){return!!a.getAddinModeValue()},isLockedAppMode:function(){return"true"===n.getParsedQuery().lockedapp},isBELayoutEditorMode:function(){return"belayouteditor"in n.getParsedQuery()},isSWAMode:function(){return"swamode"in n.getParsedQuery()},buildBaseUrl:function(e){return e=e||{},n.buildPath(window.dsBaseUrl,e.path)+a.buildQueryParams({params:e.params,add:e.paramsToAdd,remove:e.paramsToRemove})},buildQueryParams:function(t){var a={},i="",r=(t=t||{}).add,d=t.remove,l=t.params||n.getParsedQuery();return l||r||d?(l&&(s()?o.forEach(function(e){l.hasOwnProperty(e)&&(a[e]=l[e])}):a=l),a=r?e.merge(r,a):a,d&&Object.keys(a).forEach(function(e){d.hasOwnProperty(e)&&!0===d[e]&&delete a[e]}),(i=n.toQueryString(a))?"?"+i:""):i},buildLogoutUrl:function(e,t){var n={redirectUrl:e};return(t=t||{}).resetLogin&&(n.reset_login=!0),a.buildBaseUrl({path:"logout",params:n})},buildAppUrl:function(e){var t,n=e.data;return n&&(t=Object.keys(n).length?encodeURIComponent(JSON.stringify(n)):""),a.buildBaseUrl({params:e.params,paramsToAdd:e.paramsToAdd,paramsToRemove:e.paramsToRemove})+(s()?"/":"#")+"app:"+e.appId+(t?"/content:URLTransientData="+t:"")},buildSWAUrl:function(e){return a.buildAppUrl({appId:e.appId,params:e.params,paramsToAdd:Object.assign({addinmode:!0,swamode:!0,wii:e.widgetId},e.paramsToAdd),paramsToRemove:e.paramsToRemove})},buildRoute:function(o){o=o||{};var d,l,c,u=s(),h=b(o.keeps),m=b(o.discards),g="",f=[],p=a.firstPart;function b(t){return(e.is(t,"string")?[t]:t)||[]}return"east"===p&&(m.push("tab"),delete o.tab,m.push("dashboard"),o.dashboard&&(o.cockpit=o.dashboard,delete o.dashboard)),m=m.filter(function(e){return n=e,a=t.getCurrentAdress(),i=!1,a.forEach(function(e){n===e.name&&(i=!0)}),i;var n,a,i}),d=-1!==m.indexOf("app")||-1!==m.indexOf("sidepanel"),l=u?function(e,t){f=f.concat(e,t)}:function(e,t){f.push(e+":"+t)},i.forEach(function(e){var t=o[e]||function(e){return!o.keepAll&&-1===h.indexOf(e)||-1!==m.indexOf(e)?null:r(e)}(e);!t||"content"===e&&d||l(e,t)}),g=f.join("/"),o.outside||(g=g?RegExp("^"+p,"g").test(g)?g:n.buildPath(p,g):p),c=a.buildQueryParams({add:o.params,remove:o.paramsToRemove}),g+=u?c:"",o.excludeNavChar||(g=(u?"/":"#")+g),g}},i=function(){var e,t=a.parts,n=[];for(e in t)t.hasOwnProperty(e)&&n.push(t[e]);return n}(),a}),define("DS/Dashboard/Navigation/App",["UWA/Promise","DS/Dashboard/Navigation"],function(e,t){"use strict";return{isAccessible:function(){return t.isAddinMode()||t.routeTo({keepAll:!0}),e.resolve(!0)}}}),define("DS/Dashboard/Navigation/Story",["UWA/Promise","DS/Dashboard/Navigation"],function(e,t){"use strict";return{isAccessible:function(){return t.isAddinMode()||t.routeTo({keepAll:!0}),e.resolve(!0)}}}),define("DS/Dashboard/Navigation/Notification",["UWA/Promise","DS/Dashboard/Navigation"],function(e,t){"use strict";return{isAccessible:function(){return t.routeTo({keepAll:!0}),e.resolve(!0)}}}),define("DS/Dashboard/Navigation/SidePanel",["UWA/Promise","DS/Dashboard/Navigation"],function(e,t){"use strict";return{isAccessible:function(){return t.routeTo({keepAll:!0}),e.resolve(!0)}}}),define("DS/Dashboard/UserPlatformAccess",["UWA/Core","UWA/Utils","UWA/Promise","UWA/Json","UWA/Array","DS/WebappsUtils/Performance","DS/WAFData/WAFData","DS/PubSub/PubSub","DS/UWPClientControls/PlatformNotify","DS/UWPClientCode/PublicAPI","DS/UWPClientControls/Modal","DS/UWPClientCode/I18n","DS/i3DXCompass/ServiceApi/UserStartupApi","DS/Dashboard/Utils","DS/Dashboard/Navigation","DS/Dashboard/CompassManager","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b){"use strict";var v,w,D,_="/resources/AppsMngt/",C="swymlang",I=null,S=null,y=null,E=null,T=[],A=[],P=null,x={},M=n.deferred(),k=M.promise;function N(e,n){return m.buildPath(v.getMyAppsBaseUrl(),_,e)+(n?"?"+t.toQueryString(n):"")}function W(){var e,t,n=C,a=[];return e=null,t=document.cookie.split(";"),(a=t.filter(function(e){return e.toLowerCase().indexOf(n.toLowerCase())>=0})).length>0&&(e=a[0].split("=")[1]),e||window.dsLang||navigator.language.split("-")[0]}function L(){return"startup@"+window.location.host+"@"+window.dsUserLogin}function U(){var e=window.localStorage.getItem(L());try{e=a.decode(e)}catch(t){e=null}return e}function O(e){try{window.localStorage.setItem(L(),a.encode(e))}catch(e){}}function F(){window.localStorage.removeItem(L())}function B(t){function i(t){var n,i,r,s=t.data||{};if(t.fail||(n=s,r=!0,i=e.is(n.success)?n.success:n.message,e.is(i)?["true","Success"].indexOf(i.toString())<0&&(r=!1):r=!1,!r))return!t.cacheUsed&&U()&&(F(),o()),t.isOk=!1,t;if(!t.cacheUsed){var d=function(e){var t;try{t=a.encode(e)}catch(e){t=null}return t!==(window.localStorage.getItem(L())||t)}(s);O(s),d&&o()}return t.isOk=!0,t}function o(){setTimeout(function(){window.location.reload()},200)}return t=t||{},new n(function(e){var n,a=!1;(n=U())&&(a=!0,e({data:n,cacheUsed:!0})),h.fetch({platform:t.noPlatform?void 0:w._getGlobalPlatformId(),config:{myAppsBaseUrl:v.getMyAppsBaseUrl(),userId:window.dsUserExternalId,lang:S||W()},onComplete:function(t){var n={data:t};a?i(n):e(n)},onFailure:function(t){var n={fail:!0,data:t};a?i(n):e(n)}})}).then(i).then(function(e){var t,n=e.data||{};return e.isOk?(A=[],x=n,y=!0,E=n.admin,T=n.swym,P={tos:n.legal,count:(n.legal||[]).length},n.ko&&d.warn(b.platformMakingError),n.message&&d.warn(n.message),M.resolve(),{granted:!0}):(n.message&&(t=n.message),{granted:!1,msg:t,startupCode:n.code})}).then(function(e){return!1===e.granted?e:(t.noPlatform?v.fetchUserRolesAllPlatforms():v.fetchUserRoles()).then(function(t){return t.filter(function(e){return"IFW"===e.id}).length?e:{granted:!1,showPublicCompass:g.isAddinMode()}})}).catch(function(e){return n.reject(e)})}return v={init:function(){w=require("DS/Dashboard/PublicAPI"),S=W(),D=(l.getApplicationConfiguration("app.urls.myapps")||"").replace(/\/$/g,""),I=l.getApplicationConfiguration("app.urls.tagging_collab"),s.add(w.events.license.error,v.showGrantingError)},getMyAppsBaseUrl:function(){if(!D)throw"myApps Server url not available.";return D},getTagsServicesBaseUrl:function(){if(!I)throw"Tags Server url not available.";return I},fetchUserAdmin:function(){return k.then(function(){return E})},getSwymTenants:function(){return T},fetchUserLegal:function(){return k.then(function(){return P})},fetchUserStartupParams:function(){return k.then(function(){return x})},fetchAppUrlById:function(e,t,n){r.authenticatedRequest(N("apps/?id="+e),{type:"json",onComplete:t,onFailure:n})},fetchUserRoles:function(){return A.length?n.resolve(A):v.fetchUserStartupParams().then(function(e){var t,n=w._getGlobalPlatformId(),a=m.cloneDeep(e.roles||[]),i={};return a.forEach(function(e){var t=e.platform;t===n&&e.roles.forEach(function(e){var n=e.id;i[n]?i[n].platforms.push(t):i[n]={name:e.name,default:e.default,platforms:[t]}})}),t=Object.keys(i).map(function(e){var t=i[e];return{id:e,name:t.name,default:t.default,platforms:t.platforms}}),A=t,t})},fetchUserRolesAllPlatforms:function(){return v.fetchUserStartupParams().then(function(e){var t=[],n=m.cloneDeep(e.roles||[]);return n.forEach(function(e){t.push.apply(t,e.roles.filter(function(e){return-1===t.map(function(e){return e.id}).indexOf(e.id)}))}),t.forEach(function(e){var t=e.id;e.platforms=[],n.forEach(function(n){var a=n.platform;n.roles.find(function(e){return e.id===t})&&e.platforms.push(a)})}),t})},getUserRoles:function(){return A||[]},getRoleName:function(e){var t;return(t=i.detect(A,function(t){return t.id===e}))&&t.name},addFirstManager:function(t){return F(),new n(function(e){var n=N("environment/addfirstmanager",{token:t});r.authenticatedRequest(n,{type:"json",headers:{"Accept-Language":S||W()},cache:-1,onComplete:function(t){e({data:t})},onFailure:function(t){e({fail:!0,data:t})}})}).then(function(t){var n,a=t.data||{};return(t.fail||e.is(a.code,"number")&&0!==a.code||e.is(a.error))&&(n=a.message||a.error),{msg:n,warnMsg:a.ko?b.platformMakingError:""}}).then(function(e){return v.checkUserGranted({noPlatform:!w._isPlatformAwareUrl()}).then(function(t){return t.admin=E,t.msg=e.msg||t.msg,e.warnMsg&&(t.msg=t.msg||e.warnMsg),t})}).then(function(e){return e.granted?new n(function(t,n){l.getUserAsync({serviceName:w._getServiceName(),retryNumber:20,success:function(){t(e)},failure:n})}):e})},checkUserGranted:function(e){return e=e||{},o.mark("ifwe_userplatformaccess_checkUserGranted"),B(e)},showGrantingError:function(t){var n=e.createElement("div",{class:"ifwe-dialog-background",html:[{tag:"div",class:"ifwe-dialog-logo"},{tag:"div",class:"message message-main",text:b.AccessDeniedBody},{tag:"div",class:"message message-secondary",html:[{tag:"div",text:t||u.replace(b.loggedUserMessage,{UserLogin:window.dsUserLogin}),styles:{"max-height":"120px","padding-bottom":"3px"}},{tag:"div",text:b.logoutLink,styles:{color:"#E7E9E9",cursor:"pointer","text-decoration":"underline"},events:{click:function(){p.track({category:"dashboard.accessDeniedModal",action:"logoutLink"}),g.logout({resetLogin:!0})}}}]}]});new c({title:b.AccessDeniedTitle,content:n,display:!0,closable:!1,className:"ifwe-about-dialog",displayFooter:!0,events:{onShow:function(){p.track({category:"dashboard.accessDeniedModal",action:"open"})}}})},redirectToRightGrantingError:function(e){(e=e||{}).showPublicCompass||(null==e.startupCode||1===e.startupCode)&&g.isAddinMode()?v.showPublicCompass(e.msg):v.showGrantingError(e.msg)},showPublicCompass:function(){window.location.replace(m.buildPath(v.getMyAppsBaseUrl(),"webapps/i3DXCompassStandalone/i3DXCompassStandalone.html"+(window.location.search||"")))},setUserLegal:function(e,t,n){e&&Array.isArray(e)&&r.authenticatedRequest(N("user/setlegal"),{method:"POST",type:"json",data:{envids:e.join(",")},onComplete:t,onFailure:n,cache:-1})},updateStartupCache:function(e){e=e||{};var t=U();t&&("boolean"==typeof e.coachmarkDNSA&&(t.showCoachmark=!e.coachmarkDNSA),e.legal&&(t.legal=e.legal),O(t))},clearStartupCache:F,isUserGranted:function(){return y},isInvitationOnShareByEmailConfigEnabled:function(e){return e=e||{},f.getPlatformConfig({key:"share",platformId:e.platformId||w._getGlobalPlatformId()}).then(function(e){return!!e})},sendPlatformInvitations:function(e){return v.isInvitationOnShareByEmailConfigEnabled().then(function(t){return t?function(e){return new n(function(t,n){function a(e){var t=(e||{}).message;n({message:t||b.errorTryLater})}var i=m.buildPath(D,_,"platform/invitemember");r.authenticatedRequest(i,{data:{platform:w._getGlobalPlatformId(),emails:e.join(",")},method:"POST",type:"json",onComplete:function(e){if(0!==(e=e||{}).code)return a(e);t()},onFailure:a})})}(e):{message:b.invitationNotAllowed}})},updatePlatformName:function(e,t){v.getSwymTenants().forEach(function(n){n.id===e&&(n.displayName=t)})}}}),define("DS/Dashboard/Navigation/PlatformManagement",["UWA/Core","UWA/Promise","DS/UWPClientControls/PlatformNotify","DS/Dashboard/UserPlatformAccess","DS/Dashboard/Navigation","DS/Dashboard/UIKITUtils","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r){"use strict";function s(e){return e.granted?(i.start(),e.msg&&n.warn(e.msg),t.resolve(!0)):d(e)}function d(e){return a.redirectToRightGrantingError(e),t.resolve(!1)}return{isAccessible:function(){return(n=i.getUrlParameter("myapps"))?(o.maskBody(r.firstManagerProcessMessage),a.addFirstManager(n).then(s).catch(d)):new t(function(t){a.fetchUserAdmin().then(function(n){var i=s({granted:a.isUserGranted(),admin:n});t(!e.is(i._result)||i._result)})});var n}}}),define("DS/Dashboard/Models/Dashboard",["UWA/String","UWA/Class/Model","DS/Dashboard/Models/Member"],function(e,t,n){"use strict";function a(t){return-1===t.search(/[<>]/)?t:e.escapeHTML(t)}return t.extend({idAttribute:"contextId",defaults:{title:"",wiId:void 0,wiData:{},modelId:void 0,contextId:void 0,owner:!1,access:void 0,deletionDate:void 0,creationDate:void 0,lastUpdate:void 0,membersCount:0,templateId:void 0,thumbnail:void 0,roles:[],role:"",description:"",_originalRoleBeforeTrashed:void 0},setup:function(e){e=e||{},this.actions=e.actions;var t=this.get("title")||this.defaults.title;Object.defineProperty(this._attributes,"title",{get:function(){return t},set:function(e){t=a(e)}})},parse:function(e){var t=((e=e||{}).role||"").toLowerCase()||(e.owner?n.OWNER_ROLE:n.READER_ROLE);return{title:a(e.name),modelId:e.modelId,contextId:e.contextId,access:e.access,templateId:e.template,thumbnail:e.thumbnail,owner:e.owner,membersCount:e.membersCount||0,roles:e.roles||[],role:t,description:e.data.description||"",deletionDate:e.deletionDate,creationDate:e.creationDate,lastUpdate:e.lastUpdate||e.creationDate,_originalRoleBeforeTrashed:e._originalRoleBeforeTrashed,type:e.type}},getRole:function(){return this.get("role")},getDescription:function(){return this.get("description")},isOwner:function(){return!(!this.get("owner")&&"owner"!==this.get("role"))},getDeletionDate:function(){return this.get("deletionDate")},getCreationDate:function(){return this.get("creationDate")},getLastUpdateDate:function(){return this.get("lastUpdate")},getOriginalRoleBeforeTrashed:function(){return this.get("_originalRoleBeforeTrashed")},getType:function(){return this.get("type")}})}),define("DS/Dashboard/Collections/DashboardsAbstract",["UWA/Class/Collection","DS/Dashboard/Utils"],function(e,t){"use strict";return e.extend({filterDashboards:function(e){var t=[],n=((e=e||{}).search||"").toLowerCase(),a=(e.accessRights||"").toLowerCase(),i=(e.type||"").toLowerCase();return n&&a&&i?t=this.filter(function(e){return e.get("title").toLowerCase().indexOf(n)>-1}).filter(function(e){return e.get("role").toLowerCase().indexOf(a)>-1}).filter(function(e){return e.get("type").toLowerCase().indexOf(i)>-1}):n?t=this.filter(function(e){return e.get("title").toLowerCase().indexOf(n)>-1}):a?t=this.filter(function(e){return e.get("role").toLowerCase().indexOf(a)>-1}):i?t=this.filter(function(e){return e.get("type").toLowerCase().indexOf(i)>-1}):t},sortDashboards:function(e){var n=(e=e||{}).direction,a=e.field;return n||a?(this.comparator=function(e,i){var o,r=e.get(a),s=i.get(a);return o="title"===a||"role"===a?t.localeCompare(r,s):r<s?-1:r>s?1:0,"desc"===n&&(o=-o),o},this.sort()):this}})}),define("DS/Dashboard/Views/AbstractSearchIn",["UWA/Class/View","DS/PubSub/PubSub","DS/Dashboard/Views/SearchInput","DS/Dashboard/UsageTracker"],function(e,t,n,a){"use strict";return e.extend({tagName:"div",_classes:{hasFocus:"has-focus"},_events:{onShow:function(){},onHide:function(){},onSearch:function(){},onClear:function(){},onClose:function(){}},_isVisible:!1,_from:null,_targetName:null,_targetId:null,_trackerType:null,setup:function(e){this._events=Object.assign({},this._events,e.events||{}),this._from=e.from,this._targetName=e.targetName,this._targetId=e.targetId,this._trackerType=e.trackerType||"",this.options.value=e.value||""},destroy:function(){this._events=null,this._isVisible=null,this._from=null,this._targetName=null,this._targetId=null,this._parent.apply(this,arguments)},render:function(e){e=e||{};var t=this.elements;return t.searchInput=new n({inputTextPlaceholder:e.inputTextPlaceholder||"",dense:e.dense,elevated:e.elevated,value:this.options.value,events:{onSearch:this._onSearch.bind(this),onClear:this._onClear.bind(this),onClose:this._onClose.bind(this),onFocus:this._onFocus.bind(this),onBlur:this._onBlur.bind(this)}}),t.searchInput.render().inject(this.container),this},show:function(){return this._isVisible?this:(this.container.show(),this._isVisible=!0,this.focus(),this._events.onShow(),a.track({category:"searchIn."+this._trackerType,action:"show"}),this)},hide:function(){return this._isVisible?(this.container.hide(),this._isVisible=!1,this._events.onHide(),a.track({category:"searchIn."+this._trackerType,action:"hide"}),this):this},close:function(e){return this._onClose(e),this},getValue:function(){return this._getSearchInput().getValue()},setValue:function(e){return this._getSearchInput().setValue(e),this},hasLastSearch:function(){return this._getSearchInput().hasLastSearch()},focus:function(){return this._getSearchInput().focus(),this},search:function(){return this._getSearchInput().search(),this},isVisible:function(){return this._isVisible},_getSearchInput:function(){return this.elements.searchInput},_dispatchSearchQueryEvent:function(e){var n={from:this._from,query:e||"",clear:!e};this._targetName&&this._targetId&&(n[this._targetName]=this._targetId),t.dispatch(t.events.searchQuery,n,!1)},_onSearch:function(){this._dispatchSearchQueryEvent(this._getSearchInput().getValue()),this._events.onSearch(),a.track({category:"searchIn."+this._trackerType,action:"search"})},_onClear:function(){this.hasLastSearch()&&this._dispatchSearchQueryEvent(""),this._events.onClear(),a.track({category:"searchIn."+this._trackerType,action:"clear"})},_onClose:function(e){e=e||{},this._getSearchInput().clear({noFocus:!0,silent:e.silent}),!e.silent&&this._events.onClose(),this.hide(),a.track({category:"searchIn."+this._trackerType,action:"close"})},_onFocus:function(){this.container.addClassName(this._classes.hasFocus)},_onBlur:function(){this.container.removeClassName(this._classes.hasFocus)}})}),define("DS/Dashboard/DDMenu/Abstract",["UWA/Class","DS/UIKIT/DropdownMenu","DS/UWPClientControls/Utils","DS/Dashboard/Utils","DS/Dashboard/Navigation","i18n!DS/Dashboard/assets/nls/dd_menu"],function(e,t,n,a,i,o){"use strict";var r=function(){},s={id:"searchInWidget",name:"searchInWidget",text:o.searchInWidget,className:"search-in-widget-item",icon:"search-in-widget-icon fonticon fonticon-search"},d={id:"preferences",name:"preferences",text:o.preferences,className:"preferences-item",icon:"preferences-icon fonticon fonticon-cog"},l={id:"linkWithWidgets",name:"linkWithWidgets",text:o.linkWithWidgets,className:"link-with-widgets-item",icon:"link-with-widgets-icon fonticon fonticon-link"},c={id:"share",name:"share",text:o.share,className:"share-item",icon:"share-icon fonticon fonticon-forward"},u={id:"comment",name:"comment",text:o.comment,className:"comment-item",icon:"fonticon fonticon-comment"},h={id:"duplicate",name:"duplicate",text:o.duplicate,className:"duplicate-item",icon:"duplicate-icon fonticon fonticon-docs"},m={id:"refresh",name:"refresh",text:o.refresh,className:"refresh-item",icon:"refresh-icon refresh-icon fonticon fonticon-refresh"},g={id:"enterMaximize",name:"enterMaximize",text:o.maximize,className:"enter-maximize-item",icon:"maximize-icon fonticon fonticon-resize-full"},f={id:"leaveMaximize",name:"leaveMaximize",text:o.restore,className:"leave-maximize-item",icon:"maximize-icon fonticon fonticon-resize-small"},p={id:"delete",name:"delete",text:o.remove,className:"delete-item",icon:"delete-icon fonticon fonticon-trash"},b={id:"edit",name:"edit",text:o.edit,className:"edit-item",icon:"edit-icon fonticon fonticon-pencil"},v={id:"help",name:"help",text:o.help,className:"help-item",icon:"help-icon fonticon fonticon-3ds-why"},w={id:"showSWAQRCode",name:"showSWAQRCode",text:o.showSWAQRCode,className:"show-swa-qrcode-item",icon:"swa-qrcode-icon fonticon fonticon-tablet"},D={id:"openSWA",name:"openSWA",text:o.openSWA,className:"open-swa-item",icon:"open-swa-icon fonticon fonticon-window"},_={id:"story",name:"story",text:o.story,className:"story-item",icon:"story-icon fonticon fonticon-play"},C={id:"beUsage",name:"beUsage",text:o.beUsage,className:"be-usage-item",icon:"be-usage-icon fonticon fonticon-attributes"},I={id:"manage",name:"manage",text:i.isBELayoutEditorMode()?o.manageBE:o.manage,className:"manage-item",icon:"manage-icon fonticon fonticon-cog"},S={id:"unshare",name:"unshare",text:o.unshare,className:"unshare-item",icon:"unshare-icon fonticon fonticon-role-delete"},y=e.extend({destroyed:!1,DEFAULT_ITEMS_STATES:{hide:!0,disabled:!1},_menu:null,_menuStates:{allItemsDisabled:!1},_items:[],_itemsStates:{},_itemsHandlers:{},_itemsChild:{},_itemsMap:{},_events:{onClick:null,onShow:null,onHide:null},_target:null,init:function(e){var a,i=this;i.DEFAULT_ITEMS_STATES=Object.assign({},i.DEFAULT_ITEMS_STATES),i._menuStates=Object.assign({},i._menuStates),i._items=Object.assign([],i._items),i._itemsMap={},i._itemsStates={},i._itemsHandlers={},i._itemsChild={},i._events={},i._events.onClick=e.onClick||r,i._events.onShow=e.onShow||r,i._events.onHide=e.onHide||r,i._target=e.target,a={className:["ifwe-dd-menu",e.className||""].join(" "),renderTo:e.renderTo||document.body,target:i._target,position:e.position||"bottom left",offset:e.offset||{x:0,y:0},items:[],contextual:"boolean"==typeof e.contextual&&e.contextual,bound:"boolean"!=typeof e.bound||e.bound,closeOnClick:"boolean"!=typeof e.closeOnClick||e.closeOnClick,removeOnHide:"boolean"!=typeof e.removeOnHide||e.removeOnHide,responsiveMode:"boolean"!=typeof e.responsiveMode||e.responsiveMode,scrollMode:"boolean"!=typeof e.scrollMode||e.scrollMode,events:{onClick:i._onClick.bind(i),onShow:i._onShow.bind(i),onHide:i._onHide.bind(i)}},i._menu=new t(a),i._items.forEach(function(e){i._itemsMap[e.id]=Object.assign({},e),i._itemsStates[e.id]=Object.assign({},i.DEFAULT_ITEMS_STATES)}),i._updateMenuItemsDebounced=n.debounce(i._updateMenuItems.bind(i),300),i._updateMenuItems()},getItem:function(e){return this._itemsMap[e]},hasItem:function(e){return!!this.getItem(e)},hasChildren:function(e){return!!this._itemsChild[e]},isItemShown:function(e){return this.hasItem(e)&&!this._itemsStates[e].hide},showItem:function(e){this.hasItem(e)&&!this.isItemShown(e)&&(this._itemsStates[e].hide=!1,this._updateMenuItemsDebounced())},showItems:function(e){e.forEach(this.showItem,this)},hideItem:function(e){this.hasItem(e)&&this.isItemShown(e)&&(this._itemsStates[e].hide=!0,this._menu.removeItem(e))},hideItems:function(e){e.forEach(this.hideItem,this)},addItem:function(e,t){var n,a,i,o,r=e.id||e.name,s=e.handler,d=e.parentItemId;if(!r)throw new Error("Missing item id.");if(d&&!this.hasItem(d))throw new Error("No parent item id found:"+d);this.hasItem(r)&&this.removeItem(r),!(o=d?this._itemsChild[d]:this._items)&&d&&(o=this._itemsChild[d]=[]),n=o.length,a={parentItemId:d,id:r,name:e.name||r,text:e.text||"",icon:e.icon,fonticon:e.fonticon,className:e.className,title:e.title},((i="number"==typeof t?t:n)<0||i>o.length)&&(i=n),o.splice(i,0,a),this._itemsMap[r]=a,this._itemsStates[r]=Object.assign({},this.DEFAULT_ITEMS_STATES,{hide:"boolean"==typeof e.hide&&e.hide,disabled:"boolean"==typeof e.disabled&&e.disabled}),this._itemsHandlers[r]=s,this._updateMenuItemsDebounced()},addItems:function(e,t){var n="number"==typeof t;e.forEach(function(e,a){this.addItem(e,n?t+a:void 0)},this)},removeItem:function(e){var t=this,n=(t.getItem(e)||{}).parentItemId,a=n?t._itemsChild[n]||[]:t._items;(t._itemsChild[e]||[]).forEach(function(e){var n=e.id;t._itemsChild[n]&&t.removeChildrenItems(n),t.removeItem(n)}),delete t._itemsMap[e],delete t._itemsStates[e],delete t._itemsHandlers[e],a=a.filter(function(t){return t.id!==e}),n?a.length?t._itemsChild[n]=a:delete t._itemsChild[n]:t._items=a,t._menu.removeItem(e)},removeItems:function(e){e.forEach(this.removeItem,this)},removeChildrenItems:function(e){var t=this;t.hasItem(e)&&(t._itemsChild[e]||[]).forEach(function(e){t.removeItem(e.id)})},keepItems:function(e){var t=this;t._items.forEach(function(n){e.includes(n.id)||t.removeItem(n.id)})},disableItem:function(e){this.hasItem(e)&&!this._itemsStates[e].disabled&&(this._itemsStates[e].disabled=!0,this._menu.disableItem(e),this.hasChildren(e)&&this._updateMenuItemsDebounced())},disableItems:function(e){e.forEach(this.disableItem,this)},enableItem:function(e){this.hasItem(e)&&this._itemsStates[e].disabled&&(this._itemsStates[e].disabled=!1,this._menuStates.allItemsDisabled||(this._menu.enableItem(e),this.hasChildren(e)&&this._updateMenuItemsDebounced()))},enableItems:function(e){e.forEach(this.enableItem,this)},setAllItemsDisabled:function(){var e=this;!0!==e._menuStates.allItemsDisabled&&(e._menuStates.allItemsDisabled=!0,e._menu.items.forEach(function(t){e._menu.disableItem(t.id)}),Object.keys(e._itemsChild).length&&e._updateMenuItemsDebounced())},unsetAllItemsDisabled:function(){var e=this;!1!==e._menuStates.allItemsDisabled&&(e._menuStates.allItemsDisabled=!1,e._menu.items.forEach(function(t){!e._itemsStates[t.id].hide&&e._menu.enableItem(t.id)}),Object.keys(e._itemsChild).length&&e._updateMenuItemsDebounced())},setItemHandler:function(e,t){this.hasItem(e)&&(this._itemsHandlers[e]=t,this._updateMenuItemsDebounced())},hide:function(){this._menu.isVisible&&this._menu.hide()},destroy:function(){this._menuStates=null,this._items=null,this._itemsChild=null,this._itemsMap=null,this._itemsStates=null,this._itemsHandlers=null,this._menu&&this._menu.destroy(),this._menu=null,this._events=null,this._target=null,this.destroyed=!0},_getItems:function(){var e,t=this;return e=Object.values(t._itemsChild).reduce(function(e,t){return e.concat(t)},[]),a.cloneDeep(t._items.concat(e)).map(function(e){var n=t._itemsHandlers[e.id];return n&&(e.handler=n),e})},_removeAllItems:function(){var e=this;e._menu.items.map(function(e){return e.id}).forEach(function(t){e._menu.removeItem(t)})},_updateMenuItems:function(){if(!this.destroyed){var e=this,t=e._getItems();e._removeAllItems(),t=t.filter(function(t){return!function t(n){var a,i,o=n.parentItemId,r=e._itemsStates[n.id];return o?(i=e._itemsMap[o],a=e._itemsStates[o],r.hide||a.hide||a.disabled||t(i)):r.hide}(t)}).map(function(t){return t.disabled=e._menuStates.allItemsDisabled||e._itemsStates[t.id].disabled,t}),e._menu.addItem(t)}},_onShow:function(){this._target.addClassName("active"),this._events.onShow.apply(this._menu,arguments)},_onHide:function(){this._target.removeClassName("active"),this._events.onHide.apply(this._menu,arguments)},_onClick:function(){this._events.onClick.apply(this._menu,arguments)}});return y.NOT_CLICKABLE_CLASS="not-clickable",y.SEARCH_IN_WIDGET_ITEM=s,y.PREFS_ITEM=d,y.LINK_WITH_WIDGETS_ITEM=l,y.SHARE_ITEM=c,y.COMMENT_ITEM=u,y.DUPLICATE_ITEM=h,y.REFRESH_ITEM=m,y.ENTER_MAXIMIZE_ITEM=g,y.LEAVE_MAXIMIZE_ITEM=f,y.DELETE_ITEM=p,y.EDIT_ITEM=b,y.HELP_ITEM=v,y.SHOW_SWA_QRCODE_ITEM=w,y.OPEN_SWA_ITEM=D,y.STORY_ITEM=_,y.BE_USAGE_ITEM=C,y.MANAGE_ITEM=I,y.UNSHARE_ITEM=S,y}),define("DS/Dashboard/Views/ImageUploadView",["UWA/Core","UWA/String","UWA/Class/View","UWA/Event","UWA/Data","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Image","DS/UWPClientControls/Utils","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n,a,i,o,r,s,d,l,c,u,h){"use strict";return n.extend({MAX_SIZE_IN_BYTES:0,className:"image-upload-form",tagName:"div",acceptedTypes:{},checkHexaTypes:!1,initialImageSrc:"",_file:null,_urlInputVal:"",_onKeyDownTimeout:0,_onDragLeaveTimeout:0,_showDrag:!1,_isBadUrl:!1,_onErrorState:!1,setup:function(e){var t=e.events,n=e.nls,a=e.trackers||{};this.MAX_SIZE_IN_BYTES=e.maxSizeInBytes,this.acceptedTypes=e.acceptedTypes,this.checkHexaTypes=e.checkHexaTypes,this.initialImageSrc=e.initialImageSrc,this.nls={emptyImagePreview:n.emptyImagePreview,acceptedFileTypesAndlimitFileSize:n.acceptedFileTypesAndlimitFileSize,limitFileSize:n.limitFileSize,wrongFileType:n.wrongFileType,urlPlaceholder:n.urlPlaceholder||h.urlPlaceholder,usePlatformSSO:n.usePlatformSSO||h.usePlatformSSO,browseBtn:n.browseBtn||h.browseBtn,applyBtn:n.applyBtn||h.applyBtn,resetBtn:n.resetBtn||h.resetBtn,dropFileHere:n.dropFileHere||h.dropFileHere,emptyFile:n.emptyFile||h.emptyFile,loadPreviewUrl:n.loadPreviewUrl||h.loadPreviewUrl,loadPreview:n.loadPreview||h.loadPreview,previewFromUrlError:n.previewFromUrlError||h.previewFromUrlError,previewError:n.previewError||h.previewError},this.events={onApply:t.onApply,onReset:t.onReset,onRestoreView:t.onRestoreView,onError:t.onError,onNoFileDropped:t.onNoFileDropped,onUploadValidImage:t.onUploadValidImage},this.trackers={browseFromPreview:a.browseFromPreview,browseFromBtn:a.browseFromBtn,fetchFileFromUrl:a.fetchFileFromUrl,dropUrl:a.dropUrl,dropFile:a.dropFile}},render:function(){var t,n,i,d,l,u,h,m,g,f,p=e.createElement,b=this,v=b.nls,w=b.elements,D=b.container,_=b._hasInitialImageSrc(),C="div";return(t=w.urlInput=new r({className:"url-input",placeholder:v.urlPlaceholder,attributes:{autofocus:!1}})).getContent().addEvents({input:c.debounce(b._onKeyDownUrlinput.bind(b),300),keydown:function(e){"Enter"===e.code&&(a.preventDefault(e),a.stopPropagation(e),clearTimeout(b._onKeyDownTimeout),b._onEnterKeydown())}}),m=w.isUrlAuthInput=new s({className:"primary",type:"checkbox",label:v.usePlatformSSO,events:{onChange:b._onInputUrlChange.bind(b)}}),g=w.isUrlAuthCtn=p(C,{class:"isurlauth-input-ctn",html:m}),f=w.browseBtn=new o({className:"default browse-btn",value:v.browseBtn,events:{onClick:function(){b._trackUsage(b.trackers.browseFromBtn),l.click()}}}),n=w.applyBtn=new o({className:"primary",value:v.applyBtn,disabled:!0,events:{onClick:b._onApply.bind(b)}}),i=w.resetBtn=new o({className:"default reset-btn",value:v.resetBtn,disabled:!_,events:{onClick:b._onReset.bind(b)}}),l=w.fileInput=p("input",{class:"file-input",type:"file",events:{change:function(){var e=l.files;e&&e.length&&b._onFileInputChange(e[0])}}}),d=w.thumbnailCtn=p(C,{class:"thumbnail-ctn show-default-thumb",html:[{tag:"div",class:"default-thumb image-thumb img-thumbnail",html:{tag:"div",class:"default-thumb-img",html:{tag:"span",class:"default-thumb-text",text:v.emptyImagePreview}}},{tag:"div",class:"error-thumb image-thumb img-thumbnail",html:{tag:"div",class:"default-thumb-img",html:{tag:"span",class:"error-thumb-text default-thumb-text"}}},{tag:"div",class:"img-thumb image-thumb"},{tag:"div",class:"upload-thumb image-thumb img-thumbnail",html:{tag:"div",class:"upload-thmub-img",html:{tag:"span",class:"fonticon fonticon-upload upload-icon"}}}],events:{click:function(){b._trackUsage(b.trackers.browseFromPreview),l.click()}}}),u=w.dropZone=p(C,{class:"upload-drop-zone",text:v.dropFileHere}),h=w.urlInputCtn=p(C,{class:"url-input-ctn",html:[t,f]}),w.elsCtn=p(C,{class:"upload-form-wrapper",html:[d,{tag:C,class:"right-els",html:[h,{tag:C,class:"file-constraint",text:v.acceptedFileTypesAndlimitFileSize},g,{tag:C,class:"btns",html:[n,i]}]},l]}),D.addContent([w.elsCtn,u]),D.addEventListener("dragenter",b._onDragOver.bind(b),!1),D.addEventListener("dragover",b._onDragOver.bind(b),!1),D.addEventListener("dragleave",b._onDragLeave.bind(b),!1),D.addEventListener("dragend",b._onDragEnd.bind(b),!1),D.addEventListener("drop",b._onDrop.bind(b),!1),_?b._setThumbnail(b.initialImageSrc):b._setDefaultThumbnail(),b},setInitialImageSrc:function(e){this.initialImageSrc=e,this._resetView({initialImageSrc:this.initialImageSrc})},destroy:function(){clearTimeout(this._onDragLeaveTimeout),clearTimeout(this._onKeyDownTimeout),this.acceptedTypes=null,this.checkHexaTypes=!1,this._file=null,this._parent.apply(this,arguments)},_maskThumbnail:function(e){e=e||this.nls.loadPreview,d.mask(this.elements.thumbnailCtn,e)},_unmaskThumbnail:function(){d.unmask(this.elements.thumbnailCtn)},_maskView:function(e){d.mask(this.container,e)},_unmaskView:function(){d.unmask(this.container)},_onDragEnd:function(e){a.stopPropagation(e),a.preventDefault(e),this._showDrag=!1,this.container.removeClassName("dragging")},_onDragOver:function(e){var t=this.elements,n=this.container,i=t.dropZone;n.addClassName("dragging"),this._showDrag=!0,e.target===i?i.addClassName("hover"):i.removeClassName("hover"),a.stopPropagation(e),a.preventDefault(e)},_onDragLeave:function(e){var t=this;a.stopPropagation(e),a.preventDefault(e),t._showDrag=!1,clearTimeout(t._onDragLeaveTimeout),t._onDragLeaveTimeout=setTimeout(function(){!t._showDrag&&t.container.removeClassName("dragging")},300)},_onDrop:function(e){var t,n,i,o,r=e.dataTransfer,s=r.files||[],d=s.length;if(this._onDragEnd(e),a.preventDefault(e),!d)for(t=r.getData("url"),i=r.types,n=0;!t&&n<i.length;n++)if("text/x-moz-url"===i[n]){t=r.getData("text/x-moz-url");break}return d||t?(t?(this._trackUsage(this.trackers.dropUrl),this.elements.urlInput.setValue(t),o=this._setFileFromUrl()):(this._trackUsage(this.trackers.dropFile),o=this._setFile(s[0])),o.then(this._unmaskThumbnail.bind(this))):(this.events.onNoFileDropped&&this.events.onNoFileDropped(),Promise.resolve())},_onFileInputChange:function(e){return this.elements.urlInput.setValue(e.name),this._setFile(e)},_checkFileSize:function(e){var t=(e||{}).size;return!!(t&&t<=this.MAX_SIZE_IN_BYTES)},_onError:function(e){e=e||{};var t=this.elements,n=e.msg||"";this._unmaskView(),this._unmaskThumbnail(),this._file=null,t.resetBtn.enable(),t.applyBtn.disable(),t.fileInput.value="",this._setErrorThumbnail(n),this._onErrorState=!0,this.events.onError&&this.events.onError(e)},_onInputUrlChange:function(){return this._setFileFromUrl().catch(function(){})},_onKeyDownUrlinput:function(){var e=this.elements,t=this._getUrlInputVal().trim();if(!t)return this.events.onRestoreView&&this.events.onRestoreView(),void this._resetView({initialImageSrc:this.initialImageSrc});e.applyBtn.enable(),e.resetBtn.enable(),this._urlInputVal!==t&&(this._urlInputVal=t,this._file=null,this._hasHttpsProtocol(t)?e.isUrlAuthCtn.show():e.isUrlAuthCtn.hide(),clearTimeout(this._onKeyDownTimeout),this._onKeyDownTimeout=setTimeout(this._onInputUrlChange.bind(this),2e3))},_onEnterKeydown:function(){var e,t=this,n=t._getUrlInputVal();return t.elements.urlInput.blur(),t._file&&t._urlInputVal===n?e=t._onApply():(t._urlInputVal=n,t._maskView(t.nls.loadPreviewUrl),e=t._setFileFromUrl().then(function(){return t._unmaskView(),t._onApply()}).catch(function(){})),e},_onApply:function(){var e,t=this,n=t.nls;function a(e){e&&t._resetView({initialImageSrc:t._file.src})}return t._file||(t._maskView(n.loadPreviewUrl),e=t._setFileFromUrl().then(t._unmaskView.bind(t)).catch(function(e){throw t._onError(e),new Error("Fail to set file from url.")})),e||t._file?(e=e||Promise.resolve()).then(function(){return(t.events.onApply?t.events.onApply(t._file):Promise.resolve(!0)).then(a)}).catch(function(){return a(!1)}):Promise.resolve()},_onReset:function(){var e,t=this,n=!1,a=t.events;function i(e){e&&t._resetView({initialImageSrc:n?null:t.initialImageSrc})}return t._file||t._onErrorState?(n=!1,a.onRestoreView&&a.onRestoreView(),e=Promise.resolve(!0)):(n=!0,e=a.onReset?a.onReset():Promise.resolve(!0)),e=e.then(i).catch(function(){return i(!1)})},_readFile:function(e){var t=this;return new Promise(function(n,a){var i,o,r=t.nls,s=Promise.resolve();return e||a({msg:r.emptyFile}),t._checkFileSize(e)?!!t.acceptedTypes[e.type]?(t.checkHexaTypes&&(s=t._getFileHexa(e).then(function(e){var n=Object.keys(t.acceptedTypes).filter(function(e){return t.acceptedTypes[e]});if(!t.getHexaMimeTypes(n).includes(e))return a({msg:r.wrongFileType})})),s=s.then(function(){(i=new FileReader).onload=function(t){e.src=t.target.result,n(e)},i.onerror=function(){a({msg:i.error})},i.readAsDataURL(e)})):a({msg:r.wrongFileType}):(o=0===e.size?r.emptyFile:r.limitFileSize,a({msg:o}))})},_setFile:function(e){var t=this;return t._maskThumbnail(),t._readFile(e).then(function(e){var n=t.elements,a=e.name;t._file=e,t._setThumbnail(e.src),t._urlInputVal=a,n.urlInput.setValue(a),n.applyBtn.enable(),n.fileInput.value="",t.events.onUploadValidImage&&t.events.onUploadValidImage()}).catch(t._onError.bind(t))},_setFileFromUrl:function(){var e=this;return new Promise(function(t,n){var a,o=e._getIsUrlAuthChecked();if(!(a=e.prettifyUrl(e._getUrlInputVal())))return n({msg:"empty url"});e._maskThumbnail(e.nls.loadPreviewUrl),e._isBadUrl=!1,i.request(a,{type:"blob",proxy:o?"passport":"",onComplete:function(n){return e._trackUsage(e.trackers.fetchFileFromUrl),n.name=a,e._setFile(n).then(t)},onFailure:function(t){e._isBadUrl=!0,t.msg=t.msg||e.nls.previewFromUrlError,t.code="onFailFetchUrl",e._onError(t),n(t)}})})},prettifyUrl:function(e){var t,n=new RegExp("https{0,1}://","i");return(t=(e=e.trim()).match(n)||"")&&(e=e.replace(n,t[0].toLowerCase())),e},_hideThumbnails:function(){["show-default-thumb","show-error-thumb","show-img-thumb"].forEach(function(e){this.removeClassName(e)},this.elements.thumbnailCtn)},_setDefaultThumbnail:function(){this._hideThumbnails(),this.elements.thumbnailCtn.addClassName("show-default-thumb"),this._unmaskThumbnail()},_setErrorThumbnail:function(e){var t=this.elements.thumbnailCtn;this._hideThumbnails(),t.addClassName("show-error-thumb"),t.getElement(".error-thumb-text").setText(e||this.nls.previewError),this._unmaskThumbnail()},_setThumbnail:function(e){this._maskThumbnail(),new l({className:"thumbnail img-responsive",events:{onLoad:this._onThumbnailLoaded.bind(this),onError:this._onThumbnailLoadError.bind(this)}}).load(e)},_onThumbnailLoaded:function(e){var t=this.elements,n=t.thumbnailCtn,a=this._file||{};n.getElement(".img-thumb").setHTML(e),this._hideThumbnails(),n.addClassName("show-img-thumb"),a.width=e.naturalWidth,a.height=e.naturalHeight,this._unmaskThumbnail(),t.resetBtn.enable()},_onThumbnailLoadError:function(){this._unmaskThumbnail(),this._setDefaultThumbnail()},_getUrlInputVal:function(){return this.elements.urlInput.getValue()},_getIsUrlAuthChecked:function(){return this.elements.isUrlAuthInput.isChecked()},_hasInitialImageSrc:function(){return!!this.initialImageSrc},_hasHttpsProtocol:function(e){return e=e||"",t.test(e,new RegExp("https://","i"))},_resetView:function(e){e=e||{};var t=this.elements;this._unmaskView(),this._unmaskThumbnail(),clearTimeout(this._onDragLeaveTimeout),clearTimeout(this._onKeyDownTimeout),this._onErrorState=!1,this._urlInputVal="",this._file=null,this._isBadUrl=!1,this.initialImageSrc=e.initialImageSrc||null,t.applyBtn.disable(),t.urlInput.setValue(""),t.fileInput.value="",t.isUrlAuthCtn.hide(),e.initialImageSrc?t.resetBtn.enable():t.resetBtn.disable(),e.initialImageSrc?this._setThumbnail(e.initialImageSrc):this._setDefaultThumbnail()},_trackUsage:function(e){e&&u.track(e)},_getFileHexa:function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(e){var n=new Uint8Array(e.target.result).subarray(0,4),a="";n.forEach(function(e){a+=e.toString(16)}),t(a)},a.onerror=function(){n({msg:a.error})},a.readAsArrayBuffer(e.slice(0,4))})},getHexaMimeTypes:function(e){var t,n=[];return t={"image/jpeg":["ffd8ffdb","ffd8ffe0","ffd8ffe1","ffd8ffe2","ffd8ffe3","ffd8ffe8","ffd8ffee"],"image/svg+xml":["3c3f786d","3c737667"]},"string"==typeof e&&(e=[e]),e.forEach(function(e){n=n.concat(t[e]||[])}),n}})}),define("DS/Dashboard/TopBar/DDMenu/WidgetMenu",["UWA/Core","UWA/String","DS/UIKIT/DropdownMenu","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/main","i18n!DS/Dashboard/assets/nls/dd_menu"],function(e,t,n,a,i,o){"use strict";var r,s={items:[],events:{onClick:function(t,n){var i=n.id,o=this.options.callbacks[i];e.is(o,"function")&&o();a.track({category:l._trackerCategory,action:i})},onShow:function(){this.options.target.addClassName("active"),l.events.onShow(this)},onHide:function(){this.options.target.removeClassName("active")},onClickOutside:function(){this.hide()}},className:"ifwe-header-dd module-dd-menu",renderTo:document.body,offset:{x:8,y:-6},position:"bottom left",bound:!0,responsiveMode:!1};function d(e){var n=[];return e.forEach(function(e){var a=function(e){var t={name:e};switch(e){case"searchInWidget":t.icon="search search-in-widget-icon",t.text=o.searchInWidget;break;case"preferences":t.icon="cog preferences-icon",t.text=o.preferences;break;case"linkWithWidgets":t.icon="link link-with-widgets-icon",t.text=o.linkWithWidgets;break;case"share":t.icon="share share-icon",t.text=o.share;break;case"refresh":t.icon="refresh refresh-icon",t.text=o.refresh;break;case"publish":t.icon="pin pin-icon",t.text=i.pinItem;break;case"help":t.icon="3ds-why help-icon",t.text=o.help;break;case"exitFullscreen":t.icon="resize-fullscreen-off fullscreen-off-icon",t.text=i.exitFullscreenTextItem;break;case"close":t.icon="cancel close-icon",t.text=i.closeItem;break;case"openIn3DD":t.icon="window open-in-3dd-icon",t.text=i.expand;break;case"showSWAQRCode":t.icon="tablet swa-qrcode-icon",t.text=o.showSWAQRCode;break;case"openSWA":t.icon="window open-swa-icon",t.text=o.openSWA}return t}(e);a&&a.text&&n.push({id:a.name,name:a.name,text:t.escapeHTML(t.ucfirst(a.text)),fonticon:a.icon,className:e,_type:"action"})}),n}var l={_trackerCategory:null,events:{onShow:null},create:function(t){var a={callbacks:t.callbacks,target:t.target},i=[];return l.events.onShow=t.onShow||function(){},l._trackerCategory=t.trackerCategory||"",i.unshift(d(t.items||Object.keys(t.callbacks))),a.items=i,(r=new n(e.merge(a,s))).getActionElement=function(e){var t;if(e){try{t=r.getContent().getElement("."+e)}catch(e){console.error(e),t=void 0}return t}},r},destroy:function(){l._trackerCategory=null,l.events.onShow=null,r&&r.destroy(),r=null}};return l}),define("DS/Dashboard/Models/Group",["UWA/Core","DS/Dashboard/Models/Member"],function(e,t){"use strict";return t.extend({defaults:{groupId:"",groupName:"",groupMembers:0,groupPlatform:""},parse:function(t){var n=this.parseMember(t);return n=e.extend(n,{id:n.reference,groupId:n.reference,groupName:n.name||n.reference,groupMembers:n.members||0,groupPlatform:n.platform})},getGroupName:function(){return this.get("groupName")},getGroupMembers:function(){return this.get("groupMembers")},getGroupPlatform:function(){return this.get("groupPlatform")||""}})}),define("DS/Dashboard/Views/SearchInWidget",["DS/Dashboard/Views/AbstractSearchIn","i18n!DS/Dashboard/assets/nls/views"],function(e,t){"use strict";return e.extend({className:"search-in-widget",setup:function(e){e.targetName="widgetId",this._parent(e)},destroy:function(){this._parent.apply(this,arguments)},render:function(){return this._parent({inputTextPlaceholder:t.searchInWidgetPlaceholder,dense:!0})}})}),define("DS/Dashboard/Modals/ShareLink",["UWA/Core","UWA/Element","UWA/Utils/Client","DS/WebappsUtils/Utils","DS/UWPClientCode/I18n","DS/UWPClientControls/Utils","DS/UIKIT/SuperModal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/UIKIT/Alert","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/main","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m){"use strict";var g,f={article:{sharePublicTitle:m.sharePublicTitleArticle,sharePublicBody:m.sharePublicBodyArticle,notFoundAlert:h.notFoundAlertArticle},module:{sharePublicTitle:m.sharePublicTitleWidget,sharePublicBody:m.sharePublicBodyWidget,notFoundAlert:h.notFoundAlertWidget},widget:{sharePublicTitle:m.sharePublicTitleWidget,sharePublicBody:m.sharePublicBodyWidget,notFoundAlert:h.notFoundAlertWidget},tab:{sharePublicTitle:m.sharePublicTitleTab,sharePublicBody:m.sharePublicBodyTab,notFoundAlert:h.notFoundAlertTab},dashboard:{sharePublicTitle:m.sharePublicTitleDashboard,sharePublicBody:m.sharePublicBodyDashboard,notFoundAlert:h.notFoundAlertDashboard},cockpit:{sharePublicTitle:m.sharePublicTitleCockpit,sharePublicBody:m.sharePublicBodyCockpit,notFoundAlert:h.notFoundAlertCockpit}};function p(e){return e.elements.input}return g={elements:null,options:null,superModal:null,_isTouch:!1,show:function(e){g.elements={},g._isTouch=o.hasTouch(),g.options=e,g._buildModal(e),g.superModal.dialog({body:g.elements.body,title:i.replace(f[e.type].sharePublicTitle,{name:e.title}),buttons:[{className:"primary",value:m.doneBtn,action:g._buildCallback(e.confirm)}]})},hide:function(e){g.superModal.modals.current.hide(),e&&(g.elements=null,g.options=null,g.superModal.destroy())},_buildCallback:function(t){return function(){e.is(t,"function")&&t(),u.track({category:"share.modal.link",action:"doneBtn"}),g.hide(!0)}},_buildModal:function(e){var a,o,u,h,b,v=g._isTouch,w=n.Platform.mac||n.Platform.macintel,D=g.elements;D.linkInput=a=new s({className:"link-input",value:e.link,events:{onClick:g._onLinkInputClick}}),(o=p(a)).readOnly=!0,u=new d({className:"default copy-btn",icon:"copy",events:{onClick:g._onCopyBtnClick}}),D.shareAlert=h=new c({className:"share-alert",animate:!1,closable:!0,visible:!0,autoHide:!1}),D.copyAlert=b=new c({className:"copy-alert",animate:!0,closable:!0,visible:!0,autoHide:!0}),D.copyTooltip=new l({position:"top",target:o,trigger:v?"":"focus",body:v?m.longPressToCopy:i.replace(m.pressKeyToCopy,{key:(w?"&#8984;":"CTRL")+"-C"})}),D.body=new t("div",{html:[{tag:"div",html:h},{tag:"div",html:b},{tag:"p",class:"message",text:i.replace(f[e.type].sharePublicBody,{title:e.title})},{tag:"div",class:"link-ctn",html:[a,u]}]}),g.superModal=new r({renderTo:document.body,className:"share-link-modal",closable:!0,events:{onShow:g._onModalShow,onHide:g._onModalHide}})},_onModalShow:function(){var e=g.options,t=g.elements.shareAlert;setTimeout(function(){if(!g._isTouch){var e=p(g.elements.linkInput);e.focus(),e.select()}}),e.preferenceAlert&&t.add({message:m.cleanedPreferencesAlert,className:"primary"}),e.errorAlert&&t.add({message:f[e.type].notFoundAlert,className:"warning"}),u.track({category:"share.modal.link",action:"open"})},_onModalHide:function(){u.track({category:"share.modal.link",action:"close"})},_onLinkInputClick:function(){g._isTouch||setTimeout(function(){p(g.elements.linkInput).select()}),u.track({category:"share.modal.link",action:"linkClick"})},_onCopyBtnClick:function(){var e=g.elements,t=e.copyAlert;a.copy(p(e.linkInput))?t.add({className:"success",message:m.copySuccess}):t.add({className:"error",message:m.copyError}),u.track({category:"share.modal.link",action:"buttonClick"})}}}),define("DS/Dashboard/Models/User",["UWA/Core","DS/Dashboard/Models/Member"],function(e,t){"use strict";return t.extend({defaults:{externalId:"",login:"",firstName:"",lastName:"",email:"",language:""},parse:function(t){var n=this.parseMember(t);return n=e.extend(n,{id:n.externalId||n.login||n.email,externalId:n.externalId,login:n.login,firstName:n.firstName,lastName:n.lastName,email:n.email,language:n.language})},getExternalId:function(){return this.get("externalId")},getLogin:function(){return this.get("login")},getFirstName:function(){return this.get("firstName")},getLastName:function(){return this.get("lastName")},getEmail:function(){return this.get("email")},getLanguage:function(){return this.get("language")}})}),define("DS/Dashboard/DDMenu/WidgetMenu",["DS/Dashboard/DDMenu/Abstract"],function(e){"use strict";var t,n=e.SEARCH_IN_WIDGET_ITEM,a=e.PREFS_ITEM,i=e.LINK_WITH_WIDGETS_ITEM,o=e.SHARE_ITEM,r=e.DUPLICATE_ITEM,s=e.REFRESH_ITEM,d=e.ENTER_MAXIMIZE_ITEM,l=e.LEAVE_MAXIMIZE_ITEM,c=e.DELETE_ITEM,u=e.EDIT_ITEM,h=e.HELP_ITEM,m=e.SHOW_SWA_QRCODE_ITEM,g=e.OPEN_SWA_ITEM;return(t=e.extend({_items:[n,a,i,o,r,s,d,l,c,u,h,m,g],init:function(e){e.className="widget-dd-menu "+(e.className||""),e.position="bottom right",e.offset={y:-10,x:0},this._parent(e)}})).SEARCH_IN_WIDGET_ITEM_ID=n.id,t.PREFS_ITEM_ID=a.id,t.LINK_WITH_WIDGETS_ITEM_ID=i.id,t.SHARE_ITEM_ID=o.id,t.DUPLICATE_ITEM_ID=r.id,t.REFRESH_ITEM_ID=s.id,t.ENTER_MAXIMIZE_ITEM_ID=d.id,t.LEAVE_MAXIMIZE_ITEM_ID=l.id,t.DELETE_ITEM_ID=c.id,t.EDIT_ITEM_ID=u.id,t.HELP_ITEM_ID=h.id,t.SHOW_SWA_QRCODE_ITEM_ID=m.id,t.OPEN_SWA_ITEM_ID=g.id,t}),define("DS/Dashboard/Modals/PlatformSelect",["UWA/Element","DS/UIKIT/SuperModal","DS/UIKIT/Input/Select","DS/Dashboard/UsageTracker","DS/Dashboard/Utils","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o){"use strict";var r={className:"platform-select-modal",elements:null,options:null,_platforms:null,_shouldCallOnCancel:!0,show:function(e){e=e||{};var t=[];r.elements={},r.options=e,r._platforms=i.cloneDeep(e.platforms),r._shouldCallOnCancel=!0,r._buildModal(e),t.push({className:"primary",value:o.selectBtn,action:r._onConfirm}),e.closable&&t.push({className:"default",value:o.cancelBtn,action:r._onCancel}),r.elements.superModal.dialog({body:r.elements.body,title:e.title||o.platformSelectTitle,buttons:t})},hide:function(){var e=r.elements||{};e.superModal.modals.current.hide(),Object.keys(e).forEach(function(t){e[t].destroy()}),r.elements=null,r.options=null,r._platforms=null},_buildModal:function(){var a,i=r.elements,s=r.options;i.platformSelect=a=new n({placeholder:!1,options:r._populatePlatformSelect(r._platforms),showTooltips:!0}),i.body=new e("div",{html:[{tag:"div",class:"message",text:s.message||o.platformSelectContent},{tag:"div",class:"platform-select-ctn",html:a}]}),i.superModal=new t({renderTo:document.body,className:r.className,closable:!!s.closable,events:{onShow:r._onModalShow,onHide:r._onModalHide}})},_onModalShow:function(){a.track({category:"widget.add.modal.platformselect",action:"open"})},_onModalHide:function(){a.track({category:"widget.add.modal.platformselect",action:"hide"}),r._shouldCallOnCancel&&r._onCancel()},_onConfirm:function(){var e=r.elements.platformSelect.getValue()[0],t=r.options.onConfirm,n=r._platforms.find(function(t){return t.platformId===e});r._shouldCallOnCancel=!1,r.hide(),t&&t(n)},_onCancel:function(){var e=r.options.onCancel;r._shouldCallOnCancel=!1,r.hide(),e&&e()},_populatePlatformSelect:function(e){return e.map(function(e){return{label:e.displayName||e.platformId,value:e.platformId}})}};return r}),define("DS/Dashboard/Modals/SWAQRCode",["UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/UWPClientCode/I18n","DS/Dashboard/Navigation","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r){"use strict";var s;return s={options:null,_modal:null,show:function(e){s.options=e,s._modal&&s._destroy(),s._build(e).show()},hide:function(){var e=s._modal;e&&e.hide()},_build:function(o){var d,l,c,u,h;return u=i.buildSWAUrl({appId:o.appId,widgetId:o.widgetId}),c=e.createElement("div",{class:"qrcode",events:{click:function(){window.open(u,"_blank")}}}),h=e.createElement("div",{class:"qrcode-ctn",html:c}),n.mask(h),l=e.createElement("div",{class:"swa-qrcode-body",html:[{tag:"div",class:"message",html:"<span>"+a.replace(r.swaQRCodeOpenMsg,{name:o.widgetName})+"</span>"},h,{tag:"div",class:"qrcode-link-ctn hide",text:u}]}),s._modal=d=new t({className:"swa-qrcode-modal",closable:!0,header:r.swaQRCodeHeader,body:l,events:{onHide:s._destroy}}).inject(document.body),s._buildQRCode({container:c,url:u}).finally(function(){n.unmask(h)}),d},_destroy:function(){var e=s._modal;e&&e.destroy(),s._modal=null,s.options=null},_buildQRCode:function(e){return new Promise(function(t,n){require(["DS/MobilePairing/QRCode/QRCode"],function(n){new n(e.container,{width:e.width||200,height:e.height||200,correctLevel:e.correctLevel||n.CorrectLevel.L}).makeCode(e.url),t()},function(e){console.error("Fail to require DS/MobilePairing/QRCode/QRCode:",e),n(e)})})}}}),define("DS/Dashboard/UsersGroupManager",["DS/WAFData/WAFData","DS/Dashboard/CompassManager","DS/Dashboard/Utils","DS/Dashboard/Models/Member"],function(e,t,n,a){"use strict";var i={getAllMembers:function(i){var o=i.ugId,r=i.platformId,s=i.ugPlatformId||r;return t.getServiceUrl({serviceName:t.serviceNames.usersgroup,platformId:r}).then(function(t){return new Promise(function(i,r){var d="/3drdfindex/v0/resources/uuid:"+o+"/groupMembers?tenant=dstenant:"+s;e.authenticatedRequest(n.buildPath(t,d),{method:"GET",type:"json",data:{$mask:"dsaccess:Mask.GroupUI.Members",$orderby:"familyName"},onComplete:function(e){i(function(e){var t=[];return e&&Array.isArray(e.member)?(e.member.forEach(function(e){var n,i,o=e["@id"]||"";0===o.indexOf("iam:")?o=o.slice(4):0===o.indexOf("uuid:")&&(o=o.slice(5)),i=e.mbox,((n=e.accountName||o)||i)&&t.push({id:o||n||i,login:n,email:i,type:a.USER_TYPE})}),t):t}(e))},onFailure:function(e){console.error(e),r("Fail to get members from UsersGroup: uuid:"+o+" | platformId:"+s)}})})})},isMember:e=>i.getAllMembers({ugId:e.ugId,ugPlatformId:e.ugPlatformId,platformId:e.platformId}).then(function(t){return t.some(function(t){return t.id===e.userId})}).catch(function(e){return console.error(e),!1})};return i}),define("DS/Dashboard/PublicAPI",["UWA/Core","UWA/String","UWA/Utils","UWA/Data","UWA/Promise","DS/PubSub/PubSub","DS/WAFData/WAFData","DS/UWPClientCode/PublicAPI","DS/UWPClientCode/I18n","DS/UWPClientCode/Data/Context","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/Data/Utils","DS/UWPClientControls/Utils","DS/Dashboard/Utils","DS/Dashboard/UserPlatformAccess","DS/Dashboard/Models/Member","DS/Dashboard/UsageTracker","DS/Dashboard/CompassManager","DS/Dashboard/UsersGroupManager","DS/Dashboard/Navigation","i18n!DS/Dashboard/assets/nls/main","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w,D,_){"use strict";var C=function(e,t,n){return(n||t)&&(t=t||"name",e.sort(function(e,a){var i,o,r=e[t],s=a[t];return"desc"===n?(i=s,o=r):(i=r,o=s),m.localeCompare(i,o)})),e},I="dashboard",S="14bae14c-63a8-4fac-9890-6f9a1dbfb988",y="33ce90de-7f02-48eb-9e8c-2fc85a93f809",E={empty:S,first:y},T="7zAw5w30gCwH0QgEjm01",A=255,P="",x="";function M(e){var t,n,a,o=f.USER_TYPE,r=f.GROUP_TYPE,l="NO_RECIPIENTS",c=e.recipients||[],u=[],h=[];function p(e){return e.login}function b(e){return e.email}function w(e){h.push(e||D.errorTryLater)}function _(e){var t,n=[];if(!(t=e.filter(function(e){return e.type===r})).length)return i.resolve([]);return t.forEach(function(e){var t=v.getAllMembers({ugId:e.id,ugPlatformId:e.platform,platformId:V._getGlobalPlatformId()}).catch(function(){return function(e){d.replace(D.fetchGroupMembersError,{groupName:e.name})}(e),[]});n.push(t)}),i.all(n).catch(function(e){throw e})}n=c.filter(function(e){return!e.login&&e.type===o}).map(b),(a=n,a.length?g.sendPlatformInvitations(a):i.resolve()).then(function(e){if(e){u.push(e);if(!(c=c.filter(function(e){return e.login||e.type===r})).length)return i.reject(e)}}).then(function(){return _(c).then(function(e){var t;if(c=c.filter(function(e){return e.type===o}),e.forEach(function(e){Array.isArray(e)&&e.length&&(t=t||c.map(function(e){return e.id}),e=e.filter(function(e){return-1===t.indexOf(e.id)}),c=c.concat(e),t=t.concat(e.map(function(e){return e.id})))}),!c.length)throw{errorType:l}})}).then(function(){return function(n){return new i(function(a,i){if(!n.length)throw{errorType:l};var o,r;o=n.filter(function(e){return e.login&&!e.email}).map(p),r=n.filter(b).map(b),s.createNotification({serviceName:V._getServiceName(),widgetInstanceId:e.id,handler:e.handler,accessType:3,recipientsByLogin:o,recipientsByEmail:r,message:e.message,data:e.data,success:function(e){t=e,a()},failure:function(e,t){i(t)}})})}(c)}).then(function(){return new i(function(e){if(!c.length||!t)return i.resolve();s.publishNotificationByMail({serviceName:V._getServiceName(),notificationId:t.id,success:e,failure:function(t){w(t),e()}})})}).then(function(){m.apply(e.success,e.scope,[t,u,h],!0)}).catch(function(n){w(n),m.apply(e.failure,e.scope,[t,h],!0)})}var k,N,W,L,U,O,F,B,R,V={events:{panel:{open:"panel:open",change:"panel:change",close:"panel:close"},topbar:{userContextClick:"topbar:userContextClick"},rightpanel:{minimized:"rightpanel:minimized",maximized:"rightpanel:maximized",comment:{open:"rightpanel:comment:open",close:"rightpanel:comment:close"}},dashboard:{add:"dashboard:add",remove:"dashboard:remove",duplicate:"dashboard:duplicate",change:"dashboard:change",rename:"dashboard:rename",manage:"dashboard:manage",unshare:"dashboard:unshare",trashPending:"dashboard:trashPending",trash:"dashboard:trash",untrash:"dashboard:untrash",refresh:"dashboard:refresh",created:"dashboard:created",_loaded:"dashboard:loaded",addFavorites:"dashboard:addFavorites",removeFavorites:"dashboard:removeFavorites",reorderFavorites:"dashboard:reorderFavorites",setThumbnail:"dashboard:setThumbnail",unsetThumbnail:"dashboard:unsetThumbnail",contextApiBaseUrlChange:"dashboard:contextApiBaseUrlChange",inconsistency:"dashboard:inconsistency"},tab:{add:"tab:add",remove:"tab:remove",duplicate:"tab:duplicate",change:"tab:change",click:"tab:click",rename:"tab:rename",fit:"tab:fit",refresh:"tab:refresh",subscribe:"tab:subscribe",switchto:"tab:switchto",showSearchIn:"tab:showSearchInTab",closeSearchIn:"tab:closeSearchInTab",_loadingStable:"tab:_loadingStable"},widget:{add:"widget:add",remove:"widget:remove",destroy:"widget:destroy",_enterWindowed:"widget:enterWindowed",_enterFullscreen:"widget:enterFullscreen",_enterMaximized:"widget:enterMaximized",_exitFullscreen:"widget:exitFullscreen",_exitMaximized:"widget:exitFullscreen",_link:"widget:link",_unlink:"widget:unlink",_changeLinkability:"widget:changeLinkability",focus:"widget:focus",unfocus:"widget:unfocus",switchTab:"widget:switchTab",updatePlatformInfoFullscreenWidget:"widget:updatePlatformInfoFullscreenWidget",updateFilteredIconFullscreenWidget:"widget:updateFilteredIconFullscreenWidget"},environment:{_widgetInstanceReady:"environment:widgetInstanceReady",_tentativeChangeLinkability:"environment:tentativeChangeLinkability"},widgetLinkMode:{_link:"_widgetLinkMode:link",_unlink:"_widgetLinkMode:unlink",_linkAll:"_widgetLinkMode:linkAll",_unlinkAll:"_widgetLinkMode:unlinkAll"},member:{add:"member:add",update:"member:update",remove:"member:remove"},manageDashboard:{open:"manageDashboard:open",close:"manageDashboard:close"},search:{openSearchInTab:"3DSearch:open3DDSearchInTab"},myprofile:{updated:"myprofile:updated"},preview:{show:"preview:show",hide:"preview:hide",close:"preview:close",loaded:"preview:loaded",updateTopBarProviders:"preview:updateTopBarProviders"},platform:{tenant:"platform:tenant"},story:{init:"story:init",updated:"story:updated",start:"story:start",stop:"story:stop",next:"story:next",previous:"story:previous"},license:{error:"license:error"}},currentMode:"standalone",serviceName:"",_isPlatformAwareUrl:function(){var e=V._getApplicationConfigurationBoolean("app.build.isCloud"),t=V._getGlobalPlatformId();return!e||"OnPremise"!==t},_getGlobalPlatformId:function(){return s.getSandboxPlatformId()||"OnPremise"},_initNewContext:function(e){var t=e.context,n=e.widgetInstance;return t.role=f.OWNER_ROLE,n&&(t.sourceModelId=n.sourceModelId,t._widgetId=n.id),t.shareAccesses=[{type:f.USER_TYPE,role:f.OWNER_ROLE}],t},initContextApiBaseUrl:function(e){return e=e||{},new i(function(t,n){l.getAPIBaseUrl({serviceName:V._getServiceName(),success:function(n){P=n||"",e.sendEvent&&o.dispatch(V.events.dashboard.contextApiBaseUrlChange),t(n)},failure:n})})},_initBackgroundApiBaseUrl:function(){return new i(function(e,t){u.getServiceUrl({serviceName:V._getServiceName(),onComplete:function(t){var n=m.buildPath(t,"api/templates");x=n,e(n)},onFailure:t})})},_disableContext:function(t){e.is(t,"string")&&(t=V._getContext(t)),t&&(t.disabled=!0)},_enableContext:function(t){e.is(t,"string")&&(t=V._getContext(t)),t&&delete t.disabled},_getAllContexts:function(e,t){var n=[],a=V._getAllDashboardContexts(),i=V._getAllCockpitContexts();return V._isBusinessExpFeatureEnabled()&&(n=V._getAllBusinessExpInstanceContexts()),C([].concat(a,n,i),e,t)},_getAllDashboardContexts:function(e,t){var n=s._getAllContexts("dashboard");return C(n.filter(function(e){return V._isEnabledContext(e)&&!V._isTrashedContext(e)&&!V._isTemplateContext(e)},V),e,t)},_getAllBusinessExpInstanceContexts:function(e,t){var n=s._getAllContexts("business-experience-instance");return C(n.filter(function(e){return V._isEnabledContext(e)&&!V._isTrashedContext(e)&&!V._isTemplateContext(e)},V),e,t)},_getAllCockpitContexts:function(e,t){var n=s._getAllContexts("cockpit");return C(n.filter(function(e){return V._isEnabledContext(e)&&!V._isTrashedContext(e)&&!V._isTemplateContext(e)},V),e,t)},_getAllBusinessExpLayoutContexts:function(e,t){var n=s._getAllContexts("business-experience-layout");return C(n.filter(function(e){return V._isEnabledContext(e)&&!V._isTrashedContext(e)&&!V._isTemplateContext(e)},V),e,t)},_getTrashedContexts:function(e,t){var n=s._getAllContexts();return n=n.filter(V._isTrashedContext),C(n,e,t)},_getFavoriteContexts:function(e,t){var n;return n=V._getFavoriteContextModelIds().map(function(e){return V._getContext(e)}).filter(function(e){return e&&V._isEnabledContext(e)&&!V._isTrashedContext(e)}),C(n,e,t)},_getDefaultContexts:function(e,t){var n=s._getAllContexts();return n=n.filter(V._isDefaultContext),C(n,e,t)},_getDefaultCustomRoleContexts:function(e,t){var n=s._getAllContexts();return n=n.filter(V._isDefaultCustomRoleContext),C(n,e,t)},_getOwnerCustomRoleContexts:function(e,t){var n=s._getAllContexts();return n=n.filter(V._isOwnCustomRoleContext),C(n,e,t)},_getTemplateContexts:function(e,t){var n=s._getAllContexts();return n=n.filter(V._isTemplateContext),C(n,e,t)},_isBusinessExpInstanceContext:function(t){return e.is(t,"string")&&(t=V._getBusinessExpInstanceContext(t)),!(!t||"business-experience-instance"!==t.type)},_isCockpitContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||"cockpit"!==t.type)},_isEndUserCockpitContext:function(e){return e||(e=V._getActiveContext()),!(!e||!V._isCockpitContext(e)&&!V._isBusinessExpInstanceContext(e))},_isBusinessExpLayoutContext:function(t){return e.is(t,"string")&&(t=V._getBusinessExpLayoutContext(t)),!(!t||"business-experience-layout"!==t.type)},_isDashboardContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||"dashboard"!==t.type)},_isEnabledContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||t.disabled)},_isRestrictedContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||3!==t.access&&"restricted"!==t.access)},_isPublicContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||1!==t.access&&"public"!==t.access)},_isTrashedContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||!t.deletionDate)},_isFavouriteContext:function(t){if(!t)return!1;var n=e.is(t,"string")?t:t.modelId;return V._getFavoriteContextModelIds().includes(n)},_isAnyDefaultContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!!(t&&!t.owner&&V._isPublicContext(t)&&(t.roles||[]).length>0)},_isDefaultContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||t.owner||!V._isPublicContext(t)||!(t.roles||[]).filter(function(e){return"_starter_"!==e}).length||(t.roles||[]).some(function(e){return m.customRolePattern.test(e)}))},_isDefaultCustomRoleContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||t.owner||!V._isPublicContext(t)||!(t.roles||[]).some(function(e){return m.customRolePattern.test(e)}))},_isOwnCustomRoleContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!!(t&&t.owner&&V._isPublicContext(t)&&(t.roles||[]).length>0)},_isTemplateContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||2!==t.access&&"intermediate"!==t.access)},_isSharedContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!!(t&&t.membersCount>1&&g.getUserRoles().map(function(e){return e.id}).every(function(e){return-1===(t.roles||[]).indexOf(e)}))},_isOwnerContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||!f.isOwnerRole(t.role))},_isContributorContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||!f.isContributorRole(t.role))},_isReaderContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||!f.isReaderRole(t.role)&&!V._isAnyDefaultContext(t))},_isUnShareableContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||!(t.shareAccesses||[]).some(function(e){if(f.isUserType(e.type)&&(f.isReaderRole(e.role)&&V._isSharedContext(t)||f.isContributorRole(e.role)))return!0}))},_isDeleteableContext:function(t){return e.is(t,"string")&&(t=V._getContext(t)),!(!t||!V._isOwnerContext(t)||!V._isRestrictedContext(t)&&!V._isOwnCustomRoleContext(t))},_getContext:function(e,t){return"string"==typeof type&&(t=[t]),t||(t=["dashboard","business-experience-instance","business-experience-layout","cockpit"]),s._getAllContexts().find(function(n){return n.modelId===e&&t.includes(n.type)})},_getDashboardContext:function(e){return s._getContext(e,"dashboard")},_getBusinessExpInstanceContext:function(e){return s._getContext(e,"business-experience-instance")},_getCockpitContext:function(e){return s._getContext(e,"cockpit")},_getBusinessExpLayoutContext:function(e){return s._getContext(e,"business-experience-layout")},_getActiveDashboardContext:function(){return require("DS/Logger/Logger").warn("Please do not use `DS/Dashboard/PublicAPI#_getActiveDashboardContext` since it is deprecated in favor of `DS/Dashboard/PublicAPI#_getActiveContext`"),V._getActiveContext()},_getActiveContext:function(){return s._getActiveContext()},_getActiveContextModelId:function(){return(V._getActiveContext()||{}).modelId||""},_setActiveContext:function(e){var t=V._getContext(e);t&&s._setActiveContext(t.id)},_isActiveContext:function(e){return!!e&&("string"==typeof e?e:e.modelId)===V._getActiveContextModelId()},_getActiveContextWidget:function(){return s.getContextOwner("dashboard")},_getTemplateContextBlackList:function(){return E},getContextWidgetId:function(e){return new i(function(t,n){var a=V._getContext(e.modelId);return a?a._widgetId?t(a._widgetId):void s.getWidgetInstanceChildren({serviceName:V._getServiceName(),id:T,contextType:a.type,contextId:a.modelId,cacheId:Date.now(),success:function(e){e.parent?(a._widgetId=e.parent.id,t(a._widgetId)):n()},failure:n}):n(new Error("Context not found: "+e.modelId))})},_getContextExportUrl:function(e,a){a=a||{};var i,o=V._getContext(e);if(!o)throw new Error("Context not found: "+e);return i=1===a.kind?"default-dashboard":2===a.kind?"dashboard-template":"export",t.format("{0}/{1}/{2}.json?modelId={3}&access={4}&name={5}",l.getUrl({serviceUrl:a.serviceUrl}),o.id,i,n.getUUID(),a.kind||"",a.name||"")},_getWidget:function(e){return e&&s.getPageWidget(e)},_getWidgetName:function(e){"string"==typeof e&&(e=V._getWidget(e));var t=(e||{}).environment;return t?t.getName():""},_getDuplicateContextName:function(e){return d.replace(D.copyOfDashboardName,{dashboardName:(V._getContext(e)||{}).name||""})},_getDuplicateTabName:function(e){return d.replace(D.copyOfTabName,{sourceName:V._getTabName(e)})},duplicateContext:function(e){var n,a,o;a=e.name||V._getDuplicateContextName(e.id),e.name=t.truncate(a,A,""),(o=V._getContext(e.id)||{})?V.addContext({name:e.name,type:o.type,description:o.data&&o.data.description||"",templateModelId:o.modelId,templateId:o.template,thumbnailId:o.thumbnail?o.thumbnail.id:null}).then(function(t){return i.all([new i(function(a,i){s.getWidgetInstanceChildren({serviceName:V._getServiceName(),id:T,contextType:o.type,contextId:e.id,success:function(e){var i,o,r,s,d,l,c={},u=e.children;r=(n=e.children).map(function(e){return e.id}),s=u.map(function(e){return e.id}),r.forEach(function(e,t){var a=s[t];(i=V._getTabProperty(e,"minimizedWidgetIds"))&&(c[a]={minimizedWidgetIds:{}},o=c[a].minimizedWidgetIds,d=(n[t].children||[]).map(function(e){return e.id}),l=(u[t].children||[]).map(function(e){return e.id}),Object.keys(i).forEach(function(e){var t=d.indexOf(e),n=i[e];-1!==t&&n&&(o[l[t]]=n)}))}),V.setContextProperty(t.modelId,"tabs",c).then(a)},failure:i})}),(a=V._getContextPlatformIdProperty(e.id),a?V.setContextPlatformId({id:t.modelId,platformId:a}):i.resolve())]).then(function(){return t}).catch(e.failure);var a}).then(function(t){m.apply(e.success,e.scope,[t])}):m.apply(e.failure,e.scope,[new Error("Context not found: "+e.id)])},fetchBusinessExperienceUsages:function(e){var t,n,a=e.context||V._getContext(e.modelId),o=a.platform||V._getGlobalPlatformId(),s="";if(!a)return i.reject(new Error("Context not found: "+e.modelId));try{t=a.data.businessExperience,(s=t.cockpitId)||(n=t.callback.split("?")[0].split("/"),s=n[n.length-1])}catch(e){return i.reject(new Error("Fail to get business experience cockpit id."))}return b.getServiceUrl({serviceName:b.serviceNames.businessexperience,platformId:o}).then(function(e){return(t={serviceUrl:e,platformId:o,cockpitId:s},new i(function(e,n){var a=m.buildPath(t.serviceUrl,"resources/BusinessExperienceAccess/v1/model/BusinessCockpitDefinition",t.cockpitId,"Usage?tenant="+t.platformId);r.authenticatedRequest(a,{method:"GET",type:"json",onComplete:function(t){e(t)},onFailure:function(e){(e=e||{}).code="business experience usage not-found",n(e)}})})).catch(function(e){throw e});var t})},newAddContext:function(e){var t;return(e=e||{}).templateModelId&&(t=V._getContext(e.templateModelId)),s.addContext({serviceName:V._getServiceName(),sourceContext:{type:t?t.type:I,modelId:t?t.modelId:S},targetContext:{name:e.name||D.newDashboardName,type:e.type,description:e.description||"",thumbnailId:e.thumbnailId,template:e.templateId},templateTopic:e.templateTopic,withoutTab:e.withoutTab}).then(function(e){return V._initNewContext({context:e})})},addContext:function(t){if(!V._getApplicationConfigurationBoolean("app.feature.add-context-v2.disabled"))return V.newAddContext({name:t.name,type:t.type,description:t.description,thumbnailId:t.thumbnailId,templateId:t.templateId,templateModelId:t.templateModelId,templateTopic:t.templateTopic,withoutTab:t.withoutTab});return t=t||{},V.createEmptyContext({type:t.type,name:t.name,description:t.description,thumbnailId:t.thumbnailId,templateId:t.templateId}).then(function(e){return new i(function(n,a){var i;t.templateModelId&&(i=V._getContext(t.templateModelId));var o={serviceName:V._getServiceName(),name:t.name,sourceContext:{type:i?i.type:I,modelId:t.templateModelId||S},depth:t.withoutTab?1:null,targetContext:e,replacement:t.templateTopic,success:function(t){n({context:e,widget:t})},failure:a};s.copyContextTree(o)})}).then(function(n){var a=n.context,o=n.widget;return a=V._initNewContext({context:a,widgetInstance:o}),i.all([function(e){var t=!1,n=e.context,a=e.contextWidget,o=JSON.parse(a.data||"{}");return e.platformId&&(o.platformId=e.platformId,t=!0),t?V.setContextWidgetData({modelId:n.modelId,method:"set",data:o}):i.resolve()}({context:a,contextWidget:o,platformId:t.platformId}),function(t){if(!t.templateModelId&&!t.platformId)return i.resolve();var n=t.context.modelId,a=i.resolve(t.platformId);if(!t.platformId&&t.templateModelId){var o=t.templateModelId;if(o===y)return i.resolve();if(!V._getTemplateContexts().find(function(e){return e.modelId===o}))return i.resolve();a=i.resolve(V._getGlobalPlatformId())}return a.then(function(t){return function(t,n){return n?V.setContextPlatformId({id:t,platformId:n,useCache:!0}).catch(function(){var n="Fail to inject platform id into context: "+t;return e.log(n),i.reject(n)}):i.resolve()}(n,t)})}({context:a,templateModelId:t.templateModelId,platformId:t.platformId})]).then(function(){return a})}).then(function(e){return e})},addDashboard:function(e){return(e=e||{}).type="dashboard",V.addContext(e)},setContextWidgetData:function(t){var n,a,o;return o=(t.method||"extend").toLowerCase(),a="extend"===o||"merge"===o,V.getContextWidgetId(t).then(function(e){return n=e,a?new i(function(e,t){s.getWidgetInstance({serviceName:V._getServiceName(),id:n,success:e,failure:t})}):{}}).then(function(a){var r,d;switch(o){case"set":r=t.data;break;case"extend":r=e.extend(JSON.parse(a.data||"{}"),t.data,t.recursiveExtend);break;case"merge":r=e.merge(JSON.parse(a.data||"{}"),t.data);break;default:throw new Error("unknow method.")}return(d=r,new i(function(e,t){s.setWidgetInstance({serviceName:V._getServiceName(),id:n,data:d,success:e,failure:t})})).then(function(){return r})})},createEmptyContext:function(e){return new i(function(t,a){e=e||{},s.setContext({serviceName:V._getServiceName(),id:n.getUUID(),name:e.name?e.name:D.newDashboardName,data:{description:e.description},thumbnailId:e.thumbnailId,template:e.templateId,type:e.type||"dashboard",accessType:"restricted",success:t,failure:a})})},removeContext:function(e){var t=e.success,n=e.scope,a=V._getContext(e.id);a?(e.serviceName=V._getServiceName(),e.type=a.type,e.success=function(){V.setContextProperties(e.id,null),m.apply(t,n,arguments)},s.removeContext(e)):m.apply(e.failure,n,[new Error("Context not found: "+e.id)])},removeAllTrashedContexts:function(){var e=V._getTrashedContexts().filter(function(e){return f.isOwnerRole(e.role)}).map(function(e){return e.id});return s.removeContexts({ids:e,serviceName:V._getServiceName()})},removeTrashedContexts:function(e){var t=V._getTrashedContexts(),n=[];return t.forEach(function(t){e.forEach(function(e){var a=V._getContext(e);a&&a.id===t.id&&n.push(a.id)})}),s.removeContexts({ids:n,serviceName:V._getServiceName()})},trashContext:function(e){var t=V._getContext(e.modelId);return t?(e.type=t.type,e.serviceName=V._getServiceName(),s.trashContext(e)):i.reject(new Error("Context not found: "+e.modelId))},unTrashContext:function(e){var t=e.modelId,n=V._getContext(t);return n?(e.type=n.type,e.serviceName=V._getServiceName(),s.unTrashContext(e).then(function(){V._enableContext(t)})):i.reject(new Error("Context not found: "+t))},renameContext:function(t){return new i(function(n,a){var i=V._getContext(t.modelId);if(!i)return a(new Error("Context not found: "+t.modelId));s.setContext({serviceName:V._getServiceName(),id:t.modelId,name:t.name,data:e.extend(i.data,{description:t.description}),type:i.type,success:function(e){n(e)},failure:a})})},setContextPlatform:function(e){return new i(function(t,n){var a=V._getContext(e.modelId);if(!a)return n(new Error("Context not found: "+e.modelId));s.setContext({serviceName:V._getServiceName(),id:e.modelId,type:a.type,platformId:e.platformId,success:t,failure:n})})},unShareContext:function(e){return new i(function(t,n){var a=e.member.email,o=V._getContext(e.modelId);if(!o)return n(new Error("Context not found: "+e.modelId));s.removeAclAsync({serviceName:V._getServiceName(),type:o.type,id:e.modelId,login:a,success:function(){var a;(a=e.userRecipients,a.length?V.publish3DNotifications({recipients:a,messageId:V._isEndUserCockpitContext(e.modelId)?"unshare.cockpit.msg":"unshare.dashboard.msg",notificationId:"unshare.dashboard.setting",uri:"#dashboard:"+e.modelId,data:{FROM_USER_NAME:e.member.firstName+" "+e.member.lastName,INSTANCE_NAME:o.name}}):i.resolve()).then(t).catch(function(e){n(e)})},failure:function(e){n(e)}})})},_getLastVisitedPlatformId:function(){return s.getUserProperty("lastVisitedPlatformId")||""},setLastVisitedPlatformId:function(e){return(e||"")===V._getLastVisitedPlatformId()?i.resolve():new i(function(t,n){s.setUserProperty("lastVisitedPlatformId",e,{serviceName:V._getServiceName(),success:t,failure:n})})},_getLastOpenedContextId:function(){return s.getUserProperty("lastOpenedDashboardId."+V._getGlobalPlatformId())||""},setLastOpenedContextId:function(e){return(e||"")===V._getLastOpenedContextId()||V._isBusinessExpLayoutContext(e)?i.resolve():new i(function(t,n){s.setUserProperty("lastOpenedDashboardId."+V._getGlobalPlatformId(),e,{serviceName:V._getServiceName(),success:t,failure:n})})},_getCreatedTemplatesStarters:function(e){var t=(e=e||{}).isPlatformUnaware?void 0:V._getGlobalPlatformId(),n=s.getUserProperty("starters"+(t?"."+t:""));return JSON.parse(n||"[]")},setCreatedTemplatesStarters:function(e,t){return t=t||{},new i(function(n,a){var i=t.isPlatformUnaware?void 0:V._getGlobalPlatformId();s.setUserProperty("starters"+(i?"."+i:""),JSON.stringify(e),{serviceName:V._getServiceName(),success:n,failure:a})})},_getFavoriteContextModelIds:function(e){var t=(e=e||{}).isPlatformUnaware?void 0:V._getGlobalPlatformId(),n=s.getUserProperty("dashboardFavorites"+(t?"."+t:""));try{n=JSON.parse(n||"[]")||[]}catch(e){n=[]}return n},setFavoriteContextModelIds:function(e,t){return t=t||{},new i(function(n,a){var i=t.isPlatformUnaware?void 0:V._getGlobalPlatformId();s.setUserProperty("dashboardFavorites"+(i?"."+i:""),JSON.stringify(e),{serviceName:V._getServiceName(),success:n,failure:a})})},_getDashboardMenuVisibility:function(){var e=s.getUserProperty("dashboardSwitchVisibility");return"boolean"==typeof e?e:"true"===e},setDashboardMenuVisibility:function(e){return e===V._getDashboardMenuVisibility()?i.resolve():new i(function(t,n){s.setUserProperty("dashboardSwitchVisibility",e,{serviceName:V._getServiceName(),success:t,failure:n})})},_getTab:function(e){var t=V._getTabContext(e);if(t&&t.options.item&&t.options.item.widget)return t.options.item.widget},_getTabName:function(e){return"string"==typeof e&&(e=V._getTabContext(e)),((e||{}).options||{}).name||""},_getActiveTab:function(){var e,t=V._getActiveContextWidget();if(t&&t.layout)return(e=t.layout.selectedTab)&&e.options&&e.options.item&&e.options.item.widget&&e.options.item.widget},getActiveTab:function(){return V._getActiveTab()},_setActiveTab:function(e){V._getActiveContextWidget().layout.selectTab(e)},_addTab:function(){V._getActiveContextWidget().layout.dispatchEvent("onNewTab")},_getAllTabs:function(){var e=((V._getActiveContextWidget()||{}).layout||{}).tabs;return e?e.map(function(e){if(e&&e.options.item&&e.options.item.widget)return e.options.item.widget}):[]},_getTabContext:function(e){var t=V._getActiveContextWidget(),n=t&&t.layout;return n&&n.getTab(e)},_getAllTabContexts:function(){return V._getActiveContextWidget().layout.tabs},_getTabByModuleId:function(e){var t=V._getWidget(e);return t&&t.environment.wp&&t.environment.wp.parent},getTabData:function(e){s.getWidgetInstance({serviceName:V._getServiceName(),id:e.id,success:e.success,failure:e.failure,scope:e.scope})},getAllTabsData:function(e){return V.getContextWidgetId(e).then(function(e){return new i(function(t,n){s.getWidgetInstanceChildren({serviceName:V._getServiceName(),id:e,success:t,failure:n})})}).then(function(e){return e.children})},removeTab:function(e){s.removeWidgetInstance({serviceName:V._getServiceName(),id:e.id,success:e.success,failure:e.failure,scope:e.scope})},duplicateTab:function(e){var n=e.id,a=e.name,i=e.failure,r=e.scope;function l(a){var d=t.truncate(a,A,"");s.copySubTree({serviceName:V._getServiceName(),sourceId:n,name:d,success:function(t){e.shouldDispatchEvent&&o.dispatch(V.events.tab.duplicate,[t]),m.apply(e.success,e.scope,arguments,!0)},failure:i,scope:r})}a?l(a):V.getTabData({id:n,success:function(e){l(d.replace(D.copyOfTabName,{sourceName:e.name||""}))},failure:i,scope:r})},renameTab:function(e){s.setWidgetInstance({serviceName:V._getServiceName(),id:e.id,title:"",name:e.name,success:e.success,failure:e.failure,scope:e.scope})},getContextMembers:function(e){var t=V._getContext(e.id);t?s.getAclAsync({serviceName:V._getServiceName(),id:e.id,type:t.type,name:e.name,roles:e.roles,userType:e.userType,userInfo:!0,offset:e.offset,limit:e.limit,success:e.success,failure:e.failure,scope:e.scope}):m.apply(e.failure,e.scope,[new Error("Context not found: "+e.id)])},addContextMembers:function(e){var t,n,a=f.USER_TYPE,o=f.GROUP_TYPE,r=e.id,d=V._getContext(r),l=e.newOwners||[],c=e.newContributors||[],u=e.newReaders||[],h=[],p=[],b={};function v(){return l.concat(c,u)}function w(e){p.push({message:(e||{}).message||D.errorTryLater})}d?(t=v().filter(function(e){return!e.login&&e.type===a}).map(function(e){return e.email}),(n=t,n.length?g.sendPlatformInvitations(n):i.resolve()).then(function(e){if(e){h.push(e);var t=function(e){return e.login||e.type===o};if(l=l.filter(t),c=c.filter(t),u=u.filter(t),!v().length)return i.reject(e)}b.membersAdded=v().length}).then(function(){return t=l,n=c,h=u,m=new i(function(i,o){function l(e){return function(t){return{identifier:t.email||t.login,type:t.email?"email":"login",role:e.toUpperCase()}}}function c(e){return e.type===a}var u=t.filter(c).map(l(f.OWNER_ROLE)),m=n.filter(c).map(l(f.CONTRIBUTOR_ROLE)),g=h.filter(c).map(l(f.READER_ROLE)),p=u.concat(m,g);p.length?s.setAclV2({serviceName:V._getServiceName(),modelId:r,type:d.type,recipients:p,sendEmail:e.sendEmail,success:function(e){b.acl=e,i(!0)},failure:function(e){w(e),o()}}):i(!1)}),g=new i(function(a,i){function l(e){return function(t){return{id:t.id,platform:t.platform,role:e.toUpperCase()}}}function c(e){return e.type===o}var u=t.filter(c).map(l(f.OWNER_ROLE)),m=n.filter(c).map(l(f.CONTRIBUTOR_ROLE)),g=h.filter(c).map(l(f.READER_ROLE)),p=u.concat(m,g);p.length?s.setGroupAccesses({serviceName:V._getServiceName(),modelId:r,type:d.type,groups:p,sendEmail:e.sendEmail,success:function(e){b.groupsAccesses=e,a(!0)},failure:function(e){w(e),i()}}):a(!1)}),i.all([m,g]);var t,n,h,m,g}).then(function(e){if(!e.filter(function(e){return e}).length)return i.reject({message:D.errorTryLater})}).then(function(){m.apply(e.success,e.scope,[b,h,p],!0)}).catch(function(t){w(t),m.apply(e.failure,e.scope,[p],!0)})):m.apply(e.failure,e.scope,[new Error("Context not found: "+r)])},removeContextMemberAccess:function(e){var t,n=e.member,a=e.id,i=V._getContext(a);i?(t={serviceName:V._getServiceName(),type:i.type,success:e.success,failure:e.failure,scope:e.scope},n.isGroup()?(t.modelId=a,t.groupId=n.getId(),s.removeGroupAccess(t)):n.isUser()&&(t.id=a,t.login=n.getLogin(),s.removeAclAsync(t))):m.apply(e.failure,e.scope,[new Error("Context not found: "+a)])},updateContextMemberAccess:function(e){function t(t){return e.role===t?[a]:[]}var n,a,i=e.member,o=e.id,r=V._getContext(o);r?(n={serviceName:V._getServiceName(),modelId:o,type:r.type,role:e.role,success:e.success,failure:e.failure,scope:e.scope,sendEmail:!0},i.isGroup()?(n.groupId=i.getId(),s.updateGroupAccess(n)):i.isUser()&&(a={type:f.USER_TYPE,login:i.getLogin(),email:i.getEmail()},n.id=o,n.newOwners=t(f.OWNER_ROLE),n.newContributors=t(f.CONTRIBUTOR_ROLE),n.newReaders=t(f.READER_ROLE),V.addContextMembers(n))):m.apply(e.failure,e.scope,[new Error("Context not found: "+o)])},_getSwymPlatform:function(){return g.getSwymTenants().find(function(e){return e.id===V._getGlobalPlatformId()})},getPlatforms:(B=!1,R=[],function(e){var t;return(e=e||{}).force&&(F=null),F?i.resolve(m.cloneDeep(F)):(t=new i(function(e,t){R.push({resolve:e,reject:t})}),B||(B=!0,b.getPlatformServices(e.config?{config:e.config}:void 0).then(function(e){F=e||[]}).catch(function(e){console.error("Fail to fetch platforms list with error:"),console.error(e)}).finally(function(){B=!1,R.forEach(function(e){e.resolve(m.cloneDeep(F||[]))}),R=[]})),t)}),searchUsers:function(e){var n,a=10,o=[],l=e.query||"";(n=e.platformId,b.getServiceUrl({serviceName:b.serviceNames.search,platformId:n}).then(function(e){return n&&(e=[{platformId:n,url:e}]),e}).catch(function(){return[]})).then(function(e){var n=[];return e.forEach(function(e){var c=new i(function(n){var i,c,u,h,g,p=V._getApplicationConfigurationBoolean("app.usergroup.enable");i='[ds6w:type]:("pno:Person"'+(p?' OR "foaf:Group"':"")+")",u=["swym"],h={swym:{additional_query:"AND personOrGroup:("+l+")"}},g=["ds6w:resourceUid","resourceid","ds6w:label","ds6w:type"],p&&(u.push("usersgroup"),h.usersgroup={additional_query:'AND ([ds6w:label]:"'+t.escapeRegExp(l)+'" OR [ds6w:label]:('+t.escapeRegExp(l)+"*))"},g=g.concat(["dsaccess:groupMemberCount"])),c=JSON.stringify({source:u,select_predicate:g,query:i,specific_source_parameter:h,order_field:"relevance",order_by:"desc",start:0,nresults:a,tenant:e.platformId,locale:d.getCurrentLanguage(),label:"3DDashboard-searchUserOrGroupByName-"+s.getCachedCurrentUser().login+"-"+Date.now(),with_synthesis:!1,with_synthesis_attribute:!1}),r.authenticatedRequest(m.buildPath(e.url,"/search"),{method:"POST",type:"json",headers:{"Content-Type":"application/json",Accept:"application/json"},data:c,onComplete:function(t){var a=function(e,t){var n=[];return e.error||e.errorcode||!Array.isArray(e.results)?n:(e.results.forEach(function(e){var a={};(e.attributes||[]).forEach(function(e){var t=e.name;t&&(a[t]=e.value||"")}),n.push(("pno:Person"===a["ds6w:type"]?function(e,t){var n,a,i,o,r;if(a=(a=(e["ds6w:resourceUid"]||"").split(":",2)).length>=2?a[1]:a[0],n=e["ds6w:label"],i=(e.resourceid||"").split(":",2),o=i[1],"mailto"===i[0])if(n!==(r=o))n+=" "+r;else{if(r.toLowerCase().trim()!==l.toLowerCase().trim())return{};n=r}return{id:a||o||r,externalId:a,name:n||o,login:o,email:r,url:t.url,platform:t.platformId,type:f.USER_TYPE}}:function(e,t){var n,a,i;return i=e["dsaccess:groupMemberCount"]||0,n=e["ds6w:label"],n=d.replace(_.groupNameWithNbMembers,{groupName:n,nb:i}),{id:a=(a=e.resourceid).slice(6,a.length-1),name:n,url:t.url,platform:t.platformId,type:f.GROUP_TYPE}})(a,t))}),n)}(t,e);a=a.filter(function(e){return e.id&&!o.find(function(t){return t.id===e.id&&t.type===e.type})}),o=o.concat(a),n(!0)},onFailure:function(){n(!1)},onTimeout:function(){n(!1)},onPassportError:function(){n(!1)}})});n.push(c)}),i.all(n)}).then(function(t){-1!==t.indexOf(!0)?(o.sort(function(e,t){return m.localeCompare(e.name,t.name)}),e.success&&e.success.call(e.scope,o.slice(0,a))):e.failure&&e.failure.call(e.scope)}).catch(function(){e.failure&&e.failure.call(e.scope)})},publish3DNotifications:function(t){return new i(function(n,a){return V._getApplicationConfigurationBoolean("app.notifications.enable")?t.recipients&&t.recipients.length?void function(){function n(n){return new i(function(a){var i={serviceName:V._getServiceName(),user:s.getUser().login,messageId:t.messageId,notificationId:t.notificationId,service:"3DDashboard",uri:t.uri,platformId:n.platformId||V._getGlobalPlatformId(),data:t.data,appId:"X3DDASH_AP",success:function(){a(!0)},failure:function(){e.log("Fail to publish notification."),a(!1)}};n.groupRecipients?i.groupRecipients=n.groupRecipients:i.userRecipients=n.userRecipients,s.publishNotification(i)})}return i.all([(l=f.USER_TYPE,c=t.recipients.filter(function(e){return e.type===l}).map(function(e){return e.login||e.email}),c.length?n({userRecipients:c}).then(function(e){return[e]}):i.resolve([])),(r=f.GROUP_TYPE,d={},t.recipients.forEach(function(e){var t,n;e.type===r&&e.platform&&e.id&&(t=e.platform,n="<uuid:"+e.id+">",d[t]?d[t].push(n):d[t]=[n])}),o=Object.keys(d).map(function(e){return n({platformId:e,groupRecipients:d[e]})}),i.all(o))]).then(function(e){return e[0].concat(e[1])}).catch(a);var o,r,d,l,c}().then(function(e){e.indexOf(!1)>=0?a("Some or all notifications was not sent successfully."):n()}).catch(a):a("No recipients found."):n()})},shareModule:function(t){var n=t.recipients;t.serviceName=V._getServiceName(),t.handler="DS_Dashboard_Notification_Handlers_ShareWidget",t.data={title:t.title,fullTitle:t.fullTitle},e.is(n,"array")&&n.length>0?(t.notificationId="share.widget.setting",t.messageId="share.private.widget.msg",M(t)):s.setPublicNotificationAsync(t)},shareTab:function(t){var n=t.recipients;t.serviceName=V._getServiceName(),t.handler="DS_Dashboard_Notification_Handlers_ShareTab",t.data={title:t.title},e.is(n,"array")&&n.length>0?(t.notificationId="share.tab.setting",t.messageId="share.private.tab.msg",M(t)):s.setPublicNotificationAsync(t)},shareContext:function(t){var n=t.recipients,a=t.modelId,i=V._isEndUserCockpitContext(a);t.serviceName=V._getServiceName(),t.handler=i?"DS_Dashboard_Notification_Handlers_ShareCockpit":"DS_Dashboard_Notification_Handlers_ShareDashboard",t.data={title:t.title},e.is(n,"array")&&n.length>0?(t.notificationId="share.dashboard.setting",t.messageId=i?"share.private.cockpit.msg":"share.private.dashboard.msg",M(t)):s.setPublicNotificationAsync(t)},shareArticle:function(t){t.serviceName=V._getServiceName(),t.handler="DS_Dashboard_Notification_Handlers_ShareArticle",t.data={title:t.title,link:t.link},(t.recipients||[]).length&&(t.to=t.recipients.map(function(e){return e.login}).filter(function(e){return e})),e.is(t.to,"array")&&t.to.length>0?s.setPrivateNotificationAsync(t):s.setPublicNotificationAsync(t)},addModule:function(e){p.track({category:"widget.create",action:"addModule-publicAPI",appId:e.appId,platformId:(e.data||{}).x3dPlatformId});var t=e.coordinates;if("string"!=typeof t){var n=h.getPlatform(),a={};a[n]=V._getDefaultModuleCoordinates()[n],t=JSON.stringify(a)}s.addWidgetInstance({serviceName:V._getServiceName(),widgetIdOrUrl:e.url,appId:e.appId,title:e.title,name:e.title||"",data:e.data||{},coordinates:t,parentId:e.tabId,scope:e.scope,success:function(t){e.success&&e.success(t),o.dispatch(V.events.widget.add,[t[0]])},failure:e.failure})},_getDefaultModuleCoordinates:function(){return{mobile:{col:1,row:1,sizex:1,sizey:4},tablet:{col:1,row:1,sizex:2,sizey:6},desktop:{col:1,row:1,sizex:4,sizey:6}}},_getContextProperties:function(t){var n,a;return n=s.getUserProperty("dashboards"),a=(n=e.is(n)?JSON.parse(n||"{}"):{})[t]=n[t]||{},e.merge(a,{tabs:{}}),e.merge(a.tabs,{}),a},setContextProperties:function(t,n){var a;return a=s.getUserProperty("dashboards"),a=e.is(a)?JSON.parse(a||"{}"):{},e.is(n)?a[t]=n:delete a[t],new i(function(e,t){s.setUserProperty("dashboards",JSON.stringify(a),{serviceName:V._getServiceName(),success:e,failure:t})})},_getContextProperty:function(e,t){return V._getContextProperties(e)[t]},setContextProperty:function(t,n,a){var i=V._getContextProperties(t);return e.is(a)?i[n]=a:delete i[n],V.setContextProperties(t,i)},_getContextPlatformIdProperty:function(e){var t="platformId";return V._isAnyDefaultContext(e)&&(t=t+"."+V._getGlobalPlatformId()),V._getContextProperty(e,t)||""},setContextPlatformIdProperty:function(e,t){var n="platformId";return(t||"")===V._getContextPlatformIdProperty(e)?i.resolve():(V._isAnyDefaultContext(e)&&(n=n+"."+V._getGlobalPlatformId()),V.setContextProperty(e,n,t))},_getTabProperties:function(t){var n,a;return n=s.getUserProperty("dashboards"),n=e.is(n)?JSON.parse(n||"{}"):{},Object.keys(n).forEach(function(e){var i=n[e];Object.keys(i.tabs||{}).forEach(function(e){var n=i.tabs[e];t===e&&(a=n)})}),a||{}},setTabProperties:function(t,n){var a,i,o=s.getUserProperty("dashboards");return o=e.is(o)?JSON.parse(o||"{}"):{},Object.keys(o).forEach(function(e){var n=o[e];Object.keys(n.tabs||{}).forEach(function(n){t===n&&(a=e)})}),a=a||V._getActiveContextModelId(),i=V._getContextProperties(a),e.is(n)?i.tabs[t]=n:delete i.tabs[t],V.setContextProperties(a,i)},_getTabProperty:function(e,t){return V._getTabProperties(e)[t]},setTabProperty:function(t,n,a){var i=V._getTabProperties(t);return e.is(a)?i[n]=a:delete i[n],V.setTabProperties(t,i)},setContextPlatformId:function(e){var t,n=(e=e||{}).platformId||null,a=e.id,o=i.resolve();return t=V.setContextPlatformIdProperty(a,n),n&&!V._isReaderContext(a)&&(o=V.setContextWidgetsPlatformId({id:a,platformId:n,useCache:e.useCache||!1})),i.all([t.catch(function(){}),o]).then(function(){V._isActiveContext(a)&&require("DS/Dashboard/CommentPanelManager").setPlatformId(n||V._getGlobalPlatformId())})},getMaximizedModuleId:function(e){var t,n=e.scope,a=e.tabId||V._getActiveTab().id;(t=V._getTabProperty(a,"lastMaximizedWidgetId"))?m.apply(e.success,n,[t],!0):m.apply(e.failure,n,[],!0)},_getContextThumbnailUrl:function(e){var t,n=V._getContext(e);if(!n)throw new Error("Context not found: "+e);return n.thumbnail?(t=m.buildPath(P,n.type,e,"thumbnail"),t+="?checksum="+n.thumbnail.fingerprint):""},_getContextBackgroundUrl:function(e){var t=e.backgroundId,n=e.modelId;if(n){var a=V._getContext(n);if(!a)throw new Error("Context not found: "+n);t=a.template}return t?m.buildPath(x,t,"image/bg.jpg"):""},setContextBackgroundId:function(e){e=e||{};var t=V._getContext(e.id);s.setContext({serviceName:V._getServiceName(),id:e.id,type:t.type,template:e.bgId,success:e.success,failure:e.failure,scope:e.scope})},setContextBackground:function(t){var n,i,o,r=new FormData;o=(t=t||{}).id,n=t.events||{},i=e.is(n.onFail,"function")?n.onFail:function(){},r.append("template-bg-upload",t.file),a.request(x,{data:r,method:"POST",onComplete:function(e){try{e=JSON.parse(e||"{}")}catch(t){e={}}V.setContextBackgroundId({id:o,bgId:e.id,success:t.success,failure:t.failure})},onFailure:i})},unsetContextBackground:function(e){var t;t=(e=e||{}).failure,V.setContextBackgroundId({id:e.id,bgId:-1,success:function(){a.request(m.buildPath(x,e.bgId),{method:"DELETE",onComplete:e.success,onFailure:t})},failure:t})},setContextThumbnail:function(e){var t=V._getContext(e.id);t?s.setContextThumbnail({type:t.type,modelId:e.id,file:e.file,success:e.success,failure:e.failure}):m.apply(e.failure,e.scope,[new Error("Context not found: "+e.id)])},unsetContextThumbnail:function(e){var t=V._getContext(e.id);t?s.removeContextThumbnail({type:t.type,modelId:e.id,success:e.success,failure:e.failure}):m.apply(e.failure,e.scope,[new Error("Context not found: "+e.id)])},setContextWidgetsPlatformId:function(e){var t,n=e.platformId,a=e.id;return n&&a?(t=V._getContext(e.id))?new i(function(n,o){c.getWidgetInstanceContextTree({serviceName:V._getServiceName(),id:T,contextId:a,contextType:t.type,depth:5,cacheId:!1===e.useCache?Date.now():void 0,success:function(t){var a=[];(t.children||[]).forEach(function(t){(t.children||[]).forEach(function(t){var n,o;try{n=JSON.parse(t.data)}catch(e){return}n.x3dPlatformId=e.platformId,a.push((o={id:t.id,widgetId:t.widgetId,data:n,parentId:t.parentId},new i(function(e,t){o.success=e,o.failure=t,o.serviceName=V._getServiceName(),c.editWidgetInstance(o)})))})}),i.all(a).then(n).catch(o)},failure:o})}):i.reject(new Error("Context not found: "+e.id)):i.reject("Missing mandatory options.")},_getApplicationConfigurationBoolean:function(e){return"true"===(s.getApplicationConfiguration(e)||"").toLowerCase()},_getCurrentMode:function(){return V.currentMode},_setCurrentMode:function(e){V.currentMode=e||"standalone"},_getServiceName:function(){return V.serviceName||""},_setServiceName:function(e){V.serviceName=e||"",V.initContextApiBaseUrl({sendEvent:!0})},fetchHelpInfo:(L=[],U=!1,O={},function(e){var t=O[e||""];return!e||t?i.resolve(t):U?new i(function(e){L.push(function(t){e(t)})}):(U=!0,new i(function(t){a.request(e,{method:"GET",type:"json",onComplete:function(n){O[e]=n,t(n)},onFailure:function(){t()}})}).then(function(e){return U=!1,L.forEach(function(t){t(e)}),L=[],e}).catch(function(){throw U=!1,new Error}))}),fetchHelpCustomUrl:function(){return e.is(W,"string")?i.resolve(W):b.getServiceUrl({serviceName:b.serviceNames.help}).then(function(t){return Array.isArray(t)&&(W=(t.filter(function(e){return e.url})[0]||{}).url),W||(e.log("x3dhelp service url is empty."),"")}).catch(function(){return e.log("Fail to get the help custom url."),""})},_shouldShowWidgetPlatformInfo:function(e){var t=e.getValue("x3dPlatformId"),n=e.getValue("tenantAware");return!!((V._getApplicationConfigurationBoolean("app.feature.widget-tenant-icon.enabled")||"widget-tenant-icon"in m.getParsedQuery())&&n&&t)},fetchAllPlatformAwareUrls:function(){return b.getPlatformServices({serviceName:b.serviceNames.dashboard,config:{myAppsBaseUrl:g.getMyAppsBaseUrl(),lang:dsLang,userId:window.dsUserExternalId}}).then(function(e){return V._isDevProfile()?e:V._getApplicationConfigurationBoolean("app.build.isCloud")?e.filter(function(e){return s.isPlatformAwareUrl(e["3DDashboard"])}):e})},redirectToPlatformAwareUrl:function(e){var t,a=e.url,o=e.platformId,r=e.clearAnchor,s=e.replaceLocation,d=n.parseUrl(window.location.href);if(V._isDevProfile()){if(!o)return i.reject("Missing platform id");var l=d.query?m.getParsedQuery(d.query):{};V._getApplicationConfigurationBoolean("app.build.isCloud")&&(l._gpid=e.platformId,d.query=n.toQueryString(l)),r&&(d.anchor=""),t=n.composeUrl(d)}else{if(!a)return i.reject("Missing platform url");t=a+(d.query?"?"+d.query:"")+(!r&&d.anchor?"#"+d.anchor:"")}return s?window.location.replace(t):window.location.assign(t),i.resolve()},_isDevProfile:function(){return"development"===s.getApplicationConfiguration("app.profile")},getCollabspaceAndCredential:(N={},function(e){var t,n,a,o,r=e.xPrefCredential,s=e.platformId,d=N[s+"."+r];return s&&r?d?i.resolve(Object.assign({},d)):3!==(t=r.split(".").filter(function(e){return e})).length?i.reject({code:"invalid-xPrefCredential"}):(n=t[0],a=t[1],o=t[2],V.fetchCollabspaces(e).then(function(e){var t,i;(t=e.find(function(e){return e.name===o||e.pid===o}))?i=t.couples.find(function(e){var t=(e=e||{}).organization||{},i=e.role||{};return!(t.name!==a&&t.pid!==a||i.name!==n&&i.pid!==n)}):t={name:o,title:o},i||(i={organization:{name:a,title:a},role:{name:n,nls:n}});var d={collabspace:t,credential:i};return N[s+"."+r]=d,Object.assign({},d)}).catch(function(e){throw"not-found"===(e=e||{}).code&&(e.collabspaceName=o,e.organizationName=a,e.roleName=n),e})):i.reject({code:"missing-mandatory-options"})}),fetchCollabspaces:function(e){return e.platformId?b.getServiceUrl({serviceName:b.serviceNames.space,platformId:e.platformId}).then(function(e){return new i(function(t,n){var a=m.buildPath(e,"/resources/modeler/pno/person?current=true&select=collabspaces");r.authenticatedRequest(a,{method:"GET",type:"json",headers:u.getDefaultHeaders({lang:d.getCurrentLanguage()}),onComplete:function(e){t((e||{}).collabspaces||[])},onFailure:function(e){(e=e||{}).code="not-found",n(e)}})})}):i.reject("Missing mandatory options.")},_isBusinessExpFeatureEnabled:function(){return V._getApplicationConfigurationBoolean("app.feature.business-experience.enabled")||"businessExpFeatureEnabled"in m.getParsedQuery()},isSWAFeatureEnabled:(k=null,function(){if("boolean"==typeof k)return i.resolve(k);if(w.isBELayoutEditorMode())return k=!1,i.resolve(k);var e,t=(s.getApplicationConfiguration("app.feature.swa.enabledby.ug")||"").split("@"),n=t[0],a=t[1];if(k=V._getApplicationConfigurationBoolean("app.feature.swa.enabled")||"swaFeatureEnabled"in m.getParsedQuery())e=i.resolve(k);else{if(!n)return i.resolve(k);e=v.isMember({userId:s.getCachedCurrentUser().externalId,ugId:n,ugPlatformId:a,platformId:V._getGlobalPlatformId()}).then(function(e){return k=e})}return e}),DASHBOARD_TYPE:"dashboard",BUSINESS_EXP_INSTANCE_TYPE:"business-experience-instance",COCKPIT_TYPE:"cockpit",BUSINESS_EXP_LAYOUT_TYPE:"business-experience-layout",EMPTY_TEMPLATE_TYPE:I,ACCESS_TYPE:"restricted",EMPTY_TEMPLATE_MODEL_ID:S,FIRST_TEMPLATE_MODEL_ID:y,TEMPLATE_BLACKLIST:E,CONTEXT_WIDGET_INSTANCE_ID:T,CONTEXT_WIDGET_ID:"7v_264iAwqKOGqc1RW1Z",TAB_WIDGET_ID:"8KqyNGD_00012RwEeGAd",DASH_NAME_MAX_LENGTH:A,DASH_DESC_MAX_LENGTH:251,TAB_NAME_MAX_LENGTH:A,STARTER_ROLE:"_starter_",STANDALONE_MODE:"standalone",MY3DEXPERIENCE_MODE:"My3DExperience",SERVICE_NAME_3DD:"3DDashboard",ON_PREMISE_PLATFORM_ID:"OnPremise"};return V}),define("DS/Dashboard/Views/DashboardSettingsViews/PlatformSectionView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/Dashboard/Navigation","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker","DS/PubSub/PubSub","i18n!DS/Dashboard/assets/nls/views","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l){"use strict";return t.extend({PLATFORM_ID_KEY:"platformId",className:"platform-section section",tagName:"div",parentView:null,setup:function(e){this.parentView=e.parentView},render:function(){return this._build(),r.track({category:"manageDashboard.tenant",action:"render"}),this},destroy:function(){this._platforms=null,this.parentView=null,this._parent.apply(this,arguments)},showNotif:function(){this.parentView.showNotif.apply(this.parentView,arguments)},hideNotif:function(){this.parentView.hideNotif.apply(this.parentView,arguments)},_build:function(){var t=this.elements,a=this.container,i=this.model.get("modelId"),r=o._getContextPlatformIdProperty(i);t.enableSettingToggle=new n({type:"switch",label:d.platformActivateToggle,checked:!!r,events:{onChange:this._onEnableSettingToggleChange.bind(this)}}),t.elsCtn=e.createElement("div",{html:[t.enableSettingToggle]}),a.addContent([{tag:"div",class:"section-title",text:d.platformSectionTitle},{tag:"div",class:"section-content",html:[t.elsCtn]}])},_onEnableSettingToggleChange:function(){var e=this;r.track({category:"manageDashboard.tenant",action:"activateToggleChange"});var t=e.container,n=e.elements.enableSettingToggle.isChecked()?o._getGlobalPlatformId():null,i=e.model.get("modelId");return e.hideNotif(),a.mask(t,l.loadingMessage),o.setContextPlatformId({id:i,platformId:n}).then(function(){o._isActiveContext(i)&&s.dispatch(o.events.dashboard.refresh),a.unmask(t)}).catch(function(){return a.unmask(t),e.showNotif({msg:l.errorTryLater}),Promise.reject()})},_isAdminDashboard:function(e){return[i.getPlatformManagementId(),i.getMembersManagementId()].includes(e)},onFacetSelect:function(){r.track({category:"manageDashboard.tenant",action:"facetSelect"})}})}),define("DS/Dashboard/Collections/Tabs",["UWA/Core","UWA/Class/Collection","DS/Dashboard/PublicAPI","DS/Dashboard/Models/Tab"],function(e,t,n,a){"use strict";return t.extend({model:a,dashboardId:null,setup:function(e,t){t.dashboard&&(this.dashboardId=t.dashboard.get("modelId"))},fetch:function(){var e=this,t=e.dashboardId;t&&n.getAllTabsData({modelId:t}).then(function(t){e.reset(e.parse(t))})},parse:function(t){var n=[];return t&&e.is(t,"array")&&t.forEach(function(e){n.push({title:e.name,order:e.coordinates,wiId:e.id,wiData:e.data})}),n}})}),define("DS/Dashboard/Collections/MyDashboards",["UWA/Class/Collection","DS/Dashboard/PublicAPI","DS/Dashboard/Models/Dashboard"],function(e,t,n){"use strict";return e.extend({model:n,tags:{},setup:function(e,t){t=t||{},this.actions=t.actions},fetch:function(e){var n=(e=e||{}).onComplete,a=e.reset?"reset":"set",i=t._getAllContexts("name","asc").filter(function(e){return!t._isFavouriteContext(e)});e.parse=!0,this[a](i,e),n&&n(this,i,e)},parse:function(e){var t=this;return(e=e||[]).forEach(function(e){e.actions=t.actions,e.contextId=e.id}),e}})}),define("DS/Dashboard/Views/My3DExperience/TabList",["UWA/Core","UWA/Class/View","DS/UWPClientControls/EditableTabview","DS/PubSub/PubSub","DS/Dashboard/PublicAPI"],function(e,t,n,a,i){"use strict";function o(t){function a(e){return"object"!=typeof e?e:((d.tabs.indexOf(e)>-1?d:t)===d?t:d).tabs.filter(function(t){return t.options.id===e.options.id})[0]}function i(e){return"object"==typeof e&&e.options?(e.options.rendered=!0,e):e}function o(e){!function(e){["show","hide"].forEach(function(t){var n=e[t];e[t]=function(){return a(e)[t](),n.call(e)}})}(e),function(e){var t=a(e);["setText","setName"].forEach(function(n){var a=e[n],i=t[n];e[n]=function(n){return i.call(t,n),a.call(e,n)},t[n]=function(n){return a.call(e,n),i.call(t,n)}})}(e),function(e){var t=a(e);e.menu.options.target=t.menu.options.target,e.menu.options.renderTo=t.menu.options.renderTo,t.menu.destroy(),t.elements.action.addEventListener("click",function(){e.menu.toggle()})}(e)}function r(t){var n=e.merge({el:e.createElement("div")},e.clone(t.item,!1));return{id:t.id,name:t.name,text:t.text,item:n}}var s=t.options.events.onReorderTabs;t.options.events.onReorderTabs=function(){return t.tabs=d.tabs.map(function(e){return a(e)}),s.call(this,arguments)};var d=new n(t.options);d.elements.contentNode.hide(),t.elements.scrollerContainer.hide(),t.elements.scrollerContainer.show=function(){},t.tabs.forEach(function(e){d.addTab(r(e.options)),o(e),t.selectedTab===e&&(t.selectTab(e),d.selectTab(i(a(e))))});var l=d.selectTab;d.selectTab=function(e,n){c.call(t,a(e),n),l.call(d,i(e),n)};var c=t.selectTab;t.selectTab=function(e,n){l.call(d,i(a(e)),n),c.call(t,e,n)};var u=t.removeTab;t.removeTab=function(e){d.removeTab(e),u.call(t,e)};var h=t.addTab;t.addTab=function(e){d.addTab(r(e)),h.call(t,e),o(t.tabs[t.tabs.length-1])};var m=t.enableTab;return t.enableTab=function(e,n){d.enableTab(a(e),n),m.call(t,e,n)},d}var r=t.extend({setup:function(){var e;r._bootstrapped||(e=this.container,a.add(i.events.dashboard._loaded,function(){var t=i._getActiveContextWidget();t&&(e.empty(),o(t.layout).inject(e))}),r._bootstrapped=!0)}});return r}),define("DS/Dashboard/Navigation/Cockpit",["UWA/Core","UWA/Promise","UWA/Utils","DS/UWPClientCode/PublicAPI","DS/UWPClientCode/I18n","DS/UWPClientControls/PlatformNotify","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/navigation","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o,r,s,d,l,c){"use strict";function u(e){var t=!0;if(e.active){if(!s.getUrlParameter(s.parts.tab)){var a=r._getActiveContextWidget(),i=a&&a.layout,o=i&&i.options,l=o&&o.currentTab,c=l&&l.options,u=c&&c.text;s.routeTo({cockpit:e.modelId,keepAll:!0,tab:n.encodeUrl(u||"")})}}else r._setActiveContext(e.modelId),d.track({category:"dashboard.read",action:"loadingWithParameter-dashboardNavigation"}),t={shouldChangeCard:!0};return t}function h(){var e,t=r._getContext(r._getLastOpenedContextId());return t&&!t.disabled?(s.routeTo({cockpit:t.modelId,keepAll:!0}),void d.track({category:"dashboard.read",action:"loadingLast-dashboardNavigation"})):(e=r._getAllContexts())&&e.length>0?(s.routeTo({cockpit:e[0].modelId,keepAll:!0}),void d.track({category:"dashboard.read",action:"loadingFirstFound-dashboardNavigation"})):void 0}function m(t){var n,i=s.getUrlParameter(s.parts.cockpit);if(!s.hasPart(s.parts.east))return e.log("No east parameter found in hash, break navigation here."),t(!1);i?(n=r._getContext(i))?t(u(n)):a.getContextsBy({platforms:[r._getGlobalPlatformId()],unMerged:!0,serviceName:r._getServiceName(),success:function(e){(n=(e||[]).filter(function(e){return e.modelId===i})[0])?t(u(n)):(o.error(l.navigationFailedDashboard),h(),t(!0))},failure:function(){o.error(l.fetchingFailedDashboard),h(),t(!0)}}):(h(),t(!0))}return{isAccessible:function(){return new t(m)}}}),define("DS/Dashboard/Navigation/Dashboard",["UWA/Promise","UWA/Utils","DS/PubSub/PubSub","DS/UWPClientCode/PublicAPI","DS/UWPClientControls/PlatformNotify","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/UsageTracker","DS/Dashboard/UIKITUtils","i18n!DS/Dashboard/assets/nls/navigation"],function(e,t,n,a,i,o,r,s,d,l){"use strict";function c(n){var a=!0;if(n.active){if(!r.getUrlParameter(r.parts.tab)){var i,l=o._getActiveContextWidget(),c=l&&l.layout,u=c&&c.options,h=u&&u.currentTab,m=h&&h.options,g=m&&m.text,f=o._getActiveTab(),p={keepAll:!0,tab:t.encodeUrl(g||"")};f&&(i=(((f.environment||{}).wp||{}).children||[]).find(function(e){var t=(e.widget||{}).environment;return t&&t.isFullscreen()}))&&(p.fullscreen=i.id),r.routeTo(p)}}else{if(a={shouldChangeCard:!0},s.track({category:"dashboard.read",action:"loadingWithParameter-dashboardNavigation"}),!n.platform&&n.owner)return o.fetchAllPlatformAwareUrls().then(function(t){return(t.length>1?(a={platforms:t,dashboard:n},new e(function(e,t){require(["DS/Dashboard/Modals/PlatformSelect","i18n!DS/Dashboard/assets/nls/modal","DS/UWPClientCode/I18n"],function(t,n,i){t.show({message:i.replace(n.platformSelectInDashboardContent,{dashboard:a.dashboard.name}),title:n.platformSelectTitleforDashboard,closable:!1,platforms:a.platforms,onConfirm:e})},t)})):e.resolve(t[0])).then(function(e){return d.maskBody(),o.setContextPlatform({modelId:n.modelId,platformId:e.platformId}).then(function(){return o.redirectToPlatformAwareUrl({platformId:e.platformId,url:e[o.SERVICE_NAME_3DD],replaceLocation:!0})})});var a}).then(function(){return d.unmaskBody(),o._setActiveContext(n.modelId),a});o._setActiveContext(n.modelId)}return e.resolve(a)}function u(){var e,t=o._getContext(o._getLastOpenedContextId());return t&&!t.disabled?(r.routeTo({dashboard:t.modelId,keepAll:!0}),void s.track({category:"dashboard.read",action:"loadingLast-dashboardNavigation"})):(e=o._getAllContexts())&&e.length>0?(r.routeTo({dashboard:e[0].modelId,keepAll:!0}),void s.track({category:"dashboard.read",action:"loadingFirstFound-dashboardNavigation"})):void 0}function h(e){var t,s=r.getUrlParameter(r.parts.dashboard);if(s){if(t=o._getContext(s))return o._isBusinessExpLayoutContext(t)&&!r.isBELayoutEditorMode()?(r.routeTo({keepAll:!0,params:{belayouteditor:!0}}),void e(!1)):void c(t).then(e);a.getContextsBy({platforms:[o._getGlobalPlatformId()],unMerged:!0,serviceName:o._getServiceName(),success:function(a){if(t=(a||[]).filter(function(e){return e.modelId===s})[0])return n.dispatch(o.events.dashboard.add,[t]),c(t).then(e);i.error(l.navigationFailedDashboard),u(),e(!0)},failure:function(){i.error(l.fetchingFailedDashboard),u(),e(!0)}})}else u(),e(!0)}return{isAccessible:function(){return new e(h)}}}),define("DS/Dashboard/Collections/BusinessExperienceInstances",["DS/Dashboard/PublicAPI","DS/Dashboard/Models/Dashboard","DS/Dashboard/Collections/DashboardsAbstract"],function(e,t,n){"use strict";return n.extend({model:t,tags:{},setup:function(e,t){t=t||{},this.actions=t.actions},fetch:function(t){var n=(t=t||{}).onComplete,a=t.reset?"reset":"set",i=e._getAllBusinessExpInstanceContexts("name","asc");t.parse=!0,this[a](i,t),n&&n(this,i,t)},parse:function(e){var t=this;return(e=e||[]).forEach(function(e){e.actions=t.actions,e.contextId=e.id}),e}})}),define("DS/Dashboard/WidgetLinkManager",["UWA/Core","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/UWPClientCode/PublicAPI","DS/Dashboard/PublicAPI","DS/Dashboard/Utils","DS/Dashboard/Navigation","DS/WidgetLink/WidgetLinkData","DS/WidgetLink/AbstractWidgetLink","DS/WidgetLink/WidgetLink","DS/WidgetLink/WidgetLinkView","DS/WidgetLink/ExternalWidgetLink"],function(e,t,n,a,i,o,r){"use strict";var s,d,l={},c=new WeakMap,u=new WeakMap,h=new Set,m="widget-link",g="linkedWidgets";function f(t){var n=i._getTabByModuleId(t);return n?n.widget:e.Widgets.instances.find(function(e){return(e.environment.wp.children||[]).find(function(e){return e.id===t})})}function p(e){return"8KqyNGD_00012RwEeGAd"===e.environment.wp.widgetId}function b(e){return e.id.startsWith("preview")}function v(e){return e.environment.wp.parent&&p(e.environment.wp.parent.widget)}function w(e){var t=e&&o.getRegisteredWidgetInstance(e);return!(!t||!c.has(t))}function D(e){e.forEach(function(e){o.getRegisteredWidgetInstance(e.id)&&h.add(e.id)})}function _(e){var t,n=o.getRegisteredWidgetInstance(e);return n?n.data:(t=i.getActiveTab().environment.wp.children.find(function(t){return t.id===e}))?C(t):{}}function C(e){return JSON.parse(e.data||"{}")}function I(e){return C(e).x3dSharedId}function S(e){var t={};function n(e,n){t[e]=(t[e]||[]).concat([n])}return e.forEach(function(e){n(e[0],e[1]),n(e[1],e[0])}),t}function y(e){return S(e.getValue(g)||[])}function E(e,t){e.setValue(g,function(e){var t=[];return e=Object.fromEntries(Object.entries(e).map(function(e){return[e[0],e[1].slice()]})),Object.keys(e).forEach(function(n){e[n].forEach(function(a){t.push([n,a]),e[a].splice(e[a].indexOf(n),1)})}),t}(t))}function T(e,n,a,o){o=Object.assign({source:n,target:a},o),("link"===e?d.onLink:d.onUnlink)(o),t.dispatch(i.events.widget["_"+e],[o])}function A(e,t,a){n.publish({channel:m,topic:e,data:{ids:[t,a]}})}function P(e,t,n){T("link",e,t,n),w(e)&&w(t)?A("link",e,t):w(e)&&!w(t)?c.get(o.getRegisteredWidgetInstance(e)).add(t):!w(e)&&w(t)&&c.get(o.getRegisteredWidgetInstance(t)).add(e)}function x(e,t,n){T("unlink",e,t,n),(w(e)||w(t))&&A("unlink",e,t)}function M(e){n.publish({channel:m,topic:"destroy",data:{ids:e}})}function k(e,t){return(t=t||f(e))&&y(t)[e]||[]}function N(e){var t=e.id,n=e.tab||f(t),a=Object.fromEntries(e.states),i=y(n),o=i[t]||[],r=[];Object.keys(a).forEach(function(n){var s=i[n]||[],d=o.indexOf(n),l=s.indexOf(t),c=!1,u=!1;a[n]?(-1===d&&(o.push(n),c=!0),-1===l&&(s.push(t),c=!0),c&&r.push([P,t,n,{cause:e.cause}])):(-1!==d&&(o.splice(d,1),u=!0),-1!==l&&(s.splice(l,1),u=!0),u&&r.push([x,t,n,{cause:e.cause,reason:e.reason}])),0===s.length?delete i[n]:i[n]=s}),0===o.length?delete i[t]:i[t]=o,E(n,i),r.forEach(function(e){e[0].apply(null,e.slice(1))})}function W(e,t,n){N({id:t,tab:n,states:k(t,n).map(function(e){return[e,!1]}),cause:e}),M([t])}function L(e,t){var n="string"==typeof e,a=n?i.getActiveTab():e,o=a.environment.wp.children||[],r=new Map;!t&&a.getValue(g)||(o.forEach(function(t){var a=I(t);!a||n&&a!==e||r.set(a,(r.get(a)||[]).concat([t.id]))}),r.forEach(function(e){e.forEach(function(t,n){e.slice(n+1).forEach(function(e){s.matchLinkability(_(t),_(e)).overall&&N({id:t,tab:a,states:[[e,!0]],cause:"multiwidget app"})})})}))}function U(t,n){var a,i=b(t)&&t.environment.wp.parent.widget;i&&(!n&&(i.getValue(g)||[]).length>0||(a=e.Widgets.instances.filter(function(e){return e.id&&(e.environment.wp.parent||{}).widget===i}).map(function(e){return e.id}),(i.environment.wp.children||[]).length===a.length&&L(Object.assign(Object.create(i),{environment:{wp:{children:i.environment.wp.children.map(function(e,t){return Object.assign({id:a[t]},e)})}}}),!0)))}return s={init:function(e){r.isAddinMode()||r.isLockedAppMode()||(d={onChangeLinkability:(e=e||{}).onChangeLinkability||function(){},onLink:e.onLink||function(){},onUnlink:e.onUnlink||function(){}},t.add(i.events.environment._widgetInstanceReady,function(e){if(v(e))return function(e){c.set(e,new Set),k(e.id).map(o.getRegisteredWidgetInstance).filter(function(e){return!!e}).forEach(function(t){var n=c.get(t)||new Set;n.has(e.id)&&(A("link",t.id,e.id),n.delete(e.id))})}(e),U(e),void function(e){u.set(e,s.getLinkable(e.id).sort())}(e);var t;p(e)&&(l[(t=e).id]&&(l[t.id](t),delete l[t.id],1)||(L(e),function(e){var t=y(e);Object.keys(t).forEach(function(n){(e.environment.wp.children||[]).find(function(e){return e.id===n})||(t[n].forEach(function(e){t[e].splice(t[e].indexOf(n),1)}),delete t[n])}),E(e,t)}(e)))}),t.add(i.events.environment._tentativeChangeLinkability,function(e){w(e.id)&&v(e)&&function(e){var n,a,o,r,l,c=!1;n=u.get(e),a=s.getLinkable(e.id).sort(),o=k(e.id);for(var h=0;h<Math.max(n.length,a.length);++h)if(n[h]!==a[h]){c=!0;break}c&&(u.set(e,a),r={source:e.id},d.onChangeLinkability(r),t.dispatch(i.events.widget._changeLinkability,[r]),o.forEach(function(t){n.includes(t)&&!a.includes(t)&&N({id:e.id,states:[[t,!1]],cause:"linkability change"})}),(l=_(e.id).x3dSharedId)&&(b(e)?U(e):L(l,!0)))}(e)}),t.add(i.events.tab.refresh,function(e){D(e.options.item.children),M(e.options.item.children.map(function(e){return e.id}))}),t.add(i.events.widget.add,function(e){var t=I(e);t&&L(t,!0)}),t.add(i.events.widget.remove,function(e){if(p(e))return D(e.environment.wp.children),M(e.environment.wp.children.map(function(e){return(e.widget||{}).id}).filter(function(e){return e}));var t;v(e)&&(t=e.id,!h.has(t)||(h.delete(t),0))&&0!==k(e.id).length&&W("removal",e.id)}),t.add(i.events.widget.switchTab,function(e,t){0!==k(e.id,t.previousTab).length&&W("relocation",e.id,t.previousTab)}),n.subscribe({channel:m,topic:"force-unlink",callback:function(e){N({id:e.source,states:[[e.target,!1]],cause:"forced unlink",reason:e.reason})}}))},fixLinkability:function(e){function t(e){return"string"==typeof e}var n={open:!1,appIds:[],implements:[],uses:[]};return e&&"object"==typeof e?{open:"boolean"==typeof e.open?e.open:n.open,appIds:Array.isArray(e.appIds)?e.appIds.filter(function(e){return function(e){var t=/[A-Z][A-Z0-9]{3,8}_AP/.test(e),n=/MAP-[A-Z]{3,10}/.test(e);return t||n}(e)}):n.appIds,implements:Array.isArray(e.implements)?e.implements.filter(t):n.implements,uses:Array.isArray(e.uses)?e.uses.filter(t):n.uses}:Object.assign({},n)},matchLinkability:function(e,t){function n(e,t){return e.implements.filter(function(e){return t.uses.find(function(t){return e===t})})}var a={},i=s.fixLinkability(e.x3dLinkability),o=s.fixLinkability(t.x3dLinkability);return a.matchingImplements=n(i,o),a.matchingUses=n(o,i),a.matchingFeatures=a.matchingImplements.concat(a.matchingUses),a.byImplements=a.matchingImplements.length>0,a.byUses=a.matchingUses.length>0,a.byFeature=a.matchingFeatures.length>0,a.byAppId=function(e,t,n,a){return t.appIds.includes(n)&&a.appIds.includes(e)||t.open&&a.appIds.includes(e)||a.open&&t.appIds.includes(n)}(e.appId,i,t.appId,o),a.overall=a.byFeature||a.byAppId,a},getLinkable:function(e){var t=_(e),n=f(e);return n?n.environment.getChildren().filter(function(n){var a=(n.widget||{}).id;return!(!a||a===e)&&s.matchLinkability(t,_(a)).overall}).map(function(e){return(e.widget||{}).id}):[]},getLinked:function(e){return k(e)},setLinked:function(e,t){N({id:e,states:Object.entries(t),cause:"user"})},copyLinked:function(e){return Promise.all([(n=e.sourceId,new Promise(function(e,t){a.getWidgetInstance({serviceName:i._getServiceName(),id:n,success:e,failure:t})})),(t=e,new Promise(function(e){l[t.id]=e}))]).then(function(t){var n=t[0];E(t[1],function(e,t){var n,a={},i={};return(e.children||[]).forEach(function(e,n){i[e.id]=(t.children||[]||[])[n].id}),n=S(C(e)[g]||[]),Object.keys(n).forEach(function(e){a[i[e]]=n[e].map(function(e){return i[e]})}),a}(n,e))});var t,n}}}),define("DS/Dashboard/WidgetPreviewManager",["DS/PubSub/PubSub","DS/TransientWidget/TransientWidget","DS/TransientWidget/Tool/TransientMessaging","DS/TransientWidget/Tool/Mapping","DS/WidgetPreview/Controller/TransientManager","DS/Dashboard/Navigation","DS/Dashboard/PublicAPI","DS/Dashboard/CompassManager"],function(e,t,n,a,i,o,r,s){"use strict";var d,l,c=!1,u=!1,h=null,m=[],g=(l=[],{getAll:function(){return l},add:function(e){l.push(e)},remove:function(e){var t=l.indexOf(e);t>=0&&l.splice(t,1)},getPrevious:function(){return l[l.length-1]}});return d={init:function(){c=o.isAddinMode(),u=o.isLockedAppMode(),h=i.getInstance({addinMode:o.getAddinModeValue(),lockedAppMode:u}),d._initEvents()},getOpened:function(){return m||[]},hasOpened:function(){return!!d.getOpened().length},getActiveAppId:function(){return h.activeAppId},getUpdatedStartingData:function(e){return h.getUpdatedStartingData(e)},show:function(e){t.showWidget(e.appId,"",e.data)},close:function(t){var n=(m.filter(function(e){return e.active})[0]||{}).appId||(m[0]||{}).appId,a=t||n;if(m=m.filter(function(e){return e.appId!==a}),g.remove(a&&"default"!==a?a:g.getPrevious()),h.closeWidget({appId:a||"default"}),a)if(m.length){var i=g.getPrevious();d.switchTo(a===n?i:"default"===n?g.getAll()[0]:n)}else e.dispatch(r.events.preview.close)},switchTo:function(e){var t,n,a=h,i=a.getUpdatedStartingData(e);function r(t){o.routeTo({keeps:["app","content"],app:e,content:"URLTransientData="+t})}function s(){a.showWidget({appId:e,title:"",data:{}})}m.forEach(function(t){t.active=e===t.appId||1===m.length}),o.getUrlParameter(o.parts.app)===e?s():!function(e){try{return JSON.stringify(e),!0}catch(e){return console.warn("Widget data cannot be processed"),!1}}(i)?r(""):(t=encodeURIComponent(JSON.stringify(i)),n=o.buildAppUrl({appId:e,data:i}),o.buildLogoutUrl(n).length>8e3?s():r(t))},_initEvents:function(){var t;(t=n.getInstance()).on(a.TransientMessaging.ShowWidget,function(t){var n=s.appIds.x3DSearch,a=t.appId,i=g.getPrevious(),o=m.map(function(e){return e.appId}),d="panel"===(t.options||{}).mode;c||a===n?g.remove(a):g.remove(g.getAll().find(function(e){return e!==a&&e!==n})),g.add(a),m.forEach(function(e){e.active=-1===o.indexOf(e.appId)||e.appId===a}),h.showWidget(t),d||e.dispatch(r.events.preview.show,{isSameApp:a===i})}),t.on(a.TransientMessaging.CloseWidget,function(e){d.close(e&&e.appId)}),t.on(a.TransientMessaging.Show,function(){h.show()}),t.on(a.TransientMessaging.Hide,function(){h.hide()}),t.on(a.TransientMessaging.AddModule,function(e){h.addModule(e)}),t.on(a.TransientMessaging.AddModules,function(e){h.addModules(e)}),t.on(a.TransientMessaging.T3DNotification,function(e){var t=(e=e||{}).action,n=e.data&&e.data.url||"",a=h.isWidgetOpen(),i=function(e){return e.indexOf("#app:")>-1?e.split("#app:")[1].split("/")[0]:""}(n),r=a?o.getUrlParameter(o.parts.app):"";"refresh"===t&&n&&(a&&r===i?h.refresh():window.location.assign(n))}),e.add(a.Events.PreviewTopBarUpdate,function(t){e.dispatch(r.events.preview.updateTopBarProviders,t)}),e.add(a.Events.PreviewWidgetLoaded,function(t){if(!t.isContainer){var n=t.id,a=r._getWidget(n);a&&(a.environment.isFloat()||e.dispatch(r.events.preview.loaded,n))}}),e.add("onShowMultiApp",function(){d._updateTransients({appId:h.activeAppId,title:"",data:{}})}),e.add("onViewChange",function(e){var t=e.id;0===t.indexOf("preview")&&d._updateTransients({widgetId:t})})},_updateTransients:function(e){var t=e.appId,n=e.widgetId,a=e.title,i=e.data;if(t||(t=h.activeAppId||"",e.appId=t),n){var o=(r._getWidget(n)||{}).environment,d=(o||{}).wp;a||(o&&(a=o.getName()||o.getTitle()),e.title=a),i||(d&&(i=d.data||{}),e.data=i)}m.reduce(function(e,n){return e||n.appId===t},!1)||(m.push(e),c&&s.showHideCloseBtn({show:!0})),m.forEach(function(e){e.active=t===e.appId||1===m.length})}}}),define("DS/Dashboard/ManageDashboardManager",["DS/PubSub/PubSub","DS/Dashboard/PublicAPI"],function(e,t){"use strict";var n,a,i=!1;function o(){return a?Promise.resolve(a):new Promise((e,t)=>{require(["DS/Dashboard/ManageDashboard/ManageDashboard"],function(t){e(a=t)},t)})}return n={init:function(){n._initEvents()},open:function(e){return e=e||{},o().then(function(t){return t.open({refresh:"boolean"!=typeof e.refresh||e.refresh,dashboardId:e.contextModelId,facet:e.facet,showPreviousState:"boolean"==typeof e.showPreviousState&&e.showPreviousState})})},close:function(){var e;return i&&(e=o().then(function(e){e.close()})),e||Promise.resolve()},isOpen:function(){return i},_initEvents:function(){e.add(t.events.manageDashboard.open,function(){i=!0},null,!0),e.add(t.events.manageDashboard.close,function(){i=!1},null,!0)}}}),define("DS/Dashboard/TopBar/API",["DS/TopBar/TopBar","DS/UWPClientCode/PublicAPI","DS/Dashboard/PublicAPI","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a){"use strict";var i,o=!1,r=!0,s=!1;return i={getTitleName:function(){return e.getTitleName()},getTitleMenuElement:function(){return e.getTitleMenuElement()},getTitleMenuAppMenuElement:function(){return i.getTitleMenuElement().getElement(".topbar-app-menu")},setBrand:function(t){e.set({brand:t||""})},setApplication:function(t){e.set("application",t)},setPlatformId:function(t,a){a&&e.set("tenantId",""),"string"!=typeof t&&(t=n._getGlobalPlatformId()||""),e.set("tenantId",t)},setCollabspaceId:function(t){var n=(t=t||{}).collabspaceId;!n&&t.xPrefCredential&&(n=t.xPrefCredential.split(".")[2]),e.set("collabSpaceId",n||"")},setDisableUserContextDropdown:function(t){e.set("disableUserContextDropdown",!!t)},setReadOnlyUserContext:function(t){e.set("readOnlyUserContext",!!t)},setUserName:function(n){return n=n||{},t.getCurrentUser({refresh:!!n.forceRefresh}).then(function(t){var n,a,i;n=t.firstName,a=t.lastName,i=n&&a?n+" "+a:t.login||"",e.set({userName:i})})},showExitFullscreenButton:function(){o||(o=!0,e.setExtraButtonOptions({tooltip:a.exitFullscreenHTMLItem,fonticon:"fullscreen-off-icon fonticon-resize-fullscreen-off"}),e.toggleExtraButton())},hideExitFullscreenButton:function(){o&&(o=!1,e.toggleExtraButton())},hideAddinModeCloseBtn:function(){r&&(r=!1,e.toggleAddinModeButton())},showAddinModeCloseBtn:function(){r||(r=!0,e.toggleAddinModeButton())},showFilteredFullscreenIcon:function(t){t=t||{},e.toggleFilterExtraButton&&(s||(s=!0,e.toggleFilterExtraButton()),e.setFilterExtraButtonOptions({tooltip:t.tooltip}))},hideFilteredFullscreenIcon:function(){e.toggleFilterExtraButton&&s&&(s=!1,e.toggleFilterExtraButton())}}}),define("DS/Dashboard/Search",["DS/PubSub/PubSub","DS/Dashboard/PublicAPI"],function(e,t){"use strict";var n={from:{tab:"searchInTab",widget:"searchInWidget",widgetPreview:"searchInWidgetPreview",multiWidgetPreview:"searchInMultiAppWidgetPreview",tagger:"tagger"},init:function(t){var a={from:n.from.tab,query:t||"",clear:!t};e.dispatch(e.events.searchQuery,a,!1)},getSearchInTabOverlayView:function(){var e=t._getActiveTab(),n=e&&t._getTabContext(e.id),a=n&&n.elements.searchInTabOverlayView;return a&&a.isVisible()&&a},closeSearchInTabOverlayView:function(e){var t=n.getSearchInTabOverlayView();t&&t.close(e)},getSearchInTabValue:function(){var e=n.getSearchInTabOverlayView();return e&&e.getValue()||""}};return n}),define("DS/Dashboard/CommentPanelManager",["DS/TopFrame/TopFrame","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","DS/Dashboard/Views/PanelButton","DS/Dashboard/UsageTracker","DS/Dashboard/Navigation","DS/Dashboard/PublicAPI","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s){"use strict";var d,l,c,u,h="SocialToolbarWdg:sidepanel:update";function m(e){return{subjectUri:e.type+":"+e.modelId,x3dPlatformId:r._getGlobalPlatformId()}}var g={_button:null,init:function(){var e;e=require("DS/Dashboard/Bootstrap"),t.add(r.events.dashboard.change,function(e){g.enable(),g.setSubject(m(e))}),[r.events.panel.change,r.events.panel.close].forEach(function(e){t.add(e,function(){!g.isOpen()&&g._button&&g._button.isActive()&&g._afterClose()})}),[r.events.story.start,r.events.story.stop,r.events.story.next,r.events.story.previous].forEach(function(e){t.add(e,function(t){var n,a=t.step||{};a.widget&&t.skip||!t.readonly||(n=!!a.widget&&t.step.element,g._setTargets({enable:e!==r.events.story.stop,screenshot:n&&n+" .moduleWrapper",annotation:n&&n+" .moduleContent .moduleWrapper"}))})}),e.addSidePanelNavigationHook("X3DGSTO_AP",{beforeNavigate:g._beforeOpen,transformData:function(e){return(e=Object.assign(g._getPanelData(),e))["commentToScrollToAtInit.commentUri"]=e.replyURI||e.commentURI,e["commentToScrollToAtInit.parentCommentUri"]=e.replyURI&&e.commentURI,delete e.commentURI,delete e.replyURI,n.publish(h,e),e},afterNavigate:g._afterOpen})},getButton:function(){return g._button=new a({icon:"comment",mainClassName:"wp-comment-panel-btn",tooltip:{body:r._isEndUserCockpitContext()?s.cockpitComments:s.dashboardComments,position:"bottom"},active:g.isOpen(),events:{onClick:function(){g.isOpen()?g.close():g.open()}}}),g._button},isOpen:function(){return e.isPanelOpen("right")&&"X3DGSTO_AP"===e.getPanelApp("right")},open:function(){return g._beforeOpen(),e.openPanel("right",{appId:"X3DGSTO_AP",data:g._getPanelData()}).then(g._afterOpen)},close:function(){return g._beforeClose(),e.closePanel("right").then(g._afterClose)},enable:function(){g._button&&g._button.show()},disable:function(){g._button&&g._button.hide(),g.close()},setSubject:function(e){var t;d=e,n.publish(h,(t=e,Object.keys(t).reduce(function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e},{})))},setPlatformId:function(e){n.publish(h,{x3dPlatformId:e})},_setButtonActive:function(e){g._button&&g._button.isActive()!==e&&(g._button.setActive(e),i.track({category:"dashboard.comments",action:e?"show":"hide",platformId:d.platformId}))},_beforeOpen:function(){d=m(r._getActiveContext()),t.dispatch(r.events.widget._exitFullscreen),o.getUrlParameter(o.parts.fullscreen)&&o.routeTo({keepAll:!0,discards:o.parts.fullscreen})},_afterOpen:function(){t.dispatch(r.events.rightpanel.comment.open),g._setButtonActive(!0)},_beforeClose:function(){},_afterClose:function(){t.dispatch(r.events.rightpanel.comment.close),g._setButtonActive(!1)},_getPanelData:function(){return Object.assign({service:"3DDashboard",enableShare:!1,enableCommentLike:!0,enableScreenshot:l,screenshotTarget:c,annotationTarget:u,title:r._isEndUserCockpitContext()?s.cockpitComments:s.dashboardComments},d)},_setTargets:function(e){l=e.enable,c=e.screenshot,u=e.annotation,n.publish(h,{enableScreenshot:e.enable,screenshotTarget:e.screenshot,annotationTarget:e.annotation})}};return g}),define("DS/Dashboard/StoryManager",["DS/PubSub/PubSub","DS/Dashboard/PublicAPI"],function(e,t){"use strict";var n,a;return n={init:function(){n._initEvents()},getModule:function(){return new Promise(function(n,i){if(a)return n(a);require(["DS/Story/DashboardsStory"],function(o){var r=t._getActiveContext(),s=t._getActiveContextWidget();if(!r||!s)return i("No current context or no current context widget available yet.");a=o,e.dispatch(t.events.story.init,{id:s.id,modelId:r.modelId}),n(a)},i)})},start:function(e){return n.getModule().then(function(t){t.start(e)})},add:function(){return n.getModule().then(function(e){e.add()})},duplicate:function(e){return n.getModule().then(function(t){t.duplicate(e)})},remove:function(e){return n.getModule().then(function(t){t.remove(e)})},getStories:function(){return n.getModule().then(function(e){return e.getCurrentDashboardStories()})},getScenarios:function(){return n.getStories().then(function(e){return new Promise(function(t){e.getScenarios(function(e){t((e||[]).map(function(e,t){return e.length>0&&{item:e,index:t}}).filter(function(e){return e}))})})})},_initEvents:function(){}}}),define("DS/Dashboard/DraggableManager",["UWA/Core","UWA/Utils","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/UWPClientControls/Draggable","DS/UWPClientControls/PlatformNotify","DS/UWPClientCode/Data/Widgets","DS/WebappsUtils/Map","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/Utils","DS/Dashboard/CompassManager","DS/Dashboard/UsageTracker","DS/Dashboard/Modals/PlatformSelect","DS/TagNavigator/TagNavigator","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p){"use strict";var b="drag-external-widget",v={externalWidget:x(b)};c.isAddinMode()||c.isLockedAppMode()||(v.compassWidget=".widget-item, .widget-item > *",v.catalogWidget=".wp-drag *");var w=new d,D=null,_=null,C=null,I=null,S=null,y="up",E=null;function T(e){M._setMouseState(e)}function A(e,t,n){w.forEach(function(a,i){i.get()&&a.registeredFunctions[e].apply(t,n)})}function P(){var t=v;return w.forEach(function(n){t=e.merge(t,n.selectors)}),t}function x(e){var t="."+e+(e!==b?":not(."+b+")":"");return t+" > .moduleWrapper > .moduleHeader, "+t+" > .moduleWrapper > .moduleHeader > *, "+t+" > .moduleWrapper > .moduleHeader > .moduleHeader__middle > *, "+t+" > .moduleWrapper > .moduleHeader > .moduleHeader__left .moduleHeader__icon"}document.addEventListener("mousedown",T.bind(null,"down")),document.addEventListener("touchstart",T.bind(null,"down")),document.addEventListener("mouseup",T.bind(null,"up")),document.addEventListener("touchend",T.bind(null,"up"));var M={register:function(e){return w.set(e.manager,{selectors:e.selectors,registeredFunctions:{beforeStart:e.beforeStart,start:e.start,drag:e.drag,stop:e.stop}}),this._setupDrag()},unregister:function(e){w.delete(e),this._setupDrag()},getType:function(e){var t,a;return t=P(),Object.keys(t).forEach(function(i){n.match.call(e,t[i])&&(a=i)}),a},normalizeCompassPlayer:function(e){return(e=e.getAttribute("data-appId")?e:e.getParent(".widget-item"))&&e.getAttribute("data-appId")||(e=void 0),e},buildCompassConfig:function(e){var t={appId:e.getAttribute("data-appId"),icon:e.getAttribute("data-icon"),url:e.getAttribute("data-url"),title:e.getAttribute("data-title"),dataUrl:e.getAttribute("data-dataUrl"),isolationLevel:e.getAttribute("data-isolationLevel"),token:e.getAttribute("data-token")};try{t.data=JSON.parse(e.getAttribute("data-data")),t.apps=JSON.parse(e.getAttribute("data-apps"))}catch(e){}return t},buildCatalogConfig:function(e){var t=e.getParent(".wp-drag");if(t)try{return JSON.parse(t.getAttribute("data-conf"))}catch(e){}},onNewWidgetDrop:function(n,i){return new a(function(o,s){var d,l,c=!1,u=a.resolve();function h(){m.track({category:"widget.drop",action:"dropNewWidgetSuccess-widget",appId:n.appId,platformId:l}),(d||[]).forEach(function(e){m.track({category:"widget.drop",action:"dropNewWidgetSuccess-widgetFromMultiWidget",appId:e,platformId:l})}),o()}function g(e){m.track({category:"widget.drop",action:"dropNewWidgetFailure-"+(e||"widget"),appId:n.appId,platformId:l}),s()}return E=E||require("DS/WidgetPreview/Controller/TransientManager"),n?(n.data=n.data||{},l=n.data.x3dPlatformId,E.getInstance().isWidgetOpen()?(r.warn(p.previewBusyError),void g("widgetPreviewOpened")):(n.data.tenantAware&&!l&&(u=M._getWidgetPlatformId({appId:n.appId}).then(function(e){n.data.x3dPlatformId=e,l=e},function(e){if("object"!=typeof e||!e.canceled)throw new Error(e);c=!0})),u.then(function(){var o,r;if(!c)return i.beforeAddWidget&&i.beforeAddWidget(),n.apps&&n.apps.length?(d=[],[],r=t.getUUID().substr(0,6),o=n.apps.map(function(t){var a={appId:t.id,url:t.launchInfos,title:t.title,dataUrl:t.config};return a.data=e.extend(t.data||{},{x3dSharedId:r,x3dAppId:n.appId,x3dPlatformId:l}),d.push(t.id),M._addWidget({tabId:i.tabId,params:i.getAddWidgetParams?i.getAddWidgetParams(a,!0):[a]}).then(function(){return!0}).catch(function(){return!1})}),a.all(o).then(function(e){e.includes(!1)?g():h()}).catch(g)):M._addWidget({tabId:i.tabId,params:i.getAddWidgetParams?i.getAddWidgetParams(n):[n]}).then(h).catch(g);g("canceledByUser")}))):s()})},buildBodyOverlay:function(){return e.createElement("div",{styles:{position:"absolute",top:0,left:0,zIndex:100,width:document.body.offsetWidth+"px",height:document.body.offsetHeight+"px",cursor:"move",userSelect:"none",userDrag:"none"}})},getWidgetContainer:function(e){if(e){return e.hasClassName("module")?e:e.getParent(".module")}},makeWidgetSelector:x,initCrossTabDrag:function(){var e=l._getActiveContextWidget(),t=e&&e.layout&&e.layout.tabs;_=l._getActiveTab(),S=S||t.map(function(e){var t=e.elements.container.getOffsets(),n=e.elements.container.getSize();return{w:n.width,h:n.height,y:t.y,x:t.x,id:e.elements.container.getAttribute("data-tabid")}});var n=e.layout.elements.tabDirectAddBtn;if(n){var a=n.getSize(),i=n.getOffsets(),o={};S.some(function(e){if("_add_"===e.id)return o=e,!0}),o.id="_add_",o.w=a.width,o.h=a.height,o.y=i.y,o.x=i.x,-1===S.indexOf(o)&&S.push(o)}},detectCrossTabDrag:function(e,t,n){var a,i=this,o=((e.target||{}).ownerDocument||{}).defaultView===top,r=o&&e.target.getBoundingClientRect();(S||[]).some(function(e){(n.player?t.pointer&&t.pointer.left>=e.x&&t.pointer.left<e.x+e.w&&t.pointer.top>=e.y&&t.pointer.top<e.y+e.h:r&&r.left>=e.x&&r.right<=e.x+e.w&&r.top>=e.y&&r.bottom<=e.y+e.h)&&(a=e)}),a&&o?a.id!==(_||{}).id&&(C=_,_=a,clearTimeout(I),I=setTimeout(function(){"up"!==y&&i._switchTab(e,t,n)},600)):(_=C||_,clearTimeout(I))},validateCrossTabExistingWidgetDrop:function(e){var t=e.widgetId,n=e.parentId,a=u.getRegisteredWidgetInstance(t).environment.wp.parent.widget,o=l._getWidget(t);function r(){delete o._isSwitchingTab}if(n===a.id)return r(),void(e.success&&e.success());s.editWidgetInstance({serviceName:l._getServiceName(),id:t,parentId:n,success:function(){var t,s,d=o&&o.environment,c=d&&d.wp.parent&&d.wp.parent.wp.children;if(c)for(var u=c.length-1;u>=0;u--)if(c[u].id===d.wp.id){s=c.splice(u,1)[0];break}(c=(d=(t=l._getWidget(n))&&t.environment)&&d.wp.children)&&s&&(delete s.coordinates,c.push(s)),o.environment.wp.parent=d,r(),i.dispatch(l.events.widget.switchTab,[o,{previousTab:a,newTab:t}]),e.success&&e.success(),m.track({category:"widget.drop",action:"changeTabSuccess-draggableManager"})},failure:function(){r(),e.failure&&e.failure(),m.track({category:"widget.drop",action:"changeTabFailure-draggableManager"})}})},cleanupCrossTabDrag:function(e){var t=(e||{}).player;t&&t.classList.remove(b),I=null,S=null},isBodyShifted:function(){return h.isOpen()&&t.Client.getSize().width<640},toggleCompassIfNeeded:function(e){var n=t.Client.getSize().width,a=e.pointer;return!(n>=640)&&(!!(h.isOpen()&&a.left>n-25)&&(h.close(),S.forEach(function(e){e.x-=n}),!0))},_setMouseState:function(e){y=e},_switchTab:function(t,n,a){var i,o=this,r=a.native;l._getWidget(a.widgetId)._isSwitchingTab=!0,r||D.options.stop(t,n,!0),D._autoscroll&&(window.clearInterval(D._autoscroll.id),D._autoscroll=null),"_add_"===_.id?r||l._addTab():((i=l._getTabProperty(_.id,"lastMaximizedWidgetId"))&&l.setTabProperty(_.id,"lastMaximizedWidgetId",""),l._setActiveTab(_.id)),r?(_=null,C=null,a.clean&&a.clean()):function r(){var s,d,c,u,h,g=require("DS/Dashboard/GridManager"),p=require("DS/Dashboard/DockLayoutManager"),v=["compassWidget","catalogWidget"].indexOf(o.getType(a.player))>-1,w=l._getActiveTab();if(w&&C.id!==w.id&&(g.get()||p.get())&&("_add_"!==_.id||S.length-1<l._getActiveContextWidget().layout.tabs.length)){if(i){var I=l._getWidget(i);I&&I.environment.isMaximized()&&I.environment.toggleMaximize()}v||(s=l._getTabProperty(C.id,"minimizedWidgetIds")||{},d=l._getTabProperty(w.id,"minimizedWidgetIds")||{},(h=s[c=a.widgetId])&&(d[c]=h,delete s[c],l.setTabProperty(C.id,"minimizedWidgetIds",s),l.setTabProperty(w.id,"minimizedWidgetIds",d)),(u=e.Widgets.instances.filter(function(e){return e.id===c})[0])&&u.environment.embedded?u.environment.embedded.launched=!1:f.get6WTagger(w.id).switchProxiesOnCC(c),a.onExternalWidgetCrosses()),_=null,C=null,a.clean(),!v&&a.player&&a.player.classList.add(b),D.options.beforeStart(t,n),D.options.start(t,n),m.track({category:"widget.drag",action:"switchTab-draggableManager"})}else setTimeout(r,100)}()},_setupDrag:function(){var t,n={movePlayer:!1,container:document.body,items:(t=P(),Object.keys(t).map(function(e){return t[e]}).join(", ")),limit:!0,textSelection:!1,distance:10,area:15,beforeStart:function(){A("beforeStart",this,arguments)},start:function(){A("start",this,arguments)},drag:function(){A("drag",this,arguments)},stop:function(){A("stop",this,arguments)}};return D=D||new o(n),e.extend(D.options,n),D},_addWidget:function(e){return new a(function(t,n){var a=l.events.widget.add+e.tabId,o=e.params.slice();o[2]=function(e){t(e),i.dispatch(l.events.widget.add,[e[0]])},o[3]=n,i.dispatch(a,o)})},_getWidgetPlatformId:function(e){var t=!1,n="";return M._getAppInfo({appId:e.appId}).then(function(e){var i=a.resolve(),o=l._getGlobalPlatformId(),r=e.platforms||[],s=r.some(function(e){return e.id===o});return r.length||(n=""),s?n=o:i=M._showPlatformSelectModal({platforms:r.map(function(e){return{platformId:e.id,displayName:e.name}})}).then(function(e){n=e.platformId},function(){t=!0,n=""}),i}).then(function(){return t?a.reject({canceled:!0}):n})},_getAppInfo:function(e){return new a(function(t,n){h.getAppInfo({appId:e.appId,onComplete:t,onFailure:n})})},_showPlatformSelectModal:function(e){return new a(function(t,n){g.show({closable:!0,platforms:e.platforms,onConfirm:t,onCancel:n})})}};return M}),define("DS/Dashboard/GridManager",["UWA/Core","UWA/Utils","DS/UWPClientControls/Utils","DS/UWPClientCode/WidgetCatalog","DS/Dashboard/DraggableManager","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker","DS/LayoutSwitcher/GridLayout"],function(e,t,n,a,i,o,r,s){"use strict";var d,l=1,c=2,u="r2g-widget",h="r2g-resize",m={gridWidget:i.makeWidgetSelector(u),gridResize:"."+u+" > ."+h},g=[],f=null,p=!1,b="",v=!1,w=!1,D=null,_=null,C=null,I=null,S=null,y=null,E=null,T=null,A={},P=!0,x={},M={},k=[];function N(t,n,a){return e.createElement("div",{class:"module","data-sizex":n,"data-sizey":a})}function W(t,n,a,i){var o;return o=e.createElement("div",{class:t.options.placeholderClassName,"data-sizex":n,"data-sizey":a}),i&&e.createElement("div",{class:t.options.placeholderClassName+"-content",text:i}).inject(o),o}function L(e,t,n,a){var i={};return n+(a=a||l)>e.cols+1?(i.col=1,i.row=t+c):(i.col=n,i.row=t),i.colEnd=i.col+a,i.rowEnd=i.row,i}function U(e){return e.className.match(h+"-([^s]*)")[1]||""}return{setupDrag:function(){var e,t=this;D={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},f=i.register({manager:t,selectors:m,beforeStart:function(n,a){a=t.getGridRelativeDragInfo(a);var o=i.getWidgetContainer(a.player),r=i.getType(a.player);f.options.distance="gridWidget"===r?10:0,"gridWidget"===r||"externalWidget"===r?(b=r.replace("Widget",""),I=o,f.player=I,e=setTimeout(function(){I.addClassName("shadowed")},300)):"gridResize"===r?(b="resize",I=a.player,e=setTimeout(function(){o&&o.addClassName("shadowed-"+U(n.target))},300)):require("DS/WidgetPreview/Controller/TransientManager").getInstance().isWidgetOpen()||("compassWidget"===r?(b="compass",I=a.player,f.options.distance=20):"catalogWidget"===r&&(b="catalog",I=a.player))},start:function(n,a){b&&(a=t.getGridRelativeDragInfo(a),"grid"===b||"external"===b?(clearTimeout(e),i.getWidgetContainer(a.player).addClassName("shadowed")):"resize"===b&&(clearTimeout(e),i.getWidgetContainer(a.player).addClassName("shadowed-"+U(a.target))),t.onDragStart(n,a))},stop:function(n,a,o){b&&(a=t.getGridRelativeDragInfo(a),"grid"===b||"external"===b?(clearTimeout(e),i.getWidgetContainer(a.player).removeClassName("shadowed")):"resize"===b&&(clearTimeout(e),i.getWidgetContainer(a.player).removeClassName("shadowed-"+U(a.target))),t.onDragStop(n,a,o))},drag:function(e,n){b&&(n=t.getGridRelativeDragInfo(n),t.onDrag(e,n))}}),M.onResizing=n.debounce(function(e,t){!f._autoscroll&&e.onResizing(t)},60),M.onResizingWidget=n.throttle(function(e,t){!f._autoscroll&&e.onResizingWidget(t)},60),M.onDrag=n.throttle(function(e,t){!f._autoscroll&&e.onDrag(t)},120),n.addEvent(window,"resize",n.debounce(this.update.bind(this),120))},onDragStart:function(e,n){var s;if(S=S||i.buildBodyOverlay().inject(document.body),!p&&(_=this.get())){var d=o._getDefaultModuleCoordinates();if(l=d[_.breakpoint.name].sizex,c=d[_.breakpoint.name].sizey,"compass"===b&&0===_.id.indexOf("preview-")&&(_=this.get(o._getActiveTab().id)),i.initCrossTabDrag(),s=_.elements.container.getParent(".wp-tabview-panel"),E=s.getOffsets(),_.options.fit||(f.options.autoscrollContainer=s),"grid"===b)f.baseX=E.x,f.baseY=E.y,f.options.movePlayer=!0,_.onDragStart(I),r.track({category:"widget.drag",action:"grid-gridManager"});else if("resize"===b)_.options.fit||(f.oScroll={x:f.options.autoscrollContainer.scrollLeft,y:f.options.autoscrollContainer.scrollTop}),I=I.getParent(".module"),_.onResizeStart(I,n),r.track({category:"widget.resize",action:"resize-gridManager"});else if("compass"===b){if(i.isBodyShifted()&&(E.x-=t.Client.getSize().width),f.baseX=E.x+_.minWidgetWidth*l/2,f.baseY=E.y+_.minWidgetHeight*c/2,!(I=i.normalizeCompassPlayer(I)))return;C=i.buildCompassConfig(I),I=N(0,l,c),f.player=I,r.track({category:"widget.drag",action:"compass-gridManager"})}else if("catalog"===b){if(f.baseX=E.x+_.minWidgetWidth*l/2,f.baseY=E.y+_.minWidgetHeight*c/2,!(C=i.buildCatalogConfig(I)))return;a.toggle(),I=N(0,l,c),_.add(I),f.player=I,_.onDragStart(f.player),r.track({category:"widget.drag",action:"catalog-gridManager"})}else if("external"===b){var u=I.getBoundingClientRect(),h=I.style.left,m=I.style.top;f.baseX=E.x,f.baseY=E.y,f.options.movePlayer=!0,I.setAttribute("data-sizex",I.getAttribute("data-sizex")||Math.min(_.cols,Math.round(u.width/_.minWidgetWidth))),I.setAttribute("data-sizey",I.getAttribute("data-sizey")||Math.round(u.height/_.minWidgetHeight)),I.removeAttribute("style"),I.style.left=h,I.style.top=m,o._getActiveTab().layout.activeLayout.addChild({id:I.id.substr(2),el:I,coordinates:{col:1,row:1,sizex:parseInt(I.getAttribute("data-sizex")),sizey:parseInt(I.getAttribute("data-sizey"))}}),_.onDragStart(f.player),r.track({category:"widget.drag",action:"otherTab-gridManager"})}}},onDrag:function(t,n){var a=this,o=require("DS/Dashboard/DockLayoutManager");if(_&&!p)if(T=n,this.autoscroll("y",n),"resize"===b)M.onResizing(_,n),M.onResizingWidget(_,n);else{if(i.detectCrossTabDrag(t,n,{player:I,widgetId:I.id&&I.id.substr(2),onExternalWidgetCrosses:function(){var e=o.get(),t=a.get();_.remove({widget:I}),"compass"===b||"catalog"===b?I.remove():I.inject(t?t.elements.wrapper:e.element)},clean:function(){_.onDragStop(n),n.player=n.target,o.get()&&"compass"!==b&&"catalog"!==b&&(o.prepareExternalPlayer(I),s.cleanupWidget(_,I),I.classList.remove("shadowed")),a.clean()}}),"compass"===b){if(i.toggleCompassIfNeeded(n),n.pointer.left<E.x)return;if(P){if(P=!1,_.add(I),C&&C.apps&&C.apps.length>1){k=[],v=!0,w=C.apps.length*l>_.cols,x=L(_,1,1,l),A={col:x.colEnd,row:x.rowEnd};for(var r=1;r<C.apps.length;r++)(y={}).el=W(_,l,c,r+1),y.width=l,y.height=c,k.push(y),x=L(_,A.row,A.col,y.width),y.row=x.row,y.col=x.col,_.add({el:y.el,row:y.row,col:y.col,sizex:y.width,sizey:y.height}),y.el.removeClassName(u),A.col=x.colEnd,A.row=x.rowEnd;d={col:1,row:1}}_.onDragStart(I),v&&e.createElement("div",{class:_.options.placeholderClassName+"-content",text:1}).inject(_.placeholder.el)}!f._autoscroll&&M.onDrag(_,n)}else!f._autoscroll&&M.onDrag(_,n);v&&!w&&(x.col=_.placeholder&&_.placeholder.col,x.row=_.placeholder&&_.placeholder.row,d.col===x.col&&d.row===x.row||(d.col=x.col,d.row=x.row,x=L(_,x.row,x.col,l),function(e,t,n){var a={};t.forEach(function(t){a=L(e,n.row,n.col,t.width),e.remove({widget:t.el}),t.row=a.row,t.col=a.col,e.add({el:t.el,row:a.row,col:a.col,sizex:t.width,sizey:t.height}),t.el.removeClassName(u),n={col:a.colEnd,row:a.rowEnd}})}(_,k,{col:x.colEnd,row:x.rowEnd})))}},onDragStop:function(e,t,n){var a,s;_&&!p?"grid"===b?(_.onDragStop(t),!n&&this.clean(),r.track({category:"widget.drop",action:"grid-gridManager"})):"external"===b?(_.onDragStop(t),n||(i.validateCrossTabExistingWidgetDrop({widgetId:I.id.substr(2),parentId:_.id,success:function(){o._getActiveTab().layout.reorder()}}),this.clean()),r.track({category:"widget.drop",action:"otherTab-gridManager"})):"resize"===b?(setTimeout(_.onResizeStop.bind(_),120),require("DS/Dashboard/Layout/Dashboard").resizeTab({widget:o._getActiveTab().environment.wp.parent.widget}),this.clean()):"catalog"!==b&&"compass"!==b||(s=_.elements.container.getOffsets(),!n&&t.pointer&&t.pointer.left>s.x&&t.pointer.top>s.y?this.onNewWidgetDrop(I):((a=_.findWidget(I))&&(_.remove({widget:I,silent:!0,prevent:!0}),_.removeFauxWidget(_.placeholder),_.player=null,_.playerCells=null,_.placeholderCells=null,_.placeholder.el.remove(),_.placeholder=null,_.options.silent||_.widgets.forEach(function(e){_.moveWidgetUp(e,a.sizey)})),!n&&this.clean()),r.track({category:"widget.drop",action:b+"-gridManager"})):this.clean()},autoscroll:function(e,t){if(!_.options.fit){var n="x"===e,a=n?"left":"top",i=n?"width":"height",o="resize"!==b&&f.player,r="resize"===b&&function(e){_.onResizingWidget(e),_.onResizing(e)},s=f.options.autoscrollContainer,d=t.scroller[e],l=t.pointer[a]+d,c=D[i],u=f.options.area;f._autoscroll||(f._autoscroll={}),l<d+u?(void 0===f._autoscroll.positive||f._autoscroll.positive)&&(d?(window.clearInterval(f._autoscroll.id),f._autoscroll=h(!1,o,s,d,u,c,r)):f._autoscroll=null):l>d+c-u?f._autoscroll.positive||(window.clearInterval(f._autoscroll.id),f._autoscroll=h(!0,o,s,d,u,c,r)):(window.clearInterval(f._autoscroll.id),f._autoscroll=null)}function h(e,t,n,a,i,o,r){var s=Date.now(),d=Math.floor(T.position.top),l=d,c={};return c.positive=e,c.id=window.setInterval(function(){var u,h,m=Date.now(),g=m-s,p=T.pointer.top,b=T.position.top;u=(i-(e?o-p:p))/i,h=2*Math.floor(10*u/2),h=Math.max(h,2),h=Math.floor(h*g/16)*(e?1:-1),!e&&a<=0&&(window.clearInterval(c.id),f._autoscroll=null),a+=h,n.scrollTop+=h,d!==b?(d=b,l=b):l+=h,r&&(T.pointer.diffTop+=h,r(T)),t&&t.setStyle("top",l),s=m},16),c}},onNewWidgetDrop:function(){var t,n=this,a=_.findWidget(I);a&&_.placeholder&&C&&i.onNewWidgetDrop(C,{tabId:_.id,beforeAddWidget:function(){t={row:_.placeholder.row,col:_.placeholder.col,sizex:_.placeholder.sizex,sizey:_.placeholder.sizey},_.remove({widget:I,silent:!0,prevent:!0}),_.removeFauxWidget(_.placeholder),_.player=null,_.playerCells=null,_.placeholderCells=null,a.el.destroy()},getAddWidgetParams:function(n,a){return a?(i=L(_,t.row,t.col,l),(t=i).sizex=l,t.sizey=c,o=[n,t],(t=e.clone(t)).row=t.rowEnd,t.col=t.colEnd,o):[n,t];var i,o}}).then(function(){_.dispatchEvent("onDrop"),_.placeholder.el.remove(),_.placeholder=null,n.clean()}).catch(function(){_.remove({widget:I,silent:!0,prevent:!0}),_.removeFauxWidget(_.placeholder),_.placeholder.el.remove(),_.placeholder=null,_.placeholderCells=null,_.widgets.forEach(function(e){_.moveWidgetUp(e)}),n.clean()})},handleDrag:function(e){e?!f&&this.setupDrag():(i.unregister(this),f=null)},register:function(e){for(var t,n=e.elements.container.id.substr(2),a=!1,i=g.length-1;i>=0;i--)(t=g[i]).elements&&t.elements.container.isInjected()?t.id===n&&(a=!0):g.splice(i,1);a||(e.id=n,g.push(e)),g.length>0&&this.handleDrag(!0)},unregister:function(e){var t=this.get(e),n=g.indexOf(t);-1!==n&&g.splice(n,1),g.length<1&&this.handleDrag(!1)},get:function(e){var t,n;if(!e){if((n=g.filter(function(e){return-1!==e.id.indexOf("preview")&&e.options&&!e.options.viewport.classList.contains("preview-content-float")})).length>0)return n.find(function(e){return!(!e.elements||!e.elements.container.offsetParent)});t=o._getActiveTab(),e=t&&t.id}return g.filter(function(t){return t.id===e})[0]},update:function(e){var t=this.get(),n={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight};e&&D.width===n.width&&D.height===n.height||(D=n,t&&null!=(t.options.viewport||{}).offsetParent&&t.update(!0))},fit:function(e){var t=this.get(e);t&&!t.options.fit&&(t.options.fit=!0,t.fit(),t.elements.container.addClassName("ifwe-fit-"+e),r.track({category:"tab.layout",action:"fit-gridManager"}))},unfit:function(e){var t=this.get(e);t&&t.options.fit&&(t.unfit(),t.elements.container.removeClassName("ifwe-fit-"+e),r.track({category:"tab.layout",action:"unfit-gridManager"}))},isFitted:function(e){var t=this.get(e);return!(!t||!t.options.fit)},enable:function(){p=!1,this.toggleResizable(!p)},disable:function(){p=!0,this.toggleResizable(!p)},isEnabled:function(){return!p},toggleResizable:function(e,t){var n,a,i=o._getActiveContextWidget(),r=this.get();t?(a=r&&r.elements.wrapper.getElement(".wi-"+t))&&a.toggleClassName("disabled",!e):(n=i&&i.layout&&i.layout.getTabContent())&&n.toggleClassName("disabled",!e)},clean:function(){clearTimeout(""),k&&k.forEach(function(e){_.remove({widget:e.el})}),i.cleanupCrossTabDrag({player:I}),k=null,f.options.movePlayer=!1,f.options.autoscrollContainer=null,S&&S.destroy(),_=null,C=null,b="",P=!0,S=null,v=!1,w=!1,f._autoscroll&&(window.clearInterval(f._autoscroll.id),f._autoscroll=null)},getGridRelativeDragInfo:function(e){if(-1===["catalog","compass"].indexOf(b))return e;if(!e.position)return{},e;e.prevPosition||e.pointer;var t=this.get(),n=t.elements.container.getOffsets(),a=o._getDefaultModuleCoordinates()[t.breakpoint.name],i=a.sizex*t.widgetWidth,r=a.sizey*t.widgetHeight,s={left:e.pointer.left-(n.x+i/2),top:e.pointer.top-(n.y+r/2)};return Object.assign({},e,{position:s,prevPosition:e.prevPosition&&{left:s.left-(e.pointer.diffLeft||0),top:s.top-(e.pointer.diffTop||0)}})}}}),define("DS/Dashboard/NewDashboardMenu",["UWA/Core","DS/Handlebars/Handlebars4","DS/PubSub/PubSub","DS/UIKIT/Tooltip","DS/UIKIT/Popover","DS/UWPClientControls/Draggable","DS/UWPClientControls/Utils","DS/TopFrame/TopFrame","DS/Dashboard/ManageDashboardManager","DS/Dashboard/Navigation","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker","DS/Dashboard/Views/PanelButton","text!DS/Dashboard/assets/templates/newDashboardMenu.html","text!DS/Dashboard/assets/templates/newDashboardMenuPreview.html","DS/UWPClientCode/I18n","i18n!DS/Dashboard/assets/nls/main","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b){"use strict";var v,w=!1,D=!1,_=!1,C="active",I="hide",S="draggable",y="favorite-placeholder-add",E="favorite-placeholder-trash",T="favorite-placeholder-move",A="dashboard-menu-favorites-items",P="dashboard-menu-list-item",x=((s._frame||{})._UI_BREAKS||{}).SMALL;function M(){return"mobile"===r.getPlatform()}var k,N,W={findAncestor:function(e,t,n){if(!e)return e;if((e.matches||e.matchesSelector).call(e,n||"#new-dashboard-menu"))return!1;if((e.matches||e.matchesSelector).call(e,t))return e;for(;(e=e.parentElement)&&!(e.matches||e.matchesSelector).call(e,t););return e},matchSelector:function(e,t){return!!(e.matches||e.matchesSelector).call(e,t)&&e},getFormatEvent:function(e){if(e)return e.changedTouches?{x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY}:e},formatDate:function(e){var t=new Date(e),n=""+(t.getMonth()+1),a=""+t.getDate(),i=t.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[i,n,a].join("-")}},L={_favorites:[],getAll:function(){return this._favorites},getContexts:function(){var e=this;if(!e._favorites.length)return[];var t={};return U.getContexts().forEach(function(n){var a=n.modelId;e.isFavorite(a)&&(t[a]=n)}),e._favorites.map(function(e){return t[e]}).filter(function(e){return e})},isFavorite:function(e){return this._favorites.includes(e)},hasFavorites:function(){return!!this._favorites.length},add:function(e,t){this.isFavorite(e)||(this._favorites.splice(t,0,e),v.addFavorites(e,t,{preventSuccessNotif:!0}),u.track({category:"dashboard.favorite",action:"add",persDim:{pd1:e}}))},remove:function(e){if(this.isFavorite(e)){var t=this._favorites;this._favorites=t=t.filter(function(t){return t!==e}),v.removeFavorites(e,{preventSuccessNotif:!0}),u.track({category:"dashboard.favorite",action:"remove",persDim:{pd1:e}})}},move:function(e,t){if(this.isFavorite(e)){var n=this._favorites;this._favorites=n=n.filter(function(t){return t!==e}),n.splice(t,0,e),v.reorderFavorites(e,t),u.track({category:"dashboard.favorite",action:"reorder"})}},fetch:function(){var e=c._getFavoriteContextModelIds();return this._favorites=e,e}},U={popover:{element:void 0,target:void 0,timeoutID:void 0},width:window.innerWidth<=x?"narrow":"wide",narrowVisibility:!1,_contexts:[],_dashboards:[],_cockpits:[],_isMouseOver:!1,addFavorite:function(e,t){L.isFavorite(e)||(L.add(e,t),F.fetch(),F.render())},removeFavorite:function(e){L.isFavorite(e)&&(L.remove(e),F.fetch(),F.render())},moveFavorite:function(e,t){L.isFavorite(e)&&(L.move(e,t),F.render())},fetchContexts:function(){var e=U;e._contexts=c._getAllContexts("name","asc").map(function(e){var t=Object.assign({},e);return c._isSharedContext(t)&&t.owner?t.fonticon="users":c._isOwnCustomRoleContext(t)?t.fonticon="lock-user":c._isContributorContext(t)?t.fonticon="pencil":t.owner||(t.fonticon="lock"),t.data.description||(t.data.description=""),t}),e._dashboards=e._fetchDashboards(),e._cockpits=e._fetchCockpits()},_fetchDashboards:function(){return U._contexts.filter(function(e){var t=e.modelId;return!L.isFavorite(t)&&e.type===c.DASHBOARD_TYPE})},_fetchCockpits:function(){return U._contexts.filter(function(e){return!L.isFavorite(e.modelId)&&c._isEndUserCockpitContext(e.modelId)})},getContexts:function(){return U._contexts},getDashboards:function(){return U._dashboards},getCockpits:function(){return U._cockpits},saveVisibility:function(e){var t=Promise.resolve();return"wide"===U.width?t=c.setDashboardMenuVisibility(!!e):U.narrowVisibility=!!e,t},getVisibility:function(){return"wide"===U.width?c._getDashboardMenuVisibility():U.narrowVisibility},showPopover:function(){var e,n=U.popover,a=n.target;a&&U._isMouseOver&&F.isOpen()&&!D&&(e=U.getContexts().find(function(e){return e.modelId===a.dataset.modelid}))?(n.element=new i({target:a,position:"bottom",className:"dashboard-menu-item-preview",body:t.compile(g)({dashboard:{modelId:e.modelId,name:e.name,description:e.data.description||"",thumbnail:e.thumbnail},nls:p,expandedNLS:function(e){var t={role:"",modifiedOn:"",members:""};return t.role=f.replace(p.dbRole,{classes:"information-title",role:function(e){return{owner:b.ownerAccess,reader:b.readerAccess,contributor:b.contributorAccess}[(e.role||"").toLowerCase()]||""}(e)}),t.modifiedOn=f.replace(p.dbModifiedOn,{classes:"information-title",date:W.formatDate(new Date(e.creationDate))}),t.members=f.replace(p.dbMembers,{classes:"information-title",members:e.membersCount}),t}(e)})}),n.element.show()):U.destroyPopover()},destroyPopover:function(){var e=U.popover;e.element&&(e.element.destroy(),e.element=null),e.target=null,clearTimeout(e.timeoutID),e.timeoutID=null},onMouseOver:function(e){U._isMouseOver=!0,U._showPopoverOnMouseOver(e)},onMouseLeave:function(){U._isMouseOver=!1,U.destroyPopover()},_showPopoverOnMouseOver:r.debounce(function(e){if(U._isMouseOver){var t,n=e.target,a=U.popover;if(!(t=n&&W.findAncestor(n,"."+P)))return U.destroyPopover();t!==a.target&&(U.destroyPopover(),a.target=t,a.timeoutID=setTimeout(function(){U.showPopover()},2e3))}else U.destroyPopover()},100,!1)},O={currentTop:0,activeElement:null,container:null,isReady:!1,reset:function(){this.isReady=!1,window.requestAnimationFrame(function(){O.isReady=!0,O.update(),O.container.addEventListener("scroll",function(){O.save()})})},save:function(){this.currentTop=this.container.scrollTop},update:function(e){this.isReady&&(O.container.scrollTop="number"==typeof e?e:O.currentTop)},goToActiveElement:function(){var e=this.activeElement.offsetTop-this.container.offsetTop;this.update(e)}},F={options:null,elements:null,visible:!1,dashboards:null,cockpits:null,_search:"",_enabled:!0,init:function(e){v=require("DS/Dashboard/DashboardManager"),F.options=e,F.visible=!1,F.search="",l.isBELayoutEditorMode()||l.isAddinMode()||l.isSWAMode()||l.isLockedAppMode()?F._enabled=!1:(t.registerHelper("NewDashboardMenu_getDashThumbnailUrl",function(e){return c._getContextThumbnailUrl(e)}),t.registerHelper("NewDashboardMenu_shouldShowThumbnail",function(e,t){return w&&e?t.fn(this):t.inverse(this)}),F.onAfterTabLoad=function(){this.once||(U.getVisibility()&&F.open(),this.once=!0)}.bind({}),F.fetch(),F.render(),F._refreshUIDebounced=r.debounce(F._refreshUI,200),[c.events.dashboard.rename,c.events.dashboard.unshare,c.events.dashboard.trashPending,c.events.dashboard.trash,c.events.dashboard.untrash,c.events.dashboard.duplicate,c.events.dashboard.add,c.events.dashboard.remove,c.events.dashboard.created,c.events.dashboard.addFavorites,c.events.dashboard.removeFavorites,c.events.dashboard.reorderFavorites,c.events.dashboard.setThumbnail,c.events.dashboard.unsetThumbnail,c.events.dashboard.contextApiBaseUrlChange,c.events.member.add,c.events.member.remove].forEach(function(e){n.add(e,function(){[c.events.dashboard.rename,c.events.dashboard.unshare,c.events.dashboard.trashPending,c.events.dashboard.trash,c.events.dashboard.untrash,c.events.dashboard.duplicate,c.events.dashboard.add,c.events.dashboard.remove,c.events.dashboard.created,c.events.dashboard.setThumbnail,c.events.dashboard.unsetThumbnail].includes(e)&&(_=!0),F._refreshUIDebounced()})}),n.add(c.events.dashboard.change,function(){F._updateActiveContext(),F._scrollToActiveContext()}),n.addOnce(c.events.tab._loadingStable,function(){F._enabled&&(w=!0,F._refreshUIDebounced())}),window.addEventListener("resize",F._resize))},render:function(){var e=L.getContexts(),n=F.options.container;n.innerHTML=t.compile(m)({emptyFavorite:0===e.length,favorites:e,emptyDashboards:0===F.dashboards.length,dashboards:F.dashboards,search:F.search,emptyCockpits:0===F.cockpits.length,cockpits:F.cockpits,nls:p}),F._initElements(),F._initDraggable(),F._filterDashboards(),F._enableSearch(),O.reset(),n.removeEventListener("click",F._clickManager),n.addEventListener("click",F._clickManager),!matchMedia("(hover: none)").matches&&(n.removeEventListener("mouseover",U.onMouseOver),n.addEventListener("mouseover",U.onMouseOver),n.removeEventListener("mouseleave",U.onMouseLeave),n.addEventListener("mouseleave",U.onMouseLeave));var i=F.elements;i.dashboardMenuClose&&new a({position:"bottom",target:i.dashboardMenuClose,body:p.dashboardMenuClose,offset:{x:0,y:0}}),i.dashboardMenuAddDashboard&&new a({position:"bottom",target:i.dashboardMenuAddDashboard,body:p.addItem,offset:{x:0,y:0}}),i.dashboardMenuManageDashboard&&new a({position:"bottom",target:i.dashboardMenuManageDashboard,body:b.manageTitle,offset:{x:0,y:0}}),i.dashboardMenuTrashDashboard&&new a({position:"bottom",target:i.dashboardMenuTrashDashboard,body:p.recycleBinItem})},fetch:function(){L.fetch(),U.fetchContexts(),F.dashboards=U.getDashboards(),F.cockpits=U.getCockpits()},open:function(e){!F.visible&&F._enabled&&(!(e=e||{}).fromSave||U.getVisibility()?(document.body.classList.add("new-dashboard-menu-opened"),document.querySelector(".column.left").classList.add("new-dashboard-menu-opened"),F.options.onOpen(),F._hideDashboardMenuOpen(),F.visible=!0,U.saveVisibility(F.visible),window.requestAnimationFrame(function(){window.requestAnimationFrame(function(){!r.hasTouch()&&F.elements.dashboardSearchInput.focus(),F._scrollToActiveContext()})})):F._showDashboardMenuOpen())},close:function(e){(e=e||{}).hide&&F._hideDashboardMenuOpen(),F.visible&&(document.body.classList.remove("new-dashboard-menu-opened"),document.querySelector(".column.left").classList.remove("new-dashboard-menu-opened"),F.options.onClose(),!e.hide&&F._showDashboardMenuOpen(),F.visible=!1,!e.noSave&&U.saveVisibility(F.visible),U.destroyPopover())},isOpen:function(){return F.visible},enable:function(){F._enabled=!0,F._showDashboardMenuOpen()},disable:function(){F.close({hide:!0,noSave:!0}),F._enabled=!1},isEnabled:function(){return F._enabled},getOpenMenuBtn:function(){return F.dashboardMenuOpen},routeToNextContext:function(){l.routeTo({keepAll:!0,dashboard:F._getNextContext()})},onAfterTabLoad:function(){},_refreshUI:function(){F._enabled&&(F.fetch(),F.render(),F._updateActiveContext(),_&&(_=!1,F._scrollToActiveContext()))},_resize:function(){window.innerWidth<=x&&"wide"===U.width?(U.width="narrow",F.close({noSave:!0})):window.innerWidth>x&&"narrow"===U.width&&(U.width="wide",U.getVisibility()?F.open():F.isOpen()&&U.saveVisibility(!0))},_enableSearch:function(){var e=F.elements;e.dashboardSearchInput.addEventListener("keyup",function(t){F.search=t.target.value,F._filterDashboards(),F.search?(e.dashboardSearchInputCloseIcon.classList.remove(I),e.dashboardSearchInputSearchIcon.classList.add(I)):(e.dashboardSearchInputCloseIcon.classList.add(I),e.dashboardSearchInputSearchIcon.classList.remove(I))}),e.dashboardSearchInputCloseIcon.addEventListener("click",function(){F.search="",F.render(),e.dashboardSearchInput.focus()})},_filterDashboards:function(){var e=F.search.toLowerCase().trim();F.elements.dashboardMenuListItems.forEach(function(t){e&&-1===t.innerText.toLowerCase().indexOf(e)?t.classList.add(I):t.classList.remove(I)})},_updateActiveContext:function(e){var t=F.elements,n=!e&&c._getActiveContext();(n||e)&&(e=e||n.modelId,t.dashboardMenuListItems.forEach(function(t){t.dataset.modelid===e?(t.classList.add(C),O.activeElement=t):t.classList.remove(C)}))},_scrollToActiveContext:function(){var t=F.elements.dashboardMenuList;O.activeElement||F._updateActiveContext(),window.requestAnimationFrame(function(){!O.activeElement||e.extendElement(O.activeElement).isInViewport(t,!0)||O.goToActiveElement()})},_initDraggable:function(){var e,t,n,a,i,s,d="dragging",l="handle-dragged",u="hovering-placeholder",h=F.options.container,m=F.elements,g=m.dashboardMenuList,f=m.dashboardMenuFavoritesItemsCtn,p=m.dashboardTrashPlaceHolder,b=m.dashboardAddPlaceholder,v=m.dashboardMovePlaceholder,w=m.dashboardEmptyPlaceholder;function _(e){if(D&&i&&s&&i.classList.contains(S)){var n=W.getFormatEvent(e),a=g.getBoundingClientRect(),o=a.top,r=a.bottom,d=g.scrollTop;g.scrollTop&&n.y>=o&&n.y<=o+50&&(g.scrollTo(0,d-10),t({x:n.x,y:o+25})),Math.ceil(g.scrollTop)<g.scrollHeight-g.offsetHeight&&n.y<=r&&n.y>=r-50&&(g.scrollTo(0,d+10),t({x:n.x,y:r-25}))}}function x(e,t){var n,a,i=W.getFormatEvent(t),o=i.x&&i.y&&document.elementFromPoint(i.x,i.y),r=o&&W.findAncestor(o,".dashboard-menu-favorites");L.hasFavorites()&&r&&(n=o&&W.findAncestor(o,"."+P),a=o&&W.findAncestor(o,".dashboard-menu-favorites-title"),n&&f.insertBefore(e,n.nextSibling),a&&f.insertBefore(e,f.firstChild))}e={container:h,items:"."+P,limit:!1,textSelection:!1,autoscroll:!1,movePlayer:!0,area:10,shouldIgnoreDrag:function(e){var t=!1;return e.target.getAttribute("data-type")===c.BUSINESS_EXP_INSTANCE_TYPE&&(t=!0),t},beforeStart:function(e,t){i=t.player,clearTimeout(n),n=setTimeout(function(){D||i.addClassName(l)},200)},start:function(e,o){var s=i.dataset,c=i.parentElement.classList;clearTimeout(a),clearTimeout(n),D=!0,U.destroyPopover(),h.addClassName(d),i.addClassName(S).removeClassName(l),L.isFavorite(s.modelid)||g.scrollTo(0,0),c.contains("dashboard-menu-dashboards-items")&&(b.classList.remove(I),w&&w.classList.add(I)),c.contains(A)&&(p.classList.remove(I),v.classList.remove(I),v.parentNode.insertBefore(v,o.player)),t=r.throttle(_,10,i),["mousemove","touchmove"].forEach(function(e){window.addEventListener(e,t)})},drag:function(e){var t,n=W.getFormatEvent(e),a=parseInt(i.getStyle("top"),10);s=n&&n.x&&n.y&&document.elementFromPoint(n.x,n.y),i.setStyle("left","9px"),a<g.offsetTop&&i.setStyle("top",g.offsetTop),a+i.clientHeight>h.clientHeight&&i.setStyle("top",h.clientHeight-i.clientHeight),x(v,e),x(b,e),s&&(t=!1,W.findAncestor(s,"."+E)?(t=!0,p.classList.add(C)):p.classList.remove(C),W.findAncestor(s,"."+y)?(t=!0,b.classList.add(C)):b.classList.remove(C),W.findAncestor(s,"."+T)?(t=!0,v.classList.add(C)):v.classList.remove(C),t?i.addClassName(u):i.removeClassName(u))},stop:function(){clearTimeout(n),function(){if(i&&s){var e,t,n,a,o,r=i.dataset;if(W.findAncestor(s,"."+y)){for(n=f.children,o=[],a=0;a<n.length;a++)e=n[a],((t=e.classList).contains(y)||t.contains(P))&&o.push(e);U.addFavorite(r.modelid,o.indexOf(b))}else if(W.findAncestor(s,"."+E))U.removeFavorite(r.modelid);else if(W.findAncestor(s,"."+T)){for(n=f.children,o=[],a=0;a<n.length;a++)e=n[a],(t=e.classList).contains(S)||!t.contains(P)&&!t.contains(T)||o.push(e);U.moveFavorite(r.modelid,o.indexOf(v))}L.getAll().length||w&&w.classList.remove(I)}}(),h.removeClassName(d),b.classList.add(I),b.classList.remove(C),p.classList.add(I),p.classList.remove(C),v.classList.add(I),i.removeClassName(S).removeClassName(l).removeClassName(u),["mousemove","touchmove"].forEach(function(e){window.removeEventListener(e,t)}),a=setTimeout(function(){m.dashboardMenuListItems.forEach(function(e){e.classList.remove(S,l,u),e.removeAttribute("style")}),i=null,D=!1},50)}},F.draggableChildElements&&F.draggableChildElements.destroy(),F.draggableChildElements=new o(Object.assign({handle:"."+P+" *"},e)),F.draggableMainElement&&F.draggableMainElement.destroy(),F.draggableMainElement=new o(Object.assign({},e))},_initElements:function(){function e(e,t){return e.querySelector("."+t)}var t,n,a,i=document.body,o=F.options.container,r=F.dashboardMenuOpen||new h({icon:"menu",mainClassName:"new-dashboard-menu-open-btn",tooltip:{position:"bottom",body:p.dashboardMenuBurger,offset:{x:0,y:0}},events:{onClick:F.open}});for(F.dashboardMenuOpen=r,t=o.querySelectorAll("."+P),n=[],a=0;a<t.length;a++)n.push(t[a]);F.elements={dashboardMenuList:e(o,"dashboard-menu-list"),dashboardMenuListItems:n,dashboardMenuFavoritesItemsCtn:e(o,A),dashboardMenuOpen:r.container,dashboardMenuClose:e(i,"new-dashboard-menu-close-btn"),dashboardMenuAddDashboard:e(i,"dashboard-menu-actions-item-add"),dashboardMenuManageDashboard:e(i,"dashboard-menu-actions-item-manage"),dashboardMenuTrashDashboard:e(i,"dashboard-menu-actions-item-trash"),dashboardTrashPlaceHolder:e(o,E),dashboardAddPlaceholder:e(o,y),dashboardEmptyPlaceholder:e(o,"favorite-placeholder-empty"),dashboardMovePlaceholder:e(o,T),dashboardSearchInput:e(o,"dashboard-menu-actions input"),dashboardSearchInputSearchIcon:e(o,"dashboard-menu-actions .fonticon-search"),dashboardSearchInputCloseIcon:e(o,"dashboard-menu-actions .clear-btn")},O.container=F.elements.dashboardMenuList},_clickManager:(N=0,function(e){D||(1==++N?[".thumbnail"].find(function(t){return W.findAncestor(e.target,t)})?k=setTimeout(function(){N=0,F._onClickDispatcher(e)},500):(N=0,F._onClickDispatcher(e)):2===N&&(clearTimeout(k),N=0,F._onDbClickDispatcher(e)))}),_onClickDispatcher:function(e){var t,n=e.target,a=M();n&&((t=W.findAncestor(n,"."+P))?(O.save(),l.routeTo({dashboard:t.dataset.modelid}),F._updateActiveContext(t.dataset.modelid),F._scrollToActiveContext()):W.findAncestor(n,".new-dashboard-menu-close-btn")?a=!0:W.findAncestor(n,".dashboard-menu-actions-item-add")?v.addDashboard.apply(v,arguments):W.findAncestor(n,".dashboard-menu-actions-item-manage")?d.open():W.findAncestor(n,".dashboard-menu-actions-item-trash")?v.manageTrashedDashboard.apply(v,arguments):a=!1,a&&F.close())},_onDbClickDispatcher:function(e){var t,n=e.target,a=M();n&&(W.findAncestor(n,".thumbnail")?(t=W.findAncestor(n,"."+P),d.open({contextModelId:t.dataset.modelid,facet:b.settingsFacetTitle})):a=!1,a&&F.close())},_showDashboardMenuOpen:function(){var e=F.elements.dashboardMenuOpen;e&&e.classList.remove(I)},_hideDashboardMenuOpen:function(){var e=F.elements.dashboardMenuOpen;e&&e.classList.add(I)},_getNextContext:function(){var e,t,n=F.elements.dashboardMenuListItems;function a(e){return e?e.dataset.modelid:void 0}for(e=n.length-1;e>=0;e--)if(n[e].classList.contains(C)){(t=a(n[e+1]))||(t=a(n[e-1]));break}return t||a(n[0])}};return F}),define("DS/Dashboard/Collections/Members",["UWA/Core","UWA/Class/Collection","DS/Dashboard/PublicAPI","DS/Dashboard/Models/User","DS/Dashboard/Models/Group","DS/Dashboard/Models/Member"],function(e,t,n,a,i,o){"use strict";return t.extend({model:o,actions:null,dashboardId:null,limit:40,fetching:!1,nbOfOwners:null,setup:function(e,t){t=t||{};var n={};this.dashboardId=t.dashboard?t.dashboard.get("modelId"):null,this.actions=t.actions,Object.defineProperty(this,"activeFilters",{get:function(){return n}})},fetch:function(t){t=t||{};var a,i,o=this;o.dashboardId&&!o.fetching&&(i=t.reset?0:o.length,n.getContextMembers(e.extend({id:o.dashboardId,offset:i,limit:o.limit,success:function(e){var n=e.members,i=t.onComplete;o.nbOfOwners=e.noOfOwners,a=t.reset?"reset":"add",t.parse=!0,o[a](n,t).length<o.limit&&o.dispatchEvent("onEnd"),o.fetching=!1,i&&i()},failure:function(){var e=t.onFailure;o.fetching=!1,e&&e(),o.dispatchEvent("onError")}},o.activeFilters)),o.fetching=!0)},parse:function(e,t){var n=[];return(e||[]).forEach(function(e){var r=(e.type||"").toUpperCase();e.actions=this.actions,r===o.USER_TYPE?n.push(new a(e,t)):r===o.GROUP_TYPE?n.push(new i(e,t)):window.console&&window.console.warn('Unknow member type: "'+r+'"')},this),n},hasOwners:function(){return this.nbOfOwners>1},getNbOfOwners:function(){return this.nbOfOwners}})}),define("DS/Dashboard/DockLayoutManager",["DS/UWPClientCode/WidgetCatalog","DS/WebappsUtils/Map","DS/Dashboard/DraggableManager","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker"],function(e,t,n,a,i){"use strict";var o={splitter:".dock-splitter",dockWidget:n.makeWidgetSelector("dock-item")},r=null,s=new t,d=null,l=null,c=null,u="",h=null,m=null,g=!0,f=!1,p=!1,b=!1;function v(e){return!!e.pointer&&d.element.getBoundingClientRect().left<=e.pointer.left}function w(e){var t="compass"===u&&!v(e);(m||[]).forEach(function(e){e.toggleClassName("hide",t)})}function D(){var e=a._getActiveTab();return e&&e.id}function _(e){return n.getWidgetContainer(e.player)||e.player}function C(){return function(){switch(u){case"splitter":return"resize";case"externalWidget":return"otherTab";default:return u}}()+"-dockLayoutManager"}function I(){h=n.buildBodyOverlay(),f?h.inject(document.body):h.inject(d.element,"before")}return{setupDrag:function(){var t=this;r=n.register({manager:this,selectors:o,beforeStart:function(a,i){r.options.distance=0,l=i.player,d=t.get();var o=n.getType(i.target);if(p=require("DS/WidgetPreview/Controller/TransientManager").getInstance().isWidgetOpen(),"compassWidget"===o){if(u="compass",r.options.distance=20,!(l=n.normalizeCompassPlayer(l)))return;c=n.buildCompassConfig(l)}else if("catalogWidget"===o){if(u="catalog",!(c=n.buildCatalogConfig(l)))return t.clean();e.toggle()}else u=o;f=["compass","catalog"].indexOf(u)>-1,"dockWidget"===o&&(r.options.distance=10,l=n.getWidgetContainer(l)),"splitter"===u&&I()},start:function(e,t){if(!f||!p){var a,o="externalWidget"===u,r=_(t);h||I(),d.element.addClassName("dock-dragging"),"splitter"===u&&d.element.addClassName("dock-dragging-splitter"),c&&(a=c.apps&&c.apps.length?c.apps.length:1),o&&(a=1,l.style.top="-22px"),(c||o)&&(l=d.getPlayer({content:o?r.id.substr(2):Array.apply(null,new Array(a)).map(String.prototype.valueOf,""),element:o&&r})),i.track({category:"splitter"===u?"widget.resize":"widget.drag",action:C()}),n.initCrossTabDrag(),d.onDragStart(l,e),m=Array.prototype.slice.call(document.querySelectorAll(".dock-drop-target")),w(t)}},drag:function(e,a){if(!f||!p){var i=_(a),o=require("DS/Dashboard/GridManager"),r=D();b=!0,"splitter"!==u&&n.detectCrossTabDrag(e,a,{player:i,widgetId:i.id&&i.id.substr(2),onExternalWidgetCrosses:function(){var e=t.get(),n=o.get();"compass"!==u&&"catalog"!==u&&i.inject(n?n.elements.wrapper:e.element)},preventStart:function(){return!!t.get()},clean:function(){a.player=a.target,t.prepareExternalPlayer(i);try{s.get(r).removeChild(i)}catch(e){}o.get()&&("dockWidget"!==u&&"externalWidget"!==u||require("DS/LayoutSwitcher/DockLayout").cleanupWidget(i)),t.clean()}}),"compass"===u&&n.toggleCompassIfNeeded(a),w(a),d.onDrag(e)}},stop:function(e,a,o){if(!f||!p){if("splitter"!==u&&b&&i.track({category:"widget.drop",action:C()}),o&&(l.onDragCancel&&l.onDragCancel(),h&&h.destroy(),(m||[]).forEach(function(e){e.remove()})),"compass"===u&&!v(a))return l.onDragCancel&&l.onDragCancel(),void(!o&&t.clean());if(!o&&d.onDragStop(e)&&(f&&n.onNewWidgetDrop(c,{tabId:D(),getAddWidgetParams:function(e){return[e]}}).catch(function(){var e=d.element.getElements(".dock-placeholder"),n=D();(e||[]).forEach(function(e){s.get(n).removeChild(e)}),l.onDragCancel&&l.onDragCancel(),t.clean()}),"externalWidget"===u)){var r=_(a),g=r.id.substr(2),w=D();n.validateCrossTabExistingWidgetDrop({widgetId:g,parentId:w,success:function(){var e=s.get(w);e.addChild({el:r,id:g}),r.classList.contains("minimized")&&t.get().minimize(r),e.switcher.reorder()}})}!o&&t.clean()}}})},clean:function(){h&&h.destroy(),h=null,d&&(d.element.removeClassName("dock-dragging"),d.element.removeClassName("dock-dragging-splitter")),d=null,n.cleanupCrossTabDrag({player:_({player:l&&(l.element||(l instanceof Element?l:null))})}),u="",l=null,c=null,m=null,p=!1,f=!1,b=!1},register:function(e){s.set(e.id,e.layout.activeLayout),!r&&this.setupDrag()},unregister:function(e){s.delete(e)},get:function(e){var t;return e||(e=D()),(t=(s.get(e)||{}).manager)&&t.setEnabled(g),t},enable:function(){g=!0},disable:function(){g=!1},prepareExternalPlayer:function(e){e.style.position="absolute",e.style.left=e.offsetLeft+"px",e.style.width=e.offsetWidth+"px",e.style.height=e.offsetHeight+"px",e.classList.add("dock-item")}}}),define("DS/Dashboard/Views/DashboardSettingsViews/ThumbnailSectionView",["UWA/Class/View","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/PubSub/PubSub","DS/UWPClientCode/I18n","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker","DS/Dashboard/Views/ImageUploadView","i18n!DS/Dashboard/assets/nls/views","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o,r,s,d,l,c){"use strict";return e.extend({MAX_SIZE_IN_BYTES:81920,className:"dashboard-thumb-section section",tagName:"div",parentView:null,acceptedTypes:{"image/png":!1,"image/jpeg":!0,"image/gif":!1,"image/svg+xml":!0},manageDashModal:null,imageUploadView:null,setup:function(e){this.manageDashModal=e.modal,this.parentView=e.parentView},render:function(){var e=this;return e.imageUploadView=new s({maxSizeInBytes:e.MAX_SIZE_IN_BYTES,acceptedTypes:e.acceptedTypes,checkHexaTypes:!0,initialImageSrc:o._getContextThumbnailUrl(e.getModelId()),nls:{emptyImagePreview:d.noThumbnail,acceptedFileTypesAndlimitFileSize:i.replace(d.thumbnailAcceptedFileTypesAndlimitFileSize,{size:80,unit:c.KBUnit}),limitFileSize:i.replace(d.limitFileSize,{size:80,unit:c.KBUnit}),wrongFileType:d.notifThumbnailWrongType},events:{onApply:function(t){return r.track({category:"manageDashboard.thumbnail",action:"applyBtn"}),e.hideNotif(),e.setThumbnail(t)},onReset:function(){return r.track({category:"manageDashboard.thumbnail",action:"resetBtn"}),e.hideNotif(),e.askUnsetThumbnail()},onRestoreView:function(){r.track({category:"manageDashboard.thumbnail",action:"resetBtn-restoreView"}),e.hideNotif()},onError:function(t){"onFailFetchUrl"===(t=t||{}).code?(r.track({category:"manageDashboard.thumbnail",action:"urlFail"}),e.showNotif({msg:t.msg||d.failFetchImageFromUrl})):e.showNotif({msg:t.msg||d.previewError})},onNoFileDropped:function(){e.showNotif({msg:d.noFileDropped})},onUploadValidImage:function(){e.hideNotif()}},trackers:{browseFromBtn:{category:"manageDashboard.thumbnail",action:"browseFromBtn"},browseFromPreview:{category:"manageDashboard.thumbnail",action:"thumbnailBtn"},fetchFileFromUrl:{category:"manageDashboard.thumbnail",action:"url"},dropUrl:{category:"manageDashboard.thumbnail",action:"dropUrl"},dropFile:{category:"manageDashboard.thumbnail",action:"drop"}}}),e.imageUploadView.render(),e.container.addContent([{tag:"div",class:"section-title",text:d.thumbSectionTitle},{tag:"div",class:"section-content",html:[e.imageUploadView.container]}]),r.track({category:"manageDashboard.thumbnail",action:"render"}),e},destroy:function(){this.imageUploadView&&this.imageUploadView.destroy(),this.manageDashModal=null,this.parentView=null,this._parent.apply(this,arguments)},showNotif:function(){this.parentView.showNotif.apply(this.parentView,arguments)},hideNotif:function(){this.parentView.hideNotif.apply(this.parentView,arguments)},maskView:function(e){n.mask(this.container,e)},unmaskView:function(){n.unmask(this.container)},hasThumbnail:function(){return!!this.model.get("thumbnail")},getModelId:function(){return this.model.get("modelId")},setThumbnail:function(e){var t=this;return new Promise(function(n,i){function s(){t.showNotif({msg:d.notifThumbSetFail}),t.unmaskView(),i()}if(t.maskView(d.waitSaveThumb),!e||!e.src)return s();o.setContextThumbnail({id:t.getModelId(),file:e,success:function(e){r.track({category:"dashboard.thumbnail.set",action:"set-view"}),t.unmaskView(),t.model.set("thumbnail",e),a.dispatch(o.events.dashboard.setThumbnail),t.showNotif({msg:d.notifThumbSetSuccess,type:"success"}),n(!0)},failure:s})})},askUnsetThumbnail:function(){var e=this;return e.hasThumbnail()?new Promise(function(n,a){var i=new t({closable:!0,overlay:!0});e.manageDashModal.hide(),i.confirm(d.setThumbModalContentReset,d.setThumbModalTitleReset,function(t){return e.manageDashModal.show(),(t?e.unsetThumbnail():Promise.resolve(!1)).then(n).catch(a)},l.yesBtn,l.noBtn)}):Promise.resolve(!0)},unsetThumbnail:function(){var e=this;return e.hasThumbnail()?(e.maskView(d.waitResetThumb),new Promise(function(t,n){o.unsetContextThumbnail({id:e.getModelId(),success:function(){e.unmaskView(),e.model.set("thumbnail",void 0),a.dispatch(o.events.dashboard.unsetThumbnail),e.showNotif({msg:d.notifThumbResetSuccess,type:"success"}),r.track({category:"dashboard.thumbnail.reset",action:"resetSuccess-view"}),t(!0)},failure:function(){e.showNotif({msg:d.notifThumbResetFail}),e.unmaskView(),r.track({category:"dashboard.thumbnail.reset",action:"resetFail-view"}),n()}})})):Promise.resolve(!0)},onFacetSelect:function(){r.track({category:"manageDashboard.thumbnail",action:"facetSelect"})}})}),define("DS/Dashboard/SWAModeManager",["UWA/Core","UWA/Utils/Client","DS/UIKIT/Alert","DS/UWPClientCode/I18n","DS/Dashboard/PublicAPI","DS/Dashboard/Utils","DS/Dashboard/CompassManager","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s){"use strict";var d;return d={init:function(){d._initEvents()},onSetWidgetAsTopBarContext:function(e){var t=e.widgetId,n=i._getWidget(t),a=i._getWidgetName(n);d._setSWAManifest(n),d._showHowInstallSWAAlert({widgetName:a})},_initEvents:function(){},_showHowInstallSWAAlert:function(i){if(t.Platform.ios&&t.Engine.safari&&!window.navigator.standalone||"showInstallSWAAlert"in o.getParsedQuery()){var r,d,l,c=i.widgetName;r=new n({className:"encourage-ios-install-swa-alert ifwe-dashboard-notify",visible:!0}).inject(document.body,"top"),d=o.buildPath(window.dsDefaultWebappsBaseUrl,"Dashboard/assets/images/share-apple.svg"),l=e.createElement("div",{html:[{tag:"div",class:"title",text:a.replace(s.howInstallSWAAlertTitle,{name:c})},{tag:"div",class:"message",html:"<span>"+a.replace(s.howInstallSWAAlertMsg,{name:c})+"</span>"},{tag:"div",class:"hint",html:"<span>"+a.replace(s.howInstallSWAAlertHint,{icon:'<img class="safari-share-icon" src="'+d+'">'})+"</span>"}]}),r.add({className:"primary",message:l})}},_setSWAManifest:function(n){var a=t.Platform.ios,i=n.environment,s=i.getName(),d=i.getAppId()||r.appIds.runYourApp;return"serviceWorker"in navigator&&navigator.serviceWorker.register(o.buildPath(window.dsBaseUrl,"service-worker.js")),(d?r.getAppIcon({appId:d,pngFormat:a}):Promise.resolve("")).then(function(t){var n,i,r;a?(i={href:t},(r=document.querySelector('link[rel="apple-touch-icon"]'))&&(r.href=i.href),function(e){var t=document.querySelector('meta[name="apple-mobile-web-app-title"]');t&&(t.content=e.content)}({content:s}),n=[{src:t,sizes:"64x64",type:"image/png"}]):n=[{src:t,sizes:"48x48 72x72 96x96 128x128 144x144 256x256 512x512",type:"image/svg+xml",purpose:"any"}],function(t){var n,a,i,o=t.name;n={name:o,short_name:o,display:"standalone",description:"SWA App: "+o,icons:t.icons,start_url:t.startUrl},t.id&&(n.id=t.id),a="data:application/manifest+json,"+encodeURIComponent(JSON.stringify(n)),(i=document.querySelector('head link[rel="manifest"]'))?i.setAttribute("href",a):(i=e.createElement("link",{rel:"manifest",href:a}),document.querySelector("head").appendChild(i))}({name:s,icons:n,id:o.buildPath(window.location.pathname,window.location.search),startUrl:window.location.href})})}}}),define("DS/Dashboard/Modals/RenameTab",["UWA/Core","DS/UIKIT/SuperModal","DS/Dashboard/UsageTracker","DS/Dashboard/PublicAPI","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i){"use strict";var o;return o={buildCallback:function(t,a){return function(i){(i=(i=i||"").trim())?(e.is(t,"function")&&t.call(null,i),n.track({category:"tab.renameModal",action:"renameBtn"})):(e.is(a,"function")&&a.call(null,i),n.track({category:"tab.renameModal",action:"cancelBtn"}))}},buildModal:function(a){var o,r;return r=new t({renderTo:document.body,closable:!1,events:{onShow:function(){var t,s,d,l,c=/<.*>/i;s=(t=r.modals.current)?t.elements:"",t=t?s.body:"",t=o=t?t.getElement("input"):"",l=s.footer.getElement(".btn-primary"),t&&(t.addEvent("keyup",function(){var n=t.value.trim(),a=c.test(n);!n||a?(l&&l.setAttribute("disabled",""),a&&(d?d.show():d=e.createElement("div",{class:"alert-warning alert-message",content:i.renameTabNoHTML}).inject(t,"before"))):(d&&d.hide(),l&&l.removeAttribute("disabled"))}),a.name&&(t.value=a.name,t.select(),e.Utils.Client.Features.touchEvents&&t.setSelectionRange(0,9999)),n.track({category:"tab.renameModal",action:"open"}))},onHide:function(){o&&o.destroy(),n.track({category:"tab.renameModal",action:"close"})}}})}},{show:function(e){o.buildModal(e=e||{}).prompt(i.renameTabBody,i.renameTabTitle,o.buildCallback(e.confirm,e.cancel),i.okBtn,i.cancelBtn,e.name?e.name:i.renameTabPlaceholder,!1,void 0,a.TAB_NAME_MAX_LENGTH)}}}),define("DS/Dashboard/ManageDashboard/ManageDashboard",["UWA/Promise","DS/PubSub/PubSub","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/Modal","DS/Dashboard/UsageTracker","DS/UIKIT/Mask","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s){"use strict";var d;return d={_modal:null,_isBuilt:!1,_onCloseFn:null,_options:null,_onResizeFn:null,elements:null,open:function(t){d._options=t||{},d._options.refresh&&d._modal&&(d._modal.destroy(),d._modal=null,d._isBuilt=!1);var n=e.resolve();return d._modal||(n=d._buildModal()),n.then(function(){d._modal.show()})},close:function(){d._modal&&d._modal.hide()},isOpen:function(){return!(!d._modal||!d._modal.isVisible)},_buildModal:function(){return d._modal=new i({header:"<h4>"+s.manageTitle+"</h4>",className:"manage-db-modal",closable:!0,events:{onShow:d._onShow,onHide:d._onHide}}),e.resolve()},_onShow:function(){if(!d._isBuilt)return d._onCloseFn=d._onClose.bind(d._modal),r.mask(d._modal.elements.body),new e(function(e,t){require(["DS/Dashboard/ManageDashboard/Controller/ManageDashboard"],function(t){t._initMainView(d._modal,d._options).then(function(){d._isBuilt=!0,r.unmask(d._modal.elements.body),d._onShow()}).then(e).catch(function(){r.unmask(d._modal.elements.body)})},t)});a.isBELayoutEditorMode()&&d._modal.elements.content.addClassName("business-experience-layout"),screen.width<=639&&d._modal.elements.content.addClassName("mobile-device"),d._addResizeEvent(),d._modal.elements.close.addEvent("click",d._onCloseFn),o.track({category:"manageDashboard.modal",action:"open"}),t.dispatch(n.events.manageDashboard.open)},_onHide:function(){d._removeResizeEvent(),a.getUrlParameter(a.parts.manage)&&a.routeTo({keepAll:!0,discards:a.parts.manage}),t.dispatch(n.events.manageDashboard.close),o.track({category:"manageDashboard.modal",action:"close"})},_onClose:function(){d._modal.elements.close.removeEvent("click",d._onCloseFn),o.track({category:"manageDashboard.modal",action:"closeBtn"})},_addResizeEvent:function(){d._onResizeFn=d._onResize.bind(d._modal),window.addEventListener("resize",d._onResizeFn)},_removeResizeEvent:function(){window.removeEventListener("resize",d._onResizeFn)},_onResize:function(e){var t=d._modal;t.currentScreenWidth=e.target.innerWidth,t.currentScreenWidth<=639?t.elements.content.addClassName("mobile-device"):t.elements.content.removeClassName("mobile-device")}}}),define("DS/Dashboard/Collections/BusinessExperienceLayouts",["DS/Dashboard/PublicAPI","DS/Dashboard/Models/Dashboard","DS/Dashboard/Collections/DashboardsAbstract"],function(e,t,n){"use strict";return n.extend({model:t,tags:{},setup:function(e,t){t=t||{},this.actions=t.actions},fetch:function(t){var n=(t=t||{}).onComplete,a=t.reset?"reset":"set",i=e._getAllBusinessExpLayoutContexts("name","asc");t.parse=!0,this[a](i,t),n&&n(this,i,t)},parse:function(e){var t=this;return(e=e||[]).forEach(function(e){e.actions=t.actions,e.contextId=e.id}),e}})}),define("DS/Dashboard/TagNavManager",["DS/PubSub/PubSub","DS/TagNavigator/TagNavigator","DS/Dashboard/PublicAPI"],function(e,t,n){"use strict";var a,i,o,r={};function s(){function t(){var e=a._getFocusContainerId();delete r[e],a.unfocusTagger({containerId:e})}e.add(n.events.widget.focus,function(e){setTimeout(function(){!function(e){var t=a._getFocusContainerId();r[t]=e.id,a.focusTagger({containerId:t,widgetId:e.id})}(e)})}),e.add(n.events.widget.destroy,function(e){var n=a._getFocusedWidgetId({containerId:i.getCurrentTabId()});e.id===n&&t()}),e.add(n.events.widget.unfocus,t),e.add(n.events.tab.refresh,t)}return a={WIDGET_PREVIEW_CONTAINER_ID:"transient",init:function(){i=require("DS/Dashboard/TopFrameManager"),o=require("DS/Dashboard/WidgetPreviewManager"),a._initEvents()},getTagger:function(e){var n=(e=e||{}).containerId||i.getCurrentTabId();return t.get6WTagger(n)},focusTagger:function(e){var t=(e=e||{}).widgetId,n=a.getTagger({containerId:e.containerId});if(n){if(n.setAsCurrent(),e.removeAllProxies&&n.removeAllProxies(),!t)return a.unfocusTagger({containerId:e.containerId});n.focusOnCC(t)}},unfocusTagger:function(e){var t,n=(e=e||{}).containerId||i.getCurrentTabId(),o=a.getTagger({containerId:n});o&&(o.setAsCurrent(),e.removeAllProxies&&o.removeAllProxies(),(t=a._getFocusedWidgetId({containerId:n}))?a.focusTagger({widgetId:t,containerId:n}):o.unfocusCC())},removeAllProxies:function(e){e=e||{};var t=a.getTagger({containerId:e.containerId});t&&t.removeAllProxies()},removeProxy:function(e){var t=a.getTagger({containerId:e.containerId}),n=e.widgetId;t&&n&&t.removeProxiesOfCC(n)},_getFocusedWidgetId:function(e){return r[(e=e||{}).containerId||a._getFocusContainerId()]},_getFocusContainerId:function(){return o.hasOpened()?"transient":i.getCurrentTabId()},_initEvents:function(){e.add(n.events.widget.destroy,function(e){e=e||{},a.removeProxy({widgetId:e.id})},null,!0),s()}}}),define("DS/Dashboard/Collections/DashboardsTrash",["DS/Dashboard/PublicAPI","DS/Dashboard/Models/Dashboard","DS/Dashboard/Collections/DashboardsAbstract"],function(e,t,n){"use strict";return n.extend({model:t,tags:{},setup:function(e,t){t=t||{},this.actions=t.actions},fetch:function(t){var n=(t=t||{}).onComplete,a=t.reset?"reset":"set",i=e._getTrashedContexts("name","asc").filter(function(e){return e.owner});t.parse=!0,this[a](i,t),n&&n(this,i,t)},parse:function(e){var t=this;return(e=e||[]).forEach(function(e){e.actions=t.actions,e.contextId=e.id,e._originalRoleBeforeTrashed||(e._originalRoleBeforeTrashed=e.role)}),e}})}),define("DS/Dashboard/Modals/AddRenameDashboard",["UWA/Core","UWA/Element","UWA/Event","DS/UIKIT/SuperModal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l,c){"use strict";var u,h,m,g,f,p,b,v={},w=null,D=null,_=d._getTemplateContextBlackList(),C=/<.*>/i;function I(){var t=v.dashNameWarn,n=v.nameInput.getValue().trim(),a=C.test(n);p=""===n,(m||b)&&p?E():T(),a?(g=!0,E(),t?t.show():v.dashNameWarn=e.createElement("div",{class:"alert-warning alert-message",content:c.renameDashboardNameNoHTML}).inject(v.nameInput.elements.input,"before")):(g=!1,T(),t&&t.hide())}function S(){var t=v.dashDescriptionWarn;C.test(v.descriptionInput.getValue())?(f=!0,E(),t?t.show():v.dashDescriptionWarn=e.createElement("div",{class:"alert-warning alert-message",content:c.renameDashboardDescriptionNoHTML}).inject(v.descriptionInput.elements.input,"before")):(f=!1,T(),t&&t.hide())}function y(){return w.modals.current.elements.footer.getElement("button")}function E(){var e=y();e.disabled=!0,e.addClassName("disabled")}function T(){var e,t=y();e=g||f||(m||b)&&p,t.disabled=e,!e&&t.removeClassName("disabled")}function A(e){u.hide(!0),l.track({category:h,action:"cancelBtn"}),e&&e()}function P(){var s,u,g,f,p,b,C,E,T,A;if(v={},u=new t("span",{class:"name-label",text:m?c.renameDashboardNameLabel:c.addEmptyDashboardNameLabel}),C=new t("span",{class:"required-icon",text:"*"}),E=new t("span",{class:"name-label-ctn",html:[u,C]}),s=new i({className:"name-input",value:m&&D.name||"",placeholder:m?D.name||"":c.addEmptyDashboardPlaceholder,maxlength:d.DASH_NAME_MAX_LENGTH,events:{onChange:I}}),g=new t("div",{class:"description-label",text:m?c.renameDashboardDescriptionLabel:c.addDashboardDescriptionLabel}),f=new i({className:"description-input",value:m&&D.data.description||"",multiline:!0,placeholder:m&&d._isEndUserCockpitContext(T)?c.cockpitDescriptionPlaceholder:c.dashboardDescriptionPlaceholder,rows:4,maxlength:d.DASH_DESC_MAX_LENGTH,events:{onChange:S}}),s.elements.input.addEvent("input",I),f.elements.input.addEvent("input",S),p=[E,s,g,f],!m){var P=(A=Object.keys(_).map(function(e){return _[e]}),d._getTemplateContexts().filter(function(e){return-1===A.indexOf(e.modelId)}));P.length>0&&function(t){var n,a,i;a=new r({name:"template",type:"radio",className:"primary default",label:c.startFromEmptyLabel,checked:!0,events:{onClick:function(){k(!1),l.track({category:h,action:"temlateOffToggle"})}}}),n=new r({name:"template",type:"radio",className:"primary",value:"on",label:c.startFromTemplateLabel,events:{onClick:function(){k(!0),l.track({category:h,action:"temlateOnToggle"})}}}),i=new o({className:"template-input",showTooltips:!0,placeholder:!1,options:function(e){return e.map(function(e){return T=e.modelId,{label:e.name,value:e.modelId}})}(t),disabled:!0}),p.unshift([a,n,i]),e.extend(v,{templateOffToggle:a,templateOnToggle:n,templateInput:i})}(P)}b=new t("form",{html:p,events:{submit:function(e){n.stop(e),y().click(),l.track({category:h,action:"submit"})}}}),e.extend(v,{nameLabelCtn:E,nameLabel:u,nameRequiredIcon:C,nameInput:s,descriptionLabel:g,descriptionInput:f,body:b}),m?M():C.hide(),w=new a({className:"add-rename-dashboard-modal "+(m?"rename-modal":"add-modal"),renderTo:document.body,closable:!0,events:{onShow:function(){l.track({category:h,action:"open"})},onHide:function(){l.track({category:h,action:"close"})}}})}function x(){v.nameRequiredTooltip&&v.nameRequiredTooltip.destroy(),delete v.nameRequiredTooltip}function M(){x(),v.nameRequiredTooltip=new s({position:"right",target:v.nameLabelCtn,body:c.fieldRequired,offset:{x:5,y:0}})}function k(e){var t=v.nameRequiredIcon;b=e,v.templateInput.setDisabled(!e),v.nameLabel.setText(e?c.addDashboardNameLabel:c.addEmptyDashboardNameLabel),e?(t.show(),M()):(t.hide(),x()),v.nameInput.elements.input.set("placeholder",e?c.addDashboardPlaceholder:c.addEmptyDashboardPlaceholder),I()}return u={show:function(e){var t=[];if(g=!1,f=!1,p=!0,b=!1,m=!!e.modelId){if(h="dashboard.renameModal",!(D=d._getContext(e.modelId)))throw new Error("Context not found: "+e.modelId);p=!D.name}else h="dashboard.addModal",D=null;P(),t.push({className:"default",value:c.cancelBtn,action:function(){A(e.cancel)}}),t.push({className:"primary",value:m?c.saveBtn:c.createBtn,action:function(){!function(e){var t,n,a,i,o,r;if(t=v.nameInput.getValue().trim(),n=v.descriptionInput.getValue().trim(),m){if(m&&!t)return void A()}else{if(v.templateOnToggle&&v.templateOnToggle.isChecked()){if(i=(v.templateInput.getValue()||[])[0],!(a=d._getContext(i)))throw new Error("Template context not found: "+i);o=t,r=a.thumbnail&&a.thumbnail.id,l.track({category:h,action:"template:"+a.name})}!t&&l.track({category:h,action:"emptyName"})}l.track({category:h,action:m?"renameBtn":"createBtn"}),u.hide(!0),e({name:t,description:n,templateModelId:i,templateTopic:o,thumbnailId:r})}(e.confirm)}}),w.dialog({body:v.body,title:m?d._isEndUserCockpitContext(e.modelId)?c.renameCockpitTitle:c.renameDashboardTitle:c.addDashboardTitle,buttons:t}),v.nameInput.focus()},hide:function(e){w.modals.current.hide(),e&&w.destroy()}}}),define("DS/Dashboard/Views/WidgetLinkModeView",["UWA/Element","UWA/Class/View","DS/PubSub/PubSub","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/Dashboard/PublicAPI","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n,a,i,o,r){"use strict";return t.extend({className:"widget-link-mode-view",tagName:"div",widgetId:"",state:"nonLinkable",_initialState:"nonLinkable",setup:function(e){this.widgetId=e.widgetId,e.isOrigin?this.state="origin":e.isLinked?this.state="linked":e.isLinkable?this.state="linkable":this.state="nonLinkable",this._initialState=this.state},destroy:function(){this._parent.apply(this,arguments)},render:function(){switch(this.container.empty(),this._cleanClassNames(),this.state){case"origin":this._renderOrigin();break;case"linked":this._renderLinked();break;case"linkable":this._renderLinkable();break;default:this._renderNoneLinkable()}return this},setOrigin:function(){if("origin"!==this.state)return this.state="origin",this.render()},setLinked:function(){if("linked"!==this.state)return this.options.onLinked(),this.state="linked",this.render()},setLinkable:function(){var e=this.state;if("linkable"!==e)return"linked"===e&&this.options.onUnlinked(),this.state="linkable",this.render()},setNoneLinkable:function(){var e=this.state;if("nonLinkable"!==e)return"linked"===e&&this.options.onUnlinked(),this.state="nonLinkable",this.render()},_renderOrigin:function(){var t=this.container;t.addClassName("origin-view"),new e("div",{class:"body-view",html:[{tag:"div",class:["link-icon","fonticon fonticon-link"].join(" ")},{tag:"div",class:["link-text"].join(" "),text:r.originText},{tag:"div",class:"btns",html:[{tag:"div",class:"link-all-btn",text:r.linkAllBtn,events:{click:function(){n.dispatch(o.events.widgetLinkMode._linkAll)}}},{tag:"div",class:"unlink-all-btn",text:r.unlinkAllBtn,events:{click:function(){n.dispatch(o.events.widgetLinkMode._unlinkAll)}}}]}]}).inject(t)},_renderLinked:function(){var t=this,a=t.container,s=t.elements;a.addClassName("linked-view"),new e("div",{class:["body-view"].join(" "),events:{click:function(){t.setLinkable(),n.dispatch(o.events.widgetLinkMode._unlink,t.widgetId)}},html:[{tag:"div",class:["linked-icon","fonticon fonticon-status-ok"].join(" ")},{tag:"div",class:["linked-text"].join(" "),text:r.linkedText},{tag:"div",class:["remove-link-btn"].join(" "),text:r.removeLinkBtn},{tag:"div",class:["linked"===t._initialState?"hide":"","updated-icon","fonticon fonticon-new-create"].join(" ")}]}).inject(a),s.updatedIconTooltip&&s.updatedIconTooltip.destroy(),s.updatedIconTooltip=new i({position:"bottom",target:a.getElement(".updated-icon"),body:r.changesNotSavedYet,offset:{x:0,y:0}})},_renderLinkable:function(){var t=this,s=t.container,d=t.elements;s.addClassName("linkable-view");var l=new e("div",{class:"body-view",events:{click:function(){t.setLinked(),n.dispatch(o.events.widgetLinkMode._link,t.widgetId)}},html:[{tag:"div",class:["linkable"===t._initialState?"hide":"","updated-icon","fonticon fonticon-new-create"].join(" ")}]}).inject(s);new a({className:"create-link-btn default large-icon",icon:"link-add",value:r.linkBtn}).inject(l),d.updatedIconTooltip&&d.updatedIconTooltip.destroy(),d.updatedIconTooltip=new i({position:"bottom",target:s.getElement(".updated-icon"),body:r.changesNotSavedYet,offset:{x:0,y:0}})},_renderNoneLinkable:function(){var e=this.container;e.addClassName("none-linkable-view"),this.elements.noneLinkableWithTooltip=new i({position:"top",target:e,body:r.noneLinkableWithTooltip,offset:{x:0,y:0},trigger:"touch"})},_cleanClassNames:function(){var e=this.container;["origin-view","linked-view","linkable-view","none-linkable-view"].forEach(function(t){e.removeClassName(t)})}})}),define("DS/Dashboard/ManageDashboard/Views/DashboardTileView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView","DS/Dashboard/PublicAPI","DS/UIKIT/Tooltip"],function(e,t,n,a){"use strict";return t.extend({tagName:"div",className:"dashboard-tile-view",elements:{},setup:function(e){this._parent.apply(this,e),this.collectionView=e.collectionView},render:function(){var t,i=this.container,o=this.model,r=o.get("modelId");return this._parent.apply(this,arguments),t=o.get("thumbnail")?e.createElement("img",{class:"thumbnail-img",draggable:!1,src:n._getContextThumbnailUrl(r)}):e.createElement("div",{class:"fonticon fonticon-chart-map-tree thumbnail-icon"}),i.getElement(".tile-check").removeClassName("hidden"),e.createElement("div",{class:"thumbnail",html:t}).inject(i.getElement(".tile-header")),n._isFavouriteContext(r)&&e.createElement("div",{class:"fonticon fonticon-favorite-on db-type-icon"}).inject(i.getElement(".tile-header")),new a({target:i.getElement(".tile-title"),position:"bottom",body:o.get("title")}),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/Dashboard/Views/SearchInTabOverlay",["DS/Dashboard/Views/AbstractSearchIn","DS/Dashboard/Search","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n){"use strict";return e.extend({className:"search-in-tab-overlay",setup:function(e){e.from=t.from.tab,e.targetName="tabId",e.trackerType="tab",this._parent(e)},destroy:function(){this._parent.apply(this,arguments)},render:function(){return this._parent({inputTextPlaceholder:n.searchInTabPlaceholder,elevated:!0})},setPosition:function(e,t){var n=this.container;function a(e){return"number"==typeof e?e+"px":void 0}return e=a(e),t=a(t),e||t?n.addClassName("custom-pos"):n.removeClassName("custom-pos"),n.setStyles({top:t,left:e}),this}})}),define("DS/Dashboard/InitUserDashboards",["UWA/Core","DS/UWPClientCode/PublicAPI","DS/Dashboard/PublicAPI","DS/Dashboard/UserPlatformAccess"],function(e,t,n,a){"use strict";var i,o,r,s="Operator",d={},l=[],c=[],u=[],h=[],m=[],g=!1;function f(e,t){return n.setContextPlatformIdProperty(e,t)}function p(){return Promise.all(u.map(function(e){var t=e.modelId;return n._getContextPlatformIdProperty(t)?Promise.resolve():f(t,n._getGlobalPlatformId()).catch(function(e){return e})}))}function b(){return g?Promise.resolve():(t=n._getAllContexts().map(function(t){var a,i,o=t.modelId,r=n._getContextPlatformIdProperty(o),s=n._getGlobalPlatformId();return r&&r!==s?(f(o,s),n._isReaderContext(t)?Promise.resolve():(a=o,i=s,i?n.setContextPlatformId({id:a,platformId:i}).catch(function(){var t="Fail to set platform id for context: "+a;return e.log(t),{error:t}}):Promise.resolve()).catch(function(e){return e})):Promise.resolve()}),Promise.all(t));var t}function v(){return n._getCurrentMode()!==n.STANDALONE_MODE?Promise.resolve():(a=m.map(function(e){return e.source}),i=h.filter(function(e){return-1===a.indexOf(e.modelId)}),i.length?(t=i.map(function(e){var t=e.modelId;return n.addContext({type:e.type,name:e.name,thumbnailId:e.thumbnail?e.thumbnail.id:null,templateModelId:t}).then(function(e){m.push({source:t,target:e.modelId})}).catch(function(e){return e})}),Promise.all(t).then(function(){return n.setCreatedTemplatesStarters(m)})):Promise.resolve()).then(function(){if(0===n._getAllContexts().length)return n.addDashboard()}).then(function(){g&&n.setLastOpenedContextId(function(){var e,t=d.id;function n(e,t){return(e.find(function(e){return(e.roles||[]).includes(t)})||{}).modelId||""}if(e=(r[0]||{}).modelId)return e;if(t===s&&(e=n(u,s)))return e;var a=n(h,t);return(e=(m.find(function(e){return e.source===a})||{}).target)?e:(e=n(o,t))?e:(e=(m[0]||{}).target)?e:e=(o[0]||{}).modelId}()).catch(function(t){e.log(t)})});var t,a,i}function w(){return new Promise(function(a,i){var s=n._getCurrentMode()===n.STANDALONE_MODE,d=s?{projection:"withoutUserContexts",unMerged:!0}:{serviceName:n._getServiceName()};t.getContextsBy(e.merge(d,{roles:l.map(function(e){return e.id}),platforms:[n._getGlobalPlatformId()],success:function(e){var i=n.STARTER_ROLE;s||(t.contexts=e),c=n._getTemplateContexts(),u=n._getDefaultContexts(),h=c.filter(function(e){return(e.roles||[]).indexOf(i)>=0}),g&&(r=n._getOwnerCustomRoleContexts().filter(function(e){return(e.roles||[]).indexOf(i)>=0&&function(e,t){return(t||[]).some(function(t){if(e.indexOf(t)>=0)return!0})}(l,e.roles)}).concat(n._getDefaultCustomRoleContexts().filter(function(e){return(e.roles||[]).indexOf(i)>=0})),o=u.filter(function(e){return(e.roles||[]).indexOf(i)>=0})),a()},failure:i}))})}return i={init:function(){var t=n._getCreatedTemplatesStarters({isPlatformUnaware:!0}),o=Promise.resolve();if(g=!n._getLastOpenedContextId(),m=n._getCreatedTemplatesStarters(),t.length){var r=n._getAllContexts(),s={},c=!1;t.forEach(function(e){var t=r.find(function(t){return e.target===t.modelId});t&&(c=!0,s[e.source]=e,m.push({source:e.source,target:t.modelId}))}),c&&(t=t.filter(function(e){return!s[e.source]}),o=n.setCreatedTemplatesStarters(m).then(function(){return n.setCreatedTemplatesStarters(t,{isPlatformUnaware:!0}).catch(function(){})}))}return Promise.all([a.fetchUserRoles(),o]).then(function(e){(l=e[0]||[]).some(function(e){if(e.default)return d="CSV"===e.id?{id:"IFW",default:!0,name:"Business Innovation"}:e,!0})}).then(w,function(t){return e.log(t),w()}).then(v,function(t){return e.log(t),v()}).then(b,function(t){return e.log(t),b()}).then(p,function(t){return e.log(t),p()}).then(i._migrateAgnosticFavoritesToAware,function(t){return e.log(t),i._migrateAgnosticFavoritesToAware()}).catch(function(t){throw e.log(t),t})},_migrateAgnosticFavoritesToAware:function(){var e=n._getFavoriteContextModelIds({isPlatformUnaware:!0});if(!e.length)return Promise.resolve();var t={},a=n._getFavoriteContextModelIds(),i=!1;return n._getAllContexts().forEach(function(e){t[e.modelId]=!0}),e.forEach(function(e){t[e]&&!a.includes(e)&&(a.push(e),i=!0)}),i?n.setFavoriteContextModelIds(a).then(function(){return e=e.filter(function(e){return!a.includes(e)}),n.setFavoriteContextModelIds(e,{isPlatformUnaware:!0})}):Promise.resolve()}}}),define("DS/Dashboard/Collections/Dashboards",["UWA/String","UWA/Date","DS/Dashboard/PublicAPI","DS/Dashboard/Models/Dashboard","DS/Dashboard/Collections/DashboardsAbstract","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o){"use strict";return i.extend({model:a,currentUser:!1,tags:{},setup:function(e,t){(t=t||{}).currentUser&&(this.currentUser=!0),t.actions&&(this.actions=t.actions)},fetch:function(e){if(e=e||{},this.currentUser){var t=e.onComplete,a=e.reset?"reset":"set",i=n._getAllContexts("name","asc");e.parse=!0,this[a](i,e),t&&t(this,i,e)}},parse:function(a){var i=this;return(a=a||[]).forEach(function(a){var r,s=[],d=(a.role||(a.owner?"OWNER":"READER")).toLowerCase(),l=n._isAnyDefaultContext(a);a.actions=i.actions,a.contextId=a.id,r=(r=new Date(a.creationDate)).valueOf()?t.strftime(r,"%Y/%m/%d"):"",s.push({object:d,sixw:"ds6w:who/ds6w:role",dispValue:e.capitalize(o[d])},{object:l?"default":"restricted",sixw:"ds6w:what/ds6w:kind",dispValue:e.capitalize(l?o.defaultDashboard:o.dashboard)},{object:l?"public":"private",sixw:"ds6w:how/ds6w:visibility",dispValue:e.capitalize(l?o.public:o.private+" ("+o.secret+")")},{object:r,sixw:"ds6w:when/ds6w:created",dispValue:r,type:"date"}),i.tags[a.modelId]=s}),a}})}),define("DS/Dashboard/Views/PlatformInfoTooltipView",["UWA/Element","UWA/Class/View","DS/UIKIT/Spinner","DS/UIKIT/Tooltip","DS/Dashboard/PublicAPI"],function(e,t,n,a,i){"use strict";var o="credential-text";return t.extend({target:null,platformId:"",xPrefCredential:"",disabled:!0,_tooltip:null,_platformName:"",_collabspace:null,_credential:null,_isCredentialFetched:!1,setup:function(e){this.target=e.target,this.platformId=e.platformId,this.disabled=e.disabled,this.xPrefCredential=this._isValidxPrefCredential(e.xPrefCredential)?e.xPrefCredential:"",this._isCredentialFetched=!1,this._createTooltip()},show:function(){this._tooltip.show()},hide:function(){this._tooltip.hide()},isVisible:function(){return this._tooltip.isVisible},update:function(e){e=e||{};this.platformId=e.platformId||"",this._platformName="",this.xPrefCredential=this._isValidxPrefCredential(e.xPrefCredential)?e.xPrefCredential:"",this._collabspace=null,this._credential=null,this._isCredentialFetched=!1,this.disabled="boolean"!=typeof e.disabled||e.disabled,this.isVisible()?this._onShow():this._updateBody()},destroy:function(){this._tooltip&&(this._tooltip.destroy(),this._tooltip=null),this.target=null,this._collabspace=null,this._credential=null,this._parent.apply(this,arguments)},_getPlatformName:function(){return this._platformName||""},_getCredentialText:function(){var e=this._credential,t=this._collabspace,n="";if(t&&(n+=t.title||t.name||""),e){var a=e.role||{},i=e.organization||{};n&&(n+=" - "),n+=i.title||i.name||"",n+=" - "+(a.nls||a.name||"")}return n},_createTooltip:function(){this._tooltip=new a({className:"platform-info-tooltip",position:"bottom",target:this.target,body:this._buildBody(),offset:{x:0,y:0},events:{onShow:this._onShow.bind(this)}})},_buildBody:function(){var t,a=!!this.xPrefCredential&&!this._isCredentialFetched;return this.elements._body=t=new e("div",{class:[this.disabled?"disabled":"enabled"].join(" "),events:{click:this.options.onClick||function(){}},html:[{tag:"div",class:["platform-ctn","hide"].join(" "),html:[{tag:"div",class:"platform-icon fonticon fonticon-cloud-alt"},{tag:"div",class:"platform-name",text:this._getPlatformName()}]},{tag:"div",class:["credential-ctn",this._shouldShowCredentialCtn()?"":"hide"].join(" "),html:[{tag:"div",class:"credential-icon fonticon fonticon-user-key"},{tag:"div",class:[o].join(" "),text:this._getCredentialText()}]}]}),a&&(new n).inject(t.getElement("."+o)).show(),this._updatePlatformCtnVisibility(),t},_updatePlatformCtnVisibility:function(){var e;function t(){e.addClassName("hide")}return e=this.elements._body.getElement(".platform-ctn"),this.platformId?i.getPlatforms().then(function(n){n.length>1?e.removeClassName("hide"):t()}).catch(function(){t()}):(t(),Promise.resolve())},_shouldShowCredentialCtn:function(){return!!this.xPrefCredential},_isValidxPrefCredential:function(e){return"string"==typeof(e=e||"")&&3===e.split(".").filter(function(e){return e}).length},_fetchPlatformName:function(){var e=this;return i.getPlatforms().then(function(t){var n=e.platformId,a=t.find(function(e){return e.platformId===n})||{};e._platformName=a.displayName||n})},_fetchCredential:function(){var e=this;return e._isCredentialFetched=!1,i.getCollabspaceAndCredential({platformId:e.platformId,xPrefCredential:e.xPrefCredential}).then(function(t){e._collabspace=t.collabspace,e._credential=t.credential,e._isCredentialFetched=!0}).catch(function(t){throw"not-found"===(t=t||{}).code?(e._collabspace={name:t.collabspaceName,title:t.collabspaceName},e._credential={organization:{name:t.organizationName,title:t.organizationName},role:{name:t.roleName,nls:t.roleName}},e._isCredentialFetched=!0):(e._collabspace=null,e._credential=null,e.xPrefCredential=""),e._updateBody(),t})},_updateBody:function(){this._tooltip.setBody(this._buildBody())},_onShow:function(){var e=this;e.platformId&&e._fetchPlatformName().then(function(){e._updateBody()}),e.xPrefCredential&&e._fetchCredential().then(function(){e._updateBody()}),e.platformId||e.xPrefCredential||e._updateBody()}})}),define("DS/Dashboard/Views/WidgetsLinksModeActionBarView",["UWA/Class/View","DS/PubSub/PubSub","DS/UIKIT/Input/Button","DS/Dashboard/PublicAPI","DS/Dashboard/WidgetLinkManager","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n,a,i,o){"use strict";return e.extend({className:"widgets-links-mode-action-bar-view",tagName:"div",originId:"",tabId:"",_linked:[],_newLinked:[],_newUnlinked:[],setup:function(e){this.originId=e.originId,this.tabId=e.tabId,this._newLinked=[],this._newUnlinked=[],this._linked=i.getLinked(this.originId),t.add(a.events.widgetLinkMode._link,this._onLinked.bind(this)),t.add(a.events.widgetLinkMode._unlink,this._onUnlinked.bind(this)),t.add(a.events.widgetLinkMode._linkAll,this._onLinkedAll.bind(this)),t.add(a.events.widgetLinkMode._unlinkAll,this._onUnlinkedAll.bind(this))},destroy:function(){t.remove(a.events.widgetLinkMode._link),t.remove(a.events.widgetLinkMode._unlink),t.remove(a.events.widgetLinkMode._linkAll),t.remove(a.events.widgetLinkMode._unlinkAll),this._linked=null,this._newLinked=null,this._newUnlinked=null,this._parent.apply(this,arguments)},render:function(){var e=this.container,t=this.elements;return t.applyBtn=new n({value:o.applyBtn,className:"apply-btn primary",disabled:!0,events:{onClick:this._onApplyBtn.bind(this)}}).inject(e),t.cancelBtn=new n({className:"cancel-btn default",value:o.cancelBtn,events:{onClick:this._onCancelBtn.bind(this)}}).inject(e),this},_onLinked:function(e){this._removeIdFromArray(e,"_newUnlinked"),this._linked.includes(e)?this._updateApplyBtnState():(!this._newLinked.includes(e)&&this._newLinked.push(e),this._updateApplyBtnState())},_onUnlinked:function(e){this._removeIdFromArray(e,"_newLinked"),this._linked.includes(e)?(!this._newUnlinked.includes(e)&&this._newUnlinked.push(e),this._updateApplyBtnState()):this._updateApplyBtnState()},_onLinkedAll:function(){var e=i.getLinkable(this.originId);e.forEach(this._onLinked,this),this._getWidgets(e).forEach(function(e){e.environment.components.widgetLinkModeView.setLinked()})},_onUnlinkedAll:function(){var e=this._linked.concat(this._newLinked);e.forEach(this._onUnlinked,this),this._getWidgets(e).forEach(function(e){e.environment.components.widgetLinkModeView.setLinkable()})},_removeIdFromArray:function(e,t){var n=this[t],a=n.indexOf(e);a>=0&&n.splice(a,1)},_onApplyBtn:function(){var e={};this._newLinked.forEach(function(t){e[t]=!0}),this._newUnlinked.forEach(function(t){e[t]=!1}),i.setLinked(this.originId,e),this.options.onApply()},_onCancelBtn:function(){this.options.onCancel()},_getWidgets:function(e){return a._getActiveTab().environment.wp.children.filter(function(t){return t.widget&&e.includes(t.id)}).map(function(e){return e.widget})},_updateApplyBtnState:function(){var e=this.elements.applyBtn;this._newLinked.length||this._newUnlinked.length?e.enable():e.disable()}})}),define("DS/Dashboard/Modals/Subscribe",["UWA/Core","UWA/String","UWA/Element","UWA/Event","UWA/Promise","UWA/Data","DS/UWPClientCode/PublicAPI","DS/UWPClientCode/I18n","DS/PubSub/PubSub","DS/WebappsUtils/WebappsUtils","DS/UIKIT/SuperModal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/UsageTracker","DS/Dashboard/CompassManager","DS/Dashboard/Utils","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w){"use strict";var D,_,C,I,S,y,E,T,A,P;return T={article:{subscribeTitle:v.subscribeTitleArticle,userLabel:v.userLabelArticle},widget:{subscribeTitle:v.subscribeTitleWidget,userLabel:v.userLabelWidget},multiWidget:{subscribeTitle:v.subscribeTitleMultiWidget,userLabel:v.userLabelMultiWidget},tab:{subscribeTitle:v.subscribeTitleTab,userLabel:v.userLabelTab,titleExistWarning:v.titleExistWarningTab,renameLabel:v.renameLabelTab},dashboard:{subscribeTitle:v.subscribeTitleDashboard,userLabel:v.userLabelDashboard,titleExistWarning:v.titleExistWarningDashboard,renameLabel:v.renameLabelDashboard},cockpit:{subscribeTitle:v.subscribeTitleCockpit,userLabel:v.userLabelCockpit,titleExistWarning:v.titleExistWarningCockpit,renameLabel:v.renameLabelCockpit}},P={elements:null,isDisplayed:!1,superModal:null,options:null,_action:"",show:function(e){if(!P.isDisplayed){P._init(),P._action="",P.isDisplayed=!0,e=e||{};var t=[];P.options=e,A=e.type,P._buildModal(e),t.push({className:"default",value:v.cancelBtn,action:P._buildCallback(!1,e.confirm,e.cancel)}),t.push({className:"primary",value:v.addBtn,action:P._buildCallback(!0,e.confirm,e.cancel)}),P.superModal.dialog({body:P.elements.body,title:T[A].subscribeTitle,buttons:t})}},hide:function(e){P.superModal.modals.current.hide(),e&&P.superModal.destroy(),P.isDisplayed=!1},_init:function(){D=require("DS/Dashboard/Notification/Subscribe"),_=D._NEW_,C=D.WIDGET_TYPE,I=D.MULTI_WIDGET_TYPE,S=D.TAB_TYPE,y=D.DASHBOARD_TYPE,E=D.COCKPIT_TYPE},_buildModal:function(e){var i,o,r,d,l,g=e.sender,p=e.title,b=e.fullTitle,D=e.message,_=e.warning;(d=new u({placeholder:v.newTitlePlaceholder,value:p,maxlength:255,events:{onChange:P._onNameChanged}})).elements.input.addEvent("input",P._onNameChanged).setData("title",p),o=new h({placeholder:!1,options:P._populateDashboards(),showTooltips:!0,events:{onChange:P._onDashboardChanged}}),r=new h({placeholder:!1,showTooltips:!0,events:{onChange:P._onTabChanged}}),(l={tag:"div",class:"shared-thumbnail"}).html=A===y||A===E||A===S?{tag:"div",class:"fonticon fonticon-chart-map-tree thumbnail-icon"}:{tag:"img",class:"thumbnail-img"},i={events:{submit:function(e){a.stop(e),P.superModal.modals.current.elements.footer.getElement("button").click(),f.track({category:"subscribe.modal."+A,action:"submit"})}},html:[{tag:"div",class:"notification-share section",html:[l,{tag:"div",class:"notification-share-label",title:b||p||"",text:t.cut(b||p||"",m.DASH_NAME_MAX_LENGTH)}]}]},A!==y&&A!==E&&A!==S||i.html.push({tag:"div",class:"notification-rename section",html:[{tag:"div",class:"alert-warning alert-message",content:T[A].titleExistWarning,styles:{display:"none"}},{tag:"p",class:"notification-rename-label",content:T[A].renameLabel},d]}),A!==I&&A!==C&&A!==S||i.html.push({tag:"div",class:"notification-handlers",html:[{tag:"p",class:"notification-handlers-label",content:s.replace(A===C?v.selectForWidgetLabel:A===I?v.selectForWidgetsLabel:v.selectForTabLabel,{dashboard:"<b>"+w.dashboard+"</b>",tab:"<b>"+w.tab+"</b>"})},{tag:"div",class:"notification-handlers-inputs",html:A===C||A===I?[o,r]:[o]}]}),!_||A!==C&&A!==I||i.html.unshift({tag:"p",class:"notification-warning",text:_}),g&&i.html.unshift({tag:"div",class:"notification-user section",html:[{tag:"div",class:"line",html:[{tag:"div",class:"notification-user-icon"},{tag:"span",class:"notification-user-label"}]},{tag:"div",class:["line",D?"":"hide"].join(" "),html:[{tag:"span",class:"notification-user-message",text:D}]}]},{tag:"hr"}),i=new n("form",i),P.elements={body:i,userIcon:i.getElement(".notification-user-icon"),userLabel:i.getElement(".notification-user-label"),sharedThumbnail:i.getElement(".shared-thumbnail"),shareLabel:i.getElement(".notification-share-label"),warning:i.getElement(".alert-warning"),dashboardInput:o,tabInput:r,renameInput:d},P.superModal=new c({className:"subscribe-modal",renderTo:document.body,closable:!0,events:{onShow:P._onModalShow,onHide:P._onModalHide}})},_onModalShow:function(){var e=P.options,t=e.sender,n=P.elements.dashboardInput;A!==C&&A!==I||(e.appId?P._getWidgetIconFromAppId(e.appId):P._getWidgetAppIdFromWidgetId(e.widgetId).then(P._getWidgetIconFromAppId)).then(P._setWidgetIcon).catch(P._setDefaultWidgetIcon),t&&P._getUserInfo(t).then(P._setUserInfo).catch(P._setUserInfoError),n.dispatchOnChange(),setTimeout(function(){n&&n.setFocus()},300),f.track({category:"subscribe.modal."+A,action:"open"})},_onModalHide:function(){P.isDisplayed=!1;var e=[g.parts.notification];"confirm"===P._action&&(e=e.concat([g.parts.app])),g.routeTo({keepAll:!0,discards:e}),f.track({category:"subscribe.modal."+A,action:"close"})},_buildCallback:function(t,n,a){return t?function(){var t,a,i,o,r=P.elements;P._action="confirm",e.is(n,"function")&&(t=(o=r.renameInput).getValue(),a=(a=r.dashboardInput.getValue()).length>0?a[0]:void 0,i=(i=r.tabInput.getValue()).length>0?i[0]:void 0,t!==o.elements.input.getData("title")&&f.track({category:"subscribe.modal."+A,action:"renamed"}),n(t,a,i)),f.track({category:"subscribe.modal."+A,action:"subscribeBtn"}),P.hide(!0)}:function(){P._action="cancel",e.is(a,"function")&&a.call(),f.track({category:"subscribe.modal."+A,action:"cancelBtn"}),P.hide(!0)}},_getWidgetAppIdFromWidgetId:function(e){return new i(function(t,n){if(!e)return n();r.getWidgetById({id:e,success:function(e){t((e||{}).appId||"")},failure:n,serviceName:m._getServiceName()})})},_getWidgetIconFromAppId:function(e){return new i(function(t,n){if(!e)return t("");p.getAppInfo({appId:e,onComplete:function(e){t((e||{}).icon||"")},onFailure:n})})},_setDefaultWidgetIcon:function(){P._setWidgetIcon(l.getWebappsAssetUrl("W3DDComponents","DragView_DefaultDragIcon.png"))},_setWidgetIcon:function(e){var t=P.elements.sharedThumbnail.getElement(".thumbnail-img");t.addEventListener("error",P._setDefaultWidgetIcon),e?t.setAttribute("src",e):P._setDefaultWidgetIcon()},_getUserInfo:function(e){var t=m._getSwymPlatform()||{},n=t.url;return n?new i(function(a,i){o.request(n+"/api/user/find/login/"+e,{type:"json",proxy:"passport",onComplete:function(e){if(!(e=(e||{}).result))return i();a({user:e,platform:t})},onFailure:i})}):i.reject()},_setUserInfo:function(e){var t,n=e.user,a=e.platform,i=P.elements;t=n.first_name?n.first_name+" "+n.last_name:n.last_name,i.userLabel.setContent(s.replace(T[A].userLabel,{someone:t})),i.userIcon.setStyles({"background-image":"url("+a.url+"/api/media/streammediasprite/idList/"+n.login+":6:6:34:34:0)"})},_setUserInfoError:function(){P.elements.userLabel.setContent(v.userError)},_onTabChanged:function(){var e=this.getValue();e&&e.length>0&&(e=e[0],m._setActiveTab(e),e!==_?f.track({category:"subscribe.modal."+A,action:"changeTab"}):f.track({category:"subscribe.modal."+A,action:"createTab"}))},_onDashboardChanged:function(){var e=P.elements,t=e.dashboardInput.getValue(),n=e.tabInput;t&&t.length>0&&(t=t[0],m._isActiveContext(t)&&m._getActiveContextWidget()?m._getActiveTab()?(P._populateTabs(),P._onNameChanged()):d.addOnce(m.events.tab.change,function(){P._populateTabs(),P._onNameChanged()}):t!==_?(d.addOnce(m.events.tab.change,function(){P._populateTabs(),P._onNameChanged()}),m._setActiveContext(t),g.routeTo({dashboard:t}),f.track({category:"subscribe.modal."+A,action:"changeDashboard"})):(n.remove(),n.setDisabled(!0),P._onNameChanged(!1),f.track({category:"subscribe.modal."+A,action:"createDashboard"})))},_onNameChanged:function(t){var n=P.elements.renameInput.getValue(),a=!1,i=!e.is(n)||""===n;(t=!e.is(t)||t)&&!i&&A===S&&(a=m._getAllTabContexts().some(function(e){return e.getName().toLowerCase()===n.toLowerCase()})),!t||i||A!==y&&A!==E||(a=m._getAllContexts().some(function(e){return e.name.toLowerCase()===n.toLowerCase()})),P.elements.warning&&P.elements.warning[!i&&a?"show":"hide"](),P.superModal.modals.current.elements.footer.getElement("button").disabled=a||i&&"widget"!==A},_populateTabs:function(){var e,n=P.elements.tabInput;(e=m._getAllTabContexts().sort(function(e,t){return b.localeCompare(e.getName(),t.getName())}).map(function(e){return{label:e.getName(),value:e.getId(),selected:e.isSelected(),group:t.ucfirst(w.tabs)}})).push({label:v.createNewTab,value:_,group:t.ucfirst(w.actions)}),n.setDisabled(!1),n.remove(),n.add(e)},_populateDashboards:function(){var e=m._getAllContexts("name","asc").filter(function(e){return e.owner}).map(function(e){return{label:e.name,value:e.modelId,selected:e.active,group:t.ucfirst(w.dashboards)}});return e.push({label:v.createNewDashboard,value:_,group:t.ucfirst(w.actions)}),e}}}),define("DS/Dashboard/Notification/Subscribe",["UWA/Core","UWA/Promise","UWA/String","DS/PubSub/PubSub","DS/UWPClientCode/I18n","DS/UWPClientControls/PlatformNotify","DS/UWPClientCode/Data/Widgets","DS/Dashboard/PublicAPI","DS/Dashboard/Modals/Subscribe","DS/Dashboard/Navigation","DS/Dashboard/Utils","DS/Dashboard/CompassManager","DS/Dashboard/UsageTracker","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m){"use strict";var g="dashboard",f={widget:{subscribeError:m.subscribeErrorWidget,subscribeSuccess:m.subscribeSuccessWidget},multiWidget:{subscribeError:m.subscribeErrorMultiWidget,subscribeSuccess:m.subscribeSuccessMultiWidget},tab:{subscribeError:m.subscribeErrorTab,subscribeSuccess:m.subscribeSuccessTab},dashboard:{subscribeError:m.subscribeErrorDashboard,subscribeSuccess:m.subscribeSuccessDashboard},cockpit:{subscribeError:m.subscribeErrorCockpit,subscribeSuccess:m.subscribeSuccessCockpit}},p={subscribe:function(a){var i,r,s,d=e.clone(a.notification),l=a.type,c=n.ucfirst(l);return d.shared=JSON.parse(d.data||"{}"),d.type=l,d.ucfType=c,r=p._getTitle(d.shared),"widget"===l?s=p._filterAccessibleWidgetsFromWidget:"multiWidget"===l?s=p._filterAccessibleWidgetsFromMultiWidget:"tab"===l?s=p._filterAccessibleWidgetsFromTab:l===g?s=p._filterAccessibleWidgetsFromDashboard:"cockpit"===l&&(s=p._filterAccessibleWidgetsFromCockpit),s(d.shared).then(function(e){return d.shared=e[l],i=e.warningMsg,d.shared?p._showSubscribeModal(d):(o.error(i),t.resolve({canceled:!0}))}).then(function(e){if(e.canceled)return t.resolve(!1);var n,a=e.newTitle||r;return"widget"===l?n=p._subscribeWidget:"multiWidget"===l?n=p._subscribeMultiWidget:"tab"===l?n=p._subscribeTab:l===g?n=p._subscribeDashboard:"cockpit"===l&&(n=p._subscribeCockpit),n({subscribeModalInfos:e,notification:d}).then(function(){return r=a,!0})}).then(function(e){return e&&p._onSubscribeSuccess(l,r,i),e}).catch(function(e){throw p._onSubscribeFailure(l,r,e),new Error("Subscribe failure: "+l+" - "+r)})},_subscribeDashboard:function(e){var n=e.notification.shared;return s.createEmptyContext({name:e.subscribeModalInfos.newTitle,description:(n.context||{}).description||""}).then(function(e){return new t(function(t,a){r.createWidgetInstance({serviceName:s._getServiceName(),widgetIdOrUrl:s.CONTEXT_WIDGET_ID,parentId:s.CONTEXT_WIDGET_INSTANCE_ID,name:e.name,title:e.name,data:JSON.parse(n.data),children:n.children,context:{type:g,modelId:e.modelId},success:function(n){e=s._initNewContext({context:e,widgetInstance:n}),t({context:e,widget:n})},failure:a})})}).then(function(e){l.routeTo({dashboard:e.context.modelId})})},_subscribeCockpit:function(e){var n=e.notification.shared;return s.createEmptyContext({type:s.COCKPIT_TYPE,name:e.subscribeModalInfos.newTitle,description:(n.context||{}).description||""}).then(function(e){return new t(function(t,a){r.createWidgetInstance({serviceName:s._getServiceName(),widgetIdOrUrl:s.CONTEXT_WIDGET_ID,parentId:s.CONTEXT_WIDGET_INSTANCE_ID,name:e.name,title:e.name,data:JSON.parse(n.data),children:n.children,context:{type:s.COCKPIT_TYPE,modelId:e.modelId},success:function(n){e=s._initNewContext({context:e,widgetInstance:n}),t({context:e,widget:n})},failure:a})})}).then(function(e){l.routeTo({dashboard:e.context.modelId})})},_subscribeTab:function(e){return new t(function(n,i){var o,d=e.subscribeModalInfos.dashboardModelId,c=e.notification.shared;function u(e){return s.getContextWidgetId({modelId:e.dashboardId}).then(function(n){return new t(function(t,i){var o=e.title;r.createWidgetInstance({serviceName:s._getServiceName(),widgetIdOrUrl:s.TAB_WIDGET_ID,name:o,title:o,data:e.data,parentId:n,children:e.children,coordinates:null,success:function(e){a.dispatch(s.events.tab.subscribe,[e,n]),t()},failure:i})})})}function h(){n()}function m(e){i(e)}o={dashboardId:d,title:e.subscribeModalInfos.newTitle,data:c.data,children:c.children},"_new_"===d?s.addDashboard({withoutTab:!0}).then(function(e){var t=e.modelId;a.addOnce(s.events.dashboard.change,function(){o.dashboardId=t,u(o).then(h).catch(m)}),l.routeTo({dashboard:t})}).catch(m):u(o).then(h).catch(m)})},_subscribeWidget:function(e){return new t(function(t,n){var i,o=e.notification,r=o.shared,d=o.type,c=o.ucfType,u=e.subscribeModalInfos.tabId,h=e.subscribeModalInfos.dashboardModelId,m=e.subscribeModalInfos.newTitle;function g(){t()}function f(e){n(e)}if("widget"===d?i={tabId:u,appId:r.appId,url:r.widgetId,data:r.data,title:m}:"multiWidget"===d&&(i={tabId:u,widgets:r.modulesData}),"_new_"!==h&&"_new_"!==u)return p["_add"+c](i).then(g).catch(f);a.addOnce(s.events.tab.change,function(e){i.tabId=e,p["_add"+c](i).then(g).catch(f)}),"_new_"===h?s.addDashboard().then(function(e){l.routeTo({dashboard:e.modelId})}).catch(f):a.dispatch(s.events.tab.add)})},_subscribeMultiWidget:function(e){return p._subscribeWidget(e)},_showSubscribeModal:function(e){return new t(function(t){var n=e.shared,i=p._getTitle(n),o=l.getUrlParameter(l.parts.fullscreen);a.dispatch(s.events.widget._exitFullscreen),d.show({widgetId:n.widgetId,appId:n.appId,type:e.type,title:i,fullTitle:n.contentData&&n.contentData.fullTitle||"",sender:e.from,message:e.message,warning:e.warning,confirm:function(e,n,o){a.dispatch(s.events.widget._exitMaximized),t({newTitle:e||i,dashboardModelId:n,tabId:o})},cancel:function(){if(t({canceled:!0}),o){var e,n=s._getActiveTab(),a=s._getTabByModuleId(o);n&&a&&n.id===a.widget.id&&(e=n.environment.wp.children.find(function(e){return e.id===o}),setTimeout(function(){e&&e.widget&&e.widget.environment.toggleFullscreen()}))}}})})},_filterAccessibleWidgetsFromDashboard:function(n){var a=[],o=[],r="";return(n.children||[]).forEach(function(t,n){a[n]=e.clone(t),a[n].children=[],o=(t.children||[]).map(function(e){return p._isUserHasAccessToWidget(e).then(function(t){t?a[n].children.push(e):(r+=i.replace(f.widget.subscribeError,{title:e.name?'"'+e.name+'"':""}),r+=" "+m.subscribeForbiddenWidget+" ")})})}),t.all(o).then(function(){return n.children=a,{warningMsg:r,dashboard:n}})},_filterAccessibleWidgetsFromCockpit:function(e){return p._filterAccessibleWidgetsFromDashboard(e).then(function(e){return{warningMsg:e.warningMsg,cockpit:e.dashboard}})},_filterAccessibleWidgetsFromTab:function(e){var t={children:[e]};return p._filterAccessibleWidgetsFromDashboard(t).then(function(t){return e.children=t.dashboard.children[0].children,{warningMsg:t.warningMsg,tab:e}})},_filterAccessibleWidgetsFromWidget:function(e){var t={children:[{children:[e]}]};return p._filterAccessibleWidgetsFromDashboard(t).then(function(t){return e=t.dashboard.children[0].children[0],{warningMsg:t.warningMsg,widget:e}})},_filterAccessibleWidgetsFromMultiWidget:function(e){return t.resolve({warningMsg:"",multiWidget:e})},_isUserHasAccessToWidget:function(e){return new t(function(t){var n=(e||{}).appId;if(!n)return t(!0);u.getAppInfo({appId:n,onComplete:function(){t(!0)},onFailure:function(){t(!1)}})})},_addWidget:function(e){return new t(function(t,n){var a,i;i=e.appId,a=e.data;try{a="string"==typeof a?JSON.parse(a):a}catch(t){a=e.data}s.addModule({tabId:e.tabId,appId:i,url:e.url,data:a,title:e.title,coordinates:e.coordinates,success:t,failure:n}),h.track({category:"subscribe.consume.widget",action:"appId-dashboardManager",appId:i})})},_addMultiWidget:function(e){var n;return n=((e=e||{}).widgets||[]).map(function(n){var a,i;try{(i=JSON.parse(n.data)).data&&delete i.data.x3dLinkability,a=p._addWidget({tabId:e.tabId,appId:i.appId,url:n.widgetId,data:i.data,coordinates:i.coordinates,title:i.contentData.title})}catch(e){a=t.resolve()}return a}),t.all(n)},_onSubscribeFailure:function(e,t,n){var a=Array.isArray(n)?n[1]:null;try{a=JSON.parse(a)}catch(e){}o.error(c.getViolationMessageFromError(a)||i.replace(f[e].subscribeError,{title:t?'"'+t+'"':""})),h.track({category:"subscribe.consume."+e,action:"failure"})},_onSubscribeSuccess:function(e,t,n){n&&o.warn(n),o.success(i.replace(f[e].subscribeSuccess,{title:t})),h.track({category:"subscribe.consume."+e,action:"success"})},_getTitle:function(t){var n;return t.contentData&&e.is(t.contentData.link)?(n=JSON.parse(t.data),t.name+(n.title?" - "+n.title:"")):t.contentData.title},_NEW_:"_new_",WIDGET_TYPE:"widget",MULTI_WIDGET_TYPE:"multiWidget",TAB_TYPE:"tab",DASHBOARD_TYPE:g,COCKPIT_TYPE:"cockpit"};return p}),define("DS/Dashboard/Notification/Handlers/ShareCockpit",["DS/Dashboard/Notification/Subscribe"],function(e){"use strict";return function(t){e.subscribe({notification:t,type:e.COCKPIT_TYPE})}}),define("DS/Dashboard/Notification/Handlers/ShareArticle",["DS/Dashboard/Notification/Subscribe"],function(e){"use strict";return function(t){e.subscribe({notification:t,type:e.WIDGET_TYPE})}}),define("DS/Dashboard/Notification/Handlers/ShareDashboard",["DS/Dashboard/Notification/Subscribe"],function(e){"use strict";return function(t){e.subscribe({notification:t,type:e.DASHBOARD_TYPE})}}),define("DS/Dashboard/Notification/Handlers/ShareWidget",["DS/Dashboard/Notification/Subscribe"],function(e){"use strict";return function(t){e.subscribe({notification:t,type:e.WIDGET_TYPE})}}),define("DS/Dashboard/Collections/DashboardsFavourite",["UWA/String","UWA/Date","DS/Dashboard/PublicAPI","DS/Dashboard/Models/Dashboard","DS/Dashboard/Collections/DashboardsAbstract","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o){"use strict";return i.extend({model:a,currentUser:!1,tags:{},setup:function(e,t){(t=t||{}).currentUser&&(this.currentUser=!0),t.actions&&(this.actions=t.actions)},fetch:function(e){if(e=e||{},this.currentUser){var t=e.onComplete,a=e.reset?"reset":"set",i=n._getFavoriteContexts();e.parse=!0,this[a](i,e),t&&t(this,i,e)}},parse:function(a){var i=this;return(a=a||[]).forEach(function(a){var r,s=[],d=(a.role||(a.owner?"OWNER":"READER")).toLowerCase(),l=n._isAnyDefaultContext(a);a.actions=i.actions,a.contextId=a.id,r=(r=new Date(a.creationDate)).valueOf()?t.strftime(r,"%Y/%m/%d"):"",s.push({object:d,sixw:"ds6w:who/ds6w:role",dispValue:e.capitalize(o[d])},{object:l?"default":"restricted",sixw:"ds6w:what/ds6w:kind",dispValue:e.capitalize(l?o.defaultDashboard:o.dashboard)},{object:l?"public":"private",sixw:"ds6w:how/ds6w:visibility",dispValue:e.capitalize(l?o.public:o.private+" ("+o.secret+")")},{object:r,sixw:"ds6w:when/ds6w:created",dispValue:r,type:"date"}),i.tags[a.modelId]=s}),a}})}),define("DS/Dashboard/ManageDashboard/Controller/ManageDashboard",["UWA/Core","DS/PubSub/PubSub","DS/Dashboard/PublicAPI","DS/Dashboard/Collections/Members","DS/Dashboard/Collections/DashboardsTrash","DS/Dashboard/Collections/DashboardsFavourite","DS/Dashboard/Collections/Dashboards","DS/Dashboard/Collections/BusinessExperienceLayouts","DS/Dashboard/Models/Member","DS/Dashboard/Models/Dashboard","DS/Dashboard/Utils","DS/Dashboard/UsageTracker","DS/Dashboard/UserPlatformAccess","DS/Dashboard/Navigation","DS/Dashboard/ManageDashboard/Events","DS/Dashboard/ManageDashboard/Views/DashboardDetailView","DS/WebappsUtils/WebappsUtils","DS/WebappsUtils/Utils","DS/UWPClientCode/I18n","DS/UIKIT/Tooltip","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/manage_modal","i18n!DS/Dashboard/assets/nls/vocabulary","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w,D,_,C,I){"use strict";var S,y,E,T,A,P,x,M,k,N,W,L="hidden",U="selected",O=!0;var F={selectedCategory:void 0,_selectedDashboards:[],selectedDashboardModel:null,manageDashboardModal:null,_modal:null,_options:null,_bones:null,_platform:null,_platforms:null,_selectCategory:null,filters:{search:"",accessRights:"",type:""},sort:{direction:"",field:""},tableViewSort:{direction:"",field:""},_selectedView:null,_detailView:null,elements:null,dbDraggedFrom:null,membersCollectionBeforeFilter:null,isMultiSelectActive:null,memberMapping:null,dashboardMapping:null,idCardDashboardMapping:null,members:null,lastDetailViewOpened:{all:{dashboardId:null},myFavorites:{dashboardId:null},recycleBinDashboards:{dashboardId:null}},_loadSecondaryDeps:function(){return new Promise(function(e,t){require(["DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/Dashboard/ManageDashboard/Views/TileMain","DS/Dashboard/ManageDashboard/Views/MainView","DS/Dashboard/ManageDashboard/Actions/MembersActions","DS/Dashboard/ManageDashboard/Actions/DashboardActions","DS/Dashboard/ManageDashboard/Views/ActionBar","DS/Dashboard/ManageDashboard/Views/DashboardTableView","DS/Dashboard/ManageDashboard/Views/ManageBody"],function(t,n,a,i,o,r,s,d){k=t,N=n,W=a,A=i,P=o,x=r,M=s,T=d,e()},t)})},init:function(e){return e=e||{},F.initDefault(),F._modal=e.modal,F.manageDashboardModal=F._modal,F._options=e.options,F._selectCategory=F._options.selectCategory,F._initEvents(),F._loadSecondaryDeps().then(function(){return h.isInvitationOnShareByEmailConfigEnabled().then(function(e){O=e}),n.getPlatforms().then(function(e){F._platforms=e;var t=n._getSwymPlatform()||{};F._platform=t.url&&t}).then(F._initManageViews.bind(F,{categoryToSelect:F._selectCategory,dashboardId:F._options.dashboardId,searchFilter:e.searchFilter})).then(F._initManageBody)})},initDefault:function(){F.filters={},F.sort={},F.tableViewSort={},F._selectedView=null,F._selectCategory=null,F._bones=null,F._options=null,F._platform=null,F._platforms=null,F._detailView=null},_initManageBody:function(){var e=F._options.dashboardId,t=F._modal.elements.body,a=new T({manageBody:t}).render();if(new W({selectedCategory:S}).render().inject(a.elements.topPanelContiner,"top"),(E=new x).render().inject(a.elements.actionBarContainer),F._bones.render().inject(a.elements.tileViewSkeletonContainer),F._updateElements(),e){a.elements.tileViewSkeletonContainer.addClassName(L),a.elements.dashboardDetailViewContainer.removeClassName(L),a.elements.actionBarContainer.addClassName(L);var i=n._getContext(e),o=y.get(i.id),r=F._options.facet;F.createDashboardDetailView({model:o,selectFacet:r,selectedCategory:S})}return Promise.resolve()},_initManageViews:function(t){var a=(t=t||{}).categoryToSelect,f=t.dashboardId,w=t.searchFilter;function E(e){e=e||[],y=F._selectCategory&&!m.isBELayoutEditorMode()?F._selectCategory.toLowerCase()===W.MY_FAVORITES_PANEL.toLowerCase()?new o(e,{currentUser:!0,actions:P.dashboardActions}):F._selectCategory.toLowerCase()===W.RECYCLE_BIN_PANEL.toLowerCase()?new i(e,{actions:P.dashboardActions}):new r(e,{currentUser:!0,actions:P.dashboardActions}):m.isBELayoutEditorMode()?new s(e,{currentUser:!0,actions:P.dashboardActions}):new r(e,{currentUser:!0,actions:P.dashboardActions})}F._selectCategory=S=a||W.ALL_DASHBOARD_PANEL,F.selectedCategory=F._selectCategory,w&&(F.filters.search=w.search,F.filters.accessRights=w.accessRights,F.filters.type=w.type,w.ordering&&w.ordering.field&&(F.sort.field=w.ordering.field,F.sort.direction=w.ordering.direction));var T=n._getApplicationConfigurationBoolean("app.usergroup.enable");return F.memberMapping=c.sanitizeMapping(d,{title:function(){return this.model.getName()},subtitle:function(){return F.getRoleNLS(this.model)},content:function(){var e=this.model.isGroup(),t=e&&this.model.getGroupMembers();return e?v.replace(C.nbMembers,{nb:t}):""},image:function(){return this.model.isGroup()?(this.container.classList.add("user-group"),p.getWebappsAssetUrl("Dashboard","images/users-group.png")):F._platform.url+"/api/media/streammediasprite/idList/"+this.model.getLogin()+":7:6:60:60:0"},lastNameGroupName:function(){var e=this.model,t=e.isGroup(),n=t&&e.getGroupMembers();return t?v.replace(C.groupNameWithNbMembers,{groupName:e.getGroupName(),nb:n}):e.getLastName()}}),F.dashboardMapping=c.sanitizeMapping(l,{title:"title",subtitle:function(){var t,n=e.createElement("span",{class:"dashboard-user-access",text:F.getRoleNLS(this.model)}),a=F.getIconAsPerRole(this.model);return a&&(t=e.createElement("div",{class:"fonticon "+a+" role-icon"})),n.outerHTML+(a?t.outerHTML:"")},content:function(){var e=this.model.get("deletionDate"),t=this.model.get("lastUpdate"),n=v.replace(D.deletedOn,{classes:"deletion-date",date:c.formatDate(e)}),a=v.replace(I.dbModifiedOn,{classes:"creation-date",date:c.formatDate(t)});return S&&S.toLowerCase()===W.RECYCLE_BIN_PANEL.toLowerCase()?a+"</br>"+n:a}}),F.idCardDashboardMapping=c.sanitizeMapping(l,{title:"title",ownerName:function(){var e=this.get("modelId");return n._isEndUserCockpitContext(e)?C.cockpit:C.dashboard},date:function(){var e;return(e=this.get("roles").map(function(e){return h.getRoleName(e)}).filter(function(e){return e})).length>0?v.replace(D.assignedToRoles,{list:e.join(", ")}):""},description:function(){var t=this.getDescription(),a=e.createElement("span",{class:"dashboard-description",text:t,title:t});return e.createElement("span",{class:"dashboard-user-access",text:n._isEndUserCockpitContext(this.get("modelId"))?v.replace(D.yourCockpitAccessDescription,{access:F.getRoleNLS(this)}):v.replace(D.yourAccessDescription,{access:F.getRoleNLS(this)})}).outerHTML+"</br>"+a.outerHTML}}),F.members={collection:{actions:A.memberActions},autoFetch:!1,className:"members-facet",contents:{useInfiniteScroll:!0,usePullToRefresh:!0,itemViewOptions:{mapping:F.memberMapping,events:{onActionClick:A.memberActionsHandler}},filterViewOptions:{search:{tooltips:{search:D.searchMembers,clear:D.clearSearchMembers},placeholder:D.searchMembers,onChange:function(){return b.debounce(function(){var e=this.elements.searchInput.getValue(),t=this.collection.activeFilters;e!==t.name&&(t.name=e,t.name&&!F.membersCollectionBeforeFilter&&(F.membersCollectionBeforeFilter=this.collection.clone()),t.name||t.roles||t.userType||!F.membersCollectionBeforeFilter||(F.membersCollectionBeforeFilter=null),this.collection.fetch({reset:!0}))},300)}()},filter:{tooltip:D.filterAccessRights,items:[{text:_.userRights,className:"header"},{name:"reader",text:D.readerAccess,fonticon:"lock"},{name:"contributor",text:D.contributorAccess,fonticon:"pencil"},{name:"owner",text:D.ownerAccess,fonticon:"lock-open"},{className:"divider"},{text:_.type,className:"header"},{name:"user",text:_.user,className:"type",fonticon:"user"},{name:"group",text:_.uesrGroup,className:"type",fonticon:"users-group"}],onChange:function(){var e=this.collection.activeFilters,t=this.elements.filterInput.getSelectedItems(),n=t.length;if(n){var a=t[0];n&&"type"!==(a.className||"").toLowerCase()?(e.userType=void 0,e.roles=t.map(function(e){return e.name.toUpperCase()})):(e.roles=void 0,e.userType=n&&a.name.toUpperCase())}else e.roles=void 0,e.userType=void 0;(e.roles||e.userType)&&(e.roles&&e.roles.length||e.userType)&&!F.membersCollectionBeforeFilter&&(F.membersCollectionBeforeFilter=this.collection.clone()),e.roles&&e.userType||e.name||!F.membersCollectionBeforeFilter||(F.membersCollectionBeforeFilter=null),this.collection.fetch({reset:!0})}}},headers:[{property:"firstName",label:D.firstNameHeader},{property:T?"lastNameGroupName":"lastName",label:T?D.lastNameGroupNameHeader:D.lastNameHeader},{property:"subtitle",label:D.accessHeader},{actions:!0,label:D.actionsHeader}],events:{onPullToRefresh:function(e){var t=this.nestedView.collection;this.listenToOnce(t,"onReset",function(){e.endLoading()}),t.fetch({reset:!0}),u.track({category:"manageDashboard.member",action:"pullToRefresh"})},onInfiniteScroll:function(e){var t=this.nestedView.collection;this.listenToOnce(t,"onAdd",function(){e.endLoading()}),t.hasEvent("onEnd")||t.addEventOnce("onEnd",e.useInfiniteScroll.bind(e,!1)),t.fetch(),u.track({category:"manageDashboard.member",action:"infiniteScroll"})}}},actions:{collection:A.membersFacetActions},events:{onActionClick:A.membersFacetActionsHandler},slidepanel:{view:k,viewOptions:{getSuggestions:function(e,t,a){e&&(n.searchUsers({query:e,success:a,platformId:n._getGlobalPlatformId(),failure:function(){a([]),u.track({category:"manageDashboard.member",action:"searchUserFailed"})}}),u.track({category:"manageDashboard.member",action:"searchUserNew"}))},categories:[{id:d.READER_ROLE,name:D.readerAccess,isDefault:"true"},{id:d.CONTRIBUTOR_ROLE,name:D.contributorAccess},{id:d.OWNER_ROLE,name:D.ownerAccess}],suggestDistinction:function(t){var n=(F.membersCollectionBeforeFilter?F.membersCollectionBeforeFilter:this.collection).findWhere({id:t.id});if(!e.is(n))return!1;switch(n.getRole()){case d.OWNER_ROLE:return D.ownerAccess;case d.CONTRIBUTOR_ROLE:return D.contributorAccess;case d.READER_ROLE:return D.readerAccess}},suggestFormat:"{name}",suggestKey:"id",labelFormat:"{name}",onEmailAddress:function(e){if(O)return{id:e,name:e,email:e,login:"",url:"",type:d.USER_TYPE}},placeholder:D.memberAutocompletePlaceholder,typeDelay:1e3,minLength:3,saveProcess:A.addMembers}},swipe:!1},E(),new Promise(function(e){y.fetch({onComplete:function(){F.sort.direction&&F.sort.field&&(y=y.sortDashboards(F.sort)),(F.filters.search||F.filters.accessRights||F.filters.type)&&E(y=y.filterDashboards(F.filters));var t={dashboardsCollection:y,dashboardActions:P.dashboardActions,dashboardActionsHandler:P.dashboardActionsHandler,dashboardMapping:F.dashboardMapping,facets:A.idCardDashboardFacets,actions:P.idCardDashboardActions,attributesMapping:F.idCardDashboardMapping,members:F.members,tenants:F._platforms,filters:F.filters,sort:F.sort,selectedPanel:S,dashboardId:f,tableViewSort:F.tableViewSort};F._selectedView&&F._selectedView!==g.TILE_VIEW?(delete t.dashboardMapping,F._bones=new M(t)):F._bones=new N(t),e()}})})},createManageDashboardView:function(e){var t=(e=e||{}).categoryToSelect,a=e.from,i=e.dashboardId||a?this.getLastOpenDashboardIdforSelectedCategory(t):void 0,o=e.searchFilter;F._selectedDashboards=[],F._bones.destroy(),F._options.dashboardId=i,F._initManageViews({categoryToSelect:t,dashboardId:i,searchFilter:o}).then(function(){var e=F._modal.elements.body,a=e.getElement(".tile-view-skeleton-container"),o=e.getElement(".dashboard-details-container"),r=e.getElement(".action-bar-container");if(a.setContent(null),o.setContent(null),F._bones.render().inject(a),i){a.addClassName(L),o.removeClassName(L),r.addClassName(L);var s=n._getContext(i),d=y.get(s.id),l=F._options.facet;F.createDashboardDetailView({model:d,selectFacet:l,selectedCategory:t})}else a.hasClassName(L)&&(a.removeClassName(L),r.removeClassName(L));return F.tableViewSort.direction&&F.tableViewSort.field&&E.updateSortIcon(F.tableViewSort),F.toggleActionBarIcon(),Promise.resolve()})},_updateElements:function(){var e=F._modal.elements.container;F.elements={mainContainer:e,tileViewContainer:e.getElement(".tile-view-skeleton-container"),detailViewContainer:e.getElement(".dashboard-details-container"),actionBarContainer:e.getElement(".action-bar-container"),searchViewContainer:e.getElement(".search-view-container"),filterContainer:e.getElement(".filter-db")}},getLastOpenDashboardIdforSelectedCategory:function(e){return F.lastDetailViewOpened[e].dashboardId},_initMainView:function(e,t){return t=t||{},new Promise(function(n,a){F.init({options:t,modal:e}).then(n).catch(a)})},getIconAsPerRole:function(e){var t="",a=e.get("modelId");return n._isSharedContext(a)&&e.isOwner()?t="fonticon-users":n._isOwnCustomRoleContext(a)?t="fonticon-lock-open-user":n._isContributorContext(a)?t="fonticon-pencil":e.isOwner()||(t="fonticon-lock"),t},getUserRightAccessNLS:function(e){var t="",a=e.get("modelId");return n._isSharedContext(a)&&e.isOwner()?t=_.shared:n._isOwnCustomRoleContext(a)?t=_.customRole:n._isContributorContext(a)?t=_.contributors:e.isOwner()||(t=_.reader),t},getRoleNLS:function(e){return e.getRole&&D[e.getRole()+"Access"]||""},createDashboardDetailView:function(t){var n=(t=t||{}).model,i=t.selectFacet,o=F.elements.detailViewContainer;F.membersCollectionBeforeFilter=null,F.setSelectedDashboard(n),this.members.model=n;var r=new a([],{dashboard:n,actions:this.members.collection.actions});this.members.collection=r,this.elements.dashboardDetailView=new f({model:n,facets:A.idCardDashboardFacets,actions:P.idCardDashboardActions,attributesMapping:F.idCardDashboardMapping,selectedFacet:i?1:0}).render().inject(o,"top");var s=e.createElement("div",{class:"controller-back",html:[{tag:"span",class:"controller fonticon fonticon-chevron-left",events:{click:function(){F.toggleControlState(g.COLLAPSED_ICON),F.setLastDetailViewOpened({selectedCategory:F.selectedCategory,dashboardId:n.get("modelId"),set:!1})}}}]});s.inject(o,"top"),new w({target:s,position:"right",className:"controller-back-tooltip",body:D.backToolTip}),F.setLastDetailViewOpened({selectedCategory:F.selectedCategory,dashboardId:n.get("modelId"),set:!0}),F.toggleControlState(g.DETAIL_VIEW)},toggleControlState:function(e){var t=F.elements.tileViewContainer,n=F.elements.detailViewContainer,a=F.elements.actionBarContainer;e!==g.TOP_PANEL&&e!==g.COLLAPSED_ICON||(t.removeClassName(L),a.removeClassName(L),n.addClassName(L),n.setContent(null),F._detailView=null),e===g.DETAIL_VIEW&&(t.addClassName(L),a.addClassName(L),n.removeClassName(L),F._detailView=!0)},toggleSelectedState:function(e){var t=F.elements.actionBarContainer;F._selectedView===g.TABLE_VIEW?F.toggleDashboadRowSelection(e,t):F.toggleDashboadTileSelection(e,t),F.toggleActionBarIcon()},toggleDashboadTileSelection:function(e,t){var n=e.hasClassName(U),a=F._selectedDashboards.includes(e.model.get("modelId"));e[(n?"remove":"add")+"ClassName"](U),e.getElement(".tile-check")[(n?"remove":"add")+"ClassName"]("show"),e.getElement(".tile-check input").checked=!n,a?F._selectedDashboards.splice(F._selectedDashboards.indexOf(e.model.get("modelId")),1):(F._selectedDashboards.push(e.model.get("modelId")),t.getElement(".select-on").addClassName(U)),F.toggleActionBarIcon()},toggleDashboadRowSelection:function(e,t){var n=e.hasClassName(U),a=F._selectedDashboards.includes(e.dataset.modelid);e[(n?"remove":"add")+"ClassName"](U),e.getElement(".toggle input").checked=!n,a?F._selectedDashboards.splice(F._selectedDashboards.indexOf(e.dataset.modelid),1):(F._selectedDashboards.push(e.dataset.modelid),t.getElement(".select-on").addClassName(U)),F.toggleActionBarIcon()},selectDashboardTile:function(){var e=F.elements.tileViewContainer;F._selectedView===g.TABLE_VIEW?F.selectUnselectRow(e,!0):F.selectUnSelectTile(e,!0),F.toggleActionBarIcon()},unSelectDashboardTile:function(){var e=F.elements.tileViewContainer;F._selectedView===g.TABLE_VIEW?F.selectUnselectRow(e,!1):F.selectUnSelectTile(e,!1),F.toggleActionBarIcon()},selectUnSelectTile:function(e,t){e.getElements(".dashboard-tile-view").forEach(function(e){var n=e.hasClassName(U);if(t?!n:n){e[(t?"add":"remove")+"ClassName"](U),e.getElement(".tile-check")[(t?"add":"remove")+"ClassName"]("show"),e.getElement(".tile-check input").checked=t;var a=F._selectedDashboards.includes(e.model.get("modelId"));t&&!a&&F._selectedDashboards.push(e.model.get("modelId")),!t&&a&&F._selectedDashboards.splice(F._selectedDashboards.indexOf(e.model.get("modelId")),1)}})},selectUnselectRow:function(e,t){e.getElements(".table-row").forEach(function(e){var n=e.hasClassName(U);if(t?!n:n){e[(t?"add":"remove")+"ClassName"](U),e.getElement(".toggle input").checked=t;var a=F._selectedDashboards.includes(e.dataset.modelid);t&&!a&&F._selectedDashboards.push(e.dataset.modelid),!t&&a&&F._selectedDashboards.splice(F._selectedDashboards.indexOf(e.dataset.modelid),1)}})},clearSearchAndFilterView:function(){var e=F.elements.searchViewContainer,t=F.elements.filterContainer,n=e.getElement(".search-input");t.removeClassName("active"),e.removeClassName("active"),n.value=""},toggleActionBarIcon:function(){var e=F.elements.actionBarContainer;function t(t,n){t.forEach(function(t){e.getElement("."+t)[(n?"add":"remove")+"ClassName"](L)})}F._selectedDashboards.length>0?(F._selectCategory===g.ALL_DASHBOARD_PANEL&&t(["divider-icon","trash-icon","add-fav-icon","remove-fav-icon"],!1),F._selectCategory===g.MY_FAVORITES_PANEL&&t(["divider-icon","trash-icon","remove-fav-icon"],!1),F._selectCategory===g.RECYCLE_BIN_PANEL&&t(["divider-icon","trash-icon","undo-icon"],!1)):(t(["divider-icon","trash-icon","add-fav-icon","remove-fav-icon","undo-icon"],!0),e.getElement(".select-on").removeClassName(U))},setSelectedDashboard:function(e){F.selectedDashboardModel=e},setLastDetailViewOpened:function(e){var t=(e=e||{}).selectedCategory||F.selectedCategory,n=e.dashboardId,a=e.set,i=e.action;if(t===g.ALL_DASHBOARD_PANEL)a?F.lastDetailViewOpened.all.dashboardId=n:F.lastDetailViewOpened.myFavorites.dashboardId===n?(F.lastDetailViewOpened.myFavorites.dashboardId=null,F.lastDetailViewOpened.all.dashboardId=null):F.lastDetailViewOpened.all.dashboardId=null;else if(t===g.MY_FAVORITES_PANEL)if(a)F.lastDetailViewOpened.myFavorites.dashboardId=n;else if(F.lastDetailViewOpened.all.dashboardId===n){if(F.lastDetailViewOpened.myFavorites.dashboardId=null,"removefromfavorite"===i.toLowerCase())return;F.lastDetailViewOpened.all.dashboardId=null}else F.lastDetailViewOpened.myFavorites.dashboardId=null;else F.lastDetailViewOpened.recycleBinDashboards.dashboardId=a?n:null},_initEvents:function(){!function(){function e(e){F.setLastDetailViewOpened({dashboardId:e,set:!1})}t.add(n.events.dashboard.remove,function(t){e(((t||{}).context||{}).modelId)},null,!0),t.add(n.events.dashboard.unshare,function(t){e(((t||{}).context||{}).modelId)},null,!0),t.add(n.events.dashboard.removeFavorites,function(t){((t=t||{}).modelIds||[]).forEach(function(t){e(t)})},null,!0),t.add(n.events.dashboard.trash,function(t){e(((t||{}).context||{}).modelId)},null,!0)}()}};return F}),define("DS/Dashboard/Notification/Handlers/ShareTab",["DS/Dashboard/Notification/Subscribe"],function(e){"use strict";return function(t){e.subscribe({notification:t,type:e.TAB_TYPE})}}),define("DS/Dashboard/ManageDashboard/Views/DashboardRowView",["UWA/Core","UWA/Class/View","UWA/Event","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/Dashboard/PublicAPI","DS/Dashboard/Utils","DS/Dashboard/ManageDashboard/Controller/ManageDashboard","i18n!DS/Dashboard/assets/nls/manage_modal"],function(e,t,n,a,i,o,r,s,d,l){"use strict";var c="td";return t.extend({tagName:"tr",className:"table-row",elements:{},domEvents:{click:"_onClick"},setup:function(e){return e=e||{},this.model=e.model,this.dashboardActions=e.dashboardActions,this.dashboardActionsHandler=e.dashboardActionsHandler,this.facets=e.facets,this.actions=e.actions,this.attributesMapping=e.attributesMapping,this.members=e.members,this.modal=e.modal,this.tenants=e.tenants,this.selectedPanel=e.selectedPanel,this.filters=e.filters,this.sort=e.sort,this.dashboardId=e.dashboardId,this.tableViewSort=e.tableViewSort,this.container.setAttribute("data-modelid",this.model.get("modelId")),this._parent.apply(this,arguments)},render:function(){this.container.setContent(this.createDashboardContent());var e=d.getUserRightAccessNLS(this.model),t=this.container.getElement(".db-type-icon");return this.elements.userRightsToolTip=new o({position:"top",target:this.container.getElement(".db-rights-icon"),body:e}),this.elements.dbTitleToolTip=new o({position:"top",target:this.container.getElement(".db-title"),body:this.model.get("title")}),t&&(this.elements.favToolTip=new o({position:"top",target:t,body:l.favorites})),this},getThumbnailURL:function(){var e,t=this.model;return t.get("thumbnail")&&(e=r._getContextThumbnailUrl(t.get("modelId"))),e},_onClick:function(e){var t=this.model;if(n.stop(e),e.target.classList.contains("control-label")){var a=e.currentTarget;d.toggleSelectedState(a)}else d.createDashboardDetailView.call(this,{model:t,selectedCategory:this.selectedPanel})},createDashboardContent:function(){var e=this.model,t=e.get("title"),n=d.getRoleNLS(e),i=s.formatDate(e.getLastUpdateDate()),o=r._isFavouriteContext(e.get("modelId")),l=d.getIconAsPerRole(e),u=this.getThumbnailURL();return this.toggleSelect=new a({className:"primary inline row-check",type:"checkbox",name:"dbName",label:""}),[{tag:c,html:[this.toggleSelect,{class:"img-wrapper hidden-xs db-icon",html:u?{tag:"img",class:"db-img",src:u}:{tag:"div",class:"fonticon fonticon-chart-map-tree thumbnail-icon"}}]},{tag:c,class:"text-ellipsis db-title",html:t},{tag:c,class:"text-ellipsis hidden-xs user-rights",html:n},{tag:c,class:"text-ellipsis hidden-xs modif-date",html:i},{tag:c,class:"text-ellipsis hidden-xs hidden-sm fav-db",html:o?[{tag:"div",class:"fonticon fonticon-favorite-on db-type-icon"}]:""},{tag:c,class:"text-ellipsis hidden-xs hidden-sm",html:[{class:"img-wrapper rights-icon",html:{tag:"div",class:"fonticon "+l+" db-rights-icon"}}]},{tag:c,html:this._buildAction()}]},_buildAction:function(){var t,a=this,o=a.model;return t=e.createElement("div",{tag:"div",class:"action-container",html:{class:"action-icon-wrapper",html:{tag:"i",class:"fonticon fonticon-down-open"}},events:{click:function(e){n.stop(e)}}}),new i({target:t,items:o.actions().map(function(e){return{id:e.id,text:e.get("title"),icon:"fonticon fonticon-"+e.get("icon"),handler:function(){a.dashboardActionsHandler(null,e.id)}}})}),t}})}),define("DS/Dashboard/ManageDashboard/Views/DashboardTableView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/Dashboard/ManageDashboard/Views/DashboardRowView","DS/Dashboard/ManageDashboard/Events","DS/Dashboard/PublicAPI","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/EmptyView","i18n!DS/Dashboard/assets/nls/manage_modal","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l){"use strict";var c,u="td",h="fonticon-expand-down",m="fonticon-expand-up",g="fonticon-sort-column",f="hidden-xs",p=" hidden-sm";return t.extend({tagName:"div",className:"table-view table-responsive",elements:{},setup:function(e){e=e||{};var t=this.elements;this.collection=e.dashboardsCollection,this.dashboardActions=e.dashboardActions,this.dashboardActionsHandler=e.dashboardActionsHandler,this.facets=e.facets,this.actions=e.actions,this.attributesMapping=e.attributesMapping,this.members=e.members,this.modal=e.modal,this.tenants=e.tenants,this.selectedPanel=e.selectedPanel,this.filters=e.filters,this.sort=e.sort,this.dashboardId=e.dashboardId,this.tableViewSort=e.tableViewSort,this._parent(e),this._loadDeps().then(function(e){c=e}),t.scrollView=new r({useInfiniteScroll:!1,usePullToRefresh:!1,view:this._getScrollView()})},render:function(){this._parent.apply(this,arguments);var e=this.elements.scrollView;return e.render().inject(this.container),this.container.getElement(".dashboard-table-view-wrapper").setContent(this.buildTableView()),e.getElement(".scroller-content").addEvent("scroll",function(e){var t=e.currentTarget.ownerDocument.getElement('.dropdown:not([style*="display: none;"])');t&&t.remove()}),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)},onPostInject:function(){var t=this.options.selectedPanel,n=this.container.getParent();if(t&&t.toLowerCase()===i.RECYCLE_BIN_PANEL.toLowerCase()){var a=e.createElement("span",{text:l.emptyRecycleBinMsg,class:"empty-db-cnt"});e.createElement("div",{class:["empty-dashboard-cnt",0===o._getTrashedContexts().length?"hide":""].join(" "),html:o._getTrashedContexts().length&&a}).inject(n,"top")}},_getScrollView:function(){return new(t.extend({tagName:"div",className:"dashboard-table-view-wrapper",render:function(){return this}}))},_loadDeps:function(){return new Promise(function(e,t){require(["DS/Dashboard/ManageDashboard/Controller/ManageDashboard"],function(t){e(t)},t)})},buildTableView:function(){var e=this;if(e.collection.length){var t=e.collection.map(function(t){return new a({model:t,dashboardActions:e.dashboardActions,dashboardActionsHandler:e.dashboardActionsHandler,facets:e.facets,actions:e.actions,attributesMapping:e.attributesMapping,members:e.members,modal:e.modal,tenants:e.tenants,selectedPanel:e.selectedPanel,filters:e.filters,sort:e.sort,dashboardId:e.dashboardId,tableViewSort:e.tableViewSort}).render()});return[{tag:"table",class:"table table-striped table-hover",html:[{tag:"thead",html:[{tag:u,class:"db-check-img-ctn"},e.sortColumn(d.title,!1,"title","header-title"),e.sortColumn(d.userRights,!0,"role","header-role"),e.sortColumn(d.modificationDate,!0,"lastUpdate","header-modification-date"),{tag:u,class:[f,p,"header-favorites"].join(" "),text:d.favorites},{tag:u,class:[f,p,"header-details"].join(" "),text:d.details},{tag:u,class:"header-actions",text:d.actions}]},{tag:"tbody",html:t}]}]}return e.filters.search||e.filters.accessRights?new s({icon:"info",title:d.noResult,model:new n}).render():e.selectedPanel.toLowerCase()===i.MY_FAVORITES_PANEL.toLowerCase()?new s({icon:"favorite-on",title:d.nodbInFavorites,model:new n}).render():new s({icon:"recycle",title:d.nodbInRecycleBin,model:new n}).render()},sortColumn:function(e,t,n,a){var i="sort-cursor";return{tag:u,"data-action":n,class:[a,t?f:""].join(" "),html:[{tag:u,class:["td-sort",i,t?f:""].join(" "),text:e,events:{click:this.sortColumnsAction.bind(this)}},{tag:"i",class:[" fonticon "+this.getSortFonticon(n),g,i,"sort-icon"].join(" "),events:{click:this.sortColumnsAction.bind(this)}}]}},sortColumnsAction:function(e){var t=e.target,n=t;0===t.getElementsByTagName(u).length&&(n=t.getParent()),this.dashboardsSortDirectionUpdate(n)},getSortFonticon:function(e){return this.tableViewSort&&this.tableViewSort.direction?"desc"===this.tableViewSort.direction&&this.tableViewSort.field===e?h+" blue":"desc"===this.tableViewSort.direction?h:"asc"===this.tableViewSort.direction&&this.tableViewSort.field===e?m+" blue":"asc"===this.tableViewSort.direction?m:void 0:m},dashboardsSortDirectionUpdate:function(e){var t=this.getContent().getElements("."+g),n=c.tableViewSort;switch(e.getText()){case d.title:n.field="title";break;case d.userRights:n.field="role";break;case d.modificationDate:n.field="lastUpdate"}var a=n.field;this.tableViewSort&&n.direction&&"desc"===n.direction?this.applySort("asc",a,t):this.applySort("desc",a,t)},applySort:function(e,t,n){var a=this.tableViewSort;a.direction=e,a.field=t,n.forEach(function(e){e.removeClassName(m),e.addClassName(h),e.addClassName("blue")}),this.sort.direction=a.direction,this.sort.field=a.field,c.createManageDashboardView({categoryToSelect:c._selectCategory})}})}),define("DS/Dashboard/Modals/Share",["UWA/Core","UWA/Element","DS/UWPClientCode/I18n","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Alert","DS/Dashboard/PublicAPI","DS/Dashboard/Models/Member","DS/Dashboard/UserPlatformAccess","DS/Dashboard/UsageTracker","DS/Dashboard/WidgetLinkManager","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l,c,u,h){"use strict";var m,g,f,p,b=!0,v={article:{privateShareLabel:h.privateShareLabelArticle,publicShareLabel:h.publicShareLabelArticle,publicShareWarning:h.publicShareWarningArticle,shareTitle:h.shareTitleArticle},module:{privateShareLabel:h.privateShareLabelWidget,publicShareLabel:h.publicShareLabelWidget,publicShareWarning:h.publicShareWarningWidget,shareTitle:h.shareTitleWidget},widget:{privateShareLabel:h.privateShareLabelWidget,publicShareLabel:h.publicShareLabelWidget,publicShareWarning:h.publicShareWarningWidget,shareTitle:h.shareTitleWidget},tab:{privateShareLabel:h.privateShareLabelTab,publicShareLabel:h.publicShareLabelTab,publicShareWarning:h.publicShareWarningTab,shareTitle:h.shareTitleTab},dashboard:{privateShareLabel:h.privateShareLabelDashboard,publicShareLabel:h.publicShareLabelDashboard,publicShareWarning:h.publicShareWarningDashboard,shareTitle:h.shareTitleDashboard},cockpit:{privateShareLabel:h.privateShareLabelCockpit,publicShareLabel:h.publicShareLabelCockpit,publicShareWarning:h.publicShareWarningCockpit,shareTitle:h.shareTitleCockpit}};return g={superModal:void 0,elements:void 0,radios:[],buildCallback:function(t,n,a){return t?function(){var t=[];e.is(n,"function")&&(g.elements.privateInput.isChecked()?(t.push("private"),t.push(g.getPrivateRecipients().map(function(e){var t={};return Object.keys(e.item).forEach(function(n){t[n]=e.item[n]}),t})),t.push(g.elements.privateMessage.getValue())):g.elements.publicInput.isChecked()?t.push("public"):t.push("live"),n.apply(null,t)),c.track({category:"share.modal."+m,action:"shareBtn"}),f.hide(!0)}:function(){e.is(a,"function")&&a.call(),c.track({category:"share.modal."+m,action:"cancelBtn"}),f.hide(!0)}},getPrivateRecipients:function(){return g.elements.privateMembers.getJsonObjects()},buildModal:function(e){(e=e||{}).shares=e.shares||{};var n,l,f,w,D,_,C,I,S,y,E,T,A,P,x,M=[],k=e.type,N=!!(s._getSwymPlatform()||{}).url;function W(e){c.track({category:"share.modal."+m,action:e+"Toggle"})}function L(e,n,a){var o,r,d;switch(e){case"private":o=v[k].privateShareLabel,d=function(e){D?D=!1:W(e)};break;case"public":o=v[k].publicShareLabel,d=function(e){W(e)};break;case"live":o=s._isEndUserCockpitContext()?h.liveShareLabelForCockpit:h.liveShareLabel,d=function(e){W(e)}}return n?((r=new t("p",{text:o,class:"share-unique"})).isChecked=function(){return e===a},r):new i({name:"share",type:"radio",className:"primary "+e,value:e,label:o,events:{onClick:function(){g.toggle(e),d(e)}}})}T=function(e){var t,n=0;return Object.keys(e).forEach(function(a){e[a]&&(n++,t=a)}),{visibleCount:n,uniqueType:1===n?t:void 0}}(A={private:N&&e.shares.private,public:e.shares.public,live:N&&e.shares.live}),y=1===T.visibleCount,E=T.uniqueType,n=L("private",y,E),_=L("public",y,E),I=L("live",y,E),l=new t("p",{html:[(f=new p({getSuggestions:function(e,t,n){e&&(t[e]?n(t[e]):s.searchUsers({query:e,platformId:s._getGlobalPlatformId(),success:n,failure:function(e){n([])}}))},categories:[{id:"recipient",name:h.recipientRole,isDefault:!0}],suggestFormat:"{name}",suggestKey:"id",labelFormat:"{name}",onEmailAddress:function(e){if(b)return{id:e,name:e,email:e,login:"",url:"",type:d.USER_TYPE}},placeholder:h.memberAutocompletePlaceholder,typeDelay:1e3,minLength:3,events:{onUpdate:function(e){g.enableShareBtn(!e.length)}}}).render()).container,w=new o({multiline:!0,rows:4,placeholder:h.messagePlaceholder,maxlength:255})],class:"private-area"}),C=new t("p",{class:"public-area",text:v[k].publicShareWarning}),S=new t("p",{class:"live-area",text:s._isEndUserCockpitContext()?h.liveShareWarningForCockpit:h.liveShareWarning}),A.private&&(M.push(n),M.push(l)),A.public&&(M.push(_),M.push(C)),A.live&&(M.push(I),M.push(S)),P=new t("div",{html:M}),x=new r({className:"share-modal-alert",fullWidth:!0,autoHide:!1,closeOnClick:!1}).inject(P,"top"),g.elements={publicInput:_,privateInput:n,liveInput:I,publicArea:C,privateArea:l,liveArea:S,privateMembers:f,privateMessage:w,alert:x,body:P},g.superModal=new a({className:"share-modal",renderTo:document.body,closable:!0,events:{onShow:function(){M.length>0&&(D=!0,y?g.toggle(E):(M[0].check(),M[0].options.events.onClick())),("widget"===k||"module"===k||"article"===k)&&u.getLinked(e.id).length>0&&x.add({className:"warning",message:h.shardeWidgetsLinkedAlert}).show(),c.track({category:"share.modal."+m,action:"open"})},onHide:function(){c.track({category:"share.modal."+m,action:"close"})}}})},toggle:function(e){var t=g.elements;switch(e){case"private":t.publicArea.hide(),t.privateArea.show(),t.liveArea.hide(),g.enableShareBtn(!g.getPrivateRecipients().length);break;case"public":t.publicArea.show(),t.privateArea.hide(),t.liveArea.hide(),g.enableShareBtn();break;case"live":t.publicArea.hide(),t.privateArea.hide(),t.liveArea.show(),g.enableShareBtn()}},enableShareBtn:function(e){var t=g.superModal;t&&t.modals.current&&(t.modals.current.elements.footer.getElement("button").disabled=e||!1)}},f={show:function(t){l.isInvitationOnShareByEmailConfigEnabled().then(function(e){b=e}),m="module"===t.type?"widget":t.type,t.shares=e.is(t.shares,"object")?t.shares:{private:!0,public:!0,live:!1},new Promise(function(e){require(["DS/W3DXComponents/Views/Item/LabelManagerView"],function(t){p=t,e()})}).then(function(){var e=[];g.buildModal(t),e.push({className:"default",value:h.cancelBtn,action:g.buildCallback(!1,t.confirm,t.cancel)}),e.push({className:"primary",value:h.shareBtn,action:g.buildCallback(!0,t.confirm,t.cancel)}),g.superModal.dialog({body:g.elements.body,title:n.replace(v[t.type].shareTitle,{name:t.title}),buttons:e})})},hide:function(e){g.superModal.modals.current.hide(),e&&g.superModal.destroy()}}}),define("DS/Dashboard/DashboardManager",["UWA/Core","UWA/String","UWA/Element","UWA/Event","DS/PlatformAPI/PlatformAPI","DS/PubSub/PubSub","DS/UWPClientCode/PublicAPI","DS/UWPClientCode/I18n","DS/UWPClientControls/PlatformNotify","DS/UWPClientCode/Undo","DS/UIKIT/SuperModal","DS/UIKIT/Alert","DS/UIKIT/Popover","DS/UIKIT/Tooltip","DS/Dashboard/Navigation","DS/Dashboard/PublicAPI","DS/Dashboard/Search","DS/Dashboard/NewDashboardMenu","DS/Dashboard/Modals/AddRenameDashboard","DS/Dashboard/Modals/RenameTab","DS/Dashboard/Modals/Share","DS/Dashboard/Modals/ShareLink","DS/Dashboard/Modals/ExportDashboard","DS/Dashboard/UsageTracker","DS/Dashboard/Models/Member","DS/Dashboard/UserPlatformAccess","DS/Dashboard/Utils","DS/Dashboard/Views/WidgetsLinksModeActionBarView","DS/Dashboard/ManageDashboardManager","i18n!DS/Dashboard/assets/nls/main","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/layout","i18n!DS/Dashboard/assets/nls/manage_modal"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w,D,_,C,I,S,y,E,T,A,P,x,M,k){"use strict";function N(e,t,n){new c({closable:!1,renderTo:document.body}).alert(e,t,n)}var W,L;function U(){return require("DS/Dashboard/Layout/Dashboard")}var O,F={init:function(){F._initEvents()},showAlert:function(e){var t;return(t=new u({className:["ifwe-dashboard-notify",e.className||""].join(" "),closable:!0,visible:!0,autoHide:e.autoHide||!1,closeOnClick:e.closeOnClick||!1,hideDelay:e.hideDelay||4e3,events:{onClick:e.onClick||function(){},onRemoveMessage:e.onRemoveMessage||function(){t&&t.elements&&t.destroy(),t=null}}}).inject(document.body,"top")).add(e.messages[0]),t},showVideoPlayer:function(t){t=t||{};var n,i,o,r,s,d=!e.is(t.autoStart,"boolean")||t.autoStart,l=document.body;function c(e){switch(a.whichKey(e)){case"esc":u(),a.stop(e)}}function u(e){e&&e.target!==n&&e.target!==i||(n.destroy(),o&&o.elements&&o.destroy(),o=null,l.removeEvent("keydown",c))}function h(){r&&r.pause(),open(t.videoUrl,"_blank")}n=e.createElement("div",{class:"ifwe-video-player-ctn",html:[s=e.createElement("div",{id:"ifwe-video-player"}),i=e.createElement("div",{class:"fonticon fonticon-close ifwe-video-player-close-icon",title:P.closeVideoPlayerTooltip,events:{click:u}}),{tag:"div",class:"fonticon fonticon-login ifwe-video-player-dl-icon",title:P.openNewTabVideoLinkTooltip,events:{click:h}}],events:{click:function(e){u(e),a.stopPropagation(e)}}}).inject(l),l.addEvent("keydown",c),s.addContent(e.createElement("video",{src:t.videoUrl,autoplay:d,controls:!0,events:{keyup:c,error:function(){o=F.showAlert({className:"ifwe-video-player-notify",closeOnClick:!1,onClick:function(){h(),u()},messages:[{className:"error",message:P.videoNotPlayable}]})}}})),l.getElement("#ifwe-video-player video").focus()},setDashboardBackground:function(t){var a,i,o,r,s,d,l=82,c="ifwe-bg",u=document.body;function h(e){u.removeClassName(c),e&&e.setStyles({background:""})}function m(){return i||(i=u.getElement(".app-content"))}r=(t=t||{}).url,s=t.bgId,o=t.scale,u.hasClassName("background-preview-open")&&(s="",r=m()?m().getStyle("background-image"):"",r=(d=/(?:^url\()(.*?)(?:\)$)/gi.exec(r)||[]).length>=2?d[1]:""),s||r?m()?(s&&(r=f._getContextBackgroundUrl({backgroundId:s})),u.addClassName(c),a={"background-image":r?"url("+r+")":"","background-repeat":t.repeat||"no-repeat","background-position":t.position||"0 "+l+"px","background-color":t.color||"transparent","background-attachment":"fixed"},o&&(a["background-size"]=100*o+"%"),m().setStyles(a),t.fit&&function(t){var a=t.width,o=t.height;function r(e,a){var o,r,s,d,c;function u(){var t=d/e;return e*t+"px "+a*t+"px"}function h(){var t=c/a;return e*t+"px "+a*t+"px"}r=t.fit,s=n.getSize.call(window),d=s.width,(o=(c=s.height-l)/a>=d/e?"lossless"===r?u():h():"lossless"===r?h():u())&&i.setStyles({"background-size":o})}if(a&&o)r(a,o);else var s=e.createElement("img",{src:t.bgUrl,styles:{display:"none"},events:{load:function(){r(this.width,this.height),s&&s.destroy()},error:function(){s&&s.destroy()}}}).inject(u)}({bgUrl:r,width:t.width,height:t.height,fit:t.fit})):h():h(m())},renameDashboard:function(e){return new Promise(function(t,n){v.show({modelId:e,confirm:function(a){f.renameContext({modelId:e,name:a.name,description:a.description}).then(function(e){I.track({category:"dashboard.rename",action:"success-dashboardManager"}),o.dispatch(f.events.dashboard.rename,[e]),t(e)},function(){var t=f._isEndUserCockpitContext(e);I.track({category:"dashboard.rename",action:"fail-dashboardManager"}),N(t?P.renameCockpitErrorBody:P.renameDashboardErrorBody,t?P.renameCockpitErrorTitle:P.renameDashboardErrorTitle,function(){n(new Error("Unable to rename Dashboard: "+e))})})},cancel:t})})},unShareDashboard:function(e,t){var n,a,i=(t=t||{}).skipConfirm,s=f._getContext(e);if(!s)return Promise.reject("Context not found: "+e);return n=f._isEndUserCockpitContext(e),s.shareAccesses=s.shareAccesses||[],a=s.shareAccesses.filter(function(e){return S.isGroupType(e.type)}),1!==f._getAllContexts().length||a.length?(i?Promise.resolve(!0):new Promise(function(e){new c({closable:!1,renderTo:document.body}).confirm(n?P.unshareCockpitWarnBody:P.unshareDashboardWarnBody,x.confirmation,e,x.okBtn,x.cancelBtn)})).then(function(t){return!!t&&function(e){return new Promise(function(t,n){f.getContextMembers({id:e,success:t,failure:n})}).then(function(t){if(0===(t.members||[]).length)return Promise.reject("Fail in fetching context's members");var a=t.members.filter(function(e){return S.isOwnerRole(e.role)&&S.isUserType(e.type)});return f.unShareContext({modelId:e,member:r.getCachedCurrentUser(),userRecipients:a}).then(function(){var t=!1,a=f._isActiveContext(e);y.getUserRoles().map(function(e){return e.id}).some(function(e){return(s.roles||[]).indexOf(e)>=0})?s.shareAccesses.forEach(function(e){S.isUserType(e.type)&&(e.role=S.READER_ROLE,t=!0)}):s.shareAccesses=s.shareAccesses.filter(function(e){return!S.isUserType(e.type)}),s.shareAccesses.length?(s.role=E.getStrongerAccessRight(s.shareAccesses).toUpperCase(),o.dispatch(f.events.dashboard.unshare,{context:s})):(r.contexts=r.contexts.filter(function(t){return t.modelId!==e}),a&&b.routeToNextContext(),o.dispatch(f.events.dashboard.remove,{isCurrent:a,context:s})),i||d.success(t?P.unShareAccessRightSuccess:n?P.unShareCockpitSuccess:P.unShareDashboardSuccess)}).catch(function(e){throw I.track({category:"unshare.remove.live",action:"fail-unShare"}),e})})}(e).then(function(){return!0}).catch(function(){return!1})}):new Promise(function(e){N(n?P.cantRemoveAccessToLastShareCockpitBody:P.cantRemoveAccessToLastShareDashboardBody,n?P.cantRemoveAccessToShareCockpitTitle:P.cantRemoveAccessToShareDashboardTitle,function(){e(!1)})})},addFavorites:function(e,t,n){if(n=n||{},t=t||0,"string"==typeof e&&(e=[e]),!e.length)return Promise.resolve();var a=f._getFavoriteContextModelIds(),i=!1;return e.forEach(function(e){a.includes(e)||(a.splice(t,0,e),i=!0)}),i?f.setFavoriteContextModelIds(a).then(function(){n.preventSuccessNotif||d.success(e.length>1?P.addAsFavoritesDashboardOrCockpit:f._isEndUserCockpitContext(e[e.length-1])?P.cockpitAddAsFavoriteSuccess:P.addAsFavoriteSuccess),o.dispatch(f.events.dashboard.addFavorites,{modelIds:e})}):Promise.resolve()},removeFavorites:function(e,t){var n;if(t=t||{},"string"==typeof e&&(e=[e]),!e.length)return Promise.resolve();var a=f._getFavoriteContextModelIds();return e.forEach(function(e){a.includes(e)&&(n=!0,a.splice(a.indexOf(e),1))}),n?f.setFavoriteContextModelIds(a).then(function(){t.preventSuccessNotif||d.success(e.length>1?P.cockpitorDashboardRemoveFromFavoriteSuccess:f._isEndUserCockpitContext(e[0])?P.cockpitRemoveFromFavoriteSuccess:P.removeFromFavoriteSuccess),o.dispatch(f.events.dashboard.removeFavorites,{modelIds:e})}):Promise.resolve()},reorderFavorites:function(e,t){if("string"==typeof e&&(e=[e]),!e.length)return Promise.resolve();var n=f._getFavoriteContextModelIds();return n=n.filter(function(t){return!e.includes(t)}),e.forEach(function(e){n.splice(t++,0,e)}),f.setFavoriteContextModelIds(n).then(function(){o.dispatch(f.events.dashboard.reorderFavorites,{modelIds:e})})},addDashboard:function(){return new Promise(function(e,t){v.show({confirm:function(n){f.addDashboard({name:n.name,description:n.description,templateModelId:n.templateModelId,templateTopic:n.templateTopic,thumbnailId:n.thumbnailId}).then(function(t){o.addOnce(f.events.dashboard.change,function(){e(t)}),I.track({category:"dashboard.create",action:"success-dashboardManager"}),g.routeTo({dashboard:t.modelId})}).catch(function(){d.error(P.addDashboardError),I.track({category:"dashboard.create",action:"fail-dashboardManager"}),t()})},cancel:e})})},updateDashboardMemberAccess:function(e){return new Promise(function(t,n){var a=e.dashboardId;f.updateContextMemberAccess({id:a,member:e.member,role:e.role,success:function(n,a){e.member.isGroup()||e.member.isCurrentUser()&&window.location.reload(),t(a),I.track({category:"share.update.live",action:"success-dashboardManager"})},failure:function(e){n(e),I.track({category:"share.update.live",action:"fail-dashboardManager"})},scope:this}),I.track({category:"share.update.live",action:"as"+e.role+"-dashboardManager"})})},removeDashboardMemberAccess:function(e,t){return new Promise(function(n,a){f.removeContextMemberAccess({id:e,member:t,success:function(){if(t.isGroup())n({isCurrentUser:!1});else{var a,i,s=!1,d=!1;i=f._isActiveContext(e),t.isCurrentUser()&&(s=!0,(a=f._getContext(e)).shareAccesses=(a.shareAccesses||[]).filter(function(e){return!S.isUserType(e.type)}),a.shareAccesses.length||(d=!0,r.contexts=r.contexts.filter(function(t){return t.modelId!==e})),i&&b.routeToNextContext(),o.dispatch(f.events.dashboard.remove,{isCurrent:i,context:a})),n({isCurrentUser:s,isAccessRemovedForCurrentUser:d}),I.track({category:"share.delete.live",action:"success-dashboardManager"})}},failure:function(e){a(e),I.track({category:"share.delete.live",action:"fail-dashboardManager"})},scope:this})})},duplicateContext:function(e){return new Promise(function(n,a){var i=f.DASH_NAME_MAX_LENGTH,r=e.modelId,l=f._getDuplicateContextName(r),u=f._isEndUserCockpitContext(r);function h(e){N(u?P.duplicateCockpitErrorBody:P.duplicateDashboardErrorBody,u?P.duplicateCockpitErrorTitle:P.duplicateDashboardErrorTitle,function(){a(e)}),I.track({category:"dashboard.duplicate",action:"fail-dashboardManager"})}function m(t){f.duplicateContext({id:r,name:t,success:function(t){d.success(u?s.replace(P.duplicateCockpitSuccess,{dashboardName:t.name}):s.replace(P.duplicateDashboardSuccess,{dashboardName:t.name})),o.dispatch(f.events.dashboard.duplicate,{context:t}),e.navTo&&g.routeTo({dashboard:t.modelId,keeps:g.parts.tab}),I.track({category:"dashboard.duplicate",action:"success-dashboardManager"}),n(t)},failure:h})}l.length>i?new c({closable:!1}).prompt({message:u?P.duplicateCockpitNameTooLong:P.duplicateDashboardNameTooLong,title:u?P.duplicateCockpitTitle:P.duplicateDashboardTitle,required:!0,value:t.truncate(l,i),maxlength:i,okButtonText:P.duplicateItem,callback:function(e){e?m(e):n(!1)}}):m(l)})},deleteDashboard:function(t,n){var a=(n=n||{}).skipUndo,i=f._isEndUserCockpitContext(t);return new Promise(function(n,d){var u=f._getContext(t),h=f._getActiveContext();function m(e){I.track({category:"dashboard.delete",action:"fail-dashboardManager"}),e&&e.lastDashboard?(N(i?P.cantRemoveLastCockpitBody:P.cantRemoveLastDashboardBody,i?P.cantRemoveLastCockpitTitle:P.cantRemoveLastDashboardTitle,function(){d(new Error("The last Dashboard cannot be removed."))}),I.track({category:"share.delete.live",action:"failDeleteLastDashboard-dashboardManager"})):d(e)}u?function(n){return new Promise(function(a,i){r.getContextRoles(e.extend(e.clone(n),{serviceName:f._getServiceName(),success:a,failure:function(){i(new Error("Unable to find roles for Dashboard: "+t))}}))})}(u).then(function(e){return new Promise(function(t){var n,a,o=u.membersCount||1;a=e.length?s.replace(P.deleteDashboardWithRolesWarnBody,{rolesCount:e.length}):"",n=i?P.deleteCockpitBody+" ":P.deleteDashboardBody+" ",n+=a?a+" ":" ",n+=o>=2?s.replace(P.deleteDashboardWithMemberCountWarnBody,{count:o}):"",n+=P.deleteDashboardRestore,new c({closable:!0,renderTo:document.body}).confirm(n,i?P.deleteCockpitWarnTitle:P.deleteDashboardWarnTitle,t,x.deleteBtn,x.cancelBtn)})}).then(function(e){if(e)return a?F.trashContext(t).then(function(){n({confirmed:!0})}):function(e){e?1!==f._getAllContexts().length?l.addAction({id:t,name:u.name,undoPending:function(){f._disableContext(t),u.active&&b.routeToNextContext(),o.dispatch(f.events.dashboard.trashPending,{isCurrent:u.active,context:u}),n({confirmed:!0})},undoAgree:function(){f._enableContext(t),o.dispatch(f.events.dashboard.add,[t]),h.active||g.routeTo({dashboard:h.modelId}),I.track({category:"dashboard.delete",action:"undo-dashboardManager"})},undoDecline:function(){f._enableContext(t),F.trashContext(t)}}):m({lastDashboard:!0}):n({confirmed:!1})}(e);n({confirmed:!1})}).catch(function(e){m(e)}):d(new Error("Unable to find the Dashboard: "+t))})},trashContext:function(e){var t,n=f._getContext(e);return n?(t=n.active,f._disableContext(e),f.trashContext({modelId:e}).then(function(){new Promise(function(t,n){f.getContextMembers({id:e,success:t,failure:n})}).then(function(t){if(!((t=t.members)||[]).length)return Promise.reject("Fail to fetch context's members.");var a=r.getCachedCurrentUser(),i=t.filter(function(e){return e.email!==a.email&&S.isOwnerRole(e.role)&&S.isUserType(e.type)});i.length&&f.publish3DNotifications({recipients:i,messageId:f._isEndUserCockpitContext(e)?"trash.cockpit.msg":"trash.dashboard.msg",notificationId:"trash.dashboard.setting",uri:"#dashboard:"+e,data:{FROM_USER_NAME:a.firstName+" "+a.lastName,INSTANCE_NAME:n.name}})}),t&&b.routeToNextContext(),o.dispatch(f.events.dashboard.trash,{isCurrent:t,context:n}),I.track({category:"dashboard.trash",action:"trash-dashboard-success"})})):Promise.reject("Context not found: "+e)},unTrashContext:function(e){var t,n=e.context||f._getContext(e.modelId);return n?(t=n.modelId,f.unTrashContext({modelId:t}).then(function(){!e.preventSuccessNotif&&d.success(s.replace(P.restoreDashboardSuccess,{dashboardName:n.name})),(f._getActiveContext()||{}).modelId===t&&(F.destroyTrashedDashboardAlert(),setTimeout(()=>{g.routeTo({dashboard:t,reload:!0})},500)),o.dispatch(f.events.dashboard.untrash,{context:n})})):Promise.reject("Context not found.")},unTrashContexts:function(e){var t=[];return e.modelIds.forEach(function(e){t.push(F.unTrashContext({modelId:e,preventSuccessNotif:!0}).catch(function(e){throw console.error(e),new Error(e)}))}),Promise.all(t).then(function(){d.success(P.restoreMultipleDashboardSuccess)})},deleteDashboards:function(e){return new Promise(function(t,n){var a=f._getAllContexts().length,i=[],o=[];function r(e){e&&e.lastDashboard?(N(f._isEndUserCockpitContext(e.dashboardId)?P.cantRemoveLastCockpitBody:P.cantRemoveLastDashboardBody,function(){n({error:P.lastDashboardOrCockpitDeleteError})}),I.track({category:"dashboard.delete",action:"fail-dashboardManager"})):n({error:e})}e.length>=a?N(P.deleteMultipleDashboardWarningBody,P.deleteMultipleDashboardWarningErrorTitle,function(){t({shouldContinue:!1})}):(i=e.filter(function(e){return f._isUnShareableContext(e)}),o=e.filter(function(e){return f._isDeleteableContext(e)}),function(e){var t=e.length>1;return new Promise(function(n){var a=i.length?k.deleteAndUnsubscribeMultipleDashboardBody:P.deleteMultipleDashboardBody;a+=" "+k.deleteMultipleDashboardRestore,new c({closable:!0,renderTo:document.body}).confirm(a,t?P.deleteDashboardOrCockpitWarnTitle:f._isEndUserCockpitContext(e[e.length-1])?P.deleteCockpitWarnTitle:P.deleteDashboardWarnTitle,n,x.deleteBtn,x.cancelBtn)})}(e).then(function(n){if(n){if(1!==a){var s=[];return o.forEach(function(e){s.push(F.trashContext(e).catch(function(e){console.error(e)}))}),i.forEach(function(e){s.push(F.unShareDashboard(e,{skipConfirm:!0}).catch(function(e){console.error(e)}))}),Promise.all(s).then(function(){!function(e){var t,n,a=g.getPlatformManagementId(),i=g.getMembersManagementId(),o=[];n=e.some(function(e){return f._isDefaultContext(e)&&e!==a&&e!==i}),t=e.some(function(e){return f._isDefaultCustomRoleContext(e)}),e.some(function(e){return e===a||e===i})&&o.push(k.adminDashboardDeleteWarningMsg),t&&o.push(k.customRoleDashboardDeleteWarningMsg),n&&o.push(k.defaultDashboardDeleteWarningMsg),o.length&&F.showAlert({className:"delete-dash-warn-notify",messages:[{className:"warning",message:o.join("<br/>")}]})}(e),t({shouldContinue:!0})})}r({lastDashboard:!0,dashboardId:e[e.length-1]})}else t({shouldContinue:!1})}).catch(r))})},deleteTrashDashboards:function(e){return new Promise(function(e){new c({closable:!1,renderTo:document.body}).confirm(x.deleteRecycleBinWarnBody,x.confirmation,e,x.okBtn,x.cancelBtn)}).then(function(t){return!!t&&f.removeTrashedContexts(e).then(function(){I.track({category:"trashDashboard.dashboard.delete",action:"delete-trash-success"})})})},addTab:function(){o.dispatch(f.events.tab.add)},deleteTab:function(e){return new Promise(function(t,n){var a=f._getTabContext(e);if(!a)return n(new Error("Tab not found: "+e));if(f._getAllTabs().filter(function(e){return!e||!e.disabled}).length<2)return N(P.cantRemoveLastTabBody,P.cantRemoveLastTabTitle,function(){t(!1)});if(g.isBELayoutEditorMode()&&f._getTab(e).environment.wp.children.some(function(e){return e.widget&&e.widget.environment.isBMDummyWdg()}))return N(P.cantRemoveTabContainingBMDummyWdgBody,P.cantRemoveTabContainingBMDummyWdgTitle,function(){t(!1)});new Promise(function(e){new c({closable:!0,renderTo:document.body}).confirm(P.deleteTabBody,P.deleteTabWarnTitle,e,x.deleteBtn,x.cancelBtn)}).then(function(e){e&&o.dispatch(f.events.tab.remove,[a]),t(!0)})})},renameTab:function(e){return new Promise(function(t,n){var a=f._getTabContext(e);function i(e){N(P.renameTabErrorBody,P.renameTabErrorTitle,function(){n(e)}),I.track({category:"tab.rename",action:"fail-dashboardManager"})}w.show({name:((a||{}).options||{}).name||"",confirm:function(n){n&&a?(o.dispatch(f.events.tab.rename,[a,n]),I.track({category:"tab.rename",action:"success-dashboardManager"}),t({tab:a,newName:n})):n&&f.renameTab({id:e,name:n,success:function(e){I.track({category:"tab.rename",action:"success-dashboardManager"}),t(e)},failure:i})},cancel:function(){I.track({category:"tab.rename",action:"canceled-by-user"}),t({canceled:!0})}})})},fitTab:function(t,n){var a=f._getTabContext(t),i=f._getTab(t),r=i.layout.activeLayout.name,s=n?"dock":"grid";return a&&r!==s&&(i.layout.convertTo(s),o.dispatch(f.events.tab.fit,[t,n])),i.setValue("layout",e.extend(e.clone(i.getValue("layout")),{master:s})),"grid"===s?a.menu.updateItem({id:"fitItem",text:M.fitItem}):a.menu.updateItem({id:"fitItem",text:M.scrollItem}),Promise.resolve()},refreshTab:function(e){var t,n=f._getTabContext(e);return n?(o.dispatch(f.events.tab.refresh,[n]),t=Promise.resolve(n)):t=Promise.reject(new Error("Unable to refresh the tab since it is not in the active dashboard")),t},duplicateTab:function(e){return new Promise(function(n,a){var i=f.TAB_NAME_MAX_LENGTH,o=f._getTabContext(e),r=o?f._getDuplicateTabName(e):null;function s(e){N(P.duplicateTabErrorBody,P.duplicateTabErrorTitle,function(){a(e)}),I.track({category:"tab.duplicate",action:"fail-dashboardManager"})}function d(t){f.duplicateTab({id:e,name:t,shouldDispatchEvent:!!o,success:function(e){n(e),I.track({category:"tab.duplicate",action:"success-dashboardManager"})},failure:s})}o&&r.length>i?new c({closable:!1}).prompt({message:P.duplicateTabNameTooLong,title:P.duplicateTabTitle,required:!0,value:t.truncate(r,i),maxlength:i,okButtonText:P.duplicateItem,callback:function(e){e?d(e):n(!1)}}):d(r)})},addModule:function(e){var t=f._getActiveTab();I.track({category:"widget.create",action:"addModule-dashboardManager",appId:e.appId,platformId:(e.data||{}).x3dPlatformId}),f.addModule({url:e.url,appId:e.appId,title:e.title,data:e.data,coordinates:e.coordinates||"",tabId:t.id,scope:e.scope,success:e.success,failure:e.failure})},share:function(e){return new Promise(function(t,n){var a,i,o,r,l,c,u,h,m,g,p;function b(e,n){var a,o={};try{o=JSON.parse(e.data)}catch(e){}a=e.warnings||o.warnings||{},n=Array.isArray(n)?n:[],a.cleanedPreferences&&(d.info(P.cleanedPreferencesAlert),I.track({category:"share.create.copy."+r,action:"cleanedPreferences-dashboardManager"})),a.notFoundWidgets&&(d.warn(i.notFoundAlert),I.track({category:"share.create.copy."+r,action:"notFoundWidgets-dashboardManager"})),n.forEach(function(e){d.warn(e.message)}),d.success(s.replace(i.sharePrivateSuccess,{title:m||c})),I.track({category:"share.create.copy."+r,action:"privateSuccess-dashboardManager"}),t(!0)}function v(e,t){t=t||[],Array.isArray(t)||(t=[t]),t.forEach(function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}var t="object"==typeof e;t&&"WIDGET_DATA_SIZE_LIMITATION_EXCEED"===e.errorType?d.error(P.dataSizeShareError):t&&"NO_RECIPIENTS"===e.errorType?d.error(i.nothingToShareError):t&&(e.message||e.errorMessage)?d.error(e.message||e.errorMessage):d.error(P.shareError+" - "+e)}),I.track({category:"share.create.copy."+r,action:"fail-dashboardManager"}),n(e)}e=e||{},g={article:{action:"shareArticle"},module:{action:"shareModule"},widget:{action:"shareModule"},tab:{action:"shareTab"},dashboard:{action:"shareContext"},cockpit:{action:"shareContext"}},o={article:{sharePrivateSuccess:P.sharePrivateSuccessArticle,nothingToShareError:P.nothingToShareErrorArticle},module:{sharePrivateSuccess:P.sharePrivateSuccessWidget,nothingToShareError:P.nothingToShareErrorWidget},widget:{sharePrivateSuccess:P.sharePrivateSuccessWidget,nothingToShareError:P.nothingToShareErrorWidget},tab:{sharePrivateSuccess:P.sharePrivateSuccessTab,nothingToShareError:P.nothingToShareErrorTab,notFoundAlert:P.notFoundAlertTab},dashboard:{sharePrivateSuccess:P.sharePrivateSuccessDashboard,nothingToShareError:P.nothingToShareErrorDashboard,notFoundAlert:P.notFoundAlertDashboard},cockpit:{sharePrivateSuccess:P.sharePrivateSuccessCockpit,nothingToShareError:P.nothingToShareErrorCockpit,notFoundAlert:P.notFoundAlertCockpit}},l=e.id,p=e.modelId,r=e.type,c=e.title,m=e.fullTitle,u=e.link,h=e.shares,a=g[r].action,i=o[r],D.show({modelId:p,id:l,title:m||c,type:r,shares:h,confirm:function(e,o,s){switch(e){case"private":o.length>0?f[a]({id:l,modelId:p,recipients:o,message:s,title:c,fullTitle:m,link:u,success:b,failure:v}):(d.warn(i.nothingToShareError),n());break;case"public":f[a]({id:l,modelId:p,title:c,fullTitle:m,link:u,success:function(e){var n=e.warnings||{};_.show({type:r,link:e.publicUrl,title:m||c,preferenceAlert:n.cleanedPreferences,errorAlert:n.notFoundWidgets,confirm:function(){I.track({category:"share.create.copy."+r,action:"publicSuccess-dashboardManager"}),t(!0)}.bind(this,e)})},failure:v});break;case"live":A.open({contextModelId:f._getActiveContextModelId()}),t(!0)}},cancel:function(){t(!1)}})})},shareContext:function(e,t){return f.getContextWidgetId({modelId:e}).then(function(n){var a=f._getContext(e);return F.share({id:n,modelId:e,type:a.type,title:a.name,shares:t})}).catch(function(){})},shareTab:function(e){return(e=e||(f._getActiveTab()||{}).id)?F.share({id:e,type:"tab",title:f._getTabName(e)}):Promise.reject("No tab id found.")},shareWidget:function(e){var t,n=((e="string"==typeof e?f._getWidget(e):e)||{}).environment;return e&&n?(t=n.getParent())&&t.isEditable()?F.share({id:e.id,type:"module",fullTitle:n.getTitle(),title:n.getName()}):Promise.reject("No parent env found or parent env not editable."):Promise.reject("Widget or Widget env not found.")},exportDashboard:function(e){var t=e?f._getContext(e):f._getActiveContext();return C.show({title:t.name,confirm:function(e){document.location=f._getContextExportUrl(t.modelId,{kind:"default"===e?1:"template"===e?2:3})}}),Promise.resolve()},setOverflowMessageDisplayed:function(e,t){var n,a,i=f._getActiveContextWidget().layout,o=f._getActiveTab(),r=i.elements.contentNode;O&&O.destroy(),O=void 0,e&&((n=(a=(O=new h({target:r,trigger:"",offset:{y:r.getSize().height},body:o.environment.wp.isEditable?'<a href="#">'+P.cancelFit+"</a>":"",title:P.widgetOverflowTitle})).getContent()).getElement("a"))&&n.addEvent("click",t),O.show(),["left","right","top","bottom"].forEach(a.removeClassName.bind(a)))},openHelpWindow:function(e){return e=e||{},Promise.all([function(e){return e.helpInfo?Promise.resolve(e.helpInfo):e.helpInfoPath?f.fetchHelpInfo(e.helpInfoPath):Promise.resolve()}(e),new Promise(function(e){require(["DS/WebUAUtils/WebUAUtils"],function(t){t.setContext(f._getApplicationConfigurationBoolean("app.build.isCloud")?"cloud":"onpremise"),t.setLanguage(s.getCurrentLanguage()),f.fetchHelpCustomUrl().then(function(n){n&&t.setLocation(n),e(t)})})})]).then(function(t){var n=t[0],a=t[1];n=n?{helpid:e.helpId||"Widget",content:n}:void 0,a.displayHelp(n)})},enableWidgetsLinksMode:function(e){var t=f._getActiveTab(),n=t&&t.environment,a=n&&((n.wp||{}).parent||{}).widget;n&&a&&!F.isWidgetsLinksModeEnabled()&&(n.html.module.addClassName("tab-widgets-links-mode-enabled"),(W=new T({originId:e,tabId:t.id,onApply:function(){F.disableWidgetsLinksMode()},onCancel:function(){F.disableWidgetsLinksMode()}})).render().inject(a.body.getElement("> .wp-tabview"),"bottom"),n.propagateWidgetsLinksMode(!0),U().resizeTab({widget:a,noTracking:!0}))},disableWidgetsLinksMode:function(){if(F.isWidgetsLinksModeEnabled()){var e=f._getTab(W.tabId),t=e&&e.environment;W.destroy(),W=null,t&&(t.propagateWidgetsLinksMode(!1),t.html.module.removeClassName("tab-widgets-links-mode-enabled"),U().resizeTab({widget:t.wp.parent.widget,noTracking:!0}))}},isWidgetsLinksModeEnabled:function(){return!!W},getWidgetsLinksModeOriginWidgetId:function(){return W.originId},showTrashedDashboardAlert:function(){var t,n,a,i,o,r=f._getActiveContext(),s=f._isEndUserCockpitContext(r);function d(){F.destroyTrashedDashboardAlert(),null}r&&(t=r.owner?s?P.openCockpitInNewTabNotifyLinkOwner:P.openDashboardInNewTabNotifyLinkOwner:s?P.openCockpitInNewTabNotifyLinkReader:P.openDashboardInNewTabNotifyLinkReader,i=(n=(L=F.showAlert({className:"dashboard-in-recycle-bin-alert",messages:[{message:t}]})).elements.container).getElement(".alert-message"),(a=n.getElement("a"))&&a.addEvent("click",function(){var e=f._getActiveContext();return e||e.deletionDate?F.unTrashContext({context:e}).then(function(){d()}):Promise.resolve()}),o=e.createElement("div",{class:"custom-close-icon fonticon fonticon-cancel",events:{click:function(){d(),setTimeout(function(){var e=f._getActiveContext();e&&e.deletionDate&&F.showTrashedDashboardAlert()},3e4)}}}).inject(i),new m({position:"bottom",target:o,body:P.closeItem,offset:{x:0,y:0}}))},destroyTrashedDashboardAlert:function(){var e=L;e&&e.elements&&e.destroy(),L=null},_initEvents:function(){o.add(o.events.searchQuery,function(e){var t=(f._getActiveTab()||{}).environment;t&&t.propagateSearch(e)}),o.add(f.events.dashboard.inconsistency,function(){var t=e.createElement("span",{html:P.dashboardInconsistency});t.getElement(".page-reload-prompt").addEvent("click",function(){window.location.reload()}),F.showAlert({messages:[{message:t,className:"error"}]})},null,!0),o.add(f.events.dashboard.remove,F._onDeleteContext,null,!0),o.add(f.events.dashboard.trashPending,F._onDeleteContext,null,!0),o.add(f.events.dashboard.remove,F._onDeleteContext,null,!0),o.add(f.events.dashboard.change,function(e){p.init(""),e.deletionDate?F.showTrashedDashboardAlert():F.destroyTrashedDashboardAlert(),I.track({category:"dashboard.use",action:"onDashboardChange-topFrameManager"})},null,!0),i.subscribe("3ddashboard:contexts:created",function(){r.getContextsBy({platforms:[f._getGlobalPlatformId()],unMerged:!0,serviceName:f._getServiceName(),success:function(){o.dispatch(f.events.dashboard.created)}})},null,!0),i.subscribe("com.ds.compass:onGrantedRole",function(){F.showAlert({className:"ifwe-granted-role-notify",autoHide:!1,messages:[{className:"primary",message:P.servicesChangedBodyP1+" "+P.servicesChangedBodyP3}]});var e=document.body.getElement(".ifwe-granted-role-notify a");e&&e.addEvent("click",function(){g.routeTo({keepAll:!0,reload:!0})})},null,!0),y.fetchUserAdmin().then(function(e){e&&i.subscribe(f.events.platform.tenant,function(e){var t=(e=e||{}).tenantId,n=f._getActiveContextModelId();n&&f.setContextPlatformId({id:n,platformId:t}).then(function(){!e.silent&&o.dispatch(f.events.dashboard.refresh)})},null,!0)})},_onDeleteContext:function(e){var t=(e=e||{}).context;t&&F.removeFavorites(t.modelId,{preventSuccessNotif:!0})}};return F}),define("DS/Dashboard/ManageDashboard/Views/ActionBar",["UWA/Core","UWA/Promise","UWA/Class/View","DS/UIKIT/Iconbar","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/WebappsUtils/Utils","DS/Dashboard/DashboardManager","DS/Dashboard/ManageDashboard/Views/SortMenu","DS/Dashboard/ManageDashboard/Events","DS/Dashboard/ManageDashboard/Controller/ManageDashboard","i18n!DS/Dashboard/assets/nls/manage_modal"],function(e,t,n,a,i,o,r,s,d,l,c,u){"use strict";var h;return n.extend({tagName:"div",className:"action-bar",elements:{},filterValue:"",setup:function(){this._loadDeps().then(function(e){h=e})},render:function(){return this.createSortView(),this._buildSearchAction(),this.elements.searchMainCtn.inject(this.container,"top"),this},destroy:function(){this.elements.iconBar&&this.elements.iconBar.destroy(),this.elements.searchMainCtn&&this.elements.searchMainCtn.destroy(),this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)},_loadDeps:function(){return new t(function(e,t){require(["DS/Dashboard/ManageDashboard/Controller/ManageDashboard"],function(t){e(t)},t)})},createSortView:function(){var t=this,n=t.elements,i=t.container,r=e.createElement("div",{class:"icon-bar-ctn pull-right"});n.iconBar&&n.iconBar.destroy(),n.iconBar=new a({items:[{fonticon:"favorite-add",text:u.addAsFavorite,className:"add-fav-icon hidden",handler:function(){t.addAsFavorite()}},{fonticon:"favorite-delete",text:u.removeFromFavorite,className:"remove-fav-icon hidden",handler:function(){t.removeFromFavorites()}},{fonticon:"undo",text:u.unTrashAction,className:"undo-icon hidden",handler:function(){t.restoreDashboards()}},{fonticon:"trash",text:u.deleteAction,className:"trash-icon hidden",handler:function(){t.deleteDashboards()}},{className:"divider divider-icon hidden"},{fonticon:"sort-alpha-asc",text:u.sortDashboards,name:"sort",className:"sort-db",content:{type:"dropdown",options:{className:"customdropdown-menu",body:d.buildSortView(),events:{onShow:function(){var e=this.elements.container.getElement(".sort-deletion-date");if(h._selectCategory===l.RECYCLE_BIN_PANEL?e.removeClassName("hidden"):e.addClassName("hidden"),h.tableViewSort&&h.tableViewSort.field){var t=h.tableViewSort.field+"-"+("asc"===h.tableViewSort.direction?"a":"d"),n=this.elements.container.getElement("."+t);d.toggleSelection(n)}},onClick:function(e){t.onSortSelection(e)}}}}},{fonticon:"filter",text:u.filterDashboards,className:"filter-db",content:{type:"dropdownmenu",options:{multiSelect:!0,closeOnClick:!0,items:[{text:u.userRights,className:"header"},{className:"access-rights",name:"reader",text:u.readerAccess,fonticon:"lock",handler:function(){t.onFilterSelected(this)}},{className:"access-rights",name:"contributor",text:u.contributorAccess,fonticon:"pencil",handler:function(){t.onFilterSelected(this)}},{className:"access-rights",name:"owner",text:u.ownerAccess,fonticon:"lock-open",handler:function(){t.onFilterSelected(this)}},{className:"divider"},{text:u.type,className:"header"},{className:"type",name:"cockpit",text:u.cockpit,fonticon:"attributes",handler:function(){t.onFilterSelected(this)}},{className:"type",name:"dashboard",text:u.dashboard,fonticon:"chart-map-tree",handler:function(){t.onFilterSelected(this)}}].map(function(t){return e.extend({selectable:!0},t)})}}},{fonticon:"select-on",text:u.multiSelect,className:"select-on",handler:function(e,t){var n=t.elements.container;if(n.hasClassName("selected"))return n.removeClassName("selected"),void c.unSelectDashboardTile();n.addClassName("selected")}},{fonticon:"open-down",text:u.selectUnselectAll,className:"select-open-down",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-all",description:u.selectAll,text:u.selectAll,className:"select-all",handler:function(){c.selectDashboardTile(),n.iconBar.elements.container.getElement(".select-on").addClassName("selected")}},{fonticon:"select-none",description:u.unselectAll,text:u.unselectAll,className:"unselect-all",handler:function(){c.unSelectDashboardTile(),n.iconBar.elements.container.getElement(".select-on").addClassName("selected")}}]}}},{fonticon:"view-list",className:"switch-view table-view",handler:function(e,n){t.switchDashboardView(e,n)}}]}).inject(r),n.activeViewToolTip=new o({position:"top",target:n.iconBar.elements.container.getElement(".switch-view"),body:u.tableView}),i.addContent(r)},switchDashboardView:function(e,t){var n,a=t.elements.container;a.hasClassName("tile-view")?(a.addClassName("table-view"),a.removeClassName("tile-view"),a.getElement("span").className="fonticon fonticon-view-list table-icon",this.elements.activeViewToolTip.setBody(u.tableView),n=l.TILE_VIEW):(a.addClassName("tile-view"),a.removeClassName("table-view"),a.getElement("span").className="fonticon fonticon-view-small-tile tile-icon",this.elements.activeViewToolTip.setBody(u.tileView),n=l.TABLE_VIEW),h._selectedView=n,h.createManageDashboardView({categoryToSelect:h._selectCategory}),c.toggleActionBarIcon()},onSortSelection:function(e){var t=e.target||e.srcElement,n=t.getAttribute("data-sort"),a=this.elements.iconBar.getItem("sort").elements.icon;if(n){d.toggleSelection(t);var i={ordering:{field:d.sortList[n].field,direction:d.sortList[n].asc?"asc":"desc"}};i.accessRights=h.filters.accessRights,i.type=h.filters.type,i.search=h.filters.search,h.tableViewSort.direction=i.ordering.direction,h.tableViewSort.field=i.ordering.field,h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:i}),a.className=d.getClassNamesBySort(n)}},_buildSearchAction:function(){var t=this,n=t.elements;n.searchMainCtn&&n.searchMainCtn.destroy(),n.searchMainCtn=e.createElement("div",{class:"search-main-container"}),n.searchAction=e.createElement("div",{class:"search-view-container",html:[{tag:"span",class:"search-view-action search-view-apply fonticon fonticon-2x fonticon-search pull-right",events:{click:function(){n.searchInput.focus()}}},{tag:"span",class:"search-view-action search-view-cancel fonticon fonticon-2x fonticon-cancel-squared pull-right",events:{click:function(){t.onClearSearch()}}}]}),n.searchInput=new i({placeholder:u.searchDashboardsAndCockpits,className:"search-input",events:{onKeyDown:function(){setTimeout(function(){n.searchAction.toggleClassName("active",!!n.searchInput.getValue()),t.onSearchChange()})}}}).inject(n.searchAction,"top"),n.searchAction.inject(n.searchMainCtn,"top")},updateSortIcon:function(e){var t=e.field.toLowerCase().indexOf("date")>-1?"fonticon fonticon-date-sorting-":"fonticon fonticon-alpha-sorting-",n=this.elements.iconBar.elements.container.getElement(".sort-db > span");e&&e.direction?e.field.toLowerCase().indexOf("date")>-1?"asc"===e.direction?t+="1-31":t+="31-1":"asc"===e.direction?t+="a-z":t+="z-a":t+="a-z",n.className=t},onClearSearch:function(){var e=this.elements;e.searchInput.setValue(""),e.searchAction.toggleClassName("active",!!e.searchInput.getValue()),e.searchInput.focus(),this.onSearchChange()},onFilterSelected:function(e){var t,n,a=this,i=e;t=i.getSelectedItems().filter(function(e){var t=a.filterValue!==e.name;return t||i.toggleSelection(e),t}).map(function(e){return e}),a.container.getElement(".filter-db").toggleClassName("active",!!t.length),(n=t[0])&&n.name!==a.filterValue?(a.filterValue=n.name,a.onFilterChange(n)):(a.filterValue="",a.onFilterChange(n))},onFilterChange:function(e){var t;(t=e&&e.className.indexOf("type")>-1?{type:e?e.name:void 0,accessRights:void 0}:{accessRights:e?e.name:void 0,type:void 0}).search=h.filters.search,t.ordering=h.sort,h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:t})},onSearchChange:function(){return r.debounce(function(){var e={search:this.elements.searchInput.getValue().trim()};e.accessRights=h.filters.accessRights,e.type=h.filters.type,e.ordering=h.sort,h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:e}),c.toggleActionBarIcon()},300)}(),_getAppliedFilters:function(){var e={};return e.accessRights=h.filters.accessRights,e.type=h.filters.type,e.search=h.filters.search,e.ordering=h.sort,e},addAsFavorite:function(){var e=this,t=c._selectedDashboards;s.addFavorites(t).then(function(){h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:e._getAppliedFilters()})})},removeFromFavorites:function(){var e=this,t=c._selectedDashboards;s.removeFavorites(t).then(function(){h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:e._getAppliedFilters()})})},deleteDashboards:function(){var e=this,t=c._selectedDashboards;h._selectCategory===l.RECYCLE_BIN_PANEL?s.deleteTrashDashboards(t).then(function(t){t||h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:e._getAppliedFilters()})}):s.deleteDashboards(t).then(function(t){t.shouldContinue&&h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:e._getAppliedFilters()})})},restoreDashboards:function(){var e=this,t=c._selectedDashboards;return s.unTrashContexts({modelIds:t}).then(function(){h.createManageDashboardView({categoryToSelect:h._selectCategory,searchFilter:e._getAppliedFilters()})})}})}),define("DS/Dashboard/Environment",["module","UWA/Core","UWA/String","UWA/Event","UWA/Element","UWA/Storage","UWA/Utils/Client","UWA/Environment","DS/Logger/Logger","DS/PubSub/PubSub","DS/UWPClientCode/I18n","DS/UWPClientCode/UWA/Widget","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/DebugMe","DS/UWPClientControls/Utils","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/UIKIT/Form","DS/UIKIT/Alert","DS/Dashboard/PublicAPI","DS/Dashboard/Utils","DS/Dashboard/DashboardManager","DS/Dashboard/DraggableManager","DS/Dashboard/CompassManager","DS/Dashboard/Views/PlatformInfoTooltipView","DS/Dashboard/WidgetLinkManager","DS/Dashboard/Views/WidgetLinkModeView","DS/Dashboard/Navigation","DS/Dashboard/DDMenu/WidgetMenu","DS/Dashboard/Views/SearchInWidget","DS/Dashboard/Search","DS/Dashboard/UsageTracker","DS/Dashboard/Modals/SWAQRCode","i18n!DS/Dashboard/assets/nls/environment","DS/UWPClientCode/UWA/Embedded"],function(module,UWA,UWAString,UWAEvent,Element,Storage,Client,Environment,Logger,PubSub,i18n,Widget,Data,DebugMe,WPControlsUtils,SuperModal,Tooltip,Button,Form,Alert,DAPI,DUtils,DManager,DraggableManager,CompassManager,PlatformInfoTooltipView,WidgetLinkManager,WidgetLinkModeView,DNav,WidgetDDMenu,SearchInWidgetView,DSearch,UsageTracker,SWAQRCodeModal,Nls){"use strict";var log=Logger.getLogger(module),exports,ICON_PATH=DUtils.buildPath(dsBaseUrl,"resources",dsVersion,dsLang,"webapps/UWPClientCode/assets"),ICON_PATH_TEMPLATE=DUtils.buildPath(ICON_PATH,"${PLACEHOLDER}-widget-icon@2X.png"),ICON_DRAG=DUtils.buildPath(ICON_PATH,"default-drag.png"),BRAND_PLACEHOLDER="${PLACEHOLDER}",FULLSCREEN_CLASS="ifwe-fullscreen",MODULE_BORDER_CLASS="moduleBorder",FOCUSED_CLASS="ifwe-focused",HIGHLIGHTED_CLASS="ifwe-highlighted",LINKED_HIGHLIGHTED_CLASS=[HIGHLIGHTED_CLASS,"blue-highlight"].join(" "),LINKABLE_HIGHLIGHTED_CLASS=[HIGHLIGHTED_CLASS,"gray-highlight"].join(" "),CLICKABLE_CLASS="clickable",DISABLED_CLASS="disabled",HAS_OVERFLOW_CLASS="has-overflow",ICONS={"3DEXCITE":ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DEXCITE"),"3DSWYM":ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DSWYM"),"3DVIA":ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DVIA"),BIOVIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"BIOVIA"),CATIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"CATIA"),CENTRICPLM:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DVIA"),DELMIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"DELMIA"),ENOVIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"ENOVIA"),EXALEAD:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"EXALEAD"),GEOVIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"GEOVIA"),MEDIDATA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"MEDIDATA"),NETVIBES:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"NETVIBES"),SIMULIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"SIMULIA"),SOLIDWORKS:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"SOLIDWORKS")};function getParentCardContext(e){var t=e;for(e=e.wp.parent;e&&!e.wp.isCard;)t=e,e=e.wp.parent;return{card:e,children:t}}function isContributorActiveContext(){return DAPI._isContributorContext(DAPI._getActiveContext())}function isOwnerActiveContext(){return DAPI._isOwnerContext(DAPI._getActiveContext())}function forceRepaint(e){e.style.display="none",e.offsetHeight,e.style.display=""}var whichTransitionEvent=function(){var e,t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(void 0!==document.body.style[e])return t[e]}(),reloadWidgetCb;exports=Environment.extend({name:"dashboard",maximizedContainer:"wp-maximize-container",serviceName:"",focusLocked:!1,init:function(e){this.components={};var t,n,a,i,o,r=e.data;if(this.html={},this.Features={},this.view={},this.options={defaultView:{type:"windowed"},initialView:e.initialView},this.serviceName=DAPI._getServiceName(),this.wp=UWA.merge({},e),this.wp._isNew=e._isNew,this.wp._edit=!!e.isEditable,this.wp._preventsEdit=r.wpData&&void 0!==r.wpData.editable?!r.wpData.editable:void 0,this.wp.isEditable=!1,this.wp.isBulky=!1,this.wp.isPlatformInfoIconShown=!1,this.wp.isLinkedWidgetIconShown=!1,this.wp.isFilteredIconShown=!1,this.wp.isLinked=!1,this.wp.isLinkable=!1,this.wp.isVisible=!0,this.wp.preview=e.preview,this.wp.originalTitle=this.wp.title,this.wp.customTitle="",this.wp.hasFocus=!1,this.wp.isFiltered=!1,this.wp.checksum=e.checksum,(t=this.wp.parent)&&t.wp)n=t.isEditable(),a=this.isContainer()&&this.wp._edit,i=t.wp._edit&&t.widget.data&&t.widget.data.wpData&&!1===t.widget.data.wpData.editable,o=!this.wp._preventsEdit&&(n||a||i||!this.wp.children&&isContributorActiveContext());else if(t&&!t.wp){if(o=!1,t.destroyed)return void this.destroy()}else o=!0;this.wp.isEditable=o,e.metas&&(this.wp.author=e.metas.author||"",this.wp.version=e.metas.version||"",this.wp.header="false"!==e.metas.header,this.wp.border="false"!==e.metas.border,this.wp.brand=e.metas.brand?e.metas.brand:"",this.wp.thumbnail=e.metas.thumbnail||ICON_DRAG,this.wp.noSearchInWidgetUI=!!e.metas.noSearchInWidgetUI||!1),r.wpData&&(this.wp.header=r.wpData.header||this.wp.header,this.wp.border=r.wpData.border||this.wp.border,this.wp.styles=r.wpData.styles,this.wp.classes=r.wpData.classes,this.wp.title=r.wpData.title||this.wp.title,this.wp.hidden=r.wpData.hidden||!1),this.html.module=e.el,this.wp.hasPreferences=e.preferences&&e.preferences.length>0&&e.preferences.some(function(e){return"hidden"!==e.type}),this.updatePlatformInfoIconDebounced=WPControlsUtils.debounce(this.updatePlatformInfoIcon.bind(this),300),this.buildSkeleton(),this.setBulky(this.wp.warnings&&this.wp.warnings.data),this.dispatchInit()},buildSkeleton:function(){var e="ifwe-action-icon",t="div",n=this,a=UWA.createElement,i=n.html,o=n.components,r=n.wp,s=DUtils.buildPath(ICON_PATH,"default-widget-icon.png"),d=WPControlsUtils.hasTouch();i.module.hasClassName("module")||(i.module=a(t,{class:"module"}).inject(i.module)),i.module.setAttribute("id","m_"+r.id),i.module.addClassName("wi-"+r.id),i.wrapper=a(t,{class:"moduleWrapper"}).inject(i.module),r.header&&(i.header=a(t,{class:"moduleHeader"}).inject(i.wrapper,"top"),i.headerLeft=a(t,{class:"moduleHeader__left"}).inject(i.header),i.headerMiddle=a(t,{class:"moduleHeader__middle"}).inject(i.header),i.headerRight=a(t,{class:"moduleHeader__right"}).inject(i.header).hide(),i.title=a(t,{class:"moduleHeader__title"}).inject(i.headerMiddle),i.icon=a(t,{class:"moduleHeader__icon-ctn",html:'<img class="moduleHeader__icon" src="'+s+'" width="16px" height="16px" />'}).inject(i.headerLeft),i.icon.getElement("img").addEventListener("dragstart",function(e){e.preventDefault()}),i.header.addEventListener("dragenter",function(){n.isMinimized()&&n.toggleMinimize()})),n.isContainer()?(i.body=i.wrapper,i.module.addClassName("moduleLayout"),i.wrapper.addClassName("clearfix")):(i.module.addClassName("leaf-widget"),i.body=a(t,{class:"moduleContent w-"+r.widgetId}).inject(i.wrapper),r.header&&(i.searchCtn=a(t,{class:"moduleHeader__search"}).inject(i.headerMiddle),i.rightActions=a(t,{class:"moduleHeader__right-actions"}).inject(i.headerMiddle),i.stateFiltered=a("span",{class:["filtered-badge",e].join(" "),html:{tag:"span",class:"filter-icon fonticon fonticon-filter"}}).inject(i.rightActions).hide(),i.stateUntrusted=UWA.createElement("span",{class:["untrusted-state-icon",e,"fonticon fonticon-lock-open"].join(" ")}).inject(i.rightActions).hide(),o.untrustedTooltip=new Tooltip({position:"bottom",target:i.stateUntrusted,body:Nls.untrusted,offset:{x:0,y:0}}),i.stateBulky=UWA.createElement("span",{class:["bulky-state-icon","warn",e,"fonticon fonticon-attention"].join(" ")}).inject(i.rightActions).hide(),o.toolipBulky=new Tooltip({position:"bottom",target:i.stateBulky,body:Nls.bulky,offset:{x:0,y:0}}),i.actionPlatformInfo=a("span",{class:["platform-info-icon",e,"fonticon"].join(" ")}).inject(i.rightActions).hide(),i.actionLinkedWidget=a("span",{class:["widget-link-icon",e,"fonticon fonticon-link"].join(" "),events:!d&&{mouseover:n._highlightLinkedWidgets.bind(n),mouseleave:n._unhighlightLinkedWidgets.bind(n)}}).inject(i.rightActions).hide(),i.actionMinimize=a("span",{class:["minimize-icon",e,"fonticon fonticon-minus",CLICKABLE_CLASS].join(" ")}).inject(i.rightActions),o.tooltipMinimize=new Tooltip({position:"bottom",target:i.actionMinimize,body:Nls.minimizeIcon,offset:{x:0,y:0}}),i.actionFullscreen=a("span",{class:["fullscreen-icon",e,"fonticon fonticon-resize-fullscreen",CLICKABLE_CLASS,DNav.isBELayoutEditorMode()?"hide":""].join(" ")}).inject(i.rightActions),o.tooltipFullscreen=new Tooltip({position:"bottom",target:i.actionFullscreen,body:Nls.fullscreen,offset:{x:0,y:0}}),i.ddMenuHandler=a("span",{class:["widget-menu-icon",e,"fonticon fonticon-down-open",CLICKABLE_CLASS].join(" ")}).inject(i.headerRight),o.menuToolip=new Tooltip({position:"bottom",target:i.ddMenuHandler,body:Nls.menuIcon,offset:{x:0,y:0},closeOnClick:!0}),i.headerRight.show(),n.createMenu()),i.wrapper.addClassName("front"),n.isEditable()&&(i.module.addClassName("moduleEditable"),i.edit=a(t,{class:"moduleEdit "}).inject(i.module),i.edit.addClassName("back"))),n.updateSkeleton()},getWidget:function(){var e=this.widget||new Widget;return!this.widget&&this.registerWidget(e),e},destroy:function(){var e,t,n=this.html,a=this.widget,i=this.embedded;for(e in this._removePubSubEvents(),a&&(a.dispatchEvent("onDestroy"),PubSub.dispatch(DAPI.events.widget.destroy,[a]),this.getChildren().forEach(function(e){var t=e.widget;t&&t.environment&&t.environment.destroy()}),UWA.Widgets.instances.splice(UWA.Widgets.instances.indexOf(a),1),a.destroy(),this.widget=null,!this.isContainer()&&this._updateNeighborsLinkabilityStatus()),Object.keys(this.components||{}).forEach(function(e){"function"==typeof e.destroy&&e.destroy(),delete this.components[e]},this),this.components=null,this.embedded&&this.embedded.elements.iframe.removeEventListener("load",this._iframeLoadEventCallback),this.clearDelayed(),this.clearPeriodical(),n)n.hasOwnProperty(e)&&n[e].destroy();for(t in this.view)this.view.hasOwnProperty(t)&&this.view[t]&&this.view[t].destroy();this.removeEvent(),i&&(!function(){var e,t,n;if(i.socket&&(e=UWA.Embedded.Servers["uwa.embedded"])&&(n=i.socket.id.replace("master","slave"),t=e.sockets[n]))try{t.source.contentDocument||delete e.sockets[n]}catch(e){}}(),i.destroy(this.wp.id)),window.CollectGarbage&&window.CollectGarbage(),this.destroyed=!0,this.embedded=null,this.registered=!1,this.data=null,this.wp=null,this.options=null},loadWidget:function(e,t){var n,a,i=this;if(!i.destroyed)return t=UWA.extend({data:{},onFailure:function(e){throw e},onTimeout:function(e){throw e},onComplete:function(){}},t),i.wp.isolationLevel?(i.loadEmbeddedWidget(i.wp.widgetId||e,t),(n=i.embedded)&&(a=i.widget,n.addEvent("onLoad",function(){n.launched=!0,i.launched=!0}),n.addEvent("onRegisterWidget",function(){n.launched=!1,i.launched=!1}),n.addEvent("onPatchData",i.patchData.bind(i)),n.addEvent("onUpdateMenu",i.onUpdateMenu.bind(i)),n.addEvent("onUpdateMetas",i.onUpdateMetas.bind(i)),a.addEvent("onContextChange",n.sendRemote.bind(n,"onContextChange")),a.addEvent("onDeconnect",n.sendRemote.bind(n,"onDeconnect")),a.addEvent("onReconnect",n.sendRemote.bind(n,"onReconnect")),i._iframeLoadEventCallback=function(){i.html.module.dispatchEvent(new Event("loaded",{bubbles:!1,cancelable:!0}))},n.elements.iframe.addEventListener("load",i._iframeLoadEventCallback)),i.dispatchEvent("onRegisterWidget")):(i.loadInlinedWidget(i.wp.preview?i.wp.widgetId:e,t),i.launched=!0,i.addEvent("onPatchData",i.patchData.bind(i)),i.html.module.dispatchEvent(new Event("loaded",{bubbles:!1,cancelable:!0}))),i},loadEmbeddedWidget:function(e,t){var n,a,i=this,o=i.getWidget();if(o.id=this.wp.id,o.thumbnail=this.wp.thumbnail,t.cache=this.wp.checksum+"-"+window.dsVersion,n={id:this.wp.id,appId:this.wp.appId,token:this.wp.token,lang:i18n.getCurrentLanguage(),displayEdit:!1,exposition:2===this.wp.isolationLevel?UWA.hosts.untrustedExposition:UWA.hosts.exposition,debugMe:UWA.debug?1:null},t.embedded=UWA.extend(t.embedded||{},n),this._parent(e,t),a=this.embedded.elements.iframe,2===this.wp.isolationLevel&&UWA.hosts.untrustedExposition!==UWA.hosts.exposition){var r=DAPI._getGlobalPlatformId();if(r){var s=new URL(a.src);s.searchParams.set("_gpid",r),a.src=s.toString()}}return Element.setAttributes.call(a,{width:"",height:"",scrolling:"auto"}),Element.setStyles.call(a,{width:"0",height:"0",minWidth:"100%",minHeight:"100%"}),[this,this.embedded].forEach(function(e){e.addEvent("onRegisterWidget",function(){e.registeredHack&&!i.mutated?(e._dispatchers.onRegisterWidget.halt(),e.embedded||t.onComplete(o,i,{data:i.getAllData()})):e.registeredHack=!0},e,1)}),this.html.body.setStyle("padding",""),this},loadInlinedWidget:function(url,options){var widget=this.getWidget(),json=options.fetcher,script=json.script;return widget.id=this.wp.id,widget.thumbnail=this.wp.thumbnail,json.title=this.wp.title,widget.setStyle(json.style),json.script=function(widget){eval(script)},delete options.fetcher.style,this._parent(url,options)},onRegisterWidget:function(){var e=this,t=e.html,n=e.widget;if(!e.registered){if(e.data=new Storage({adapter:"Object",database:"preference"+e.wp.id}),n.lang=i18n.getCurrentLanguage(),n.readOnly=!e.isEditable(),!e.isContainer()){if(t.header){var a,i,o=function(n){t.rightActions&&t.rightActions.contains(n.target)||t.headerRight&&t.headerRight.contains(n.target)||e.isMaximized()||e.isFullscreen()||e.focusLocked||DManager.isWidgetsLinksModeEnabled()||e.updateFocus({focus:!e.hasFocus()})},r=function(t){var n=UWAEvent.getElement(t);n&&!function e(t,n,a){if(!t)return!0;var i=t.parentElement;return!t.hasClassName(n)&&(!!a.some(function(e){return t.hasClassName(e)})||e(i,n,a))}(n,"moduleHeader",["moduleHeader__search","moduleHeader__right"])&&function(t){UWAEvent.stop(t),e.toggleMaximize()}.call(e,t)};if(WPControlsUtils.hasTouch())WPControlsUtils.addEvent(t.header,"click",function(e){var t=(new Date).getTime()-a;if(a&&t<500&&t>0)return clearTimeout(i),a=void 0,i=void 0,void r(e);a=(new Date).getTime(),i||(i=setTimeout(function(){a=void 0,i=void 0,o(e)},500))});else WPControlsUtils.addEvent(t.header,"dblclick",r),WPControlsUtils.addEvent(t.header,"click",o);Element.addEvent.call(t.actionFullscreen,"click",function(t){UWAEvent.stop(t),e.components.tooltipFullscreen.hide(),e.toggleFullscreen()}),Element.addEvent.call(t.actionMinimize,"click",function(t){UWAEvent.stop(t),e.components.tooltipMinimize.hide(),e.toggleMinimize()}),Element.addEvent.call(t.actionPlatformInfo,"click",function(t){var n=e.components.tooltipPlatformInfo;UWAEvent.stop(t),WPControlsUtils.hasTouch()&&n&&!n.isVisible()?n.show():e._onPlatformInfoClick()}),Element.addEvent.call(t.actionLinkedWidget,"click",function(n){UWAEvent.stop(n);var a=e.components.tooltipLinkedWidget,i=DManager.isWidgetsLinksModeEnabled();if(WPControlsUtils.hasTouch()){if(a&&!a.isVisible)return a.show(),void e._highlightLinkedWidgets();a.hide(),i||e._unhighlightLinkedWidgets()}!i&&t.actionLinkedWidget.hasClassName(CLICKABLE_CLASS)&&e.toggleWidgetsLinksMode()}),e.addEvent("onViewChange",e.updatePlatformInfoIcon.bind(e))}Element.handleExternalLinks.call(t.wrapper,function(t,n){e.dispatchEvent("onOpenURL",[t,n])})}Element.addEvent.call(t.body,"update",function(){e.dispatchEvent("onUpdateBody")}),Element.addEvent.call(t.wrapper,"resize",function(){e.dispatchEvent("onResize")}),e.dispatchEvent("onResize"),e.dispatchEvent("onViewRequest",[e.options.initialView])}},afterLoad:function(){var e=this,t=e.wp.parent,n=e.getEmbeddedIframe(),a=getParentCardContext(this)||{},i=e.widget,o=e.isContainer();e._addPubSubEvents(),PubSub.dispatch(DAPI.events.environment._widgetInstanceReady,[i]),t&&t.wp.shouldPropagateHide&&e.setVisible(!1),t&&t.wp.shouldPropagateSearch&&e._onReadyForSearchEvent(),!e.isFullscreen()&&a.card&&DNav.getUrlParameter(DNav.parts.fullscreen)===e.wp.id?e.toggleFullscreen():!e.isMaximized()&&a.card&&DAPI._getTabProperty(t.wp.id,"lastMaximizedWidgetId")===e.wp.id?e.toggleMaximize():!e.isMinimized()&&a.card&&e.wp.id in(DAPI._getTabProperty(t.wp.id,"minimizedWidgetIds")||{})&&e.toggleMinimize(),n&&WPControlsUtils.addEvent(n,"keydown",function(t){(Client.Platform.macintel&&"meta+shift+f"===UWAEvent.whichKey(t)||"shift+f11"===UWAEvent.whichKey(t))&&(UWAEvent.stop(t),e.toggleFullscreen())}),t&&WPControlsUtils.addEvents(n||e.html.body,{dragstart:DraggableManager.initCrossTabDrag,dragover:function(e){DraggableManager.detectCrossTabDrag(e,{pointer:{left:e.pageX,top:e.pageY}},{native:!0})},dragend:DraggableManager.cleanupCrossTabDrag,drop:DraggableManager.cleanupCrossTabDrag,mousedown:DraggableManager._setMouseState.bind(null,"down"),touchstart:DraggableManager._setMouseState.bind(null,"down"),mouseup:DraggableManager._setMouseState.bind(null,"up"),touchend:DraggableManager._setMouseState.bind(null,"up")},9999,!0),o||(e._updateNeighborsLinkabilityStatus(),DManager.isWidgetsLinksModeEnabled()&&e._enableWidgetsLinksMode()),e.sendContextChange()},_initOriginalTitleLegacy:function(e){var t=this.wp;if(t.originalTitle){var n=this.getBrand();if(n&&UWA.String.test(t.originalTitle,n+" - ")){var a=t.originalTitle.split(n+" - ");a.length>1&&(t.originalTitle=a[1].trim())}}else t.originalTitle=e||""},isEnvLaunched:function(){var e=this.embedded;return e?e.launched:this.launched},getBrand:function(){var e=this.wp;return e&&e.brand||""},getName:function(){var e=this.wp;return e&&(e.originalTitle||e.name)||""},getAppId:function(){var e=this.wp;return e?e.appId:void 0},getTitle:function(){var e=this.wp;return e?this.isContainer()?e.name||e.title||"":e.title||this.getComputedWidgetTitle():""},getCustomTitle:function(){var e=this.wp;return e&&(e.customTitle||this.getData("title"))||""},_computeWidgetTitle:function(e){var t=[],n=(e=e||{}).hideBrand,a=e.hideAppName,i=e.hideCustomTitle,o=(e.brand||"").trim(),r=(e.appName||"").trim(),s=(e.customTitle||"").trim();return s===r&&(i=!0),n||t.push(o),a||t.push(r),i||t.push(s),t.filter(function(e){return e}).join(" - ")},getComputedWidgetTitle:function(e){var t=this.getAppId(),n=[CompassManager.appIds.globViewer,CompassManager.appIds.mail,CompassManager.appIds.mediaLinks,CompassManager.appIds.quickLinks,CompassManager.appIds.webNotes,CompassManager.appIds.webPageReader,CompassManager.appIds.x3DPlay,CompassManager.appIds.x3DSearch],a=!1;if(t&&n.includes(t)){var i=this.getData("x3dTitleShowAppName");a="boolean"==typeof i&&!i}return this._computeWidgetTitle(Object.assign({brand:this.getBrand(),appName:this.getName(),customTitle:this.getCustomTitle(),hideAppName:a},e))},onUpdateTitle:function(e){var t,n=this.wp,a=this.html,i={customTitle:e};this.isContainer()||(this.isEnvLaunched()||(this._initOriginalTitleLegacy(e),e=this.getCustomTitle(),delete i.customTitle),n.customTitle=e,t=this.getComputedWidgetTitle(i),n.title=t,a.title&&a.title.setText(t))},onUpdateValue:function(e){var t=this.widget;["appId","x3dSharedId","x3dLinkability"].includes(e)&&PubSub.dispatch(DAPI.events.environment._tentativeChangeLinkability,[t]),["x3dPlatformId","xPref_CREDENTIAL"].includes(e)&&this.updatePlatformInfoIconDebounced(),["x3dTitleShowAppName"].includes(e)&&this.onUpdateTitle(this.getCustomTitle()),this.isEditable()&&t.launched&&!t.isEdit&&this.save()},onUpdateMetas:function(e){var t,n,a=this.widget,i=this.wp,o=this.components.menu;if(a.setMetas(e),n=a.metas||{},i.brand=n.brand||this.getBrand()||"",i.noSearchInWidgetUI=!!n.noSearchInWidgetUI||!1,t=ICONS[i.brand],i.brand&&t&&a.setIcon&&a.setIcon(t),o){var r=WidgetDDMenu.SEARCH_IN_WIDGET_ITEM_ID;i.noSearchInWidgetUI?o.hideItem(r):o.showItem(r)}e._readyForSearchEvent&&this._onReadyForSearchEvent(),this.displayCustomMenuItem()},patchData:function(e){var t=this;function n(n,a){var i=e._callId;if(i){var o="success"===n?"onPatchDataSuccess-"+i:"onPatchDataFailure-"+i;t.embedded?t.embedded.sendRemote(o,i,a):t.widget.dispatchEvent(o,i,a)}}Data.patchWidgetInstanceData({id:e.widgetId,patches:e.patches,serviceName:DAPI._getServiceName(),success:function(e){t._onEditDataSuccess({response:e}),n("success",e)},failure:function(a){t._onEditDataFailure({error:a,silentAlert:e.silentErrorAlert}),n("failure",a)}})},onResize:function(){var e=this.components.menu;e&&e.hide(),this._checkHeaderMiddleOverflow()},_checkHeaderMiddleOverflow:function(){var e,t=this.html;this.isContainer()||this.isFullscreen()||(e=t.headerMiddle).toggleClassName(HAS_OVERFLOW_CLASS,e.scrollWidth>e.clientWidth)},onEdit:function(){function e(e){var t=this,n=(e=e||{}).show,a=e.dispatchRefresh,i=e.submitted;function o(){n||(t.dispatchEvent("endEdit",[{submitted:i}]),a&&t.dispatchEvent("onRefresh"))}Client.Features.transitionsCSS&&-1===window.navigator.userAgent.indexOf("Edge")?(this.transitionEndCallback=function(e){"transform"===e.propertyName&&(t.html.module.removeClassName("animate"),n&&t.html.module.removeClassName("animate"),t.html.module.removeEventListener(whichTransitionEvent,t.transitionEndCallback),o())},!n&&this.html.module.addClassName("flipping"),window.requestAnimationFrame(function(){var e=t.html.module;e.addClassName("animate"),e.addEventListener(whichTransitionEvent,t.transitionEndCallback,!1),e[n?"addClassName":"removeClassName"]("flipping"),e[n?"addClassName":"removeClassName"]("flip")})):(this.html.module[n?"addClassName":"removeClassName"]("flip"),o())}return function(){var t,n=this,a=UWA.createElement,i=this.html,o=this.getWidget(),r=o.getPreferences();if(o.isEdit||(o.isEdit=!0,e.call(this,{show:!0})),i.edit&&(i.edit.empty(),o.hasPreferences())){i.preferences&&i.preferences.destroy(),r.push({type:"submit",className:"hide"}),r.forEach(function(e){"list"===e.type&&(e.showTooltips=!UWA.is(e.showTooltips,"boolean")||e.showTooltips)}),a("h4",{class:"moduleEdit__header",text:Nls.editPreferences}).inject(i.edit),i.preferences=new Form({fields:r,events:{onChange:function(e,t,a){o.setValue(e,t),n.embedded?n.embedded.sendRemote("dispatchEvent",a,[e,t]):n.dispatchEvent(a,[e,t])},onSubmit:function(t){for(var a in t)t.hasOwnProperty(a)&&o.setValue(a,t[a]);!o.metas._preventsSaveOnEditPrefs&&n.save(),e.call(n,{dispatchRefresh:!0,submitted:!0})}}}).inject(i.edit),this.components.saveButton=new Button({className:"primary",value:Nls.save}),this.components.cancelButton=new Button({value:Nls.cancel}),t=a("div",{class:"moduleEdit__footer"}).inject(i.edit),this.components.saveButton.inject(t),this.components.cancelButton.inject(t),this.components.saveButton.addEvent("onClick",function(){this.disable(),n.components.cancelButton.disable(),i.preferences.submit()}),this.components.cancelButton.addEvent("onClick",function(){this.disable(),n.components.saveButton.disable(),n.restorePrefCache(),e.call(n,{submitted:!1})}),DebugMe.isEnabled()&&a("div",{class:"moduleInfos",html:[{tag:"p",html:[Nls.widgetInstanceId+"  ",{tag:"strong",text:o.id}]},this.wp&&this.wp.widgetId?{tag:"p",html:[Nls.widgetId+"  ",{tag:"strong",text:this.wp.widgetId}]}:"",o.metas.version?{tag:"p",html:[Nls.version+" ",{tag:"strong",text:o.metas.version}]}:""]}).inject(t),setTimeout(function(){var e=i.preferences.getFields();e&&e[0].focus()},500);var s,d=(o.metas||{})._linksDetails;if(o.metas._isLinksToDisplay&&d&&(s=i.preferences.getContent().getElement(d.target))){var l=d.links;l&&l.forEach(function(e,t){var n=s.getParent();UWA.createElement("a",{name:e.name,text:e.text,href:e.href,target:"_blank"}).inject(n,"bottom"),l.length>t+1&&n.addContent(d.delimiter)})}}this.embedded||this.dispatchEvent("onShowEdit")}}(),endEdit:function(){this.embedded||(this.dispatchEvent("onHideEdit"),this.dispatchEvent("onRefresh")),this.getWidget().isEdit=!1},onViewRequest:function(e){var t;if(e){if(!e.type&&"focus"in e)return this.updateFocus(e);if("maximized"===e.type){if((t=this.widget.environment.html.module.getParent())&&t.getElement(".module.ifwe-maximized"))return}else"minimized"===e.type&&this.updateFocus({focus:!1});this._parent(e),(Client.Platform.ios||Client.Platform.ipad)&&forceRepaint(this.widget.environment.html.body)}},updateFocus:function(e){function t(e,t){e.wp.hasFocus!==t&&(e.wp.hasFocus=t,PubSub.dispatch(t?DAPI.events.widget.focus:DAPI.events.widget.unfocus,e.widget),e.embedded?e.embedded.sendRemote("onFocus",t):e.widget.dispatchEvent("onFocus",t),e.html.module.toggleClassName(FOCUSED_CLASS,t))}var n=e.focus&&!this.isMinimized();n&&this.getParentChildren().forEach(function(e){var n=e.widget&&e.widget.environment;n&&e.id!==this.wp.id&&t(n,!1)},this),t(this,n)},restorePrefCache:function(){var e,t,n,a;if(this.editPrefsCache){for(e=0,t=this.editPrefsCache.length;e<t;e++)n=this.editPrefsCache[e],this.getWidget().setValue(n.name,n.value),"function"==typeof this[a="onUpdate"+UWAString.ucfirst(n.name)]&&this.dispatchEvent(a,n.value);delete this.editPrefsCache}},onUpdatePreferences:function(){var e=this.components.menu,t=WidgetDDMenu.PREFS_ITEM_ID;if(this.widget.launched&&this.isEditable()&&e){var n=this.widget.hasPreferences();this.updatePlatformInfoIconDebounced(),n?(e.showItem(t),this.isMinimized()&&e.disableItem(t)):e.hideItem(t)}},updateId:function(e){var t=this.getWidget(),n=this.html;this.wp.id!==e&&(this.wp._id=this.wp.id,this.wp.id=e,t.id=e),n.module.removeClassName("wi-"+this.wp._id),n.module.setAttribute("id","m_"+this.wp.id),n.module.addClassName("wi-"+this.wp.id)},displayHelp:function(){DManager.openHelpWindow({helpInfoPath:DUtils.getHelpInfoPath(this)})},toggleRefresh:function(){this.dispatchEvent("onRefresh")},toggleDuplicate:function(){var e=this.wp.parent;e&&e.isEditable()&&e.dispatchEvent("onDuplicate",this.wp.id)},toggleDelete:function(){var e=this.wp,t=e.parent;t&&t.isEditable()&&t.dispatchEvent("onRemove",e.id)},togglePreferences:function(){var e=this.widget;e&&!this.isMinimized()&&e.hasPreferences()&&!e.isEdit&&(this.editPrefsCache=UWA.clone(e.getPreferences()),this.dispatchEvent("toggleEdit"))},toggleWidgetsLinksMode:function(){this.isLinkable()&&isOwnerActiveContext()&&(DManager.isWidgetsLinksModeEnabled()?DManager.disableWidgetsLinksMode():DManager.enableWidgetsLinksMode(this.widget.id))},toggleMaximize:function(){if(!this.view.next){var e=this.isMaximized();!e&&DManager.isWidgetsLinksModeEnabled()||this.onViewRequest({type:e?"windowed":"maximized"})}},toggleFullscreen:function(){if(!this.view.next){var e=this.isFullscreen();!e&&DManager.isWidgetsLinksModeEnabled()||this.onViewRequest({type:e?"windowed":"fullscreen"})}},toggleMinimize:function(){if(!this.view.next){var e=this.isMinimized();this.onViewRequest({type:e?"windowed":"minimized"})}},isEditable:function(){return!!(this.wp||{}).isEditable},isContainer:function(){return!!(this.wp||{}).isContainer},isMaximized:function(){var e=this.view.current;return!!e&&"maximized"===e.event.type},isMinimized:function(){var e=this.view.current;return!!e&&"minimized"===e.event.type},isFullscreen:function(){var e=this.view.current;return!!e&&"fullscreen"===e.event.type},hasFocus:function(){return this.wp.hasFocus},isLinkable:function(){return this.wp.isLinkable},isLinked:function(){return this.wp.isLinked},isLinkedWith:function(e){return this.isLinked()&&WidgetLinkManager.getLinked(e).includes(this.widget.id)},isBMDummyWdg:function(){return!(!this.wp||"8p1GNod0g3W1CYDOh009"!==this.wp.widgetId)},getEmbeddedIframe:function(){if(this.embedded&&this.wp.isolationLevel<2){var e=this.embedded.elements.iframe;return e&&e.contentWindow.document}},getParent:function(){return(this.wp||{}).parent},getChildren:function(){return(this.wp||{}).children||[]},getParentChildren:function(){return(this.wp||{}).parent?this.getChildren.call(this.wp.parent):[]},updateSkeleton:function(){var e=this.wp,t=e.classes,n=this.html,a=this.isContainer(),i=this.isEditable(),o=(t||{}).border||MODULE_BORDER_CLASS;t&&(t.module&&n.module.addClassName(t.module),t.moduleWrapper&&n.wrapper.addClassName(t.moduleWrapper),a||(t.moduleContent&&n.body.addClassName(t.moduleContent),e.header&&t.moduleHeader&&n.header.addClassName(t.moduleHeader))),e.styles&&n[a?"wrapper":"body"].setStyles(e.styles),e.border?(n.wrapper.addClassName(o),!a&&i&&n.edit.addClassName(o)):!1===e.border&&n.wrapper&&(n.wrapper.removeClassName(o),!a&&i&&n.edit.removeClassName(o)),a||(n.stateUntrusted&&(2===e.isolationLevel&&i?n.stateUntrusted.show():n.stateUntrusted.hide()),this._updatePlatformInfoClickableClass(),this._updateLinkedWidgetClickableClass()),!1===e.header&&n.header&&n.header.remove()},onUpdateMenu:function(e){var t=this,n=e[0],a=t.components.menu;a&&(a.hideItem(WidgetDDMenu.EDIT_ITEM_ID),n&&"options"===n.name&&(n.items||[]).some(function(e){if(e&&"options/edit"===e.name){return a.setItemHandler(WidgetDDMenu.EDIT_ITEM_ID,function(){t.dispatchEvent("onMenuExecute",[e])}),a.showItem(WidgetDDMenu.EDIT_ITEM_ID),!0}}))},onMenuExecute:function(e){"string"==typeof e.onExecute&&(this.embedded?this.embedded.sendRemote(e.onExecute,e):this.widget.dispatchEvent(e.onExecute,e))},createMenu:function(){var e=this;function t(){e.components.menu.hide()}e.components.menu&&e.components.menu.destroy(),e.components.menu=new WidgetDDMenu({target:e.html.ddMenuHandler,renderTo:e.wp.parent.widget.body,onClick:function(t,n){var a=n.id;switch(a){case WidgetDDMenu.SEARCH_IN_WIDGET_ITEM_ID:e.showSearchInWidgetView();break;case WidgetDDMenu.PREFS_ITEM_ID:e.togglePreferences();break;case WidgetDDMenu.LINK_WITH_WIDGETS_ITEM_ID:e.toggleWidgetsLinksMode();break;case WidgetDDMenu.DUPLICATE_ITEM_ID:e.toggleDuplicate();break;case WidgetDDMenu.DELETE_ITEM_ID:e.toggleDelete();break;case WidgetDDMenu.ENTER_MAXIMIZE_ITEM_ID:case WidgetDDMenu.LEAVE_MAXIMIZE_ITEM_ID:e.toggleMaximize();break;case WidgetDDMenu.SHARE_ITEM_ID:DManager.shareWidget(e.widget);break;case WidgetDDMenu.REFRESH_ITEM_ID:e.toggleRefresh();break;case WidgetDDMenu.HELP_ITEM_ID:e.displayHelp();break;case WidgetDDMenu.SHOW_SWA_QRCODE_ITEM_ID:e.showSWAQRCodeModal();break;case WidgetDDMenu.OPEN_SWA_ITEM_ID:e.openSWA()}UsageTracker.track({category:"widget.menu",action:a})},onShow:function(){DAPI.fetchHelpInfo(DUtils.getHelpInfoPath(e));var n=e.getEmbeddedIframe();n&&n.addEventListener("click",t),e._manageSWAMenuItems()},onHide:function(){var n=e.getEmbeddedIframe();n&&n.removeEventListener("click",t)}}),e.setMenuItems()},setMenuItems:function(){var e,t=WidgetDDMenu.SEARCH_IN_WIDGET_ITEM_ID,n=WidgetDDMenu.PREFS_ITEM_ID,a=WidgetDDMenu.LINK_WITH_WIDGETS_ITEM_ID,i=WidgetDDMenu.SHARE_ITEM_ID,o=WidgetDDMenu.DUPLICATE_ITEM_ID,r=WidgetDDMenu.REFRESH_ITEM_ID,s=WidgetDDMenu.ENTER_MAXIMIZE_ITEM_ID,d=WidgetDDMenu.LEAVE_MAXIMIZE_ITEM_ID,l=WidgetDDMenu.DELETE_ITEM_ID,c=WidgetDDMenu.HELP_ITEM_ID,u=this.wp,h=isContributorActiveContext(),m=DManager.isWidgetsLinksModeEnabled(),g=this.components.menu,f=[],p=[];f=[r,c],u.noSearchInWidgetUI?p.push(t):f.push(t),this.isMaximized()?(f.push(d),p.push(s)):(f.push(s),p.push(d)),u.isEditable&&(e=[i,o,l],h?p=p.concat(e):f=f.concat(e),isOwnerActiveContext()&&this.isLinkable()?f.push(a):p.push(a),this.widget&&this.widget.hasPreferences()?f.push(n):p.push(n)),g.showItems(f),g.hideItems(p),m&&g.setAllItemsDisabled(),DNav.isBELayoutEditorMode()&&(g.removeItems([i,a]),this.isBMDummyWdg()&&g.keepItems([s,d]))},displayCustomMenuItem:function(){var e,t,n=this,a=n.components.menu,i=n.widget.metas||{},o=i._customItem;a&&o&&n.isEditable()&&!isContributorActiveContext()&&(i._isCustomItemToDisplay?(t=o.event,e={id:o.id,name:o.name,text:o.text,icon:o.icon,fonticon:o.fonticon,className:o.className,title:o.title,hide:o.hide,disabled:o.disabled,handler:function(){n.widget.dispatchEvent(t)}},n.addMenuItem(e,o.position),!n.widget.hasEvent(t)&&n.embedded&&n.widget.addEvent(t,n.embedded.sendRemote.bind(n.embedded,t))):a.removeItem(o.id||o.name))},addMenuItem:function(e,t){var n=this.components.menu;n&&e&&n.addItem({id:e.id,name:e.name,text:e.text,icon:e.icon,fonticon:e.fonticon,className:e.className,title:e.title,hide:e.hide,disabled:e.disabled,handler:e.handler},t)},save:function(){var e=this;this._save||(this._save=WPControlsUtils.debounce(function(){e.destroyed||Data.editWidgetInstance({serviceName:DAPI._getServiceName(),id:e.wp.id,data:e.getAllData(),success:function(t){var n=e.widget;e._onEditDataSuccess({response:t}),delete e.editPrefsCache,n.metas._dispatchOnSetValueCallbacks&&(e.embedded?e.embedded.sendRemote("onSetValueSuccess",t):n.dispatchEvent("onSetValueSuccess",t))},failure:function(t){var n=e.widget;e._onEditDataFailure({error:t}),e.restorePrefCache(),n.metas._dispatchOnSetValueCallbacks&&(e.embedded?e.embedded.sendRemote("onSetValueFailure",t):n.dispatchEvent("onSetValueFailure",t))}})},300)),this._save()},setVisible:function(e,t){var n=this.getWidget(),a=e?"onShow":"onHide";(this.wp.isVisible!==e||t)&&(this.wp.isVisible=!!e,this.embedded?this.embedded.sendRemote(a):n.dispatchEvent(a))},setEditable:function(e){this.isEditable()!==e&&(this.wp.isEditable=!!e)},setBulky:function(e){var t=this.wp,n=this.html;if(t.isBulky=!!e,!this.isContainer()&&n.stateBulky){var a=WidgetDDMenu.SHARE_ITEM_ID,i=this.components.menu;t.isBulky&&this.isEditable()?(n.stateBulky.show(),i&&i.disableItem(a)):(n.stateBulky.hide(),i&&i.enableItem(a))}},setFiltered:function(e){var t=e.from,n=!e.clear,a=this.widget,i=!!a._isFilteredByTagger,o=!!a._isFilteredBySearchInTab,r=!!a._isFilteredBySearchInWidget;t===DSearch.from.tagger?a._isFilteredByTagger=n:t===DSearch.from.tab?a._isFilteredBySearchInTab=n:t===DSearch.from.widget&&(a._isFilteredBySearchInWidget=n),this.wp.isFiltered=!!(a._isFilteredByTagger||a._isFilteredBySearchInTab||a._isFilteredBySearchInWidget),i===!!a._isFilteredByTagger&&o===!!a._isFilteredBySearchInTab&&r===!!a._isFilteredBySearchInWidget||this._updateFilteredIcon()},removeWidget:function(e){var t,n=this,a=n.wp.id,i=n.widget;function o(e){return new Promise(function(t,n){Data.removeWidgetInstance({serviceName:DAPI._getServiceName(),id:e,success:t,failure:n})})}function r(){var t=n.wp.parent&&n.wp.parent.wp.children;if(t)for(var i=t.length-1;i>=0;i--)if(t[i].id===a){t.splice(i,1);break}n.destroy(),e&&e()}return i?(PubSub.dispatch(DAPI.events.widget.remove,[i]),t=n.isMaximized()?new Promise(function(e,t){n.addEventOnce("onViewChange",function(){o(a).then(r).then(e).catch(t)}),n.onViewRequest({type:"windowed",animate:!1})}):o(a).then(r)):t=o(a).then(r),t},mutate:(reloadWidgetCb=function(e){var t,n=this.getWidget(),a=this.html,i=this.wp,o=i.widgetId;i.widgetId=e.id,i.isContainer=e.isContainer,i.title=e.title||"",i.originalTitle=i.title,i.name=i.title,i.appId=null,i.token=null,e.metas&&(i.header="false"!==e.metas.header,i.border="false"!==e.metas.border,i.author=e.metas.author||"",i.version=e.metas.version||"",i.brand=e.metas.brand?e.metas.brand:"",i.thumbnail=e.metas.thumbnail||ICON_DRAG),e.wpData&&(t=e.wpData,i.header=UWA.is(t.header)?t.header:i.header,i.border=UWA.is(t.border)?t.border:i.border,i.styles=t.styles,i.classes=t.classes,i.title=t.title,i.hidden=t.hidden),i.hasPreferences=e.preferences&&e.preferences.length>0&&e.preferences.some(function(e){return"hidden"!==e.type}),this.createMenu(),a.module.removeClassName("wi-"+o),a.module.addClassName("wi-"+i.widgetId),a.body&&(a.body.removeClassName("w-"+o),a.body.addClassName("w-"+i.widgetId)),this.wp.isolationLevel=e.isolationLevel,this.mutated=!0,this.updateSkeleton(),n.removeEvent(),n.clearDelayed(),n.clearPeriodical(),this.loadWidget(i.id+i.widgetId,{fetcher:e,onComplete:function(e,t){t.launchWidget()}}),Data.editWidgetInstance({serviceName:DAPI._getServiceName(),id:n.id,name:i.title,title:i.title})},function(e,t){var n=this,a=this.getWidget();e&&(this.wp.preview?Data.getWidget({serviceName:DAPI._getServiceName(),id:e,success:reloadWidgetCb.bind(n)}):Data.editWidgetInstance({serviceName:DAPI._getServiceName(),success:function(e){!1!==e.success&&Data.getWidget({serviceName:DAPI._getServiceName(),id:e.widgetId,success:reloadWidgetCb.bind(n)})},failure:function(e,n){var i,o,r="";try{var s=JSON.parse(n);i=s&&s.errorCode?s.errorCode:null,o=s&&s.errorMessage?s.errorMessage:null}catch(e){}switch(i){case"WIDGET_PARSING_ERROR":log.warn("Failed to parse widget "+a.id+": "+(o||n)),r=Nls.widgetParsingError;break;case"ENTITY_NOT_FOUND":log.warn("Failed to load widget "+a.id+": "+(o||n));default:r=Nls.widgetLoadingError}t.failureCb&&t.failureCb(r)},id:a.id,data:t||{},widgetId:e}))}),sendContextChange:function(){var e=getParentCardContext(this);e=e.children.wp.id,this.widget.context=e,this.dispatchEvent("onContextChange",e)},propagateSearch:function(e){var t=(e=e||{}).from,n=e.tabId,a=e.widgetId,i=this.wp,o=this.widget,r=o&&o.id,s=this.isContainer();!i||!o||t!==DSearch.from.widget&&t!==DSearch.from.tab||s&&t===DSearch.from.tab&&n!==r||!s&&t===DSearch.from.widget&&a!==r||(s?(n===r&&(i.shouldPropagateSearch=!0,i.shouldPropagateSearchArg=e,this._applySearch(e)),this.getChildren().forEach(function(t){t.widget&&t.widget.environment.propagateSearch(e)})):(a===r&&(i.shouldPropagateSearch=!0,i.shouldPropagateSearchArg=e),this._applySearch(e)))},propagateWidgetsLinksMode:function(e){var t,n=this.wp,a=this.widget;n&&(a&&(t=a.environment,e?t._enableWidgetsLinksMode():t._disableWidgetsLinksMode()),this.isContainer()&&this.getChildren().forEach(function(t){t.widget&&t.widget.environment.propagateWidgetsLinksMode(e)}))},propagateConnectionStatus:function(e){var t=this.wp,n=this.widget;t&&n&&!this.isContainer()&&("up"===e?n.dispatchEvent("onReconnect"):"down"===e&&n.dispatchEvent("onDeconnect"))},updatePlatformInfoIcon:function(){var e=this.widget,t=this.html;if(e&&t&&t.actionPlatformInfo&&!this.isContainer())if(DAPI._shouldShowWidgetPlatformInfo(e)){var n,a=this.components,i=t.actionPlatformInfo,o=a.tooltipPlatformInfo,r=DAPI._getGlobalPlatformId(),s=e.getValue("x3dPlatformId"),d=e.getValue("xPref_CREDENTIAL"),l=this.isFullscreen();d||s!==r||l?(n={target:i,platformId:s,xPrefCredential:d,disabled:!this._isPlatformInfoClickable(),onClick:this._onPlatformInfoClick.bind(this)},o?o.update(n):a.tooltipPlatformInfo=new PlatformInfoTooltipView(n),l&&PubSub.dispatch(DAPI.events.widget.updatePlatformInfoFullscreenWidget,{widgetId:this.widget.id,show:!0}),this._updatePlatformInfoFonticon(),i.show(),this.wp.isPlatformInfoIconShown=!0,this.updateSkeleton()):this._hidePlatformInfoIcon()}else this._hidePlatformInfoIcon()},_hidePlatformInfoIcon:function(){var e=this.html.actionPlatformInfo;if(e){var t=this.components,n=t.tooltipPlatformInfo;n&&n.destroy(),delete t.tooltipPlatformInfo,this.isFullscreen()&&PubSub.dispatch(DAPI.events.widget.updatePlatformInfoFullscreenWidget,{widgetId:this.widget.id,hide:!0}),e.hide(),this.wp.isPlatformInfoIconShown=!1,this.updateSkeleton()}},_updatePlatformInfoFonticon:function(){var e=this;return DAPI.getPlatforms().then(function(t){e.html.actionPlatformInfo.removeClassName("fonticon-cloud-alt").removeClassName("fonticon-user-key").addClassName(t.length>1?"fonticon-cloud-alt":"fonticon-user-key")})},_isPlatformInfoClickable:function(){var e=this.widget;return!(!e||!e.hasPreferences()||this.isMinimized())},_updatePlatformInfoClickableClass:function(){var e=this.html.actionPlatformInfo;e&&this.wp.isPlatformInfoIconShown&&e.toggleClassName(CLICKABLE_CLASS,this._isPlatformInfoClickable())},_onPlatformInfoClick:function(){this._isPlatformInfoClickable()&&(this.components.tooltipPlatformInfo.hide(),this.togglePreferences())},updateLinkedWidgetIcon:function(){var e,t,n=this.components,a=this.html.actionLinkedWidget;!this.isContainer()&&a&&(this.isLinked()?(n.tooltipLinkedWidget&&n.tooltipLinkedWidget.destroy(),e=WidgetLinkManager.getLinked(this.widget.id),t=1===(t=(e=this.getParentChildren().filter(function(t){return e.includes(t.id)})).map(function(e){return e.widget.environment.getName()})).length?t[0]:t.join(", "),n.tooltipLinkedWidget=new Tooltip({className:"linked-with-tooltip",position:"bottom",target:a,body:i18n.replace(Nls.linkWithWidgetTooltip,{name:t}),offset:{x:0,y:0},events:{onHide:this._unhighlightLinkedWidgets.bind(this)}}),a.show(),this.wp.isLinkedWidgetIconShown=!0,this._updateLinkedWidgetClickableClass()):this._hideLinkedWidgetIcon())},_hideLinkedWidgetIcon:function(){var e=this.html.actionLinkedWidget;e&&(e.hide(),this.wp.isLinkedWidgetIconShown=!1)},_updateLinkedWidgetClickableClass:function(){var e=this.html.actionLinkedWidget;if(e&&this.wp.isLinkedWidgetIconShown){var t=DManager.isWidgetsLinksModeEnabled(),n=!t&&isOwnerActiveContext();e.toggleClassName(CLICKABLE_CLASS,n).toggleClassName(DISABLED_CLASS,t)}},_updateLinkabilityStatus:function(){var e=this.widget,t=this.wp;if(e&&t){var n,a=WidgetDDMenu.LINK_WITH_WIDGETS_ITEM_ID,i=e.id,o=this.components.menu,r=this.isLinkable(),s=WidgetLinkManager.getLinkable(i),d=!1,l=!1,c=!1;s.length>0?(t.isLinkable=l=!0,n=WidgetLinkManager.getLinked(i),t.isLinked=c=n.length>0,isOwnerActiveContext()&&o.showItem(a)):(t.isLinkable=!1,t.isLinked=!1,o.hideItem(a)),r!==t.isLinkable&&(d=!0),this.updateLinkedWidgetIcon(),d&&(t._isNew&&l&&!c&&this._showLinkableWithAlert(s),this.dispatchEvent("onChangeLinkability"))}},_highlightLinkedWidgets:function(){this.isLinked()&&!DManager.isWidgetsLinksModeEnabled()&&this._getLinkedWidgets().concat([this.widget]).forEach(function(e){var t=e.environment,n=t.html.module;t.hasFocus()&&n.removeClassName(FOCUSED_CLASS),n.addClassName(LINKED_HIGHLIGHTED_CLASS)})},_unhighlightLinkedWidgets:function(){this.isLinked()&&!DManager.isWidgetsLinksModeEnabled()&&this._getLinkedWidgets().concat([this.widget]).forEach(function(e){var t=e.environment,n=t.html.module;t.hasFocus()&&n.addClassName(FOCUSED_CLASS),n.removeClassName(LINKED_HIGHLIGHTED_CLASS)})},_getLinkedWidgets:function(){if(!this.isLinked())return[];var e=WidgetLinkManager.getLinked(this.widget.id);return this.getParentChildren().filter(function(t){return t.widget&&e.includes(t.id)}).map(function(e){return e.widget})},_isNeighborWidget:function(e){return!!this.getParentChildren().find(function(t){return t.widget&&t.widget.id===e})},_enableWidgetsLinksMode:function(){var e,t,n=this.html,a=n.module,i=this.widget.id,o=this.components,r=!1,s=!1;this.isContainer()||((e=(t=DManager.getWidgetsLinksModeOriginWidgetId())===i)||!(r=!!this.isLinked()&&this.isLinkedWith(t))&&this.isLinkable()&&(s=WidgetLinkManager.getLinkable(t).includes(i)),this.isFullscreen()&&this.toggleFullscreen(),this.isMaximized()&&this.toggleMaximize(),this.isMinimized()&&s&&this.toggleMinimize(),a.removeClassName(FOCUSED_CLASS),a.addClassName("widgets-links-mode-enabled"),[n.actionFullscreen].forEach(function(e){e.removeClassName(CLICKABLE_CLASS).addClassName(DISABLED_CLASS)}),this._updateLinkedWidgetClickableClass(),this._destroyLinkableWithAlert(),o.menu.setAllItemsDisabled(),r&&!e?a.addClassName(LINKED_HIGHLIGHTED_CLASS):e?a.removeClassName(LINKED_HIGHLIGHTED_CLASS):s&&a.addClassName(LINKABLE_HIGHLIGHTED_CLASS),o.widgetLinkModeView&&o.widgetLinkModeView.destroy(),o.widgetLinkModeView=new WidgetLinkModeView({widgetId:i,isOrigin:e,isLinked:r,isLinkable:s,onLinked:function(){a.removeClassName(LINKABLE_HIGHLIGHTED_CLASS),a.addClassName(LINKED_HIGHLIGHTED_CLASS)},onUnlinked:function(){a.removeClassName(LINKED_HIGHLIGHTED_CLASS),a.addClassName(LINKABLE_HIGHLIGHTED_CLASS)}}).render().inject(n.wrapper))},_disableWidgetsLinksMode:function(){var e=this.html,t=e.module,n=this.components;this.isContainer()||([LINKABLE_HIGHLIGHTED_CLASS,LINKED_HIGHLIGHTED_CLASS,"widgets-links-mode-enabled"].forEach(function(e){t.removeClassName(e)}),[e.actionFullscreen].forEach(function(e){e.removeClassName(DISABLED_CLASS).addClassName(CLICKABLE_CLASS)}),this._updateLinkedWidgetClickableClass(),n.menu.unsetAllItemsDisabled(),this.hasFocus()&&t.addClassName(FOCUSED_CLASS),n.widgetLinkModeView&&n.widgetLinkModeView.destroy(),delete n.widgetLinkModeView)},_updateNeighborsLinkabilityStatus:function(){var e=(this.wp||{}).parent;e&&(e._updateWidgetsLinkabilityStatusDebounced||(e._updateWidgetsLinkabilityStatusDebounced=WPControlsUtils.debounce(function(){e.getChildren().forEach(function(e){var t=(e.widget||{}).environment;t&&t._updateLinkabilityStatus()})},300)),e._updateWidgetsLinkabilityStatusDebounced())},_showLinkableWithAlert:function(e){var t,n,a,i,o=this,r=o.widget,s=r.id,d=r.elements;if((e=e||WidgetLinkManager.getLinkable(s)).length){if(t=o.getName(),e.length>1)n=i18n.replace(Nls.linkableWithWidgetsAlert,{nameOrigin:t});else{var l=e[0];if(!(i=o.getParentChildren().find(function(e){return e.id===l})))return;a=i.title,n=i18n.replace(Nls.linkableWithWidgetAlert,{nameOrigin:t,name:a})}o._destroyLinkableWithAlert(),(d.alertLinkable=new Alert({className:"linkable-widget-alert",visible:!0,fullWidth:!1,autoHide:!0,hideDelay:8e3,closeOnClick:!0,events:{onClick:function(t){if(!t.target.hasClassName("close"))if(e.length>1)o.toggleWidgetsLinksMode();else{var n={};n[i.id]=!0,WidgetLinkManager.setLinked(s,n)}},onRemoveMessage:o._destroyLinkableWithAlert.bind(o)}}).inject(d.body,"top")).add({className:"info",message:n})}},_destroyLinkableWithAlert:function(){var e=this.widget.elements,t=e.alertLinkable;t&&(t.destroy(),delete e.alertLinkable)},_showSwitchTabLinkedWidgetAlert:function(){var e=this.components;function t(){e.alertSwitchTabLinked&&e.alertSwitchTabLinked.destroy(),delete e.alertSwitchTabLinked}t(),(e.alertSwitchTabLinked=new Alert({className:"switch-tab-linked-widget-alert",visible:!0,fullWidth:!1,autoHide:!0,hideDelay:5e3,closeOnClick:!0,events:{onRemoveMessage:t}}).inject(document.body,"top")).add({className:"warning",message:Nls.switchTabLinkedWidgetAlert})},_onEditDataSuccess:function(e){var t=(e=e||{}).response||{};this.isContainer()||this.setBulky(t.warnings&&t.warnings.data,!0)},_onEditDataFailure:function(e){e=e||{};var t,n=this.widget.elements;e.silentAlert||((t=n.alertError)&&(t.destroy(),delete n.alertError),(t=n.alertError=new Alert({visible:!0,fullWidth:!0,autoHide:!0,hideDelay:8e3}).inject(n.body,"top")).add({className:"error",message:DUtils.getViolationMessageFromError(e.error)||Nls.editWidgetFail}))},_addPubSubEvents:function(){var e=this,t=e.widget.id;e._removePubSubEvents(),e.isContainer()?(e._onSwitchTab=function(n,a){var i=n.environment,o=a.newTab.id;o===t&&(i.createMenu(),DSearch.getSearchInTabOverlayView()&&i._closeSearchInWidget(),i._onReadyForSearchEvent()),[(a.previousTab||{}).id,o].includes(t)&&e._updateWidgetsLinkabilityStatusDebounced&&e._updateWidgetsLinkabilityStatusDebounced()},PubSub.add(DAPI.events.widget.switchTab,e._onSwitchTab),e._onShowSearchInTabOverlayView=function(n){t===n&&e.getChildren().forEach(function(e){e.widget&&e.widget.environment._closeSearchInWidget()})},PubSub.add(DAPI.events.tab.showSearchIn,e._onShowSearchInTabOverlayView),e._onCloseSearchInTabOverlayView=function(n){t===n&&(e.wp.shouldPropagateSearch=!1,e.wp.shouldPropagateSearchArg=null)},PubSub.add(DAPI.events.tab.closeSearchIn,e._onCloseSearchInTabOverlayView)):(e._onChangeLinkability=function(t){e._isNeighborWidget(t.source)&&e._updateLinkabilityStatus()},PubSub.add(DAPI.events.widget._changeLinkability,e._onChangeLinkability),e._onLinked=function(n){[n.source,n.target].includes(t)&&(e._updateLinkabilityStatus(),e._destroyLinkableWithAlert())},PubSub.add(DAPI.events.widget._link,e._onLinked),e._onUnlinked=function(n){var a=[n.source,n.target];a.includes(t)&&e._updateLinkabilityStatus(),a[0]===t&&"relocation"===n.cause&&e._showSwitchTabLinkedWidgetAlert()},PubSub.add(DAPI.events.widget._unlink,e._onUnlinked))},_removePubSubEvents:function(){this._onChangeLinkability&&PubSub.remove(DAPI.events.widget._changeLinkability,this._onChangeLinkability),this._onLinked&&PubSub.remove(DAPI.events.widget._link,this._onLinked),this._onUnlinked&&PubSub.remove(DAPI.events.widget._unlink,this._onUnlinked),this._onSwitchTab&&PubSub.remove(DAPI.events.widget.switchTab,this._onSwitchTab),this._onShowSearchInTabOverlayView&&PubSub.remove(DAPI.events.tab.showSearchIn,this._onShowSearchInTabOverlayView),this._onCloseSearchInTabOverlayView&&PubSub.remove(DAPI.events.tab.closeSearchIn,this._onCloseSearchInTabOverlayView)},showSearchInWidgetView:function(e){e=e||{};var t,n=this,a=n.html,i=a.searchInWidgetView;if(t=("boolean"==typeof e.isFullscreen?e.isFullscreen:n.isFullscreen())?a.wrapper:a.searchCtn,i){if(i.isVisible())return void(e.updateDOMLocation?(t.appendChild(i.container),n._checkHeaderMiddleOverflow()):i.focus());a.searchInWidgetView.destroy()}a.searchInWidgetView=i=new SearchInWidgetView({targetId:n.widget.id,from:DSearch.from.widget,trackerType:"widget",events:{onShow:function(){a.module.addClassName("search-in-widget-displayed"),n.isFullscreen()&&a.searchInWidgetView.setValue(DSearch.getSearchInTabValue()),DSearch.closeSearchInTabOverlayView()},onHide:function(){a.module.removeClassName("search-in-widget-displayed"),n._checkHeaderMiddleOverflow()},onClose:function(){n.wp.shouldPropagateSearch=!1,n.wp.shouldPropagateSearchArg=null}}}),i.render().inject(t).show(),n._checkHeaderMiddleOverflow(),"string"==typeof e.value&&i.setValue(e.value)},_applySearch:function(e){var t=this.widget,n=e.query;t&&(this.setFiltered({from:e.from,clear:e.clear}),this.isContainer()||(n?t.dispatchEvent("onSearch",n):t.dispatchEvent("onResetSearch")))},_onReadyForSearchEvent:function(){var e,t,n=this,a=n.wp,i=n.widget,o=(a||{}).parent,r=(o||{}).wp,s={};a&&i&&o&&r&&!i._isSwitchingTab&&((t=!(!i._isFilteredBySearchInTab&&!i._isFilteredBySearchInWidget))&&(i._isFilteredBySearchInTab&&(s[DSearch.from.tab]={from:DSearch.from.tab,tabId:o.widget.id,clear:!0}),i._isFilteredBySearchInWidget&&(s[DSearch.from.widget]={from:DSearch.from.widget,widgetId:i.id,clear:!0})),r.shouldPropagateSearch?(e=r.shouldPropagateSearchArg).clear&&!t||(s[e.from]=e):a.shouldPropagateSearch&&((e=a.shouldPropagateSearchArg).clear&&!t||(s[e.from]=e)),Object.keys(s).length&&Object.values(s).sort(function(e,t){return e.clear&&!t.clear?-1:!e.clear&&t.clear?1:0}).forEach(function(e){n.propagateSearch(e)}))},_updateFilteredIcon:function(){var e=this.wp,t=this.widget,n=this.html,a=this.components,i="";t&&n.stateFiltered&&(e.isFiltered&&(!t._isFilteredBySearchInWidget||t._isFilteredByTagger||t._isFilteredBySearchInTab)?(t._isFilteredBySearchInTab&&t._isFilteredByTagger?i=Nls.contentFilteredByTagsAndSearch:t._isFilteredBySearchInTab?i=Nls.contentFilteredBySearch:t._isFilteredByTagger&&(i=Nls.contentFilteredByTags),i&&(a.filteredTooltip&&a.filteredTooltip.destroy(),a.filteredTooltip=new Tooltip({position:"bottom",target:n.stateFiltered,body:i||Nls.filtered,offset:{x:0,y:0}})),n.stateFiltered.show(),this.wp.isFilteredIconShown=!0,this.isFullscreen()&&PubSub.dispatch(DAPI.events.widget.updateFilteredIconFullscreenWidget,{widgetId:t.id,show:!0,tooltip:i})):this._hideFilteredIcon())},_hideFilteredIcon:function(){var e=this.html,t=this.components;t.filteredTooltip&&t.filteredTooltip.destroy(),delete t.filteredTooltip,e.stateFiltered.hide(),this.wp.isFilteredIconShown=!1,this.isFullscreen()&&PubSub.dispatch(DAPI.events.widget.updateFilteredIconFullscreenWidget,{widgetId:this.widget.id,hide:!0})},_getSearchInWidgetView:function(){var e=this.html.searchInWidgetView;return e&&e.isVisible()&&e},_closeSearchInWidget:function(e){var t=this._getSearchInWidgetView();t&&t.close(e)},showSWAQRCodeModal:function(){var e=this.wp;SWAQRCodeModal.show({appId:this.getAppId()||CompassManager.appIds.runYourApp,widgetId:e.id,widgetName:this.getName()})},openSWA:function(){var e=DNav.buildSWAUrl({appId:this.getAppId()||CompassManager.appIds.runYourApp,widgetId:this.wp.id});window.open(e,"_blank")},_manageSWAMenuItems:function(){var e=this;return e.getAppId()===CompassManager.appIds.x3DSearch?Promise.resolve():DAPI.isSWAFeatureEnabled().then(function(t){if(t){var n=e.components.menu,a=WidgetDDMenu.SHOW_SWA_QRCODE_ITEM_ID,i=WidgetDDMenu.OPEN_SWA_ITEM_ID,o=[WPControlsUtils.hasTouch()?i:a];n.showItems(o)}})}});var fade=(outTimeouts=[],inTimeouts=[],function(e,t){var n=t.id;inTimeouts[n]&&clearTimeout(inTimeouts[n])&&delete inTimeouts[n],outTimeouts[n]&&clearTimeout(outTimeouts[n])&&delete inTimeouts[n],"out"===e?(t.setStyles({opacity:1,transition:"opacity 0.2s ease-in"}),outTimeouts[n]=setTimeout(function(){t.setStyle("opacity",0),delete outTimeouts[n]},0)):(t.setStyle("opacity",1),inTimeouts[n]=setTimeout(function(){t.style.opacity="",t.setStyles({transition:""}),delete inTimeouts[n]},450))}),outTimeouts,inTimeouts;return exports.prototype.views.windowed.prototype.onEnter=function(){PubSub.dispatch("onViewChange",{type:"windowed",id:this.environment.wp.id})},exports.prototype.views.windowed.prototype.onLeave=function(){},exports._modalFactory=new SuperModal,exports.prototype.views.maximized=Environment.AbstractView.extend({getTarget:function(){return this.container||this.environment.html.module.getParent()},getWidgets:function(){var e=this.getTarget();if(e)return this.widgets||(this.widgets=e.getElements(".module")),this.widgets},getHolder:function(e){return(e=e||this.getTarget())&&e.getParent(".wp-tabview-panel")},resize:function(){var e=this.getTarget(),t=this.getHolder(e);t&&(this.height=t.getSize().height,e.setStyle("height",this.height),this.event.height=this.height-44-11)},isSingle:function(){return!1},onEnter:function(){PubSub.dispatch("onViewChange",{type:"maximized",id:this.environment.wp.id})},onLeave:function(){PubSub.dispatch("onViewChange",{type:"windowed",id:this.environment.wp.id})},enter:function(){var e=this.getWidgets(),t=this.getTarget(),n=!1!==this.event.animate,a=this.environment,i=a.html,o=a.components.menu;t&&(this.resizefn=this.resize.bind(this),WPControlsUtils.addEvent(window,"resize",this.resizefn),this.resize(),t.setStyle("position","relative"),a.embedded&&a.embedded.resizeHeight(this.height),e.forEach(function(e){e!==i.module&&!e.hasClassName("ifwe-maximized")&&fade("out",e)}),i.module.toggleClassName("ifwe-maximized"),n&&i.module.toggleClassName("ifwe-maximized-animated"),i.header&&(o.hideItem(WidgetDDMenu.ENTER_MAXIMIZE_ITEM_ID),o.showItem(WidgetDDMenu.LEAVE_MAXIMIZE_ITEM_ID),o.disableItem(WidgetDDMenu.DUPLICATE_ITEM_ID)),i.wrapper.removeClassName(MODULE_BORDER_CLASS),a.wp.border=!1,this.dispatchEvent("onEnter"))},leave:function(){var e=this,t=e.getWidgets(),n=e.getTarget(),a=!1!==e.event.animate,i=e.environment,o=i.html,r=i.components.menu;WPControlsUtils.removeEvent(window,"resize",e.resizefn),t.forEach(function(e){e!==o.module&&fade("in",e)}),o.module.toggleClassName("ifwe-maximized"),o.header&&(r.hideItem(WidgetDDMenu.LEAVE_MAXIMIZE_ITEM_ID),r.showItem(WidgetDDMenu.ENTER_MAXIMIZE_ITEM_ID),r.enableItem(WidgetDDMenu.DUPLICATE_ITEM_ID)),setTimeout(function(){var t=e.environment,i=t&&t.wp;a&&o.module.toggleClassName("ifwe-maximized-animated"),n.setStyles({position:""}),t&&i&&!t.isMaximized()&&!t.isFullscreen()&&"dock"!==i.parent.widget.getValue("layout").master&&n.setStyle("height","")},400),o.wrapper.addClassName(MODULE_BORDER_CLASS),i.wp.border=!0,e.dispatchEvent("onLeave")}}),exports.prototype.views.fullscreen=Environment.AbstractView.extend({getTarget:function(){return this.container||this.environment.html.module.getParent()},getWidgets:function(){var e=this.getTarget();if(e)return this.widgets||(this.widgets=e.getElements(".module")),this.widgets},resize:function(){var e=this.getTarget(),t=e.getParent(".wp-tabview-panel");this.height=t.getSize().height,e.setStyle("height",this.height),this.event.height=this.height-44-11},escapeHandler:function(e){(Client.Platform.macintel&&"meta+shift+f"===UWAEvent.whichKey(e)||"shift+f11"===UWAEvent.whichKey(e))&&this.leave()},getDocuments:function(e){var t=e.embedded,n=[document];return t&&e.wp.isolationLevel<2&&n.push(t.elements.iframe.contentWindow.document),n},isSingle:function(){return!1},onEnter:function(){var e=this.environment.wp.id;DNav.routeTo({keepAll:!0,fullscreen:e}),PubSub.dispatch("onViewChange",{type:"fullscreen",id:e})},onLeave:function(){DNav.routeTo({keepAll:!0,discards:DNav.parts.fullscreen}),PubSub.dispatch("onViewChange",{type:"windowed",id:this.environment.wp.id})},enter:function(){var e=this,t=e.getWidgets(),n=e.getTarget(),a=!1!==e.event.animate,i=e.environment,o=i.html,r=e.getDocuments(i),s=i._getSearchInWidgetView(),d=DSearch.getSearchInTabOverlayView();if(n){if(e.resizefn=e.resize.bind(e),WPControlsUtils.addEvent(window,"resize",e.resizefn),e.resize(),n.setStyle("position","relative"),i.embedded&&i.embedded.resizeHeight(e.height),t.forEach(function(e){e!==o.module&&fade("out",e)}),o.module.toggleClassName(FULLSCREEN_CLASS),a&&o.module.toggleClassName("ifwe-fullscreen-animated"),o.body.toggleClassName("ifwe-fullscreen-space-optimized"),o.wrapper.removeClassName(MODULE_BORDER_CLASS),i.wp.border=!1,o.edit&&o.edit.toggleClassName("ifwe-fullscreen-preferences"),d&&!d.hasLastSearch()){var l=d.getValue();l&&i.showSearchInWidgetView({isFullscreen:!0,value:l}),d.close({silent:!0})}s&&i.showSearchInWidgetView({isFullscreen:!0,updateDOMLocation:!0}),e.onFullscreen=function(){var t=e.environment;document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||!t.isFullscreen()||t.toggleFullscreen()},e.escapeHandlerFn=e.escapeHandler.bind(e),r.forEach(function(t){t&&WPControlsUtils.addEvent(t,"keydown",e.escapeHandlerFn)}),e.dispatchEvent("onEnter")}},leave:function(){var e=this,t=e.getWidgets(),n=e.getTarget(),a=!1!==e.event.animate,i=e.environment,o=i.html,r=e.getDocuments(i);WPControlsUtils.removeEvent(window,"resize",e.resizefn),t.forEach(function(e){e!==o.module&&fade("in",e)}),o.module.toggleClassName(FULLSCREEN_CLASS),o.body.toggleClassName("ifwe-fullscreen-space-optimized"),o.edit&&o.edit.toggleClassName("ifwe-fullscreen-preferences"),i._getSearchInWidgetView()&&i.showSearchInWidgetView({isFullscreen:!1,updateDOMLocation:!0}),setTimeout(function(){a&&o.module.toggleClassName("ifwe-fullscreen-animated"),n.setStyles({position:""}),e.environment.isMaximized()||e.environment.isFullscreen()||"dock"===e.environment.wp.parent.widget.getValue("layout").master||n.setStyle("height","")},400),i.wp.border=!0,o.wrapper.addClassName(MODULE_BORDER_CLASS),r.forEach(function(t){t&&WPControlsUtils.removeEvent(t,"keydown",e.escapeHandlerFn)}),e.dispatchEvent("onLeave")}}),exports.prototype.views.minimized=Environment.AbstractView.extend({getTarget:function(){return this.environment.html.wrapper},resize:function(){this.height=44,this.getTarget().setStyle("height",this.height)},isSingle:function(){return!1},onEnter:function(){PubSub.dispatch("onViewChange",{type:"minimized",id:this.environment.wp.id})},onLeave:function(){PubSub.dispatch("onViewChange",{type:"windowed",id:this.environment.wp.id})},enter:function(){var e,t,n,a=this,i=a.getTarget(),o=a.environment,r=o.html;i&&(e=r.module,n=(t=o.components).menu,this.event.height=0,setTimeout(function(){o.isMinimized()&&(a.resize(),e.addClassName("minimized"))},300),o.embedded&&o.embedded.resizeHeight(0),r.header&&(r.actionMinimize.addClassName("active"),t.tooltipMinimize.setBody(Nls.restoreTooltip),n.disableItems([WidgetDDMenu.SEARCH_IN_WIDGET_ITEM_ID,WidgetDDMenu.PREFS_ITEM_ID,WidgetDDMenu.REFRESH_ITEM_ID]),o._closeSearchInWidget()),a.dispatchEvent("onEnter"))},leave:function(){var e=this.getTarget(),t=this.environment,n=t.html,a=n.module,i=t.components,o=i.menu;n.header&&(n.actionMinimize.removeClassName("active"),i.tooltipMinimize.setBody(Nls.minimizeIcon),o.enableItems([WidgetDDMenu.SEARCH_IN_WIDGET_ITEM_ID,WidgetDDMenu.PREFS_ITEM_ID,WidgetDDMenu.REFRESH_ITEM_ID])),e.setStyle("height",""),a.removeClassName("minimized"),this.dispatchEvent("onLeave")}}),exports.serviceName=DAPI._getServiceName(),exports.setFocusLock=function(e){exports.prototype.focusLocked=e},exports}),define("DS/Dashboard/ManageDashboard/Views/MainView",["UWA/Core","UWA/Class/View","DS/Dashboard/ManageDashboard/Events","DS/Dashboard/DashboardManager","DS/Dashboard/PublicAPI","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o){"use strict";var r,s,d="myFavorites",l="all",c="recycleBinDashboards",u="active",h="my-favorites",m="my-dashboards",g="recycle-bin-dashboards";return(r=t.extend({tagName:"div",className:"dashboard-top-panel",elements:{},selectedCategory:null,setup:function(e){e=e||{},this.selectedCategory=e.selectedCategory,this._loadDeps().then(function(e){s=e})},render:function(){return this.buildTopPanel(),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)},buildTopPanel:function(){var t=this,n=t.elements,a=t.container,i=screen.width<768;function r(e){var n=t.elements.topPanel.getElement("."+h),a=t.elements.topPanel.getElement("."+m),i=t.elements.topPanel.getElement("."+g),o=e.currentTarget;o.hasClassName(u)||(o.hasClassName(h)&&!n.hasClassName(u)?(n.addClassName(u),a.removeClassName(u),i.removeClassName(u),t.setActiveCategory(d),t.selectActiveCategory(d)):o.hasClassName(m)&&!a.hasClassName(u)?(n.removeClassName(u),i.removeClassName(u),a.addClassName(u),t.setActiveCategory(l),t.selectActiveCategory(l)):(a.removeClassName(u),n.removeClassName(u),i.addClassName(u),t.setActiveCategory(c),t.selectActiveCategory(c)))}n.topPanel=e.createElement("nav",{class:"tab "+(i?"tab-icons":""),html:[{tag:"a",class:"tab-item "+m+(t.selectedCategory===l?" "+u:""),html:[{tag:"span",class:"fonticon fonticon-chart-map-tree"+(i?" fonticon-2x":"")},{tag:"span",class:"all-db-title title",text:o.allDashboards},{tab:"div",class:"alldashboard drop-zone hide",html:[{tag:"p",class:"drop-text",text:o.dropDashboardText}]}],events:{click:function(e){r(e)}}},{tag:"a",class:"tab-item "+h+(t.selectedCategory===d?" "+u:""),html:[{tag:"span",class:"fonticon fonticon-favorite-on"+(i?" fonticon-2x":"")},{tag:"span",class:"my-fav-title title",text:o.myFavorites},{tab:"div",class:"myfavorites drop-zone hide",html:[{tag:"p",class:"drop-text",text:o.dropDashboardText}]}],events:{click:function(e){r(e)}}},{tag:"a",class:"tab-item "+g+(t.selectedCategory===c?" "+u:""),html:[{tag:"span",class:"fonticon fonticon-recycle"+(i?" fonticon-2x":"")},{tag:"span",class:"trash-title title",text:o.recycleBinItem},{tab:"div",class:"recyclebin drop-zone hide",html:[{tag:"p",class:"drop-text",text:o.dropDashboardText}]}],events:{click:function(e){r(e)}}}]}),n.topPanel.childNodes.forEach(function(e){e.className.includes("business-exp-ins-contexts")||(e.addEventListener("dragenter",t.onDragEnter.bind(t)),e.addEventListener("dragleave",t.onDragLeave.bind(t)),e.addEventListener("drop",t.onDrop.bind(t)),e.addEventListener("dragover",t.onDragOver))}),a.addContent(n.topPanel)},selectActiveCategory:function(e){this.createSkeletonView(e),s.toggleControlState(n.TOP_PANEL)},setActiveCategory:function(e){this.selectedCategory=e,s.selectedCategory=e},getActiveCategory:function(){return this.selectedCategory},addRemoveDropCss:function(e,t){var n=e.getElement(".drop-zone");e.classList[t?"add":"remove"]("drop"),n[(t?"remove":"add")+"ClassName"]("hide")},onDragEnter:function(e){var t=e.currentTarget;t.className.includes("business-exp-ins-contexts")||this.addRemoveDropCss(t,!0)},onDragLeave:function(e){var t=e.currentTarget;t.className.includes("business-exp-ins-contexts")||this.addRemoveDropCss(t,!1)},onDrop:function(e){e.preventDefault();var t,o=JSON.parse(e.dataTransfer.getData("text/plain")),r=e.currentTarget.getElement(".title").textContent.replace(/\s/g,"").toLowerCase(),c=d.toLowerCase(),u=l.toLowerCase(),h="recycleBin".toLowerCase(),m=o.draggedFrom;if(this.addRemoveDropCss(e.currentTarget,!1),!r.includes(m))if(t=o.selectedDashboards,r.includes(h))a.deleteDashboards(t).then(function(e){e.shouldContinue&&s.createManageDashboardView({categoryToSelect:s._selectCategory,from:n.TOP_PANEL})});else if(r.includes(c)){if(u.includes(m)){var g=i._getFavoriteContextModelIds().length;a.addFavorites(t,g+1).then(function(){s.createManageDashboardView({categoryToSelect:s._selectCategory,from:n.TOP_PANEL})})}if(m.includes(h))return a.unTrashContexts({modelIds:t}).then(function(){s.createManageDashboardView({categoryToSelect:s._selectCategory,from:n.TOP_PANEL})}).then(function(){a.addFavorites(t).then(function(){s.createManageDashboardView({categoryToSelect:s._selectCategory,from:n.TOP_PANEL})})})}else if(m.includes(c)&&a.removeFavorites(t).then(function(){s.createManageDashboardView({categoryToSelect:s._selectCategory,from:n.TOP_PANEL})}),m.includes(h))return a.unTrashContexts({modelIds:t}).then(function(){s.createManageDashboardView({categoryToSelect:s._selectCategory,from:n.TOP_PANEL})})},onDragOver:function(e){e.preventDefault()},_loadDeps:function(){return new Promise(function(e,t){require(["DS/Dashboard/ManageDashboard/Controller/ManageDashboard"],function(t){e(t)},t)})},createSkeletonView:function(e){s.filters={},s.sort={},s.createManageDashboardView({categoryToSelect:e,from:n.TOP_PANEL}),s.clearSearchAndFilterView()}})).MY_FAVORITES_PANEL=d,r.ALL_DASHBOARD_PANEL=l,r.RECYCLE_BIN_PANEL=c,r.BUSINESS_EXP_INS_PANEL="businessexperiencesinstances",r}),define("DS/Dashboard/ManageDashboard/Actions/DashboardActions",["UWA/Core","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/UsageTracker","DS/Dashboard/Models/Member","DS/Dashboard/DashboardManager","DS/Dashboard/ManageDashboard/Events","DS/Dashboard/ManageDashboard/Views/MainView","DS/Dashboard/ManageDashboard/Controller/ManageDashboard","DS/Logger/Logger","DS/UIKIT/SuperModal","DS/W3DXComponents/Collections/ActionsCollection","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m){var g={dashboardActions:function(){var e=[],n=t._isEndUserCockpitContext(this.get("modelId"));return(d.selectedCategory||"").toLowerCase()===s.ALL_DASHBOARD_PANEL.toLowerCase()&&n?(e=i.isOwnerRole(this.getRole())?[{id:"gotodb",title:h.gotoAction,icon:"login",context:!0,overflow:!1},{id:"renamedb",title:h.editAction,icon:"pencil",context:!0,overflow:!1},{id:"deletedb",title:h.deleteAction,icon:"trash",context:!0,overflow:!1}]:[{id:"gotodb",title:h.gotoAction,icon:"login",context:!0,overflow:!1},{id:"duplicatedb",title:h.duplicateAction,icon:"docs",context:!0,overflow:!1}],t._isFavouriteContext(this.get("modelId"))?e.unshift({id:"removeFavorites",title:h.removeFromFavorite,icon:"favorite-delete",context:!0,overflow:!1}):e.unshift({id:"addFavorite",title:h.addAsFavorite,icon:"favorite-add",context:!0,overflow:!1}),new u(e)):d.selectedCategory&&d.selectedCategory.toLowerCase()===s.RECYCLE_BIN_PANEL.toLowerCase()?(i.isOwnerRole(this.getRole())&&(e=[{id:"gotodbTrash",title:n?h.gotoCockpitActionManageDB:h.gotoDashboardActionManageDB,icon:"login",context:!0,overflow:!1},{id:"untrash",title:h.unTrashAction,icon:"undo",context:!0,overflow:!1},{id:"deletedbTrash",title:h.deletePermanentlyAction,icon:"trash",context:!0,overflow:!1}]),new u(e)):(e=this.get("owner")?[{id:"gotodb",title:h.gotoAction,icon:"login",context:!0,overflow:!1},{id:"sharedb",title:h.shareAction,icon:"forward",context:!0,overflow:!1},{id:"renamedb",title:h.editAction,icon:"pencil",context:!0,overflow:!1},{id:"duplicatedb",title:h.duplicateAction,icon:"docs",context:!0,overflow:!1},{id:"deletedb",title:h.deleteAction,icon:"trash",context:!0,overflow:!1}]:t._isDefaultContext(this.get("modelId"))?[{id:"gotodb",title:h.gotoAction,icon:"login",context:!0,overflow:!1},{id:"duplicatedb",title:h.duplicateAction,icon:"docs",context:!0,overflow:!1}]:[{id:"gotodb",title:h.gotoAction,icon:"login",context:!0,overflow:!1}],t._isUnShareableContext(this.get("modelId"))&&e.push({id:"unsharedb",title:h.unshareItem,icon:"role-delete",context:!0,overflow:!1}),t._isFavouriteContext(this.get("modelId"))?e.unshift({id:"removeFavorites",title:h.removeFromFavorite,icon:"favorite-delete",context:!0,overflow:!1}):e.unshift({id:"addFavorite",title:h.addAsFavorite,icon:"favorite-add",context:!0,overflow:!1}),new u(e))},dashboardActionsHandler:function(i,s){var u=e.is(this.model)?this.model:this,f=u.get("modelId"),p=e.is(s,"string")?s:s.model.get("id"),b=d.selectedCategory;function v(e){return new Promise(function(n){new c({closable:!0,renderTo:document.body}).confirm(t._isEndUserCockpitContext(e)?m.deleteCockpitConfirmMsg:m.deleteDashboardConfirmMsg,h.confirmation,n,h.deleteBtn,h.cancelBtn)}).then(function(n){return n?new Promise(function(n,i){t.removeContext({id:e,success:function(){a.track({category:"manageDashboard.dashboard.delete",action:"delete-dashboard-success"}),n()},failure:function(){a.track({category:"manageDashboard.dashboard.delete",action:"delete-dashboard-failure"}),i()}})}):Promise.resolve()})}return new Promise(function(t,i){switch(p){case"gotodb":d.manageDashboardModal.hide(),n.routeTo({dashboard:f}),t();break;case"sharedb":o.shareContext(f,{private:!0,public:!0,live:!1}).then(t.bind(null,{refresh:!1}),i);break;case"renamedb":o.renameDashboard(f).then(function(e){e&&(u.set("title",e.name),u.set("description",e.data.description)),t({refresh:!1})},i);break;case"duplicatedb":o.duplicateContext({modelId:f}).then(function(){t({refresh:!0})},i);break;case"deletedb":o.deleteDashboard(f,{skipUndo:!0}).then(function(e){t({refresh:!!e.confirmed})},i);break;case"unsharedb":o.unShareDashboard(f).then(function(e){t({refresh:e})},i);break;case"addFavorite":o.addFavorites([f]).then(t.bind(null,{refresh:!0,dashboardId:g._detailView&&b===r.ALL_DASHBOARD_PANEL?f:void 0}),i);break;case"removeFavorites":o.removeFavorites([f]).then(t.bind(null,{refresh:!0,dashboardId:g._detailView&&b===r.ALL_DASHBOARD_PANEL?f:void 0}),i);break;case"untrash":o.unTrashContext({modelId:f}).then(function(){a.track({category:"manageDashboard.dashboard.untrash",action:"untrash-dashboard-success"}),t({refresh:!0})},i);break;case"deletedbTrash":v(f).then(function(){d.setLastDetailViewOpened({dashboardId:f,set:!1}),t({refresh:!0})},i);break;case"gotodbTrash":a.track({category:"manageDashboard.dashboard.goto",action:"goto-trash-dashboard"}),d.manageDashboardModal.hide(),n.routeTo({dashboard:f}),t()}a.track(e.is(s,"string")?{category:"manageDashboard.idCardAction",action:s}:{category:"manageDashboard.tileMenu",action:s.model.get("id")})}).then(function(e){"gotodb"!==p&&"gotodbTrash"!==p&&e.refresh&&require(["DS/Dashboard/ManageDashboard/Controller/ManageDashboard"],function(t){t.createManageDashboardView({categoryToSelect:b,dashboardId:e.dashboardId?e.dashboardId:void 0})})}).catch(function(e){l.error("Error in dashboard action handler "+e)})},idCardDashboardActions:function(){var e=[],n=t._isEndUserCockpitContext(this.get("modelId"));return d.selectedCategory&&d.selectedCategory.toLowerCase()===s.ALL_DASHBOARD_PANEL.toLowerCase()&&n?(e=i.isOwnerRole(this.getRole())?[{text:h.gotoAction,icon:"login",handler:g.dashboardActionsHandler.bind(this,null,"gotodb")},{text:h.editAction,icon:"pencil",handler:g.dashboardActionsHandler.bind(this,null,"renamedb")},{text:h.deleteAction,icon:"trash",handler:g.dashboardActionsHandler.bind(this,null,"deletedb")}]:[{text:h.gotoAction,icon:"login",handler:g.dashboardActionsHandler.bind(this,null,"gotodb")}],t._isFavouriteContext(this.get("modelId"))?e.push({text:h.removeFromFavorite,icon:"favorite-delete",handler:g.dashboardActionsHandler.bind(this,null,"removeFavorites")}):e.push({text:h.addAsFavorite,icon:"favorite-add",handler:g.dashboardActionsHandler.bind(this,null,"addFavorite")}),e):d.selectedCategory&&d.selectedCategory.toLowerCase()===s.RECYCLE_BIN_PANEL.toLowerCase()?(i.isOwnerRole(this.getRole())&&(e=[{text:n?h.gotoCockpitActionManageDB:h.gotoDashboardActionManageDB,icon:"login",handler:g.dashboardActionsHandler.bind(this,null,"gotodbTrash")},{text:h.unTrashAction,icon:"undo",handler:g.dashboardActionsHandler.bind(this,null,"untrash")},{text:h.deletePermanentlyAction,icon:"trash",handler:g.dashboardActionsHandler.bind(this,null,"deletedbTrash")}]),e):(e=this.get("owner")?[{text:h.gotoAction,icon:"login",handler:g.dashboardActionsHandler.bind(this,null,"gotodb")},{text:h.shareAction,icon:"forward",handler:g.dashboardActionsHandler.bind(this,null,"sharedb")},{text:h.editAction,icon:"pencil",handler:g.dashboardActionsHandler.bind(this,null,"renamedb")},{text:h.duplicateAction,icon:"docs",handler:g.dashboardActionsHandler.bind(this,null,"duplicatedb")},{text:h.deleteAction,icon:"trash",handler:g.dashboardActionsHandler.bind(this,null,"deletedb")}]:t._isDefaultContext(this.get("modelId"))?[{text:h.gotoAction,icon:"login",handler:g.dashboardActionsHandler.bind(this,null,"gotodb")},{text:h.duplicateAction,icon:"docs",handler:g.dashboardActionsHandler.bind(this,null,"duplicatedb")}]:[{text:h.gotoAction,icon:"login",handler:g.dashboardActionsHandler.bind(this,null,"gotodb")}],t._isUnShareableContext(this.get("modelId"))&&e.push({text:h.unshareItem,icon:"role-delete",handler:g.dashboardActionsHandler.bind(this,null,"unsharedb")}),t._isFavouriteContext(this.get("modelId"))?e.push({text:h.removeFromFavorite,icon:"favorite-delete",handler:g.dashboardActionsHandler.bind(this,null,"removeFavorites")}):e.push({text:h.addAsFavorite,icon:"favorite-add",handler:g.dashboardActionsHandler.bind(this,null,"addFavorite")}),e)}};return g}),define("DS/Dashboard/Views/BELayoutEditorActionBarView",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UWPClientCode/Data/BusinessExperience","DS/Dashboard/PublicAPI","DS/Dashboard/DashboardManager","i18n!DS/Dashboard/assets/nls/views"],function(e,t,n,a,i,o,r){"use strict";return e.extend({className:"be-layout-editor-action-bar-view",tagName:"div",_alert:null,setup:function(){},destroy:function(){this._alert&&(this._alert.destroy(),this._alert=null),this._parent.apply(this,arguments)},render:function(){var e=this.container;return this.elements.applyBtn=new t({value:r.saveBtn,className:"apply-btn primary",events:{onClick:this._onApplyBtn.bind(this)}}).inject(e),this},_onApplyBtn:function(){var e=this;return n.mask(document.body,r.savingBELayoutLoading),a.publishLayout({modelId:(i._getActiveContext()||{}).modelId,serviceName:i._getServiceName()}).then(function(){e.elements.applyBtn.disable(),e._showAlert({autoHide:!0,message:{className:"success",message:r.saveBELayoutSuccessBody}}),setTimeout(function(){window.postMessage("close",window.origin)},3e3)}).catch(function(t){console.error(t),e._showAlert({message:{className:"error",message:r.saveBELayoutFailureBody}})}).finally(function(){n.unmask(document.body)})},_showAlert:function(e){o.showAlert({className:"save-be-layout-alert",autoHide:e.autoHide,closeOnClick:!0,messages:[e.message]})}})}),define("DS/Dashboard/Layout/Dashboard",["UWA/Core","UWA/Utils","DS/UWPClientCode/Undo","DS/UWPClientCode/I18n","DS/UWPClientControls/Utils","DS/UWPClientControls/PlatformNotify","DS/UWPClientControls/LazyLoader","DS/Dashboard/PublicAPI","DS/Dashboard/DashboardManager","DS/Dashboard/WidgetLinkManager","DS/Dashboard/GridManager","DS/Dashboard/DockLayoutManager","DS/Dashboard/Navigation","DS/Dashboard/UsageTracker","DS/Dashboard/Environment","DS/Dashboard/NewDashboardMenu","DS/Dashboard/CommentPanelManager","DS/Dashboard/Views/BELayoutEditorActionBarView","DS/Dashboard/Views/SearchInTabOverlay","DS/Dashboard/Utils","DS/PubSub/PubSub","DS/W3DLegal/W3DLegal","DS/WebappsUtils/Utils","DS/PlatformAPI/PlatformAPI","DS/WidgetPreview/Controller/TransientManager","i18n!DS/Dashboard/assets/nls/layout"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w,D,_,C,I,S,y){"use strict";var E,T=!1,A={},P=!1,x={},M={},k={};function N(e){return((e||{}).options||{}).id||""}function W(t,n){var a=t.layout.elements.contentNode,i=a.scrollTop;return a.scrollTop=n,a.setStyle("overflow-y","hidden"),a._preventScrollOnFocusFunc||a.addEvent("scroll",a._preventScrollOnFocusFunc=function(t){e.Event.stop(t),a.scrollTop!==n&&(a.scrollTop=n)}),i}function L(e,t){var n=e.layout.elements.contentNode;n.scrollTop=t,n.setStyle("overflow-y","auto"),n._preventScrollOnFocusFunc&&(n.removeEvent("scroll",n._preventScrollOnFocusFunc),delete n._preventScrollOnFocusFunc)}function U(e){var t,n,a,i,o=e.layout.elements,r=o.footer;r&&(t=o.contentNode,n=o.container,a=!!u.get(),i=((e.layout.getTab()||{}).options||{}).id,!(a||t.getSize().height+t.scrollTop>=t.scrollHeight-15)||E._hasMaximizedWidget(i)||E._hasFullscreenWidget(i)?(r.removeClassName("up"),n.removeClassName("footer-up")):(r.addClassName("up"),n.addClassName("footer-up")))}function O(e){if(t.Client.Platform.android&&(r.revalidate(),"Float"===(S.getInstance()||{}).viewMode||!e)){var n=document.body.getElement(".app-content > .moduleWrapper"),a=document.body.getElement(".app-content > .preview-wrapper");n&&n.setStyles({position:e}),a&&a.setStyles({position:e})}}var F,B=function(e){F&&F.destroy(),(F=new b).render().inject(e.layout.elements.container)};function R(t,n){function i(){w.isEditable()?(c.enable(),u.enable()):(c.disable(),u.disable())}function r(){"minimized"!==b&&-1!==Object.keys(_).indexOf(v)&&(delete _[v],s.setTabProperty(D,"minimizedWidgetIds",_)),"maximized"!==b&&C===v&&s.setTabProperty(D,"lastMaximizedWidgetId",""),"minimized"===b&&-1===Object.keys(_).indexOf(v)&&(_[v]=d||3,s.setTabProperty(D,"minimizedWidgetIds",_)),"maximized"===b&&s.setTabProperty(D,"lastMaximizedWidgetId",v),"fullscreen"===b&&s.setTabProperty(D,"lastMaximizedWidgetId","")}if(0!==n.id.indexOf("preview")){var d,l,g=e.Utils.Client.Platform,b=n.type,v=n.id,w=t.layout&&t.layout.getTab(),D=w&&N(w),_=s._getTabProperty(D,"minimizedWidgetIds")||{},C=s._getTabProperty(D,"lastMaximizedWidgetId"),I=s._getTab(D),S=I&&I.environment.wp.children.filter(function(e){return e.id===n.id})[0],T=c.get(D),A=S&&S.el.dockItem&&u.get(),P=T&&T.elements.wrapper.getElement(".wi-"+v),U="fullscreen"===b,O="maximized"===b,F="minimized"===b,B=!U&&v===k[D],R=!O&&v===M[D];S?(x[n.id]&&delete x[n.id],U&&(k[D]=v),O&&(M[D]=v),B&&delete k[D],R&&delete M[D],B&&!h.isBELayoutEditorMode()&&p.enable(),F?(P&&(d=P.getData("sizey"),T.resize({silent:t.getValue("resetWidgetsViewState"),widget:P,sizey:1}),c.toggleResizable(!1,v)),A&&A.minimize(S.el),i(),r(),m.track({category:"widget.update",action:"minimized-dashboardLayout"})):O?(c.disable(),u.disable(),A&&A.maximize(S.el),r(),w.savedScrollTop=W(t,0)):U?(c.disable(),u.disable(),A&&A.maximize(S.el),p.disable(),r(),w.savedScrollTop=W(t,0),s._getActiveContextWidget().layout.elements.scrollerContainer.hide(),f.close({hide:!0,noSave:!0}),l=0===((c.get()||{}).id||"").indexOf("preview"),g.tablet||g.android||g.ipad||g.ios||l||o.info(a.replace(y.fullscreenInfo,{key:g.macintel?"++F":"+F11"})),m.track({category:"widget.update",action:"maximized-dashboardLayout"})):(P&&(d=_[v],(e.is(d)||P.getData("sizey")<=1)&&(d=!d||d<=1?s._getDefaultModuleCoordinates()[T.breakpoint.name].sizey:d,T.resize({widget:P,sizey:d})),c.toggleResizable(!0,v)),A&&(t.body.setStyle("margin-top",""),A.setDefaultViewMode(S.el)),i(),r(),e.is(w.savedScrollTop)&&P&&L(t,w.savedScrollTop),delete w.savedScrollTop,s._getActiveContextWidget().layout.elements.scrollerContainer.show(),f.open({fromSave:!0}),m.track({category:"widget.update",action:"windowed-dashboardLayout"})),E.resizeTab({widget:t,waitEndOfAnimation:!0})):x[n.id]=n}}return E={viewportHeight:0,init:function(t,a){var o,r;a.serviceName=s._getServiceName(),a.customEnvironment=g,t.serviceName=a.serviceName,o=i.debounce(E._setSearchInTabViewPosition,800),r=i.debounce(E._setSearchInTabViewPosition,800),E.switchToCard=function(n){n=n||{};var i,o,r,d,l=t.layout.tabs;l.length&&!h.isAddinMode()&&(i=n.name||(n.encodedName?decodeURIComponent(n.encodedName):""),d=e.is(n.position,"number")?n.position:-1,n.id?o={id:n.id}:d>-1&&d<l.length?o=d:i&&l.forEach(function(e){e.getName()===i&&(o=e.getId())}),o||0===o||(r=s._getContextProperty(s._getActiveContextModelId(),"lastOpenedTabId"),o=e.is(r)?{id:r}:0),a.switchCard(o))},D.add("onViewChange",R.bind(null,t)),D.add(s.events.tab.fit,function(e,n){t.layout.getTab().getId()===e&&n?(W(t,0),m.track({category:"tab.update",action:"fit-dashboardLayout"})):(L(t,0),m.track({category:"tab.update",action:"unfit-dashboardLayout"})),E.resizeTab({widget:t,waitEndOfAnimation:!0})}),D.add(s.events.tab.add,a.createCard),D.add(s.events.tab.subscribe,function(e){a.addCard(e),a.switchCard(e)}),D.add(s.events.tab.remove,function(e){!function(e,t,a){var i,o,r,d=t.layout,l=d.tabs,c=N(e);if(o=d.getTab(l.indexOf(e)),(i=d.getTab(l.indexOf(e)+1))&&i!==e||(i=d.getTab(l.indexOf(e)-1)),!i||i.options.item.widget&&i.options.item.widget.disabled)for(r=0;r<l.length&&(!(i=l[r]).options.item.widget||i.options.item.widget.disabled);r++);n.addAction({id:N(o),name:o.options.text,undoPending:function(){o.hide(),o.options.item.widget.disabled=!0,a.switchCard(i.options.item)},undoAgree:function(){o.show(),o.options.item.widget.disabled=!1,a.switchCard(o.options.item)},undoDecline:function(){s.setTabProperties(c,null),a.deleteCard(c,i,o),delete k[c],delete M[c],m.track({category:"tab.delete",action:"delete-dashboardLayout"})}})}(e,t,a)}),D.add(s.events.tab.rename,function(e,t){T=!0,function(e,t){""!==t&&(e.setText(t),m.track({category:"tab.rename",action:"rename-dashboardLayout"}))}(e,t)}),D.add(s.events.tab.refresh,function(e){!function(e,t){d.disableWidgetsLinksMode(),c.unregister(N(e)),t.refreshCard(e),E.resizeTab({widget:e.options.item.parent.widget,noTracking:!0}),m.track({category:"tab.read",action:"refresh-dashboardLayout"})}(e,a)}),D.add(s.events.dashboard.refresh,function(){a.wp.children.forEach(function(e){var t=e.widget.environment,n=t.wp.isVisible;t.wp.isVisible=!0,t.dispatchEvent("onRefresh"),t.wp.isVisible=n})}),D.add(s.events.tab.duplicate,function(e){e&&(a.addCard(e),a.switchCard(e))}),D.add(s.events.dashboard.change,function(n){var i=n.template;a.contextId=n.modelId,a.contextType=n.type,s.setLastOpenedContextId(n.modelId).catch(function(t){e.log(t)}),delete t.data.resetWidgetsViewState,t.environment.deleteData("resetWidgetsViewState"),a.refreshIfVisible(),d.setDashboardBackground({bgId:i,fit:"loss"})},null,!0),D.add(s.events.tab.switchto,E.switchToCard),I.subscribe(s.events.tab.switchto,E.switchToCard),D.add(s.events.search.openSearchInTab,function(e){var t;h.hasPart(h.parts.app)||(t=s._getTabContext())&&(E._showSearchInTabOverlayView(t,e),m.track({category:"searchIn.tab",action:"showFrom3DSearchEvent"}))}),D.add(s.events.panel.open,function(){o()}),D.add(s.events.panel.close,function(){o()}),i.addEvent(window,"resize",function(){E.resizeTab({widget:t}),o(),r()})},onClickCard:function(e,t){var n=t.tab.getId();D.dispatch(s.events.tab.click,n,!0)},onChangeCard:function(e,n){var a,i,o=n.tab,r=o.getId(),l=n.previousTab,g=o.options.item.children||[],f=s._getActiveContext().modelId,p=t.encodeUrl(n.tab.getName()),b=h.getUrlParameter(h.parts.tab),v=s._getTab(r),w=JSON.parse(o.options.item.data||"{}"),_=v&&v.getValue("layout")||{},C=v?"dock"===(_.master||_)||v.getValue("fit"):w.layout&&"dock"===(w.layout.master||w.layout)||w.fit;if(l){var I=l.elements.searchInTabOverlayView;I&&I.isVisible()&&(I.hasLastSearch()?I.hide():(I.close(),I.destroy(),delete l.elements.searchInTabOverlayView)),d.disableWidgetsLinksMode()}var S=o.elements.searchInTabOverlayView;o.options.searchInTabOpened&&S&&E._showSearchInTabOverlayView(o),a=s._getTabProperty(r,"lastMaximizedWidgetId"),(i=-1!==(g=g.map(function(e){return e.id})).indexOf(a)||s._getWidget(a))?document.body.addClassName("ifwe-has-maximized-widget"):document.body.removeClassName("ifwe-has-maximized-widget"),b&&b===p||(h.routeTo({dashboard:f,tab:p,keepAll:!l}),m.track({category:"dashboard.read",action:"goToOnChangeCard-dashboardLayout"})),C||i?W(e,0):L(e,0),s._getContextProperty(f,"lastOpenedTabId")!==r&&s.setContextProperty(f,"lastOpenedTabId",r),o.isEditable()&&!i?(c.enable(),u.enable()):(c.disable(),u.disable()),D.dispatch(s.events.tab.change,r,!0),v&&v.environment.wp.children.forEach(function(t){x[t.id]&&R(e,x[t.id])}),h.isBELayoutEditorMode()&&B(e),setTimeout(E.resizeTab.bind(null,{widget:e}))},getDefaultConfiguration:function(e){var t=e.layout.tabs,n=y.newTab,a=n,i=0;function o(e,t){for(var n=0,a=t.length;n<a;n++)if(t[n].options.item.name===e)return t[n].options.item}for(;o(a,t);)a=n+" "+ ++i;return{widgetId:"8KqyNGD_00012RwEeGAd",data:{module:"DS/Dashboard/Layout/Tab"},name:a,children:[]}},onBeforeAddCard:function(e,t,n){var a,i,o,r,d,c=this.getTabMenuConfiguration(e).menuItems,u=s._getActiveContext();if(!n.item.isEditable||u.deletionDate){var h=["searchTabItem","refreshItem"];n.menuItems=c.filter(function(e){return h.indexOf(e.name)>=0})}n.item.sourceId&&((a=s._getTabProperty(n.item.sourceId,"minimizedWidgetIds"))&&!u.sourceModelId&&(o=t.wp.children.filter(function(e){return e.id===n.item.sourceId})[0].widget.layout.wp,i={},r=(o.children||[]).map(function(e){return e.id}),d=(n.item.children||[]).map(function(e){return e.id}),Object.keys(a).forEach(function(e){var t=r.indexOf(e),n=a[e];-1!==t&&n&&(i[d[t]]=n)}),s.setTabProperty(n.id,"minimizedWidgetIds",i)),l.copyLinked(n.item))},onBeforeLoadCards:function(e){D.dispatch(s.events.story.init,{id:e.id,modelId:s._getActiveContextModelId()}),E._applyContextBackground()},onLoadCards:function(e){var t,n=e.layout;e.getValue("resetWidgetsViewState")&&(n.tabs||[]).forEach(function(e){var t=N(e);s._getTabProperty(t,"lastMaximizedWidgetId")&&s.setTabProperty(t,"lastMaximizedWidgetId","");var n=s._getTabProperty(t,"minimizedWidgetIds");Object.keys(n||{}).length&&s.setTabProperty(t,"minimizedWidgetIds",{})});r.destroy(),E.switchToCard({encodedName:h.getUrlParameter(h.parts.tab)}),(t=_.displayFooter(n.elements.container,"bottom"))&&(D.add(s.events.tab.fit,U.bind(null,e)),n.elements.footer=t.container,n.elements.container.addClassName("has-footer"),n.elements.contentNode.addEvent("scroll",U.bind(null,e)))},onTabMenuItemClick:function(e,t){var n=t.name,a=N(e);switch(n){case"shareItem":d.shareTab(a);break;case"searchTabItem":E._showSearchInTabOverlayView(e);break;case"renameItem":d.renameTab(a);break;case"duplicateItem":d.duplicateTab(a);break;case"refreshItem":d.refreshTab(a);break;case"deleteItem":d.deleteTab(a);break;case"fitItem":d.fitTab(a,"dock"!==e.options.item.widget.getValue("layout").master)}m.track({category:"tab.menu",action:n})},onRenameCard:function(e,t){T?T=!1:D.dispatch(s.events.tab.rename,[t,s._getTabName(t)])},getTabMenuConfiguration:function(){var e=[{name:"shareItem",text:y.shareItem,icon:"fonticon fonticon-forward"},{name:"searchTabItem",text:y.searchTabItem,icon:"search-in-tab-icon fonticon fonticon-search"},{name:"renameItem",text:y.renameItem,icon:"fonticon fonticon-pencil"},{name:"duplicateItem",text:y.duplicateItem,icon:"fonticon fonticon-docs"},{name:"refreshItem",text:y.refreshItem,icon:"refresh-icon fonticon fonticon-refresh"},{name:"fitItem",text:y.fitItem,icon:"fonticon fonticon-arrow-combo"},{name:"deleteItem",text:y.deleteItem,icon:"fonticon fonticon-trash"}];return h.isBELayoutEditorMode()&&(e=e.filter(function(e){return!["shareItem","duplicateItem"].includes(e.name)})),{editable:!0,allowNewTab:!0,menuItems:e,onBuildContainer:function(e){var t=e.elements.container;if(p.getButton().inject(t,"top"),h.isBELayoutEditorMode())p.disable();else{var n=f.getOpenMenuBtn();n&&n.inject(t,"top")}}}},resizeTab:function(e){if(e.widget&&e.widget.layout&&e.widget.layout.elements){var n,a,i=e.widget,o=i.layout.getTab(),r=N(o),s=i.layout.elements,l=s.contentNode,g=o.options&&o.options.item.el.firstChild,f=E._hasMaximizedWidget(r),p=E._hasFullscreenWidget(r),b=u.get(),v=c.get(r),D=o.elements.searchInTabOverlayView&&o.elements.searchInTabOverlayView.isVisible(),_=!b||f||p?0:s.footer&&parseInt(window.getComputedStyle(s.footer).minHeight)||0,I=d.isWidgetsLinksModeEnabled()?60:0,S=h.isBELayoutEditorMode()?60:0,y=D&&!p&&document.body.clientWidth<=w.breakpoints.topbar.medium?43:0;if(t.Client.Platform.android&&(e._attempts||0)<5&&(!e._retry||e._retry()))return setTimeout(function(){E.resizeTab(Object.assign({},e,{_attempts:(e._attempts||0)+1,_retry:function(){return window.screen.width===A.width&&window.screen.height===A.height&&C.isVirtualKeyboardOpen()===P}}))},500);(b||c.get())&&C.isVirtualKeyboardOpen()&&A.width===window.screen.width&&A.height===window.screen.height||(O(""),A={width:window.screen.width,height:window.screen.height},P=C.isVirtualKeyboardOpen(),a=t.Client.getSize().height-(l.getOffsets().y+_+I+S),l.setStyle("height",a+"px"),b&&b.element.setStyle("height",a+"px"),l.parentElement.setStyle("margin-bottom",_+I+S+"px"),g&&g.setStyle("height",a-y+"px"),c.update(),v&&D&&(n=v.elements.container).setStyles({height:parseInt(n.getStyle("height"),10)+y+"px"}),e.waitEndOfAnimation?setTimeout(U.bind(null,i),500):U(i),setTimeout(function(){O("fixed"),setTimeout(function(){O("")},50)},50),e.noTracking||m.track({category:"tab.read",action:"resize-dashboardLayout"}))}},_showSearchInTabOverlayView:function(e,t){t=t||{};var n=e.getId(),a=e.elements,i=a.searchInTabOverlayView;function o(e){var t=s._getTab(e),n=t&&t.environment;return n&&((n.wp||{}).parent||{}).widget}function r(e){"string"==typeof e.query&&i.setValue(e.query),e.submit&&i.search()}if(i)return i.isVisible()?(E._setSearchInTabViewPosition(e),i.focus()):i.show(),void r(t);a.searchInTabOverlayView=i=new v({targetId:n,value:t.query,events:{onShow:function(){e.options.searchInTabOpened=!0,a.content.addClassName("search-in-tab-overlay-displayed"),E.resizeTab({widget:o(n),noTracking:!0}),E._setSearchInTabViewPosition(e),D.dispatch(s.events.tab.showSearchIn,n,!1)},onHide:function(){var e=(s._getActiveTab()||{}).id;a.content.removeClassName("search-in-tab-overlay-displayed"),e===n&&E.resizeTab({widget:o(n),noTracking:!0})},onClose:function(){e.options.searchInTabOpened=!1,D.dispatch(s.events.tab.closeSearchIn,n,!1)}}}),i.render().inject(function e(t,n){var a=t.parentElement;return a?a.hasClassName(n)?a:e(a,n):t}(a.container,"wp-tabview")).show(),r(t)},_setSearchInTabViewPosition:function(e){if(e=e||s._getTabContext()){var t,n=e.elements,a=n.searchInTabOverlayView;if(a){if(document.body.clientWidth>w.breakpoints.topbar.small){var i=n.container,o=(h=i.getBoundingClientRect(),m=window.pageXOffset||document.documentElement.scrollLeft,g=window.pageYOffset||document.documentElement.scrollTop,{top:h.top+g,left:h.left+m}),r=i.getBoundingClientRect(),d=n.content.getBoundingClientRect(),l=d.width,c=a.container.getBoundingClientRect().width,u=r.width+30;(t=Math.max(o.left-d.x+u/2-c/2,0))+c>l&&(t=Math.max(l-c,0))}var h,m,g;a.setPosition(t)}}},_hasMaximizedWidget:function(e){return!!M[e]},_hasFullscreenWidget:function(e){return!!k[e]},_applyContextBackground(){var e=s._getActiveContext();e&&d.setDashboardBackground({bgId:e.template,fit:"loss"})}}}),define("DS/Dashboard/Shortcuts",["UWA/Core","UWA/Event","DS/UWPClientCode/WidgetCatalog","DS/Dashboard/DashboardManager","DS/Dashboard/PublicAPI"],function(e,t,n,a,i){"use strict";return{init:function(){document.body.addEvent("keydown",function(o){switch(t.whichKey(o)){case"alt+ctrl+e":a.exportDashboard(),t.stop(o);break;case"alt+ctrl+a":if(!e.debug)break;n.toggle({serviceName:i._getServiceName()}),t.stop(o)}})}}}),define("DS/Dashboard/Views/DashboardSettingsViews/BackgroundSectionView",["UWA/Class/View","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/UWPClientCode/I18n","DS/Dashboard/DashboardManager","DS/Dashboard/PublicAPI","DS/Dashboard/UsageTracker","DS/Dashboard/Views/ImageUploadView","i18n!DS/Dashboard/assets/nls/views","i18n!DS/Dashboard/assets/nls/modal","i18n!DS/Dashboard/assets/nls/vocabulary"],function(e,t,n,a,i,o,r,s,d,l,c){"use strict";return e.extend({MAX_SIZE_IN_BYTES:5242880,className:"dashboard-bg-section section",tagName:"div",parentView:null,acceptedTypes:{"image/png":!1,"image/jpeg":!0,"image/gif":!1},manageDashModal:null,imageUploadView:null,setup:function(e){this.manageDashModal=e.modal,this.parentView=e.parentView},render:function(){var e=this;return e.imageUploadView=new s({maxSizeInBytes:e.MAX_SIZE_IN_BYTES,acceptedTypes:e.acceptedTypes,checkHexaTypes:!0,initialImageSrc:o._getContextBackgroundUrl({backgroundId:e.getBgId()}),nls:{emptyImagePreview:d.noBackground,acceptedFileTypesAndlimitFileSize:a.replace(d.acceptedFileTypesAndlimitFileSize,{size:5,unit:c.MBUnit}),limitFileSize:a.replace(d.limitFileSize,{size:5,unit:c.MBUnit}),wrongFileType:d.notifWrongType},events:{onApply:function(t){return r.track({category:"manageDashboard.dashboard",action:"applyBtn"}),e.hideNotif(),e.setBackground(t)},onReset:function(){return r.track({category:"manageDashboard.dashboard",action:"resetBtn"}),e.hideNotif(),e.askUnsetBackground()},onRestoreView:function(){r.track({category:"manageDashboard.dashboard",action:"resetBtn-restoreView"}),e.hideNotif()},onError:function(t){"onFailFetchUrl"===(t=t||{}).code?(r.track({category:"manageDashboard.dashboard",action:"urlFail"}),e.showNotif({msg:t.msg||d.failFetchImageFromUrl})):e.showNotif({msg:t.msg||d.previewError})},onNoFileDropped:function(){e.showNotif({msg:d.noFileDropped})},onUploadValidImage:function(){e.hideNotif()}},trackers:{browseFromBtn:{category:"manageDashboard.background",action:"browseFromBtn"},browseFromPreview:{category:"manageDashboard.background",action:"thumbnailBtn"},fetchFileFromUrl:{category:"manageDashboard.background",action:"url"},dropUrl:{category:"manageDashboard.background",action:"dropUrl"},dropFile:{category:"manageDashboard.background",action:"drop"}}}),e.imageUploadView.render(),e.container.addContent([{tag:"div",class:"section-title",text:d.bgSectionTitle},{tag:"div",class:"section-content",html:[e.imageUploadView.container]}]),r.track({category:"manageDashboard.background",action:"render"}),e},destroy:function(){this.imageUploadView&&this.imageUploadView.destroy(),this.imageUploadView=null,this.manageDashModal=null,this.parentView=null,this._parent.apply(this,arguments)},showNotif:function(){this.parentView.showNotif.apply(this.parentView,arguments)},hideNotif:function(){this.parentView.hideNotif.apply(this.parentView,arguments)},maskView:function(e){n.mask(this.container,e)},unmaskView:function(){n.unmask(this.container)},getBgId:function(){return this.model.get("templateId")},getModelId:function(){return this.model.get("modelId")},isCurrentDashboard:function(){return o._isActiveContext(this.getModelId())},setBackground:function(e){var t=this;return new Promise(function(n,a){function s(){t.showNotif({msg:d.notifBgSetFail}),t.unmaskView(),t.isCurrentDashboard()&&i.setDashboardBackground({fit:"loss",bgId:t.getBgId()}),a()}var l,c=t.getBgId();if(t.maskView(d.waitSaveBg),!e||!e.src)return s();t.isCurrentDashboard()&&i.setDashboardBackground({fit:"loss",url:e.src,width:e.width,height:e.height}),l={id:t.getModelId(),file:e,success:function(e){t.unmaskView(),r.track({category:"dashboard.background.set",action:"set-view"}),t.model.set("templateId",e.template),t.showNotif({msg:d.notifBgSetSuccess,type:"success"}),n(!0)},failure:s,events:{onFail:s}},c?o.unsetContextBackground({bgId:c,id:t.getModelId(),success:function(){t.model.set("templateId",void 0),r.track({category:"dashboard.background.reset",action:"resetFromSet-view"}),o.setContextBackground(l)},failure:s}):o.setContextBackground(l)})},askUnsetBackground:function(){var e=this;return e.getBgId()?new Promise(function(n,a){var i=new t({closable:!0,overlay:!0});e.manageDashModal.hide(),i.confirm(d.setBgModalContentReset,d.setBgModalTitleReset,function(t){return e.manageDashModal.show(),r.track({category:"manageDashboard.background",action:t?"confirmOkBtn":"confirmCancelBtn"}),(t?e.unsetBackground():Promise.resolve(!1)).then(n).catch(a)},l.yesBtn,l.noBtn)}):Promise.resolve(!0)},unsetBackground:function(){var e=this,t=e.getBgId();return e.maskView(d.waitResetBg),new Promise(function(n,a){o.unsetContextBackground({bgId:t,id:e.getModelId(),success:function(){e.unmaskView(),e.model.set("templateId",void 0),e.isCurrentDashboard()&&i.setDashboardBackground(),e.showNotif({msg:d.notifBgResetSuccess,type:"success"}),r.track({category:"dashboard.background.reset",action:"resetSuccess-view"}),n(!0)},failure:function(){e.showNotif({msg:d.notifBgResetFail}),e.unmaskView(),r.track({category:"dashboard.background.reset",action:"resetFail-view"}),a()}})})},onFacetSelect:function(){r.track({category:"manageDashboard.background",action:"facetSelect"})}})}),define("DS/Dashboard/TopBar/RightMenusManager",["UWA/Core","UWA/Utils","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","DS/TopBar/TopBar","DS/TopBar/model/MainMenuBar","DS/UWPClientCode/PublicAPI","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/DashboardManager","DS/Dashboard/Utils","DS/Dashboard/CompassManager","DS/Dashboard/WidgetPreviewManager","DS/Dashboard/StoryManager","DS/Dashboard/UsageTracker","DS/Dashboard/TopBar/API","DS/Dashboard/TopBar/CmdProvider","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b){"use strict";var v,w,D,_,C=t.getUUID(),I=C+"-ifwe-default",S=C+"-ifwe-default-add-widget",y=C+"-ifwe-default-add-tab",E=C+"-ifwe-default-add-dash",T=C+"-ifwe-default-add-story",A=C+"-ifwe-default-share-widget",P=C+"-ifwe-default-share-tab",x=C+"-ifwe-default-share-dash",M=C+"-ifwe-default-share-cockpit",k=C+"-ifwe-default-addinmode-dash",N=!1,W=!1,L=!1,U=!1,O=null,F=null;return v={_widgetsPreviewProviders:[],_mainProvider:null,init:function(){w=require("DS/Dashboard/TopFrameManager"),D=require("DS/Dashboard/TopBar/Manager"),N=d.isAddinMode(),W=d.isSWAMode(),L=d.isBELayoutEditorMode(),U=s._getApplicationConfigurationBoolean("app.dashboardstory.enable"),N?v._initAddinModeMenus():v._initMenus(),v._initEvents()},setProviders:function(e){var t=[],n=(e=e||{}).widgetsIds||[];if("string"==typeof n&&(n=[n]),v._widgetsPreviewProviders.length&&(n=v._widgetsPreviewProviders),D.isCtxTypeContext()){if(N||W)return;var a=s._getActiveContext(),o=w.getMaximizedWidgetId(),r=w.getMaximizedWidgetPreviewId(),d=!r,l=!r,u=!r&&c.isEditionFriendlyDevice();t=L?[I,d&&S,y]:a&&a.owner?[I,d&&S,y,E,l&&A,P,s._isEndUserCockpitContext(a)?M:x,u&&T]:[I,E],s._isBusinessExpInstanceContext(a)&&(t=c.removeItems(t,[x,M])),r?n.unshift(r):o&&(n.unshift(o),g.track({category:"dashboard.use",action:"addMaximizeWidgetProvider-topFrameManager"}))}else if(D.isCtxTypeWidget()){var h=w.getFullscreenWidgetId(),m=w.getFullscreenWidgetPreviewId();t=N||W?[k]:[I,h&&A],m?n.unshift(m):h&&n.unshift(h)}if(n.length){var f={};n.forEach(function(e){var t=((s._getWidget(e)||{}).environment||{}).embedded;t&&(f[t.id]=!0)}),n=Object.keys(f),t=t.concat(n)}i.MainMenuBar.setActiveMenuProviders(t.filter(function(e){return e}))},_initEvents:function(){n.add(s.events.widget.destroy,function(e){var t=(e=e||{}).id;F===t&&(F=null),o._removeProvider(t)},null,!0),function(){function e(){F=null}n.add(s.events.widget.focus,function(e){F=e.id}),n.add(s.events.widget.unfocus,e),n.add(s.events.tab.refresh,e)}(),n.add(s.events.preview.updateTopBarProviders,function(e){v._widgetsPreviewProviders=e.widgetsIds||[],v.setProviders()}),n.add(s.events.preview.close,function(){v._widgetsPreviewProviders=[]}),function(){function e(e){function t(){l.showAlert({messages:[{className:"error",message:b.errorTryLater}]}),g.track({category:"dashboard.use",action:"updateProfileFail"})}switch(e){case"update_ok":f.setUserName({forceRefresh:!0}).then(function(){l.showAlert({autoHide:!0,messages:[{className:"success",message:b.profileUpdateSuccess}]}),g.track({category:"dashboard.use",action:"updateProfileSuccess"})}).catch(t);break;case"update_ko":t()}O&&O.hide()}n.add(s.events.myprofile.updated,e,null,!0),a.subscribe("profile:update",function(){e("update_ok")})}()},_initMenus:function(){var e,t=v._mainProvider=new p({providerId:I}),n=new p({providerId:S}),a=new p({providerId:y}),i=new p({providerId:E}),o=new p({providerId:A}),r=new p({providerId:P}),s=new p({providerId:x}),d=new p({providerId:M});U&&(e=new p({providerId:T})),v._mainProvider=t,t.setCommands({profile:[{label:b.myProfileItem,onExecute:v._onMyProfileClick},{label:b.myPrerefencesItem,onExecute:v._onMyPreferencesClick},{label:b.signOutItem,onExecute:v._onSignOutClick}],help:{label:b.helpItemTopBar,onExecute:v._onHelpClick}}),n.setCommands({add:{label:b.addWidgetTopBar,onExecute:v._onAddWidgetClick}}),a.setCommands({add:{label:b.tabType,onExecute:v._onAddTabClick}}),i.setCommands({add:{label:b.dashboardType,onExecute:v._onAddDashboardClick}}),U&&e.setCommands({add:{label:b.storyType,onExecute:v._onAddStoryClick}}),o.setCommands({share:{label:b.shareWidgetItem,onExecute:v._onShareWidgetClick}}),r.setCommands({share:{label:b.shareTabItem,onExecute:v._onShareTabClick}}),s.setCommands({share:{label:b.shareDashboardItem,onExecute:v._onShareContextClick}}),d.setCommands({share:{label:b.shareCockpitItem,onExecute:v._onShareContextClick}})},_initAddinModeMenus:function(){var e=new p({providerId:k});v._mainProvider=e,e.setCommands({profile:[{label:b.myPrerefencesItem,onExecute:v._onMyPreferencesClick},{label:b.signOutItem,onExecute:v._onSignOutClick}],help:{label:b.helpItemTopBar,onExecute:v._onHelpClick}})},_onMyProfileClick:function(){g.track({category:"dashboard.use",action:"myProfileTopBarItem-topFrameManager"}),w.closeCoachmark();var e=s._getSwymPlatform()||{};e.url?v._openMyProfileWdg(e):v._openMyProfileModal()},_onMyPreferencesClick:(_=!1,function(){function e(){return v._openMyPreferencesModal()}return g.track({category:"dashboard.use",action:"myPreferencesTopBarItem-topFrameManager"}),w.closeCoachmark(),_?Promise.resolve():(_=!0,s._getApplicationConfigurationBoolean("app.feature.me-preferences.enabled")||"me-preferences-enabled"in c.getParsedQuery()?u.getServiceUrl({serviceName:u.serviceNames.mepreferences,platformId:s._getGlobalPlatformId()}).then(function(t){return t?v._openMePreferencesDialog().catch(function(t){return console.error(t),e()}):e()}).catch(function(t){return console.error(t),e()}).finally(function(){_=!1}):e().finally(function(){_=!1}))}),_onSignOutClick:function(){g.track({category:"dashboard.use",action:"logoutTopBarItem-topFrameManager"}),d.logout()},_onAddWidgetClick:function(){g.track({category:"dashboard.use",action:"addWidgetTopBarItem-topFrameManager"}),u.isOpen()?l.showAlert({className:"dd-widget-from-compass-alert",autoHide:!0,messages:[{className:"primary",message:b.dragDropWidgetFromCompass}]}):u.open()},_onAddTabClick:function(){g.track({category:"dashboard.use",action:"addTabTopBarItem-topFrameManager"}),w.closeCoachmark(),l.addTab()},_onAddDashboardClick:function(){g.track({category:"dashboard.use",action:"addDashboardTopBarItem-topFrameManager"}),w.closeCoachmark(),l.addDashboard()},_onAddStoryClick:function(){g.track({category:"dashboard.use",action:"addStoryTopBarItem-topFrameManager"}),m.add()},_onShareWidgetClick:function(){var e=w.getFullscreenWidgetId();if(e||(e=w.getMaximizedWidgetId()),!e&&F&&(e=F),!e){var t=s._getActiveTab();if(t){var n=t.environment.getChildren();1===n.length&&(e=n[0].id)}}e?(g.track({category:"dashboard.use",action:"shareWidgetTopBarItem-topFrameManager"}),w.closeCoachmark(),l.shareWidget(e)):l.showAlert({autoHide:!0,closeOnClick:!0,messages:[{message:b.topBarShareWidgetInfoAlert,className:"primary"}]})},_onShareTabClick:function(){g.track({category:"dashboard.use",action:"shareTabTopBarItem-topFrameManager"}),w.closeCoachmark(),l.shareTab()},_onShareContextClick:function(){var e=s._getActiveContext();if(g.track({category:"dashboard.use",action:s._isEndUserCockpitContext(e)?"shareCockpitTopBarItem-topFrameManager":"shareDashboardTopBarItem-topFrameManager"}),!e)return Promise.reject();l.shareContext(e.modelId,{private:!0,public:!0,live:!0}).catch(function(){})},_onHelpClick:function(){l.openHelpWindow()},_openMePreferencesDialog:function(){return new Promise(function(e,t){require(["DS/MePreferencesDialog/MePreferencesUIProxy"],function(n){(new n).GetPreferenceDialog().then(function(t){if(!t)throw new Error("MePreferencesDialog is empty (platform id is mandatory in the url, please check your url).");t.getContent().addClassName("ifwe-me-preferences-dialog").inject(document.body),e()}).catch(function(e){console.error(e),t(new Error("Error on opening MePreferencesDialog."))}),g.track({category:"dashboard.use",action:"openMePreferencesDialog-topFrameManager"})},t)})},_openMyPreferencesModal:function(){return new Promise(function(e,t){require(["DS/W3DXComponents/LanguagePicker","DS/UWPClientCode/I18n"],function(t,n){var a=new t({availableLanguagesGetter:n.getSupportedLanguages,currentLanguageGetter:n.getCurrentLanguage,currentLanguageSetter:n.setCurrentLanguage,passportUrl:r.getApplicationConfiguration("app.urls.passport")});a.render().inject(document.body),a.show(),g.track({category:"dashboard.use",action:"languagePickerModalOpen-topFrameManager"}),e()},t)})},_openMyProfileWdg:function(e){var t=r.getCachedCurrentUser();h.show({appId:"X3DPRFL_AP",data:{userId:t.externalId,login:t.login,url:e.url}})},_openMyProfileModal:function(){require(["DS/UWPCrypto/UWPCrypto","DS/UWPClientControls/Modal"],function(t,n){var a,i,o,s;(a=r.getApplicationConfiguration("app.urls.passport"))?(a=a.replace(/\/$/g,""),a+="/ds-connect-profile/service/3dexperience_profile/?dsconnect-client-proxy=",a+=t.base64Encode(window.dsBaseUrl+"?page=dsconnect"),o=e.createElement("div",{class:"ifwe-loading-my-profile",text:b.loadingMessage}),s=e.createElement("iframe",{class:"ifwe-my-profile-iframe",src:a,frameborder:0,width:"100%",height:"100%",events:{load:function(){o.hide(),s.show()}}}),i=e.createElement("div",{class:"ifwe-my-profile-ctn",html:[o,s]})):i=e.createElement("div",{text:"App passport url is unknow."}),O&&O.elements?(O.setBody(i),O.show()):O=new n({title:b.myProfileItem,className:"ifwe-my-profile-modal",destroy:!0,content:i,display:!0,displayHeader:!0,displayFooter:!1,overlay:!0,clickToClose:!1,closable:!0,maximizable:!0}),g.track({category:"dashboard.use",action:"myProfileModalOpen-topFrameManager"})})}}}),define("DS/Dashboard/Layout/Tab",["UWA/Core","UWA/Promise","DS/PubSub/PubSub","DS/UWPClientCode/I18n","DS/UWPClientControls/PlatformNotify","DS/UWPClientCode/Undo","DS/WebappsUtils/Map","DS/Dashboard/PublicAPI","DS/Dashboard/Utils","DS/Dashboard/WidgetLinkManager","DS/Dashboard/DashboardManager","DS/Dashboard/GridManager","DS/Dashboard/DockLayoutManager","DS/Dashboard/Layout/Dashboard","DS/Dashboard/UsageTracker","DS/Dashboard/NewDashboardMenu","DS/Dashboard/Environment","DS/Dashboard/Navigation","i18n!DS/Dashboard/assets/nls/layout"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v){"use strict";var w,D=300,_=new r,C=[],I=["X3DWNEW_AP","X3DMCTY_AP"];function S(e){var t,n=!1,a=[3,3,5,8,11,13,16,19,21,24,27,29,32,35,37,40];try{n=!!((t=JSON.parse(e.coordinates)||{}).mobile||t.tablet||t.desktop),(t.sm||t.md||t.lg||t.xl)&&!n?(t.mobile=t.sm,t.tablet=t.md,t.desktop=t.xl,["mobile","tablet","desktop"].forEach(function(e){t[e]?(t[e].sizey=a[Math.min(t[e].sizey||0,15)],t[e].row+=10):delete t[e]})):(t.row||t.col||t.sizex||t.sizey)&&!n&&(t.desktop={col:t.col,row:t.row,sizex:t.sizex,sizey:t.sizey},t.desktop.sizey=a[Math.min(t.sizey||0,15)]),delete t.sm,delete t.md,delete t.lg,delete t.xl,delete t.col,delete t.row,delete t.sizex,delete t.sizey,e.coordinates=JSON.stringify(t)}catch(t){console.warn("Unable to convert widget instance ("+e.id+") coordinates: "+e.coordinates)}}function y(e){var t,n=e.widget,a=n.environment.wp.children;0!==a.length&&(t=setInterval(function(){if(!n.body.isInjected())return clearInterval(t);var i=s._getTabProperties(n.id),o=a.filter(function(e){return i.lastMaximizedWidgetId===e.id})[0];n.body.querySelector(".r2g-widget, .dock-item")&&n.body.style.height&&!n.body.getParent(".wp-tab-panel").isHidden()&&(!o||o.widget&&o.el.clientWidth===n.body.clientWidth)&&(clearInterval(t),o?setTimeout(e.callback,D+100):e.callback())},200))}function E(n,a,i){var o=n.environment.wp.children,r=require("DS/Dashboard/GridManager").get(),d=require("DS/Dashboard/DockLayoutManager").get();function l(e){e.dispatchEvent=function(){},e.widget.environment.toggleMaximize(),delete e.dispatchEvent}function c(t){var o,l=a.minimizedWidgetIds[t.id],c=e.clone(a.minimizedWidgetIds);r?(o=r.findWidget(t.el).sizey,r.resize({widget:t.el,sizey:1===o?l:1}),i||(c[t.id]=o,s.setTabProperty(n.id,"minimizedWidgetIds",c))):d&&i&&d.setDefaultViewMode(t.el)}return a=a||{},new t(function(e){var t=a.lastMaximizedWidgetId||Object.keys(a.minimizedWidgetIds||{}).length>0?D+100:0;o.filter(function(e){return a.minimizedWidgetIds&&a.minimizedWidgetIds[e.id]}).forEach(c),o.filter(function(e){return a.lastMaximizedWidgetId===e.id}).forEach(l),setTimeout(e,t)})}function T(e,t){e.forEach(function(e){var n=_.get(e.id);n&&(document.querySelector('.action-undo[data-id="'+e.id+'"]').parentElement.hide(),n.undoDecline(),t&&C.push(e.id))})}function A(t){var n=e.clone(t.getValue("layout"));Object.keys(n).forEach(function(e){e!==t.layout.breakpoint&&"master"!==e&&delete n[e]}),t.setValue("layout",n)}w=function(){var e=new WeakMap,t=new r,a=window.WeakRef;function i(e){var n=t.get(e),a=n&&n.deref();a&&a()}return a||((a=function(e){this._ref=e}).prototype.deref=function(){return this._ref}),n.add(s.events.story.next,function(t){var n=e.get(t.element);n&&n()}),n.add(s.events.environment._widgetInstanceReady,function(e){var t;try{t=l.getLinked(e.id)}catch(e){return}t.forEach(i)}),n.add(s.events.widget._link,function(e){var t=[e.source,e.target];t.filter(d.getRegisteredWidgetInstance).length>0&&t.forEach(i)}),function(n,i){e.set(n.element,i),t.set(n.widget.id,new a(i))}}();var P={init:function(t,o){var r=this,d=s.events.widget.add+this.wp.id,l=s._getTabProperties(t.id),c=l.lastMaximizedWidgetId,u=b.getUrlParameter(b.parts.fullscreen),h=Object.keys(l.minimizedWidgetIds||{});t.serviceName=s._getServiceName(),n.has(d)||n.add(d,function(e,t,n,o){e.coordinates=JSON.stringify(t),e.success=n,e.widgetIdOrUrl=e.url,e.name=e.name||e.title||"",e.serviceName=s._getServiceName(),e.failure=function(t){var n;t&&"TOO_MANY_WIDGETS"===((t||[])[1]||{}).errorType&&(n=v.tooManyWidgets),i.error(a.replace(n||v.noWidgetFound,{name:e.name})),o&&o()},g.track({category:"widget.create",action:"add-tabLayout"}),r.addWidget(e)}),d="widgetAddFromCatalog-"+this.wp.id,n.has(d)||n.add("widgetAddFromCatalog-"+this.wp.id,function(e){e.coordinates=e.coordinates&&JSON.stringify(e.coordinates),r.addWidget(e),g.track({category:"widget.create",action:"addFromCatalog-tabLayout"})}),t.layout=r,r.lazy={mode:"viewport",maxSimultaneous:3,loadedEvent:"loaded",scrollTarget:t.elements.module.getParent(".wp-tabview-panel"),sorter:function(e,t){var n=e.widget,a=t.widget,i={},o={},r=e.element.getBoundingClientRect(),s=t.element.getBoundingClientRect();try{i=JSON.parse(n.data)}catch(e){}try{o=JSON.parse(a.data)}catch(e){}return[c,u].indexOf(n.id)>-1||h.indexOf(a.id)>-1||2===a.isolationLevel||o.x3dUntrustedContent?-1:[c,u].indexOf(n.id)>-1||h.indexOf(n.id)>-1||2===n.isolationLevel||i.x3dUntrustedContent?1:r.top-s.top||r.left-s.left},forceLoad:function(e,t){w(e,t),[c,u].indexOf(e.widget.id)>-1&&t()},onQueueStable:function(){n.dispatch(s.events.tab._loadingStable,t)}},e.is(o,"function")?o():o.refreshIfVisible()},onBeforeLoad:function(t,a,i,o){var r,d,l=0,u=s._getSwymPlatform();switch(i.slice().forEach(function(e){var t=C.indexOf(e.id);t>-1&&(i.splice(i.indexOf(e),1),C.splice(t))}),o._masterLayout=o.getValue("layout").master||t,0===i.length&&A(o),t){case"grid":(function(e,t,n){n.body.setStyle("height",""),e.namespace="ifwe-tabview",e.proxy=!0,e.height=44,e.margins="7 7",e.maxSize="12 32",e.breakpoints="mobile:1:1:2 tablet:6:2:2 desktop:12:2:2",e.viewport=n.body.getParent(".wp-tabview-panel"),e.defaultCoordinates=s._getDefaultModuleCoordinates()}).call(this,a,i,o);break;case"dock":(function(e,t,a){var i={};function o(e,t,n){var r=t[t.length-1],s=r.root.getRectangle(),d={width:a.body.clientWidth,height:a.body.clientHeight},l=!a.body.getParent(".wp-tab-panel").isHidden()&&d.height<s.height,u=d.width/r.sizes.minItemWidth|0||1;(i.width!==d.width||i.height!==d.height||d.width!==s.width&&d.width>r.sizes.minItemWidth||l)&&(a.body.getElement(".dock-placeholder")?setTimeout(o.bind(this,null,t,n),100):(r.maximizedItem||(r.restoreState(!0),r.setMaxAlignedItems("horizontal",u),r.paint(),n&&(r.commitState(),a.layout.reorder())),c.setOverflowMessageDisplayed(l,function(){c.fitTab(a.id,!1)}),i=d)),"function"==typeof e&&e.apply(this,t)}var r=e.onChange,d=e.onResize,l=e.onBeforeFirstPaint;a.body.setStyle("height",document.body.getBoundingClientRect().height-a.body.getBoundingClientRect().top),e.sizes={splitter:24,minItemWidth:160,minItemHeight:100,minimizedItemHeight:44},e.onChange=function(e){o.call(this,r,arguments,"addChild"===e)},e.onResize=function(){o.call(this,d,arguments)},e.onBeforeFirstPaint=function(t){var i=Object.keys(s._getTabProperty(a.id,"minimizedWidgetIds")||{});[].forEach.call(t.element.querySelectorAll(".dock-item"),function(e){-1!==i.indexOf(e.dockItem.content)&&t.minimize(e)}),n.addOnce("onAfterLoadDockLayout-"+a.id,function(){t.restoreWeights(e.structure),t.paint()}),l&&l.apply(this,arguments)}}).call(this,a,i,o);break;default:throw new Error("Unsupported layout type: "+t)}for(;l<i.length;)d=!1,(r=i[l]).customEnvironment=p,r.el=r.el||e.createElement("div",{class:"module",styles:{opacity:.5},html:[{tag:"div",class:"module-mask"}]}),r.callback=function(e){var t=e.el.getElement(".module-mask");e.el.setStyle("opacity",null),setTimeout(function(){t&&t.setStyle("opacity",0),setTimeout(function(){t&&t.remove()},700)},300)},u&&u.url||-1===I.indexOf(r.appId)||(i.splice(l,1),d=!0),"grid"===t&&S(r),!d&&l++},onAfterLoad:function(e,t,a){var i=a.getValue("layout")[this.breakpoint];switch(e){case"grid":(function(e,t){u.register(e),t.getValue("fit")&&y({widget:t,callback:function(){t.deleteValue("fit"),t.setValue("layout",{desktop:"grid",tablet:"grid",mobile:"grid"}),c.fitTab(t.id,!0)}})}).call(this,t,a);break;case"dock":(function(e,t){h.register(t),c.fitTab(t.id,!0),n.dispatch("onAfterLoadDockLayout-"+t.id)}).call(this,t,a)}m.resizeTab({widget:a.environment.wp.parent.widget,noTracking:!0}),i&&i!==a._masterLayout&&y({widget:a,callback:function(){c.fitTab(a.id,"dock"===a._masterLayout),delete a._masterLayout}}),this.wp.children.forEach(function(e){var t=e.el,n=e.id;t.setAttribute("id","m_"+n),t.addClassName("wi-"+n)}),f.onAfterTabLoad()},onBeforeConvert:function(e,t,n,a,i,o){var r=this;return o._initialTabProperties=s._getTabProperties(o.id),T(a),"grid"===t&&c.setOverflowMessageDisplayed(!1),E(o,o._initialTabProperties,!0).then(function(){switch(e){case"grid":u.unregister(o.id);break;case"dock":h.unregister(o.id)}"dock"===t&&(o.body.getParent(".wp-tabview-panel").scrollTop=0),P.onBeforeLoad.call(r,t,n,a,o)})},onAfterConvert:function(e,n,a,i){var o=i._initialTabProperties;return delete i._initialTabProperties,P.onAfterLoad.call(this,n,a,i),new t(function(e){return setTimeout(e,300)}).then(E.bind(null,i,o))},onBeforeAddChild:function(e,t){c.disableWidgetsLinksMode(),e.customEnvironment=p,e._isNew=!0},onAddChild:function(e,t){var n,a;e.sourceId&&(a=(n=s._getTabProperty(t.id,"minimizedWidgetIds"))&&n[e.sourceId])&&(n[e.id]=a,s.setTabProperty(t.id,"minimizedWidgetIds",n))},onRemoveChild:function(e,t,n){var a,i,r=e.widget.environment,d=this.activeLayout,l=d.getChildCoordinates(r.html.module),c=this;a={id:e.id,undoPending:function(){(i=r.isMaximized())&&r.toggleMaximize(),1===c.wp.children.length&&A(t),d.removeChild(r.html.module)},undoAgree:function(){_.get(e.id)&&(r.embedded&&(r.embedded.launched=!1),d.addChild({el:r.html.module,id:e.id,coordinates:l}),i&&r.toggleMaximize(),_.delete(e.id))},undoDecline:function(){if(_.get(e.id)){var a=s._getTabProperty(t.id,"minimizedWidgetIds");a&&a[e.id]&&(delete a[e.id],s.setTabProperty(t.id,"minimizedWidgetIds",a)),g.track({category:"widget.delete",action:"deleteWidget"}),g.track({category:"dashboard.use",action:"removeWidget-topFrameManager"}),_.delete(e.id),n()}}},Object.defineProperty(a,"name",{get:function(){return e.widget.environment.getName()}}),_.set(e.id,a),o.addAction(a)},onDestroy:function(){T(this.wp.children,!0)}};return P}),define("DS/Dashboard/TopBar/DDMenu/ContextMenu",["UWA/String","DS/PubSub/PubSub","DS/UWPClientControls/Utils","DS/WidgetPreview/Controller/TransientManager","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/Utils","DS/Dashboard/DashboardManager","DS/Dashboard/ManageDashboardManager","DS/Dashboard/StoryManager","DS/Dashboard/DDMenu/Abstract","DS/Dashboard/UsageTracker","DS/Dashboard/CommentPanelManager","i18n!DS/Dashboard/assets/nls/dd_menu"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m){"use strict";var g,f=!1,p=!1,b=c.NOT_CLICKABLE_CLASS,v=Object.assign({},c.BE_USAGE_ITEM),w=c.DELETE_ITEM,D=c.DUPLICATE_ITEM,_=c.EDIT_ITEM,C=c.MANAGE_ITEM,I=c.SHARE_ITEM,S=c.COMMENT_ITEM,y=Object.assign({},c.STORY_ITEM),E=c.UNSHARE_ITEM,T=v.id,A=w.id,P=D.id,x=_.id,M=C.id,k=I.id,N=S.id,W=y.id,L=E.id;return v.className=[v.className||"",b].join(" "),y.className=[y.className||"",b].join(" "),(g=c.extend({_items:[I,_,S,D,C,w,E,y,v],init:function(e){f=o.isBELayoutEditorMode(),p=i._getApplicationConfigurationBoolean("app.dashboardstory.enable"),e.className=[e.className||"","dashboard-dd-menu"].join(" "),e.closeOnClick=!1,e.onClick=this._onItemClick.bind(this),e.onShow=this._onShowMenu.bind(this),e.onHide=this._onHideMenu.bind(this),this._parent(e),this._initEvents(),this._initItems()},destroy:function(){this._removeEvents(),this._parent()},_initEvents:function(){var e=this;p&&(e._onStoryUpdate=function(){e._initStoryItems()},t.add(i.events.story.updated,e._onStoryUpdate,null,!0))},_removeEvents:function(){p&&t.remove(i.events.story.updated,this._onStoryUpdate)},_onItemClick:function(e,t){var n=t.id,a=t.elements.container,o=i._getActiveContext(),r=o.modelId,l=![b,"item-back"].some(function(e){return a.hasClassName(e)});switch(n){case A:s.deleteDashboard(r);break;case P:s.duplicateContext({modelId:r,navTo:!0});break;case x:s.renameDashboard(r);break;case M:d.open({contextModelId:o.modelId});break;case k:s.shareContext(r,{private:!0,public:!0,live:!0}).catch(function(){});break;case N:h.isOpen()?h.close():h.open();break;case L:s.unShareDashboard(r)}u.track({category:"dashboard.topBarMenu",action:t.name+"Item"}),l&&this.hide()},_onShowMenu:function(){a.getInstance().isWidgetOpen()?this.disableItem(W):this.enableItem(W),u.track({category:"dashboard.topBarMenu",action:"show"})},_onHideMenu:function(){u.track({category:"dashboard.topBarMenu",action:"hide"})},_initItems:function(){var e=i._getActiveContext(),t=[],n=[];t=[N,M],i._isDefaultContext(e)?t.push(P):i._isOwnerContext(e)&&t.push(k,N,x,P,A),i._isUnShareableContext(e)&&t.push(L),i._isBusinessExpInstanceContext(e)&&n.push(k),f&&n.push(k,N,P,A,x,M,W,T),this.showItems(t),this.hideItems(n),this._initStoryItems(),i._isBusinessExpInstanceContext(e)&&this._initBEUsageItems()},_initStoryItems:function(){if(!p||f)return Promise.resolve();var e=this,t="storyScenario",a="storyScenarioAction",o=i._getActiveContext();if(e.destroyed||!o)return Promise.resolve();function s(e){return t+"-"+function(e){return e.item[0].id}(e)}function d(e,t){return e+"-"+a+"-"+t}return l.getScenarios().then(function(t){if(!e.destroyed){var a=o.owner&&r.isEditionFriendlyDevice(),i=function(e){var t=e.scenarios||[],n="boolean"!=typeof e.handler||e.handler;return t.map(function(e){var t,a=s(e),i=e.item[0];return t={parentItemId:W,id:a,name:a,text:i.title,className:["story-scenario-item",n?"":b].join(" "),fonticon:"play"},n&&(t.handler=function(){l.start({index:e.index})}),t})}({scenarios:t,handler:!a});e.removeChildrenItems(W),i.length||o.owner&&!n.hasTouch()?(e.showItem(W),a&&e.addItem({parentItemId:W,id:"addStory",name:"addStory",text:m.addStory,fonticon:"plus",className:"story-add-item",handler:function(){l.add()}},0),e.addItems(i),a&&e.addItems(function(e){return(e||[]).reduce(function(e,t){var n=s(t);return e.concat([{parentItemId:n,id:d(n,"playStory"),name:"playStory",text:m.playStory,fonticon:"play",className:"story-play-item",handler:function(){l.start({index:t.index})}},{parentItemId:n,id:d(n,"duplicateStory"),name:"duplicateStory",text:m.duplicateStory,fonticon:"copy",className:"story-duplicate-item",handler:function(){l.duplicate({index:t.index})}},{parentItemId:n,id:d(n,"deleteStory"),name:"deleteStory",text:m.removeStory,fonticon:"trash",className:"story-delete-item",handler:function(){l.remove({index:t.index})}}])},[])}(t))):e.hideItem(W)}})},_initBEUsageItems:function(){if(f)return Promise.resolve();var t,n=this,a="beUsage",r=i._getActiveContext();if(n.destroyed||!r)return Promise.resolve();return t=r.modelId,i.fetchBusinessExperienceUsages({context:r}).then(function(r){var s=(r||{}).usages,d={};!n.destroyed&&s.length?(s.forEach(function(e){var t;try{t=JSON.parse(e.content).data.items[0].objectId}catch(t){console.error("Fail to get context modelId from usage:",e,t)}t&&!i._getContext(t).deletionDate&&(d[t]=e)}),Object.keys(d).length<2?n.hideItem(T):(n.showItem(T),Object.keys(d).forEach(function(i){var r,s=d[i];n.addItem({parentItemId:T,id:(r=i,a+"-"+r),name:"beUsage-"+i,text:e.escapeHTML(s.title),className:["be-usage-ctx-item",i===t?"selectable selected":""].join(" "),handler:function(){o.routeTo({dashboard:i})}})}))):n.hideItem(T)})}})).BE_USAGE_ITEM_ID=T,g.DELETE_ITEM_ID=A,g.DUPLICATE_ITEM_ID=P,g.EDIT_ITEM_ID=x,g.MANAGE_ITEM_ID=M,g.SHARE_ITEM_ID=k,g.COMMENT_ITEM_ID=N,g.STORY_ITEM_ID=W,g.UNSHARE_ITEM_ID=L,g}),define("DS/Dashboard/Views/DashboardSettingsView",["UWA/Class/View","DS/UIKIT/Alert","DS/Dashboard/UsageTracker","DS/Dashboard/Views/DashboardSettingsViews/BackgroundSectionView","DS/Dashboard/Views/DashboardSettingsViews/ThumbnailSectionView"],function(e,t,n,a,i){"use strict";return e.extend({tagName:"div",className:"dashboard-settings",platformSection:null,backgroundSection:null,thumbnailSection:null,alert:null,manageDashModal:null,setup:function(e){this.manageDashModal=e.modal},render:function(){return this.build(),n.track({category:"manageDashboard.settingsFacet",action:"render"}),this},showNotif:function(e){var n,a;a=(e=e||{}).type&&"error"!==e.type,this.hideNotif(),this.alert=n=new t({animate:!1,closable:!0,visible:!0,autoHide:a,hideDelay:4e3,className:"settings-notif"}).inject(this.manageDashModal.elements.body,"top"),n.add({message:e.msg,className:e.type||"error"})},hideNotif:function(){this.alert&&this.alert.destroy(),this.alert=null},destroy:function(){this.alert&&this.alert.destroy(),this.alert=null,this.platformSection&&this.platformSection.destroy(),this.platformSection=null,this.backgroundSection&&this.backgroundSection.destroy(),this.backgroundSection=null,this.thumbnailSection&&this.thumbnailSection.destroy(),this.thumbnailSection=null,this._parent.apply(this,arguments)},build:function(){var e=this.container,t=this.model;t.get("owner")&&(this.backgroundSection=new a({parentView:this,model:t,modal:this.manageDashModal}),this.backgroundSection.render().inject(e),this.thumbnailSection=new i({parentView:this,model:t,modal:this.manageDashModal}),this.thumbnailSection.render().inject(e))},onFacetSelect:function(){this.hideNotif(),n.track({category:"manageDashboard.settingsFacet",action:"select"}),this.platformSection&&this.platformSection.onFacetSelect(),this.backgroundSection&&this.backgroundSection.onFacetSelect()}})}),define("DS/Dashboard/ManageDashboard/Actions/MembersActions",["UWA/Core","UWA/String","DS/PubSub/PubSub","DS/UWPClientCode/I18n","DS/UWPClientControls/PlatformNotify","DS/Dashboard/UsageTracker","DS/Dashboard/PublicAPI","DS/Dashboard/Modal","DS/Dashboard/Models/Member","DS/Dashboard/DashboardManager","DS/Dashboard/ManageDashboard/Controller/ManageDashboard","DS/Dashboard/ManageDashboard/ManageDashboard","DS/Dashboard/Collections/Members","DS/Dashboard/Views/DashboardSettingsView","DS/Dashboard/Views/SearchableMemberSet","DS/Dashboard/ManageDashboard/Views/MainView","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/EmptyView","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v){function w(e,n,a){function r(){return n.collection.filter(function(e){return e.isOwner()}).length}var s=r();return l.updateDashboardMemberAccess({dashboardId:e,member:n,role:a}).then(function(e){var d;n.setRole(a),_.memberActions.call(n),(Array.isArray(e)?e:[]).forEach(function(e){i.warn(e.message)}),((d=r())<2||d>=2&&s<2)&&n.collection.fetch({reset:!0}),i.success(v.membersUpdateSuccess),o.track({category:"manageDashboard.member",action:"setUser"+t.capitalize(t.camelCase(a))+"Btn"})}).catch(function(e){(Array.isArray(e)?e:[]).forEach(function(e){i.warn(e.message)})})}function D(e){var t=e.rootElement,n=e.elementCssToHide,a=e.elementCssToShow,i=e.emptyViewCss,o=t.getElement(n),r=t.getElement(a),s=t.getElement(i);return s&&s.destroy(),o&&o.hide(),!(!r||!r.isHidden())&&(r.show(),!0)}var _={membersFacetActions:function(){var e=this.model.get("owner")?[{id:"addMembers",title:v.addMemberAction,icon:"user-add",context:!0,overflow:!1}]:void 0;return new p(e)},membersFacetActionsHandler:function(e,t,n){"addMembers"===n.model.get("id")&&(this.togglePanel(),o.track({category:"manageDashboard.member",action:"addMemberBtn"}))},memberActions:function(){var e=[],t=r._getContext(this.collection.dashboardId),n=this.collection.nbOfOwners,a=c.membersCollectionBeforeFilter?c.membersCollectionBeforeFilter:this.collection,i=t.owner,o=this.isCurrentUser();function s(){e.push({id:"setMemberOwner",title:v.setOwnerAction,icon:"lock-open",overflow:!0})}function l(){e.push({id:"setMemberContributor",title:v.setContributorAction,icon:"pencil",overflow:!0})}function u(){e.push({id:"setMemberReader",title:v.setReaderAction,icon:"lock",overflow:!0})}if(i&&(o&&n>=2||!o&&(n>=2||1===n&&!function(e){return a.some(function(t){return t.isGroup()&&t.isOwner()&&e.getName()===t.getName()})}(this))||o&&!this.isOwner())){switch(this.getRole()){case d.OWNER_ROLE:u(),l();break;case d.CONTRIBUTOR_ROLE:u(),s();break;case d.READER_ROLE:l(),s()}e.push({id:"removeMemberAccess",title:v.revokeAction,icon:"block",overflow:!0})}return this.isGroup()&&e.push({id:"viewGroupMembers",title:v.viewMembersAction,icon:"eye",overflow:!0}),this._actions?this._actions.reset(e):this._actions=new p(e),this._actions},memberActionsHandler:function(e,t){var h,m=this.model,g=t.model.get("id"),f=m.collection,p=f.dashboardId,b=r._isEndUserCockpitContext(p);switch(g){case"setMemberReader":w(p,m,d.READER_ROLE);break;case"setMemberContributor":w(p,m,d.CONTRIBUTOR_ROLE);break;case"setMemberOwner":w(p,m,d.OWNER_ROLE);break;case"removeMemberAccess":h=c.selectedDashboardModel,l.removeDashboardMemberAccess(p,m).then(function(e){var t;f.remove(m),e.isAccessRemovedForCurrentUser?h&&h.collection.remove(h):(t=f.size(),h&&h.set("membersCount",t)),e.isCurrentUser&&u.show({refresh:!0}),f.filter(function(e){return e.isOwner()}).length<2&&f.fetch({reset:!0}),n.dispatch(r.events.member.remove,[{dashboardId:p,member:m}]),e.isCurrentUser?i.success(b?v.ownerRevokeSuccessForCockpit:v.ownerRevokeSuccess):i.success(b?v.membersRevokeCockpitSuccess:v.membersRevokeSuccess)}),o.track({category:"manageDashboard.member",action:"removeUserBtn"});break;case"viewGroupMembers":!function(e){require(["DS/i3DXRDFGroupViewer/js/GroupViewer"],function(t){var n=new t({platformId:e.getGroupPlatform(),groupId:"uuid:"+e.getId(),language:a.getCurrentLanguage()});_.viewGroupMembersModal&&(_.viewGroupMembersModal.destroy(),delete _.viewGroupMembersModal),_.viewGroupMembersModal=new s({header:"<h4>"+v.viewGroupMembersTitle+"</h4>",className:"manage-db-modal",body:n.render(),closable:!0}),_.viewGroupMembersModal.show()})}(m)}},addMembers:function(e){var t=this.collection,s=t.dashboardId,l=e.length,u=[],h=[],m=[],g=r._isEndUserCockpitContext(s);e.forEach(function(e){var t={};switch(Object.keys(e.item).forEach(function(n){t[n]=e.item[n]}),e.categoryId){case d.OWNER_ROLE:u.push(t);break;case d.CONTRIBUTOR_ROLE:h.push(t);break;case d.READER_ROLE:m.push(t)}}),r.addContextMembers({id:s,newOwners:u,newContributors:h,newReaders:m,sendEmail:!0,success:function(e,o){var d=((e=e||{}).acl||{membersCount:2}).membersCount,l=e.membersAdded,f=l>1?g?a.replace(v.membersAddToCockpitSuccess,{count:l}):a.replace(v.membersAddSuccess,{count:l}):g?v.memberAddToCockpitSuccess:v.memberAddSuccess;n.dispatch(r.events.member.add,[{owners:u,contributors:h,readers:m,dashboardId:s,membersCount:d}]),c.selectedDashboardModel.set("membersCount",d),(Array.isArray(o)?o:[]).forEach(function(e){i.warn(e.message)}),i.success(f),t.fetch({reset:!0})},failure:function(e){(Array.isArray(e)?e:[]).forEach(function(e){i.error(e.message)}),i.error(l>1?g?v.membersAddToCockpitFailure:v.membersAddFailure:g?v.memberAddToCockpitFailure:v.memberAddFailure),t.fetch({reset:!0})}}),o.track({category:"manageDashboard.member",action:"addMembers"})},idCardDashboardFacets:function(){var e=this,t=e.get("modelId"),n=[];return c.selectedCategory&&c.selectedCategory.toLowerCase()===f.RECYCLE_BIN_PANEL.toLowerCase()&&(e._attributes.owner=!1),c._platform&&!r._isAnyDefaultContext(t)&&n.push({text:v.membersFacetTitle,icon:"users",handler:function(){var e=this.container.parentElement||this.container.ownerDocument.getElement(".dashboard-details-container");if(!D({rootElement:e,elementCssToHide:".dashboard-settings",elementCssToShow:".members-facet",emptyViewCss:".empty-view"})){var t=new h([],{dashboard:this.model,actions:c.members.collection.actions});c.members.collection=t,t.fetch({onComplete:function(){new g(c.members).render().inject(e,"bottom")}})}}}),n.push({text:v.settingsFacetTitle,icon:"cog",handler:function(){var t=this.container.parentElement||this.container.ownerDocument.getElement(".dashboard-details-container");D({rootElement:t,elementCssToHide:".members-facet",elementCssToShow:".dashboard-settings",emptyViewCss:".empty-view"})||(e.get("owner")?new m({modal:c.manageDashboardModal,platforms:c._platforms,model:this.model}).render().inject(t,"bottom"):new b({icon:"cog",title:v.noFacetTitle,model:this.model}).render().inject(t,"bottom"))}}),n}};return _}),define("DS/Dashboard/TopBar/DDMenuManager",["UWA/Core","DS/UIKIT/Tooltip","DS/UWPClientControls/Utils","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/DashboardManager","DS/Dashboard/Utils","DS/Dashboard/CompassManager","DS/Dashboard/WidgetPreviewManager","DS/Dashboard/TopBar/API","DS/Dashboard/TopBar/DDMenu/ContextMenu","DS/Dashboard/TopBar/DDMenu/WidgetMenu","DS/Dashboard/TopBar/DDMenu/AddinModeMenu","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m){"use strict";var g,f,p=!1;function b(){}function v(){var e,t,n=d.getActiveAppId(),a={addinmode:!0,swamode:!0};p?e=i.buildAppUrl({appId:n,paramsToRemove:a}):(function(e){try{return JSON.stringify(e),!0}catch(e){return console.warn("Widget data cannot be processed"),!1}}(t=d.getUpdatedStartingData(n))||(console.error("Widget data cannot be stringifyed, so will be ignored."),t=null),(e=i.buildAppUrl({appId:n,data:t,paramsToRemove:a})).length>=2048&&console.warn("URL length is too long. Browsers may not handle it correctly.")),e&&window.open(e,"_blank")}return g={names:{context:"context_menu",fullscreenWidget:"fullscreen_widget_menu",fullscreenWidgetPreview:"fullscreen_widget_preview_menu",addinMode:"addin_mode_menu",lockedAppMode:"locked_app_mode_menu",swaMode:"swa_mode_menu"},_menu:null,_menuName:null,_tooltip:null,_widget:null,init:function(){f=require("DS/Dashboard/TopFrameManager"),p=i.isSWAMode()},update:n.debounce(function(e){var t=(e=e||{}).name;t&&t!==g._menuName||g._update(e.opts)},300),build:function(e){var t=e.name,n=e.opts;t!==g._menuName?(g.destroy(),g._widget=(n||{}).widget||null,"context_menu"===t?g._buildContextMenu(n):"fullscreen_widget_menu"===t?g._buildFullscreenWidgetMenu(n):"fullscreen_widget_preview_menu"===t?g._buildFullscreenWidgetPreviewMenu(n):"addin_mode_menu"===t?g._buildAddinModeMenu(n):"locked_app_mode_menu"===t?g._buildLockedAppModeMenu(n):"swa_mode_menu"===t?g._buildSWAModeMenu(n):console.error("Invalid menu name:",t)):g.update(e)},hide:function(){var e=g._menu;e&&e.hide()},updateItemsVisibility:function(){var e=g._menu,t=g._widget;if(e&&t&&e.getActionElement&&!e.getClassNames().includes("dashboard-dd-menu-topbar")){var n=t.environment,i=e.getActionElement("preferences"),r=e.getActionElement("linkWithWidgets"),s=e.getActionElement("searchInWidget");i&&(t.hasPreferences()?(i.show(),t.isEdit?e.disableItem("preferences"):e.enableItem("preferences")):i.hide()),r&&(a._isOwnerContext(a._getActiveContext())&&n.isLinkable()?(r.show(),o.isWidgetsLinksModeEnabled()?e.disableItem("linkWithWidgets"):e.enableItem("linkWithWidgets")):r.hide()),s&&(n.wp.noSearchInWidgetUI?s.hide():s.show())}},updateCustomItem:function(){var e=g._menu,t=g._widget;if(e&&t){var n=t.metas||{},a=n._customItem,i=t.environment;e.items&&a&&i&&i.isEditable()&&(n._isCustomItemToDisplay&&!e.getItem(a.name)?e.addItem({id:a.id,name:a.name,icon:a.icon,fonticon:a.fonticon,className:a.className,text:a.text,title:a.title,handler:function(){t.dispatchEvent(a.event)}}):e.removeItem(a.name))}},destroy:function(){g._menu&&(g._tooltip&&(g._tooltip.destroy(),g._tooltip=null),g._menu&&(g._menu.destroy(),g._menu=null),g._menuName=null,g._update=b,g._widget=null,l.getTitleMenuAppMenuElement().empty(),g._toggleHasDDMenuClass(!1))},_update:b,_buildContextMenu:function(){var e=!0;g._menuName="context_menu",g._update=function(){var t=a._getActiveContext();t&&!t.deletionDate?(e&&(g._buildOpenMenuIcon(),g._toggleHasDDMenuClass(!0),e=!1),g._menu&&g._menu.destroy(),g._menu=new c(g._getDefaultMenuOpts()),g._setTooltip('"'+l.getTitleName()+'" '+m.dashboardMenu)):g.destroy()},g._update()},_buildFullscreenWidgetMenu:function(e){var t,r,s,d="showSWAQRCode",c="openSWA",h=e.widget,m=h.environment,p={searchInWidget:m.showSearchInWidgetView.bind(m),preferences:m.togglePreferences.bind(m),linkWithWidgets:m.toggleWidgetsLinksMode.bind(m),share:function(){o.shareWidget(h)},refresh:m.toggleRefresh.bind(m),help:m.displayHelp.bind(m),exitFullscreen:f.exitFullscreenWidget,showSWAQRCode:m.showSWAQRCodeModal.bind(m),openSWA:m.openSWA.bind(m)},b=["searchInWidget","preferences","linkWithWidgets","share","refresh","help",d,c,"exitFullscreen"],v=m.isEditable()?b:["refresh","help","exitFullscreen"];i.isBELayoutEditorMode()&&(v=v.filter(function(e){return!["share",d,c].includes(e)}),m.isBMDummyWdg()&&(v=v.filter(function(e){return!["refresh","help"].includes(e)}))),g._buildOpenMenuIcon(),g._toggleHasDDMenuClass(!0),g._menuName="fullscreen_widget_menu",t=g._menu=u.create({target:l.getTitleMenuElement(),items:v,callbacks:p,trackerCategory:"widget.fullscreenMenu",onShow:function(){a.isSWAFeatureEnabled().then(function(e){e&&(n.hasTouch()?s&&s.show():r&&r.show())})}}),r=t.getActionElement(d),s=t.getActionElement(c),r&&r.hide(),s&&s.hide(),g.updateItemsVisibility(),g.updateCustomItem(),g._setWidgetTooltip(),g._update=function(t){g.destroy(),g._buildFullscreenWidgetMenu(t||e)}},_buildFullscreenWidgetPreviewMenu:function(e){var t,n,a=e.widget.environment;t={searchInWidget:a.showSearchInWidgetView.bind(a),preferences:a.togglePreferences.bind(a),publish:function(){a.viewSkeleton._publish(new Event(""))},refresh:function(){a.dispatchEvent("onRefresh")},help:function(){o.openHelpWindow({helpInfoPath:r.getHelpInfoPath(a)})},close:d.close},n=["searchInWidget","preferences","publish","refresh","help","close"],g._buildOpenMenuIcon(),g._toggleHasDDMenuClass(!0),g._menuName="fullscreen_widget_preview_menu",g._menu=u.create({target:l.getTitleMenuElement(),items:n,callbacks:t,trackerCategory:"widgetPreview.fullscreenMenu"}),g.updateItemsVisibility(),g.updateCustomItem(),g._setWidgetTooltip(),g._update=function(t){g.destroy(),g._buildFullscreenWidgetPreviewMenu(t||e)}},_buildSWAModeMenu:function(e){var t=e.widget.environment;g._buildOpenMenuIcon(),g._toggleHasDDMenuClass(!0),g._menuName="swa_mode_menu",g._menu=u.create({target:l.getTitleMenuElement(),items:["searchInWidget","preferences","refresh","openIn3DD"],callbacks:{searchInWidget:t.showSearchInWidgetView.bind(t),preferences:t.togglePreferences.bind(t),refresh:function(){window.location.reload()},openIn3DD:v},trackerCategory:"widgetPreview.addinmodeLockedappFullscreenMenu"}),g.updateItemsVisibility(),g.updateCustomItem(),g._setWidgetTooltip(),g._update=function(t){g.destroy(),g._buildSWAModeMenu(t||e)}},_buildAddinModeMenu:function(e){var t=e.widget.environment,n=t.getName();g._buildOpenMenuIcon(),g._toggleHasDDMenuClass(!0),g._menuName="addin_mode_menu",g._menu=h.create({target:l.getTitleMenuElement(),widgets:d.getOpened(),actions:["searchInWidget","preferences","refresh","expand","close"],callbacks:{searchInWidget:t.showSearchInWidgetView.bind(t),preferences:t.togglePreferences.bind(t),refresh:function(){t.dispatchEvent("onRefresh")},expand:v,close:d.close,open:d.switchTo,"more-apps":s.open}}),g.updateItemsVisibility(),g.updateCustomItem(),g._setTooltip(n?n+" "+m.menuCurrentApps:m.menuCurrentApps),g._update=function(t){g.destroy(),g._buildAddinModeMenu(t||e)}},_buildLockedAppModeMenu:function(e){var t=e.widget.environment;g._buildOpenMenuIcon(),g._toggleHasDDMenuClass(!0),g._menuName="locked_app_mode_menu",g._menu=u.create({target:l.getTitleMenuElement(),items:["searchInWidget","preferences","refresh"],callbacks:{searchInWidget:t.showSearchInWidgetView.bind(t),preferences:t.togglePreferences.bind(t),refresh:function(){t.dispatchEvent("onRefresh")}},trackerCategory:"widgetPreview.addinmodeLockedappFullscreenMenu"}),g.updateItemsVisibility(),g.updateCustomItem(),g._setWidgetTooltip(),g._update=function(t){g.destroy(),g._buildLockedAppModeMenu(t||e)}},_buildOpenMenuIcon:function(){e.createElement("div",{class:"ifwe-topbar-ddmenu-open-icon fonticon fonticon-down-open"}).inject(l.getTitleMenuAppMenuElement())},_toggleHasDDMenuClass:function(e){l.getTitleMenuElement().toggleClassName("ifwe-has-ddmenu",e)},_setWidgetTooltip:function(){var e,t=g._widget;t&&(e=a._getWidgetName(t),g._setTooltip(e?e+" "+m.menu:m.widgetMenu))},_setTooltip:function(e){g._tooltip?g._tooltip.setBody(e):g._tooltip=new t({position:"bottom",target:l.getTitleMenuElement(),body:e,offset:{x:0,y:0},closeOnClick:!0})},_getDefaultMenuOpts:function(){return{className:"ifwe-header-dd",target:l.getTitleMenuElement(),position:"bottom left",offset:{x:8,y:-6}}}}}),define("DS/Dashboard/ManageDashboard/Views/DashboardsTileCollection",["UWA/Core","UWA/Utils/Client","UWA/Class/View","UWA/Class/Model","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/EmptyView","DS/Dashboard/ManageDashboard/Views/DashboardTileView","DS/Dashboard/ManageDashboard/Views/MainView","DS/Dashboard/ManageDashboard/Events","DS/Dashboard/ManageDashboard/Controller/ManageDashboard","DS/Dashboard/DashboardManager","i18n!DS/Dashboard/assets/nls/manage_modal","i18n!DS/Dashboard/assets/nls/main"],function(e,t,n,a,i,o,r,s,d,l,c,u,h){"use strict";return n.extend({tagName:"div",className:"dashboard-tile-collection-view",elements:{},emptyView:o,_emptyView:null,_isDashboardTileDragged:!1,_isScrollOnTouchDevice:!1,setup:function(e){e=e||{};var t=this.elements;this.dashboardActions=e.dashboardActions,this.dashboardActionsHandler=e.dashboardActionsHandler,this.dashboardMapping=e.dashboardMapping,this.facets=e.facets,this.actions=e.actions,this.attributesMapping=e.attributesMapping,this.members=e.members,this.modal=e.modal,this.tenants=e.tenants,this.visibleItems=new Array,this.selectedPanel=e.selectedPanel,this.dashboardId=e.dashboardId,this.filters=e.filters,this.sort=e.sort,t.tileViews=this._buildTiles(),t.scrollView=new i({useInfiniteScroll:!1,usePullToRefresh:!1,view:this._getScrollView()})},render:function(){var e=this.elements.scrollView;return e.render().inject(this.container),e.getElement(".scroller-content").addEvent("scroll",function(e){var t=e.currentTarget.ownerDocument.getElement('.dropdown:not([style*="display: none;"])');t&&t.remove()}),this},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this.elements.tileViews.forEach(function(e){e.destroy()}),delete this.elements.tileViews,this._parent.apply(this,arguments)},_getScrollView:function(){var t=this;return new(n.extend({tagName:"div",className:"dashboard-tile-view-wrapper",render:function(){var n=t.elements,i=this.container,r=n.tileViews;return r.forEach(function(e){t.visibleItems.push(e),e.render().inject(i),e.container.setAttribute("draggable",!0),e.container.setAttribute("data-modelId",e.model.get("modelId")),e.container.model=e.model}),0===r.length&&(t.filters.search||t.filters.accessRights||t.filters.type?t.elements.emptyView=new o({icon:"info",title:u.noResult,model:new a}).render().inject(i):t.selectedPanel.toLowerCase()===s.MY_FAVORITES_PANEL.toLowerCase()?t.elements.emptyView=new o({icon:"favorite-on",title:u.nodbInFavorites,model:new a}).render().inject(i):t.elements.emptyView=new o({icon:"recycle",title:u.nodbInRecycleBin,model:new a}).render().inject(i)),t.selectedPanel===d.MY_FAVORITES_PANEL&&(n.dropBox=e.createElement("div",{class:"drop-in-fav drop-zone hide",html:[{tag:"p",class:"drop-text",text:h.dropDashboardText}]}),n.dropBox.addEventListener("dragenter",t.onDropBoxEnter.bind(t),!1),n.dropBox.addEventListener("dragleave",t.onDropBoxLeave.bind(t),!1),n.dropBox.addEventListener("drop",t.onDropBoxDrop.bind(t),!1),n.dropBox.addEventListener("dragover",t.onDropBoxDragOver,!1)),this}}))},_buildTiles:function(){var e=this,t=[];return e.collection.forEach(function(n){t.push(e._buildTile(n))}),t},_buildTile:function(e){var n=this;e.actions=n.dashboardActions;var a=new r({lazyLoading:!1,model:e,mapping:n.dashboardMapping,events:{onActionClick:n.dashboardActionsHandler,onClick:function(){var t=this.container;t.getParent(".tile-view-skeleton-container").parentElement.getElement(".action-bar-container").getElement(".select-on.selected")?l.toggleSelectedState(t):l.createDashboardDetailView.call(n,{model:e,selectedCategory:n.selectedPanel})},onCheck:function(e){var t=e.currentTarget;l.toggleSelectedState(t)},onDrag:function(e){n.onDragStart(e)}},collectionView:n});return a.container.addEventListener("mouseover",function(e){t.Features.touchEvents||e.currentTarget.getElement(".tile-sub-container").addClassName("hover-effect")}),a.container.addEventListener("mouseout",function(e){t.Features.touchEvents||e.currentTarget.getElement(".tile-sub-container").removeClassName("hover-effect")}),a.container.addEventListener("touchmove",function(e){n._isScrollOnTouchDevice=!0}),a.container.addEventListener("touchend",function(e){if(n._isDashboardTileDragged||n._isScrollOnTouchDevice||"action-icon-wrapper"===((e.target||{}).parentNode||{}).className)_isScrollOnTouchDevice=!1;else{var t=e.currentTarget.model;l.createDashboardDetailView.call(n,{model:t,selectedCategory:n.selectedPanel})}}),a.container.addEventListener("dragend",n.onDragEnd.bind(n),!1),a},onDragStart:function(e){var t=this,n=!1,a={draggedFrom:"",selectedDashboards:[]},i=[];t._isDashboardTileDragged=!0,t.elements.tileViews.forEach(function(a){a.container.hasClassName("selected")?(n=!0,i.push(a.model.get("modelId")),a.container.classList.add("dragging")):t.selectedPanel===d.MY_FAVORITES_PANEL&&(t.sort.direction||t.sort.field||t.filters.search||t.accessRights||e.currentTarget!==a.container&&a.container.addEventListener("dragenter",t.onFavDragEnter.bind(t),!1))}),n||e.currentTarget.classList.add("dragging"),l.dbDraggedFrom=a.draggedFrom=t.selectedPanel.trim().toLowerCase(),i.length?a.selectedDashboards=i:a.selectedDashboards.push(e.currentTarget.dataset.modelid),e.dataTransfer.setData("text/plain",JSON.stringify(a))},onDragEnd:function(e){var t=!1;this.elements.tileViews.forEach(function(e){e.container.hasClassName("selected")&&(t=!0,e.container.classList.remove("dragging"))}),this._isDashboardTileDragged=!1,t||e.currentTarget.classList.remove("dragging"),this.selectedPanel===d.MY_FAVORITES_PANEL&&e.target!==this.elements.dropBox&&this.elements.dropBox.addClassName("hide")},onFavDragEnter:function(e){var t=this.elements,n=e.currentTarget,a=t.dropBox,i=n.parentElement;if(n!==t.tileViews[t.tileViews.length-1].container)i.insertBefore(a,n);else{var o=n.getBoundingClientRect(),r=o.right,s=o.width;r-e.clientX>s/2?i.insertBefore(a,n):i.appendChild(a)}a.removeClassName("hide")},onDropBoxEnter:function(){this.elements.dropBox.classList.add("drop")},onDropBoxLeave:function(){this.elements.dropBox.classList.remove("drop")},onDropBoxDrop:function(e){var t=JSON.parse(e.dataTransfer.getData("text/plain")),n=Array.prototype.slice.call(e.target.parentElement.children).indexOf(this.elements.dropBox);this.elements.dropBox.classList.remove("drop"),this.elements.dropBox.addClassName("hide"),c.reorderFavorites(t.selectedDashboards,n).then(function(){require(["DS/Dashboard/ManageDashboard/Controller/ManageDashboard"],function(e){e.createManageDashboardView({categoryToSelect:e._selectCategory})})})},onDropBoxDragOver:function(e){e.preventDefault()}})}),define("DS/Dashboard/ManageDashboard/Views/TileMain",["UWA/Core","UWA/Class/View","DS/Dashboard/ManageDashboard/Views/DashboardsTileCollection","DS/Dashboard/PublicAPI","DS/Dashboard/ManageDashboard/Events","i18n!DS/Dashboard/assets/nls/modal"],function(e,t,n,a,i,o){"use strict";return t.extend({tagName:"div",className:"dashboard-tile-main",elements:{},setup:function(e){e=e||{},this.collection=e.dashboardsCollection,this.elements.dashboardsCollectionView=new n({collection:this.collection,useInfiniteScroll:!1,dashboardActions:e.dashboardActions,dashboardActionsHandler:e.dashboardActionsHandler,dashboardMapping:e.dashboardMapping,facets:e.facets,actions:e.actions,attributesMapping:e.attributesMapping,members:e.members,modal:e.modal,tenants:e.tenants,exportsObj:e.exportsObj,filters:e.filters,sort:e.sort,selectedPanel:e.selectedPanel,dashboardId:e.dashboardId})},render:function(){var t=this.container,n=this.elements.dashboardsCollectionView;this._parent.apply(this,arguments);var a=e.createElement("div",{class:"dashboard-tile-container"});return a.inject(t),n.render().inject(a),this},onPostInject:function(){var t=this.options.selectedPanel,n=this.container.getParent();if(t&&t.toLowerCase()===i.RECYCLE_BIN_PANEL.toLowerCase()){var r=e.createElement("span",{text:o.emptyRecycleBinMsg,class:"empty-db-cnt"});e.createElement("div",{class:"empty-dashboard-cnt "+(a._getTrashedContexts().length?"":"hide"),html:a._getTrashedContexts().length&&r}).inject(n,"top")}},destroy:function(){this.dispatchEvent("onDestroy"),this.stopListening(),this._parent.apply(this,arguments)}})}),define("DS/Dashboard/TopBar/Manager",["UWA/Core","DS/PubSub/PubSub","DS/TopBar/TopBar","DS/UWPClientCode/PublicAPI","DS/UWPClientControls/Utils","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/Utils","DS/Dashboard/UsageTracker","DS/Dashboard/WidgetPreviewManager","DS/Dashboard/TopBar/API","DS/Dashboard/TopBar/DDMenuManager","DS/Dashboard/TopBar/RightMenusManager"],function(e,t,n,a,i,o,r,s,d,l,c,u,h){"use strict";var m,g,f,p,b,v={},w="x3dPlatformId",D="xPref_CREDENTIAL",_=!1,C=!1,I=!1,S=!1,y=null;return v[o.DASHBOARD_TYPE]="3DDashboard",v[o.COCKPIT_TYPE]="3DDashboard",v[o.BUSINESS_EXP_INSTANCE_TYPE]="Business Experience",v[o.BUSINESS_EXP_LAYOUT_TYPE]="Business Experience",m={ctxNames:{dashboard:"3DDashboard_context",fullscreenWidget:"fullscreen_widget_contex",fullscreenWidgetPreview:"fullscreen_widget_preview_contex",swaMode:"swa_mode_context",addinMode:"addin_mode_context",lockedAppMode:"locked_app_mode_context"},ctxType:{context:"context_ctx_type",widget:"widget_ctx_type"},_ctxName:null,_ctxType:null,init:function(){g=require("DS/Dashboard/TopFrameManager"),_=r.isAddinMode(),C=r.isSWAMode(),I=r.isLockedAppMode(),S=o._getApplicationConfigurationBoolean("app.service.search.enabled"),C&&c.hideAddinModeCloseBtn(),c.setUserName(),m.updateTitle(),h.init(),u.init(),m._initEvents(),S&&m._buildSearchMenu()},updateTitle:function(){var e=g.getFullscreenWidgetPreviewId(),t=o._getWidget(e),n=g.getFullscreenWidgetId(),a=o._getWidget(n),i={};function r(e){if(!e)return{};var t=e.environment,n=t.getComputedWidgetTitle({hideBrand:!0})||t.getName();return{topBarBrand:t.getBrand(),topBarTitle:n,pageTitle:n}}if(_||C)i=r(t);else if(e)i=r(t);else if(n)i=r(a);else{var s=o._getActiveContext(),d=s&&s.name,l=s&&g.getCurrentTabId();i={topBarTitle:d,topBarBrand:s&&v[s.type],pageTitle:s?d+(l?" - "+o._getTabName(l):""):""}}c.setApplication(i.topBarTitle||""),c.setBrand(i.topBarBrand||""),document.title=i.pageTitle||"3DEXPERIENCE Platform"},setContext:function(){var e=g.getFullscreenWidgetPreviewId(),t=g.getFullscreenWidgetId();_||C?(m._ctxName=C?"swa_mode_context":"addin_mode_context",m._ctxType="widget_ctx_type",m._setWidgetContext({widgetId:e})):e?(m._ctxName="fullscreen_widget_preview_contex",m._ctxType="widget_ctx_type",m._setWidgetContext({widgetId:e})):t?(m._ctxName="fullscreen_widget_contex",m._ctxType="widget_ctx_type",m._setWidgetContext({widgetId:t})):(m._ctxName="3DDashboard_context",m._ctxType="context_ctx_type",m._set3DDContext())},updateContext:function(e){if(e){var t=m._ctxName,n=m._ctxType,a=e.name,i=e.type;a!==t&&i!==n||m.setContext()}else m.setContext()},isCurrentCtxType:function(e){return m._ctxType===e},isCtxTypeContext:function(){return"context_ctx_type"===m._ctxType},isCtxTypeWidget:function(){return"widget_ctx_type"===m._ctxType},destroyDDMenu:u.destroy,hideDDMenu:u.hide,getTopBarUserPlatforms:(p=!1,b=[],function(e){var t,n=(e=e||{}).force;return r.isBELayoutEditorMode()?Promise.resolve([]):(n&&(f=null),f?Promise.resolve(s.cloneDeep(f)):(t=new Promise(function(e,t){b.push({resolve:e,reject:t})}),p||(p=!0,o.getPlatforms({force:e.force}).then(function(e){f=e.filter(function(e){return e[o.SERVICE_NAME_3DD]})}).finally(function(){p=!1,b.forEach(function(e){e.resolve(s.cloneDeep(f||[]))}),b=[]})),t))}),_initEvents:function(){n.addEvent({events:{"click-extrabtn":g.exitFullscreenWidget,"click-close-addinmode":l.close,mobileSearchAction:g.onMobileSearchBarDisplayChange}}),t.add(o.events.topbar.userContextClick,function(){var e,t=g.getFullscreenWidgetPreviewId()||g.getFullscreenWidgetId();t&&(e=o._getWidget(t))&&!e.isEdit&&e.environment.togglePreferences()}),t.add(a.events.userRefreshed,c.setUserName,null,!0),t.add(o.events.dashboard.change,function(){if(S){var e=document.body,t=e.getElement(".input_search"),n=e.getElement(".clear_btn_search");t&&(t.value=""),n&&n.hide()}m.setContext()},null,!0),t.add(o.events.dashboard.untrash,function(e){var t=((e=e||{}).context||{}).modelId;(o._getActiveContext()||{}).modelId===t&&m.updateContext({type:m.ctxType.context})},null,!0),t.add(o.events.dashboard.rename,function(e){o._isActiveContext(e)&&m.updateTitle()},null,!0),t.add(o.events.tab.rename,function(){m.updateTitle()},null,!0),t.add(o.events.widget.updatePlatformInfoFullscreenWidget,function(e){var t,n=e.widgetId,a="",i="",r=g.getFullscreenWidgetPreviewId()||g.getFullscreenWidgetId();r&&n===r&&(t=o._getWidget(n))&&(e.show&&(a=t.getValue(w),i=t.getValue(D)),c.setPlatformId(a),c.setCollabspaceId({xPrefCredential:i}))}),t.add(o.events.widget.updateFilteredIconFullscreenWidget,function(e){var t=e.widgetId,n=g.getFullscreenWidgetPreviewId()||g.getFullscreenWidgetId();n&&t===n&&o._getWidget(t)&&(e.show?c.showFilteredFullscreenIcon({tooltip:e.tooltip}):c.hideFilteredFullscreenIcon())})},_set3DDContext:function(){m._removeWidgetEventsListeners(),c.hideExitFullscreenButton(),m.updateTitle(),u.build({name:u.names.context}),c.setDisableUserContextDropdown(!1),c.setReadOnlyUserContext(!1),c.setPlatformId(),c.setCollabspaceId(),h.setProviders()},_setWidgetContext:function(t){var n,a=!!g.getFullscreenWidgetPreviewId(),i=t.widgetId,r=o._getWidget(i),s=r&&r.environment;if(r){if(m._addWidgetEventsListeners(r),m.updateTitle(),C)n=u.names.swaMode,c.hideAddinModeCloseBtn();else if(_){var d=r.getValue("addinHideClose");n=I?u.names.lockedAppMode:u.names.addinMode,e.is(d)?c.hideAddinModeCloseBtn():c.showAddinModeCloseBtn()}else a?(n=u.names.fullscreenWidgetPreview,c.hideExitFullscreenButton()):(n=u.names.fullscreenWidget,c.showExitFullscreenButton());if(u.build({name:n,opts:{widget:r}}),o._shouldShowWidgetPlatformInfo(r)?(c.setDisableUserContextDropdown(!0),c.setReadOnlyUserContext(!r.hasPreferences()),c.setPlatformId(r.getValue(w)||""),c.setCollabspaceId({xPrefCredential:r.getValue(D)||""})):(c.setPlatformId(""),c.setCollabspaceId({xPrefCredential:""})),s.wp.isFilteredIconShown){var l=s.components.filteredTooltip&&s.components.filteredTooltip.getBody().textContent;c.showFilteredFullscreenIcon({tooltip:l})}if(h.setProviders(),C)require("DS/Dashboard/SWAModeManager").onSetWidgetAsTopBarContext({widgetId:i})}},_addWidgetEventsListeners:function(e){m._removeWidgetEventsListeners();var t,n,a,o=e.environment,r=o.embedded;function s(){u.updateItemsVisibility()}function d(){t(),n()}t=i.debounce(s,300),n=i.debounce(function(){u.updateCustomItem()},300),a={widget:e,callbacks:{onEdit:s,endEdit:function(e){(e=e||{}).submitted?m.updateContext({type:m.ctxType.widget}):s()},onUpdateTitle:m.updateTitle},envCallbacks:{onUpdatePreferences:t,onChangeLinkability:s,onUpdateMetas:d},embededEnvCallbacks:{onUpdateMetas:d}},Object.keys(a.callbacks).forEach(function(t){e.addEvent(t,a.callbacks[t])}),o&&Object.keys(a.envCallbacks).forEach(function(e){o.addEvent(e,a.envCallbacks[e])}),r&&Object.keys(a.embededEnvCallbacks).forEach(function(e){r.addEvent(e,a.embededEnvCallbacks[e])}),y=a},_removeWidgetEventsListeners:function(){if(y){var e=y,t=e.widget,n=t&&t.environment,a=t&&t.environment.embedded;t?(Object.keys(e.callbacks).forEach(function(n){t.removeEvent(n,e.callbacks[n])}),n&&Object.keys(e.envCallbacks).forEach(function(t){n.removeEvent(t,e.envCallbacks[t])}),a&&Object.keys(e.embededEnvCallbacks).forEach(function(t){a.removeEvent(t,e.embededEnvCallbacks[t])}),y=null):y=null}},_buildSearchMenu:function(){o.getPlatforms().then(function(e){var t,a={sourceNames:{LOCAL:"My Dashboard",ENOVIA:"Collaborative Spaces",SWYM:"3DSwym"},currSource:{type:"LOCAL",url:null}},i=a.sourceNames,o=h._mainProvider,r=o.createMenuItem,s=u("LOCAL",null,!0),l=[s],c=[s];function u(e,t,n){return r({label:i[e],selected:n,selectable:!0,onExecute:function(e,t,n){c.forEach(function(e){e.set("selected",!1)}),n.set("selected",!0),a.currSource={type:e,url:t},m(n),d.track({category:"dashboard.use",action:"searchMenu-topFrameManager"}),d.track({category:"dashboard.use",action:"searchMenuSource-"+e+"-topFrameManager"})}.bind(null,e,t)})}function m(e){n.set("searchOptionBox",e.get("label"))}e.forEach(function(e){var t=e["3DSwym"];if(t){var n=u("SWYM",t,!1),a=u("ENOVIA",t,!1),i=r({label:e.displayName,selected:!0,submenu:[n,a]});l.push(i),c.push(n,a)}}),t=r({label:"Where to search",submenu:l}),o.setCommands({search:[t]}),m(s)})}}}),define("DS/Dashboard/Intercom",["UWA/Utils/InterCom","DS/PubSub/PubSub","DS/UWPClientCode/PublicAPI","DS/Dashboard/PublicAPI","DS/Dashboard/DashboardManager","DS/Dashboard/Navigation"],function(e,t,n,a,i,o){"use strict";var r,s,d={};return{serverId:"ifweServer",events:{article:{share:"article:share"},profile:{updateko:"profile:update:ko"}},init:function(){if(!r){var d=this.events;r=new e.Server(this.serverId),(s=new e.Socket("socket-ifweAdapterSocket")).subscribeServer(this.serverId),s.addListener(d.article.share,function(e){i.share({id:e.id,type:e.type,title:e.title,link:e.link})}),t.add(n.events.contextChange,function(e){e.type!==a.DASHBOARD_TYPE&&e.type!==a.BUSINESS_EXP_INSTANCE_TYPE&&e.type!==a.BUSINESS_EXP_LAYOUT_TYPE&&e.type!==a.COCKPIT_TYPE||(o.isBELayoutEditorMode()&&e.type!==a.BUSINESS_EXP_LAYOUT_TYPE?o.routeTo({keepAll:!0,paramsToRemove:{belayouteditor:!0}}):(i.disableWidgetsLinksMode(),t.dispatch(a.events.dashboard.change,e,!0)))},null,!0),t.add(n.events.contextAdd,function(e){e.type!==a.DASHBOARD_TYPE&&e.type!==a.BUSINESS_EXP_INSTANCE_TYPE&&e.type!==a.COCKPIT_TYPE||t.dispatch(a.events.dashboard.add,e,!0)},null,!0)}},firePersistedMessage:function(e,t){!function(e,t){r.dispatchEvent(e,t)}(e,t),d[e]=t},listenPersistedMessage:function(e,t,n){if("function"==typeof n){var a=!1;return void 0!==d[e]&&(n(d[e]),a=!0),t.addListener(e,n),a}}}}),define("DS/Dashboard/TopFrameManager",["UWA/Core","UWA/Utils/Client","UWA/Element","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","DS/TopFrame/TopFrame","DS/UWPClientControls/Utils","DS/Dashboard/Navigation","DS/Dashboard/PublicAPI","DS/Dashboard/UserPlatformAccess","DS/Dashboard/CommentPanelManager","DS/Dashboard/UsageTracker","DS/Dashboard/CompassManager","DS/Dashboard/UIKITUtils","DS/Dashboard/GridManager","DS/Dashboard/TagNavManager","DS/Dashboard/TopBar/Manager","DS/Dashboard/TopBar/API","DS/Dashboard/WidgetPreviewManager","DS/Dashboard/SWAModeManager"],function(e,t,n,a,i,o,r,s,d,l,c,u,h,m,g,f,p,b,v,w){"use strict";var D,_,C=".app-content",I="ifwe-has-fullscreen-widget",S=null,y=null,E=null,T=null,A=null,P=null,x=!1,M=!1,k=!1,N=!1,W=!1;return _=r.debounce(function(){var e;try{window.dispatchEvent(new Event("resize"))}catch(t){(e=document.createEvent("Event")).initEvent("resize",!1,!0),window.dispatchEvent(e)}},400),D={init:function(){M=s.isAddinMode(),k=s.isLockedAppMode(),N=s.isSWAMode(),W=d._getCurrentMode()===d.MY3DEXPERIENCE_MODE,f.init(),p.init(),c.init(),v.init(),W&&D._initMy3DExperienceMode(),M&&D._initAddinMode(),N&&w.init(),D._initEvents()},isFullscreenRightPanel:function(){return x},getFullscreenWidgetId:function(){return T},getMaximizedWidgetId:function(){return y},getWidgetPreviewId:function(){return E},getFullscreenWidgetPreviewId:function(){return A},getMaximizedWidgetPreviewId:function(){return P},getCurrentTabId:function(){return S},closeCoachmark:function(){var e,t=n.getElement.call(document.body,[".ds-coachmark"]);t&&(e=t.getElement(".ds-coachmark-close"))&&(e.triggerEvent("click"),u.track({category:"dashboard.use",action:"closeCoachmark-topFrameManager"}))},exitMaximizedWidget:function(){var e=d._getWidget(y);if(e){var t=e.environment;t&&t.isMaximized()&&t.toggleMaximize()}},exitFullscreenWidget:function(){var e=d._getWidget(T);if(e){var t=e.environment;t&&t.isFullscreen()&&t.toggleFullscreen()}},getTopBarUserPlatforms:p.getTopBarUserPlatforms,onMobileSearchBarDisplayChange:function(e){var t,n=document.body.querySelector(C);if(n)switch(t=n.classList,e.action){case"enable":t.add("topbar-mobile-search-bar-displayed"),_();break;case"disable":if(!t.contains("topbar-mobile-search-bar-displayed"))break;t.remove("topbar-mobile-search-bar-displayed"),_()}},_initMy3DExperienceMode:function(){new MutationObserver(function(t){try{"east/cockpit"!==t[0].target.getAttribute("data-page")?p.destroyDDMenu():(p.setContext(),require("DS/UWPClientCode/Navigation").historyChanged(window.location.hash))}catch(t){e.log(t)}}).observe(document.querySelector(".layout.global.layout-im-view-container.layout-sci-view-container"),{attributes:!0})},_initAddinMode:function(){k||s.getUrlParameter(s.parts.app)||h.onPostInitialized().then(function(){h.open(),h.showHideCloseBtn({hide:!0}),setTimeout(function(){m.unmaskBody()},300)}),h.subscribeOnOpen(function(){setTimeout(function(){s.getUrlParameter(s.parts.app)||v.hasOpened()||h.showHideCloseBtn({hide:!0})},100),p.hideDDMenu()})},_initEvents:function(){var e;a.add(d.events.tab.change,function(e){S=e||"",p.updateTitle(),!d._getTab(e)&&f.removeAllProxies(),f.getTagger().setAsCurrent(),d.getMaximizedModuleId({tabId:e,success:function(e){D._onEnterMaximizedWidget({widgetId:e})},failure:function(){p.updateContext({type:p.ctxType.context}),f.unfocusTagger()}})},null,!0),a.add("onViewChange",function(e){var t=e.id,n=e.type,a=d._getWidget(t),i=(a||{}).environment;if(a&&i){var o=0===t.indexOf("preview"),r=o&&i.isFloat(),s="fullscreen"===n,l="maximized"===n,c="windowed"===n,u=c&&t===y,h=c&&t===T,m=!1,g=!1,f=!1,p=!1;"minimized"===n||r||(o?(E=t,f=!(m=i.isFullscreen())&&t===A,p=!(g=!m)&&t===P,m&&(A=t),g&&(P=t),f&&(A=null),p&&(P=null)):(s&&(T=t),l&&(y=t),h&&(T=null),u&&(y=null)),E?(f?D._onLeaveFullscreenWidgetPreview({widgetId:t}):p&&D._onLeaveMaximizedWidgetPreview({widgetId:t}),m?D._onEnterFullscreenWidgetPreview({widgetId:t}):g&&D._onEnterMaximizedWidgetPreview({widgetId:t})):(h?D._onLeaveFullscreenWidget({widgetId:t}):u&&D._onLeaveMaximzedWidget({widgetId:t}),s?D._onEnterFullscreenWidget({widgetId:t}):l?D._onEnterMaximizedWidget({widgetId:t}):c&&D._onEnterWindowedWidget({widgetId:t})))}}),a.add(d.events.widget._exitFullscreen,function(){T&&D.exitFullscreenWidget()}),a.add(d.events.widget._exitMaximized,function(){y&&D.exitMaximizedWidget()}),a.add(d.events.preview.show,function(e){if(o.minimizeSidePanel(),!A||M||e.isSameApp||p.setContext(),D._isSmallBreakpoint()&&h.close(),M){var t=document.body.querySelector(C);t&&t.style&&"auto"===t.style.height&&t.style.removeProperty&&t.style.removeProperty("height"),m.unmaskBody(),document.body.addClassName("with-app")}}),a.add(d.events.preview.loaded,function(e){D.getWidgetPreviewId()&&D._onEnterMaximizedWidgetPreview({widgetId:e}),f.focusTagger({widgetId:e,containerId:f.WIDGET_PREVIEW_CONTAINER_ID})}),a.add(d.events.preview.close,function(){var e=document.body;s.routeTo({keepAll:!0,discards:s.parts.app,paramsToRemove:{wii:!0}}),M&&h.open(),setTimeout(function(){document.body.removeClassName("with-app")},500),f.unfocusTagger({containerId:f.WIDGET_PREVIEW_CONTAINER_ID}),T?e.addClassName(I):e.removeClassName(I),A=null,P=null,E=null,T?D._onEnterFullscreenWidget({widgetId:T}):y?D._onEnterMaximizedWidget({widgetId:y}):(p.setContext(),f.focusTagger()),M||g.update()}),a.add(d.events.rightpanel.minimized,function(){x=!1,E?A?D._onEnterFullscreenWidgetPreview({widgetId:A}):P&&D._onEnterMaximizedWidgetPreview({widgetId:P}):T?D._onEnterFullscreenWidget({widgetId:T}):y?D._onEnterMaximizedWidget({widgetId:y}):(p.setContext(),f.focusTagger())},null,!0),a.add(d.events.rightpanel.maximized,function(){x=!0},null,!0),t.Features.touchEvents&&(document.addEventListener("focusin",function(t){"INPUT"===((t=t||{}).target||{}).tagName&&(e=(n.getScrolls.call(document.body)||{}).top)}),document.addEventListener("focusout",function(t){"INPUT"===((t=t||{}).target||{}).tagName&&(e=y?0:e||0,window.scrollTo(0,e))})),l.fetchUserAdmin().then(function(e){e&&i.subscribe("com.ds.platform-control-center:onChangePlatformName",function(e){var t=(e=e||{}).platformId,n=e.name;t&&n&&(l.updatePlatformName(t,n),p.getTopBarUserPlatforms({force:!0}),b.setPlatformId(t,!0),((d._getActiveTab()||{}).environment||{}).wp.children.forEach(function(e){var t=(e.widget||{}).environment;t&&t.updatePlatformInfoIcon()}))},null,!0)})},_isSmallBreakpoint:function(){var e=o._frame,t=e&&e._UI_BREAKS,n=t&&t.SMALL,a=window.innerWidth;return!(!n||!a)&&a<=n},_onEnterFullscreenWidget:function(e){var t=e.widgetId;document.body.addClassName(I),T=t,p.setContext(),f.focusTagger({widgetId:t}),a.dispatch(d.events.widget._enterFullscreen,{id:t,name:d._getWidgetName(t)}),u.track({category:"dashboard.use",action:"widgetEnterFullscreen-topFrameManager"})},_onLeaveFullscreenWidget:function(){T=null,document.body.removeClassName(I),p.setContext(),f.unfocusTagger(),u.track({category:"dashboard.use",action:"widgetLeaveFullscreen-topFrameManager"})},_onEnterFullscreenWidgetPreview:function(e){var t=e.widgetId;document.body.addClassName(I),A=E=t,p.setContext(),f.focusTagger({widgetId:t,containerId:f.WIDGET_PREVIEW_CONTAINER_ID}),u.track({category:"dashboard.use",action:"widgetPreviewEnterFullscreen-topFrameManager"})},_onLeaveFullscreenWidgetPreview:function(){A=null,document.body.removeClassName(I),u.track({category:"dashboard.use",action:"widgetPreviewLeaveFullscreen-topFrameManager"})},_onEnterMaximizedWidgetPreview:function(e){var t=e.widgetId;document.body.removeClassName(I),P=E=t,p.setContext(),f.focusTagger({widgetId:t,containerId:f.WIDGET_PREVIEW_CONTAINER_ID}),u.track({category:"dashboard.use",action:"widgetPreviewEnterMaximized-topFrameManager"})},_onLeaveMaximizedWidgetPreview:function(){P=null,u.track({category:"dashboard.use",action:"widgetPreviewLeaveMaximized-topFrameManager"})},_onEnterMaximizedWidget:function(e){var t=e.widgetId;document.body.addClassName("ifwe-has-maximized-widget"),y=t,p.setContext(),f.focusTagger({widgetId:t}),a.dispatch(d.events.widget._enterMaximized,{id:t,name:d._getWidgetName(t)}),u.track({category:"dashboard.use",action:"widgetEnterMaximized-topFrameManager"})},_onLeaveMaximzedWidget:function(){y=null,document.body.removeClassName("ifwe-has-maximized-widget"),p.setContext(),f.unfocusTagger(),u.track({category:"dashboard.use",action:"widgetLeaveMaximized-topFrameManager"})},_onEnterWindowedWidget:function(e){var t=e.widgetId;a.dispatch(d.events.widget._enterWindowed,{id:t,name:d._getWidgetName(t)}),u.track({category:"dashboard.use",action:"widgetEnterWindowed-topFrameManager"})}}});