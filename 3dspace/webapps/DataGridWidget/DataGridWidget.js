define("DS/DataGridWidget/Collab_Scroller",["UWA/Controls/Abstract","DS/UIKIT/Scroller"],function(e,t){"use strict";return e.extend({defaultOptions:{displayScrollers:!0,setExternalHorizontalScrollbar:!1,setExternalVerticalScrollbar:!1,synchronizationHorizontal:!1,synchronizationVertical:!1},init:function(e,n){var i=this;this._parent(n),this._childElement=e,this._alreadyDimensioned=!1;var a=e.getParent();this.parentElement=UWA.createElement("div",{class:"collab_Scroller","data-rec-id":"dataRecCollabScroller"}).inject(a),e.inject(this.parentElement),this.scrollContent=this.parentElement,!1===this.options.displayScrollers?(this.parentElement.setStyle("overflow","hidden"),this._childElement.setStyle("position","relative")):(this.UIKitScroller=new t({element:this.parentElement}).inject(a),this.parentElement.setStyle("overflow","auto"),this.scrollContent=this.UIKitScroller.elements.content,this.scrollContent.setAttribute("data-rec-id","dataRecscrollContent"),this.scrollContent.addEventListener("scroll",function(){i.dispatchEvent("onScrollMove")}))},getPosition:function(){var e=this.scrollContent.getScrolls();return{x:e.left,y:e.top}},setPosition:function(e,t){!0===this.options.displayScrollers?(this.scrollContent.scrollLeft=e,this.scrollContent.scrollTop=t):(this._childElement.setStyle("left",-e),this._childElement.setStyle("top",-t))},setSize:function(e){var t=e.width,n=e.height;(!0===this.options.setExternalVerticalScrollbar&&!0===this.options.displayScrollers||!0===this.options.synchronizationHorizontal)&&(isNaN(t)||(t=parseInt(t))),(!0===this.options.setExternalHorizontalScrollbar&&!0===this.options.displayScrollers||!0===this.options.synchronizationVertical)&&(isNaN(n)||(n=parseInt(n))),this.parentElement.setStyle("width",t),this.parentElement.setStyle("height",n)}})}),define("DS/DataGridWidget/models/SheetLine",["UWA/Class"],function(e){"use strict";var t=["authorizedInitialization","rollbackOnCell"];return e.extend({_id:null,_properties:null,_initValues:null,_changedValues:null,_rollbackOnCell:!0,_eventChangeCallback:null,_color:null,_created:!1,_authorizedInitialization:!1,init:function(e,t,n){for(var i in this._parent(n),this._properties={},this._id=e,this._initValues=null,this._changedValues=[],this._eventChangeCallback={},this._authorizedInitialization=n&&!0===n.authorizedInitialization,this._rollbackOnCell=!n||!1!==n.rollbackOnCell,t)this._properties[i]=t[i];if(n&&n.events)for(var i in n.events){var a=n.events[i];this.addEvent(i,a)}this.saveValues()},getAvailableOptions:function(){return t},setInitializationAuthorization:function(e){this._authorizedInitialization=e},canInitialize:function(){return this._authorizedInitialization},_propertyCanChange:function(e){return!0},addEvent:function(e,t){if("function"==typeof t){var n=this._eventChangeCallback[e];null==n&&(n=[],this._eventChangeCallback[e]=n),n.push(t)}},_raiseChangeEvent:function(e){this._raiseEvent("onPropChanged:"+e,e),this._raiseEvent("onChange",e)},_raiseEvent:function(e,t){var n=this,i=this._eventChangeCallback[e];i&&i.forEach(function(e){e.call(n,t)})},raiseEventsForChanges:function(e){var t=this;this.getChangedValue().forEach(function(n){null!=e&&e!==n||t._raiseChangeEvent(n)})},setRollbackOnCells:function(e){this._rollbackOnCell=!0===e},isRollbackOnCells:function(){return this._rollbackOnCell},setColor:function(e){this._color=e,this._raiseEvent("onColorChanged",this._color)},getColor:function(){return this._color},getProperties:function(){return this._properties},getID:function(){return this._id},getInitialValue:function(e){return this._initValues?this._initValues[e]:void 0},getValue:function(e){return this._properties[e]},setValue:function(e,t){this._properties[e]=t},setValues:function(e){this._properties=e},changeValue:function(e,t){this.setValue(e,t),this.addChangedValue(e)},removeValue:function(e){delete this._properties[e],this.removeChangedValue(e)},getChangedValue:function(){return this._changedValues},hasChanged:function(e){return this._changedValues.indexOf(e)>=0},initIsDefined:function(){return null!==this._initValues},addChangedValues:function(e,t){var n=this;e.forEach(function(e){n.addChangedValue(e,t)})},addChangedValue:function(e,t){(this._propertyCanChange(e)||!0===t)&&(this.hasChanged(e)||this._changedValues.push(e),this._raiseChangeEvent(e))},removeChangedValue:function(e){var t=this._changedValues.indexOf(e);t>=0&&(this._changedValues.splice(t,1),this._raiseChangeEvent(e))},resetValue:function(e){this.removeChangedValue(e),delete this._properties[e],this._raiseChangeEvent(e)},saveValues:function(e){for(var t in this.getProperties())this._initValues||(this._initValues={}),!1===e&&void 0!==this._initValues[t]||(this._initValues[t]=this.getValue(t))}})}),define("DS/DataGridWidget/DataGridWidget",["UWA/Controls/Input","UWA/Controls/Abstract","UWA/Controls/Scroller","DS/DataGridWidget/Collab_Scroller","DS/WidgetServices/WidgetServices","DS/WidgetServices/moveHelper/MoveHelper","css!DS/DataGridWidget/DataGridWidget.css"],function(e,t,n,i,a,l){"use strict";var s=a.isNatifEnvironnement()?"table-condensed":"";function r(e){var t=e.getElement(".HeaderArea"),n=0,i=t.getParent().getDimensions(),a=i.width-i.innerWidth;return t&&(n=t.getSize()),n.width+a}return t.extend({defaultOptions:{setHeaderColumn:!0,setScroller:!0,activeSelection:!1,setMultiSelection:!1,maxHeightScroller:"300",className:"",resizeClass:"",contextMenu:[],restrict:!1,UIKitClasses:"table-striped table-hover "+s},init:function(e,t){this._parent(t),this.classResize=this.options.resizeClass?this.options.resizeClass:"DGW_DataGrid";var n=this._dispatchOnResize();n&&a.addNewStyles(this.classResize+"_style",n,!0),this.saveElementObj={listId:[]},this.data=[],this.Column=[],this.CurrentSortColumn=-1,this.sort=!0,this.container=UWA.createElement("div",{class:"datagrid_MainContainer"}),this.createMyTable().inject(this.container),e&&e.length>0&&this.addHeader(e)},_dispatchOnResize:function(){var e=localStorage.getItem(this.classResize+"_style"),t=null;try{(t=JSON.parse(e)).width<20&&(t.width=20)}catch(e){}return t&&this.dispatchEvent("onResizeCells",t),t?t.style:null},resetDisplay:function(){localStorage.removeItem(this.classResize+"_style"),a.clearJSStylesheet(this.classResize+"_style"),this.dispatchEvent("onResizeCells",null)},addHeader:function(e){var t=this,n=t.MainTableHeader.getElement("thead").getElement("tr");e.forEach(function(e,i){var a="";e.hasOwnProperty("html")||(e.html=""),e.hasOwnProperty("text")&&(a=UWA.createElement("div",{class:"HeaderAreaText DGWI_"+e.dataIndex,text:e.text,"data-rec-id":"dataRecheadertext"+e.text+i}));var l=e.fixed;l||(l="false");var s=!0===e.hidden?" hidden":"",r=UWA.createElement("th",{isFixed:l,class:e.dataIndex+s+(e.hasOwnProperty("sortable")?" DGW_Sortable":""),dataIndex:e.dataIndex,html:[{tag:"table",class:"HeaderArea DGWI_"+e.dataIndex,html:[a,{tag:"div",class:"HeaderAreaHtml",html:e.html}]}]});e.hasOwnProperty("sortable")&&!0===e.sortable&&((-1===t.CurrentSortColumn||e.hasOwnProperty("defaultSort")&&!0===e.defaultSort)&&(t.CurrentSortColumn=i),""!==a&&a.addEvents({click:function(){t.CurrentSortColumn=t.getColumnHeaderIndex(e.dataIndex),t.applySort(!0)}})),n.addContent(r),t.Column.push(e)}),this.applySort(null,null)},getOptimalSize:function(){var e=this.container.getElement("tbody").getSize(),t=this.container.getElement("thead").getSize();return{width:e.width,height:e.height+t.height}},_clearAllLines:function(){var e=this.MainTableDiv.getElement("tbody");e&&e.empty()},clearAllLine:function(){this._clearAllLines(),this.saveElementObj={listId:[]}},getAllLine:function(){var e=[],t=this.MainTableDiv.getElement("tbody");return t&&(e=t.getElements("tr")),e},allIsHidden:function(){var e=this.getAllLine(),t=!0;return e.every(function(e){return"none"===e.getStyle("display")||(t=!1,!1)}),t},applySort:function(e){if(null!==this.CurrentSortColumn&&void 0!==this.CurrentSortColumn){if(!(this.CurrentSortColumn<0)){var t=this.Column[this.CurrentSortColumn],n=t.dataIndex,i=null;if(this.MainTableHeader.getElements(".HeaderAreaText").forEach(function(e){e.hasClassName("DGWI_"+n)?(i=e,e.hasClassName("asc")||e.hasClassName("desc")||e.toggleClassName("asc")):(e.hasClassName("asc")&&e.toggleClassName("asc"),e.hasClassName("desc")&&e.toggleClassName("desc"))}),i){!0===e&&(i.toggleClassName("asc"),i.toggleClassName("desc"));var a=i.hasClassName("asc");this._sortAndUpdateTable(t,a)}}}else UWA.log("issue with sort column")},_sortAndUpdateTable:function(e,t){var n=this,i=this.getAllLine(),l=e.dataIndex;i.sort(function(i,s){var r=i.getElement("."+l),o=s.getElement("."+l),h=0;if(r)if(o){var d=null;e.hasOwnProperty("sortKey")&&(d=e.sortKey);var c=n._getElementValue(r,d),u=n._getElementValue(o,d);h=a.compareValue(c,u),h=!1===t?-1===h?-1:1:1===h?-1:1}else h=1;else h=-1;return h}),this.MainTableDiv.getElement("tbody").setContent(i),this._putHiddenLineAtEnd(i)},_putHiddenLineAtEnd:function(e){e||(e=this.getAllLine());var t=this.MainTableDiv.getElement("tbody"),n=[],i=[];e.forEach(function(e){"none"===e.getStyle("display")?i.push(e):n.push(e)}),n=n.concat(i),t.setContent(n)},_getElementValue:function(e,t){var n="",i=e.getData("idElement"),a=null;i&&i.hasOwnProperty("idProp")&&(a=this.saveElementObj[i.idProp]);n=e.firstChild?e.firstChild:e.getText();if(t){var l=n;a&&(l=a),n=t(l)}return"object"==typeof n&&(n=e.getText()),n},_getInsideElement:function(e){var t=e.getData("idElement"),n=null;return t&&t.hasOwnProperty("idProp")&&(n=this.saveElementObj[t.idProp]),n||e.getText()},createMyTable:function(){var e=this,t=!0===this.options.restrict?" DGW_Restrict":"",n=e.MainTable=UWA.createElement("div",{class:"DGW_DataGrid "+this.options.className+" "+this.options.resizeClass+t,"data-rec-id":"dataRecTable"});this.DivSSTable1=UWA.createElement("div",{class:"DivSSTableHeader "+this.options.className+"Header","data-rec-id":"dataRecSSTable1"}),this.DivSSTable2=UWA.createElement("div",{class:"DivSSTableBody "+this.options.className+"Body","data-rec-id":"dataRecSSTable2"});var a=this.options.UIKitClasses,l="";if(a.indexOf("table-striped")>=0&&(l+="striped"),e.MainTableHeader=UWA.createElement("table",{name:this.options.className+"Header",class:"theadTable table "+a,"data-rec-id":"dataRecMainTableHeader",html:[{tag:"thead",class:"theadHeader",html:{tag:"tr"}}]}),e.MainTableDiv=UWA.createElement("table",{name:this.options.className+"Body",class:"tbodyTable table "+a,"data-rec-id":"dataRecMainTableDiv",html:[{tag:"tbody",name:this.options.className+"Body_Body",class:"tbodyMain "+l}]}),e.MainTableHeader.inject(this.DivSSTable1),e.MainTableDiv.inject(this.DivSSTable2),this.DivSSTable1.inject(n),this.DivSSTable2.inject(n),e.MainTableDiv.addEvent("resize",function(){e.resizeTable()}),this.DivSSTable1.addEvent("resize",function(){e.allIsHidden()&&e.resizeTable()}),this.DivSSTable2.setPosition(this.DivSSTable1.getPosition()),e.tbodyScroll=null,e.tHeadScroll=null,e.userStopMove=!1,!0===e.options.setScroller){!1===e.options.useNativeScroller&&(!1,!0);var s=function(){var t={x:0,y:0};e.tbodyScroll&&(t=e.tbodyScroll.getPosition()),e.dispatchEvent("onScroll",{scrollPosition:t,containerSize:e.DivSSTable2.getSize(),contentSize:e.MainTableDiv.getSize()}),e.tHeadScroll.setPosition(t.x,0,0,!0)};e.tbodyScroll=new i(e.MainTableDiv,{setExternalHorizontalScrollbar:!0,events:{onScrollMove:function(){s()}}}),e.tHeadScroll=new i(e.MainTableHeader,{displayScrollers:!1,synchronizationHorizontal:!0,events:{onScrollMove:function(){s()}}})}return!1===e.options.setHeaderColumn&&this.DivSSTable1.hide(),n},updateScroller:function(e,t){if(!0!==this.options.restrict){if(this.DivSSTable2.show(),!e)e=this.MainTable.getSize().width;var n=this.MainTableDiv.getSize();if(t?this.MainTableDiv.setStyle("height",t):t=n.height,isNaN(e))(s=e.match(/[0-9]*/))&&(e=s);e=parseInt(e),this.tHeadScroll&&this.tHeadScroll.setSize({width:e,height:"auto"}),""!==this.options.maxHeightScroller&&t>this.options.maxHeightScroller&&(t=this.options.maxHeightScroller);var i=this.DivSSTable2.getOffsetParent(),a=null;if(i)a=i.getDimensions().innerHeight;var l=0;if(!0===this.options.setHeaderColumn)l=this.MainTableHeader.getSize().height;if((0===a||i)&&t>a-l)t=a-l;else if(isNaN(t)){var s;(s=t.match(/[0-9]*/))&&(t=s)}if(t=parseInt(t),this.tbodyScroll?(this.tbodyScroll.setSize({width:e,height:t}),this.allIsHidden()&&this.DivSSTable2.hide()):!0===this.options.useNativeScroller&&this.DivSSTable2.setStyle({width:e,height:t}),!0===this.options.setHeaderColumn)this.MainTableHeader.getSize();if(this.tHeadScroll&&this.tbodyScroll){var r=this.tbodyScroll.getPosition(),o=r;!0===this.options.setHeaderColumn&&this.tHeadScroll.getPosition(),this.tbodyScroll.setPosition(o.x,r.y,0,!0)}}},fixeColumns:function(){var e=this.MainTable.getElement(".theadTable").getElement("thead").getElement("tr").getElements("th"),t=this.MainTable.getElement(".tbodyTable").getElement("tbody").getElements("tr.standardLine");e.forEach(function(n,i){if("true"===n.getAttribute("isfixed")){var a=-1,l=n.getStyle("min-width");l=l.match(/[0-9]*/,""),l=parseInt(l);var s=n.getStyle("max-width");s=s.match(/[0-9]*/,""),s=parseInt(s);var r=n.attributes.dataIndex.value;t.every(function(e){var t=e.getElement("."+r),n=t.getStyle("padding");n=n.match(/[0-9]*/,"");var i=t.firstChild;if(i){var o=i.getSize().width+2*n;if(a<o){if(s&&s<o)return a=s,!1;a=l&&l>o?l:o}}return!0}),a&&e[i].setStyle("width",a)}})},resizeInProgress:!1,resizeWaitingNb:0,resizeTable:function(){var e=this;e.resizeWaitingNb++,!1===e.resizeInProgress&&(e.resizeWaitingNb=0,e.resizeInProgress=!0,this.updateScroller(),this._resizeTable(),this.updateScroller(),setTimeout(function(){e.resizeInProgress=!1,e.resizeWaitingNb>2&&e.resizeTable()},100))},_resizeTable:function(){var e=!1,t=this.MainTable.getElement(".theadTable").getElement("thead").getElement("tr").getElements("th"),n=this.MainTable.getElement(".tbodyTable").getElement("tbody").getElements("tr.standardLine"),i=t.length;if(n.length>0){var a=null;if(n.every(function(e){return"none"===e.getStyle("display")||(a=e,!1)}),a){var l=a.getElements("td");e=!0;var s=l.length,o=i;i>s&&(o=s);for(var h=[],d=0;d<o;d++){if("true"===t[d].getAttribute("isfixed")){var c=t[d].getStyle("width");if(c=c.match(/[0-9]*/,""),0!==(c=parseInt(c))){var u=t[d].attributes.dataIndex.value;n.forEach(function(e){e.getElement("."+u).setStyle("width",c)})}}else{t[d].setStyle("width","");var g=l[d].getSize();if((b=r(t[d]))>g.width){u=t[d].attributes.dataIndex.value;n.forEach(function(e){e.getElement("."+u).setStyle("min-width",b)}),h.push(d)}else t[d].setStyle("width",g.width)}}for(var f=0;f<o;f++){g=l[f].getSize();t[f].setStyle("width",g.width)}}}if(!1===e){var v=0,m=0,p=0;for(d=0;d<i;d++){if("none"!==t[d].getStyle("display")){m++;var S=t[d].getStyle("min-width"),b=r(t[d]);S&&""!==S&&v++,(I=parseInt(S.match(/[0-9]*/)))>b?b=I:t[d].setStyle("width",b),p+=b}}var C=m-v,E=C<=0;E&&(C=m);var _=(this.MainTable.getSize().width-p)/C;for(d=0;d<i;d++){if("none"!==t[d].getStyle("display")&&(E||!t[d].getStyle("min-width"))){var y=_;if(E){var I;S=t[d].getStyle("min-width"),b=r(t[d]);(I=parseInt(S.match(/[0-9]*/)))>b&&(b=I),y+=b}t[d].setStyle("width",y)}}}},getAllHeadersIndex:function(){var e=this.MainTableHeader.getElements("th"),t=[];return e.forEach(function(e){var n=e.attributes.dataIndex.value;t.push(n)}),t},getCurrentSelectedLine:function(){return this.MainTableDiv.getElement("tbody").getElements("tr.selected")},selectFirstLines:function(e,t){var n=[],i=this;e.forEach(function(e){var t=i.findLines(e).goodLines,a=null;t.length>0&&(a=t[0],n.push(a))}),this._selectLines(n,t,!0)},selectFirstLine:function(e,t){this.selectFirstLines([e],t)},_selectLines:function(e,t,n){0==t||t||(t=!0),(!1===this.options.setMultiSelection||n)&&this._unSelectAllLine(e),e&&e.forEach(function(e){e.toggleClassName("selected",n)}),t&&this.dispatchEvent("onSelection")},_unSelectAllLine:function(e){this.getCurrentSelectedLine().forEach(function(t){var n=!1;e.every(function(e){return e!==t||(n=!0,!1)}),!1===n&&t.toggleClassName("selected",!1)})},createNewLine:function(e){var t=this,n=UWA.createElement("tr",e);return t.options.contextMenu.length>0&&require(["DS/UIBehaviors/ContextualMenuManager"],function(e){e.onReady({target:n,nodes:t.options.contextMenu})}),n},_getNewElementStoreId:function(){for(var e=!0,t=this.saveElementObj.listId,n=t.length;!0===e;)n++,e=!1,t.forEach(function(t){n===t&&(e=!0)});return n},_addNewElementStoreInTable:function(e){var t=this._getNewElementStoreId(),n="element"+t;return this.saveElementObj.listId.push(t),this.saveElementObj[n]=e,{id:t,idProp:n}},_removeStoredElement:function(e){if(e.hasOwnProperty("id")&&e.hasOwnProperty("idProp")){var t=this.saveElementObj.listId.indexOf(e.id);this.saveElementObj.listId.splice(t,1),delete this.saveElementObj[e.idProp]}},_dispatchNotification:function(e){this.dispatchEvent("onNotification",e)},_onPointingEvent:function(e,t,n){this.dispatchEvent("onPointingEvent",{type:e,evt:t,cellPosition:n})},_generateNewCellForLine:function(e,t){var n=this;this.getAllHeadersIndex().forEach(function(i){var s="";e.hasOwnProperty(i)&&(s=e[i]);var r=!0===(g=n.getColumnHeader(i)).hidden?" hidden":"",o=UWA.createElement("td",{class:i+r});o.setAttribute("data-rec-id","dataRecCell"+i+e.Id);var h={line:e,headerIndex:i};n._addEventsOnLine(o,t,h);var d=!1,c=null;if(null!==s&&"object"==typeof s){d=!0;var u=n._addNewElementStoreInTable(s);o.setData("idElement",u),"function"==typeof s.inject?s.inject(o):c=s instanceof Date?s.toLocaleString(a.getLanguage()):s.toString()}else c=null===s?"":s;var g=n.getColumnHeader(i);if(c)if(g&&!0===g.fixed){if(!1===d){u=n._addNewElementStoreInTable(c);o.setData("idElement",u)}(c=UWA.createElement("span",{text:c})).inject(o)}else o.setText(c);if(g&&g.resizable){var f=n.classResize,v="."+f+" ."+i,m=UWA.createElement("div",{class:"resizeHandler"}),p=null;m.inject(o),n.elements.moveHelpers0=new l({element:m,events:{startMove:function(){p=o.getSize()},move:function(e){var t={},n=p.width-e.diff.x;n<20&&(n=20),t[v]={width:n+"px"},a.addNewStyles(f+"_style",t,!0),localStorage.setItem(f+"_style",JSON.stringify({style:t,width:n}))},endMove:function(){n.dispatchEvent("onCellResize",o),n._dispatchOnResize()}}})}o.inject(t)})},_addEventsOnLine:function(e,t,n){var i=this;e.addEvents({dblclick:function(e){i._onPointingEvent("dblclick",e,n)},click:function(e){i._onPointingEvent("click",e,n),!0===i.options.activeSelection&&i._selectLines([t])},contextmenu:function(e){i._onPointingEvent("contextmenu",e,n)},touchstart:function(e){var t=null,a=new Date;i.firstTouch&&(t=a-i.firstTouch),i.firstTouch=a,t&&t<500?i._onPointingEvent("dblclick",e,n):i._onPointingEvent("touchstart",e,n)}})},AddDatasInTable:function(e,t){var n=this,i=this.getAllLine(),a=null,l=this._getBodyTable();e.forEach(function(e){var t=e.datagridOptions,i="";if(t){var s=t.customClass;s&&(i=s)}var r=n.createNewLine({class:"standardLine "+i,"data-rec-id":"dataRecNewLine"});a||(a=r),r.inject(l),n._generateNewCellForLine(e,r)}),i.length<=0&&(n.updateScroller(),n.fixeColumns()),n.resizeTable(),!1!==t&&n.applySort()},AddDataInTable:function(e){this.AddDatasInTable([e])},_getBodyTable:function(){return this.MainTableDiv.getElement("tbody")},AddMultiColumnLineInTable:function(e){var t="";e.hasOwnProperty("className")&&(t=e.className);var n=0;e.hasOwnProperty("span")?n=e.span:n=this.getAllHeadersIndex().length;0===n&&(n=1);var i=this.MainTableDiv.getElement("tbody"),a=this.createNewLine({}).inject(i),l={line:e,headerIndex:null},s=UWA.createElement("td",{class:"DG_spanElement "+t,colspan:n});this._addEventsOnLine(s,a,l);var r=e.insideElement;if("object"==typeof r){var o=this._addNewElementStoreInTable(r);s.setData("idElement",o),r.inject(s)}else s.setText(r);s.inject(a),this.resizeTable()},removeLine:function(e){var t=this,n=this.findLines(e);n.goodLines.forEach(function(e){e.getElements("td").forEach(function(e){var n=e.getData("idElement");n&&t._removeStoredElement(n)})});var i=n.badLines;this.MainTableDiv.getElement("tbody").setContent(i)},HideLine:function(e,t){var n=this,i=this.findLines(e);(i=i.goodLines).forEach(function(e){!0===t?(e.hide(),e.inject(n.MainTableDiv.getElement("tbody"))):e.show()}),this.applySort()},hideAllLines:function(e){this.getAllLine().forEach(function(t){!0===e?t.hide():t.show()})},getCellFromPosition:function(e,t){var n=this.findLines(e),i=null;return(n=n.goodLines)&&n.length>0&&(i=n[0].getElement("."+t)),i},getCellsContent:function(e,t){var n=this,i=[],a=this.findLines(e);return(a=a.goodLines).forEach(function(e){var a=n.getCellContent(e,t);a||(a=""),i.push(a)}),i},getCellContent:function(e,t){var n=null,i=e.getElement("."+t);return i&&(n=this._getInsideElement(i)),n},getCellsValue:function(e,t){var n=this,i=[],a=this.findLines(e);return(a=a.goodLines).forEach(function(e){var a=n.getCellValue(e,t);a||(a=""),i.push(a)}),i},getCellValue:function(e,t){var n=this.getColumnHeader(t),i=e.getElement("."+t),a=null;return n.hasOwnProperty("sortKey")&&(a=n.sortKey),this._getElementValue(i,a)},clearCell:function(e,t){var n=this,i=this.findLines(e);(i=i.goodLines).forEach(function(e){var i=e.getElement("."+t),a=i.getData("idElement");a&&(n._removeStoredElement(a),i.setData("idElement",{})),i&&i.setHTML("")})},findLines:function(e,t,n){var i=this,a=this.getAllLine(),l=[],s=[];Array.isArray(e)||(e=[e]);return a.every(function(a){var r=!0,o=!0===n?0:a;return e.every(function(e){for(var t in r=!0,e){var n=i.getColumnHeader(t);if(!n){r=!1;break}var l=a.getElement("."+t);if(!l){r=!1;break}var s=null;if(n.hasOwnProperty("sortKey")&&(s=n.sortKey),i._getElementValue(l,s)!==e[t]+""){r=!1;break}}return!0!==r}),!0===r?l.push(o):s.push(o),!t||!r}),{goodLines:l,badLines:s}},getColumnHeader:function(e){var t=null,n=this;return this.Column.every(function(i,a){return i.dataIndex!==e||(t=n.Column[a],!1)}),t},getColumnHeaderIndex:function(e){var t=null;return this.Column.every(function(n,i){return n.dataIndex!==e||(t=i,!1)}),t}})}),define("DS/DataGridWidget/Datasheet",["DS/DataGridWidget/DataGridWidget","DS/DataGridWidget/models/SheetLine","DS/WidgetServicesUI/helpers/Helpers","DS/WidgetServices/WidgetServices","DS/Controls/Button"],function(e,t,n,i,a){"use strict";return e.extend({mapLines:{},lines:[],_tweakerCallback:{},defaultOptions:{rollback:!0,colorization:!1},init:function(e,t){this.mapLines={},this.lines=[],this._tweakerCallback={};var n=(t=t||{}).className;n=n||"",t.className="DGW_Sheet "+n,(e=e||[]).unshift({text:UWA.i18n("Id"),dataIndex:"_Id",hidden:!0}),!0===t.colorization&&e.unshift({text:"",dataIndex:"_Color"}),this._parent(e,t)},removeAll:function(){this.clearAllLine(),this.mapLines={},this.lines=[]},clearAllLine:function(){this._parent()},moveLine:function(e,t){var n=this._getLineFromId(e);if(null!==n){var i=this._getBodyTable();if(void 0===t)n.inject(i);else if(null===t)n.inject(i,"top");else{var a=this._getLineFromId(t);null!==a&&n.inject(a,"after")}}},_getLineFromId:function(e){var t={};t._Id=e;var n=this.findLines(t,!0,!1),i=null;return n.goodLines.length>0&&(i=n.goodLines[0]),i},addHeader:function(e){this._parent(e)},getAllLinesId:function(){return Object.keys(this.mapLines)},getAllLines:function(){return this.lines},changeColorOnLine:function(e,t){var n=this._getLineFromId(e);n&&(1==t?n.addClassName("DGW_defaultColor"):n.removeClassName("DGW_defaultColor"))},_changeValue:function(e,t,n,i){var a=this.mapLines[t].getData(),l=this.getColumnHeader(n);a.setValue(n,i),a.addChangedValue(n),l.events&&l.events.onChange&&l.events.onChange.call(this,a,n)},getTweaker:function(e,t,n){var i=e;"object"==typeof e&&(i=e.getID());var a=null,l=this.mapLines[i];if(l){var s=l._tweakers;s&&s[t]&&(a=s[t]),n.call(this,a)}else{var r=this._getOrCreateProp(this._tweakerCallback,i,!1);this._getOrCreateProp(r,t,!0).push(n)}},_getOrCreateProp:function(e,t,n){var i=e[t];return i||(i=n?[]:{},e[t]=i),i},_getValue:function(e,t){var n=e.getValue(t),i=void 0===n,a=this.getColumnHeader(t);return void 0!==(n=i&&void 0!==a.defaultValue?a.defaultValue:n)&&i&&e.canInitialize()&&e.setValue(t,n),n},_sortAndUpdateTable:function(e,t){var n=e.dataIndex;this.lines.sort(function(a,l){var s=a.getData().getValue(n),r=l.getData().getValue(n),o=0;if(s)if(r){var h=null;e.hasOwnProperty("sortKey")&&(h=e.sortKey);s=null!=h?h(s):s,r=null!=h?h(r):r;o=i.compareValue(s,r),o=!1===t?-1===o?-1:1:1===o?-1:1}else o=1;else o=-1;return o}),this.clearAllLine(),this.AddDatasInTable(this.lines,!1)},addLinesSheet:function(e){var i=this,l=this.getAllHeadersIndex();e.forEach(function(e){if(e instanceof t){var s=e.getID();e.addEvent("onColorChanged",function(e){i.changeColorOnLine(s,!0===e)});var r={},o={};l.forEach(function(t){o[t]=null;var l=i._getValue(e,t);void 0===l&&(l=null),r[t]="string"==typeof l?l:"";var h=i.getColumnHeader(t);if(void 0!==l){var d={events:{change:function(e){i._changeValue(this,s,t,e)},liveChange:function(e){i._changeValue(this,s,t,e)},notification:function(e){i._dispatchNotification(e)}}};if(h.inputOptions)for(var c in h.inputOptions)d[c]=h.inputOptions[c];var u=UWA.createElement("div",{class:"datasheet_ui_container"});"object"!=typeof r&&(r={}),r[t]=u,d.value=l,d.editable=!0===h.editable,n.getTweaker(h.type,d,function(n){if(e.addEvent("onPropChanged:"+t,function(t){if(!0===i.options.rollback&&this.isRollbackOnCells()){var a=n.getHTMLElement().getParent("td");a&&(this.hasChanged(t)?a.addClassName("datasheet_cell_changed"):a.removeClassName("datasheet_cell_changed"))}n.setValue(e.getValue(t))}),n.inject(u),o[t]=n,i._tweakerCallback){var l=i._tweakerCallback[s];if(l){var r=l[t];r&&(r.forEach(function(e){e.call(i,n)}),delete l[t],0===Object.keys(l).length&&delete i._tweakerCallback[s])}}var h=UWA.createElement("div",{class:"datasheet_forgetButton"}).inject(u);!0===i.options.rollback&&new a({icon:"undo",displayStyle:"lite",onClick:function(){e.resetValue(t);var a=e.getInitialValue(t),l=void 0!==a?a:i._getValue(e,t);n.setValue(l)}}).inject(h),e.raiseEventsForChanges(t)})}}),r._Id=s,r._data=e,r._tweakers=o,r.getData=function(){return this._data},r.getID=function(){return this._Id},!0===e.getColor()&&(r.datagridOptions={customClass:"DGW_defaultColor"}),i.mapLines[s]=r,i.lines.push(r)}}),this.clearAllLine(),this.AddDatasInTable(this.lines),this._raiseChangeEventForLines(e)},sortFromList:function(e){var t=this,n=this.getAllLine(),i={};n.forEach(function(e){var n=t.getCellValue(e,"_Id");i[n]=e});var a=this._getBodyTable();for(var l in this._clearAllLines(),e.forEach(function(e){var t=i[e];t&&t.inject(a),delete i[e]}),i){var s=i[l];s&&s.inject(a)}t.updateScroller(),t.fixeColumns(),t.resizeTable(),t.applySort()},_raiseChangeEventForLines:function(e){e.forEach(function(e){e.raiseEventsForChanges()})}})});