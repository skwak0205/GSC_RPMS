define("DS/DELPPWLinksModule/LinksUI",["UWA/Core"],function(e){"use strict";return function(t,n,i,o,r,s,a){var l,c,d,u,f,g,p,h,m,P,b,I,y,v,R,A,C,L,E,T,D,S={className:"Links MGA-linksUIContainer disableContentselection"},k=i.getNLSValue("LinksUI.PanelTitle"),w={},U=null,M={title:"",labelAttribute:"V_Name",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}};return P=function(){e.is(U)&&(U.title=k+M.title)},b=function(){var i,o,r,s,a=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext());(U=n.create("Panel",{position:{my:"center",at:"center"},domId:"RelationsPanel",immersiveFrame:a.getImmersiveFrame(),resizableFlag:!0,visibleFlag:!1})).close=function(){e.is(c)?t.notify("toggleCmdCheckHeaderState",{cmdName:c,cmdState:!1}):v()},p=n.create("Element","div",{class:S.className}),i=n.create("Element","div",{class:"linksPanel-Container"}),o=n.create("Element","div",{class:"module-messages"}),r=I(),s=y(),o.inject(i),r.inject(i),s.inject(i),i.inject(p)},I=function(){var t;return t=n.create("Element","div",{class:"linkView-toolbar"}),(h=n.create("Filter",{filterToolbarSections:f})).inject(t),h.addEvent("onChange",function(t,n){var i,o;for(i in o=this.getSelectedItems(),w)w.hasOwnProperty(i)&&(-1===o.indexOf(i)?w[i].pprTypeDiv.hide():(e.is(t,"string")&&"PARENT"===t&&!0===n&&!1===M.whereUsed.isFetched&&R(),w[i].pprTypeDiv.show()))}),t},y=function(){var t,i;for(i in t=n.create("Element","div",{class:"LinksUI-menuDiv"}),(g=n.create("WUXLoader")).inject(t),w)w.hasOwnProperty(i)&&(w[i].pprTypeDiv=new e.Element("div",{class:"pprTypeDiv"}).inject(t));return t},v=function(){U.hide()},R=function(){var n,i=!1,s=!1,a=[],l=[],c=[],d=M.reference.model,u=M.instance.model,f=M.labelAttribute,p=!1,m=null,P=[],b=function(){var e,n,o,r;i&&s&&(e=a,n=l,o=c,r={PRODUCT:[],PROCESS:[],SYSTEM:[],RESOURCE:[],PART:[],PARENT:[]},D(),r=C(e,d,u,f,r),r=L(n,o,d,u,f,r),A(r),g.hide(),t.notify("RelationsPanelLoaded")),p&&t.notify("updateRelationsColumn",m)},I=function(e){i=!0,a=e,b()};n=h.getSelectedItems(),!0!==M.whereUsed.isFetched?e.is(d)&&-1!==n.indexOf("PARENT")?(r.getWhereUsedReferences(d,function(t,n){s=!0,e.is(M.whereUsed)&&(M.whereUsed.isFetched=!0,M.whereUsed.references=t,M.whereUsed.instances=n),l=t,c=n,b()}),M.whereUsed.isFetched=!0):s=!0:(e.is(d)&&-1!==n.indexOf("PARENT")&&(l=M.whereUsed.references||[],c=M.whereUsed.instances||[]),s=!0),D(),e.is(u)&&(p=p||r.needToQueryForConnections(u),e.is(m)||(m=u.get("PID"))),e.is(d)&&(p=p||r.needToQueryForConnections(d),e.is(m)||(m=d.get("PID"))),g.show(),r.isNavigateOnDemand()?(e.is(u)?P.push({id:u.get("PID"),path:M.instance.absPath}):e.is(d)&&P.push({id:d.get("PID"),path:[]}),P.length>0&&o.getRelations(P).then(function(t){var n,i;i=e.is(u)?u.get("PID"):d.get("PID"),n=o.getImpactedConnections(i),I(n)})):o.getConnectionsByModel(d,u,{silentMode:!0,onComplete:I})},A=function(t){var o,s,a,l,c,d,u,f,g,p,m,P,b;for(a in m=h.getSelectedItems(),t)if(t.hasOwnProperty(a)&&w.hasOwnProperty(a)){if(l=t[a],s=w[a].pprTypeDiv,0===l.length){s.setStyle("display","none");continue}for(m.indexOf(a)>-1?s.show():s.hide(),s.addClassName("pprTypeMarg"),new e.Element("div",{class:"pprTypeTitleDiv",text:w[a].title}).inject(s),o=0;o<t[a].length;o++){if(u=n.create("Element","div",{class:"connectionDiv default"}),p=(c=t[a][o]).type,e.is(p)&&("SecondaryCandidateResourceLink"===p&&(u.className="connectionDiv secondaryRecource"),g=c.iconDirection,e.is(g)&&(-1!==p.indexOf("_inverse")?g.tooltipInfos=n.create("TooltipModel",{shortHelp:i.getNLSValue("LinksUI.BackwardIcon")}):g.tooltipInfos=n.create("TooltipModel",{shortHelp:i.getNLSValue("LinksUI.ForwardIcon")}),g.inject(u)),f=c.icon,e.is(f)&&(f.tooltipInfos=n.create("TooltipModel",{shortHelp:i.getNLSValue(p)}),f.inject(u))),(d=n.create("Element","div",{class:"connectionLabel",text:c.label,styles:{display:"inline-block"}})).tooltipInfos=n.create("TooltipModel",{shortHelp:c.label}),d.inject(u),e.is(M.reference)&&e.is(M.reference.model)){const e=M.reference.model;P=r.isReferencesHasReadOnlyType(e)}P||((b=n.create("Button",{label:"",icon:"bars",iconSize:"2x",displayStyle:"lite",onClick:E}).inject(u)).getContent().setStyles({float:"right"}),b.getContent().setData("pid",c.pid),b.getContent().setData("linkedReferencePID",c.linkedReferencePID)),u.inject(s)}}},C=function(n,s,c,d,u){var f,g,p,h,m,P,b,I,y,v,R,A,C,L,E,T,D,S=l,k=e.is(s)?s.id:"",w=e.is(c)?c.id:"";for(f=0;f<n.length;f++){switch(g=(b=n[f]._attributes).type){case"DELLmiTimeConstraintCnx":g=o.getLinkInfo(n[f]).subType;break;case"DELAsmProcessCanUseCnx":o.getSecondaryRscLinksFromPrimaryLink(n[f]).forEach(function(e){(D=e.clone()).set("from",b.from),n.splice(f+1,0,D)});break;case"SecondaryCandidateResourceLink":if(T=o.getConnection(b.from),e.is(T)){(D=n[f].clone()).set("from",T.get("from")),n.splice(f+1,0,D),(D=n[f].clone()).set("from",T.get("to")),n.splice(f+1,0,D);continue}}if(R=b.to,!("ProcessImplementLinkOcc"===b.type&&e.is(b.from,"array")&&e.is(b.to,"array")&&e.is(M.instance.absPath))||a.isImplementLinkValidForOccPath(b.from,b.to,M.instance.absPath))if(E=!!e.is(b.to,"array")&&w===b.to[b.to.length-1],k===b.to||w===b.to||E?(R=b.from,g+="_inverse",y=i.getIconElem("LinkInverse")):y=i.getIconElem("Link"),A=r.getReference(R),e.is(A)||((v=e.is(R,"array")?r.getInstance(R[R.length-1]):r.getInstance(R))?A=r.getReference(v.get("isInstanceOf")||v.get("to")):t.debug("No linked instance !!!")),e.is(A)){if(P=A.get("type"),e.is(S[P])&&e.is(S[P].Attribute)){C=S[P].Attribute,C=e.is(C,"array")?C:[C];const t=S[P].separator||" ";h=C.map(e=>A.get(e.name)).join(t)}else h=A.get(d);if(e.is(S[g])&&e.is(S[g].Attribute)){C=S[g].Attribute,C=e.is(C,"array")?C:[C];const t=S[g].separator||" ";for(m="",L=0;L<C.length;L++)0!==L&&(m+=t),"ProcessImplementLinkOcc"!==g&&"ProcessImplementLinkOcc_inverse"!==g||"V_usage"!==C[L].name?m+=b[C[L].name]:m+=a.getRoleFromModelOrComputed(b.PID);h="("+m+")"+h}I=A.get("PPRTYPE"),e.is(I,"string")?("OPERATION"===I&&(I="SYSTEM"),p=i.getIconElem(g),u[I].push({label:h,icon:p,iconDirection:y,pid:b.PID,linkedReferencePID:A.get("PID"),type:g})):t.debug("PPRTYPE is not available for object type:"+P)}else t.debug("No linked reference !!!")}return u},L=function(n,o,r,s,a,c){var d,u,f,g,p,h,m,P,b,I,y=l;for(d=0;d<n.length;d++){if(h=(P=n[d]).get("type"),e.is(y[h])&&e.is(y[h].Attribute))for(I=y[h].Attribute,I=e.is(I,"array")?I:[I],m=y[h].separator||" ",g="",u=0;u<I.length;u++)0!==u&&(g+=m),g+=P.get(I[u].name);else g=P.get(a);for(f=i.getIconElem(h),p="Type."+h,u=0;u<o.length;u++)if(o[u].get("isAggregatedBy")===P.get("PID")){b=o[u];break}e.is(b)?c.PARENT.push({label:g,icon:f,pid:b.get("PID"),linkedReferencePID:P.get("PID"),type:p}):t.debug("Instance of reference id:"+P.get("PID")+" not found.")}return c},m=function(t){var n,i;n=o.getConnection(t),e.is(n)?o.deleteConnection(t):(i=r.getInstance(t),e.is(i)&&r.deleteInstance([i],{askDeleteConfirmation:!1}))},E=function(a){var l,c,f,g,p,h,P=[],b=this.getData("pid"),I=this.getData("linkedReferencePID"),y=r.getReference(I),v=y.get("PPRTYPE"),R=a.currentTarget.getOffsets().x,A=a.currentTarget.getOffsets().y+25;c=e.is(o.getConnection(b)),f={icon:"url("+i.getIconURLFromKey("GeneralDelete")+")",label:i.getNLSValue("LinksUI.DeleteLink"),sensitivity:c?o.canDeleteRelation(b)?"enabled":"disabled":"enabled",callback:function(){m(b)}},l={icon:"url("+i.getIconURLFromKey("EditAttribute")+")",label:i.getNLSValue("LinksUI.EditAttribute"),sensitivity:s.hasEditConfiguration(b)?"enabled":"disabled",callback:function(){s.editConfiguredAttributes(b)}},g={icon:"url("+i.getIconURLFromKey("showAuxiliaryView")+")",label:i.getNLSValue("LinksUI.ShowInAuxiliaryView"),sensitivity:"enabled",callback:function(){t.notify("addToAuxiliaryView",y)}},Object.keys(d).indexOf(v)>-1&&(p={icon:"url("+i.getIconURLFromKey(d[v].icon)+")",label:i.getNLSValue("LinksUI.ShowInNaturalView",{view:i.getNLSValue(d[v].view)}),sensitivity:"enabled",callback:function(){t.notify("addReference",[y,null,{withLinksResolved:!0}])}}),h={icon:"url("+i.getIconURLFromKey("ExploreInWebApp")+")",label:i.getNLSValue("ExploreInWebApp",null,"Cmd","Title"),sensitivity:"enabled",callback:function(){t.notify("ExploreInWebApp",[[{referencePID:I}]])}},e.is(o.getConnection(b))?(P.push(f),P.push(l)):e.is(M.reference.model)&&"PRODUCT"!==M.reference.model.get("PPRTYPE")&&P.push(f),P.push(g),e.is(p,"object")&&P.push(p),o.isExploreWebAppEnabled()&&u&&P.push(h),n.getComponent("ContextualMenuManager").show({nodes:P},[R,A])},T=function(){var e;for(e in w)w.hasOwnProperty(e)&&("PARENT"===e?h.unselectItem(e,!0):h.selectItem(e,!0))},D=function(){Object.values(w).forEach(function(e){e.pprTypeDiv.empty()})},{init:function(t){S=e.extend(S,t),l=t.relAttributeConfig,c=e.is(t.relatedCmdId)?t.relatedCmdId:null,d=e.is(t.acceptedTypes)?t.acceptedTypes:null,u=!e.is(t.exploreInWebApp)||t.exploreInWebApp,f=e.is(t.filterToolbarSections)?t.filterToolbarSections:null,Array.isArray(f)?f.forEach(function(e){w[e]={title:i.getNLSValue("PPRTYPE."+e)}}):w={PRODUCT:{title:i.getNLSValue("PPRTYPE.PRODUCT")},PROCESS:{title:i.getNLSValue("PPRTYPE.PROCESS")},SYSTEM:{title:i.getNLSValue("PPRTYPE.SYSTEM")},RESOURCE:{title:i.getNLSValue("PPRTYPE.RESOURCE")},PART:{title:i.getNLSValue("PPRTYPE.PART")},PARENT:{title:i.getNLSValue("PPRTYPE.PARENT")}},b()},destroy:function(){this.isActive()&&v(),e.is(U)&&(U.destroy(),U=void 0)},showModal:function(t){M=e.extend(M,t),R(),U.show(),P(),U.content=p},isActive:function(){return!!e.is(U)&&U.visibleFlag},clear:function(){M={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}},P(),D()},hideUI:function(){U.hide()},updateWhereUsed:function(t){var n,i,o=-1;if(e.is(t)&&(n=t.isInstance()?t.get("isAggregatedBy"):t.get("PID"),e.is(M.whereUsed.references,"array"))){for(i=0;i<M.whereUsed.references.length;++i)if(M.whereUsed.references[i].id===n){o=i;break}-1!==o?M.whereUsed.references.splice(o,1):t.isInstance()&&(M.whereUsed.instances.push(t),M.whereUsed.references.push(r.getReference(n))),R()}},getCurrentModel:function(){return M},updateTitle:function(e){M.title=e,P()},resetFilter:function(){T()}}}}),define("DS/DELPPWLinksModule/LinksModule",["UWA/Core","DS/DELPPWLinksModule/LinksUI"],function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","SelectionBehavior","LinkBehavior","ModelBehavior","EditAttributeBehavior","ImplementBehavior","ProductFlowLinkBehavior"],creator:function(n,i,o,r,s,a,l,c){var d,u,f,g,p,h,m,P=null;return g=function(t,n){s.getXMLValues(d.relationsDialogDisplayAttributeConfigXML,function(n){var i=n.convert("DisplayAttributeDescriptionList.Type","name")||{},o=n.convert("DisplayAttributeDescriptionList.Relation","linkName")||{};u=e.merge(i,o),t()},function(e){n(e)})},p=function(t){var n=!1,i=P.getCurrentModel(),o=e.is(i.reference.model)?i.reference.model.id:"",r=e.is(i.instance.model)?i.instance.model.id:"";return t!==o&&t!==r||(n=!0),n},h=function(t){var i={instModel:{},refModel:{},absPath:""},o=t.id?t.id:t.instancePID,r=t.id?t.id:t.referencePID;return i.instModel=a.getInstance(o),e.is(i.instModel)?(i.absPath=t.path?t.path:t.absPath,i.refModel=a.getReferenceModelFromInstance(i.instModel)):(i.refModel=a.getReference(r),e.is(i.refModel)||n.debug("Object with reference PID:"+o+" and instance PID:"+r+" not found.")),i},f=function(t){var n,i,o,s,a={title:"",reference:{model:null},instance:{model:null,absPath:""},whereUsed:{isFetched:!1,references:[],instances:[]}};return e.is(t)?(n=h(t),i=n.refModel,o=n.instModel,s=n.absPath):1===r.getSelectedNodesCount()&&r.getSelectionsWithPaths().forEach(function(t){e.is(t)&&1===t.length&&t.forEach(function(e){n=h(e),i=n.refModel,o=n.instModel,s=n.absPath})}),a.title=e.is(i)?i.get("V_Name"):"",a.reference.model=i,a.instance.model=o,a.instance.absPath=s,a},m=function(){P.isActive()&&(P.resetFilter(),P.showModal(f()))},{name:"LinksModule",listenTo:function(){return{select:this.onSelect,Relations:this.onShowRelations,addInstance:this.onAddInstance,addConnection:this.onAddConnections,removeConnection:this.onRemoveConnections,removeReference:this.onRemoveRefOrInst,changeReference:this.onChangeRefOrInst,removeInstance:this.onRemoveRefOrInst,refreshImpacted:this.relaodUI}},onStart:function(r,p){if(d=r||{},!e.is(d.relationsDialogDisplayAttributeConfigXML))return n.debug("LinksModule loading failed : relationsDialogDisplayAttributeConfigXML options are undefined"),void p();Promise.all([new Promise(g.bind(this))]).then(function(){(P=new t(n,i,o,s,a,l,c)).init({relAttributeConfig:u,relatedCmdId:d.relatedCmdId,acceptedTypes:d.pprTypes,exploreInWebApp:d.exploreInWebApp,filterToolbarSections:d.filterToolbarSections}),P.showModal(f(d.node)),p()},function(e){n.debug("LinksModule loading failed :"+e),p()})},onStop:function(){P.destroy(),P=void 0},onRemoveRefOrInst:function(t){(t=Array.isArray(t)?t:[t]).forEach(function(t){e.is(t)&&P.isActive()&&(p(t.id)?P.clear():P.updateWhereUsed(t))})},onChangeRefOrInst:function(t){var n;(t=Array.isArray(t)?t:[t]).forEach(function(t){P.isActive()&&e.is(t)&&t.isReference()&&p(t.id)&&(n=t.changedAttributes(),e.is(n)&&n.hasOwnProperty("V_Name")&&P.updateTitle(n.V_Name))})},onShowRelations:function(t){var n;n=e.is(t)?e.is(t,"array")?t[0]:t:null,e.is(n)&&P.isActive()&&P.showModal(f(n))},onSelect:function(){m()},onAddConnections:function(t){var n,i,o;P.isActive()&&(o=function(t){return!!(e.is(t)&&(n=t.getAttribute("from"),i=t.getAttribute("to"),p(n)&&p(i)))},(e.is(t,"array")?t.some(o):o(t))&&P.showModal(P.getCurrentModel()))},onRemoveConnections:function(t){var n,i,o;P.isActive()&&(o=function(t){var o,r,a,l;if(e.is(t))if(n=t.getAttribute("from"),i=t.getAttribute("to"),"SecondaryCandidateResourceLink"===t.get("type")){if(o=s.getConnection(n),!e.is(o))return!1;if(r=o.getAttribute("from"),a=o.getAttribute("to"),l=i,p(r)||p(a)||p(l))return!0}else if(p(n)||p(i))return!0;return!1},(e.is(t,"array")?t.some(o):o(t))&&P.showModal(P.getCurrentModel()))},onAddInstance:function(t){e.is(t)&&P.isActive()&&p(t.get("isInstanceOf"))&&P.updateWhereUsed(t)},relaodUI:function(){m()}}}}});