define("DS/MPFFaqComponent/MPFFaqFeatureSuggestion",["UWA/Core","UWA/Class/View","DS/UIKIT/Form","i18n!DS/MPFFaqComponent/assets/nls/MPFFaqFeatureSuggestion"],function(e,t,i,n){"use strict";return t.extend({setup:function(e){this.form=null},render:function(){this.form=new i({url:"https://toto.fr",className:"horizontal",fields:[{type:"text",name:"name",label:n.nameLabel,placeholder:n.namePlaceholder,required:!0},{type:"text",name:"company",label:n.companyLabel,placeholder:n.companyPlaceholder,required:!0},{type:"email",name:"email",label:n.emailLabel,placeholder:n.emailPlaceholder,required:!0},{type:"tel",name:"phone",label:n.phoneLabel,placeholder:n.phonePlaceholder,required:!0},{type:"textarea",name:"message",label:n.messageLabel,placeholder:n.messagePlaceholder,rows:10,required:!0}],buttons:[{type:"submit",value:n.sendMessageButton}],events:{onSubmit:this._onFormSubmit.bind(this)}});var t=e.createElement("div",{html:[{tag:"h4",text:n.suggestFeatureTitle,styles:{padding:"10px 28px 15px 28px"}},this.form]});this.container.setContent(t)},_onFormSubmit:function(e){var t=this.form,i=n.mailSubject,s=t.getValue("message")+" \n\n"+n.nameLabel+" : "+t.getValue("name")+" \n"+n.companyLabel+" : "+t.getValue("company")+" \n"+n.emailLabel+" : "+t.getValue("email")+" \n"+n.phoneLabel+" : "+t.getValue("phone")+" \n";window.location.href=this._generateMailTo("marketplace.make@3ds.com",i,s),this.container.setContent('<p class="text-center text-success"><br /><br /><br />'+n.mailSentMessage+"</p>")},_generateMailTo:function(e,t,i){return"mailto:"+e+"?subject="+this._prepareForMail(t)+"&body="+this._prepareForMail(i)},_prepareForMail:function(e){return encodeURIComponent(e).replace(" ","%20").replace("\n","%0D%0A")}})}),define("DS/MPFFaqComponent/MPFFaqHandlebarsHelpers",["UWA/Core","WebappsUtils/WebappsUtils","DS/Handlebars/Handlebars"],function(e,t,i){"use strict";return{addHandlebarsHelpers:function(n){var s=this;"i18n"in i.helpers||i.registerHelper("i18n",function(e,t){return new i.SafeString(null!=i.i18n?i.i18n.get(e,t.hash):e)}),"ifCond"in i.helpers||i.registerHelper("ifCond",function(e,t,i){return e===t?i.fn(this):i.inverse(this)}),"userHasRole"in i.helpers||i.registerHelper("userHasRole",function(e,t){return s.userHasRole(e,t)}),"faq-image"in i.helpers||i.registerHelper("faq-image",function(e){var s=t.getWebappsAssetUrl(n,"images/"+e);return new i.SafeString('<img src="'+s+'" />')}),"faq-images"in i.helpers||i.registerHelper("faq-images",function(){var s=(new Date).valueOf(),o=arguments;return require(["DS/UIKIT/Carousel"],function(i){for(var r="",a=0;a<o.length-1;a++){r+='<img src="'+t.getWebappsAssetUrl(n,"images/"+o[a])+'" />'}var l=new i({slides:e.createElement("div",{html:r}),slideSelector:"> img",autoPlay:!0,animation:"slide",dots:!0,infinite:!0}),c=document.querySelector("#_"+s);c&&(l.inject(UWA.extendElement(c),"after"),c.parentNode.removeChild(c))}),new i.SafeString('<div id="_'+s+'"></div>')}),"faq-columns"in i.helpers||i.registerHelper("faq-columns",function(e){var t=e.fn(this);return new i.SafeString('<div class="row">'+t+"</div>")}),"faq-column"in i.helpers||i.registerHelper("faq-column",function(e){var t=e.fn(this);return new i.SafeString('<div class="col-md-6">'+t+"</div>")})},userHasRole:function(e,t){var i=!1;if(t){if(e&&e.length)for(var n=t.split(">"),s=n[0],o=n.length>1?n[1]:void 0,r=0;r<e.length;r++)if(e[r].Role===s&&(!o||e[r].Project===o)){i=!0;break}}else i=!0;return i}}}),define("DS/MPFFaqComponent/MPFFaqWidget",["UWA/Core","UWA/Promise","UWA/Class/View","DS/Handlebars/Handlebars","DS/MPFFaqComponent/MPFFaqHandlebarsHelpers","text!DS/MPFFaqComponent/assets/templates/MPFFaqComponent.hbs","i18n!DS/MPFFaqComponent/assets/nls/MPFFaqComponent","css!DS/MPFUI/MPFUI"],function(e,t,i,n,s,o,r){"use strict";return i.extend({domEvents:{"click img":"_onImageClick","click .mpf-faq-go-top":"scrollToTop"},setup:function(e){this._onUrlChanges=this._onUrlChanges.bind(this),this._onResize=this._onResize.bind(this,this._isMobileDevice()),this._onScroll=this._onScroll.bind(this),this.model={pageUrlBase:this._getPageUrlBase(),categories:[],categoryToDisplay:null,roles:null},this.datasModule=null,this.i18nDatas=null,this.template=n.compile(o),this.isOnSummaryPage=!0,this.pageParent=this._getPageParent(e.widget),this.pageParent.setStyles({scrollBehavior:"smooth"}),this.isSticky=!1,e.widget.data&&e.widget.data.datasModule&&(this.datasModule=e.widget.data.datasModule),s.addHandlebarsHelpers(this.datasModule),this._fetchMeRoles().then(function(){this._loadDatasModule(),this._listenResize(),this._listenScroll()}.bind(this))},_getPageParent:function(e){var t=document.querySelector(".wp-tabview-panel")||e.body;return"auto"!==window.getComputedStyle(t).getPropertyValue("overflow-y")&&((t=e.body).style.overflowY="auto"),t},render:function(){var t,i,s;this.model&&(n.i18n=e.merge(this.i18nDatas,r),t=this.template.call(null,this.model),this.container.setContent(t),this.model&&this.model.categoryToDisplay&&((i=this.model.categoryToDisplay.component)&&(s=this.container.getElement(".mpf-faq-component"))&&(i.render(),i.inject(s)),this._toggleActiveMenuCategory(),this._toggleActiveMenuLink()),this._updateMetas())},destroy:function(){this._stopListeningResize(),this._stopListeningUrlChanges(),this._stopListeningScroll(),this.stopListening(),this._parent()},_getPageUrlBase:function(){var e=window.dsBaseUrl.replace(document.location.protocol+"//"+document.location.host+"/",""),t=document.location.href.replace(window.dsBaseUrl,"").split("/");return t.length>1&&t.pop(),"/"+e+(t=t.join("/").split("?")[0])},_fetchMeRoles:function(){var e=this,i=t.deferred();return window.dsUserLogin?require(["DS/MPFDataProxy/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2"],function(t,n){var s;t.fetchPromise().then(function(e){return n.getInstance(e).getFactory(n.Types.PERSON)}).then(function(e){return(s=e.createModel("me")).fetchPromise()}).then(function(){e.model.roles=s.get("PersonRoles"),i.resolve()})}):i.resolve(),i.promise},_loadDatasModule:function(){this.datasModule?(require(["text!DS/"+this.datasModule+"/assets/model/"+this.datasModule+"Model.json","i18n!DS/"+this.datasModule+"/assets/nls/"+this.datasModule],this._onDatasModuleLoaded.bind(this),console.error.bind("FAQ config file not found")),window.addEventListener("popstate",this._onUrlChanges)):console.error("FAQ no config file path set in widget parameters")},_stopListeningUrlChanges:function(){window.removeEventListener("popstate",this._onUrlChanges)},_onDatasModuleLoaded:function(e,t){var i=null;try{i=JSON.parse(e)}catch(e){console.error("FAQ JSON Datas error")}i&&(this.model.categories=i,this.model.categoryToDisplay=null,this.i18nDatas=t,this._getUrlSecondPart()?this._onUrlChanges():this.render())},_listenResize:function(){window.addEventListener("resize",this._onResize)},_stopListeningResize:function(){window.removeEventListener("resize",this._onResize)},_onResize:function(e){var t=this._isMobileDevice();t!==e&&(e=t,this._updateElementsStick())},_listenScroll:function(){this.pageParent.addEventListener("scroll",this._onScroll,{passive:!0})},_stopListeningScroll:function(){this.pageParent.removeEventListener("scroll",this._onScroll,{passive:!0})},_onScroll:function(e){var t=e.currentTarget.scrollTop;this._isMobileDevice()||(t>105&&!this.isSticky?this._stickElements(!0):t<105&&this.isSticky&&this._stickElements(!1))},_updateElementsStick:function(){var e=this.pageParent.scrollTop,t=!this._isMobileDevice()&&e>105;this._stickElements(t)},_stickElements:function(e){var t=e?"add":"remove";this.isSticky=e,this.isOnSummaryPage?(document.querySelector(".mpf-faq-subtitle").classList[t]("sticky"),document.querySelector(".mpf-faq-menu-content").classList[t]("for-sticky")):(document.querySelector(".mpf-faq-bloc .mpf-faq-category-title").classList[t]("sticky"),document.querySelector(".mpf-faq-articles").classList[t]("for-sticky"),document.querySelector(".mpf-faq-menu-content").classList[t]("sticky")),document.querySelector(".mpf-faq-go-top").classList[t]("on")},_isMobileDevice:function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<768},_toggleActiveMenuCategory:function(){var e,t,i=this._findCategoryFromUrl();i&&((e=this.container.getElement(".mpf-faq-category.active"))&&e.classList.remove("active"),(t=this.container.getElement('.mpf-faq-category[data-url="'+i.url+'"]'))&&t.classList.add("active"))},_toggleActiveMenuLink:function(){var e,t,i=this.container.getElement(".mpf-faq-article-link.active");i&&i.classList.remove("active"),(e=this._findArticleFromUrl())&&(t=this.container.getElement('.mpf-faq-article-link[data-url="'+e.url+'"]'))&&t.classList.add("active")},_scrollToArticle:function(){var e,t,i=this._findArticleFromUrl();i&&(e='.mpf-faq-anchor[data-url="'+i.url+'"]',(t=this.pageParent.querySelector(e))&&this.scroll(t))},_onUrlChanges:function(){var e,t,i=this.model.categoryToDisplay||{},n=this;this.model.categoryToDisplay=this._findCategoryFromUrl(),this.model.categoryToDisplay&&i.title!==this.model.categoryToDisplay.title?(this.isOnSummaryPage=!1,e=!0,this.model.categoryToDisplay.role&&(e=s.userHasRole(this.model.roles,this.model.categoryToDisplay.role)),e?this._getArticlesTemplates(this.model.categoryToDisplay.articles).then(this.render.bind(this)).then(this._updateElementsStick.bind(this)).then(setTimeout.bind(null,this._scrollToArticle.bind(this),500)):(console.error("User don't have '"+this.model.categoryToDisplay.role+"' role"),require(["DS/UWPClientCode/Navigation"],function(e){e.routeTo(document.location.pathname)}))):this.model.categoryToDisplay?(this.isOnSummaryPage=!1,"component"===(t=this._findArticleFromUrl()).type&&require([t.class],function(e){n._setCurrentComponent(new e),n.render()}),this._toggleActiveMenuLink(),this._scrollToArticle(),this._updateMetas()):(this.isOnSummaryPage=!0,this.model.categoryToDisplay=null,this.render(),this._updateElementsStick())},_getUrlSecondPart:function(){var e=document.location.href.replace(window.dsBaseUrl,"").split("/");return e.length>1?e[1].split("?")[0]:null},_findCategoryFromUrl:function(){var e,t,i,n=null,s=this._getUrlSecondPart();for(e=0;e<this.model.categories.length;e++){if((t=this.model.categories[e]).url===s){n=t;break}if(t.articles)for(i=0;i<t.articles.length;i++)if(t.articles[i].url===s){n=t;break}}return n},_findArticleFromUrl:function(){var e,t,i,n,s,o=null,r=this._getUrlSecondPart();if(r){for(e=0;e<this.model.categories.length;e++)if((t=this.model.categories[e]).articles)for(i=0;i<t.articles.length;i++)if((n=t.articles[i]).url===r){o=n;break}o||(s=this._findCategoryFromUrl())&&s.articles&&(o=s.articles[0])}return o},_getArticlesTemplates:function(i){var s,o=t.deferred(),a=this,l=i.length,c=0,d=function(){++c===l&&o.resolve()},u=this._findArticleFromUrl();for(s=0;s<i.length;s++)!function(t){var i,s;t.type?"component"===t.type&&t.url===u.url?require([t.class],function(e){a._setCurrentComponent(new e),d()},d):d():require(["text!DS/"+a.datasModule+"/assets/templates/"+t.url+".hbs"],function(o){i=n.compile(o),n.i18n=e.merge(a.i18nDatas,r),s=i(a.model),a._setArticleContent(t,s),d()},d)}(i[s]);return o.promise},_setArticleContent:function(e,t){var i,n,s,o;for(i=0;i<this.model.categories.length;i++)for(n=this.model.categories[i],s=0;s<n.articles.length;s++)if((o=n.articles[s]).url===e.url){o.content=t;break}},_setCurrentComponent:function(e){this.model.categoryToDisplay.component=e},_onImageClick:function(t){var i=e.createElement("div",{class:"mpf-faq-modal-mask off",html:{tag:"img",src:t.target.src},events:{click:function(){i.addClassName("off"),setTimeout(function(){i.remove()},250)}}});i.inject(e.extendElement(document.body)),setTimeout(function(){i.removeClassName("off")},10)},_updateMetas:function(){var e,t,i,n,s,o=this._findArticleFromUrl();o&&(e=this._findCategoryFromUrl(),t=this._getUrlSecondPart(),i=null,i=t===e.url?this.i18nDatas.get(e.title):this.i18nDatas.get(o.title),(n=document.createElement("div")).innerHTML=o.content,s=(n.textContent||n.innerText).substring(0,160),require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("update-metas",{title:{articleTitle:i},description:{articleDescription:s}})}))},scrollToTop:function(){window.parent.scrollTo({top:0,behavior:"smooth"})},scroll:function(e){var t=parseInt(UWA.extendElement(e).getPosition().y);e&&(this._interval&&clearInterval(this._interval),this.pageParent.scrollTo({top:t-64,left:0}),this._interval=setInterval(function(){t-64!==this.pageParent.getScrolls().top&&this.pageParent.getScrolls().top+this.pageParent.clientHeight!==this.pageParent.getScrolls().height||clearInterval(this._interval),parseInt(UWA.extendElement(e).getPosition().y)!==t&&this.scroll(e)}.bind(this),50))}})});