define("DS/MIBQueryWidget/DataGridViewForMIBQuery",["UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/Selection/XSO","DS/Windows/ImmersiveFrame","DS/Utilities/UUID","css!DS/MIBQueryWidget/DataGridViewForMIBQuery"],function(t,e,i,n,o,r,a,s,d){"use strict";return e.extend({defaultOptions:{idName:"dgvContainerMIBQuery"},model:null,init:function(t){if(this._parent(t),this.buildSkeleton(t.data),this.options=t,t._po_exposed){this._po_exposed=t._po_exposed;var e=this;this._po_exposed.getRows=function(){var t=[];e.model&&e.model.getRoots().forEach(e=>{var i=e.options.grid,n={objectId:i.objectId,title:i.Title,originated:new Date(i.originated)};t.push(n)});return t},this._po_exposed.setSelectedRow=function(t){var i=e.model.getRoots(),n=e.dataGridView.getNodesXSO();i.forEach(i=>{i.options.grid.objectId===t&&(n.empty(),n.add(i),e.dataGridView.ensureNodeModelVisible(i))})}}},getSelected:function(){return null!=this.model?this.model.getSelectedNodes():null},buildSkeleton:function(t){var e=this,i=this.options;this.model=new n;var a=this.model,u=[];t.forEach(function(t){var i=JSON.parse(JSON.stringify(t)),n=i.fullcontenturl;if(void 0!==n){const t=n.split("/");3==t.length&&(i.iteration=t[2])}var o=void 0;i.contenturl&&(o=i.contenturl.substring("cid:".length)),i.contenturl=o,i.options&&i.options.icons&&i.options.icons.length>0&&(i.icon=e.options.startOfURL+i.options.icons[0]);var r=i["attribute[XCADExtension.V_CADFileOrigin]"];void 0!==r&&r.length>0&&(i.cadorigin=r),void 0!==(r=i["attribute[XCADExtension.V_CADOrigin]"])&&r.length>0&&(i.cadorigin=r),void 0!==i.modified_ms&&(i.modified_date=new Date(parseInt(i.modified_ms)).toLocaleString()),void 0!==i.originated_ms&&(i.originated_date=new Date(parseInt(i.originated_ms)).toLocaleString()),i["attribute[PLMEntity.V_Name]"]?i.Title=i["attribute[PLMEntity.V_Name]"]:i["attribute[Title]"]&&(i.Title=i["attribute[Title]"]),u.push(i)}),a.prepareUpdate(),u.forEach(function(t){var e=new o({label:t.Text,grid:t});a.addRoot(e)}),a.pushUpdate();var l=!1;u.forEach(function(t){t.sandbox&&(l=!0)});var c=[{dataIndex:"icon",width:"20px",typeRepresentation:"icon",visibleFlag:!1},{text:"Title",dataIndex:"Title",width:"auto"},{text:"Type",dataIndex:"displayType",width:"auto"},{text:"Name",dataIndex:"name",width:"auto"},{text:"Revision",dataIndex:"branch",width:"auto"},{text:"Revision Comment",dataIndex:"branch.description",width:"auto",visibleFlag:!1},{text:"sandbox",dataIndex:"sandbox",width:"auto",visibleFlag:l,typeRepresentation:"boolean"},{text:"Maturity",dataIndex:"branch.current",width:"auto"},{text:"Owner",dataIndex:"branch.owner",width:"auto"},{text:"Collab Space",dataIndex:"branch.project",width:"auto"},{text:"Organization",dataIndex:"branch.organization",width:"auto"},{text:"Created",dataIndex:"branch.originated",width:"auto",typeRepresentation:"datetime"},{text:"Modified",dataIndex:"branch.modified",width:"auto",typeRepresentation:"datetime",visibleFlag:!1},{text:"CAD",dataIndex:"attribute[XCADExtension.V_CADOrigin]",width:"auto",visibleFlag:!1},{text:"Description",dataIndex:"attribute[PLMEntity.V_description]",width:"auto"},{text:"Module",dataIndex:"module",width:"auto",visibleFlag:!1},{text:"Branch UUID",dataIndex:"branch.uuid",width:"auto",visibleFlag:!1},{text:"Object Id",dataIndex:"objectId",width:"auto",visibleFlag:!1},{text:"Content Id",dataIndex:"contenturl",width:"auto",visibleFlag:!1},{text:"Full Content Id",dataIndex:"fullcontenturl",width:"auto",visibleFlag:!1}];this.dataGridView=new r({treeDocument:a,columns:c,cellDragEnabledFlag:!0,onDragStartCell:function(t,e){var i=e.draggedNodes,n=[];i.forEach(function(t){var e=t.options.grid,i={envId:"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",serviceId:"3DSpace",contextId:void 0,objectId:e.objectId,objectType:e.type,displayName:e.Title,displayType:e.displayType};n.push(i)});e.nodeModel;var o={protocol:"3DXContent",version:"1.1",source:d.v4(),widgetId:"undefined"==typeof widget?d.v4():widget.id,data:{items:n}};return t.dataTransfer.setData("Text",JSON.stringify(o)),t.stopPropagation(),!1},identifier:this.options.identifier});var h=this.dataGridView;h.rowSelection="multiple",h.cellSelection="single";var p=new s;p.setContentInBackgroundLayer(h.getContent()),p.reactToPointerEventsFlag=!1;var y=UWA.createElement("div",{id:i.idName});p.inject(y),this.elements.container=y}})}),define("DS/MIBQueryWidget/MIBQueryWidget",["css!DS/MIBQueryWidget/MIBQueryWidget","UWA/Controls/Abstract","DS/ENO6WPlugins/jQuery","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/MIBQueryWidget/assets/nls/MIBQueryWidgetNls","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/Controls/Button","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/MIBQueryWidget/DataGridViewForMIBQuery","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/LifecycleServices/LifecycleAlert"],function(t,e,i,n,o,r,a,s,d,u,l,c,h,p,y){"use strict";return e.extend({init:function(t,e,n){this.context={},this.securityCtx=null,this.tenant=null,this.id=n.id||"",this.resultList=[],this.queryStringInput=null,this._parent(n),this.container=UWA.createElement("div",{class:"mibquery_container"}),this.content=UWA.createElement("div",{class:"mibquery_content"}),this.content.inject(this.container),this._po_exposed={},i(this.content).data("_po_exposed",this._po_exposed);var o=this,s=new Promise((t,e)=>{a.app_initialization(function(){o.tenant=a.getTenant();var e=a.getOption("platform_services",null);null!=e&&e.length>0&&Array.isArray(e)&&e.forEach(function(e){null!=e&&e.hasOwnProperty("platformId")&&r.getSecurityContextList(e.platformId,function(){o.getSecurityContext=r.getSecurityContextForCollaborativeSharingCommands,t()})})})});Promise.all([s]).then(()=>{console.log("app_initialization done")}).catch(function(t){o._setEndWaitingResponse(),console.log("app_initialization failed:"),o.showError(t),o._onComplete()})},refresh:function(){this.executeCmd()},_onComplete:function(){},executeCmd:function(t,e,i){null==e&&(e={}),null==i&&(i=function(){}),e.hasOwnProperty("context")&&e.context&&(this.context=e.context),this._onComplete=function(){i()},this._showQueryPanel()},_setWaitingResponse:function(){void 0!==this.widget&&null!==this.widget?this.widget.body.style.cursor="wait":document.body.style.cursor="wait"},_setEndWaitingResponse:function(){void 0!==this.widget&&null!==this.widget?this.widget.body.style.cursor="default":document.body.style.cursor="default"},_showQueryPanel:function(){var t=this,e=this.content;e.empty();var i=null;(i=UWA.createElement("div",{class:"mibquery-query_div"})).inject(e),new UWA.Element("text",{text:o.Query,class:"mibquery-query_title"}).inject(i),this.queryStringInput=new l({sizeInCharNumber:40,displayClearFieldButtonFlag:!0}),this.queryStringInput.getContent().addClassName("mibquery-query_editor"),this.queryStringInput.inject(i),i.style.marginLeft="10px";var n=new d;n.label="Go",n.inject(i),n.getContent().style.marginLeft="10px",n.getContent().addEventListener("buttonclick",function(){console.log(t.queryStringInput.value),t._query(t.queryStringInput.value)}),this.dispatchEvent("onReady")},_showResultPanel:function(){var t=this.content;t.empty();var e=a.get3DSpaceBaseUrl(this.tenant),i=this.resultList;new c({identifier:"dgvContainerMIBQuery"+this.id,idName:"dgvContainerMIBQuery",data:i,securityCtx:this.securityCtx,startOfURL:e,_po_exposed:this._po_exposed}).inject(t),this.dispatchEvent("onResultDisplayed")},_query:function(t){this._setWaitingResponse(),this.resultList=[];var e=this,i=new Promise(t=>{t()});Promise.all([i]).then(()=>e._requireSecurityContext()).then(()=>e._queryRequest(t)).then(t=>{var i=null;return t.hasOwnProperty("results")&&(i=t.results),t.hasOwnProperty("status")&&"error"===t.status&&t.hasOwnProperty("report")?t:null===i||0===i.length?t:e._queryAttributesValue(i)}).then(t=>{e._setEndWaitingResponse(),e.resultList=[];var i=null;if(t.hasOwnProperty("results")&&(i=t.results),t.hasOwnProperty("status")&&"error"===t.status&&t.hasOwnProperty("report")){var o=t.report;o.length>0&&o[0].hasOwnProperty("message")&&e.showError(o[0].message),e._onComplete()}else null===i||0===i.length?(e.showError(n.objectNotFound),e._onComplete()):(e.resultList=i,e._showResultPanel())}).catch(function(t){e._setEndWaitingResponse(),e.showError(t),e._onComplete()})},_requireSecurityContext:function(){var t=this;return new Promise((e,i)=>{var n=a.getCurrentFolderSecurityContext();"function"==typeof this.context.getSecurityContext&&(n=this.context.getSecurityContext().SecurityContext);null!=n?(t.securityCtx=n,e()):r.getSecurityContextPromise(this.tenant).then(function(i){t.securityCtx=i,e()}).catch(function(t){i(t)})})},_queryRequest:function(t){var e=this;return new Promise((i,o)=>{var d={query_string:t},u=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/mibws/mibquery2",null),l=a.getHeaders(encodeURIComponent(e.securityCtx));s.authenticatedRequest(u,{method:"POST",type:"json",headers:l,timeout:6e5,data:JSON.stringify(d),onComplete:function(t){i(t)},onFailure:function(t,e){console.log("MIBQueryWidget _query:Failure..."+t),o(r.parseWebServiceError(t,e))},ontimeout:function(){console.log("MIBQueryWidget _query: A connection timeout occured."),o(n.timeout)}})})},_queryAttributesValue:function(t){var e=this;return new Promise((i,o)=>{var d={data:[],attributes:["type","name","module","contenturl","fullcontenturl","branch","branch.uuid","branch.current","branch.project","branch.owner","branch.organization","branch.originated","branch.modified","branch.description","displayType","Title","attribute[PLMEntity.V_Name]","attribute[Title]","attribute[PLMEntity.V_description]"]};t.forEach(t=>{d.data.push({objectId:t.objectId})});var u=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/attributeList",null),l=a.getHeaders(encodeURIComponent(e.securityCtx));s.authenticatedRequest(u,{method:"POST",type:"json",headers:l,timeout:6e5,data:JSON.stringify(d),onComplete:function(t){i(t)},onFailure:function(t,e){console.log("MIBQueryWidget _queryAttributesValue:Failure..."+t),o(r.parseWebServiceError(t,e))},ontimeout:function(){console.log("MIBQueryWidget _queryAttributesValue: A connection timeout occured."),o(n.timeout)}})})},showNotification:function(t){if("function"==typeof this.context.displayNotification){var e={eventID:"primary",msg:t};this.context.displayNotification(e)}else{e={eventID:"primary",msg:t};y.displayNotification(e)}console.log(t)},showError:function(t){if("function"==typeof this.context.displayNotification){var e={eventID:"error",msg:t};this.context.displayNotification(e)}else{e={eventID:"error",msg:t};y.displayNotification(e)}console.log(t)}})});