define("DS/WidgetPreview/View/SearchInMultiAppWidget",["DS/Dashboard/Views/AbstractSearchIn","i18n!DS/WidgetPreview/assets/nls/TransientWidget"],function(e,t){"use strict";return e.extend({className:"search-in-multiapp-widget",setup:function(e){e.targetName="widgetId",this._parent(e)},destroy:function(){this._parent.apply(this,arguments)},render:function(){return this._parent({inputTextPlaceholder:t.searchInMultiAppWidgetPlaceholder,dense:!0})}})}),define("DS/WidgetPreview/View/TransientContainer",["UWA/Core","UWA/Class/View","DS/Handlebars/Handlebars4","DS/TransientWidget/Tool/Mapping","DS/TransientWidget/Tool/TransientMessaging","DS/PubSub/PubSub","DS/Dashboard/PublicAPI","DS/UIKIT/Tooltip","i18n!DS/WidgetPreview/assets/nls/TransientWidget","text!DS/WidgetPreview/Template/TransientContainer.html","css!DS/WidgetPreview/Style/TransientContainer.css"],function(e,t,i,n,a,s,o,r,d,l){"use strict";return t.extend({template:i.compile(l),domEvents:{"click .preview-header-float .search-icon":"_search","click .preview-header-float .pin-icon":"_publish","click .preview-header-float .close-icon":"_cancel"},setup:function(t){var i=this,a=e.extendElement(document.body.querySelector(n.Selector.AppContainer)),s=n.Selector.TransientContainer.substring(1);i.wrapper=a,i.app={},i.tooltips={},i.manager=t.manager||{},i.viewMode="Basic",i.PREVIEW_MARGIN_BOTTOM=25,i.container=e.createElement("div",{class:s+" "+(i.manager.activeAppId||"")+" "+s+"-"+(i.manager.activeAppId||"")}).inject(a),i.resizeContainerHeight=function(){var e=i.container.querySelector(n.Selector.TransientContent),t=document.documentElement.clientHeight-i.wrapper.getBoundingClientRect().top;i.manager.addinMode&&i.wrapper.setStyle("height",t+"px"),e&&(e.style.height=t-i.PREVIEW_MARGIN_BOTTOM+"px")}},attachEvents:function(){s.add(o.events.panel.open,this.updateGrid,this),s.add(o.events.panel.close,this.updateGrid,this),window.addEventListener("resize",this.resizeContainerHeight)},detachEvents:function(){window.removeEventListener("resize",this.resizeContainerHeight),s.remove(o.events.panel.open,this.updateGrid),s.remove(o.events.panel.close,this.updateGrid)},updateGrid:function(){var e=this.manager||{};e.grid&&e.grid.update(!0)},setData:function(e){this.app=e.App||this.app,this.viewMode=e.ViewMode||this.viewMode},render:function(){var t,i,a,s=this.container,o=this.app.widgets.length>1;return this.attachEvents(),s.innerHTML=this.template({isMultiApp:o,isFloatMode:"Float"===this.viewMode,addinMode:this.manager.addinMode}),o&&((i=e.extendElement(s.querySelector(".search-icon")))&&(this.tooltips.searchTooltip=new r({position:"bottom",target:i,body:d.searchInMultiAppIcon,offset:{x:0,y:0}})),(t=e.extendElement(s.querySelector(".pin-icon")))&&(this.tooltips.pinTooltip=new r({position:"bottom",target:t,body:d.pinIcon,offset:{x:0,y:0}})),(a=e.extendElement(s.querySelector(".close-icon")))&&(this.tooltips.closeTooltip=new r({position:"bottom",target:a,body:d.closeIcon,offset:{x:0,y:0}})),this.delegateDOMEvents()),this.resizeContainerHeight(),s.querySelector(n.Selector.TransientContent).style.height=document.body.querySelector(n.Selector.AppContainer).clientHeight-this.PREVIEW_MARGIN_BOTTOM+"px",this},hide:function(){this.container.addClassName("hidden")},show:function(){var e=this.app.widgets[0].widget&&this.app.widgets[0].widget.id||this.app.id,t=this.app.widgets.length>1;this.container.removeClassName("hidden"),this.manager.isFirstTimeApp||s.dispatch("onViewChange",{type:"maximized",id:e}),t&&s.dispatch("onShowMultiApp",{id:e})},showBackground:function(){var e=this.wrapper.getElement(n.Selector.AppContainer+" > .moduleWrapper");e&&(e.style.opacity="1",e.style.pointerEvents="auto")},hideBackground:function(){var e=this.wrapper.getElement(n.Selector.AppContainer+" > .moduleWrapper");e&&(e.style.opacity="0.1",e.style.pointerEvents="none")},isVisible:function(){var e=this.container,t=!1;return"none"!==e.style.display&&(t=!!e.getElement(".module")),t},_cancel:function(e){e.stopPropagation(),e.preventDefault(),this.tooltips.closeTooltip.hide(),a.getInstance().fire(n.TransientMessaging.CloseWidget,{needChangeUrlHash:!0})},_publish:function(e){e.stopPropagation(),e.preventDefault(),this.tooltips.pinTooltip.hide(),a.getInstance().fire(n.TransientMessaging.AddModules)},_search:function(e){e.stopPropagation(),e.preventDefault(),this.tooltips.searchTooltip.hide(),this.app.widgets[0].parent.showSearchInMultiAppView()},destroy:function(){this.wrapper.setStyle("height",""),this.detachEvents(),this._parent()}})}),define("DS/WidgetPreview/View/Transient",["UWA/Core","UWA/Class/View","DS/TransientWidget/Tool/Mapping","DS/TransientWidget/Tool/TransientMessaging","DS/Dashboard/GridManager","DS/Dashboard/DashboardManager","DS/Dashboard/Utils","DS/Handlebars/Handlebars4","DS/UIKIT/Tooltip","DS/PubSub/PubSub","DS/UWPClientControls/Utils","text!DS/WidgetPreview/Template/Transient.html","i18n!DS/WidgetPreview/assets/nls/TransientWidget"],function(e,t,i,n,a,s,o,r,d,l,h,p,c){"use strict";return t.extend({domEvents:{"click .preview-header .search-in-widget-icon":"_showSearchInWidgetView","click .preview-header .platform-info-icon":"_platformInfo","click .preview-header .help-icon":"_help","click .preview-header .preferences-icon":"_preference","click .preview-header .refresh-icon":"_refresh","click .preview-header .pin-icon":"_publish","click .preview-header .close-icon":"_cancel"},setup:function(e){var t=this;!t.container&&e.container&&(t.container=e.container),t.widget=e.widget,t.options=e.options,t.template=r.compile(p),t.environment=e.environment,t.tooltips=e.tooltips||{},t._onSearch=function(e){t.environment.propagateSearch(e)},t.handleResize=h.debounce(function(){t.environment.isDeviceModeChange()&&!t.environment.addinMode&&t.environment.updateViewMode(),a.update()},500)},attachEvents:function(){this.environment.isContainer()&&l.add(l.events.searchQuery,this._onSearch,null,!0),window.addEventListener("resize",this.handleResize)},detachEvents:function(){l.remove(l.events.searchQuery,this._onSearch),window.removeEventListener("resize",this.handleResize)},render:function(){var t=this.container,i=e.extendElement;if(t.innerHTML=this.template({widget:this.widget,options:this.options}),this.attachEvents(),this.widget.isContainer)return this;var n=i(t.querySelector(".search-in-widget-icon"));n&&(this.tooltips.helpTooltip=new d({position:"bottom",target:n,body:c.searchInWidgetIcon,offset:{x:0,y:0}}));var a=i(t.querySelector(".help-icon"));a&&(this.tooltips.helpTooltip=new d({position:"bottom",target:a,body:c.helpIcon,offset:{x:0,y:0}}));var s=i(t.querySelector(".preferences-icon"));s&&(this.tooltips.prefTooltip=new d({position:"bottom",target:s,body:c.prefIcon,offset:{x:0,y:0}}));var o=i(t.querySelector(".refresh-icon"));if(o&&(this.tooltips.refreshTooltip=new d({position:"bottom",target:o,body:c.refreshIcon,offset:{x:0,y:0}})),!this.widget.data.isMultiAppChildren){var r=i(t.querySelector(".pin-icon"));r&&(this.tooltips.pinTooltip=new d({position:"bottom",target:r,body:c.pinIcon,offset:{x:0,y:0}}));var l=i(t.querySelector(".close-icon"));l&&(this.tooltips.closeTooltip=new d({position:"bottom",target:l,body:c.closeIcon,offset:{x:0,y:0}}))}return this},onUpdatePreferences:function(){if(!this.widget.isContainer){var t=e.extendElement(this.container.querySelector(".fonticon-cog")),i=this.widget.hasPreferences;t&&t.toggleClassName("fonticon-hide",!i)}},onUpdateMetas:function(t){if(!this.widget.isContainer&&t){var i,n=t._isCustomItemToDisplay,a=t._customItem;if(a)if(i=this.container.querySelector("span[name="+a.name+"]"),n&&!i){i=e.createElement("span",{name:a.name,class:a.icon}).inject(this.container.querySelector(".moduleHeader__right"),"top"),this.tooltips.customItemTooltip=new d({position:"bottom",target:i,body:a.text,offset:{x:0,y:0}});var s=a.event;s&&i.addEvent("click",this._customItemEvent.bind(this,s))}else i.toggleClassName("fonticon-hide",!n)}},_customItemEvent:function(e){this.environment.dispatchEvent(e),this.tooltips.customItemTooltip.hide()},_refresh:function(e){e.stopPropagation(),e.preventDefault(),this.environment.dispatchEvent("onRefresh")},_cancel:function(e){e.stopPropagation(),e.preventDefault(),this.tooltips.closeTooltip.hide(),n.getInstance().fire(i.TransientMessaging.CloseWidget,{needChangeUrlHash:!0})},_publish:function(t){var a=this.environment,s=this.widget,o=e.merge(a.getAllData(),a.widget.data)||{};t.stopPropagation(),t.preventDefault(),this.tooltips.pinTooltip.hide(),this.container.focus(),n.getInstance().fire(i.TransientMessaging.AddModule,{environment:{getAllData:o},widget:{title:(s.name||s.originalTitle||"").unescapeHTML(),widgetId:s.widgetId,appId:o.appId||a.wp.appId||s.appId,preview:!0}})},_preference:function(e){this.widget.hasPreferences&&(e.stopPropagation(),e.preventDefault(),this.environment.togglePreferences())},_platformInfo:function(e){var t=this.environment.components.tooltipPlatformInfo;e.stopPropagation(),e.preventDefault(),!h.hasTouch()||t.isVisible()?this.environment._onPlatformInfoClick():t.show()},_help:function(e){e.stopPropagation(),e.preventDefault(),s.openHelpWindow({helpInfoPath:o.getHelpInfoPath(this.environment)})},_showSearchInWidgetView:function(e){e.stopPropagation(),e.preventDefault(),this.environment.showSearchInWidgetView()},destroy:function(){var e=this;Object.keys(e.tooltips||{}).forEach(function(t){var i=e.tooltips[t];i&&(i.hide(),i.destroy())}),e.tooltips=null,e._parent(),e.detachEvents()}})}),define("DS/WidgetPreview/Model/App",["UWA/Core","UWA/Utils","UWA/Class/Model","DS/Dashboard/CompassManager","DS/Dashboard/PublicAPI","DS/UWPClientCode/PublicAPI","DS/UWPClientControls/PlatformNotify","DS/Logger/Logger","i18n!DS/WidgetPreview/assets/nls/TransientWidget"],function(e,t,i,n,a,s,o,r,d){"use strict";return i.extend({init:function(e){this.id=e.appId||"",this.data=e.data||{},this.title=e.title,this.widgets=e.widgets||[]},fetch:function(t){function i(e){return new Promise(function(t,i){var s=e.data||{};if(e.errorOnGetAppInfo)return i();n.getAppInfo({appId:e.id,onComplete:function(e){a._processData({appInfos:e,data:s}),a._fetchWidgetsConfig({onComplete:t,onFailure:i})},onFailure:i})})}var a=this;if(a.errorOnGetAppInfo=(t||{}).errorOnGetAppInfo,a.id||(r.error("Model > ID should be specified"),o.error(d.noAppConfig)),e.is(a.id,"string"))a.id.match(/^http/)?(a._processData({widgetId:a.id,data:a.data}),t.onComplete()):i(a).then(t.onComplete).catch(t.onFailure);else if(e.is(a.id,"array")){var s=a.id.map(function(e){return i(e)});Promise.all(s).then(t.onComplete).catch(t.onFailure)}else o.error(d.noAppConfig)},_processData:function(i){var n,a,s,o,r,d,l=i.appInfos||{},h=i.data||{},p=!0;if(h.wpData&&"boolean"==typeof h.wpData.editable&&(p=h.wpData.editable),e.is(l,"string")&&(l=JSON.parse(l)),i.widgetId)n={title:"",id:null,isolationLevel:null},this._registerWidget(n,i);else if(e.is(l.apps,"array")&&0!==l.apps.length)for(r=(o=l.apps).length,a=t.getUUID().substr(0,6),d=0;d<r;d++)s=o[d],(n={}).data=e.merge(h,{x3dPlatformId:l.platformId,tenantAware:l.tenantAware,x3dAppId:l.id,x3dSharedId:a,wpData:{editable:p}}),this._registerWidget(s,n);else(n={}).data=e.merge(h,{x3dPlatformId:l.platformId,tenantAware:l.tenantAware,wpData:{editable:p}}),this._registerWidget(l,n);this._createTitle(l)},_registerWidget:function(t,i){var n=e.merge(i,{parent:!1,preview:!0,title:this.title||t.title,isolationLevel:t.isolationLevel,appId:t.id});t.config&&(n.config=t.config),n.data=JSON.stringify(n.data),this.widgets.push(n)},_fetchWidgetsConfig:function(e){var t=e.onComplete,i=e.onFailure,n=[];return this.widgets.forEach(function(e){n.push(function(e){return new Promise(function(t,i){var n={};e.config?(n.dataUrl=e.config||{},n.data=JSON.parse(e.data)||{},n.success=function(i){e.data=JSON.stringify(i),t()},n.failure=function(){i("WidgetPreview > Error on fetching App config")},n.serviceName=a._getServiceName(),s.getWidgetInstanceData(n)):t()})}(e))}),Promise.all(n).then(t).catch(function(e){r.error(e),o.error(d.errorRetriveApp),i()})},_createTitle:function(e){var t=this;e=e||{},t.title||(e.title?t.title=e.title:(t.title="",t.widgets.length>1?(t.widgets.forEach(function(e){e.name&&(t.title+=e.name+", ")}),t.title=t.title.slice(0,-2)):t.title=t.widgets[0].name),t.title||(t.title="Preview app"))}})}),define("DS/WidgetPreview/View/TransientFloat",["UWA/Core","DS/WidgetPreview/View/Transient","DS/UWPClientControls/Draggable","DS/UWPClientCode/PublicAPI","DS/TransientWidget/Tool/Mapping","DS/PubSub/PubSub","DS/Dashboard/PublicAPI"],function(e,t,i,n,a,s,o){"use strict";return t.extend({setup:function(t){var i,s,r,d,l=this,h=document.body,p=require("DS/WidgetPreview/Controller/TransientManager"),c=n.getUserProperty("transients"),u=c&&JSON.parse(c),g=h.querySelector(a.Selector.AppContainer),f=e.extendElement(h.querySelector(a.Selector.TransientContent)),m=e.extendElement(h.querySelector(".topbar")),w=e.extendElement(h.querySelector(".compass-ct")),v=p.getInstance(),S=v.floatWidth,I=v.floatHeight,b=g.clientWidth,A=g.clientHeight,C=v.floatMinWidth,E=v.floatMinHeight,P=w.getSize().height,D=m.getSize().height,_=P?P-D:25,T=_,y=0;u&&(i=u.width,s=u.height,r=u.top,d=u.left),r&&(T=r),d&&(y=d),C=i?Math.min(i,b):Math.min(S,b-y),E=s?Math.min(s,A):Math.min(I,A-T),l._parent(t),l.updateTransientData=function(e){var t=JSON.parse(n.getUserProperty("transients")||"{}");for(var i in e)t[i]=e[i];n.setUserProperty("transients",JSON.stringify(t),{serviceName:o._getServiceName()})},l.alwaysBeVisible=function(){var e=document.body,t=e.getElement(a.Selector.TransientContent);t.isInViewport(e)||(t.setStyles({top:"25px",left:"0"}),l.updateTransientData({top:parseInt(t.getStyle("top"),10),left:parseInt(t.getStyle("left"),10)}))},f.setStyles({top:T+"px",left:y+"px",width:C+"px",height:E+"px"}),l.updateTransientData({top:T,left:y,width:C,height:E}),t.widget.data.TransientFloatCallback=l._initializeDrag.bind(this,{height:E,width:C,moduleWrapperPreviewPadding:14,offsetTopLimit:_})},_initializeDrag:function(t){var n=this,r=document.body,d=e.extendElement(r.querySelector(a.Selector.AppContainer)),l=r.querySelector(a.Selector.TransientContent),h=e.extendElement(r.querySelector(a.Selector.TransientApp)),p=e.extendElement(h.querySelector(".wi-preview")),c=e.extendElement(h.querySelector(".r2g-resize-transient-overlay")),u=require("DS/WidgetPreview/Controller/TransientManager").getInstance(),g=t.width,f=t.height,m=t.moduleWrapperPreviewPadding,w=t.offsetTopLimit;h.setStyles({width:g-m+"px",height:f-m+"px"}),n.draggablePosition=new i({container:r,items:a.Selector.TransientContent,handle:".moduleHeader, .moduleHeader > *",limit:!0,movePlayer:!1,beforeStart:function(){var e=this.style;e.height=h.clientHeight+m+"px",e.width=h.clientWidth+m+"px"},start:function(t,i){var a=i.player.style;n.initialTop=parseInt(a.top,10),n.initialLeft=parseInt(a.left,10),n.maskLayer=e.createElement("div",{class:"draggable-float-layer",styles:{width:"100%",height:"100%","z-index":"100000",position:"absolute",top:0,left:0}}),n.maskLayer.inject(r)},stop:function(e,t){var i=t.player.style;n.maskLayer.destroy(),n.updateTransientData({top:parseInt(i.top,10),left:parseInt(i.left,10)})},drag:function(e,t){var i=t.player,a=r.querySelector("div.column.left.shown > .column-ctn"),s=(a&&a.clientWidth,i.clientWidth,i.clientHeight,r.clientHeight),o=r.clientWidth;this.setStyles({top:n.initialTop+t.pointer.diffTop+"px",left:n.initialLeft+t.pointer.diffLeft+"px"}),i.offsetTop<=w&&(i.style.top=w+"px"),i.offsetLeft<0&&i.offsetWidth+i.offsetLeft<200&&(i.style.left=200-i.offsetWidth+"px"),i.offsetLeft+100>=o&&(i.style.left=o-100+"px"),i.offsetTop+100>=s&&(i.style.top=s-100+"px")}}),n.draggableResize=new i({container:r,handle:".r2g-resize-transient",items:a.Selector.TransientApp,movePlayer:!1,limit:!0,textSelection:!1,beforeStart:function(t,i){n.resizeStartsFromTop=Math.abs(t.target.getOffsets().y-p.getOffsets().y)<20,n.initialTop=parseInt(l.style.top,10),n.initialHeight=i.player.getSize().height,n.transition=this.getStyle("transition"),this.setStyle("transition","none"),n.maskLayer=e.createElement("div",{class:"draggable-float-layer",styles:{width:"100%",height:"100%","z-index":"100000",position:"absolute",top:0,left:0}}),n.maskLayer.inject(r),p.setStyles({position:"absolute",top:"0",left:"0",width:g,height:f}),c.addClassName("resize-active"),d.addClassName("events-disabled")},drag:function(e,t){var i,a=r.getSize(),s=a.width,o=a.height,d=e.clientX||e.touches&&e.touches[0]&&e.touches[0].clientX,p=e.clientY||e.touches&&e.touches[0]&&e.touches[0].clientY,c=r.querySelector("div.column.left.shown > .column-ctn"),v=c?c.clientWidth:0,S=n.initialTop+t.pointer.diffTop;n.transientContainerCoordinates={x:l.offsetLeft,y:t.player.getOffsets().y},n.resizeCoordinates={x:d-v,y:p},n.resizeStartsFromTop?(f=n.initialHeight-t.pointer.diffTop,g=t.pointer.left-t.player.getOffsets().x):(f=n.resizeCoordinates.y-n.transientContainerCoordinates.y,g=n.resizeCoordinates.x-n.transientContainerCoordinates.x),g<=u.floatMinWidth&&(g=u.floatMinWidth),f<=u.floatMinHeight&&(f=u.floatMinHeight,n.resizeStartsFromTop&&(S=n.initialTop+n.initialHeight-u.floatMinHeight)),n.resizeStartsFromTop&&S<=w&&(S=w,f=n.initialTop+n.initialHeight-w),n.transientContainerCoordinates.x+g+m+v>=s&&(g=s-(n.transientContainerCoordinates.x+m+v)),n.transientContainerCoordinates.y+f+w+2*m>=o&&(f=o-(n.transientContainerCoordinates.y+w+2*m)),h.setStyles({width:g+"px",height:f+"px"}),l.setStyles({width:g+m+"px",height:f+m+"px"}),i={width:parseInt(g,10),height:parseInt(f,10)},n.resizeStartsFromTop&&(i.top=S,l.setStyles({top:S+"px"})),n.updateTransientData(i)},stop:function(){this.setStyle("transition",n.transition),p.setStyles({position:"",top:"",left:"",width:"",height:""}),c.removeClassName("resize-active"),n.maskLayer.destroy(),d.removeClassName("events-disabled")}}),s.add(o.events.panel.open,n.alwaysBeVisible),s.add(o.events.panel.close,n.alwaysBeVisible),window.addEventListener("resize",n.alwaysBeVisible)},destroy:function(){this._parent(),window.removeEventListener("resize",this.alwaysBeVisible),s.remove(o.events.panel.open,this.alwaysBeVisible),s.remove(o.events.panel.close,this.alwaysBeVisible),this.draggablePosition.destroy(),this.draggableResize.destroy(),this.draggablePosition=null,this.draggableResize=null}})}),define("DS/WidgetPreview/Environment/Transient",["UWA/Core","UWA/Environment","UWA/Utils/Client","UWA/Element","UWA/Event","DS/Logger/Logger","DS/UWPClientCode/Data/Widgets","DS/UWPClientCode/DebugMe","DS/UWPClientCode/I18n","DS/UWPClientControls/Utils","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/UIKIT/Alert","DS/PubSub/PubSub","DS/TransientWidget/Tool/Mapping","DS/WidgetPreview/View/Transient","DS/WidgetPreview/View/TransientFloat","DS/WidgetPreview/View/SearchInMultiAppWidget","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/Dashboard/Views/PlatformInfoTooltipView","DS/Dashboard/CompassManager","DS/Dashboard/WidgetLinkManager","DS/Dashboard/Views/SearchInWidget","DS/Dashboard/Search","DS/Dashboard/Utils","i18n!DS/WidgetPreview/assets/nls/TransientWidget"],function(UWA,Environment,Client,Element,UWAEvent,Logger,Data,DebugMe,i18n,Utils,Form,Button,Tooltip,Alert,PubSub,Mapping,ViewTransient,ViewTransientFloat,SearchInMultiAppWidgetView,DAPI,DNav,PlatformInfoTooltipView,CompassManager,WidgetLinkManager,SearchInWidgetView,DSearch,DUtils,Nls){"use strict";function isPreference(e,t){return t.getPreferences().map(function(e){return e.name}).indexOf(e)>=0}var ICON_PATH=DUtils.buildPath(dsBaseUrl,"resources",dsVersion,dsLang,"webapps/UWPClientCode/assets"),ICON_PATH_TEMPLATE=DUtils.buildPath(ICON_PATH,"${PLACEHOLDER}-widget-icon@2X.png"),BRAND_PLACEHOLDER="${PLACEHOLDER}",FOCUSED_CLASS="ifwe-focused",HIGHLIGHTED_CLASS="ifwe-highlighted",FULLSCREEN_CLASS="ifwe-fullscreen",MODULE_BORDER_CLASS="moduleBorder",LINKED_HIGHLIGHTED_CLASS=[HIGHLIGHTED_CLASS,"blue-highlight"].join(" "),CLICKABLE_CLASS="clickable",HIDE_CTN_BEFORE_ON_VIEW_CHANGE_CLASS="hide-ctn-before-onviewchange",ON_VIEW_CHANGE_ANIMATION_TIME=300,_isAddinMode=!1,_isSWAMode=!1,ICONS={"3DEXCITE":ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DEXCITE"),"3DSWYM":ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DSWYM"),"3DVIA":ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DVIA"),BIOVIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"BIOVIA"),CATIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"CATIA"),CENTRICPLM:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"3DVIA"),DELMIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"DELMIA"),ENOVIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"ENOVIA"),EXALEAD:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"EXALEAD"),GEOVIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"GEOVIA"),MEDIDATA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"MEDIDATA"),NETVIBES:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"NETVIBES"),SIMULIA:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"SIMULIA"),SOLIDWORKS:ICON_PATH_TEMPLATE.replace(BRAND_PLACEHOLDER,"SOLIDWORKS")},whichTransitionEvent=function(){var e,t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(void 0!==document.body.style[e])return t[e]}(),Preview=Environment.extend({name:"preview",init:function(e){_isAddinMode=DNav.isAddinMode(),_isSWAMode=DNav.isSWAMode(),this.components={};var t,i,n,a,s=e.data;this.html={},this.Features={},this.view={},this.viewMode=e.data.TransientViewMode,this.navContext=e.data.TransientNavContext,this.isSingleBasicApp=e.data.TransientIsSingleBasicApp||e.parent&&e.parent.widget.data.TransientIsSingleBasicApp||!1,this.isMultiApp=!!e.data.isMultiApp,this.addinMode=e.data.TransientAddinMode||e.parent&&e.parent.widget.data.TransientAddinMode||void 0,this.options={defaultView:{type:"windowed"},initialView:e.initialView},this.deviceMode=this.calculateDeviceMode(),this.wp=UWA.merge({},e),this.wp._edit=!!e.isEditable,this.wp._preventsEdit=s.wpData&&void 0!==s.wpData.editable?!s.wpData.editable:void 0,this.wp.isEditable=!1,this.wp.isBulky=!1,this.wp.isPlatformInfoIconShown=!1,this.wp.isLinkedWidgetIconShown=!1,this.wp.isFilteredIconShown=!1,this.wp.isLinked=!1,this.wp.isLinkable=!1,this.wp.isVisible=!0,this.wp.preview=e.preview,this.wp.originalTitle=this.wp.title,this.wp.customTitle="",this.wp.hasFocus=!1,this.wp.isFiltered=!1,this.wp.checksum=e.checksum,!1===(t=this.wp.parent)?this.wp.isEditable=!0:t&&(i=t.isEditable(),n=this.wp.isContainer&&this.wp._edit,a=t.wp._edit&&t.widget.data&&t.widget.data.wpData&&!1===t.widget.data.wpData.editable,this.wp.isEditable=!this.wp._preventsEdit&&(i||n||a||this.wp.preview)),e.metas&&(this.wp.author=e.metas.author||"",this.wp.version=e.metas.version||"",this.wp.header="false"!==e.metas.header,this.wp.border="false"!==e.metas.border,this.wp.brand=e.metas.brand?e.metas.brand:"",this.wp.thumbnail=e.metas.thumbnail||"resources/"+dsVersion+"/"+dsLang+"/webapps/UWPClientCode/assets/default-drag.png",this.wp.noSearchInWidgetUI=!!e.metas.noSearchInWidgetUI||!1),s.wpData&&(this.wp.header=UWA.is(s.wpData.header)?s.wpData.header:this.wp.header,this.wp.border=UWA.is(s.wpData.border)?s.wpData.border:this.wp.border,this.wp.styles=s.wpData.styles,this.wp.classes=s.wpData.classes,this.wp.title=UWA.is(s.wpData.title)?s.wpData.title:this.wp.title,this.wp.hidden=!!UWA.is(s.wpData.hidden)&&s.wpData.hidden),this.html.module=e.el,this.wp.hasPreferences=e.preferences&&e.preferences.length>0&&e.preferences.some(function(e){return"hidden"!==e.type}),this.wp.isMultiAppChildren=s.isMultiAppChildren,this.wp.isFloat="Float"===s.TransientViewMode,this.updatePlatformInfoIconDebounced=Utils.debounce(this.updatePlatformInfoIcon.bind(this),300),this.buildSkeleton(),this.dispatchInit()},loadInlinedWidget:function(url,options){var widget=this.getWidget(),json=options.fetcher,script=json.script;return widget.id=this.wp.id,widget.thumbnail=this.wp.thumbnail,widget.data={module:"DS/WidgetPreview/Controller/Grid"},json.title=this.wp.title,widget.setStyle(json.style),json.metas={},json.preferences={},json.plugins={},json.script=function(widget){eval(script)},delete options.fetcher.style,url||json.appId||!json.userNotAllowed?this._parent(url,options):(widget.setTitle(json.title),widget.setIcon(json.icon),widget.setMetas(json.metas),widget.setPreferences(json.preferences),widget.setPlugins(json.plugins),widget.setBody(json.body),json.script&&json.script(widget),options.onComplete(widget,this),this)},loadWidget:function(e,t){var i,n,a,s=this;return t=UWA.extend({onFailure:function(e){throw e},onTimeout:function(e){throw e},onComplete:function(){}},t),n=function(){i&&(i.launched=!0),s.launched=!0,s.updatePlatformInfoIcon()},a=function(){i&&(i.launched=!1),s.launched=!1;var e={is3DDAddinMode:_isAddinMode,is3DDSWAMode:_isSWAMode};s.widget.setMetas(e),i&&i.sendRemote("onUpdateMetas",e)},s.wp.isolationLevel?(s.loadEmbeddedWidget(s.wp.widgetId||e,t),(i=s.embedded)&&(i.addEvent("onLoad",n),i.addEvent("onRegisterWidget",a),i.addEvent("onUpdateMetas",s.onUpdateMetas.bind(s)),s.widget.addEvent("onContextChange",i.sendRemote.bind(i,"onContextChange")),i.addEvent("onPatchData",s.patchData.bind(s))),s.dispatchEvent("onRegisterWidget")):(s.loadInlinedWidget(s.wp.preview?s.wp.widgetId:e,t),s.addEvent("onPatchData",s.patchData.bind(s)),a(),n()),s._addPubSubEvents(),!s.isContainer()&&s.wp.parent&&"Basic"===s.wp.parent.viewMode&&1===s.getParentChildren().length&&s.widget.addEventOnce("onLoad",s.onViewRequest.bind(s,{type:"maximized"})),PubSub.dispatch(Mapping.Events.PreviewWidgetLoaded,{id:s.widget.id,isContainer:s.isContainer()}),s},loadEmbeddedWidget:function(e,t){var i,n,a=this.getWidget();return a.id=this.wp.id,a.thumbnail=this.wp.thumbnail,t.cache=this.wp.checksum,i={id:this.wp.id,appId:this.getAppId(),token:this.wp.token,lang:i18n.getCurrentLanguage(),displayEdit:!1,exposition:2===this.wp.isolationLevel?UWA.hosts.untrustedExposition:UWA.hosts.exposition,debugMe:UWA.debug?1:null},t.embedded=UWA.extend(t.embedded||{},i),this._parent(e,t),n=this.embedded.elements.iframe,Element.setAttributes.call(n,{width:"",height:"",scrolling:"auto"}),Element.setStyles.call(n,{width:"0",height:"0",minWidth:"100%",minHeight:"100%"}),this.html.body.setStyle("padding",""),this},onRegisterWidget:function(){var e=this,t=this.html;if(!this._isRegistered)return t.header&&Utils.addEvent(t.header,"click",function(i){t.rightActions.contains(i.target)||e.updateFocus({focus:!e.hasFocus()})}),this._isRegistered=!0,this._parent.apply(this,arguments)},afterLoad:function(){if(_isSWAMode){var e=this.getEmbeddedIframe();e&&e.body&&e.body.classList.add("ifwe-is-3dd-swa-mode")}PubSub.dispatch(DAPI.events.environment._widgetInstanceReady,[this.widget]),this._updateLinkabilityStatus()},buildSkeleton:function(){var e,t,i,n=this,a=n.html,s=n.wp,o="resources/"+dsVersion+"/"+dsLang+"/webapps/UWPClientCode/assets/default-widget-icon.png",r=Utils.hasTouch(),d={container:a.module,environment:n,widget:s,options:{widgetIcon:o,widgetIconSize:16}};"Float"===n.viewMode?n.viewSkeleton=new ViewTransientFloat(d):n.viewSkeleton=new ViewTransient(d),n.viewSkeleton.render(),a.wrapper=UWA.extendElement(a.module.querySelector(".moduleWrapper")),a.body=UWA.extendElement(a.module.querySelector(".moduleContent")),n.isContainer()?(a.body=a.wrapper,(i=a.module.parentElement.querySelector(".preview-header-float"))&&(a.headerFloat=i,a.headerFloatSearchCtn=UWA.extendElement(i.querySelector(".search-ctn")))):(a.header=UWA.extendElement(a.module.querySelector(".moduleHeader")),s.header&&(a.leftActions=a.icon=a.header.getElement(".moduleHeader__left"),a.title=a.header.getElement(".moduleHeader__title"),a.searchCtn=a.header.getElement(".moduleHeader__search"),a.rightActions=a.header.getElement(".moduleHeader__right"),a.actionSearchInWidget=a.header.getElement(".search-in-widget-icon"),a.stateUntrusted=a.header.getElement(".untrusted-state-icon"),a.actionPlatformInfo=a.rightActions.getElement(".platform-info-icon").hide(),a.actionLinkedWidget=e=a.rightActions.getElement(".widget-link-icon").hide(),a.stateFiltered=a.rightActions.getElement(".filtered-badge").hide(),t=r?{click:function(e){UWAEvent.stop(e);var t=n.components.tooltipLinkedWidget;t&&!t.isVisible?(t.show(),n._highlightLinkedWidgets()):(t.hide(),n._unhighlightLinkedWidgets())}}:{mouseover:n._highlightLinkedWidgets.bind(n),mouseleave:n._unhighlightLinkedWidgets.bind(n)},e.addEvents(t),s.noSearchInWidgetUI&&a.actionSearchInWidget.hide()),a.module.hasClassName("r2g-widget")&&(a.module=UWA.extendElement(a.module.querySelector(".module")))),n.isEditable()&&(a.edit=UWA.extendElement(a.module.querySelector(".moduleEdit"))),(s.isMultiAppChildren||n.isFloat())&&a.module.removeClassName(HIDE_CTN_BEFORE_ON_VIEW_CHANGE_CLASS),n.updateSkeleton()},updateSkeleton:function(){var e=this.wp,t=e.classes,i=this.html,n=this.isContainer(),a=this.isEditable(),s=(t||{}).border||MODULE_BORDER_CLASS;t&&(t.module&&i.module.addClassName(t.module),t.moduleWrapper&&i.wrapper.addClassName(t.moduleWrapper),n||(t.moduleContent&&i.body.addClassName(t.moduleContent),e.header&&t.moduleHeader&&i.header.addClassName(t.moduleHeader))),e.styles&&i[n?"wrapper":"body"].setStyles(e.styles),e.border?(i.wrapper.addClassName(s),!n&&a&&i.edit.addClassName(s)):!1===e.border&&i.wrapper&&(i.wrapper.removeClassName(s),!n&&a&&i.edit.removeClassName(s)),n||(i.stateUntrusted&&(2===e.isolationLevel&&a?i.stateUntrusted.show():i.stateUntrusted.hide()),this._updatePlatformInfoClickableClass()),!1===e.header&&i.header&&i.header.remove()},_initOriginalTitleLegacy:function(e){var t=this.wp;if(t.originalTitle){var i=this.getBrand();if(i&&UWA.String.test(t.originalTitle,i+" - ")){var n=t.originalTitle.split(i+" - ");n.length>1&&(t.originalTitle=n[1].trim())}}else t.originalTitle=e||""},isEnvLaunched:function(){var e=this.embedded;return e?e.launched:this.launched},getBrand:function(){var e=this.wp;return e&&e.brand||""},getName:function(){var e=this.wp;return e&&(e.originalTitle||e.name)||""},getAppId:function(){var e=this.wp;return e?e.appId:void 0},getTitle:function(){var e=this.wp;return e?this.isContainer()?e.name||e.title||"":e.title||this.getComputedWidgetTitle():""},getCustomTitle:function(){var e=this.wp;return e&&(e.customTitle||this.getData("title"))||""},_computeWidgetTitle:function(e){var t=[],i=(e=e||{}).hideBrand,n=e.hideAppName,a=e.hideCustomTitle,s=(e.brand||"").trim(),o=(e.appName||"").trim(),r=(e.customTitle||"").trim();return r===o&&(a=!0),i||t.push(s),n||t.push(o),a||t.push(r),t.filter(function(e){return e}).join(" - ")},getComputedWidgetTitle:function(e){var t=this.getAppId(),i=[CompassManager.appIds.globViewer,CompassManager.appIds.mail,CompassManager.appIds.mediaLinks,CompassManager.appIds.quickLinks,CompassManager.appIds.webNotes,CompassManager.appIds.webPageReader,CompassManager.appIds.x3DPlay,CompassManager.appIds.x3DSearch],n=!1;if(t&&i.includes(t)){var a=this.getData("x3dTitleShowAppName");n="boolean"==typeof a&&!a}return this._computeWidgetTitle(Object.assign({brand:this.getBrand(),appName:this.getName(),customTitle:this.getCustomTitle(),hideAppName:n},e))},onUpdateTitle:function(e){var t,i=this.wp,n=this.html,a={customTitle:e};this.isContainer()||(this.isEnvLaunched()||(this._initOriginalTitleLegacy(e),e=this.getCustomTitle(),delete a.customTitle),i.customTitle=e,t=this.getComputedWidgetTitle(a),i.title=t,n.title&&n.title.setText(t))},onUpdateMetas:function(e){var t,i,n=this.widget,a=this.wp,s=this.html,o=this.embedded;n.setMetas(e),t=n.metas||{},a.brand=t.brand||this.getBrand()||"",a.noSearchInWidgetUI=!!t.noSearchInWidgetUI||!1,i=ICONS[a.brand],a.brand&&i&&n.setIcon&&n.setIcon(i),this.isContainer()||(a.noSearchInWidgetUI?s.actionSearchInWidget.hide():s.actionSearchInWidget.show()),e._readyForSearchEvent&&this._onReadyForSearchEvent(),this.viewSkeleton.onUpdateMetas(e);var r=e&&e._customItem,d=r&&r.event;o&&!n.hasEvent(d)&&n.addEvent(d,o.sendRemote.bind(o,d))},setEditable:function(e){this.isEditable()!==e&&(this.wp.isEditable=!!e)},mutate:function(e,t){this.getWidget(),e&&Data.getWidget({serviceName:DAPI._getServiceName(),id:e,success:function(e){var t,i=this.getWidget(),n=this.html,a=this.wp,s=a.widgetId;a.widgetId=e.id,a.isContainer=e.isContainer,a.title=e.title||"",a.originalTitle=a.title,a.name=a.title,a.appId=null,a.token=null,e.metas&&(a.header="false"!==e.metas.header,a.border="false"!==e.metas.border,a.author=e.metas.author||"",a.version=e.metas.version||"",a.brand=e.metas.brand?e.metas.brand:"",a.thumbnail=e.metas.thumbnail||"resources/"+dsVersion+"/"+dsLang+"/webapps/UWPClientCode/assets/default-drag.png"),e.wpData&&(t=e.wpData,a.header=UWA.is(t.header)?t.header:a.header,a.border=UWA.is(t.border)?t.border:a.border,a.styles=t.styles,a.classes=t.classes,a.title=t.title,a.hidden=t.hidden),a.hasPreferences=e.preferences&&e.preferences.length>0&&e.preferences.some(function(e){return"hidden"!==e.type}),n.module.removeClassName("wi-"+s),n.module.addClassName("wi-"+a.widgetId),n.body&&(n.body.removeClassName("w-"+s),n.body.addClassName("w-"+a.widgetId)),this.wp.isolationLevel=e.isolationLevel,this.updateSkeleton(),i.removeEvent(),i.clearDelayed(),i.clearPeriodical(),this.loadWidget(a.id+a.widgetId,{fetcher:e,onComplete:function(e,t){t.onUpdatePreferences({hasPreferences:!1}),t.launchWidget()}})}.bind(this)})},togglePreferences:function(){var e=this.widget;e&&e.hasPreferences()&&!e.isEdit&&(this.editPrefsCache=UWA.clone(this.widget.getPreferences()),this.dispatchEvent("toggleEdit"))},onUpdatePreferences:function(e){var t=this.wp.hasPreferences;this.updatePlatformInfoIconDebounced(),this.wp.hasPreferences="hasPreferences"in e?e.hasPreferences:this.widget.hasPreferences(),t!==this.wp.hasPreferences&&this.updateSkeleton(),this.viewSkeleton.onUpdatePreferences()},onUpdateValue:function(e){var t=this.widget;["appId","x3dSharedId","x3dLinkability"].includes(e)&&PubSub.dispatch(DAPI.events.environment._tentativeChangeLinkability,[t]),["x3dPlatformId","xPref_CREDENTIAL"].includes(e)&&this.updatePlatformInfoIconDebounced(),["x3dTitleShowAppName"].includes(e)&&this.onUpdateTitle(this.getCustomTitle()),this.isEditable()&&t.launched&&!t.isEdit&&this.save({fromPrefsUpdate:isPreference(e,t)})},save:function(e){e=e||{};var t;if(this.isEditable())return(t=DUtils.getParsedQuery()).wii?this._saveToBackend({wii:t.wii}):this.addinMode&&e.fromPrefsUpdate?this._saveToDSCEF():void 0},_saveToDSCEF:function(){var e,t,i,n=this;window.dscef&&window.dscef.saveValue&&(e=n.widget.data.x3dAppId||n.widget.data.appId,t=UWA.merge(n.widget.data,n.widget.environment.getAllData()),i=Object.keys(t).reduce(function(e,i){return isPreference(i,n.widget)&&(e[i]=t[i]),e},{}),window.dscef.saveValue(e,i).catch(function(e){Logger.warn(e)}))},_saveToBackend:function(e){var t=this;this._save||(this._save=Utils.debounce(function(){if(!t.destroyed){var i=UWA.clone(t.getAllData());["addinmode","isMultiAppChildren","wpData"].forEach(function(e){delete i[e]}),Data.editWidgetInstance({serviceName:DAPI._getServiceName(),id:e.wii,data:i,noUpdateCache:!0,success:function(e){var i=t.widget;delete t.editPrefsCache,i.metas._dispatchOnSetValueCallbacks&&(t.embedded?t.embedded.sendRemote("onSetValueSuccess",e):i.dispatchEvent("onSetValueSuccess",e))},failure:function(e){var i=t.widget;t._onEditDataFailure({error:e}),t.restorePrefCache(),i.metas._dispatchOnSetValueCallbacks&&(t.embedded?t.embedded.sendRemote("onSetValueFailure",e):i.dispatchEvent("onSetValueFailure",e))}})}},300)),this._save()},patchData:function(e){var t,i=this;function n(t,n){var a=e._callId;if(a){var s="success"===t?"onPatchDataSuccess-"+a:"onPatchDataFailure-"+a;i.embedded?i.embedded.sendRemote(s,a,n):i.widget.dispatchEvent(s,a,n)}}i.isEditable()&&((t=DUtils.getParsedQuery()).wii&&(e.widgetId=t.wii),Data.patchWidgetInstanceData({serviceName:DAPI._getServiceName(),id:e.widgetId,patches:e.patches,noUpdateCache:!0,success:function(e){n("success",e)},failure:function(t){i._onEditDataFailure({error:t,silentAlert:e.silentErrorAlert}),n("failure",t)}}))},_onEditDataFailure:function(e){e=e||{};var t,i=this.widget.elements;e.silentAlert||((t=i.alertError)&&(t.destroy(),delete i.alertError),(t=i.alertError=new Alert({visible:!0,fullWidth:!0,autoHide:!0,hideDelay:8e3}).inject(i.body,"top")).add({className:"error",message:DUtils.getViolationMessageFromError(e.error)||Nls.editWidgetFail}))},onEdit:function(){function e(e){var t=this,i=(e=e||{}).show,n=e.dispatchRefresh,a=e.submitted;function s(){i||(t.dispatchEvent("endEdit",[{submitted:a,needRefresh:!!e.needRefresh}]),n&&t.dispatchEvent("onRefresh"))}Client.Features.transitionsCSS&&-1===window.navigator.userAgent.indexOf("Edge")?(this.transitionEndCallback=function(e){"transform"===e.propertyName&&(t.html.module.removeClassName("animate"),i&&t.html.module.removeClassName("animate"),t.html.module.removeEventListener(whichTransitionEvent,t.transitionEndCallback),s())},!i&&this.html.module.addClassName("flipping"),window.requestAnimationFrame(function(){var e=t.html.module;e.addClassName("animate"),e.addEventListener(whichTransitionEvent,t.transitionEndCallback,!1),e[i?"addClassName":"removeClassName"]("flipping"),e[i?"addClassName":"removeClassName"]("flip")})):(this.html.module[i?"addClassName":"removeClassName"]("flip"),s())}var t,i=this,n=UWA.createElement,a=this.html,s=this.getWidget(),o=s.getPreferences();if(s.isEdit||(s.isEdit=!0,e.call(this,{show:!0})),a.edit&&(a.edit.empty(),s.hasPreferences())){a.preferences&&a.preferences.destroy(),o.push({type:"submit",className:"hide"}),o.forEach(function(e){"list"===e.type&&(e.showTooltips=!UWA.is(e.showTooltips,"boolean")||e.showTooltips)}),n("h4",{class:"moduleEdit__header",text:Nls.editPreferences}).inject(a.edit),a.preferences=new Form({fields:o,events:{onChange:function(e,t,n){s.setValue(e,t),i.embedded?i.embedded.sendRemote("dispatchEvent",n,[e,t]):i.dispatchEvent(n,[e,t])},onSubmit:function(t){for(var n in t)t.hasOwnProperty(n)&&s.setValue(n,t[n]);i.save({fromPrefsUpdate:!0}),e.call(i,{dispatchRefresh:!0,needRefresh:!0,submitted:!0})}}}).inject(a.edit),this.components.saveButton=new Button({className:"primary",value:Nls.save}),this.components.cancelButton=new Button({value:Nls.cancel}),t=UWA.createElement("div",{class:"moduleEdit__footer"}).inject(a.edit),this.components.saveButton.inject(t),this.components.cancelButton.inject(t),this.components.saveButton.addEvent("onClick",function(){this.disable(),i.components.cancelButton.disable(),a.preferences.submit()}),this.components.cancelButton.addEvent("onClick",function(){this.disable(),i.components.saveButton.disable(),i.restorePrefCache(),e.call(i,{submitted:!1})}),DebugMe.isEnabled()&&n("div",{class:"moduleInfos",html:[{tag:"p",html:[Nls.widgetInstanceId+"  ",{tag:"strong",text:s.id}]},this.wp&&this.wp.widgetId?{tag:"p",html:[Nls.widgetId+"  ",{tag:"strong",text:this.wp.widgetId}]}:"",s.metas.version?{tag:"p",html:[Nls.version+" ",{tag:"strong",text:s.metas.version}]}:""]}).inject(t),setTimeout(function(){var e=a.preferences.getFields();e&&e[0].focus()},500);var r,d=s.metas||{},l=d._linksDetails;if(d._isLinksToDisplay&&l&&(r=a.preferences.getContent().getElement(l.target))){var h=l.links;h&&h.forEach(function(e,t){var i=r.getParent();UWA.createElement("a",{name:e.name,text:e.text,href:e.href,target:"_blank"}).inject(i,"bottom"),h.length>t+1&&i.addContent(l.delimiter)})}}this.embedded||this.dispatchEvent("onShowEdit")},endEdit:function(e){var t=this.html,i=this.getWidget(),n=!(!e||!e.disableFlip);n&&t.module.removeClassName("flip"),i.isEdit=!1,this.embedded||n||(this.dispatchEvent("onHideEdit"),this.dispatchEvent("onRefresh"))},restorePrefCache:function(){var e,t,i;if(this.editPrefsCache){for(e=0,t=this.editPrefsCache.length;e<t;e++)i=this.editPrefsCache[e],this.getWidget().setValue(i.name,i.value),i.onchange&&(this.embedded?this.embedded.sendRemote("dispatchEvent",i.onchange,[i.name,i.value]):this.dispatchEvent(i.onchange,[i.name,i.value]));delete this.editPrefsCache}},setFiltered:function(e){var t=e.from,i=!e.clear,n=this.widget,a=!!n._isFilteredByTagger,s=!!n._isFilteredBySearchInWidget,o=!!n._isFilteredBySearchInMultiAppWidget;t===DSearch.from.tagger?n._isFilteredByTagger=i:t===DSearch.from.widgetPreview&&(n._isFilteredBySearchInWidget=i),t===DSearch.from.multiWidgetPreview&&(n._isFilteredBySearchInMultiAppWidget=i),this.wp.isFiltered=!!(n._isFilteredByTagger||n._isFilteredBySearchInWidget||n._isFilteredBySearchInMultiAppWidget),a===!!n._isFilteredByTagger&&s===!!n._isFilteredBySearchInWidget&&o===!!n._isFilteredBySearchInMultiAppWidget||this._updateFilteredIcon()},propagateSearch:function(e){var t=(e=e||{}).from,i=e.widgetId,n=this.wp,a=this.widget,s=a&&a.id,o=this.isContainer();!n||!a||t!==DSearch.from.widgetPreview&&t!==DSearch.from.multiWidgetPreview||!o&&t===DSearch.from.widgetPreview&&i!==s||o&&t===DSearch.from.multiWidgetPreview&&i!==s||(o?(i===s&&(n.shouldPropagateSearch=!0,n.shouldPropagateSearchArg=e,this._applySearch(e)),this.getChildren().forEach(function(t){t.widget&&t.widget.environment.propagateSearch(e)})):(i===s&&(n.shouldPropagateSearch=!0,n.shouldPropagateSearchArg=e),this._applySearch(e)))},calculateDeviceMode:function(){return document.body.getSize().width<=958?"mobile":"desktop"},isDeviceModeChange:function(){var e=this.calculateDeviceMode();return this.deviceMode!==e},isEditable:function(){return!!(this.wp||{}).isEditable},isContainer:function(){return!!(this.wp||{}).isContainer},isFloat:function(){return!!(((this.wp||{}).parent||{}).wp||{}).isFloat},isMaximized:function(){var e=this.view.next||this.view.current;return!!e&&"maximized"===e.event.type},isMinimized:function(){return!1},isFullscreen:function(){return!!this.addinMode||this.isMaximized()&&"mobile"===this.deviceMode},hasFocus:function(){return!!(this.wp||{}).hasFocus},isLinkable:function(){return!!(this.wp||{}).isLinkable},isLinked:function(){return!!(this.wp||{}).isLinked},isLinkedWith:function(e){return this.isLinked()&&WidgetLinkManager.getLinked(e).includes(this.widget.id)},isBMDummyWdg:function(){return!1},updateViewMode:function(){var e=this.wp;this.deviceMode=this.calculateDeviceMode(),this.isContainer()||this.addinMode||e.isMultiAppChildren||PubSub.dispatch("onViewChange",{type:"maximized",id:e.id})},onViewRequest:function(e){return e&&"focus"in e&&this.updateFocus(e),this._parent.apply(this,arguments)},updateFocus:function(e){function t(e,t){e.wp.hasFocus!==t&&(e.wp.hasFocus=t,PubSub.dispatch(t?DAPI.events.widget.focus:DAPI.events.widget.unfocus,e.widget),e.html.module.parentElement.toggleClassName(FOCUSED_CLASS,t))}var i=e.focus&&this.getParentChildren().length>1;i&&this.getParentChildren().forEach(function(e){var i=e.widget&&e.widget.environment;i&&e.id!==this.wp.id&&t(i,!1)},this),t(this,i)},getEmbeddedIframe:function(){if(this.embedded&&this.wp.isolationLevel<2){var e=this.embedded.elements.iframe;return e&&e.contentWindow.document}},getParent:function(){return(this.wp||{}).parent},getChildren:function(){return this.wp.children||[]},getParentChildren:function(){return(this.wp||{}).parent?this.getChildren.call(this.wp.parent):[]},destroy:function(){var e,t,i=this.html,n=this.widget,a=this.view,s=this.embedded;for(e in this._removePubSubEvents(),n&&(n.dispatchEvent("onDestroy"),PubSub.dispatch(DAPI.events.widget.destroy,[n]),this.getChildren().forEach(function(e){var t=(e.widget||{}).environment;t&&t.destroy()}),UWA.Widgets.instances.splice(UWA.Widgets.instances.indexOf(n),1),n.removeEvents(),n.destroy(),this.widget=null),Object.keys(this.components||{}).forEach(function(e){"function"==typeof e.destroy&&e.destroy(),delete this.components[e]},this),this.components=null,this.clearDelayed(),this.clearPeriodical(),i)i.hasOwnProperty(e)&&i[e].destroy();for(t in a)a.hasOwnProperty(t)&&a[t]&&a[t].destroy();this.viewSkeleton.destroy(),this.removeEvents(),s&&(!function(){var e,t,i;if(s.socket&&(e=UWA.Embedded.Servers["uwa.embedded"])&&(i=s.socket.id.replace("master","slave"),t=e.sockets[i]))try{t.source.contentDocument||delete e.sockets[i]}catch(e){}}(),s.destroy(this.wp.id)),this.destroyed=!0,this.registered=!1,this.data=null,this.wp=null,this.viewSkeleton=null,this.embedded=null},updatePlatformInfoIcon:function(){var e=this.widget,t=this.html;if(!this.isContainer()&&t.actionPlatformInfo)if(DAPI._shouldShowWidgetPlatformInfo(e)){var i,n=this.components,a=t.actionPlatformInfo,s=n.tooltipPlatformInfo,o=DAPI._getGlobalPlatformId(),r=e.getValue("x3dPlatformId"),d=e.getValue("xPref_CREDENTIAL"),l=this.isFullscreen();d||r!==o||l?(i={target:a,platformId:r,xPrefCredential:d,disabled:!this._isPlatformInfoClickable(),onClick:this._onPlatformInfoClick.bind(this)},s?s.update(i):n.tooltipPlatformInfo=new PlatformInfoTooltipView(i),l&&PubSub.dispatch(DAPI.events.widget.updatePlatformInfoFullscreenWidget,{widgetId:e.id,show:!0}),this._updatePlatformInfoFonticon(),a.show(),this.wp.isPlatformInfoIconShown=!0,this.updateSkeleton()):this._hidePlatformInfoIcon()}else this._hidePlatformInfoIcon()},_hidePlatformInfoIcon:function(){var e=this.html.actionPlatformInfo;if(e){var t=this.components,i=t.tooltipPlatformInfo;i&&i.destroy(),delete t.tooltipPlatformInfo,this.isFullscreen()&&PubSub.dispatch(DAPI.events.widget.updatePlatformInfoFullscreenWidget,{widgetId:this.widget.id,hide:!0}),e.hide(),this.wp.isPlatformInfoIconShown=!1,this.updateSkeleton()}},_updatePlatformInfoFonticon:function(){var e=this;return DAPI.getPlatforms().then(function(t){e.html.actionPlatformInfo.removeClassName("fonticon-cloud-alt").removeClassName("fonticon-user-key").addClassName(t.length>1?"fonticon-cloud-alt":"fonticon-user-key")})},_isPlatformInfoClickable:function(){return!(!this.widget||!this.widget.hasPreferences())},_updatePlatformInfoClickableClass:function(){var e=this.html.actionPlatformInfo;e&&this.wp.isPlatformInfoIconShown&&e.toggleClassName(CLICKABLE_CLASS,this._isPlatformInfoClickable())},_onPlatformInfoClick:function(){this._isPlatformInfoClickable()&&(this.components.tooltipPlatformInfo.hide(),this.togglePreferences())},updateLinkedWidgetIcon:function(){var e,t,i=this.components,n=this.html.actionLinkedWidget;!this.isContainer()&&n&&(this.isLinked()?(i.tooltipLinkedWidget&&i.tooltipLinkedWidget.destroy(),e=WidgetLinkManager.getLinked(this.widget.id),t=1===(t=(e=UWA.Widgets.instances.filter(function(t){return e.includes(t.id)})).map(function(e){return e.environment.getName()})).length?t[0]:t.join(", "),i.tooltipLinkedWidget=new Tooltip({className:"linked-with-tooltip",position:"bottom",target:n,body:i18n.replace(Nls.linkWithWidgetTooltip,{name:t}),offset:{x:0,y:0},events:{onHide:this._unhighlightLinkedWidgets.bind(this)}}),n.show(),this.wp.isLinkedWidgetIconShown=!0):this._hideLinkedWidgetIcon())},_hideLinkedWidgetIcon:function(){var e=this.html.actionLinkedWidget;e&&(e.hide(),this.wp.isLinkedWidgetIconShown=!1)},_updateLinkabilityStatus:function(){var e=this.widget,t=this.wp;e&&t&&(t.isLinked=WidgetLinkManager.getLinked(e.id).length>0,this.updateLinkedWidgetIcon())},_highlightLinkedWidgets:function(){this._getLinkedWidgets().concat([this.widget]).forEach(function(e){var t=e.environment,i=t.html.module.parentElement;t.hasFocus()&&i.removeClassName(FOCUSED_CLASS),i.addClassName(LINKED_HIGHLIGHTED_CLASS)})},_unhighlightLinkedWidgets:function(){this._getLinkedWidgets().concat([this.widget]).forEach(function(e){var t=e.environment,i=t.html.module.parentElement;t.hasFocus()&&i.addClassName(FOCUSED_CLASS),i.removeClassName(LINKED_HIGHLIGHTED_CLASS)})},_getLinkedWidgets:function(){var e=WidgetLinkManager.getLinked(this.widget.id);return UWA.Widgets.instances.filter(function(t){return e.includes(t.id)&&t.environment.widget}).map(function(e){return e.environment.widget})},_addPubSubEvents:function(){var e=this,t=e.widget.id,i=(e.wp||{}).isMultiAppChildren;e._removePubSubEvents(),e._on3DSearchOpenSearchInTab=function(t){var n={value:(t=t||{}).query,submit:t.submit};e.isContainer()&&e.isMultiApp?e.showSearchInMultiAppView(n):i||e.showSearchInWidgetView(n)},e.isContainer()?e.isMultiApp&&PubSub.add(DAPI.events.search.openSearchInTab,e._on3DSearchOpenSearchInTab):(e._onLinked=function(i){[i.source,i.target].includes(t)&&e._updateLinkabilityStatus()},PubSub.add(DAPI.events.widget._link,e._onLinked),e._onUnlinked=function(i){[i.source,i.target].includes(t)&&e._updateLinkabilityStatus()},PubSub.add(DAPI.events.widget._unlink,e._onUnlinked),e._onViewChanged=function(){var t=e.html,i=t.module,n=t.wrapper;e.isFullscreen()?(i.addClassName(FULLSCREEN_CLASS),n.removeClassName(MODULE_BORDER_CLASS)):(i.removeClassName(FULLSCREEN_CLASS),n.addClassName(MODULE_BORDER_CLASS)),e._getSearchInWidgetView()&&e.showSearchInWidgetView({updateDOMLocation:!0}),i.hasClassName(HIDE_CTN_BEFORE_ON_VIEW_CHANGE_CLASS)&&setTimeout(function(){i.removeClassName(HIDE_CTN_BEFORE_ON_VIEW_CHANGE_CLASS)},ON_VIEW_CHANGE_ANIMATION_TIME)},PubSub.add("onViewChange",e._onViewChanged),i||PubSub.add(DAPI.events.search.openSearchInTab,e._on3DSearchOpenSearchInTab))},_removePubSubEvents:function(){this._onLinked&&PubSub.remove(DAPI.events.widget._link,this._onLinked),this._onUnlinked&&PubSub.remove(DAPI.events.widget._unlink,this._onUnlinked),this._onViewChanged&&PubSub.remove("onViewChange",this._onViewChanged),this._on3DSearchOpenSearchInTab&&PubSub.remove(DAPI.events.search.openSearchInTab,this._on3DSearchOpenSearchInTab)},showSearchInWidgetView:function(e){e=e||{};var t,i=this,n=i.html,a=n.searchInWidgetView;function s(e){"string"==typeof e.value&&a.setValue(e.value),e.submit&&a.search()}if(t=("boolean"==typeof e.isFullscreen?e.isFullscreen:i.isFullscreen())?n.wrapper:n.searchCtn,a){if(a.isVisible())return e.updateDOMLocation?t.appendChild(a.container):a.focus(),void s(e);n.searchInWidgetView.destroy()}n.searchInWidgetView=a=new SearchInWidgetView({targetId:i.widget.id,from:DSearch.from.widgetPreview,trackerType:"widgetPreview",events:{onShow:function(){n.module.addClassName("search-in-widget-displayed"),n.actionSearchInWidget.hide(),i.wp.isMultiAppChildren&&i.wp.parent._closeSearchInMultiAppWidget()},onHide:function(){n.module.removeClassName("search-in-widget-displayed"),n.actionSearchInWidget.show()},close:function(){i.wp.shouldPropagateSearch=!1,i.wp.shouldPropagateSearchArg=null}}}),a.render().inject(t).show(),s(e)},showSearchInMultiAppView:function(e){e=e||{};var t=this,i=t.html,n=i.searchInMultiAppWidgetView,a=t.widget.id;function s(e){"string"==typeof e.value&&n.setValue(e.value),e.submit&&n.search()}if(n){if(n.isVisible())return n.focus(),void s(e);i.searchInMultiAppWidgetView.destroy()}i.searchInMultiAppWidgetView=n=new SearchInMultiAppWidgetView({targetId:a,from:DSearch.from.multiWidgetPreview,trackerType:"multiWidgetPreview",events:{onShow:function(){i.headerFloat.addClassName("search-in-multiapp-widget-displayed"),t.getChildren().forEach(function(e){e.widget&&e.widget.environment._closeSearchInWidget()})},onHide:function(){i.headerFloat.removeClassName("search-in-multiapp-widget-displayed")},close:function(){t.wp.shouldPropagateSearch=!1,t.wp.shouldPropagateSearchArg=null}}}),n.render().inject(i.headerFloatSearchCtn).show(),s(e)},_getSearchInWidgetView:function(){var e=this.html.searchInWidgetView;return e&&e.isVisible()&&e},_closeSearchInWidget:function(e){var t=this._getSearchInWidgetView();t&&t.close(e)},_getSearchInMultiAppWidgetView:function(){var e=this.html.searchInMultiAppWidgetView;return e&&e.isVisible()&&e},_closeSearchInMultiAppWidget:function(e){var t=this._getSearchInMultiAppWidgetView();t&&t.close(e)},_applySearch:function(e){var t=this.widget,i=e.query;t&&(this.setFiltered({from:e.from,clear:e.clear}),this.isContainer()||(i?t.dispatchEvent("onSearch",i):t.dispatchEvent("onResetSearch")))},_onReadyForSearchEvent:function(){var e,t,i=this,n=i.wp,a=i.widget,s=(n||{}).parent,o=(s||{}).wp,r={};n&&a&&s&&o&&(t=!(!a._isFilteredBySearchInMultiAppWidget&&!a._isFilteredBySearchInWidget),o.shouldPropagateSearch?(e=o.shouldPropagateSearchArg).clear&&!t||(r[e.from]=e):n.shouldPropagateSearch&&((e=n.shouldPropagateSearchArg).clear&&!t||(r[e.from]=e)),Object.keys(r).length&&Object.values(r).forEach(function(e){i.propagateSearch(e)}))},_updateFilteredIcon:function(){var e=this.wp,t=this.widget,i=this.html,n=this.components,a="";t&&i.stateFiltered&&(e.isFiltered&&(!t._isFilteredBySearchInWidget||t._isFilteredByTagger||t._isFilteredBySearchInMultiAppWidget)?(t._isFilteredByTagger&&t._isFilteredBySearchInMultiAppWidget?a=Nls.contentFilteredByTagsAndSearchInMultiAppWidget:t._isFilteredByTagger&&(a=Nls.contentFilteredByTags),t._isFilteredBySearchInMultiAppWidget&&(a=Nls.contentFilteredBySearchInMultiAppWidget),a&&(n.filteredTooltip&&n.filteredTooltip.destroy(),n.filteredTooltip=new Tooltip({position:"bottom",target:i.stateFiltered,body:a||Nls.filtered,offset:{x:0,y:0}})),i.stateFiltered.show(),this.wp.isFilteredIconShown=!0,this.isFullscreen()&&PubSub.dispatch(DAPI.events.widget.updateFilteredIconFullscreenWidget,{widgetId:t.id,show:!0,tooltip:a})):this._hideFilteredIcon())},_hideFilteredIcon:function(){var e=this.html,t=this.components;t.filteredTooltip&&t.filteredTooltip.destroy(),delete t.filteredTooltip,e.stateFiltered.hide(),this.wp.isFilteredIconShown=!1,this.isFullscreen()&&PubSub.dispatch(DAPI.events.widget.updateFilteredIconFullscreenWidget,{widgetId:this.widget.id,hide:!0})},views:{windowed:Environment.AbstractView.extend({onEnter:function(){}}),maximized:Environment.AbstractView.extend({getTarget:function(){var e=this.environment;return this.container||e.html.module.getParent()},getWidgets:function(){var e=this.getTarget();if(e)return this.widgets||(this.widgets=e.getElements(".module")),this.widgets},resize:function(){var e=this.getTarget(),t=e.getParent(".wp-tabview-panel");this.height=t.getSize().height,e.setStyle("height",this.height),this.event.height=this.height-44-11},isSingle:function(){return!1},onEnter:function(){this.environment.wp&&PubSub.dispatch("onViewChange",{type:"maximized",id:this.environment.wp.id})},onLeave:function(){},enter:function(){this.dispatchEvent("onEnter")},leave:function(){this.dispatchEvent("onLeave")}})}});return Preview}),define("DS/WidgetPreview/Controller/AbstractTransientManager",["UWA/Core","UWA/Class","UWA/Promise","DS/WidgetPreview/Environment/Transient","DS/WidgetPreview/View/TransientContainer","DS/WidgetPreview/Model/App","DS/TransientWidget/Tool/Mapping","DS/TransientWidget/Tool/TransientMessaging","DS/Dashboard/GridManager","DS/Dashboard/PublicAPI","DS/Dashboard/Navigation","DS/UWPClientControls/Utils","DS/UWPClientControls/PlatformNotify","DS/TagNavigator/TagNavigator","DS/PubSub/PubSub","i18n!DS/WidgetPreview/assets/nls/TransientWidget"],function(e,t,i,n,a,s,o,r,d,l,h,p,c,u,g,f){"use strict";var m;function w(){return new i(function(e){require(["DS/Dashboard/Notification/Subscribe"],function(t){e(t)})})}function v(e,t,i){if(h.isBELayoutEditorMode()){var n=require("UWA/String"),a=t.type;t.notification.shared=JSON.parse(t.notification.data||"{}"),t.notification.type=a,t.notification.ucfType=n.ucfirst(a);var s=e._getTitle(t.notification.shared),o={notification:t.notification,subscribeModalInfos:{newTitle:s,dashboardModelId:(l._getActiveContext()||{}).modelId,tabId:(l._getActiveTab()||{}).id}};return(i?e._subscribeMultiWidget(o):e._subscribeWidget(o)).then(function(){return e._onSubscribeSuccess(a,s),!0}).catch(function(t){throw e._onSubscribeFailure(a,s,t),new Error("Subscribe failure: "+a+" - "+s)})}return e.subscribe(t)}return t.extend({init:function(e){e=e||{},this.apps={},this.activeAppId="default",this.grids=new Map,this.viewMode="Basic",this.addinMode=e.addinMode&&e.addinMode.value,Object.defineProperty(this,"activeApp",{get:function(){return this.apps[this.activeAppId]},set:function(e){this.apps[this.activeAppId]=e}}),this.endpoint="app",this.tagNavContext="transient",this.floatMinHeight=300,this.floatMinWidth=300,m=require("DS/UWPClientCode/WidgetFactory")},showWidget:function(t){var i,n=t.options||{},a=n&&"panel"===n.mode,s=n.height||void 0,o=n.width||void 0;if(this.viewMode=a?"Float":"Basic",a?(this.floatHeight=e.is(s,"number")&&s>=this.floatMinHeight?s:this.floatMinHeight,this.floatWidth=e.is(o,"number")&&o>=this.floatMinWidth?o:this.floatMinWidth):(this.floatHeight=null,this.floatWidth=null),t.data&&t.data.URLTransientData){try{i=JSON.parse(t.data.URLTransientData)}catch(e){i={}}Object.keys(i).forEach(function(e){t.data[e]=i[e]}),delete t.data.URLTransientData}},closeWidget:function(t){var i,n,a,s=t&&t.appId||this.activeAppId,r=this.apps[s];r&&(1===Object.keys(this.apps).length&&(i=l._getActiveTab(),u.get6WTagger(this.tagNavContext).clearFilters(),i&&(n=i.id,e.is(n)&&u.get6WTagger(n).setAsCurrent())),this.activeAppId===s&&this.hide({appId:s}),g.remove(o.Events.PreviewWidgetLoaded,this._setTopBarProxyWithContext),delete this._setTopBarProxyWithContext,r.view&&r.view.destroy&&r.view.destroy(),r.widgetGrid&&(r.widgetGrid.environment.destroy(),r.widgetGrid=null),(a=this.grids.get(r))&&a.destroy(),this.grids.delete(r),delete this.apps[s])},hide:function(e){var t,i=e&&e.appId||this.activeAppId,n=this.apps[i];n&&(n.view&&n.view.hide&&n.view.hide(),"Basic"===this.viewMode&&(n.view&&n.view.showBackground(),(t=this.grids.get(n))&&d.unregister(t.id)))},isWidgetOpen:function(e){var t=(e=e||{}).appId?this.apps[e.appId]:this.activeApp;return t&&t.view.isVisible()},show:function(e){var t=e&&e.appId||this.activeAppId,i=this.apps[t],n=this.grids.get(i);i.view.show(),"Basic"===this.viewMode&&(i.view.hideBackground(),n&&d.register(n)),"Float"===this.viewMode&&this.apps[t].view.showBackground(),Object.keys(this.apps).forEach(function(e){e!==t&&this.apps[e].view.hide()},this)},refresh:function(){this.activeApp.model.widgets.forEach(function(e){e.widget.dispatchEvent("onRefresh")})},addModule:function(t){return w().then(function(i){return v(i,{notification:e.merge({data:JSON.stringify({contentData:{title:t.widget.title||"_"},appId:t.widget.appId,widgetId:t.widget.widgetId,data:t.environment.getAllData})},t.notification||{}),type:i.WIDGET_TYPE},!1)}).then(this._handleAddModuleEnd.bind(this))},addModules:function(t){t=t||{};var i=(this.activeApp.widgetGrid?this.activeApp.widgetGrid.environment.wp.children:this.activeApp.model.widgets)||[],n=[],a=p.getPlatform(this.clientWidth),s={},o=this.activeApp.model;return s[a]=l._getDefaultModuleCoordinates()[a],i.forEach(function(e,t){s[a].col+=s[a].sizex*t,n.unshift({widgetId:e.widgetId,data:JSON.stringify({contentData:{title:e.name},appId:e.appId,widgetId:e.widgetId,data:e.widget.environment.getAllData(),coordinates:JSON.stringify(s)})})}),w().then(function(a){var s=1===i.length?a.WIDGET_TYPE:a.MULTI_WIDGET_TYPE;return v(a,{notification:e.merge({data:JSON.stringify({contentData:{title:o.title},appId:o.id,data:o.data,modulesData:n}),warning:o.data&&!1===o.data.x3dPreviewCompatible&&f.previewIncompatible},t.notification||{}),type:s},!0)}).then(this._handleAddModuleEnd.bind(this))},getUpdatedStartingData:function(t){var i,n=this.apps[t||this.activeAppId],a=n&&n.startingData||{};return i=e.clone(a),Object.keys(i).forEach(function(e){i[e]=n.model.widgets[0].widget.data[e]}),i},onInitLayout:function(e){this.activeApp.widgetGrid=e},onBeforeLoadLayout:function(e,t,i){"Float"===this.viewMode&&(e.proxy=!0,e.resizeClassName="r2g-resize-transient")},onAfterLoadLayout:function(e){"Basic"===this.viewMode&&d.register(e),this.grids.set(this.activeApp,e),d.register(e)},_handleAddModuleEnd:function(e){e?this._sendClose():u.get6WTagger(this.tagNavContext).setAsCurrent()},_sendClose:function(){r.getInstance().fire(o.TransientMessaging.CloseWidget)},_setTopBarProxy:function(e){var t;e.isContainer||((t=this.appInGridLoaded=this.appInGridLoaded||[]).push(e.id),this.activeApp.model.widgets.length===t.length&&(g.dispatch(o.Events.PreviewTopBarUpdate,{widgetsIds:t}),delete this.appInGridLoaded))},_renderApp:function(e){var t=this;function i(){"Float"!==t.viewMode&&u.get6WTagger(t.tagNavContext).setAsCurrent(),"Float"===t.viewMode&&t.activeApp.model.widgets.length>1?c.error(f.errorMultiAppFloating):(t._initializeGridLayout(),t.show())}function n(){t.closeWidget(),c.error(f.errorRetriveApp)}t.activeApp.model=new s(e.transientOpts),t.activeApp.model.fetch({errorOnGetAppInfo:e.errorOnGetAppInfo,onComplete:e.onComplete?e.onComplete.bind(null,i):i,onFailure:e.onFailure?e.onFailure.bind(null,n):n})},_initializeGridLayout:function(){var e=this.activeApp,t=e.model,i="."+this.activeAppId+" > "+o.Selector.TransientContent;e.view.setData({App:t,ViewMode:this.viewMode}),e.view.render(),m.load({widgetId:"8KqyNGD_00012RwEeGAd",el:document.body.querySelector(i),isolationLevel:0,preview:!0,data:JSON.stringify({TransientViewMode:this.viewMode,TransientNavContext:this.tagNavContext,TransientIsSingleBasicApp:this.isSingleBasicApp,TransientAddinMode:this.addinMode,isMultiApp:((t||{}).widgets||[]).length>1})},null,n)},_initializeActiveApp:function(){this.activeApp=this.activeApp||{},this.activeApp.view=new a({manager:this}),this.activeApp.model=null,this.activeApp.widgetGrid=null}})}),define("DS/WidgetPreview/Controller/TransientManagerAddinMode",["UWA/Core","DS/WidgetPreview/Controller/AbstractTransientManager","DS/TransientWidget/Tool/Mapping","DS/TagNavigator/TagNavigator","DS/PubSub/PubSub"],function(e,t,i,n,a){"use strict";return t.extend({showWidget:function(t){var s=this,o=t.options||{},r=o&&"panel"===o.mode;function d(){s.isSingleBasicApp=!r&&1===s.activeApp.model.widgets.length,s.isSingleBasicApp&&n.get6WTagger(s.tagNavContext).setAsCurrent(),s._setTopBarProxyWithContext=s._setTopBarProxy.bind(s),a.add(i.Events.PreviewWidgetLoaded,s._setTopBarProxyWithContext)}s._parent.apply(s,arguments),s.activeAppId=t.appId||"",s.isFirstTimeApp=!s.activeApp,s.isFirstTimeApp?(t.data||(t.data={}),s._initializeWidgetFirstTime(t.data),t.data.addinmode=s.addinMode,window.dscef&&window.dscef.loadValue?window.dscef.loadValue(s.activeAppId).then(function(i){i&&delete i.x3dPlatformId,t.data=e.merge(t.data,i),s.activeApp.startingData=t.data,s._renderApp({transientOpts:t}),d()}).catch(function(){s._renderApp({transientOpts:t}),d()}):(s._renderApp({transientOpts:t}),d())):(t.data&&s._widgetDataHasChanged(s.getUpdatedStartingData(),t.data)&&(s.activeApp.model.widgets.forEach(function(e){Object.keys(t.data).forEach(function(i){e.widget.setValue(i,t.data[i])}),e.widget.dispatchEvent("endEdit",{disableFlip:!0})}),s.activeApp.startingData=t.data),t.data||(s.activeApp.model.widgets.forEach(function(e){Object.keys(s.activeApp.startingData).forEach(function(t){e.widget.deleteValue(t)}),e.widget.dispatchEvent("endEdit",{disableFlip:!0})}),s.activeApp.startingData={}),s.show(),d())},_widgetDataHasChanged:function(e,t){var i=!0;return e=e||{},t=t||{},Object.keys(t).forEach(function(n){JSON.stringify(t[n])!==JSON.stringify(e[n])&&(i=!1)}),!i},_initializeWidgetFirstTime:function(e){this._initializeActiveApp(),this.activeApp.data=e,this.activeApp.startingData=e}})}),define("DS/WidgetPreview/Controller/TransientManagerClassic",["DS/WidgetPreview/Controller/AbstractTransientManager","DS/TransientWidget/Tool/Mapping","DS/TagNavigator/TagNavigator","DS/PubSub/PubSub","DS/Dashboard/CompassManager","i18n!DS/WidgetPreview/assets/nls/TransientWidget"],function(e,t,i,n,a,s){"use strict";var o={};return e.extend({init:function(){this._parent.apply(this,arguments)},showWidget:function(e){this._parent.apply(this,arguments);var r,d=a.appIds.x3DSearch;this.activeAppId=e.appId===d?d:"default",a.getAppInfo({appId:e.appId,onComplete:r=function(a){if(this.x3dPlatformId=(a||{}).platformId||"",this.isFirstTimeApp=!this.activeApp||this.activeApp.model.id!==e.appId||"Float"===this.viewMode||Object.keys(e.data||{}).length>0||this.activeAppId in o&&o[this.activeAppId]!==this.x3dPlatformId,o[this.activeAppId]=this.x3dPlatformId,this.isFirstTimeApp)this.isWidgetOpen()&&this.closeWidget(),this._initializeActiveApp(),e.data||(e.data={}),e.data.addinmode=this.addinMode,this._renderApp({errorOnGetAppInfo:(a||{}).error,transientOpts:e,onComplete:function(e){this.activeApp.model.widgets.reduce(function(e,t){return e&&!1!==JSON.parse(t.data).x3dPreviewCompatible},!0)?e():(this.addModules({notification:{warning:s.previewIncompatible}}),this.closeWidget())}.bind(this)});else{if(this.activeApp&&!this.activeApp.model.widgets)return;this.show(),"Float"!==this.viewMode&&i.get6WTagger(this.tagNavContext).setAsCurrent()}this._setTopBarProxyWithContext=this._setTopBarProxy.bind(this),n.add(t.Events.PreviewWidgetLoaded,this._setTopBarProxyWithContext)}.bind(this),onFailure:r})},closeWidget:function(e){delete o[e&&e.appId||this.activeAppId],this._parent.apply(this,arguments)},hide:function(e){var t=e&&e.appId||this.activeAppId;this._parent.apply(this,arguments),"default"!==t&&this.apps.default?this.showWidget({appId:this.apps.default.model.id}):this._parent.apply(this,arguments)}})}),define("DS/WidgetPreview/Controller/TransientManager",["DS/WidgetPreview/Controller/TransientManagerClassic","DS/WidgetPreview/Controller/TransientManagerAddinMode"],function(e,t){"use strict";var i=null;return{getInstance:function(n){return n=n||{},i||(i=n.addinMode?new t(n):new e(n)),i}}}),define("DS/WidgetPreview/Controller/Grid",["UWA/Core","DS/WidgetPreview/Controller/TransientManager","DS/WidgetPreview/Environment/Transient","DS/TransientWidget/Tool/Mapping"],function(e,t,i,n){"use strict";var a={init:function(e,i){e.data.isTransientMode=!0,t.getInstance().onInitLayout(e),i()},onBeforeLoadGrid:function(a,s,o){var r=t.getInstance(),d=(r.activeApp.model||{}).widgets||[],l=d.length,h={mobile:{sizex:1,sizey:5},tablet:{sizex:1,sizey:4},desktop:{sizex:1,sizey:6}};a.namespace=[].find.call(o.body.getParent(n.Selector.TransientContainer).classList,function(e){return 0===e.indexOf(n.Selector.TransientContainer.substring(1)+"-")}),a.proxy=!1,a.fit=!0,a.breakpoints="mobile:1:1:2 tablet:2:1:3 desktop:2:1:1",a.height=44,a.margins="7 7",a.maxSize="12 2",a.viewport=o.body.getParent(n.Selector.TransientContent),1===d.length&&(a.proxy=!0),r.onBeforeLoadLayout(a,s,o),d.forEach(function(t){t.data=e.merge({isMultiAppChildren:l>1},JSON.parse(t.data)),t.customEnvironment=i,t.coordinates=h,t.data.isMultiAppChildren||(t.coordinates.desktop.sizex=2,t.coordinates.tablet.sizex=2,t.coordinates.mobile.sizex=2),t.coordinates=JSON.stringify(t.coordinates),t.data=JSON.stringify(t.data),t.callback=o.data.TransientFloatCallback,s.push(t)})},onAfterLoadGrid:function(e){t.getInstance().onAfterLoadLayout(e)},onBeforeLoad:function(e,t,i,n){return a.onBeforeLoadGrid(t,i,n)},onAfterLoad:function(e,t){return a.onAfterLoadGrid(t)}};return a});