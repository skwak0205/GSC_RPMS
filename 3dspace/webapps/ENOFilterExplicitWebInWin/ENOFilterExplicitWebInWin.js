define("DS/ENOFilterExplicitWebInWin/views/filterRepairUI",["UWA/Core","UWA/Element","UWA/Promise","DS/Core/Core","UWA/Class/View","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/Handlebars/Handlebars4","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/WAFData/WAFData","DS/Controls/Accordeon","DS/Controls/TooltipModel","DS/CollectionView/ResponsiveLargeTilesCollectionView","i18n!DS/ENOFilterExplicitWebInWin/assets/nls/ENOStrRefinementUX.json","text!DS/ENOFilterExplicitWebInWin/template/filterRepairUITemplate.html","css!DS/ENOFilterExplicitWebInWin/ENOFilterExplicitWebInWin.css"],function(e,t,n,i,a,l,r,o,s,c,d,h,p,u,g,f,v,m){"use strict";return a.extend({setup:function(e){this.IsRepairFilterLaunchedInWidget=!1,this.securityCtx=e.ctx,this.serverUrl=e.url,this._brokenPathObj="object"==typeof e.brokenPaths?e.brokenPaths:JSON.parse(e.brokenPaths),this._template=o.compile(v),this.container.addEvent("click",function(e){return e.stopPropagation(),!1})},render:function(){var t=this;this.container.setContent(this._template({AppType:this.IsRepairFilterLaunchedInWidget?"widget":"webInWin",filterNameToRepair:f.get("RepairPanelHeader")})),this._ListOfTileViewCollection=[],this._myAccordeon=new p({style:"filled-separate"}),this._myAccordeon.inject(this.getElement(".repairFilter-list-accordeons"));for(var n=0;n<t._responseJsonObj.paths.length;n++){var i=new g({height:"inherit",displayTitleTooltip:!0,displayPropertiesTooltip:!0,useDragAndDrop:!1,toggle:!0});i.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!1,enableShiftSelection:!1,enableListSelection:!1,enableFeedbackForActiveCell:!0};for(var a=[],l=0;l<t._responseJsonObj.paths[n].length;l++){var o=t._responseJsonObj.paths[n][l],d=o.length,h=t._checkForDeletedPathCase(o),v=!!h&&this._checkForReplacedPathCase(o,this._brokenPathObj.paths[n]);if(d>0&&o[d-2].name&&h&&!v){var m=this._buildNodeFromData(o);if(m.label){var b=new r({label:m.label,subLabel:o[d-1].trueType,thumbnail:o[d-1].preview_url,data:m.data});a.push(b)}}}if(a.length>0){i.model=a,this._ListOfTileViewCollection.push(i),i.modelProvider.selectNode(a[0]);var _=e.createElement("div",{class:"tile1 accordeon-node"});_.inject(this.getElement(".repairFilterTiles-test")),i.inject(_);var y=i.model.length,T=125*y+"px";_.setStyle("height",T);var I={header:t._brokenPathObj.paths[n][t._brokenPathObj.paths[n].length-1].name,content:_};this._myAccordeon.addItem(I);var C=e.createElement("span",{class:"ignore-span accordeon-"+n,text:f.get("IgnoreTitle")});C.setAttribute("expander",n);var S=e.createElement("div",{class:"statusOfRepair statusNum-"+n,text:f.get("SolvedCellName")}),O=this.getElements(".wux-controls-expander-header-container")[n];C.inject(O),S.inject(O),O.tooltipInfos=new u({shortHelp:I.header,mouseRelativePosition:!0}),C.addEventListener("click",function(e){var n=e.target.getAttribute("expander"),i=t._ListOfTileViewCollection[n],a=e.target.getText();f.get("IgnoreTitle")===a?(t._ignore=!0,e.target.setText(f.get("ReactivateTitle")),i.modelProvider.unselectAll()):f.get("ReactivateTitle")===a&&(t._reactivate=!0,e.target.setText(f.get("IgnoreTitle")),i.modelProvider.selectNode(i.model[0]))},!1)}else{this._ListOfTileViewCollection.push(i);var E=new UWA.Element("div",{text:f.get("ObjectDeleted")});I={header:t._brokenPathObj.paths[n][t._brokenPathObj.paths[n].length-1].name,content:E};this._myAccordeon.addItem(I);var N=e.createElement("span",{class:"ignore-span deletedPath-span accordeon-"+n,text:f.get("Deleted")});O=this.getElements(".wux-controls-expander-header-container")[n];N.inject(O),O.tooltipInfos=new u({shortHelp:I.header,mouseRelativePosition:!0})}var F=function(e,n){for(var i=e.getLabel(),a="",l=t._ListOfTileViewCollection.length,r=0;r<l;r++){var o=t._ListOfTileViewCollection[r].model;if(o.length)for(var s=0;s<o.length;s++)if(i===o[s].getLabel()){a=r,t._myAccordeon.getExpanderFromIndex(r).expand();break}}a>=0&&(t.getElement(".statusNum-"+a).setText("add"===n?f.get("SolvedCellName"):f.get("IgnoreCellName")),t.getElement(".statusNum-"+a).setStyle("background-color","add"===n?"limegreen":"darkorange"),t.getElement(".accordeon-"+a).setText("add"===n?f.get("IgnoreTitle"):f.get("ReactivateTitle")))};i.onSelectionAdd(function(e){F(e,"add")}),i.onSelectionRemove(function(e){F(e,"remove")})}function w(e){e.stopImmediatePropagation();var t=e.options.expanderIndex,n=this._ListOfTileViewCollection[t];this._ignore?(n.modelProvider.unselectAll(),this._ignore=!1,this.getElement(".statusNum-"+t).setText(f.get("IgnoreCellName")),this.getElement(".statusNum-"+t).setStyle("background-color","darkorange")):this._reactivate&&(n.modelProvider.selectNode(n.model[0]),this._reactivate=!1,this.getElement(".statusNum-"+t).setText(f.get("SolvedCellName")),this.getElement(".statusNum-"+t).setStyle("background-color","limegreen"))}this._myAccordeon.getContent().addEventListener("expand",w.bind(this)),this._myAccordeon.getContent().addEventListener("collapse",w.bind(this));var x=this.getElement(".buttonDiv");return this.applyButton=new s({value:f.get("TitleApply"),className:"default RtMargin",id:"applyButton"}).inject(x),this.saveButton=new s({value:f.get("TitleSave"),className:"default RtMargin",id:"saveButton"}).inject(x),this.cancelButton=new s({value:f.get("TitleCancel"),className:"default RtMargin",id:"cancelButton"}).inject(x),t.IsRepairFilterLaunchedInWidget&&(this.saveButton.getContent().addClassName("hidden"),this.applyButton.getContent().setText(f.get("TitleOK"))),t.cancelButton.addEvent("onClick",function(){if(t.IsRepairFilterLaunchedInWidget){t.dispatchEvent("NGF_CancelRepairFilter",{listOfList:"CancelRepair"})}else t._webInWinNotif("CancelButton")}),t.saveButton.addEvent("onClick",function(){new c({closable:!0,renderTo:document.body,id:"superModaldialog"}).confirm(f.get("SaveWarning"),f.get("SaveWarningTitle"),function(e){if(console.log("Confirm result: "+e),e){var n=t._operateModel();t._webInWinNotif("SaveButton",n.listOfList)}})}),t.applyButton.addEvent("onClick",function(){var e=t._operateModel();t.IsRepairFilterLaunchedInWidget?t.dispatchEvent("NGF_RepairFilter",e):t._webInWinNotif("ApplyButton",e.listOfList)}),this},RepairFilterInWidget:function(){this.IsRepairFilterLaunchedInWidget=!0},fetchData:function(){var e=this;return new n(function(t){h.authenticatedRequest(e.serverUrl+"/resources/FilterBIAPI/ExplicitMgt/getGoodVersionsIds",{headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityCtx},method:"POST",data:JSON.stringify(e._brokenPathObj),onComplete:function(n){e._responseJsonObj={paths:[]};var i=JSON.parse(n);"object"==typeof i&&Array.isArray(i.paths)&&(e._responseJsonObj=i),e._responseJsonObj?e._getThumbnailAndTypeInfo().then(function(){t("RepairFilterFetchData_SUCCESS")}):t("RepairFilterFetchData_SUCCESS")},onFailure:function(n){console.log(" WebService Failure");JSON.stringify(n);var i=f.get("ServerError");alert(i),d.unmask(e.container),t("RepairFilterFetchData_FAILURE")}})})},_checkForDeletedPathCase:function(e){if(0==e.length)return!1;for(var t=0;t<e.length;t++)if(!e[t].name)return!1;return!0},_checkForReplacedPathCase:function(e,t){if(e[e.length-1].logicalid!=t[t.length-1].logicalid)return!0},_buildNodeFromData:function(e){for(var t=e[e.length-2].name+" - "+e[e.length-1].revision,n=e[e.length-2].coretype,i=[],a=[],l=0;l<e.length;l++)i.push(e[l].physicalid),a.push(e[l].logicalid);return{label:t,subLabel:n,data:{pathOfPhysicalID:i,pathOfLogicalID:a}}},_webInWinNotif:function(e,t){var n=JSON.stringify(t);console.log(n),"undefined"!=typeof CATCefSendString&&dscef.sendString(e+"="+n)},_operateModel:function(){for(var e=[],t=[],n=this._ListOfTileViewCollection.length,i=0;i<n;i++){var a=this._ListOfTileViewCollection[i],l=a.getActiveCellID();if("undefined"!==l&&a.modelProvider.isNodeSelected(a.model[l])){var r=a.getModelAt(l).options.data;e.push(r.pathOfPhysicalID),t.push(r.pathOfLogicalID)}}return{listOfList:e}},_getThumbnailAndTypeInfo:function(){var e=this;return new n(function(t){for(var n=[],i=e._responseJsonObj.paths,a=i.length,l=0;l<a;l++){var r=i[l].length;if(1==r)(s=i[l][0].length)>0&&n.push(i[l][0][s-1].physicalid);else for(var o=0;o<r;o++){var s;(s=i[l][o].length)>0&&n.push(i[l][o][s-1].physicalid)}}n.length>0?e._fetchTypeUrlInfo(n).then(function(i){var a=[];if(i.results=i.results||[],i.results.length<=n.length){for(var l=0;l<i.results.length;l++){for(var r,o,s,c=i.results[l],d=0;d<c.attributes.length;d++){var h=c.attributes[d];"resourceid"==h.name&&(r=h.value),"preview_url"==h.name&&(o=h.value),"type"==h.name&&(s=h.value)}var p={physicalid:r,url:o,type:s};a.push(p)}for(var u=e._responseJsonObj.paths,g=u.length,f=0;f<g;f++){var v=u[f].length;if(1==v){if((_=u[f][0].length)>0)for(var m=u[f][0][_-1].physicalid,b=0;b<a.length;b++)a[b].physicalid==m&&(u[f][0][_-1].preview_url=a[b].url,u[f][0][_-1].trueType=a[b].type)}else for(b=0;b<v;b++){var _;if((_=u[f][b].length)>0){m=u[f][b][_-1].physicalid;for(var y=0;y<a.length;y++)a[y].physicalid==m&&(u[f][b][_-1].preview_url=a[y].url,u[f][b][_-1].trueType=a[y].type)}}}t()}}):t()})},_fetchTypeUrlInfo:function(e){var t=this;return new n(function(n,i){var a={headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:e,select_file:["icon","thumbnail_2d"],select_predicate:["type"]}),onComplete:function(e){n(e)},onFailure:function(e){i(e)}};h.authenticatedRequest(t.serverUrl+"/cvservlet/fetch/v2",a)})}})});