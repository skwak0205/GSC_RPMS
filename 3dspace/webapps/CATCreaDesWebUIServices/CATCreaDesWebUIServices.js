define("DS/CATCreaDesWebUIServices/CATCrDWebMathServices",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var t=function(){};return t.getClosestCanonicalDir=function(t){var n=new e.Vector3(1,0,0),r=new e.Vector3(0,1,0),i=new e.Vector3(0,0,1),o=t.angleTo(n),a=t.angleTo(r),s=t.angleTo(i);return o>.5*Math.PI&&(o=Math.PI-o),a>.5*Math.PI&&(a=Math.PI-a),s>.5*Math.PI&&(s=Math.PI-s),o<a&&o<s?n:a<s?r:i},t.computeIsoView=function(t){t.normalize();var n=new Array(new e.Vector3(1,1,1),new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,1),new e.Vector3(-1,1,-1),new e.Vector3(1,-1,-1),new e.Vector3(-1,1,1),new e.Vector3(1,1,-1),new e.Vector3(-1,-1,1)),r=new Array(n[0].dot(t),n[1].dot(t),n[2].dot(t),n[3].dot(t),n[4].dot(t),n[5].dot(t),n[6].dot(t),n[7].dot(t)),i=0,o=Math.max(Math.min(1,r[0]),Math.min(1,r[1]),Math.min(1,r[2]),Math.min(1,r[3]),Math.min(1,r[4]),Math.min(1,r[5]),Math.min(1,r[6]),Math.min(1,r[7]));return r[1]==o?i=1:r[2]==o?i=2:r[3]==o?i=3:r[4]==o?i=4:r[5]==o?i=5:r[6]==o?i=6:r[7]==o&&(i=7),n[i].normalize(),UWA.log(i+"  dotResults :  "+r[i]),n[i]},t.computeIsoUpView=function(t){var n=new Array(new e.Vector3(1,0,0),new e.Vector3(-1,0,0),new e.Vector3(0,1,0),new e.Vector3(0,-1,0),new e.Vector3(0,0,1),new e.Vector3(0,0,-1)),r=new Array(n[0].dot(t),n[1].dot(t),n[2].dot(t),n[3].dot(t),n[4].dot(t),n[5].dot(t)),i=0,o=Math.max(r[0],r[1],r[2],r[3],r[4],r[5]);return r[1]==o?i=1:r[2]==o?i=2:r[3]==o?i=3:r[4]==o?i=4:r[5]==o&&(i=5),n[i]},t.computeLengthParameters=function(e){var t=new Array;if(e.length>0){t.push(0);for(var n=0,r=1;r<e.length;r++)n+=e[r-1].distanceTo(e[r]),t.push(n)}return t},t.computeLengthParametersPoints=function(t){var n=new Array;if(t.length>0){n.push(0);for(var r=0,i=1;i<t.length/3;i++){var o=i-1,a=new e.Vector3(t[3*o],t[3*o+1],t[3*o+2]),s=new e.Vector3(t[3*i],t[3*i+1],t[3*i+2]);r+=a.distanceTo(s),n.push(r)}}return n},UWA.namespace("DS/CATCreaDesWebUIServices/CATCrDWebMathServices",t)}),define("DS/CATCreaDesWebUIServices/CATCrDSettings",["UWA/Core","DS/ApplicationFrame/FrameWindow","DS/Visualization/ThreeJS_DS","DS/Controls/LayerSet","DS/Core/Events"].concat(window.dependencies),function(e,t,n,r,i){function o(){var e,t,r,i,o,a,s,c,l,u,d,p,m,h;this.getSettingsColor=function(){return e},this.getSettingsDrawingPlane=function(){return t},this.getSettingsDrawingPlanePosition=function(){return r},this.getSettingsSymmetryPlane=function(){return i},this.getSettingsSymmetryPlanePosition=function(){return o},this.getSettingsPencilThickness=function(){return a},this.getSettingsMaxPencilThickness=function(){return s},this.getSettingsMinPencilThickness=function(){return c},this.getSettingsPencilOpacity=function(){return l},this.getSettingsMaxPencilOpacity=function(){return u},this.getSettingsMinPencilOpacity=function(){return d},this.getPencilDebug=function(){return h},this.getSymmetryMode=function(){return p},this.getPrimitivesMode=function(){return m},this.setSettingsColor=function(t){e=t},this.setSettingsDrawingPlane=function(e){t=e},this.setSettingsDrawingPlanePosition=function(e){r=e},this.setSettingsSymmetryPlane=function(e){i=e},this.setSettingsSymmetryPlanePosition=function(e){o=e},this.setSettingsPencilThickness=function(e){a=e},this.setSettingsMaxPencilThickness=function(e){s=e},this.setSettingsMinPencilThickness=function(e){c=e},this.setSettingsPencilOpacity=function(e){l=e},this.setSettingsMaxPencilOpacity=function(e){u=e},this.setSettingsMinPencilOpacity=function(e){d=e},this.setPencilDebug=function(e){h=e},this.setSymmetryMode=function(e){p=e},this.setSymmetryPlane=function(e){p=e},this.setPrimitivesMode=function(e){m=e},this.initSettings=function(){e=new n.Color(0),1,t=new n.Plane(new n.Vector3(0,0,1)),r=new n.Vector3(0),i=new n.Plane(new n.Vector3(0,1,0)),o=new n.Vector3(0),a=1,l=1,h=!1,s=15,c=1,u=1,d=.1,m=!1,p=!1}}var a;return UWA.namespace("DS/CATCreaDesWebUIServices/CATCrDSettings",function(){return!1===UWA.typeOf(a)&&(a=new o).initSettings(),a})}),define("DS/CATCreaDesWebUIServices/CATCrDShaders",["UWA/Core","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";var n=UWA.Class.extend({getPencilShader:function(){return{uniforms:{Color:{type:"c",value:new t.Color(16776960)},Opacity:{type:"f",value:1},CutByPlane:{type:"f",value:0},PlanePosition:{type:"v3",value:new t.Vector3(0,0,0)},PlaneNormal:{type:"v3",value:new t.Vector3(1,0,0)}},varyings:{vTexCoord:{type:"v4"}},globalCode_VS:[].join("\n"),overridenFunctions_VS:{ComputeObjectPosition:"vec3 ComputeObjectPosition() { return vGetAttribPosition(); }",ComputeVaryingValues:"void ComputeVaryingValues() { /*vTexCoord = vec4(uv, 0.0, 1.0);*/ vTexCoord = vGetAttribTexCoord0(); }"},globalCode_FS:["vec4 commonFinalColor;","vec3 selectorColor = vec3(0., 0.45, 0.75);","float bezierBlend(float t)","{","return clamp((3.0 * t * t * (1.0-t) + t * t * t), 0.0, 1.0);","}"].join("\n"),overridenFunctions_FS:{ComputeCommonValues:["void ComputeCommonValues()","{","vec2 cornerUV = vTexCoord.xy;","float alpha = Opacity;","//  float pressure = clamp(1.02 * vTexCoord1.x, 0.0, 1.0); // if pressure > 0.98 => pressure = 1.0","float pressure=1.0;","cornerUV.y = 2.0 * (cornerUV.y - 0.5);","float xUVTest1 = clamp(sign(0.25 - cornerUV.x), 0.0, 1.0); // if cornerUV.x<0.25f","float xUVTest2 = clamp(sign(cornerUV.x - 0.75), 0.0, 1.0); // if cornerUV.x>0.75f","cornerUV.x = mix(cornerUV.x, 1.0 - cornerUV.x * 4.0, xUVTest1); // if cornerUV.x<0.25f => cornerUV.x = 1.0 - cornerUV.x * 4.0","cornerUV.x = mix(cornerUV.x, (cornerUV.x - 0.75) * 4.0, xUVTest2); // if cornerUV.x>0.75f => cornerUV.x = (cornerUV.x - 0.75) * 4.0","float inTheCorner = xUVTest1 + xUVTest2; // 0 if 0.25 < u < 0.75, else 1","float corner = cornerUV.x * cornerUV.x + cornerUV.y * cornerUV.y;","if(inTheCorner * corner > 1.0) // true only if inTheCorner = 1 and corner > 1 as inTheCorner can only be 0 or 1","{","discard;","}","//-----------------------------------------------------------------------------------------------","// Handle cut by plane","//-----------------------------------------------------------------------------------------------","float cutByPlaneActivated = clamp(sign(CutByPlane), 0.0, 1.0); // 0 if CutByPlane <= 0, 1 if CutByPlane > 0","// We do the work in the view space","// We compute the plane's equation: ax + by + cz + d = 0   => Normal(a, b, c), d = -dot(PlaneNormal, PlanePosition)","vec4 viewPlaneEq = vGetViewInvTranspMatrix() * vec4(PlaneNormal, -dot(PlaneNormal, PlanePosition));","// eye and Fragment position","vec4 fragPos = vec4(vGetViewPosition(), 1.0);","vec4 eyePos = vec4(0.0, 0.0, 0.0, 1.0);","// The sign of the plane's equation applied to the previous position gives the side of each point","float eyeClip = dot(viewPlaneEq, eyePos); // => d","float fragClip = dot(viewPlaneEq, fragPos) + sign(eyeClip) * 10e-2;","// cutByPlaneActivated == 0 => hide = 0.0","// If both values have the same sign, they are on the same side => hide = 0.0","// If there signs are different, they are on opposite side      => hide = 1.0","float hide = mix(0.0, clamp(-1.0 * sign(fragClip * eyeClip), 0.0, 1.0), cutByPlaneActivated);","commonFinalColor = vec4(Color.xyz, pressure * alpha * mix(1.0, 0.25, hide));","}"].join("\n"),ComputeOpacity:["float ComputeOpacity()","{","return commonFinalColor.a;","}"].join("\n"),ProcessFinalColor:["void ProcessFinalColor(inout vec4 finalColor)","{","finalColor = commonFinalColor;","}"].join("\n")}}},getPenShader:function(){return{uniforms:{Color:{type:"c",value:new t.Color(16776960)},Opacity:{type:"f",value:1},Thickness:{type:"f",value:1},Length:{type:"f",value:1},CutByPlane:{type:"f",value:0},PlanePosition:{type:"v3",value:new t.Vector3(0,0,0)},PlaneNormal:{type:"v3",value:new t.Vector3(1,0,0)}},varyings:{vTexCoord:{type:"v4"}},globalCode_VS:[].join("\n"),overridenFunctions_VS:{ComputeObjectPosition:"vec3 ComputeObjectPosition() { return vGetAttribPosition(); }",ComputeVaryingValues:"void ComputeVaryingValues() { vTexCoord = vGetAttribTexCoord0(); }"},globalCode_FS:["vec4 commonFinalColor;"].join("\n"),overridenFunctions_FS:{ComputeCommonValues:["void ComputeCommonValues()","{","float adjustedLength = max(Thickness, Length);","float thicknessUV = 0.5 * Thickness/adjustedLength;","vec2 cornerUV = vTexCoord.xy;","cornerUV.y = 2.0 * (cornerUV.y - 0.5);","float xUVTest1 = clamp(sign(thicknessUV - cornerUV.x), 0.0, 1.0); // if cornerUV.x<thicknessUV","float xUVTest2 = clamp(sign(cornerUV.x - (1.0 - thicknessUV)), 0.0, 1.0); // if cornerUV.x>1.0f - thicknessUV","cornerUV.x = mix(cornerUV.x, 1.0 - cornerUV.x/thicknessUV, xUVTest1); // if cornerUV.x<thicknessUV => cornerUV.x = 1.0f - cornerUV.x/thicknessUV","cornerUV.x = mix(cornerUV.x, (cornerUV.x - (1.0 - thicknessUV))/thicknessUV, xUVTest2); // if cornerUV.x > 1.0f - thicknessUV => (cornerUV.x - (1.0f - thicknessUV))/thicknessUV","float inTheCorner = xUVTest1 + xUVTest2; // xUVTest1 || xUVTest2","float corner = cornerUV.x * cornerUV.x + cornerUV.y * cornerUV.y;","if(inTheCorner * corner > 1.0) // true only if isOpenedWire == 1 and inTheCorner == 1 and corner > 1 as isOpenedWire and inTheCorner can only be 0 or 1","{","discard;","}","//-----------------------------------------------------------------------------------------------","// Handle cut by plane","//-----------------------------------------------------------------------------------------------","float cutByPlaneActivated = clamp(sign(CutByPlane), 0.0, 1.0); // 0 if CutByPlane <= 0, 1 if CutByPlane > 0","// We do the work in the view space","// We compute the plane's equation: ax + by + cz + d = 0   => Normal(a, b, c), d = -dot(PlaneNormal, PlanePosition)","vec4 viewPlaneEq = vGetViewInvTranspMatrix() * vec4(PlaneNormal, -dot(PlaneNormal, PlanePosition));","// eye and Fragment position","vec4 fragPos = vec4(vGetViewPosition(), 1.0);","vec4 eyePos = vec4(0.0, 0.0, 0.0, 1.0);","// The sign of the plane's equation applied to the previous position gives the side of each point","float eyeClip = dot(viewPlaneEq, eyePos); // => d","float fragClip = dot(viewPlaneEq, fragPos) + sign(eyeClip) * 10e-2;","// cutByPlaneActivated == 0 => hide = 0.0","// If both values have the same sign, they are on the same side => hide = 0.0","// If there signs are different, they are on opposite side      => hide = 1.0","float hide = mix(0.0, clamp(-1.0 * sign(fragClip * eyeClip), 0.0, 1.0), cutByPlaneActivated);","commonFinalColor = vec4(Color.xyz, Opacity * mix(1.0, 0.25, hide));","}"].join("\n"),ComputeOpacity:["float ComputeOpacity()","{","return commonFinalColor.a;","}"].join("\n"),ProcessFinalColor:["void ProcessFinalColor(inout vec4 finalColor)","{","finalColor = commonFinalColor;","}"].join("\n")}}},getGroundShader:function(){return{uniforms:{Color:{type:"c",value:new t.Color(16776960)},Radius:{type:"f",value:500}},varyings:{worldPosition:{type:"v3"}},globalCode_VS:[].join("\n"),overridenFunctions_VS:{ComputeObjectPosition:"vec3 ComputeObjectPosition() { return vGetAttribPosition(); }",ComputeVaryingValues:"void ComputeVaryingValues() { worldPosition = vGet3x3WorldMatrix() * vGetAttribPosition(); }"},globalCode_FS:["vec4 commonFinalColor;"].join("\n"),overridenFunctions_FS:{ComputeCommonValues:["void ComputeCommonValues()","{","float rad = Radius;","float dist = sqrt(worldPosition.x*worldPosition.x + worldPosition.y*worldPosition.y);","if  (dist > Radius)","{","dist = Radius;","}","float alpha = (Radius-dist)/Radius;","commonFinalColor = vec4(0.5, 0.5, 0.5, alpha);","}"].join("\n"),ComputeOpacity:["float ComputeOpacity()","{","return commonFinalColor.a;","}"].join("\n"),ProcessFinalColor:["void ProcessFinalColor(inout vec4 finalColor)","{","finalColor = commonFinalColor;","}"].join("\n")}}}});return UWA.namespace("DS/CATCreaDesWebUIServices/CATCrDShaders",n)}),define("DS/CATCreaDesWebUIServices/CATCrDCircle",["UWA/Core","UWA/Event","DS/Core/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t,n,r,i){"use strict";var o=e.Class.extend({init:function(){return this._Center=new i.Vector3(0,0,0),this._FirstAxis=new i.Vector3(1,0,0),this._SecondAxis=new i.Vector3(0,1,0),this._FirstLimit=new i.Vector3(1,0,0),this._SecondLimit=new i.Vector3(0,1,0),this._Closed=!0,this._Radius=10,this},setCenter:function(e){return this._Center.copy(e),this},setFirstAxis:function(e){return this._FirstAxis.copy(e),this},setSecondAxis:function(e){return this._SecondAxis.copy(e),this},setRadius:function(e){return this._Radius=e,this},getIsClosed:function(){return this._Closed},calculateFromPoints:function(e,t){var n=new i.Vector3(0,0,0),r=new i.Vector3(1,0,0),o=new i.Vector3(0,1,0),a=-1,s=(Math.pow(10,-15),Math.pow(10,-30)),c=e.length;if(3<=c){var l,u,d,p,m=new Array(new i.Vector3(0,0,0),new i.Vector3(0,0,0),new i.Vector3(0,0,0),new i.Vector3(0,0,0)),h=new Array(!1,!1,!1,!1),f=0,V=0,y=0,w=4;for(p=0;p<w;p++){switch(p){case 0:f=0,V=Math.floor(1*c/5),y=Math.floor(2*c/5);break;case 1:f=Math.floor(1*c/5),V=Math.floor(2*c/5),y=Math.floor(3*c/5);break;case 2:f=Math.floor(2*c/5),V=Math.floor(3*c/5),y=Math.floor(4*c/5);break;case 3:f=Math.floor(3*c/5),V=Math.floor(4*c/5),y=c-1}l=e[f],u=e[V],d=e[y];var v=(new i.Vector3).subVectors(u,l),x=(new i.Vector3).subVectors(d,u),C=(new i.Vector3).addVectors(l,u).multiplyScalar(.5),P=(new i.Vector3).addVectors(u,d).multiplyScalar(.5),g=(new i.Vector3).crossVectors(v,x),A=(new i.Vector3).crossVectors(g,v),S=(new i.Vector3).crossVectors(g,x),T=!1,b=i.Math.degToRad(10),D=2*Math.PI-b,U=A.angleTo(S);(U<b||U>D)&&(T=!0),h[p]=!T,v.addVectors(C,A),x.addVectors(P,S);var M=(new i.Line3).set(C,v),F=(new i.Line3).set(P,x),I=!1,O=-1,_=M.distanceSq(),E=F.distanceSq();if(_>s&&E>s){var z=M.delta().normalize(),L=F.delta().normalize(),B=(new i.Vector3).copy(C),N=(new i.Vector3).copy(P),W=Math.sqrt(_),R=Math.sqrt(E),G=L.dot(z),k=G*G-1;if(Math.abs(k)>s){var X=(new i.Vector3).subVectors(B,N),j=X.dot(L),q=X.dot(z),J=(q*G-j)/k,H=(q-j*G)/k,Y=(new i.Vector3).copy(L).multiplyScalar(J).add(N),K=(new i.Vector3).copy(z).multiplyScalar(H).add(B);Y.distanceToSquared(K)<1&&(J/R,O=H/W,I=!0)}}1==I?m[p]=M.at(O):m[p].addVectors(C,P).multiplyScalar(.5)}var Q=0;for(p=0;p<w;p++)1==h[p]&&(n.add(m[p]),Q+=1);0!=Q&&n.multiplyScalar(1/Q),l=e[0];var Z=(new i.Vector3).subVectors(n,l);for(a=Z.length(),w=6,p=1;p<w;p++)u=e[Math.floor(c*p/w)],Z.subVectors(n,u),a+=Z.length();d=e[c-1],Z.subVectors(n,d),a+=Z.length(),a/=w-1+2,this._Center.copy(n),this._Radius=a}if(-1!=a){var $=(new i.Vector3).copy(t.normal).normalize();this._FirstAxis.crossVectors($,r),this._FirstAxis.normalize(),s>this._FirstAxis.length()&&(this._FirstAxis.crossVectors($,o),this._FirstAxis.normalize()),this._SecondAxis.crossVectors($,this._FirstAxis),this._SecondAxis.normalize();var ee=!1,te=(new i.Vector3).copy(e[0]),ne=(new i.Vector3).copy(e[c-1]),re=(new i.Vector3).subVectors(te,this._Center).normalize(),ie=(new i.Vector3).subVectors(ne,this._Center).normalize();if(te.copy(re).multiplyScalar(this._Radius).add(this._Center),ne.copy(ie).multiplyScalar(this._Radius).add(this._Center),Math.PI/20>re.angleTo(ie)&&(ee=!0),0==ee){var oe=(new i.Vector3).subVectors(e[Math.floor(c/2)],this._Center).normalize(),ae=(new i.Vector3).copy(re).cross(oe),se=(new i.Vector3).copy(oe).cross(ie),ce=(new i.Vector3).copy(re).cross(ie),le=ae.dot($),ue=se.dot($),de=ce.dot($);if(1==(0>le&&0>ue||0>le&&0<ue&&0<de||0<le&&0>ue&&0<de)){var pe=(new i.Vector3).copy(te);te.copy(ne),ne.copy(pe)}}else ne.copy(te);this._FirstLimit.copy(te),this._SecondLimit.copy(ne)}return this},evaluate:function(e){var t=Math.sin(e),n=Math.cos(e),r=(new i.Vector3).copy(this._FirstAxis),o=(new i.Vector3).copy(this._SecondAxis),a=(new i.Vector3).copy(this._Center);return a.add(r.multiplyScalar(this._Radius*n)),a.add(o.multiplyScalar(this._Radius*t)),a},getParam:function(e,t,n,r){var o=new Array(0,0,0),a=this.evaluate(n),s=this.evaluate(r),c=t,l=t*t,u=(new i.Vector3).subVectors(e,a),d=(new i.Vector3).subVectors(a,this._Center),p=d.dot(this._FirstAxis)*u.dot(this._SecondAxis)-d.dot(this._SecondAxis)*u.dot(this._FirstAxis),m=a.distanceTo(e),h=m<l&&p<=c;u.subVectors(e,s),d.subVectors(s,this._Center),p=d.dot(this._FirstAxis)*u.dot(this._SecondAxis)-d.dot(this._SecondAxis)*u.dot(this._FirstAxis);s.distanceTo(e);var f=m<l&&p<=c;if(h&&f)return o[0]=2,o[1]=n,o[2]=r,o;if(!h&&f)return o[0]=1,o[1]=r,o;if(h&&!f)return o[0]=2,o[1]=n,o;var V=2*Math.PI,y=(new i.Vector3).subVectors(e,this._Center),w=y.dot(this._FirstAxis),v=y.dot(this._SecondAxis),x=Math.pow(10,-12);if(Math.abs(w)<x*this._Radius&&Math.abs(v)<x*this._Radius)return o;for(var C=Math.atan2(v,w);C>n+V;)C-=V;for(;C<n;)C+=V;return C>=n&&C<=r&&(o[0]=0,o[1]=C,o[0]=1),o}});return e.namespace("DS/CATCreaDesWebUIServices/CATCrDCircle",o)}),define("DS/CATCreaDesWebUIServices/CATCrDStrokeInterpreter",["DS/Visualization/ThreeJS_DS"],function(e){"use strict";var t=UWA.Class.extend({init:function(){return this},GetResultShape:function(t){var n,r=-1,i=new e.Vector2(0,0),o=new e.Vector2(0,0),a=new e.Vector2(0,0),s=new e.Vector2(0,0),c=new e.Vector2(1,0),l=new e.Vector2(0,1),u=-1,d=-1,p=-1,m=-1,h=-1,f=-1,V=new Array(0,0,0,0,0,0),y=new e.Vector2(0,0),w=new e.Vector2(0,0),v=new e.Vector2(-1/0,-1/0),x=new e.Vector2(1/0,1/0),C=new e.Vector2(-1/0,-1/0),P=new e.Vector2(1/0,1/0),g=new e.Vector2(-1/0,-1/0),A=new e.Vector2(1/0,1/0),S=new e.Vector2(-1/0,-1/0),T=!1,b=1,D=1;for(b=0;b<t.length-1;b++){for(i.set(t[b].xPix,t[b].yPix),o.set(t[b+1].xPix-t[b].xPix,t[b+1].yPix-t[b].yPix),o.normalize(),a.set(-o.y,o.x),V[0]=c.dot(o),V[1]=l.dot(o),V[2]=c.dot(a),V[3]=l.dot(a),V[4]=s.x-(V[0]*i.x+V[2]*i.y),V[5]=s.y-(V[3]*i.x+V[4]*i.y),D=0;D<t.length;D++)y.setX(V[0]*t[D].xPix+V[1]*t[D].yPix+V[4]),y.setY(V[2]*t[D].xPix+V[3]*t[D].yPix+V[5]),0==D?(w.copy(y),v.copy(y)):(y.x<w.x?w.x=y.x:y.x>v.x&&(v.x=y.x),y.y<w.y?w.y=y.y:y.y>v.y&&(v.y=y.y));p=v.x-w.x,m=v.y-w.y,-1==u?(u=b,d=b,h=p,f=m,x.copy(w),C.copy(v),P.copy(w),g.copy(v)):(p<h&&(u=b,h=p,x.copy(w),C.copy(v)),m<f&&(d=b,f=m,P.copy(w),g.copy(v)))}if(-1!=u){var U=0;h<f?(U=u,A.x=x.y,A.y=x.x,S.x=C.y,S.y=C.x):(U=d,A.copy(P),S.copy(g)),p=S.x-A.x,T=(m=S.y-A.y)>p;var M=new e.Vector2(t[U].xPix,t[U].yPix),F=new e.Vector2(1,0),I=new e.Vector2(0,1);for(F.set(t[U+1].xPix-t[U].xPix,t[U+1].yPix-t[U].yPix),F.normalize(),I.set(-F.y,F.x),V[0]=c.dot(F),V[1]=l.dot(F),V[2]=c.dot(I),V[3]=l.dot(I),V[4]=s.x-(V[0]*M.x+V[2]*M.y),V[5]=s.y-(V[3]*M.x+V[4]*M.y),n=new Array,D=0;D<t.length;D++)y.setX(V[0]*t[D].xPix+V[1]*t[D].yPix+V[4]),y.setY(V[2]*t[D].xPix+V[3]*t[D].yPix+V[5]),1==T&&y.set(y.y,y.x),n.push((new e.Vector2).copy(y))}if(!1!==UWA.typeOf(n)){var O=S.x-A.x,_=S.y-A.y,E=O;0!=_&&(E=O/_);var z=E>1.5?.05*O:.1*O,L=.1*_,B=!1;p=n[n.length-1].x-n[0].x,m=n[n.length-1].y-n[0].y,Math.abs(p)<=4*z&&Math.abs(m)<=4*L&&(B=!0);var N=0;0==B&&(12>O&&12>_?N=11:1.5<E&&12>_&&(N=11));var W=0;1==B?(0,W=2):(W=2,N>0&&(N,W=1)),r=W}return r}});return UWA.namespace("DS/CATCreaDesWebUIServices/CATCrDStrokeInterpreter",t)}),define("DS/CATCreaDesWebUIServices/CATCrDGrid",["UWA/Core","DS/Mesh/MeshUtils","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/CATCreaDesWebUIServices/CATCrDShaders"].concat(window.dependencies),function(e,t,n,r,i,o){function a(){var a,s,c,l,u,d,p;this.onLoad=function(e){this.initSettings(e)},this.initSettings=function(e){s=new n.Vector3(0,0,1),l=100,u=new n.Vector3,c=new i,a=!1,c.setVisibility(!1),d=e.getRootNode(),p=e},this.setGroundGrid=function(e,t){this.setGrid(new n.Vector3(0,0,1),300,new n.Vector3(0,0,0))},this.setGrid=function(a,m,h){s=a.clone(),l=m,0!=e.typeOf(h)&&(u=h.clone()),d.remove(c),c=new i,function(){s.normalize();var e=new Array,i=new Array,a=new Array,p=new Array,m=0,h=0;for(m=0;m<40;m++)e.push(.05*m-1),e.push(-1),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(0),a.push(0),a.push(0),p.push(h),h++,e.push(.05*m-1),e.push(0),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(1),a.push(1),a.push(0),p.push(h),h++,e.push(.05*m-1),e.push(0),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(0),a.push(0),a.push(0),p.push(h),h++,e.push(.05*m-1),e.push(1),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(1),a.push(1),a.push(0),p.push(h),h++,e.push(-1),e.push(.05*m-1),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(0),a.push(0),a.push(0),p.push(h),h++,e.push(0),e.push(.05*m-1),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(1),a.push(1),a.push(0),p.push(h),h++,e.push(0),e.push(.05*m-1),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(0),a.push(0),a.push(0),p.push(h),h++,e.push(1),e.push(.05*m-1),e.push(0),i.push(s.x),i.push(s.y),i.push(s.z),a.push(1),a.push(1),a.push(0),p.push(h),h++;var f=(new o).getGroundShader();f.uniforms.Radius.value=l,material=new n.MeshBasicMaterial({force:!0}),material.activatePDSFX(),material.setPDSFXUniforms(f.uniforms),material.setPDSFXVaryings(f.varyings),material.setPDSFXGlobalShaderCode(f.globalCode_VS,f.globalCode_FS),material.setPDSFXOverridableFunctions(f.overridenFunctions_VS,f.overridenFunctions_FS),material.setPDSFXPolygonOffset("Frontward1"),material.blending=n.AdditiveAlphaBlending,material.transparent=!0,material.side=n.DoubleSide,material.depthWrite=!1,material.opacity=.1;var V=new n.Color(0),y=new t.PrimitiveGroup;y.fillAttr=new t.FillAttributes,y.lineAttr=new t.LineAttributes,y.pointAttr=new t.PointAttributes;var w=new t.Buffer;w.size=e.length,w.component=t.VertexComponentEnum.POSITION,w.format=t.DataTypeEnum.FLOAT,w.dimension=3,w.data=new Float32Array(e),y.addBuffer(0,w);var v=new t.Buffer;v.size=i.length,v.component=t.VertexComponentEnum.NORMAL,v.format=t.DataTypeEnum.FLOAT,v.dimension=3,v.data=new Float32Array(i),y.addBuffer(1,v);var x=new t.Buffer;x.size=a.length,x.component=t.VertexComponentEnum.TEX_COORD_0,x.format=t.DataTypeEnum.FLOAT,x.dimension=3,x.data=new Float32Array(a),y.addBuffer(2,x);var C=new t.Buffer;C.indexBuffer=!0,C.size=p.length,C.format=t.DataTypeEnum.UINT,C.dimension=1,C.data=new Uint16Array(p),y.addBuffer(3,C);var P=new t.Primitive;P.nbIndices=p.length,P.connectivity=t.ConnectivityTypeEnum.LINES,P.attr={fill:new t.FillAttributes(V),line:new t.LineAttributes(V),point:new t.PointAttributes(V,1)};var g=new t.VertexComponent;g.component=t.VertexComponentEnum.POSITION,g.nbVertices=e.length/3,g.nbValuesPerVertex=3,g.format=t.DataTypeEnum.FLOAT,g.cardinality=0,g.bufferId=0,g.indices=new t.IndexArray,g.indices.format=t.DataTypeEnum.UINT,g.indices.bufferId=3,g.indices.offset=0,P.addVertexComponent(g);var A=new t.VertexComponent;A.component=t.VertexComponentEnum.NORMAL,A.nbVertices=i.length/3,A.nbValuesPerVertex=3,A.format=t.DataTypeEnum.FLOAT,A.cardinality=0,A.bufferId=1,A.indices=new t.IndexArray,A.indices.format=t.DataTypeEnum.UINT,A.indices.bufferId=3,A.indices.offset=0,P.addVertexComponent(A);var S=new t.VertexComponent;S.component=t.VertexComponentEnum.TEX_COORD_0,S.nbVertices=a.length/3,S.nbValuesPerVertex=3,S.format=t.DataTypeEnum.FLOAT,S.cardinality=0,S.bufferId=2,S.indices=new t.IndexArray,S.indices.format=t.DataTypeEnum.UINT,S.indices.bufferId=3,S.indices.offset=0,P.addVertexComponent(S),y.addPrimitive(P);var T=r.createMeshNode(y,material);T.name="Grid",T.setPickable(t.NOPICKABLE),c.add(T);var b=(new n.Matrix4).makeScale(1e3,1e3,1);c.applyMatrix(b);var D=s.angleTo(new n.Vector3(0,0,1));if(Math.abs(D)>.001&&Math.abs(Math.PI-D)>.001){var U=s.cross(new n.Vector3(0,0,1)),M=new n.Matrix4;U.normalize(),M.makeRotationAxis(U,-D),c.applyMatrix(M)}c.getMatrix().setPosition(u),c._updateMatrix(),d.add(c)}(),this.setGridVisibility(!0),p.render()},this.setGridVisibility=function(e){a!=e&&(a=e,c.setVisibility(a),p.render())}}var s;return e.namespace("DS/CATCreaDesWebUIServices/CATCrDGrid",function(){return!1===e.typeOf(s)&&(s=new a),s})}),define("DS/CATCreaDesWebUIServices/CATCrDWebUIServices",["DS/Visualization/ThreeJS_DS","DS/Mesh/MeshUtils","DS/Visualization/SceneGraphFactory","DS/Visualization/Node3D","DS/CATCreaDesWebUIServices/CATCrDShaders","DS/CATCreaDesWebUIServices/CATCrDWebMathServices","DS/CATCreaDesWebUIServices/CATCrDSettings"],function(e,t,n,r,i,o,a){"use strict";var s=function(){};return s.getScreenPlane=function(t){var n=t.getViewpoints()[0],r=n.getTarget(),i=n.getCamera().position,o=new e.Vector3(r.x-i.x,r.y-i.y,r.z-i.z);return o.normalize(),new e.Plane(o,0)},s.get3DPosition=function(t,n,r){var i=new e.Vector3(n.x,n.y,1);(new e.Projector).unprojectVector(i,t.currentViewpoint.camera);var o=new e.Ray(t.currentViewpoint.camera.position,i.sub(t.currentViewpoint.camera.position).normalize());return i=o.intersectPlane(r)},s.updateCutByPlane=function(e,t,n,r){},s.convertPixelsLengthToMm=function(e,t,n){var r=e.fov,i=t.distanceTo(e.position),o=e.aspect,a=2*Math.tan(.5*r)*i,s=a*o,c=a/window.outerHeight*n,l=s/window.outerWidth*n;return Math.min(c,l)},s.getResolutionPixelsPerMm=function(){return 96*("undefined"==typeof window?0:+window.devicePixelRatio||(e=window.screen.deviceXDPI,t=window.screen.deviceYDPI,Math.sqrt(e*t)/96)||0)/25.4;var e,t},s.createPencilMaterial=function(t,n){var r=null,o=(new i).getPencilShader();o.uniforms.Color.value=t;var a=n;return a>1&&(a/=255),o.uniforms.Opacity.value=a,(r=new e.MeshBasicMaterial({force:!0})).activatePDSFX(),r.setPDSFXUniforms(o.uniforms),r.setPDSFXVaryings(o.varyings),r.setPDSFXGlobalShaderCode(o.globalCode_VS,o.globalCode_FS),r.setPDSFXOverridableFunctions(o.overridenFunctions_VS,o.overridenFunctions_FS),r.setPDSFXPolygonOffset("Frontward1"),r.blending=e.AdditiveAlphaBlending,r.transparent=!0,r.side=e.DoubleSide,r},s.createMaterial=function(e,t){return s.createPencilMaterial(e,t)},s.createPenMaterial=function(t,n,r,o){var a=(new i).getPenShader();a.uniforms.Color.value=t;var s=n;return s>1&&(s/=255),a.uniforms.Opacity.value=s,material=new e.MeshBasicMaterial({force:!0}),material.activatePDSFX(),material.setPDSFXUniforms(a.uniforms),material.setPDSFXVaryings(a.varyings),material.setPDSFXGlobalShaderCode(a.globalCode_VS,a.globalCode_FS),material.setPDSFXOverridableFunctions(a.overridenFunctions_VS,a.overridenFunctions_FS),material.setPDSFXPolygonOffset("Frontward1"),material.blending=e.AdditiveAlphaBlending,material.transparent=!0,material.side=e.DoubleSide,material},s.createPencilGP=function(r,i,a,s,c){if(r.length>1){var l=new Array,u=new Array,d=new Array,p=new Array,m=.5*a,h=o.computeLengthParameters(r),f=h[h.length-1]+0+0,V=0;f>1e-6&&(V=1/f);for(var y,w,v,x,C,P=[1,0],g=[0,1],A=0,S=i[0],T=new e.Vector3(0,0,0),b=new Array,D=new Array,U=0;U<r.length;U++){y=r[U],S=i[U],U<r.length-1?(w=r[U+1],(v=(new e.Vector3).subVectors(w,y)).normalize(),x=(new e.Vector3).addVectors(T,v),T=v):x=T,x.normalize(),C=(new e.Vector3).crossVectors(S,x),b[0]=(new e.Vector3).copy(C),b[1]=(new e.Vector3).copy(C),b[0].multiplyScalar(m),b[1].multiplyScalar(-1*m),D[0]=(new e.Vector3).addVectors(y,b[0]),D[1]=(new e.Vector3).addVectors(y,b[1]);for(var M=0;M<2;M++)l.push(D[M].x),l.push(D[M].y),l.push(D[M].z),u.push(S.x),u.push(S.y),u.push(S.z),d.push(h[U]*V),d.push(P[M]),d.push(0),A++;U>0&&(p.push(g[0]),p.push(A-1),p.push(A-2),p.push(g[0]),p.push(g[1]),p.push(A-1),g[0]=A-2,g[1]=A-1)}var F=new e.Color(65280),I=new t.PrimitiveGroup;I.fillAttr=new t.FillAttributes,I.lineAttr=new t.LineAttributes,I.pointAttr=new t.PointAttributes;var O=new t.Buffer;O.size=l.length,O.component=t.VertexComponentEnum.POSITION,O.format=t.DataTypeEnum.FLOAT,O.dimension=3,O.data=new Float32Array(l),I.addBuffer(0,O);var _=new t.Buffer;_.size=u.length,_.component=t.VertexComponentEnum.NORMAL,_.format=t.DataTypeEnum.FLOAT,_.dimension=3,_.data=new Float32Array(u),I.addBuffer(1,_);var E=new t.Buffer;E.size=d.length,E.component=t.VertexComponentEnum.TEX_COORD_0,E.format=t.DataTypeEnum.FLOAT,E.dimension=3,E.data=new Float32Array(d),I.addBuffer(2,E);var z=new t.Buffer;z.indexBuffer=!0,z.size=p.length,z.format=t.DataTypeEnum.UINT,z.dimension=1,z.data=new Uint16Array(p),I.addBuffer(3,z);var L=new t.Primitive;L.nbIndices=p.length,L.connectivity=t.ConnectivityTypeEnum.TRIANGLES,L.attr={fill:new t.FillAttributes(F),line:new t.LineAttributes(F),point:new t.PointAttributes(F,1)};var B=new t.VertexComponent;B.component=t.VertexComponentEnum.POSITION,B.nbVertices=l.length/3,B.nbValuesPerVertex=3,B.format=t.DataTypeEnum.FLOAT,B.cardinality=0,B.bufferId=0,B.indices=new t.IndexArray,B.indices.format=t.DataTypeEnum.UINT,B.indices.bufferId=3,B.indices.offset=0,L.addVertexComponent(B);var N=new t.VertexComponent;N.component=t.VertexComponentEnum.NORMAL,N.nbVertices=u.length/3,N.nbValuesPerVertex=3,N.format=t.DataTypeEnum.FLOAT,N.cardinality=0,N.bufferId=1,N.indices=new t.IndexArray,N.indices.format=t.DataTypeEnum.UINT,N.indices.bufferId=3,N.indices.offset=0,L.addVertexComponent(N);var W=new t.VertexComponent;W.component=t.VertexComponentEnum.TEX_COORD_0,W.nbVertices=d.length/3,W.nbValuesPerVertex=3,W.format=t.DataTypeEnum.FLOAT,W.cardinality=0,W.bufferId=2,W.indices=new t.IndexArray,W.indices.format=t.DataTypeEnum.UINT,W.indices.bufferId=3,W.indices.offset=0,L.addVertexComponent(W),I.addPrimitive(L),s.force=!0;var R=n.createMeshNode(I,s);if(!1!==UWA.typeOf(c)){var G=new Array;for(U=0;U<p.length;U++)G.push(new e.Vector3(l[3*p[U]],l[3*p[U]+1],l[3*p[U]+2]));var k=geomHelper.createLine({points:G,color:new e.Color(16711680),width:2});c.value=k}}return R},s.createPencilGPWithVariableThickness=function(r,i,a,s,c){if(r.length>1){var l=new Array,u=new Array,d=new Array,p=new Array,m=0,h=o.computeLengthParameters(r),f=h[h.length-1]+0+0,V=0;f>1e-6&&(V=1/f);for(var y,w,v,x,C,P=[1,0],g=[0,1],A=0,S=i[0],T=new e.Vector3(0,0,0),b=new Array,D=new Array,U=0;U<r.length;U++){y=r[U],S=i[U],m=.5*a[U],U<r.length-1?(w=r[U+1],(v=(new e.Vector3).subVectors(w,y)).normalize(),x=(new e.Vector3).addVectors(T,v),T=v):x=T,x.normalize(),C=(new e.Vector3).crossVectors(S,x),b[0]=(new e.Vector3).copy(C),b[1]=(new e.Vector3).copy(C),b[0].multiplyScalar(m),b[1].multiplyScalar(-1*m),D[0]=(new e.Vector3).addVectors(y,b[0]),D[1]=(new e.Vector3).addVectors(y,b[1]);for(var M=0;M<2;M++)l.push(D[M].x),l.push(D[M].y),l.push(D[M].z),u.push(S.x),u.push(S.y),u.push(S.z),d.push(h[U]*V),d.push(P[M]),d.push(0),A++;U>0&&(p.push(g[0]),p.push(A-1),p.push(A-2),p.push(g[0]),p.push(g[1]),p.push(A-1),g[0]=A-2,g[1]=A-1)}var F=new e.Color(65280),I=new t.PrimitiveGroup;I.fillAttr=new t.FillAttributes,I.lineAttr=new t.LineAttributes,I.pointAttr=new t.PointAttributes;var O=new t.Buffer;O.size=l.length,O.component=t.VertexComponentEnum.POSITION,O.format=t.DataTypeEnum.FLOAT,O.dimension=3,O.data=new Float32Array(l),I.addBuffer(0,O);var _=new t.Buffer;_.size=u.length,_.component=t.VertexComponentEnum.NORMAL,_.format=t.DataTypeEnum.FLOAT,_.dimension=3,_.data=new Float32Array(u),I.addBuffer(1,_);var E=new t.Buffer;E.size=d.length,E.component=t.VertexComponentEnum.TEX_COORD_0,E.format=t.DataTypeEnum.FLOAT,E.dimension=3,E.data=new Float32Array(d),I.addBuffer(2,E);var z=new t.Buffer;z.indexBuffer=!0,z.size=p.length,z.format=t.DataTypeEnum.UINT,z.dimension=1,z.data=new Uint16Array(p),I.addBuffer(3,z);var L=new t.Primitive;L.nbIndices=p.length,L.connectivity=t.ConnectivityTypeEnum.TRIANGLES,L.attr={fill:new t.FillAttributes(F),line:new t.LineAttributes(F),point:new t.PointAttributes(F,1)};var B=new t.VertexComponent;B.component=t.VertexComponentEnum.POSITION,B.nbVertices=l.length/3,B.nbValuesPerVertex=3,B.format=t.DataTypeEnum.FLOAT,B.cardinality=0,B.bufferId=0,B.indices=new t.IndexArray,B.indices.format=t.DataTypeEnum.UINT,B.indices.bufferId=3,B.indices.offset=0,L.addVertexComponent(B);var N=new t.VertexComponent;N.component=t.VertexComponentEnum.NORMAL,N.nbVertices=u.length/3,N.nbValuesPerVertex=3,N.format=t.DataTypeEnum.FLOAT,N.cardinality=0,N.bufferId=1,N.indices=new t.IndexArray,N.indices.format=t.DataTypeEnum.UINT,N.indices.bufferId=3,N.indices.offset=0,L.addVertexComponent(N);var W=new t.VertexComponent;W.component=t.VertexComponentEnum.TEX_COORD_0,W.nbVertices=d.length/3,W.nbValuesPerVertex=3,W.format=t.DataTypeEnum.FLOAT,W.cardinality=0,W.bufferId=2,W.indices=new t.IndexArray,W.indices.format=t.DataTypeEnum.UINT,W.indices.bufferId=3,W.indices.offset=0,L.addVertexComponent(W),I.addPrimitive(L),s.force=!0;var R=n.createMeshNode(I,s);if(!1!==UWA.typeOf(c)){var G=new Array;for(U=0;U<p.length;U++)G.push(new e.Vector3(l[3*p[U]],l[3*p[U]+1],l[3*p[U]+2]));var k=geomHelper.createLine({points:G,color:new e.Color(16711680),width:2});c.value=k}}return R},s.createCustomGP=function(r,i,o,a,s,c){for(var l=new Array,u=0;u<r.length;u++)l.push(o[c*u]),l.push(o[c*u+1]),l.push(0);var d=new e.Color(65280),p=new t.PrimitiveGroup;p.fillAttr=new t.FillAttributes,p.lineAttr=new t.LineAttributes,p.pointAttr=new t.PointAttributes;var m=new t.Buffer;m.size=r.length,m.component=t.VertexComponentEnum.POSITION,m.format=t.DataTypeEnum.FLOAT,m.dimension=3,m.data=new Float32Array(r),p.addBuffer(0,m);var h=new t.Buffer;h.size=i.length,h.component=t.VertexComponentEnum.NORMAL,h.format=t.DataTypeEnum.FLOAT,h.dimension=3,h.data=new Float32Array(i),p.addBuffer(1,h);var f=new t.Buffer;f.size=l.length,f.component=t.VertexComponentEnum.TEX_COORD_0,f.format=t.DataTypeEnum.FLOAT,f.dimension=3,f.data=new Float32Array(l),p.addBuffer(2,f);var V=new t.Buffer;V.indexBuffer=!0,V.size=a.length,V.format=t.DataTypeEnum.UINT,V.dimension=1,V.data=new Uint16Array(a),p.addBuffer(3,V);var y=new t.Primitive;y.nbIndices=a.length,y.connectivity=t.ConnectivityTypeEnum.TRIANGLES,y.attr={fill:new t.FillAttributes(d),line:new t.LineAttributes(d),point:new t.PointAttributes(d,1)};var w=new t.VertexComponent;w.component=t.VertexComponentEnum.POSITION,w.nbVertices=r.length/3,w.nbValuesPerVertex=3,w.format=t.DataTypeEnum.FLOAT,w.cardinality=0,w.bufferId=0,w.indices=new t.IndexArray,w.indices.format=t.DataTypeEnum.UINT,w.indices.bufferId=3,w.indices.offset=0,y.addVertexComponent(w);var v=new t.VertexComponent;v.component=t.VertexComponentEnum.NORMAL,v.nbVertices=i.length/3,v.nbValuesPerVertex=3,v.format=t.DataTypeEnum.FLOAT,v.cardinality=0,v.bufferId=1,v.indices=new t.IndexArray,v.indices.format=t.DataTypeEnum.UINT,v.indices.bufferId=3,v.indices.offset=0,y.addVertexComponent(v);var x=new t.VertexComponent;return x.component=t.VertexComponentEnum.TEX_COORD_0,x.nbVertices=l.length/3,x.nbValuesPerVertex=3,x.format=t.DataTypeEnum.FLOAT,x.cardinality=0,x.bufferId=2,x.indices=new t.IndexArray,x.indices.format=t.DataTypeEnum.UINT,x.indices.bufferId=3,x.indices.offset=0,y.addVertexComponent(x),p.addPrimitive(y),s.force=!0,n.createMeshNode(p,s)},s.createImageGP=function(t,i,o,c){var l=new e.ImageUtils.loadTexture(t,e.UVMapping),u=(new a).getSettingsDrawingPlane(),d=new e.Vector3(1,0,0),p=new e.Vector3(0,1,0),m=new e.Vector3(0,0,1),h=u.normal;h.normalize();var f=c.currentViewpoint.getCameraTarget(),V=c.currentViewpoint.getCamera().position,y=new e.Vector3(f.x-V.x,f.y-V.y,f.z-V.z),w=c.currentViewpoint.getCamera().up;(new e.Vector3).crossVectors(y,w),y.normalize(),h.dot(y);var v=new e.Matrix4,x=new e.Matrix4,C=new e.Matrix4,P=m.angleTo(h),g=new e.Vector3;g.crossVectors(m,h),g.normalize(),h*g>0&&(P=2*Math.PI-P),P>.5*Math.PI?P-=Math.PI:P<.5*-Math.PI&&(P+=Math.PI),v.makeRotationAxis(g,P),x.makeRotationAxis(m,Math.PI),C.multiplyMatrices(v,x);var A=d.applyMatrix4(C),S=p.applyMatrix4(C),T=s.get3DPosition(c,i,u),b=l.image.width/l.image.height,D=l.image.height,U=l.image.width,M=c.currentViewpoint.camera,F=s.convertPixelsLengthToMm(M,T,Math.min(.25*window.innerHeight,.25*window.innerWidth));l.image.width>l.image.height?D=(U=F)/b:U=b*(D=F),T.sub(A.multiplyScalar(.5*U)),T.sub(S.multiplyScalar(.5*D));var I=n.createRectangleNode({width:_planeSize,height:_planeSize,fill:!0,color:16711680});I.name="image support";var O=new r;O.add(I),O.matrix.multiply(C),O.matrix.setPosition(T),O._updateMatrix(),O.material=new e.MeshBasicMaterial({map:l}),O.material.line=new e.LineBasicMaterial({color:0,linewidth:1,opacity:1}),O.material.side=e.DoubleSide,O.material.depthWrite=!1,O.material.transparent=!0,O.material.force=!0,o.add(O),c.render()},s.createImageFromDataGP=function(t,i,o,a){var s=new e.DataTexture(t,i,o,e.RGBAFormat);s.needsUpdate=!0;var c=new e.Vector3(1,0,0),l=new e.Vector3(0,1,0),u=new e.Vector3(0,0,1),d=new e.Vector3(a[0],a[1],a[2]),p=new e.Vector3(a[3],a[4],a[5]),m=new e.Vector3(a[6],a[7],a[8]),h=(new e.Vector3).subVectors(p,d),f=(new e.Vector3).subVectors(m,d),V=(new e.Vector3).crossVectors(h,f);V.normalize();var y=new e.Matrix4,w=new e.Matrix4,v=new e.Matrix4,x=u.angleTo(V),C=new e.Vector3;C.crossVectors(u,V),C.normalize(),V*C>0&&(x=2*Math.PI-x),x>.5*Math.PI?x-=Math.PI:x<.5*-Math.PI&&(x+=Math.PI),y.makeRotationAxis(C,x),w.makeRotationAxis(u,Math.PI),v.multiplyMatrices(y,w);c.applyMatrix4(v),l.applyMatrix4(v);var P=n.createRectangleNode({width:h.length(),height:f.length(),fill:!0,color:16711680});P.name="image support";var g=new r;return g.add(P),g.matrix.multiply(v),g.matrix.setPosition(d),g._updateMatrix(),g.material=new e.MeshBasicMaterial({map:s}),g.material.line=new e.LineBasicMaterial({color:0,linewidth:1,opacity:1}),g.material.side=e.DoubleSide,g.material.depthWrite=!1,g.material.transparent=!0,g.material.force=!0,g},UWA.namespace("DS/CATCreaDesWebUIServices/CATCrDWebUIServices",s)});