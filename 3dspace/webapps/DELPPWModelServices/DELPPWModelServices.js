define("DS/DELPPWModelServices/ModelUtils",["UWA/Core","UWA/Class","UWA/Date","UWA/Promise","DS/CfgBaseUX/scripts/CfgUtility","DS/DELPPWNavigationServices/SwitchDBModeManager"],function(e,t,n,i,o,s){"use strict";var r=t.singleton({name:"ModelUtils",_widgetTrigram:"NOT_DEFINED",init:function(t){var n="uwa";e.is(widget.environment)&&e.is(widget.environment.name)&&(n=widget.environment.name),"uwa"===n?this.setStandAlone(!0):this.setStandAlone(!1),this._parent(t)},getWidgetTrigram:function(){return r._widgetTrigram},setWidgetTrigram:function(e){r._widgetTrigram=e},getNavigateOnDatabasePreference:function(){var e=!1;return"Database"===widget.getValue("navigateOnIndex")&&(e=!0),e},getNavigateOnDatabase:function(){var e=!1;return!0===s.isDbMode()&&(e=!0),e},getNavigateOnIndex:function(){var e=!1;return"Index"===widget.getValue("navigateOnIndex")&&!0!==s.isDbMode()&&(e=!0),e},getNavigateOnIndexedDB:function(){return widget.getBool("navigateOnIndexedDB")},isNavigateOnDemand:function(){var e=!1;return"IndexRelationsOnDemand"===widget.getValue("navigateOnIndex")&&!0!==s.isDbMode()&&(e=!0),e},getOneDelmiaAggregationMode:function(){return widget.getBool("oneDelmiaAggregationMode")},getPrefSeparator:function(){return widget.getValue("separator")},getPrefExpandLevel:function(){return widget.getBool("fetchAllLevel")?-1:2},getCVServletLabel:function(){return this.getWidgetTrigram()+"-"+(new n).toISOString()},getTimeoutPreference:function(){var e=widget.getInt("timeout");return 1e3*(0!==e?e:600)},isStandAlone:function(){return r._standalone},setStandAlone:function(e){r._standalone=e},getExecuteByBlockPromise:function(t){var n=t||{},o=e.is(n.callback,"function")?n.callback:function(){},s=e.is(n.context)?n.context:null,r=e.is(n.globalArray,"array")?n.globalArray:[],a=e.is(n.blockSize,"number")&&Math.abs(Math.floor(n.blockSize))>0?Math.abs(Math.floor(n.blockSize)):500,c=e.is(n.delay,"number")?Math.abs(Math.floor(n.delay)):5,l=Math.floor(r.length/a)+1,u=null,d=0,f=function(e){return function(e,t){return new i(function(n,i){var r=function(){n(t+1)};e.length>0?setTimeout(function(){o.call(s,e,r,i)},c):n(t+1)})}(r.slice(e*a,(e+1)*a),e)};for(d=0;d<l;d++)u=e.is(u)?u.then(f):f(0);return u},checkCFGLicenseAvailablePromise:function(){return new i(function(t,n){var i=!1;e.is(o.rolesAvailable)?o.rolesAvailable(function(n){e.is(n.isCFGRoleAvail,"boolean")&&(i=n.isCFGRoleAvail),t(i)}):n('"CfgUtility.rolesAvailable" method not available')})},isLicenseAvailable:function(t){return e.is(r._userGrantedRoles,"array")&&r._userGrantedRoles.indexOf(t)>=0},isMFNLicenseAvailable:function(){return this.isLicenseAvailable("MFN")||this.isLicenseAvailable("InternalDS")},isMGALicenseAvailable:function(){return this.isLicenseAvailable("MGA")||this.isLicenseAvailable("InternalDS")},isRMELicenseAvailable:function(){return this.isLicenseAvailable("RME")||this.isLicenseAvailable("InternalDS")}});return r}),define("DS/DELPPWModelServices/BehaviorUtil",["UWA/Core","UWA/Class","DS/DELPPWLoggerModel/LoggerUtils","DS/PlatformAPI/PlatformAPI"],function(e,t,n,i){"use strict";var o=t.singleton({name:"BehaviorUtil",isFacet:!1,_isNLSTestEnabled:null,_isMdlAccessTestEnabled:null,init:function(e){e=e||{},this._parent(e)},_getVariable:function(t,o,s){var r=!!e.is(s)&&s,a=e.is(o,"string")&&o.length>0?o:"boolean",c=e.is(t,"string")&&t.length>0?t:"app.MFN.default",l=i.getApplicationConfiguration(c),u=localStorage.getItem(c),d=!1;if(e.is(l,"string")?(r=l,d=!0,n.debug(this.name,"From server ("+c+", "+a+"): "+r)):e.is(u,"string")&&(r=u,d=!0,n.debug(this.name,"From client ("+c+", "+a+"): "+r)),d)switch(a){case"boolean":r="true"===r}return r},isNewDragNDrop:function(){return!o._getVariable("app.MFN.isOldDragNDrop")},shouldLoadRootOnly:function(){return o._getVariable("app.feature.loadRootOnly")},isCloud:function(){var e=!1;return e=!o.isFacet&&o._getVariable("app.build.isCloud"),e},useRootStorage:function(){return o._getVariable("app.feature.useRootStorage")},getDefaultTimeout:function(){return o._getVariable("app.feature.defaultTimeout","string")},isSwipeableMenuPrefDisplayed:function(){return o._getVariable("app.MFNMGA.isSwipeableMenuPrefDisplayed")},isNavigateOnIndexedDBPrefDisplayed:function(){return o._getVariable("app.MFNMGA.isNavigateOnIndexedDBPrefDisplayed")},isDialogDisplayedAtDDinCaseOfMove:function(){return o._getVariable("app.MFNMGA.isDialogDisplayedAtDDinCaseOfMove")},isViewPersistanceOn:function(){return o._getVariable("app.feature.isViewPersistanceOn")},isSuppressHideShow3DColumn:function(){return o._getVariable("app.feature.suppressHideShow3DColumn")},setIsFacet:function(e){o.isFacet=e},getIsFacet:function(){return o.isFacet},isExpandFetchFetchEnabled:function(){return o._getVariable("app.MFNMGA.enableEFF","boolean",!0)},isNLSTestEnabled:function(){var t;return e.is(o._isNLSTestEnabled,"boolean")?t=o._isNLSTestEnabled:(t=o._getVariable("app.MFNMGA.TestNLS","boolean"),o._isNLSTestEnabled=t),t},isMdlAccessTestEnabled:function(){return e.is(o._isMdlAccessTestEnabled,"boolean")||(o._isMdlAccessTestEnabled=o._getVariable("app.MFNMGA.MdlAccessTest","boolean")),o._isMdlAccessTestEnabled},getNavigateSize:function(){return o._getVariable("app.feature.private.navigateSplitSize","string")},getNavigateFetchSize:function(){return o._getVariable("app.feature.private.navigateFetchSplitSize","string")},isInsertButtonInInsertCmdDisplayed:function(){return o._getVariable("app.feature.private.insertButtonInInsertCmdDisplayed")},shouldLoadRelationsOnDemand:function(){return o._getVariable("app.MGA.relationsOnDemand")},shouldLoadOOTBProcedures:function(){return o._getVariable("app.loadOOTBProcedures")},displayDocumentManagementCmds:function(){return o._getVariable("app.feature.displayDocumentManagementCmds","boolean")},isDescHighlightFromEBOMEnabled:function(){return o._getVariable("app.MFN.descHighlightFromEBOM","boolean")},isChangeRequiredSyncronizationEnabled:function(){return o._getVariable("app.MFN.changeRequiredSyncronization","boolean")},isResultingProductSyncronizationEnabled:function(){return o._getVariable("app.MFN.ResultingProductSyncronization","boolean")},isAutomaticDragNDropEnabled:function(){return!o._getVariable("app.MFN.isAutomaticDragNDisabled","boolean")},isCacheFullyOptimized:function(){return o._getVariable("app.MFNMGA.isCacheFullyOptimized","boolean")},isAddAndRemoveActivated:function(){return o._getVariable("app.MFNMGA.isAddAndRemoveActivated","boolean",!1)},isReleaseSyncXENEnabled:function(){return o._getVariable("app.XEN.isReleaseSyncXENEnabled","boolean")}});return o}),define("DS/DELPPWModelServices/MfgProcessBIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],function(e,t,n,i){"use strict";return t.singleton({name:"MfgProcessBIUtils",init:function(e){this._parent(e),this.biModelCollection=new n,this._systemArray=[],this._itemArray=[],this._itemConfigFilter={},this._sysConfigFilter={}},getMfgItemAssignmentStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"ItemAssignmentStatus"})),t},getSystemUpdateStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"SystemUpdateStatus"})),t},getBrokenMfgProcessStatus:function(t,n){var i;(t=t||{}).silent=!0,this._fetchStatus(t,function(t){e.is(t)&&(i=t.where({type:"SystemUpdateStatus",status:"DirectlyImpacting"}),n(i))})},_fetchStatus:function(e,t){var n=this;new Promise(function(t){n.isBIComputed()?t():n.fetchBIComputation(e,function(){t()})}).then(function(){t(n.biModelCollection)},function(){t([])})},fetchBIComputation:function(t,n){var o,s,r=this,a=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)};t=t||{},s=!e.is(t.silent,"boolean")||t.silent,r._systemArray=e.is(t.rootSystems)?t.rootSystems:r._systemArray,r._itemArray=e.is(t.rootItems)?t.rootItems:r._itemArray,r._itemConfigFilter=e.is(t.itemConfigFilter)?t.itemConfigFilter:r._itemConfigFilter,r._sysConfigFilter=e.is(t.sysConfigFilter)?t.sysConfigFilter:r._sysConfigFilter,r._systemArray.length<=0||r._itemArray.length<=0?a():(o={expandLevel:-1,ordered:!0,systemIds:r._systemArray,sysConfigFilter:r._sysConfigFilter,itemIds:r._itemArray,itemConfigFilter:r._itemConfigFilter},i.webServiceRequest({url:"dsmfg/private/V0/invoke/MfgProcess/BI",method:"POST",onComplete:function(e){r._addToBIModelCollection(e,{silent:s}),n instanceof Function&&n()},onFailure:a,onTimeout:a,data:e.Json.encode(o),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}}))},_addToBIModelCollection:function(e,t){var n,i,o,s;for(n in e)if(e.hasOwnProperty(n))for(o in i=e[n])i.hasOwnProperty(o)&&((s=i[o]).id=o,s.type=n,this.biModelCollection.add(s,t))},isBIComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIComputed()&&this.biModelCollection.reset()},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()}})}),define("DS/DELPPWModelServices/Navigation/NavigateOnLocalStore",["UWA/Core","DS/DELPPWModelServices/Navigation/NavigationBase","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWIRPCModel/Model/ConnectionModel","DS/DELPPWIRPCModel/Model/InstanceModel"],function(e,t,n,i,o){"use strict";return t.extend({init:function(e){this._parent(e)},getDescendants:function(t,s){var r,a,c,l=[t],u=[t.PID];c=function(){var t,n,i,o,r,a,c=0;u.forEach(function(l){t=self.references.get(l),e.is(t)&&(n=[],i=self.connections.where({to:t.id}),o=self.connections.where({from:t.id}),i.forEach(function(e){n.push({modelID:e.get("from"),connectionID:e.id,connectionTypeName:e.get("type")})}),o.forEach(function(e){n.push({modelID:e.get("to"),connectionID:e.id,connectionTypeName:e.get("type")})}),t.setDisplayModel({connectionModelInfo:n},{silent:!0}),a=function(){++c===u.length&&e.is(s.callback,"function")&&s.callback()},r=function(t){var n,i,o=[];t.forEach(function(t){var i=e.Json.decode(t);n=i.irpcID,o.push(i.docID)}),i=self.references.get(n),self._addDocuments(o,i,a)},self.IndexedDBUtils.where(self.IndexedDBUtils.documentsConnectionsStore,"irpcID",t.get("PID"),r,a))})},r=function(t){var i,r,d,f,g=[],p=0,m=function(){l=l.filter(function(e){return e.PID!==t.PID}),e.is(s.callback,"function")&&0===l.length?c():e.is(s.callback,"function")&&a(l[0])},h=function(t){p++,d=t.displayModel,delete t.displayModel,i=new n(t),u.push(i.id),self.references.get(i.get("PID"))||self.references.add(i),i.setDisplayModel(d,{silent:!0}),l.push(i._attributes),f=g[i.id],e.is(f)&&(r=f.model,self.instances.get(r.get("PID"))||self.instances.add(r,{silent:!0}),r.setDisplayModel(f.displayAttributes,{silent:!0})),p===Object.keys(g).length&&m()};self.IndexedDBUtils.where(self.IndexedDBUtils.instancesStore,"isAggregatedBy",t.PID,function(t){var n,i;t.forEach(function(t){var s=e.Json.decode(t);i=s.displayModel,delete s.displayModel,(n=new o(s)).setAdditionalInfo({queriedForConnections:!0}),g[n.get("isInstanceOf")]={model:n,displayAttributes:i},self.IndexedDBUtils.get(self.IndexedDBUtils.referencesStore,n.get("isInstanceOf"),h)})},m)},(a=function(t){var o,s,a,c=[],d=function(e){a=e.displayModel,delete e.displayModel,o=new n(e),u.push(o.id),self.references.get(o.get("PID"))||self.references.add(o),o.setDisplayModel(a,{silent:!0}),c.forEach(function(e){e.get("to")===o.id&&self.connections.add(e)}),l.push(o._attributes)};self.IndexedDBUtils.where(self.IndexedDBUtils.connectionsStore,"from",t.PID,function(n){n.forEach(function(t){s=new i(e.Json.decode(t)),c.push(s),self.IndexedDBUtils.get(self.IndexedDBUtils.referencesStore,s.get("to"),d)}),r(t)},function(){r(t)})})(t)}})}),define("DS/DELPPWModelServices/BIUtils",["UWA/Core","UWA/Class","DS/DELPPWIRPCModel/Collections/BIModelCollection","DS/DELPPWWebServices/WebserviceUtils"],function(e,t,n,i){"use strict";return t.singleton({name:"BIUtils",init:function(e){this._parent(e),this.biModelCollection=new n,this._mbomArray=[],this._embomArray=[],this._mbomConfigFilter={},this._ebomConfigFilter={},this._pseudoBIStatusIdSet=new Set},getBrokenMfgItemStatus:function(t,n){var i;(t=t||{}).silent=!0,this._fetchStatus(t,function(t){e.is(t)&&(Array.isArray(t)?(i=t.filter(t=>{const n=t._attributes;let i=!1;return e.is(n.type)&&"MfgItemsUpdateStatus"===n.type&&e.is(n.isBroken,"boolean")&&!0===n.isBroken&&(i=!0),i}),n(i)):(i=t.where({type:"MfgItemsUpdateStatus",isBroken:!0}),n(i)))})},getPhantomNodeItems:function(){return this.biModelCollection.filter(t=>{const n=t.get("status");let i=!1;return e.is(n,"string")&&(i=n.toLowerCase().includes("intermediate")),i})},getProductAssignmentStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"ProductsAssignmentStatus"})),t},getMfgItemUpdateStatus:function(){var t;return e.is(this.biModelCollection)&&(t=this.biModelCollection.where({type:"MfgItemsUpdateStatus"})),t},_fetchStatus:function(t,n){const i=this;let o=t||{};(function(t){const n=!!e.is(t.forceBIComputation,"boolean")&&t.forceBIComputation;return new Promise(e=>{n||!i.isBIComputed()?i.fetchBIComputation(t,function(t){e(t)}):e([])})})(o).then(function(t){const s=!!e.is(o.areRootsBroken,"boolean")&&o.areRootsBroken;n(s?t:i.biModelCollection)}).catch(function(){n([])})},fetchBIComputation:function(t,n){var o,s,r,a,c=this,l=function(n){e.is(t.onFailure,"function")&&t.onFailure.call(n)};t=t||{},s=!e.is(t.silent,"boolean")||t.silent,c._mbomArray=e.is(t.rootMBOM)?t.rootMBOM:c._mbomArray,c._embomArray=e.is(t.rootEBOM)?t.rootEBOM:c._embomArray,c._mbomConfigFilter=e.is(t.rootMBOMConfigFilter)?t.rootMBOMConfigFilter:{},c._ebomConfigFilter=e.is(t.rootEBOMConfigFilter)?t.rootEBOMConfigFilter:{},r=!!e.is(t.areRootsBroken,"boolean")&&t.areRootsBroken,a=e.is(t.prefix)?t.prefix:null,c._mbomArray.length<=0||c._embomArray.length<=0?l():(o={expandLevel:-1,ordered:!0,mbomIds:c._mbomArray,ebomIds:c._embomArray,engConfigFilter:c._ebomConfigFilter,mfgConfigFilter:c._mbomConfigFilter,areRootsBroken:r},i.webServiceRequest({url:"dsmfg/private/V0/invoke/BI",method:"POST",onComplete:function(e){const t=c._addToBIModelCollection(a,e,{silent:s,merge:!0});n instanceof Function&&n(t)},onFailure:l,onTimeout:l,data:e.Json.encode(o),headers:{Accept:"application/json",SecurityContext:i.getSecurityContext(),"Content-Type":"application/ds-json"}}))},_addToBIModelCollection:function(t,n,i){const o=e=>(...t)=>t.join(e),s=o(","),r=o("/"),a=t=>e.is(t.isRef)&&!0===t.isRef,c=(e,t=null)=>{const n=e.length;return n>0?e[n-1]:t},l=this;let u,d,f;e.is(t)&&({mfgAggByPath:u,mfgOccPath:d,mfgInstanceLID:f}=t);let g=[];for(const o of Object.keys(n))for(const[p,m]of Object.entries(n[o])){let n=p,h=e.clone(m);if(e.is(t)&&"MfgItemsUpdateStatus"===o){if(e.is(h.aggregatedByPath)){const e=c(d.split(","));h.aggregatedByPathTillRoot=s(u,r(e,f),h.aggregatedByPath)}a(h)||(n=s(d,p))}h.id=n,h.type=o,e.is(t)&&l._pseudoBIStatusIdSet.add(h.id),g.push(l.biModelCollection.add(h,i))}return g},isBIComputed:function(){return this.biModelCollection.size()>0},resetBIModelCollection:function(){!0===this.isBIComputed()&&(this.clearPseudoBIStatus(),this.biModelCollection.reset())},clearPseudoBIStatus:function(){if(this.isBIComputed()&&this._pseudoBIStatusIdSet.size>0){const e={silent:!0};for(const t of this._pseudoBIStatusIdSet)this.biModelCollection.remove(t,e);this._pseudoBIStatusIdSet.clear()}},getProductStatus:function(e,t){if("ProductImplementLinkOcc"===t){if(0===e.length)return"NotAssigned";if(1===e.length)return"AssignedDirectly";if(1<e.length)return"AssignedMoreThanOnce"}else if("ProductImplementLink"===t){if(0===e.length)return"NotAssigned";if(1===e.length)return"AssociatedWithScope";if(1<e.length)return"AssignedMoreThanOnce"}},getProcessStatus:function(t,n){if(e.is(n)){if("ProductImplementLinkOcc"===t)return"ImplGood";if("ProductImplementLink"===t)return"ScopeGood"}return"NotApplicable"},setBIModelEvents:function(e){this.biModelCollection.addEvents(e)},removeBIModelEvents:function(){this.biModelCollection.removeEvents()},getBIModelCollection:function(){return this.biModelCollection},getBIModel:function(e){return this.biModelCollection.get(e)}})}),define("DS/DELPPWModelServices/DocumentObjAttributesUtils",["UWA/Core","UWA/Class"],function(e,t){"use strict";var n=t.singleton({name:"DocumentObjAttributesUtils",_logger:null,init:function(e){if(!(e=e||{}).webServiceUtils||!e.logger)throw new Error("webServiceUtils or logger options not defined");this._webServiceUtils=e.webServiceUtils,this._logger=e.logger,this._iUIConfigDocValuesURL="DELWebMfgAssetsDefUI/DELWebMfgAssetsDefUIDocumentDisplayAttributeConfig",this._readXMLConfiguration(),this.attrDisplayMap={}},_readXMLConfiguration:function(){n._webServiceUtils.getXMLValues(this._iUIConfigDocValuesURL,function(t){var i,o;if(e.is(t.DisplayAttributeDescriptionList))for(i=Array.isArray(t.DisplayAttributeDescriptionList.Document)?t.DisplayAttributeDescriptionList.Document:[t.DisplayAttributeDescriptionList.Document],o=0;o<i.length;o++)n.attrDisplayMap[i[o].coloumnName]=i[o].Attribute},function(e){n._logger.log(e.message)})},getDocumentAttributes:function(t,i){var o,s=n.attrDisplayMap[i],r=t[0].get("dataelements"),a="";if(e.is(s))for(Array.isArray(s)||(s=[s]),o=0;o<s.length;o++)e.is(r[s[o].name])&&""!==r[s[o].name]&&(a=a+r[s[o].name]+" ");else a=r.title;return a}});return n}),define("DS/DELPPWModelServices/Navigation/IndexedDBUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/ModelUtils","DS/DELPPWLoggerModel/LoggerUtils"],function(e,t,n,i){"use strict";var o=t.singleton({name:"IndexedDBUtils",referencesStore:"references",instancesStore:"instances",connectionsStore:"connections",documentsStore:"documents",documentsConnectionsStore:"documentsConnections",_db:null,_version:1,_storeNames:["references","instances","connections","documents","documentsConnections"],_keyPath:"pid",_columns:{references:["data"],instances:["isInstanceOf","isAggregatedBy","data"],connections:["from","to","data"],documents:["data"],documentsConnections:["docID","irpcID","data"]},init:function(t){var i,s;t=t||{},this._parent(t),e.is(o._db)||((i=indexedDB.open(n.getWidgetTrigram(),o._version)).onupgradeneeded=function(e){o._db=e.target.result,o._storeNames.forEach(function(e){s=o._db.createObjectStore(e,{keyPath:o._keyPath}),o._columns[e].forEach(function(e){s.createIndex(e,e,{unique:"data"===e})})})},i.onsuccess=function(e){o._db=e.target.result})},get:function(t,n,o,s){var r,a,c="indexedDB/get";r=i.printCurrentDateTime(c+" start - "),(a=this._db.transaction([t]).objectStore(t).get(n)).onsuccess=function(t){i.printDuration(r,c),e.is(t.target.result)?e.is(o)&&o(e.Json.decode(t.target.result.data)):e.is(s)&&s()},a.onerror=function(){i.printDuration(r,c),e.is(s)&&s()}},put:function(t,n,s,r){var a,c,l,u,d="indexedDB/put";a={pid:n,data:e.Json.encode(s)},c=e.is(s._attributes)?s._attributes:s,Object.prototype.hasOwnProperty.call(c,"isInstanceOf")?(a.isInstanceOf=c.isInstanceOf,Object.prototype.hasOwnProperty.call(c,"isAggregatedBy")&&(a.isAggregatedBy=c.isAggregatedBy)):Object.prototype.hasOwnProperty.call(c,"from")&&Object.prototype.hasOwnProperty.call(c,"to")?(a.from=c.from,a.to=c.to):Object.prototype.hasOwnProperty.call(c,"docID")&&Object.prototype.hasOwnProperty.call(c,"irpcID")&&(a.docID=c.docID,a.irpcID=c.irpcID),e.is(o._db)&&(u=i.printCurrentDateTime(d+" start - "),(l=o._db.transaction([t],"readwrite").objectStore(t).put(a)).onsuccess=function(){i.printDuration(u,d),e.is(r)&&r(s)},l.onerror=function(){i.printDuration(u,d)})},remove:function(t,n,s){var r,a,c="indexedDB/delete";o._db&&(r=i.printCurrentDateTime(c+" start - "),(a=o._db.transaction([t],"readwrite").objectStore(t).delete(n)).onsuccess=function(){i.printDuration(r,c),e.is(s,"function")&&s()},a.onerror=function(){i.printDuration(r,c)})},where:function(t,n,i,o,s){var r,a=this._db.transaction([t]).objectStore(t).index(n),c=[],l=!1;a.openCursor(IDBKeyRange.only(i)).onsuccess=function(t){var n=t.target.result;e.is(n)?(l=!0,c.push(t.target.result.value),n.continue()):l?e.is(o,"function")&&(r=c.map(function(e){return e.data}),o(r)):e.is(s,"function")&&s()}},getStoreName:function(e){var t="NONAME";return"DocumentConnectionModel"===e.name?t=o.documentsConnectionsStore:"Document"===e.get("type")?t=o.documentsStore:e.isReference()?t=o.referencesStore:e.isInstance()?t=o.instancesStore:e.isConnection()&&(t=o.connectionsStore),t},getModel:function(t,n,i){var s=o.getStoreName(t);e.is(s)?o.get(s,t.id,n,i):i()},storeModel:function(t,n){var i=o.getStoreName(t);e.is(t.get("attributesValue"))&&delete t._attributes.attributesValue,e.is(i)&&o.put(i,t.id,t,n)},removeModel:function(t,n){var i=o.getStoreName(t);e.is(i)&&o.remove(i,t.id,n)}});return o}),define("DS/DELPPWModelServices/CollectionUtils",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/DELPPWModelServices/ModelUtils","DS/DELPPWIRPCModel/Collections/ReferenceCollection","DS/DELPPWIRPCModel/Collections/InstanceCollection","DS/DELPPWIRPCModel/Collections/ConnectionCollection","DS/DELPPWDocumentModel/DocumentCollection","DS/DELPPWIRPCModel/Model/ReferenceModel","DS/DELPPWIRPCModel/Model/InstanceModel","DS/DELPPWWebServices/WebserviceUtils","DS/DELPPWLoggerModel/LoggerUtils","DS/PlatformAPI/PlatformAPI","DS/DELPPWModelServices/BehaviorUtil"],function(e,t,n,i,o,s,r,a,c,l,u,d,f,g){"use strict";var p=t.singleton({name:"CollectionUtils",pprTypes:{system:"SYSTEM",operation:"OPERATION",process:"PROCESS",resource:"RESOURCE",product:"PRODUCT",part:"PART"},ConnectionDir:{DIRECT:"direct",INVERSE:"inverse"},_init:function(t){this.references=new o,this.instances=new s,this.connections=new r,this.documents=new a,this.instances.referenceCollection=this.references,this.connections.referenceCollection=this.references,this.connections.instanceCollection=this.instances,e.is(t)&&e.is(t.useER,"boolean")&&this.useERObjects(t.useER)},init:function(e){e=e||{},this._parent(e),this._init(e)},reset:function(t){var n,i=t||{},o=!e.is(i.silent,"boolean")||i.silent;e.is(this.references)&&(n=this.references.reset({},{silent:o}),e.is(n)&&this.references.remove(n,{silent:o})),e.is(this.instances)&&(n=this.instances.reset({},{silent:o}),e.is(n)&&this.instances.remove(n,{silent:o})),e.is(this.connections)&&(n=this.connections.reset({},{silent:o}),e.is(n)&&this.connections.remove(n,{silent:o})),e.is(this.documents)&&(n=this.documents.reset({},{silent:o}),e.is(n)&&this.documents.remove(n,{silent:o}))},setReferenceCollectionEvents:function(e){this.references.addEvents(e)},setConnectionsCollectionEvents:function(e){this.connections.addEvents(e)},setInstanceCollectionEvents:function(e){this.instances.addEvents(e)},setDocumentCollectionEvents:function(e){this.documents.addEvents(e)},removeCollectionEvents:function(){this.references.removeEvents(),this.connections.removeEvents(),this.instances.removeEvents()},removeDocumentCollectionEvents:function(){this.documents.removeEvents()},updateModel:function(t,n){var i=this;(n=n||{}).onCompleteMsg=e.is(n.onCompleteMsg)?n.onCompleteMsg:"Updated Model succesfully",n.onFailureMsg=e.is(n.onFailureMsg)?n.onFailureMsg:"Updating Model failed",t.save(null,{proxy:"passport",headers:u.getHeaders(),data:e.Json.encode(n.data),onComplete:function(t,o){if(e.is(o.attributesValue)){let e=t.changedAttributes();Object.keys(t._attributes).forEach(function(e){!e.contains(".")||e in o.attributesValue||t.unset(e)}),t._changed=e}d.debug(i.name,n.onCompleteMsg+" : %s",JSON.stringify(t)),e.is(n.isFacet)&&n.isFacet&&f.publish("DS/PADUtils/PADCommandProxy/refresh",{data:{authored:{modified:[t.id]}}}),e.is(n.onComplete,"function")&&n.onComplete.call(null,t,o)},onFailure:function(){d.debug(i.name,n.onFailureMsg+" : %s",JSON.stringify(t)),e.is(n.onFailure,"function")&&n.onFailure.call(null,t)},wait:!0,parse:!0})},massUpdateModels:function(t,n,i){var o=this;(i=i||{}).onCompleteMsg=e.is(i.onCompleteMsg)?i.onCompleteMsg:"MassUpdate: Model has been updated successfully",i.onFailureMsg=e.is(i.onFailureMsg)?i.onFailureMsg:"MassUpdate has failed",e.is(i.data)||e.is(i.data.keyValues)&&e.is(i.data.pids,"array")||(d.debug(o.name,i.onFailureMsg+" as keyValues or pids have not been provided"),!e.is(i.onFailure,"function"))?u.webServiceRequest({url:"dsmfg/private/V0/MfgElement/"+t,method:"PUT",data:e.Json.encode(i.data),onComplete:function(s){var r;s.forEach(function(e){e=e.attributesValue,(r="instance"===t?p.instances.get(e.PID):p.references.get(e.PID)).set(n,e[n]),d.debug(o.name,i.onCompleteMsg+": %o",r)}),e.is(i.onComplete,"function")&&i.onComplete.call(null,s)},onFailure:function(){d.debug(o.name,i.onFailureMsg),e.is(i.onFailure,"function")&&i.onFailure.call(null)}}):i.onFailure.call(null)},fetch:function(t,n){var i,o,s,r=this;e.is(t)?(n=n||{},o=!!e.is(n.silent,"boolean")&&n.silent,s=!e.is(n.parse,"boolean")||n.parse,i={proxy:"passport",type:"json",headers:u.getHeaders(),onComplete:function(t,i,o){d.debug(r.name,"fetch completed: %o",i),e.is(n.onComplete,"function")&&n.onComplete.apply(null,[t,o])},onFailure:function(t,i,o){var s=e.is(i)?e.Json.isJson(i)?e.Json.decode(i):i:{};d.debug(r.name,"fetch failed with error: %o",s),e.is(n.onFailure,"function")&&n.onFailure.apply(null,[s,o])},onTimeout:function(t,i,o){var s=e.is(i)?e.Json.isJson(i)?e.Json.decode(i):i:{};d.debug(r.name,"fetch timed out with error: %o",s),e.is(n.onTimeout,"function")&&n.onTimeout.apply(null,[s,o])},parse:s,silent:o},t.fetch(i)):d.debug(r.name,"Invalid model object to fetch.")},createRef:function(t,n){var o,s=this,r=t||{},a=n||{},c=!!e.is(a.silent,"boolean")&&a.silent,l=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return r.oneDelmiaAggregationMode=i.getOneDelmiaAggregationMode(),e.is(a.securityContextOverride,"string")&&(l.SecurityContext=a.securityContextOverride),o={proxy:"passport",headers:l,data:e.Json.encode(r),onComplete:function(t){e.is(a.onComplete,"function")&&a.onComplete.call(null,t)},onFailure:function(t,n){var i=e.is(n)?e.Json.isJson(n)?e.Json.decode(n):n:{};d.debug(s.name,"Creation failed: %o",t),e.is(a.onFailure,"function")&&a.onFailure.call(null,t,i.error)},silent:c,wait:!0,parse:!0},this.references.create(null,o)},fetchReferences:function(t,n){var i,o,s,r,a=this;n=n||{},o=!e.is(n.silent,"boolean")||n.silent,s=!e.is(n.parse,"boolean")||n.parse,r=!!e.is(n.remove,"boolean")&&n.remove,i={data:t,proxy:"passport",headers:u.getHeaders(),onComplete:function(t,i,o){var s=[];d.debug(a.name,"fetch references completed: %o",i),e.is(i,"array")&&i.forEach(function(e){s.push(t.get(e.PID))}),e.is(n.onComplete,"function")&&n.onComplete.apply(null,[s,o])},onFailure:function(t,i,o){var s=e.is(i)?e.Json.isJson(i)?e.Json.decode(i):i:{};d.debug(a.name,"fetch references failed with error: %o",s),e.is(n.onFailure,"function")&&n.onFailure.apply(null,[s,o])},wait:!0,parse:s,silent:o,remove:r},a.references.fetch(i)},addRef:function(t,n){var i,o=n||{};return t&&(o=e.merge(o,{merge:!0,parse:!0}),i=p.references.add(t,o)),i},fetchRef:function(t,n){var i=this,o=new c(t);return o.fetch({proxy:"passport",headers:u.getHeaders(),onComplete:function(t){d.debug(i.name,"Fetch completed: %o",t),i.references.add(t,{silent:!!e.is(n.silent)&&n.silent,merge:!0}),e.is(n.onComplete,"function")&&n.onComplete.call(null,t)},onFailure:function(t){d.debug(i.name,"Fetch failed: %o",t),e.is(n.onFailure,"function")&&n.onFailure.call(null,t)},wait:!0,parse:!0}),o},fetchRefList:function(t,n){var i,o=[];i={url:"dsmfg/private/V0/MfgElement/reference/getReferences",method:"POST",data:e.Json.encode(t),options:n,onComplete:function(e){o=e.references.map(function(e){return e.attributesValue}),i={stackedReferences:o,onComplete:n.onComplete,onFailure:n.onFailure},p.addToCollections(i)},onFailure:function(t){e.is(n.onFailure,"function")&&n.onFailure.call(t)}},u.webServiceRequest(i)},fetchInstancesAndTheirReferences:function(t,n){u.webServiceRequest({url:"dsmfg/private/V0/MfgElement/instance/getInstancesAndTheirReferences",method:"POST",data:e.Json.encode(t),onComplete:function(e){var t,i,o=function(e){return e.attributesValue};t=e.instances.map(o),i=e.references.map(o),p.addToCollections({stackedReferences:i,stackedInstances:t,onComplete:n.onComplete,onFailure:n.onFailure,silentMode:n.silentMode})},onFailure:function(t){e.is(n.onFailure,"function")&&n.onFailure.call(t)}})},updateRef:function(e,t){var n=p.references.get(e);(t=t||{}).onCompleteMsg="Updated Reference succesfully",t.onFailureMsg="Updating Reference failed",this.updateModel(n,t)},updateRefs:function(e,t){(t=t||{}).onCompleteMsg="MassUpdate: Reference has been updated successfully",t.onFailureMsg="MassUpdate of References has failed",this.massUpdateModels("reference",e,t)},deleteRef:function(t,n){var i,o=this,s=p.references.get(t);if(n=n||{},i=!!e.is(n.deep)&&n.deep,!e.is(s))return d.debug(this.name,"Refrence does not exists"),void(e.is(n.onFailure)&&n.onFailure());s.destroy({proxy:"passport",data:e.Json.encode({deep:i}),headers:u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(i,s){var r=e.is(s)?s:{};d.debug(o.name,"Deleting of Refrence failed: %s with error:",t,JSON.stringify(r)),e.is(n.onFailure)&&n.onFailure(i,r)},onComplete:function(s,r){var a,c,l,u=e.is(r)?r:{},f=e.is(u.deletedObjects)?u.deletedObjects:[];if(i&&e.is(f))for(c=0;c<f.length;c++)a=f[c],l=p.instances.get(a),e.is(l)&&p.instances.remove(a),l=p.references.get(a),e.is(l)&&p.references.remove(a);d.debug(o.name,"Deleting of Refrence completed: %s ",t),e.is(n.onComplete)&&n.onComplete(s,u)}})},removeRef:function(e,t){this.references.remove(e,t)},addInst:function(t,n){if(e.is(t))return e.is(n)||(n={}),n=e.merge(n,{merge:!0,parse:!0}),p.instances.add(t,n);d.debug(this.name,"refData is not defined")},createInst:function(t,n){var o,s=this,r=t||{},a=n||{},c=!!e.is(a.silent,"boolean")&&a.silent,l=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0});return e.is(a.securityContextOverride,"string")&&(l.SecurityContext=a.securityContextOverride),r.oneDelmiaAggregationMode=i.getOneDelmiaAggregationMode(),o={proxy:"passport",headers:l,data:e.Json.encode(r),onComplete:function(t){p.manageLinearProductFlowsOnCreateInstance(t),e.is(a.onComplete,"function")&&a.onComplete.call(null,t)},onFailure:function(t,n){var i=e.is(n)?e.Json.isJson(n)?e.Json.decode(n):n:{};i=e.is(i.error)?i.error:i,d.debug(s.name,"Instance Creation failed: %o",t),e.is(a.onFailure,"function")&&a.onFailure.call(null,t,i)},wait:!0,parse:!0,silent:c},this.instances.create(null,o)},fetchInst:function(t,n){var i=this,o=new l(t);return e.is(n)||(n={}),o.fetch({proxy:"passport",headers:u.getHeaders(),onComplete:function(t){d.debug(i.name,"Fetch completed: %o",t),i.instances.add(t,{silent:!!e.is(n.silent)&&n.silent,merge:!0,parse:!0}),e.is(n.onComplete,"function")&&n.onComplete.call(null,t)},onFailure:function(t){d.debug(i.name,"Fetch failed: %o",t),e.is(n.onFailure,"function")&&n.onFailure.call(null,t)},wait:!0,parse:!0}),o},updateInst:function(e,t){var n=p.instances.get(e);(t=t||{}).onCompleteMsg="Updated Instance succesfully",t.onFailureMsg="Updating Instance failed",this.updateModel(n,t)},updateInsts:function(e,t){(t=t||{}).onCompleteMsg="MassUpdate: Instance has been updated successfully",t.onFailureMsg="MassUpdate of Instances has failed",this.massUpdateModels("instance",e,t)},deleteInst:function(t,n){var i=this,o=p.instances.get(t);if(n=n||{},!e.is(o))return d.debug(this.name,"Instance does not exists"),void(e.is(n.onFailure)&&n.onFailure());p.manageLinearProductFlowsOnDeleteInstance(o),o.destroy({proxy:"passport",headers:u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,s){var r=e.is(s)?e.Json.isJson(s)?e.Json.decode(s):s:{};d.debug(i.name,"Deleting of Instance failed: %s with error:",t,r),e.is(n.onFailure)&&n.onFailure(o,r.error)},onComplete:function(){d.debug(i.name,"Deleting of instance completed: %s ",t),e.is(n.onComplete)&&n.onComplete()}})},removeInstance:function(e,t){return this.instances.remove(e,t)},removeConnection:function(e,t){return this.connections.remove(e,t)},createConn:function(t,n){var i,o=this,s=u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0,minorVersion:"2.0"});return e.is(n)||(n={}),e.is(n.securityContextOverride,"string")&&(s.SecurityContext=n.securityContextOverride,delete n.securityContextOverride),i=e.extend({proxy:"passport",headers:s,data:e.Json.encode(t),onComplete:function(t){d.debug(o.name,"Creation completed: %o",t),e.is(n.onComplete,"function")&&n.onComplete.call(null,t)},onFailure:function(t,i){var s;d.debug(o.name,"Creation failed: %o",t),e.is(i)&&e.is(i.message,"string")&&(s=i.message,d.debug(o.name,s)),e.is(n.onFailure,"function")&&n.onFailure.call(null,t,s)},wait:!0,parse:!0},n,!0),this.connections.create(null,i)},addConn:function(t,n){if(e.is(t))return e.is(n)||(n={}),n=e.merge(n,{merge:!0,parse:!0}),p.connections.add(t,n);d.debug(self.name,"connData is not defined")},updateConn:function(e,t){var n=p.connections.get(e);(t=t||{}).onCompleteMsg="Updated Connection succesfully",t.onFailureMsg="Updating Connection failed",this.updateModel(n,t)},deleteConn:function(t,n){var i=this,o=p.connections.get(t);if(n=n||{},!e.is(o))return d.debug(this.name,"Connection does not exists"),void(e.is(n.onFailure)&&n.onFailure());o.destroy({proxy:"passport",headers:u.getHeaders({isAuthoringCtx:!0,isJsonOnly:!0}),wait:!0,onFailure:function(o,s){var r;d.debug(i.name,"Deleting of connection failed: %s ",t),e.is(s)&&e.is(s.message,"string")&&(r=s.message,d.debug(i.name,r)),e.is(n.onFailure)&&n.onFailure(o,s)},onComplete:function(o,s){var r;s&&(r=s.deletedConnections?s.deletedConnections:[],Array.isArray(r)&&r.length>0&&r.forEach(function(e){p.removeConnection(e)})),d.debug(i.name,"Deleting of connection completed: %s ",t),e.is(n.onComplete)&&n.onComplete(s)}})},addDocument:function(e){return this.documents.add(e)},getDocument:function(e){return this.documents.get(e)},removeDocument:function(e){return this.documents.remove(e)},getTypes:function(){return this.pprTypes},getInstancesFromCollection:function(e){return this.instances.getChildren(e)},getInstanceFromCollection:function(e){return this.instances.get(e)},isReference:function(t){return e.is(this.references.get(t))},isInstance:function(t){return e.is(this.instances.get(t))},getParentInstancesFromCollection:function(e){return this.instances.getInstancesForGivenReference(e)},getReferenceFromCollection:function(e){return this.references.get(e)},getReferencesArrayFromCollection:function(t){var n=[];return e.is(t,"array")&&t.forEach(function(t){var i=p.getReferenceFromCollection(t);e.is(i)&&n.push(i)}),n},getReferenceModel:function(t){var n,i=this.getReferenceFromCollection(t);return e.is(i)||(n=this.getInstanceFromCollection(t),e.is(n)&&(i=this.getReferenceModelFromInstance(n))),i},getConnectionFromCollection:function(e){return this.connections.get(e)},findSomeConnection:function(e,t){return this.connections.filter(e,t)},hasConnection:function(t){var n=!1,i=this.connections.findWhere(t);return e.is(i)&&(n=!0),n},findConnections:function(e){return this.connections.where(e)},getReferenceModelFromInstance:function(e){var t=e.get("isInstanceOf");return this.references.get(t)},getAggregatingReferenceModelFromInstance:function(e){var t=e.get("isAggregatedBy");return this.references.get(t)},getImpactedConnections:function(t,n,i){var o=[];return i=i||{},i=e.merge(i,{from:!0,to:!0}),o=(o=(o=o.concat(this.connections.getImpactedConnections(t,i.fromXEN,i.relationTypes))).concat(this.connections.getImpactedConnections(n,i.fromXEN,i.relationTypes))).filter(function(n){var o,s=n.get("type"),r=(n.getAttribute("to"),n.getAttribute("from"),!1);return o=function(e){r=!0,i.relationTypes?r=i.relationTypes.indexOf(e)>=0:(i.excludeRelationTypes&&(r=-1===i.excludeRelationTypes.indexOf(e)),i.excludeTimeConstraintType&&!0===i.excludeTimeConstraintType&&["DELLmiTimeConstraintCnx","DELLmiMaterialPathCnxCust","LinearProductFlowCnx"].indexOf(e)>-1&&(r=!1))},i.fromXEN?e.is(n.id)&&(3===n.id.split("|").length&&(s=n.id.split("|")[0]),n.get("from.attributesValue").PID===t&&o(s)):o(s),r})},needToQueryForConnections:function(t,n){var i,o=!1;return i=e.is(n,"string")?(i=t?t.get(n):this.getInstanceFromCollection(n))||this.getReferenceFromCollection(n):n,e.is(i)&&(i.getAdditionalInfo("queriedForConnections")||(o=!0)),o},_needToQueryForConnectionsByDir:function(t,n,i){var o,s,r=!1;switch(i){case this.ConnectionDir.DIRECT:s="directConnectionsFetched";break;case this.ConnectionDir.INVERSE:s="inverseConnectionsFetched";break;default:s="queriedForConnections"}return o=e.is(n,"string")?(o=t?t.get(n):this.getInstanceFromCollection(n))||this.getReferenceFromCollection(n):n,e.is(o)&&(o.getAdditionalInfo(s)||(r=!0)),r},needToQueryForDirectConnections:function(e,t){return this._needToQueryForConnectionsByDir(e,t,this.ConnectionDir.DIRECT)},needToQueryForInverseConnections:function(e,t){return this._needToQueryForConnectionsByDir(e,t,this.ConnectionDir.INVERSE)},needToQueryForChildren:function(t){var n=!1,i=e.is(t,"string")?this.references.get(t):t;return e.is(i)&&(i.getAdditionalInfo("queriedForChildren")||(n=!0)),n},refreshAll:function(t,i,o,s){var r,a,l=s||{},f=e.is(l.context)?l.context:null,g=i.concat(o,t),m=[],h=0,C=0;d.log(this.name,"refreshAll, Body roots PID: "+t),d.log(this.name,"refreshAll, Table roots PID: "+i),d.log(this.name,"refreshAll, Auxiliary view roots PID: "+o),new n(function(e){0!==g.length?g.forEach(function(t){var n,i=function(){h+C===g.length&&e()};(n=new c({PID:t})).fetch({proxy:"passport",type:"json",headers:u.getHeaders(),onComplete:function(e){h++,p.references.add(e),i()},onFailure:function(){C++,i()}}),m.push(n)}):e()}).then(function(){p.references.reset(m,{silent:!0}),r=p.instances.reset({},{silent:!0}),e.is(r)&&p.instances.remove(r,{silent:!0}),a=p.connections.reset({},{silent:!0}),e.is(a)&&p.connections.remove(a,{silent:!0}),e.is(l.onComplete,"function")&&l.onComplete.call(f,h,C)})},_removeDuplicate:function(t){return e.is(t,"array")&&(t.sort(),t=t.filter(function(e,t,n){return!t||e!==n[t-1]})),t},expandOnBackbone:function t(n,i){var o=p.getInstancesFromCollection(n),s=[];e.is(o,"array")&&e.is(i)&&o.forEach(function(t){var n=t.get("isInstanceOf");e.is(i.referencesPID,"array")&&-1===i.referencesPID.indexOf(n)&&i.referencesPID.push(n),e.is(i.instancesPID,"array")&&-1===i.instancesPID.indexOf(t.id)&&i.instancesPID.push(t.id),-1===s.indexOf(n)&&s.push(n)}),s.forEach(function(e){t(e,i)})},addToCollections:function(t){var n,o=t||{},s={instancesAndReferences:[],connections:[],documents:e.is(o.documentIdMap)?o.documentIdMap:{}},r=o.stackedReferences?o.stackedReferences:[],a=o.stackedInstances?o.stackedInstances:[],c=o.stackedConnections?o.stackedConnections:[],l=o.deletedObjects?o.deletedObjects:[],u=o.deletedConnections?o.deletedConnections:[],d=o.references?o.references:p.references,f=o.instances?o.instances:p.instances,g=o.connections?o.connections:p.connections,m=e.is(o.onComplete,"function")?o.onComplete:null,h=e.is(o.onFailure,"function")?o.onFailure:null,C=e.is(o.onTimeout,"function")?o.onTimeout:null,y=!e.is(o.silentMode,"boolean")||o.silentMode,b=e.is(o.context)?o.context:this,I=function(e,t){var n=d.add(e,{silent:y,merge:!0,parse:!0});s.instancesAndReferences.push.apply(s.instancesAndReferences,n),t()},v=function(t,n){t.forEach(function(t){var n,i=t.attributesValue||t;(function t(n,i){var o,s,r;if(i===n)return!0;if(r=p.getReferenceFromCollection(i),e.is(r))for(o=p.getParentInstancesFromCollection(r.get("PID")),s=0;s<o.length;s++)if(t(n,o[s].get("isAggregatedBy")))return!0;return!1})(i.isInstanceOf,i.isAggregatedBy)||(n=f.add(t,{silent:y,merge:!0,parse:!0}),s.instancesAndReferences.push(n))}),n()},D=function(t,n){var i;t.forEach(function(t){i=p.getInstanceFromCollection(t),e.is(i)&&p.removeInstance(t,{silent:y})}),n()},P=function(t,n){var i;t.forEach(function(t){i=p.getConnectionFromCollection(t),e.is(i)&&p.removeConnection(t)}),n()},M=function(){e.is(m,"function")?m.call(b,s):e.is(h,"function")?h.call(b):e.is(C,"function")&&C.call(b)};(n={callback:function(e,t){var n=g.add(e,{silent:y,merge:!0,parse:!0});s.connections.push.apply(s.connections,n),t()},globalArray:c,context:g},i.getExecuteByBlockPromise(n)).then(function(){var e;(e={callback:I,globalArray:r,context:d},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:v,globalArray:a,context:f},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:D,globalArray:l,context:f},i.getExecuteByBlockPromise(e)).then(function(){var e;(e={callback:P,globalArray:u,context:g},i.getExecuteByBlockPromise(e)).then(M)})})})})},getFilteredInstancesFromCollection:function(t,n){var i;return i=this.getInstancesFromCollection(t),e.is(n)&&(i=i.filter(function(t){var i=!1,o=t.getAdditionalInfo("filterQuery");return e.is(o)&&(i=e.equals(o,n)),i})),i},traverseInstanceModels:function(t,n){var i,o,s=function(e,t){p.getInstancesFromCollection(e).forEach(function(e){t.push(e)})};if(e.is(n,"function"))for(s(t,i=[]);i.length>0;)n(o=i.pop()),s(o.get("isInstanceOf"),i);else d.log(this.name,"callback cbProcessModel not provided")},removeFilterFromCollection:function(t){p.traverseInstanceModels(t,function(t){var n=t.getAdditionalInfo("filterQuery");e.is(n)&&t.setAdditionalInfo({filterQuery:null})})},transformToRIROccurrencePath:function(t){var n,i,o=[],s=[];return Array.isArray(t)?(o=t).length>0&&(i=p.getInstanceFromCollection(o[0]),e.is(i)&&(n=i.get("isAggregatedBy"))):n=t,s=e.is(n)?[n]:[],o.forEach(function(t){s.push(t),i=p.getInstanceFromCollection(t),e.is(i)&&s.push(i.get("isInstanceOf"))}),s},transformRIRToAbsolutePath:function(e){var t,n=[];for(t=0;t<e.length;t++)t%2==1&&n.push(e[t].resourceid);return n},syncChangeRequired:function(t,n,i,o){var s=[];t.forEach(function(e){s.push("pid:"+e.id)}),u.webServiceRequest({url:"modeler/change/changecontrol",method:"PUT",headers:n,context:this,data:e.Json.encode({ObjectsListForSetChangeControl:s}),onComplete:function(e){i(e)},onFailure:function(){o()}})},syncMaturity:function(t,i,o,s,r){var a=[];t.forEach(function(e){a.push({id:e.id,identifier:e.id,type:e.get("type"),source:"3DSpace",relativePath:"/resources/v1/modeler/dsmfg/dsmfg:MfgItem/"+e.id,nextState:"RELEASED"})}),u.webServiceRequest({url:"v1/modeler/dslc/maturity/changeState",method:"POST",headers:i,context:this,data:e.Json.encode({data:a}),onComplete:function(e){o&&g.isChangeRequiredSyncronizationEnabled()?new n(function(e,n){p.syncChangeRequired(t,i,e,n)}).then(function(){s(e)}):s(e)},onFailure:function(){r()}})},getCurrentStates:function(t,n,i){var o=[];t.forEach(function(e){o.push({id:e})}),u.webServiceRequest({url:"v1/modeler/dslc/maturity/getNextStates",method:"POST",headers:n,context:this,data:e.Json.encode({data:o}),onComplete:function(t){var n=new Map;e.is(t)&&e.is(t.data,"array")?(t.data.forEach(function(e){n.set(e.id,e.maturityState)}),i(n)):i(null)}})},getSequencingMode:function(t,n){u.webServiceRequest({url:"dsmfg/private/V0/invoke/getSequencingMode?pid="+t,method:"GET",context:this,onComplete:function(i){var o;e.is(i)&&e.is(i,"object")&&e.is(i.mode,"string")?(o=p.references.get(t),e.is(o)&&o.set("V_SequencingMode",i.mode),e.is(n.onComplete,"function")&&n.onComplete(i.mode)):e.is(n.onFailure,"function")&&n.onFailure()},onFailure:function(){e.is(n.onFailure,"function")&&n.onFailure()},onTimeout:function(){e.is(n.onTimeout,"function")&&n.onTimeout()}})},setSequencingMode:function(t,n,i){u.webServiceRequest({url:"dsmfg/private/V0/invoke/setSequencingMode",method:"PUT",data:e.Json.encode({pid:t,mode:n}),context:this,onComplete:function(){var o,s,r,a,c,l;if(o=p.references.get(t),e.is(o)&&o.set("V_SequencingMode",n),s=p.getInstancesFromCollection(t),(r=s.map(function(e){return e.get("PID")})).length>0)if("Linear"===n)for(a of(p.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&r.includes(e.getAttribute("from"))}).forEach(function(e){p.removeConnection(e.get("PID"))}),p.sortInstancesByTreeOrder(s),s.map(function(e){return e.get("PID")})))e.is(l)?(c=l,l=a,p.addLinearProductFlow(c,l)):l=a;else p.findSomeConnection(function(e){return"LinearProductFlowCnx"===e.get("type")&&r.includes(e.getAttribute("from"))}).forEach(function(e){p.removeConnection(e.get("PID"))});e.is(i.onComplete,"function")&&i.onComplete()},onFailure:function(){e.is(i.onFailure,"function")&&i.onFailure()},onTimeout:function(){e.is(i.onTimeout,"function")&&i.onTimeout()}})},getLinearProductFlowPID:function(e,t){return"LinearProductFlowCnx|"+e+"|"+t},getLinearProductFlowFromCollection:function(e,t){return p.getConnectionFromCollection(p.getLinearProductFlowPID(e,t))},addLinearProductFlow:function(e,t){p.addConn({PID:p.getLinearProductFlowPID(e,t),from:[e],to:[t],type:"LinearProductFlowCnx"})},removeLinearProductFlow:function(e,t){p.removeConnection(p.getLinearProductFlowPID(e,t))},sortInstancesByTreeOrder:function(t){t.sort(function(t,n){var i=t.get("V_TreeOrder"),o=n.get("V_TreeOrder");return(e.is(i)?i:0)-(e.is(o)?o:0)})},manageLinearProductFlowsOnCreateInstance:function(t){var n,i,o,s,r,a,c,l,u=t.get("isAggregatedBy"),d=p.references.get(u);e.is(d)&&(l=d.get("V_SequencingMode")),"Linear"===l&&(n=p.getInstancesFromCollection(u),p.sortInstancesByTreeOrder(n),i=t.get("PID"),a=(o=n.findIndex(function(e){return e.get("PID")===i}))>0,c=o<n.length-1,a&&(s=n[o-1].get("PID"),r=i,p.addLinearProductFlow(s,r)),c&&(s=i,r=n[o+1].get("PID"),p.addLinearProductFlow(s,r)),a&&c&&(s=n[o-1].get("PID"),r=n[o+1].get("PID"),p.removeLinearProductFlow(s,r)),p.findSomeConnection(function(e){return"DELLmiTimeConstraintCnx"===e.get("type")&&(e.getAttribute("from")===i||e.getAttribute("to")===i)}).forEach(function(e){p.removeConnection(e.get("PID"))}))},manageLinearProductFlowsOnDeleteInstance:function(e){var t,n,i,o,s,r,a,c=e.get("isAggregatedBy");"Linear"===p.references.get(c).get("V_SequencingMode")&&(t=p.getInstancesFromCollection(c),p.sortInstancesByTreeOrder(t),n=e.get("PID"),r=(i=t.findIndex(function(e){return e.get("PID")===n}))>0,a=i<t.length-1,r&&(o=t[i-1].get("PID"),s=n,p.removeLinearProductFlow(o,s)),a&&(o=n,s=t[i+1].get("PID"),p.removeLinearProductFlow(o,s)),r&&a&&(o=t[i-1].get("PID"),s=t[i+1].get("PID"),p.addLinearProductFlow(o,s)))},detachExtn:function(t,n){var i,o,s=n.mdlType,r={url:"dsmfg/private/V0/MfgElement/"+n.mdlType+"/detachExtn/"+t,method:"PUT",context:this,data:e.Json.encode(n.data),onComplete:function(r){switch(s){case"instance":i=p.instances.get(t);break;case"reference":i=p.references.get(t);break;case"connection":i=p.connections.get(t);break;default:i=null}i&&(n.data.forEach(e=>{e in r.attributesValue||(o=i.unset(e))}),o&&e.is(n.onComplete,"function")&&n.onComplete())},onFailure:function(){e.is(n.onFailure,"function")&&n.onFailure()}};r=e.merge(r,n),u.webServiceRequest(r)}});return p}),define("DS/DELPPWModelServices/EGraphUtils",["UWA/Core","UWA/Class","DS/DELPPWModelServices/CollectionUtils","DS/DELPPWGraphModel/GraphCollection"],function(e,t,n,i){"use strict";var o=function(e,t){var n={PID:"",links:[],childOccurencePath:"",index:0};return n.PID=e.get("isInstanceOf"),n.instancePID=e.get("PID"),n.childOccurencePath=t.concat([e.get("PID")]).toString(),n};return t.singleton({name:"EGraphUtils",init:function(){this.linkTypeName=new e.Class.Collection([],{}),this.linkTypeName.add({name:"scope",typeAssociated:"ProductImplementLink"}),this.linkTypeName.add({name:"scope",typeAssociated:"ProcessImplementLink"}),this.linkTypeName.add({name:"partialscopeOnHeaderOperation",typeAssociated:"PartialProcessImplementLink"}),this.linkTypeName.add({name:"implement",typeAssociated:"ProcessImplementLinkOcc"}),this.linkTypeName.add({name:"origin",typeAssociated:"HistorizationLinkRefRef"}),this.linkTypeName.add({name:"alternate",typeAssociated:"MfgProcessAlternate"}),this.linkTypeName.add({name:"output",typeAssociated:"DELLmiProductionSystemOutputCnxToMBOM"}),this.linkTypeName.add({name:"capableResources",typeAssociated:"DELAsmProcessCanUseCnx"}),this.linkTypeName.add({name:"secondaryCapableResources",typeAssociated:"SecondaryCandidateResourceLink"}),this.linkTypeName.add({name:"productFlow",typeAssociated:"DELLmiTimeConstraintCnx"}),this.linkTypeName.add({name:"productFlow",typeAssociated:"DELLmiMaterialPathCnxCust"}),this.linkTypeName.add({name:"productFlow",typeAssociated:"LinearProductFlowCnx"}),this.linkTypeName.add({name:"capableResourcesStructure",typeAssociated:"CapableResourcesStructureLink"}),this.creatableTypesOfLink=new e.Class.Collection([],{}),this.creatableTypesOfLink.add({img:"ProcessImplementLink",linkType:"scope",displayed:!0}),this.creatableTypesOfLink.add({img:"PartialProcessImplementLink",linkType:"partialscopeOnHeaderOperation",displayed:!0}),this.creatableTypesOfLink.add({img:"ProcessImplementLinkOcc",linkType:"implement",displayed:!0}),this.creatableTypesOfLink.add({img:"DELLmiProductionSystemOutputCnxToMBOM",linkType:"output",displayed:!0}),this.creatableTypesOfLink.add({img:"MfgProcessAlternate",linkType:"alternate",displayed:!0}),this.creatableTypesOfLink.add({img:"HistorizationLinkRefRef",linkType:"origin",displayed:!0}),this.creatableTypesOfLink.add({img:"DELAsmProcessCanUseCnx",linkType:"capableResources",displayed:!0}),this.creatableTypesOfLink.add({img:"SecondaryCandidateResourceLink",linkType:"secondaryCapableResources",displayed:!0}),this.creatableTypesOfLink.add({img:"DELLmiTimeConstraintCnx",linkType:"productFlow",displayed:!0}),this.creatableTypesOfLink.add({img:"CapableResourcesStructureLink",linkType:"capableResourcesStructure",displayed:!0})},addInstances:function(t,i,o,s,r){var a,c,l,u,d=null,f=null,g=0,p=null,m=null,h=null,C=null;if(e.is(i)){if(d=i,f=i,g=t.findWhere({referencePID:i.get("PID")}).get("X")+1,e.is(i.id))for((C=n.getInstancesFromCollection(i.id)).sort(function(t,n){var i=t.get("V_TreeOrder"),o=n.get("V_TreeOrder");return(e.is(i)?i:0)-(e.is(o)?o:0)}),u=C.length-1;u>=0;u--)l=C[u],h=n.getReferenceModelFromInstance(l),e.is(h)&&-1!==this.getType(h.get("PPRTYPE"))&&(a=e.is(r)?r+","+l.id:l.id,s.unshift([h,g,d.id,a,l.id]));e.is(s[0],"array")&&s[0].length>=5&&(e.is(s[0][0])&&(p=e.is(s[0][0].id)?s[0][0].id:null,m=s[0][3]),t.add({PID:m,X:s[0][1],Type:o,isAggregatedBy:s[0][2],childOccurencePath:s[0][3],instancePID:s[0][4],referencePID:p,LINKS:this.getReferenceReferenceLinks(p)}),f=s[0][0],c=s[0][3],s.shift(),this.addInstances(t,f,o,s,c))}},getInstanceInstanceLink:function(t){var i,o,s,r,a,c,l,u,d,f,g=[],p=this;Array.prototype.push.apply(g,n.connections.where({type:"ProcessImplementLinkOcc"})),Array.prototype.push.apply(g,n.connections.where({type:"DELLmiMaterialPathCnxCust"})),Array.prototype.push.apply(g,n.connections.where({type:"DELLmiTimeConstraintCnx"})),Array.prototype.push.apply(g,n.connections.where({type:"LinearProductFlowCnx"})),Array.prototype.push.apply(g,n.connections.where({type:"DEFAULT"})),g.forEach(function(g){if(i=g.get("from").toString(),o=g.get("to").toString(),"DELLmiTimeConstraintCnx"===g.get("type")||"LinearProductFlowCnx"===g.get("type")||"DELLmiMaterialPathCnxCust"===g.get("type"))for(s=t.filter(function(e){return(u=e.get("PID")).length-u.indexOf(i)-i.length==0}),a=t.filter(function(e){return(u=e.get("PID")).length-u.indexOf(o)-o.length==0}),l=new e.Class.Collection([],{}),d=0;d<s.length;d++)for(r=s[d].get("PID").split(",")[0],r=n.getInstanceFromCollection(r),f=0;f<a.length;f++)c=a[f].get("PID").split(",")[0],c=n.getInstanceFromCollection(c),r.get("isAggregatedBy")===c.get("isAggregatedBy")&&(l.add({PID:g.get("PID"),from:s[d].get("PID"),to:a[f].get("PID"),type:g.get("type")}),l.add(s[d].get("LINKS")._models),p.isConnectionTypeAllowed(l._models[0]._attributes.type)&&s[d].set({LINKS:l}));else s=t.filter(function(e){return e.id.contains(i)}),a=t.filter(function(e){return e.id.contains(o)}),s.length>0&&a.length>0&&((l=new e.Class.Collection([],{})).add({PID:g.get("PID"),from:i,to:o,type:g.get("type")}),l.add(s[0].get("LINKS")._models),p.isConnectionTypeAllowed(l._models[0]._attributes.type)&&s[0].set({LINKS:l}))})},getReferenceReferenceLinks:function(t){var i,o,s=new e.Class.Collection([],{}),r=n.connections.where({from:t});for(i=0;i<r.length;i++)"DELAsmProcessCanUseCnx"===(o=r[i]).get("type")&&n.connections.where({from:o.get("PID")}).forEach(function(e){(e=e.clone()).set("from",t),r.push(e)}),this.isConnectionTypeAllowed(o.get("type"))&&n.references.where({PID:o.get("to")}).length>0&&s.add(o);return s},getType:function(e){switch(e){case"PRODUCT":return 0;case"PROCESS":return 1;case"SYSTEM":case"OPERATION":return 2;case"RESOURCE":return 3;default:return-1}},isConnectionTypeAllowed:function(t){var n,i;return(i=this.linkTypeName.findWhere({typeAssociated:t}))&&(n=this.creatableTypesOfLink.findWhere({linkType:i._attributes.name})),!!e.is(n)&&n._attributes.displayed},setLinkDisplayStatus:function(e,t){this.creatableTypesOfLink.findWhere({linkType:e}).set("displayed",t)},getCreatableTypesOfLink:function(){return this.creatableTypesOfLink},getEGraphData:function(e){var t,o,s=new i,r=[],a=this;return e.forEach(function(e){t=n.getReferenceFromCollection(e),o=a.getType(t.get("PPRTYPE")),s.add({PID:t.id,X:0,Type:o,isAggregatedBy:null,referencePID:t.id,LINKS:a.getReferenceReferenceLinks(t.id)}),a.addInstances(s,t,o,r)}),this.getInstanceInstanceLink(s),s},getProductFlowData:function(t,i){var s,r,a=n.references,c=n.connections,l=n.instances.where({isAggregatedBy:t}),u=new e.Class.Collection([],{}),d=this;return l.forEach(function(t){var n=a.findWhere({PID:t.get("isInstanceOf")}).get("PPRTYPE");n=e.is(n)?n:"",2===d.getType(n)&&(r=o(t,i),c.filter(function(e){var n=e.get("from");return n[n.length-1]===t.get("PID")}).forEach(function(t){s=l.find(function(e){var n=t.get("to");return n[n.length-1]===e.get("PID")}),e.is(s)&&a.where({PID:s.get("isInstanceOf")}).forEach(function(e){r.links.push([e.get("PID"),t])})}),u.push(r))}),u},isProductFlowLooped:function(t){var n,i,o,s,r,a,c=[],l=new e.Class.Collection([],{}),u=new e.Class.Collection([],{}),d=0;for(i=function(e){return e.get("links").length>0},n=t.filter(i),c=n;c.length>0;)s=o,o=c[0],l.add(o),o.get("links").forEach(function(n){a=l.findWhere({PID:n[0]}),e.is(a)||(r=t.findWhere({PID:n[0]}),e.is(r)&&r.set({index:o.get("index")+1})),u.add({from:o.get("PID"),to:n[0]}),u.where({from:o.get("PID"),to:n[0]}).length>5*t.length?(u.reset(),e.is(s)&&s.set({loopNode:!0}),d++):e.is(a)&&c.splice(1,0,t.findWhere({PID:n[0]}))}),c.shift();return d},getProductFlowGraphInstance:function(e,t){return o(e,t)}})});