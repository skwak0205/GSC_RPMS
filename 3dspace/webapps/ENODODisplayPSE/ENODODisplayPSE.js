define("DS/ENODODisplayPSE/commands/facets/DerivedOutputFacet",["DS/ENODODisplay/commands/facets/DerivedOutputFacet","UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/PADUtils/PADContext"],function(e,t,i,n,r){"use strict";return e.extend({_actionAuthorized:!1,_currentSelectionId:null,init:function(e){this._parent(e)},isActionAvailable:function(e){return 1==this._actionAuthorized&&"generateDeriveOutput"==e||this._parent(e)},onAction:function(e){if("generateDeriveOutput"===e){var t=this,i=r.get(),n=i.options.model?i.options.model:i.getPADTreeDocument(),o={};null!=this._selectionInfo&&(o=this._selectionInfo.getDOGenerationFilter()),require(["DS/ENODOManagementCmds/commands/GenericDOGenerationCmd"],function(e){var r=n.getSelectedNodes(),s=t._retrieveSelectionAndFilters(i,r);new e({command_id:t.options.ID,data:{selections:s.selections,context:widget.data.appId,filter:o}})})}else this._parent(e)},_retrieveFilteOnSelection:function(){var e=r.get(),t=(e.options.model?e.options.model:e.getPADTreeDocument()).getSelectedNodes(),i=this._retrieveSelectionAndFilters(e,t);return i.selections.length>0?i.selections[0]:{}},_retrieveSelectionAndFilters:function(e,i){for(var n={selections:[]},r=[],o=[],s=0;s<i.length;s++){var l=i[s],c=l.getOccurencePath(),a=l.getRoot().getID(),u=r.indexOf(a);if(-1===u){r.push(a);var d=[c];o.push(d)}else o[u]&&o[u].push(c)}var p={V1:{}};for(s=0;s<r.length;s++){if((d={}).paths=o[s],void 0!==e.HasFilter&&"function"==typeof e.HasFilter){var f=e.HasFilter(r[s]);if(t.is(f.hasFilter)&&!0===f.hasFilter&&t.is(e.GetFilterSpec(r[s],p).CVQuery)){var D=e.GetFilterSpec(r[s],p).CVQuery;d.filter=D}}n.selections.push(d)}return n}})});