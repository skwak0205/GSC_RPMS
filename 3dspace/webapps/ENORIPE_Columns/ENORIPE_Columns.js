/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/ENORIPE_Columns/WSRelations",["DS/WAFData/WAFData","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/PCSTracker"],function(e,t,n,o){"use strict";function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this)}return s.prototype.executeRequest=function(t,n,s,i){var a=o.networkprobe({url:t,request_options:n});return e.authenticatedRequest(t,a)},s.prototype.getCount=function(e){return n.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}),new Promise(function(o,s){var i=n.get3DSpaceURL(),a={onComplete:o,onFailure:s};i=i+"/resources/enorelnav/navigate/getrelationcount?tenant="+n.getPlatformId(),a.method="POST",a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify({widgetId:"DGV-RelationColumns-"+t.getWidgetId()+"-"+Date.now(),ids:e.ids,relations:e.relations,countmanagement:!0,trueREST:!0}),this.executeRequest(i,a)}.bind(this))},s.prototype.setPreferences=function(e){return new Promise(function(o,s){var i=n.get3DSpaceURL(),a={onComplete:o,onFailure:s};i=i+"/resources/enorelnav/navigate/setpreferences?tenant="+n.getPlatformId(),a.method="POST",a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify({widgetId:"DGV-RelationColumns-"+t.getWidgetId()+"-"+Date.now(),relations:e.relations,attributes_for_detailview:e.attributes,countmanagement:!0}),this.executeRequest(i,a)}.bind(this))},s.prototype.getDetail=function(e){return new Promise(function(o,s){var i=n.get3DSpaceURL(),a={onComplete:o,onFailure:s};i=i+"/resources/enorelnav/navigate/getecosystem?tenant="+n.getPlatformId(),a.method="POST",a.headers={Accept:"application/json","Content-Type":"application/json"},a.data={widgetId:"DGV-RelationColumns-"+t.getWidgetId()+"-"+Date.now(),debug:!1,countmanagement:!0,ecoSystemWithDetail:!0},a.data=Object.assign(a.data,e),a.data=JSON.stringify(a.data),this.executeRequest(i,a)}.bind(this))},new s}),define("DS/ENORIPE_Columns/RelationsColumns",["text!DS/ENORIPE_Columns/assets/ColumnsDefinition.json","i18n!DS/ENORIPE_Columns/assets/nls/ENORIPE_Columns","DS/ENORIPE_Columns/WSRelations","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/DictionaryAccess","DS/CoreEvents/ModelEvents","DS/PADServices/utils/GlobalUtils"],function(e,t,n,o,s,i,a){"use strict";var r=new i,l={BME:["v6_cad_document_drawing_to","v6_cad_document_analysis_to","v6_cad_document_process_to"]};function d(){if("object"==typeof d.instance)return d.instance;d.instance=this,this.relationColumnsDef=JSON.parse(e),this.alwaysUpdate=!1,this.dataIndexes=[],r.subscribe({event:"ENXRelationsCol/AddGroupingNodes"},this._addGroupingNodes.bind(this)),r.subscribe({event:"ENXRelationsCol/ShowGroupingNodes"},this._showGroupingNodes.bind(this)),r.subscribe({event:"ENXRelationsCol/HideGroupingNodes"},this._hideGroupingNodes.bind(this))}function u(e,t,n,o){var s=new e.options.nodeModelClass(n);s.isRelationsObjectNode=!0;var i,a=t.getRoot().getID(),l=t.getState(),u=t.getChildren();return u&&u.length?!0===u[0].isRelationsObjectGroupingNode?(u[0].addChild(s),i=u[0]):((i=c({treeDoc:e,parentId:t.getID()})).addChild(s),t.insertBefore(i,u[0])):((i=c({treeDoc:e,parentId:t.getID()})).addChild(s),t.addChild(i)),!0===d.groupingNodeHidden&&i.hide(),r.publish({event:"ENXRelationsCol/AddGroupingNodes",data:{groupingNode:i,rootId:a}}),!0===o&&i.setState({state:"expanded"}),"noChildren"===l?t.setState({state:"expanded"}):"collapsed"===l&&t.childComputed&&t.getReferenceValue("ds6w:kind")&&-1!==t.getReferenceValue("ds6w:kind").indexOf("3DPart")?t.setState({state:"expanded"}):"collapsed"===l&&!1===t.childComputed?t.setState({state:"expanded"}):t.setState({state:l}),s}function c(e){var n={resourceid:"fakeNode-"+e.parentId,label:t.fakeGroupingNode.label,childComputed:!0,icons:[{iconName:"object-related",fontIconFamily:1}],thumbnail:{iconName:"object-related",fontIconFamily:1},grid:{},children:[]},o=new e.treeDoc.options.nodeModelClass(n);return o.isRelationsObjectNode=!0,o.isRelationsObjectGroupingNode=!0,o.childComputed=!0,o}return d.prototype.setupCallback=function(e){e.treeDocModelEvents&&e.treeDocModelEvents.subscribe({event:"preRemoveChild"},this._cleanupGroupingNodes.bind(this)),e.globalModelEvents&&e.globalModelEvents.subscribe({event:"ENXModel/UpdateAdditionalColumns"},this._forceUpdateAttributes.bind(this))},d.groupingNodeHidden=!localStorage.getItem("enx-relation-groupingNode-hide_"+a.getAppId())||"true"===localStorage.getItem("enx-relation-groupingNode-hide_"+a.getAppId()),d.prototype.isAdditionalColumnsAvailable=function(e){for(var t=Object.keys(this.relationColumnsDef.patterns),n=[],o=0;o<t.length;o++)this.relationColumnsDef.patterns[t[o]].nlsPatternAMD&&-1===n.indexOf(this.relationColumnsDef.patterns[t[o]].nlsPatternAMD)&&n.push(this.relationColumnsDef.patterns[t[o]].nlsPatternAMD);n.length?require(n,function(){e(!0)}):e(!0)},d.prototype.getName=function(){return"RelationsColumns"},d.prototype.getManagedColumnNames=function(){return this.dataIndexes=this.columnsPreference.availableDataIndexes,this.dataIndexes},d.prototype.getAutoReloadNames=function(){return this.columnsPreference.addAutoPatterns},d.prototype.setPreferenceProxy=function(e){d.prototype.setPreference=e.setPreference,d.prototype.getPreference=e.getPreference,d.prototype.relationsColumnsList=e.relationsColumnsList,this.columnsPreference=this.getPreference();var t={};this.columnsPreference&&(t=JSON.parse(this.columnsPreference)),this._buildDefaultConfiguration(this.relationsColumnsList),this.columnsPreference=UWA.extend(this.columnsPreference,t,!0),this.setPreference(JSON.stringify(this.columnsPreference)),this.columnsPreference.addAutoPatterns&&this.columnsPreference.addAutoPatterns.length>0&&(this.alwaysUpdate=!0)},d.prototype.hasStructureModelUpdate=function(){return!(!that.columnsPreference.addAutoPatterns||!that.columnsPreference.addAutoPatterns.length)},d.prototype.setupDGVManipulation=function(e){d.prototype.addColumns=e.onAddColumn,d.prototype.removeColumns=e.onRemoveColumn},d.prototype.toBeUpdated=function(e,t){if("SyncModelRefresh"===t||"SyncModelNodes"===t||"OnSyncModel"===t)return!0;for(var n=!1,o=Object.keys(e),s=0;s<o.length&&!1===n;s++)""!==e[o[s]]&&void 0!==e[o[s]]||(n=!0);return n},d.prototype._forceUpdateAttributes=function(e){this.updateAttributes(e.nodesToUpdate,e.callback,e.treedocument)},d.prototype.updateAttributes=function(e,t,o){var s={pids:{},relids:{}},i=this;e.pids.forEach(function(e){s.pids[e]||(s.pids[e]={});for(var t=0;t<i.dataIndexes.length;t++)s.pids[e][i.dataIndexes[t]]=void 0});var a=[],r=new Promise(function(t){n.getCount({ids:e.pids,relations:i.dataIndexes}).then(function(t){e.pids.forEach(function(e){for(var t=0;t<i.dataIndexes.length;t++)s.pids[e][i.dataIndexes[t]]=0});for(var n=(t="string"==typeof t?JSON.parse(t):t).New.Counts,o=0;o<n.length;o++)s.pids[n[o].source][n[o].name]=parseInt(n[o].count)}).finally(t)});a.push(r),a.push(new Promise(function(t){r.then(function(){i._autoAddInView({pids:e.pids,updatedAttributes:s,treedocument:o}).then(t)})})),Promise.all(a).then(function(){"function"==typeof t&&t(s)})},d.prototype.getAdditionalColumnsUXDGV=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].dataIndex);0===this.dataIndexes.length&&this.getManagedColumnNames();for(var o=0;o<this.dataIndexes.length;o++){var s=this.dataIndexes[o],i=this.columnsPreference.patterns[s]&&this.columnsPreference.patterns[s].nlsPatternAMD,a=require(i),r=this._buildDGVColumn(this.dataIndexes[o]),l=t.indexOf(s),d=s;-1===l?(r.text=a[d]?a[d]:"",e.push(r)):(e[l]=UWA.extend(e[l],r,!0),e[l].text=a[d]?a[d]:"")}},d.prototype.provideDisplayTooltip=function(e){var n=null;return e.nodeModel&&-1!==this.dataIndexes.indexOf(e.dataIndex)&&(n=t[e.dataIndex]&&t[e.dataIndex].columnTooltip?t[e.dataIndex].columnTooltip:""),n},d.prototype.getTypeRepresentations=function(){for(var e={relColNone:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"",fontIconFamily:WUXManagedFontIcons.Font3DS}}},relColLoading:{stdTemplate:"functionIcon",semantics:{className:"relationRefresh",icon:{iconName:"reload wux-ui-3ds-spin",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},t=Object.keys(this.columnsPreference.patterns),n=0;n<t.length;n++)this.columnsPreference.patterns[t[n]].typeRepresentations&&(e=Object.assign(e,this.columnsPreference.patterns[t[n]].typeRepresentations)),e[t[n]+"Check"]||(e[t[n]+"Check"]={stdTemplate:"functionIcon",semantics:{icon:{iconName:"check",fontIconFamily:WUXManagedFontIcons.Font3DS}}});return e},d.prototype.getOnCellClickCB=function(e){if(-1!==this.dataIndexes.indexOf(e)){var t=this;return function(i){if(i.nodeModel){var a=i.nodeModel,r=a.getTreeDocument();if(r.unselectAll(),i.nodeModel.options.grid[e]>0){var l=a.getID(),d=o.createOutputsRequest("fetch"),c=a.options.icons;c[0].badges||(c[0].badges={}),c[0].badges.topRight={iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"},a.updateOptions({icons:c}),n.getDetail({id:l,relations:[e],attributes_for_detailview:d.select_predicate?d.select_predicate:d.select_object}).then(function(n){n="string"==typeof n?JSON.parse(n):n,r.withTransactionUpdate(function(){for(var o=n.newstructure[e],i=(a.getState(),0);i<o.length;i++){var l=o[i],d=a.getNodesByRelId(l.relation);if(0===d.length){var c=t._buildNode(l),p=u(r,a,c,!0);s.updateNLS(p),p.select()}else{d[0].select();var h=d[0]._parentNode;h&&h.setState({state:"expanded"})}}t._showGroupingNodes({treeDoc:r});var g=UWA.clone(a.options.icons);g[0].badges&&(g[0].badges.topRight=null),a.updateOptions({icons:g})})})}}}}},d.prototype.getAdditionalCtxMenu=function(e){var n,o=!1;"datagridview"===e.view&&(o=-1===e.ctxParams.cellInfos.rowID,n=e.ctxParams.collectionView.getColumnOrGroup(e.ctxParams.cellInfos.columnID).dataIndex);var s=[];"tree"===n&&!0===o?(d.groupingNodeHidden?s.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye"},title:t.ctxCommands.showRelated,action:{callback:function(){r.publish({event:"ENXRelationsCol/ShowGroupingNodes",data:{treeDoc:e.treeDocument}}),d.groupingNodeHidden=!1,localStorage.setItem("enx-relation-groupingNode-hide_"+a.getAppId(),"false")}}}):s.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},title:t.ctxCommands.hideRelated,action:{callback:function(t){r.publish({event:"ENXRelationsCol/HideGroupingNodes",data:{treeDoc:e.treeDocument}}),d.groupingNodeHidden=!0,localStorage.setItem("enx-relation-groupingNode-hide_"+a.getAppId(),"true")}}}),e.callback(this.getName(),s)):e.callback(null)},d.prototype.resetConfiguration=function(){var t=[],n=[];this.relationColumnsDef=JSON.parse(e);for(var o=Object.keys(this.relationColumnsDef.patterns),s=0;s<o.length;s++){var i=this.relationColumnsDef.patterns[o[s]];if("boolean"==typeof i.dgvColumnAvailable)if(this.columnsPreference.patterns[o[s]]){if(this.columnsPreference.patterns[o[s]].dgvColumnAvailable!==i.dgvColumnAvailable)if(!0===i.dgvColumnAvailable){a=this._buildDGVColumn(o[s]),r=this.columnsPreference.patterns[o[s]]&&this.columnsPreference.patterns[o[s]].nlsPatternAMD,l=require(r);a.text=l[o[s]]?l[o[s]]:"",t.push(a)}else n.push({dataIndex:o[s]})}else if(this.columnsPreference.patterns[o[s]]=i,!0===i.dgvColumnAvailable){var a=this._buildDGVColumn(o[s]),r=this.columnsPreference.patterns[o[s]]&&this.columnsPreference.patterns[o[s]].nlsPatternAMD,l=require(r);a.text=l[o[s]]?l[o[s]]:"",t.push(a)}}t.length>0&&this.addColumns&&this.addColumns({addedColumns:t}),n.length>0&&this.removeColumns&&this.removeColumns({removedColumns:n}),this._buildDefaultConfiguration(this.relationsColumnsList),this.columnsPreference.addAutoPatterns&&this.columnsPreference.addAutoPatterns.length>0&&(this.alwaysUpdate=!0),this.setPreference(JSON.stringify(this.columnsPreference))},d.prototype.updateConfiguration=function(e){for(var t=Object.keys(e),n=[],o=[],s=0;s<t.length;s++){if("boolean"==typeof e[t[s]].dgvColumnAvailable)if(this.columnsPreference.patterns[t[s]].dgvColumnAvailable=e[t[s]].dgvColumnAvailable,!0===this.columnsPreference.patterns[t[s]].dgvColumnAvailable){var i=this._buildDGVColumn(t[s]),a=this.columnsPreference.patterns[t[s]]&&this.columnsPreference.patterns[t[s]].nlsPatternAMD,r=require(a);i.text=r[t[s]]?r[t[s]]:"",n.push(i)}else o.push({dataIndex:t[s]});"boolean"==typeof e[t[s]].autoAdd&&(this.columnsPreference.patterns[t[s]].autoAdd=e[t[s]].autoAdd)}n.length>0&&this.addColumns&&this.addColumns({addedColumns:n}),o.length>0&&this.removeColumns&&this.removeColumns({removedColumns:o}),this._rebuildConfiguration(),this.columnsPreference.addAutoPatterns&&this.columnsPreference.addAutoPatterns.length>0&&(this.alwaysUpdate=!0),this.setPreference(JSON.stringify(this.columnsPreference))},d.prototype._buildDGVColumn=function(e){var t={dataIndex:e,alignment:"center",editableFlag:!1,sortableFlag:!1,width:50,minWidth:50,visibleFlag:!1,isAdditionalColumn:!0,getCellTypeRepresentation:function(t){if(t.nodeModel){var n=t.nodeModel.options.grid[e];return!0===t.nodeModel.isRelationsObjectNode?"relColNone":void 0!==n&&""!==n?n>0?e+"Check":"relColNone":"relColLoading"}},getCellSemantics:function(t){if(t.nodeModel){var n=t.nodeModel.options.grid[e];if(void 0===n||""===n||0===n)return{disabled:!0}}},customisation:{dataIndex:e,exportable:{lock:!1,value:!1},layout:{removable:!1}}},n=this.columnsPreference.patterns[e]&&this.columnsPreference.patterns[e].dgvOpts?this.columnsPreference.patterns[e].dgvOpts:{};return t=UWA.extend(t,n),UWA.clone(t)},d.prototype._autoAddInView=function(e){var t=this;return new Promise(function(i){if(e.treedocument&&t.columnsPreference.addAutoPatterns&&t.columnsPreference.addAutoPatterns.length){var a,r=e.pids,l=[],d=t.columnsPreference.addAutoPatterns,c=e.treedocument,p=o.createOutputsRequest("fetch");for(a=0;a<r.length;a++){c.getNodesById(r[a]).forEach(function(e){if(!0!==e.isRelationsObjectNode){var t=e.options.icons;t[0].badges||(t[0].badges={}),t[0].badges.topRight={iconName:"reload wux-ui-3ds-spin",fontIconSize:"1x",className:"dgv-badge-top"},e.updateOptions({icons:t})}})}n.getDetail({ids:r,relations:d,attributes_for_detailview:p.select_predicate?p.select_predicate:p.select_object}).then(function(e){e="string"==typeof e?JSON.parse(e):e,c.withTransactionUpdate(function(){for(a=0;a<d.length;a++){var n=d[a],o=e.newstructure[n];if(o)for(var p=0;p<o.length;p++){var h=o[p],g=h.relation.substring(0,h.relation.indexOf("_"));-1===l.indexOf(g)&&l.push(g);for(var f=c.getNodesById(g),m=0;m<f.length;m++){var v=f[m];if(!0!==v.isRelationsObjectNode){if(0===v.getNodesById(h.id).length){var b=t._buildNode(h),C=u(c,v,b);s.updateNLS(C)}var P=UWA.clone(v.options.icons);P[0].badges&&(P[0].badges.topRight=null),v.updateOptions({icons:P})}}}}for(a=0;a<r.length;a++){if(-1===l.indexOf(r[a]))(f=c.getNodesById(r[a])).forEach(function(e){var t=UWA.clone(e.options.icons);t[0].badges&&(t[0].badges.topRight=null),e.updateOptions({icons:t})})}i()})}).catch(function(e){console.warn("Retrieve the pattern fails:"+JSON.stringify(e)),i()})}else i()})},d.prototype._buildDefaultConfiguration=function(e){var t=[];if(Array.isArray(e))for(var n=Object.keys(this.relationColumnsDef.patterns),o=0;o<e.length;o++)-1!==n.indexOf(e[o])&&t.push(e[o]);this.columnsPreference=this.relationColumnsDef,this.columnsPreference.availableDataIndexes=t,this.dataIndexes=t,this.columnsPreference.addAutoPatterns=[]},d.prototype.setHardcodedConfiguration=function(e){var t=[],n=[],o=Object.keys(this.relationColumnsDef.patterns);if(d.groupingNodeHidden=!1,l.hasOwnProperty(e)){console.log("set harcoded configuration for "+e+" : "+l.key);for(var s=0;s<l[e].length;s++)-1!==o.indexOf(l[e][s])&&n.push(l[e][s])}this.columnsPreference=this.relationColumnsDef,this.columnsPreference.availableDataIndexes=t,this.dataIndexes=t,this.columnsPreference.addAutoPatterns=n,this.columnsPreference.addAutoPatterns&&this.columnsPreference.addAutoPatterns.length>0&&(this.alwaysUpdate=!0)},d.prototype._rebuildConfiguration=function(){for(var e=[],t=[],n=Object.keys(this.columnsPreference.patterns),o=0;o<n.length;o++)!0===this.columnsPreference.patterns[n[o]].dgvColumnAvailable&&e.push(n[o]),!0===this.columnsPreference.patterns[n[o]].autoAdd&&t.push(n[o]);this.columnsPreference.availableDataIndexes=e,this.dataIndexes=e,this.columnsPreference.addAutoPatterns=t},d.prototype._buildNode=function(e){for(var t=o.createOutputsRequest("fetch"),n={resourceid:e.id,relationid:e.relation,label:e["ds6w:label"],icons:[{iconPath:"url("+e.icon_url+")",className:"dgv-icons"}],type:e["ds6w:type"],thumbnail:e.thumbnail,relationOrder:-2,grid:{thumbnail:e.thumbnail},children:null},s=t.select_predicate?t.select_predicate:t.select_object,i=0;i<s.length;i++)"ds6w:label"!==s[i]&&(n.grid[s[i]]=e[s[i]]);return n},d.prototype.hasHiddenGroupingNodes=function(){return this._hiddenGroupingNodes&&this._hiddenGroupingNodes.length},d.prototype._addGroupingNodes=function(e){var t=e.groupingNode,n=e.rootId;t&&n&&(this._groupingNodes||(this._groupingNodes={}),this._groupingNodes[n]||(this._groupingNodes[n]=[]),this._groupingNodes[n].push(t))},d.prototype._showGroupingNodes=function(e){if(this._groupingNodes){var t=this;e.treeDoc.withTransactionUpdate(function(){for(var e=Object.keys(t._groupingNodes),n=0;n<e.length;n++)for(var o=t._groupingNodes[e[n]],s=0;s<o.length;s++){o[s].show();var i=o[s]._parentNode;i&&"expanded"!==i.getState()&&i.setState({state:"partiallyExpanded"})}})}d.groupingNodeHidden=!1},d.prototype._hideGroupingNodes=function(e){if(this._groupingNodes){var t=this;e.treeDoc.withTransactionUpdate(function(){for(var e=Object.keys(t._groupingNodes),n=0;n<e.length;n++)for(var o=t._groupingNodes[e[n]],s=0;s<o.length;s++)o[s].hide()})}d.groupingNodeHidden=!0},d.prototype._cleanupGroupingNodes=function(e){if(this._groupingNodes){var t=e.data.nodeModel;if(t&&t.isRoot())this._groupingNodes[t.getID()]&&delete this._groupingNodes[t.getID()];else{var n=t.getRoot();n&&this._groupingNodes[n.getID()]&&(this._groupingNodes[n.getID()]=this._groupingNodes[n.getID()].filter(function(e){return-1!==e.getOccurencePath().indexOf(t.getID())}))}}},new d}),define("DS/ENORIPE_Columns/RelationsColumnsCmd",["DS/ENORIPE_Columns/RelationsColumns","DS/ApplicationFrame/Command","css!DS/ENORIPE_Columns/ENORIPE_Columns","i18n!DS/ENORIPE_Columns/assets/nls/ENORIPE_Columns","DS/Controls/Button","DS/Controls/Accordeon","DS/Controls/Toggle","DS/PADUtils/PADContext"],function(e,t,n,o,s,i,a,r){"use strict";return t.extend({init:function(e){this._parent(e);var t=r.get();this._checkIfTreeview(),UWA.is(t.addEvent,"function")&&t.addEvent("onToggleView",this._checkIfTreeview.bind(this))},execute:function(){var t=this;this.columnsPreference=JSON.parse(e.getPreference()),this.changes={},require(["DS/ENOFloatingPanel/ENOFloatingPanel"],function(e){t.elements={},t._buildContent().then(function(){t.elements.floatingpanel=new e({className:"enx-relationcolmgt",body:t.elements.container,footer:t._buildFooter(),title:o.relationsColumnsMgt.title,overlay:!0,closable:!0,animate:!0,resizable:!0,visible:!0,events:{onClose:function(){t.elements.floatingpanel.destroy()}}}),t.elements.floatingpanel.inject(document.body)})})},_buildContent:function(){return new Promise(function(t){this.elements.container=document.createElement("div"),this.elements.container.classList.add("enx-relmgt-container");var n=e.relationColumnsDef;this.columnsPreference.addAutoPatterns||(this.columnsPreference.addAutoPatterns=[]);var s=e.relationsColumnsList,r=this,l=function(t){var n=document.createElement("div");n.classList.add("enx-relmgt-expander"),n.classList.add(t);var s=-1!==e.dataIndexes.indexOf(t),i=new a({type:"switch",label:o.relationsColumnsMgt.columnAvailable,value:t,checkFlag:s,touchMode:!0});n.appendChild(i.getContent()),i.addEventListener("change",r._colAvailablityMgt.bind(r));var l=-1!==r.columnsPreference.addAutoPatterns.indexOf(t),d=new a({type:"switch",label:o.relationsColumnsMgt.autoAdd,value:t,checkFlag:l,touchMode:!0});n.appendChild(d.getContent());var u=document.createElement("div");return u.classList.add("enx-relmgt-autoAddInfo"),u.classList.add(t),u.innerText=o.relationsColumnsMgt.autoAddInfo,!0===l?u.removeAttribute("hidden"):u.setAttribute("hidden",""),n.appendChild(u),d.addEventListener("change",r._autoAddMgt.bind(r)),n};if(1===s.length){this.elements.container.classList.add("enx-relmgt-single-pattern");var d=n.patterns[s[0]],u=require(d.nlsPatternAMD),c=document.createElement("div");c.classList.add("enx-relmgt-title-pattern"),c.innerText=u[s[0]],this.elements.container.appendChild(c);var p=l(s[0]);this.elements.container.appendChild(p)}else if(s.length>1){var h=this.elements.accordion=new i({style:"filled-separate",exclusive:!1});this.elements.container.appendChild(h.getContent());for(var g=0;g<s.length;g++){p=l(s[g]),d=n.patterns[s[g]],u=require(d.nlsPatternAMD);h.addItem({header:u[s[g]],body:p,expandedFlag:!0})}}t()}.bind(this))},_buildFooter:function(){var t=this,n=UWA.createElement("div",{class:"footerModal"}),i=new s({label:o.relationsColumnsMgt.save,emphasize:"primary",touchMode:!0});i.addEventListener("click",function(){e.updateConfiguration(t.changes),t.elements.floatingpanel.destroy()}),i.inject(n);var a=new s({label:o.relationsColumnsMgt.reset,emphasize:"secondary",touchMode:!0});a.addEventListener("click",function(){e.resetConfiguration(),t.elements.floatingpanel.destroy()}),a.inject(n);var r=new s({label:o.relationsColumnsMgt.cancel,emphasize:"secondary",touchMode:!0});return r.addEventListener("click",function(){t.elements.floatingpanel.destroy()}),r.inject(n),n},_colAvailablityMgt:function(e){this.changes[e.dsModel.value]||(this.changes[e.dsModel.value]={}),this.changes[e.dsModel.value].dgvColumnAvailable=e.dsModel.checkFlag},_autoAddMgt:function(e){this.changes[e.dsModel.value]||(this.changes[e.dsModel.value]={}),this.changes[e.dsModel.value].autoAdd=e.dsModel.checkFlag;var t=this.elements.container.getElementsByClassName("enx-relmgt-autoAddInfo "+e.dsModel.value);1===t.length&&(!0===e.dsModel.checkFlag?(this.elements.container.classList.add("withAutoAddInfo"),t[0].removeAttribute("hidden")):(this.elements.container.classList.remove("withAutoAddInfo"),t[0].setAttribute("hidden","")),this.elements.floatingpanel.onResize())},_checkIfTreeview:function(){switch(r.get().getCurrentView()){case"datagridview":this.enable();break;default:this.disable()}}})});