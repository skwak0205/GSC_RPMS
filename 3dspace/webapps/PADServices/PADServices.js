/*!  COPYRIGHT DASSAULT SYSTEMES 2019   */
define("DS/PADServices/views/ProgressDialog",["DS/Windows/Dialog","DS/Controls/ProgressBar","DS/Utilities/Dom","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame"],function(e,t,n,i,o){"use strict";function s(s){this.options=s||{},this.options=Object.assign({width:230,height:45,progressBar:{displayStyle:"lite",infiniteFlag:!0},renderTo:document.body},this.options),this.elements={},this.elements.immframe=new o,this.elements.immframe.getContent().addClassName("enxprogressive-immframe"),this.elements.progressBar=new t(this.options.progressBar),this.elements.dialog=new e({immersiveFrame:this.elements.immframe,title:this.options.title,content:this.elements.progressBar.getContent(),closeButtonFlag:!1,width:this.options.width,height:this.options.height,showTitleFlag:!1}),this.elements.dialog.getContent().setStyle("z-index",void 0),n.addEndResizeListener(this.options.target,this.setPosition.bind(this),100),this.setPosition(),i.createModal(this.options.target,this.elements.immframe.getContent()),this.options.modalOpened=!0,document.querySelector(".wux-controls-modalContent").addEventListener("click",function(e){n.firstParentWithClass(e.target,"wux-windows-window-content")||"function"!=typeof this.options.events.onClickOutsideContent||this.options.events.onClickOutsideContent()}.bind(this))}return s.prototype.setProgress=function(e){this.elements.progressBar.value=e},s.prototype.setPosition=function(){if(this.elements.container){var e=this.options.renderTo.getBoundingClientRect(),t={x:e.x+(e.width/2-this.options.width/2),y:e.x+(e.height/2-this.options.height/2)};this.elements.container.getContent().setStyles({left:t.x,top:t.y})}},s.prototype.close=function(){delete this.elements.progressBar,this.options.modalOpened=!1,this.elements.dialog.destroy(),this.elements.dialog=null,delete this.elements.immframe,this.elements.immframe=null,i.removeModal(this.options.target)},s}),define("DS/PADServices/views/ENXDropTarget",["text!DS/PADServices/assets/templates/dropArea.html","css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/Handlebars/Handlebars","DS/Core/Core","DS/Utilities/Dom"],function(e,t,n,i,o,s){"use strict";var r=i.compile(e),a=function(e){this.options=Object.assign({show:!1,isOver:!1,backgroundOnDefault:!1},e),this.elements={};let t={openTitle:n.dropTarget.openTitle,openInCtxTitle:n.dropTarget.openInCtxTitle,openAndFilterTitle:n.dropTarget.openAndFilterTitle};var i=document.createElement("div");i.innerHTML=r(t).trim(),this.elements.container=i.firstChild,!0!==this.options.show?this.elements.container.style.visibility="hidden":this.elements.container.style.visibility="visible";var o=this.elements.container.getElementsByClassName("enx-drop-zone");for(let e=0;e<o.length;e++)this.__addDnDCB(o[e]);this.elements.defaultDrop=this.elements.container.querySelector(".enx-drop-default"),!0===this.options.backgroundOnDefault&&this.elements.container.classList.add("withbackground")};function l(e){return e.preventDefault(),e.stopPropagation(),!1}return a.prototype.render=function(){return this.elements.container},a.prototype.show=function(){this.elements.container.style.visibility="visible"},a.prototype.hide=function(){if(this.elements.container.style.visibility="hidden",!0===this.options.isOver){this.options.isOver=!1;let e=this.elements.container.getElementsByClassName("enx-drop-zone");for(let t=0;t<e.length;t++)e[t].classList.remove("hover")}},a.prototype.getMainClassName=function(){return"enx-droptarget"},a.prototype.isOver=function(){return this.options.isOver},a.prototype.onOpenInCtx=function(e){},a.prototype.onOpenAndFilter=function(e){},a.prototype.__addDnDCB=function(e){e.addEventListener("drop",this.__dropped.bind(this)),e.addEventListener("dragenter",l),e.addEventListener("dragover",this.__dragOver.bind(this)),e.addEventListener("dragleave",this.__dragLeave.bind(this))},a.prototype.__dropped=function(e){e.preventDefault(),e.stopPropagation();let t=s.firstParentWithClass(e.target,"enx-open-ctx")?"openCtx":s.firstParentWithClass(e.target,"enx-open-filter")?"openFilter":null;return"openCtx"===t?this.onOpenInCtx(e):"openFilter"===t&&this.onOpenAndFilter(e),this.hide(),!1},a.prototype.__dragOver=function(e){e.preventDefault(),e.stopPropagation();let t=s.firstParentWithClass(e.target,"enx-open-ctx")||s.firstParentWithClass(e.target,"enx-open-filter");return t&&(this.options.isOver=!0,t.classList.add("hover"),this.elements.container.classList.remove("hover")),!1},a.prototype.__dragLeave=function(e){e.preventDefault(),e.stopPropagation();let t=s.firstParentWithClass(e.target,"enx-open-ctx")||s.firstParentWithClass(e.target,"enx-open-filter");return t&&(this.options.isOver=!1,t.classList.remove("hover"),this.elements.container.classList.add("hover")),!1},a}),define("DS/PADServices/utils/Generics",["UWA/Core"],function(e){const t={ARRAY:"array",STRING:"string",NUMBER:"number",FUNCTION:"function",OBJECT:"object"};function n(t,n){return e.is(t,n)}function i(e){return function(t){return n(t,e)}}const o={string:i(t.STRING),array:i(t.ARRAY),number:i(t.NUMBER),function:i(t.FUNCTION),object:i(t.OBJECT)};return{clone:e.clone,merge:e.merge,typeOf:e.typeOf,checks:o,is:e.is,isType:n,TYPES:t}}),define("DS/PADServices/utils/Iterator",[],function(){function e(e,t){if(Array.isArray(e)){var n=e.length;if(n)for(var i=0;i<n;i++){t(e[i],i,e)}}}return{iterate:e,iterateControl:function(e,t){if(Array.isArray(e)){var n=e.length;if(n)for(var i=0;i<n;i++){let n=t(e[i],i,e);if(n&&n.break)break;!n||n.continue}}},iterateObj:function(t,n){e(Object.keys(t),function(e){var i=t[e];n(i,e,t)})},iterateMap:function(e,t){var n=e.keys();for(let i of n)t(e.get(i),i)}}}),define("DS/PADServices/utils/WaitingPromise",[],function(){function e(){let e=this;this._promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return e.prototype={then:function(e,t){e&&t?this._promise.then(e,t):this._promise.then(e)},catch:function(e){this._promise.catch(e)}},e}),define("DS/PADServices/utils/SubscriptionHolder",[],function(){function e(e){this.modelEvents=e,this.subscriptions=[]}return e.prototype={subscribe:function(e,t){this.subscriptions.push(this.modelEvents.subscribe(e,t))},destroy:function(){for(var e=0;e<this.subscriptions.length;e++){var t=this.subscriptions[e];this.modelEvents.unsubscribe(t)}}},e}),define("DS/PADServices/views/private/Iconbar",["css!DS/PADServices/PADServices.css","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Event","UWA/Utils","UWA/Controls/Abstract","DS/UIKIT/Menu","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],function(e,t,n,i,o,s,r,a,l){"use strict";var d=n.Utils.Client.Features.touchEvents;var c,p=(c=/^(divider)$/,function(e){var t,n,i=!1;if(!e)return!1;for(t=e.split(" "),n=0;n<t.length&&!1===i;n++)c.test(t[n])&&(i=!0);return i}),u=r.extend({name:"iconbar-items",templateClassname:"iconbar-template"}),h=l.extend({show:function(){document.body.style.overflow="hidden",this._parent(),document.body.style.overflow="auto"}});return s.extend({name:"iconbar",menu:null,overflowMenu:null,overflowMenuTrigger:null,init:function(e){if(void 0===e.renderTo)throw new Error("renderTo options is Mandatory");this._parent(e),this.buildSkeleton(),this.handleEvents(),this.show()},buildSkeleton:function(){var e=this.elements,t=this.options;e.container||(this.menu=new u({multiSelect:t.multiSelect}),this.addItem(t.items),e.container=this.menu.elements.container,e.container.className=this.getClassNames(),e.container.addClassName("enx-iconbar"),t.renderTo&&1===t.renderTo.nodeType&&(e.container.inject(t.renderTo),delete t.renderTo))},buildOverflowMenu:function(){var e,t,i=[];this.overflowMenuTrigger||(this.overflowMenuTrigger=n.createElement("li",{class:this.name+"-overflow-menu-trigger item",html:{tag:"span",class:"fonticon fonticon-menu-dot"}})),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenu=null,this.menu.items.forEach(function(n){n.content&&"dropdown"===n.content.type||(t=!0,e={className:(n.id+" "+(n.className?n.className:"")).trim(),fonticon:n.fonticon,text:n.text,name:n.name,handler:n.handler,selectable:n.selectable,selected:n.selected,disabled:n.disabled},n.content&&n.content.options.items&&"icondropdown"!==n.content.type?e.items=n.content.options.items.map(function(e){return e.className=(n.id+" "+(e.className?e.className:"")).trim(),e.selectable=!0,e}):n.content&&"icondropdown"===n.content.type&&(t=!1,n.content.options.items&&n.content.options.items.forEach(function(e){i.push({className:(n.id+" "+(e.className?e.className:"")).trim(),fonticon:e.fonticon,icon:e.icon,handler:e.handler,text:e.description})})),t&&i.push(e))}),this.overflowMenu=new h({multiSelect:this.options.multiSelect,items:i,target:this.overflowMenuTrigger,events:this.options.events})},getItem:function(e){var t,n,i,o=!1;for(t=0,n=this.menu.items.length;t<n;t++){if(o=this.menu.items[t],e&&e.nodeType){if(i=e.hasClassName("item")?e:e.getParent(),o.id===i.id)break}else if(t===e||o.id===e||o.name===e)break;o=!1}return o},handleEvents:function(){var e,t,n,o;this.events={container:{click:function(e){var t=i.getElement(e),n=this.getItem(t);n.selectable&&this.select(n.name,!n.selected),n&&(n.content&&(window.requestAnimationFrame?window.requestAnimationFrame(this.displayContent.bind(this,n)):this.displayContent(n)),n.tooltip&&n.tooltip.isVisible&&!d&&n.tooltip.hide(),this.dispatchEvent("onClick",[e,n],this),"function"==typeof n.handler&&n.handler.call(this,e,n))}.bind(this)}},this.elements.container.addEvents(this.events.container),this.events.window={resize:(e=this.resize,t=100,function(){var i,s=this,r=arguments;i=n&&!o,clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(s,r)},t),i&&e.apply(s,r)}).bind(this)},window.addEventListener("resize",this.events.window.resize)},addItem:function(e){return o.splat(e).forEach(function(e){this._addItem(e)},this),this.buildOverflowMenu(),this},_addItem:function(e){var t=this.menu._addItem(e);t.content=t.innerComponent||t.content,!p(e.className)&&t.text&&(t.tooltip=new a({target:t.elements.container,body:t.text,trigger:t.tooltipTrigger||this.options.tooltipsTrigger||"hover focus"}),t.tooltip.getContent().addClassName("enx-tooltip-iconbar"),t.elements.container.getElement(".item-text").remove())},isOverflowing:function(){return this.menu.items.some(function(e){return!e.elements.container.isInViewport(this.elements.container,!0,!0)}.bind(this))},isInjected:function(){if(this.elements&&this.elements.container)return this.elements.container.isInjected()},resize:function(){function e(e){this.overflowMenu.items.forEach(function(t){e.some(function(e){return!!t.className&&(t.className&&-1!==t.className.indexOf(e))})?t.elements.container.removeClassName("hidden"):t.elements.container.addClassName("hidden")})}return function(){if(this.elements.container){var t,n;if(this.overflowMenuTrigger&&this.overflowMenuTrigger.isInjected()&&this.overflowMenuTrigger.remove(),this.overflowMenu.isVisible&&this.overflowMenu.hide(),this.elements.container&&!this.isOverflowing())return;if(n=(t=function(){var e=this.elements.container.getBoundingClientRect();return this.menu.items.filter(function(t){var n=t.elements.container.getBoundingClientRect();return n.top+n.height>e.bottom||n.left+n.width>e.right},this)}.call(this)).map(function(e){return e.id}),e.call(this,n),t.length)for(this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,t[0].elements.container);!this.overflowMenuTrigger.isInViewport(this.elements.container,!0,!0)&&this.overflowMenuTrigger.previousSibling;)this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,this.overflowMenuTrigger.previousSibling),t.push(this.overflowMenuTrigger.nextSibling),this.overflowMenuTrigger.nextSibling.id&&n.push(this.overflowMenuTrigger.nextSibling.id),e.call(this,n)}}}(),displayContent:function(e){var t=n.clone(e.content.options);if(t.target=e.elements.container,e.content.created)e.content.component&&e.content.component.show();else{if("dropdown"===e.content.type)require(["DS/UIKIT/Dropdown"],function(n){e.content.component=new n(t).show()});else if("icondropdown"===e.content.type)require(["DS/UIKIT/IconDropdown"],function(n){e.content.component=new n(t).show()});else{if("dropdownmenu"!==e.content.type)return;e.content.component=new l(t).show(),e.content.component.getContent().addClassName("enx-dropdown-iconbar")}e.content.created=!0}},select:function(){var e,t,n,i,o=arguments;void 0!==o[0]&&null!==o[0]&&(t=void 0===o[1]||o[1],!0!==this.options.multiSelect&&(t&&function(e,t){for(var n=e.length,i=0;i<n;i++)t(e[i],i)}(this.elements.container.querySelectorAll(".selected"),function(e){e.removeClassName&&e.removeClassName("selected")}),t&&this.overflowMenu.getSelectedItems().forEach(function(e){this.overflowMenu.menus[0].toggleSelection(e),e.elements.container.removeClassName("selectable")},this)),(e=this.getItem(o[0])).selected=t,e&&!e.elements.container.hasClassName("divider")&&(e.elements.container[t?"addClassName":"removeClassName"]("selected"),n=e.elements.container.id,1===(i=this.overflowMenu.items.filter(function(e){return e.elements.container.hasClassName(n)})).length&&(this.overflowMenu.menus[0].toggleSelection(i[0]),i[0].elements.container.addClassName("selectable"),i[0].selected=t)))},enableItem:function(e){this.menu.enableItem(e);var t=this.getItem(e);t&&(t.disabled=!1)},disableItem:function(e){this.menu.disableItem(e);var t=this.getItem(e);t&&(t.disabled=!0)},show:function(){this.isInjected()&&(this._injectionObserver&&this._injectionObserver.disconnect(),this._injectionObserver=null,this._parent(),window.requestAnimationFrame?window.requestAnimationFrame(this.resize.bind(this)):this.resize())},destroy:function(){window.removeEventListener("resize",this.events.window.resize),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenuTrigger&&this.overflowMenuTrigger.destroy(),this.elements.container.removeEvents(this.events.container),this.menu.items.forEach(function(e){e.tooltip&&e.tooltip.destroy()}),this._parent()}})}),define("DS/PADServices/utils/PromiseCompletion",[],function(){function e(e){if(this.options=e,!this.options.promise||!this.options.before||!this.options.after)throw Error("Key parameter missing");this._start()}return e.prototype={_start:function(){this.options.before();var e=this._complete.bind(this);this.options.promise.then(e).catch(e)},_complete:function(){this.options.after()}},e}),define("DS/PADServices/utils/PersistBlob",[],function(){function e(e){this.options=e,this._readData(),this._data||(this._data={_internals:{version:this.options.version,timestamp:Date.now()}})}return e.prototype={_readData:function(){this._data=this.options.storageWrapper.get(this.options.key),this._data&&this.options.versionConverter&&(this._data=this.options.versionConverter(this._data))},save:function(){this._data._internals?(this._data._internals.version=this.options.version,this._data._internals.timestamp=Date.now()):this._data={_internals:{version:this.options.version,timestamp:Date.now()}},this.options.storageWrapper.set(this.options.key,this._data)}},Object.defineProperties(e.prototype,{data:{get:function(){return this._data}}}),e}),define("DS/PADServices/views/private/ComboSelector",["css!DS/PADServices/PADServices.css","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/ContextualMenu","DS/Menu/Menu","DS/Core/Core"],function(e,t,n,i,o,s,r){"use strict";return n.extend(i,{defaultOptions:{treedocument:null,disabled:!1},init:function(e){this._parent(e);if(this.elements.container=t.createElement("div",{class:"comboSelector "+(e.className?e.className:"")}),this.elements.inner=t.createElement("div",{class:"comboSelector-inner"}).inject(this.elements.container),this.elements.text=t.createElement("div",{class:"comboSelector-text"}).inject(this.elements.inner),this.elements.expander=t.createElement("span",{class:"comboSelector-expander wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(this.elements.inner),this.elements.container.addEventListener("click",this._launchCtxMenu.bind(this)),this.elements.container.addEventListener("contextmenu",this._launchCtxMenu.bind(this)),null===this.options.treedocument)throw new Error("Invalid attribute in constructor. Missing treedocument");this.options.treedocument.getXSO().onPostAdd(this._redrawInnerText.bind(this)),this.options.treedocument.getXSO().onPostRemove(this._redrawInnerText.bind(this)),this.disabled(this.options.disabled),this._redrawInnerText()},disabled:function(e){e?(this.elements.container.setAttribute("disabled",""),this.options.disabled=e):(this.elements.container.removeAttribute("disabled",""),this.options.disabled=e)},_launchCtxMenu:function(e){var t=[];if(!1===this.options.disabled){for(var n=this.options.treedocument.getRoots(),i=0;i<n.length;i++){var o=n[i].options.icons&&n[i].options.icons.length&&n[i].options.icons[0].iconName?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+n[i].options.icons[0].iconName}:void 0;t.push({title:n[i].getLabel(),type:"CheckItem",state:n[i].isSelected()?"selected":void 0,fonticon:o,action:{this:this,context:n[i],callback:this._typeSelectedInMenu.bind(this)}})}if(t.length){var r=this.elements.container.getBoundingClientRect();s.show(t,{position:{x:r.left,y:r.bottom}})}}},_typeSelectedInMenu:function(e){var t=e.context;t.select(!0),this.dispatchEvent("onSelect",t),this.dispatchEvent("onSelectionChange"),this._redrawInnerText()},_redrawInnerText:function(){this.elements.text.empty();for(var e="",n=[],i=this.options.treedocument.getSelectedNodes(),o=0;o<i.length;o++)n.push(i[o].getLabel());if(e=n.length?n.join(", "):this.options.nlsEmptySelection,1===i.length&&i[0].options.icons){t.createElement("div",{class:"iconMenu wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+i[0].options.icons[0].iconName}).inject(this.elements.text);i[0].options.subLabel&&(this.elements.text.title=i[0].options.subLabel)}t.createElement("p",{text:e}).inject(this.elements.text)}})}),define("DS/PADServices/utils/NlsCache",[],function(){function e(){this.entries={}}let t;return e.prototype={store:function(e,t,n){this.entries[e]||(this.entries[e]={originals:{}}),this.entries[e].originals[t]=n},hasChange:function(e,t,n){let i={found:!1,hasChange:!1},o=this.entries[e];if(o){return i.found=!0,o.originals[n]!==t&&(i.hasChange=!0),i}return i}},t||(t=new e),t}),define("DS/PADServices/views/private/SearchInput",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Event","DS/Controls/ButtonGroup","DS/Controls/Button"],function(e,t,n,i,o,s,r,a){"use strict";return i.extend(o,{name:"enx-search-input",init:function(e){this._parent(e);this.elements.container=UWA.createElement("div",{class:this.getClassNames(e.className?e.className:"")}),this.elements.inner=UWA.createElement("div",{class:this.getClassNames("-inner")}).inject(this.elements.container);var n=UWA.createElement("div",{class:this.getClassNames("-input-container")}).inject(this.elements.inner);this.elements.input=UWA.createElement("input",{class:this.getClassNames("-input"),type:"text",placeholder:this.options.placeholder?this.options.placeholder:t.searchInput.placeholder}).inject(n);var i=UWA.createElement("div",{class:this.getClassNames("-right")}).inject(this.elements.inner),o=UWA.createElement("div",{class:this.getClassNames("-clear")+this.getClassNames("-btn")}).inject(i);this.elements.clearBtn=UWA.createElement("div",{class:this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear"),title:t.searchInput.clear}).inject(o),this.elements.clearBtn.hide();var s=UWA.createElement("div",{class:this.getClassNames("-search")+this.getClassNames("-btn")}).inject(i);this.elements.searchBtn=UWA.createElement("div",{class:this.getClassNames("-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search"),title:t.searchInput.search}).inject(s),this.elements.searchBtn.setStyle("opacity","0.1"),this.elements.searchBtn.addEventListener("click",this._onSearch.bind(this)),this.elements.clearBtn.addEventListener("click",this._onClearSearch.bind(this)),this.elements.input.addEventListener("keyup",this._onSearchInputKeyUp.bind(this)),this.elements.input.addEventListener("paste",this._onSearchInputPaste.bind(this)),this.elements.input.addEventListener("keydown",this._onSearchInputKeyDown.bind(this))},clear:function(e){this._onClearSearch(null,e)},_onSearch:function(e){this.elements.input.blur(),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onClearSearch:function(e,t){this.elements.input.value="",this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),!0!==t&&this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onSearchInputKeyUp:function(e){this.elements.input.value?(this.elements.searchBtn.setStyle("opacity","1"),this.elements.clearBtn.setStyle("display","inline-block"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})):(this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value}))},_onSearchInputPaste:function(e){var t=this;setTimeout(function(){t._onSearchInputKeyUp()}.bind(this),200)},_onSearchInputKeyDown:function(e){"return"!==s.whichKey(e)&&"Enter"!==e.keyIdentifier&&"return"!==e.keyIdentifier||this._onSearch(),s.stopPropagation(e)}})}),define("DS/PADServices/views/private/CustomColorView",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Class/View"],function(e,t,n){"use strict";return n.extend({className:"padcustomcolorview",name:"padcustomcolorview",template:function(){return'              <div data-label="'+this.model.get("label")+'" class="'+this.getClassNames("_cell")+'" style="background-color:'+this.model.get("background_color")+';">              <div class="'+this.getClassNames("_check")+' ">'+this.displayContent+"</div>              </div>"},domEvents:{"click .padcustomcolorview_cell":"_onSelect","click .padcustomcolorview_check":"_onSelect"},setup:function(e){var n=e||{};this._parent(n),"P_Preview"===this.model.get("label")?this.displayContent=t.colorView.content:this.displayContent=t.colorView.checkmark,this.model.addEvent("onChange:selected",this.render.bind(this)),this.model.addEvent("onChange:background_color",this.render.bind(this)),this.model.addEvent("onChange:color",this.render.bind(this)),"BG_Greyscale_8"!==this.model.get("label")&&"FG_Greyscale_1"!==this.model.get("label")||this.model.set("selected",!0)},render:function(){this.container.setHTML(this.template()),this.container.setStyle("background-color",this.model.get("background_color"));var e=this.model.get("background_color");return"P_Preview"===this.model.get("label")&&this.container.setStyle("cursor","default"),!0!==this.model.get("selected")&&"P_Preview"!==this.model.get("label")||(e=this.model.get("color")),this.container.setStyle("color",e),this.elements.padcustomcolorview=this.container,this},toggleSelected:function(){!0===this.model.get("selected")?(this.model.set("selected",!1),this.elements.padcustomcolorview.setStyle("color",this.model.get("background_color"))):(this.model.set("selected",!0),this.elements.padcustomcolorview.setStyle("color",this.model.get("color")))},isSelected:function(){return this.model.get("selected")},_onSelect:function(){this.toggleSelected(),this.dispatchEvent("select",this.model.get("label"))}})}),define("DS/PADServices/views/private/WizardSteps",["text!DS/PADServices/assets/templates/WizardSteps.html","css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars","DS/Core/Core","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,o,s,r,a){"use strict";var l=s.compile(e);return s.registerHelper("getlabel",function(e){for(var t=require("i18n!"+this.label.file),n=this.label.key.split("."),i=t,o=0;o<n.length;o++)i=i[n[o]];return i}),o.extend({name:"enx-wizard-container",defaultOptions:{subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeStep:null},init:function(e){this._parent(e),this.elements.container=i.createElement("div",{class:this.getClassNames()}),this.options.steps&&this.elements.container.setContent(l(this.options.steps)),this.options.renderTo&&this.elements.container.inject(this.options.renderTo),this.options.rope=this.elements.container.getElement("div.enx-wizard-rope"),this.options.navigator=this.elements.container.getElement("nav.enx-view-navigator");var t=this.elements.container.getElement("a.nav-item.active");if(t){var n=t.id;this._render2ActiveStep(n)}for(var o=this,s=this.options.navigator.getElements("a"),r=0;r<s.length;r++)s[r].addEventListener("click",function(e){var t=e.currentTarget.id;o.changeStep(t)});this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/changeStep"},function(e){var t=e.stepId;o.changeStep(t)}))},changeStep:function(e){this._render2ActiveStep(e),this.options.modelEvents.publish({event:"ENXViews/WizardSteps/stepChanged",data:{stepId:e}})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this._parent()},_render2ActiveStep:function(e){for(var t,n=this.options.navigator.getElements("a"),i=!1,o=0;o<n.length;o++){var s=n[o];if(!1===i?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===this.options.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");s.getElement(".view-icon.enx-icon");var r="100%";o<n.length-1&&(r=Math.floor(100/(n.length+1))*(o+1)+"%"),this.options.rope.setStyles({width:r,height:"2px"}),t=s.id,i=!0}}this.options.activeView=t}})}),define("DS/PADServices/utils/WidgetProxy",[],function(){function e(){this._hasWidget=void 0!==window.widget,this._hasWidget||(this._data={})}var t;return e.prototype={setValue:function(e,t){if(this._hasWidget)return window.widget.setValue(e,t);this._data[e]=t},getValue:function(e){return this._hasWidget?window.widget.getValue(e):this._data[e]},addPreference:function(e){if(this._hasWidget)return window.widget.addPreference(e);this._data[e.name]=e.defaultValue},dispatchEvent:function(e,t){this._hasWidget&&window.widget.dispatchEvent(e,t)}},Object.defineProperties(e.prototype,{hasWidget:{get:function(){return this._hasWidget}}}),t||(t=new e),t}),define("DS/PADServices/commands/HomeCmd",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({execute:function(e){require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.getModelEvents().publish({event:"ENXViews/PADPager/close",data:"fromHome"}),e.getModelEvents().publish({event:"ENXViews/WelcomePanel/activate",data:"fromHome"})})}})}),define("DS/PADServices/utils/ZipUtils",["UWA/Utils","DS/ZipJS/inflate","DS/ZipJS/deflate"],function(e,t,n){"use strict";function i(){return"object"==typeof i.instance?i.instance:(i.instance=this,this)}return i.prototype.jsonZip=function(t){if(!t)return t;if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;var n=t;try{n=encodeURIComponent(t)}catch(e){}for(var i=new ArrayBuffer(n.length),o=new Uint8Array(i),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);var r=new Deflater;r.append(o);var a=r.flush(),l=String.fromCharCode.apply(null,a);return"ZIP:"+e.base64Encode(l)},i.prototype.jsonUnzip=function(t){if(!t||!1===t.startsWith("ZIP:"))return t;var n=t=t.replace("ZIP:","");try{n=e.base64Decode(t)}catch(e){}for(var i=new ArrayBuffer(n.length),o=new Uint8Array(i),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);var r=new Inflater,a=r.append(o);r.flush();var l=String.fromCharCode.apply(null,a);return l=decodeURIComponent(l)},new i}),define("DS/PADServices/utils/GlobalModelEvents",["DS/CoreEvents/ModelEvents"],function(e){"use strict";var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,n){return t.subscribe(e,n)},subscribeOnce:t.subscribeOnce,unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}}),define("DS/PADServices/views/private/AppStructure",[],function(){var e;function t(e){return"null"===e?null:e}function n(){}return n.prototype={setWidget:function(e){this.widget=e},retrieveData:function(e){var t,n=this.widget.getValue(e);return"null"===n&&(n=null),n?((t=JSON.parse(n)).wasOpenFilters||(t.wasOpenFilters={}),t.wasOpenProducts||(t.wasOpenProducts={}),t.wasOpenPointCloud||(t.wasOpenPointCloud={}),t.ver||(t.ver={major:2,minor:0})):t={ver:{major:2,minor:0},products:{},filters:{},pointClouds:{},wasOpenProducts:{},wasOpenFilters:{},wasOpenPointCloud:{}},t},getWidgetBool:function(e){return t=this.widget.getValue(e),n=!1,"boolean"==typeof t?n=t:"string"==typeof t&&(n="true"===t.toLowerCase()),n;var t,n},migratePrevData:function(e){let n=t(this.widget.getValue("PAD3DViewerPathsInSession")),i=t(this.widget.getValue("Cockpit_RootIds"));if(n){let t=JSON.parse(n);this._migrateArrayOfPaths(e,t),this.widget.deleteValue("PAD3DViewerPathsInSession"),this.widget.setValue("3dmigrated",!0)}else if(i){let t=JSON.parse(i);this._migrateArrayOfPaths(e,t),this.widget.deleteValue("Cockpit_RootIds")}},_migrateArrayOfPaths:function(e,t){let n=this.retrieveData(e);for(let e=0;e<t.length;e++)this.addProductPath(n,t[e],!0);this.addOpenProduct(n,t),this.persistData(e,n)},persistData:function(e,t){this.widget.setValue(e,JSON.stringify(t))},addOpenProduct:function(e,t){for(var n=!1,i=0;i<t.length;i++)for(var o,s=t[i],r=0;r<s.length;r++){var a=s[r];0===r?(o=e.wasOpenProducts[a])||(o=e.wasOpenProducts[a]={},n=!0):o[a]?o=o[a]:(o=o[a]={},n=!0)}return n},addOpenFilter:function(e,t){for(var n=!1,i=0;i<t.length;i++){var o=t[i];e.wasOpenFilters[o]||(e.wasOpenFilters[o]={},n=!0)}return n},addOpenPointCloud:function(e,t){for(var n=0;n<t.length;n++);return!1},removeOpen:function(e,t){for(var n=[],i=0;i<t.length;i++){var o=t[i];e.wasOpenProducts[o]&&(n.push(o),delete e.wasOpenProducts[o]),e.wasOpenFilters[o]&&(n.push(o),delete e.wasOpenFilters[o]);let l=0,d=Object.keys(e.pointClouds);for(l=0;l<d.length;l++){e.pointClouds[d[l]].fsId===o&&(n.push(d[l]),delete e.wasOpenPointCloud[d[l]])}var s=Object.keys(e.filters);for(l=0;l<s.length;l++){var r=s[l],a=e.filters[r];a.associatedProduct===o&&(n.push(a.associatedProduct),delete e.wasOpenFilters[r])}}return n},addProduct:function(e,t){return!e.products[t]&&(e.products[t]={},!0)},addProductPath:function(e,t,n){if(Array.isArray(t))if(n){var i=e.products,o=0,s=t.length;for(o=0;o<s;o++)i.hasOwnProperty(t[o])||(i[t[o]]={}),i=i[t[o]]}else{var r,a=t.length;for(r=0;r<a;r++){i=e.products,o=0,s=t[r].length;for(o=0;o<s;o++)i.hasOwnProperty(t[r][o])||(i[t[r][o]]={}),i=i[t[r][o]]}}},addFilter:function(e,t,n){return!e.filters[t]&&(e.filters[t]={associatedProduct:n},!0)},addPointCloud:function(e,t,n){return e.pointClouds[n]?e.pointClouds[n].fsId!==t&&(e.pointClouds[n].fsId=t,!0):(e.pointClouds[n]={fsId:t},!0)},buildReloadList:function(e){var t={products:{},filters:{},pointClouds:{},hasLoad:!1};if(e.wasOpenFilters&&e.wasOpenProducts&&e.wasOpenPointCloud){for(var n=Object.keys(e.wasOpenProducts),i=Object.keys(e.wasOpenFilters),o=Object.keys(e.wasOpenPointCloud),s=0;s<n.length;s++){var r=n[s];(d=e.wasOpenProducts[r])&&(t.products[r]=d,t.hasLoad=!0)}for(s=0;s<i.length;s++){var a=i[s];if(e.wasOpenFilters[a]){var l=e.filters[a];l&&(t.filters[a]={associatedProduct:l.associatedProduct},t.hasLoad=!0)}}for(s=0;s<o.length;s++){var d;r=n[s];(d=e.wasOpenPointCloud[r])&&(t.pointClouds[r]=d,t.hasLoad=!0)}}return t},removeProduct:function(e,t){var n=!1;return e.products[t]&&(delete e.products[t],n=!0),e.wasOpenProducts[t]&&(delete e.wasOpenProducts[t],n=!0),n},removeFilter:function(e,t){return e.filters[t]&&(delete e.filters[t],!0),e.wasOpenFilters[t]&&(delete e.wasOpenFilters[t],!0),!1},removePointCloud:function(e,t){var n=!1;return e.pointClouds[t]&&(delete e.pointClouds[t],n=!0),e.wasOpenPointCloud[t]&&(delete e.wasOpenPointCloud[t],n=!0),n}},e||(e=new n),e}),define("DS/PADServices/utils/Meas",[],function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,n=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),i=!!document.documentMode,o=window.navigator.userAgentData&&window.navigator.userAgentData.brands.filter(function(e){return-1!==e.brand.indexOf("Microsoft Edge")}).length>0,s=!!window.chrome&&!o,r={isOpera:e,isFirefox:t,isSafari:n,isIE:i,isEdge:o,isChrome:s,isBlink:(s||e)&&!!window.CSS};Object.freeze(r);var a=-1!=navigator.appVersion.indexOf("Win"),l=-1!=navigator.appVersion.indexOf("Mac"),d=-1!=navigator.appVersion.indexOf("Linux"),c={isWin:a,isMac:l,isUnix:-1!=navigator.appVersion.indexOf("X11"),isLinux:d};Object.freeze(c);var p;function u(e,t,n){this.name=t,this.section=e,this.section.start(t,n)}function h(e,t,n){this._perfPtr=e,this.name=t,this.startName=t+"_start",this.endName=t+"_end",this.measName=t+"_meas",n&&(this.options=n),this.hasMeasured=!1,this._perfPtr.mark(this.startName)}function m(e,t,n){this.perfPtr=e,this.name=t,this.trackerPrefix=n,this.enabled=!0,this.trackers={},this.sections={}}function f(e){this.perfPtr=e}function v(e){this.perfPtr=e}function g(e){this.perfPtr=e}function b(e){this.perfPtr=e,this.clearHelper=new f(this.perfPtr),this.lsHelper=new v(this.perfPtr),this.findHelper=new g(this.perfPtr)}function w(){this.trackers={},this.sections={},this.perfHelper=new b(this.perfPtr),window?this.setPerfPtr(window.performance):this.setPerfPtr(self.performance),this.enabled=!0}return u.prototype={end:function(){this.section.end(this.name)}},h.prototype={end:function(){this.hasEnded||(this._perfPtr.mark(this.endName),this.hasEnded=!0)},endnmeas:function(e){return this.end(),this.meas()},meas:function(){return this.hasMeasured||(this._perfPtr.measure(this.measName,this.startName,this.endName),this.hasMeasured=!0),this._findmeas()},_findmeas:function(){for(var e=this._perfPtr.getEntriesByType("measure"),t=0;t<e.length;t++){var n=e[t];if(n.name===this.measName)return n}},dump:function(e){var t=this._perfPtr.getEntriesByType("measure"),n=this,i=t.filter(function(e){return e.name===n.measName});if(this.options&&this.options.stats){for(var o=0,s=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,a=i.length,l=0;l<a;l++){var d=i[l].duration;o+=d,d<s&&(s=d),d>r&&(r=d)}for(var c=o/a,p=0,u=0;u<a;u++){p+=i[u].duration-c^2}p/=a;var h=Math.sqrt(p);this.calculated={cnt:a,min:s,max:r,avg:c,var:p,stddev:h};var m="name="+this.name+", cnt="+a+" avg="+c+", min="+s+", max="+r+", σ2="+p+", σ="+h;console.log(m)}else{var f=i.length;f>1&&console.warn("there are more than one entry...maybe you should do stats");var v=i[f-1];if(f){this.calculated={duration:v.duration};var g="name="+this.name+", value="+v.duration;console.log(g)}}}},m.prototype={create:function(e,t){return new u(this,e,t)},start:function(e,t){if(this.enabled){var n=this.trackerPrefix+"."+e;this.trackers[e]&&this.trackers[e].end(),this.trackers[e]=new h(this.perfPtr,n,t)}},end:function(e){this.enabled&&this.trackers[e]&&this.trackers[e].end()},enable:function(e){this.enabled=e;for(var t=Object.keys(this.sections),n=0;n<t.length;n++){var i=t[n];this.sections[i].enable(e)}},addOrGetSection:function(e){if(this.enabled){var t=this.sections[e];if(t)return t;var n=this.trackerPrefix+"."+e;return t=this.sections[e]=new m(this.perfPtr,e,n)}},dump:function(e){var t=e||"";t.length?t+="."+this.name:t=this.name;for(var n=Object.keys(this.trackers),i=0;i<n.length;i++){var o=n[i];this.trackers[o].meas(),this.trackers[o].dump(t)}for(var s=Object.keys(this.sections),r=0;r<s.length;r++){var a=s[r];this.sections[a].dump(t)}}},f.prototype={_set:function(e){this.perfPtr=e},mark:function(){this.perfPtr.clearMarks()},meas:function(){this.perfPtr.clearMeasures()}},v.prototype={_set:function(e){this.perfPtr=e},mark:function(){for(var e=this.perfPtr.getEntriesByType("mark"),t=[],n=0;n<e.length;n++)t.push(e[n].name);return t},meas:function(){for(var e=this.perfPtr.getEntriesByType("measure"),t=[],n=0;n<e.length;n++)t.push(e[n].name);return t}},g.prototype={_set:function(e){this.perfPtr=e},mark:function(e){for(var t=this.perfPtr.getEntriesByType("mark"),n=[],i=0;i<t.length;i++){var o=t[i];-1!==o.name.indexOf(e)&&n.push(o)}return n},meas:function(e){for(var t=this.perfPtr.getEntriesByType("measure"),n=[],i=0;i<t.length;i++){var o=t[i];-1!==o.name.indexOf(e)&&n.push(o)}return n}},b.prototype={_set:function(e){this._perfPtr=e,this.clearHelper._set(e),this.lsHelper._set(e),this.findHelper._set(e)}},Object.defineProperties(b.prototype,{clr:{get:function(){return this.clearHelper}},ls:{get:function(){return this.lsHelper}},find:{get:function(){return this.findHelper}}}),w.prototype={setPerfPtr:function(e){e.mark&&e.measure&&e.getEntriesByType&&(this._perfPtr=e,this.perfHelper._set(e),e.onresourcetimingbufferfull&&(e.onresourcetimingbufferfull=function(){console.error("You cannot make more marks and measures try upping your buffersize")}))},start:function(e){this.enabled&&(this.trackers[e]=new h(this.perfPtr,e))},end:function(e){this.enabled&&this.trackers[e]&&this.trackers[e].end()},endnmeas:function(e){if(this.enabled)return this.trackers[e]?this.trackers[e].endnmeas():void 0},meas:function(e){if(this.enabled)return this.trackers[e]?this.trackers[e].meas():void 0},specificMeas:function(e,t,n){return this.perfPtr.measure(e,t,n),this.perfPtr.getEntriesByType("measure").filter(function(t){return t.name===e})},withMeas:function(e,t){try{this.start(e),t()}finally{this.end(e)}},addOrGetSection:function(e){if(this.enabled){var t=this.sections[e];return t||(t=this.sections[e]=new m(this.perfPtr,e,e))}},buildOrGetSection:function(e){for(var t,n=e.split("."),i=0;i<n.length;i++){var o=n[i];t=0===i?this.addOrGetSection(o):t.addOrGetSection(o)}return t},enable:function(e){this.enabled=e;for(var t=Object.keys(this.sections),n=0;n<t.length;n++){var i=t[n];this.sections[i].enable(e)}},dump:function(){for(var e=Object.keys(this.sections),t=0;t<e.length;t++){var n=e[t];this.sections[n].dump()}}},Object.defineProperties(w.prototype,{BrowserFlags:{value:r,writable:!1},OsFlags:{value:c,writable:!1},perf:{get:function(){return this.perfHelper}},perfPtr:{get:function(){return this._perfPtr}},buffersize:{set:function(e){this._perfPtr.setResourceTimingBufferSize&&this._perfPtr.setResourceTimingBufferSize(e)}}}),p||(p=new w,window?(window.meas=p,window.top.meas=p):self&&(self.meas=p)),p}),define("DS/PADServices/utils/PromiseHook",[],function(){return function(e,t){e.then(t),e.catch(t)}}),define("DS/PADServices/views/private/ColorView",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Class/View","UWA/Class/Options"],function(e,t,n,i){"use strict";return n.extend(i,{className:"padcolorview",name:"padcolorview",template:function(){var e="";return this.selected_color.color===this.model.get("color")&&this.selected_color.background_color===this.model.get("background_color")&&(e=this.getClassNames("_cell_selected")),this.model.get("custom")?'                <div data-label="'+this.model.get("label")+'" class="'+this.getClassNames("_cell","_custom_cell")+e+'" style="background-color:'+this.model.get("background_color")+';">                <div class="'+this.getClassNames("_content","_custom_content")+' font-3dsregular" style="color:'+this.model.get("color")+';">'+t.colorView.content+"</div>                </div>":'                <div data-label="'+this.model.get("label")+'" class="'+this.getClassNames("_cell")+e+'" style="background-color:'+this.model.get("background_color")+';">                <div class="'+this.getClassNames("_content")+' font-3dsregular" style="color:'+this.model.get("color")+';">'+t.colorView.content+"</div>                </div>"},domEvents:{"click .padcolorview_cell":"_onSelect","click .padcolorview_content":"_onSelect"},setup:function(e){var n=e||{};this._parent(n),this.displayContent=t.colorView.content,n.selected_color?this.selected_color=n.selected_color:this.selected_color={background_color:"#ffffff",color:"#000000"},this.model.addEvent("onChange:selected",this.render.bind(this))},render:function(){return this.container.setHTML(this.template()),this.model.get("empty")?(this.container.getElement("div.padcolorview_cell").setStyle("border-color","#ffffff"),this.container.getElement("div.padcolorview_cell").addClassName("padcolorview_empty_cell")):this.container.getElement("div.padcolorview_cell").addClassName("padcolorview_active_cell"),this.elements.padcolorview_cell=this.container.getElement("div.padcolorview_cell"),this},toggleSelected:function(){!0===this.model.get("selected")?this.model.set("selected",!1):this.model.set("selected",!0)},isSelected:function(){return this.model.get("selected")},_onSelect:function(){this.model.set("empty",!1),this.selected_color.color=this.model._attributes.color,this.selected_color.background_color=this.model._attributes.background_color,this.toggleSelected(),this.dispatchEvent("select",this.model.get("label"))}})}),define("DS/PADServices/utils/GlobalUtils",["DS/PlatformAPI/PlatformAPI","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","UWA/Utils/Client"],function(e,t,n,i){"use strict";var o,s=null,r=null,a=null,l=null,d=null,c=void 0;var p={setExecutionContext:function(e){r=(s=e).getComponent("AFR_NotificationManager")},getExecutionContext:function(){return s},displayError:function(e,t){r&&r.addNotif({title:e,message:t.message,level:"error"}),console.error(e),console.groupCollapsed("Error outputs"),console.error("Message:"+t.message),console.error("Stack:"+t.stack),console.groupEnd()},displayNotif:function(e){null===r&&(r=t,n.setNotificationManager(r),n.setStackingPolicy(5));if(e=UWA.extend({level:"info",sticky:!1},e),r.addNotif(e),"error"===e.level||"warning"===e.level){void 0===c&&(c=require("DS/PADServices/utils/PADTrackerManager"));var i=c.getPADTracker({eventCategory:"usage",eventAction:"notification"});i&&(i.setEventData({eventLabel:e.key?e.key:"no-key",eventValue:"error"===e.level?1:2}),i.trackPageEvent())}},uid:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},getLang:function(){return"undefined"!=typeof widget?widget.lang:"en"},deserializeDroppedData:function(e){for(var t,n={data:{items:[]}},i=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="",s=["text/searchitems","text/plain","Text"],r=0;r<s.length&&""===o;r++){var a=e.dataTransfer.types[i](s[r]);(UWA.is(a,"number")&&a>=0||UWA.is(a,"boolean")&&!0===a)&&(o=s[r])}if(""!==o){t=e.dataTransfer.getData(o);try{n=JSON.parse(t)}catch(e){}}return n},getUser:function(){return null==a&&(a=e.getUser()),a},getUserLogin:function(){var e=p.getUser(),t="";return void 0!==e&&(t=e.login),t},getUserName:function(){var e=p.getUser(),t="";return void 0!==e&&(t=e.firstName+" "+e.lastName),t},getWidgetId:function(){return"undefined"!=typeof widget&&null!==widget?widget.id:"default-widget-id"},getAppId:function(){if("undefined"!=typeof widget&&null!==widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},getSharedId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId()},getRequestLabel:function(){return p.getUserLogin()+"-"+p.getAppId()+"-"+Date.now()},setSecurityContext:function(e){o=e},getSecurityContext:function(){return o},retrieveAndSetSC:function(e){var t=require("DS/PADServices/ws/WSAccess"),n=this;return new Promise(function(e,i){t.getscandcollab().then(function(t){var i,o,s,r,a=UWA.is(t,"string")?JSON.parse(t):t;a.pid;for(var l in a.preferredcredentials){var d=a.preferredcredentials[l];switch(l){case"collabspace":o=d.name,d.title?d.title:o;break;case"organization":s=d.name;break;case"role":r=d.name}}i="ctx::"+r+"."+s+"."+o,n.setSecurityContext(i),e()})})},createCSSClass:function(e,t){var n=document.getElementById(e);if(!UWA.is(n)){var i=document.createElement("style");i.type="text/css",i.id=e,i.innerHTML="."+e+t,document.getElementsByTagName("head")[0].appendChild(i)}},getURLParameter:function(e){return null===l&&((l=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null)||(l=location.search.length?location.search:null)),l&&decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(l)||[null,""])[1].replace(/\+/g,"%20"))||null},isWebInWinContext:function(){return null===d&&(d="undefined"!=typeof widget?widget.getValue("addinmode"):""),"solidworks"===d||"catiav5"===d},hookTransitionEnd:function(e,t){var n=function(){var e,t=document.createElement("fakeelement"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();if(n){var i=function(e){t(e)};return e.addEventListener(n,i),function(){e.removeEventListener(n,i)}}},getPCSPrefix:function(){return"undefined"==typeof widget?"ODTFallbackPrefix":widget.id+"_"+widget.title},downloadfile:function(e,t,n){var i=document,o=i.createElement("a");if(UWA.is(e)&&UWA.is(t)&&UWA.is(n)&&(n=n||"application/octet-stream","download"in o)){var s=URL.createObjectURL(new Blob([e],{type:n}));return o.setAttribute("href",s),o.setAttribute("download",t),o.innerHTML="downloading...",i.body.appendChild(o),setTimeout(function(){o.click(),i.body.removeChild(o),URL.revokeObjectURL(s)},66),!0}},isMobileDevice:function(){return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i)||this.isIOSDesktopMode()},isIOSDesktopMode:function(){return"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},loadAMDs:function(e){return new Promise((t,n)=>{require(e,()=>{t({loadedAMDs:e})},n=>{console.error("Cannot load following AMDs:\n"+JSON.stringify(n.requireModules,null,2));var i=[];for(let t=0;t<n.requireModules.length;t++){var o=n.requireModules[t].replace("pluginDS!","");const s=e.indexOf(o);s>-1&&e.splice(s,1),i.push(o)}t({loadedAMDs:e,notLoadedAMDs:i})})})},copyTexttoCLipboard:function(e){var t=document.createElement("textarea");if(t.classList.add("bookmark-txt-link"),t.value=e,document.body.appendChild(t),i.Platform.hasOwnProperty("ios")&&!0===i.Platform.ios){t.contentEditable=!0,t.readOnly=!0;var n=document.createRange();n.selectNodeContents(t);var o=window.getSelection();o.removeAllRanges(),o.addRange(n),t.setSelectionRange(0,t.value.length)}else t.select();try{var s=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),!!s},launchURL:function(e){"documentation"===e.kind?require(["DS/WebUAUtils/WebUAUtils"],t=>{t.displayHelp(e.topics)}):"directLnk"===e.kind&&e.url&&window.open(e.url,"_blank")}};return p}),define("DS/PADServices/utils/ParserUtils",["DS/ENOXParser/modules/Numbers"],function(e){"use strict";return{parseAttributes:function(t){var n={};return t.forEach(function(t){UWA.is(t.value)&&UWA.is(t.value.replace,"function")&&(t.value=t.value.replace(/\n/g," ")),"physicalid"===t.name||"resourceid"===t.name?n.resourceid=t.value:"did"===t.name?n.did=t.value:"ro.plminstance.V_treeorder"===t.name?(n.relationOrder=parseFloat(t.value),isNaN(n.relationOrder)&&(n.relationOrder=-1)):"matrixtxt"===t.name?e.checkNotIdentity(t.value)&&(n.instanceMatrix=t.value):"type_icon_url"===t.name?(n.icons||(n.icons=[]),n.icons.push(t.value)):"thumbnail_2d"===t.name||"preview_url"===t.name?(n.thumbnail=t.value,n.grid||(n.grid={}),n.grid.thumbnail="url("+t.value+")"):"ds6w:label"===t.name?(n.label=t.value,n.display=n.label):(n.grid||(n.grid={}),n.grid[t.name]=t.value)}),n.relationOrder||(n.relationOrder=-1),n}}}),define("DS/PADServices/views/ENXModal",["css!DS/PADServices/PADServices.css","DS/Utilities/Dom","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog"],function(e,t,n,i,o){"use strict";function s(e){this.elements={},this.options=e||{},this.options=Object.assign({target:null,events:{onClose:this.close.bind(this)},closeCB:void 0},this.options),this.elements.immframe=new i,this.elements.immframe.getContent().addClassName("enxmodal-immframe");var s=Object.assign({immersiveFrame:this.elements.immframe,resizableFlag:!0,position:{my:"top",at:"top"},height:"auto",width:"auto"},this.options);return this.elements.dialog=new o(s),this.elements.dialog.addEventListener("close",this.close.bind(this)),n.createModal(this.options.target,this.elements.immframe.getContent()),this.options.modalOpened=!0,document.querySelector(".wux-controls-modalContent").addEventListener("click",function(e){t.firstParentWithClass(e.target,"wux-windows-window-content")||"function"!=typeof this.options.events.onClickOutsideContent||this.options.events.onClickOutsideContent()}.bind(this)),this}return s.prototype.close=function(){!0===this.options.modalOpened&&(this.options.modalOpened=!1,this.elements.dialog.destroy(),this.elements.dialog=null,delete this.elements.immframe,this.elements.immframe=null,n.removeModal(this.options.target),this.options.closeCB&&this.options.closeCB())},s.prototype.destroy=function(){!0===this.options.modalOpened&&this.close(),delete this.options},s.prototype.getContent=function(){return this.elements.dialog.getContent()},s}),define("DS/PADServices/views/private/ENXMask",["DS/Controls/ModalContainer","DS/Controls/Loader"],function(e,t){"use strict";function n(e){return"object"==typeof n.instance?n.instance:(n.instance=this,this.elements={},this.currentTarget=null,this)}return n.prototype.mask=function(n,i){null!==this.currentTarget&&this.currentTarget!==n&&this.unmask(this.currentTarget),this.currentTarget=n,void 0===this.elements.loader&&(this.elements.loader=new t({}),this.elements.loader.getContent().addClassName("ENXMask-loader")),this.elements.loader.on(i),e.createModal(n,this.elements.loader.getContent())},n.prototype.unmask=function(t){this.currentTarget===t&&(this.currentTarget=null,this.elements.loader.off(),e.removeModal(t))},new n}),define("DS/PADServices/utils/HideShowController",["DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADCommandProxy","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n){const i={isPADHidden:!0},o={isPADHidden:!1},s={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye pad_eye "},label:"show"},r={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-off pad_eye_off"},label:"hide"},a={HIDDEN:0,SHOWN:1,MIXED:2},l={UI:10,PROXY:20,PGP:30},d={SHOW:{isHiddenState:a.SHOWN},HIDDEN:{isHiddenState:a.HIDDEN},MIXED:{isHiddenState:a.MIXED}},c={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye pad_eye "},label:"show"},p={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-off pad_eye_off"},label:"hide"},u={icon:{iconClasses:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-eye-partial pad_eye_partial"},label:"mixed"};function h(e){let t=[];if(!e.isRoot()){let n=e.getParent();for(;n&&(t.push(n),!n.isRoot());)n=n.getParent()}return t}function m(e){if(!e.isRoot()){var t=e.options.isHiddenState;t===d.MIXED.isHiddenState&&(e.options.prevIsHiddenState=t)}}function f(e){var t=e.options.prevIsHiddenState;return void 0!==t&&(delete e.options.prevIsHiddenState,e.updateOptions({isHiddenState:t}),!0)}function v(){this._isThreeStates=e.getSetting("activateFUN105429"),n.subscribe({event:"ENXModel/hideShowState"},this._hideShowUpdate.bind(this))}var g;return v.prototype={defaultHiddenState:function(e){this._isThreeStates&&(e.isPADHidden?e.isHiddenState=a.HIDDEN:e.isHiddenState=a.SHOWN)},cleanupOptions:function(e,t){let n=e.options;void 0===n.isHiddenState||n.isHiddenState===t.isHiddenState||n.isHiddenStateFrom!==l.UI&&n.isHiddenStateFrom!==l.PROXY||(delete t.isHiddenState,delete t.isPADHidden)},gatherParentsIfHidden:function(e,t){if(this._isThreeStates&&t.options.isHiddenState===a.HIDDEN){let n=h(t);for(let t=0;t<n.length;t++){let i=n[t];e.indexOf(i)&&e.push(i)}}},gatherParentsIfHiddenOrShown:function(e,t){if(this._isThreeStates&&(t.options.isHiddenState===a.HIDDEN||t.options.isHiddenState===a.SHOWN)){let n=h(t);for(let t=0;t<n.length;t++){let i=n[t];-1===e.indexOf(i)&&e.push(i)}}},calculateParents:function(e,t,n){if(this._isThreeStates)for(let i=0;i<e.length;i++)this._calculateParentState(e[i],t,n)},determineIcon:function(e){if(!this._isThreeStates)return e.options.isPADHidden&&!0===e.options.isPADHidden?r:s;switch(e.options.isHiddenState){case a.HIDDEN:return p;case a.MIXED:return u;default:case a.SHOWN:return c}},determineTooltip:function(e,t){let n;switch(e.options.isHiddenState){case a.HIDDEN:n={shortHelp:t.columnsDef.show,updateModel:!1};break;case a.SHOWN:case a.MIXED:default:n={shortHelp:t.columnsDef.hide,updateModel:!1}}return n},shouldeRecalculate:function(e){let t=e.options;return t.isHiddenState===a.HIDDEN||t.isHiddenState===a.MIXED},updateHideShowStatus:function(e,t){this._hide(e),this._show(t)},clearHiddenState:function(e){let t=performance.now();this.parentList=new Map,this._show(e,!0,l.UI);let n=performance.now();console.log("PERFORMANCE : ",n-t)},_hideShowUpdate:function(e){var t=e.target,n="show"===e.data.toggle;let i=e.data.fromUI?l.UI:l.PROXY;var o=e.data.nobroadcast;n?this._show(t,o,i):this._hide(t,o,i)},_hide:function(e,t,n){var o=()=>{if(this._isThreeStates)for(let i=0;i<e.length;i++)this._hideMultiState(e[i],t,n);else for(let t=0;t<e.length;t++)e[t].updateOptions(i)};let s;e&&e.length&&(s=e[0].getTreeDocument()),s?s.withTransactionUpdate(o):o()},_show:function(e,t,n){var i=()=>{if(this._isThreeStates)for(let i=0;i<e.length;i++)this._showMultiState(e[i],t,n);else for(let t=0;t<e.length;t++)e[t].updateOptions(o)};let s;e&&e.length&&(s=e[0].getTreeDocument()),s?s.withTransactionUpdate(i):i()},_showMultiState:function(e,t,n){if(void 0!==n&&(e.options.isHiddenStateFrom=n),void 0!==e.options.finalHiddenState&&e.options.finalHiddenState===e.options.isHiddenState)return void delete e.options.finalHiddenState;let i=!1;f(e)||(m(e),this._determineMixedOnShow(e)?(e.updateOptions(d.MIXED),i=!0):e.updateOptions(d.SHOW),delete e.options.hiddenStateSet),i||e.options.isHiddenState===d.HIDDEN.isHiddenState&&(e.updateOptions(d.SHOW),delete e.options.hiddenStateSet);let o=h(e);this._nobroadcast=t,this.parentList&&this.parentList.clear(),this.parentList=new Map;for(let t=0;t<o.length;t++){let n=o[t].options;if(n.isPADHiddenInstance||n.isPADHiddenReference||n.isPADHiddenOccurrence)break;if(this.parentList&&!this.parentList.has(o[t]._id+"_"+o[t].getLabel()))this._calculateParentState(o[t]),this.parentList.set(o[t]._id+"_"+o[t].getLabel(),!0);else{if(!this.parentList||!this.parentList.has(o[t]._id+"_"+o[t].getLabel())||e.options.isPADHidden===o[t].options.isPADHidden)continue;this._calculateParentState(o[t])}}},_hideMultiState:function(e,t,n){if(void 0!==n&&(e.options.isHiddenStateFrom=n),!t&&void 0!==e.options.finalHiddenState&&e.options.finalHiddenState===e.options.isHiddenState)return void delete e.options.finalHiddenState;f(e)||(m(e),e.updateOptions(d.HIDDEN),e.options.ignoreRebound?delete e.options.ignoreRebound:e.options.hiddenStateSet=!0);let i=h(e);this._nobroadcast=t;for(let e=0;e<i.length;e++)this._calculateParentState(i[e]);delete this._nobroadcast},_determineMixedOnShow:function(e){let t=!1;if(e.hasChildren()){let n=e.getChildren();for(let e=0;e<n.length;e++){let i=n[e];if(t=i.options.isHiddenState===a.HIDDEN||i.options.isHiddenState===a.MIXED)break;t=this._determineMixedOnShow(i)}}return t},_calculateParentState:function(e,t,n){if(n=void 0!==n&&n,e.hasChildren()){if(!t&&e.options.isHiddenState===a.HIDDEN&&e.options.hiddenStateSet)return;let i=e.getChildren().filter(function(e){return!0!==e.isRelationsObjectGroupingNode}),o=i.filter(function(e){return e.options.isHiddenState===a.SHOWN}),s=i.filter(function(e){return e.options.isHiddenState===a.HIDDEN});i.filter(function(e){return e.options.isHiddenState===a.MIXED});if(function(e){return!e.childComputed&&!e.options.childComputed||"partiallyExpanded"===e.getState()}(e)&&!n)return void(o.length===i.length?e.updateOptions(d.SHOW):e.updateOptions(d.MIXED));o.length===i.length?e.updateOptions(d.SHOW):s.length===i.length?e.updateOptions(d.HIDDEN):(e.options.isHiddenState===a.HIDDEN&&(m(e),e.options.finalHiddenState=d.MIXED.isHiddenState),t&&(e.options.finalHiddenState=d.MIXED.isHiddenState),e.updateOptions(d.MIXED))}}},Object.defineProperties(v.prototype,{isThreeStates:{get:function(){return this._isThreeStates}},STATES:{get:function(){return a}},FROMS:{get:function(){return l}}}),g||(g=new v),g}),define("DS/PADServices/views/ENXDropDiv",["i18n!DS/PADServices/assets/nls/PADServices.json","css!DS/PADServices/PADServices.css","DS/PADServices/views/ENXDropTarget","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/CoreEvents/ModelEvents","DS/Controls/Button"],function(e,t,n,i,o,s){"use strict";var r=function(e){this.options=Object.assign({isOver:!1,withEmptyInvite:!1,openSearchFilter:'flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"'},e),this.options.modelEvents||(this.options.modelEvents=new o),this.elements={},this.elements.container=document.createElement("div"),this.elements.container.classList.add("enx-dropdiv"),this.options.className&&this.elements.container.classList.add(this.options.className),this.elements.content=document.createElement("div"),this.elements.content.classList.add("enx-dropdiv-content"),this.elements.container.append(this.elements.content),!0===this.options.withEmptyInvite&&(this.__createEmptyInvite(),this.options.modelEvents.subscribe({event:"DS/ENXDropInvite/displayEmptyInvite"},this.displayEmptyInvite.bind(this))),this.options.dropTarget=new n({backgroundOnDefault:!0!==this.options.withEmptyInvite}),this.options.dropTarget.onOpenInCtx=this.__onOpenInCtx.bind(this),this.options.dropTarget.onOpenAndFilter=this.__onOpenAndFilter.bind(this),this.elements.container.appendChild(this.options.dropTarget.render()),this.__addDnDCB(this.elements.container)};return r.prototype.render=function(){return this.elements.container},r.prototype.getContentDiv=function(){return this.elements.content},r.prototype.getMainClassName=function(){return"enx-dropdiv"},r.prototype.displayEmptyInvite=function(e){!0===e?this.elements.emptyDiv.removeAttribute("hidden"):this.elements.emptyDiv.setAttribute("hidden","")},r.prototype.onOpen=function(e){},r.prototype.onOpenInCtx=function(e){},r.prototype.onOpenAndFilter=function(e){},r.prototype.onOpenFromEmpty=function(e){},r.prototype.__onOpenInCtx=function(e){this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1,this.onOpenInCtx(e)},r.prototype.__onOpenAndFilter=function(e){this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1,this.onOpenAndFilter(e)},r.prototype.__addDnDCB=function(e){e.addEventListener("drop",this.__dropped.bind(this)),document.addEventListener("dragover",this.__dragOver.bind(this)),document.addEventListener("dragend",this.__dragEnd.bind(this)),document.addEventListener("dragleave",this.__dragLeave.bind(this))},r.prototype.__dropped=function(e){return this.onOpen(e),this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1,!0},r.prototype.__dragOver=function(e){return this.__isInside(e)&&(this.options.isOver=!0,this.elements.container.classList.add("hover"),this.options.dropTarget.show(),this.options.withEmptyInvite&&!1===this.elements.emptyDiv.hasAttribute("hidden")&&(this.options.emptyHiddenByOver=!0,this.displayEmptyInvite(!1))),e.preventDefault(),!0},r.prototype.__dragLeave=function(e){this.__isInside(e)||setTimeout(()=>{!1===this.options.dropTarget.isOver()&&(this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver&&(this.options.emptyHiddenByOver=!1,this.displayEmptyInvite(!0)))},50)},r.prototype.__dragEnd=function(e){this.options.isOver=!1,this.options.dropTarget.hide(),this.elements.container.classList.remove("hover"),this.options.emptyHiddenByOver=!1},r.prototype.__isInside=function(e){let t=(o=0,s=0,(i=e).pageX||i.pageY?(o=i.pageX,s=i.pageY):(i.clientX||i.clientY)&&(o=i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=i.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:o,y:s}),n=!1;var i,o,s,r,a;return this.options.containerRec=this.elements.container.getBoundingClientRect(),r=t,a=this.options.containerRec,r.y>=a.top&&r.y<=a.bottom&&r.x>=a.left&&r.x<=a.right&&(n=!0),n},r.prototype.__createEmptyInvite=function(){this.elements.emptyDiv=document.createElement("div"),this.elements.emptyDiv.classList.add("enx-dropdiv-empty"),this.elements.container.append(this.elements.emptyDiv);var t=new s({label:e.dropdiv.openContent,emphasize:"primary"});t.getContent().addClassName("enx-dropdiv-openContent"),t.addEventListener("click",()=>{this.__launchOpen()}),this.elements.emptyContent=new i({modelEvents:this.options.modelEvents,sentences:[{type:"drop",text:e.dropdiv.dropcontenthere},{type:"dom",DOMelement:t.getContent()}],fontSize:"16px",orderedListType:"none"}),this.elements.emptyContent.inject(this.elements.emptyDiv)},r.prototype.__launchOpen=function(){return new Promise(t=>{require(["DS/PADServices/utils/SearchUtils"],n=>{let i=()=>{t()};var o={title:e.dropdiv.openContent,search_criteria_to_display:"",fts_value:this.options.openSearchFilter,showApplyButton:!0,applyButton_Nls:e.dropTarget.openAndFilterTitle,callback:e=>{var t=n.createDropDataFromSearch(e);this.onOpenFromEmpty({mode:"drop",behavior:"WITH_CONTEXT",unserializedData:t}),i()},apply:e=>{var t=n.createDropDataFromSearch(e);this.onOpenFromEmpty({mode:"drop",behavior:"FILTER",unserializedData:t}),i()},cancel:i};n.inAppsSearch(o)})})},r}),define("DS/PADServices/utils/private/TreeDocUpdate",["DS/PADServices/utils/PromiseCompletion"],function(e){return function(t,n){this._completion=new e({before:function(){t.prepareUpdate()},after:function(){t.pushUpdate()},promise:n})}}),define("DS/PADServices/utils/Batches",["DS/PADServices/utils/Iterator","DS/PADServices/utils/WaitingPromise"],function(e,t){function n(e,t,n,i){var o=-1;return function(){if(++o<=e.length-1){var s=e[o];n(s,t)}else i()}}function i(e,t,n){var i=[],o=e.length;if(o>=t)for(var s=0;s<o;s+=n)i.push(e.slice(s,s+n));else i.push(e);return i}return{breakup:i,stepper:n,promStepper:function(e,t,o,s,r){let a,l=i(e,t,o);return a=n(l,null,function(e){new Promise(function(t,n){s(e,t)}).then(a)},function(){r()})},chain:function(e,t,n,o){let s=i(e,t,n),r=[],a=1,l=s.length;return new Promise(function(e,t){s.reduce(function(t,n){return t.then(function(){let t=o(n,a);return a++,r.push(t),r.length===l&&e({promises:r}),t})},Promise.resolve())})},waiting:function(n,o,s,r){let a=i(n,o,s),l=Promise.resolve(),d=[];return e.iterate(a,function(e,n){d.push({batch:e,batchId:n+1,waiting:new t})}),results=d.map(function(e){return e.waiting}),e.iterate(d,function(e){l.then(function(){e.work=r(e.batch,e.batchId),e.work.then(function(t){e.waiting.resolve(t)}),l=e.waiting})}),results}}}),define("DS/PADServices/utils/CommandProxy",["text!DS/PADServices/assets/init/CommandProxyRsc.json","text!DS/PADServices/assets/init/CommandProxyRsc_karma.json","DS/PlatformAPI/PlatformAPI","DS/ENOXInterWdgCom/Proxy","DS/PADServices/utils/GlobalUtils"],function(e,t,n,i,o){"use strict";var s=window.__karma__?JSON.parse(t):JSON.parse(e),r={};function a(){var e="/no_private_channel";return"undefined"!=typeof widget&&null!==widget&&(void 0!==widget.getValue("x3dSharedId")?e="/"+widget.getValue("x3dSharedId"):void 0!==widget.getValue("x3dAppId")?e="/"+widget.getValue("x3dAppId"):void 0!==widget.getValue("appId")&&(e="/"+widget.getValue("appId")+"_"+widget.id)),e}return r.create=function(e){var t;return e&&(t=e.events),new i({prefix:"DS/PADUtils/PADCommandProxy/",privateChannel:a(),commands:s,events:t})},r.appId=function(){return a()},r}),define("DS/PADServices/utils/PlatformURL",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PADServices/utils/GlobalUtils"],function(e,t){"use strict";var n=null,i={retrievePlatformUrl:function(t){var i=this;return new Promise(function(o,s){var r=[];null===n&&r.push(new Promise(function(t,o){e.getPlatformServices({onComplete:function(e){i.__checkURLs(e).then(e=>{n=e,t()})},onFailure:function(e){o(e)}})})),t&&!0===t.initWSAcess&&r.push(new Promise(function(e,n){require(["DS/PADServices/ws/WSAccess"],function(i){i.initialize({addDefaults:t.addDefaults,WSDefinitionAMDs:t.WSDefinitionAMDs}).then(e).catch(n)},n)})),Promise.all(r).then(o).catch(s)})},getPlatformId:function(){return"undefined"!=typeof widget&&null!==widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"},getTenantInfo:function(e){for(var t={},i=0;i<n.length;i++)if(n[i].platformId===e){t=n[i];break}return t},get3DSpaceURL:function(){return i.getPlatformURL("3DSpace")},get3DSwymURL:function(){if(!UWA.is(n,"array"))throw new Error("Platform services not initialize yet");var e=i.getPlatformId(),t=i.getTenantInfo(e);return void 0===t["3DSwym"]?null:t["3DSwym"]},getPlatformURL:function(e){if(!UWA.is(n,"array"))throw new Error("Platform services not initialize yet");var t=i.getPlatformId(),o=i.getTenantInfo(t);if(void 0===o[e])throw console.error("No "+e+" URL available for this tenant."),new Error("Unknown service "+e);return o[e]},getAppInfo:function(t){return new Promise(n=>{e.getAppInfo({appId:t,onComplete:e=>{n(e)}})})},__checkURLs:function(n){return new Promise(i=>{var o=!1;"undefined"!=typeof widget&&widget.getValue("noCompass")&&(o=!0);var s=!1;if(!o&&"undefined"!=typeof widget&&n&&n.length>1){var r=n[0].platformId;r&&-1===["OnTenant1","odt_tenant","OnPremise"].indexOf(r)&&(s=!0)}s?e.getAppInfo({appId:t.getAppId(),onComplete:function(e){var t=[],o=!!e.tenantAware&&e.tenantAware;if(o){for(var s=0;s<e.platforms.length;s++)for(var r=0;r<n.length;r++)if(!o||n[r].platformId===e.platforms[s].id){t.push(n[r]);break}}else t=n;i(t)},onFailure:function(e){console.error("Cannot retrieve the App Info"),i(n)}}):i(n)})}};return i}),define("DS/PADServices/ws/WSFilter",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],function(e,t){"use strict";function n(){}return n.prototype.fetchFilter=function(n){return new Promise(function(i,o){var s=n.data.filterids,r=t.getSecurityContext(),a=e.get3DSpaceURL()+"/resources/FilterBIAPI/Filter/getBasicsInDBFromIds?tenant="+e.getPlatformId(),l={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:n.timeout?n.timeout:void 0,data:JSON.stringify(s),onComplete:i,onFailure:o};r&&(a+="&SecurityContext="+r),this.executeRequest(a,l)}.bind(this))},n}),define("DS/PADServices/views/private/SoITimelineV0",["css!DS/PADServices/PADServices.css","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/Windows/Panel","UWA/Controls/Scroller"],function(e,t,n,i,o,s,r){"use strict";function a(e){return this.options=e||{},this.options=Object.assign({dateFormatOptions:{dateStyle:"long",timeStyle:"medium"},sliderStops:[],data:void 0,events:{}},this.options),this.elements={},this.__buildUX(),this}return a.prototype.__buildUX=function(){this.elements.content=i.createElement("div",{class:"soi-timeline-v0-container"}),this.elements.disabled=i.createElement("div",{class:"soi-timeline-v0-disabled"}),this.elements.sliderWrapper=i.createElement("div",{class:"soi-timeline-v0-slider_wrapper"}),this.elements.sliderTrack=i.createElement("div",{class:"soi-timeline-v0-slider"}),this.elements.sliderProgress=i.createElement("div",{class:"soi-timeline-v0-progress"}),this.elements.label=i.createElement("p",{class:"soi-timeline-v0-label"}),this.elements.content.appendChild(this.elements.disabled),this.elements.content.appendChild(this.elements.label),this.elements.content.appendChild(this.elements.sliderTrack),this.elements.content.appendChild(this.elements.sliderWrapper),this.elements.content.appendChild(this.elements.sliderProgress),this.elements.panel=new s({identifier:"PAD3DSOITimeline",immersiveFrame:this.options.immersiveFrame,content:this.elements.content,resizableFlag:!0,height:"auto",maxHeight:100,minHeight:70,allowedDockAreas:WUXDockAreaEnum.TopDockArea,currentDockArea:WUXDockAreaEnum.TopDockArea,horizontallyStretchableFlag:!0,collapsibleFlag:!0,closeButtonFlag:!1});let e=this.options.data;const t=new Date(e.result[0].grid["r2v:fsEffectivityDate"]);this.elements.label.innerHTML=`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(t)} – ${e.result[0]["ds6w:label"]}`;const n=this.__computeTimelineInfo(e);for(let t=0;t<e.result.length;++t)if("RELEASE"===e.result[t].status||"FROZEN"===e.result[t].status){const i=this.__createStateStop(e,t,n);this.elements.sliderTrack.appendChild(i),this.options.sliderStops.push(i)}else e.result.splice(t,1);this.elements.sliderProgress.tooltipInfos=new o({title:`${e.result[0]["ds6w:label"]}`,shortHelp:`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(t)}`,longHelp:`${e.result[0].grid["ds6w:description"]}`}),this._selectedSurveyElement=this.options.sliderStops[this.options.sliderStops.length-1],this.options.selectedStateId=e.result[e.result.length-1].resourceid,this._selectedSurveyElement.classList.add("state-selected"),this.__setStopsPosition(e,n),this.__listenProgressEvents()},a.prototype.__computeTimelineInfo=function(e){const t=e.result.length-1,n=new Date(e.result[0].grid["r2v:fsEffectivityDate"]),i=new Date(e.result[t].grid["r2v:fsEffectivityDate"]);let o=new Map;for(let t=0;t<e.result.length;++t){const i=new Date(e.result[t].grid["r2v:fsEffectivityDate"]);o.set(t,this.__getTimeBetweenDates(n,i))}return{minDate:n,maxDate:i,range:this.__getTimeBetweenDates(n,i),map:o}},a.prototype.__createStateStop=function(e,s,r){const a=i.createElement("div",{class:"soi-timeline-v0-stop"}),l=new Date(e.result[s].grid["r2v:fsEffectivityDate"]),d=this.__getTimeBetweenDates(l,r.minDate),c=JSON.stringify({envId:t.getPlatformId(),contextId:n.getSecurityContext(),objectId:e.result[s].resourceid,objectType:e.result[s].type,displayType:"Location State",displayName:e.result[s]["ds6w:label"],description:e.result[s]["ds6w:description"],serviceId:e.serviceId,date:l});return a.tooltipInfos=new o({title:`${e.result[s]["ds6w:label"]}`,shortHelp:`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(l)}`,longHelp:`${e.result[s].grid["ds6w:description"]}`}),a.dataset.survey=c,a.dataset.label=`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(l)} – ${e.result[s]["ds6w:label"]}`,a.dataset.offset=100*d/r.range,a.addEventListener("click",this.__stateStopClicked.bind(this)),a},a.prototype.__setStopsPosition=function(e,t){const n=13*t.range;if(13*t.range<300||e.result.length<10){this.elements.sliderTrack.style.width="300px",this.elements.sliderWrapper.style.width="300px";for(let e=0;e<this.options.sliderStops.length;++e){let n=this.options.sliderStops[e];const i=t.map.get(e);n.style.left=`${100*i/t.range}%`}}else{this.elements.sliderTrack.style.width=`${n}px`,this.elements.sliderWrapper.style.width=`${n+100}px`;for(let e=0;e<this.options.sliderStops.length;++e){let n=this.options.sliderStops[e];const i=13*t.map.get(e);n.style.left=`${i}px`}this.elements.scroller=new r(this.elements.sliderWrapper,{height:40,bounce:!0,scrollDrag:!0,scrollbarH:!0,scrollbarV:!1})}},a.prototype.__listenProgressEvents=function(){let e=!1;const t=this.elements.sliderProgress.style.transition;this.elements.sliderProgress.addEventListener("mousedown",()=>{e=!0,this.elements.sliderProgress.style.transition="none"}),document.body.addEventListener("mousemove",t=>{if(!0===e){const e=this.elements.sliderTrack.getBoundingClientRect();let n=100*(t.clientX-e.left)/e.width;n<0&&(n=0),n>100&&(n=100),this.elements.sliderProgress.style.left=`${n}%`}}),document.body.addEventListener("mouseup",()=>{if(!0===e)return e=!1,this.elements.sliderProgress.style.transition=t,void this.__snapToClosestSpot(this.elements.sliderProgress.style.left.slice(0,-2))}),this.elements.sliderTrack.addEventListener("click",e=>{const t=this.elements.sliderTrack.getBoundingClientRect();let n=100*(e.clientX-t.left)/t.width;this.__snapToClosestSpot(n)})},a.prototype.__getTimeBetweenDates=function(e,t){let n=e.getTime()-t.getTime();return n<0&&(n=t.getTime()-e.getTime()),Math.ceil(n/864e5)},a.prototype.__snapToClosestSpot=function(e){let t=0,n=100;for(let i=0;i<this.options.sliderStops.length;++i)Math.abs(parseFloat(this.options.sliderStops[i].dataset.offset)-parseFloat(e))<n&&(n=Math.abs(parseFloat(this.options.sliderStops[i].dataset.offset)-parseFloat(e)),t=i);this.elements.sliderProgress.style.left=this.options.sliderStops[t].style.left,this.__stateStopClicked({target:this.options.sliderStops[t]})},a.prototype.__stateStopClicked=function(e){if(!0!==this.__surveyLoadingInProgress){const t=JSON.parse(e.target.dataset.survey);t.objectId!==this.options.selectedStateId&&(this.startStateLoadingTransaction(),this.elements.label.innerHTML=e.target.dataset.label,this.elements.sliderProgress.style.left=e.target.style.left,this.elements.sliderProgress.tooltipInfos.title=t.displayName,this.elements.sliderProgress.tooltipInfos.shortHelp=new Intl.DateTimeFormat(window.navigator.language,this._dateFormatOptions).format(new Date(t.date)),this.elements.sliderProgress.tooltipInfos.longHelp=`${t.description}`,"function"==typeof this.options.events.stateStopClicked&&(e.previouslySelected=this.options.selectedStateId,e.stateData=t,this._selectedSurveyElement.classList.remove("state-selected"),this.options.events.stateStopClicked(e).then(()=>{this._selectedSurveyElement=e.target,this._selectedSurveyElement.classList.add("state-selected")})))}},a.prototype.startStateLoadingTransaction=function(){this.__surveyLoadingInProgress=!0,this.elements.disabled.style.display="block"},a.prototype.endStateLoadingTransaction=function(e){this.__surveyLoadingInProgress=!1,this.options.selectedStateId=e,this.elements.disabled.style.display="none"},a}),define("DS/PADServices/views/AttributesCustomization",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/views/private/Iconbar","DS/PADServices/views/private/ComboSelector","DS/PADServices/utils/GlobalUtils","css!DS/UIKIT/UIKIT","DS/UIKIT/Mask","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","DS/Utilities/Dom","DS/Utilities/TouchUtils"],function(e,t,n,i,o,s,r,a,l,d,c,p,u,h,m,f,v,g,b){"use strict";var w=["selection","hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],y=["bi_color","selection","hide_show","thumbnail"],S=!1;function _(e){var t=!0;return-1!==y.indexOf(e)?t=!1:!1===S&&-1!==["ds6w:label-Instance","positionMatrix-Instance"].indexOf(e)&&(t=!1),t}var C={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){var e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){var e;switch(this.options.grid.attrName){case"positionMatrix-Instance":e="matrixtxt";break;default:e=this.options.grid.attrName}return{property:"ds6w",value:e}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrInstRef?"rel":void 0}},function(){return{property:"source",value:"Classification"===this.options.grid.attrInstRef?"Classification":void 0}}]};function D(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.dataIndex===t)return i;if(i.xnav_options&&i.xnav_options.name===t)return i}}return l.extend({name:"attr-customization",columnOrdering:!0,defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},noAddRemoveColumn:!1,manageAttrFromInstance:!0,dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"eye",fontIconFamily:1},tooltip:t.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{dataIndex:"tree",text:t.attributesCustomization.attrTitle,typeRepresentation:"string",editableFlag:!1,editionPolicy:"EditionOnDoubleClick",sortableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel?!0===S?-1===y.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):-1===w.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):t=!1,t}},{icon:{iconName:"pin",fontIconFamily:1},dataIndex:"pinContent",typeRepresentation:"pin",alignmentValue:"center",alwaysVisibleFlag:!0,width:100,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1},{icon:{iconName:"export",fontIconFamily:1},dataIndex:"exportContent",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&!e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"},getCellSemantics:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!0),{disabled:t}}},{icon:{iconName:"palette",fontIconFamily:1},dataIndex:"columnColor",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!1,sortableFlag:!1,resizableFlag:!1,typeRepresentation:"colorChange",getCellClassName:function(e){var t=[];if(e.nodeModel){var n="#ffffff",i="#000000";if(e.nodeModel.options.grid&&e.nodeModel.options.grid.columnColor){if(n=(n=e.nodeModel.options.grid.columnColor["background-color"]?e.nodeModel.options.grid.columnColor["background-color"]:"#ffffff").replace(/;/g,""),i=(i=e.nodeModel.options.grid.columnColor.color?e.nodeModel.options.grid.columnColor.color:"#0000").replace(/;/g,""),"#ffffff"!==n){var s="enx-background-color-"+n.replace(/\#/g,""),r="{background-color:"+n+";}";o.createCSSClass(s,r),t.push(s)}if("#000000"!==i){var a="enx-color-"+i.replace(/\#/g,"");r="{color:"+i+";}";o.createCSSClass(a,r),t.push(a)}}}return t.join(" ")},getCellEditableState:function(e){var t=!0;return!0===e.nodeModel.options.pinColumn&&(t=!1),t}},{icon:{iconName:"remove",fontIconFamily:1},dataIndex:"attrRemove",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)?"actionNotRemove":"actionRemove"},getCellSemantics:function(e){if(e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable))return{disabled:!0}}}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(e){this._parent(e);var n=this,i=o.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";n.elements.container=a.createElement("div",{class:n.getClassNames(i)}),v.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){S=!!(n.options.baseInstanceTypes&&n.options.baseInstanceTypes.length>0),n.options.allowedIndexAttributes=new Set(n.options.allowedIndexAttributes),n._buildBody(),n._buildFooter(),n.elements.panel2small=a.createElement("div",{class:n.getClassNames("-panel2small"),text:t.attributesCustomization.panel2small}).inject(n.elements.container),n.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",title:t.attributesCustomization.apptitle,html:n.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=a.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container);var e=this.options.dgvOptions;!0!==this.options.withDgv?e.columns.splice(2,1):(e.columns.splice(4,1),!0===this.options.noAddRemoveColumn&&e.columns.splice(4,1));var n=a.extend({identifier:"DataGridView-attrCusto-"+o.uid()},this.options.dgvOptions);n.layout=new f(this.options.dgvLayoutOptions);var s=this.options.grid=new m(n);s.onContextualEvent=function(){return[]},s.getCellTooltip=function(e){var n=this.options.grid.getColumnOrGroup(e.columnID).dataIndex;return e.dataIndex=n,-1===e.rowID?{shortHelp:t.attributesCustomization[n],updateModel:!1}:"tree"===n&&e.nodeModel&&!0!==e.nodeModel.getReferenceValue("isAdditionalColumn")?!0===u.instanceMgtActivated?{shortHelp:t.replace(t.attributesCustomization.tooltipColName,{label:e.nodeModel.getLabel(),instRef:t.attributesCustomization[e.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:{shortHelp:e.nodeModel.getLabel(),updateModel:!1}:void 0}.bind(this);var r={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},l={};l[t.attributesCustomization.pinLeft]="left",l[t.attributesCustomization.pinRight]="right",l[t.attributesCustomization.unpinned]="unpinned";var d={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:l,valueType:"enumCustom"}}};s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d)),!0!==this.options.withDgv&&(r.colorChange={stdTemplate:"functionIcon",semantics:{icon:{iconName:"text",fontIconFamily:WUXManagedFontIcons.Font3DS}}}),s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(r));var u=this;this.options.attrModel=new c({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),s.treeDocument=this.options.attrModel,s.getContent().addClassName("enxdatagridview"),s.getContent().inject(this.elements.dgv);u=this;s.onReady(function(){s.addEventListener("change",u._cellModified.bind(u)),s.addEventListener("click",u._cellClicked.bind(u)),u.options.toolbar.show(),u.options.grid.sizeColumnToFit("pinContent",{computeAllRows:!0})}),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},function(e){!0!==u._isMoving&&!0!==u._globalUpdate&&u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(C)]}})})),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},function(e){if(!0!==u._isMoving&&!0!==u._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");if(-1!==w.indexOf(t)&&!0!==u.options.withDgv){var n=u.options.toolbar.getItem("specificColumns").content.component;n&&n.isSelected(t)&&n.toggleSelection(n.getItem(t))}u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(C)]}})}})),this.elements.behavior=a.createElement("div",{class:this.getClassNames("-behavior")}).inject(this.elements.container);var v=new c,g=new p({viewMode:"comfortable",label:t.attributesCustomization.comfortable,subLabel:t.attributesCustomization.comfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});v.addRoot(g);var y=new p({viewMode:"compact",label:t.attributesCustomization.compact,subLabel:t.attributesCustomization.compactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});v.addRoot(y);this.options.attrModel.getRoots().filter(function(e){return"thumbnail"===e.getReferenceValue("attrName")}).length;"compact"===this.options.viewMode?y.select(!0):g.select(!0),this.elements.comboCompact=new i({className:this.getClassNames("-compactmode-selector"),treedocument:v,events:{onSelectionChange:function(){var e=v.getSelectedNodes()[0].options.viewMode;u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:e}})}}});var S=a.createElement("div",{class:this.getClassNames("-compactmode-global")});a.createElement("div",{class:this.getClassNames("-compactmode-label"),text:t.attributesCustomization.density}).inject(S),this.elements.comboCompact.inject(S),S.inject(this.elements.behavior),b.getTouchMode()&&this.elements.comboCompact.disabled(!0),this.elements.applyToggle=new h({label:t.attributesCustomization.apply_to_this_app});var _=a.createElement("div",{class:this.getClassNames("-applytothisapp"),content:this.elements.applyToggle});this.elements.applyToggle.addEventListener("change",function(e){var t=e.dsModel;u.options.applyOnlyToThisApp=t.checkFlag,u.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/applyOnlyToThisApp",data:{applyOnlyToThisApp:u.options.applyOnlyToThisApp}})}),_.inject(this.elements.behavior)},_buildFooter:function(){var e=this,n=a.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container),i=new d({label:t.attributesCustomization.close,emphasize:"primary",touchMode:!0});i.addEventListener("buttonclick",function(){e._closePanel(),e.destroy()}),i.inject(n);var o=new d({label:t.attributesCustomization.reset,touchMode:!0});o.addEventListener("buttonclick",function(){var n=e.elements.container.getParent("body");r.mask(n,t.attributesCustomization.resetView),e.options.modelEvents.publish({event:"container-to-unmask",data:{container:n}}),e.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:e.options.applyOnlyToThisApp}}),e.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0,idView:"app"}}),e.destroy()}),o.inject(n)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach(function(t){e.includes(t.dump(C))||e.push(t.dump(C))}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp}}),this.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0,idView:"app"}})},_addColumns:function(){var e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate(function(){for(var t=0;t<e.options.appColumns.length;t++){var n=e.options.appColumns[t];if(!n.neverVisible&&"bi_color"!==n.dataIndex){var i=a.is(n.text,"string")&&n.text.length>0?n.text:e._retrieveColumnName(n.dataIndex),o=!n.customisation||!n.customisation.exportable||n.customisation.exportable.value,s=!(!n.customisation||!n.customisation.exportable)&&n.customisation.exportable.lock,r=n.customisation&&n.customisation.styles?n.customisation.styles:{"background-color":"#ffffff",color:"#000000"},l=n.customisation&&n.customisation.layout?n.customisation.layout:{},d=n.pinned?n.pinned:"unpinned",c=void 0!==n.visibleFlag?n.visibleFlag:!n.isHidden;!0!==e.options.withDgv&&(c=!n.isHidden);var u,h=n.ds6wFrom&&"rel"===n.ds6wFrom?"Instance":"Reference";n.isAdditionalColumn?h="AdditionalColumn":n.source&&"Classification"===n.source&&(h="Classification"),!0===S?"Reference"===h?u=[{iconName:"product"}]:"Instance"===h?u=[{iconName:"flow-cascade"}]:"AdditionalColumn"===h?u=[{iconName:"attributes-add"}]:"Classification"===h&&(u=[{iconName:"library-books"}]):u=void 0;var m=n.ds6w&&"rel"!==n.ds6wFrom?n.ds6w:n.dataIndex,f=new p({columnIndex:n.dataIndex,label:i,icons:u,grid:{attrTitle:i,attrVisible:c,exportContent:o,exportLock:s,columnColor:r,attrName:m,attrDBName:n.attrDBName,isAdditionalColumn:n.isAdditionalColumn,layout:l,pinContent:d,attrRemove:!0,attrInstRef:h,attrAlert:null},children:null});e.options.attrModel.addChild(f)}}e.options.attrModel.expandAll()})},_cellModified:function(e,t){if(t&&t.nodeModel&&t.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(t.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:t.nodeModel.options.columnIndex,visibilityFlag:t.nodeModel.getReferenceValue("attrVisible")}});break;case"tree":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:t.nodeModel.options.columnIndex,newTitle:t.nodeModel.getLabel()}});break;case"exportContent":this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:t.nodeModel.options.columnIndex,exportFlag:t.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var n=this,i=t.nodeModel.getReferenceValue("attrName");"tree"===t.nodeModel.options.columnIndex&&(i="tree");var o=t.nodeModel.getReferenceValue("pinContent"),s=n.__locateFirstAndLastPin(o);n.options.attrModel.withTransactionUpdate(function(){n._globalUpdate=!0;var e=s.last?s.last._getLocalID?s.last._getLocalID():s.last._localID:n.options.attrModel.getRoots().length-1;0===e?e=1:e++,n.options.attrModel.addChild(t.nodeModel,e),t.nodeModel.select(),delete n._globalUpdate,n.options.grid.sizeColumnToFit("pinContent",{computeAllRows:!0})}),this.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:i,pin:o}})}},_cellClicked:function(e,n){if(n&&n.nodeModel&&n.nodeModel.options.grid){if(!0===n.nodeModel.options.pinColumn)return;switch(this.options.grid.layout.getDataIndexFromColumnIndex(n.columnID)){case"columnColor":this._changeColor([n.nodeModel]);break;case"attrRemove":if(n.nodeModel){if(n.nodeModel.options.grid.layout&&!1===n.nodeModel.options.grid.layout.removable||n.nodeModel.options.grid.isAdditionalColumn&&!0===n.nodeModel.options.grid.isAdditionalColumn)break;if(this.options.attrModel.removeRoot(n.nodeModel),"thumbnail"===n.nodeModel.options.columnIndex){this.options.thumbnailsActivated=!1;var i={id:this.options.toolbar.getItem("thumbnail").id,tile:t.attributesCustomization.activateThumbnails};this.options.toolbar.menu.updateItem(i),this.options.toolbar.select("thumbnail",!1)}}}}},_retrieveColumnName:function(e){return t.attributesCustomization[e]?t.attributesCustomization[e]:e},_buildIconBar:function(){this.elements.toolbar=a.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=(this.options.appColumns?this.options.appColumns:[]).filter(function(e){return!e.isHidden}).map(function(e){return e.dataIndex}),i=this,o={renderTo:this.elements.toolbar,multiSelect:!0,items:[{fonticon:"cog",title:t.attributesCustomization.moreAttributes,name:"moreAttributes",handler:function(e,n){require(["DS/PADServices/views/private/MoreAttributesWizard"],function(e){for(var n=i.options.attrModel.getRoots(),o=[],s=0;s<n.length;s++)!0===_(n[s].getReferenceValue("attrName"))&&o.push({name:n[s].getReferenceValue("attrName"),instRef:n[s].getReferenceValue("attrInstRef")});var r=i.options.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/selectedAttributes"},function(e){i.options.modelEvents.unsubscribe(r);for(var n=i.options.attrModel.getRoots(),o=[],s=0;s<n.length;s++)!0===_(n[s].getReferenceValue("attrName"))&&o.push(n[s].getReferenceValue("attrName"));i.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:i.elements.container,title:t.attributesCustomization.apptitle}}),i.options.selectedExtensions=e.selectedExtensions,i.options.selectedTypes=e.selectedTypes,i._globalUpdate=!0;var a=e.selectedAttributes.filter(function(e){return-1!==o.indexOf(e.dataIndex)}).map(function(e){return e.dataIndex}),l=o.filter(function(e){return-1===a.indexOf(e)}),d=e.selectedAttributes.filter(function(e){return-1===o.indexOf(e.dataIndex)}),c=[],u=[],h=0;for(h=0;h<l.length;h++){var m=i.options.attrModel.search({match:function(e){var t=!1;return e.nodeModel.options.columnIndex===l[h]&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&!1!==e.nodeModel.options.grid.layout.removable&&"ds6w:type"!==l[h]&&(t=!0,i.options.dbOnlyAttributes&&i.options.allowedIndexAttributes.has(l[h])&&(t=!1)),t}});i.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<m.length;e++)i.options.attrModel.removeRoot(m[e]),c.push(m[e].dump(C))})}var f=[];for(h=0;h<d.length;h++){var v,g=D(i.options.appColumns,d[h].dataIndex),b=!1;if(g){var w=g.xnav_options;w||(w=g.customisation),w&&(b=!!w.exportable&&w.exportable.lock)}!0===S&&("Reference"===d[h].attrParent?v=[{iconName:"product"}]:"Instance"===d[h].attrParent?v=[{iconName:"flow-cascade"}]:"Classification"===d[h].attrParent&&(v=[{iconName:"library-books"}]));var y=new p({label:d[h].label,columnIndex:d[h].dataIndex,icons:v,grid:{attrTitle:d[h].label,attrVisible:!0,exportContent:!0,exportLock:b,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:d[h].dataIndex,attrDBName:d[h].attrDBName,attrRemove:!0,pinContent:"unpinned",attrInstRef:d[h].attrParent,attrAlert:null},kind:d[h].kind,children:null});if(S){var P=i.__locateFirstAndLastPin("right");P.first?i.options.attrModel.insertBefore(y,P.first):i.options.attrModel.addChild(y)}else i.options.attrModel.addChild(y);y.select(),f.push(y)}for(h=0;h<f.length;h++)u.push(f[h].dump(C));(c.length||u.length)&&i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:i.options.selectedTypes,selectedExtensions:i.options.selectedExtensions,removedColumns:c,addedColumns:u}}),delete i._globalUpdate}),a=i.options.modelEvents.subscribe({event:"ENXViews/MoreAttributesWizard/closeWizard"},function(){i.options.modelEvents.unsubscribe(a),i.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{idView:"customize",html:i.elements.container,title:t.attributesCustomization.apptitle}})});new e({dgv:i.options.withDgv,modelEvents:i.options.modelEvents,baseTypes:i.options.baseTypes,baseInstanceTypes:i.options.baseInstanceTypes,selectedTypes:i.options.selectedTypes,selectedExtensions:i.options.selectedExtensions,selectedAttributes:o,defaultTypes:i.options.defaultTypes,defaultExtensions:i.options.defaultExtensions,defaultAttributes:i.options.defaultAttributes,dbOnlyAttributes:i.options.dbOnlyAttributes,attributesToIgnore:i.options.attributesToIgnore,onlyCustomer:!1})})}},{className:"divider"},{fonticon:"up",title:t.attributesCustomization.moveUp,name:"moveUp",disabled:!0,handler:function(e,t){i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}},{fonticon:"down",title:t.attributesCustomization.moveDown,name:"moveDown",disabled:!0,handler:function(e,t){i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-top",title:t.attributesCustomization.moveFirst,name:"moveFirst",disabled:!0,handler:function(e,t){i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-bottom",title:t.attributesCustomization.moveLast,name:"moveLast",disabled:!0,handler:function(e,t){i._moveColumn(t.name,i.options.attrModel.getSelectedNodes())}},{className:"divider"},{fonticon:"remove",title:t.attributesCustomization.remove,name:"remove",disabled:!0,handler:function(e,t){i._removeSelectedColumn()}}]};if(!0===this.options.withDgv){this.options.thumbnailsActivated=-1!==e.indexOf("thumbnail");var s=[{fonticon:this.options.rowHeaderActivated?"checkbox-on":"checkbox-off",title:this.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,name:"checkBoxes",handler:function(e,n){i.options.rowHeaderActivated=!i.options.rowHeaderActivated;var o=i.options.rowHeaderActivated?"checkbox-on":"checkbox-off",s=i.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,r={id:i.options.toolbar.getItem("checkBoxes").id,title:s,fonticon:o};i.options.toolbar.menu.updateItem(r),i.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"rowsHeaderModification",rowsHeader:i.options.rowHeaderActivated}})}},{fonticon:"picture",title:this.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,name:"thumbnail",selectable:!0,selected:this.options.thumbnailsActivated,handler:function(e,n){i.options.thumbnailsActivated=!i.options.thumbnailsActivated;var o=i.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,s={id:i.options.toolbar.getItem("thumbnail").id,title:o,selected:i.options.thumbnailsActivated};i.options.toolbar.menu.updateItem(s),i._manageThumbnailAttribute(n.name,n.selected)}},{className:"divider"}];if(!0!==S&&!0!==i.options.noAddRemoveColumn&&i.options.manageAttrFromInstance){var r={fonticon:"list-add",title:t.attributesCustomization.instanceAtt,name:"instanceAttributes",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")}],events:{onClick:function(e,t){i._manageInstanceAttributes(t.name,t.selected)}}}}};s.splice(1,0,r)}o.items.splice.apply(o.items,[2,0].concat(s))}else{var l=[{fonticon:"list-add",title:t.attributesCustomization.specificColumn,name:"specificColumns",id:"specificColumns",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{fonticon:"checkbox-on",text:t.attributesCustomization.selection,name:"selection",id:"selection",selectable:!0,selected:-1!==e.indexOf("selection")},{fonticon:"eye",text:t.attributesCustomization.hide_show,name:"hide_show",id:"hide_show",selectable:!0,selected:-1!==e.indexOf("hide_show")},{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",id:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",id:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")},{fonticon:"picture",text:t.attributesCustomization.thumbnail,name:"thumbnail",id:"thumbnail",selectable:!0,selected:-1!==e.indexOf("thumbnail")}],events:{onClick:function(e,t){i._manageSpecificColumn(t.name,t.selected)}}}}},{className:"divider"}];o.items.splice.apply(o.items,[2,0].concat(l));var d=[{fonticon:"palette",title:t.attributesCustomization.changeColor,name:"changeColor",disabled:!0,handler:function(e,t){i._changeColor(i.options.attrModel.getSelectedNodes())}}];o.items.splice.apply(o.items,[9,0].concat(d))}!0===this.options.noAddRemoveColumn&&(o.items.splice(0,2),o.items.splice(7,2)),this.options.toolbar=new n(o),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],n=["remove","changeColor"],i=e.length,o=!1,s=0;for(s=0;s<i;s++)!0===e[s].options.grid.isAdditionalColumn||e[s].options.grid.layout&&!1===e[s].options.grid.layout.removable||(o=!0);if(0===i){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<n.length;s++)this.options.toolbar.disableItem(n[s])}else if(1===i){for(s=0;s<t.length;s++)this.options.toolbar.enableItem(t[s]);for(s=0;s<n.length;s++)"remove"===n[s]&&!1===o?this.options.toolbar.disableItem(n[s]):this.options.toolbar.enableItem(n[s])}else if(i>=1){for(s=0;s<t.length;s++)this.options.toolbar.disableItem(t[s]);for(s=0;s<n.length;s++)"remove"===n[s]&&!1===o?this.options.toolbar.disableItem(n[s]):this.options.toolbar.enableItem(n[s])}},_moveColumn:function(e,t){!0===this.options.withDgv?this.__dgvMoveColumn(e,t):this.__treeMoveColumn(e,t)},__dgvMoveColumn:function(e,t){var n=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var i,o=t[0],s=o.getReferenceValue("pinContent"),r=o._getLocalID?o._getLocalID():o._localID,a=n.__locateFirstAndLastPin(s,!0),l=a.first._getLocalID?a.first._getLocalID():a.first._localID,d=a.last?a.last._getLocalID?a.last._getLocalID():a.last._localID:n.options.getRoots().length-1;switch(e){case"moveFirst":i=l;break;case"moveUp":i=l<=r-1?r-1:r;break;case"moveDown":i=d>=r+1?r+1:r;break;case"moveLast":i=d}if(r!==i&&n.options.dgvInfo&&!0===n.options.dgvInfo.columnOrdering){n.options.dgvInfo.columnOrdering=!1;var c={from:n.options.attrModel.getRoots()[r].options.columnIndex,to:n.options.attrModel.getRoots()[i].options.columnIndex};n._isMoving=!0,n.options.attrModel.addChild(o,i),o.select(),n._isMoving=!1,n.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:c}})}})},__treeMoveColumn:function(e,t){var n=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var i=t[0],o=i._getLocalID?i._getLocalID():i._localID,s={fromID:o,toID:-1};switch(e){case"moveFirst":s.toID=0;break;case"moveUp":s.toID=o-1;break;case"moveDown":s.toID=o+1;break;case"moveLast":s.toID=n.options.attrModel.getRoots().length-1}-1!==s.toID&&o!==s.toID&&s.toID<n.options.attrModel.getRoots().length&&(n._isMoving=!0,n.options.attrModel.addChild(i,s.toID),i.select(),n._isMoving=!1,n.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:s}}))})},_manageSpecificColumn:function(e,n){var i=this,o=!1,s=!0;"ds6w:label-Instance"===e&&(o=!0,s=!1);var r=["hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],a="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,l=t.attributesCustomization[a]?t.attributesCustomization[a]:e;if(!0===n){if("thumbnail"===e)this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0);this.options.attrModel.withTransactionUpdate(function(){var t=-1!==r.indexOf(e),n=new p({columnIndex:e,label:l,grid:{attrTitle:l,attrVisible:!0,exportContent:o,exportLock:s,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:e,hasTitle:t},modelEvents:i.options.modelEvents});i.options.attrModel.addChild(n)})}else{var d=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<d.length;e++)i.options.attrModel.removeRoot(d[e])})}},_manageInstanceAttributes:function(e,n){var i=this;if(!0===n)this.options.attrModel.withTransactionUpdate(function(){var n="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,o=t.attributesCustomization[n]?t.attributesCustomization[n]:e;switch(e){case"ds6w:label-Instance":var s=new p({columnIndex:e,label:o,grid:{attrTitle:o,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"left",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:i.options.modelEvents});(r=i.__locateFirstAndLastPin("right")).first?i.options.attrModel.insertBefore(s,r.first):i.options.attrModel.addChild(s);break;case"positionMatrix-Instance":var r,a=new p({columnIndex:e,label:o,grid:{attrTitle:o,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:i.options.modelEvents});(r=i.__locateFirstAndLastPin("right")).first?i.options.attrModel.insertBefore(a,r.first):i.options.attrModel.addChild(a)}});else{var o=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<o.length;e++)i.options.attrModel.removeRoot(o[e])})}},_manageThumbnailAttribute:function(e,n){var i=this;if(!0===n)this.options.attrModel.withTransactionUpdate(function(){var n=t.attributesCustomization[e]?t.attributesCustomization[e]:e,o=new p({columnIndex:e,icons:[{iconName:"product"}],label:n,grid:{attrTitle:n,attrVisible:!0,exportContent:!1,exportLock:!0,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:e,hasTitle:!1},modelEvents:i.options.modelEvents}),s=i.__locateFirstAndLastPin("right");s.first?i.options.attrModel.insertBefore(o,s.first):i.options.attrModel.addChild(o)});else{var o=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<o.length;e++)i.options.attrModel.removeRoot(o[e])})}},_removeSelectedColumn:function(){var e=this.options.attrModel.getSelectedNodes(),n=this;this.options.attrModel.withTransactionUpdate(function(){for(var i=0;i<e.length;i++)!0===e[i].options.grid.isAdditionalColumn||e[i].options.grid.layout&&!1===e[i].options.grid.layout.removable?(e[i].unselect(),o.displayNotif({level:"warning",message:t.replace(t.attributesCustomization.cannotRemove,{attr:e[i].getReferenceValue("attrTitle")}),key:"AttCusto-cannotRemove"})):n.options.attrModel.removeRoot(e[i])})},_changeColor:function(e){var t=this;require(["DS/PADServices/views/private/ColorPicker"],function(n){t.elements.container.disabled=!0;var i={background_color:"#ffffff",color:"#000000"};if(1===e.length&&e[0].getReferenceValue("columnColor")){var o=e[0].getReferenceValue("columnColor");i={background_color:o["background-color"],color:o.color}}new n({selected_color:i,renderTo:document.body,events:{onColorOK:function(n){t.elements.container.disabled=!1;for(var i=[],o=0;o<e.length;o++){var s=e[o],r={};"#ffffff"===n.background_color?r["background-color"]=void 0:r["background-color"]=n.background_color,"#000000"===n.color?r.color=void 0:r.color=n.color,s.updateOptions({grid:{columnColor:r}}),i.push(s.options.columnIndex)}t.options.modelEvents.publish({event:"ENXViews/AttributesCustomization/columnModification",data:{what:"changeColor",modifiedColumns:i,"background-color":r["background-color"]+";",color:r.color+";"}})},onClose:function(){t.elements.container.disabled=!1}}})})},__locateFirstAndLastPin:function(e,t){var n,i;let o=2;t&&(o=1);var s=this.options.attrModel.getRoots().filter(function(t){return t.getReferenceValue("pinContent")===e});if(n=s[0],s.length>1&&"left"===e)i=s[r=s.length-o];else if("left"!==e&&1===s.length){var r=this.options.attrModel.getRoots().length-1;i=this.options.attrModel.getRoots()[r]}else{i=s[r=s.length-o]}return{first:n,last:i}}})}),define("DS/PADServices/ws/WSAdmin",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils"],function(e,t){"use strict";function n(){}return n.prototype.getTypesHierarchy=function(t){return new Promise(function(n,i){var o=e.get3DSpaceURL()+"/resources/enong/dico/gettypeshierarchy?tenant="+e.getPlatformId(),s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({types:t}),onComplete:n,onFailure:i};this.executeRequest(o,s)}.bind(this))},n.prototype.getTypeInfo=function(n){return new Promise(function(i,o){var s=e.get3DSpaceURL()+"/resources/dictionary/getTypeInfo?tenant="+e.getPlatformId();n.onlyCustomer&&(s+="&customerOnly=true&displayAttributes=true");var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},onComplete:i,onFailure:o};if(n.url_parameters){for(var a=Object.getOwnPropertyNames(n.url_parameters),l=0;l<a.length;l++)s=s+"&"+a[l]+"="+n.url_parameters[a[l]];delete n.url_parameters}r.data=JSON.stringify(n.body),delete r.body,this.executeRequest(s,r)}.bind(this))},n.prototype.getFullDictionary=function(n){return new Promise(function(i,o){var s=e.get3DSpaceURL()+"/resources/dictionary/Dictionary?tenant="+e.getPlatformId();n&&n.getNLS&&(s+="&lang="+t.getLang());var r={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:3e5,onComplete:i,onFailure:o,onTimeout:o};this.executeRequest(s,r)}.bind(this))},n.prototype.interfaces=function(n){return new Promise(function(i,o){var s=e.get3DSpaceURL()+"/resources/dictionary/class/interfaces?tenant="+e.getPlatformId();n.onlyCustomer&&(s+="&customerOnly=true&displayAttributes=true");var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},onComplete:i,onFailure:o};r.data=JSON.stringify(n.data),this.executeRequest(s,r)}.bind(this))},n.prototype.retrievePQ=function(){return new Promise(function(n,i){var o=e.get3DSpaceURL()+"/resources/SNAPI/pq_services/pqs?tenant="+e.getPlatformId(),s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},cache:-1,onComplete:n,onFailure:i};this.executeRequest(o,s)}.bind(this))},n.prototype.getscandcollab=function(){return new Promise(function(n,i){var o={},s=e.get3DSpaceURL()+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces&tenant="+e.getPlatformId();o.method="GET",o.headers={Accept:"application/json","Accept-Language":t.getLang(),"Content-Type":"application/json"},o.cache=-1,o.onComplete=n,o.onFailure=i,this.executeRequest(s,o)}.bind(this))},n.prototype.getTemplates=function(){return new Promise(function(n,i){var o={},s=e.get3DSpaceURL()+"/resources/v1/collabServices/authoring/op/getTemplatesNames?tenant="+e.getPlatformId()+"&templateType=component";o.method="GET",o.headers={Accept:"application/json","Accept-Language":t.getLang(),"Content-Type":"application/json"},o.cache=-1,o.onComplete=n,o.onFailure=i,o.type="json",this.executeRequest(s,o)}.bind(this))},n.prototype.getTemplatesV2=function(){return new Promise(function(n,i){var o={},s=e.get3DSpaceURL()+"/resources/v1/collabServices/authoring/createContent/typeInfo?tenant="+e.getPlatformId()+"&objType=VPMReference&preferedType=VPMReference&typeName=component&subTypes=true";o.method="GET",o.headers={Accept:"application/json","Accept-Language":t.getLang(),"Content-Type":"application/json"},o.cache=-1,o.onComplete=n,o.onFailure=i,o.type="json",this.executeRequest(s,o)}.bind(this))},n}),define("DS/PADServices/views/private/SoITimeline",["css!DS/PADServices/PADServices.css","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/Windows/Panel"],function(e,t,n,i,o,s){"use strict";function r(e){return this.options=e||{},this.options=Object.assign({dateFormatOptions:{dateStyle:"long",timeStyle:"medium"},sliderStops:[],data:void 0,events:{}},this.options),this.elements={},this.__preprocessData(),this.__buildUX(),this}return r.prototype.close=function(e){!0===this.__surveyLoadingInProgress?this.__removeIdWhenLoaded=e:e===this.getActiveStateId()&&(delete this.__removeIdWhenLoaded,delete this.elements.content,this.elements.panel.close(),"function"==typeof this.options.events.closeTimeline&&this.options.events.closeTimeline(this.options.data.soiData.resourceid))},r.prototype.__preprocessData=function(){this.options.data.states.sort((e,t)=>e.grid["r2v:fsEffectivityDate"]>t.grid["r2v:fsEffectivityDate"]?1:e.grid["r2v:fsEffectivityDate"]<t.grid["r2v:fsEffectivityDate"]?-1:0)},r.prototype.__buildUX=function(){this.elements.content=i.createElement("div",{class:"soi-timeline-container"}),this.__buildContentUX(),this.elements.panel=new s({identifier:"PAD3DSoITimeline",immersiveFrame:this.options.immersiveFrame,title:this.options.data.soiData["ds6w:label"],icon:"url("+this.options.data.soiData.icon+")",content:this.elements.content,resizableFlag:!1,maxHeight:140,minHeight:40,allowedDockAreas:WUXDockAreaEnum.TopDockArea,horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,collapsibleFlag:!1,closeButtonFlag:!1})},r.prototype.__buildContentUX=function(){this.elements.stateTimeline=i.createElement("div",{class:"soi-timeline-states-line"});const e=new Date(this.options.data.states[this.options.loadedStateIdx].grid["r2v:fsEffectivityDate"]),t=this.options.data.states[this.options.loadedStateIdx]["ds6w:label"]+" - "+`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(e)}`;let n=i.createElement("div",{class:"soi-timeline-state-header"});n.appendChild(i.generateIcon({className:"soi-timeline-state-icon",iconPath:this.options.data.states[this.options.loadedStateIdx].icon,iconSize:{height:"22px",width:"22px"}}));let o=this.elements.stateLabel=i.createElement("div",{className:"soi-timeline-state-label"});o.innerText=t,n.appendChild(o),this.elements.content.appendChild(n),this.options.data.states.length>1&&this.elements.content.appendChild(this.elements.stateTimeline),this.__buildSlidderUX()},r.prototype.__buildSlidderUX=function(){this.elements.disabled=i.createElement("div",{class:"soi-timeline-disabled"}),this.elements.sliderTrack=i.createElement("div",{class:"soi-timeline-slider"});let e=this.options.data,t=Math.floor(100/(e.states.length-1)),n="";for(let i=0;i<e.states.length;i++)n+=t+"% ";this.elements.sliderTrack.style.gridTemplateColumns=n,this.elements.stateTimeline.appendChild(this.elements.disabled),this.elements.stateTimeline.appendChild(this.elements.sliderTrack);for(let t=0;t<e.states.length;++t){const n=this.__createStateStop(e.states[t],e.serviceId);t===this.options.loadedStateIdx&&this.__stateStopClicked({target:n,reframe:!0}),this.elements.sliderTrack.appendChild(n),this.options.sliderStops.push(n)}},r.prototype.startStateLoadingTransaction=function(){this.__surveyLoadingInProgress=!0,this.disable()},r.prototype.endStateLoadingTransaction=function(e){this.__surveyLoadingInProgress=!1,this.options.selectedStateId=e,this.enable(),this.__removeIdWhenLoaded&&this.close(this.__removeIdWhenLoaded)},r.prototype.enable=function(){this.elements.disabled.style.display="none"},r.prototype.disable=function(){this.elements.disabled.style.display="block"},r.prototype.setActiveState=function(e){this.__stateStopClicked({target:this.options.sliderStops[e]})},r.prototype.getActiveStateId=function(){return this.options.selectedStateId},r.prototype.__createStateStop=function(e,s){const r=i.createElement("div",{class:"soi-timeline-stop"}),a=new Date(e.grid["r2v:fsEffectivityDate"]),l=`${e["ds6w:label"]}`+" - "+`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(a)}`,d=JSON.stringify({envId:t.getPlatformId(),contextId:n.getSecurityContext(),objectId:e.resourceid,objectType:e.type,displayName:l,description:e["ds6w:description"],serviceId:s,date:a,fromTimeline:!0,soiId:this.options.data.soiData.resourceid,soIdisplayName:this.options.data.soiData["ds6w:label"]});return r.tooltipInfos=new o({title:l,shortHelp:`${e.grid["ds6w:description"]}`}),r.dataset.locstate=e.resourceid,r.dataset.state=d,r.dataset.label=`${e["ds6w:label"]}`+" - "+`${new Intl.DateTimeFormat(window.navigator.language,this.options.dateFormatOptions).format(a)}`,r.addEventListener("click",this.__stateStopClicked.bind(this)),r},r.prototype.__stateStopClicked=function(e){if(!0!==this.__surveyLoadingInProgress){const t=JSON.parse(e.target.dataset.state);t.objectId!==this.options.selectedStateId&&(this.startStateLoadingTransaction(),this.elements.stateLabel.innerText=t.displayName,"function"==typeof this.options.events.stateStopClicked&&(e.previouslySelected=this.options.selectedStateId,this._selectedSurveyElement&&this._selectedSurveyElement.classList.remove("state-selected"),e.stateData=t,this.options.events.stateStopClicked(e).then(()=>{this._selectedSurveyElement=e.target,this._selectedSurveyElement.classList.add("state-selected")})))}},r}),define("DS/PADServices/ws/R2VServices",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/WAFData/WAFData"],function(e,t,n){"use strict";function i(){}return i.prototype.getR2VAssets=function(t){return new Promise(function(t,i,o){const s=e.getPlatformURL(t.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/"+t.objectId+"/assets",r={cors:!0,method:"GET",headers:{"Accept-Language":"*"},onComplete:i,onFailure:function(){o("FAILURE")},onTimeout:function(){o("TIMEOUT")}};n.authenticatedRequest(s,r)}.bind(this,t))},i.prototype.getFeatureState=function(n){const i=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/"+n.objectId,o={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(i,o,!0,!0)},i.prototype.fetchFeatureStates=function(n){const i=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featurestate/fetch",o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify({ids:n.ids})};return this.executeRequestPromise(i,o,!0,!0)},i.prototype.getSoI=function(n){let i=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featureofinterest/"+n.objectId,o={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(i,o,!0,!0)},i.prototype.fetchSoIs=function(n){let i=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featureofinterest/fetch",o={ids:n.ids},s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},data:JSON.stringify(o)};return this.executeRequestPromise(i,s,!0,!0)},i.prototype.getFeatureStatesFromSOI=function(n){const i=e.getPlatformURL(n.serviceId)+"/enovia/resources/r2v/v1/modeler/featureofinterest/"+n.objectId+"/featurestates",o={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}};return this.executeRequestPromise(i,o,!0,!0)},i}),define("DS/PADServices/ws/WSRelations",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],function(e,t){"use strict";function n(){}return n.prototype.getDetail=function(n){return new Promise(function(i,o){var s=t.get3DSpaceURL(),r={onComplete:i,onFailure:o};s=s+"/resources/enorelnav/navigate/getecosystem?tenant="+t.getPlatformId(),r.method="POST",r.headers={Accept:"application/json","Content-Type":"application/json"},r.data={widgetId:"Reveal-"+e.getWidgetId()+"-"+Date.now(),displayTime:!0,trueREST:!0,debug:!1},r.data=Object.assign(r.data,n),r.data=JSON.stringify(r.data),this.executeRequest(s,r)}.bind(this))},n}),define("DS/PADServices/settings/AppSettings",["DS/PADServices/utils/GlobalUtils"],function(e){"use strict";function t(e,t,n){for(var i=Object.keys(e),o=0;o<i.length;o++)e[i[o]].debug=n,t.set(i[o],e[i[o]])}function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this._defaultUUID="DefaultSettingUUID-"+e.getWidgetId(),this._settingsMap=new Map,this)}return n.prototype.initializeSettings=function(e,n){return new Promise(function(i,o){if(e.AMDSettings);else if(e.padsettingsInit){var s=this.getSettingsMap(n,!0);t(e.padsettingsInit.run_options,s),t(e.padsettingsInit.debug_options,s,!0),t(e.padsettingsInit.session_options,s)}else o();i()}.bind(this))},n.prototype.getSettingsMap=function(e,t){void 0===e&&(e=this._defaultUUID);var n=this._settingsMap.get(e);return void 0===n&&!0===t&&(n=new Map,this._settingsMap.set(e,n)),n},n.prototype.getSetting=function(t,n){var i,o=this.getSettingsMap(n);o&&(i=o.get(t));var s,r,a=o&&i?i.value:void 0;if(void 0===a){var l=e.getURLParameter(t);a=l?(s=l,r=!1,UWA.is(s,"boolean")?r=s:UWA.is(s,"string")&&(r="true"===s.toLowerCase()),r):void 0}return a},n.prototype._dump=function(e){var t={};const n=this.getSettingsMap(e).entries();for(var i=n.next();!1===i.done;)t[i.value[0]]=i.value[1],i=n.next();return t},new n}),define("DS/PADServices/utils/Storage",["DS/PADServices/utils/GlobalUtils"],function(e){function t(e){this.root=e}t.prototype={set:function(e,t){try{return this.root.setItem(e,JSON.stringify(t)),!0}catch(t){return console.error(t),console.error(`${e} not stored`),t&&"QuotaExceededError"===t.name&&console.error(`${e} data may be the quotexceed problem.`),!1}},setWithExpire:function(e,t,n){return t.expiresAt=Date.now()+n,this.set(e,t)},get:function(e){var t;try{t=JSON.parse(this.root.getItem(e))}catch(e){return console.error(e),null}return t&&t.expiresAt?Date.now()<t.expiresAt?t:(this.root.removeItem(e),null):t},del:function(e){this.root.removeItem(e)},clear:function(){this.root.clear()}};var n={local:new t(localStorage),session:new t(sessionStorage)},i={buildKey:function(t,n,i){return i?t+"."+e.getWidgetId()+"."+n:t+"."+n}};return Object.defineProperties(i,{local:{get:function(){return n.local}},sess:{get:function(){return n.session}}}),i}),define("DS/PADServices/utils/ClassificationAttributes",["UWA/Core","UWA/Promise","DS/PADServices/utils/GlobalUtils","DS/PADServices/settings/AppSettings","DS/Utilities/Utils"],function(e,t,n,i,o){"use strict";var s=!1;return{getClassificationAttributes:function(e){return new t(function(e,t){let o=i.getSetting("activateFUN118223");if(s||!0!==o)return e();require(["DS/ClassificationUtil/ClassificationUtil"],function(t){t.fetchClassificationAttributes({apiVersion:"R2019x",lang:n.getLang(),onComplete:function(t){e(t)},onFailure:function(t){console.warn("Cannot retrieve Classification Attributes"),e()}})},function(){s=!0,e()})})}}}),define("DS/PADServices/utils/DictionaryAccess",["UWA/Core","UWA/Promise","DS/Utilities/Utils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/NlsCache","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/ClassificationAttributes"],function(e,t,n,i,o,s,r,a,l){"use strict";var d={nodes2updateId:[],nodes2update:[],grpnodes2updateId:[],grpnodes2update:[],idx:0,idxGrp:0};const c=["globaltype","ds6wg:revision","ds6w:type","ds6w:cadMaster","ds6w:status"],p=["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:responsible","ds6wg:revision","ds6w:status","owner","ds6w:created"];function u(e,t,n){e[t]||(e[t]=[]),-1===e[t].indexOf(n)&&e[t].push(n)}function h(t,n,i){for(var o=!1,s={grid:e.clone(t.options.grid)},r=0;r<n.length;r++)s.grid[n[r]]&&i[n[r]][s.grid[n[r]]]&&i[n[r]][s.grid[n[r]]]!==s.grid[n[r]]&&(o=!0,s.grid[n[r]]=i[n[r]][s.grid[n[r]]]);return{updated:o,options:s}}var m=n.debounce(function(t){v.idx=0;var n,o,l,p={},u=require("DS/PADServices/utils/AttributesMgtV2"),h=u.getAvailableColumns(),m=u.getColumnsToNotNls(),f=h.filter(function(e){return-1===m.indexOf(e)});for(n=0;n<t.length;n++){l=t[n].getTreeDocument();var g=Object.getOwnPropertyNames(t[n].options.grid);for(o=0;o<g.length;o++)if(u.hasNLS(g[o])&&"ds6w:reserved"!==g[o]&&"ds6w:reserved-Instance"!==g[o]&&"positionMatrix-Instance"!==g[o]&&-1!==f.indexOf(g[o])){var b=-1!==g[o].indexOf("-Instance")?g[o].substring(0,g[o].indexOf("-Instance")):g[o];void 0===p[b]&&(p[b]=[]),-1===p[b].indexOf(t[n].options.grid[g[o]])&&p[b].push(t[n].options.grid[g[o]])}}i.getNlsOfPropertiesValues(JSON.stringify(p),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(i){var s=e.is(i,"string")?JSON.parse(i):i;Object.getOwnPropertyNames(s);function a(t){var n=!1,i={grid:e.clone(t.options.grid)},a=Object.keys(i.grid);for(o=0;o<a.length;o++){var l=-1!==a[o].indexOf("-Instance")?a[o].substring(0,a[o].indexOf("-Instance")):a[o];if(s[l]&&s[l][i.grid[a[o]]]&&s[l][i.grid[a[o]]]!==i.grid[a[o]]){n=!0,i.grid[a[o]+"-original"]=i.grid[a[o]],i.grid[a[o]]=s[l][i.grid[a[o]]];let e=a[o],t=e+"-original";-1!==c.indexOf(e)&&r.store(e,i.grid[t],i.grid[e])}}return{updated:n,options:i}}if(l)l.setUseChangeTransactionMode(!0),l.withTransactionUpdate(function(){for(n=0;n<t.length;n++){var e=t[n],i=a(e);!0===i.updated&&e.updateOptions(i.options),delete e._manageNLS,e.options.ensureNLS=!1}d.nodes2updateId=[],d.nodes2update=[]}),l.setUseChangeTransactionMode(!1);else{for(n=0;n<t.length;n++){var p=t[n],u=a(p);!0===u.updated&&p.updateOptions(u.options),delete p._manageNLS,p.options.ensureNLS=!1}d.nodes2updateId=[],d.nodes2update=[]}},onFailure:function(e){console.warn("Cannot retrieve NLS"),d.nodes2updateId=[],d.nodes2update=[]}})},100),f=n.debounce(function(t){v.idxGrp=0;var n,o,r={};if(t.length){for(o=t[0].getTreeDocument(),n=0;n<t.length;n++){var l=t[n].options.ds6w;r[l]||(r[l]=[]),-1===r[l].indexOf(t[n].getLabel())&&r[l].push(t[n].getLabel())}i.getNlsOfPropertiesValues(JSON.stringify(r),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(i){var s=e.is(i,"string")?JSON.parse(i):i;function r(i){var o={label:e.clone(i.getLabel())},r=!1,a=t[n].options.ds6w;return s[a][i.getLabel()]&&i.getLabel()!==s[a][i.getLabel()]&&(r=!0,o.label=s[a][i.getLabel()]),{updated:r,options:o}}o&&(o.setUseChangeTransactionMode(!0),o.withTransactionUpdate(function(){for(n=0;n<t.length;n++){var e=t[n],i=r(e);!0===i.updated&&e.updateOptions(i.options),delete e._manageNLS}d.grpnodes2updateId=[],d.grpnodes2update=[]}),o.setUseChangeTransactionMode(!1))},onFailure:function(e){console.warn("Cannot retrieve NLS"),d.grpnodes2updateId=[],d.grpnodes2update=[]}})}},100),v={__mapAttNameNLS:{},initNLS:function(){return this.retrieveDS6WNLS(p)},getAttNameNLS:function(e){return this.__mapAttNameNLS[e]?this.__mapAttNameNLS[e].label:o.columnsNLS[e]?o.columnsNLS[e]:e},retrieveDS6WNLS:function(e){return new t((t,n)=>{var o={tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:e=>{for(let t=0;t<e.length;t++)this.__mapAttNameNLS[e[t].curi]=e[t];t(this.__mapAttNameNLS)},onFailure:()=>{t()}};i.getResourcesInfo(e.join(","),o)})},retrieveNLS:function(n){return new t(function(t,o){i.getNlsOfPropertiesValues(JSON.stringify(n.nlsData),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(n){var i=e.is(n,"string")?JSON.parse(n):n;t(i)},onFailure:function(e){console.warn("Cannot retrieve NLS"),t({})}})})},retrieveNLSWithSource:function(n){return new t(function(t,o){i.getNlsOfPropertiesValuesBySource(n.nlsData,{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(n){var i=e.is(n,"string")?JSON.parse(n):n;t(i)},onFailure:function(e){console.warn("Cannot retrieve NLS"),t({})}})})},updateColumnsWithNLS:function(t,n){var i,r=this,a=[],d=require("DS/PADServices/utils/AttributesMgtV2"),c=d.getBaseInstanceTypes().length>0;for(r.completeResponse={},i=0;i<t.length;i++){var p=null;if(p=t[i].ds6w&&"rel"!==t[i].ds6wFrom?t[i].ds6w:t[i].ds6w&&"rel"===t[i].ds6wFrom?t[i].dataIndex:t[i].xnav_options&&t[i].xnav_options.name?t[i].xnav_options.name:t[i].dataIndex,t[i].customisation&&!0===t[i].customisation.titleModified&&(p=null),p){if("actualIndex"===p)continue;if(t[i].text)r.completeResponse[p]={nlsName:t[i].text,lang:s.getLang()};else if(t[i].label)console.info("custom_label==>",p),r.completeResponse[p]={nlsName:t[i].label,lang:s.getLang()};else if(-1!==p.indexOf(":")&&"rel"!==t[i].ds6wFrom)a.push(p);else if("rel"===t[i].ds6wFrom){if(-1!==p.indexOf(":"))if(!0===c){var u=p.substring(0,p.indexOf("-Instance"));-1===a.indexOf(u)&&a.push(u)}else"ds6w:label-Instance"===p&&(r.completeResponse[p]={nlsName:o.attributesCustomization.instanceName,lang:s.getLang()});"positionMatrix-Instance"===p&&(r.completeResponse[p]={nlsName:o.attributesCustomization.instanceMatrix,lang:s.getLang()})}else t[i].xnav_options&&!0===t[i].xnav_options.hardcoded?r.completeResponse[p]={nlsName:o[p],lang:s.getLang()}:o.attributesCustomization[p]?r.completeResponse[p]={nlsName:o.attributesCustomization[p],lang:s.getLang()}:!0!==t[i].isAdditionalColumn&&d.isAttributeColumn(t[i].dataIndex)&&console.warn("DictionaryAccess## Unknown attribute type:"+t[i].dataIndex)}}var h=function(){for(i=0;i<t.length;i++){var e=null,o=null;t[i].ds6w&&"rel"!==t[i].ds6wFrom?e=t[i].ds6w:t[i].ds6w&&"rel"===t[i].ds6wFrom?-1!==(e=t[i].dataIndex).indexOf("-Instance")&&(o=e.substring(0,e.indexOf("-Instance"))):e=t[i].xnav_options&&t[i].xnav_options.name?t[i].xnav_options.name:t[i].dataIndex,e&&r.completeResponse[e]&&r.completeResponse[e].nlsName&&!0!==t[i].noTitleColumn?t[i].text=r.completeResponse[e].nlsName:o&&r.completeResponse[o]&&r.completeResponse[o].nlsName&&!0!==t[i].noTitleColumn?t[i].text=r.completeResponse[o].nlsName+" ":e&&-1!==e.indexOf("ds6w")&&!0!==t[i].customisation.titleModified&&(console.warn("DictionaryAccess## ds6w attribute ["+e+"] not found by FedDictionaryAccessAPI.getResourcesInfo"),t[i].text=e)}n({status:"success",columns:t})};a.length>0?r.getResourcesInfo(a).then(function(t){if(e.is(t,"array"))for(var n=0;n<t.length;n++){var i=t[n].label;if(t[n].curi)if(i===t[n].curi.replace("ds6wg:","")){console.warn("No real label for attribute "+t[n].curi);var o=i.indexOf(".");o>0&&(i=i.substring(o+1))}r.completeResponse[t[n].curi]={nlsName:i,lang:s.getLang(),kind:t[n].dataType}}}).then(l.getClassificationAttributes).then(function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)for(var n=0;n<e[t].properties.length;n++){var i=e[t].properties[n];void 0!==r.completeResponse[i.curi]&&(r.completeResponse[i.curi]={nlsName:i.label,lang:s.getLang(),kind:i.dataType})}}).finally(function(){h()}):h()},updateNLS:function(e){var t=e.getOccurencePath();-1===d.nodes2updateId.indexOf(t)&&(d.nodes2updateId.push(t),d.nodes2update.push(e),m(d.nodes2update))},updateNLSforexport:function(n,o){var r=o||n.getAllDescendants();return new t(function(t,o){var l=function(e){for(var t={},n=require("DS/PADServices/utils/AttributesMgtV2"),i=n.getAvailableColumns(),o=n.getColumnsToNotNls(),s=i.filter(function(e){return-1===o.indexOf(e)}),r=0;r<e.length;r++)for(var a=e[r],l=Object.keys(a.options.grid),d=0;d<l.length;d++){var c=l[d];n.hasNLS(c)&&-1!==s.indexOf(c)&&"ds6w:reserved"!==c&&"positionMatrix-Instance"!==c&&u(t,c,a.options.grid[c])}return t}(r);i.getNlsOfPropertiesValues(JSON.stringify(l),{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(i){var o=function(e){for(var t={},n=Object.keys(e),i=0;i<n.length;i++)for(var o=e[n[i]],s=Object.keys(o),r=0;r<s.length;r++){var a=s[r],l=o[a];l&&a!==l&&0!==l.indexOf("emxFramework")&&(t[n[i]]||(t[n[i]]={}),t[n[i]][a]=l)}return t}(e.is(i,"string")?JSON.parse(i):i),s=Object.keys(o);n.setUseChangeTransactionMode(!0),n.withTransactionUpdate(function(){for(var e=0;e<r.length;e++){var t=r[e],n=h(t,s,o);!0===n.updated&&t.updateOptions(n.options)}}),n.setUseChangeTransactionMode(!1),t()},onFailure:function(e){console.warn("Cannot retrieve NLS"),t()}})})},getPropertiesForClass:function(n){return new t(function(t,o){i.getPropertiesForClass(n.classURIs,{tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(n){var i=e.is(n,"string")?JSON.parse(n):n;t(i)},onFailure:function(e){o(e)}})})},getResourcesInfo:function(e){return new t(function(t,n){var o={tenantId:a.getPlatformId(),lang:s.getLang(),apiVersion:"R2019x",onComplete:function(e){t(e)},onFailure:function(n){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getResourcesInfo failed for"+e.join(",")),n&&n.length?t(n):t()}};i.getResourcesInfo(e.join(","),o)})},updateNLSGroupingNode:function(e){var t=e.getGroupID();-1===d.grpnodes2updateId.indexOf(t)&&(d.grpnodes2updateId.push(t),d.grpnodes2update.push(e),f(d.grpnodes2update))}};return v}),define("DS/PADServices/utils/AttributesMgtV2",["DS/Utilities/UUID","DS/PADServices/utils/DictionaryAccess"],function(e,t){"use strict";var n=["matrixtxt"];const i=["ds6w:reservedBy"];function o(e){var t,n,i={},o={};if(e.attributes)for(t=0;t<e.attributes.length;t++){!(s=e.attributes[t]).ds6w&&s.name&&0===s.name.indexOf("ds6w:")&&(s.ds6w=s.name,delete s.name),s.dataIndex?i[s.dataIndex.toLowerCase()]=s:s.ds6w&&(i[s.ds6w.toLowerCase()]=s),!0===s.tree&&(n=s.ds6w),"rel"===s.ds6wFrom&&(o[s.ds6w.toLowerCase()]=s.dataIndex)}if(e.commandColumns)for(t=0;t<e.commandColumns.length;t++){var s;(s=e.commandColumns[t]).isCommand=!0,s.dataIndex&&(i[s.dataIndex]=s)}return{accessMap:i,accessMapInst:o,treeColumn:n}}function s(){return"object"==typeof s.instance?s.instance:(this._mapAttribute=new Object,this._defaultUUID="Default-"+e.v4(),this._currentUUID="Current"+e.v4(),this.isInitialized=!1,s.instance=this,this)}return s.prototype.getKind=function(){return"Static"},s.prototype.initialize=function(e){return new Promise((t,n)=>{var i=e.uuid;i||(i=this._defaultUUID),new Promise((t,s)=>{this._mapAttribute[i]&&this.isInitialized?t():(e.defaultAttributesJSON||n("Default Attributes JSON not in initialization parameters"),require(["text!"+e.defaultAttributesJSON],n=>{var r=JSON.parse(n),a=o(r);r.treeColumn=a.treeColumn,r.attAccessMap=a.accessMap,r.attInstAccessMap=a.accessMapInst,this._mapAttribute[i]=r,this._mapAttribute[this._currentUUID]=r,e.appAttributesJSON?require(["text!"+e.appAttributesJSON],e=>{var n=JSON.parse(e);this.updateAttributesList(n,i),this.isInitialized=!0,t()},s):(!0===r.default&&(r.defaultOrder=r.order.slice(),r.defaultAttributes=r.attributes.slice(),r.defaultSelectedTypes=r.selectedTypes.slice(),r.defaultSelectedExtensions=r.selectedExtensions.slice(),this._mapAttribute[i]=r,this._mapAttribute[this._currentUUID]=r),this.isInitialized=!0,t())},s))}).then(()=>{t()})})},s.prototype.deleteMapping=function(e){var t=e?e.uuid:void 0;t||(t=this._defaultUUID),this._mapAttribute[t]&&delete this._mapAttribute[t]},s.prototype.getCurrentUUID=function(e){return e||(Object.keys(this._mapAttribute).length>=1?this._currentUUID:this._defaultUUID)},s.prototype.getMap=function(e){var t,n=this.getCurrentUUID(e);if(!(t=this._mapAttribute[n]))throw new Error("Map is not initialized for UUID "+n);return t},s.prototype.updateAttributesList=function(e,t){return new Promise(function(n){var i;if(!0===e.default?(i=this.getMap(this._defaultUUID),this.getCurrentUUID(this._defaultUUID)):(i=this.getMap(t),this.getCurrentUUID(t)),e.attributesToIgnore&&(i.attributesToIgnore=e.attributesToIgnore),delete i.computedOutputs,Array.isArray(e)){var s,r=[];for(s=0;s<e.length;s++)e[s].dataIndex&&"bi_color"!==e[s].dataIndex&&(r.push(this.addAvailableColumn(e[s].dataIndex,e[s],t)),-1===i.order.indexOf(e[s].dataIndex)&&i.order.push(e[s].dataIndex));Promise.all(r).then(function(){var t=o(i);i.treeColumn=t.treeColumn,i.attAccessMap=t.accessMap,i.attInstAccessMap=t.accessMapInst,!0===e.default&&(i.defaultOrder=i.order.slice(),i.defaultAttributes=i.attributes.slice(),i.defaultSelectedTypes=i.selectedTypes.slice(),i.defaultSelectedExtensions=i.selectedExtensions.slice(),this._mapAttribute[this._defaultUUID]=JSON.parse(JSON.stringify(i))),this._mapAttribute[this._currentUUID]=JSON.parse(JSON.stringify(i)),n()}.bind(this))}else{var a=o(i=function(e,t){var n,i=new Object(e),o=[];if(t.order&&(i.order=t.order),t.attributes)for(n=0;n<t.attributes.length;n++){var s=t.attributes[n];if(i.attAccessMap[s.ds6w])o.push(s);else{i.attributes.push(s);var r=s.dataIndex?s.dataIndex:s.ds6w;-1===i.order.indexOf(r)&&i.order.push(r)}}if(t.commandColumns)for(n=0;n<t.commandColumns.length;n++)s=t.commandColumns[n],i.attAccessMap[s.dataIndex]?(i.attributes.push(s),r=s.dataIndex?s.dataIndex:s.ds6w,-1===i.order.indexOf(r)&&i.order.push(r)):o.push(s);return Array.isArray(t.baseTypes)&&(i.baseTypes=t.baseTypes),Array.isArray(t.baseInstanceTypes)&&(i.baseInstanceTypes=t.baseInstanceTypes),Array.isArray(t.selectedTypes)&&(i.selectedTypes=t.selectedTypes),Array.isArray(t.selectedExtensions)&&(i.selectedExtensions=t.selectedExtensions),i}(i,e));i.treeColumn=a.treeColumn,i.attAccessMap=a.accessMap,i.attInstAccessMap=a.accessMapInst,!0===e.default&&(i.defaultOrder=i.order.slice(),i.defaultAttributes=i.attributes.slice(),i.defaultSelectedTypes=i.selectedTypes.slice(),i.defaultSelectedExtensions=i.selectedExtensions.slice(),this._mapAttribute[this._defaultUUID]=JSON.parse(JSON.stringify(i))),this._mapAttribute[this._currentUUID]=JSON.parse(JSON.stringify(i)),n()}}.bind(this))},s.prototype.getColumnsOrder=function(e){return this.getMap(e).order},s.prototype.getColumn=function(e,t){return this.getMap(t).attAccessMap[e.toLowerCase()]},s.prototype.addAvailableColumn=function(e,t,n){return new Promise(function(i){var s=this.getColumn(e);if("bi_color"!==e&&void 0===this.getColumn(e)){var r=this.getMap(n),a=this.getCurrentUUID(n);"selection"===e&&(t.type="selection"),r.attributes.push(t),-1===r.order.indexOf(t.dataIndex)&&r.order.push(t.dataIndex);var l=o(r);r.treeColumn=l.treeColumn,r.attAccessMap=l.accessMap,r.attInstAccessMap=l.accessMapInst,delete r.computedOutputs,this._mapAttribute[a]=r,i(this.getColumn(e))}else{s=JSON.parse(JSON.stringify(s)),i(UWA.extend(s,t,!0))}}.bind(this))},s.prototype.removeAvailableColumn=function(e,t){return new Promise(function(n){if(void 0!==this.getColumn(e,t)){for(var i=this.getMap(t),s=this.getCurrentUUID(t),r=0,a=0;0===r&&a<i.attributes.length;a++)i.attributes[a].dataIndex===e&&(r=a);if(r){i.attributes.splice(r,1);var l=o(i);i.treeColumn=l.treeColumn,i.attAccessMap=l.accessMap,i.attInstAccessMap=l.accessMapInst,delete i.computedOutputs,this._mapAttribute[s]=i}n()}else n()}.bind(this))},s.prototype.updateAttributesWithKind=function(e,i){if(i)return new Promise(function(e){var o=i.filter(function(e){return void 0===e.kind&&e.ds6w&&-1===n.indexOf(e.ds6w)}).map(function(e){return e.ds6w}),s=o.filter(function(e,t){return o.indexOf(e)===t});s.length?t.getResourcesInfo(s).then(function(t){for(var n=t.map(function(e){return e.curi}),o=0;o<i.length;o++)i[o].ds6w&&-1!==n.indexOf(i[o].ds6w)&&(i[o].kind=t[n.indexOf(i[o].ds6w)].dataType);e(i)}):e(i)});var o=this.getMap(e),s=this.getCurrentUUID(e);return!0===o.columnsChecked?Promise.resolve():new Promise(function(e){var i=o.attributes.filter(function(e){return void 0===e.kind&&e.ds6w&&-1===n.indexOf(e.ds6w)}).map(function(e){return e.ds6w}),r=i.filter(function(e,t){return i.indexOf(e)===t});r.length?t.getResourcesInfo(r).then(function(t){if(t)for(var n=0;n<t.length;n++){var i=t[n].curi;i===o.treeColumn&&(i="tree"),o.attAccessMap[i]&&(o.attAccessMap[i].kind=t[n].dataType)}o.columnsChecked=!0,this._mapAttribute[s]=o,e()}.bind(this)):(o.columnsChecked=!0,this._mapAttribute[s]=o,e())}.bind(this))},s.prototype.getTreeColumn=function(e){return this.getMap(e).treeColumn},s.prototype.getAttributesToIgnore=function(e){return this.getMap(e).attributesToIgnore},s.prototype.getAvailableColumns=s.prototype.getColumnsOrder,s.prototype.getAvailableColumnsOpts=function(e){for(var t=[],n=this.getColumnsOrder(e),i=0;i<n.length;i++){var o=this.getColumn(n[i],e);o&&t.push(o)}return t},s.prototype.getBaseTypes=function(e){return this.getMap(e).baseTypes},s.prototype.getBaseInstanceTypes=function(e){var t=this.getMap(e);return t.baseInstanceTypes?t.baseInstanceTypes:[]},s.prototype.getSelectedTypes=function(e){return this.getMap(e).selectedTypes},s.prototype.getSelectedExtensions=function(e){return this.getMap(e).selectedExtensions},s.prototype.updateSelectedParams=function(e,t){var n=this.getMap(t),i=this.getCurrentUUID(t);e.selectedTypes&&(n.selectedTypes=e.selectedTypes),e.selectedExtensions&&(n.selectedExtensions=e.selectedExtensions);var s=o(n);n.treeColumn=s.treeColumn,n.attAccessMap=s.accessMap,n.attInstAccessMap=s.accessMapInst,this._mapAttribute[i]=n},s.prototype.getDefaultTypesAndExtensions=function(e){var t=this.getMap(e);return{defaultTypes:t.defaultSelectedTypes,defaultExtensions:t.defaultSelectedExtensions}},s.prototype.resetSelectedParams=function(e){var t=this.getMap(this._defaultUUID),n=this.getCurrentUUID(e);t.order=t.defaultOrder,t.attributes=t.defaultAttributes,t.selectedTypes=t.defaultSelectedTypes,t.selectedExtensions=t.defaultSelectedExtensions;var i=o(t);t.treeColumn=i.treeColumn,t.attAccessMap=i.accessMap,t.attInstAccessMap=i.accessMapInst,this._mapAttribute[n]=t},s.prototype.addBIColumn=function(e,t,n){var i=this.getMap(n),o=this.getCurrentUUID(n);void 0===i.attAccessMap[e]&&(delete i.computedOutputs,void 0===i.biPredicates&&(i.biPredicates=[]),-1===i.biPredicates.indexOf(e)&&i.biPredicates.push(e),!0===t&&(void 0===i.biPredicatesInst&&(i.biPredicatesInst=[]),-1===i.biPredicatesInst.indexOf(e)&&i.biPredicatesInst.push(e)),-1===i.order.indexOf(e)&&i.order.push(e),this._mapAttribute[o]=i),!0===t&&void 0===i.attInstAccessMap[e+"-Instance"]&&(delete i.computedOutputs,void 0===i.biPredicatesInst&&(i.biPredicatesInst=[]),-1===i.biPredicatesInst.indexOf(e)&&i.biPredicatesInst.push(e),-1===i.order.indexOf(e+"-Instance")&&i.order.push(e+"-Instance"),this._mapAttribute[o]=i)},s.prototype.removeBIColumn=function(e,t){var n=this.getMap(t),i=this.getCurrentUUID(t);void 0===n.attAccessMap[e]&&(delete n.computedOutputs,void 0!==n.biPredicates&&-1!==n.biPredicates.indexOf(e)&&(n.biPredicates.splice(n.biPredicates.indexOf(e),1),0===n.biPredicates.length&&delete n.biPredicates),-1!==n.order.indexOf(e)&&n.order.splice(n.order.indexOf(e),1),void 0!==n.biPredicatesInst&&-1!==n.biPredicatesInst.indexOf(e)&&(n.biPredicatesInst.splice(n.biPredicatesInst.indexOf(e),1),0===n.biPredicatesInst.length&&delete n.biPredicatesInst),-1!==n.order.indexOf(e+"-Instance")&&n.order.splice(n.order.indexOf(e+"-Instance"),1),this._mapAttribute[i]=n)},s.prototype.createOutputsRequest=function(e,t){var n=this.getMap(t),o=["physicalid","ds6w:globalType"],s=["physicalid","ds6w:globalType"],r=n.predefinedComputation?n.predefinedComputation:["thumbnail_2d","icon"],a=n.computedOutputs&&n.computedOutputs[e];if(!a){for(var l=Object.keys(n.attAccessMap),d=l.length,c=0;c<d;c++)if(!0!==n.attAccessMap[l[c]].isCommand&&"thumbnail"!==l[c]&&"actualindex"!==l[c]&&n.attAccessMap[l[c]].ds6w)if("rel"===n.attAccessMap[l[c]].ds6wFrom){var p=n.attAccessMap[l[c]].ds6w;p.length>9&&"-Instance"===p.substring(p.length-9,p.length)&&(p=p.substring(0,p.length-9)),-1===s.indexOf(p)&&s.push(p)}else-1===o.indexOf(n.attAccessMap[l[c]].ds6w)&&o.push(n.attAccessMap[l[c]].ds6w);if(n.biPredicates)for(c=0;c<n.biPredicates.length;c++)-1===o.indexOf(n.biPredicates[c])&&o.push(n.biPredicates[c]);if(n.biPredicatesInst)for(c=0;c<n.biPredicatesInst.length;c++)-1===s.indexOf(n.biPredicatesInst[c])&&s.push(n.biPredicatesInst[c]);i.length&&(o=o.concat(i)),o=o.filter(function(e,t,n){return n.indexOf(e)===t}),s=s.filter(function(e,t,n){return n.indexOf(e)===t}),a="expandV2"===e?{select_object:o,select_relation:s,hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]}}:"fetch"===e?{select_predicate:o,select_file:r}:{select_object:o,select_relation:s,select_file:r},n.computedOutputs||(n.computedOutputs={}),n.computedOutputs[e]=a,this._mapAttribute[this.getCurrentUUID(t)]=n}return a},s.prototype.hasNLS=function(e,t){var n=this.getMap(t),i=!0,o=e.toLowerCase();return n.additionalColumns&&-1!==n.additionalColumns.indexOf(e)?i=!1:n.attAccessMap[o]&&UWA.is(n.attAccessMap[o].hasNLS,"boolean")&&(i=n.attAccessMap[o].hasNLS),i},s.prototype.isAttributeColumn=function(e,t){var n=this.getMap(t),i=!1,o=n.attAccessMap[e.toLowerCase()];return o&&(!0!==o.isCommand&&!0!==o.isAdditionalColumn||e===n.treeColumn)&&(i=!0),i},s.prototype.addAsyncAttributes=function(e,t){for(var n=this.getMap(t),i=this.getCurrentUUID(t),o=0;o<e.length;o++)n.additionalColumns||(n.additionalColumns=[]),-1===n.additionalColumns.indexOf(e[o])?n.additionalColumns.push(e[o]):console.warn("Additional Column Attribute["+e[o]+"] already defined");this._mapAttribute[i]=n},s.prototype.getAdditionalColumns=function(e){return this.getMap(e).additionalColumns},s.prototype.getColumnsToNotNls=function(e){var t=this.getMap(e),n=t.attributesToNotNls;return n||(n=[]),n=n.concat(t.additionalColumns)},s.prototype.deprecatedLoadAttr=function(e,t){console.warn("Deprecated use of DS/PADServices/utils/AttributesMgt please use DS/PADServices/utils/AttributesMgtV2");var n=t;if(n||(n=this._defaultUUID),this._mapAttribute[n])throw new Error("AttributesMgt Map with UUID["+n+"] already created");if(void 0===e)throw new Error("Default Attributes JSON not in initialization parameters");var i=o(e);e.treeColumn=i.treeColumn,e.attAccessMap=i.accessMap,e.attInstAccessMap=i.accessMapInst,this._mapAttribute[n]=e;var s=e.attributesToNotNls?e.attributesToNotNls.slice():[];this._mapAttribute[this._currentUUID]={baseTypes:e.baseTypes.slice(),selectedTypes:e.selectedTypes.slice(),selectedExtensions:e.selectedExtensions.slice(),order:e.order.slice(),attributes:e.attributes.slice(),commandColumns:e.commandColumns.slice(),treeColumn:e.treeColumn,attAccessMap:e.attAccessMap,attInstAccessMap:e.attInstAccessMap,attributesToNotNls:s,typeRepresentations:e.typeRepresentations},this.isInitialized=!0},s.prototype.intentActivated=function(e){return this.getMap(e).intentActivated},s.prototype.useIntent=function(e){var t=this.getMap(e),n=this.getCurrentUUID(e),i=o(t={intentActivated:!0,baseTypes:["VPMReference","VPMRepReference"],selectedTypes:["VPMReference","VPMRepReference","3DShape"],selectedExtensions:["XCADExtension","EnterpriseExtension"],order:[],attributes:[],commandColumns:[],typeRepresentations:{}});t.treeColumn=i.treeColumn,t.attAccessMap=i.accessMap,t.attInstAccessMap=i.accessMapInst,this._mapAttribute[n]=t},new s}),define("DS/PADServices/utils/AttributesMgt",["text!DS/PADServices/assets/init/AttributesMgt.json","DS/PADServices/utils/AttributesMgtV2"],function(e,t){"use strict";var n=JSON.parse(e);return t.deprecatedLoadAttr(n),t}),define("DS/PADServices/utils/IconMgt",["DS/PADServices/utils/Storage","DS/PADServices/settings/AppSettings"],function(e,t){"use strict";const n="ENX-ICON-MAP",i="ENX2DApp.THUMB-MAP",o="$$",s=["ds6w:type","bo.plmentity.v_usage"],r=["ds6w:type","bo.plmentity.v_usage"];function a(){return"object"==typeof a.instance?a.instance:(a.instance=this,this.iconMap={},this.iconMap=e.local.get(n),this.thumbNailMap=e.local.get(i),this.thumbNailMap&&function(e){let t=Object.keys(e);for(let n=0;n<t.length;n++){let i=t[n];i.startsWith("ds6w:type")&&delete e[i]}}(this.thumbNailMap),this.iconMap||(this.iconMap={}),this.thumbNailMap||(this.thumbNailMap={}),this.isActivePref=null,this)}return a.prototype.isActive=function(){return null===this.isActivePref&&(this.isActivePref=!0===t.getSetting("Icon_URL_by_pass"),console.log("Check icon URL activation value=["+this.isActivePref+"]")),this.isActivePref},a.prototype.buildKey=function(e){var t="";for(let n=0;n<s.length;n++)e[s[n]]&&(0!==t.length&&(t+=o),t+=s[n]+o+e[s[n]]);return t},a.prototype.buildThumbKey=function(e){var t="";for(let n=0;n<r.length;n++)e[r[n]]&&(0!==t.length&&(t+=o),t+=r[n]+o+e[r[n]]);return t},a.prototype.initializeIconMap=function(e){var t=this;return new Promise(n=>{var i=[],s=[];for(let n=0;n<e.typeMap.length;n++)if(!t.iconMap[e.typeMap[n]]){var r=e.typeMap[n].split(o),a={};for(let e=0;e<r.length;e+=2)a[r[e]]=r[e+1];i.push(a),s.push(e.rscIds[n])}!function(e,t,n,i,s){for(let l=0;l<t.length;l++){let d=t[l];if(!n[d]){var r=d.split(o),a={};for(let e=0;e<r.length;e+=2)a[r[e]]=r[e+1];s.push(a),i.push(e[l])}}}(e.thumbsRscId,e.typeMapThumbs,t.thumbNailMap,s,i);var l=Promise.resolve();i.length&&(l=t._completeIconMap(i,s)),l.then(function(){n(t.iconMap)})})},a.prototype.getRequiredAtt=function(){return s},a.prototype.getIcon=function(e){return this.iconMap[e]},a.prototype.getThumbnail=function(e){return this.thumbNailMap[e]},a.prototype._completeIconMap=function(t,o){var r=this;return new Promise(a=>{require(["DS/PADServices/ws/WSAccess"],function(l){l.retrieveIcons({unknownIcons:t,tmpParams:{rscIds:o,ATTICON:s}}).then(function(t){t="string"==typeof t?JSON.parse(t):t;for(let e=0;e<t.results.length;e++){t.results[e];var o=r.buildKey(t.results[e]),s=r.buildThumbKey(t.results[e]);r.iconMap[o]="url("+t.results[e].type_icon_url+")",r.thumbNailMap[s]=t.results[e].preview_url}e.local.setWithExpire(n,r.iconMap,432e6),e.local.setWithExpire(i,r.thumbNailMap,432e6),a()})})})},new a}),define("DS/PADServices/utils/PADTrackerManager",["text!DS/PADServices/assets/init/TrackerMetrics.json","DS/Usage/TrackerAPI","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],function(e,t,n,i){"use strict";var o={},s=Date.now();function r(){return"object"==typeof r.instance?r.instance:(r.instance=this,this)}function a(t,n){return this._id=t.id,this._trackerMetrics=n?JSON.parse(n):JSON.parse(e),this.widgetId=t.widgetId,this.eventCategory=t.eventCategory,this.eventAction=t.eventAction,this.appID=t.appID,this.tenant=t.tenant,this.eventLabel=null,this.eventValue=null,this.persDim={},this.persVal={},this.persDim.pd1=this.widgetId,this.persVal.pv1=Date.now()-s,this}return r.prototype.getPADTracker=function(e,t){var s=e.widgetId?e.widgetId:n.getWidgetId(),r=s+"_"+e.eventCategory+"_"+e.eventAction;if(o[r])return o[r];var l=new a({widgetId:s,eventCategory:e.eventCategory,eventAction:e.eventAction,appID:e.appID?e.appID:n.getAppId(),tenant:e.tenant?e.tenant:i.getPlatformId(),id:r},t);return o[r]=l,l},r.prototype.addCommandHit=function(e,t){var n=this.getPADTracker({eventCategory:"usage",eventAction:t||"command"});n.setEventData({eventLabel:e}),n.trackPageEvent()},a.prototype.setEventData=function(e){e.hasOwnProperty("eventLabel")&&(this.eventLabel=e.eventLabel,e.hasOwnProperty("eventValue")&&(this.eventValue=e.eventValue))},a.prototype.addMultivaluedEventData=function(e,t){var n=this._trackerMetrics[e];if(void 0!==n){var i=Object.keys(t);for(var o in i){var s=i[o];void 0!==n[s]&&(this.persDim["pd"+n[s]]=s,this.persVal["pv"+n[s]]=t[s])}}},a.prototype.setProxyData=function(e){this.eventLabel=e.topic,this.persDim.pd2=e.direction,this.persVal.pv2=1,e.originAppId&&(this.persDim.pd3=e.originAppId,this.persVal.pv3=1),this.persDim.pd4=e.isPrivate?"private":"public",this.persVal.pv4=1,void 0!==e.sameApp&&(this.persDim.pd5=e.sameApp?"sameApp":"otherWidget",this.persVal.pv5=1)},a.prototype.setWidgetLinkEventsData=function(e){this.eventLabel=e.topic,this.persDim.pd2=e.fromAppId,this.persVal.pv2=1},a.prototype.trackPageEvent=function(){if(this.eventCategory&&this.eventAction)if(o[this._id]){var e={eventCategory:this.eventCategory,eventAction:this.eventAction,eventLabel:this.eventLabel,eventValue:this.eventValue,appID:this.appID,tenant:this.tenant,persDim:this.persDim,persVal:this.persVal};console.debug("track page event with input = "),console.debug(e),t.trackPageEvent(e),o[this._id]&&delete o[this._id]}else console.error("tracker not found, might be deleted");else console.error("Not able to send trackpageEvent query: check eventCategory and eventAction input")},new r}),define("DS/PADServices/utils/MaturityUtils",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices"],function(e,t,n,i){"use strict";var o=!0,s=[],r={},a=(Promise.resolve(),[]);const l=["VPLM_SMB_Definition","VPLM_SMB_Evaluation"];var d=null,c=function(){return new Promise(e=>{d?e(!0):void 0===d?e(!1):i.getServiceUrl({serviceName:"3DSpace",platformId:t.getPlatformId(),onComplete:t=>{e(void 0!==(d=t))},onFailure:()=>{d=void 0,e(!1)}})})},p=function(){return new Promise(n=>{e.getSecurityContext()?n():t.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(()=>{e.retrieveAndSetSC().then(n)})})};function u(e,t,n){if(null===document.getElementById(e)){var i=document.createElement("style");i.type="text/css",i.id=e;let o=n||"."+e;i.innerHTML=o+t,document.getElementsByTagName("head")[0].appendChild(i)}}function h(e){return e.replace(/(\.| )/g,"-")}function m(){return"object"==typeof m.instance?m.instance:(m.instance=this,this)}return m.prototype.getAndCreateMaturityClass=function(e,t){let n="lc-status-"+h(e)+(t?"-withClass":""),i=[],o=e.split(".")[0];return-1===s.indexOf(o+(t?"-withClass":""))&&i.push(o),i.length&&this.addCSSMaturityClasses(i,t),n},m.prototype.addCSSMaturityClasses=function(i,m){void 0===i&&(i=l.slice()),Promise.all(a).then(()=>{let l=[];for(let e=0;e<i.length;e++)-1===s.indexOf(i[e])&&void 0===r[i[e]]&&l.push(i[e]);let f=Promise.resolve();l.length&&(f=new Promise(i=>{s=s.concat(l),a.push(function(i){return o?new Promise((s,r)=>{c().then(p).then(()=>{let r,a=i.policies?i.policies:void 0,l=JSON.stringify({policies:a}),c={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.getSecurityContext()},data:l,onComplete:e=>{e=JSON.parse(e),s(e)},onFailure:e=>{r&&r.xhr&&404===r.xhr.status&&(console.warn("Unknown WS: ["+d+"/resources/lifecycle/maturity/getStatesAttributes]"),o=!1),s({policies:[]})}},p=d+"/resources/lifecycle/maturity/getStatesAttributes?tenant="+t.getPlatformId();r=n.authenticatedRequest(p,c)})}):Promise.resolve({})}({policies:l}).then(e=>{let t=e.policies;for(let e=0;t&&e<t.length;e++){let n=t[e].policyName;r[n]=t[e].states,i()}}).catch(()=>{i()}))})),f.then(()=>{for(let e=0;e<i.length;e++){let t=i[e];if(r[t]){let e=r[t];for(let n=0;n<e.length;n++){let i=e[n].activeColor,o="{color:"+("#FFFFFF"===i?"#000000":"#FFFFFF")+" ; background-color:"+i+";}",s=h(e[n].stateSysName),r="lc-status-"+h(t)+"-"+s+(m?"-withClass":"");u(r,o,"."+r+(m?" ."+m:""))}-1===s.indexOf(t+(m?"-withClass":""))&&s.push(t+(m?"-withClass":""))}}})})},new m}),define("DS/PADServices/views/private/TilesViewUtils",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/MaturityUtils","DS/PADServices/utils/DictionaryAccess","DS/Utilities/Dom","DS/Controls/TooltipModel"],function(e,t,n,i,o,s,r,a){"use strict";const l=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier","ds6w:created"],d={dateStyle:"long",timeStyle:"medium"};o.addCSSMaturityClasses();var c=null;function p(e){return new Promise(t=>{let n={nlsData:{}},i=!1,o=e.serviceId?e.serviceId:"3DSpace";e.grid&&(e.grid["ds6w:type-original"]||(n.nlsData["ds6w:type"]=[{value:e.grid["ds6w:type"],source:[o]}],i=!0),e.grid["ds6w:status-original"]||(n.nlsData["ds6w:status"]=[{value:e.grid["ds6w:status"],source:[o]}],i=!0)),i?s.retrieveNLSWithSource(n).then(n=>{n["ds6w:type"]&&(e.grid["ds6w:type-original"]=e.grid["ds6w:type"],e.grid["ds6w:type"]=n["ds6w:type"][e.grid["ds6w:type"]]?n["ds6w:type"][e.grid["ds6w:type"]]:e.grid["ds6w:type"]),n["ds6w:status"]&&(e.grid["ds6w:status-original"]=e.grid["ds6w:status"],e.grid["ds6w:status"]=n["ds6w:status"][e.grid["ds6w:status"]]?n["ds6w:status"][e.grid["ds6w:status"]]:e.grid["ds6w:status"]),t(e)}):t(e)})}function u(e,t){let i=r.createElement("span",{class:t.isWP&&!0!==e.isR2V?"enx-tile-subLabel enx-tile-subLabel-wp-custom":"enx-tile-subLabel"}),o=r.createElement("span",{class:"enx-tile-subLabel-type"});if(o.innerText=e.grid["ds6w:type"],i.appendChild(o),e.grid["ds6wg:revision"]){let t=r.createElement("span",{class:"enx-tile-divider"});t.innerText="|",i.appendChild(t);let n=r.createElement("span",{class:"enx-tile-subLabel-type"});n.innerText=e.grid["ds6wg:revision"],i.appendChild(n)}if(e.grid["ds6w:status"]){let t=r.createElement("span",{class:"enx-tile-divider"});t.innerText="|",i.appendChild(t),h(i,e.grid["ds6w:status-original"],e.grid["ds6w:status"])}m(i,e.grid.owner,e.grid["ds6w:responsible"]);var s=new Date(e.grid["ds6w:modified"]).toLocaleString(n.getLang());let a=r.createElement("span",{class:"enx-tile-subLabel-modified"});return a.innerText=s,i.appendChild(a),i}function h(e,t,n,i,s){if(t&&n){let a=r.createElement("span",{class:"enx-tile-status "+(s||"")}),l=o.getAndCreateMaturityClass(t);if(a.classList.add(l),a.innerText=n,e.appendChild(a),!0!==i){let t=r.createElement("span",{class:"enx-tile-divider"});t.innerText="|",e.appendChild(t)}}}function m(e,t,n,o,s){if(t&&n){let l=r.createElement("span",{class:"enx-tile-owner "+(s||"")});var a=i.get3DSwymURL();let d;if(a){d={iconPath:"url("+(a+"/api/user/getpicture/login/"+t)+")",className:"enx-tile-owner-icon owner-url"}}else d={iconName:"topbar-user",fontIconFamily:1,className:"enx-tile-owner-icon owner-font"};let c=r.generateIcon(d);l.appendChild(c);let p=r.createElement("span",{class:"enx-tile-subLabel-owner-label"});if(p.innerText=n,l.appendChild(p),e.appendChild(l),!0!==o){let t=r.createElement("span",{class:"enx-tile-divider"});t.innerText="|",e.appendChild(t)}}}function f(e){let t=r.createElement("div",{class:"enx-fs-label"}),n=r.generateIcon({iconPath:e.selectedFs.icon,iconSize:{height:"14px",width:"14px"}});n.classList.add("enx-fs-label-icon"),t.appendChild(n);let i=r.createElement("div",{class:"enx-fs-label-txt"}),o=new Date(e.selectedFs.grid["r2v:fsEffectivityDate"]);return i.innerText=e.selectedFs["ds6w:label"]+" - "+`${new Intl.DateTimeFormat(window.navigator.language,d).format(o)}`,t.appendChild(i),t}function v(){return"object"==typeof v.instance?v.instance:(v.instance=this,this)}return v.prototype.addCSSMaturityClasses=function(){o.addCSSMaturityClasses()},v.prototype.getFetchAttribute=function(){return l},v.prototype.translateFetchAttribute=function(){return null===c?new Promise(e=>{s.getResourcesInfo(l).then(t=>{if(c={},!0===Array.isArray(t))for(let e=0;e<t.length;e++)c[t[e].curi]=t[e];else for(let e=0;e<l.length;e++)c[l[e]]={label:l[e]};e()})}):Promise.resolve()},v.prototype.buildNodeOptions=function(e,t){return t=t||{},new Promise(n=>{this.translateFetchAttribute().then(()=>{p(e).then(e=>{if(e.grid){var i=e.grid["ds6w:status-original"]?e.grid["ds6w:status-original"]:e.grid["ds6w:status"];if(i&&!1===i.contains(".")){let t=e.grid["ds6w:policy-original"]?e.grid["ds6w:policy-original"]:e.grid["ds6w:policy"];t&&(e.grid["ds6w:status-original"]=t+"."+i)}e.subLabel=u(e,t);var o=e.grid["ds6w:type-original"]?e.grid["ds6w:type-original"]:e.grid["ds6w:type"];"ENOStrRefinementSpecification"===o?e.isFilter=!0:"R2V_FeatureOfInterest"===o?e.isR2V=!0:e.isFilter=!1,e.isR2V?e.description=f(e):e.description=e.grid["ds6w:identifier"]}n(e)})})})},v.prototype.toBeUpdated=function(e,t){let n=!1;if(e.options.filtered!==t.options.filtered)n=!0;else for(let i=0;i<l.length&&!1===n;i++)"ds6w:label"===l[i]?e.getLabel()!==t.getLabel()&&(n=!0):e.getReferenceValue(l[i])!==t.getReferenceValue(l[i])&&(n=!0);return n},v.prototype.getTooltip=function(e,i){if(null!==c){let o=function(e){let i=r.createElement("span",{class:"enx-tile-tooltip"}),o=r.createElement("span",{class:"enx-tile-tooltip-type enx-tile-tooltip-row"});i.appendChild(o);let s=r.createElement("span",{class:"enx-tile-tooltip-label"});s.innerText=c["ds6w:type"].label,o.appendChild(s);let a=r.createElement("span",{class:"enx-tile-tooltip-value"});if(a.innerText=e.grid["ds6w:type"],o.appendChild(a),e.grid["ds6wg:revision"]){let t=r.createElement("span",{class:"enx-tile-tooltip-revision enx-tile-tooltip-row"});i.appendChild(t);let n=r.createElement("span",{class:"enx-tile-tooltip-label"});n.innerText=c["ds6wg:revision"].label,t.appendChild(n);let o=r.createElement("span",{class:"enx-tile-tooltip-value"});o.innerText=e.grid["ds6wg:revision"],t.appendChild(o)}if(e.grid["ds6w:status-original"]||e.grid["ds6w:status"]){let t=r.createElement("span",{class:"enx-tile-tooltip-status enx-tile-tooltip-row"});i.appendChild(t);let n=r.createElement("span",{class:"enx-tile-tooltip-label"});n.innerText=c["ds6w:status"].label,t.appendChild(n);let o=r.createElement("span",{class:"enx-tile-tooltip-value"});h(o,e.grid["ds6w:status-original"],e.grid["ds6w:status"],!0),t.appendChild(o)}let l=r.createElement("span",{class:"enx-tile-tooltip-owner enx-tile-tooltip-row"});i.appendChild(l);let d=r.createElement("span",{class:"enx-tile-tooltip-label"});d.innerText=c["ds6w:responsible"].label,l.appendChild(d),m(l,e.grid.owner,e.grid["ds6w:responsible"],!0,"enx-tile-tooltip-value");let p=r.createElement("span",{class:"enx-tile-tooltip-modified enx-tile-tooltip-row"});i.appendChild(p);let u=r.createElement("span",{class:"enx-tile-tooltip-label"});u.innerText=c["ds6w:modified"].label,p.appendChild(u);var f=new Date(e.grid["ds6w:modified"]).toLocaleString(n.getLang());let v=r.createElement("span",{class:"enx-tile-tooltip-value"});if(v.innerText=f,p.appendChild(v),e.selectedFs){let o=r.createElement("span",{class:"enx-tile-tooltip-location-state enx-tile-tooltip-row"});i.appendChild(o);let s=r.createElement("span",{class:"enx-tile-tooltip-label"});s.innerText=t.columnsNLS.locationstate,o.appendChild(s);let a=r.createElement("span",{class:"enx-tile-tooltip-value"});a.innerText=e.selectedFs["ds6w:label"],o.appendChild(a);let l=r.createElement("span",{class:"enx-tile-tooltip-eff-date enx-tile-tooltip-row"});i.appendChild(l);let d=r.createElement("span",{class:"enx-tile-tooltip-label"});d.innerText=t.columnsNLS["r2v:fsEffectivityDate"],l.appendChild(d),f=new Date(e.selectedFs.grid["r2v:fsEffectivityDate"]).toLocaleString(n.getLang());let c=r.createElement("span",{class:"enx-tile-tooltip-value"});c.innerText=f,l.appendChild(c)}return i}(e.options);return new a({title:e.getLabel(),shortHelp:o,allowUnsafeHTMLShortHelp:!0,updateModel:!1,wrapThreshold:375,initialDelay:i||void 0})}},v.prototype.updateNode=function(e,t){t=t||{},p(e.options).then(n=>{if(n.grid){var i=n.grid["ds6w:status-original"]?n.grid["ds6w:status-original"]:n.grid["ds6w:status"];if(i&&!1===i.contains(".")){let e=n.grid["ds6w:policy-original"]?n.grid["ds6w:policy-original"]:n.grid["ds6w:policy"];e&&(n.grid["ds6w:status-original"]=e+"."+i)}let o={};o.subLabel=u(n,t),n.isR2V?o.description=f(n):o.description=n.grid["ds6w:identifier"],e.updateOptions(o)}})},new v}),define("DS/PADServices/ws/WSIndexCommon",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/settings/AppSettings","DS/PADServices/utils/IconMgt","DS/PADServices/views/private/TilesViewUtils"],function(e,t,n,i,o,s){"use strict";function r(e,t){var n=void 0;return t>-1&&(n=[{truncate:{max_distance_from_prefix:t,prefix_filter:{prefix_path:e}}}]),n}function a(e,t){var n=null,i=0;if(t&&t.length)for(n=[],i=0;i<t.length;i++)n.push({physical_id_path:t[i]});else n=[{physical_id_path:e}];return n}const l='((typecode:0 OR typecode:1) AND (ds6w_58_globaltype:"ds6w:Document" OR ds6w_58_globaltype:"ds6w:Part"))  OR (typecode:2 AND NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency"))';function d(){}return d.prototype.fetch=function(o){return new Promise(function(s,r){var a=o.data||{};let l="fetch-"+t.getRequestLabel();o.labelPrefix&&(l=o.labelPrefix+l);var d=Object.assign({label:l,locale:t.getLang(),tenant:e.getPlatformId()},a);void 0!==o.pids&&(d.physicalid=o.pids),!0===o.autoAttSelection&&(d=Object.assign(d,n.createOutputsRequest("fetch"))),!0===i.getSetting("pgpFromServer")&&d.select_predicate&&-1===d.select_predicate.indexOf("bo.pgpshowextension.V_PGP_Show")&&d.select_predicate.push("bo.pgpshowextension.V_PGP_Show");let c="";null!==t.getURLParameter("redirectQueryToSGI")&&(c="&redirectQueryToSGI=true");var p=t.getSecurityContext(),u=e.get3DSpaceURL()+"/cvservlet/fetch/v2?tenant="+e.getPlatformId()+c,h={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:o.timeout?o.timeout:void 0,data:JSON.stringify(d),onComplete:s,onFailure:r};p&&(u+="&SecurityContext="+p),this.executeRequest(u,h)}.bind(this))},d.prototype.findInCtx=function(n){return new Promise(function(i,o){for(var s=n.data||{},r=n.filterBI,a=(n.version,Object.assign({label:"FindInCtxFTS-"+t.getRequestLabel(),compute_select_bo:["thumbnail_2d","icon"],max_output_paths:n.max_output_paths,fcs_url_mode:"REDIRECT",union:{expand:[]}},s)),l={},d=[],c=0;c<n.pathIds.length;c++){var p=n.pathIds[c][0];void 0===l[p]&&(l[p]=[],d.push(p)),l[p].push(n.pathIds[c])}var u={V1:{"q.iterative_filter_query_bo":n.iterativeFilter}};n.ftsString&&(u.V1.find_in_context=[{"q.query":n.ftsString}]),n.rscIdToSearch&&(u.V1.find_path_filter=[{option:["cut"],path_physicalid:[[n.rscIdToSearch]]}]);for(var h=0;h<d.length;h++){var m=UWA.clone(u);m.V1.root_path_physicalid=l[d[h]];var f=r.getFilterSpec(d[h],m);a=Object.assign(a,f.CVQuery);var v=t.getSecurityContext(),g=e.get3DSpaceURL()+"/cvservlet/multiexpand?tenant="+e.getPlatformId(),b={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:n.timeout?n.timeout:void 0,data:JSON.stringify(a),onComplete:i,onFailure:o,onTimeout:function(){i({timeoutOccurs:!0})}};v&&(g+="&SecurityContext="+v),this.executeRequest(g,b)}}.bind(this))},d.prototype.findInCtxV2=function(n){return new Promise(function(o,s){var r={},l=t.getSecurityContext();let d="";null!==t.getURLParameter("redirectQueryToSGI")&&(d="&redirectQueryToSGI=true");var c=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+d,p=a(n.data.rootPhID);n.data.max_count_path&&(n.data.max_count_path=parseInt(n.data.max_count_path),n.data.maxOutputPaths===parseInt(i.getSetting("maxPathsForSearch"))&&(n.data.max_count_path=n.data.max_count_path+1));n.iterativeFilter&&n.iterativeFilter;var u,h=n.FBIProxy.GetFilterSpec(n.data.rootPhID[0],{V2:{prefixPathArray:p,find_in_context:n.data.ftsString}}).filter,m=[{truncate:{max_distance_from_prefix:0,compute_matching_subpaths_lengths:1,match_only_refs:1,sequence_filter:{sequence:[{uql:n.data.ftsString,uql_prefix_handler:"starPH"}]}}}];!0===i.getSetting("pgpFromServer")&&(u=["show","hide"],n.data.select_bo&&-1===n.data.select_bo.indexOf("bo.pgpshowextension.V_PGP_Show")&&n.data.select_bo.push("bo.pgpshowextension.V_PGP_Show"),n.data.select_rel&&-1===n.data.select_rel.indexOf("ro.pgpshowextension.V_PGP_Show")&&n.data.select_rel.push("ro.pgpshowextension.V_PGP_Show"));var f={batch:{expands:[{label:"FindInCtxV2_"+t.getRequestLabel(),parameters:void 0!==n.data.max_count_path?{limit_max_path:n.data.max_count_path+1}:void 0,root:{physical_id:n.data.rootPhID[0]},filter:h,aggregation_processors:m}]},outputs:{select_object:n.data.select_bo,select_relation:n.data.select_rel,select_pgp:u,hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]},matching_lengths:1}};return n.format?f.outputs.format=n.format:f.outputs.format="entity_relation_occurrence",r.onComplete=o,r.onFailure=s,r.onTimeout=function(){o({timeoutOccurs:!0})},r.timeout=n.timeout?n.timeout:void 0,r.method="POST",r.headers={Accept:"application/json","Content-Type":"application/json"},r.data=JSON.stringify(f),l&&(c+="&SecurityContext="+l),this.executeRequest(c,r)}.bind(this))},d.prototype.selectFromTagger=function(n){return new Promise(function(o,s){var r={},l=t.getSecurityContext();let d="";null!==t.getURLParameter("redirectQueryToSGI")&&(d="&redirectQueryToSGI=true");var c=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+d,p=a(n.data.rootPhID);n.data.max_count_path&&(n.data.max_count_path=parseInt(n.data.max_count_path),n.data.max_count_path===parseInt(i.getSetting("maxPathsForSearch"))&&(n.data.max_count_path=n.data.max_count_path+1));n.iterativeFilter&&n.iterativeFilter;var u=n.FBIProxy.GetFilterSpec(n.data.rootPhID,{V2:{prefixPathArray:p,tagger_select:n.data.taggerSelect}}).filter;const h={truncate:n.FBIProxy.buildSpecFromAppIntent({V2:{tagger_select:n.data.taggerSelect}})};h.truncate.max_distance_from_prefix=0,h.truncate.compute_matching_subpaths_lengths=1,h.truncate.match_only_refs=1;var m,f=[h];!0===i.getSetting("pgpFromServer")&&(m=["show","hide"],n.data.select_bo&&-1===n.data.select_bo.indexOf("bo.pgpshowextension.V_PGP_Show")&&n.data.select_bo.push("bo.pgpshowextension.V_PGP_Show"),n.data.select_rel&&-1===n.data.select_rel.indexOf("ro.pgpshowextension.V_PGP_Show")&&n.data.select_rel.push("ro.pgpshowextension.V_PGP_Show"));var v={batch:{expands:[{label:"SelectFromTaggerV2_"+t.getRequestLabel(),parameters:void 0!==n.data.max_count_path?{limit_max_path:n.data.max_count_path}:void 0,root:{physical_id:n.data.rootPhID},filter:u,aggregation_processors:f}]},outputs:{select_object:n.data.select_bo,select_relation:n.data.select_rel,select_pgp:m,hits:{predefined_computation:["urlstream|thumbnail|2dthb|allrefs","icons"]},matching_lengths:1}};return n.format?v.outputs.format=n.format:v.outputs.format="entity_relation_occurrence",r.onComplete=o,r.onFailure=s,r.onTimeout=function(){o({timeoutOccurs:!0})},r.timeout=n.timeout?n.timeout:void 0,r.method="POST",r.headers={Accept:"application/json","Content-Type":"application/json"},r.data=JSON.stringify(v),l&&(c+="&SecurityContext="+l),this.executeRequest(c,r)}.bind(this))},d.prototype.getRootStats=function(n){return new Promise(function(i,o){var s=n.data||{},r=n.filterBI,a=this._buildPrefixPath(s.rootPhID,s.root_path_physicalid),d=r.getFilterSpec(s.rootPhID,{V2:{appQueryObj:{keep:n.is2D?l:void 0}}}).filter,c=[{truncate:{max_distance_from_prefix:0,prefix_filter:{prefix_path:a}}}],p={batch:{expands:[{label:"GetRootStats-"+t.getRequestLabel(),root:{physical_id:s.rootPhID},parameters:{limit_max_path:n.maxLeaves},filter:d,aggregation_processors:[{synthesis:{name:"ProgressiveExpand_FlatSynthesis",mode:"flat"}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",mode:"occurence"}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf",synthesis_only:1}}]},{label:"GetRootStats-0-"+t.getRequestLabel(),root:{physical_id:s.rootPhID},filter:{prefix_filter:{prefix_path:a}},aggregation_processors:c}]},outputs:{select_object:s.select_bo?s.select_bo:["physicalid"],synthesis:["ProgressiveExpand_FlatSynthesis","ProgressiveExpand_OccSynthesis","ProgressiveExpand_LeafSynthesis"]}},u=t.getSecurityContext();let h="";null!==t.getURLParameter("redirectQueryToSGI")&&(h="&redirectQueryToSGI=true");var m=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+h,f={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:n.timeout?n.timeout:"30000",data:JSON.stringify(p),onComplete:i,onFailure:o,onTimeout:function(){i({timeoutOccurs:!0})}};u&&(m+="&SecurityContext="+u),this.executeRequest(m,f)}.bind(this))},d.prototype.expandv2=function(a){return new Promise(function(d,c){for(var p,u=a.FBIProxy,h=(a.version,{}),m=[],f=0;f<a.pathIds.length;f++){var v=a.pathIds[f][0];void 0===h[v]&&(h[v]=[],m.push(v)),h[v].push(a.pathIds[f])}var g=-1;a.data.expandLevel&&(g=parseInt(a.data.expandLevel));let b="Expand-Level-"+(-1===g?"All":g)+"-"+t.getRequestLabel();var w,y=a.batch?a.batch:function(e){var t={expands:[]},n=e.pathsWithRoot,i=e.expandLevel,o=Object.keys(n),s=e.queryLabel;console.groupCollapsed("Batch for ["+s+"]"),console.log("Number of Roots "+o.length);for(var a=0;a<o.length;a++){console.log("Root["+a+"] with id ["+o[a]+"]");var d=n[o[a]];console.log("Number of Paths "+d.length);for(var c=[],p=0;p<d.length;p++)c.push({physical_id_path:d[p]});var u=e.FBIProxy.getFilterSpec(o[a],{V2:{prefixPathArray:c,appQueryObj:{keep:l}}}),h=r(c,i);Array.isArray(u.aggregation_processors)&&u.aggregation_processors.length>0&&(h=h?h.concat(u.aggregation_processors):u.aggregation_processors),t.expands.push({label:s,root:{physical_id:o[a]},filter:u.filter,aggregation_processors:h})}return console.groupEnd(),t}({queryLabel:b,pathsWithRoot:h,expandLevel:g,FBIProxy:u}),S=n.createOutputsRequest("expandV2");if(!0===i.getSetting("pgpFromServer")&&(w=["show","hide"],S.select_pgp=w,S.select_object&&-1===S.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&S.select_object.push("bo.pgpshowextension.V_PGP_Show"),S.select_relation&&-1===S.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&S.select_relation.push("ro.pgpshowextension.V_PGP_Show")),a.select_relation&&-1===S.select_relation.indexOf("ro.plminstance.v_treeorder")&&(S.select_relation=S.select_relation.concat(a.select_relation)),o.isActive()){var _=o.getRequiredAtt();S.select_object=S.select_object.concat(_)}var C=s.getFetchAttribute();S.select_object=S.select_object.concat(C),S.select_object=S.select_object.filter(function(e,t,n){return n.indexOf(e)===t}),p={batch:y,outputs:S};let D="";null!==t.getURLParameter("redirectQueryToSGI")&&(D="&redirectQueryToSGI=true");var P=t.getSecurityContext(),I=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+D,A={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:a.timeout?a.timeout:void 0,data:JSON.stringify(p),onComplete:d,onFailure:c,onTimeout:function(){d({timeoutOccurs:!0})}};P&&(I+="&SecurityContext="+P),this.executeRequest(I,A)}.bind(this))},d.prototype.getGroupingNodes=function(n){return new Promise(function(o,s){for(var r=n.data||{},a=n.filterBI,l={},d=[],c=0;c<n.pathIds.length;c++){var p=n.pathIds[c][0];void 0===l[p]&&(l[p]=[],d.push(p)),l[p].push(n.pathIds[c])}r.rootPhID=d[0];var u={};if("function"!=typeof a.getGroupingSpec)return console.error("WSIndexCommon.getGroupingNodes: getGroupingSpec not found on FBIProxy"),void s();{let e=[],i=n.grouping.groups,o="GetGroupingNodes-"+t.getRequestLabel();e.push([r.rootPhID]),u=a.getGroupingSpec(e,i,o)}let h="";null!==t.getURLParameter("redirectQueryToSGI")&&(h="&redirectQueryToSGI=true");var m=t.getSecurityContext(),f=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+h,v={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:n.timeout?n.timeout:"30000",data:JSON.stringify(u),onComplete:o,onFailure:s,onTimeout:function(){o({timeoutOccurs:!0})}};!0===i.getSetting("splitActivation")&&(f+="&enable_mono_sixw=false"),m&&(f+="&SecurityContext="+m),this.executeRequest(f,v)}.bind(this))},d.prototype.expandGroupingNodeV2=function(r){return new Promise(function(a,l){for(var d,c=r.FBIProxy?r.FBIProxy:r.filterBI,p=(r.version,{}),u=[],h=0;h<r.pathIds.length;h++){var m=r.pathIds[h][0];void 0===p[m]&&(p[m]=[],u.push(m)),p[m].push(r.pathIds[h])}r.data.expandLevel&&parseInt(r.data.expandLevel);let f=r.groupingFilter;if(!0===i.getSetting("activate_47_bypass")&&r.groupingFilter){let e=JSON.stringify(r.groupingFilter);f=JSON.parse(e.replaceAll("/","_47_"))}var v={groupingIntent:f};v.root_path_physicalid=p[u[0]];var g,b=c.getExpandSpec(u[0],v),w=n.createOutputsRequest("expandV2");!0===i.getSetting("pgpFromServer")&&(g=["show","hide"],w.select_pgp=g,w.select_object&&-1===w.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&w.select_object.push("bo.pgpshowextension.V_PGP_Show"),w.select_relation&&-1===w.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&w.select_relation.push("ro.pgpshowextension.V_PGP_Show"));var y=o.getRequiredAtt();w.select_object=w.select_object.concat(y);var S=s.getFetchAttribute();w.select_object=w.select_object.concat(S),w.select_object=w.select_object.filter(function(e,t,n){return n.indexOf(e)===t}),d={batch:b.batch,outputs:w};let _="";null!==t.getURLParameter("redirectQueryToSGI")&&(_="&redirectQueryToSGI=true");var C=t.getSecurityContext(),D=e.get3DSpaceURL()+"/cvservlet/progressiveexpand/v2?output_format=cvjson&tenant="+e.getPlatformId()+_,P={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:r.timeout?r.timeout:void 0,data:JSON.stringify(d),onComplete:a,onFailure:l,onTimeout:function(){a({timeoutOccurs:!0})}};C&&(D+="&SecurityContext="+C),this.executeRequest(D,P)}.bind(this))},d.prototype.retrieveIcons=function(e){var t=this;return new Promise(function(n,i){if(e.tmpParams){var o={pids:e.tmpParams.rscIds,data:{select_predicate:["resourceid"].concat(e.tmpParams.ATTICON),select_file:["icon","thumbnail_2d"]}};t.fetch(o).then(function(e){var t=[];if((e="string"==typeof e?JSON.parse(e):e).results&&e.results.length>0)for(var i=0;i<e.results.length;i++){for(var o={},s=0;s<e.results[i].attributes.length;s++)o[e.results[i].attributes[s].name]=e.results[i].attributes[s].value;t.push(o)}n({infos:{},results:t})})}})},d.prototype._buildPrefixPath=function(e,t){var n=null,i=0;if(t&&t.length)for(n=[],i=0;i<t.length;i++)n.push({physical_id_path:t[i]});else n=[{physical_id_path:[e]}];return n},d}),define("DS/PADServices/ws/WSENOAuth",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/IconMgt","DS/PADServices/settings/AppSettings","DS/PADServices/views/private/TilesViewUtils","DS/PADServices/utils/AttributesMgtV2","require"],function(e,t,n,i,o,s,r){"use strict";const a={url:"/resources/enoauthoring/fetch/v1",verb:"POST"},l={url:"/resources/enoedit/prodtopart/v1",verb:"POST"},d={url:"/resources/enoauthoring/expand/v2",verb:"POST"},c={url:"/resources/enoauthoring/expand/v2/progressive",verb:"POST"},p={url:"/resources/v1/collabServices/attributes/op/read",verb:"POST"},u='((typecode:0 OR typecode:1) AND (ds6w_58_globaltype:"ds6w:Document" OR ds6w_58_globaltype:"ds6w:Part"))  OR (typecode:2 AND NOT (flattenedtaxonomies:"reltypes/XCADBaseDependency"))';function h(e,t){var n=void 0;return t>-1&&(n=[{truncate:{max_distance_from_prefix:t,prefix_filter:{prefix_path:e}}}]),n}function m(){}return m.prototype={fetchDB:function(n){var i=t.getSecurityContext(),o=this,r=function(){var r=a,l=n.data;delete n.data,i||(i=t.getSecurityContext()),i=encodeURIComponent(i);var d=UWA.extend({method:a.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()}},n),c=e.get3DSpaceURL()+r.url+"?SecurityContext="+i+"&tenant="+e.getPlatformId(),p=Object.assign({label:"fetchDB-"+t.getRequestLabel(),physicalid:n.pids,select_predicate:l.select_predicate,locale:t.getLang(),tenant:e.getPlatformId(),types:s.getSelectedTypes(),extensions:s.getSelectedExtensions()},l);return n.autoAttSelection&&(p=Object.assign(p,s.createOutputsRequest("fetch"))),delete p.intent,delete p.authored,p.select_predicate&&(p.select_predicate=p.select_predicate.filter(function(e,t,n){return n.indexOf(e)===t})),d.data=p,o.executeRequestPromise(c,d)};return i?r():new Promise(function(e,n){t.retrieveAndSetSC().then(function(){r().then(e)})}.bind(this))},productToPart:function(n){var o=t.getSecurityContext(),r=this,a=function(){var o=l;n.data;delete n.data;var a=UWA.extend({method:l.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},timeout:i.getSetting("webapi_timeout")},n),d=e.get3DSpaceURL()+o.url+"?tenant="+e.getPlatformId(),c=s.createOutputsRequest(),p={label:"ProductToPart-"+t.getRequestLabel(),physicalid:n.pids,select_predicate:c.select_object,select_file:c.select_file,locale:t.getLang(),tenant:e.getPlatformId(),types:s.getSelectedTypes(),extensions:s.getSelectedExtensions(),template:n.template};return p.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getLang()},delete p.intent,delete p.authored,p.select_predicate=p.select_predicate.filter(function(e,t,n){return n.indexOf(e)===t}),a.data=JSON.stringify(p),a.onTimeout=a.onTimeout||a.onFailure,r.executeRequest(d,a)};return o?a():new Promise(function(e,n){t.retrieveAndSetSC().then(function(){a().then(e)})}.bind(this))},expandv2DBprogressive:function(r){let a=c;for(var l=r.FBIProxy,d=(r.version,{}),p=[],m=0;m<r.pathIds.length;m++){var f=r.pathIds[m][0];void 0===d[f]&&(d[f]=[],p.push(f)),d[f].push(r.pathIds[m])}var v=-1;r.data.expandLevel&&(v=parseInt(r.data.expandLevel));let g="Expand-Level-"+(-1===v?"All":v)+"-"+t.getRequestLabel();var b,w=r.batch?r.batch:function(e){for(var t={expands:[]},n=e.pathsWithRoot,i=e.expandLevel,o=Object.keys(n),s=e.queryLabel,r=0;r<o.length;r++){for(var a=n[o[r]],l=[],d=0;d<a.length;d++)l.push({physical_id_path:a[d]});var c=e.FBIProxy.getFilterSpec(o[r],{V2:{prefixPathArray:l,appQueryObj:{keep:u}}}),p=h(l,i);Array.isArray(c.aggregation_processors)&&c.aggregation_processors.length>0&&(p=p?p.concat(c.aggregation_processors):c.aggregation_processors),t.expands.push({label:s,root:{physical_id:o[r]},filter:c.filter,aggregation_processors:p})}return t}({queryLabel:g,pathsWithRoot:d,expandLevel:v,FBIProxy:l}),y=s.createOutputsRequest("expandV2");if(!0===i.getSetting("pgpFromServer")&&(b=["show","hide"],y.select_pgp=b,y.select_object&&-1===y.select_object.indexOf("bo.pgpshowextension.V_PGP_Show")&&y.select_object.push("bo.pgpshowextension.V_PGP_Show"),y.select_object&&-1===y.select_object.indexOf("cestamp")&&y.select_object.push("cestamp"),y.select_relation&&-1===y.select_relation.indexOf("ro.pgpshowextension.V_PGP_Show")&&y.select_relation.push("ro.pgpshowextension.V_PGP_Show"),y.select_relation&&-1===y.select_relation.indexOf("cestamp")&&y.select_relation.push("cestamp")),r.select_relation&&-1===y.select_relation.indexOf("ro.plminstance.v_treeorder")&&(y.select_relation=y.select_relation.concat(r.select_relation)),n.isActive()){var S=n.getRequiredAtt();y.select_object=y.select_object.concat(S)}var _=o.getFetchAttribute();y.select_object=y.select_object.concat(_),y.select_object=y.select_object.filter(function(e,t,n){return n.indexOf(e)===t});var C={batch:w,outputs:y};let D="Expand-Level-"+(-1===v?"All":v)+"-"+t.getRequestLabel();r.version;var P={storage:"cstorage",root_path_physicalid:r.pathIds.slice(),expand_iter:r.data.expandLevel,label:D,select_bo:[],select_rel:[],compute_select_bo:["icon","thumbnail_2d"],select_pgp:["Show","Hide"],types:["VPMReference","VPMInstance","VPMRepReference","3DShape"]},I=s.createOutputsRequest("expandV2");P.select_bo=I.select_object.slice(),P.select_rel=I.select_relation.slice();S=n.getRequiredAtt();P.select_bo=P.select_bo.concat(S);_=o.getFetchAttribute();P.select_bo=P.select_bo.concat(_),r.select_relation&&-1===P.select_rel.indexOf("ro.plminstance.v_treeorder")&&(P.select_rel=P.select_rel.concat(r.select_relation)),P.select_bo&&(P.select_bo.includes("bo.pgpshowextension.V_PGP_Show")||P.select_bo.includes("bo.PGPShowExtension.V_PGP_Show")||(console.debug("missing bo v_pgp_show"),P.select_bo.push("bo.PGPShowExtension.V_PGP_Show"))),P.select_rel&&(P.select_rel.includes("ro.pgpshowextension.V_PGP_Show")||P.select_rel.includes("ro.PGPShowExtension.V_PGP_Show")||(console.debug("missing ro v_pgp_show"),P.select_rel.push("bo.PGPShowExtension.V_PGP_Show"))),P.select_bo=P.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),P.select_rel=P.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});var A=t.getSecurityContext(),x=e.get3DSpaceURL()+a.url+"?tenant="+e.getPlatformId();A&&(x+="&SecurityContext="+A);let O={cv:C,db:P};return this.executeRequestPromise(x,{method:a.verb,headers:{Accept:"application/json","Content-Type":"application/json"},data:O,timeout:r.timeout})},expandv2DB:function(i){i.FBIProxy;let r=d;var a=-1;i.data.expandLevel&&(a=parseInt(i.data.expandLevel));let l="Expand-Level-"+(-1===a?"All":a)+"-"+t.getRequestLabel();i.version;var c={storage:"cstorage",root_path_physicalid:i.pathIds.slice(),expand_iter:i.data.expandLevel,label:l,select_bo:[],select_rel:[],compute_select_bo:["icon","thumbnail_2d"],select_pgp:["Show","Hide"],types:["VPMReference","VPMInstance","VPMRepReference","3DShape"]},p=s.createOutputsRequest("expandV2");c.select_bo=p.select_object.slice(),c.select_rel=p.select_relation.slice();var u=n.getRequiredAtt();c.select_bo=c.select_bo.concat(u);var h=o.getFetchAttribute();c.select_bo=c.select_bo.concat(h),i.select_relation&&-1===c.select_rel.indexOf("ro.plminstance.v_treeorder")&&(c.select_rel=c.select_rel.concat(i.select_relation)),c.select_bo&&(c.select_bo.includes("bo.pgpshowextension.V_PGP_Show")||c.select_bo.includes("bo.PGPShowExtension.V_PGP_Show")||(console.debug("missing bo v_pgp_show"),c.select_bo.push("bo.PGPShowExtension.V_PGP_Show"))),c.select_rel&&(c.select_rel.includes("ro.pgpshowextension.V_PGP_Show")||c.select_rel.includes("ro.PGPShowExtension.V_PGP_Show")||(console.debug("missing ro v_pgp_show"),c.select_rel.push("bo.PGPShowExtension.V_PGP_Show"))),c.select_bo=c.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),c.select_rel=c.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});var m=t.getSecurityContext(),f=e.get3DSpaceURL()+r.url+"?tenant="+e.getPlatformId();return m&&(f+="&SecurityContext="+m),this.executeRequestPromise(f,{method:r.verb,headers:{Accept:"application/json","Content-Type":"application/json"},data:c,timeout:i.timeout})},read:function(t){var n=t;let i=p;var o=e.get3DSpaceURL()+i.url+"?tenant="+e.getPlatformId();return n.method=p.verb,n.headers={Accept:"application/json","Content-Type":"application/json"},this.appendCfgIf(n),n.cache=-1,delete n.ids,n.onTimeout=n.onTimeout||n.onFailure,this.executeRequestPromise(o,n)}},m}),define("DS/PADServices/views/private/docsMgt/AttachmentsUI",["UWA/Core","UWA/Controls/Abstract","UWA/Class","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL"],function(e,t,n,i,o){"use strict";return n.extend(t,{init:function(e){this._parent(e),this.options=e},initPane:function(e){this.options.showLoader=e.showLoader,this.options.hideLoader=e.hideLoader;var t=this;t.options.showLoader(),require(["DS/ENOXAttachmentsAndSpecificationsUX/AttachmentsAndSpecifications","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(n,o){t.elements={},t.elements.doclstdiv=document.createElement("div"),t.elements.doclstdiv.classList.add("doclst_container");var s=new n({parentObject:{parentId:t._currentid},connectorOptions:{fetchSecurityContext:function(){return i.getSecurityContext().replace("ctx::","")},getWorkUnderHeaders:function(){if(o){var e=o.get();return e&&e.change&&""!==e.change.id?{"DS-Change-Authoring-Context":"pid:"+e.change.id}:{}}},platformUrls:t.getPlatformOptions()},hideAttachments:t.options.hideAttachments,hideSpecifications:t.options.hideSpecifications,supportedTypes:t.options.supportedTypes,readonly:t.options.readonly,webinwin:i.isWebInWinContext()});s.inject(t.elements.doclstdiv),t.options.hideLoader(),e.renderTo.appendChild(t.elements.doclstdiv),t.options.mainRenderDiv=e.renderTo,t.attachmentsPane=s,t.options.hideLoader()})},getPlatformOptions:function(){return{"3DSpace":o.get3DSpaceURL(),"3DSwym":o.get3DSwymURL(),"3DDashboard":o.getPlatformURL("3DDashboard"),platformId:o.getPlatformId()}},updatePane:function(e){this.options.showLoader(),this.attachmentsPane&&(this.attachmentsPane.attachmentsPane&&(this.attachmentsPane.attachmentsPane.options.connectorOptions.platformUrls=this.getPlatformOptions()),this.attachmentsPane.specificationsPane&&(this.attachmentsPane.specificationsPane.options.connectorOptions.platformUrls=this.getPlatformOptions()),this.attachmentsPane.setParentObject(e))},selectionModified:function(e){this.options.showLoader(),e.parentId!==this._currentid&&(this._currentid=e.parentId,this._parentType=e.parentType,this.updatePane(e)),this.options.hideLoader()}})}),define("DS/PADServices/views/private/docsMgt/AttachmentsFacet",["css!DS/PADServices/PADServices","UWA/Core","DS/PADServices/views/private/docsMgt/AttachmentsUI","UWA/Controls/Abstract","UWA/Class"],function(e,t,n,i,o){"use strict";var s=require("DS/EditPropWidget/facets/Common/FacetsBase");require("DS/EditPropWidget/constants/EditPropConstants");return o.extend(i,s,{_docList:null,init:function(e){this._parent(e),this._initUI()},_initUI:function(){null===this._docList&&(this.elements.container=t.createElement("div",{class:"relatedDocumentsv2"}),this._docList=new n(this.options),this._docList.initPane({renderTo:this.elements.container,showLoader:this.showLoader.bind(this),hideLoader:this.hideLoader.bind(this)}))},updateFacet:function(){var e=this,t=function(t){t?e._docList.selectionModified({parentId:t,parentType:model.get("type")}):e._docList.selectionModified()},n=this.getModel();n?"relationship"===n.get("metatype")?(console.count("firstModel-relatio"),this.getOccurrence().addEventOnce("onChange:properties",function(){var n=e.getModel();t(n.get("objectId"))})):t(n.get("objectId")):t()},destroyComponent:function(){},onRefresh:function(){this.updateFacet()}})}),define("DS/PADServices/views/private/ResponsiveRootList",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Utility","DS/PADServices/views/private/TilesViewUtils","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils"],function(e,t,n,i,o,s,r,a,l,d,c){"use strict";function p(e){var t=this;this._broadcastSelect=!0,this._roots2add=[],this._root2select=[],this.elements={},this.elements.container=UWA.createElement("div",{class:"rootLst-main"}),this.options={grid:null,model:null,HasFilter:void 0,getCtxForSharing:void 0},this.options.dgvOptions={useDragAndDrop:!0,selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},allowUnsafeHTMLContent:!0};var i=this.options.grid=new r(this.options.dgvOptions);i.name="resposiverootlist",i.onStatusbarIconPointerDown=function(e){var n=e.cellInfos,i=e.clickedIconIndex,o=n?n.cellModel:void 0;switch(i){case 0:t._removeTile({tile_id:o.options.resourceid});break;default:console.warn("PADResponsiveRootList: Unknown Icon")}},i.getContent().addEventListener("dragover",function(e){return e.preventDefault(),e.stopPropagation(),!1}),i.getContent().addEventListener("drop",this._onDropBlank.bind(this)),i.onContextualEvent=this.__onContextualEvent(),i.onDragStartCell=this.__onDragStartCell.bind(this),i.getCustomTooltip=s.getTooltip;this.options.model=new a({shouldAcceptDrag:function(){return!1}}),this.options.model.id="rootListModel",this.options.model.getXSO().onPostAdd(function(e){if(t._broadcastSelect){var i=t.options.model.getSelectedNodes().map(function(e){return e.options.resourceid});n.publish({event:"ENXModel/Root/select",data:{tile_ids:i}})}}),this.options.model.getXSO().onPostRemove(function(e){if(t._broadcastSelect){var i=t.options.model.getSelectedNodes().map(function(e){return e.options.resourceid});n.publish({event:"ENXModel/Root/select",data:{tile_ids:i}})}}),this.options.model.getXSO().onEmpty(function(e){t._broadcastSelect&&n.publish({event:"ENXModel/Root/select",data:{tile_ids:[]}})}),i.model=this.options.model,i.getContent().inject(t.elements.container),n.subscribe({event:"ENXModel/Root/FBIProxy"},function(e){t.options.HasFilter=e.HasFilter,t.options.getCtxForSharing=e.getCtxForSharing}),n.subscribe({event:"ENXModel/Root/manage"},this._manageRoot.bind(this)),n.subscribe({event:"ENXModel/Root/sync"},this._syncTile.bind(this)),n.subscribe({event:"ENXModel/Root/remove"},this._removeTiles.bind(this)),n.subscribe({event:"ENXModel/Root/selectTile"},this.selectTile.bind(this)),n.subscribe({event:"ENXModel/Root/unselectTile"},this.unselectTile.bind(this))}return p.prototype.getContent=function(){return this.elements.container},p.prototype.getTabLabel=function(){return t.rootLst.rootLstLabel},p.prototype.setVisible=function(e){e?this.elements.container.removeAttribute("hidden"):this.elements.container.setAttribute("hidden","")},p.prototype.selectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length?t[0].select():-1===this._root2select.indexOf(e.data.nodeModel.getID())&&this._root2select.push(e.data.nodeModel.getID()),this._broadcastSelect=!0},p.prototype.unselectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length&&t[0].unselect(),this._broadcastSelect=!0},p.prototype.__cloneNodeOpts=function(e){return new Promise(n=>{if(1==e.clonedRootNode)n(e);else{var i={clonedRootNode:!0,resourceid:e.resourceid,serviceId:e.serviceId,label:UWA.String.escapeHTML(e.label),icons:UWA.clone(e.icons,!0),thumbnail:e.thumbnail?e.thumbnail:d.getWebappsAssetUrl("PADServices","icons/32/I_DefaultThumbnail.png"),statusbarIcons:["wrong"],statusbarIconsTooltips:[t.rootLst.removeRoot],children:null,isFiltered:e.isFiltered,type:e.type};e.badges&&(i.badges=UWA.clone(e.badges)),i.icons[0]&&i.icons[0].badges&&delete i.icons[0].badges.topRight,delete i.contextualMenu,i.contextualMenu=[{type:"SeparatorItem"}];let o=Promise.resolve(i);i.grid=UWA.clone(e.grid,!0),(o=s.buildNodeOptions(i)).then(n)}})},p.prototype._addRootTiles=function(e){for(var t=0;t<e.length;t++){var n=e[t];!0===n.waiting4validation&&!0!==n.parseV2||this.__cloneNodeOpts(n).then(e=>{this._roots2add.push(e),this._realAddInWebUX(this._roots2add)})}},p.prototype._manageRoot=function(e){var t=void 0!==e.added_node?[e.added_node]:void 0!==e.added_nodes?e.added_nodes:[];if("boolean"!=typeof e.isremove||!0!==e.isremove){for(var n=[],i=[],o=0;o<t.length;o++){var s=t[o];s instanceof l||(s=new l(s));var r=!1,a=this.options.model.getRoots();if(a&&a.length>0)for(var d=0;d<a.length;d++)if(a[d].options.resourceid===s.options.resourceid){r=!0;break}r||i.push(this.__cloneNodeOpts(s.options).then(e=>{n.push(e),s.onSelect(this.selectTile.bind(this)),s.onUnselect(this.unselectTile.bind(this))}))}Promise.all(i).then(()=>{n.length&&this._addRootTiles(n)})}},p.prototype._syncTile=function(e){if(e instanceof l){var t=e;if(!t.isRoot())return;var n=t.getID?t.getID():"FakeTreeNode";if(1===(a=this._search(n)).length){var i=a[0],o=this.options.model,r=t.options.filtered;s.toBeUpdated(i,t)&&(o.prepareUpdate(),this.__cloneNodeOpts(t.options).then(e=>{i.updateOptions(e),i.options.filtered=r,!0===i.options.filtered?i.setBadges({bottomRight:"filter"}):i.setBadges({bottomRight:""}),o.pushUpdate(),this.options.grid.layout.invalidate()}))}}else if(e.tileId){var a;if(1===(a=this._search(e.tileId)).length){i=a[0],o=this.options.model;if(e.nodeOpts){e.nodeOpts.thumbnail||(e.nodeOpts.thumbnail=i.options.thumbnail),e.nodeOpts.label||(e.nodeOpts.label=i.options.label);let t=new l(e.nodeOpts);s.toBeUpdated(i,t)&&(o.prepareUpdate(),this.__cloneNodeOpts(t.options).then(e=>{i.updateOptions(e),i.options.filtered=r,!0===i.options.filtered?i.setBadges({bottomRight:"filter"}):i.setBadges({bottomRight:""}),o.pushUpdate(),this.options.grid.layout.invalidate()}))}else o.prepareUpdate(),"boolean"==typeof e.isFiltered&&(i.options.filtered=e.isFiltered,!0===i.options.filtered?i.setBadges({bottomRight:"filter"}):i.setBadges({bottomRight:""})),o.pushUpdate(),this.options.grid.layout.invalidate()}}},p.prototype._search=function(e){return this.options.model.search({match:function(t){if(t.nodeModel.options.resourceid===e)return!0}})},p.prototype._removeTiles=function(e){var t=!0===e.all?this._getAllIDs():Array.isArray(e.pids)?e.pids:[];if(t.length>500)this._removeTilesBatch({pids:t,noDispatch:e.noDispatch});else for(var n=0;n<t.length;n++)this._removeTile({tile_id:t[n],noDispatch:e.noDispatch})},p.prototype._removeTilesBatch=function(e){let t=this.options.model.getRoots().filter(function(t){return-1!==e.pids.indexOf(t.options.resourceid)});var i=this;this.options.model.withTransactionUpdate(function(){for(let s=0;s<t.length;s++){let r=t[s];if(i.options.model.removeRoot(r),!0!==e.noDispatch){var o={tile_id:r.options.resourceid};n.publish({event:"ENXModel/Root/removeTile",data:o})}}})},p.prototype._removeTile=function(e){var t=e.tile_id,i=this._search(t);if(1===i.length){var o=this;this.options.model.withTransactionUpdate(function(){o.options.model.removeRoot(i[0]);var s={tile_id:t};!0!==e.noDispatch&&n.publish({event:"ENXModel/Root/removeTile",data:s})})}},p.prototype._realAddInWebUX=c.debounce(function(e){var t=[];this.options.model.prepareUpdate(),t=e;var n=function(){t.length&&t[0].resolve&&t[0].resolve()};let i=this.options.model.getRoots().map(function(e){return e.options.resourceid}),s=e.filter(function(e){return-1===i.indexOf(e.resourceid)}),r=s.map(function(e){return e.resourceid}),a=r.filter(function(e,t,n){return n.indexOf(e)===t}),l=s;if(a.length<r.length){let e={};l=s.filter(function(t){let n=t.resourceid;if(!e[n]&&-1!==a.indexOf(n))return e[n]=!0,!0})}if(0===(e=l).length)return void n();let d=this;o.createBatchStepper(e,500,200,function(e,t){d.options.model.addRoot(e),t()},function(){n(),d._roots2add.length=0,d._broadcastSelect=!1;let e=d.options.model.getRoots().filter(function(e){return-1!==a.indexOf(e.options.resourceid)});for(let t=0;t<e.length;t++){let n=e[t];n.options.selectTile&&n.select(),n.options.isFiltered?n.setBadges({bottomRight:"filter"}):!1===n.options.isFiltered&&n.setBadges({bottomRight:""})}d.options.model.pushUpdate(),d._broadcastSelect=!0})()},100),p.prototype._onDropBlank=function(e,t){var o=i.deserializeDroppedData(e);return n.publish({event:"ENXModel/Root/addTile",data:{unserializedData:o,behavior:"WITHOUT_CONTEXT",broadcast:!0}}),!0},p.prototype._getAllIDs=function(){var e=[],t=this.options.model.getRoots();for(var n in t)e.push(t[n].options.resourceid);return e},p.prototype.__onDragStartCell=function(e,t){var n=t.nodeModel,i=this.options.model.getXSO().get().slice(0);if(i[0]!==n){var o=i.indexOf(n),s=i[0];i[0]=n,i[o]=s}var r=this.__dropDataFromNodes(i);return this._updateWithBIProxyInfos(i,r),e.dataTransfer.setData("Text",JSON.stringify(r)),e.stopPropagation(),!1},p.prototype.__dropDataFromNodes=function(e){var t={protocol:"3DXContent",version:"1.1",source:i.getAppId(),widgetId:i.getWidgetId(),data:{items:[]}};return e.forEach(function(e){t.data.items=t.data.items.concat(this.__dropDataItem(e))}.bind(this)),t},p.prototype.__dropDataItem=function(e){return{envId:require("DS/PADServices/utils/PlatformURL").getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:i.getSecurityContext()?i.getSecurityContext():void 0,objectId:e.options.resourceid,objectType:e.options.type,displayType:e.options.grid["ds6w:type"],displayName:e.options.display?e.options.display:e.getLabel()}},p.prototype._updateWithBIProxyInfos=function(e,t){var n=!1;if("function"==typeof this.options.HasFilter&&"function"==typeof this.options.getCtxForSharing){for(let t=0;t<e.length&&!1===n;t++){if(e[t].isRoot())!0===this.options.HasFilter(e[t].options.resourceid).hasFilter&&(n=!0)}if(n){var i=this.options.getCtxForSharing();i&&(t.biProxyCtx=i)}}},p.prototype.__onContextualEvent=function(){return{this:this,callback:function(e){var i=this;return new Promise(function(e){var o=[],s=i.options.model,r={type:"PushItem",icon:{iconName:"wrong",fontIconFamily:1},title:t.rootLst.removeRoot,action:{this:s,callback:function(){var e=this;this.withTransactionUpdate(function(){var t=e.getSelectedNodes();for(let o=0;o<t.length;o++){var i={tile_id:t[o].options.resourceid};e.removeRoot(t[o]),n.publish({event:"ENXModel/Root/removeTile",data:i})}})}}};o.push(r),e(o)})}}},p}),define("DS/PADServices/views/ENXLeftSidePanel",["DS/Controls/TabBar","DS/PADServices/views/private/ResponsiveRootList","DS/PADServices/utils/GlobalModelEvents"],function(e,t,n){"use strict";function i(n){var i=this;i.elements={},i.elements.container=UWA.createElement("div",{class:"enx-leftsidepanel"}),i.elements.leftHeaderdiv=document.createElement("div"),i.elements.leftHeaderdiv.classList.add("enx-left-header"),i.elements.container.appendChild(i.elements.leftHeaderdiv),i.elements.leftsidetabbar=new e({displayStyle:"strip"}),i.elements.leftsidetabbar.onContextualMenuEvent(function(){return Promise.resolve([])}),i.elements.leftsidetabbar.getContent().setStyle("width","calc(100% - 38px)"),i.elements.leftHeaderdiv.appendChild(i.elements.leftsidetabbar.getContent()),i.elements.leftContentdiv=document.createElement("div"),i.elements.leftContentdiv.classList.add("enx-left-content"),i.elements.container.appendChild(i.elements.leftContentdiv),i.elements.rootLst=new t,i.elements.leftsidetabbar.add({label:i.elements.rootLst.getTabLabel(),isSelected:!0,value:"rootlst",icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.elements.leftContentdiv.appendChild(i.elements.rootLst.getContent()),i.elements.leftsidetabbar.addEventListener("change",function(e){switch(e.dsModel.value[0]){case"rootlst":i.elements.rootLst.setVisible(!0)}})}return i.prototype.getContent=function(){return this.elements.container},i}),define("DS/PADServices/views/private/CustomColorSet",["css!DS/PADServices/PADServices","UWA/Class/Collection","UWA/Class/View","DS/PADServices/views/private/CustomColorView","text!DS/PADServices/assets/init/CustomColor.json"],function(e,t,n,i,o){"use strict";return n.extend({name:"padcustomcolorset",className:"padcustomcolorset",tagName:"div",defaultOptions:{mono_sel:!0,color_set:"greyscale",color_category:"background"},setup:function(e){var n=e||{},i=JSON.parse(o),s=i[n.color_set];this.collection=new t(s),this.collection.forEach(function(e){e.set("label",n.color_category+"_"+e.get("label"))}),this.defaults=i.defaults,this._parent(n)},render:function(){var e=this,t=0,n=UWA.createElement("div",{class:this.getClassNames("_container")}).inject(this.container),o=UWA.createElement("div",{class:"padcustomcolorset_row"}).inject(n);return this.collection.forEach(function(s){8===t&&(o=UWA.createElement("div",{class:"padcustomcolorset_row"}).inject(n),t=0),new i({model:s,events:{select:e._onSelect.bind(e)}}).render().inject(o),t++}),this},_onSelect:function(e){if(!0===this.getOption("mono_sel")){var t=this.collection.where({selected:!0});if(this.selected_model=null,t.length>0){var n=this;t.forEach(function(t){t.get("label")!==e?t.set("selected",!1):n.selected_model=t})}this.dispatchEvent("select",this.selected_model.toJSON())}},clearSelection:function(){this.collection.forEach(function(e){e.get("selected")&&e.set("selected",!1)})},select:function(e){this.collection.forEach(function(t){t.get("label")===e&&t.set("selected",!0)})},setColor:function(e,t,n){this.collection.forEach(function(i){i.get("label")===e&&i.set(t,n)})},getColor:function(e,t){var n=null;return this.collection.forEach(function(i){i.get("label")!==e||(n=i.get(t))}),n},resetToDefault:function(){this.clearSelection();var e=this.defaults.background,t=this.defaults.foreground;this.collection.forEach(function(n){n.get("label")===e&&n.set("selected",!0),n.get("label")===t&&n.set("selected",!0)})}})}),define("DS/PADServices/utils/CompassUtils",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PlatformURL","DS/i3DXCompassServices/i3DXCompassPubSub","UWA/Utils/InterCom"],function(e,t,n,i){"use strict";var o=null,s={settypes_params:null},r=!1;function a(n){var i={protocol:"3DXContent",version:"1.1",source:e.getAppId(),widgetId:e.getWidgetId(),data:{items:[]}};return n.forEach(function(n){!0!==n.isGroupingNode&&i.data.items.push(function(n,i){var o=[n.options.type];i&&i[n.options.type]&&(o=i[n.options.type]);return{envId:t.getPlatformId(),serviceId:"3DSpace",contextId:e.getSecurityContext(),objectId:n.options.resourceid,objectType:n.options.type,objectTaxonomies:o}}(n))}),i}function l(){return"object"==typeof l.instance?l.instance:(l.instance=this,this)}return l.prototype.launchApp=function(i){var o=i.context.model,s=i.context.appName,r=a([o]);i={x3dSharedId:e.getSharedId(),x3dPlatformId:t.getPlatformId(),CollabSpacePref:JSON.stringify(r)};if(e.isWebInWinContext()){var l={objectId:o.options.resourceid,envId:t.getPlatformId(),contextId:e.getSecurityContext(),serviceId:"3DSpace"};n.publish("setObject",l),n.subscribe("launchAppCallback",function(i){i.appId===s&&i.widgetId===e.getWidgetId()&&n.publish("setObject",{objectId:"",envId:t.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var d={appId:s,widgetId:e.getWidgetId()};n.publish("launchApp",d,function(e){console.log("CompassUtils:launchApp called back with["+JSON.stringify(e)+"]")})}else require(["DS/TransientWidget/TransientWidget"],function(e){e.showWidget(s,void 0,i,function(e){console.log("CompassUtils:launchApp called back with["+JSON.stringify(e)+"]")})})},l.prototype.setObject=function(e){var t="undefined"!=typeof widget&&widget.id?"padcompassSocket_"+widget.id:"padcompassSocket";if(!UWA.is(e.nodes,"array"))throw new Error("setObject: Invalid init parameter nodes");if(null===o&&(o=new i.Socket(t)).subscribeServer("com.ds.compass",window.parent),0===e.nodes.length)o.dispatchEvent("onResetX3DContent",{},t);else{var n=a(e.nodes);o.dispatchEvent("onSetX3DContent",n,t)}},l.prototype.setTypesForOFW=function(i){if(!r){n.subscribe("setTypesCallback",function(o){if(o.widgetId===e.getWidgetId()){var r=i.getSelectedNodesForOFW();if(r.length>0){var a,l;try{var d=localRequire("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");a=d.get()}catch(e){console.warn("CfgAuthoringContext throw an error")}if("MAP-CATCDVEAP"===o.appId&&1===r.length&&r[0].relatedCADDocs&&(l=r[0].relatedCADDocs.getSelectedNodes()),l&&0!=l.length||"MAP-CATCDVEAP"!==o.appId||1!==r.length||!r[0].isRoot()||!0===r[0].options.filtered||UWA.is(a)&&""!==a.change.id){var c="MAP-AAAPBYSWX"!==o.appId;require(["DS/PADUtils/PADDataTransform"],function(e){e.buildDataForSetTypes(r,i,function(e,t){e._getLastViewpoint(function(e){var i,s,r;if(null!==e&&t.viewpoint.push(e),a&&(t.workUnder=a),l)for(s=(new Date).valueOf(),i=0;i<l.length;i++)"XCADNonPSBaseRepReference"!==l[i].options.type&&"Drawing"!==l[i].options.type||(s++,r=""+l[i].options.physicalid,t.results.push({id:""+s,phid:r}),t.structures.push({structure:[]}),t.structures[t.structures.length-1].structure.push({id:""+s,show:!0,select:!1,children:[]}));var d=JSON.stringify(t),c={appId:o.appId,widgetId:o.widgetId,fileName:"-file",fileContent:d};n.publish("launchApp",c)})},c)})}else{var p={objectId:r[0].getID(),envId:t.getPlatformId(),contextId:e.getSecurityContext(),serviceId:"3DSpace"};n.publish("setObject",p),n.subscribe("launchAppCallback",function(e){e.appId===o.appId&&e.widgetId===o.widgetId&&n.publish("setObject",{objectId:"",envId:t.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var u={appId:o.appId,widgetId:o.widgetId};n.publish("launchApp",u,function(e){n.publish("setTypes",s.settypes_params)})}}else{n.publish("resetTypes");var h={appId:o.appId,widgetId:o.widgetId};n.publish("launchApp",h,function(e){n.publish("setTypes",s.settypes_params)})}}}),r=!0}s.settypes_params||(s.settypes_params={widgetId:e.getWidgetId()}),n.publish("setTypes",s.settypes_params)},l.prototype.buildDnDData=a,l.prototype.buildX3DContent=a,new l}),define("DS/PADServices/utils/SearchUtils",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/CompassUtils","UWA/Utils/InterCom","DS/Utilities/Utils"],function(e,t,n,i,o){"use strict";function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this)}return s.prototype.inAppsSearch=function(n){var s=Object.assign({mode:"furtive",default_with_precond:!0,widget_id:t.getWidgetId(),app_socket_id:"enosearchutils_"+t.getWidgetId(),idcard_activated:!1,tenant:e.getPlatformId()},n),r=new i.Socket(s.app_socket_id,{dispacthRetryInterval:0});!0===n.debug_mode&&r.setDebugMode(!0),UWA.is(n.parent_window)?r.subscribeServer("SearchComServer",window):r.subscribeServer("SearchComServer"),r.dispatchEvent("RegisterContext",s),UWA.is(n.context_name)&&(s.context_title=n.context_name),s.default_search_criteria=n.fts_value,r.dispatchEvent("InContextSearch",s);var a,l=[];r.addListener("InContextSearch_Response",function(e){e,l=e.selected_objects,a=e.selected_command});var d=o.debounce(function(e){switch(a){case"in_app_ok":n.callback.call(null,l);break;case"in_app_apply":n.apply?n.apply.call(null,l):n.callback.call(null,l);break;default:n.cancel&&n.cancel.call(null)}r.removeListener("onCloseTransient",d),r.dispatchEvent("UnregisterContext",{widget_id:s.widget_id})},200);r.addListener("InContextSearch_Response",d),r.addListener("onCloseTransient",d),r.addListener("onCloseTransient",function(e){n.cancel&&n.cancel.call(null),r.dispatchEvent("UnregisterContext",{widget_id:s.widget_id})})},s.prototype.createDropDataFromSearch=function(e){var t=[];for(let n=0;n<e.length;n++){var i={options:{label:e[n]["ds6w:label"],resourceid:e[n].resourceid,type:e[n]["ds6w:type_value"]}};t.push(i)}return n.buildDnDData(t)},new s}),define("DS/PADServices/views/private/CustomColorPicker",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/UIKIT/Modal","DS/Controls/Button","DS/PADServices/views/private/CustomColorSet"],function(e,t,n,i,o,s,r,a){"use strict";return n.extend(o,i,{name:"padcustomcolorpicker",defaultOptions:{selected_color:null},init:function(e){this._parent(e);var n=this,i=UWA.createElement("div"),o=UWA.createElement("div");o.addClassName("padcustomcolorpicker_leftfooter"),o.inject(i);var l=UWA.createElement("div");l.addClassName("padcustomcolorpicker_rightfooter"),l.inject(i);UWA.createElement("div");var d=new r({label:t.colorPicker.OKtitle,emphasize:"primary"});d.addEventListener("click",function(){n._onSaveAndApply()});var c=new r({label:t.colorPicker.Canceltitle});c.addEventListener("click",function(){n.elements.container.destroy()});var p=new r({label:t.colorPicker.Resettitle});p.addEventListener("click",function(){n._onReset()}),c.getContent().setStyles({float:"right"}),d.getContent().setStyles({float:"right","margin-right":"10px"}),p.getContent().setStyles({float:"left"}),c.inject(l),d.inject(l),p.inject(o);var u=UWA.createElement("div"),h=UWA.createElement("div");h.setStyle("margin-left","10px"),h.inject(u),UWA.createElement("text",{class:this.name+"_prompt",content:t.colorPicker.preview}).inject(h),this.preview=new a({color_set:"preview",color_category:"P"}),this.preview.render().inject(h);var m=UWA.createElement("div");m.setStyle("float","left"),m.setStyle("margin-left","10px"),m.inject(u),UWA.createElement("text",{class:this.name+"_prompt",content:t.colorPicker.backgroundColor}).inject(m),this.bgGreyscale=new a({color_set:"greyscale",color_category:"BG",events:{select:this._onSelect.bind(this)}}),this.bgGreyscale.render().inject(m),this.bgPrimary=new a({color_set:"primary",color_category:"BG",events:{select:this._onSelect.bind(this)}}),this.bgPrimary.render().inject(m),this.bgSecondary=new a({color_set:"secondary",color_category:"BG",events:{select:this._onSelect.bind(this)}}),this.bgSecondary.render().inject(m);var f=UWA.createElement("div");f.setStyle("float","right"),f.inject(u),UWA.createElement("text",{class:this.name+"_prompt",content:t.colorPicker.textColor}).inject(f),this.tcGreyscale=new a({color_set:"greyscale",color_category:"FG",events:{select:this._onSelect.bind(this)}}),this.tcGreyscale.render().inject(f),this.tcPrimary=new a({color_set:"primary",color_category:"FG",events:{select:this._onSelect.bind(this)}}),this.tcPrimary.render().inject(f),this.tcSecondary=new a({color_set:"secondary",color_category:"FG",events:{select:this._onSelect.bind(this)}}),this.tcSecondary.render().inject(f),this.elements.container=new s({className:this.name,closable:!0,header:t.colorPicker.titleCustom,body:u,footer:i,visible:!0}),e.renderTo&&this.elements.container.inject(e.renderTo)},_onSaveAndApply:function(){var e={background_color:this.preview.getColor("P_Preview","background_color"),color:this.preview.getColor("P_Preview","color")};this.dispatchEvent("onCustomColorOK",e),this.elements.container.destroy()},_onReset:function(){this.bgGreyscale.resetToDefault(),this.bgPrimary.resetToDefault(),this.bgSecondary.resetToDefault(),this.tcGreyscale.resetToDefault(),this.tcPrimary.resetToDefault(),this.tcSecondary.resetToDefault(),this.preview.setColor("P_Preview","background_color","#ffffff"),this.preview.setColor("P_Preview","color","#000000")},_onSelect:function(e){var t=e.label;0===t.indexOf("BG_")&&(this.preview.setColor("P_Preview","background_color",e.background_color),-1===t.indexOf("BG_Greyscale_")&&this.bgGreyscale.clearSelection(),-1===t.indexOf("BG_Primary_")&&this.bgPrimary.clearSelection(),-1===t.indexOf("BG_Secondary_")&&this.bgSecondary.clearSelection()),0===t.indexOf("FG_")&&(this.preview.setColor("P_Preview","color",e.background_color),-1===t.indexOf("FG_Greyscale_")&&this.tcGreyscale.clearSelection(),-1===t.indexOf("FG_Primary_")&&this.tcPrimary.clearSelection(),-1===t.indexOf("FG_Secondary_")&&this.tcSecondary.clearSelection())}})}),define("DS/PADServices/views/private/ColorSet",["css!DS/PADServices/PADServices","UWA/Class/Options","UWA/Class/Collection","UWA/Class/View","DS/PADServices/views/private/ColorView","text!DS/PADServices/assets/init/Color.json"],function(e,t,n,i,o,s){"use strict";return i.extend(t,{name:"padcolorset",className:"padcolorset",tagName:"div",defaultOptions:{mono_sel:!0,objects_per_row:9,custom_color_rows:2,preset_color_rows:5,selected_color:{background_color:"#ffffff",color:"#000000"}},addCustomColors:function(e){var t=localStorage.getItem("ENOPAD_CustomColors"),n={background_color:"#ffffff",color:"#ffffff",custom:!0,empty:!0};if(t){t=JSON.parse(t);var i=1;t.forEach(function(e){e.custom=!0,e.empty=!1,e.label="custom_"+i,i+=1})}else t=[];var o,s=this.getOption("objects_per_row")*this.getOption("custom_color_rows"),r=s-t.length;for(o=0;o<r;o++)t.push(UWA.clone(n));for(o=0;o<s;o++)t[o].label="custom_"+(o+1);return e.concat(t)},initCollection:function(e){var t=JSON.parse(s);t=this.addCustomColors(t),this.collection=new n(t),e&&this.collection.forEach(function(t){t._attributes.color===e.color&&t._attributes.background_color===e.background_color&&(t._attributes.selected=!0)})},setup:function(e){var t=e||{};this.selected_color=t.selected_color,this.initCollection(t.selected_color),this._parent(t)},render:function(){var e=this,t=0,n=UWA.createElement("div",{class:this.getClassNames("_container")}).inject(this.container),i=UWA.createElement("div",{class:"padcolorset_row"}).inject(n);return this.collection.forEach(function(s){t===e.getOption("objects_per_row")&&(i=UWA.createElement("div",{class:"padcolorset_row"}).inject(n),t=0),new o({model:s,selected_color:e.selected_color,events:{select:e._onSelect.bind(e)}}).render().inject(i),t++}),this},_onSelect:function(e){if(!0===this.getOption("mono_sel")){var t=this.collection.where({selected:!0}),n=null;t.forEach(function(t){t.get("label")!==e?t.set("selected",!1):n=t}),n&&this.dispatchEvent("select",n.toJSON())}},reset:function(){var e=this.collection.where({selected:!0});e.length>0&&e.forEach(function(e){e.set("selected",!1)}),this.dispatchEvent("select","")},updateCollection:function(e){var t=0,n=0,i=this.getOption("objects_per_row")*this.getOption("preset_color_rows");this.collection.forEach(function(o){t>=i&&(o.get("background_color")!==e[n].background_color&&o.set("background_color",e[n].background_color),o.get("color")!==e[n].color&&o.set("color",e[n].color),n+=1),t+=1})},updateCustomColors:function(){var e=this.addCustomColors([]),t=this.getElements(".padcolorview_custom_cell"),n=this.getElements(".padcolorview_custom_content"),i=0;t.forEach(function(t){i<e.length&&(t.setStyle("background-color",e[i].background_color),e[i].empty||t.hasClassName("padcolorview_empty_cell")&&(t.removeClassName("padcolorview_empty_cell"),t.addClassName("padcolorview_active_cell"),t.setStyle("border-color","#000000")),i+=1)}),i=0,n.forEach(function(t){i<e.length&&(t.setStyle("color",e[i].color),i+=1)}),this.updateCollection(e)}})}),define("DS/PADServices/views/private/ColorPicker",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","UWA/Drivers/Alone","DS/UIKIT/Modal","DS/Controls/Button","DS/PADServices/views/private/ColorSet","DS/PADServices/views/private/CustomColorPicker"],function(e,t,n,i,o,s,r,a,l,d){"use strict";return console.warn("DEPRECATED AMD [DS/PADServices/views/private/ColorPicker]"),n.extend(o,i,{name:"padcolorpicker",defaultOptions:{selected_color:{background_color:"#ffffff",color:"#000000"}},init:function(e){this._parent(e),this.selected_color=this.getOption("selected_color");var n=this,i=UWA.createElement("div"),o=UWA.createElement("span");o.setStyle("margin-right","10px");var s=new a({label:t.colorPicker.addTitle,icon:"plus",iconSize:"1x"}),d=new a({label:t.colorPicker.resetTitle,icon:"clear",iconSize:"1x"});s.inject(o),o.inject(i),d.inject(i);var c=i.getElementsByClassName("wux-ui-fa-clear")[0];c.removeClassName("wux-ui-fa"),c.removeClassName("wux-ui-fa-clear"),c.removeClassName("wux-ui-fa-lg"),c.addClassName("wux-ui-3ds"),c.addClassName("wux-ui-3ds-clear"),c.addClassName("wux-ui-3ds-lg");var p=UWA.createElement("div");this.colorSet=new l({selected_color:this.selected_color,events:{select:this._onSelect.bind(this)}}).render().inject(p),s.addEventListener("click",n._onAddCustomColor.bind(n)),d.addEventListener("click",n._onResetToDefault.bind(n)),this.elements.container=new r({className:this.name,closable:!0,header:t.colorPicker.title,body:p,footer:i,visible:!0,events:{onHide:function(){n.dispatchEvent("onClose")}}}),e.renderTo&&(this.renderTo=e.renderTo,this.elements.container.inject(e.renderTo))},_onAddCustomColor:function(){var e=this;new d({renderTo:this.renderTo,events:{onCustomColorOK:function(t){var n=localStorage.getItem("ENOPAD_CustomColors");n?(n=JSON.parse(n)).push(t):n=[t],n.length>16&&(n=n.slice(-16)),localStorage.setItem("ENOPAD_CustomColors",JSON.stringify(n)),e.colorSet.updateCustomColors(),e._onSelect(t)}}})},_onResetToDefault:function(){this._onSelect({background_color:"#ffffff",color:"#000000"})},_onSelect:function(e){this.setOption("selected_color",e),this.dispatchEvent("onColorOK",e),this.elements.container.destroy()}})}),define("DS/PADServices/views/private/homepage/RecentView",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/views/private/TilesViewUtils","DS/Utilities/Dom","DS/Controls/ResponsiveTileView","DS/Core/PointerEvents"],function(e,t,n,i,o,s){"use strict";const r=e=>{const t=new Date;return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()};function a(e,t){return e=e||{},this.options=Object.assign({name:"enx-recent-view",model:null,counterUpd:0,mdlEvts:null,subscriptions:[]},e),this.elements={},this.elements.container=i.createElement("div",{class:this.options.name+" "+t}),this.__buildRecentsLst(),this}return a.prototype.destroy=function(){},a.prototype.getContent=function(){return this.elements.container},a.prototype.loadGridViewModel=function(e){this.options.model=e,this.updateContent(),this.options.subscriptions.push(this.options.model.addEventListener("removeChild",this.updateContent.bind(this))),this.options.subscriptions.push(this.options.model.getXSO().onPostAdd(this.__manageSelection.bind(this))),this.options.subscriptions.push(this.options.model.getXSO().onPostRemove(this.__manageSelection.bind(this))),this.options.subscriptions.push(this.options.model.getXSO().onEmpty(this.__manageSelection.bind(this)))},a.prototype.unloadGridViewModel=function(){for(let e=0;e<this.options.subscriptions.length;e++)this.options.model.removeEventListener(this.options.subscriptions[e]);this.options.subscriptions=[],this.options.model=null,this.updateContent()},a.prototype.__buildRecentsLst=function(){this.elements.content=i.createElement("div",{class:this.options.name+"-lst"}),this.elements.content.addEventListener(s.POINTERDOWN,e=>{this.options.model.unselectAll()}),this.elements.container.appendChild(this.elements.content)},a.prototype.updateContent=function(){let e=this.options.model?this.options.model.getRoots():0;this.elements.content.innerHTML=null,this.options.nodesMap={};let n={};for(let i=0;i<e.length;i++){let o=e[i],s=new Date(o.options.openDate);if(r(s))void 0===n.today&&(n.today=this.__buildSection(t.recent.today),this.elements.content.appendChild(n.today)),this.__addRowToSection(n.today,o);else{let e=s.toDateString();void 0===n[e]&&(n[e]=this.__buildSection(e),this.elements.content.appendChild(n[e])),this.__addRowToSection(n[e],o)}}},a.prototype.__buildSection=function(e){let t=i.createElement("div",{class:this.options.name+"-day"}),n=i.createElement("div",{class:this.options.name+"-day-title"}),o=i.createElement("div",{class:this.options.name+"-day-title-label"});o.innerText=e,n.appendChild(o),t.appendChild(n);let s=i.createElement("div",{class:this.options.name+"-day-lst"});return t.appendChild(s),t},a.prototype.__addRowToSection=function(e,t){var i=this;let r=new o({picture:t.options.thumbnail,icon:t.options.icons.length?t.options.icons[0]:void 0,title:t.getLabel(),clickableTitle:"function"==typeof i.options.events.clickOnTitleCell,subtitle:t.options.subLabel,description:t.options.description,contextualMenu:t.options.contextualMenu,customTooltip:n.getTooltip(t,2e3),onContextMenuBuildCallback:function(e){return r.options.node.select(),i.options.events.onContextualEvent()}});r.options.node=t,r.getContent().addEventListener(s.POINTERDOWN,e=>{t.isSelected()?t.unselect():t.select(),e.stopPropagation(),e.preventDefault()});let a=r.getContent().getElementsByClassName("wux-controls-responsiveview-clickable-title");1===a.length&&a[0].addEventListener(s.POINTERDOWN,e=>{this.options.model.unselectAll(),t.select(!0),"function"==typeof i.options.events.clickOnTitleCell&&i.options.events.clickOnTitleCell({nodeModel:t}),e.stopPropagation(),e.preventDefault()}),"function"==typeof this.options.events.dblclickCell&&r.getContent().addEventListener("dblclick",e=>{this.options.events.dblclickCell({nodeModel:t})}),r.getContent().setStyles({width:"100%",height:"100%","max-width":"100%"}),this.options.nodesMap[t.options.resourceid]=r,r.getContent().addClassName(this.options.name+"-tile");let l=e.getElementsByClassName(this.options.name+"-day-lst");1===l.length&&l[0].appendChild(r.getContent())},a.prototype.__manageSelection=function(){if(this.options.model){let e=this.options.model.getRoots();for(let t=0;t<e.length;t++){let n=e[t],i=this.options.nodesMap[n.options.resourceid];i&&(n.isSelected()?i.highlight():i.unhighlight())}}},a}),define("DS/PADServices/views/private/homepage/Recent",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/views/private/ENXMask","DS/PADServices/views/private/homepage/RecentView","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/PADTrackerManager","DS/Utilities/Dom","DS/Tree/TreeDocument","DS/Tweakers/GeneratedToolbar","DS/Tweakers/TypeRepresentationFactory","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/Controls/Button"],function(e,t,n,i,o,s,r,a,l,d,c,p){"use strict";const u="ENXRecent",h="recentTiles",m="recentLargeTiles";function f(e){this.options=e||{},this.options.defaultLayout=e.defaultLayout?e.defaultLayout:h,this.options=Object.assign({toolbar:{entries:[{id:"open",dataElements:{typeRepresentation:"functionIcon",tooltip:{title:t.recent.open,shortHelp:t.recent.openShortHelp},icon:{iconName:"open",fontIconFamily:1},position:"far",category:"commands",priority:0,disabled:!0,value:this.__openSelected.bind(this)}},{id:"openWithFilter",dataElements:{typeRepresentation:"functionIcon",tooltip:{title:t.recent.openWithFilter,shortHelp:t.recent.openWithFilterShortHelp},icon:{iconName:"filter-open",fontIconFamily:1},position:"far",category:"commands",priority:0,disabled:!0,value:this.__openSelectedWithFilter.bind(this)}},{id:"selectionMenu",dataElements:{typeRepresentation:"functionMenuIconCount",tooltip:{title:t.recent.selection,shortHelp:t.recent.selectionShortHelp},icon:{iconName:"select-on",fontIconFamily:1},value:{menu:[{type:"PushItem",title:t.recent.selectAll,tooltip:t.recent.selectAll,icon:{iconName:"select-all",fontIconFamily:1},action:{callback:()=>{this.options.model.selectAll(),s.addCommandHit("selectAll","HP")}}},{type:"PushItem",title:t.recent.selectNone,tooltip:t.recent.selectNone,icon:{iconName:"select-none",fontIconFamily:1},action:{callback:()=>{this.options.model.unselectAll(),s.addCommandHit("unselectAll","HP")}}}]},position:"far",category:"view",priority:2,count:0}},{id:"remove",dataElements:{typeRepresentation:"functionIcon",tooltip:{title:t.recent.remove,shortHelp:t.recent.removeShortHelp},icon:{iconName:"remove",fontIconFamily:1},position:"far",category:"commands",disabled:!0,priority:0,value:this.__removeNodes.bind(this)}},{id:"layoutOptions",dataElements:{typeRepresentation:"icon",value:this.options.defaultLayout,possibleValues:[{value:m,label:t.recent.largetiles,tooltip:t.recent.largetiles,icon:{iconName:"view-big-tile",fontIconFamily:1}},{value:h,label:t.recent.tiles,tooltip:t.recent.tiles,icon:{iconName:"view-small-tile",fontIconFamily:1}}],position:"far",category:"view",priority:2,onNodeUpdate:e=>{this.__switchView(e.getReferenceValue("data"))}}},{id:"close",dataElements:{typeRepresentation:"functionIcon",tooltip:{title:t.recent.close,shortHelp:t.recent.closeShortHelp},icon:{iconName:"close",fontIconFamily:1},position:"far",category:"other",priority:0,value:()=>{o.publish({event:"DS/ENX/HP/Recent/close"})}}}]},contentViewID:u,recentsOpts:{mdlEvts:o.getModelEvents(),events:{onContextualEvent:this.__onContextualEvent.bind(this),clickOnTitleCell:this.__openCell.bind(this),dblclickCell:this.__openCell.bind(this)}},recentMaxSize:40},this.options),this.elements={},this.__buildUX(),o.subscribe({event:"DS/ENX/HP/Recent/Updated"},this.__recentMgt.bind(this))}return f.prototype.initialize=async function(){return new Promise(e=>{var t=this.options.supportedTypes,n=Object.keys(t);(function(e){return e.reduce((e,n)=>e.then(()=>(function(e){return new Promise(function(n){require([t[e].amd],e=>{n()},()=>{console.warn("No AMD found "+t[e].amd),n()})})})(n)),Promise.resolve())})(n).then(()=>{e()})})},f.prototype.getDOM=function(){return this.elements.container},f.prototype.retrieveObjs=function(e,i){return new Promise(o=>{if(!0!==this.inprogress){this.inprogress=!0,!0!==i&&n.mask(this.elements.content,t.recent.loading),new Promise(t=>{this.options.model.removeRoots();let n=e?Object.keys(e):[],i=[];for(let t=0;t<n.length;t++)if(this.options.supportedTypes[n[t]]){var o=require(this.options.supportedTypes[n[t]].amd);i.push(o[this.options.supportedTypes[n[t]].retrieveFunc](e[n[t]]))}Promise.all(i).then(t)}).then(e=>{!0!==i&&n.unmask(this.elements.content),delete this.inprogress,this.options.model.withTransactionUpdate(()=>{for(let t=0;t<e.length;t++)this.options.model.addRoot(e[t]);this.options.model._getTrueRoot().sortChildren({isRecursive:!1,sortFunction:(e,t)=>new Date(e.options.openDate)>new Date(t.options.openDate)?-1:1});var t=this.options.model.getRoots();if(t.length>this.options.recentMaxSize){console.log("Remove oldest recents to keep it lower than "+this.options.recentMaxSize);for(var n=t.length,i=[];n>this.options.recentMaxSize;)i.push(t[n-1]),this.options.model.removeRoot(t[n-1]),n--;this.__removeNodes({nodes:i,nocloseInApp:!0})}this.__updateContent(),o()})})}else o()})},f.prototype.setToolbarOpts=function(e,t){this.elements.toolbar.updateNodeModel(e,t)},f.prototype.__buildUX=function(){this.elements.container=r.createElement("div",{class:"enx-recent-main "+this.options.contentViewID}),this.elements.hdr=r.createElement("div",{class:"enx-recent-hdr"}),this.__buildHeader(),this.elements.container.appendChild(this.elements.hdr),this.elements.content=r.createElement("div",{class:"enx-recent-content"});this.options.model=new a({shouldAcceptDrag:function(){return!1}}),this.__switchView(this.options.defaultLayout),this.options.model.addEventListener("removeChild",this.__updateContent.bind(this)),this.options.model.addEventListener("addChild",()=>this.__manageSelection.bind(this)),this.options.model.getXSO().onPostAdd(this.__manageSelection.bind(this)),this.options.model.getXSO().onPostRemove(this.__manageSelection.bind(this)),this.options.model.getXSO().onEmpty(this.__manageSelection.bind(this)),this.elements.container.appendChild(this.elements.content),this.__buildEmptyPlaceholder(),this.elements.container.appendChild(this.elements.emptyplaceholder)},f.prototype.__buildHeader=function(){let e=r.createElement("div",{class:"enx-recent-hdr-title"});this.elements.hdr.appendChild(e),e.innerText=t.recent.title;let n=r.createElement("div",{class:"enx-recent-hdr-toolbar"});if(this.elements.hdr.appendChild(n),this.options.toolbar){if(this.options.toolbar.typeRepresentations)(new d).registerTypeRepresentations(this.options.toolbar.typeRepresentations);var i=l.prototype.createTreeDocument(this.options.toolbar);this.elements.toolbar=new l({overflowManagement:"dropdown",direction:"horizontal",items:i}),n.appendChild(this.elements.toolbar.getContent())}},f.prototype.__buildEmptyPlaceholder=function(){this.elements.emptyplaceholder=r.createElement("div",{class:"enx-recent-empty-main"});var e=new p({icon:{iconName:"open",fontIconFamily:WUXManagedFontIcons.Font3DS},label:t.recent.openNew,emphasize:"primary"});e.getContent().addClassName("enx-recent-empty-link"),e.addEventListener("click",()=>{o.publish({event:"DS/ENX/WelcomeScreen/openSearch",data:{default:!0}})}),new c({modelEvents:this.options.mdlEvts,sentences:[{type:"icon",text:t.recent.NoRecentAct},{type:"dom",DOMelement:e.getContent()}],fontSize:"16px",orderedListType:"none"}).inject(this.elements.emptyplaceholder)},f.prototype.__switchView=function(e){if(this.elements.views||(this.elements.views=r.createElement("div"),this.elements.views.classList.add("enx-recent-views-container"),this.elements.content.appendChild(this.elements.views)),this.options.currentView!==e){switch(e){case m:this.elements.recentLargeTiles?this.elements.recentLargeTiles.getContent().removeAttribute("hidden"):(this.elements.recentLargeTiles=new i(this.options.recentsOpts,e),this.elements.views.appendChild(this.elements.recentLargeTiles.getContent())),this.elements.recentTiles&&this.elements.recentTiles.getContent().setAttribute("hidden",!0);break;case h:this.elements.recentTiles?this.elements.recentTiles.getContent().removeAttribute("hidden"):(this.elements.recentTiles=new i(this.options.recentsOpts,e),this.elements.views.appendChild(this.elements.recentTiles.getContent())),this.elements.recentLargeTiles&&this.elements.recentLargeTiles.getContent().setAttribute("hidden",!0);break;default:console.warn(`Unknow data name : ${e}`)}this.elements[this.options.currentView]&&this.elements[this.options.currentView].unloadGridViewModel(),this.elements[e].loadGridViewModel(this.options.model),this.options.currentView=e}},f.prototype.__openCell=function(e){var t=e.nodeModel,n={};if(this.options.supportedTypes[t.options.kind]){n[t.options.kind]||(n[t.options.kind]=[]);var i=require(this.options.supportedTypes[t.options.kind].amd);n[t.options.kind].push(i[this.options.supportedTypes[t.options.kind].getOpenNodeFunc](t)),o.publish({event:"DS/ENX/HP/Recent/open",data:{toopen:n}})}},f.prototype.__onContextualEvent=function(e){var n=e&&e.cellInfos?e.cellInfos.nodeModel:void 0;n&&n.select();var i=[],o=this.options.model.getSelectedNodes(),s={type:"PushItem",icon:{iconName:"open",fontIconFamily:1},title:t.recent.open,action:{callback:this.__openSelected.bind(this)}},r={type:"PushItem",icon:{iconName:"filter-open",fontIconFamily:1},title:t.recent.openWithFilter,action:{callback:this.__openSelectedWithFilter.bind(this)}},a={type:"PushItem",icon:{iconName:"remove",fontIconFamily:1},title:t.recent.remove,action:{callback:this.__removeNodes.bind(this)}};return o.length&&(i.push(s),1===o.length&&!0!==o[0].options.isFilter&&i.push(r),i.push(a)),i},f.prototype.__recentMgt=function(e){this.retrieveObjs(e)},f.prototype.__toolbarVisibility=function(e){const t=["layoutOptions","selectionMenu","open","openWithFilter","remove"];let n={disabled:!0};n=e?{...n,visibleFlag:!0}:{...n,visibleFlag:!1};for(const i of t)"layoutOptions"===i?this.setToolbarOpts(i,{disabled:!1}):"selectionMenu"===i?e?this.setToolbarOpts(i,{disabled:!1,visibleFlag:!0}):this.setToolbarOpts(i,{disabled:!1,visibleFlag:!1}):this.setToolbarOpts(i,n)},f.prototype.__updateContent=function(){const e=()=>{this.options.model&&this.options.model.getRoots().length>0?(this.__manageSelection(),this.__toolbarVisibility.call(this,!0)):this.__toolbarVisibility.call(this,!1)};this.options.model&&this.options.model.getRoots().length>0?(this.elements.emptyplaceholder.setAttribute("hidden",""),this.elements.content.removeAttribute("hidden"),e()):(this.elements.content.setAttribute("hidden",""),this.elements.emptyplaceholder.removeAttribute("hidden"),e()),this.elements[this.options.currentView]&&this.elements[this.options.currentView].updateContent()},f.prototype.__manageSelection=function(){let e=this.options.model.getSelectedNodes();const t=["open","openWithFilter","remove"];let n={};if(this.setToolbarOpts("selectionMenu",{disabled:!1,count:e.length}),0===e.length){n={disabled:!0};for(const e of t)this.setToolbarOpts(e,n)}else this.elements.toolbar.updateNodeModel("open",{disabled:!1}),this.elements.toolbar.updateNodeModel("remove",{disabled:!1}),1===e.length&&!0!==e[0].options.isFilter?this.elements.toolbar.updateNodeModel("openWithFilter",{disabled:!1}):this.elements.toolbar.updateNodeModel("openWithFilter",{disabled:!0})},f.prototype.__openSelected=function(){let e=this.options.model.getSelectedNodes();var t={};for(let i=0;i<e.length;i++)if(this.options.supportedTypes[e[i].options.kind]){t[e[i].options.kind]||(t[e[i].options.kind]=[]);var n=require(this.options.supportedTypes[e[i].options.kind].amd);t[e[i].options.kind].push(n[this.options.supportedTypes[e[i].options.kind].getOpenNodeFunc](e[i]))}o.publish({event:"DS/ENX/HP/Recent/open",data:{toopen:t}}),s.addCommandHit("openSelected","HP")},f.prototype.__openSelectedWithFilter=function(){let e=this.options.model.getSelectedNodes();var t={};for(let i=0;i<e.length;i++)if(this.options.supportedTypes[e[i].options.kind]){t[e[i].options.kind]||(t[e[i].options.kind]=[]);var n=require(this.options.supportedTypes[e[i].options.kind].amd);t[e[i].options.kind].push(n[this.options.supportedTypes[e[i].options.kind].getOpenNodeFunc](e[i]))}o.publish({event:"DS/ENX/HP/Recent/open",data:{toopen:t,withFilter:!0}}),s.addCommandHit("openSelectedWithFilter","HP")},f.prototype.__removeNodes=function(e){let t=(e=e||{}).nodes?e.nodes:this.options.model.getSelectedNodes();var n={noRefresh:!0,nocloseInApp:e.nocloseInApp,removeIds:[]};for(let e=0;e<t.length;e++)n[t[e].options.kind]||(n[t[e].options.kind]={removeIds:[]}),n[t[e].options.kind].removeIds.push(t[e].options.resourceid),n.removeIds.push(t[e].options.resourceid),this.options.model.removeRoot(t[e]);o.publish({event:"DS/ENX/App/Recent/Upd",data:n}),s.addCommandHit("removeSelected","HP")},f}),define("DS/PADServices/utils/PCSTracker",["DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PADTrackerManager"],function(e,t){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}function i(t){this.id=e.getPCSPrefix()+"_"+t,this.inprogress=!0,this.stamp=window.top.performance.now(),this.beginMark=this.id+"__begin_"+this.stamp,this.endMark=this.id+"__end_"+this.stamp,window.top.performance.mark(this.beginMark)}return n.prototype.createProbe=function(e){return new i(e)},n.prototype.networkprobe=function(e){var n,i,o=e.request_options,s=function(e){var t=e.split("/");if(t.length>5){var n=t[t.length-1],i=t[t.length-1].indexOf("?");return-1!==i&&(n=n.substring(0,i),t[t.length-1]=n),t.slice(4,t.length).join("/")}return 0===t[t.length-1].length?t[t.length-2]:t[t.length-1]}(e.url),r=this.createProbe("query_"+s);return r.eventName=s,o.onComplete=(n=o.onComplete,function(e){if(r.end(),r.eventName){var i=t.getPADTracker({eventCategory:"usage",eventAction:"queryFailed"}),o=r.duration;i.setEventData({eventLabel:r.eventName,eventValue:o}),i.trackPageEvent()}if(UWA.is(n,"function"))return n.apply(this,Array.prototype.slice.call(arguments))}),o.onFailure=(i=o.onFailure,function(e){if(r.end(),r.eventName){var n=t.getPADTracker({eventCategory:"usage",eventAction:"query"}),o=r.duration;n.setEventData({eventLabel:r.eventName,eventValue:o}),n.trackPageEvent()}if(UWA.is(i,"function"))return i.apply(this,Array.prototype.slice.call(arguments))}),o},i.prototype.end=function(){if(!0===this.inprogress){this.inprogress=!1,window.top.performance.mark(this.endMark);try{window.top.performance.measure(this.id,this.beginMark,this.endMark),this.duration=window.top.performance.getEntriesByName(this.id)[0].duration}catch(e){console.error(e),console.log("%c Measure failure...begin or end does not exist","font-size: 1.1rem; text-shadow: 4px 4px 5px red")}}},i.prototype.dump=function(){console.log(window.top.performance.getEntriesByName(this.id))},new n}),define("DS/PADServices/ws/WSAccess",["i18n!DS/PADServices/assets/nls/PADServices","DS/WAFData/WAFData","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/PCSTracker"],function(e,t,n,i){"use strict";const o=new Error("TIMEOUT");function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this)}return s.prototype.getKind=function(){return"Static"},s.prototype.initialize=function(e){return new Promise(function(t,n){var i=[],o=[];if(!0===e.addDefaults&&(o=o.concat(["DS/PADServices/ws/WSAdmin","DS/PADServices/ws/WSIndexCommon","DS/PADServices/ws/WSENOAuth","DS/PADServices/ws/WSFilter","DS/PADServices/ws/WSRelations","DS/PADServices/ws/R2VServices"])),Array.isArray(e.WSDefinitionAMDs)&&(o=o.concat(e.WSDefinitionAMDs)),Array.isArray(o))for(var r=0;r<o.length;r++){var a=r;i.push(new Promise(function(e,t){require([o[a]],function(t){s.prototype=Object.assign(s.prototype,t.prototype),e()},t)}.bind(this)))}Promise.all(i).then(t).catch(n)}.bind(this))},s.prototype.appendCfgIf=function(e){var t;try{t=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").get()}catch(e){console.warn("CfgAuthoringContext throw an error")}t&&""!==t.change.id&&(e.headers["DS-Change-Authoring-Context"]="pid:"+t.change.id),t&&null!==t.AuthoringContextHeader&&UWA.extend(e.headers,t.AuthoringContextHeader)},s.prototype.executeRequest=function(s,r,a,l){var d=n.getSecurityContext();if(UWA.is(d,"string")&&!0!==a&&(r.headers.SecurityContext=d,!0!==l)){var c=n.getUser();c&&c.login&&(r.headers.SecurityToken=c.login+"|"+d+"|preferred")}if(void 0===r.onTimeout){var p=r.onFailure?r.onFailure:r.onComplete;r.onTimeout=function(){n.displayNotif({level:"error",message:e.errors.requesttimeout,sticky:!0,key:"WSAccess-requesttimeout"}),p(o)}}var u=i.networkprobe({url:s,request_options:r});return t.authenticatedRequest(s,u)},s.prototype.executeRequestPromise=function(e,t,n,i){var o=this;return new Promise(function(s,r){t.onComplete=function(e){var t=function(e){return"string"==typeof e?JSON.parse(e):e}(e);s(t)},t.onFailure=function(e){r(e)},t.onTimeout=function(e){r(e)},"POST"===t.method&&"string"!=typeof t.data&&(t.data=JSON.stringify(t.data)),o.executeRequest(e,t,n,i)})},new s}),define("DS/PADServices/utils/PredefinedQueryUtils",["UWA/Promise","DS/PADServices/ws/WSAccess"],function(e,t){"use strict";var n=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(UWA.is(e[i],"object")&&UWA.is(t[i],"object")?n(e[i],t[i]):UWA.is(e[i],"array")&&(e[i]=e[i].concat(t[i])))},i={pqDictionary:null,abvLst:{},retrievePQDictionary:function(){return new e(function(e,o){null===i.pqDictionary?t.retrievePQ().then(function(t){if((t="string"==typeof t?JSON.parse(t):t).pqlist&&t.pqlist.PQ){if(t.custom){console.log("Custome PQ exists");for(var o=0,s=t.custom.PQ.length;o<s;o++){t.custom.PQ[o].custom=!0}n(t.pqlist,t.custom)}i.pqDictionary=t.pqlist.PQ;for(var r=0;r<t.pqlist.PQ.length;r++)for(var a=t.pqlist.PQ[r].abbreviations.split(","),l=0;l<a.length;l++)i.abvLst[a[l]]=r}else i.pqDictionary=[];e()}).catch(function(e){console.error(e),o()}):e()})}};return{isPredefinedQry:function(t,n){return new e(function(e){var o=t,s=t.indexOf(":"),r=!1;n&&2===n.version&&(r=!0),-1!==s?i.retrievePQDictionary().then(function(){var n=!1,a=t.substring(0,s),l=t.substring(s+1,t.length);if(void 0!==i.abvLst[a]){var d=UWA.clone(i.pqDictionary[i.abvLst[a]]);!0===d.custom&&(d.value="3dexp"+a+":__QUERY__"),o=d.value.replace(/__QUERY__/g,l),n=!0}e(r?{realQry:o,isPredefinedQry:n}:o)}).catch(function(){console.warn("Predefined Qry retrival fails. Keep the original query String"),e(r?{realQry:o,isPredefinedQry:!1}:o)}):e(r?{realQry:o,isPredefinedQry:!1}:o)})}}}),define("DS/PADServices/views/private/homepage/RecentProductMgt",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/ws/WSAccess","DS/PADServices/views/private/TilesViewUtils","DS/PADServices/utils/ParserUtils"],function(e,t,n,i){"use strict";function o(e){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}return o.prototype.getKey=function(){return"products"},o.prototype.convertProduct=function(e){var t=[];let n=Object.keys(e.products);function i(e,t,n=[],o=[]){let s=Object.keys(t);s.length||o.push(n.concat(e));for(const r of s)i(r,t[r],n.concat(e),o);return o}for(let o=0;o<n.length;o++){let s=i(n[o],e.products[n[o]]);1===s.length&&1===s[0].length&&(s=void 0);let r={id:n[o],paths:s,openDate:(new Date).toISOString(),wasOpen:void 0!==e.wasOpenProducts[n[o]]};t.push(r)}return t},o.prototype.retrieveProducts=function(o){return new Promise(s=>{let r=[],a={},l={};for(let e=0;e<o.length;e++)r.push(o[e].id),o[e].paths&&1===o[e].paths.length&&r.push(o[e].paths[0][o[e].paths[0].length-1]),a[o[e].id]=o[e];var d=function(e){return e.reduce((e,t)=>e.then(()=>(function(e){return new Promise(function(t){var o=i.parseAttributes(e.attributes);n.buildNodeOptions(o).then(e=>{a[e.resourceid]&&(e.opened=a[e.resourceid].wasOpen,e.openDate=a[e.resourceid].openDate),e.kind="products",e.contextualMenu=[{type:"SeparatorItem"}],l[e.resourceid]=e,t()})})})(t)),Promise.resolve())};if(r.length){var c={labelPrefix:"HP-Product-",pids:r,data:{select_predicate:n.getFetchAttribute(),select_file:["icon","thumbnail_2d"]}};t.fetch(c).then(t=>{(t="string"==typeof t?JSON.parse(t):t).results&&t.results.length>0?d(t.results).then(()=>{var t=[];for(let n=0;n<o.length;n++)if(l[o[n].id]){if(o[n].paths)if(o[n].paths.length>1){let t=o[n].paths.length+e.recent.branches;l[o[n].id].label=l[o[n].id].label+" ► "+t,l[o[n].id].description=l[o[n].id].description+" ► "+t,l[o[n].id].paths=o[n].paths}else{let e=l[o[n].paths[0][o[n].paths[0].length-1]];e&&(l[o[n].id].label=l[o[n].id].label+" ► "+e.label,l[o[n].id].description=l[o[n].id].description+" ► "+e.description)}t.push(l[o[n].id])}s(t)}):s([])})}else s([])})},o.prototype.updProductsInPref=function(e,t,n){var i=e?JSON.clone(e):[];if(t.addedPaths)for(let e=0;e<t.addedPaths.length;e++){var o=!1;for(let s=0;s<i.length;s++)if(i[s].id===t.addedPaths[e][0]){i[s].openDate=n,i[s].wasOpen=!0,t.addedPaths[e].length>1&&(i[s].paths||(i[s].paths=[]),i[s].paths.push(t.addedPaths[e])),o=!0;break}!1===o&&i.push({id:t.addedPaths[e][0],paths:t.addedPaths[e].length>1?[t.addedPaths[e]]:void 0,openDate:n,wasOpen:!0})}if(t.removeIds)for(let e=0;e<t.removeIds.length;e++){o=!1;for(let n=0;n<i.length;n++)if(i[n].id===t.removeIds[e]){i.splice(n,1);break}!1===o&&console.warn("RecentProductMgt.updProductsInPref unknwon Id to remove ["+t.removeIds[e]+"]")}if(t.closeIds)for(let e=0;e<t.closeIds.length;e++)for(let n=0;n<i.length;n++)if(i[n].id===t.closeIds[e]){i[n].wasOpen=!1;break}if(!0===t.removeLastOpenSession)for(let e=0;e<i.length;e++)i[e].wasOpen=!1;return i},o.prototype.getOpenNode=function(e){return{id:e.options.resourceid,paths:e.options.paths}},o.prototype.buildProductOpenParams=function(e,t){var n={};for(let o=0;o<e.length;o++)if(!0===t&&e[o].wasOpen||!t)if(e[o].paths&&e[o].paths.length)for(let t=0;t<e[o].paths.length;t++){var i=n;for(let n=0;n<e[o].paths[t].length;n++)i[e[o].paths[t][n]]||(i[e[o].paths[t][n]]={}),i=i[e[o].paths[t][n]]}else n[e[o].id]={};return n},new o}),define("DS/PADServices/utils/R2VProperties",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/PADServices/ws/WSAccess","DS/PADServices/views/private/TilesViewUtils","text!DS/PADServices/assets/init/r2vpropertiesCfg.json"],function(e,t,n,i,o,s){"use strict";const r=JSON.parse(s);function a(){return"object"==typeof a.instance?a.instance:(a.instance=this,this)}return a.prototype.getPropModel=async function(e){return new Promise((n,s)=>{t.initNLS().then(()=>{let t;e.type;(t=new Promise(t=>{i.fetchFeatureStates({serviceId:e.serviceId,ids:[e.objectId]}).then(e=>{"0"===e.infos.code&&e.result&&t(e.result)})})).then(e=>{e[0].serviceId="r2vsurvey",o.buildNodeOptions(e[0]).then(e=>{var t=this.__setPropModels(e);n(t)})})})})},a.prototype.__setPropModels=function(i){let o=require("DS/EditPropWidget/models/EditPropModel"),s=require("DS/EditPropWidget/models/EditPropAttributeModel"),a=new o({metatype:require("DS/EditPropWidget/constants/EditPropConstants").METATYPE_BUS,objectId:i.resourceid,source:"r2vsurvey",tenant:e.getPlatformId()});i.surveyId&&a.set("surveyId",i.surveyId),i.soiid&&a.set("soiid",i.soiid);let l={},d=new s;d.set("name","ds6w:label"),d.set("path","ds6w:label"),d.set("label",t.getAttNameNLS("ds6w:label")),-1!==r.positionInUI.indexOf("ds6w:label")&&d.set("positionUI",r.positionInUI.indexOf("ds6w:label")+""),d.set("value",i["ds6w:label"]),d.set("sectionIdentityCard","title"),l["ds6w:label"]=d,l["ds6w:what/ds6w:type_value"]=i.type;let c=Object.keys(i.grid);for(const e of c)if("owner"!==e&&-1===r.removedAttribues.indexOf(e)&&-1===e.indexOf("-original")){let o=new s;switch(o.set("name",e),o.set("path",e),o.set("label",t.getAttNameNLS(e)),-1!==r.positionInUI.indexOf(e)&&o.set("positionUI",r.positionInUI.indexOf(e)+""),e){case"ds6w:created":o.set("sectionIdentityCard","date");case"ds6w:modified":case"r2v:startedAtTime":case"r2v:endedAtTime":case"r2v:firstObsDate":case"r2v:lastObsDate":case"r2v:fsEffectivityDate":let s=new Date(i.grid[e]).toLocaleString(n.getLang());o.set("value",s);break;case"ds6w:responsible":o.set("type","person"),o.set("sectionIdentityCard","ownerName"),o.set("valueDB",i.grid.owner),o.set("value",i.grid[e]);break;case"ds6w:type":o.set("urlIcon",i.icon),o.set("valueDB",i.type),o.set("value",i.grid[e]);break;default:o.set("value",i.grid[e])}l[e]=o}return a.set(l),a.set("previewUrl",i.thumbnail),a.set("preview_url",i.thumbnail),a.set("type_icon_url",i.icon),a.set("isTransient",!0),a},new a}),define("DS/PADServices/views/private/homepage/RecentFilterMgt",["i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/ws/WSAccess","DS/PADServices/views/private/TilesViewUtils","DS/PADServices/utils/ParserUtils"],function(e,t,n,i){"use strict";function o(e){return"object"==typeof o.instance?o.instance:(o.instance=this,this)}return o.prototype.getKey=function(){return"filters"},o.prototype.convertFilter=function(e){var t=[];let n=Object.keys(e.filters);for(let i=0;i<n.length;i++){let o={id:n[i],rootProductId:e.filters[n[i]].associatedProduct,openDate:(new Date).toISOString(),wasOpen:void 0!==e.wasOpenFilters[n[i]]};t.push(o)}return t},o.prototype.retrieveFilters=function(o){return new Promise(s=>{let r=[],a=[],l={},d={};for(let e=0;e<o.length;e++)r.push(o[e].id),o[e].rootProductId&&a.push(o[e].rootProductId),l[o[e].id]=o[e];var c=function(e){return e.reduce((e,t)=>e.then(()=>(function(e){return new Promise(function(t){var o=i.parseAttributes(e.attributes);n.buildNodeOptions(o).then(e=>{l[e.resourceid]&&(e.opened=l[e.resourceid].wasOpen,e.openDate=l[e.resourceid].openDate),e.kind="filters",e.contextualMenu=[{type:"SeparatorItem"}],d[e.resourceid]=e,t()})})})(t)),Promise.resolve())};if(r.length){var p={labelPrefix:"HP-Filter-",pids:r.concat(a),data:{select_predicate:n.getFetchAttribute(),select_file:["icon","thumbnail_2d"]}};t.fetch(p).then(t=>{(t="string"==typeof t?JSON.parse(t):t).results&&t.results.length>0?c(t.results).then(()=>{var t=[];for(let n=0;n<o.length;n++)d[o[n].id]&&(o[n].rootProductId&&d[o[n].rootProductId]&&(d[o[n].id].label+=e.recent.on+d[o[n].rootProductId].label,d[o[n].id].description+=e.recent.on+d[o[n].rootProductId].description,d[o[n].id].rootProductId=o[n].rootProductId),t.push(d[o[n].id]));s(t)}):s([])})}else s([])})},o.prototype.updFiltersInPref=function(e,t,n){var i=e?JSON.clone(e):[];if(!0===t.added)for(let e=0;e<t.filterIds.length;e++){var o=!1;for(let s=0;s<i.length;s++)if(i[s].id===t.filterIds[e]){i[s].rootProductId=t.rootIds[e],i[s].openDate=n,i[s].wasOpen=!0,o=!0;break}!1===o&&i.push({id:t.filterIds[e],rootProductId:t.rootIds[e],openDate:n,wasOpen:!0})}if(t.removeIds)for(let e=0;e<t.removeIds.length;e++){o=!1;for(let n=0;n<i.length;n++)if(i[n].id===t.removeIds[e]){i.splice(n,1);break}!1===o&&console.warn("RecentFilterMgt.updFiltersInPref unknwon Id to remove ["+t.removeIds[e]+"]")}if(t.closeIds)for(let e=0;e<t.closeIds.length;e++)for(let n=0;n<i.length;n++)if(i[n].id===t.closeIds[e]){i[n].wasOpen=!1;break}if(!0===t.removeLastOpenSession)for(let e=0;e<i.length;e++)i[e].wasOpen=!1;return i},o.prototype.getOpenNode=function(e){return{id:e.options.resourceid,rootProductId:e.options.rootProductId}},o.prototype.buildFilterOpenParams=function(e,t){var n={};for(let i=0;i<e.length;i++)(!0===t&&e[i].wasOpen||!t)&&(n[e[i].id]={associatedProduct:e[i].rootProductId});return n},new o}),define("DS/PADServices/utils/R2VUtils",["DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/GlobalUtils","DS/PADServices/ws/WSAccess","DS/PADServices/views/private/TilesViewUtils"],function(e,t,n,i,o){"use strict";function s(){return"object"==typeof s.instance?s.instance:(s.instance=this,this)}return s.prototype.retrieveRecentTiles=async function(e,t,n){let o=e,s=[];for(let n=0;n<e.length;n++)s.push(t.pointClouds[e[n]].fsId);return new Promise((e,r)=>{let a=[];a.push(i.fetchSoIs({ids:o,serviceId:n})),a.push(i.fetchFeatureStates({ids:s,serviceId:n})),Promise.all(a).then(n=>{let i=0,o=n[0].result,s=n[1].result,r=[],a={};for(i=0;i<s.length;i++)a[s[i].resourceid]=s[i];for(i=0;i<o.length;i++){let e=o[i];e.label=o[i]["ds6w:label"],e.fsId=t.pointClouds[e.resourceid].fsId,e.selectedFs=a[e.fsId],r.push(e)}e(r)}).catch(r)})},new s}),define("DS/PADServices/views/private/ENXDnD",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/Utilities/Dom","DS/PADServices/utils/GlobalUtils"],function(e,t,n,i){"use strict";function o(e){return this.options=e||{},this.options=Object.assign({containerSuffix:""},this.options),this.elements={},this.__buildUX(),this.__addListeners(),this}return o.prototype.getDOM=function(){return this.elements.container},o.prototype.__buildUX=function(){this.elements.container=n.createElement("div",{id:this.options.idCmp,class:"enx-dnd "+this.options.containerSuffix}),this.elements.dndZones=[];let e=n.createElement("div",{class:"enx-dnd-dropZone dropZone1"});this.elements.dndZones.push(e);let i=n.createElement("div",{class:"enx-dnd-openInCtx dropInvite dropInvite1"}),o=n.createElement("div",{class:"enx-dnd-icon"});o.appendChild(n.generateIcon({iconName:"drag-drop ",fontIconSize:"3x",fontIconFamily:1})),i.appendChild(o);let s=n.createElement("div",{class:"enx-dnd-label"});s.innerText=t.dropTarget.openInCtxTitle,i.appendChild(s),e.appendChild(i);let r=n.createElement("div",{class:"enx-dnd-dropZone dropZone2"});this.elements.dndZones.push(r);let a=n.createElement("div",{class:"enx-dnd-open dropInvite dropInvite2"}),l=n.createElement("div",{class:"enx-dnd-icon"});l.appendChild(n.generateIcon({iconName:"drag-drop ",fontIconSize:"3x",fontIconFamily:1})),a.appendChild(l);let d=n.createElement("div",{class:"enx-dnd-label"});d.innerText=t.dropTarget.openTitle,a.appendChild(d),r.appendChild(a);let c=n.createElement("div",{class:"enx-dnd-dropZone dropZone3"});this.elements.dndZones.push(c);let p=n.createElement("div",{class:"enx-dnd-openFilter dropInvite dropInvite3"}),u=n.createElement("div",{class:"enx-dnd-icon"});u.appendChild(n.generateIcon({iconName:"filter-open",fontIconSize:"3x",fontIconFamily:1})),p.appendChild(u);let h=n.createElement("div",{class:"enx-dnd-label"});h.innerText=t.dropTarget.openAndFilterTitle,p.appendChild(h),c.appendChild(p),this.elements.container.appendChild(e),this.elements.container.appendChild(r),this.elements.container.appendChild(c)},o.prototype.__addListeners=function(){function e(e){e.preventDefault(),e.stopPropagation()}this.options.main.addEventListener("dragenter",e=>-1===e.dataTransfer.types.indexOf("Files")?(this.options.dropContainer.removeAttribute("hidden"),!0):(e.dataTransfer.dropEffect="none",e.dataTransfer.effectAllowed="none",!1),!1),this.options.main.addEventListener("dragover",e=>(e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="none",e.dataTransfer.effectAllowed="none",!1)),["dragleave","drop"].forEach(t=>{this.options.main.addEventListener(t,e,!1)}),this.options.dropContainer.addEventListener("dragleave",e=>{this.options.dropContainer.setAttribute("hidden","")}),["dragenter","dragover","dragleave","drop"].forEach(t=>{this.elements.dndZones.forEach(n=>{n.addEventListener(t,e,!1)})}),["dragenter","dragover"].forEach(e=>{this.elements.dndZones.forEach(t=>{t.addEventListener(e,n,!1)})}),["dragleave","drop"].forEach(e=>{this.elements.dndZones.forEach(t=>{t.addEventListener(e,o,!1)})});var t=this;function n(e){e.target.classList.add("highlight")}function o(e){e.target.classList.remove("highlight")}function s(e){t.options.dropContainer.setAttribute("hidden","");let n,o=i.deserializeDroppedData(e);e.target.classList.contains("dropZone1")?n="WITH_CONTEXT":e.target.classList.contains("dropZone2")?n="WITHOUT_CONTEXT":e.target.classList.contains("dropZone3")&&(n="FILTER"),t.__openDropContent({behavior:n,dataTransfer:o})}this.elements.dndZones.forEach(e=>{e.addEventListener("drop",s,!1)})},o.prototype.__openDropContent=function(e){"function"==typeof this.options.openDropContent&&this.options.openDropContent(e)},o}),define("DS/PADServices/views/private/homepage/WelcomeScreen",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/views/private/ENXDnD","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","DS/Core/PointerEvents","DS/PADServices/utils/PlatformURL","DS/Controls/Button"],function(e,t,n,i,o,s,r,a,l,d,c){"use strict";const p="enx-ws";function u(e){if(this.options=e||{},this.options=Object.assign(this.options,{actionMap:{},views:{},loadedContentViews:[]}),this.elements={},this.elements.container=r.createElement("div",{class:p}),this.elements.welcome=r.createElement("div",{class:p+"-welcome"}),this.elements.container.appendChild(this.elements.welcome),this.elements.left=r.createElement("div",{class:p+"-left"}),this.elements.welcome.appendChild(this.elements.left),this.elements.main=r.createElement("div",{class:p+"-main",id:p+"-main"}),"object"==typeof this.options.backgroundImage){let e=s.getWebappsAssetUrl(this.options.backgroundImage.module,this.options.backgroundImage.asset);this.elements.main.style.backgroundImage="url("+e+")"}this.elements.welcome.appendChild(this.elements.main),this.elements.drop=r.createElement("div",{class:p+"-drop",id:p+"-drop"}),this.elements.drop.appendChild(this.__buildDropUX()),this.elements.drop.setAttribute("hidden",""),this.elements.main.appendChild(this.elements.drop),this.__addListeners()}return u.prototype.initialize=function(){return new Promise(e=>{n.loadAMDs([this.options.i18n.AMD]).then(()=>{d.getAppInfo(this.options.appId).then(t=>{this.options.appIconUrl=t.icon,this.options.title=t.title;let n=require(this.options.i18n.AMD);this.options.nls=n[this.options.i18n.key],this.__buildSidePanel(),this.options.activatedTab&&this.options.mdlEvts.publish({event:this.options.actionMap[this.options.activatedTab].event,data:this.options.actionMap[this.options.activatedTab].data}),e()})})})},u.prototype.getDOM=function(){return this.elements.container},u.prototype.__buildSidePanel=function(){let e=p+"-left-",t=r.createElement("div",{class:e+"container",id:e+"container"});this.elements.left.appendChild(t);let n=r.createElement("div",{class:e+"container-collapse",id:e+"container-collapse"});this.elements.left.appendChild(n);let i=r.createElement("div",{class:e+"title"}),o=r.createElement("div",{class:e+"icon"}),s=r.createElement("div",{class:e+"icon-img"});s.style.backgroundImage="url("+this.options.appIconUrl+")",o.appendChild(s),i.appendChild(o);let a=r.createElement("div",{class:e+"label"});a.innerText=this.options.title,i.appendChild(a);let l=r.createElement("div",{class:e+"desc"});l.innerText=this.options.nls.description,i.appendChild(l),t.appendChild(i),this.buildSidePanelCollapse.call(this,e,n);let d=r.createElement("div",{class:e+"tabs"}),c=r.createElement("div",{class:e+"tabs"});for(const e of this.options.tabs)d.appendChild(this.__buildTab(e)),c.appendChild(this.__buildTabCollapse(e));t.appendChild(d),n.appendChild(c);let u=r.createElement("div",{class:e+"btns"}),h=r.createElement("div",{class:e+"btns"});for(const e of this.options.buttons)!0!==e.deactivated&&(u.appendChild(this.__buildBtn(e)),h.appendChild(this.__buildBtn(e,!0)));t.appendChild(u),n.appendChild(h);let m=r.createElement("div",{class:e+"links"});m.appendChild(this.__buildLinks()),t.appendChild(m);let f=r.createElement("div",{class:e+"links"});return f.appendChild(this.__buildLinks()),n.appendChild(f),t},u.prototype.buildSidePanelCollapse=function(e,t){let n=r.createElement("div",{class:e+"title"}),i=r.createElement("div",{class:e+"icon"}),o=r.createElement("div",{class:e+"icon-img"});o.style.backgroundImage="url("+this.options.appIconUrl+")",i.appendChild(o),n.appendChild(i),t.appendChild(n)},u.prototype.__buildTab=function(e){let t=p+"-tab",n=r.createElement("div",{class:t,id:t+"-"+e.tabId}),i=new a;i.loadFromHelpRscFile(this.options.i18n.helpResourceFile,e.tabId),n.tooltipInfos=i;let o=r.createElement("div",{class:t+"-row"});n.appendChild(o);let s=r.createElement("div",{class:t+"-icon"});s.appendChild(r.generateIcon(e.icon)),o.appendChild(s);let d=r.createElement("div",{class:t+"-label"});d.innerText=this.options.nls[e.nlsKey],o.appendChild(d);let c=r.createElement("div",{class:t+"-chevron"});return c.appendChild(r.generateIcon({iconName:"chevron-right",fontIconFamily:1})),o.appendChild(c),n.addEventListener(l.POINTERHIT,this.__clickTabOrBtn.bind(this)),!0===e.activated&&(this.options.activatedTab=e.tabId),this.options.actionMap[e.tabId]=e.action,n},u.prototype.__buildTabCollapse=function(e){let t=p+"-tab",n=e.tabId+"-collapse",i=r.createElement("div",{class:t,id:t+"-"+e.tabId+"-collapse"}),o=new a;o.loadFromHelpRscFile(this.options.i18n.helpResourceFile,e.tabId),i.tooltipInfos=o;let s=r.createElement("div",{class:t+"-icon"});return s.appendChild(r.generateIcon(e.icon)),i.appendChild(s),i.addEventListener(l.POINTERHIT,this.__clickTabOrBtn.bind(this)),!0===e.activated&&(this.options.activatedTab=n),this.options.actionMap[n]=e.action,i},u.prototype.__buildBtn=function(e,t){let n=p+"-btn",i=new a;i.loadFromHelpRscFile(this.options.i18n.helpResourceFile,e.btnId);let o=new c({domId:n+"-"+e.btnId,label:!0!==t?this.options.nls[e.nlsKey]:void 0,icon:e.icon,emphasize:e.emphasize,fontSize:"10px",touchMode:!0});return o.getContent().addClassName(n),o.getContent().addEventListener("buttonclick",this.__clickTabOrBtn.bind(this)),o.tooltipInfos=i,this.options.actionMap[e.btnId]=e.action,o.getContent()},u.prototype.__clickTabOrBtn=function(e){let t=e.currentTarget.id.replace(p+"-tab-","").replace(p+"-btn-","");this.options.mdlEvts.publish({event:this.options.actionMap[t].event,data:Object.assign({fromTab:!0,noRefresh:!0},this.options.actionMap[t].data)})},u.prototype.__buildLinks=function(){let e=p+"-links",t=r.createElement("div",{class:e});for(const n of this.options.links){let i=r.createElement("div",{class:e+"-category",id:"link-category-"+n.id}),o=r.createElement("div",{class:e+"-category-links"});for(const t of n.links){let n=r.createElement("a",{class:e+"-category-link",id:"enx-ws-"+t.id}),i=new a;i.loadFromHelpRscFile(this.options.i18n.helpResourceFile,t.id),n.tooltipInfos=i;let s=r.createElement("div",{class:e+"-category-link-icon"});s.appendChild(r.generateIcon(t.icon)),n.appendChild(s);let d=r.createElement("div",{class:e+"-category-link-label"});d.innerText=this.options.nls[t.nlsKey],n.appendChild(d),n.addEventListener(l.POINTERHIT,()=>{if(t.action){let e=Object.assign({fromBtn:!0},t.action.data||{});this.options.mdlEvts.publish({event:t.action.event,data:e})}}),o.appendChild(n)}i.appendChild(o),1===this.options.links.length&&t.classList.add(e+"-monoCol"),t.appendChild(i)}return t},u.prototype.__buildDropUX=function(){return this.options.dropCmp=new o({main:this.elements.main,dropContainer:this.elements.drop,idCmp:"enx-hp-drop",containerSuffix:"enx-hp-drop",openDropContent:e=>{this.options.mdlEvts.publish({event:"enx-welcomescreen-drop",data:e})}}),this.options.dropCmp.getDOM()},u.prototype.__addListeners=function(){let e=this.options.mdlEvts;e.subscribe({event:"enx-welcomescreen-activate-tab"},this.__activateTab.bind(this)),e.subscribe({event:"enx-welcomescreen-set-main-container"},this.__setMainContainerBtn.bind(this)),e.subscribe({event:"enx-welcomescreen-hide-currentview"},this.__hideCurrentView.bind(this))},u.prototype.__activateTab=function(e){let t=this.elements.container.getElementsByClassName(p+"-tab");for(const n of t)n.id===p+"-tab-"+e.tabId||n.id===p+"-tab-"+e.tabId+"-collapse"?n.classList.add("activated"):n.classList.remove("activated")},u.prototype.__setMainContainerBtn=async function(e){return new Promise(t=>{if(this.options.currentView!==e.viewId){let i=Promise.resolve();this.elements[e.viewId]||(i=new Promise(t=>{n.loadAMDs([e.AMD]).then(()=>{let n=require(e.AMD);this.options.views[e.viewId]=new n(e),this.options.views[e.viewId].initialize().then(()=>{this.elements[e.viewId]=this.options.views[e.viewId].getDOM(),this.elements[e.viewId].setAttribute("hidden",null),this.elements[e.viewId].classList.add(p+"-content-view"),this.options.loadedContentViews.push(e.viewId),this.elements.main.appendChild(this.elements[e.viewId]),t()})})})),i.then(()=>{this.options.currentView&&this.elements[this.options.currentView]&&this.elements[this.options.currentView].setAttribute("hidden",""),this.options.currentView=e.viewId,this.elements[this.options.currentView].removeAttribute("hidden"),"function"==typeof this.options.views[e.viewId].retrieveObjs&&this.options.views[e.viewId].retrieveObjs(e.recent,e.noMask).then(t)})}})},u.prototype.__hideCurrentView=function(){this.options.currentView&&this.elements[this.options.currentView]&&(this.elements[this.options.currentView].setAttribute("hidden",null),this.options.currentView=null)},u}),define("DS/PADServices/views/private/ContentChooser",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/private/TilesViewUtils","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Iconbar","DS/ENOXEmptyContent/js/ENOXEmptyContent"],function(e,t,n,i,o,s,r,a,l,d,c,p,u,h){function m(e,t,n){return e.getRoots().filter(function(e){return n(e,t)})}function f(e,t){return m(e,t,function(e,t){return e.options.resourceid===t})}function v(e,t){return m(e,t,function(e,t){return e.options.grid&&e.options.grid.leaves&&-1!==e.options.grid.leaves.indexOf(t)})}function g(e,t){return m(e,t,function(e,t){return e.options.grid&&e.options.grid.associatedProduct&&e.options.grid.associatedProduct===t})}function b(e){var t=e.target;return!(!t||t.parentElement.classList.contains("disabled"))}function w(e,t,n){e[t]=n}var y,S={largeTiles:{title:t.contentChooser.bigTiles,fonticon:"view-big-tile"},tiles:{title:t.contentChooser.smallTiles,fonticon:"view-small-tile"},thumbnails:{title:t.contentChooser.smallThb,fonticon:"view-small-thb"}};return s.extend({name:"enx-contentChooser",defaultOptions:{modelEvents:null,model:null,defaultView:"tiles",view:{largeTiles:null,tiles:null,thumbnails:null},title:"",subscribeTokens:[],mapIds:{}},init:function(e){this._parent(e),y="ENXWelcomePanel-activeView-"+n.getAppId()+"-"+n.getWidgetId();this.options.model=new c({}),this.elements.container=o.createElement("div",{class:this.getClassNames()}),this.__addToolbar().inject(this.elements.container),this.elements.content=o.createElement("div",{class:this.getClassNames("-content")}).inject(this.elements.container),this["__build"+this.options.defaultView]().getContent().inject(this.elements.content),this._addSubscribe("ENXViews/ContentChooser/model/"+e.loadKey,this._modelEvent.bind(this));var t="-withoutContent";o.is(n.isWebInWinContext,"function")&&n.isWebInWinContext()&&(t="-withoutContentWebInWin"),this.elements.withoutContent=o.createElement("div",{class:this.getClassNames(t)}).inject(this.elements.container),this.elements.withoutContent.hide(),this.__buildEmptyContent()},render:function(){return this.elements.container},getModel:function(){return this.options.model},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e])},iconBarResize:function(){this.elements.iconbar.show(),this.elements.iconbar.buildOverflowMenu(),this.elements.iconbar.resize()},_addSubscribe:function(e,t){this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:e},t))},_modelEvent:function(e){switch(e.op){case"populate":var t=this;(n=this.options.model.search({match:function(e){if(!0!==e.nodeModel.options.fromCustom)return!0}})).length>0&&this.options.model.withTransactionUpdate(function(){for(var e=0;e<n.length;e++)t.options.model.removeRoot(n[e])}),this._addObjectsToModel(e.objects,e.allselected),this.options.model.getRoots().length>0&&(this.elements.withoutContent.hide(),this.elements.content.show());break;case"populateAppend":this._addObjectsToModel(e.objects,e.allselected),this.options.model.getRoots().length>0&&(this.elements.withoutContent.hide(),this.elements.content.show());break;case"update":this._updatedObjectsInModel(e);break;case"remove":this._removeObjectsInModel(e);break;case"noResult":var n;t=this;(n=this.options.model.search({match:function(e){if(!0!==e.nodeModel.options.fromCustom)return!0}})).length>0&&this.options.model.withTransactionUpdate(function(){for(var e=0;e<n.length;e++)t.options.model.removeRoot(n[e])}),0===this.options.model.getRoots().length&&(this.elements.content.hide(),this.elements.withoutContent.show());break;case"addOrRefresh":this._addOrRefresh(e.objects,e.allselected),this.options.model.getRoots().length>0&&(this.elements.withoutContent.hide(),this.elements.content.show())}},_addObjectsToModel:function(e,t){for(var n=[],i=0;i<e.length;i++){var s=o.clone(e[i]);n.push(s)}var r=this.options.model;r.withTransactionUpdate(function(){r.addRoot(n),!0===t&&r.selectAll()})},_addOrRefresh:function(e,n){var i=this.options.model;i.withTransactionUpdate(function(){for(var o=0;o<e.length;o++){var s=e[o];!0===s.loading?s=Object.assign(s,{thumbnail:p.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),label:t.welcomePanel.loading,grid:{"ds6w:type":""},loading:!0}):s.contextualMenu=[{type:"SeparatorItem"}];var r=f(i,s.resourceid);0===r.length?i.addRoot(s):1===r.length?r[0].updateOptions(s):console.warn("More than one object found")}!0===n&&i.selectAll()})},_updatedObjectsInModel:function(e){var n=this.options.model,s=e.objects,r=this,a=!0;n.withTransactionUpdate(function(){for(var l=0;l<s.length;l++){let i=s[l];if(i.escaped||(i.label=o.String.escapeHTML(i.label),i.escaped=!0),!0===e.withAllPathInfos&&i.grid){let e=i.grid["ds6w:type-original"];e||(e=i.grid["ds6w:type"]),r.options.mapIds[i.resourceid]={type:e,label:i.label,display:i.display}}a=!0;var d=f(n,s[l].resourceid);1===d.length&&(a=!1,s[l].opened,s[l].contextualMenu=[{type:"SeparatorItem"}],e.fromCustom&&(s[l].fromCustom=!0),s[l].branchLabel&&(s[l].labelUpdated=!1),(d[0].options.rootLabel||d[0].options.branchLabel)&&(d[0].options.labelUpdated=!1),d[0].updateOptions(s[l]));var c=v(n,s[l].resourceid);if(c.length){a=!1;for(var p=0;p<c.length;p++){var u=c[p].getAttributeValue("leaves");if(1===u.length){var h="UNKNOWN";s[l].grid&&s[l].grid["ds6w:identifier"]&&(h=s[l].grid["ds6w:identifier"]),c[p].updateOptions({branchLabel:s[l].label,branchIdentifier:h,loading:!1})}else{let e=u.length+t.contentChooser.branches;c[p].updateOptions({branchLabel:e,branchIdentifier:e,loading:!1})}}}var m=g(n,s[l].resourceid);if(m.length){a=!1;for(p=0;p<m.length;p++){var b="UNKNOWN";s[l].grid&&s[l].grid["ds6w:identifier"]&&(b=s[l].grid["ds6w:identifier"]),m[p].updateOptions({rootLabel:s[l].label,rootIdentifier:b,loading:!1})}}(!0!==e.withAllPathInfos&&a||e.fetchDB&&a)&&(s[l].contextualMenu=[{type:"SeparatorItem"}],s[l].item2Load||(s[l].item2Load={},s[l].item2Load[s[l].resourceid]={}),e.fromCustom&&(s[l].fromCustom=!0),n.addRoot(s[l]))}for(var w=[],y=n.getRoots(),S=[],_=0;_<y.length;_++)y[_].options.branchLabel&&!y[_].options.labelUpdated&&y[_].updateOptions({label:y[_].getLabel()+" ► "+y[_].options.branchLabel,description:y[_].options.description+" ► "+y[_].options.branchIdentifier,labelUpdated:!0}),y[_].options.rootLabel&&!y[_].options.labelUpdated&&y[_].updateOptions({label:y[_].getLabel()+t.contentChooser.onrootprod+y[_].options.rootLabel,description:y[_].options.description+t.contentChooser.onrootprod+y[_].options.rootIdentifier,labelUpdated:!0}),!0===y[_].options.loading&&(!0===e.fromDB||!0===e.readOnlyApp?S.push(y[_]):(y[_].updateOptions({label:t.contentChooser.checkOnRecent}),w.push(y[_].options.resourceid),y[_].options.grid.leaves&&(w=w.concat(y[_].options.grid.leaves)))),i.updateNode(y[_],{isWP:!0});for(;S.length;){let e=S.pop();n.removeRoot(e)}w.length&&r.options.modelEvents.publish({event:"ENXViews/ContentChooser/searchInRecent",data:{unknownIds:w}})})},_removeObjectsInModel:function(e){var t=this.options.model;t.withTransactionUpdate(function(){for(var n=0;n<e.removedOjects.length;n++){var i=f(t,e.removedOjects[n]);1===i.length?!0===e.removeFromView?i[0].updateOptions({opened:!1,contextualMenu:[{type:"SeparatorItem"}]}):t.removeRoot(i[0]):console.log("ID to remove ["+e.removedOjects[n]+" not found")}0===t.getRoots().length&&e.cbEmptyView&&e.cbEmptyView(),this.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"})}.bind(this))},__doubleClickCellHandler:function(e){var t=e.nodeModel;t&&(t.options.opened?this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}):this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[t]}}),this.options.model.unselectAll())},__openSingle:function(e){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[e]}}),this.options.model.unselectAll()},__openSingleWithFilter:function(e){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:[e],withFilter:!0}}),this.options.model.unselectAll()},__openSelected:function(){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:this.options.model.getSelectedNodes()}}),this.options.model.unselectAll()},__openSelectedWithFilter:function(){this.options.modelEvents.publish({event:"ENXViews/ContentChooser/openContent",data:{nodes:this.options.model.getSelectedNodes(),withFilter:!0}}),this.options.model.unselectAll()},__addToolbar:function(){var e=this,i="-toolbar";o.is(n.isWebInWinContext,"function")&&n.isWebInWinContext()&&(i="-toolbarWebInWin");var s,r,a=o.createElement("div",{class:e.getClassNames(i)}),l=localStorage.getItem(y);switch(l&&(this.options.defaultView=l),o.createElement("div",{class:e.getClassNames("-togglePlaceHolder")}).inject(a),o.createElement("div",{class:e.getClassNames("-title"),text:e.options.title}).inject(a),e.options.defaultView){case"thumbnails":s="view-small-thb",r=t.contentChooser.smallThb;break;case"largeTiles":s="view-big-tile",r=t.contentChooser.bigTiles;break;case"tiles":default:s="view-small-tile",r=t.contentChooser.smallTiles}var d=o.createElement("div",{class:e.getClassNames("-commands")}).inject(a),c=function(t){e.__switchView(t);var n=e.elements.iconbar.getItem("viewDropDown");n.fonticon=S[t].fonticon,n.text=S[t].title,n.elements.icon.className="fonticon fonticon-"+n.fonticon,n.tooltip.setBody(n.text);var i=n.content.options.items;for(let e=0;e<i.length;e++)i[e].name===t?i[e].selected=!0:i[e].selected=!1;e.elements.iconbar.buildOverflowMenu()},p={renderTo:d,items:[{fonticon:"open",text:t.contentChooser.open,name:"openSelected",handler:function(t){b(t)&&e.__openSelected()}},{fonticon:"filter",text:t.contentChooser.openwithfilter,name:"filterSelected",handler:function(t){b(t)&&e.__openSelectedWithFilter()}},{fonticon:"select-on",text:t.contentChooser.manageSelection,name:"selectDropDown",content:{type:"dropdownmenu",options:{items:[{fonticon:"select-on",text:t.contentChooser.selectAll,name:"selectAll",handler:function(){e.options.model.selectAll()}},{fonticon:"select-off",text:t.contentChooser.selectNone,name:"selectNone",handler:function(){e.options.model.unselectAll()}}]}}},{fonticon:"remove",text:t.contentChooser.remove,name:"removeSelected",handler:function(t){b(t)&&e.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.options.loadKey+"/remove",data:{nodes2remove:e.options.model.getSelectedNodes(),dispatch:!0}})}},{fonticon:s,text:r,name:"viewDropDown",content:{type:"dropdownmenu",options:{items:[{fonticon:"view-big-tile",text:t.contentChooser.bigTiles,name:"largeTiles",selectable:!0,selected:"largeTiles"===e.options.defaultView,handler:function(e){c("largeTiles")}},{fonticon:"view-small-tile",text:t.contentChooser.smallTiles,name:"tiles",selectable:!0,selected:"tiles"===e.options.defaultView,handler:function(e){c("tiles")}},{fonticon:"view-small-thb",text:t.contentChooser.smallThb,name:"thumbnails",selectable:!0,selected:"thumbnails"===e.options.defaultView,handler:function(e){c("thumbnails")}}]}},handler:function(e){e.target.addClassName("active"),setTimeout(()=>{document.getElementsByClassName("dropdown-menu dropdown-menu-root dropdown dropdown-root")[0].addEventListener("focusout",()=>{e.target.removeClassName("active")},!0)},100)}},{fonticon:"close",text:t.contentChooser.back2app,name:"back2app",handler:function(t){b(t)&&e.options.modelEvents.publish({event:"ENXViews/ContentChooser/closeLandingPage"})}}]};this.elements.iconbar=new u(p),this.elements.iconbar.menu.templateClassname="byPassABug";var h=function(t){for(var n=!1,i=e.options.model.getRoots(),o=0;o<i.length&&!1===n;o++)!0===i[o].options.opened&&(n=!0);var s={id:e.elements.iconbar.getItem("selectDropDown").id,disabled:0===i.length};e.elements.iconbar.menu.updateItem(s),w(t,"selectDropDown",0===i.length),function(e,t,n){for(var i=Object.keys(n),o=0;o<i.length;o++){var s=i[o];n[s]?(t.disableItem(s),0===e.length&&"viewDropDown"!==t.menu.items[o].name?t.menu.items[o].elements.container.addClassName("hideInactiveIcon"):t.menu.items[o].elements.container.removeClassName("hideInactiveIcon")):t.enableItem(s)}}(i,e.elements.iconbar,t)},m=function(){var t=!0,n=!0,i=e.options.model.getSelectedNodes(),o=!0,s=!0,r=!1,a={};t=0===i.length;for(var l=0;l<i.length&&(o||s);l++)"ENOStrRefinementSpecification"!==i[l].getAttributeValue("ds6w:type")&&"ENOStrRefinementSpecification"!==i[l].getAttributeValue("ds6w:type-original")&&!1!==i[l].options.openWithFilter||(o=!1),!0!==i[l].options.opened?s=!1:r=!0;t=!1!==s,o&&1===i.length&&!1===s&&(n=!1),w(a,"openSelected",t);var d={id:e.elements.iconbar.getItem("openSelected").id,disabled:t};e.elements.iconbar.menu.updateItem(d);var c={id:e.elements.iconbar.getItem("filterSelected").id,disabled:n};e.elements.iconbar.menu.updateItem(c),w(a,"filterSelected",n);var p={id:e.elements.iconbar.getItem("removeSelected").id,disabled:0===i.length};e.elements.iconbar.menu.updateItem(p),w(a,"removeSelected",0===i.length);var u={id:e.elements.iconbar.getItem("removeFromView").id,disabled:0===i.length||!1===r};e.elements.iconbar.menu.updateItem(u),w(a,"removeFromView",0===i.length||!1===r),h(a)};return e.options.model.getXSO().onPostAdd(m),e.options.model.getXSO().onPostRemove(m),e.options.model.getXSO().onEmpty(m),e.options.model.getModelEvents().subscribe({event:"addChild"},function(){m()}),e.options.model.getModelEvents().subscribe({event:"removeChild"},function(){m()}),m(),this._addSubscribe("ENXViews/ContentChooser/refresh",function(){m(),setTimeout(function(){e.iconBarResize()},500)}),a},__buildlargeTiles:function(){var e=this.options.view.largeTiles=new a({useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["description","contextualMenu","activeFlag"]});return e.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},e.getCustomTooltip=i.getTooltip,e.onContextualEvent=this.__onContextualEvent(),e.onCellDoubleClick(this.__doubleClickCellHandler.bind(this)),e.onDragStartCell=this.__onDragStartCell.bind(this),e.loadGridViewModel(this.options.model),e.getContent().classList.add("enx-responsive-view"),e.getContent().classList.add("large-tiles"),e},__buildtiles:function(){var e=this.options.view.tiles=new l({useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["description","contextualMenu","activeFlag"]});return e.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},e.getCustomTooltip=i.getTooltip,e.onContextualEvent=this.__onContextualEvent(),e.onCellDoubleClick(this.__doubleClickCellHandler.bind(this)),e.onDragStartCell=this.__onDragStartCell.bind(this),e.loadGridViewModel(this.options.model),e.getContent().classList.add("enx-responsive-view"),e.getContent().classList.add("tiles"),e},__buildthumbnails:function(){var e=this.options.view.thumbnails=new d({useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["description","contextualMenu","activeFlag"]});return e.selectionBehavior={unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},e.getCustomTooltip=i.getTooltip,e.onContextualEvent=this.__onContextualEvent(),e.onCellDoubleClick(this.__doubleClickCellHandler.bind(this)),e.onDragStartCell=this.__onDragStartCell.bind(this),e.loadGridViewModel(this.options.model),e.getContent().classList.add("enx-responsive-view"),e.getContent().classList.add("tiles"),e},__switchView:function(e){this.options.view[this.options.defaultView].unloadGridViewModel();var t=this.options.view[e];null===t?t=this["__build"+e]():t.loadGridViewModel(this.options.model),this.options.defaultView=e,localStorage.setItem(y,e),this.elements.content.empty(),t.inject(this.elements.content)},__onContextualEvent:function(){return{this:this,callback:function(e){var n=this;return new Promise(function(i){var o=[];if(void 0!==e.cellInfos){var s=e.cellInfos.nodeModel,r=n.options.model.getSelectedNodes().length,a=!1,l=!0;if(!0!==s.options.opened){!0!==s.options.isFilter&&!0!==s.options.isR2V&&!1!==s.options.openWithFilter&&!0!==s.options.opened&&1===r&&(a=!0),!0!==s.options.opened&&(l=!1),"Person"!==s.getAttributeValue("ds6w:type")&&"Person"!==s.getAttributeValue("ds6w:type-original")||(l=!0,a=!1);var d={type:"PushItem",icon:{iconName:"open",fontIconFamily:1},title:t.contentChooser.open,action:{this:s,callback:function(){n.__openSelected(this)}},state:!0===l?"disabled":"enabled"};if(o.push(d),a){var c={type:"PushItem",icon:{iconName:"filter",fontIconFamily:1},title:t.contentChooser.openwithfilter,action:{this:s,callback:function(){n.__openSingleWithFilter(this)}}};o.push(c)}o.push({type:"SeparatorItem"})}var p={type:"PushItem",icon:{iconName:"remove",fontIconFamily:1},title:t.contentChooser.remove,action:{this:s,callback:function(){let e=[this],t=n.options.model.getSelectedNodes();t.length&&(e=t),n.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+n.options.loadKey+"/remove",data:{nodes2remove:n.options.model.getSelectedNodes(),dispatch:!0}})}}};if(o.push(p),!0===s.options.addRemoveFromViewCtx&&!0===s.options.opened){var u={type:"PushItem",icon:{iconName:"open wux-ui-3ds-flip-vertical",fontIconFamily:1},title:t.contentChooser.removeFromViewTile,action:{this:s,callback:function(){n.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+n.options.loadKey+"/removeFromView",data:{nodes2remove:[this],dispatch:!0}})}}};o.push(u)}i(o)}else i(o)})}}},__buildEmptyContent:function(){var e=this,n=new r({label:t.welcomePanel.searchContent,emphasize:"primary"});n.getContent().addClassName(e.getClassNames("-searchForContent")),n.addEventListener("click",function(){e.options.modelEvents.publish({event:"ENXViews/ContentChooser/searchContent"})}),this.elements.emptyContent=new h({modelEvents:this.options.modelEvents,sentences:[{type:"drop",text:t.contentChooser.dropcontenthere},{type:"dom",DOMelement:n.getContent()}],fontSize:"16px",orderedListType:"none"}),this.elements.emptyContent.inject(this.elements.withoutContent)},__onDragStartCell:function(e,t){var n=t.nodeModel,i=this.options.model.getXSO().get().slice(0);if(i[0]!==n){var o=i.indexOf(n),s=i[0];i[0]=n,i[o]=s}var r=this.__dropDataFromNodes(i);return e.dataTransfer.setData("Text",JSON.stringify(r)),e.stopPropagation(),!1},__dropDataFromNodes:function(e){var t={protocol:"3DXContent",version:"1.1",source:n.getAppId(),widgetId:n.getWidgetId(),data:{items:[]}};return e.forEach(function(e){t.data.items=t.data.items.concat(this.__dropDataItem(e))}.bind(this)),t},__dropDataItem:function(e){var t=require("DS/PADServices/utils/PlatformURL"),i=[],o=e.options.paths;if(o&&o.length)for(let d=0;d<o.length;d++){var s,r,a,l=[];for(let e=0;e<o[d].length;e++)l.push({resourceid:o[d][e],type:this.options.mapIds[o[d][e]]?this.options.mapIds[o[d][e]].type:void 0}),e===o[d].length-1&&(s=o[d][e],this.options.mapIds[o[d][e]]&&(r=this.options.mapIds[o[d][e]].type,a=this.options.mapIds[o[d][e]].display?this.options.mapIds[o[d][e]].display:this.options.mapIds[o[d][e]].label));i.push({envId:t.getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:n.getSecurityContext()?n.getSecurityContext():void 0,objectId:s,objectType:r,displayName:a,path:l})}else{let o=e.getReferenceValue("ds6w:type-original");o||(o=e.getReferenceValue("ds6w:type")),i.push({envId:t.getPlatformId(),serviceId:e.options.serviceId?e.options.serviceId:"3DSpace",contextId:n.getSecurityContext()?n.getSecurityContext():void 0,objectId:e.options.resourceid,objectType:o,displayName:e.options.display?e.options.display:e.getLabel()})}return i}})}),define("DS/PADServices/utils/DictionaryMgt",["UWA/Promise","DS/PADServices/ws/WSAccess","DS/PADServices/utils/PlatformURL","DS/PADServices/utils/DictionaryAccess","DS/PADServices/utils/Storage","DS/PADServices/utils/ClassificationAttributes"],function(e,t,n,i,o,s){"use strict";var r={},a=null,l={buildIconUrl:function(e){return null===a&&(a=n.get3DSpaceURL()+"/snresources/images/icons/small/"),e?a+e+".png":""},getNLSForTypes:function(e){var t=e.replace("ds6wg:","");return r.typesInfo[t]?r.typesInfo[t].displayName:r.extensions[t]?r.extensions[t].nlsName:r.automaticExtensions[t]?r.automaticExtensions[t].nlsName:t},getTypesInfo:function(n,s){return new e(function(e){var a=function(t,n){t="string"==typeof t?JSON.parse(t):t,void 0===n&&o.sess.set("AttWizard/TypesInfo-1",t);var s=Object.getOwnPropertyNames(t),a={"ds6w:type":s};i.retrieveNLS({nlsData:a}).then(function(n){for(var i=0;i<s.length;i++)n["ds6w:type"][s[i]]?t[s[i]].displayName=n["ds6w:type"][s[i]]:t[s[i]].displayName=s[i],t[s[i]].iconUrl=l.buildIconUrl(t[s[i]].IconName);e(t),r.typesInfo=t})};!0===s?(o.sess.del("AttWizard/TypesInfo"),t.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:n.baseTypes}).then(a)):d("AttWizard/TypesInfo").then(a).catch(function(){t.getTypeInfo({url_parameters:{parentInfo:!0,$select:"IconName"},body:n.baseTypes}).then(a)})})},interfaces:function(n,i){return new e(function(e){var s=function(t,n){t="string"==typeof t?JSON.parse(t):t,void 0===n&&o.sess.set("AttWizard/InterfacesInfo-1",t);for(var i={},s={},a=t.results,l=0;l<a.length;l++)for(var d=a[l].name,c=0;c<a[l].interfaces.length;c++)a[l].interfaces[c].automatic&&"yes"===a[l].interfaces[c].automatic.toLowerCase()||a[l].interfaces[c].name.startsWith("XP_")&&a[l].interfaces[c].name.endsWith("_Ext")?(void 0===s[a[l].interfaces[c].name]&&(s[a[l].interfaces[c].name]=a[l].interfaces[c],s[a[l].interfaces[c].name].declareIn=[]),s[a[l].interfaces[c].name].declareIn.push(d)):(void 0===i[a[l].interfaces[c].name]&&(i[a[l].interfaces[c].name]=a[l].interfaces[c],i[a[l].interfaces[c].name].declareIn=[]),i[a[l].interfaces[c].name].declareIn.push(d));e({extensions:i,automaticExtensions:s}),r.extensions=i,r.automaticExtensions=s};!0===i?(o.sess.del("AttWizard/InterfacesInfo"),t.interfaces({url_parameters:{},onlyCustomer:n.onlyCustomer,data:{classes:n.classes}}).then(s)):d("AttWizard/InterfacesInfo").then(s).catch(function(){t.interfaces({url_parameters:{},onlyCustomer:n.onlyCustomer,data:{classes:n.classes}}).then(s)})})},__getAllDBAttributes:function(n,i){return new e(function(e,o){t.getFullDictionary().then(function(t){function o(e){var t,n,i=s.get(e),o=(t=d[e],n=t.Name,"Yes"===t.Basic&&"Yes"===t.Local||(n=t.Owner&&t.Owner.length>0?"attribute["+t.Owner+"."+n+"]":"attribute["+n+"]"),n);if(i)i.has(o)||i.add(o);else{var r=new Set([o]);s.set(e,r)}}var s=new Map;(t="string"==typeof t?JSON.parse(t):t)&&t.Dictionary&&t.Dictionary.Types||e(s);for(var r=new Set,a=0;a<n.length;++a){var l=n[a];if(!r.has(l)&&t.Dictionary.Types[l]){r.add(l);var d=t.Dictionary.Types[l].Attributes;Object.keys(d).forEach(function(e){o(e)});var c=t.Dictionary.Types[l].Parent;c&&""!==c&&c.length&&n.push(c)}}for(var p in i){var u=i[p];d=t.Dictionary.Interfaces[u].Attributes;Object.keys(d).forEach(function(e){o(e)})}e(s)},function(){o()})})},getPropertiesForClass:function(t,n){var o=this;return new e(function(a,l){var d=[i.getPropertiesForClass(t)];n&&d.push(o.__getAllDBAttributes(t.types,t.interfaces)),e.all(d).then(function(n){for(var o=n[0],l=n[1],d={},c=0;c<o.length;c++)for(var p=o[c],u=0;u<p.properties.length;u++){var h=p.properties[u];if(l){var m=h.originCuri;-1!==m.indexOf("ds6wg:")&&(m=m.replace("ds6wg:","")),h.dbAttrName=[],l.has(m)&&(h.dbAttrName=Array.from(l.get(m)))}if(void 0===d[h.curi])d[h.curi]=h,d[h.curi].inTypes=[p.classInfo.curi];else if(d[h.curi].inTypes.push(p.classInfo.curi),l){d[h.curi].dbAttrName;var f=h.dbAttrName;for(var v in f){var g=f[v];-1===d[h.curi].dbAttrName.indexOf(g)&&d[h.curi].dbAttrName.push(g)}}}var b=new e(function(e){s.getClassificationAttributes().then(function(t){if(t&&t.length>0)for(var n=0;n<t.length;n++)for(var i=t[n],o=0;o<i.properties.length;o++){var s=i.properties[o];void 0===d[s.curi]?(d[s.curi]=s,d[s.curi].inTypes=[i.classInfo.curi]):d[s.curi].inTypes.push(i.classInfo.curi)}e()}).catch(function(t){e()})}),w=[];if(w.push(b),(void 0===t.queryTypeNLS||!0===t.queryTypeNLS)&&void 0===d["ds6w:type"]){d["ds6w:type"]={curi:"ds6w:type",label:"ds6w:type",dataType:"string"};var y=new e(function(e){i.getResourcesInfo(["ds6w:type"]).then(function(t){UWA.is(t,"array")&&1===t.length&&(d["ds6w:type"]=UWA.merge(t[0],d["ds6w:type"])),e()})});w.push(y)}e.all(w).then(function(){a({availaibleAttributes:d}),r.availaibleAttributes=d})})})},getAllTypes:function(){return new e(function(e,n){function i(e,t){var n=e.name,i=t.name;return n.localeCompare(i)}var o={getNLS:!0};t.getFullDictionary(o).then(function(t){(t="string"==typeof t?JSON.parse(t):t)&&t.Dictionary&&t.Dictionary.Types&&t.DictionaryNLS||n();var o={},s={},a=[];Object.keys(t.Dictionary.Types).forEach(function(e){var n=t.DictionaryNLS["Type."+e];s[e]={displayName:n,parent:t.Dictionary.Types[e].Parent},a.push({type:e,name:n})}),r.typesInfo=s,o.res=s,a.sort(i),o.types=function(e){for(var t=[],n=0,i=e.length;n<i;++n)t.push(e[n].type);return t}(a),e(o)},function(){n()})})}},d=function(t){return new e(function(e,n){var i=o.sess.get(t+"-1");i?setTimeout(function(){e(i,!0)},10):n()})};return l}),define("DS/PADServices/views/private/MoreAttributesWizard",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/PADServices/utils/GlobalUtils","DS/PADServices/views/private/WizardSteps","text!DS/PADServices/assets/init/MoreAttrWizardSteps.json","DS/PADServices/views/private/SearchInput","DS/PADServices/views/private/Iconbar","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils"],function(e,t,n,i,o,s,r,a,l,d,c,p,u,h,m,f,v,g){"use strict";var b=JSON.parse(a),w={properties:[function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}}]},y={"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"},S=["ds6w:globalType"];return i.extend({name:"more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,onlyCustomer:!0,maps:{referenceTypes:[],instanceTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&(this.mandatorySelected&&-1!==this.mandatorySelected.indexOf(e.nodeModel.getReferenceValue("attrName"))?t=!1:this.mandatorySelectedWithParent&&this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent]&&-1!==this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent].indexOf(e.nodeModel.getReferenceValue("attrName"))&&(t=!1)),t}},{dataIndex:"attrParent",editableFlag:!1,width:30,sortableFlag:!0,resizableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel.options.grid.attrParent?e.nodeModel.options.grid.attrParent:"Unknown"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!0}}},{dataIndex:"tree",text:t.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e)},_realInit:function(){var e=this,t=s.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";e.elements.container=n.createElement("div",{class:e.getClassNames(t)}),e.instanceMgt=e.options.baseInstanceTypes&&e.options.baseInstanceTypes.length>0,e._buildBody().then(e._buildFooter.bind(e)).done(function(){e.switchView(b.activeStep),e.options.subscribeTokens.push(e.options.modelEvents.subscribe({event:"ENXViews/WizardSteps/stepChanged"},function(t){var n=t.stepId;e.switchView(n)})),e.options.modelEvents.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:e.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy();var t=this;Object.keys(t.options.grids).forEach(function(e){t.options.grids[e].destroy(),t.options.grids[e]=null}),this._parent()},_buildBody:function(){var e=this;return new o(function(t,i){e.elements.wizard=n.createElement("div",{class:e.getClassNames("-wizard")}).inject(e.elements.container),e.options.wizard=new r({modelEvents:e.options.modelEvents,renderTo:e.elements.wizard,steps:b});var o=n.createElement("div",{class:e.getClassNames("-toolbar-container")}).inject(e.elements.container);e.elements.content=n.createElement("div",{class:e.getClassNames("-content")}).inject(e.elements.container),e._generateToolbar({renderTo:o}),t()})},_buildFooter:function(){var e=this;return new o(function(i,o){e.elements.footer=n.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container);var s=e.elements.nextButton=new p({label:t.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});s.addEventListener("click",function(){if("typesView"===e.options.activeView)e.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===e.options.activeView)e.options.modelEvents.publish({event:"ENXViews/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===e.options.activeView){var t=e.options.models.attributesView.search({match:function(e){return!0===e.nodeModel.options.grid.attrSel}}).map(function(e){return e.dump(w)}),n=[].concat(e.options.selectedExtensions).concat(e.options.automaticExtensions);e.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:t,selectedTypes:e.options.selectedTypes,selectedExtensions:n}}),e.destroy()}}),s.inject(e.elements.footer);var r=e.elements.closeButton=new p({label:t.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});r.addEventListener("click",function(){e.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/closeWizard"}),e.destroy()}),r.inject(e.elements.footer),i()})},switchView:function(e){if(this.options.activeView!==e)if(this.elements.toolbarSearch.clear(),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){(c=this.elements.content.getElement("div.more-attr-chooser-view"))&&this.elements.content.removeChild(c),n.is(this.elements.loader)||(this.elements.loaderDiv=n.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new u).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.elements.loader.on();var t=this,i=[],s=null,r=0,a=b.steps.length;do{b.steps[r].id===e&&(s=b.steps[r]),r++}while(r<a||null===s);var l=!1;if(s.prerequisiteViews)for(var d=0;d<s.prerequisiteViews.length;d++)null===this.options.views[s.prerequisiteViews[d]]&&(i.push(this["_build"+s.prerequisiteViews[d]](!0)),l=!0);o.all(i).then(function(){if(!0===l){var n=this.elements.content.getElement("div.more-attr-chooser-view");n&&this.elements.content.removeChild(n)}this["_build"+e]().then(function(e){t.elements.loaderDiv.addClassName("hidden"),t.elements.loader.off(),t.elements.nextButton.disabled=!1,t.options.wizard.getContent().removeClassName("disabled"),t.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:t.options.activeView}})})}.bind(this))}else{var c;(c=this.elements.content.getElement("div.more-attr-chooser-view"))&&this.elements.content.removeChild(c),this.options.views[e].inject(this.elements.content);t=this;!0===this.typesUpdated&&"extensionsView"===this.options.activeView?this.__updateExtensionsView().then(function(){delete t.typesUpdated,t.extensionsUpdated=!0,t.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:t.options.activeView}})}):!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView?this.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}}):this.__updateAttributesView().then(function(){delete t.typesUpdated,delete t.extensionsUpdated,t.options.modelEvents.publish({event:"ENXViews/MoreAttributesWizard/viewReady",data:{activeView:t.options.activeView}})})}},_buildtypesView:function(){var e=this;return new o(function(i,o){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;e.options.wizard.getContent().addClassName("disabled"),e.options.views.typesView=n.createElement("div",{class:e.getClassNames("-typesView more-attr-chooser-view")});var r=n.createElement("div",{class:e.getClassNames("-typesViewDgv more-attr-dgv-container")}).inject(e.options.views.typesView),a=n.extend({identifier:"MoreAttrWizard-"+s.uid()},n.clone(e.options.dgvOptions));!0!==e.instanceMgt&&a.columns.splice(1,1),a.layout=new v(e.options.dgvLayoutOptions);var l=e.options.grids.typesView=new f(a);!0===e.instanceMgt&&e._declareInstRefTypeReps(l),l.onContextualEvent=function(){return[]},l.getCellTooltip=function(n){var i=e.options.grids.typesView.getColumnOrGroup(n.columnID).dataIndex;if(n.dataIndex=i,-1===n.rowID)return{shortHelp:t.moreAttributesWizard[i],updateModel:!1}}.bind(this),l.mandatorySelected=e.options.defaultTypes,e.options.models.typesView=new h({}),l.treeDocument=e.options.models.typesView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(r),e.options.views.typesView.inject(e.elements.content),l.onReady(function(){e.__updateTypesViewModel().finally(function(){l.getContent().removeClassName("loading"),i()}),l.addEventListener("change",e._changeType.bind(e))})})},_changeType:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){var i=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedTypes.indexOf(i);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedTypes.push(i):-1!==o&&this.options.selectedTypes.splice(o),this.typesUpdated=!0}},_buildextensionsView:function(){var e=this;return new o(function(i,o){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;e.options.wizard.getContent().addClassName("disabled"),e.options.views.extensionsView=n.createElement("div",{class:e.getClassNames("-extensionsView more-attr-chooser-view")});var r=n.createElement("div",{class:e.getClassNames("-extensionsView-Dgv more-attr-dgv-container")}).inject(e.options.views.extensionsView),a=n.extend({identifier:"MoreAttrWizard-"+s.uid()},n.clone(e.options.dgvOptions));!0!==e.instanceMgt&&(a.columns.splice(1,1),!0!==e.options.dgv&&a.columns.push({icon:{iconName:"where-used",fontIconFamily:1},dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),a.layout=new v(e.options.dgvLayoutOptions);var l=e.options.grids.extensionsView=new f(a);if(!0===e.instanceMgt)e._declareInstRefTypeReps(l);else if(!0!==e.options.dgv){var d={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};l.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d))}l.onContextualEvent=function(){return[]},l.getCellTooltip=function(n){var i=e.options.grids.extensionsView.getColumnOrGroup(n.columnID).dataIndex;return n.dataIndex=i,-1===n.rowID?{shortHelp:t.moreAttributesWizard[i],updateModel:!1}:!0===e.instanceMgt&&n.nodeModel?{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:n.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),l.mandatorySelected=e.options.defaultExtensions,e.options.models.extensionsView=new h({}),l.treeDocument=e.options.models.extensionsView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(r),e.options.views.extensionsView.inject(e.elements.content),l.onReady(function(){e.__updateExtensionsViewModel(!0).finally(function(){l.getContent().removeClassName("loading"),i({})}),l.addEventListener("change",e._changeExtension.bind(e))})})},_changeExtension:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){var i=t.nodeModel.getReferenceValue("attrName"),o=this.options.selectedExtensions.indexOf(i);!0===t.nodeModel.options.grid.attrSel?-1===o&&this.options.selectedExtensions.push(i):-1!==o&&this.options.selectedExtensions.splice(o),this.extensionsUpdated=!0}},_buildattributesView:function(){var e=this;return new o(function(i){e.elements.nextButton.label=t.moreAttributesWizard.done,e.elements.nextButton.disabled=!0;e.options.wizard.getContent().addClassName("disabled"),e.options.views.attributesView=n.createElement("div",{class:e.getClassNames("-attributesView more-attr-chooser-view")});var o=n.createElement("div",{class:e.getClassNames("-attributesView-Dgv more-attr-dgv-container")}).inject(e.options.views.attributesView),r=n.extend({identifier:"MoreAttrWizard-"+s.uid()},n.clone(e.options.dgvOptions));e.instanceMgt||(r.columns.splice(1,1),!0!==e.options.dgv&&r.columns.push({text:t.moreAttributesWizard.declaredIn,dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),r.layout=new v(e.options.dgvLayoutOptions);var a=e.options.grids.attributesView=new f(r);if(!e.instanceMgt&&!0!==e.options.dgv){var l={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};a.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(l))}a.onContextualEvent=function(){return[]},a.getCellTooltip=function(n){var i=e.options.grids.attributesView.getColumnOrGroup(n.columnID).dataIndex;if(n.dataIndex=i,-1===n.rowID)return{shortHelp:t.moreAttributesWizard[i],updateModel:!1};if(n.nodeModel){var o=n.nodeModel.getReferenceValue("attrInTypeNLS");if(o)return{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:o.join("\n")}),updateModel:!1}}}.bind(this),e.options.defaultAttributes.length<=0&&(e.options.defaultAttributes=["ds6w:label","ds6w:type"]),a.mandatorySelectedWithParent={Reference:e.options.defaultAttributes},e.options.models.attributesView=new h({}),a.treeDocument=e.options.models.attributesView,a.getContent().addClassName("enxdatagridview loading"),a.getContent().inject(o),e.options.views.attributesView.inject(e.elements.content),a.onReady(function(){e.__updateAttributesViewModel().then(function(){a.getContent().removeClassName("loading"),i()}),a.addEventListener("change",e._changeAttributes.bind(e))})})},_changeAttributes:function(e,t){var n=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===n.layout.getDataIndexFromColumnIndex(t.columnID)){for(var i=-1,o=0,s=this.options.selectedAttributes.length;-1===i&&o<s;)this.options.selectedAttributes[o].name===t.nodeModel.getReferenceValue("attrName")&&this.options.selectedAttributes[o].instRef===t.nodeModel.getReferenceValue("attrParent")&&(i=o),o++;!0===t.nodeModel.options.grid.attrSel?-1===i&&this.options.selectedAttributes.push({name:t.nodeModel.getReferenceValue("attrName"),instRef:t.nodeModel.getReferenceValue("attrParent")}):-1!==i&&this.options.selectedAttributes.splice(i)}},_generateToolbar:function(e){var t=this,i=g.debounce(function(e){t.options.models[t.options.activeView].withTransactionUpdate(function(){var n=e.searchStr,i=!0;t.options.filterInProgress=!0,t.options.models[t.options.activeView].search({match:function(e){!function(e,t){var n=!1,i=new RegExp(e,"i");return(i.test(t.nodeModel.options.grid.attrTitle)||i.test(t.nodeModel.getLabel()))&&(n=!0),n}(n,e)?(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide()):(e.nodeModel.show(),n.length>0&&i?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),i=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect()))}}),t.options.filterInProgress=!1}),t.options.models[t.options.activeView].getXSO().onPostAdd(function(){}),t.options.models[t.options.activeView].getXSO().onPostRemove(function(){})},500);this.elements.toolbar=n.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var o=n.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=n.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);this.elements.toolbarSearch=new l({events:{onSearch:i}}).inject(o)},__setToolbarCmds:function(e){var n,i=this,o="none",s="none",r=function(){i.options.models[i.options.activeView].withTransactionUpdate(function(){for(var e=i.options.models[i.options.activeView].getRoots(),t=o+"-"+s,n=0;n<e.length;n++)switch(t){case"none-none":e[n].show();break;case"selected-none":!0===e[n].getReferenceValue("attrSel")?e[n].show():e[n].hide();break;case"unselected-none":!1===e[n].getReferenceValue("attrSel")?e[n].show():e[n].hide();break;case"none-reference":"Instance"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"none-instance":"Reference"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"selected-reference":!0===e[n].getReferenceValue("attrSel")&&"Instance"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"selected-instance":!0===e[n].getReferenceValue("attrSel")&&"Reference"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"unselected-reference":!1===e[n].getReferenceValue("attrSel")&&"Instance"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide();break;case"unselected-instance":!1===e[n].getReferenceValue("attrSel")&&"Reference"!==e[n].getReferenceValue("attrParent")?e[n].show():e[n].hide()}}),i.options.models[i.options.activeView].getXSO().onPostAdd(function(){}),i.options.models[i.options.activeView].getXSO().onPostRemove(function(){})},a={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableTypes}),name:"reload",handler:function(e,t){i.elements.loader.on(),i.elements.loaderDiv.removeClassName("hidden"),i.options.grids.typesView.getContent().addClassName("loading"),i.elements.nextButton.disabled=!0,i.options.wizard.getContent().addClassName("disabled"),i.options.models.typesView.removeRoots(),i.__updateTypesViewModel(!0).finally(function(){i.elements.loader.off(),i.options.grids.typesView.getContent().removeClassName("loading"),i.elements.nextButton.disabled=!1,i.options.wizard.getContent().removeClassName("disabled")})}},l={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableExtensions}),name:"reload",handler:function(e,t){i.__updateExtensionsView()}},c={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableAttributes}),name:"reload",handler:function(e,t){i.__updateAttributesView()}},p={fonticon:"list-filter",text:t.moreAttributesWizard.filterRowsKind,name:"filter-kind",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"product",text:t.moreAttributesWizard.filterreference,name:"reference",selectable:!0},{fonticon:"flow-cascade",text:t.moreAttributesWizard.filterinstance,name:"instance",selectable:!0}],events:{onClick:function(e,t){var n;n=t.name,s=n,r()}}}}},u={fonticon:"filter",text:t.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:t.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:t.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,t){var n;n=t.name,o=n,r()}}}}},h={className:"divider"};if(!this.options.toolbar||this.options.toolbar.currentView!==e){if(!0===this.instanceMgt)switch(e){case"typesView":n=[a,h,p,u];break;case"extensionsView":n=[l,h,p,u];break;case"attributesView":n=[c,h,p,u]}else n=[h,u];var m={renderTo:this.elements.toolbarIconbar,items:n};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new d(m),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"flow-cascade",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Classification:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"library-books",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t){var n=this.options.selectedAttributes.filter(function(n){return n.name===e&&n.instRef===t});return n.length>1&&console.warn("Several attributes found "+JSON.stringify(n)),1===n.length},__updateTypesViewModel:function(e){var t=this;return new o(function(n){var i=function(e,i){i||(i=Object.getOwnPropertyNames(e)),t.options.models.typesView.withTransactionUpdate(function(){for(var n=0;n<i.length;n++){var o=i[n],s=e[o],r=-1!==t.options.selectedTypes.indexOf(o),a=s.parent?s.parent:o,l=-1!==t.options.baseTypes.indexOf(a)?"Reference":-1!==t.options.baseInstanceTypes.indexOf(a)?"Instance":"Unknown",d=new m({label:s.displayName,grid:{attrName:o,attrTitle:s.displayName,attrSel:r,attrParent:l},icons:[s.iconUrl]});t.options.models.typesView.addRoot(d,r?0:void 0),"Reference"===l&&-1===t.options.maps.referenceTypes.indexOf(o)&&t.options.maps.referenceTypes.push(o),"Instance"===l&&-1===t.options.maps.instanceTypes.indexOf(o)&&t.options.maps.instanceTypes.push(o)}}),n({})};if(0==t.options.baseTypes.length)c.getAllTypes().then(function(e){t.options.baseTypes=e.types,i(e.res,e.types)});else{var o=t.options.baseInstanceTypes.length?t.options.baseTypes.concat(t.options.baseInstanceTypes):t.options.baseTypes;o=o.concat(t.options.defaultExtensions),c.getTypesInfo({baseTypes:o},e).then(i)}})},__updateExtensionsView:function(){var e=this;return new o(function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.extensionsView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.extensionsView.removeRoots(),e.__updateExtensionsViewModel(!0).finally(function(){e.elements.loader.off(),e.options.grids.extensionsView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()})})},__updateExtensionsViewModel:function(e){var t=this;return new o(function(n){c.interfaces({classes:t.options.selectedTypes,onlyCustomer:t.options.onlyCustomer},e).then(function(e){for(var i=Object.getOwnPropertyNames(e.extensions),o=[],s=[],r=0;r<i.length;r++){var a=i[r],l=e.extensions[a],d=-1!==t.options.selectedExtensions.indexOf(a);d&&(o.push(a),s.push(a));for(var p={menu:[]},u="",h=!1,f=!1,v=[],g=0;g<l.declareIn.length;g++)-1!==t.options.baseTypes.indexOf(l.declareIn[g])?h=!0:-1!==t.options.baseInstanceTypes.indexOf(l.declareIn[g])&&(f=!0),t.instanceMgt||p.menu.push({type:"PushItem",title:c.getNLSForTypes(l.declareIn[g])}),-1===v.indexOf(l.declareIn[g])&&v.push(c.getNLSForTypes(l.declareIn[g]));u=!0===h&&!0===f?"Both":!0===h?"Reference":!0===f?"Instance":"Unknown";var b=new m({label:l.nlsName,grid:{attrName:l.name,attrTitle:l.nlsName,attrSel:d,declaredIn:p,attrInType:l.declareIn,attrInTypeNLS:v,attrParent:u}});t.options.models.extensionsView.addRoot(b,d?0:void 0)}var w=Object.getOwnPropertyNames(e.automaticExtensions);for(r=0;r<w.length;r++)t.options.automaticExtensions.push(w[r]);for(r=0;r<t.options.defaultExtensions.length;r++)0===t.options.defaultExtensions[r].indexOf("XP_")&&t.options.defaultExtensions[r].indexOf("_Ext")===t.options.defaultExtensions[r].length-4&&(t.options.automaticExtensions.push(t.options.defaultExtensions[r]),o.push(t.options.defaultExtensions[r]));if(s.length!==t.options.selectedExtensions.length)for(let e=t.options.selectedExtensions.length-1;e>=0;e--)-1===s.indexOf(t.options.selectedExtensions[e])&&-1===t.options.defaultExtensions.indexOf(t.options.selectedExtensions[e])&&(console.warn("MoreAttributesWizard ## Remove Not Available extension ["+t.options.selectedExtensions[e]+"]"),t.options.selectedExtensions.splice(e,1));if(o.length!==t.options.defaultExtensions.length){u="Reference";for(let e=0;e<t.options.defaultExtensions.length;e++){var y=t.options.defaultExtensions[e];if(-1===s.indexOf(y)){var S=["VPMReference"],_=(v=[c.getNLSForTypes(S[0])],p={},c.getNLSForTypes(y));b=new m({label:_,grid:{attrName:y,attrTitle:_,attrSel:!0,declaredIn:p,attrInType:S,attrInTypeNLS:v,attrParent:u}});t.options.models.extensionsView.addRoot(b,0)}}}n({})})})},__updateAttributesView:function(){var e=this;return new o(function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.attributesView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.attributesView.removeRoots(),e.__updateAttributesViewModel(!0).finally(function(){e.elements.loader.off(),e.options.grids.attributesView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()})})},__updateAttributesViewModel:function(e){var i=this;return new o(function(e){for(var o=n.clone(i.options.selectedTypes.concat(i.options.automaticExtensions).concat(i.options.selectedExtensions)),s=0;s<o.length;s++)o[s]="ds6wg:"+o[s];var r=o.join("\n");c.getPropertiesForClass({classURIs:r,types:n.clone(i.options.selectedTypes),interfaces:n.clone(i.options.automaticExtensions.concat(i.options.selectedExtensions))},i.options.dbOnlyAttributes).then(function(n){for(var s=Object.getOwnPropertyNames(n.availaibleAttributes),r=[],a=[],l=i.options.attributesToIgnore?i.options.attributesToIgnore:S,d=0;d<s.length;d++){var p=s[d],u=n.availaibleAttributes[p],h=y[p]?y[p]:p;if(-1===l.indexOf(h)){var f={menu:[]},v="",g=!1,b=!1,w=!1,_=!1,C=[],D=[],P=[],I=[],A=u.dbAttrName;if(u.inTypes)for(var x=0;x<u.inTypes.length;x++){var O=u.inTypes[x].substring(u.inTypes[x].indexOf(":")+1,u.inTypes[x].length);if(-1!==i.options.baseTypes.indexOf(O))g=!0;else if(-1!==i.options.baseInstanceTypes.indexOf(O))b=!0;else if(-1!==i.options.selectedExtensions.indexOf(O)||-1!==i.options.automaticExtensions.indexOf(O)){w=!0;var E=i.options.models.extensionsView.search({match:function(e){return e.nodeModel.getReferenceValue("attrName")===O}});if(E.length){var T=E[0].getReferenceValue("attrParent");"Reference"===T?g=!0:"Instance"===T?b=!0:"Both"===T&&(g=!0,b=!0)}}else"ClassificationAttributes"===O&&(_=!0);i.instanceMgt||-1===o.indexOf(u.inTypes[x])||f.menu.push({type:"PushItem",title:c.getNLSForTypes(u.inTypes[x])}),-1===i.options.maps.referenceTypes.indexOf(O)&&!g||-1!==C.indexOf(O)||(C.push(O),D.push(c.getNLSForTypes(u.inTypes[x])),g=!0),-1===i.options.maps.instanceTypes.indexOf(O)&&!b||-1!==P.indexOf(O)||(P.push(O),I.push(c.getNLSForTypes(u.inTypes[x])),b=!0)}if("Instance"===(v=!0===g&&!0===b?"Both":!0===g?"Reference":!0===b?"Instance":!0===w?"Extension":!0===_?"Classification":"Unknown")&&(h+="-Instance"),-1===a.indexOf(h))if("Both"===v){r.push(h);var N=h+"-Instance",M=i._checkSelected(N,"Instance"),R=new m({label:u.label,grid:{attrName:N,attrDBName:A,attrTitle:u.label,attrDesc:u.description,attrKind:u.dataType.substring(u.dataType.indexOf("#")+1),attrInType:P,attrInTypeNLS:I,declaredIn:f,attrSel:M,attrParent:"Instance"}});i.options.models.attributesView.addRoot(R,M?0:void 0),a.push(N);var L=i._checkSelected(h,"Reference"),U=new m({label:u.label,grid:{attrName:h,attrDBName:A,attrTitle:u.label,attrDesc:u.description,attrKind:u.dataType.substring(u.dataType.indexOf("#")+1),attrInType:C,attrInTypeNLS:D,declaredIn:f,attrSel:L,attrParent:"Reference"}});i.options.models.attributesView.addRoot(U,L?0:void 0),a.push(h)}else{var V,k;"Reference"===v?(V=C,k=D):"Instance"===v?(V=P,k=I):"Classification"===v&&(V=["ClassificationAttributes"],k=[t.attributesCustomization.classificationAttributes]);var F=i._checkSelected(h,v),j=new m({label:u.label,grid:{attrName:h,attrDBName:A,attrTitle:u.label,attrDesc:u.description,attrKind:u.dataType.substring(u.dataType.indexOf("#")+1),attrInType:V,attrInTypeNLS:k,declaredIn:f,attrSel:F,attrParent:v}});i.options.models.attributesView.addRoot(j,F?0:void 0),a.push(h)}}}if(!0===i.instanceMgt){h="positionMatrix-Instance",F=i._checkSelected(h,"Instance"),j=new m({label:t.attributesCustomization.instanceMatrix,grid:{attrName:h,attrTitle:t.attributesCustomization.instanceMatrix,attrDesc:"",attrKind:"string",attrInType:["VPMInstance"],attrInTypeNLS:[c.getNLSForTypes("VPMInstance")],attrSel:F,attrParent:"Instance"}});i.options.models.attributesView.addRoot(j,F?0:void 0),a.push(h)}e({})})})}})}),define("DS/PADServices/views/ENXWelcomePanel",["css!DS/PADServices/PADServices.css","i18n!DS/PADServices/assets/nls/PADServices.json","UWA/Controls/Abstract","UWA/Class/Promise","DS/Core/Core","DS/PADServices/utils/PlatformURL","DS/PADServices/views/private/ContentChooser","DS/PADServices/views/private/AppStructure","DS/PADServices/ws/WSAccess","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/ParserUtils","DS/PADServices/utils/GlobalUtils","DS/PADServices/utils/SubscriptionHolder","DS/PADServices/utils/Storage","DS/PADServices/utils/R2VUtils","DS/PADServices/views/private/TilesViewUtils","DS/WebappsUtils/WebappsUtils","DS/Utilities/Dom","DS/Tree/TreeNodeModel","DS/UIKIT/Mask","DS/Menu/Menu","DS/Utilities/UUID","DS/UIKIT/Tooltip"],function(e,t,n,i,o,s,r,a,l,d,c,p,u,h,m,f,v,g,b,w,y,S,_){"use strict";var C={actual:null,count:0},D={properties:[function(){return{property:"resourceid",value:this.options.resourceid}}]},P={WELCOME:"ENXViews/WelcomePanel/",CONTENT:"ENXViews/ContentChooser/"};Object.freeze(P);var I='flattenedtaxonomies:"types/VPMReference" OR flattenedtaxonomies:"types/VPMRepReference" OR flattenedtaxonomies:"types/ENOStrRefinementSpecification"',A="ENOStrRefinementSpecification",x="R2V_FeatureOfInterest";const O=["ds6w:label","ds6w:type","ds6wg:revision","ds6w:status","owner","ds6w:responsible","ds6w:modified","ds6w:project","ds6w:identifier"],E={isWP:!0};function T(e,t){let n=null,i=t.products||{},o=Object.getOwnPropertyNames(i),s=!1;for(let t=0;t<o.length&&!1===s;t++)o[t]===e&&(s=!0,n=o[t]);return n}function N(e){var t=[],n=Object.getOwnPropertyNames(e);if(!n.length)return null;for(var i=0;i<n.length;i++)if("opened"!==n[i]){var o=N(e[n[i]]);null===o?t.push(n[i]):UWA.is(o,"string")?t.push(o):t=t.concat(o)}return t}function M(e){var t=[],n=[],i=function(e,o){var s,r=Object.getOwnPropertyNames(e),a=r.length;for(s=0;s<a;s++){var l,d=Object.getOwnPropertyNames(e[r[s]]).length;if(0===d){var c;(c=void 0===o?[]:o.slice()).push(r[s]);var p=c.join(",");-1===n.indexOf(p)&&(n.push(p),t.push(c))}else for(l=0;l<d;l++){var u;(u=void 0===o?[]:o.slice()).push(r[s]),i(e[r[s]],u)}}};return i(e),t}function R(e,t){e.openProducts||(e.openProducts={}),e.openProducts[t]||(e.openProducts[t]={}),e.hasUpdated=!0}function L(e,t){e.openProducts||(e.openProducts={});var n=!1;return e.openProducts[t]&&(delete e.openProducts[t],n=!0),e.hasUpdated=!0,n}function U(e,t){e.openPointCloud||(e.openPointCloud={}),e.pointClouds||(e.pointClouds={});var n=!1;let i=Object.keys(e.pointClouds);for(let o=0;o<i.length;o++)i[o]===t&&e.openPointCloud[i[o]]&&(delete e.openPointCloud[i[o]],n=!0);return e.hasUpdated=!0,n}function V(e,t){return!(!e.openProducts||!e.openProducts[t])}function k(e,t){return e.filters&&e.filters[t]&&e.filters[t].opened}function F(e,t){var n=e.objectsLst;return new i(function(o,s){var r=function(e,t){var n={products:[],filters:[]},i=[],o=e.products||{},s=Object.getOwnPropertyNames(o);for(var r in i=i.concat(s),s){var a=N(o[s[r]]);if(a)for(var l=0;l<a.length;l++)-1===i.indexOf(a[l])&&i.push(a[l])}var d=e.filters||{},c=Object.getOwnPropertyNames(d);for(var p in c){var u=c[p];-1===i.indexOf(d[u].associatedProduct)&&i.push(d[u].associatedProduct)}for(l=0;l<t.length;l++)-1!==i.indexOf(t[l])&&-1===n.products.indexOf(t[l])?n.products.push(t[l]):-1!==c.indexOf(t[l])&&-1===n.filters.indexOf(t[l])&&n.filters.push(t[l]);return n}(t,e.idsNotFound),a=[];if(r.products.length){var d={pids:r.products,data:{select_predicate:O,select_file:["icon","thumbnail_2d"]}};a.push(function(e,t){return new i(function(n,i){l.fetchDB(e).then(function(e){var i=[];if((e="string"==typeof e?JSON.parse(e):e).results&&e.results.length>0)for(var o=0;o<e.results.length;o++){var s=e.results[o],r=c.parseAttributes(s.attributes);if(r.grid){var a=new Date(r.grid["ds6w:modified"]).toLocaleString(p.getLang());r.subLabel=r.grid["ds6w:responsible"]+" | "+a,r.description=r.grid["ds6w:identifier"]}r.loading=void 0,void 0!==t.mapIdStoredObjLst[r.resourceid]&&!0===t.storedObjLst[t.mapIdStoredObjLst[r.resourceid]].opened?r.opened=!0:r.opened=!1,i.push(r)}n(i)}).catch(function(t){console.error(t),i({errorCode:"notFoundAtAll",notFound:e.pids})})})}(d,n))}r.filters.length&&a.push(j({idsNotFound:r.filters})),i.all(a).then(function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(e[n]);o(t)}).catch(function(e){s(e)})})}function j(e,n){var o=e.objectsLst;return new i(function(n,i){var s=[];l.fetchFilter({data:{filterids:e.idsNotFound}}).then(function(e){if((e="string"==typeof e?JSON.parse(e):e).success)for(var r=0;r<e.success.length;r++){for(var a=e.success[r],l=Object.getOwnPropertyNames(a),d=0;d<l.length;d++){var c={resourceid:l[d],icons:[v.getWebappsAssetUrl("ENOFilterBIUX","icons/I_AdvancedFilter32.png")],thumbnail:v.getWebappsAssetUrl("ENOFilterBIUX","icons/I_AdvancedFilter144.png"),grid:{"ds6w:type":"ENOStrRefinementSpecification","ds6w:identifier":a[l[d]].filterName},label:a[l[d]].filterTitle,subLabel:t.welcomePanel.filterNotIndexYet,display:a[l[d]].filterTitle,description:a[l[d]].filterName,loading:void 0};o&&o.mapIdStoredObjLst&&void 0!==o.mapIdStoredObjLst[c.resourceid]&&!0===o.storedObjLst[o.mapIdStoredObjLst[c.resourceid]].opened?c.opened=!0:c.opened=!1,s.push(c)}n(s)}else i()}).catch(function(e){i(e)})})}function W(e,t,n){var o=e.objectsLst,s=[];if(void 0!==n.pointClouds&&n.pointClouds!=={})for(let e=o.id2retrieve.length-1;e>=0;--e)n.pointClouds[o.id2retrieve[e]]&&(s.push(o.id2retrieve[e]),delete o.mapIdStoredObjLst[o.id2retrieve[e]],o.id2retrieve.splice(e,1));var r={idsNotFound:o.id2retrieve,objectsLst:o};t.options.readOnlyApp;return new i(function(o,a){var d=e.objectsLst;(function(e,t,n){return new i(i=>{null!=n&&0!==e.length?m.retrieveRecentTiles(e,t,n).then(i).catch(i):i([])})})(s,n,t.options.pCloudServiceId).then(s=>{var p=[],u=UWA.clone(d.id2retrieve),h=function(e){return e.reduce((e,t)=>e.then(()=>(function(e){return new i(function(t){var i=e.attributes?c.parseAttributes(e.attributes):e;i.grid["ds6w:type"]===x&&(i.serviceId="r2vsurvey"),f.buildNodeOptions(i,E).then(e=>{e.loading=void 0,e.isFilter?e.opened=k(n,e.resourceid):e.isR2V?(e.opened=function(e,t){return!(!e.openPointCloud||!e.openPointCloud[t])}(n,e.resourceid),e.serviceId="r2vsurvey"):e.opened=V(n,e.resourceid),p.push(e);var i=u.indexOf(e.resourceid);-1!==i&&u.splice(i,1),t()})})})(t)),i.resolve())},m={labelPrefix:"WelcomePanel-",pids:d.id2retrieve,data:{select_predicate:O,select_file:["icon","thumbnail_2d"]}};0===d.id2retrieve.length?(s&&s.length>0&&h(s).then(()=>{if(p.length){let e={op:"update",objects:p,readOnlyApp:t.options.readOnlyApp,fromDB:!0,withAllPathInfos:!1};t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/previousContent",data:e})}}),o()):l.fetch(m).then(function(l){(l="string"==typeof l?JSON.parse(l):l).results&&l.results.length>0?(s&&s.length>0&&(l.results=l.results.concat(s)),h(l.results).then(()=>{if(p.length){let e={op:"update",objects:p,readOnlyApp:t.options.readOnlyApp,fromDB:!0,withAllPathInfos:!0};t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/previousContent",data:e})}var s=[];if(u.length)if(!0===t.options.readOnlyApp){for(var l=[],c=0;c<u.length;c++){if(d.mapIdStoredObjLst[u[c]]>=0)d.storedObjLst[d.mapIdStoredObjLst[u[c]]].grid.filterId===u[c]&&l.push(l)}l.length===u.length?(console.log("Only filter ids missing "+JSON.stringify(u)),r.idsNotFound=u,s.push(j(r).then(function(e){p=p.concat(e)}))):a({error:"No result on Index",errorCode:"resultNotFoundOnIndex",idsNotFound:u})}else r.idsNotFound=u,s.push(F(r,n).then(function(e){p=p.concat(e)}));i.all(s).then(function(){p.length&&t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:p,readOnlyApp:t.options.readOnlyApp,fromDB:!0,fetchDB:!0,withAllPathInfos:!0}}),o()}).catch(function(e){a(e)})})):!0===t.options.readOnlyApp?a({error:"No result on Index",errorCode:"resultNotFoundOnIndex",idsNotFound:d.id2retrieve}):F(r,n).then(function(n){0===n.length?t.__noResult():t.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:n,readOnlyApp:t.options.readOnlyApp,fromDB:!0,withAllPathInfos:!0}})}).catch(a)}).catch(function(e){console.error(e),a(e)})})})}function H(e,t,n,i,o){var s={id:n,text:i,tooltip:i};o&&(s.fonticon=o),t.actions.push(s)}function B(e,t,n){var i={id:t,title:n,actions:[]};return e.push(i),i}function X(e){for(var t=[],n=0;n<e.length;n++)if(e[n].section)for(var i=e[n].section,o=B(t,i.id,i.title),s=0;s<i.actions.length;s++)H(0,o,i.actions[s].id,i.actions[s].title,i.actions[s].icon);else e[n].id&&e[n].actions&&t.push(UWA.clone(that.options.activities[n]));return t}var z=n.extend({name:"enx-welcome-panel",defaultOptions:{wpUUID:null,defaultActionId:null,defaultSearchTemplate:null,defaultAttributesJSON:"DS/PADServices/assets/init/AttributesMgt.json",welcomePanelState:"opened",openStack:{openContent:null,removeContent:null,openProxy:null,removeProxy:null,launchAction:null},appReady:!1,proxyReady:!1,readOnlyApp:!0,subscriptions:[]},init:function(e){this._parent(e),this.options.wpUUID="enwwp-"+S.v4(),void 0===this.options.storedObjects&&(this.options.storedObjects={products:{},filters:{},pointClouds:{}}),"string"==typeof this.options.globalSearchPrecond&&(I=this.options.globalSearchPrecond),this.options.isTransient=void 0!==window.widget&&-1!==window.widget.id.indexOf("preview"),this.options.isTransient&&window.widget.setValue("autoreloadPreview","true"),this.subcriptionHolder=new u(e.modelEvents)},initialize:function(){var e=this;return new i(function(t,n){!1===e.options.wpActivated?t():require(["DS/ENOXTriptych/js/ENOXTriptych","DS/PADServices/utils/AttributesMgtV2"],function(n,o){o.initialize({defaultAttributesJSON:e.options.defaultAttributesJSON}).then(function(){s.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){e.elements.container=UWA.createElement("div",{class:e.getClassNames()});var o=e.options.modelEvents,s={title:e.options.appTitle,description:e.options.description,container:e.elements.container,modelEvents:o};if(void 0===e.options.activities)s=UWA.extend(s,e._defaultWelcomePanel({}),!0);else{if(s.defaultActionId=e.options.defaultActionId,s.activities=[],e.options.description){var r=e.options.description,l={id:"appDescriptionRoot",title:e.options.appTitle,description:r,className:"appTitle"};s.appDescription=l}s.footer=e.options.footer,e._buildActivities(s.activities,e.options.activities)}e.options.customOpenControllerClass&&(e._openController=new e.options.customOpenControllerClass);let c=i.resolve(),u="true"===p.getURLParameter("dndDivEvo");u&&(c=e.__setDnDDivEvolution()),c.then(function(){let i=e.elements.container;u&&(i=e.options.dropDiv.getContentDiv());var r={modelEvents:e.options.modelEvents,container:i,withtransition:!0,left:{originalState:"open"}},l=X(s.activities);s.activities=l;e.elements.leftPlaceHolder=UWA.createElement("div",{class:e.getClassNames("-welcomeLeft")});s.modelEvents=e.options.modelEvents;var c=e.options.triptych=new n;c.init(r,null,void 0,null,s);var h=e.options.welcomePanel=c.welcomePanel;e.triptychTooltip=e._setTooltipForTriptychToggleButton(c._mainPanel.children,"Collapse"),e.options.modelEvents.subscribe({event:"welcome-panel-expanded"},function(t){c._mainPanel&&(e.triptychTooltip=e._setTooltipForTriptychToggleButton(c._mainPanel.children,"Collapse"))}),e.options.modelEvents.subscribe({event:"welcome-panel-collapsed"},function(t){c._mainPanel&&(e.triptychTooltip=e._setTooltipForTriptychToggleButton(c._mainPanel.children,"Expand"))}),e.subcriptionHolder.subscribe({event:P.WELCOME+"maskWP"},function(){e.mask()}),e.subcriptionHolder.subscribe({event:P.WELCOME+"appReady"},function(){e.options.appReady=!0,e.unmask(),e.options.openStack.closeLandingPage&&(e.options.openStack.closeLandingPage(),delete e.options.openStack.closeLandingPage),null!==e.options.openStack.openContent&&(e.__launchOpenMdlEvts(e.options.openStack.openContent),e.options.openStack.openContent=null),null!==e.options.openStack.removeContent&&(e.__launchRemoveMdlEvts(e.options.openStack.removeContent),e.options.openStack.removeContent=null),null!==e.options.openStack.launchAction&&(e.__launchAction(e.options.openStack.launchAction),e.options.openStack.launchAction=null),e.unmask()}),e.subcriptionHolder.subscribe({event:P.WELCOME+"cleanup"},e._cleanup.bind(e)),e.subcriptionHolder.subscribe({event:P.WELCOME+"loadData"},function(){var t=a.retrieveData(e.options.structKey),n=a.buildReloadList(t);let i=a.getWidgetBool("autoreload"),o=a.getWidgetBool("autoreloadPreview");if(e.options.isTransient||window.widget.deleteValue("autoreloadPreview"),(e.options.autoreload||o||i)&&n.hasLoad)e.options.modelEvents.publish({event:P.WELCOME+"activate"}),e.mask(),n.mode="welcome",n.fromAutoReload=!0,e.__launchOpenMdlEvts(n),e.unmask();else{var s="undefined"==typeof widget||widget.getValue("showWelcomePanel"),r="boolean"==typeof s?s:!s||(d=!1,"boolean"==typeof(l=s)?d=l:"string"==typeof l&&(d="true"===l.toLowerCase()),d);let t="boolean"==typeof e.options.closeRequested&&e.options.closeRequested;delete e.options.closeRequested,r&&!t&&e.options.modelEvents.publish({event:P.WELCOME+"activate"})}var l,d}),e.subcriptionHolder.subscribe({event:"welcome-panel-action-selected"},function(e){o.publish({event:P.WELCOME+"action/"+e.id,data:{id:e.id}})}),e.options.defaultActionId&&(h.selectAction(e.options.defaultActionId),e.options.modelEvents.publish({event:"welcome-panel-action-selected",data:{id:e.options.defaultActionId}})),e.subcriptionHolder.subscribe({event:"ENXApp/possibleTenantChange"},function(t){e._possibleTenantChange=!0}),d.subscribe({event:"ENXApp/cancelTenantChange"},function(t){delete e._possibleTenantChange}),e.subcriptionHolder.subscribe({event:"ENXApp/SettingsModification/onX3dPlatformId"},function(t){"OnPremise"!==t&&e.options.appReady&&(delete e._possibleTenantChange,e.tenantChange())}),e.subcriptionHolder.subscribe({event:"ENXModel/Nodes/modified"},e.__updateWPNode.bind(e)),e.elements.triptych=e.elements.container.querySelector(".triptych-container"),e.elements.triptych.classList.add("enx-welcome-shell");var m=e.elements.container.querySelector(".triptych-left");e._hookCleanup=p.hookTransitionEnd(m,function(t){e.elements.previousContent&&e.elements.previousContent.iconBarResize()}),e.subcriptionHolder.subscribe({event:P.CONTENT+"openContent"},function(t){for(var n={mode:"welcome",products:{},filters:{},pointClouds:[]},i=t.nodes,o=!1,s=[],r=0;r<i.length;r++){var a=i[r];let t=a.getReferenceValue("ds6w:type-original")?a.getReferenceValue("ds6w:type-original"):a.getReferenceValue("ds6w:type");t===A?(o=!0,n.filters=UWA.extend(n.filters,a.options.item2Load)):t===x?(o=!0,n.pointClouds.push({serviceId:a.options.serviceId,displayName:a.options.label,objectId:a.options.fsId,objectType:a.options.selectedFs.type,path:[{resourceid:a.options.fsId,type:a.options.selectedFs.type}]})):a.options.fromCustom?(e._openController&&e._openController.processOpenType(n,a.dump(D)),s.push(a.options.resourceid)):(o=!0,n.products=UWA.extend(n.products,i[r].options.item2Load))}if(o){if(n.products){let e=Object.keys(n.products);for(let t=0;t<e.length;t++){let i=n.products[e[t]];i.associatedProduct&&delete i.associatedProduct}}void 0!==t.withFilter&&(n.withFilter=t.withFilter),e.__launchOpenMdlEvts(n)}s&&e.options.modelEvents.publish({event:P.WELCOME+"customObjOpen",data:{customitem2open:s}})}),e.subcriptionHolder.subscribe({event:"ENXViews/WelcomePanel/setAction"},function(t){e.options.welcomePanel.selectAction(t)}),e.subcriptionHolder.subscribe({event:P.WELCOME+"openedObject"},function(t){switch(t.kind){case"products":var n=t.addedPaths.length,i=e.options.storedObjects,o=[];for(u=0;u<n;u++){var s=i.products,r=0,a=t.addedPaths[u].length;for(r=0;r<a;r++)if(s.hasOwnProperty(t.addedPaths[u][r])||(s[t.addedPaths[u][r]]={}),s=s[t.addedPaths[u][r]],0===r){var l=t.addedPaths[u][r];o.push({resourceid:l,opened:!0}),R(i,t.addedPaths[u][r])}}e._updateStoredList({loadKey:"previousContent"});break;case"filters":if(t.addedFilters.filters)for(var d=Object.getOwnPropertyNames(t.addedFilters.filters),c=0;c<d.length;c++){var p=d[c];e.options.storedObjects.filters[p]?e.options.storedObjects.filters[p].opened=!0:(e.options.storedObjects.filters[p]=t.addedFilters.filters[p],e.options.storedObjects.filters[p].opened=!0,e.options.storedObjects.hasUpdated=!0)}e._updateStoredList({loadKey:"previousContent"});break;case"pointclouds":i=e.options.storedObjects;e.options.pCloudServiceId&&e.options.pCloudServiceId===t.serviceId||(e.options.pCloudServiceId=t.serviceId),(s=i.pointClouds).hasOwnProperty(t.soiId)||(s[t.soiId]={opened:!0}),s[t.soiId].fsId=t.fsId,s[t.soiId].toUpdate=!0,function(e,t,n){e.openPointCloud||(e.openPointCloud={}),e.openPointCloud[t]=n,e.hasUpdated=!0}(i,t.soiId,s[t.soiId],t.serviceId),e._updateStoredList({loadKey:"previousContent"});break;case"roots":var u;n=t.openedIds.length,i=e.options.storedObjects,o=[];for(u=0;u<n;u++){s=i.products;var h=i.filters;r=0,a=t.openedIds[u].length;for(r=0;r<a;r++){l=t.openedIds[u][r];o.push({resourceid:l,opened:!0}),R(i,t.openedIds[u][r])}for(d=Object.getOwnPropertyNames(h),c=0;c<d.length;c++){h[p=d[c]].associatedProduct===t.openedIds[u][0]&&(e.options.storedObjects.filters[p].opened=!0,e.options.storedObjects.hasUpdated=!0)}}break;case"deleteRoots":for(var m=0;m<t.removeIds.length;m++)e.options.storedObjects.products[t.removeIds[m]]?delete e.options.storedObjects.products[t.removeIds[m]]:e.options.storedObjects.filters[t.removeIds[m]]?delete e.options.storedObjects.filters[t.removeIds[m]]:e.options.storedObjects.pointClouds&&e.options.storedObjects.pointClouds[t.removeIds[m]]&&delete e.options.storedObjects.pointClouds[t.removeIds[m]],L(e.options.storedObjects,t.removeIds[m]),e.options.storedObjects.hasUpdated=!0;e._updateStoredList({loadKey:"previousContent",removedFromViewIds:t.removeIds,removeFromStore:!0});break;case"removeFromView":e._removeObjectFromView({item2remove:t.removedFromViewIds,dispatch:t.dispatch})}}),u||e.__setDnDBehavior(),e.__setupCrossWidgetCommunication().then(function(){t()})})})})})})},addUpdateTooltip:function(e,t){return this.triptychTooltip&&this.triptychTooltip.destroy(),new _({position:"right",target:e,body:t})},_setTooltipForTriptychToggleButton:function(e,t){if(Symbol.iterator in Object(e)){let n=Array.from(e).filter(e=>e.className.includes("triptych-wp-toggle-btn"));if(n.length)return this.addUpdateTooltip(n[0],t)}},render:function(){return"opened"===this.options.welcomePanelState&&setTimeout(function(){this.options.modelEvents.publish({event:"triptych-set-size",data:{size:300,side:"left"}}),this.options.modelEvents.publish({event:"triptych-show-panel",data:"left"})}.bind(this),10),this.elements.container},destroy:function(){this.subcriptionHolder.destroy(),this.options.cmdProxy&&this.options.cmdProxy.destroy(),this._hookCleanup&&this._hookCleanup(),this.options.triptych.destroy(),this.elements.previousContent&&(this.elements.previousContent.destroy(),delete this.elements.previousContent,this.elements.previousContent=null),this.elements.container.getParent()&&this.elements.container.getParent().removeChild(this.elements.container),delete this.elements.container,this.elements.container=null},setCurrentLoadRequest:function(e){this._currentLoadRequest=e},tenantChange:function(e){var t=this.elements.previousContent.options.model.getRoots().map(function(e){return e.options.resourceid});t.length&&d.publish({event:P.WELCOME+"cleanup",data:{item2remove:t}})},_defaultWelcomePanel:function(e){var t={defaultActionId:null,activities:[]};if(this.options.defaultActionId=this.options.defaultActionId?this.options.defaultActionId:"previousContent",t.defaultActionId=this.options.defaultActionId,this.options.description){var n=this.options.description,i={id:"appDescriptionRoot",title:this.options.appTitle,description:n,className:"appTitle"};t.appDescription=i}t.footer=this.options.footer;var o=z.getDefaultActivities();return this._buildActivities(t.activities,o.activities),this.options.extraActivities&&t.activities.push(this.options.extraActivities),t},_buildActivities:function(e,n){for(var i=this,o=0;o<n.length;o++){var s=n[o],r={};if(s.section){r.section={id:s.section.id,title:s.section.title,actions:[]};for(var a=0;a<s.section.actions.length;a++){var l=s.section.actions[a],d={};if("string"==typeof l)switch(l){case"searchContent":d={id:"searchContent",title:t.welcomePanel.searchContent,icon:"open"},i.subcriptionHolder.subscribe({event:P.WELCOME+"action/searchContent"},function(){var e=I;i.options.customize&&i.options.customize.searchFilter&&(e=i.options.customize.searchFilter),i._launchSearch({title:t.welcomePanel.searchContent,showApplyButton:!0,applyButton_Nls:t.welcomePanel.applyWithFilter,precondition:"",fts_value:e})});break;case"previousContent":d={id:"previousContent",title:t.welcomePanel.previousContent,icon:"clock"};i.subcriptionHolder.subscribe({event:P.WELCOME+"action/previousContent"},i._previousContent.bind(i));break;case"availableproducts":d={id:"availableproducts",title:t.welcomePanel.availableproducts,icon:"3dproduct-open"};i.subcriptionHolder.subscribe({event:P.WELCOME+"action/availableproducts"},function(){i._launchSearch({title:t.welcomePanel.availableproducts,showApplyButton:!0,applyButton_Nls:t.welcomePanel.applyWithFilter,precondition:' (flattenedtaxonomies:"types/VPMReference" OR (flattenedtaxonomies:"types/VPMRepReference"))'})});break;case"availablefilters":d={id:"availablefilters",title:t.welcomePanel.availablefilters,icon:"filter-open"};i.subcriptionHolder.subscribe({event:P.WELCOME+"action/availablefilters"},function(){i._launchSearch({precondition:' (flattenedtaxonomies:"types/ENOStrRefinementSpecification")'})});break;default:console.error("Welcome Panel: Unknown activity ["+l+"]")}else d=l;d&&r.section.actions.push(d)}}e.push(r)}return e},_previousContent:function(){var e="previousContent";this.elements.loadauto&&this.elements.loadauto.show(),this.elements.countResults&&this.elements.countResults.hide(),this.elements.back2appDiv&&this.elements.back2appDiv.show(),this.elements.previousContent||(this.elements.previousContent=new r({title:t.welcomePanel.previousContent,modelEvents:this.options.modelEvents,loadKey:e,toggleIcon:"opened"===this.options.welcomePanelState?"expand-left":"expand-right",defaultView:void 0===this.options.defaultView?"tiles":this.options.defaultView,attrInNodes:O}),this.__addContentCB({loadKey:e})),this._updateStoredList({loadKey:e}),this.options.modelEvents.publish({event:"triptych-set-content",data:{side:"middle",content:this.elements.previousContent.render()}}),this._previousContentSubscriptions||(this.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/model/"+e+"/remove"},this._removeObjectFromStore.bind(this)),this.subcriptionHolder.subscribe({event:P.CONTENT+"model/"+e+"/removeFromView"},this._removeObjectFromView.bind(this)),this._previousContentSubscriptions=!0)},_removeObjectFromStore:function(e){if(e.nodes2remove||e.item2remove||e.customitem2remove){var t=[],n=[];if(e.nodes2remove)for(var i=0;i<e.nodes2remove.length;i++){var o=e.nodes2remove[i];if(!0===o.options.fromCustom)n.push(o.options.resourceid),t.push(o.options.resourceid);else if(o.options.item2Load)for(var s=Object.getOwnPropertyNames(o.options.item2Load),r=0;r<s.length;r++){var a=s[r];o.options.item2Load[s[r]].associatedProduct&&(a=o.options.item2Load[s[r]].associatedProduct),-1===t.indexOf(a)&&t.push(a)}}else e.item2remove&&(t=e.item2remove);e.customitem2remove&&(n=e.customitem2remove);var l,d,c=[],p=this.options.storedObjects,u=t.length;for(l=0;l<u;l++){if(p.products&&p.products.hasOwnProperty(t[l])&&(delete p.products[t[l]],c.push(t[l])),p.filters){var h=Object.getOwnPropertyNames(p.filters);for(d=0;d<h.length;d++)h[d]!==t[l]&&p.filters[h[d]].associatedProduct!==t[l]||(c.push(h[d]),delete p.filters[h[d]])}p.pointClouds&&p.pointClouds.hasOwnProperty(t[l])&&(delete p.pointClouds[t[l]],c.push(t[l]))}n.length&&(c=c.concat(n)),c.length&&(this._updateStoredList({loadKey:"previousContent",removedFromViewIds:c,removeFromStore:!0}),!1!==e.dispatch&&this.__launchRemoveMdlEvts({item2remove:t,customitem2remove:n,fromProxy:e.fromProxy,dispatch:e.dispatch}))}},_removeObjectFromView:function(e){if(e.nodes2remove||e.item2remove||e.customitem2remove){var t=[],n=[];if(e.nodes2remove)for(var i=0;i<e.nodes2remove.length;i++){var o=e.nodes2remove[i];if(!0===o.options.fromCustom)n.push(o.options.resourceid),t.push(o.options.resourceid);else if(o.options.item2Load)for(var s=Object.getOwnPropertyNames(o.options.item2Load),r=0;r<s.length;r++){var a=s[r];o.options.item2Load[s[r]].associatedProduct&&(a=o.options.item2Load[s[r]].associatedProduct),-1===t.indexOf(a)&&t.push(a)}}else e.item2remove&&(t=e.item2remove);e.customitem2remove&&(n=e.customitem2remove);var l,d,c=[],p=this.options.storedObjects,u=t.length;for(l=0;l<u;l++){var h=L(p,t[l]);if(!0===h&&c.push(t[l]),!0===(h=U(p,t[l]))&&c.push(t[l]),p.filters){var m=Object.getOwnPropertyNames(p.filters);for(d=0;d<m.length;d++)m[d]!==t[l]&&p.filters[m[d]].associatedProduct!==t[l]||!0===p.filters[m[d]].opened&&(c.push(m[d]),delete p.filters[m[d]].opened)}}n.length&&(c=c.concat(n)),c.length&&(this._updateStoredList({loadKey:"previousContent",removedFromViewIds:c,removeFromView:!0}),!1!==e.dispatch&&this.__launchRemoveFromViewMdlEvts({item2remove:t,customitem2remove:n,fromProxy:e.fromProxy,dispatch:e.dispatch}))}},_smartUpdateList:function(){if(this.options.storedObjects.hasUpdated)this.options.storedObjects.hasUpdated=!1,this._updateStoredList({loadKey:"previousContent"});else{for(var e=[],t=this.elements.previousContent.options.model.getRoots(),n=0;n<t.length;n++){var i=t[n];if(!0!==i.options.fromCustom){var o=i.options.resourceid,s=i.options.opened;s||(s=!1);var r=i.options.grid&&i.options.grid["ds6w:type"]===A;i.options.opened=r?k(this.options.storedObjects,o):V(this.options.storedObjects,o),s!==i.options.opened&&e.push({resourceid:o,opened:i.options.opened})}}e.length>0&&this.elements.previousContent._updatedObjectsInModel({objects:e})}},_updateStoredList:function(e){var n=this;if(this._possibleTenantChange)setTimeout(function(){n._updateStoredList(e)},500);else if(e.removedFromViewIds&&e.removedFromViewIds.length&&e.removeFromStore)n.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"remove",removedOjects:e.removedFromViewIds,removeFromView:e.removeFromView,removeFromStore:e.removeFromStore,cbEmptyView:n.__noResult.bind(n)}});else{var i=this.options.storedObjects;delete i.hasUpdated;var o=function(e,n,i,o){for(var s=[],r=[],a={},l=e.products||{},d=e.openProducts||{},c=Object.getOwnPropertyNames(l),p=0;p<c.length;p++){if("undefined"===c[p])continue;n&&-1!==n.indexOf(c[p])&&delete l[c[p]].opened;let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===c[p])return!0}});if(e=1===e.length?e[0]:null){if(d[(y=e.options).resourceid]?(e.updateOptions({opened:!0}),y.opened=!0):(e.updateOptions({opened:!1}),y.opened=!1),!0===i&&!0===y.loading){let e=y.paths?y.paths:[];for(let t=0;t<e.length;t++){var u=e[t];for(let e=0;e<u.length;e+=2)-1===r.indexOf(u[e])&&r.push(u[e])}y.paths=e}}else{(y={resourceid:c[p],grid:{rootId:c[p],leaves:N(l[c[p]])},opened:l[c[p]].opened||!1,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[c[p]]=l[c[p]];var h=M(y.item2Load);if(d[y.resourceid]&&(y.opened=!0),!0===i){for(let e=0;e<h.length;e++){u=h[e];for(let e=0;e<u.length;e+=2)-1===r.indexOf(u[e])&&r.push(u[e])}y.paths=h}else if(-1===r.indexOf(c[p])&&r.push(c[p]),y.grid.leaves)for(var m=0;m<y.grid.leaves.length;m++)-1===r.indexOf(y.grid.leaves[m])&&r.push(y.grid.leaves[m])}s.push(y),a[y.resourceid]=s.length-1}for(var f=e.filters||{},g=Object.getOwnPropertyNames(f),b=0;b<g.length;b++){if("undefined"===g[b])continue;var w=g[b];let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===w)return!0}});(e=1===e.length?e[0]:null)&&!0!==e.options.loading?(y=e.options,e.updateOptions({opened:f[w].opened}),y.opened=f[w].opened,s.push(y)):((y={resourceid:w,grid:{filterId:w,associatedProduct:f[w].associatedProduct},opened:f[w].opened,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[w]=f[w],s.push(y),a[y.resourceid]=s.length-1,-1===r.indexOf(w)&&r.push(w))}if(l={},e.pointClouds)if(!0===Array.isArray(e.pointClouds))for(let t=0;t<e.pointClouds.length;t++)l[e.pointClouds]={};else l=e.pointClouds;var y,S=e.openPointCloud||{},_=e.pointClouds||{};for(c=Object.getOwnPropertyNames(l),p=0;p<c.length;p++){if("undefined"===c[p])continue;n&&-1!==n.indexOf(c[p])&&delete l[c[p]].opened;let e=o.search({match:function(e){if(e.nodeModel.options.resourceid===c[p])return!0}});(e=1===e.length?e[0]:null)?(S[(y=e.options).resourceid]?(e.updateOptions({opened:!0}),y.opened=!0):(e.updateOptions({opened:!1}),y.opened=!1),!0===i&&(!0===y.loading||_[c[p]]&&!0===_[c[p]].toUpdate)&&(void 0!==S[c[p]]&&delete S[c[p]].toUpdate,r.push(c[p]))):((y={resourceid:c[p],grid:{rootId:c[p]},opened:l[c[p]].opened,thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/loading.gif"),item2Load:{},label:t.welcomePanel.loading,loading:!0}).item2Load[c[p]]=l[c[p]],S[y.resourceid]&&(y.opened=!0),-1===r.indexOf(c[p])&&r.push(c[p])),s.push(y),a[y.resourceid]=s.length-1}return{id2retrieve:r,storedObjLst:s,mapIdStoredObjLst:a}}(i,e.removedFromViewIds,!0,this.elements.previousContent.getModel());if(o.storedObjLst.length)if(n.options.modelEvents.publish({event:P.CONTENT+"model/"+e.loadKey,data:{op:"populate",objects:o.storedObjLst,allselected:!1}}),o.id2retrieve.length){var s={objectsLst:o,loadKey:e.loadKey},r={success:!1,retriedExceeded:!1,retryCounter:0},a=function(){W(s,n,i).then(function(e){r.success=!0,n.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"})}).catch(function(i){var s;r.retryCounter++,r.retryCounter<3?a():i&&"resultNotFoundOnIndex"===i.errorCode?(p.displayNotif({level:"error",message:t.errors.objetNotFoundOnIndex,sticky:!0,key:"WP-objetNotFoundOnIndex"}),n.__launchRemoveMdlEvts({item2remove:i.idsNotFound}),n.__noResult()):i&&"notFoundAtAll"===i.errorCode?(s=i.notFound,n.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"remove",removedOjects:s,readOnlyApp:n.options.readOnlyApp,cbEmptyView:n.__noResult.bind(n)}})):(r.retriedExceeded=!0,function(){for(var i=[],s=UWA.clone(o.id2retrieve),r=0;r<s.length;r++)i.push({resourceid:s[r],label:t.welcomePanel.notLoaded,subLabel:t.welcomePanel.notLoaded,icons:["attention"],thumbnail:v.getWebappsAssetUrl("PADServices","icons/32/I_Warn.png"),loading:!1});n.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:i,readOnlyApp:n.options.readOnlyApp}}),p.displayNotif({level:"error",title:t.errors.cannotFetchAttributesTitle,message:t.errors.cannotFetchAttributes,sticky:!0,key:"WP-cannotFetchAttributes"})}())})};a()}else n.options.modelEvents.publish({event:"ENXViews/ContentChooser/refresh"});else n.__noResult()}},__noResult:function(){this.options.modelEvents.publish({event:P.CONTENT+"model/previousContent",data:{op:"noResult"}})},__addContentCB:function(e){var n=this;n.subcriptionHolder.subscribe({event:P.CONTENT+"toggleClicked"},function(e){!0===n.options.mobileTriptych?("opened"===n.options.welcomePanelState?n.options.welcomePanelState="reduced":"reduced"===n.options.welcomePanelState&&(n.options.welcomePanelState="opened"),n.options.modelEvents.publish({event:"triptych-toggle-panel",data:"left"})):"opened"===n.options.welcomePanelState?(n.options.welcomePanelState="reduced",n.options.modelEvents.publish({event:"welcome-panel-collapse"})):"reduced"===n.options.welcomePanelState&&(n.options.welcomePanelState="opened",n.options.modelEvents.publish({event:"welcome-panel-expand"}))}),n.subcriptionHolder.subscribe({event:"welcome-panel-collapse"},function(){var e=document.querySelector(".triptych-left");p.hookTransitionEnd(e,function(){n.elements.previousContent.iconBarResize()}),n.options.modelEvents.publish({event:"triptych-set-size",data:{size:40,side:"left"}}),n.options.modelEvents.publish({event:"triptych-show-panel",data:"left"}),n.options.modelEvents.publish({event:P.CONTENT+"toggleIcon",data:{iconName:"expand-right",fontIconFamily:WUXManagedFontIcons.Font3DS}})}),n.subcriptionHolder.subscribe({event:"welcome-panel-expand"},function(){var e=document.querySelector(".triptych-left");p.hookTransitionEnd(e,function(){n.elements.previousContent.iconBarResize()}),n.options.modelEvents.publish({event:"triptych-set-size",data:{size:300,side:"left"}}),n.options.modelEvents.publish({event:"triptych-show-panel",data:"left"}),n.options.modelEvents.publish({event:P.CONTENT+"toggleIcon",data:{iconName:"expand-left",fontIconFamily:WUXManagedFontIcons.Font3DS}})}),p.isMobileDevice()&&(n.subcriptionHolder.subscribe({event:"triptych-entering-mobile"},function(){n.options.mobileTriptych=!0,n.options.modelEvents.publish({event:"welcome-panel-expand"})}),n.subcriptionHolder.subscribe({event:"triptych-leaving-mobile"},function(){n.options.mobileTriptych=!1,n.options.welcomePanelState="reduced",n.options.modelEvents.publish({event:"welcome-panel-collapse"})})),n.subcriptionHolder.subscribe({event:"triptych-panel-hidden"},function(e){"left"===e&&n.options.modelEvents.publish({event:P.CONTENT+"toggleIcon",data:{iconName:"expand-right",fontIconFamily:WUXManagedFontIcons.Font3DS}})}),n.subcriptionHolder.subscribe({event:P.CONTENT+"closeLandingPage"},function(){let e=function(){n.options.modelEvents.publish({event:P.WELCOME+"closeLandingPage"}),n.options.closeRequested=!0};!1===n.options.appReady?(n.options.openStack.closeLandingPage=e,n.mask()):e()}),n.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/searchContent"},function(){var e=I;n.options.customize&&n.options.customize.searchFilter&&(e=n.options.customize.searchFilter),n._launchSearch({title:t.welcomePanel.searchContent,showApplyButton:!0,applyButton_Nls:t.welcomePanel.applyWithFilter,precondition:"",fts_value:e})}),n.subcriptionHolder.subscribe({event:"ENXViews/ContentChooser/searchInRecent"},function(i){var o={pids:i.unknownIds,data:{select_predicate:["ds6w:label","ds6w:description","ds6w:type","ds6w:responsible","ds6w:identifier","ds6w:modified"],select_file:["icon","thumbnail_2d"]}};!0!==n.options.readOnlyApp?l.fetchDB(o).then(function(i){var o=[];if(i.results)for(var s=0;s<i.results.length;s++){var r=i.results[s],a=c.parseAttributes(r.attributes);if(a.grid){var l=new Date(a.grid["ds6w:modified"]).toLocaleString(p.getLang());a.subLabel=a.grid["ds6w:responsible"]+" | "+l,a.description=a.grid["ds6w:identifier"]+" ► "+t.welcomePanel.notFoundOnIndex}a.loading=void 0,o.push(a)}n.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/"+e.loadKey,data:{op:"update",objects:o,readOnlyApp:n.options.readOnlyApp,fromDB:!0}})}).catch(function(){console.warn("Search in DB failed")}):console.warn("Search in DB not suuported in read-Only apps")})},__setDnDBehavior:function(){this.elements.container.addEventListener("dragenter",this.__onDragEnter.bind(this)),this.elements.container.addEventListener("dragover",this.__onDragOver.bind(this)),this.elements.container.addEventListener("dragleave",this.__onDragLeave.bind(this)),this.elements.container.addEventListener("dragend",this.__onDragEnd.bind(this)),this.elements.container.addEventListener("drop",this.__onDrop.bind(this));var e=p.isWebInWinContext()?"-dropAreaWebInWin":"-dropArea",n=this.elements.droparea=UWA.createElement("div",{class:this.getClassNames(e)}).inject(this.elements.container);n.hide();for(var i=[{id:"addInCtx",icon:"drag-drop",title:t.welcomePanel.addObjectInCtx},{id:"addObject",icon:"drag-drop",title:t.welcomePanel.addObject},{id:"filter",icon:"filter",title:t.welcomePanel.filter}],o=0;o<i.length;o++){var s=UWA.createElement("div",{class:this.getClassNames("-dropZoneGlobal "+i[o].id),draggable:!1}),r=UWA.createElement("div",{class:this.getClassNames("-dropZone "+i[o].id),draggable:!1}).inject(s),a=UWA.createElement("div",{class:this.getClassNames("-dropIconAndText "+i[o].id)}).inject(r);UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-"+i[o].icon)}).inject(a),UWA.createElement("h5",{class:this.getClassNames("_txt "+i[o].id),text:i[o].title}).inject(a),s.inject(n)}},__onDragEnter:function(e){var t=g.firstParentWithClass(e.target,"enx-welcome-panel-dropZoneGlobal");if(0===C.count)this.elements.triptych.style.opacity="0.2",this.elements.droparea.show();else if(t){var n=t.querySelector(".enx-welcome-panel-dropZone");C.actual!==n&&(C.actual&&C.actual.classList.remove("zoneHighlighted"),n.classList.add("zoneHighlighted"),C.actual=n)}return C.count++,e.stopPropagation(),!1},__onDragOver:function(e){return g.firstParentWithClass(e.target,"enx-welcome-panel-dropZoneGlobal")&&e.preventDefault(),e.stopPropagation(),!1},__onDragLeave:function(e){return C.count--,0===C.count&&(this.elements.droparea.hide(),this.elements.triptych.style.opacity="1"),e.target===C.actual&&(C.actual.classList.remove("zoneHighlighted"),C.actual=null),e.stopPropagation(),!1},__onDragEnd:function(e){return C.count=0,C.actual&&(C.actual.classList.remove("zoneHighlighted"),C.actual=null),this.elements.droparea.hide(),this.elements.triptych.style.opacity="1",e.stopPropagation(),!1},__onDrop:function(e){if(C.count=0,this.elements.droparea.hide(),this.elements.triptych.style.opacity="1",e.stopPropagation(),!e.defaultPrevented){e.preventDefault();var t="WITH_CONTEXT";if(C.actual)C.actual.classList.contains("addObject")?t="WITHOUT_CONTEXT":C.actual.classList.contains("filter")&&(t="FILTER"),C.actual.classList.remove("zoneHighlighted"),C.actual=null;else{var n=g.firstParentWithClass(e.target,"enx-welcome-panel-dropZoneGlobal");n.classList.contains("addObject")?t="WITHOUT_CONTEXT":n.classList.contains("filter")&&(t="FILTER")}var i={mode:"drop",behavior:t,unserializedData:p.deserializeDroppedData(e)};this.__launchOpenMdlEvts(i)}return!1},_launchSearch:function(e){var t=this,n=function(e,n){var i={mode:"welcome",products:{},filters:{},pointClouds:[],unserializedData:{}},o={items:[]};if(e.length>0){for(var s=[],r=0;r<e.length;r++){var a=e[r]["ds6w:type_value"]?e[r]["ds6w:type_value"]:e[r]["ds6w:type"],l={resourceid:e[r].resourceid,label:e[r]["ds6w:label"],grid:{"ds6w:type":a},item2Load:{}};l.item2Load[e[r].resourceid]={},s.push(new b(l));var d={};d.objectId=e[r].resourceid,d.objectType=a,d.displayName=e[r]["ds6w:label"],d.displayType=e[r]["ds6w:type"],d.serviceId="3DSpace",o.items.push(d)}for(r=0;r<s.length;r++)s[r].getAttributeValue("ds6w:type")===A?i.filters=UWA.extend(i.filters,s[r].options.item2Load):s[r].getAttributeValue("ds6w:type")===x?i.pointClouds.push({serviceId:s[r].options.serviceId,displayName:s[r].options.label,objectId:s[r].options.fsId,objectType:s[r].options.selectedFs.type,path:[{resourceid:s[r].options.fsId,type:s[r].options.selectedFs.type}]}):i.products=UWA.extend(i.products,s[r].options.item2Load);i.unserializedData.protocol="3DXContent",i.unserializedData.data=o,i.withFilter=n,t.__launchOpenMdlEvts(i)}return i},i=function(e){e&&(t.options.storedObjects=UWA.merge(t.options.storedObjects,e)),t.options.welcomePanel.selectAction("previousContent")};void 0!==e.precondition&&require(["DS/PADServices/utils/SearchUtils"],function(o){var s={parent_window:t.options.odtSpecificParentWindow,title:e.title,precond:e.precondition,fts_value:e.fts_value,search_criteria_to_display:"",showApplyButton:e.showApplyButton,applyButton_Nls:e.applyButton_Nls,callback:function(e){var t=n(e);i(t)},apply:function(e){var t=n(e,!0);i(t)},cancel:i};o.inAppsSearch(s)})},__setupCrossWidgetCommunication:function(){var e=this;return new i(function(t){require(["DS/PADServices/utils/CommandProxy"],function(n){e.options.cmdProxy=n.create({events:{onLoadStoredObj:function(t,n){if(y.hide(),n.originWidgetId!==p.getWidgetId()){if(e._currentLoadRequest&&UWA.equals(e._currentLoadRequest,t))return void e.setCurrentLoadRequest(null);t.fromProxy=!0,!1===e.options.appReady?(e.options.openStack.openContent=t,e.mask()):e.options.modelEvents.publish({event:"ENXViews/WelcomePanel/openContent",data:t})}},onRemoveStoredObj:function(t,n){y.hide(),n.originWidgetId!==p.getWidgetId()&&(t.fromProxy=!0,!1===e.options.appReady?(e.options.openStack.removeContent=t,e.mask()):e._removeObjectFromStore(t))},onRemoveObjFromView:function(t,n){y.hide(),n.originWidgetId!==p.getWidgetId()&&(t.fromProxy=!0,e._removeObjectFromView(t))},onAppProxyReady:function(t,n){n.originWidgetId!==p.getWidgetId()&&(e.options.proxyReady=!0,!0===e.options.handshakeDone&&t.wpUUID===e.options.partnerUUID||(e.options.partnerUUID=t.wpUUID,e.options.handshakeDone=!0,e.options.cmdProxy.appProxyReady({wpUUID:e.options.wpUUID})),null!==e.options.openStack.openProxy&&(e.options.cmdProxy.loadStoredObj(e.options.openStack.openProxy),e.options.openStack.openProxy=null),null!==e.options.openStack.removeProxy&&(e.options.cmdProxy.removeStoredObj(e.options.openStack.removeProxy),e.options.openStack.removeProxy=null))},onUpdatePreviousContent:function(t,n){!0!==t.fromProxy&&(t.fromProxy=!0,e.__updateWPNode(t))}}}),e.options.cmdProxy.appProxyReady({wpUUID:e.options.wpUUID}),t()})})},__launchOpenMdlEvts:function(e){y.hide(),!1===this.options.appReady?(this.options.openStack.openContent=e,this.mask()):(this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/openContent",data:e}),!e.fromAutoReload&&this.options.cmdProxy&&!0!==e.fromProxy&&(!1===this.options.proxyReady?this.options.openStack.openProxy=e:this.options.cmdProxy.loadStoredObj(e)))},__launchRemoveMdlEvts:function(e){y.hide();!1===this.options.appReady?(this.options.openStack.removeContent=e,this.mask()):(this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:e}),this.options.cmdProxy&&!0!==e.fromProxy&&(!1===this.options.proxyReady?this.options.openStack.removeProxy=e:this.options.cmdProxy.removeStoredObj(e)))},__launchRemoveFromViewMdlEvts:function(e){y.hide();this.options.modelEvents.publish({event:"ENXViews/WelcomePanel/removeFromView",data:e}),this.options.cmdProxy&&!0!==e.fromProxy&&e.dispatch&&this.options.cmdProxy.removeObjFromView(e)},__launchAction:function(e){y.hide();var t=this;require(["DS/ApplicationFrame/CommandsManager"],function(n){var i=n.getCommand(e.command);i&&(!0===e.unselectBeforeLaunch&&t.options.modelEvents.publish({event:"ENXViews/WelcomePanel/unselectAllInModel"}),i.begin(),t.options.modelEvents.publish({event:"ENXViews/WelcomePanel/closeLandingPage"}))})},_cleanup:function(e){var t=require("DS/PADServices/utils/GlobalModelEvents");t.publish({event:"ENXViews/WelcomePanel/removeFromStored",data:{item2remove:e.item2remove}}),t.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:e.item2remove}}),this.options.cmdProxy.removeStoredObj({item2remove:e.item2remove})},_addOrRefresh:function(e){this.options.modelEvents.publish({event:P.CONTENT+"model/previousContent",data:{op:"addOrRefresh",objects:e.objects,allselected:!1}})},mask:function(e){w.mask(this.elements.container,e||t.welcomePanel.appLoading)},unmask:function(){w.unmask(this.elements.container)},__updateWPNode:function(e){let t=[],n=[];for(let i=0;i<e.modifiedIds.length;i++){let o=T(e.modifiedIds[i],this.options.storedObjects);o&&(t.push(o),-1===n.indexOf(o)&&n.push(o))}if(t.length){e.fromProxy||this.options.cmdProxy.updatePreviousContent(e);let l={};var o=[],s=this.options.storedObjects;for(let t=0;t<e.fetchAnswer.results.length;t++){let n=c.parseAttributes(e.fetchAnswer.results[t].attributes);l[n.resourceid]=n}var r=this;(a=t,a.reduce((t,r)=>t.then(()=>(function(t){return new i(function(i){var r=l[t];r?f.buildNodeOptions(r,E).then(t=>{t.loading=void 0,t.isFilter?t.opened=k(s,t.resourceid):t.opened=V(s,t.resourceid),o.push(t),!0===e.fromProxy&&-1!==n.indexOf(t.resourceid)&&d.publish({event:"ENXModel/Root/sync",data:{tileId:t.resourceid,nodeOpts:t}}),i()}):i()})})(r)),i.resolve())).then(()=>{if(o.length){let e={op:"update",objects:o,readOnlyApp:r.options.readOnlyApp,fromDB:!0,withAllPathInfos:!0};r.options.modelEvents.publish({event:"ENXViews/ContentChooser/model/previousContent",data:e})}})}var a}});return z.getDefaultActivities=function(e){return e&&"1.0"===e.version?{defaultActionId:"previousContent",activities:[{section:{id:"newActivity",title:t.welcomePanel.newActivity,actions:["searchContent"]}},{section:{id:"contentSection",title:t.welcomePanel.content,actions:["previousContent","availableproducts","availablefilters"]}}]}:{defaultActionId:"previousContent",activities:[{section:{id:"contentSection",title:t.welcomePanel.content,actions:["previousContent","searchContent","availableproducts","availablefilters"]}}]}},z.launchSearch=function(e){require(["DS/PADServices/utils/SearchUtils"],function(t){var n={parent_window:e.odtSpecificParentWindow,title:e.title,precond:e.precondition,search_criteria_to_display:e.search_criteria_to_display?e.search_criteria_to_display:"",fts_value:e.fts_value,showApplyButton:e.showApplyButton,applyButton_Nls:e.applyButton_Nls,callback:e.ok,apply:e.apply,cancel:function(t){e.modelEvts&&e.modelEvts.publish({event:"ENXViews/WelcomePanel/setAction",data:"previousContent"})}};t.inAppsSearch(n)})},z}),define("DS/PADServices/views/LandingPage",["css!DS/PADServices/PADServices","DS/PADServices/views/ENXWelcomePanel","UWA/Class/Promise","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/SubscriptionHolder","DS/PADServices/utils/GlobalUtils","DS/WebappsUtils/WebappsUtils","DS/PADServices/views/private/AppStructure","i18n!DS/PADServices/assets/nls/PADServices.json","DS/UIKIT/Mask"],function(e,t,n,i,o,s,r,a,l,d){"use strict";function c(e){var t=!1;return UWA.is(e,"boolean")?t=e:UWA.is(e,"string")&&(t="true"===e.toLowerCase()),t}function p(e){e=e||{},this.options=UWA.extend({widget:null,welcome:null,viewer:null,injectedView:null,onLandingPageReady:null,readOnlyApp:!0,renderDiv:null,structKey:"xsceneStoredObjects",subscriptions:[],ready:{viewerReady:!1,appReady:!1}},e,!0),a.setWidget(this.options.widget),a.migratePrevData(this.options.structKey)}return p.prototype={initialize:function(){var e=this;return new n(function(n){require(["DS/PADServices/utils/PlatformURL"],function(d){d.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){e._buildDOM(),e._globalSubscriptionHolder=new o(i.getModelEvents());var d=e.options.widget.getValue("xsceneStoredObjects");"xsceneStoredObjects"===s.getURLParameter("cleanSetting")?(e.options.widget.deleteValue("xsceneStoredObjects"),d=a.retrieveData(e.options.structKey)):d=a.retrieveData(e.options.structKey);var p=e.options.widget.getValue("showWelcomePanel"),u="boolean"==typeof p?p:!p||c(p),h=c(e.options.widget.getValue("autoreload")),m=void 0,f={odtSpecificParentWindow:e.options.odtSpecificParentWindow,modelEvents:i.getModelEvents(),storedObjects:d,pCloudServiceId:d.pCloudServiceId||"r2vsurvey",appTitle:e.options.appTitle,description:e.options.description,readOnlyApp:e.options.readOnlyApp,defaultAttributesJSON:"DS/ENOPAD3DViewer/assets/json/AttributesMgt.json",globalSearchPrecond:e.options.globalSearchPrecond,defaultActionId:e.options.defaultActionId,structKey:e.options.structKey,autoreload:h};e.options.activities&&(f.activities=e.options.activities),e.options.extraActivities&&(f.extraActivities=e.options.extraActivities),e.options.customHandlerClass&&(e._customHandler=new e.options.customHandlerClass({loadingNls:l.welcomePanel.loading,loadingIcon:r.getWebappsAssetUrl("PADServices","icons/32/loading.gif")}),e.__customizeSetup()),e.options.customOpenControllerClass&&(f.customOpenControllerClass=e.options.customOpenControllerClass),e.options.customize&&(f.customize=UWA.clone(e.options.customize));let v=function(){e.__switchView("welcome")};e.options.welcome=new t(f),e.options.welcome.initialize().then(function(){e.options.onLandingPageReady&&e.options.onLandingPageReady.call(null,d),!0===u&&(!1===h?v():e.hasObjectToLoad(d).then(function(e){e||v()}.bind(e)));var t=i.subscribe({event:"ENXViews/WelcomePanel/appReady"},function(){i.unsubscribe(t),e.options.onReady&&e.options.onReady()});e._globalSubscriptionHolder.subscribe({event:"ENXViews/LandingPage/addOrRefresh"},function(t){e.options.welcome._addOrRefresh(t)}),e._globalSubscriptionHolder.subscribe({event:"ENXViews/LandingPage/remove"},function(t){e.options.welcome._removeObjectFromStore(t)}),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/customObjOpen"},function(e){i.publish({event:"ENXViews/LandingPage/openCustom",data:e})}),h&&(m=d,i.publish({event:"ENXViews/LandingPage/autoreload"})),n(m)})})})})},hasObjectToLoad:function(e){return new n(function(e,t,n){e&&t(a.buildReloadList(e).hasLoad);t(!1)}.bind(this,e))},setViewer:function(e,t){if(null!=e){if(this.options.viewer=e,this._viewerReady=t,this.__3DCBSetUp(),!0===t){var n=this.options.viewer.getController();if(0!==n.getNbRoots()){n._getRootLog();i.publish({event:"ENXViews/ContentChooser/openedObject",data:{nodes:n.getRoots()}})}}}else console.eror("LandingPage.setViewer : The viewer given as a parameter is empty")},render:function(){return this.options.welcome.render()},redraw:function(){this.options.welcome.render()},appReady:function(){this._setupReady("appReady")},dispose:function(){if(this.options.viewer){let e=this.options.viewer.render().getContent(),t=e.parentNode;t&&t!==this.options.renderDiv&&this.options.renderDiv.appendChild(e)}this._globalSubscriptionHolder.destroy(),this._viewerSubscriptionHolder&&this._viewerSubscriptionHolder.destroy(),this.options.welcome&&(this.options.welcome.destroy(),this.options.welcome=null),this.elements.mainBody&&this.elements.mainBody.parentElement.removeChild(this.elements.mainBody)},destroy:function(){this._viewerReady=!1,this._globalSubscriptionHolder.destroy(),this._viewerSubscriptionHolder&&this._viewerSubscriptionHolder.destroy(),this.options.viewer&&(this.options.viewer.destroy(),this.options.viewer=null),this.options.welcome&&(this.options.welcome.destroy(),this.options.welcome=null),this.elements.mainBody&&this.elements.mainBody.parentElement.removeChild(this.elements.mainBody)},_buildDOM:function(){this.elements||(this.elements={},this.elements.mainBody=UWA.createElement("div"),this.elements.mainBody.classList.add("landing-root"),this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",this.options.renderDiv.appendChild(this.elements.mainBody))},__switchView:function(e,t){e!==this.options.injectedView&&(this.initDiv||(this.initDiv={}),!0===this.options.externalViewerMgt&&"viewer"===e||!0!==this.initDiv[e]&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("landing-"+e),this.elements[e].classList.add("landing-div"),this.elements[e].classList.add("landing-hidden"),this.elements.mainBody.appendChild(this.elements[e])),this.options[e]&&this.options[e].render().inject(this.elements[e]),this.initDiv[e]=!0)),!0!==t?this._showActiveView(e):!0===this.options.externalViewerMgt&&"viewer"===e&&this.options.externalViewerMgtCB(e,t)},_showActiveView:function(e){var t=Object.keys(this.elements);this.options.injectedView=e;for(var n=0;n<t.length;n++)e===t[n]?this.elements[t[n]].classList.remove("landing-hidden"):"mainBody"!==t[n]&&this.elements[t[n]].classList.add("landing-hidden");!0===this.options.externalViewerMgt&&"function"==typeof this.options.externalViewerMgtCB&&this.options.externalViewerMgtCB(e),window.dispatchEvent(new Event("resize"))},__3DCBSetUp:function(){var e=this;this._viewerSubscriptionHolder=new o(this.options.viewer.getModelEvents());var t=e.options.viewer.subscribe({event:"onReady"},function(n){var o=c(e.options.widget.getValue("showWelcomePanel"));e.options.viewer.unsubscribe(t),!0===o?!0===n.injectInView?e.__switchView("viewer"):(e.__switchView("viewer",!0),e.__switchView("welcome")):e.__switchView("viewer"),e._viewerReady=!0,e._setupReady("viewerReady"),n.fromTransition||i.publish({event:"ENXViews/WelcomePanel/loadData"})});this._viewerSubscriptionHolder.subscriptions.push(t),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/openContent"},function(t){e.__switchView("viewer"),e.options.welcome.setCurrentLoadRequest(t),setTimeout(function(){switch(!0===t.fromProxy?(e.fromProxy=!0,t.broadcast=!1):e.fromProxy=!1,t.mode){case"welcome":e.options.viewer.openStoredObjects(t).then(function(){e.options.welcome.setCurrentLoadRequest(null)});break;case"drop":e.options.viewer.openDroppedObjects(t).then(function(t){delete e._previousFilterRootPids});break;default:console.error("Unknown mode ["+t.mode+"]"),e.__switchView("welcome")}},500)}),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/removeFromStored"},function(t){if(t.item2remove){var n=t.item2remove,o=e.options.widget.getValue("xsceneStoredObjects");if("null"===o&&(o=null),UWA.is(o,"string")){var s=e.options.viewer.getController();o=JSON.parse(o);var r,a,l=n.length,d=!1,c=[],p=[];for(r=0;r<l;r++){if(o.products&&o.products.hasOwnProperty(n[r]))s.getNode({id:n[r]})&&p.push(n[r]),c.push(n[r]),delete o.products[n[r]],e.options.welcome.options.storedObjects.hasUpdated=!0,d=!0;if(o.filters){var u=Object.getOwnPropertyNames(o.filters);for(a=0;a<u.length;a++)if(u[a]===n[r])c.push(u[a]),p.push(o.filters[u[a]].associatedProduct),delete o.filters[u[a]],d=!0;else if(o.filters[u[a]].associatedProduct===n[r]){s.getNode({id:n[r]})&&p.push(n[r]),c.push(u[a]),delete o.filters[u[a]],d=!0}}if(o.pointClouds)s.getNode({id:n[r]})&&p.push(n[r]),c.push(n[r]),delete o.pointClouds[n[r]],e.options.welcome.options.storedObjects.hasUpdated=!0,d=!0}if(p.length&&s.removeRoots({pids:p},!1),d&&(e.options.widget.setValue("xsceneStoredObjects",JSON.stringify(o)),i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:c}})),e._customHandler)e._customHandler.removeFromStore(e.options.widget,t.item2remove)&&i.publish({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"})}}t.customitem2remove&&t.customitem2remove.length&&i.publish({event:"ENXViews/LandingPage/removeFromStore",data:{customitem2remove:t.customitem2remove}})}),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/activate"},function(t){i.publish({event:"ENXViews/WelcomePanel/refreshView"}),("fromHome"===t||e.options.widget.getValue("showWelcomePanel"))&&e.__switchView("welcome")}),e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/closeLandingPage"},function(){e.__switchView("viewer")}),e._viewerSubscriptionHolder.subscribe({event:"onFilterApplied"},function(t){for(var n=a.retrieveData(e.options.structKey),o=0;o<t.filter.objects.length;o++){var s=t.filter.objects[o],r=s.filterId,l=s.path[0];if(r){var d={filters:{}};n.filters||(n.filters={}),a.addFilter(n,r,l),d.filters[r]={associatedProduct:l},i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:d}})}}a.persistData(e.options.structKey,n)}),e._viewerSubscriptionHolder.subscribe({event:"onRefreshBegin"},function(t){e._isInRefresh=!0}),e._viewerSubscriptionHolder.subscribe({event:"onRefreshCompleted"},function(t){e._isInRefresh=!1}),e.__hookRemoveFromView(),e._viewerSubscriptionHolder.subscribe({event:"onRootUpdateStart"},function(){e.applyFilterProcessed=!0,e.currentView=e.options.injectedView}),e._viewerSubscriptionHolder.subscribe({event:"onRootUpdateEnd"},function(){delete e.applyFilterProcessed,void 0!==e.options.injectedView&&e.currentView!==e.options.injectedView&&(null!==e.currentView&&"welcome"!==e.currentView||(e.currentView=e.options.injectedView),e.__switchView(e.currentView),delete e.currentView)}),e._viewerSubscriptionHolder.subscribe({event:"onAutoloadForDebug"},function(){"viewer"!==e.options.injectedView&&e.__switchView("viewer")}),e._viewerSubscriptionHolder.subscribe({event:"onRootAdded"},function(t){if(!e._during3Drefresh&&!0!==t.fromLoadJSON){if(t.rootLog){var n=a.retrieveData(e.options.structKey);if(t.filterId){t.serviceId||(t.serviceId="3DSpace");var o={filters:{}};o.filters[t.filterId]={associatedProduct:t.id},a.addFilter(n,t.filterId,t.id),a.addOpenFilter(n,[t.filterId]);var s=t.rootLog.map(function(e){return e[0]});e._previousFilterRootPids?(e._previousFilterRootPids=e._previousFilterRootPids.concat(t.id),s=(s=s.concat(e._previousFilterRootPids)).filter(function(e,t,n){return t===n.indexOf(e)})):e._previousFilterRootPids=[t.id];var r=s.indexOf(t.id);if(-1!==r&&s.splice(r,1),e._previousFilterRootPids)for(var l=0;l<e._previousFilterRootPids.length;l++){var d=e._previousFilterRootPids[l],c=s.indexOf(d);-1!==c&&s.splice(c,1)}if(s.length){for(var p=[],u=0;u<s.length;u++){var h=s[u];n[h]={},p.push([h])}i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:p}})}a.persistData(e.options.structKey,n),e._previousStoredFilter=t.filterId,i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:o}})}else if("r2vsurvey"===t.serviceId)n.pCloudServiceId=t.serviceId,a.addPointCloud(n,t.idPath[0],t.soiId),a.addOpenPointCloud(n,t.soiId),i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"pointclouds",soiId:t.soiId,fsId:t.idPath[0],serviceId:t.serviceId}});else{if(t.serviceId||(t.serviceId="3DSpace"),e.applyFilterProcessed)return void e.options.viewer.getContentName({callbacks:{onComplete:function(t){e.options.widget.setTitle(t.contentName)}}});a.addProductPath(n,t.idPath,!0);var m=[t.idPath];if(a.addOpenProduct(n,m),e._previousStoredFilter&&n&&n.filters&&n.filters[e._previousStoredFilter]){var f=n.filters[e._previousStoredFilter].associatedProduct;f&&n.products[f]&&(delete n.products[f],a.removeOpen(n,f),f===t.idPath[0]&&(m=[])),e._previousStoredFilter=void 0}i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:m}})}a.persistData(e.options.structKey,n),"viewer"!==e.options.injectedView&&!0!==e._isInRefresh&&e.__switchView("viewer")}e.options.viewer.getContentName({callbacks:{onComplete:function(t){e.options.widget.setTitle(t.contentName)}}})}}),e._viewerSubscriptionHolder.subscribe({event:"onLoadingFailure"},function(){0===e.options.viewer.getController().getNbRoots()&&!0!==e.applyFilterProcessed&&(i.publish({event:"ENXViews/WelcomePanel/refreshView"}),e.__switchView("welcome"))}),e._viewerSubscriptionHolder.subscribe({event:"onRetrieveFilterFailure"},function(){0===e.options.viewer.getController().getNbRoots()&&(i.publish({event:"ENXViews/WelcomePanel/refreshView"}),e.__switchView("welcome"))}),e._viewerSubscriptionHolder.subscribe({event:"onRefreshBegin"},function(t){e._during3Drefresh=!0}),e._viewerSubscriptionHolder.subscribe({event:"onRefreshCompleted"},function(t){e._during3Drefresh=!1}),e._viewerSubscriptionHolder.subscribe({event:"onEndRootRemoved"},function(t){if(!e._during3Drefresh&&!e.applyFilterProcessed&&t.ids&&t.ids.length){var n=t.ids,o=[],s=a.retrieveData(e.options.structKey);if((o=a.removeOpen(s,n)).length&&(a.persistData(e.options.structKey,s),i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:o,dispatch:t.dispatch}})),UWA.is(s,"string")){s=JSON.parse(s);var r,l,d=n.length;for(r=0;r<d;r++)if(s.products&&s.products.hasOwnProperty(n[r])&&(delete s.products[n[r]],o.push(n[r])),s.filters){var c=Object.getOwnPropertyNames(s.filters);for(l=0;l<c.length;l++){var p;s.filters[c[l]].associatedProduct===n[r]?p=n[r]:c[l]===n[r]&&(p=s.filters[c[l]].associatedProduct),p&&(delete s.filters[c[l]],o.push(c[l]))}}o.length>0&&i.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:o,dispatch:t.dispatch}})}0===e.options.viewer.getController().getNbRoots()&&!0!==e.applyFilterProcessed&&i.publish({event:"ENXViews/WelcomePanel/refreshView"}),e.options.viewer.getContentName({callbacks:{onComplete:function(t){e.options.widget.setTitle(t.contentName)}}})}}),!0===e._viewerReady&&e._setupReady("viewerReady")},__hookRemoveFromView:function(){var e=this;e._globalSubscriptionHolder.subscribe({event:"ENXViews/WelcomePanel/removeFromView"},function(t){for(var n=e.options.viewer.getController(),o=[],s=0;s<t.item2remove.length;s++){var r=t.item2remove[s];n.getNode({id:r})&&o.push(r)}(o.length&&n.removeRoots({pids:o},!1),e._customHandler&&"function"==typeof e._customHandler.removeFromView)&&(e._customHandler.removeFromView(e.options.widget,t.item2remove)&&i.publish({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"}));t.customitem2remove&&t.customitem2remove.length&&i.publish({event:"ENXViews/LandingPage/removeFromView",data:{customitem2remove:t.customitem2remove}})})},__customizeSetup:function(){var e=this;if(e._customHandler){e._globalSubscriptionHolder.subscribe({event:"/ENXViews/WelcomePanel/action/previousContent/"},function(){var t=i.getModelEvents(),n=e._getStoredStruct();e._customHandler.populate(n).then(function(i){i.length&&t.publish({event:"ENXViews/ContentChooser/model/previousContent",data:{op:"populateAppend",objects:i,allselected:!0}}),e._customHandler.update(n).then(function(e){t.publish({event:"ENXViews/ContentChooser/model/previousContent",data:{op:"update",objects:e,allselected:!0,fromCustom:!0}})})})}),e._globalSubscriptionHolder.subscribe({event:"/ENXViews/ContentChooser/model/previousContent/refresh/"},function(){i.publish({event:"/ENXViews/WelcomePanel/action/previousContent/"})})}},_getStoredStruct:function(){var e=this.options.widget.getValue("xsceneStoredObjects");return e=UWA.is(e,"string")?JSON.parse(e):{products:{},filters:{}}},_setupReady:function(e){this.options.ready[e]=!0;for(var t=Object.keys(this.options.ready),n=!0,o=0;o<t.length&&n;o++)!1===this.options.ready[t[o]]&&(n=!1);!0===n&&i.publish({event:"ENXViews/WelcomePanel/appReady"})}},p.getDefaultActivities=t.getDefaultActivities,p.launchSearch=function(e){return e.modelEvts=i.getModelEvents(),t.launchSearch(e)},p});