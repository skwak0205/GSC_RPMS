define("DS/ENOXTaggerOnIndexComponent/ENOXTaggerOnIndexComponent",["UWA/Core","DS/TagNavigatorProxy/TagNavigatorProxy","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI"],function(e,t,i,a,n){"use strict";var r={},o={},l={},s="";i.getPlatformServices({onComplete:function(e){var t=e[0];s=t["3DSearch"]+"/search"}});var c={setTagProxy:function(e,t,i,a,n){r||(r={});r[e]&&(r[e].unsetTags(),o[e]={}),this._callSetupProxy(e,t,i,a,n)},_callSetupProxy:function(i,u,f,g,d){var v=[];if(f.length>227){for(var h=Math.floor(f.length/227),p=0;p<h;p++){var y=f.slice(227*p,227*(p+1));v.push(y)}if(f.length%227>0){y=f.slice(227*h);v.push(y)}}else v.push(f);var P=0,x=function(){v.length>P&&function(i,u,f,g,d,v){var h="";if(d&&Array.isArray(d)&&d.length==f.length)for(var p=0;p<f.length;p++)p>0&&(h+=" OR "),h+=d[p];else{for(h+="physicalid:(",p=0;p<f.length;p++)p>0&&(h+=" OR "),h+=f[p];h+=")"}var y=widget.getUrl()+"-"+n.getUser().login+"-"+Date.now();"function"===e.typeOf(u.onTagFilterChange)&&(r[i]||(r[i]=t.createProxy({id:i,widgetId:widget.id,filteringMode:"WithFilteringServices",colorize:!!u.colorize&&u.colorize,MyFriends:u.MyFriends,tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise"}),UWA.is(u.onSetTagProxy,"function")&&u.onSetTagProxy()),r[i].addEvent("onFilterSubjectsChange",u.onTagFilterChange),u.colorize&&!0===u.colorize&&(r[i].addEvent("colorize",u.onTagColor),r[i].addEvent("unColorize",u.onTagUncolor))),l[i]||(l[i]={subjectPrefix:u.subjectPrefix||""}),0!=f.length?a.authenticatedRequest(s,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({query:h,order_by:"asc",order_field:"ds6w:modified",label:y,locale:null!=widget&&null!=widget.lang?widget.lang:"en",nresults:f.length,start:0,tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",with_synthesis:!0,select_predicate:["ds6w:created"]}),onComplete:function(e){UWA.is(v,"function")&&v();var t,a,n,s,u,f,d=(a={},n=e.results,s="",u={},f=[],n&&n.forEach(function(e){t=e.attributes,s="",u={},f=[];for(var i=0;i<t.length;i++)if("internal"==t[i].format)"resourceid"==t[i].name&&(s=t[i].value);else if("ds6w_facet"==t[i].format){if("explicit"===t[i].field&&t[i].sixw)continue;u={object:"date"==t[i].type?(n=t[i].value,r=void 0,o=void 0,r=new Date,o="",n&&("string"==typeof n&&(n=(n=(n=n.replace(/\&#x2f;/g,"/")).replace(/\&#x3a;/g,":")).replace(/\u200E/g,"")),o=(r=new Date(n)).getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()),o):t[i].value,sixw:t[i].name,field:t[i].field,dispValue:"date"==t[i].type?"NONE_NEEDED":t[i].dispValue?t[i].dispValue:t[i].value,type:t[i].type},f.push(u)}var n,r,o;a[s]=f}),a);if(r[i]){var h=l[i].subjectPrefix||"";if(g)for(var p in d){var y=g[p]||g[h+p];if(y)for(var P=0;P<y.length;P++)d[p].push(y[P])}for(var p in o[i]||(o[i]={}),d)o[i][h+p]=d[p];c.publishTags(i)}},onFailure:function(e){console.log("Tagger service Error : "),console.log(e)}}):r[i]&&(o[i]={},c.publishTags(i))}(i,u,v[P],g,d,function(){P++,x()})};x()},getTagProxy:function(e){return r[e]?r[e]:null},publishTags:function(e){r[e]&&!0===r[e]._attributes.isAlive&&r[e].setSubjectsTags(o[e])},filterTags:function(e,t){var i=l[e].subjectPrefix||"";if(r[e]&&!0===r[e]._attributes.isAlive&&o[e]){var a={};if(t&&t.length>0)for(var n=0;n<t.length;n++)o[e].hasOwnProperty(i+t[n])&&(a[i+t[n]]=o[e][i+t[n]]);r[e].setSubjectsTags(a)}},focusOnSubjects:function(e,t){var i=l[e].subjectPrefix||"";if(r[e]&&!0===r[e]._attributes.isAlive&&o[e]){var a=[],n={};if(t&&t.length>0)for(var s=0;s<t.length;s++)if(o[e].hasOwnProperty(i+t[s])){var c=i+t[s];a.push(c),n[c]="3DSpace"}r[e].focusOnSubjects(a,!0,n)}},unfocus:function(e){r[e]&&r[e].unfocus()},setLocalFilter:function(e,t){UWA.is(t,"object")&&(r[e]&&!0===r[e]._attributes.isAlive&&r[e].setLocalFilter(t,!0))},killTagProxy:function(e){r[e]&&(r[e].deactivate(),r[e].unsetTags(),r[e].die(),r[e]=void 0,o[e]=void 0,delete r[e],delete o[e])},killAllTagProxy:function(){var e=this;Object.keys(r).forEach(function(t){e.killTagProxy(t)})},activate:function(e){r[e]&&r[e].activate()},deactivate:function(e){r[e]&&(r[e].deactivate(),r[e].unfocus())},unsetTags:function(e){r[e]&&r[e].unsetTags()}};return c});