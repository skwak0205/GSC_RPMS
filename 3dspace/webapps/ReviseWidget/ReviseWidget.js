define("DS/ReviseWidget/ReviseWidget",["css!DS/ReviseWidget/ReviseWidget","UWA/Controls/Abstract","DS/Controls/Editor","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/HTMLTemplating","DS/WAFData/WAFData","DS/LifecycleServices/LifecycleObjectList","DS/LifecycleServices/DictionaryServices","DS/LifecycleControls/CommandDialog","DS/LifecycleControls/DataGridViewContainer","DS/LifecycleCmd/MessageMediator","DS/LifecycleCmd/Dictionary","DS/LifecycleCmd/SelectionUtil","DS/LifecycleServices/IllegalCharMapping","DS/WidgetServices/WidgetServices","DS/WebToWinInfra/WebToWinCom","DS/LifecycleServices/NewBranchObjectProp","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/ErrorWidget/ErrorWidget","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,i,s,o,r,n,a,c,l,d,u,h,p,f,v,m,y,g,b,w,S,R,O,C,_){"use strict";return t.extend({physicalIds:null,context:null,objectListDiv:null,objectsList:null,tenant:null,folderId:null,useNLV:!1,newRevisionFromOldRevisionAllowed:!1,commentInput:null,foreIntent:!1,init:function(e){this._parent(e),this.physicalIds=[],this._newTitles=new v,this.illegalChars="",this.IllegalCharMapping=new y,this.commandManager=new o,this.selUtil=new m,null!=e&&e.hasOwnProperty("wintop")&&1==e.wintop&&(this.container=UWA.createElement("div",{name:"new_revision",class:"revise_popup"})),this.reviseOptions=[]},_getUniqueListBy:function(e,t){return[...new Map(e.map(e=>[e[t],e])).values()]},executeCmd:function(e,t,i){var o=this;e=this._getUniqueListBy(e,"physicalid"),this.addEvent("onReady",function(t){this._showCommandUI(e)},this),this.addEvent("onComplete",function(t){e[0].useFIRST?i(o.firstConfigRevisionObject):i()}),this.isMultipleSelection=e.length>1,this.context=t.context,this.context.displayNotification=(e=>{this._displayNotification(e)}),this.folderId=t.targetFolderId;try{if(void 0!==n.getActiveFolder){var a=n.getActiveFolder();void 0!==a.id&&null!==a.id&&""!==a.id&&(this.folderId=a.id,this.securityContex=""!==a.sc&&void 0!==a.sc?a.sc:this.securityContex,require(["DS/PlatformAPI/PlatformAPI"],function(e){e.publish("FolderEditor.ActiveFolderCallBack",{id:a.id,label:a.label})}))}}catch(e){this.folderId=t.targetFolderId,this.securityContex=n.getCurrentFolderSecurityContext()}if(this.isMultipleSelection&&this._createObjectsList(),0===e.length)throw s.noObject;e.forEach(function(e){if(e.hasOwnProperty("physicalid")&&(""===e.physicalid||!UWA.is(e.physicalid)))throw s.objectNotFound;o.physicalIds.push(e.physicalid),null===o.tenant&&(o.tenant=e.tenant,o.commandManager.setTenant(o.tenant))}),r.getAllowedSemanticsPromise(this.physicalIds,this.context).then(function(t){if(r.isBaselineMode(void 0,t)){if(e.length>1)return void o.showError(s.multipleSelectionObjectsNotSupported);"ConfiguredBaseline"===e[0].type?(o.useFIRST=e[0].useFIRST,o.setObjects(e,t.allowedSemantics)):require(["DS/HistoryExplorer/HistoryDialog"],function(s){(new s).executeCmd(e,{getAllowedSemanticsResponse:t,context:o.context,name:"history_command"},i)})}else o.setObjects(e,t.allowedSemantics)},function(e){o.showError(e)})},_createSingleSelContentProp:function(e){this.objectProp=new w({className:"newrevision_prop",data_rec_id:"revise_prop_rec-id",showProposedRevision:!0,editable:!0}),this.objectProp.inject(e);var t=this.preparedObjectsList[0];t.hasOwnProperty("attributes_mask")||(t.attributes_mask=[]);var i=!1;t.attributes_mask.forEach(function(e){"attribute[PLMReference.V_versionComment]"==e.selectable&&(i=!0)});var s=!1,o=!1;if(t.hasOwnProperty("type.kindof[PLMReference]")&&(s="TRUE"===t["type.kindof[PLMReference]"]),t.hasOwnProperty("branch")&&(o=!!t.branch),!i){var n={};o?(n.selectable="attribute[description]",n.readOnly=!1,n.path="description",n.name="V_versionComment",n.nls=C.LifecycleObjectList_versionComment,n.multiline=!0,n.maxlength=256,t.attributes_mask.push(n)):s&&(n.selectable="attribute[PLMReference.V_versionComment]",n.readOnly=!1,n.path="PLMReference.V_versionComment",n.name="V_versionComment",n.nls=C.LifecycleObjectList_versionComment,n.multiline=!0,n.maxlength=256,t.attributes_mask.push(n))}if(this.objectProp.setObject(this.preparedObjectsList[0]),t.availableSemantic&&t.availableSemantic.includes("FORE")&&"Released"!==t.current&&"Obsolete"!==t.current){var a=this;r._getAncestorsPromise(t.physicalid).then(function(e){if(e){t.ancestors=e;var i=new S({type:"checkbox"}),s=C.insertBefore+t.revision,o=new R({type:"checkbox",label:s,value:0});i.addChild(o);var r=UWA.createElement("div",{name:"checkbox_container",styles:{bottom:"0px",position:"absolute"}});i.inject(r),r.inject(a.objectProp.container),a.foreIntentCheckbox=o}})}this.objectProp.addEvent("onAttributeValidationError",e=>{e.forEach(e=>{this.showNotificationInDialog(e)})})},_WafDataPromise:function(e,t,i){return new Promise((o,a)=>{var c=n.get3DSpaceWSUrl(this.tenant,e,null);l.authenticatedRequest(c,{method:"POST",type:"json",headers:n.getHeaders(i),timeout:6e5,data:JSON.stringify(t),onComplete:function(e){o(e)},onFailure:function(e,t){console.log("Failure..."+e),a(r.parseWebServiceError(e,t))},ontimeout:function(){console.log("A connection timeout occured."),a(s.timeout)}})})},_getRevisionDetails:function(e,t,i){var o=new Map;t.forEach(e=>{o.set(e.id,e)});let n=!0;var a=null;this._WafDataPromise("/resources/lifecycle/revise/prepare_revise_checkavailability",{data:e},i).then(e=>{if("failure"===e.status&&e.hasOwnProperty("report")){var t=e.report;throw t.length>0&&t[0].hasOwnProperty("message")?t[0].message:(a=e,s.reviseFailed)}n=!!e.NewRevisionFromOldRevisionAllowed}).then(()=>{return this._WafDataPromise("/resources/lifecycle/product/attributeList",{data:e,attributes:["current","attribute[PLMReference.V_versionComment]","type.kindof[PLMReference]","displayType","current"]},i)}).then(e=>{var t=e.results;if(!Array.isArray(t)||0===t.length)throw s.objectNotFound;this.preparedObjectsList=t}).then(()=>{this.preparedObjectsList.forEach(e=>{var t=e.objectId||e.physicalid,i=o.get(t);i&&Array.isArray(i.semantic)&&(e.availableSemantic=i.semantic)})}).then(()=>{var t=[];return e.forEach(function(e){var i=e.objectId||e.physicalid;t.push(i)}),r.getVersionNumberProposalPromise(t,n?"LAST":"E",null,this.context)}).then(e=>{if(e.errorID)throw console.log("Versioning service returned error: "+JSON.stringify(e)),e.errorMessage?e.errorMessage:(a=e,s.reviseFailed);var t=new Map;e&&Array.isArray(e.addRequests)&&e.addRequests.forEach(e=>{t.set(e.copyId,e.code)}),this.preparedObjectsList.forEach(e=>{var i=e.objectId||e.physicalid,s=t.get(i);s&&(e.proposedRevision=s)})}).then(()=>this._WafDataPromise("/resources/lifecycle/revise/prepare_revise_maskattributes",{data:this.preparedObjectsList},i)).then(e=>{if("failure"===e.status&&e.hasOwnProperty("report")){var t=e.report;throw t.length>0&&t[0].hasOwnProperty("message")?t[0].message:(a=e,s.reviseFailed)}var i=e.results;if(!Array.isArray(i)||0===i.length)throw s.objectNotFound;this.preparedObjectsList=i,this.dispatchEvent("onReady",{})}).catch(e=>{console.log("Prepare revise request status is failure"),console.log(e),a?this._showReviseFailure(a):this.showError(e)})},_getFirstVersionNumberProposal:function(e,t){var i=this,o={addRequests:[{copyId:e,ancestors:[{id:e,semantic:"FIRST"}]}]},a=JSON.stringify(o),c=n.get3DSpaceWSUrl(this.tenant,"/resources/v1/dslc/getversionnumberproposal",null);l.authenticatedRequest(c,{method:"POST",type:"json",headers:n.getHeaders(t),timeout:6e5,data:a,onComplete:function(e){console.log(e),Array.isArray(e.addRequests)&&e.addRequests.length>0&&(i.preparedObjectsList=[{proposedRevision:e.addRequests[0].code}]),i.dispatchEvent("onReady",{})},onFailure:function(e,t){console.log("Failure, object details: "+e),i.showError(r.parseWebServiceError(e,t))},onTimeout:function(){console.log("A connection timeout occured."),i.showError(s.timeout)}})},_showCommandUI:function(e){var t=this,o=!1,r=document.createElement("div");r.className="revise_popup dlg_cmd_content css_grid_container";var n="",a="";if(this.isMultipleSelection){if(this.dgvContainer=new p({idName:"dgvContainer",clickToShowDGV:!1},e),this.dgvContainer.inject(r,"top"),a=" - "+e.length+" "+s.multipleSelectionObjects,o=this.preparedObjectsList.some(function(e){return!(!e.hasOwnProperty("type.kindof[PLMReference]")||"TRUE"!==e["type.kindof[PLMReference]"])},this)){UWA.createElement("div",{class:"comment_label",text:C.LifecycleObjectList_versionComment}).inject(r),this.commentInput=new i({placeholder:_["Enter a text"],newLineMode:"enter"}),this.commentInput.addEventListener("change",function(){t.preparedObjectsList.forEach(function(e){e.hasOwnProperty("modifiedAttributes")||(e.modifiedAttributes={}),e.hasOwnProperty("type.kindof[PLMReference]")&&"TRUE"===e["type.kindof[PLMReference]"]&&(e.modifiedAttributes["PLMReference.V_versionComment"]=t.commentInput.value),e.hasOwnProperty("branch")&&e.branch&&(e.modifiedAttributes.description=t.commentInput.value)}),t.commentInput.getContent().setAttribute("title",t.commentInput.value)}),this.commentInput.addEventListener("uncommittedChange",function(){t.commentInput.getContent().setAttribute("title",t.commentInput.valueToCommit);var e=t._checkVersionCommentValue(t.commentInput.valueToCommit);e&&t.showNotificationInDialog(e)}),this.commentInput.getContent().addClassName("comment_input"),this.commentInput.inject(r)}}else if(this._createSingleSelContentProp(r),Array.isArray(e)&&e.length&&(e[0].name||e[0].displayName)){n=e[0].name?e[0].name:e[0].displayName;let t=e[0].revision?" "+e[0].revision:"";a=" - "+n,n.endsWith(t)||(a+=t)}var l=this,d=new h,u=d.create(r,{className:"ENO_Revise",closeButton:!0,title:s.newRevision+a,OKBtnText:s.ReviseOK,resizable:!0,imageUrl:e[0].imageUrl||"",onOk:function(){l._executeRevise(function(e,i){i?(d.destroy(),l._onComplete(),void 0!==t.options&&null!==t.options&&t.options.hasOwnProperty("wintop")&&1==t.options.wintop&&l._onReviseComplete(e),l.dispatchEvent("onClose")):d.updateUI()})},onClose:function(){l._onComplete(),void 0!==t.options&&null!==t.options&&t.options.hasOwnProperty("wintop")&&1==t.options.wintop&&l._onCancel()},events:{onResizeFloating:function(){t.objectsList&&t.objectsList.objectsTable.resizeTable()}}});this.isMultipleSelection&&u.elements.container.addClassName("multiSel"),u.inject(widget.body);var f=u.getBody();f||(f=widget.body),this.errorOverlay=new O(this,f,{className:"revise_errorManager"});var v=this.isMultipleSelection?600:530,m=this.isMultipleSelection&&o?286:236,y=this.isMultipleSelection?400:330;m=this.isMultipleSelection?m+25*(e.length-2):m,!this.isMultipleSelection&&c.isTouchMode()&&(m+=24);var g=m;u.setNewSize({width:v,height:m}),setTimeout(function(){u.setMinSize(y,g)},10)},_onComplete:function(){this.dispatchEvent("onComplete",{})},_onReviseComplete:function(e){var t=[];if(null!=e&&e.hasOwnProperty("results")&&e.results.hasOwnProperty("length")&&e.results.length>0)for(var i=0;i<e.results.length;i++)t.push({argname:"revised_physicalid"+i,argvalue:e.results[i].physicalid});var s=b.createJSONArrayArg("NewVersionWebInWinResults",t);s.length>0&&this.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onCtxMenuClick",notif_parameters:s},"lf_web_in_win"),this.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"ClosePanel",notif_parameters:"ClosePanel"},"lf_web_in_win")},_onCancel:function(){var e=b.createJSONArrayMessage("onDisplayErrorMessage",{severity:"warning",message:"Revise canceled"});e.length>0&&(this.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:e},"lf_web_in_win"),this.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"ClosePanel",notif_parameters:"ClosePanel"},"lf_web_in_win"))},setObjects:function(e,t){var i=this;this.commandManager.addEvent("onCompleteGetOptions",function(s){this.reviseOptions=s;for(var o=i.reviseOptions.objects,n=0;n<o.length;++n){var a=o[n];a["type.property[IPML.NonLinearVersioningAvailability].value"]&&(this.useNLV=!0);var c=a.CADOrigin||"CATIAV5",l="";"CATIAV5"===c&&(l=":!"),i.IllegalCharMapping.addCADType(c,l)}if(i.reviseOptions.hasOwnProperty("options")){var d=i.reviseOptions.options;for(n=0;n<d.length;++n){var u=d[n];u.hasOwnProperty("newRevisionFromOldRevisionAllowed")&&(i.newRevisionFromOldRevisionAllowed=u.newRevisionFromOldRevisionAllowed)}}i._verifyNewRevisionAllowed(e,t)&&this.IllegalCharMapping.getMappings().then(function(s){if(i.illegalChars=s.find("CATIAV5")||"",i.isMultipleSelection)i._verifyMultipleSelection(e),i.objectsList.setObjects(e);else if(i.context&&"function"==typeof i.context.getSecurityContext){var o=i.context.getSecurityContext().SecurityContext;i.useFIRST?i._getFirstVersionNumberProposal(e[0].physicalid,o):i._getRevisionDetails(e,t,o)}else r.getSecurityContextPromise(i.tenant).then(function(s){i.useFIRST?i._getFirstVersionNumberProposal(e[0].physicalid,s):i._getRevisionDetails(e,t,s)}).catch(function(e){i.showError(e)})})},this);try{var o=this;document.body.style.cursor="wait";var n={data:[{physicalid:this.physicalIds[0]}],command:"revise"};this.commandManager.getOptions(n,function(t,i){if(i&&i.report&&i.report[0]&&i.report[0].errorcode&&3===i.report[0].errorcode){var r=e[0].typeDisplayName?e[0].typeDisplayName:e[0].type,n=s.replace(s.get("noReviseOfAggType"),{dispType:r});o.isMultipleSelection&&(n=s.noReviseOfAggMulti);var a=s.reviseParent;o.showError(n,{title:n,subtitle:a})}else o.showError(t);o._onComplete()},this.context)}finally{document.body.style.cursor="default"}},_createObjectsList:function(){this.objectListDiv=UWA.createElement("div",{class:"revise-objectList"}),this.objectsList=new d({className:"objectlist-Revise",showDisplayNameColumn:!1,showNameColumn:!0,showRevisionColumn:!0}),this.objectsList.inject(this.objectListDiv)},_verifyNewRevisionAllowed:function(e,t){if(this.newRevisionFromOldRevisionAllowed||this.useFIRST)return!0;var i=[];if(t&&Array.isArray(t)&&t.forEach(function(t){if(Array.isArray(t.semantic)&&!t.semantic.includes("E")){var s=e.find(e=>e.physicalid==t.id);s&&i.push(s)}}),0==i.length)return!0;var o=s.noReviseObjects,r=s.newRevisionFromAnyRevisionForbidden,n="";return i.forEach(e=>{var t=e.displayName?e.displayName:e.name,i=e.revision?" "+e.revision:"";n+=t,e.revision&&!t.endsWith(i)&&(n+=i),n+="<br>"}),this.showError(o,{title:o,subtitle:r,submessage:n}),this._onComplete(),!1},_verifyMultipleSelection:function(e){var t=this,i=function(e){if(null===e||0===e.length)t.showNotification(s.objectNotFound);else{var i=e.filter(function(e,t,i){return i.some(function(t){return e.physicalid!=t.physicalid&&e.versionid==t.versionid})});if(0==i.length)t.dispatchEvent("onReady",{});else{i.sort(function(e,t){return e.displayName<t.displayName?-1:e.displayName>t.displayName?1:0});var o=s.multObjsSameFamily+"<br>";i.forEach(function(e,t,i){o+=e.displayName,t<i.length-1&&(o+="<br>")}),t.showError(o),t._onComplete()}}};r.getSecurityContextPromise(this.tenant).then(function(s){t._attributeListRequest(e,s,i)}).catch(function(e){t.showError(e)})},_attributeListRequest:function(e,t,i){document.body.style.cursor="wait";var o=this,a={data:e,attributes:["baseType","logicalid","versionid","type.kindof[PLMReference]","displayType"]},c=n.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/product/attributeList",null);l.authenticatedRequest(c,{method:"POST",type:"json",headers:n.getHeaders(t),timeout:6e5,data:JSON.stringify(a),onComplete:function(e){document.body.style.cursor="default";var t=e.results;o.preparedObjectsList=t,i(t)},onFailure:function(e,t){document.body.style.cursor="default",console.log("verifyMultipleSelection:Failure..."+e),o.showError(r.parseWebServiceError(e,t)),o._onComplete()},onTimeout:function(){document.body.style.cursor="default",console.log("verifyMultipleSelection: A connection timeout occured."),o.showError(s.timeout),o._onComplete()}})},_strContainsIllegalChars:function(e,t){return!!(e&&g.commonChar(e,t,!0)>0)},_strIsLegal:function(e){return!this._strContainsIllegalChars(e,this.illegalChars)},_verifyTitles:function(e){return!e.some(function(e){return!this._strIsLegal(e.title)},this)||(this.showError(s.replace(s.illegalTitle,{illegalChars:this.illegalChars})),!1)},_checkVersionCommentValue:function(e){if(e&&e.length>256){var t=require("i18n!DS/EditPropWidget/assets/nls/langEditProp"),i="checkVersionCommentValue error";return t&&(i=t.replace(t.get("MaxLengthAttribute"),{label:C.LifecycleObjectList_versionComment,value:256})),{code:"ERROR",eventID:"warning",message:i}}return null},_executeRevise:function(e){var t=this,i={data:[]};if((this.foreIntent=!(!this.foreIntentCheckbox||!0!==this.foreIntentCheckbox.checkFlag),this.physicalIds.forEach(function(e){var s={physicalid:e};t._newTitles.contains(e)&&(s.title=t._newTitles.find(e)),t.preparedObjectsList&&t.preparedObjectsList.forEach(function(t){t.hasOwnProperty("physicalid")&&t.hasOwnProperty("modifiedAttributes")&&e==t.physicalid&&(s.modifiedAttributes=t.modifiedAttributes),t.hasOwnProperty("proposedRevision")&&(s.proposedRevision=t.proposedRevision),t.hasOwnProperty("ancestors")&&(s.ancestors=t.ancestors)}),i.data.push(s)}),null!=this.objectProp)&&(null!=(s=this.objectProp.getErrors())&&s.length>0))return s.forEach(e=>{this.showNotificationInDialog(e)}),void e(null,!1);if(t.preparedObjectsList){var s=[];if(t.preparedObjectsList.forEach(function(e){if(e.modifiedAttributes&&e.modifiedAttributes["PLMReference.V_versionComment"]){var i=t._checkVersionCommentValue(e.modifiedAttributes["PLMReference.V_versionComment"]);i&&s.push(i)}}),s.length>0)return t.showNotificationInDialog(s[0]),void e(null,!1)}if(this._verifyTitles(i.data)){JSON.stringify(i);i.folderid=this.folderId;var o=function(t){document.body.style.cursor="default",e(t,!0)};if("function"==typeof(t=this).context.getSecurityContext){var n=t.context.getSecurityContext().SecurityContext;t.reviseServiceRequest(i,o,n)}else r.getSecurityContextPromise(this.tenant).then(function(e){t.reviseServiceRequest(i,o,e)}).catch(function(e){t.showError(e)})}else e(null,!1)},showNotificationInDialog:function(e){"ERROR"===e.code?null!=this.errorOverlay?this.errorOverlay.addError(e.message,e.customClass):this.showError(e.message):null!=this.errorOverlay?this.errorOverlay.addWarning(e.message,e.customClass):this.showNotification(e.message)},showNotification:function(e,t){if(t=t||{},"function"==typeof this.context.displayNotification){var i={eventID:"string"==typeof t.type?t.type:"primary",msg:e,sticky:t.sticky||!1};this.context.displayNotification(i)}else alert(e)},showError:function(e,t){if(t=t||{},"function"==typeof this.context.displayNotification){var i={eventID:"error",msg:t.title||t.subtitle?t.submessage:e,title:t.title,subtitle:t.subtitle,sticky:t.sticky||!1};this.context.displayNotification(i)}else alert(e)},_displayNotification:function(e){a.displayNotification(e)},_showReviseFailure:function(e){var t=s.reviseFailed,i=null;if(0!==e.report.length){var o=e.report[0];if(t=(t=o.error).replace(/(\n)+/g,"<br>"),console.log(o.description),i={title:s.reviseFailed,subtitle:t},o.ENOVersioningErrorKey&&("NonLinearVersioning.Error.NoReviseAccess"===o.ENOVersioningErrorKey||"NonLinearVersioning.Error.AccessRights"===o.ENOVersioningErrorKey)){var r=s.noReviseObjects,n=this.preparedObjectsList[0]?this.preparedObjectsList[0].displayName:null;if(!this.isMultipleSelection&&n){r=s.replace(s.noReviseOfName,{dispName:n});var a=s.verifyCredentials,c=s.lackingReviseAccessRole;"NonLinearVersioning.Error.AccessRights"===o.ENOVersioningErrorKey&&(a=s.replace(s.get("noPermissionToLatestRevision"),{dispName:n}),c=s.createNewBranch),i={title:r,subtitle:a,submessage:c}}}}this.showError(t,i)},reviseServiceRequest:function(e,t,i){var o=this;console.log("REVISE:");e.notificationTimeout=600;var a=JSON.stringify(e),c=n.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/revise/major",null);if(o.useNLV||o.useFIRST){c=n.get3DSpaceWSUrl(this.tenant,"/resources/v1/dslc/addversions",null);var d="E";o.newRevisionFromOldRevisionAllowed&&(d="LAST"),o.useFIRST&&(d="FIRST");for(var u=[],h=0,p=e.data.length;h<p;h++){(S=[]).push({semantic:d,id:e.data[h].physicalid});var v=[];e.data[h].title&&v.push({name:"PLMEntity.V_Name",value:e.data[h].title});var m=null;if(e.data[h].modifiedAttributes){var y=e.data[h].modifiedAttributes,g=null;for(g in y)"revision"===g?m=y.revision:v.push({name:g,value:y[g]})}var b={copyId:e.data[h].physicalid,ancestors:S,attributes:v};m&&(b.code=m),u.push(b)}a=JSON.stringify({addRequests:u})}if(o.foreIntent){c=n.get3DSpaceWSUrl(this.tenant,"/resources/v1/dslc/addversions",null);d="FORE";var w=[],S=[],R=null;v=[];if(e.data[0].modifiedAttributes){y=e.data[0].modifiedAttributes,g=null;for(g in y)"revision"===g?R=y.revision:v.push({name:g,value:y[g]})}S.push({semantic:d,id:e.data[0].physicalid}),(b={copyId:e.data[0].ancestors[0].id,ancestors:S,attributes:v}).code=R||e.data[0].proposedRevision,w.push(b),a=JSON.stringify({addRequests:w})}document.body.style.cursor="wait",l.authenticatedRequest(c,{method:"POST",headers:n.getHeaders(i),timeout:6e5,onComplete:function(i){void 0!==o.options&&null!==o.options&&o.options.hasOwnProperty("wintop")&&1==o.options.wintop?t(i):(o.useFIRST&&null!=i&&i.hasOwnProperty("addRequests")&&(o.firstConfigRevisionObject={id:i.addRequests[0].id,revision:i.addRequests[0].code}),t());var r={created:[],deleted:[],modified:[]};r.context=o.context,r.refreshFolder=!!e.folderid;var n=e.data,a=o.selUtil.getAppSelectionRootPids(o.context),c=a.length>0;if(null!=i&&i.hasOwnProperty("status")&&i.hasOwnProperty("report")){if("failure"===i.status)return void o._showReviseFailure(i);var l=i.results,d=o.commandManager.findObjectDerivedFromSelection(l,n);d.forEach(function(e){var t=!1;e.hasOwnProperty("derivedfromphysicalid")&&(t=!0);var i=e["attribute[PLMReference.V_DerivedFrom]"]||e.derivedfromphysicalid,s={physicalid:e.physicalid,sourceObjectId:i,operation:"Revise",refreshPSD:t};if(e.hasOwnProperty("folders")&&(r.refreshFolder=!0,s.folders=e.folders),!c||c&&-1!==a.indexOf(s.sourceObjectId))r.created.push(s);else if(c){var o={physicalid:i,operation:"Revise"};r.modified.push(o)}})}if((o.useNLV||o.useFIRST)&&null!=i&&i.hasOwnProperty("addRequests")){if(i.errorID)return i.errorMessage?o.showError(i.errorMessage):o.showError(s.reviseFailed),void console.log("Addversions service returned error (key):"+i.key);o.useNLV&&i.addRequests.forEach(function(e){var t={physicalid:e.id,sourceObjectId:e.copyId,operation:"Revise",refreshPSD:!0};r.created.push(t)})}if(o.foreIntent&&null!=i&&i.hasOwnProperty("addRequests")){if(i.errorID)return i.errorMessage?o.showError(i.errorMessage):o.showError(s.reviseFailed),void console.log("Addversions service returned error (key):"+i.key);i.addRequests.forEach(function(e){var t={physicalid:e.id,sourceObjectId:e.copyId,operation:"Revise",refreshPSD:!0,forceLoad:!0};r.created.push(t)})}o.showNotification(s.reviseSuccessful,{type:"success"}),f.dispatchEvent("onModification",r),"function"==typeof o.callback&&o.callback(returnedData)},data:a,onTimeout:function(e){t(),o.showNotification(C.reviseTimeoutInfo,{sticky:!0}),console.log("Timeout error")},onFailure:function(e,i){t(),r.showWebServiceError(e,i,function(e,t,i,s,r){t?o.showNotification(C.reviseTimeoutInfo,{sticky:!0}):o.showError(e,{title:i,subtitle:s,submessage:r})},!0),console.log("Failed to retrive data from the server")},type:"json"})}})});