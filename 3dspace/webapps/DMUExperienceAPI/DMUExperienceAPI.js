define("DS/DMUExperienceAPI/DMUExperienceImporterAPI",["UWA/Class","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/EXPUtils","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUBaseExperience/DMUContextManager"],function(e,t,i,r,n,o,a,s){"use strict";return e.extend({init:function(e){var l,d=e||{},u=d.context,c=this;u&&d.markupsLinkedTo3DXmlModels&&(l=u.getViewer().getIdPathMatcher(),o.initIdPathMatcher(u.getViewer())),this.importModel=function(o){if(u&&o&&(o.json||o.markupStream)){o.json&&window.console.warn('============ DMUExperienceImporterAPI.importModel - "json" is a DEPRECATED attribute. Please use "markupStream" instead ============'),c.removeModel();var s=t.createReviewContext({context:u}),l="boolean"!=typeof e.bDisplayNominal||e.bDisplayNominal,d="boolean"!=typeof e.bDisplayInWork||e.bDisplayInWork,p="boolean"!=typeof e.displayDMUSlidePanel||e.displayDMUSlidePanel;r.setSlidePreferences({context:u.getFrameWindow(),preferences:{displayNominal:l,displayInWork:d,panelTitle:e.thumbnailListTitle,displaySlidePanel:p,beforeApplySlideCB:e.beforeApplySlideCB,afterApplySlideCB:e.afterApplySlideCB}});var g=o.markupStream?JSON.parse(n.cleanJSONString(o.markupStream)):o.json;if(s&&g.Model){var M=new i({viewer:u.getViewer(),experience:s,appType:"3dPlay"});M.importDataModel(g,function(t){if(M.postImport(),s.setCurrentSessionMarkup(t[0].getMarkupContent?t[0].getMarkupContent():t[0]),s.setReadOnly(!0),s.getCurrentSessionMarkup()){var i=a.giveDMUSlidesController({context:u.getFrameWindow()});if(i){var n=s.getCurrentSessionMarkup().getSlides();if(n&&n.length){if(o.slideUUIDs&&o.slideUUIDs.length)for(var d=o.slideUUIDs.slice(),c=l?1:0;c<n.length&&d.length;c++)n[c].getAttribute("bInWork")||(n[c].setAttribute("sUuid",d[0]),i.updateSlide(n[c],{uuid:d[0]}),d.splice(0,1));o.doNotDisplayFirstSlide||n[0]&&i.setActiveSlide(n[0]),p&&!e.thumbnailListTitle&&r.setSlidePreferences({context:u.getFrameWindow(),preferences:{panelTitle:s.getCurrentSessionMarkup().getAttribute("sName")}})}}}o.onModelLoadedCB&&o.onModelLoadedCB({uuidMappingTable:M.getUUIDMappingTable()})})}}},this.removeModel=function(){u&&(r.removeSlidePreferences({context:u.getFrameWindow()}),s.removeReviewContext({context:u}))},this.destroyDMUImporter=function(){d.markupsLinkedTo3DXmlModels&&u&&u.getViewer().setIdPathMatcher(l)}}})}),define("DS/DMUExperienceAPI/DMUOptionsManager",["DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/ApplicationFrame/CommandsManager"],function(e,t,i){"use strict";var r={setDMUUnit:function(i){if(i.context&&i.parameter){var n=e.getReviewContext(i);if(n||(n=t.createReviewContext(i)),n){var o=r.getDMUUnit(i);n.getDMUPreferenceRepository().setPreference(i.parameter,i.unit),o!==r.getDMUUnit(i)&&(n.getCurrentSessionMarkup()&&n.getCurrentSessionMarkup().refreshNode(),n.getTransientReviewBag()&&n.getTransientReviewBag().refreshNode(),i.context.getViewer().render())}}},getDMUUnit:function(t){if(t.context&&t.parameter){var i=e.getReviewContext(t);return i?i.getDMUPreferenceRepository().getPreference(t.parameter):void 0}},setCommandMode:function(e){if(e.context&&e.cmdHeader){var t=i.getCommand(e.cmdHeader,e.context.getCommandContext());t&&t.setCommandMode(e.mode)}}};return r}),define("DS/DMUExperienceAPI/DMUWebDesignReviewMarkerServices",["DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t){"use strict";return{selectDMUObjects:function(i){if(i&&i.context&&i.uuids&&i.uuids.length){var r=e.getReviewContext(i);if(r){var n=r.getCurrentSessionMarkup();if(n){var o=[],a=[n];a=a.concat(n.getOccurrenceOverloaders());var s=n.getSlides();s.forEach(function(e){a=a.concat(e.getDMUObjects())}),(s=n.getFormats()).forEach(function(e){a=a.concat(e.getDMUObjects())}),a.forEach(function(e){e&&e.getPathElement&&e.getAttribute&&-1!==i.uuids.indexOf(e.getAttribute("sUuid"))&&o.push({pathElement:e.getPathElement()})}),o.length&&t.add(o)}}}},getSelectedDMUObjectIDs:function(i){if(i&&i.context){var r=[],n=e.getReviewContext(i);if(n){var o=n.getCurrentSessionMarkup();if(o)t.get().forEach(function(e){var t=o.getDMUObjectFromPathElement(e.pathElement);t&&t.getAttribute("sUuid")&&r.push(t.getAttribute("sUuid"))})}return r}}}}),define("DS/DMUExperienceAPI/DMUExperienceAPI",[],function(){}),define("DS/DMUExperienceAPI/DMUWebDesignReviewSlideServices",["DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUSlidesController"],function(e,t){"use strict";return{applySlide:function(i){if(i&&i.context&&i.uuid){var r=e.getReviewContext(i);if(r){var n=r.getCurrentSessionMarkup();if(n){for(var o=null,a=n.getSlides(),s=0;s<a.length;s++)if("Nominal"!==i.uuid&&a[s].getAttribute("sUuid")===i.uuid||"Nominal"===i.uuid&&!a[s].getAttribute("sUuid")){o=a[s];break}var l=t.giveDMUSlidesController({context:i.context.getFrameWindow()});l?l.setActiveSlide(o,{duration:i.duration,afterSlideActivationCB:i.onSlideActivated}):t.setActiveSlide({context:i.context,slide:o,duration:i.duration,onSlideActivated:i.onSlideActivated})}}}},getSlidesDefinition:function(t){var i=[];if(!t||!t.context)return i;var r=e.getReviewContext(t);if(r){var n=r.getCurrentSessionMarkup();if(n)for(var o=n.getSlides(),a=0;a<o.length;a++)i.push({name:o[a].getAttribute("sName"),uuid:o[a].getAttribute("sUuid"),preview:o[a].getPreview(),inWork:o[a].getAttribute("bInWork")})}return i}}});