define("DS/CalcWdg/Views/KeyPanels",["UWA/Element","UWA/Event","UWA/Utils","UWA/Class/View","css!DS/CalcWdg/Views/KeyPanels"],function(e,t,n,i){"use strict";return i.extend({tag:"div",className:"keypanels-view",opened:!1,isTouch:!1,setup:function(){this.opened=!1,this.isTouch=n.Client.Features.touchEvents,this.eventsHandler={start:this.onTrackStart.bind(this),track:this.onTrack.bind(this),end:this.onTrackEnd.bind(this)},this.listenTo(this.model,{"onChange:wideMode":this.render})},render:function(){var t=this.elements,n=this.container.empty();return t.main=new e("div",{id:"main",html:this.options.main.render().container}),t.drawer=new e("div",{id:"drawer",html:this.options.drawer.render().container,events:{mousedown:this.eventsHandler.start}}),this.isTouch&&t.drawer.addEvent("touchstart",this.eventsHandler.start),this.options.eventsDelegation?(this.options.eventsDelegation.addEvents({mousemove:this.eventsHandler.track,mouseup:this.eventsHandler.end}),this.isTouch&&this.options.eventsDelegation.addEvents({touchmove:this.eventsHandler.track,touchend:this.eventsHandler.end})):(t.drawer.addEvents({mousemove:this.eventsHandler.track,mouseup:this.eventsHandler.end}),this.isTouch&&t.drawer.addEvents({touchmove:this.eventsHandler.track,touchend:this.eventsHandler.end})),t.panelContainer=new e("div",{id:"panelContainer",class:this.model.get("wideMode")?"wide-layout":"",html:[t.main,t.drawer]}).inject(n),this.updateSize(),this},marginChanged:function(){var e=this.model.get("wideMode"),t=this.model.get("margin");this.elements.panelContainer.style.width="calc(100% - "+(e?0:t)+"px)"},updateSize:function(){var e=this.elements,t=this.options,n=this.model.get("wideMode"),i=1/(1+t.drawerWidthRatio)*100;e.main.style.width=e.drawer.style.left=n?i+"%":"",e.drawer.style.width=n?100-i+"%":100*t.drawerWidthRatio+"%",this.opened=!1,this.marginChanged()},openedChanged:function(){var e=this.model.get("margin");this.positionDrawer(this.opened?"calc("+e+"px - 100%)":null)},positionDrawer:function(e){var t=this.elements.drawer.style;t.webkitTransform=t.transform=e?"translate3d("+e+", 0, 0)":""},onTrackStart:function(e){var n=this.elements.drawer.offsetWidth,i=this.model.get("margin");this.model.get("wideMode")||(this._start=t.getPosition(e).x,this._current=this._start,this._min=this._start+(this.opened?0:i-n),this._max=this._start+(this.opened?n-i:0),this._dragging=!0,this.elements.drawer.addClassName("dragging"),e.stopPropagation())},onTrack:function(e){var n,i;!this.model.get("wideMode")&&this._dragging&&(n=t.getPosition(e).x,this._direction=n-this._current,this._current=n,i=Math.max(this._min,Math.min(this._max,n)),this.positionDrawer(i-this._max+"px"),e.stopPropagation())},onTrackEnd:function(e){!this.model.get("wideMode")&&this._dragging&&(this.opened=this._direction<0,this.openedChanged(),this._dragging=!1,this.elements.drawer.removeClassName("dragging"),e.stopPropagation())}})}),define("DS/CalcWdg/Model",["UWA/Class/Model"],function(e){"use strict";return e.extend({defaults:{expression:"",result:"",error:"",mode:"radian",wideMode:"",responsiveWidth:600,margin:24}})}),define("DS/CalcWdg/Views/Output",["UWA/Class/View","DS/Handlebars/Handlebars4","css!DS/CalcWdg/Views/Output"],function(e,t){"use strict";return e.extend({tag:"div",className:"output-view",setup:function(){var e=this;e.listenTo(e.model,{"onChange:expression":e.render,"onChange:result":e.render,"onChange:error":e.render,"onChange:wideMode":function(t,n){e.container.toggleClassName("wide",n)}})},template:'            <div class="output {{#if error}}show-error{{/if}} {{#if result}}{{#unless error}}show-result{{/unless}}{{/if}}">              <div class="expression-outer horizontal end-justified center layout">                <div id="expression">{{expression}}</div>                <div id="error">{{error}}</div>              </div>              <div class="result-outer horizontal center layout">                <div class="result-equal">=</div>                <div class="result-value flex horizontal layout" >{{result}}</div>              </div>            </div>        ',render:function(){var e=this.model.toJSON();return this.container.empty().setContent(t.compile(this.template)(e)),this.container.toggleClassName("wide",this.model.get("wideMode")),this}})}),define("DS/CalcWdg/Keys",[],function(){"use strict";return{dot:{label:".",expression:"."},zero:{label:"0",expression:"0"},one:{label:"1",expression:"1"},two:{label:"2",expression:"2"},three:{label:"3",expression:"3"},four:{label:"4",expression:"4"},five:{label:"5",expression:"5"},six:{label:"6",expression:"6"},seven:{label:"7",expression:"7"},eight:{label:"8",expression:"8"},nine:{label:"9",expression:"9"},plus:{label:"+",expression:"+"},minus:{label:"-",expression:"-"},divide:{label:"÷",input:"/",expression:"÷"},times:{label:"×",input:"*",expression:"×"},reverse:{label:"¹⁄ₓ",expression:"^(-1)"},factorial:{label:"x!",input:"!",expression:"!"},parenthesis1:{label:"(",expression:"("},parenthesis2:{label:")",expression:")"},power2:{label:"x²",expression:"^(2)"},powern:{label:"xʸ",input:"^",expression:"^("},tenpowern:{label:"EE",expression:"E"},squareroot:{label:"√",expression:"√("},pi:{label:"π",expression:"π"},sinus:{label:"sin",expression:"sin("},sinush:{label:"sinh",expression:"sinh("},cosinus:{label:"cos",expression:"cos("},cosinush:{label:"cosh",expression:"cosh("},tangent:{label:"tan",expression:"tan("},tangenth:{label:"tanh",expression:"tanh("},percent:{label:"%",expression:"%"},logarithm10:{label:"log",expression:"log("},logarithmneperian:{label:"ln",expression:"ln("},exponential:{label:"e",expression:"e"},random:{label:"Rand",expression:"Rand"},equal:{label:"=",expression:""},del:{label:"⌫",expression:""},degree:{label:"Deg",expression:""},radian:{label:"Rad",expression:""},"":{label:"",expression:""}}}),define("DS/CalcWdg/MathPolyfills",[],function(){"use strict";Math.log10=Math.log10||function(e){return Math.log(e)*Math.LOG10E},Math.sinh=Math.sinh||function(e){var t=Math.exp(e);return(t-1/t)/2},Math.cosh=Math.cosh||function(e){var t=Math.exp(e);return(t+1/t)/2},Math.tanh=Math.tanh||function(e){if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)},Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}}),define("DS/CalcWdg/ComputationEngine/Tree",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(e){e=e||{},this.type=e.type,this.value=e.value,this.left=e.left,this.right=e.right}});return t.unflatten=function(e){var n=e.nodes.slice(),i=e.method,s=e.type,o=-1!==i.indexOf("infix"),r="infix-left-associative"===i||"suffix"===i,a=r?"left":"right",l=r?"right":"left",d=[][r?"pop":"shift"].bind(n);return function e(){var i={type:s};return o&&n.length>1&&(i[l]=d()),i.value=d(),n.length>0&&(i[a]=e()),new t(i)}()},t}),define("DS/CalcWdg/ComputationEngine/Tokens",[],function(){"use strict";var e={MATCHERS:{LPAREN:/\(/,RPAREN:/\)/,NUMBER:/\d+(\.\d+)?(E(\+|-)?\d+)?/,PLUS:/\+/,MINUS:/-/,TIMES:/\*|\u00D7/,DIV:/\/|\u00F7/,POW:/\^/,PERCENT:/%/,FACTORIAL:/!/,SQRT:/sqrt/,SQRT_SYMBOL:/\u221A/,SINH:/sinh/,COSH:/cosh/,TANH:/tanh/,SIN:/sin/,COS:/cos/,TAN:/tan/,LOG:/log/,LN:/ln/,RAND:/Rand/,PI:/pi|\u03C0/,E:/e/},isAmongTypes:function(t,n){for(var i=!1,s=0;s<n.length&&!i;++s)i=!!t.match(new RegExp("^"+e.MATCHERS[n[s]].source+"$"));return i},isOfType:function(t,n){return e.isAmongTypes(t,[n])}};return e}),define("DS/CalcWdg/Views/Key",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/CalcWdg/Keys","css!DS/CalcWdg/Views/Key"],function(e,t,n){"use strict";return e.extend({tag:"div",className:"key-view",key:"",setup:function(e){this.key=e.key||""},template:'            <div class="ink-container horizontal center-justified center layout"></div>            <div id="keyLabel" class="horizontal center-justified center layout">{{label}}</div>        ',render:function(){var e=this.elements;return this.container.empty().setContent(t.compile(this.template)({label:n[this.key].label})),e.keyLabel=this.container.getElement("#keyLabel"),e.inkContainer=this.container.getElement(".ink-container"),e.inkContainer.view=this,this},downAction:function(e){this.elements.ink.downAction(e)},upAction:function(){this.elements.ink.upAction()},cancelKey:function(e){e.preventTap(),this.resetInk()},resetInk:function(){this.elements.ink.cancel()}})}),define("DS/CalcWdg/ComputationEngine/Lexer",["DS/CalcWdg/ComputationEngine/Tokens"],function(e){"use strict";return function(t){t=t.replace(/ /g,"");var n=new RegExp(Object.keys(e.MATCHERS).map(function(t){return"("+e.MATCHERS[t].source+")"}).join("|"),"g"),i=t.match(n)||[],s=i.join("");if(s!==t)throw new Error("Expression cannot be tokenized: non-lexable sequence at position "+function(e,t){for(var n=Math.max(e.length,t.length),i=0;i<n;i++)if(e[i]!==t[i])return i;return-1}(t,s));return i}}),define("DS/CalcWdg/Views/KeyGrid",["UWA/Element","UWA/Class/View","DS/CalcWdg/Views/Key","css!DS/CalcWdg/Views/KeyGrid"],function(e,t,n){"use strict";return t.extend({tag:"div",className:"keygrid-view",keys:void 0,setup:function(e){this.keys=e.keys||[]},domEvents:{"click .key-view":"keyTap","click .handle-bar":"handleBarTap"},render:function(){var t=this.elements,i=this.container.empty();return t.keys=new e("div",{id:"keys",class:"horizontal layout"}).inject(i),t.handleBar=new e("div",{class:"handle-bar"}).inject(i),this.keys.forEach(function(i){var s=new e("div",{class:"flex vertical layout"}).inject(t.keys);i.forEach(function(e){var t=new n({key:e,attributes:{key:e}});t.render().container.addClassName("flex"),t.inject(s)})}),this},keyTap:function(e){this.dispatchEvent("onKeyTap",{key:e.target.view.key})},handleBarTap:function(e){e.preventDefault()},findKey:function(e){return this.elements.keys.querySelector('[key="'+e+'"]')}})}),define("DS/CalcWdg/ComputationEngine/Parser",["DS/CalcWdg/ComputationEngine/Tokens","DS/CalcWdg/ComputationEngine/Lexer","DS/CalcWdg/ComputationEngine/Tree"],function(e,t,n){"use strict";var i,s;function o(e){this.message=e+" at position "+s.length}o.prototype=Object.create(Error.prototype),o.prototype.constructor=o;var r={hasNext:function(){return i.length>0},nextIs:function(t){return r.hasNext()&&e.isOfType(i[0],t)},consumeNext:function(e){if(!r.hasNext())throw new o("Unexpected end of token stream. Expected "+e);if(!r.nextIs(e))throw new o("Expected "+i[0]+" to be a "+e);return s.push(i.shift()),s[s.length-1]},consumeNextAmong:function(e){return r.doAmong(e.map(function(e){return function(){return r.consumeNext(e)}}))},restoreTokens:function(e){for(var t=0;t<e;++t)i.unshift(s.pop())},doZeroOrMoreTimes:function(e){for(var t,n=[],s=!1;!s;)try{t=i.length,n.push(e())}catch(e){r.restoreTokens(t-i.length),s=!0}return n},doOneOrMoreTimes:function(e){var t=r.doZeroOrMoreTimes(e);if(0===t.length)throw new o("doOneOrMoreTimes failed at first call to callback");return t},doAtMostOnce:function(e){var t=i.length;try{return e()}catch(e){return void r.restoreTokens(t-i.length)}},doAmong:function(e){if(0===e.length)throw new o("Neither branches of doAmong succeeded");var t;try{return t=i.length,e[0]()}catch(n){return r.restoreTokens(t-i.length),r.doAmong(e.splice(1))}}};return function(e){function a(){return n.unflatten({type:"Expression",nodes:[].concat.apply([l()],r.doZeroOrMoreTimes(function(){return[r.consumeNextAmong(["PLUS","MINUS"]),l()]})),method:"infix-left-associative"})}function l(){return n.unflatten({type:"Term",nodes:[].concat.apply([d()],r.doZeroOrMoreTimes(function(){return[r.consumeNextAmong(["TIMES","DIV"]),d()]})),method:"infix-left-associative"})}function d(){return n.unflatten({type:"Factor",nodes:[].concat.apply([u()],r.doZeroOrMoreTimes(function(){return[r.consumeNext("POW"),u()]})),method:"infix-right-associative"})}function u(){return n.unflatten({type:"Suffixed",nodes:[function e(){return r.doAmong([function(){return new n({type:"SignedAtom",left:r.consumeNextAmong(["PLUS","MINUS"]),value:e()})},function(){return r.doAmong([function(){return r.consumeNextAmong(["NUMBER","RAND","PI","E"])},function(){return e="FunctionApplication",r.doAmong([function(){return new n({type:e,value:r.consumeNext("SQRT_SYMBOL"),right:u()})},function(){return new n({type:e,value:r.consumeNextAmong(["SQRT","SQRT_SYMBOL","SINH","COSH","TANH","COS","SIN","TAN","LOG","LN"]),right:c()})}]);var e},function(){return c()}])}])}()].concat(r.doZeroOrMoreTimes(function(){return r.consumeNextAmong(["PERCENT","FACTORIAL"])})),method:"suffix"})}function c(){r.consumeNext("LPAREN");var e=a();return r.hasNext()&&r.consumeNext("RPAREN"),e}i=t(e),s=[];var h=a();if(r.hasNext())throw new o("Parsing unexpectedly stopped");return h}}),define("DS/CalcWdg/Views/KeyPad",["UWA/Class/View","DS/CalcWdg/Views/KeyGrid","DS/CalcWdg/Views/KeyPanels","css!DS/CalcWdg/Views/KeyPad"],function(e,t,n){"use strict";return e.extend({tag:"div",className:"keypad-view",setup:function(){var e=this;e.listenTo(e.model,{"onChange:wideMode":function(t,n){e.elements.outerPanels&&e.elements.outerPanels.container.toggleClassName("narrow",!n)}})},render:function(){var e=this.elements,i=this.container.empty();return e.standard=new t({id:"standard",keys:this.options.standardKeys}),e.advanced=new t({id:"advanced",keys:this.options.advancedKeys}),e.mode=new t({id:"mode",keys:this.options.modeKeys}),["standard","advanced","mode"].forEach(function(t){this.listenTo(e[t],"onKeyTap",this.dispatchEvent.bind(this,"onKeyTap"))},this),e.outerPanels=new n({model:this.model,id:"outerPanels",main:e.standard,drawer:new n({model:this.model,id:"innerPanels",main:e.advanced,drawer:e.mode,drawerWidthRatio:.3,eventsDelegation:i}),drawerWidthRatio:.8,eventsDelegation:i}).render(),e.outerPanels.container.toggleClassName("narrow",!this.model.get("wideMode")),e.outerPanels.inject(i),this},findKey:function(e){for(var t,n=[this.elements.standard,this.elements.advanced,this.elements.mode],i=0;t=n[i];i++){var s=t.findKey(e);if(s)return s}}})}),define("DS/CalcWdg/ComputationEngine/Evaluator",["DS/CalcWdg/ComputationEngine/Tokens","DS/CalcWdg/ComputationEngine/Parser","DS/CalcWdg/MathPolyfills"],function(e,t){"use strict";var n,i=(n=[],function(e){if(!Number.isInteger(e)||e<0)return NaN;if(0===e||1===e)return 1;if(n[e]>0)return n[e];for(var t=1,i=1;i<=e;++i)t*=i;return n[e]=t});return function(n,s){s=s||{};var o=["NUMBER","E","PI","RAND"],r=["PLUS","MINUS","TIMES","DIV","POW"],a=["PERCENT","FACTORIAL"],l=["SQRT","SQRT_SYMBOL","SINH","COSH","TANH","SIN","COS","TAN","LOG","LN"];return function t(n){var d,u,c,h="object"==typeof n?n.value:n;if("object"==typeof h)d=t(h);else if(e.isAmongTypes(h,o))e.isOfType(h,"NUMBER")?d=parseFloat(h):e.isOfType(h,"E")?d=Math.E:e.isOfType(h,"PI")?d=Math.PI:e.isOfType(h,"RAND")&&(d=Math.random());else if(e.isAmongTypes(h,a))u=t(n.left),e.isOfType(h,"PERCENT")?d=u/100:e.isOfType(h,"FACTORIAL")&&(d=i(u));else if(e.isAmongTypes(h,r))u=t(n.left),c=t(n.right),e.isOfType(h,"PLUS")?d=u+c:e.isOfType(h,"MINUS")?d=u-c:e.isOfType(h,"TIMES")?d=u*c:e.isOfType(h,"DIV")?d=u/c:e.isOfType(h,"POW")&&(d=Math.pow(u,c));else if(e.isAmongTypes(h,l)){c=t(n.right);var p=("degree"===s.mode?Math.PI/180:1)*c;e.isAmongTypes(h,["SQRT","SQRT_SYMBOL"])?d=Math.sqrt(c):e.isOfType(h,"SINH")?d=Math.sinh(p):e.isOfType(h,"COSH")?d=Math.cosh(p):e.isOfType(h,"TANH")?d=Math.tanh(p):e.isOfType(h,"SIN")?d=Math.sin(p):e.isOfType(h,"COS")?d=Math.cos(p):e.isOfType(h,"TAN")?d=Math.tan(p):e.isOfType(h,"LOG")?d=Math.log10(c):e.isOfType(h,"LN")&&(d=Math.log(c))}return("string"==typeof n.left&&e.isOfType(n.left,"MINUS")?-1:1)*d}(t(n))}}),define("DS/CalcWdg/Views/Root",["UWA/Class/View","DS/CalcWdg/Views/Output","DS/CalcWdg/Views/KeyPad","DS/CalcWdg/Keys","DS/CalcWdg/ComputationEngine/Evaluator","css!DS/CalcWdg/Views/Root"],function(e,t,n,i,s){"use strict";return e.extend({tag:"div",className:"calculator-view",functionsRegex:"(?:"+[i.squareroot.label,i.logarithm10.label,i.logarithmneperian.label,i.sinus.label,i.sinush.label,i.cosinus.label,i.cosinush.label,i.tangent.label,i.tangenth.label].join(")|(?:")+")",contantsRegex:"(?:"+[i.random.label,i.exponential.label,i.pi.label].join(")|(?:")+")",domEvents:{keydown:"keyDown",keypress:"keyPress"},setup:function(){this.listenTo(this.model,{"onChange:result":this.onResultChanged,"onChange:mode":this.onModeChanged})},render:function(){var e=this.elements,i=this.container.empty(),s=this.model.get("mode");return i.setAttribute("tabindex",1),e.output=new t({model:this.model}),e.output.render(),e.output.inject(i),e.keypad=new n({model:this.model,standardKeys:this.standardKeys,advancedKeys:this.advancedKeys,modeKeys:this.modeKeys}),e.keypad.render().inject(i),i.toggleClassName("mode-radian","radian"===s).toggleClassName("mode-degree","degree"===s),this.listenTo(e.keypad,"onKeyTap",this.keyTap),this},standardKeys:[["seven","four","one","dot"],["eight","five","two","zero"],["nine","six","three","equal"],["del","plus","minus","divide","times"]],advancedKeys:[["parenthesis1","reverse","sinus","sinush","random"],["parenthesis2","power2","cosinus","cosinush","pi"],["percent","powern","tangent","tangenth","tenpowern"],["squareroot","factorial","logarithm10","logarithmneperian","exponential"]],modeKeys:[["radian","degree","","","",""]],errorMsg:"Error",clean:function(){var e,t=this.model.get("expression");for(e=t.split("(").length-1-(t.split(")").length-1);e>0;)t+=")",e--;this.model.set("expression",t)},clear:function(){this.model.set("expression",""),this.model.set("result",""),this.model.set("error","")},del:function(){var e=this.model.get("expression");this.model.set("expression",e.slice(0,-1))},compute:function(){var e,t=this.model,n=t.get("mode");this.clean(),e=t.get("expression");try{var i=Math.round(1e10*s(e,{mode:n}))/1e10;t.set("result",i.toString())}catch(e){t.set("result","?")}},keyTap:function(e){var t=e.key;this.processKey(t)},keyDown:function(e){8===e.keyCode&&(this.processKey("del"),e.preventDefault())},keyPress:function(e){var t,n=e.keyCode;t=13===n?"=":String.fromCharCode(n),this.processKey(function(e){for(var t,n=0,s=Object.keys(i);n<s.length;){if((t=i[s[n]]).label===e||t.expression===e||t.input===e)return s[n];n++}}(t)),e.preventDefault()},processKey:function(e){var t=this.model,n=t.get("result"),s=t.get("expression");"degree"!==e&&"radian"!==e?(n&&("equal"!==e&&this.clear(),-1!==["plus","minus","times","divide"].indexOf(e)?s=n:"equal"!==e&&(s="")),"equal"===e&&s?setTimeout(this.compute.bind(this)):"del"===e?this.del():e&&t.set("expression",s+i[e].expression)):this.model.set("mode",e)},onModeChanged:function(e){var t=e.get("mode");this.container.toggleClassName("mode-radian","radian"===t).toggleClassName("mode-degree","degree"===t)},onResultChanged:function(e){-1!==e.get("result").search(/\?|NaN|Infinity/)&&e.set("error",this.errorMsg)}})}),define("DS/CalcWdg/Calc",["DS/CalcWdg/Model","DS/CalcWdg/Views/Root","css!DS/CalcWdg/main"],function(e,t){"use strict";function n(){var n=new t({model:new e});n.render().inject(widget.body.empty()),widget.view=n,i()}function i(){var e=widget.view.container,t=widget.view.model,n=widget.view.container.getBoundingClientRect();t.set("wideMode",n.width>=t.get("responsiveWidth"));var i=Math.min(n.width,n.height);e.toggleClassName("font-xs",i<200),e.toggleClassName("font-s",i>=200&&i<350),e.toggleClassName("font-m",i>=350&&i<650),e.toggleClassName("font-l",i>=650&&i<800),e.toggleClassName("font-xl",i>=800)}widget.addEvents({onLoad:n,onRefresh:n,onResize:i})});