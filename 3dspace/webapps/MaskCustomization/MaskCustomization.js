define("DS/MaskCustomization/ajaxRequests/ServicesAjaxRequests",["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WAFData/WAFData"],function(e,t,i){"use strict";return{getTenantFromModel:function(e){var t=e?e.get("tenant"):null;return t=t||widget.getValue("x3dPlatformId")},_formatUrl:function(e,t){var i=this.getTenantFromModel(e);return this._formatUrl2(i,t)},_formatUrl2:function(e,t){if(e){var i=t.indexOf("?");i<0&&(t+="?"),i<t.length-1&&(t+="&"),t=t+="tenant="+e}return t},securityContextDispatcher:function(e,i){var n=this;if(e.securityContext)i.call(this,e);else{var s=t.getInstance({tenant:e.tenant}).getSecurityContext({context:e.context,onSuccess:function(t){e.securityContext=t.SecurityContext,i.call(n,e)},onFailure:function(t){n._onFailure(null,{error:t},null,e)}});e.handleRequest&&(e.handleRequest.handle=s)}},_onCompleteAttributes:function(e,t){t.onComplete.call(null,e)},_onCompleteCommit:function(e,t){t.onComplete.call(null,e)},_onFailure:function(e,t,i,n){var s={};s=null!=t&&t.hasOwnProperty("error")?[t.error]:[{msg:UWA.i18n("Error Server"),eventID:"error"}],n.onComplete.call(null,{success:!1,errors:s})},_onTimeout:function(e){var t=[{msg:UWA.i18n("ErrorTimeOut"),eventID:"error"}];e.onComplete.call(null,{success:!1,errors:t})}}}),define("DS/MaskCustomization/models/MaskAttribute",["DS/DataGridWidget/models/SheetLine"],function(e){"use strict";var t=["nameNls"];return e.extend({_startWithPosition:null,_initDefined:!1,init:function(e){var t={},i=null,n=e.init;if(this._initDefined=void 0!==n,n)for(var s in n)"status"===s?t.readonly="RW"!==n.status:t[s]=void 0!==n[s]?n[s]:"";var o={};for(var s in e)"status"===s?o.readonly="RW"!==e.status:("name"===s&&(i=e[s]),"init"!==s&&this.getAvailableOptions().indexOf(s)<0&&(o[s]=void 0!==e[s]?e[s]:""));var a=e.name,r=e.nameNls;r&&(a=r+" ("+a+")"),o._displayName=a,this._parent(i,t,e),this.setValues(o)},hasStartWithPosition:function(){return this._startWithPosition},setPositionRule:function(e,t,i){!0===i&&null!=t&&(this._startWithPosition=!0),this.removePositionRules(),this.setValue(e,t),this.addChangedValue(e)},removePositionRules:function(){this.removeValue("after"),this.removeValue("position"),this.removeValue("after_soft")},getPositionRule:function(){var e={rule:"after",value:null};return e.rule="after",e.value=this.getValue(e.rule),null!==e.value&&void 0!==e.value?e:(e.rule="position",e.value=this.getValue(e.rule),null!==e.value&&void 0!==e.value?e:(e.rule="after_soft",e.value=this.getValue(e.rule),null!==e.value&&void 0!==e.value?e:null))},_propertyCanChange:function(e){return"name"!==e&&"_displayName"!==e&&"nameNls"!==e},hasChanged:function(e){return!1===this._initDefined||this._parent(e)},build:function(e,i){var n=null,s=this.getProperties();for(var o in s)if(!o.startsWith("_")&&(!e||this.hasChanged(o))&&t.indexOf(o)<0){var a=s[o];"readonly"===o?(o="status",a=!0===a?"RO":"RW"):void 0!==i&&"position"===o&&(a=i),null==n&&(n={}),n[o]=UWA.clone(a)}return null!=n&&(n.name=UWA.clone(s.name)),n}})}),define("DS/MaskCustomization/common/Constants",[],function(){"use strict";return{VIEWS:{TYPE_LIST:"typeListView",MASK_EDITOR:"maskEditor",MANAGED_TYPES:"managedTypes"},MERGE_OPTIONS:{MERGE:"merge",REPLACE:"replace"}}}),define("DS/MaskCustomization/views/ViewBase",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Mask"],function(e,t,i){"use strict";return t.extend({onRefresh:function(){},onResize:function(){},launch:function(e){},maskView:function(e){i.mask(this.getUI(),e)},unMaskView:function(){i.unmask(this.getUI())},getUI:function(){return this.elements.container},_dispatchNotifications:function(e){var t=this;e.forEach(function(e){t._dispatchNotification(e)})},_dispatchNotification:function(e){this.dispatchEvent("onNotification",e)},_changeView:function(e){this.dispatchEvent("onChangeView",e)}})}),define("DS/MaskCustomization/popups/ChangePosition",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/SuperModal","DS/UIKIT/Autocomplete","DS/UIKIT/Form","i18n!DS/MaskCustomization/assets/nls/maskCustomization","css!DS/MaskCustomization/MaskCustomization.css"],function(e,t,i,n,s){"use strict";return t.extend({init:function(e){this._parent(e),this.currentRequest={handle:null},this.modal=new i({renderTo:widget.body})},_dispatchNotification:function(e){this.dispatchEvent("onNotification",e)},displayModal:function(e){var t=this,i=e?UWA.clone(e):{},n=new s({className:"horizontal mev_positionChoser",grid:"2 10",fields:[{id:"mev_positionNumber",type:"number",placeholder:"Select an option",min:-1,max:e.attributes.length-1,step:1,label:UWA.i18n("mev_position"),helperText:UWA.i18n("positionInTheList")},{type:"html",html:"<div class='mev_changePosHTML'>"+UWA.i18n("OR")+"</div>"},{type:"autocomplete",label:UWA.i18n("mev_after"),helperText:UWA.i18n("afterInTheList"),showSuggestsOnFocus:!0,datasets:[{items:e.attributes}]}]});i.body=n,i.title=UWA.i18n("Change the position"),i.buttons=[{className:"primary",value:UWA.i18n("Select"),action:function(e){var s=n.autocompletes[0].getValue(),o=n.numbers[0].getValue(),a=o&&o.length>0?o[0]:"";a=""!==a?parseInt(a):void 0,t.dispatchEvent("onComplete",{after:""!==s?s:void 0,position:a,info:i.info}),e.hide()}}],e.info.withRemove&&i.buttons.push({value:UWA.i18n("Remove"),action:function(e){t.dispatchEvent("onComplete",{remove:!0,info:i.info}),e.hide()}}),i.buttons.push({value:UWA.i18n("Cancel"),action:function(e){e.hide()}}),this.modal.dialog(i)}})}),define("DS/MaskCustomization/UI/MaskSkeleton",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Mask","i18n!MaskCustomization/assets/nls/maskCustomization"],function(e,t,i,n){"use strict";return t.extend({views:{},currentFacet:null,init:function(e){var t=this;this._parent(e),this.elements.container=UWA.createElement("div",{class:"MaskCustomization_Skeleton "+(this.options.className?this.options.className:"")}),this.views={},this.currentFacet=null;var i=null;e.views.forEach(function(e){e.id&&(i||(i=e.id),t.views[e.id]=e)})},_hideAllView:function(){for(var e in this.views){var t=this.views[e];t.content&&t.content.getUI().hide()}},_getCurrentSelectedView:function(){return this.currentFacet},_setCurrentSelectedView:function(e){this.currentFacet=e},_launchView:function(e,t){i.unmask(this.elements.container);var n=this.views[e];n.content&&(n.content.launch(t),n.content.getUI().show(),this._setCurrentSelectedView(n))},onRefresh:function(){var e=this._getCurrentSelectedView();e.content&&e.content.onRefresh()},onResize:function(){var e=this._getCurrentSelectedView();e&&e.content&&e.content.onResize()},renderView:function(e,t){var s=this,o=this.views[e];if(o){this._hideAllView();var a=o.content;if(i.mask(this.elements.container,n["msk_Loading view"]),a)this._launchView(e,t);else{var r=o.require;r&&require([r],function(i){var n=s._getCurrentSelectedView();if(null==n||n.id!=e){if(!o||!o.content){var a=o.options,r=(a=a||{}).events;(r=r||{}).onChangeView=function(e){s.renderView(e)},a.events=r,o.content=new i(a);var u=o.content.getUI();u.addClassName("mev_view view_"+o.id),u.inject(s.elements.container)}s._launchView(e,t)}})}}}})}),define("DS/MaskCustomization/ajaxRequests/AjaxRequests",["DS/WidgetServices/WidgetServices","DS/MaskCustomization/ajaxRequests/ServicesAjaxRequests","DS/WAFData/WAFData","i18n!DS/MaskCustomization/assets/nls/maskCustomization"],function(e,t,i){"use strict";var n={createRequest:function(n,s,o,a){n.handleRequest||(n.handleRequest={}),n.handleRequest.handle=e.get3DSpaceUrlAsync({onComplete:function(e){var r=e+o,u={Accept:"application/json","content-type":"application/json"};u["Accept-Language"]=widget.lang;var l=n.securityContext;l&&(u.SecurityContext=encodeURIComponent(l));var c={type:"json",method:s,timeout:36e5,proxy:"passport",headers:u,onComplete:function(e){n.onComplete(e)},onFailure:function(e,i,s){t._onFailure(e,i,s,n)},onTimeout:function(e){t._onTimeout(n)}};widget.getValue("isStandalone")||(c.authentication="passport"),a&&(c.data=UWA.Json.encode(a)),n.handleRequest.handle=i.handleRequest(t._formatUrl(null,r),c)}})},getListOfCustomizedTypes:function(e){n.createRequest(e,"GET","/resources/v1/collabServices/masks/op/list",null)},getMaskElement:function(e){var t="/resources/v1/collabServices/masks/op/getMaskForProperties?type="+e.type+"&elementType="+e.category;n.createRequest(e,"GET",t,null)},createNewMask:function(e){var t={masks:[{type:e.type,content:e.content?e.content:{}}]},i="/resources/v1/collabServices/masks/op/create?elementType="+e.category;n.createRequest(e,"POST",i,t)},getTypes:function(e){var t="/resources/v1/collabServices/masks/op/types?type="+e.type+"&category="+e.category+"&maxNumber=5";n.createRequest(e,"GET",t,null)},getAttributes:function(e){var t="/resources/v1/collabServices/masks/op/attributes?type="+e.type+"&elementType="+e.category;n.createRequest(e,"GET",t,null)},removeCustomizedType:function(e){var t="/resources/v1/collabServices/masks/op/remove?type="+e.type+"&elementType="+e.category;n.createRequest(e,"DELETE",t,null)},getManagedTypes:function(e){n.createRequest(e,"GET","/resources/v1/collabServices/masks/op/managedTypes",null)},updateManagedTypes:function(e){var t="/resources/v1/collabServices/masks/op/recomputeDSMask"+(e.type?"?type="+e.type:"");n.createRequest(e,"POST",t,null)}};return{getListOfCustomizedTypes:function(e){t.securityContextDispatcher(e,n.getListOfCustomizedTypes)},getMaskElement:function(e){t.securityContextDispatcher(e,n.getMaskElement)},createNewMask:function(e){t.securityContextDispatcher(e,n.createNewMask)},getTypes:function(e){t.securityContextDispatcher(e,n.getTypes)},getAttributes:function(e){t.securityContextDispatcher(e,n.getAttributes)},removeCustomizedType:function(e){t.securityContextDispatcher(e,n.removeCustomizedType)},getManagedTypes:function(e){t.securityContextDispatcher(e,n.getManagedTypes)},updateManagedTypes:function(e){t.securityContextDispatcher(e,n.updateManagedTypes)}}}),define("DS/MaskCustomization/views/ManagedTypesView",["UWA/Core","DS/MaskCustomization/views/ViewBase","DS/MaskCustomization/ajaxRequests/AjaxRequests","DS/MaskCustomization/ajaxRequests/ServicesAjaxRequests","DS/MaskCustomization/common/Constants","DS/WidgetServicesUI/helpers/Constants","DS/DataGridWidget/Datasheet","DS/UIKIT/Mask","DS/Controls/Button","DS/DataGridWidget/models/SheetLine","i18n!MaskCustomization/assets/nls/maskCustomization"],function(e,t,i,n,s,o,a,r,u,l,c){"use strict";return t.extend({init:function(e){this._parent(e),this.initUI()},initUI:function(){var e=this;this.elements.container=UWA.createElement("div"),this.elements.buttons={};var t=UWA.createElement("div",{class:"mev_buttonContainer"}).inject(this.elements.container);this.elements.buttons.back=new u({icon:"arrow-circle-left",displayStyle:"lite",iconSize:"2x",label:UWA.i18n("mev_back"),onClick:function(){e._goBack()}}).inject(t),this.elements.grid=this._createTable(),this.elements.grid.inject(this.elements.container)},_createLinesFromAnswer:function(e){var t=e.types,i=[];if(t)for(var n in t)if(!n.startsWith("__")){var s=t[n],o=s.reference,a=s.compiled,r={name:n,computation:{parameters:{type:n}},compilation:{parameters:{type:n}}};o&&(r.computationDate=new Date(o)),a&&(r.compilationDate=new Date(a));var u=new l(n,r);u.addEvent("onPropChanged:computation",function(e){this.changeValue("computationDate",new Date)}),u.addEvent("onPropChanged:compilation",function(e){this.changeValue("compilationDate",new Date)}),i.push(u)}this.elements.grid.addLinesSheet(i)},_launchSearch:function(){var e=this;r.mask(this.elements.container),i.getManagedTypes({onComplete:function(t){if(e.elements.grid.removeAll(),r.unmask(e.elements.container),!0===t.success)e._createLinesFromAnswer(t);else{var i=t.errors;i&&i.forEach(function(t){e._dispatchNotification(t)})}}})},onRefresh:function(){this._launchSearch()},launch:function(e){this._launchSearch()},_goBack:function(){this._changeView(s.VIEWS.TYPE_LIST)},_createTable:function(){var e=this,t={name:"managedTypesTable",className:"managedTypesTable",setHeaderColumn:!0,setScroller:!0,restrict:!0,rollback:!1,useNativeScroller:!1,activeSelection:!1,events:{onNotification:function(t){e._dispatchNotification(t)}}},i=[{text:UWA.i18n("name"),dataIndex:"name",sortable:!0,sortKey:function(e){return e}},{text:UWA.i18n("mtv_computation"),type:o.TYPES.BUTTONWEB,dataIndex:"computation",editable:!0,inputOptions:{data:{url:"/resources/v1/collabServices/masks/op/recomputeDSMask",method:"POST"}}},{text:UWA.i18n("mtv_computation_date"),type:o.TYPES.DATETIME,dataIndex:"computationDate",editable:!1},{text:UWA.i18n("mtv_compilation"),type:o.TYPES.BUTTONWEB,dataIndex:"compilation",editable:!0,inputOptions:{data:{url:"/resources/v1/collabServices/masks/op/recomputeCompiledMask",method:"POST"}}},{text:UWA.i18n("mtv_compilation_date"),type:o.TYPES.DATETIME,dataIndex:"compilationDate",editable:!1}];return new a(i,t)}})}),define("DS/MaskCustomization/models/MaskOptions",["DS/MaskCustomization/common/Constants"],function(e){"use strict";return function(t){for(var i in t)this[i]=t[i];this.getMergeOption=function(){return this.mergeOption},this.isMerge=function(){return this.getMergeOption()===e.MERGE_OPTIONS.MERGE},this.isForceReplace=function(){return this.getMergeOption()===e.MERGE_OPTIONS.REPLACE},this.setMergeOption=function(e){this.mergeOption=e},this.removeMergeOption=function(){delete this.mergeOption},this.build=function(){var e=this.getMergeOption(),t=null;return e&&(t={mergeOption:e}),t}}}),define("DS/MaskCustomization/models/MaskElementBase",["UWA/Class","DS/MaskCustomization/models/MaskAttribute","DS/MaskCustomization/models/MaskOptions"],function(e,t,i){"use strict";return e.extend({init:function(e,t){for(var n in this._parent(t),this.options=void 0,this._events={},e)"options"===n?this.__setOptions(new i(e[n])):"attributes"===n?this._initializeAttr(e[n]):this[n]=e[n]},_initializeAttr:function(e){},getAttributes:function(){},getAttribute:function(e){},getAttributesIds:function(){},getAttributesWithProperty:function(e,t){},addNewAttribute:function(e){},build:function(e,t){},saveValues:function(){},onAttributeAdd:function(e){this.__addEvent("addAttribute",e)},onAttributesMove:function(e){this.__addEvent("moveAttributes",e)},dispatchEvent:function(e,t){var i=this,n=this._events[e];void 0!==n&&n.forEach(function(e){e.call(i,t)})},__getOptions:function(){return this.options},__setOptions:function(e){this.options=e},__addEvent:function(e,t){var i=this._events[e];void 0===i&&(i=[],this._events[e]=i),i.push(t)},getMergeOption:function(){var e=this.__getOptions(),t=null;return e&&(t=e.getMergeOption()),t},setMergeOption:function(e){var t=this.__getOptions();t||(t=new i),this.__setOptions(t),!e&&t.getMergeOption()?t.removeMergeOption():t.setMergeOption(e)}})}),define("DS/MaskCustomization/facets/CommonFacet",["DS/EditPropWidget/facets/Common/FacetsCore","DS/MaskCustomization/models/MaskElementBase","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/Controls/Button","DS/DataGridWidget/Datasheet","DS/MaskCustomization/common/Constants"],function(e,t,i,n,s,o,a){return e.extend({init:function(e){this._parent(e),this.elements.datagrid=null,this.elements.container=UWA.createElement("div",{class:"containerMask"})},updateFacet:function(){var e=this,o=this.getContext();if(this.elements.container.empty(),o&&o.models){var r=o.view,u=this.getTabId();models=o.models;var l=models.getCompiledMask(),c=models.getCustomizedMask(),d=l.getElement(u);if(d&&d instanceof t){var m=[],h=UWA.createElement("div",{class:"mev_grid mev_grid_"+u.replace(/" "/g,"-")}).inject(this.elements.container),f=UWA.createElement("div",{class:"mev_optionsLine"}).inject(h),p=c.getElement(u),v=!1;p&&(v=p.getMergeOption()!==a.MERGE_OPTIONS.MERGE),d.setMergeOption(v?a.MERGE_OPTIONS.REPLACE:a.MERGE_OPTIONS.MERGE);var g=new i({type:"switch",label:UWA.i18n("mev_replaceMask"),className:"mev_replaceToggle",checked:v,events:{onChange:function(){var e=this.isChecked();d.setMergeOption(e?a.MERGE_OPTIONS.REPLACE:a.MERGE_OPTIONS.MERGE)}}});new n({target:g.getContent(),body:UWA.i18n("replaceHelper")});var C=UWA.createElement("div",{class:"mev_addAttributes"}).inject(f);new s({icon:"plus",displayStyle:"lite-borders",iconSize:"2x",label:UWA.i18n("addAttribute"),onClick:function(){var e=d.getAttributesIds();r.elements.attributesPopup.displayModal({type:o.type.type,category:o.type.category,except:e,info:{grid:u}})}}).inject(C),g.inject(f);var b=e.elements.datagrid=e._createTable({elementName:u,rollback:!v,events:{onPointingEvent:function(e){if("_position"===e.cellPosition.headerIndex){var t=e.cellPosition.line;if("function"==typeof t.getData){var i=t.getData();console.log(i.getID());var n=[];this.getAllLines().forEach(function(e){n.push({label:e.getData().getValue("_displayName"),value:e.getID()})}),r.elements.positionPopup.displayModal({attributes:n,info:{line:i,lineId:i.getID(),withRemove:!!i.getPositionRule(),grid:u}})}}}}});b.inject(h),d.onAttributeAdd(function(t){e._managePositionOnAttribute(b,t),b.addLinesSheet([t])}),d.onAttributesMove(function(){var e=d.getAttributesIds();b.sortFromList(e)});var _=d.getAttributes();_&&_.forEach(function(t){if(e._managePositionOnAttribute(b,t),p){var i=p.getAttribute(t.getID());if(i){var n=i.getValue("after"),s=i.getValue("position");void 0!==n?t.setPositionRule("after",n,!0):void 0!==s&&t.setPositionRule("position",s,!0),t.addChangedValues(Object.keys(i.getProperties()))}}t.setColor(!0!==t._initDefined),t.setRollbackOnCells(!0===t._initDefined),t.setInitializationAuthorization(!0),m.push(t)}),b.addLinesSheet(m)}}},_managePositionOnAttribute:function(e,t){var i=UWA.createElement("div",{class:"mev_positionColumn fonticon",title:""});t.setValue("_position",i),t.addEvent("onChange",function(t){var n=null,s="";switch(t){case"after":n="fonticon-expand-up",s=UWA.i18n("hardLockAfter");break;case"position":n="fonticon-arrow-combo-horizontal",s=UWA.i18n("positionLocked");break;case"after_soft":n="fonticon-chevron-up",s=UWA.i18n("softLockAfter")}if(null!==n){var o=!(null!==this.getValue(t)&&void 0!==this.getValue(t));o&&!0===this.hasStartWithPosition()&&(n="fonticon-attention",s=UWA.i18n("warningPositionRefresh"),o=!1);var a="mev_positionColumn fonticon"+(o?"":" "+n);i.className=a,e.getTweaker(this,"_position",function(e){e&&e.setTooltip(o?"":s)})}})},_createTable:function(e){var t={name:"maskTable",className:"maskTable",setHeaderColumn:!0,setScroller:!0,restrict:!0,colorization:!0,useNativeScroller:!1,activeSelection:!1};if(e)for(var i in e)t[i]=e[i];var n=null;return n="details"===e.elementName?[{text:UWA.i18n("name"),sortable:!0,defaultSort:!0,sortKey:function(e){return e},dataIndex:"_displayName"},{text:UWA.i18n("forbidden char"),type:"string",dataIndex:"forbiddenChar",defaultValue:"",editable:!0},{text:UWA.i18n("mandatory"),type:"boolean",dataIndex:"mandatory",defaultValue:!1,editable:!0},{text:UWA.i18n("remove"),dataIndex:"remove",type:"boolean",defaultValue:!1,editable:!0}]:[{html:"<span class='fonticon fonticon-target'></span>",type:"html",defaultValue:"",dataIndex:"_position"},{text:UWA.i18n("name"),dataIndex:"_displayName"},{text:UWA.i18n("readonly"),dataIndex:"readonly",type:"boolean",defaultValue:!0,editable:!0},{text:UWA.i18n("remove"),dataIndex:"remove",type:"boolean",defaultValue:!1,editable:!0}],new o(n,t)},onResize:function(){this.elements.datagrid&&this.elements.datagrid.resizeTable()}})}),define("DS/MaskCustomization/popups/SearchTypes",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/SuperModal","DS/UIKIT/Autocomplete","DS/MaskCustomization/ajaxRequests/AjaxRequests","DS/WidgetServices/WidgetServices","i18n!DS/MaskCustomization/assets/nls/maskCustomization"],function(e,t,i,n,s,o){"use strict";var a=function(e,t){var i=this;this.type=e;var n={dataParser:function(e,t){return function(e,t){var i=[];return e.forEach(function(e){if(e.nameNls){var n={};n.label=e.nameNls,n.value={type:e.name,category:t},n.subLabel=e.name,i.push(n)}}),i}(t[i.type],i.type)},onError:function(e,i){var n=e.errors;n&&n.forEach(function(e){var i=e;e.message&&(i={msg:e.message,eventID:e.type.toLowerCase()}),t._dispatchNotification(i)})},remoteSearchEngine:function(e,t){return new Promise(function(o,a){s.getTypes({type:t,category:i.type,onComplete:function(t){var i={};0==t.success?(i.type="error",i.errors=t.errors,i.dataset=e,a(i)):(i.dataset=e,i.matchingItems=n.dataParser(e,t.data),o(i))}})})}};this.getConfig=function(){return n}};return t.extend({configuration:null,init:function(e){this._parent(e),this.modal=new i({renderTo:widget.body})},_dispatchNotification:function(e){this.dispatchEvent("onNotification",e)},displayModal:function(e){var t=this;e=e||{};var i=new n({}),s=new a("BUS",this);if(i.addDataset({name:UWA.i18n("st_type"),displayName:!0,items:[]},s.getConfig()),!o.isReplayedODT()){s=new a("ITF",this);i.addDataset({name:UWA.i18n("st_interface"),displayName:!0,items:[]},s.getConfig());s=new a("REL",this);i.addDataset({name:UWA.i18n("st_relationship"),displayName:!0,items:[]},s.getConfig())}e.body=i,e.title=UWA.i18n("Choose a type"),e.buttons=[{className:"primary",value:UWA.i18n("Create"),action:function(e){var n=i.selectedItems;if(n.length>0){var s=n[0];t.dispatchEvent("onComplete",{type:s.value.type,category:s.value.category})}e.hide()}},{value:UWA.i18n("Cancel"),action:function(e){e.hide()}}],this.modal.dialog(e)}})}),define("DS/MaskCustomization/views/TypesListView",["UWA/Core","DS/MaskCustomization/views/ViewBase","DS/MaskCustomization/ajaxRequests/AjaxRequests","DS/MaskCustomization/popups/SearchTypes","DS/MaskCustomization/common/Constants","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/UIKIT/Input/Button","DS/Controls/Button","DS/Tree/ThumbnailGridView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","i18n!MaskCustomization/assets/nls/maskCustomization"],function(e,t,i,n,s,o,a,r,u,l,c,d,m,h){"use strict";return t.extend({init:function(e){this._parent(e),this.variables=this.variables?this.variables:{},this.variables.removeMode=!1,this.initUI()},initUI:function(){var e=this;this.elements.container=UWA.createElement("div"),this.elements.typesPopup=new n({events:{onNotification:function(t){e._dispatchNotification(t)},onComplete:function(t){e.maskView(UWA.i18n("mev_creatingMask")),i.createNewMask({type:t.type,category:t.category,onComplete:function(t){if(e.unMaskView(),!1===t.success){var i=t.errors?t.errors:t.error?[{msg:t.error,eventID:"error"}]:null;i&&e._dispatchNotifications(i)}else e.onRefresh(),e._dispatchNotification({msg:UWA.i18n("Creation succeeded"),eventID:"success"})}})}}}),this.elements.validationRemoveButton=new o({renderTo:widget.body}),this.elements.grid=new l({model:[],checkboxVisibleFlag:!1,selection:{canMultiSelect:!1,enableListSelection:!1},enableActiveUI:!0,enableKeyboardNavigation:!0,performances:{preloadPool:!0,useRequestAnimationFrameRendering:!1},onContextualEvent:{callback:function(t){var i=[];if(t&&t.cellInfos&&t.cellInfos.nodeModel){var n=t.cellInfos.nodeModel;i.push({type:"PushItem",title:UWA.i18n("mev_openMask"),icon:m.getWebappsAssetUrl("MaskCustomization","icons/iconActionOpen.png"),action:{callback:function(t){void 0!==n&&e.dispatchEvent("onSelection",n.options.data)}}}),i.push({type:"SeparatorItem"}),i.push({type:"PushItem",title:UWA.i18n("mev_removeMask"),icon:m.getWebappsAssetUrl("MaskCustomization","icons/I_PLMDelete.png"),action:{callback:function(t){void 0!==n&&e._removeType(n.options.data)}}})}return i}},height:"auto"});var t=UWA.createElement("div",{class:"mev_buttonContainer"}).inject(this.elements.container),r=UWA.createElement("div",{class:"mev_gridContainer"}).inject(this.elements.container),u=UWA.createElement("div",{class:"fonticon fonticon-plus  fonticon-2x",events:{click:function(){e.elements.typesPopup.displayModal()}}}).inject(t);new a({delay:{show:400},position:"bottom left",target:u,body:UWA.i18n("mev_addMask")});var d=UWA.createElement("div",{class:"fonticon fonticon-list  fonticon-2x",events:{click:function(){e._changeView(s.VIEWS.MANAGED_TYPES)}}}).inject(t);new a({delay:{show:400},position:"bottom left",target:d,body:UWA.i18n("mev_managedTypes")}),this.elements.treeDocument=new c({}),this.elements.grid.loadGridViewModel(this.elements.treeDocument),this.elements.grid.inject(r)},_removeType:function(e){var t=this,n=e.type,s=e.category;this.elements.validationRemoveButton.confirm(UWA.i18n("msgRemoveConfirmation"),UWA.i18n("titleRemoveConfirmation"),function(e){!0===e&&i.removeCustomizedType({type:n,category:s,onComplete:function(e){!0!==e.success?t._manageErrors(e):(t.onRefresh(),t._dispatchNotification({msg:UWA.i18n("removal succeeded"),eventID:"success"}))}})})},launch:function(){this.onRefresh()},onRefresh:function(){this.elements.treeDocument&&this.elements.treeDocument.removeRoots(),this._loadTypes()},_manageErrors:function(e){var t=this,i=e.errors;i&&i.forEach(function(e){t._dispatchNotification(e)})},_loadTypes:function(){var e=this;this.maskView(UWA.i18n("mev_loadingMasks")),i.getListOfCustomizedTypes({onComplete:function(t){if(e.unMaskView(),e.elements.treeDocument&&e.elements.treeDocument.removeRoots(),!0!==t.success)e._manageErrors(t);else{var i=t.data;i&&i.forEach(function(t){var i=new d({label:t.nlsName,subLabel:t.name,thumbnail:t.icon,vpm_editedDataIndex:{},data:{type:t.name,typenls:t.nlsName,category:t.elementType},grid:{rand:Math.ceil(10*Math.random())},useAsyncPreExpand:!0,asyncChildren:[]});e.elements.treeDocument.addRoot(i)})}}})}})}),define("DS/MaskCustomization/models/MaskDetails",["DS/MaskCustomization/models/MaskElementBase","DS/MaskCustomization/models/MaskAttribute","DS/MaskCustomization/models/MaskOptions"],function(e,t,i){"use strict";return e.extend({init:function(e,t){this.attributes={},this._parent(e,t)},_initializeAttr:function(e){for(var i in e){var n=e[i];n.name=i,this.attributes[i]=new t(n)}},getAttribute:function(e){return this.attributes[e]},getAttributes:function(){var e=[];for(var t in this.attributes){var i=this.attributes[t];e.push(i)}return e},getAttributesIds:function(){return Object.keys(this.attributes)},getAttributesWithProperty:function(e,t){var i=[];for(var n in this.attributes){var s=this.attributes[n];s.getValue(e)===t&&i.push(s)}return i},addNewAttribute:function(e){e instanceof t&&(this.attributes[e.getID()]=e,this.dispatchEvent("addAttribute",e))},build:function(e,t){var i={},n=this.__getOptions(),s=void 0!==n&&n.isMerge(),o=(void 0!==n&&n.isForceReplace(),this.attributes);for(var a in o){var r=o[a],u=r.build(e||s);null!==u&&(delete u.name,i[r.getID()]=u)}var l={attributes:i},c=n?n.build():null;return c&&(l.options=c),l},saveValues:function(){for(var e in this.attributes){this.attributes[e].saveValues()}}})}),define("DS/MaskCustomization/popups/SearchAttributes",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/SuperModal","DS/UIKIT/Autocomplete","DS/MaskCustomization/ajaxRequests/AjaxRequests","i18n!DS/MaskCustomization/assets/nls/maskCustomization"],function(e,t,i,n,s){"use strict";return t.extend({init:function(e){this._parent(e),this.currentRequest={handle:null},this.modal=new i({renderTo:widget.body})},_dispatchNotification:function(e){this.dispatchEvent("onNotification",e)},displayModal:function(e){var t=this,i=e?UWA.clone(e):{},o=new n({showSuggestsOnFocus:!0,allowFreeInput:!0});this.currentRequest.handle&&(this.currentRequest.handle.cancel(),this.currentRequest.handle=null),s.getAttributes({type:i.type,category:i.category,handleRequest:this.currentRequest,onComplete:function(e){if(t.currentRequest.handle=null,0==e.success){e.errors.forEach(function(e){var i={msg:e.message,eventID:e.type.toLowerCase()};t._dispatchNotification(i)})}else{var n=[],s=i.except?i.except:[];e.data.forEach(function(e){var t=!1;s.every(function(i){return!(t=e.name===i)}),t||n.push({value:e.name,label:e.nameNls,subLabel:e.name})}),o.addDataset({name:"Attributes",items:n})}}}),i.body=o,i.title=UWA.i18n("Choose an attribute"),i.buttons=[{className:"primary",value:UWA.i18n("Select"),action:function(e){var n=o.selectedItems,s=n&&n.length>0?n[0]:null;s=s||o.elements.input.value,t.dispatchEvent("onComplete",{attribute:{value:"object"==typeof s?s.value:s,label:s.label},info:i.info}),e.hide()}},{value:UWA.i18n("Cancel"),action:function(e){e.hide()}}],this.modal.dialog(i)}})}),define("DS/MaskCustomization/models/MaskElement",["DS/MaskCustomization/models/MaskElementBase","DS/MaskCustomization/models/MaskAttribute","DS/MaskCustomization/models/MaskOptions"],function(e,t,i){"use strict";return e.extend({_moveHistory:[],_initialIdList:null,init:function(e,t){this.attributes=[],this._moveHistory=[],this._initialIdList=null,this._parent(e,t)},_initializeAttr:function(e){var i=this;e.forEach(function(e){i.attributes.push(new t(e))})},getAttribute:function(e){var t=null;return this.attributes.every(function(i){return i.getID()===e&&(t=i),null===t}),t},getAttributes:function(){return this.attributes},getAttributesIds:function(){var e=[];return this.attributes.forEach(function(t){e.push(t.getID())}),e},getAttributesWithProperty:function(e,t){var i=[];return this.attributes.forEach(function(n){n.getValue(e)===t&&i.push(n)}),i},addNewAttribute:function(e){e instanceof t&&(this.attributes.push(e),this.dispatchEvent("addAttribute",e))},getAttributePosition:function(e){for(var t=null,i=this.attributes.length,n=0;n<i;n++)if(this.attributes[n].getID()===e){t=n;break}return t},moveAttributesLinkedTo:function(e,t,i,n){var s=this,o=null;if(e===i&&(o=UWA.i18n("mev_afterSameAttribute")),!o){null==this._initialIdList&&(this._initialIdList=this.getAttributesIds());var a=this.getAttributePosition(e),r=this.getAttributesLinkedTo(a,!1),u=r.length,l=this.attributes.splice(a,u);if(u>0&&(void 0!==i&&l.every(function(e){return e.getID()===i&&(o=UWA.i18n("mev_attributeInAfter")),null===o}),!o)){var c=r[0];if(void 0!==i){this.getAttributesWithProperty("after",i).forEach(function(e){e.removePositionRules()}),c.setPositionRule("after",i);var d=this.getAttributePosition(i);t=null!==d?d+1:t}else{c.setPositionRule("position",t);for(var m=t;m<s.attributes.length;m++){var h=s.attributes[m],f=s.attributes[m].getPositionRule();if(null==f||"position"===f.rule){if(t=m,null==f||m===t)break;h.setPositionRule("position",m)}}}t<0&&(t=this.attributes.length);var p=Math.min(t,this.attributes.length);this._addInArray(s.attributes,l,p);var v=[],g=null,C=null,b=0,_=0,y=0,S=s.attributes.length;s.attributes.forEach(function(e){var t=!1,i=e.getPositionRule(),n=!!i&&"after"===i.rule,o=!!i&&"after_soft"===i.rule,a=!!i&&"position"===i.rule,r=n||o,u=null===i;if(null!=g&&r?g.push(e):null!=g&&u?t=!0:null==g&&r?_=0:n||a&&(null!=g&&(t=!0),i.value<b&&_>0&&(y=Math.min(b-i.value,_),(C=[]).push(e))),u&&_++,null!=g&&(t||S==b+1)){var l=v.length;s._addInArray(v,g,l-y),g=null}if(null!=C&&(g=C,C=null),null==g&&v.push(e),null!=g&&S==b+1){l=v.length;s._addInArray(v,g,l-y),g=null}b++}),s.attributes=v,this._moveHistory.push({key:e,value:{previousAttributeId:i,newPosition:t}}),!0===n&&this.dispatchEvent("moveAttributes")}}if(o)return{eventID:"error",msg:o}},_addInArray:function(e,t,i){var n=i;t.forEach(function(t){e.splice(n,0,t),n++})},getAttributesLinkedTo:function(e,t){var i=this.attributes.length,n=[],s=[];if(e<i){var o=this.attributes[e];n.push(o),s.push(o.getID()),e++}for(var a=e;a<i;a++){var r=(o=this.attributes[a]).getValue("after"),u=o.getValue("soft_after");if(!(r&&s.indexOf(r)>=0||u&&s.indexOf(u)>=0))break;n.push(o),s.push(o.getID())}return!0===t?s:n},_resetPositions:function(){if(null!=this._initialIdList){var e={};this.attributes.forEach(function(t){e[t.getID()]=t});var t=[];this._initialIdList.forEach(function(i){var n=e[i];n&&t.push(n)}),this.attributes=t}},forgetMove:function(e){var t=this;this._resetPositions();var i=[];this._moveHistory.forEach(function(n){if(n.key!=e){var s=n.value;t.moveAttributesLinkedTo(n.key,s.newPosition,s.previousAttributeId,!1)}else i.push(n)}),this._moveHistory=i,this.getAttribute(e).removePositionRules(),this.dispatchEvent("moveAttributes")},moveAttributeAfter:function(e,t){return this.moveAttributesLinkedTo(e,null,t,!0)},moveAttributeAt:function(e,t){return this.moveAttributesLinkedTo(e,t,void 0,!0)},build:function(e,t){for(var i=[],n=this.__getOptions(),s=[],o=void 0!==n&&n.isMerge(),a=void 0!==n&&n.isForceReplace(),r=o||!a&&t,u=this.attributes,l=u.length,c=0;c<l;c++){var d=u[c],m=d.build(e||o,c);null!==m&&(r&&null!==d.getPositionRule()?s.push(m):i.push(m))}var h={attributes:i=i.concat(s)},f=n?n.build():null;return f&&(h.options=f),h},saveValues:function(){this.attributes.forEach(function(e){e.saveValues()})}})}),define("DS/MaskCustomization/models/MaskModel",["DS/MaskCustomization/models/MaskElement","DS/MaskCustomization/models/MaskDetails","DS/MaskCustomization/models/MaskOptions"],function(e,t,i){"use strict";return function(n){var s=this;for(var o in this._elements={},n)"options"===o&&(this[o]=new i(n[o])),this._elements[o]="details"===o?new t(n[o]):new e(n[o]);this.getElements=function(){return this._elements},this.getElement=function(e){return this._elements[e]};var a=function(){return s.options};this.getMergeOption=function(){var e=a(),t=null;return e&&(t=e.getMergeOption()),t},this.setMergeOption=function(e){var t=a();t||(t=new i),function(e){s.options=e}(t),!e&&t.getMergeOption()?t.removeMergeOption():t.setMergeOption(e)},this.build=function(e){var t={},i=a(),n=this.getElements();for(var s in n){var o=n[s],r=void 0!==i&&i.isMerge();t[s]=o.build(e||r,r)}var u=i?i.build():null;return u&&(t.options=u),t},this.saveValues=function(){var e=this.getElements();for(var t in e)e[t].saveValues()}}}),define("DS/MaskCustomization/MaskCustomization",["UWA/Core","UWA/Controls/Abstract","UWA/Json","DS/MaskCustomization/UI/MaskSkeleton","DS/MaskCustomization/common/Constants","css!DS/MaskCustomization/MaskCustomization.css"],function(e,t,i,n,s){"use strict";return t.extend({errorOverlay:null,defaultOptions:{className:""},init:function(e){this._parent(e),this.errorOverlay=null,this.initUI()},initUI:function(){var e=this,t={onNotification:function(t){e._addNotif(t)}},i={views:[{id:s.VIEWS.TYPE_LIST,require:"DS/MaskCustomization/views/TypesListView",options:{events:UWA.merge({onSelection:function(e){o.renderView(s.VIEWS.MASK_EDITOR,e)}},t)}},{id:s.VIEWS.MASK_EDITOR,require:"DS/MaskCustomization/views/MaskEditorView",options:{events:t}},{id:s.VIEWS.MANAGED_TYPES,require:"DS/MaskCustomization/views/ManagedTypesView",options:{events:t}}]};this.options.className&&(i.className=this.options.className);var o=this.elements.skeleton=this.elements.container=new n(i);o.renderView(s.VIEWS.TYPE_LIST)},onRefresh:function(){this.elements.skeleton&&this.elements.skeleton.onRefresh()},onResize:function(){this.elements.skeleton&&this.elements.skeleton.onResize()},_getErrorManager:function(e){var t=this;this.errorOverlay?e.call(null,this.errorOverlay):require(["DS/ErrorWidget/ErrorWidget"],function(i){t.errorOverlay||(t.errorOverlay=new i(widget,t.elements.container.getContent(),{className:"maskCustomization_errorManager"})),e.call(null,t.errorOverlay)})},_addNotif:function(e){var t=e.msg?e.msg:e.message,i=e.eventID,n=e.customClass;switch(i){case"error":t=t||e.json,this._addError(t,n);break;case"warning":this._addWarning(t,n);break;case"success":this._addSuccess(t,n);break;default:this._addInfo(t,n)}},_addInfo:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addInfo(e,t);i.dispatchEvent("onNotification",s)})},_addWarning:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addWarning(e,t);i.dispatchEvent("onNotification",s)})},_addSuccess:function(e,t){var i=this;this._getErrorManager(function(n){var s=n.addSuccess(e,t);i.dispatchEvent("onNotification",s)})},_addError:function(e,t){var n=this;this._getErrorManager(function(s){var o=s.displayJSONError(i.encode(e),t);n.dispatchEvent("onNotification",o)})}})}),define("DS/MaskCustomization/MaskCustomizationHTML",["DS/MaskCustomization/MaskCustomization","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WidgetServices/WidgetServices","i18n!MaskCustomization/assets/nls/maskCustomization"],function(e,t,i,n){return{launch:function(){i.getTenants(function(t){widget.addPreference({name:"mc_tenant",type:"list",label:n.mc_tenant,defaultValue:i.getTenantID(),options:t});var s=null,o=function(){s=new e,widget.body.setContent(s)},a=function(){s&&s.onRefresh()},r=function(e){s&&s.onResize()};widget.addEvent("onLoad",o),widget.addEvent("onRefresh",a),widget.addEvent("onResize",r),widget.setAutoRefresh(6048e3)})}}}),define("DS/MaskCustomization/models/MaskModels",["DS/MaskCustomization/models/MaskModel"],function(e){"use strict";return function(t){var i=new e(t.compiled),n=new e(t.customized);this.getCompiledMask=function(){return i},this.getCustomizedMask=function(){return n}}}),define("DS/MaskCustomization/views/MaskEditorView",["UWA/Core","DS/Core/ModelEvents","DS/MaskCustomization/views/ViewBase","DS/MaskCustomization/ajaxRequests/AjaxRequests","DS/MaskCustomization/popups/SearchTypes","DS/MaskCustomization/common/Constants","DS/MaskCustomization/models/MaskModel","DS/MaskCustomization/models/MaskModels","DS/MaskCustomization/models/MaskAttribute","DS/MaskCustomization/popups/SearchAttributes","DS/MaskCustomization/popups/ChangePosition","DS/Tree/ThumbnailGridView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/Button","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/WidgetServicesUI/helpers/Constants","DS/EditPropWidget/UI/IDCardSkeleton"],function(e,t,i,n,s,o,a,r,u,l,c,d,m,h,f,p,v,g,C,b){"use strict";return i.extend({init:function(e){var t=this;this._currentType=null,this._parent(e),this.elements.container=UWA.createElement("div"),this.elements.buttons={};var i=UWA.createElement("div",{class:"mev_buttonContainer"}).inject(this.elements.container);this.elements.buttons.back=new f({icon:"arrow-circle-left",displayStyle:"lite",iconSize:"2x",label:UWA.i18n("mev_back"),onClick:function(){t._goBack()}}).inject(i),this.elements.middleContainer=UWA.createElement("div",{class:"mev_middleDiv"}).inject(this.elements.container),this.elements.idCard=new b([],{className:"maskIdCard",closeButton:!1,sharedContext:{models:null,view:this,type:this._currentType}}),this.elements.idCard.inject(this.elements.middleContainer),this.elements.positionPopup=new c({events:{onNotification:function(e){t._dispatchNotification(e)},onComplete:function(e){var i=e.info;if(i&&i.grid){var n=i.lineId,s=t.elements.maskModel.getCompiledMask().getElement(i.grid);if(!0===e.remove)s.forgetMove(n);else{var o=e.after,a=e.position;if(void 0!==o){var r=s.moveAttributeAfter(n,o);r&&t._dispatchNotification(r)}else void 0!==a&&s.moveAttributeAt(n,a)}}}}}),this.elements.attributesPopup=new l({events:{onNotification:function(e){t._dispatchNotification(e)},onComplete:function(e){var i=e.info;if(i&&i.grid){var n=new u({name:e.attribute.value,nameNls:e.attribute.label,created:!0,authorizedInitialization:!0,rollbackOnCell:!1});if(n.addChangedValue("name",!0),n.setColor(!0),t.elements.maskModel)(e=t.elements.maskModel.getCompiledMask().getElement(i.grid)).addNewAttribute(n)}console.log(e.attribute)}}});var n=UWA.createElement("div",{class:"mev_bottomButtons"}).inject(this.elements.container);this.elements.buttons.valid=new p({className:"primary",value:UWA.i18n("mev_valid")}).inject(n),this.elements.buttons.valid.addEvent("onClick",function(){t._modifyCusto()})},onRefresh:function(){this._launch()},_goBack:function(){this._changeView(o.VIEWS.TYPE_LIST)},_modifyCusto:function(){v.mask(this.elements.container);var e={},t=this;this.elements.maskModel&&(e=this.elements.maskModel.getCompiledMask().build(!1));n.createNewMask({type:this._currentType.type,category:this._currentType.category,content:e,onComplete:function(e){if(v.unmask(t.elements.container),!0===e.success)t._onCompleteSave(e),t._dispatchNotification({eventID:"success",msg:UWA.i18n("mev_updated")});else{var i=e.errors;i&&i.forEach(function(e){t._dispatchNotification(e)})}}})},_clearDatagrid:function(){},launch:function(e){this._currentType={type:e.type,category:e.category,typenls:e.typenls},this._launch()},_launch:function(){var e=this;this.maskView(UWA.i18n("mev_loadingMask")),n.getMaskElement({type:this._currentType.type,category:this._currentType.category,onComplete:function(t){if(e.unMaskView(),!0===t.success){var i=t.data;i&&e._onComplete(i)}else{var n=t.errors;n&&n.forEach(function(t){e._dispatchNotification(t)})}}})},_onCompleteSave:function(e){e.results&&this._currentType&&this._currentType.type&&this._onComplete(e.results[this._currentType.type])},onResize:function(){},_clearAll:function(){this.elements.idCard&&this.elements.idCard.clearPanel()},_onComplete:function(e){var t=new r(e),i=t.getCompiledMask();t.getCustomizedMask();this.elements.maskModel=t,this._clearAll();this.elements.idCard.getIdentityCard().injectValue(this._currentType.typenls+" ("+this._currentType.type+")",C.TYPES.STRING,"title");var n=[];for(var s in i.getElements()){var o=null;switch(s){case"Write":o="pencil";break;case"Create":o="plus";break;case"details":o="info";break;default:o="i-question"}n.push({alwaysCalled:!0,require:"DS/MaskCustomization/facets/CommonFacet",facet:{name:s,text:s,icon:o}})}this.elements.idCard.getOrAddFacets(n);var a=this.elements.idCard.getSharedContext();a.models=t,a.type=this._currentType,this.elements.idCard.setSharedContext(a),this.elements.idCard._launchFacet()}})});