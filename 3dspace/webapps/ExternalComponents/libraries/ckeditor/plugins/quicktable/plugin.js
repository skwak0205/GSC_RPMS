CKEDITOR.plugins.add("quicktable",{requires:"table,panelbutton,floatpanel",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,ug,uk,vi,zh,zh-cn",afterInit:function(e){var t=e.config,a=t.qtRows||8,n=t.qtColumns||10,r=t.qtBorder||"1",o=t.qtStyle||null,l=t.qtClass||"",i=t.qtCellPadding||"1",s=t.qtCellSpacing||"1",c=t.qtWidth||"500px",u=t.qtPreviewSize||"14px",d=t.qtPreviewBorder||"1px solid #aaa",p=t.qtPreviewBackground||"#e5e5e5";function b(t){return new CKEDITOR.dom.element(t,e.document)}function f(t,a){for(var n=b("table"),u=n.append(b("tbody")),d=0;d<t;d++)for(var p=u.append(b("tr")),f=0;f<a;f++){p.append(b("td")).appendBogus()}n.setAttribute("cellpadding",i),n.setAttribute("cellspacing",s),n.setAttribute("border",r),n.setAttribute("class",l),n.setStyles(o),n.setStyle("width",c),e.insertElement(n),e.fire("removeFormatCleanup",n)}var g={row:-1,column:-1};function m(t,a,n,r){for(var o=a.$.tBodies[0].rows,l=0;l<o.length;l++)for(var i=o[l].cells,s=0;s<i.length;s++){var c=i[s];c.style.background=l<n&&s<r?p:""}g.row=n-1,g.column=r-1,t.setText(n+" Ã— "+r+" "+e.lang.table.toolbar)}e.ui.add("Table",CKEDITOR.UI_PANELBUTTON,{label:e.lang.table.toolbar,command:"table",modes:{wysiwyg:1},editorFocus:0,toolbar:"insert,30",caption:null,table:null,panel:{css:CKEDITOR.skin.getPath("editor"),attributes:{role:"listbox","aria-label":e.lang.table.toolbar}},onBlock:function(e,t){t.autoSize=!0,t.element.addClass("cke_colorblock");var r=new CKEDITOR.dom.element("div");r.setStyles({"text-align":"center",margin:"3px 0"}),t.element.append(r),this.caption=r;var o=CKEDITOR.dom.element.createFromHtml(function(e){var t=[],r=CKEDITOR.tools.addFunction(function(t,a){f(parseInt(t,10)+1,parseInt(a,10)+1),e.hide()});t.push('<a style="display:block" _cke_focus=1 hidefocus=true href="javascript:void(1)"><table role="presentation" cellspacing=1 cellpadding=1 style="width: 100%; margin: 0 auto 3px;table-layout:fixed;">');for(var o=0;o<a;o++){t.push("<tr>");for(var l=0;l<n;l++)t.push('<td style="border: '+d+";width:"+u+";height:"+u+';" data-i="'+o+'" data-j="'+l+'" onclick="CKEDITOR.tools.callFunction(',r,",'",o,"','",l,"'); return false;\"></td>");t.push("</tr>")}return t.push("</table></a>"),t.join("")}(e));this.table=this.addEvents(o),t.element.append(o);var l=this.createMoreButton();t.element.append(l),CKEDITOR.ui.fire("ready",this),t.keys=this.assignKeys(t.keys)},assignKeys:function(t){var a="rtl"==e.lang.dir;return t[a?37:39]="next",t[40]="next",t[9]="next",t[a?39:37]="prev",t[38]="prev",t[CKEDITOR.SHIFT+9]="prev",t[32]="click",t},addEvents:function(t){var r=this.table=t.getFirst(),o=this.caption;return r.on("mouseleave",function(e){m(o,r,1,1)}),r.on("mousemove",function(e){var t=e.data.getTarget();if("td"==t.getName()){var a=parseInt(t.getAttribute("data-i"),10),n=parseInt(t.getAttribute("data-j"),10);m(o,r,a+1,n+1)}}),t.on("keydown",function(t){var l=t.data.getKeystroke(),i=g.row,s=g.column;switch(l){case 37:s--;break;case 39:s++;break;case 40:i++;break;case 38:i--;break;case 13:case 32:return void f(i+1,s+1);default:return}i<0||s<0?this.panel.hide():((i>a-1||s>n-1)&&e.execCommand("table"),m(o,r,i+1,s+1),t.data.preventDefault(),t.data.stopPropagation())}),r},createMoreButton:function(){var t=new CKEDITOR.dom.element("a");return t.setAttributes({_cke_focus:1,hidefocus:!0,title:e.lang.quicktable.more,href:'javascript:void("'+e.lang.quicktable.more+'")',role:"option"}),t.addClass("cke_colormore"),t.setText(e.lang.quicktable.more),t.setStyle("text-align","center"),t.on("click",function(t){e.execCommand("table"),t.data.preventDefault()}),t},onOpen:function(){m(this.caption,this.table,1,1)}})}});