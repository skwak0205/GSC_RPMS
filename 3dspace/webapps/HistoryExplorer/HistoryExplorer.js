define("DS/HistoryExplorer/HistoryExplorerModel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({init:function(){this.nodes=[],this.connections={},this.currentNodeID={}},setCurrentNodeID:function(e){this.currentNodeID!==e&&(this.currentNodeID=e)},getCurrentNodeID:function(){return this.currentNodeID},setData:function(e){var t=JSON.parse(e);t.hasOwnProperty("nodes")&&(this.nodes=t.nodes),t.hasOwnProperty("connections")&&(this.connections=t.connections)},getNodes:function(){return this.nodes},getConnections:function(){return this.connections},removeNodes:function(e){UWA.is(e,"array")&&e.forEach(function(e){this.removeNode(e)},this)},removeNode:function(e){for(var t=0;t<this.nodes.length;++t)if(this.nodes[t].id===e)return void this.nodes.splice(t,1)},gotDataForThisObject:function(e){for(var t=0;t<this.nodes.length;++t)if(this.nodes[t].id===e.physicalid&&this.nodes[t].currentUntranslated===e.current)return!0;return!1},getObjectTitle:function(e){for(var t=0;t<this.nodes.length;++t)if(this.nodes[t].id===e)return this.nodes[t].displayName},getObject:function(e){for(var t=0;t<this.nodes.length;++t)if(this.nodes[t].id===e)return this.nodes[t];return null},getCurrentObject:function(e){return this.getObject(this.getCurrentNodeID().id)}})}),define("DS/HistoryExplorer/NodeView",["DS/etree/tree","DS/egraph/utils","DS/egraph/views","DS/egraph/core","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Tooltip","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","WebappsUtils/WebappsUtils"],function(e,t,i,n,a,o,s,r,d){"use strict";var l={},c=document.createElement("div");c.innerHTML=['<div class="etree-basic-node">','  <img class="etree-basic-node-thumbnail" draggable="false"></img>','  <div class="etree-basic-node-name-history" draggable="false">','    <div class="etree-basic-node-name-history-name"></div>','    <div class="etree-basic-node-name-history-revision"></div>','    <div class="etree-basic-node-name-history-context"></div>',"  </div>",'  <div class="etree-basic-node-collapser" data-egraph-subelt="collapser"></div>','  <div class="etree-basic-node-status">','    <div class="etree-basic-node-publish-status">','      <div class="etree-basic-node-publish-status-type-not-published"></div>','      <div class="etree-basic-node-publish-status-check-off"></div>',"    </div>",'    <div class="etree-basic-node-duplicate-status-not-duplicated"></div>','    <div class="etree-basic-node-outofdate-status-revision-latest"></div>',"  </div>","</div>",'<div class="etree-basic-temp-node">',"</div>"].join("\n");c.querySelector(".etree-basic-node");var u=c.querySelector(".etree-basic-temp-node");return l.NodeView=function(){i.HTMLNodeView.call(this)},t.inherit(l.NodeView,i.HTMLNodeView),l.NodeView.prototype.buildNodeElement=function(e){var t,i,n,a,o,d=e.data.data.nodeID;return(t=UWA.createElement("div")).className="etree-basic-node",t.setAttribute("data-rec-id",t.className+"_"+d),(i=UWA.createElement("img",{draggable:"false"})).className="etree-basic-node-thumbnail",i.setAttribute("data-rec-id",i.className+"_"+d),t.appendChild(i),(i=UWA.createElement("div",{draggable:"false"})).className="etree-basic-node-name-history",i.setAttribute("data-rec-id",i.className+"_"+d),t.appendChild(i),(n=UWA.createElement("div")).className="etree-basic-node-name-history-name",n.setAttribute("data-rec-id",n.className+"_"+d),i.appendChild(n),(n=UWA.createElement("div")).className="etree-basic-node-name-history-revision",n.setAttribute("data-rec-id",n.className+"_"+d),i.appendChild(n),(n=UWA.createElement("div")).className="etree-basic-node-name-history-context",n.setAttribute("data-rec-id",n.className+"_"+d),i.appendChild(n),n.onclick=function(e){var i=[{physicalid:t.data.nodeID,type:t.data.type,ev:e}];t.data.widget.dispatchEvent("onPickContext",i)},(i=UWA.createElement("div",{"data-egraph-subelt":"collapser"})).className="etree-basic-node-collapser",i.setAttribute("data-rec-id",i.className+"_"+d),t.appendChild(i),(i=UWA.createElement("div")).className="etree-basic-node-status",i.setAttribute("data-rec-id",i.className+"_"+d),t.appendChild(i),(n=UWA.createElement("div")).className="etree-basic-node-publish-status",n.setAttribute("data-rec-id",n.className+"_"+d),i.appendChild(n),(o=new s({target:n,body:r.puplishTip,position:"bottom"})).elements.body.style.zIndex="90000",o.elements.container.style.zIndex="90001",n.tooltip=o,(a=UWA.createElement("div")).className="etree-basic-node-publish-status-type-not-published",a.setAttribute("data-rec-id",a.className+"_"+d),n.appendChild(a),(a=UWA.createElement("div")).className="etree-basic-node-publish-status-check-off",a.setAttribute("data-rec-id",a.className+"_"+d),n.appendChild(a),(n=UWA.createElement("div")).className="etree-basic-node-duplicate-status-not-duplicated",n.setAttribute("data-rec-id",n.className+"_"+d),i.appendChild(n),(o=new s({className:"mytooltip",target:n,body:r.notDuplicatedTip,position:"bottom"})).elements.body.style.zIndex="90000",o.elements.container.style.zIndex="90001",n.tooltip=o,(n=UWA.createElement("div")).className="etree-basic-node-outofdate-status-revision-latest",n.setAttribute("data-rec-id",n.className+"_"+d),i.appendChild(n),(o=new s({className:"mytooltip",target:n,body:r.latestRevisionTip,position:"bottom"})).elements.body.style.zIndex="90000",o.elements.container.style.zIndex="90001",n.tooltip=o,e.data.data.isSelected?t.draggable=!0:t.draggable=!1,e.data.data.inCollapser=!1,e.data.data.elt=t,t.data=e.data.data,t},l.NodeView.prototype.onmodifyDisplay=function(t,a){var o,s;i.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),(o=UWA.extendElement(this.display.elt)).style.borderRadius="3px",o.style.cursor="",document.body.style.cursor="";var l=!1;1==t.data.data.isAlternative&&(l=!0);var c=!1;if(1==t.data.data.isAlternativeBase&&(c=!0),n.inPathSet(a,"data","data","title")&&(o.querySelector(".etree-basic-node-name-history-name").textContent=t.data.data.displayName,o.querySelector(".etree-basic-node-name-history-name").id=t.data.data.nodeID+"history",o.querySelector(".etree-basic-node-name-history-name").style.cursor=""),n.inPathSet(a,"data","data","revision")&&(o.querySelector(".etree-basic-node-name-history-revision").textContent=t.data.data.revision),n.inPathSet(a,"data","data","thumbnail")){var u,h=t.data.data.thumbnail;null!=widget.uwaUrl?u=widget.uwaUrl.substring(0,widget.uwaUrl.lastIndexOf("webapps")-1):null!=widget.body.baseURI&&""==(u=widget.body.baseURI.substring(0,widget.body.baseURI.lastIndexOf("webapps")-1))&&(u=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/",h="I_VPMNavProduct108x144.png"),null!=h&&-1==h.indexOf("http")&&(h=u+h),o.querySelector(".etree-basic-node-thumbnail").src=h,o.querySelector(".etree-basic-node-thumbnail").style.cursor=""}if((n.inPathSet(a,"data","data","isSelected")?t.data.data.isSelected?(o.style.border=c?"3px solid rgb(255, 0, 0)":l?"3px solid rgb(255, 255, 0)":"3px solid rgb(54, 142, 196)",o.querySelector(".etree-basic-node-name-history").style.cursor="move",o.querySelector(".etree-basic-node-thumbnail").style.cursor="move",o.style.cursor="move",o.draggable=!0):(o.style.border=c?"3px solid rgb(255, 0, 0)":l?"3px solid rgb(255, 255, 0)":"3px solid #E2E4E3",o.querySelector(".etree-basic-node-collapser").style.background="rgb(91, 93, 94)",o.draggable=!1):o.style.border=c?"3px solid rgb(255, 0, 0)":l?"3px solid rgb(255, 255, 0)":"3px solid #E2E4E3",n.inPathSet(a,"data","displayFlags")&&(t.data.displayFlags&e.DisplayFlags.DRAGGED?o.classList.add("dragged"):o.classList.remove("dragged")),(n.inPathSet(a,"data","data","highlighted")||n.inPathSet(a,"data","displayFlags"))&&(!t.data.data.highlighted||t.data.displayFlags&e.DisplayFlags.DRAG_NODE?o.classList.remove("highlighted"):o.classList.add("highlighted")),n.inPathSet(a,"data","*children*")||n.inPathSet(a,"data","expanded"))&&((s=o.querySelector(".etree-basic-node-collapser").classList).remove("expanded"),s.remove("collapsed"),t.data.first))if(o.querySelector(".etree-basic-node-collapser").style.display="inline-block",t.data.expanded){s.add("expanded");o.querySelector(".etree-basic-node-collapser.expanded")}else{s.add("collapsed");o.querySelector(".etree-basic-node-collapser.collapsed")}function p(e,t,i){for(var n=null,a=t.length,o=0;o<a;o++)if(n=e.querySelector("."+t[o]),null==i){if(null!=n){n.style.visibility="hidden";break}}else if(null!=n){n.className=n.className.replace(t[o],i),n.style.visibility="","etree-basic-node-duplicate-status-not-duplicated"!=i&&"etree-basic-node-outofdate-status-revision-latest"!=i&&(n.onclick=function(e){n.style.visibility="",e.stopPropagation();var t=n.offsetParent.offsetParent,i=t.data.nodeID,a=n.className;n.tooltip&&n.tooltip.hide();var o=[{physicalid:i,className:a}];t.data.widget.dispatchEvent("onPickSymbol",o)});break}return n}var f=o.querySelector(".etree-basic-node-publish-status");f&&null!=t.data.data.current&&(f.tooltip.elements.body.innerHTML=t.data.data.current);var g=[],m=[];g.push("etree-basic-node-publish-status-type-not-published"),g.push("etree-basic-node-publish-status-type-published"),m.push("etree-basic-node-publish-status-check-off"),m.push("etree-basic-node-publish-status-check-on"),n.inPathSet(a,"data","data","published_state")&&(1==t.data.data.ispublished?(p(o,g,"etree-basic-node-publish-status-type-published"),p(o,m,"etree-basic-node-publish-status-check-on")):0==t.data.data.ispublished?(p(o,g,"etree-basic-node-publish-status-type-not-published"),p(o,m,"etree-basic-node-publish-status-check-off")):(p(o,g,null),p(o,m,null)));var y=[];if(y.push("etree-basic-node-outofdate-status-revision-latest"),y.push("etree-basic-node-outofdate-status-revision-not-latest"),y.push("etree-basic-node-outofdate-status-revision-not-latest-published"),n.inPathSet(a,"data","data","out_of_date")){var v=null;"latest"==t.data.data.out_of_date?(v=p(o,y,"etree-basic-node-outofdate-status-revision-latest"))&&(v.tooltip.elements.body.innerHTML=r.latestRevisionTip):"not_latest"==t.data.data.out_of_date?(v=p(o,y,"etree-basic-node-outofdate-status-revision-not-latest"))&&(v.tooltip.elements.body.innerHTML=r.newerRevisionExistsTip):"not_latest_published"==t.data.data.out_of_date?(v=p(o,y,"etree-basic-node-outofdate-status-revision-not-latest-published"))&&(v.tooltip.elements.body.innerHTML=r.newerRevisionPublishedExistsTip):v=p(o,y,null)}var b=[];if(b.push("etree-basic-node-duplicate-status-not-duplicated"),b.push("etree-basic-node-duplicate-status-duplicated"),b.push("etree-basic-node-duplicate-status-duplicated-newer-exists"),b.push("etree-basic-node-duplicate-status-duplicated-newer-published-exists"),n.inPathSet(a,"data","data","duplicate_criteria")){v=null;"not_duplicated"==t.data.data.duplicate_criteria?(v=p(o,b,"etree-basic-node-duplicate-status-not-duplicated"))&&(v.tooltip.elements.body.innerHTML=r.notDuplicatedTip):"duplicated"==t.data.data.duplicate_criteria?(v=p(o,b,"etree-basic-node-duplicate-status-duplicated"))&&(t.data.data.out_of_date?v.tooltip.elements.body.innerHTML=r.duplicatedFromLastestTip:v.tooltip.elements.body.innerHTML=r.duplicatedTip):"duplicated_newer_exists"==t.data.data.duplicate_criteria?(v=p(o,b,"etree-basic-node-duplicate-status-duplicated-newer-exists"))&&(v.tooltip.elements.body.innerHTML=r.newerRevisionExists):"duplicated_newer_published_exists"==t.data.data.duplicate_criteria?(v=p(o,b,"etree-basic-node-duplicate-status-duplicated-newer-published-exists"))&&(v.tooltip.elements.body.innerHTML=r.newerPublishedRevisionExists):p(o,b,null)}if(t.data.document.historyConfig&&Array.isArray(t.data.document.historyConfig.historyConfig))for(var w=t.data.document.historyConfig.historyConfig,D=w.length,S=0;S<D;S++){var x=w[S];if(null!=t.data.data[x.attribute]&&null!=x.value&&t.data.data[x.attribute]===x.value||null!=t.data.data[x.attribute]&&null==x.value&&x.node_color){o.setStyle("background-color",x.node_color);break}}},l.GraphView=i.HTMLGraphView,l.TempEdgeView=function(e){return new i.SVGEdgeView("etree-basic-temp-edge")},l.EdgeView=function(e){i.SVGEdgeView.call(this,"etree-basic-tree-edge")},t.inherit(l.EdgeView,i.SVGEdgeView),l.EdgeView.prototype.onmodifyDisplay=function(e,t,n){i.SVGEdgeView.prototype.onmodifyDisplay.apply(this,arguments);var a=UWA.extendElement(this.display.elt),o=a.getTotalLength();a.svgimg.setAttribute("visiblity","hidden"),a.svgimg.setAttribute("cursor","default"),a.svgimg.onclick=null;var s=a.svgimg.getElementsByTagName("title")[0];if(s&&a.svgimg.removeChild(s),o>0){var l=d.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";if(1==e.cl2.c.node.data.data.conTypeHighlighted?(a.style.stroke="rgb(18, 171, 222)",a.style.strokeWidth="6"):(a.style.stroke="rgb(91, 93, 94)",a.style.strokeWidth=""),"revision"==e.cl2.c.node.data.data.conType)a.style.strokeDasharray="",a.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",l+"I_MajorVersion.png");else if("minorRevision"==e.cl2.c.node.data.data.conType)a.style.strokeDasharray="17,2",a.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",l+"I_MinorVersion.png");else if("revisionFrom"==e.cl2.c.node.data.data.conType){a.style.strokeDasharray="",a.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",l+"I_NewVersionUsingDistantData.png"),a.svgimg.setAttribute("cursor","pointer");var c=document.createElementNS("http://www.w3.org/2000/svg","title");c.textContent=r.newRevisionFromTip,a.svgimg.appendChild(c),a.svgimg.onclick=function(t){t.stopPropagation();var i=[{physicalid:e.cl2.c.node.data.data.nodeID}];e.cl2.c.node.data.data.widget.dispatchEvent("onPickNewRevisionFrom",i)}}else"minorRevisionFrom"==e.cl2.c.node.data.data.conType?(a.style.strokeDasharray="17,2",a.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",l+"I_NewMinorUsingDistantData.png")):"evolution"==e.cl2.c.node.data.data.conType?(a.style.strokeDasharray="",a.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",l+"I_Evolution.png")):"duplicate"==e.cl2.c.node.data.data.conType&&(a.style.strokeDasharray="",a.svgimg.setAttributeNS("http://www.w3.org/1999/xlink","href",l+"I_Duplicate.png"));var u=a.getPointAtLength(o);a.svgimg.setAttribute("x",u.x+5),a.svgimg.setAttribute("y",u.y-25),a.svgimg.setAttribute("visiblity","visible");!function(e){var t=n.container.getElements("path");if(2===e.getAttribute("d").split("C").length){var i=t.filter(function(e){return 3===e.getAttribute("d").split("C").length});if(i.length){var a=e.getAttribute("d").split("C")[0].split("M")[1].trim().split(" ").map(function(e){return Number(e.trim())});Array.prototype.find||(Array.prototype.find=function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,i=Object(this),n=i.length>>>0,a=arguments[1],o=0;o<n;o++)if(t=i[o],e.call(a,t,o,i))return t});var o=i.find(function(e){var t=function(e){var t=e.getAttribute("d").split("C")[1].split("L"),i=t[0].trim().split(" ");return{begin:i=i.slice(i.length-2,i.length).map(function(e){return Number(e.trim())}),end:t[1].trim().split(" ").map(function(e){return Number(e.trim())})}}(e);return a[1]===t.begin[1]&&a[1]===t.end[1]&&(a[0]>t.begin[0]&&a[0]<t.end[0]||a[0]<t.begin[0]&&a[0]>t.end[0])});if(o){var s=o.getAttribute("d");s=(s=s.substring(0,s.lastIndexOf("C"))).substring(0,s.lastIndexOf("L")+1)+a[0]+" "+a[1],s+="C"+e.getAttribute("d").split("C")[1],e.setAttributes({d:s});var r=e.getParent();if(r){var d=r.getParent();d&&d.appendChild(r)}}}}}(UWA.extendElement(a));e.cl1.c.node;var h=e.cl2.c.node;if(h.data.document.historyConfig&&Array.isArray(h.data.document.historyConfig.historyConfig))for(var p=h.data.document.historyConfig.historyConfig,f=(o=p.length,0);f<o;f++){var g=p[f];if(null!=h.data.data[g.attribute]&&null!=g.value&&h.data.data[g.attribute]===g.value||null!=h.data.data[g.attribute]&&null==g.value&&g.line_color){a.setStyle("stroke",g.line_color);break}}}},l.EdgeView.prototype.oncreateDisplay=function(e){i.SVGEdgeView.prototype.oncreateDisplay.apply(this,arguments);var t=this.display.elt,n=document.createElementNS("http://www.w3.org/2000/svg","image");n.setAttribute("height","20"),n.setAttribute("width","20"),t.svgimg=n,this.structure.root.appendChild(t.svgimg)},l.TempNodeView=function(){i.HTMLNodeView.call(this)},t.inherit(l.TempNodeView,i.HTMLNodeView),l.TempNodeView.prototype.buildNodeElement=function(e){return u.cloneNode(!0)},l}),define("DS/HistoryExplorer/ExternalRefresh",["UWA/Core","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI","DS/LifecycleServices/ArrayFunctions","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,i,n,a){return t.extend({PADCommandProxy:null,tenant:null,init:function(e,t){this.views=[],this.views.push(this._revisonFamilyFacade(e)),this.hostContainer=t,this.refreshSub=i.subscribe("Lifecycle.Modification",this._externalRefresh.bind(this)),this._subscribeToPADEvents()},resetViews:function(e){this.views=[],this.views.push(this._revisonFamilyFacade(e))},done:function(){this.refreshSub&&(this.refreshSub.unsubscribe(),this.refreshSub=null),this.PADCommandProxy&&(this.PADCommandProxy.destroy(),this.PADCommandProxy=null)},_subscribeToPADEvents:function(){var e=this;require(["DS/PADUtils/PADCommandProxy"],function(t){e.PADCommandProxy=t.create({events:{onRefresh:e._onPADEvent.bind(e)}})})},_onPADEvent:function(t){if(this._handlePADEventDeleted(t),e.is(t.authored.modified,"array"))for(var i=0;i<t.authored.modified.length;i++){var n=null,a=!1;if(e.is(t.authored.modified[i],"string")?n=t.authored.modified[i]:e.is(t.authored.modified[i].physicalid,"string")&&(e.is(t.authored.modified[i].key,"string")&&e.is("ownerChanged"===t.authored.modified[i].key)&&(a=!0),n=t.authored.modified[i].physicalid),!n)return;var o={physicalid:n,tenant:this._getTenant()};this._reloadHost(o.physicalid,o,a)}},_handlePADEventDeleted:function(e){e.authored.deleted&&this._handleDeletedForRefresh(e.authored.deleted)},_revisonFamilyFacade:function(e){return{refresh:function(t){e.setObjects(t)},findObjects:function(t){return e.versionExplorer.getObjects().filter(function(e){return e.options.id===t||e.options.grid&&e.options.grid.contents&&e.options.grid.contents[0].id===t})},getRelatedId:function(t){var i,n;return(n=e.versionExplorer.getObjects().find(function(e){return e.options.id!==t||e.options.grid&&e.options.grid.contents&&e.options.grid.contents[0].id!==t}))&&(i=n.options.id),i}}},_isObjectLoaded:function(e){var t=!1;return this.views.forEach(function(i){i.findObjects(e).length>0&&(t=!0)}),t},_reloadHost:function(e,t,i){if(!0===this._isObjectLoaded(e)){if(i){var n=this._getRelatedId(t.physicalid);n&&(t.physicalid=n)}this.hostContainer.load(t)}},_getRelatedId:function(e){var t=null;return this.views.forEach(function(i){t||(t=i.getRelatedId(e))}),t?t.id:null},_handleDeletedForRefresh:function(t){var i=this;if(e.is(t,"array")){var n=null;if(t.some(function(t){var a=null;return e.is(t,"string")?a=t:e.is(t.physicalid,"string")&&(a=t.physicalid),!(!a||!i._isObjectLoaded(a))&&(n=a,!0)}),!n)return;var a=null;this.views.forEach(function(e){if(e.findObjects(n).length>0){var t=e.getRelatedId(n);if(t&&!a){var o=i._getTenant();a={physicalid:t,tenant:o}}}}),a?this.hostContainer.load(a):this.hostContainer.clear()}},setTenant:function(e){this.tenant=e},_getTenant:function(){if(this.tenant)return this.tenant;var e=a.getTenant();return e||(e="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null),e},_externalRefresh:function(e){var t=null,i=null;try{var n=JSON.parse(e);if(null!=n&&n.hasOwnProperty("Refresh")){var a=n.Refresh;if(null!=a.created&&a.created.length>0)for(var o=0;o<a.created.length;o++){if(i=a.created[o].sourceObjectId,this._isObjectLoaded(i)){t={physicalid:a.created[o].physicalid,tenant:n.tenant};break}}else null!=a.modified&&a.modified.length>0?(i=a.modified[0].physicalid,t={physicalid:a.modified[0].physicalid,tenant:n.tenant}):null!=a.deleted&&a.deleted.length>0&&this._handleDeletedForRefresh(a.deleted)}}catch(e){console.log(e)}t&&this._reloadHost(i,t)}})}),define("DS/HistoryExplorer/HistoryDialog",["UWA/Core","UWA/Controls/Abstract","DS/LifecycleControls/CommandDialog","DS/LifecycleCmd/MessageMediator","DS/HistoryExplorer/ExternalRefresh","DS/LifecycleServices/LifecycleAlert","DS/HistoryMultiPanel/HistoryMultiPanel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(e,t,i,n,a,o,s,r,d,l){return t.extend({displayNotification:function(e){o.displayNotification(e)},executeCmd:function(e,t,n){if(this.options=t,e.length>1)throw l.multipleSelection;this.addEvent("onComplete",function(e){n()});var o=this,s=new i,r=this._renderDialogContent(),c=s.create(r,{className:"History_modal",closeButton:!0,title:l.revisions+" - "+e[0].displayName,buttonStyle:s.buttonStyle.none,resizable:!0,persistId:"historyDialogId",maximizable:!0,overlay:!1,onClose:u,events:{onResizeFloating:function(){var e=c.elements.container.getSize();o.historySizeInitialized||o.historySize&&(e=o.historySize,o.historySizeInitialized=!0,c.setNewSize(e)),o.historySize=e,o.historyMultiPanel.revisionFamily.onResize(e)}}},this);function u(){o.historyMultiPanel.revisionFamily.cleanup(),s.destroy(),o._onComplete()}this.dialog=c,this._createHistoryUI(r),this._setObjects(e,!1,!1);var h={load:function(e){o.historyMultiPanel.setObjects([e],!1,!1)},clear:u};this.externalRefresh=new a(this.historyMultiPanel.revisionFamily,h),this.externalRefresh&&e.length>0&&(this.externalRefresh.setTenant(e[0].tenant),d.setTenant(e[0].tenant)),c.inject(widget.body),this.dialog=c,n()},_onComplete:function(){this.externalRefresh&&this.externalRefresh.done(),this.dispatchEvent("onComplete",{})},_setObjects:function(e,t,i){i||(e.length>0&&d.setTenant(e[0].tenant),this.historyMultiPanel.revisionFamily.setObjects(e)),this.externalRefresh&&e.length>0&&(this.externalRefresh.setTenant(e[0].tenant),d.setTenant(e[0].tenant))},_createHistoryUI:function(e){var t=this,i={wintop:!1,includeMaturity:!0,getAllowedSemanticsResponse:this.options.getAllowedSemanticsResponse},n={setObjects:function(e,i,n){t._setObjects(e,i,n),t._reportSelection(e)},setTitleFromObject:function(e){t._setTitleFromObject(e)}};t.historyMultiPanel=new s(t,widget,t.dialog.elements.body,i,n),t.historyMultiPanel.inject(e)},_renderDialogContent:function(){var e=document.createElement("div");return e.className="history_popup",e},_setTitleFromObject:function(e){if(e&&e.displayName){var t="";e.cfgRevTitle?t=e.cfgRevTitle:(t=l.revisions+" - "+e.displayName,null!=e.revision&&t.indexOf(" "+e.revision)<0&&(t+=" "+e.revision)),this.dialog.setTitle(t)}},_reportSelection:function(e){if(e.length>0){var t=e[0].physicalid;r.getSecurityContext(d.getTenant(),function(e){var i={objectId:t,metadata:{origin:"ENOLCMI_AP"},envId:d.getTenant(),contextId:e};require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(e){e.publish("setObject",i)}),require(["DS/WidgetServices/commandProxy/CommandProxy"],function(e){var i=[t];e.publishSelect({data:{metadata:{origin:"ENOLCMI_AP"},paths:[i]}})})},function(e){console.log("reportSelection ",e)})}}})}),define("DS/HistoryExplorer/HistoryExplorerController",["UWA/Core","UWA/Controls/Abstract","DS/HistoryExplorer/HistoryExplorerModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(e,t,i,n,a,o,s){"use strict";return t.extend({tenant:null,init:function(){this.model=new i},initTree:function(e){var t=this;n.getSecurityContextPromise(this.tenant).then(function(i){t.getRevisionHistory(e,i)})},getRevisionHistory:function(t,i){var r,d=this;if(this.model.gotDataForThisObject(t))return this.model.setCurrentNodeID({id:t.physicalid,displayName:t.displayName}),void d.dispatchEvent("onTreeInfoChanged",{reframeFlag:!1,useHighlightedFrameFlag:!1,useMarkedFrameFlag:!1,isSelection:!1});t.hasOwnProperty("physicalid")&&n.getHistoryConfigPromise().then(function(e){r=e},function(){}).finally(function(){var l="";if("object"==typeof r&&r.historyConfig){l="&custAttribs=";for(var c=0,u=r.historyConfig,h=u.length;c<h;c++){var p=u[c];l.indexOf(e.Utils.encodeUrl(p.attribute))<0&&(l+=e.Utils.encodeUrl(p.attribute)+"~~~")}}var f=a.get3DSpaceWSUrl(d.tenant,"/resources/lifecycle/history/links",null);o.authenticatedRequest(f,{method:"GET",type:"text",headers:a.getHeaders(encodeURIComponent(i)),timeout:6e5,data:"physicalid="+t.physicalid+"&depth=100&height=100"+l,onComplete:function(e){d.model.setData(e),d.dispatchEvent("onTreeInfoChanged",{reframeFlag:!0,useHighlightedFrameFlag:!1,useMarkedFrameFlag:!1,isSelection:!0}),d.dispatchEvent("onCompleteGetRevisionHistory")},onFailure:function(e,t){d.dispatchEvent("onError",n.parseWebServiceError(e,t))},ontimeout:function(){d.dispatchEvent("onError",s.connectionTimeout)}})})},setTenant:function(e){this.tenant=e}})}),define("DS/HistoryExplorer/HistoryExplorer",["css!DS/Core/wux","css!DS/egraph/views","css!DS/HistoryExplorer/HistoryExplorer","UWA/Controls/Abstract","UWA/Utils/InterCom","WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/HistoryExplorer/HistoryExplorerModel","DS/HistoryExplorer/HistoryExplorerController","DS/HistoryExplorer/NodeView","DS/LifecycleServices/EventHandler","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/UIBehaviors/ContextualMenuManager","DS/LifecycleServices/Notification","DS/UIKIT/Mask","DS/Menu/Menu","DS/WebInWinHelper/WebInWinHelper","DS/etree/widget","DS/etree/tree","DS/egraph/utils","DS/egraph/core","DS/egraph/views","DS/etree/iact","DS/egraph/iact","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(e,t,i,n,a,o,s,r,d,l,c,u,h,p,f,g,m,y,v,b,w,D,S,x,N,C){"use strict";var A="PushItem";return n.extend({defaultOptions:{wintop:!1},WebToWinComSocket:null,ContextualMenuData:null,init:function(e){this._parent(e),this.originData=null},createUI:function(e){var t=this;this.parentWidget=e,this._disableDragAndDrop(),this._buildSkeleton(),this.contextMenuObject=null;this.controller=new d({wintop:this.options.wintop,serverUrl:this.options.serverUrl});1==t.options.wintop&&(this.WebToWinComSocket=t.options.webToWinComSocket),this.model=this.controller.model,this.controller.addEvent("onError",function(e){g.unmask(t.elements.container),t.displayError(e),t.updateUI(!1,!1,!1,!1)}),this.controller.addEvent("onTreeInfoChanged",function(e){g.unmask(t.elements.container),t._updateHistoryTree(e.reframeFlag,e.useHighlightedFrameFlag,e.useMarkedFrameFlag,e.isSelection)}),this.controller.addEvent("onCompleteGetRevisionHistory",function(){var e=this.model.getCurrentObject();t.dispatchEvent("onDataUpdated",e)})},_disableDragAndDrop:function(){this.parentWidget&&!0!==this.options.wintop&&"function"==typeof this.parentWidget.addEvent&&(this.parentWidget.addEvent("dragover",function(e){(e=e||event).preventDefault()},!1),this.parentWidget.addEvent("drop",function(e){(e=e||event).preventDefault()},!1))},onSetCtxMenuForItem:function(e){var t=this;t.ContextualMenuData=y.parseContextualMenu(e),null!=t.contextMenuObject&&(t.options.wintop?t.doPickContext(t.contextMenuObject,void 0):u.isOpenWithCATIAV5Available(function(e){t.doPickContext(t.contextMenuObject,e)}))},_buildSkeleton:function(){var e=UWA.createElement("div");this.elements.container=e,e.className="explore-globalDiv",e.setAttribute("data-rec-id",e.className),this.globalDiv=e,this.graph=UWA.createElement("div",{class:"history-canvas","data-rec-id":"history-canvas",id:"history_canvas"}).inject(e),this._buildHistoryTree()},_isFolderType:function(e){return e.indexOf("Workspace")>=0||"ENOCLG_LibraryReference"===e||e.indexOf("Folder")>=0},updateUI:function(e,t,i,n){this.controller.dispatchEvent("onTreeInfoChanged",{reframeFlag:e,useHighlightedFrameFlag:t,useMarkedFrameFlag:i,isSelection:n})},RootState:function(e){var t=e;x.RootState.call(this);this.oncontext=function(e){var i;switch(e.device){case"touch":i=[e.clientPos[0]+35,e.clientPos[1]-18];break;default:i=[e.clientPos[0]-30,e.clientPos[1]-20]}if(t.contextMenuPos=i,e.node)if(t.contextMenuObject={physicalid:e.node.data.nodeID,type:e.node.data.type,typeUntranslated:e.node.data.typeUntranslated,XCADExtension_V_CADOrigin:t.model.nodes.find(function(t){return e.node.data.nodeID===t.id}).XCADExtension_V_CADOrigin},1==t.options.wintop){var n=t.contextMenuObject.physicalid,a=t.findTreeNode(n).data.name,o=[];o.push({physicalId:n,name:a}),y.fetchContextFromSelection(t.WebToWinComSocket,o)}else u.isOpenWithCATIAV5Available(function(e){t.doPickContext(t.contextMenuObject,e)});else t.contextMenuObject=null,t.doPickContext(t.contextMenuObject,void 0)}.bind(t);this.buttons={collapser:function(e){e.document.withLockedUpdate(function(){e.expanded?e.setExpanded(!1):e.setExpanded(!0)}),e.document.withLockedUpdate(function(){})}},this.movePredicate=function(e){return e.data.isSelected,!1},this.actions={select:function(e,i){e.document.withLockedUpdate(function(){switch(i){case x.SelectMode.REPLACE:case x.SelectMode.ADD:case x.SelectMode.TOUCH:if(!e.data.isSelected){e.data.isSelected=!0,e.data.elt.style.cursor="wait",e.data.elt.ownerDocument.body.style.cursor="wait",e.data.elt.querySelector(".etree-basic-node-name-history").style.cursor="wait",e.data.elt.querySelector(".etree-basic-node-thumbnail").style.cursor="wait";var n=e.data.nodeID,a=e.data.displayName;e.data.widget.model.setCurrentNodeID({id:n}),e.data.widget.clearNotations();var o={data:[{physicalid:n,displayName:a,tenant:t.controller.tenant}]};e.data.widget.dispatchEvent("onSelectedObject",o)}break;case x.SelectMode.EMPTY:}})}}},_buildHistoryTree:function(){w.inherit(this.RootState,x.RootState),this.RootState.prototype.onwheel=function(e,t){var i,n;if(t.inside){var a=.5*t.wheelDelta;return i=e.graphView,(n=w.incViewpointScale(i.vpt,a,t.graphPos,!0))[2]>.05&&n[2]<10&&i.setViewpoint(n,!0),{consume:!0}}return{}},this.RootState.prototype.onmousedown=function(e,t){var i;if(i=t.grElt,0===t.modifiers&&t.button===N.Buttons.LEFT&&i&&i.type===D.Type.NODE&&!t.subElt)return"etree-basic-node-outofdate-status-revision-not-latest-published"!=t.dom.className&&"etree-basic-node-outofdate-status-revision-not-latest"!=t.dom.className&&"etree-basic-node-outofdate-status-revision-latest"!=t.dom.className&&"etree-basic-node-duplicate-status-duplicated-newer-published-exists"!=t.dom.className&&"etree-basic-node-duplicate-status-duplicated-newer-exists"!=t.dom.className&&"etree-basic-node-duplicate-status-duplicated"!=t.dom.className&&"etree-basic-node-duplicate-status-not-duplicated"!=t.dom.className&&"etree-basic-node-name-history-context"!=t.dom.className&&("etree-basic-node-publish-status"==t.dom.className&&t.dom.tooltip&&t.dom.tooltip.hide(),this.actions.select(t.grElt.data,x.SelectMode.REPLACE)),{state:new N.EndDragOnLeftRelease,consume:!1};Array.prototype.slice.call(arguments)[0];return x.RootState.prototype.onmousedown.apply(this,arguments)},this.graph.addEventListener("dragstart",function(e){var t=e.target;if(t.classList.contains("etree-basic-node")){var i=t.grElt.data;if(i.data.isSelected){var n=i.data.nodeID,a={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:[{envId:u.getTenant(),serviceId:"3DSpace",contextId:"",objectId:n,objectType:i.data.typeUntranslated,displayName:i.data.name,session_object:!1}]}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(a))}catch(t){e.dataTransfer.setData("Text",JSON.stringify(a))}}}}),this.graph.addEventListener("dragend",function(e){var t;if(e.target.classList.contains("etree-basic-node")&&e.target.grElt.data.data.isSelected){try{t=new MouseEvent("mouseup",e)}catch(e){(t=document.createEvent("MouseEvents")).initMouseEvent("mouseup",!0,!0,window,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,null)}e.target.dispatchEvent(t)}}),this.widget=new v.EGraphTree(this.graph,{nodeWidth:150,nodeHeight:101,rowPadding:60,siblingPadding:30,nodeViewCtor:l.NodeView,edgeViewCtor:l.EdgeView,drawing:b.Drawing.LAYERED,edges:{type:"rounded-square",radius:7},rootState:new this.RootState(this)})},_updateHistoryTree:function(e,t,i,n){var a=this;h.getHistoryConfigPromise().then(function(e){a.widget.document.historyConfig=e},function(){a.widget.document.historyConfig=null}).finally(function(){a.widget.document.withLockedUpdate(function(){a.widget.document.clear();var e=a.loadNodes([a.widget.document],n);null!=e&&a.widget.document.appendChild(e)}),1==e&&a.widget.document.withLockedUpdate(function(){try{a.reframe(t,i)}catch(e){console.log(e)}});var o=a.model.getCurrentObject();a.dispatchEvent("ModelUpdated",o)})},showProperties:function(e){var t={_context:this.options.context,_selection:[{getID:function(){return e.id}}],getSecurityContext:function(){return this._context},getSelectedNodes:function(){return this._selection},displayNotification:function(){}};require(["DS/LifecycleControls/EditPropDialog"],function(e){(new e).launchProperties(t)})},getUniqueHtmlIdForNode:function(e){return e+"history"},updateObjectTitle:function(e,t){var i=document.getElementById(this.getUniqueHtmlIdForNode(e));i&&(i.textContent=t)},showCompare:function(e,t){if(1==this.options.wintop)null!=this.ContextualMenuData&&y.launchWinCompare(this.WebToWinComSocket,e,t);else{var i=[];if(null!==e&&i.push({envId:"",serviceId:"",contextId:"",objectId:e.id,objectType:"",displayName:""}),null!==t&&i.push({envId:"",serviceId:"",contextId:"",objectId:t.id,objectType:"",displayName:""}),i.length>0){var n={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:i}},o=new a.Socket("compassPageSocket");o.subscribeServer("com.ds.compass",window.parent),o.dispatchEvent("onSetX3DContent",n,"compassPageSocket"),o.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e)),this.response=e.response});o.dispatchEvent("onLaunchApp",{appId:"ENOCOMP_AP"},"compassPageSocket")}}},showAlternatives:function(e){this.highlightAlternatives(e),this.updateUI(!1,!1,!1,!1)},showDuplicates:function(e){this.highlightDuplicates(e),this.updateUI(!1,!1,!1,!1)},getMarkedObjectsBounds:function(e,t){var i=function(){this.xmin=NaN,this.xmax=NaN,this.ymin=NaN,this.ymax=NaN,this.xminObj=null,this.xmaxObj=null,this.yminObj=null,this.ymaxObj=null};return i.prototype.update=function(e,t,i,n,a){(t<this.xmin||isNaN(this.xmin))&&(this.xmin=t,this.xminObj=e),(i>this.xmax||isNaN(this.xmax))&&(this.xmax=i,this.xmaxObj=e),(n<this.ymin||isNaN(this.ymin))&&(this.ymin=n,this.yminObj=e),(a>this.ymax||isNaN(this.ymax))&&(this.ymax=a,this.ymaxObj=e)},this.widget.document.getMarkedObjectsBounds=function(e,t){var n,a,o,s,r;for(n=this.nodeWidth,a=this.nodeHeight,r=new i,s=this.first;s;s=s.dftNext(this,!s.expanded))if((s.data.conTypeHighlighted&&e||s.data.conTypeMarked&&t)&&((o=s.height)!=o&&(o=a),r.update(s,s.left,s.left+n,s.top,s.top+o),null!=s.parent)){var d=s.parent;(o=d.height)!=o&&(o=a),r.update(d,d.left,d.left+n,d.top,d.top+o)}return r},this.widget.document.getMarkedObjectsBounds(e,t)},onResize:function(){this.reframe(!1,!1)},reframe:function(e,t){var i;this.widget.document.gr.views.main.vpt[2];if(i=this.widget.document.getBounds(),e||t){var n=this.getMarkedObjectsBounds(e,t);i.xmin=n.xmin,i.xmax=n.xmax,i.ymin=n.ymin,i.ymax=n.ymax,i.xminObj=n.xminObj,i.xmaxObj=n.xmaxObj,i.yminObj=n.yminObj,i.ymaxObj=n.ymaxObj}if(!isNaN(i.ymax)&&!isNaN(i.xmax)){var a=this.parentWidget;if(null!=a){var o=a.getBoundingClientRect(),s=this.widget.document.gr.views.main.container.getBoundingClientRect(),r=a.clientWidth,d=o.bottom-s.top;this.widget.document.gr.views.main.container.setStyle("height",d+"px");this.widget.document.gr.views.main.container.clientWidth;var l=this.widget.document.gr.views.main.container.clientHeight;i.ymax+=25;var c=i.ymax-i.ymin,u=(i.xmax,i.xmin,c/l),h=[r,d];this.widget.document.gr.views.main.setViewpoint(w.reframeViewpoint(h,i,{padding:1/u*25,horizontal:0,vertical:0,aliasing:0}))}}},loadNodes:function(e,t){var i=null,n=this.selectAndFindNode(this.model.getCurrentNodeID().id);if(null!=n){var a=this.findNodeByShortID(1);i=this.createTreeNode(a,!0,-1,"",!1,!1),this.createTreeNodeChildren(i,a,null),t&&this.CollapseNonInterestingAncestors(i,n)}return this.widget.document.vetoUpdateAnimation(),i},findNode:function(e){for(var t=this.controller.model.getNodes(),i=t.length,n=null,a=0;a<i;a++)if(t[a].id==e){n=t[a];break}return n},selectAndFindNode:function(e){for(var t=this.controller.model.getNodes(),i=t.length,n=null,a=0;a<i;a++)t[a].id==e?(n=t[a]).isSelected=!0:t[a].isSelected=!1;return n},findNodeByShortID:function(e){for(var t=this.controller.model.getNodes(),i=t.length,n=null,a=0;a<i;a++)if(t[a].nId==e){n=t[a];break}return n},createTreeNodeChildren:function(e,t,i){var n=null;if(null!=t)for(var a=this.controller.model.getConnections(),o=a.length,s=0;s<o;s++)if(a[s].src==t.nId){var r=this.findNodeByShortID(a[s].trg);if(null!=r){var d=null!=i&&i.nId==a[s].trg,l=this.createTreeNode(r,!0,s,a[s].typ,a[s].highlighted,a[s].marked);null!=l&&(e.appendChild(l),d?n=l:this.createTreeNodeChildren(l,r,null))}}return n},createTreeNode:function(e,t,i,n,a,o){var s={name:e.displayName+" "+e.revision,displayName:e.displayName,thumbnail:e.thumbnail,useAsyncPreExpand:!0,conId:i,conType:n,conTypeHighlighted:a,conTypeMarked:o,isAlternative:e.isAlternative,isAlternativeBase:e.isAlternativeBase,nodeID:e.id,type:e.type,typeUntranslated:e.typeUntranslated,inCollapser:!1,widget:this,isSelected:e.isSelected,revision:e.revision,title:e.name,ispublished:e.ispublished,out_of_date:e.out_of_date,current:e.current,duplicate_criteria:e.duplicate_criteria};if(this.widget.document.historyConfig&&Array.isArray(this.widget.document.historyConfig.historyConfig))for(var r=0,d=this.widget.document.historyConfig.historyConfig.length;r<d;r++)s[this.widget.document.historyConfig.historyConfig[r].attribute]=e[this.widget.document.historyConfig.historyConfig[r].attribute];var l=new b.Node(s);return l.setExpanded(t),l},displayError:function(e){f.displayError(this.context,e)},displayInfo:function(e){f.displayInfo(this.context,e)},setObjects:function(e){if(0===e.length)this.displayError(C.noObject);else if(1===e.length){var t=e[0];t.hasOwnProperty("physicalid")&&""===t.physicalid?this.displayError(C.epmtyPhysicalId):(g.mask(this.elements.container,C.updatingMessage),this.controller.setTenant(t.tenant),this.controller.initTree(t),t.hasOwnProperty("displayName")&&t.displayName&&t.displayName.trim().length>0?this.model.setCurrentNodeID({id:t.physicalid,displayName:t.displayName}):this.model.setCurrentNodeID({id:t.physicalid}))}else this.displayError(C.multipleSelection)},CollapseNonInterestingAncestors:function(e,t){var i,n=null;for(i=e;i;i=i.dftNext(this.widget.document))if(i.data.nodeID===t.id){n=i;break}if(null!==n){var a=n,o=n.parent;if(o)for(var s=o;null!==s;s=s.parent){for(var r=s.first;null!==r;r=r.next)r!==a&&r.setExpanded(!1);a=s}}},highlightDuplicates:function(e){var t=this.widget.document.first;if(null!=t){var i=this.controller.model.getConnections();this.clearNotations();var n=!1,a=[];if(1==this.highlightDuplicatesRAll(t,a))for(i=this.controller.model.getConnections();a.length>0;){var o=a.pop();if(o.setExpanded(!0),o.data.conId>=0&&"duplicate"==i[o.data.conId].typ&&o!=t)this.findNode(o.data.nodeID).isAlternative=!0,n=!0;i[o.data.conId].marked=!0}return n}},highlightDuplicatesR:function(e,t){for(var i=!1,n=e.first;null!=n;n=n.next){var a="duplicate"==n.data.conType;(1==this.highlightDuplicatesR(n,t)||a)&&(t.push(n),i=!0)}return i},highlightDuplicatesRAll:function(e,t){for(var i=!1,n=e.first;null!=n;n=n.next){"duplicate"==n.data.conType&&(t.push(n),i=!0),1==this.highlightDuplicatesR(n,t)&&(t.push(n),i=!0)}return i},highlightAlternatives:function(e){var t,i=null;for(t=this.widget.document.first;t;t=t.dftNext(this.widget.document))if(t.data.nodeID==e.id){i=t;break}if(null!=i){var n=this.controller.model.getConnections();this.clearNotations(),e.isAlternativeBase=!0;this.widget.document.first;for(var a=[],o=null,s=i;null!=s.parent;s=s.parent){var r=!1;if(s==i){if((r=this.highlightOODPath(s,!0,!0))||(r=this.highlightOODPath(s,!1,!0)),!r)if(r="latest"==s.data.out_of_date)this.findNode(s.data.nodeID).isAlternative=!0}else for(var d=s.first;null!=d;d=d.next)if(d!=o&&d.data.conId>=0&&"duplicate"==n[d.data.conId].typ){var l=this.highlightOODPath(d,!0,!0);if(l||(l=this.highlightOODPath(d,!1,!0)),!l)if(l="latest"==d.data.out_of_date)this.findNode(d.data.nodeID).isAlternative=!0;l&&d.data.conId>=0&&(a.push(d.data.conId),r=!0)}if(r)for(;a.length>0;)n[a.pop()].marked=!0;s.data.conId>=0&&a.push(s.data.conId),o=s}}},highlightOODPath:function(e,t,i){var n=!1,a=[];if(!0===this.highlightOODPathR(e,t,a)){var o=this.controller.model.getConnections();if(!0===i&&a.length>0){var s=a[0];this.findNode(s.data.nodeID).isAlternative=!0}for(;a.length>0;){var r=a.pop();r.setExpanded(!0);var d="revision"===r.data.conType||"revisionFrom"===r.data.conType;r.data.conId>=0&&d&&r!=e&&(n=!0,i?o[r.data.conId].marked=!0:o[r.data.conId].highlighted=!0)}}return n},highlightOODPathR:function(e,t,i){for(var n=!1,a=e.first;null!==a;a=a.next){if(!("duplicate"==a.data.conType)){if(n="latest"==a.data.out_of_date||t&&"not_latest"==a.data.out_of_date,t&&!0!==a.data.ispublished&&(n=!1),n){i.push(a),n=!0;break}if(!0===this.highlightOODPathR(a,t,i)){i.push(a),n=!0;break}}}return n},highlightDUPPath:function(e,t){for(var i=[],n=!1,a=e;null!=a.parent;a=a.parent){a.setExpanded(!0);var o=this.controller.model.getConnections();if(a.data.conId>=0&&"duplicate"==o[a.data.conId].typ&&a!=e){n=!0,i.push(a);break}a.data.conId>=0&&i.push(a)}var s=null;if(n)for(s=i[i.length-1];i.length>0;){o[i.pop().data.conId].highlighted=!0}else i.length>0&&(o[(s=i[0]).data.conId].highlighted=!0);return s},clearNotations:function(){for(var e=this.controller.model.getConnections(),t=e.length,i=0;i<t;i++)e[i].highlighted=!1,e[i].marked=!1;var n=this.controller.model.getNodes(),a=n.length;for(i=0;i<a;i++)n[i].isAlternative=!1,n[i].isAlternativeBase=!1},findTreeNode:function(e){var t,i=null;for(t=this.widget.document.first;t;t=t.dftNext(this.widget.document))if(t.data.nodeID==e){i=t;break}return i},onPickContext:function(e){var t=this;if(t.contextMenuPos=[e.ev.clientX,e.ev.clientY],t.contextMenuObject=e,1==t.options.wintop){var i=e.physicalid,n=t.findTreeNode(i).data.name,a=[];a.push({physicalId:i,name:n}),y.fetchContextFromSelection(t.WebToWinComSocket,a)}else u.isOpenWithCATIAV5Available(function(i){UWA.extend(e,{XCADExtension_V_CADOrigin:t.model.nodes.find(function(t){return t.id===e.physicalid}).XCADExtension_V_CADOrigin}),t.doPickContext(e,i)})},doPickContext:function(e,t){var i=this,n=[],a=o.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/",s=null,r=0;if(e&&(r=e.physicalid,s=this.findTreeNode(r)),s)if(1==this.options.wintop){var d=s.document;if(1==this.options.wintop){var l=i.ContextualMenuData[0],c=i.findNode(s.data.nodeID);y.onBuildWinContextMenu(i.WebToWinComSocket,l,n,c)}if(0==s.data.isSelected){x="url("+a+"I_Compare.png)";var u="PushItem",h={callback:S=function(){d.withLockedUpdate(function(){var e=i.findNode(s.data.nodeID),t=i.controller.model.getCurrentNodeID();i.showCompare(t,e)})},this:i};n.push({label:C.compare,title:C.compare,type:u,icon:x,action:h,callback:S})}if(x="url("+a+"I_Duplicate.png)",!this._isFolderType(e.type)){u="PushItem",h={callback:S=function(){d.withLockedUpdate(function(){var e=i.findNode(s.data.nodeID);i.showDuplicates(e)}),d.withLockedUpdate(function(){i.reframe(!1,!0)})},this:i};n.push({label:C.showDuplicates,title:C.showDuplicates,type:u,icon:x,action:h,callback:S})}}else{var f={node:null};a=o.getWebappsBaseUrl()+"HistoryExplorer/assets/icons/32/";f.node=s;for(var g=i._buildContextualMenu(f,t),v=!1,b=[],w=(n=i._createMenuArray(s.data.type,g)).length,D=0;D<w;D++)if("SeparatorItem"===n[D].type||"separator"===n[D].type){if(0===b.length||!0===v)continue;b.push(n[D]),v=!0}else b.push(n[D]),v=!1;n=b}if(s)c=i.findNode(s.data.nodeID);else{c=i.globalDiv;var S,x="url("+a+"I_Reframe.png)";u="PushItem",h={callback:S=function(){i.reframe(!1,!1)},this:i};n.push({label:C.reframe,title:C.reframe,type:u,icon:x,action:h,callback:S}),c=i.globalDiv}if(1==this.options.wintop){var N=window.location.search.indexOf("touch")>=0,A=window.location.search.indexOf("replace")>=0,I={target:c,nodes:n},E={input:N?"touch":"mouse",position:{x:i.contextMenuPos[0],y:i.contextMenuPos[1]},submenu:1==n.length?"outside":A?"replace":"auto"};m.show(n,E)}else{I={target:c,nodes:n},E={input:N?"touch":"mouse",position:{x:i.contextMenuPos[0],y:i.contextMenuPos[1]},submenu:1==n.length?"outside":A?"replace":"auto"};p.show(I,i.contextMenuPos)}},onPickSymbol:function(e){this.model.getCurrentNodeID();var t=e.physicalid,i=e.className;this.clearNotations();var n=this.findTreeNode(t);if(null!=n){if("etree-basic-node-outofdate-status-revision-not-latest-published"==i)this.highlightOODPath(n,!0,!1);else if("etree-basic-node-outofdate-status-revision-not-latest"==i)this.highlightOODPath(n,!1,!1);else if("etree-basic-node-outofdate-status-revision-latest"==i);else if("etree-basic-node-duplicate-status-duplicated-newer-published-exists"==i){null!=(a=this.highlightDUPPath(n,"duplicated"))&&this.highlightOODPath(a.parent,!0,!1)}else if("etree-basic-node-duplicate-status-duplicated-newer-exists"==i){var a;null!=(a=this.highlightDUPPath(n,"duplicated"))&&this.highlightOODPath(a.parent,!1,!1)}else"etree-basic-node-duplicate-status-duplicated"==i&&this.highlightDUPPath(n,"duplicated");this.updateUI(!0,!0,!1,!1)}},onPickNewRevisionFrom:function(e){this.clearNotations();var t=this.findTreeNode(e.physicalid);null!=t&&(this.highlightNewRevFromPath(t),this.updateUI(!0,!0,!1,!1))},highlightNewRevFromPath:function(e){var t=this.findNode(e.data.nodeID),i=null;if(null!=t&&t.hasOwnProperty("revisedFrom")&&(i=t.revisedFrom),null!=i){for(var n=[],a=e;null!=a.parent;a=a.parent)a.setExpanded(!0),n.push(a);for(var o=[],s=this.findTreeNode(i);null!=s.parent;s=s.parent)s.setExpanded(!0),o.push(s);var r=null,d=!1;if(o.length<n.length)var l=o,c=n;else l=n,c=o;for(var u=0;u<l.length;u++){r=l[u];for(var h=0;h<c.length;h++)if(r.data.nodeID==c[h].data.nodeID){d=!0;break}if(d)break}var p=this.controller.model.getConnections();d&&(this.processNodeStackToHighlightNewRevFromPath(n,r,p),this.processNodeStackToHighlightNewRevFromPath(o,r,p))}},processNodeStackToHighlightNewRevFromPath:function(e,t,i){for(var n=!1;e.length>0;){var a=e.pop();a.data.nodeID!=t.data.nodeID?n&&(i[a.data.conId].highlighted=!0):n=!0}},_showOpenInCATIAMenu:function(e){try{return!e.options.wintop&&(!h.isInPSEditorWidget(e.options.context.widget)&&(!!h.isInXCADEditorWidget(e.options.context.widget)||!!h.isDECType(e.contextMenuObject.typeUntranslated)))}catch(e){return!0}},_displayOpenWithCATIAV5:function(e,t){try{return!e.options.wintop&&(!h.isInPSEditorWidget(e.options.context.widget)&&(!h.isInXCADEditorWidget(e.options.context.widget)&&!h.isDECType(e.contextMenuObject.typeUntranslated)))}catch(e){return!1}},_buildContextualMenu:function(e,t){var i={},n=!0,r=s.getCommand("HistoryHdr",v);r&&!1===r.isEditMode&&(n=!1);var d=this;o.getWebappsBaseUrl();d._isWidget=!0;try{d.options.context.context.hasOwnProperty("dialog")&&(d._isWidget=!1)}catch(e){}function l(e,t){return"url("+o.getWebappsBaseUrl()+(t||"HistoryExplorer")+"/assets/icons/32/"+e+")"}if(i.Separator={type:"separator"},i.WhereUsed={label:C.whereUsed,icon:l("I_ENORIPE32.png"),callback:function(){e.node.document.withLockedUpdate(function(){var t=require("DS/PADUtils/PADCommandProxy").create();require(["DS/PADUtils/PADUtilsServices"],function(i){var n=[];n.push({envId:"",serviceId:"",contextId:"",objectId:e.node.data.nodeID,objectType:e.node.data.type,displayName:e.node.data.displayName});var o={protocol:"3DXContent",version:"1.0",source:"ENOSTDE_AP",data:{items:n}},s={attributes:{},paths:[],version:"1.1"};s.attributes[e.node.data.nodeID]={label:e.node.data.displayName,type:e.node.data.type},s.paths.push([e.node.data.nodeID]);var r=new a.Socket("compassPageSocket");r.subscribeServer("com.ds.compass",window.parent),r.dispatchEvent("onSetX3DContent",o,"compassPageSocket"),r.addListener("launchApp",function(e){t.select(s),t.destroy(),console.log("Response = "+JSON.stringify(e))}),r.dispatchEvent("onLaunchApp",{appId:"ENORIPE_AP"},"compassPageSocket")})})}},!0===n&&(i.Delete={label:C.delete_,icon:l("I_Delete.png","LifecycleCmd"),callback:function(){e.node.document.withLockedUpdate(function(){d.showDelete([e.node.data])})}}),!0===n&&(d._isWidget||(i.Maturity={label:C.maturity,icon:l("I_Maturity.png","LifecycleCmd"),callback:function(){e.node.document.withLockedUpdate(function(){d.showMaturity([e.node.data])})}})),!0===n&&(i.Duplicate={label:C.duplicate,icon:l("I_Duplicate.png","LifecycleCmd"),callback:function(){e.node.document.withLockedUpdate(function(){d.showDuplicate([e.node.data])})}}),!0===n&&(i.Revise={label:C.newRevision,icon:l("I_Revise.png","LifecycleCmd"),callback:function(){e.node.document.withLockedUpdate(function(){d.showMajorVersion([e.node.data])})}}),!0===n&&u.hasPARRole(function(t){if(1==t){var n=s.getCommand("ReviseFromHdr",v);n&&n.isTypesSupported([e.node.data.typeUntranslated])&&(i.ReviseFrom={label:C.newRevisionFrom,icon:l("I_ReviseFrom.png","LifecycleCmd"),callback:function(){e.node.document.withLockedUpdate(function(){d.showReviseFrom([e.node.data])})}})}}),this._showOpenInCATIAMenu(d)&&(i.OpenInCV5={label:C.openCATIA,icon:l("ENOV5MA_AP_AppIcon.png","FolderEditor"),callback:function(){e.node.document.withLockedUpdate(function(){g.mask(d.parentWidget,C.openCATIALaunchMessage),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(t,i){var n={version:"1",structures:{references:[],connections:[],trees:{}}};n.structures.references.push({localid:"0",physicalid:e.node.data.nodeID,type:"CATProduct"}),n.structures.trees[0]={selected:!0};var o={data:n,onComplete:function(e){var i=UWA.is(e,"string")?JSON.parse(e):e;t.setStructure_4_open_in_cv5({completeselection:i});var n=new a.Socket("compassPageSocket");n.subscribeServer("com.ds.compass",window.parent),n.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e)),g.unmask(d.parentWidget)}),n.dispatchEvent("onLaunchApp",{appId:"ENOV5MA_AP"},"compassPageSocket")},onFailure:function(e){console.error("PADWSAccess.completeselection",e),g.unmask(d.parentWidget)},timeout:0};d._isWidget?(console.log("isWidget true, initialize PADSettingsMgt and PADUtilsServices"),require("DS/PADUtils/PADSettingsMgt").set_app_context("enopad"),t.app_initialization(function(){i.completeselection(o)})):i.completeselection(o)})})}}),this._displayOpenWithCATIAV5(d,t)){var c=this,p=function(){h.getSecurityContext(u.getTenant(),function(t){e.node.document.withLockedUpdate(function(){g.mask(c.elements.container,C.openCATIALaunchMessage);var e={objectId:d.contextMenuObject.physicalid,envId:u.getTenant(),contextId:t};require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(t){t.publish("setObject",e);var i=new a.Socket("compassPageSocket");i.subscribeServer("com.ds.compass",window.parent),i.addListener("launchApp",function(e){console.log("Response = "+JSON.stringify(e)),g.unmask(c.elements.container)}),i.dispatchEvent("onLaunchApp",{appId:"MAP-CATCDVEAP"},"compassPageSocket")})})})},f={title:C.OpenWith,label:C.openCATIA,icon:l("ENOV5MA_AP_AppIcon.png","FolderEditor"),type:A,callback:p,submenu:[{type:A,title:C.OpenWithCV5,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/ENOV5MA_AP_AppIcon.png")+")",action:{this:d,callback:p}}]};0,i.openWith=f}return!0===n&&(i.Properties={label:C.properties,icon:l("I_CATSSEditorDisplayProperties.png"),callback:function(){e.node.document.withLockedUpdate(function(){var t=d.findNode(e.node.data.nodeID);d.showProperties(t)})}}),!1===e.node.data.isSelected&&require.defined("DS/CompareCmd/CompareCmd")&&(i.Compare={label:C.compare,icon:l("I_Compare.png"),callback:function(){e.node.document.withLockedUpdate(function(){var t=d.findNode(e.node.data.nodeID),i=d.controller.model.getCurrentNodeID();d.showCompare(i,t)})}}),this._isFolderType(e.node.data.type)||(i.ShowDuplicates={label:C.showDuplicates,icon:l("I_Duplicate.png"),callback:function(){var t=e.node.document;e.node.document.withLockedUpdate(function(){var t=d.findNode(e.node.data.nodeID);d.showShowDuplicates(t)}),t.withLockedUpdate(function(){d.reframe(!1,!0)})}}),i},_createMenuArray:function(e,t){function i(e){var i=t[e];return i&&"string"!=typeof i.type?UWA.extend(i,{title:i.label,type:A,action:{this:this,callback:i.callback}}):i}function n(e){return void 0!==e}return this._isFolderType(e)?["Properties","Separator","Delete","Separator","WhereUsed"].map(i).filter(n):["Properties","Compare","ShowDuplicates","Separator","Maturity","Revise","ReviseFrom","Delete","Duplicate","Separator","WhereUsed","OpenInCV5","openWith"].map(i).filter(n)},showShowDuplicates:function(e){this.highlightDuplicates(e)?this.updateUI(!1,!1,!1,!1):this.displayInfo(C.noDupesFound)},showDelete:function(e){s.getCommand("DeleteHdr",v).execute(e)},showMaturity:function(e){s.getCommand("MaturityHdr",v).execute(e)},showDuplicate:function(e){s.getCommand("DuplicateHdr",v).execute(e)},showOpenInCatia:function(e){var t=this;g.mask(t.elements.container),require(["DS/PADUtils/PADUtilsServices"],function(e){e.open_app({appId:"ENOV5MA_AP"},function(){g.unmask(t.elements.container)})})},showMajorVersion:function(e){s.getCommand("RevisionHdr",v).execute(e)},showReviseFrom:function(e){s.getCommand("ReviseFromHdr",v).execute(e)}})});