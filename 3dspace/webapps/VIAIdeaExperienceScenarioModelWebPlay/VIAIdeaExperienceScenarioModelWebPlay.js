define("DS/VIAIdeaExperienceScenarioModelWebPlay/StuProxy/StuCATICXPAnimation",["UWA/Core","DS/CoreEvents/Events","DS/XCTWebExperienceAppPlay/StuProxy/StuProxy","UWA/Class/Listener","DS/StuModel/StuAnimationEvent","DS/StuModel/StuAnimationFinishedEvent","DS/StuModel/StuAnimationLoopFinishedEvent","DS/StuModel/StuAnimationLoopStartedEvent","DS/StuModel/StuAnimationPausedEvent","DS/StuModel/StuAnimationResumedEvent","DS/StuModel/StuAnimationStartedEvent","DS/StuModel/StuAnimationStoppedEvent"],function(e,t,i,n){"use strict";const s=0,a=1,o=3;return i.extend(n,{init:function(e,t){this._animationPlayState=s,this._restartTime=0,this._parent(e,t)},dispose:function(){this.stopListening(),this._animationEndEvent&&(t.unsubscribe(this._animationEndEvent),delete this._animationEndEvent),this._animationLoopStartedEvent&&(t.unsubscribe(this._animationLoopStartedEvent),delete this._animationLoopStartedEvent),this._animationLoopFinishedEvent&&(t.unsubscribe(this._animationLoopFinishedEvent),delete this._animationLoopFinishedEvent),this._scenarioMgr.PlayScenario(this._scenario,0),this._scenario.SetCurrentFrame(0),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),delete this._scenario,delete this._scenarioMgr,this._parent()},setVCXScenario:function(e,i){this._scenario=e,this._scenarioMgr=i;var n=this,s=this.getModelObject().QueryInterface("CATI3DExperienceObject");this._setIsReverse(s.GetValueByName("reverse")),this.listenTo(s,"reverse.CHANGED",function(e){n._setIsReverse(e)}),this._setIsBounce(s.GetValueByName("bounce")),this.listenTo(s,"bounce.CHANGED",function(e){n._setIsBounce(e)}),this._setIsLoop(s.GetValueByName("loop")),this.listenTo(s,"loop.CHANGED",function(e){n._setIsLoop(e)}),this._setSpeed(s.GetValueByName("speedFactor")),this.listenTo(s,"speedFactor.CHANGED",function(e){n._setSpeed(e)}),this._animationEndEvent=t.subscribe({event:"VCX_SCENARIO_PLAY_END_REACHED"},function(e){n._scenario.GetID()===e&&(n._dispatchEvent("AnimationFinished"),n._dispatchEvent("ServiceStoppedEvent"))}),this._animationLoopStartedEvent=t.subscribe({event:"VCX_SCENARIO_PLAY_LOOP_START_REACHED"},function(e){n._scenario.GetID()===e&&n._dispatchEvent("AnimationLoopStarted")}),this._animationLoopFinishedEvent=t.subscribe({event:"VCX_SCENARIO_LOOP_END_REACHED"},function(e){n._scenario.GetID()===e&&n._dispatchEvent("AnimationLoopFinished")})},play:function(){if(this._animationPlayState!==o||this._isAnimationFinished()){this._scenarioMgr.PlayScenario(this._scenario,this._restartTime*this._scenarioMgr.GetFPS()),this._restartTime=0;var e=this._animationPlayState===a;this._animationPlayState=o,e?this._dispatchEvent("AnimationResumed"):this._dispatchEvent("AnimationStarted")}},pause:function(){this._animationPlayState===o&&(this._restartTime=this._scenario.GetCurrentFrame()/this._scenarioMgr.GetFPS(),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),this._animationPlayState=a,this._dispatchEvent("AnimationPaused"))},stop:function(){var e;this._animationPlayState!==s&&(e=this.getModelObject().QueryInterface("CATI3DExperienceObject").GetValueByName("reverse")?this._scenario.GetMaxFrame():0,this._scenarioMgr.PlayScenario(this._scenario,e),this._scenario.SetCurrentFrame(e),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()),this._restartTime=0,this._animationPlayState=s,this._dispatchEvent("AnimationStopped"),this._dispatchEvent("ServiceStoppedEvent"))},isPlaying:function(){return this._animationPlayState===o},isPaused:function(){return this._animationPlayState===a},getDuration:function(){return this._scenario.GetMaxFrame()/this._scenarioMgr.GetFPS()},setTime:function(e){var t=e*this._scenarioMgr.GetFPS();this._scenarioMgr.PlayScenario(this._scenario,t),this._animationPlayState!==o&&(this._restartTime=e,this._scenario.SetCurrentFrame(t),this._scenarioMgr.StopPlayingScenario(this._scenario.GetID()))},getTime:function(){return this._scenario.GetCurrentFrame()/this._scenarioMgr.GetFPS()},getAnimatedObjects:function(){var e=[];this._scenario.GetListModifiables(e);for(var t=[],i=0;i<e.length;i++){var n=this._scenarioMgr.ModifiableServer.GetModifiableFromHashing(e[i]);if(n){var s=n.GetObject(),a=s._experienceBase.getManager("CAT3DExperienceESExportManager").getProjectedESObject(s);a&&t.push(a)}}return t},isRewinding:function(){return this._scenario.GetIsBouncing()!==this._scenario.GetIsReverse()},_setIsReverse:function(e){this._scenario.SetIsReverse(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_setIsBounce:function(e){this._scenario.SetIsBounce(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_setIsLoop:function(e){this._scenario.SetIsLoop(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_setSpeed:function(e){this._scenario.SetSpeed(e),this._animationPlayState===o&&this._scenarioMgr.PlayScenario(this._scenario,this._scenario.GetCurrentFrame())},_dispatchEvent:function(e){this.getStuObject().doDispatchEvent(e)},_isAnimationFinished:function(){if(this._scenario.GetIsReverse()){if(0===this._scenario.GetCurrentFrame())return!0}else if(this._scenario.GetCurrentFrame()===this._scenario.GetMaxFrame())return!0;return!1}})}),define("DS/VIAIdeaExperienceScenarioModelWebPlay/extensions/StuEAnimationPrototypeBuild",["UWA/Core","DS/XCTWebExperienceAppPlay/extensions/StuEExperienceBasePrototypeBuild","DS/VIAIdeaExperienceScenarioModelWebPlay/StuProxy/StuCATICXPAnimation"],function(e,t,i){"use strict";return t.extend({build:function(e){if(!e.CATICXPAnimation){e.CATICXPAnimation=new i(this.GetObject(),e);var t=this.GetObject()._experienceBase.getManager("VCXScenarioManager"),n=this,s=this._parent;return this.QueryInterface("CATI3DXVCXScenarioAsset").getVCXScenario().done(function(i){return e.CATICXPAnimation.setVCXScenario(i,t),s.call(n,e)})}return this._parent(e)},disposeESObject:function(e){e.CATICXPAnimation.dispose(),delete e.CATICXPAnimation,this._parent(e)}})});