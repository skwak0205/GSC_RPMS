define("DS/CfgAuthoringContextUX/scripts/CfgCACustomTileView",["DS/W3DXComponents/Views/Item/TileView","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX"],function(e,t){"use strict";return e.extend({name:"CACustomAuthListTile",template:function(){return'                            <div class="'+this.getClassNames("-check")+' {{#unless withMultisel}}hidden{{/unless}}"></div>                              <div class="'+this.getClassNames("-sub-container")+'" draggable="true">                                  <div class="'+this.getClassNames("-header")+'">                                      <div>{{#if image}}<img  src="{{#unless lazyLoading}}{{image}}{{/unless}}" {{getImgAttrs imgAttrs}} class="'+this.getClassNames("-image")+'" draggable="false"/>{{/if}}</div>\t\t\t\t\t\t\t\t\t                    {{#if holdStatus}}<div class="state" title="{{{holdValue}}}[{{{currentDisplay}}}]">{{{holdValue}}}</div>{{/if}}\t\t\t\t\t\t\t\t\t\t\t\t\t\t{{#unless holdStatus}}<div class="state" title="{{{currentDisplay}}}">{{{currentDisplay}}}</div>{{/unless}}\t\t\t\t\t\t\t\t              </div>                                <div class="'+this.getClassNames("-body")+'">                                    {{#if icon}}<img src="{{icon}}" class="'+this.getClassNames("-icon")+'" draggable="false"/>{{/if}}\t                                <div class="'+this.getClassNames("-title")+'" title="{{{title}}}">{{{title}}}</div>\t                                <div class="'+this.getClassNames("-subtitle")+'" title="{{{subtitle}}}">{{{subtitle}}}</div>\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-content")+'">\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-CAowner")+'" title="{{{ownerDisplayName}}}">{{{ownerField}}}&nbsp;{{{ownerDisplayName}}}</div>\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-Role")+'" title="{{{contextUserRole}}}">{{{roleField}}}&nbsp;{{{contextUserRole}}}</div>\t\t\t\t\t\t\t\t\t\t<div class="'+this.getClassNames("-DueDate")+'">{{{dueDateField}}}&nbsp;{{{due}}}</div>\t\t\t\t\t\t\t\t\t</div>                                    <ps-progress  class="'+this.getClassNames("-progress")+'"></ps-progress>                                </div>                            </div>                                    '}})}),define("DS/CfgAuthoringContextUX/scripts/CfgCAAuthCtxTileView",["DS/W3DXComponents/Views/Item/TileView","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX"],function(e,t){"use strict";return e.extend({name:"CACustomAuthCtxTile",template:function(){return'                           <div class="'+this.getClassNames("-check")+' {{#unless withMultisel}}hidden{{/unless}}">                                            <div class="toggle toggle-primary">                                                <input type="checkbox" name="radios" value="" id="checkbox-{{cid}}">                                                <label class="control-label" for="checkbox-{{cid}}"></label>                                            </div>                                        </div>                                        <div class="'+this.getClassNames("-sub-container")+'" draggable="true">                                            <div class="'+this.getClassNames("-header")+'">                                                {{#if image}}<img src="{{#unless lazyLoading}}{{image}}{{/unless}}" {{getImgAttrs imgAttrs}} class="'+this.getClassNames("-image")+'" draggable="false"/>{{/if}}                                            </div>                                            <div class="'+this.getClassNames("-body")+'">                                                {{#if icon}}<img src="{{icon}}" class="'+this.getClassNames("-icon")+'" draggable="false"/>{{/if}}\t                                                <div class="'+this.getClassNames("-title")+'" title="{{{title}}}">{{{title}}}</div>                                                <div class="'+this.getClassNames("-subtitle")+'" title="{{{subtitle}}}">{{{subtitle}}}</div>                                                <div class="'+this.getClassNames("-content")+'"title="{{{content}}}">{{{content}}}</div>                                            <div class="'+this.getClassNames("-content")+'"title="{{{severity}}}">{{{severity}}}</div>                                            <progress max="100" value="10" class="'+this.getClassNames("-progress")+'"></progress>                                            </div>                                            <div class="'+this.getClassNames("-actions")+'">                                                <div class="actions-inline-container">                                                    <div class="action-container single-action hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x"></span></div>                                                    </div>                                                    <div class="action-container actions-inline-dotted hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x fonticon-down-open"></span></div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    '},domEvents:function(){return{"click .tile-title":function(){this.dispatchEvent("onClickTitle")}}}})}),define("DS/CfgAuthoringContextUX/scripts/CfgSessionDialog",["i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/CfgBaseUX/scripts/CfgContainerView","DS/PlatformAPI/PlatformAPI","DS/CfgBaseUX/scripts/CfgController","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],function(e,t,i,n,o){"use strict";var s={collectionNew:null,CfgDialogIns:null,create:function(a,r=""){var l=this;l.CfgUXEnvVariables=JSON.parse(o),n.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",require(["DS/CfgBaseUX/scripts/CfgDialog","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgBaseUX/scripts/CfgUtility","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgController"],function(n,o,d,c,u,g,h){s.OKhandlar=function(t){var n=o.getGlobalSessiondata();void 0!==window.__karma__&&(n=enoviaServerAuthoringWidget.odtEditMode?{"Evolution Expression":'<CfgEffectivityExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgEffectivityExpression.xsd"><Expression><Context HolderType="Model" HolderName="SONY"><Date><Interval><From Value = "2018-04-13"/></Interval></Date></Context></Expression></CfgEffectivityExpression>',"Dictionary Contexts":"[EA33B156971D0000420BD75AEF620400]",ACId:"EA33B156CB2A00008921D75AC3D50800"}:{"Evolution Expression":"","Dictionary Contexts":"[]"}),""!=n["Evolution Expression"]?(h.init(),enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")||"OnPremise",u.populate3DSpaceURL().then(function(t){u.populateSecurityContext().then(function(t){c.getAuthoringIDforEvolution(n).then(function(e){const t=[],a=[];for(const e of o.collection._models)0==u.isEmptyEvolutionExpressionForModel(e)&&(t.push(e),a.push(e.id));const l={ACId:e.ACId,evolutionExpression:n["Evolution Expression"],dictionaryContext:a,displayExpression:e.XSLTExpr,collection:t};i.publish("sessionEff",Object.assign(l,{PACID:r})),s.CfgDialogIns.closeDialog()},function(t){console.log("Create fail"),console.log(t),t&&"1"===t.errorID?u.showwarning(e.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):u.showwarning(e.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")})},function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)})},function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)})):(i.publish("removeAuthCtxSessionEvent"+r),s.CfgDialogIns.closeDialog())},s.CANhandlar=function(){s.CfgDialogIns.closeDialog(),a.style.pointerEvents="auto"};var C={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",parent:null,parentElement:null,objectid:null,mode:"SessionEffectivity",iXml:"",modelList:null,width:800,height:500,minHeight:310,minWidth:310,Access:{SetSessionEffectvity:"true"},dialogue:{header:e.CFG_Edit_Session_Header,buttonArray:null,target:widget.body,object:null,postCloseHandler:function(){a.style.pointerEvents="auto"}}},v={isHeader:!1,isFooter:!0,firstButtonText:e.CFG_SE_ACTION_OK,secondButtonText:e.CFG_SE_ACTION_Cancel,headerText:e.CFG_Edit_Session_Header,onButtonClickCB:function(e){"firstButton"==e.buttonId?s.OKhandlar():s.CANhandlar()}};C.dialogue.modelViewContainer=new t(v).render(),C.dialogue.modelViewContainer.getContent().addClassName("CfgContainerView-EditEvolution-CustomTile"),C.mode="EditEvolution",s.CfgDialogIns=new n(C),C.mode="SessionEffectivity",C.dialogue.modelViewContainer.inject(s.CfgDialogIns.container),C.parent=s.CfgDialogIns.container,C.parentElement=s.CfgDialogIns.container,C.dialogue.object=s.CfgDialogIns,s.CfgDialogIns.render(),o.create(C),0==l.CfgUXEnvVariables.isWUXDialogEnabled&&(null!=document.getElementsByClassName("CfgEditEvolutionDialog")[0]&&(a.style.pointerEvents="none"),document.getElementsByClassName("CfgEditEvolutionDialog")[0].setAttribute("style",document.getElementsByClassName("CfgEditEvolutionDialog")[0].getAttribute("style")+"min-height:310px !important;min-width:310px !important;"))})}};return s}),define("DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility",["DS/DataDragAndDrop/DataDragAndDrop","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","DS/UIKIT/Alert"],function(e,t,i,n,o,s,a,r){"use strict";return{getCAdetails:function(e){return new Promise(function(t,i){var o="/resources/modeler/change/changeaction/pid:"+e+"?attributes=1&context=1&people=1&applicability=1";n.makeWSCall(o,"GET","enovia","application/json","",function(e){t(e)},function(e,t){i(t||e)},!0)})},getCAdetailsForAuthoring:function(e){return new Promise(function(t,i){var o="/resources/modeler/change/changeaction/pid:"+e+"?attributes=1&editability=1";n.makeWSCall(o,"GET","enovia","application/json","",function(e){t(e)},i,!0)})},getCAWorkUnderList:function(){return new Promise(function(e,t){n.makeWSCall("/resources/modeler/change/changeactions?workunder=1","GET","enovia","application/json","",function(t){e(t)},t,!0)})},getAuthoringIDforEvolution:function(e){return new Promise(function(t,i){var o=JSON.stringify(e);n.makeWSCall("/resources/authoringcontext/service","POST","enovia","application/json",o,function(e){t(e)},(e,t)=>i(t||e),!0)})},getEvolutionStateFromXMLExpression:function(e){const t={mv:"None",mp:"None",unit:"None",date:"None"};if(0!=e){const i=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Expression")[0];let n="",o=!1;try{n=i.getElementsByTagName("TreeSeries")}catch(e){o=!0}o&&(n=i.childNodes[0]);const s=i.getElementsByTagName("Series"),a=i.getElementsByTagName("Date");if(n.length>0)for(const e of n){if("ProductState"==e.attributes.Type.value){let i=!1,n=!1;for(const t of e.childNodes)"Single"==t.tagName&&(i=!0),"Tree"==t.tagName&&(n=!0);t.mv=1==i?1==n?"Both":"Single":1==n?"Range":"None"}if("ManufPlan"==e.attributes.Type.value){let i=!1,n=!1;for(const t of e.childNodes)"Single"==t.tagName&&(i=!0),"Tree"==t.tagName&&(n=!0);t.mp=1==i?1==n?"Both":"Single":1==n?"Range":"None"}}if(s.length>0)for(const e of s)if("Unit"==e.attributes.Type.value){let i=!1,n=!1;for(const t of e.childNodes)"Single"==t.tagName&&(i=!0),"Interval"==t.tagName&&(n=!0);t.unit=1==i?1==n?"Both":"Single":1==n?"Range":"None"}if(a.length>0)for(const e of a){let i=!1,n=!1;for(const t of e.childNodes)if(console.log(t),1==t.childNodes.length)n=!0;else{t.childNodes[0].attributes.Value.value.split("T")[0]==t.childNodes[1].attributes.Value.value.split("T")[0]?i=!0:n=!0}t.date=1==i?1==n?"Both":"Single":1==n?"Range":"None"}console.log(t)}return t},sendTrackerAPIAuthoringContext:function(e){let t=this.getEvolutionStateFromXMLExpression(!1);Object.prototype.hasOwnProperty.call(e.authoring,"evolution")&&Object.prototype.hasOwnProperty.call(e.authoring.evolution,"xml")&&(t=this.getEvolutionStateFromXMLExpression(e.authoring.evolution.xml)),o.createEventBuilder({category:o.Category.USAGE,action:o.Events.CLICK,tenant:e.tenant}).setLabel(o.Labels.WORK_UNDER_AUTHORING_CONTEXT).setAppId(e.widget.id||"NO_APP_ID").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_WIDGET,e.widget.name||"ODT Environment").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_MEDIA,o.getDeviceUsedForOperation()).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_TYPE,e.authoring.type||"Empty").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_CHANGE_APPLICABILITY,"Change"==e.authoring.type&&"TRUE"==e.authoring.change.applicability?"TRUE":"FALSE").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_MV,t.mv).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_MP,t.mp).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_UNIT,t.unit).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_EVOLUTION_DATE,t.date).addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_SET,e.authoring.settingBy||"Authoring").addDimension(s.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_USAGE,e.authoring.usage||"Set").addPersonalValue(a.WORK_UNDER_AUTHORING_CONTEXT.AUTHORING_CONTEXT_NO_OF_MODEL,e.authoring.evolution.noModel||0).send()},showMessage:function(e){this.removeClassFromDom("wp-authAlert"),new r({className:"wp-authAlert",autoHide:!0,visible:!0,hideDelay:2e3}).inject(e.element,"top").add({className:e.type||"primary",message:e.message})},getWorkUnderEmptyObject:function(){return{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""},evolution:{id:"",displayExpression:""},configurationRevision:null}},cleanDraggableEvent:function(t){e.clean(t,"drag"),void 0!==t._evts&&(t._evts.drg=null),t.evts=null},makeDraggable:function(t,i){const n={protocol:"3DXContent",version:"1.0",source:widget.data.appId||"",widgetId:widget.id||"",data:{items:[]}};"change"===enoviaServerAuthoringWidget.saveMode?n.data.items.push({envId:widget.getValue("x3dPlatformId")||"OnPremise",serviceId:enoviaServerAuthoringWidget.serviceName||"3DSpace",contextId:enoviaServerAuthoringWidget.getSecurityContext()||"",objectId:i.id||"",objectType:"Change Action"}):"session"===enoviaServerAuthoringWidget.saveMode&&n.data.items.push({envId:widget.getValue("x3dPlatformId")||"OnPremise",serviceId:enoviaServerAuthoringWidget.serviceName||"3DSpace",contextId:enoviaServerAuthoringWidget.getSecurityContext()||"",objectId:i.id||"",objectType:"Authoring Context",objectData:{evolutionExpression:i._attributes.evolExpression||"",dictionaryContext:i._attributes.dictionaryContext||"",displayExpression:i._attributes.content||""}}),e.draggable(t,{data:JSON.stringify(n)})},readAuthroingContext:function(){return new Promise(function(e,t){n.makeWSCall("/resources/authoringcontext/service/pid:dummyid","GET","enovia","application/json","",function(t){e(t)},t,!0)})},deleteAuthroingContext:function(){return new Promise(function(e,t){n.makeWSCall("/resources/authoringcontext/service/pid:dummyid","DELETE","enovia","application/json","",function(t){e(t)},t,!0)})},getObjectFromEvolutionContextIds:(e,t,i,o)=>(null!=t&&null!=t||(t=!1),null!=i&&null!=i||(i="Change Action"),null!=o&&null!=o||(o=["In Work","Complete"]),new Promise(function(t,i){var o={with_indexing_date:!0,with_nls:!0,label:"cfgRevisionCALabel",locale:"en",select_predicate:["ds6w:identifier","ds6w:label","ds6wg:marketing_Name","ds6w:description","ds6w:type","current","owner","ds6w:responsible","ds6w:created","ds6w:lastModifiedBy"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Model") AND ((([ds6w:label]: + (*'+e+"*)) OR ([name]:(*"+e+"*))))",nresults:1e3,start:0,source:[],tenant:enoviaServerFilterWidget.tenant};o=JSON.stringify(o);n.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",o,function(e){t(e)},function(e){i(e)},!1,{isfederated:!0})})),removeClassFromDom:function(e){for(var t=document.querySelectorAll("."+e),i=0;i<t.length;i++)t[i].remove()},isChangeLicencesValid:(e,t,i)=>e||t||i,isConfigurationLicencesValid:(e,t)=>e||t}}),define("DS/CfgAuthoringContextUX/scripts/CfgSessionAuthTileView",["DS/W3DXComponents/Views/Item/TileView","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX"],function(e,t){"use strict";return e.extend({name:"CASessionAuthCtxTile",template:function(){return'</div>\t\t\t\t <div class="'+this.getClassNames("-sub-container")+'" draggable="true"><div class="'+this.getClassNames("-body")+'"><div class="'+this.getClassNames("-title")+'" title="{{{title}}}">{{{title}}}</div>                                                <div class="'+this.getClassNames("-subtitle")+'" title="{{{subtitle}}}">{{{subtitle}}}</div>                                                <div class="'+this.getClassNames("-content")+'"title="{{{content}}}">{{{content}}}</div></div>                                            <div class="'+this.getClassNames("-actions")+'">                                                <div class="actions-inline-container">                                                    <div class="action-container single-action hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x"></span></div>                                                    </div>                                                    <div class="action-container actions-inline-dotted hidden">                                                        <div class="action-icon-wrapper"><span class="fonticon fonticon-2x fonticon-down-open"></span></div>                                                    </div>                                                </div>                                            </div>                                        </div>                                    '}})}),define("DS/CfgAuthoringContextUX/scripts/CfgCAListDialog",["UWA/Drivers/Alone","DS/UIKIT/Modal","DS/UIKIT/Input","DS/UIKIT/Input/Button","UWA/Class/View","DS/W3DXComponents/Views/Layout/GridScrollView","DS/CfgAuthoringContextUX/scripts/CfgCACustomTileView","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/UIKIT/Alert","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/Item/ActionsInlineView","DS/UIKIT/Input/Text","DS/UIKIT/Iconbar","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgData","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/ENOFloatingPanel/ENOFloatingPanel","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json"],function(e,t,i,n,o,s,a,r,l,d,c,u,g,h,C,v,p,m,f,A,D,w,y,S,b){"use strict";var E={collectionNew:null,caIcon:"/snresources/images/icons/large/I_ECM_CA108x144.png",create:function(e,t){var i=this,n=JSON.parse(b);i.isWUXDialogEnabled=n.isWUXDialogEnabled,this.MainContainer=new UWA.Element("div",{id:"caListDiv",styles:{width:"100%",height:"100%",display:"table"}}),this.headerwrapperDiv=new UWA.Element("div",{id:"headerwrapperDiv",styles:{display:"table-row"}}),this.CAHeader=new UWA.Element("div",{id:"CAHeaderDiv",styles:{width:"100%",display:"inline-flex",flexDirection:"row-reverse"}}),this.inlineActionDiv=new UWA.Element("div",{id:"inlineActionDiv",styles:{}}),this.CAListBodyDiv=new UWA.Element("div",{id:"CAListBodyDiv",styles:{width:"100%",height:"100%",display:"table-row"}}),this.CASubActiondivText=new UWA.Element("div",{id:"CASubActiondiv",html:l.CFG_Heading_SortBY+':<font color="#78befa">'+l.CFG_Heading_Date+"</font>",styles:{fontSize:"1.3em"}}),this.CASearchDiv=new UWA.Element("div",{id:"CASearchDiv",styles:{width:"50%",height:"10%",display:"none"}});new C({renderTo:this.CAHeader,items:[{fonticon:"down-bold",text:l.CFG_ToolTip_Ascending_Descending,handler:function(e){E.sortCAListByDate()}},{className:"divider"},{fonticon:"search",text:l.CFG_tooltip_Search,handler:function(e){E.searchCA()}}]});this.CAHeader.appendChild(this.CASubActiondivText),this.headerwrapperDiv.appendChild(this.CAHeader),this.MainContainer.appendChild(this.headerwrapperDiv),this.CAsearchBX1=new h({id:"CAsearchBX1",attributes:{placeholder:l.CFG_CA_Searchby_NameTitle,events:{keyup:this.searchBoxKeyUpHandler}}}).inject(this.CASearchDiv),this.CAsearchBX1.elements.input.setStyles({width:"55%",padding:"6px",margin:"0px"}),this.MainContainer.appendChild(this.CASearchDiv),this.MainContainer.appendChild(this.CAListBodyDiv),this.getModel(e),v.mask(this.MainContainer),y.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",w.populate3DSpaceURL().then(function(e){w.populateSecurityContext().then(function(e){i.getWorkUnderCAList().then(e=>{var t=new UWA.Class.Collection(e),n=[];(n=t.sortBy("due")).reverse(),t.reset(n),i.collectionNew=t,E.createView(t),v.unmask(E.MainContainer)})},function(e){return Promise.reject(e)})},function(e){return Promise.reject(e)})},createNative:async function(e){this.options=e,this.createNativeHeaderAndSearchBox();let t=await this.getWorkUnderCAListForNative();0!==t.length&&this.getWorkUnderCAListSuccessCB(t)},createNativeHeaderAndSearchBox:function(){this.CAListHeader=new UWA.Element("div",{id:"ca-list-header-div",styles:{width:"100%",display:"inline-flex",flexDirection:"row-reverse"}}),this.CASubActiondivText=new UWA.Element("div",{id:"ca-sub-action-div",html:`${l.CFG_Heading_SortBY} :<font color="#78befa"> ${l.CFG_Heading_Date} </font>`,styles:{fontSize:"1.3em",justifySelf:"center",alignSelf:"center"}});new C({renderTo:this.CAListHeader,items:[{fonticon:"down-bold",text:l.CFG_ToolTip_Ascending_Descending,handler:function(e){E.sortCAListByDate()}},{className:"divider"},{fonticon:"search",text:l.CFG_tooltip_Search,handler:function(e){var t=document.querySelector("#ca-search-div");"flex"==t.getStyle("display")?t.setStyle("display","none"):t.setStyle("display","flex")}}]});this.CAListHeader.appendChild(this.CASubActiondivText),this.options.renderTo.appendChild(this.CAListHeader),this.CASearchDiv=new UWA.Element("div",{id:"ca-search-div",styles:{width:"100%",height:"40px",display:"none",justifyContent:"flex-end"}}),this.CAsearchBX1=new h({id:"CAsearchBX1",attributes:{placeholder:l.CFG_CA_Searchby_NameTitle,events:{keyup:this.searchBoxKeyUpHandler}}}).inject(this.CASearchDiv),this.CAsearchBX1.elements.input.setStyles({width:"30%","min-width":"175px",padding:"6px","margin-right":"5px"}),this.options.renderTo.appendChild(this.CASearchDiv)},getWorkUnderCAListSuccessCB:function(e){let t=new UWA.Class.Collection(e);t.reset(t.sortBy("due").reverse()),this.collectionNew=t,this.selectedCAItem,0!==t.length&&this.createNativeView(t,this.options),this.sendCAListViewRenderedNotificationToWIW()},sendCAListViewRenderedNotificationToWIW:function(){let e={eventName:"cfgShowCAList",operation:"InitCompleted",operationVersion:"1.0",content:JSON.stringify({})};w.sendNotificationWebInWin(e)},searchBoxKeyUpHandler:function(e){let t=e.target.value;!0!==E.isForbiddenChar(t)&&(E.enteredText=t,E.filterSearch())},getWorkUnderCAList:function(){return new Promise((e,t)=>{r.getCAWorkUnderList().then(t=>{this.contextArray=[];let{owner:i,contributor:n,reviewer:o,follower:s}=t.details;[i,n,o,s].forEach(e=>this.getCAObjects(e)),e(this.contextArray)})})},getWorkUnderCAListForNative:async function(){let e=await r.getCAWorkUnderList();this.contextArray=[];let{owner:t,contributor:i,reviewer:n,follower:o}=e.details;[t,i,n,o].forEach(e=>this.getCAObjects(e));try{let e=this.contextArray.map(e=>e.id);if(0!==e.length){let t=await w.getObjectsBySearchService(e,!1,"Change Action",["In Work"]);t.results&&this.contextArray.forEach(e=>{let i=t.results.find(t=>{let i=t.attributes.find(e=>"resourceid"===e.name);if(i&&i.value===e.id)return t});if(i){let t=i.attributes.find(e=>"preview_url"===e.name);t&&t.value&&(e.image=t.value)}})}}catch(e){w.showwarning(S.CfgSearchKO,"error")}finally{return this.contextArray}},getCAObjects:function(e){e.forEach(e=>{let{id:t,name:i,owner:n}=e;t=t.split(":")[1];let{Severity:o,Synopsis:s,EstimatedCompletionDate:a}=e.attributes;o=this.getCASeverity(o),a=this.getCAEstimatedCompletionDate(a);let r=this.getCAIndividualObj(s,t,i,n,o,a);this.contextArray.push(r)})},getCASeverity:function(e){let t;switch(e){case"Low":t=l.CFGLabelLow;break;case"Medium":t=l.CFGLabelMedium;break;case"High":t=l.CFGLabelHigh}return t},getCAEstimatedCompletionDate:function(e){return e?new UWA.Date(e).strftime("%Y-%m-%d"):""},getCAIndividualObj:function(e,t,i,n,o,s){return{title:e,id:t,subtitle:i,ownerField:l.CFG_Heading_Owner+":",ownerDisplayName:n,roleField:l.CFG_Heading_Severity+":",contextUserRole:o,dueDateField:l.CFG_Heading_DueDate+":",due:s,image:enoviaServerFilterWidget.computeUrl(this.caIcon),currentDisplay:l.CFG_CA_State_InWork}},getSelectedCAItemForNative:function(){return this.selectedCAItem},createNativeView:function(e,t){this.caListView=new s({collection:e,useInfiniteScroll:!1,scrollDuration:1,itemView:a,withMultisel:!1,events:{onItemViewClick:e=>{p.caListActionEvents.publish({event:"enableOkButtonInCAListContainerView"}),this.selectedCAItem={changeId:e.currentItemView.model._attributes.id,title:e.currentItemView.model._attributes.title,name:e.currentItemView.model._attributes.subtitle}},onItemViewCheck:function(e,t){console.log("item view check done")}}}),this.caListView.render().inject(t.renderTo)},createView:function(e){var t=this;this.caListView=new s({collection:e,useInfiniteScroll:!1,scrollDuration:1,itemView:a,withMultisel:!1,events:{onItemViewClick:function(e){t.dialog.footerButton.Ok.disabled=!1,console.log("Selection done")},onItemViewCheck:function(e,t){console.log("item view check done")}}}),this.caListView.render().inject(this.CAListBodyDiv),t.caListView=this.caListView,this.dialog.footerButton.Ok.disabled=!0},getModel:function(e){var t=this;if(t.isWUXDialogEnabled){var i;i=[{label:"OK",labelValue:l.CFG_Button_OK,className:"primary btn btn-primary okBtn",handler:function(){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(i){if(null!=t.caListView.options.view.currentItemView){var n=t.caListView.options.view.currentItemView.model._attributes.id,o=t.caListView.options.view.currentItemView.model._attributes.title,s=i.get();s.change.id=n,s.change.name=o;i.update(s,function(){i.publish(i.myAuthkey,s)}),t.dialog.closeDialog(),e.style.pointerEvents="auto"}else if(t.caListView.options.view.collection.length>0){var a=i.renderDiv;r.removeClassFromDom("wp-authAlert"),new d({className:"wp-authAlert",visible:!0,autoHide:!0,hideDelay:2e3}).inject(a,"top").add({className:"error",message:l.CFG_NO_SELECTION})}else t.dialog.closeDialog(),e.style.pointerEvents="auto"})}},{label:"Cancel",labelValue:l.CFG_Button_CANCEL,handler:function(){t.dialog.closeDialog(),e.style.pointerEvents="auto"}}];t.dialog=new D({className:"cfgAuthENOFloatingPanelComponent",title:l.CFG_Select_CA_Header,body:this.MainContainer,overlay:!0,mode:"caListDialog",closable:!0,resizable:!0,height:600,width:340,minHeight:200,minWidth:340,styles:{position:"fixed"},dialogue:{header:l.CFG_Select_CA_Header,buttonArray:i,target:widget.body,postCrossHandler:function(){e.style.pointerEvents="auto",t.dialog.closeDialog()}}}).inject(widget.body),t.dialog.render(),t.isWUXDialogEnabled&&null!=document.getElementsByClassName("cfgAuthENOFloatingPanelComponent")[0]&&(e.style.pointerEvents="none")}},sortCAListByDate:function(){var e=document.getElementsByClassName("fonticon fonticon-down-bold"),t=!0;if(0==e.length){t=!1;e=document.getElementsByClassName("fonticon fonticon-up-bold")}if(this.caListView.collection.length>0){var i=[];(i=this.caListView.collection.toArray()).reverse(),this.caListView.collection.reset(i),this.changeSortIcon(e,t)}},changeSortIcon:function(e,t){e.length>0&&(e[0].className=t?"fonticon fonticon-up-bold":"fonticon fonticon-down-bold")},isForbiddenChar:function(e){for(var t=!1,i='"#$@%*,?\\<>[]|:/',n=0;n<i.length;n++){var o=i[n];if(-1!=e.indexOf(o)){t=!0;break}}return!0===t&&(i=i.split("").join(" ")),t},searchCA:function(){var e=document.querySelector("#CASearchDiv");"table-row"==e.getStyle("display")?e.setStyle("display","none"):e.setStyle("display","table-row")},filterSearch:function(e){var t;this.caListView.destroy(),t=this.collectionNew.filter(this.filterNameBased);var i=new UWA.Class.Collection(t);"Native"===window.enoviaServerFilterWidget.mode||"powerBy"===window.enoviaServerFilterWidget.mode?this.createNativeView(i,this.options):this.createView(i)},filterNameBased:function(e){var t=!1,i=e._attributes.subtitle,n=e._attributes.title,o=E.enteredText;if(o&&o.length){i&&(i=i.toLowerCase()),n&&(n=n.toLowerCase()),o=o.toLowerCase();var s=i.indexOf(o);s<0&&(s=n.indexOf(o)),t=s>=0}if(void 0!==o&&0!==o.length||(t=!0),1==t)return e}};return E}),define("DS/CfgAuthoringContextUX/scripts/CfgAuthContextChangeTileView",["UWA/Class/Model","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/CfgAuthoringContextUX/scripts/CfgCAAuthCtxTileView"],function(e,t,i,n,o,s){"use strict";return t.extend({idAttribute:"id",appDiv:null,editAllowed:null,authViewMode:null,setup:function(e){this.listenTo(this.model,"onChange",this.render),this.appDiv=e.appDiv,this.editAllowed=e.editAllowed,this.authViewMode=e.authViewMode},render:function(){var e=this,t=o.CFG_CA_HEADER,a=!1;if("change"==e.authViewMode&&(a=!0),this.container&&this.container.setContent(""),UWA.is(this.model.id)&&this.container){this.container.appendChild(UWA.createElement("div",{class:"caHeader",id:"caHeaderDiv1",html:t}));var r=new s({model:e.model,contextualActions:e.contextMenuAuth(),events:{onClickTitle:function(e){var t={eventName:"cfgAuthoringContext",operation:"openCA",operationVersion:"1.0",content:{id:this.model.id}};n.sendNotificationWebInWin(t)}}});r.container.setStyles({width:"255px",minWidth:"255px",right:"5px",overflow:"hidden",whiteSpace:"nowrap"}),r.render().inject(this.container),1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||this.container.appendChild(UWA.createElement("div",{id:"AuthCAtoggle",class:"caAuthDiv1",styles:{display:"flex",float:"right"},html:new i({type:"switch",id:"autoggle",checked:a,label:"",events:{onClick:function(){var t={eventName:"cfgAuthoringContext",operation:this.isChecked()?"activate_Authoring":"deActivate_Authoring",operationVersion:"1.0",content:{id:e.model.id}};n.sendNotificationWebInWin(t)}}})}));var l={eventName:"cfgAuthoringContext",operation:"SetAuthContextSuccess",operationVersion:"1.0",content:{id:this.model.id}};n.sendNotificationWebInWin(l)}return this.container},contextMenuAuth:function(){var e=[];return 1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||e.push({id:"delete",text:o.CFG_ToolTip_Remove,fonticon:"trash",handler:function(e){var t={eventName:"cfgAuthoringContext",operation:"removeCA",operationVersion:"1.0",content:{id:e.model.id}};n.sendNotificationWebInWin(t)}}),e}})}),define("DS/CfgAuthoringContextUX/scripts/CfgAuthContextChangeView",["UWA/Class/View","css!DS/UIKIT/UIKIT.css","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/WebappsUtils/WebappsUtils","DS/W3DXComponents/Views/Item/TileView","UWA/Class/Model","DS/CfgAuthoringContextUX/scripts/CfgAuthContextChangeTileView","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS"],function(e,t,i,n,o,s,a,r,l,d){"use strict";return e.extend({renderDiv:null,model:null,isLicenseValid:void 0,isLicenseCFGValid:void 0,isLicenseCHGValid:void 0,isLicenseIDSValid:void 0,caIcon:"/snresources/images/icons/large/I_ECM_CA108x144.png",init:function(e){this.options=e;var t=this;l.rolesAvailable(function(e){t.isLicenseCFGValid=e.isCFGRoleAvail,t.isLicenseCHGValid=e.isCHGRoleAvail,1==t.isLicenseCFGValid||1==t.isLicenseCHGValid?t.isLicenseValid=!0:t.isLicenseValid=!1}),this.work_under={CA_Auth_Name:"",Auth_Details:{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""}},Message_WARN:{isLicenseValid:!1,Message:d.WorkUnderDisabledCFGLicense},Message_SUCCESS:{validKey:"",isLicenseValid:!0}},this.model=new a},setContext:function(e,t){var i=e.ChangeAction.id,o=this;o.caOptions=e,o.renderDiv=o.options.parent,n.getCAdetailsForAuthoring(i).then(function(e){for(var t="",n="",s=e.changeaction.attributes,a=0;a<s.length;a++)"current"==s[a].name?s[a].value:"attribute_Severity"==s[a].name?t=s[a].value:"attribute_Synopsis"==s[a].name?n=s[a].value:"interface[Change On Hold]"==s[a].name&&s[a].value;if("allowed"==e.changeaction.editability.work_under){var r=n,c=e.changeaction.description,u=e.changeaction.name,g=e.changeaction.context,h=o.caOptions.authoringMode;t=t;o.model.set("id",i),o.model.set("image",enoviaServerFilterWidget.computeUrl(o.caIcon)),o.model.set("context",g),o.model.set("title",r),o.model.set("content",c),o.model.set("synopsis",u),o.model.set("severity",t),o.model.set("subtitle",u),o.work_under.CA_Auth_Name=o.model.get("title"),o.model.set("status",h),o.showCATileView()}else l.showwarning(d.CFG_DROP_CA_ACTION_STATE_CHECK,"error"),o.sendCAIncorrectStateNotificationToWIW()},function(e){return l.showwarning(d.getCAFailed,"error"),console.log("Get CA Deatils Failed"),Promise.reject(e)})},sendCAIncorrectStateNotificationToWIW:function(){let e={eventName:"cfgAuthoringContext",operation:"SetAuthContextFailure",operationVersion:"1.0",content:JSON.stringify({id:this.caOptions.ChangeAction.id,msg:d.CFG_CHANGE_ACTION_INCORRECT_STATE})};l.sendNotificationWebInWin(e)},showCATileView:function(){new r({model:this.model,appDiv:this.renderDiv,editAllowed:this.editAllowed,authViewMode:this.caOptions.authoringMode}).render().inject(this.options.parent)}})}),define("DS/CfgAuthoringContextUX/scripts/CfgWorkUnderView",["DS/Controls/TooltipModel","UWA/Class/Model","UWA/Class/View","DS/W3DXComponents/Views/Item/TileView","DS/UIKIT/Input/Button","DS/Controls/Button","DS/Controls/Editor","DS/UIKIT/Input/Toggle","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","DS/CfgAuthoringContextUX/scripts/CfgCAListDialog","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgAuthoringContextUX/scripts/CfgCAAuthCtxTileView","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgSessionDialog","DS/CfgAuthoringContextUX/scripts/CfgSessionAuthTileView","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/Controls/ResponsiveTileView","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/CfgBaseUX/scripts/CfgUXEnvVariables","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS"],function(e,t,i,n,o,s,a,r,l,d,c,u,g,h,C,v,p,m,f,A,D,w,y,S,b,E){"use strict";var _=i.extend({idAttribute:"id",appDiv:null,access:null,accessCFG:null,accessCHG:null,accessIDS:null,editAllowed:null,showEvolution:null,showChange:null,allowChangeConfguired:null,myAuthKey:null,cfgsessionVar:null,CfgDialogIns:null,authViewMode:null,setup:function(e){this.appDiv=e.appDiv,this.access=e.access,this.accessCFG=e.accessCFG,this.accessCHG=e.accessCHG,this.accessCSV=e.accessCSV,this.accessIDS=e.accessIDS,this.myAuthKey=e.myAuthKey,this.editAllowed=e.editAllowed,this.showEvolution=e.showEvolution,this.showChange=e.showChange,this.allowChangeConfguired=e.allowChangeConfguired,this.authViewMode=e.authViewMode,this.cfgUXEnvVariablesJS=S.getCfgUXEnvVariables(),window.addEventListener("onResize",function(){document.querySelector(".popover")&&document.querySelector(".popover").hide()})},render:async function(){var e=this;""!=e.model._attributes.id&&null!=e.model._attributes.id||(enoviaServerAuthoringWidget.saveMode=null);JSON.parse(b);var t=c.CFG_CA_HEADER,i=document.querySelector("#workUnderDiv"),n="-",o=[],s=[];if(t="change"===enoviaServerAuthoringWidget.saveMode?c.CFG_CA_HEADER:c.CFG_Session_Header,i&&i.setContent(""),"change"===enoviaServerAuthoringWidget.saveMode||"session"===enoviaServerAuthoringWidget.saveMode){if(i){var a;if(e.createHeader(t,i),"change"===enoviaServerAuthoringWidget.saveMode){if(o.push("evolution-effectivity"),s.push(c.CFG_ToolTip_Applicability),1!=e.editAllowed&&"undefined"!=e.editAllowed&&null!=e.editAllowed||(o.push("trash"),s.push(c.CFG_ToolTip_Remove)),"Low"===e.model._attributes.severity?(o.unshift("level-low"),s.unshift(c.CFGLabelLow)):"Medium"===e.model._attributes.severity?(o.unshift("level-medium"),s.unshift(c.CFGLabelMedium)):(o.unshift("level-high"),s.unshift(c.CFGLabelHigh)),""!=e.model._attributes.dueDate&&null!=e.model._attributes.dueDate&&null!=e.model._attributes.dueDate){n=new UWA.Date(e.model._attributes.dueDate).strftime("%Y-%m-%d")}"In Work"==e.model._attributes.maturityState&&c.CFG_CA_State_InWork;var r=c.CFG_ResponsiveTileTooltip_Title+" : "+e.model._attributes.title+"\n"+c.CFG_ResponsiveTileTooltip_Name+": "+e.model._attributes.subtitle+"\n"+c.CFG_ResponsiveTileTooltip_Owner+" : "+e.model._attributes.originator+"\n"+c.CFG_ResponsiveTileTooltip_Maturity+" : "+e.model._attributes.maturityState+"\n"+c.CFG_ResponsiveTileTooltip_DueDate+" : "+n;a=e.createTileView(e.model._attributes.image,e.model._attributes.image,r,e.model._attributes.title,e.model._attributes.subtitle+" | "+e.model._attributes.originator,e.model._attributes.maturityState+" | "+n,o,s),g.cleanDraggableEvent(i),g.makeDraggable(i,e.model),i.appendChild(a.getContent())}if("session"===enoviaServerAuthoringWidget.saveMode){1!=e.editAllowed&&"undefined"!=e.editAllowed&&null!=e.editAllowed||(o.push("pencil"),s.push(c.CFG_ACTION_EDIT),o.push("trash"),s.push(c.CFG_ToolTip_Remove));const t=e.model._attributes.evolExpression;let n,a,r="";try{r=e.getDescriptionFromXML(t)}catch(e){console.error("Convert XML to JSON failed.")}r&&(n=r.displayNames.join(", "),a=r.marketingNames.join(", "));const l=e.model._attributes.content;let d="";null==e.model._attributes.image&&(d=enoviaServerFilterWidget.computeUrl("/snresources/images/icons/large/I_PLCModel108x144.png"));const u=e.createTileView(e.model._attributes.image||d,e.model._attributes.image||d,l,n||e.model.get("title"),a||e.model.get("desc"),e.model._attributes.content,o,s,"session");g.cleanDraggableEvent(i),g.makeDraggable(i,e.model),i.appendChild(u.getContent())}0,1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||e.createToggle(i)}}else this.createInnerView(i)},createCAListdialog:function(){var e=new UWA.Class.Collection;u.create(workUnderDiv,e)},getInfoFromXml:function(e,t){let i="";return"HolderName"==t&&(i=e.substr(e.lastIndexOf(t))),"DisplayName"==t&&(i=e.substr(e.indexOf(t))),(i=i.split('"'))[1]},getDescriptionFromXML:function(e){const t=(new DOMParser).parseFromString(e,"text/xml"),i=[],n=[],o=t.getElementsByTagName("Description")[0].getElementsByTagName("Context"),s=t.getElementsByTagName("Expression")[0].getElementsByTagName("Context");let a=0,r=0;for(const e of s)a++,i.push(e.attributes.HolderName.value);for(const e of o)++r<=a&&n.push(e.attributes.DisplayName.value);return{displayNames:n,marketingNames:i}},createToggle:function(t){const i=this,n=new l({type:"switch",domId:"autoggle",checkFlag:enoviaServerAuthoringWidget.status});n.addEventListener("buttonclick",function(){i.toggleEvent(n)}),n.tooltipInfos=new e({shortHelp:c.WorkUnder_Toggle_Tooltips,mouseRelativePosition:!0}),t.appendChild(UWA.createElement("div",{id:"toggle",html:n}))},toggleEvent:function(e){e.checkFlag?(enoviaServerAuthoringWidget.status=!0,"change"===enoviaServerAuthoringWidget.saveMode?C.publish("toggleActiveCA"+this.myAuthKey):C.publish("toggleActiveSE"+this.myAuthKey)):(enoviaServerAuthoringWidget.status=!1,"change"===enoviaServerAuthoringWidget.saveMode?C.publish("toggleDeActiveCA"+this.myAuthKey):C.publish("toggleDeActiveSE"+this.myAuthKey))},createButton:function(e,t,i,n){const o=this;if(o.editAllowed){const a=new s({label:e,domId:n});a.getContent().addEventListener("buttonclick",function(){"change"==t?o.buttonCAEvent():"session"==t&&o.buttonSessionEvent()}),a.inject(i)}},buttonEvent:function(){document.querySelector(".popover")&&document.querySelector(".popover").hide()},buttonCAEvent:function(){(this.accessCHG||this.accessCSV||this.accessIDS)&&(this.buttonEvent(),"undefined"==typeof dscef?this.launchSearchForCA():this.createCAListdialog())},launchSearchForCA:function(){let e=this.initialiseSearchForCA();this.activateSearchForCA(e)},initialiseSearchForCA:function(){let e=E.CfgLabelSelectChangeAction;return new y(!1,e)},activateSearchForCA:function(e){let t=enoviaServerFilterWidget.myRole,i=C.getUser().login,n=`[ds6w:status]:"Change Action.In Work" AND [ds6w:onHold]:"FALSE" AND ( owner:${i} OR [ECM_CA_ASSIGNEE]:${i} )`;e.activate(E.CfgLabelSelectChangeAction,"Change Action",t,e=>{e.length>0&&this.searchCallback(e)},"",[],n)},searchCallback:function(e){require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(t){const i=g.getWorkUnderEmptyObject();i.change.id=e[0]._attributes.id,i.change.image=e[0]._attributes.preview_url,i.change.name=e[0]._attributes["ds6w:label"],t.publish(t.myAuthkey,i)})},buttonSessionEvent:async function(){try{await this.getPAndOAccessInfo(),(this.accessCFG||this.accessIDS)&&this.createSessiondialog(this.appDiv,this.myAuthKey)}catch(e){e.includes("Insufficient access rights")&&A.showwarning(E.CfgMessageAccessRightsError,"error")}},buttonApplicabilityEvent:function(){this.render()},createTileView:function(e,t,i,n,o,s,a,r,l){const d=this,c=new w({picture:e,icon:t,customTooltip:i,title:n,multipleTitleLineNumber:!1,subtitle:o,description:s,statusbarIcons:a,statusbarIconsTooltips:r,contextualMenu:[],onStatusbarIconPointerDown:function(e){if(e.options&&e.options.iconIndex>=0&&e.options.iconIndex<c.statusbarIcons.length){const t=[],i=[];for(let e=0;e<c.statusbarIcons.length;e++)t.push(c.statusbarIcons[e]),i.push(c.statusbarIconsTooltips[e]);"trash"===t[e.options.iconIndex]&&("session"===l?d.trashEventHandler(!0):d.trashEventHandler()),"pencil"===t[e.options.iconIndex]&&d.pencilEventHandler(),"evolution-effectivity"===t[e.options.iconIndex]&&d.showApplicabilityDialog(d.model.get("applicability")),c.setProperties({statusbarIcons:t,statusbarIconsTooltips:i})}}});return c},trashEventHandler:function(e=!1){this.cleanAuthDetails(e)},pencilEventHandler:function(){const e=this;require(["DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController"],function(t,i,n,o,s,a,r){_.OKhandlar=async function(){r.init(),enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",await a.populate3DSpaceURL(),await a.populateSecurityContext();var t=n.getGlobalSessiondata();if(""!=t["Evolution Expression"]){const i=function(i){const o={ACId:i.ACId,evolutionExpression:t["Evolution Expression"],dictionaryContext:t["Dictionary Contexts"][0],displayExpression:i.XSLTExpr,fromEdit:!0,collection:n.collection._models};C.publish("sessionEff",Object.assign(o,{PACID:e.myAuthKey})),_.CfgDialogIns.closeDialog()};try{i(await s.getAuthoringIDforEvolution(t))}catch(e){console.log(e),e&&"1"===e.errorID?a.showwarning(c.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):a.showwarning(c.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")}}else{(function(){C.publish("removeAuthCtxSessionEvent"+e.myAuthKey),_.CfgDialogIns.closeDialog()})(await s.deleteAuthroingContext())}},_.CANhandlar=function(){_.CfgDialogIns.closeDialog(),0==b.isWUXDialogEnabled&&(workUnderDiv.style.pointerEvents="auto")};var l=e.model._attributes.evolExpression,d=e.model._attributes.dictionaryContext,u={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",parent:null,parentElement:null,objectid:null,mode:"SessionEffectivity",iXml:l,modelList:d,Access:{SetSessionEffectvity:"true"},width:800,height:500,minHeight:310,minWidth:310,dialogue:{header:c.CFG_Edit_Session_Header,buttonArray:null,target:widget.body,object:null,postCloseHandler:function(){workUnderDiv.style.pointerEvents="auto"}}},g={isHeader:!1,isFooter:!0,firstButtonText:c.CFG_SE_ACTION_OK,secondButtonText:c.CFG_SE_ACTION_Cancel,headerText:c.CFG_Edit_Session_Header,onButtonClickCB:function(e){"firstButton"==e.buttonId?_.OKhandlar():_.CANhandlar()}};u.dialogue.modelViewContainer=new i(g).render(),u.mode="EditEvolution",_.CfgDialogIns=new t(u),u.mode="SessionEffectivity",u.dialogue.modelViewContainer.inject(_.CfgDialogIns.container),u.parent=_.CfgDialogIns.container,u.parentElement=_.CfgDialogIns.container,u.dialogue.object=_.CfgDialogIns,_.CfgDialogIns.render(),n.create(u),0==b.isWUXDialogEnabled&&(null!=document.getElementsByClassName("CfgEditEvolutionDialog")[0]&&(workUnderDiv.style.pointerEvents="none"),document.getElementsByClassName("CfgEditEvolutionDialog")[0].setAttribute("style",document.getElementsByClassName("CfgEditEvolutionDialog")[0].getAttribute("style")+"min-height:310px !important;min-width:310px !important;"))})},createHeader:function(e,t){t.appendChild(UWA.createElement("div",{class:"caHeader",id:"caHeaderDiv1",html:e}))},createSessiondialog:function(e,t){v.create(workUnderDiv,t)},contextMenuAuthSession:function(){var e=this,t=[];return 1!=this.editAllowed&&"undefined"!=this.editAllowed&&null!=this.editAllowed||t.push({id:"delete",text:c.CFG_ToolTip_Remove,fonticon:"trash",handler:function(t){e.cleanAuthDetails(!0)}},{id:"Edit",text:c.CFG_ACTION_EDIT,fonticon:"pencil",handler:function(t){require(["DS/CfgBaseUX/scripts/CfgDialog","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController"],function(t,i,n,o,s,a,r){_.OKhandlar=function(){var t=n.getGlobalSessiondata();""!=t["Evolution Expression"]?(r.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",a.populate3DSpaceURL().then(function(i){a.populateSecurityContext().then(function(i){s.getAuthoringIDforEvolution(t).then(function(t){var i=t.ACId,n=t.XSLTExpr,s=o.get();s.evolution.id=i,s.evolution.displayExpression=n,C.publish("sessionEff",Object.assign(s,{PACID:e.myAuthKey})),_.CfgDialogIns.closeDialog()},function(e){console.log("Not a change action"),console.log(e),e&&"1"===e.errorID?a.showwarning(c.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):a.showwarning(c.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")})},function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)})},function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)})):(r.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",a.populate3DSpaceURL().then(function(t){a.populateSecurityContext().then(function(t){s.deleteAuthroingContext().then(function(){C.publish("removeAuthCtxSessionEvent"+e.myAuthKey),_.CfgDialogIns.closeDialog()},function(e){return console.log("Not a change action"),Promise.reject(e)})},function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)})},function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)}))},_.CANhandlar=function(){_.CfgDialogIns.closeDialog(),0==b.isWUXDialogEnabled&&(workUnderDiv.style.pointerEvents="auto")};o.get({fromEdit:!0});var l=o.work_under.iXML,d=o.work_under.dictionaryList,u={tenant:enoviaServerFilterWidget.tenant,environment:"Dashboard",parent:null,parentElement:null,objectid:null,mode:"SessionEffectivity",iXml:l,modelList:d,Access:{SetSessionEffectvity:"true"},width:800,height:500,minHeight:310,minWidth:310,dialogue:{header:c.CFG_Edit_Session_Header,buttonArray:null,target:widget.body,object:null,postCloseHandler:function(){workUnderDiv.style.pointerEvents="auto"}}},g={isHeader:!1,isFooter:!0,firstButtonText:c.CFG_SE_ACTION_OK,secondButtonText:c.CFG_SE_ACTION_Cancel,headerText:c.CFG_Edit_Session_Header,onButtonClickCB:function(e){"firstButton"==e.buttonId?_.OKhandlar():_.CANhandlar()}};u.dialogue.modelViewContainer=new i(g).render(),u.mode="EditEvolution",_.CfgDialogIns=new t(u),u.mode="SessionEffectivity",u.dialogue.modelViewContainer.inject(_.CfgDialogIns.container),u.parent=_.CfgDialogIns.container,u.parentElement=_.CfgDialogIns.container,u.dialogue.object=_.CfgDialogIns,_.CfgDialogIns.render(),n.create(u),0==b.isWUXDialogEnabled&&(null!=document.getElementsByClassName("CfgEditEvolutionDialog")[0]&&(workUnderDiv.style.pointerEvents="none"),document.getElementsByClassName("CfgEditEvolutionDialog")[0].setAttribute("style",document.getElementsByClassName("CfgEditEvolutionDialog")[0].getAttribute("style")+"min-height:310px !important;min-width:310px !important;"))})}}),t},cleanAuthDetails:function(e){var t=document.querySelector("#workUnderDiv");g.cleanDraggableEvent(t);JSON.parse(b);this.model._attributes.id="",enoviaServerAuthoringWidget.saveMode=null,enoviaServerAuthoringWidget.status=!0,this.createInnerView(t);enoviaServerAuthoringWidget.tenant;e?C.publish("removeAuthCtxSessionEvent"+this.myAuthKey):C.publish("removeAuthCtxEvent"+this.myAuthKey)},showApplicabilityDialog:async function(e){var t=this,i=document.querySelector("#workUnderDiv");i.innerHTML="";var n=UWA.createElement("div",{id:"applicabilityHeader"}),o=document.createElement("a");o.setAttribute("class","back_button");var s=document.createElement("i");s.setAttribute("class","wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-back "),o.appendChild(s),n.appendChild(o),t.createHeader(c.CFG_ToolTip_Applicability,n),i.appendChild(n);var r="";r=""==e||null==e||null==e?c.CFG_No_Applicability:await A.getDisplayExpressionUsingXSLT(e);var l=new a({value:r,domId:"applicability_editor"});i.appendChild(UWA.createElement("div",{id:"applicability",html:l})),document.getElementById("applicability_editor").children[0].disabled=!0,o.addEventListener("click",function(e){e.stopPropagation(),t.buttonApplicabilityEvent()})},createInnerView:function(e){const t=this;JSON.parse(b);var i=UWA.createElement("div",{id:"cabodyDiv1"}),n=UWA.createElement("div",{id:"changeActionDiv"}),o=UWA.createElement("div",{id:"evolActionDiv"}),s=UWA.createElement("div",{id:"cabodyDiv3",html:"-----------"+c.CFG_Seperator+"----------"});enoviaServerAuthoringWidget.tenant;!(this.options.accessCHG||this.options.accessIDS||this.options.accessCSV)||1!=this.showChange&&"undefined"!=this.showChange&&null!=this.showChange||(t.createButton(c.CFG_CA_HEADER,"change",n,"caAction1"),i.appendChild(n)),1!=this.showEvolution&&"undefined"!=this.showEvolution&&null!=this.showEvolution||1!=this.showChange&&"undefined"!=this.showChange&&null!=this.showChange||this.options.accessCFG&&(this.options.accessCHG||this.options.accessCSV)&&i.appendChild(s),!this.options.accessCFG&&!this.options.accessIDS||1!=this.showEvolution&&"undefined"!=this.showEvolution&&null!=this.showEvolution||(t.createButton(c.CFG_Evolution_HEADER,"session",o,"caSessionBtn1"),i.appendChild(o)),null!=e&&(e.empty(!0),t.editAllowed?e.appendChild(i):e.appendChild(UWA.createElement("div",{class:"authoring-context-readonly-container",html:c.CFG_WORK_UNDER_READ_ONLY_EMPTY})))},getPAndOAccessInfo:async function(){enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",await A.populate3DSpaceURL(),await A.populateSecurityContext();let e=await A.getPAndOAccess(["WorkUnderEvolution","WorkUnderEvolutionConfiguredAdd","WorkUnderEvolutionConfiguredDelete","WorkUnderEvolutionConfiguredMove","WorkUnderEvolutionConfiguredReplace","WorkUnderEvolutionConfiguredCutOrPaste","WorkUnderEvolutionConfiguredCopyOrPaste"]);if(e&&"Granted"!==e.WorkUnderEvolution)throw"Insufficient access rights"}});return _}),define("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog","UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Tooltip","DS/DataDragAndDrop/DataDragAndDrop","DS/UIKIT/Alert","css!DS/UIKIT/UIKIT.css","i18n!DS/CfgAuthoringContextUX/assets/nls/CfgAuthoringContextNLS","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","css!DS/CfgAuthoringContextUX/CfgAuthoringContextUX","DS/CfgAuthoringContextUX/scripts/CfgAuthoringUtility","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Popover","DS/UIKIT/Input/Button","UWA/Class/Model","DS/CfgAuthoringContextUX/scripts/CfgWorkUnderView","DS/CfgAuthoringContextUX/scripts/CfgCAListDialog","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","DS/CfgBaseUX/scripts/CfgController","DS/CfgBaseUX/scripts/CfgUtility","DS/Controls/Toggle","DS/CfgAuthoringContextUX/scripts/CfgSessionDialog","UWA/Controls/Drag","DS/CfgBaseUX/scripts/CfgDialog"],function(e,t,i,n,o,s,a,r,l,d,c,u,g,h,C,v,p,m,f,A,D,w,y,S,b,E){"use strict";return i.singleton(n,{renderDiv:null,authoringTooltip:null,model:null,authoringContextType:null,isLicenseValid:void 0,isLicenseCFGValid:void 0,isLicenseCHGValid:void 0,isLicenseIDSValid:void 0,isWorkUnderWarningToShow:!0,myAuthkey:null,isTenantChanged:!1,fromRefresh:!1,authViewModeCtx:void 0,caIcon:"/snresources/images/icons/large/I_ECM_CA108x144.png",modelIcon:"/snresources/images/icons/large/I_PLCModel108x144.png",isOriginalXUse:!1,isOriginalYUse:!1,workUnderPopup:null,immersiveFramePopOver:null,workUnderDiv:null,originalX:null,originalY:null,lastX:null,lastY:null,isVisible:!0,cfgUXEnvVariables:JSON.parse(A),init:function(){var e=this;w.rolesAvailable(function(t){e.isLicenseCFGValid=t.isCFGRoleAvail,e.isLicenseCHGValid=t.isCHGRoleAvail,e.isLicenseCSVValid=t.isCSVRoleAvail,1==e.isLicenseCFGValid||1==e.isLicenseCHGValid||1==e.isLicenseCSVValid?e.isLicenseValid=!0:e.isLicenseValid=!1}),this.work_under={CA_Auth_Name:"",iXML:"",dictionaryList:"",Auth_Details:{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""},evolution:{id:"",displayExpression:""},configurationRevision:null},Message_WARN:{isLicenseValid:!1,Message:d.WorkUnderDisabledCFGLicense},Message_SUCCESS:{validKey:"",isLicenseValid:!0}},this.model=new p},initialize:function(e,t,i,n,s){this.renderDiv=e;var a="",r=o.getApplicationConfiguration("app.urls.myapps"),l=window.UWA.Data.proxies.passport?"passport":"ajax";a=a.substring(0,a.indexOf("/webapps"));r||(r=a);var d,c=(new Date).getTimezoneOffset();null==t||""==t?d=(new Date).getTime()+"/AuthKey":d=t+"/AuthKey";this.myAuthkey=d;window.enoviaServerAuthoringWidget={sRealURL:a,serviceName:"3DSpace",baseURL:"",InterCom:UWA.Utils.InterCom,compassSocket:null,prefIntercomServer:null,compassSocketName:"",prefSocketName:"",storageUrl:r,timezone:c,wsCallTimeout:3e4,mySecurityContext:"",proxy:l,myRole:"",contextUser:"",isNative:!1,fromIDCard:!1,referentialsSearchType:"",contextSearchType:"",proposedSearchType:"",datamodel:"new",project_space:"",mode:"Dashboard",saveMode:"",odtEditMode:!1,status:!0,get3DSpaceURL:function(){return this.baseURL},computeUrl:function(e){return this.get3DSpaceURL()+e},getSecurityContext:function(){return this.mySecurityContext},getRole:function(){return this.myRole},collabspace:"",tenant:widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):"OnPremise",tenantnls:""},D.init(null,"","3DDashboard"),this.displayBubble=i,null!=s?(this.editAllowed=null==s.isEditable||s.isEditable,this.showEvolution=null==s.isEvolution||s.isEvolution,this.showChange=null==s.isChange||s.isChange,this.allowChangeConfguired=null==s.isChangeConfguired||s.isChangeConfguired,this.isMovable=null!=s.isMovable&&s.isMovable,this.resetDefault=null!=s.resetDefault&&s.resetDefault):(this.editAllowed=!0,this.showEvolution=!0,this.showChange=!0,this.allowChangeConfguired=!0,this.isMovable=!1,this.resetDefault=!1),this.bubblePosition="position-",this.bubblePosition+=null==n||""==n?"bottom-right":n;var u=this;this.injectAuthoringContext(e);const g=this.renderDiv.querySelector("#BubbleContainer");widget.addEvent("onResize",function(){if(null!=g&&null!=u.workUnderPopup&&(u.closePopoverDialog(),u.createPopOverDialog()),u.isMovable&&u.resetDefault&&null!=g){var e=g.getBoundingClientRect(),t=g.parentElement.getBoundingClientRect();if(""!=g.style.top||""!=g.style.bottom||""!=g.style.right||""!=g.style.left){u.isOriginalXUse&&(this.originalX=null),u.isOriginalYUse&&(this.originalY=null),(e.x-t.x>t.width&&null==this.originalX||e.y>t.height&&null==this.originalY)&&(this.originalX=e.x-t.x,this.originalY=e.y,u.isOriginalXUse=!1,u.isOriginalYUse=!1);var i=u.setPositionOnResize(this.originalX,this.originalY);null==i.x&&null==i.y&&(u.isOriginalXUse=!0,u.isOriginalYUse=!0),null!=i.lastX&&i.lastX>0&&(u.lastX=i.lastX),null!=i.lastY&&i.lastY>0&&(u.lastY=i.lastY)}}}),this.isMovable&&(this.dragControl=new b.Move({container:this.renderDiv,delegate:"#BubbleContainer > *",centerHandles:!0,handles:function(e){return u.closePopoverDialog(!1),e.target.getClosest("#BubbleContainer")}})),this.createToolTip(),this.createDialogContainer(!0),this.initBubbleClickHandler(),this.makeDroppable(g,d),"hide"==u.displayBubble&&(g.style.visibility="hidden"),o.subscribe(d,function(e){u.update(e),u.closePopoverDialog(!1)}),o.subscribe("removeAuthCtxEvent"+this.myAuthkey,function(){u.cleanAuthDetails(),u.editAllowed?u.closePopoverDialog(!0):u.closePopoverDialog(!1)}),o.subscribe("removeCAFromAuthCtxEvent",function(e){null!=e&&u.work_under.Auth_Details.change.id==e.ChangeAction.id&&u.cleanAuthDetails()}),o.subscribe("toggleDeActiveCA"+this.myAuthkey,function(){u.authoringContextType="disable",u.deactivateBubble()}),o.subscribe("toggleActiveCA"+this.myAuthkey,function(){u.authoringContextType="change",u.activateBubble()}),o.subscribe("sessionEff",async function(e){Object.prototype.hasOwnProperty.call(e,"PACID")&&u.myAuthkey==e.PACID?await u.setEffectivity(Object.assign(e,{authoringSettingBy:"Authoring"})):"session"!==u.authoringContextType&&"sessionDisable"!==u.authoringContextType||await u.setEffectivity(Object.assign(e,{authoringSettingBy:"Subscribe"})),u.closePopoverDialog(!1),u.createPopOverDialog(!0),u.closePopoverDialog(!1)}),o.subscribe("removeAuthCtxSessionEvent"+this.myAuthkey,function(){u.cleanAuthDetails(),u.closePopoverDialog(!1),u.editAllowed&&(u.createPopOverDialog(!0),null==u.workUnderPopup&&u.closePopoverDialog(!1))}),o.subscribe("toggleDeActiveSE"+this.myAuthkey,function(){u.authoringContextType="sessionDisable",u.deactivateBubble()}),o.subscribe("toggleActiveSE"+this.myAuthkey,function(){u.authoringContextType="session",u.activateBubble()});var h="";return widget&&(h=widget.id),o.subscribe("NGFilter.SetConfigurationRevision_"+h,function(e){u.setConfigurationRevisionDetails(e),console.log(e)}),o.subscribe("NGFilter.RemoveConfigurationRevision_"+h,function(e){u.clearConfigurationRevisionDetails(),console.log(e)}),widget.addEvent("onRefresh",function(){if(enoviaServerFilterWidget.tenant==widget.getValue("x3dPlatformId")?u.isTenantChanged=!1:u.isTenantChanged=!0,u.fromRefresh=!0,u.isVisible)if(enoviaServerFilterWidget.saveMode,u.closePopoverDialog(),"change"==enoviaServerAuthoringWidget.saveMode){const e=u.getChangeFromAuthoring();e.fromEdit=!0,u.update(e)}else"session"==enoviaServerAuthoringWidget.saveMode&&u.updateSessionEff(u.getEvolutionFromAuthoringContext({fromEdit:!0}));u.originalX=null,u.originalY=null,u.isOriginalXUse=!1,u.isOriginalYUse=!1,u.lastX=null,u.lastY=null,u.fromRefresh=!1}),d},initialize2:function(e,t,i,n,o,s){this.renderDiv=e;var a=this;if(a.isLicenseValid){var r=a.initialize(e,t,i,n,s);return a.work_under.Message_SUCCESS.validKey=r,a.work_under.Message_SUCCESS.isAuthoringContextVisible=a.isLicenseCHGValid||a.isLicenseCFGValid,void o(a.work_under.Message_SUCCESS)}if(!1===a.isLicenseValid)o(a.work_under.Message_WARN);else{w.rolesAvailable(function(r){if(a.isLicenseCFGValid=r.isCFGRoleAvail,a.isLicenseCHGValid=r.isCHGRoleAvail,a.isLicenseCSVValid=r.isCSVRoleAvail,1==a.isLicenseCFGValid||1==a.isLicenseCHGValid||1==a.isLicenseCSVValid){a.isLicenseValid=!0;var l=a.initialize(e,t,i,n,s);return a.work_under.Message_SUCCESS.validKey=l,a.work_under.Message_SUCCESS.isAuthoringContextVisible=a.isLicenseCHGValid||a.isLicenseCFGValid,void o(a.work_under.Message_SUCCESS)}a.isLicenseValid=!1,o(a.work_under.Message_WARN)})}},createToolTip:function(){this.authoringTooltip=new s({className:"authoringtooltip",id:"authtoolTipId",position:"bottom",target:this.renderDiv.querySelector("#BubbleContainer"),body:" "+d.CFG_NO_WORK_UNDER,trigger:"touch"})},closePopoverDialog:function(e){null!=this.workUnderPopup&&(this.workUnderPopup.destroy(),this.workUnderPopup=null,1==e&&(enoviaServerAuthoringWidget.saveMode=null,this.createPopOverDialog(!0)))},initBubbleClickHandler:function(){const t=this,i=this.renderDiv.querySelector("#BubbleContainer");t.immersiveFramePopOver=new e,t.immersiveFramePopOver.addEventListener("removeWindow",function(){i.parentElement.removeChild(i.parentElement.lastChild)}),i.addEventListener("click",function(){null==t.workUnderPopup?t.editAllowed?t.createPopOverDialog():null!=t.authoringContextType&&t.createPopOverDialog():t.closePopoverDialog(!1)}),t.immersiveFramePopOver.addEventListener("click",function(e){null!=t.workUnderPopup&&(e.target!=t.renderDiv.querySelector(".wux-windows-modalDialog")&&e.target!=t.renderDiv.querySelector(".wux-windows-immersive-frame-freeZone")&&e.target!=t.renderDiv.querySelector("#BubbleContainer")||t.closePopoverDialog(!1))})},createPopOverDialog:function(e=!1){const i=this,n=i.renderDiv.querySelector("#BubbleContainer");i.immersiveFramePopOver.inject(i.renderDiv);const o=n.getBoundingClientRect(),s=n.parentElement.getBoundingClientRect();let a=90,r=-140;e||"change"!==enoviaServerAuthoringWidget.saveMode&&"session"!==enoviaServerAuthoringWidget.saveMode||(r-=70,a+=70);let l=r;s.x+s.width-o.x<300&&(l=a);var c=o.x-(s.x+l);window.navigator.userAgent.search("Firefox")>-1&&"session"==enoviaServerAuthoringWidget.saveMode&&(o.y-=55,c-=100),i.workUnderPopup=new t({domId:"work-under-z-index",title:d.CFG_WorkUnder_HEADER,content:i.workUnderDiv,resizableFlag:!1,immersiveFrame:i.immersiveFramePopOver,position:{at:"top left",offsetX:c,offsetY:o.y+20},modalFlag:!1,movableFlag:!1});const u=enoviaServerFilterWidget.saveMode;"change"===u?i.authViewModeCtx="change":"session"===u&&(i.authViewModeCtx="session"),new m({model:i.model,appDiv:i.renderDiv,access:i.isLicenseValid,accessCFG:i.isLicenseCFGValid,accessCHG:i.isLicenseCHGValid,accessIDS:i.isLicenseIDSValid,accessCSV:i.isLicenseCSVValid,editAllowed:i.editAllowed,showEvolution:i.showEvolution,showChange:i.showChange,allowChangeConfguired:i.allowChangeConfguired,myAuthKey:i.myAuthkey,authViewMode:i.authViewModeCtx}).render(),i.workUnderPopup.addEventListener("close",function(e){i.workUnderPopup=null})},createDialogContainer:function(e){var t="cfgAuthContextPopOverClass";e&&(t+=" newPopOver"),this.workUnderDiv=new UWA.createElement("div",{id:"workUnderDiv",class:t,html:""})},createPopOver:function(e){var t=this;this.popOver=new C({className:"authoringpopover",target:this.renderDiv.querySelector("#BubbleContainer"),position:"left",body:t.workUnderDiv,title:d.CFG_WorkUnder_HEADER,trigger:"touch",events:{onShow:function(){document.querySelector(".popover")&&document.querySelector(".popover").show(),document.querySelector("#workUnderDiv").style.pointerEvents="auto";var e=t.get().AuthoringContextHeader;null!=e&&(null!=e["DS-Change-Authoring-Context"]&&(t.authViewModeCtx="change"),null!=e["DS-Configuration-Authoring-Context"]&&(t.authViewModeCtx="session"));new m({model:t.model,appDiv:t.renderDiv,access:t.isLicenseValid,accessCFG:t.isLicenseCFGValid,accessCHG:t.isLicenseCHGValid,accessIDS:t.isLicenseIDSValid,accessCSV:t.isLicenseCSVValid,editAllowed:t.editAllowed,showEvolution:t.showEvolution,showChange:t.showChange,allowChangeConfguired:t.allowChangeConfguired,myAuthKey:t.myAuthkey,authViewMode:t.authViewModeCtx}).render()}}})},injectAuthoringContext:function(e){var t=this,i=new UWA.createElement("div",{class:this.bubblePosition,styles:{"user-select":"none"},events:{click:function(e){},mouseover:function(){{let e;switch(t.authoringContextType){case"change":case"disable":e=t.model.get("title");break;case"session":case"sessionDisable":e=t.model.get("content");break;case null:default:e=d.CFG_NO_WORK_UNDER}t.authoringTooltip.setBody(e)}}}});i.setAttributes({id:"BubbleContainer"});var n=UWA.createElement("img",{src:h.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxEmpty.png"),events:{}});n.setAttributes({id:"iconAuthImg"}),n.inject(i),this.renderDiv.appendChild(i)},makeDroppable:function(e,t){var i=this;a.droppable(e,{drop:function(e){if(UWA.is(e)&&""!=e){const t=JSON.parse(e);if(Object.prototype.hasOwnProperty.call(t,"data"))if("Authoring Context"===t.data.items[0].objectType)if((1==i.showEvolution||null==i.showEvolution)&&g.isConfigurationLicencesValid(i.isLicenseCFGValid,i.isLicenseIDSValid)&&i.editAllowed){i.cleanAuthDetails();const e={ACId:t.data.items[0].objectId,evolutionExpression:t.data.items[0].objectData.evolutionExpression,dictionaryContext:t.data.items[0].objectData.dictionaryContext,displayExpression:t.data.items[0].objectData.displayExpression,collection:[],authoringSettingBy:"Drop"};o.publish("sessionEff",Object.assign(e,{PACID:i.myAuthkey})),i.closePopoverDialog(!1),g.showMessage({element:i.renderDiv,type:"primary",message:d.CFG_AUTH_CTX_DROP_SUCCESS})}else g.showMessage({element:i.renderDiv,type:"error",message:d.CFG_WORK_UNDER_WITH_EVOLUTION_CANNOT_USE});else if((1==i.showChange||null==i.showChange)&&g.isChangeLicencesValid(i.isLicenseCHGValid,i.isLicenseCSVValid,i.isLicenseIDSValid)&&i.editAllowed){i.cleanAuthDetails();const e=g.getWorkUnderEmptyObject();e.change.id=t.data.items[0].objectId,e.change.name=t.data.items[0].displayName,i.publish(i.myAuthkey,Object.assign(e,{authoringSettingBy:"Drop"})),i.closePopoverDialog(!1),g.showMessage({element:i.renderDiv,type:"primary",message:d.CFG_AUTH_CTX_DROP_SUCCESS})}else g.showMessage({element:i.renderDiv,type:"error",message:d.CFG_WORK_UNDER_WITH_CA_CANNOT_USE});else g.showMessage({element:i.renderDiv,type:"error",message:d.CFG_AUTH_CTX_DROP_FAILURE})}else g.showMessage({element:i.renderDiv,type:"error",message:d.CFG_AUTH_CTX_DROP_FAILURE})},enter:function(){arguments[1].preventDefault(),arguments[1].stopPropagation()},over:function(){arguments[1].preventDefault(),arguments[1].stopPropagation()},leave:function(){arguments[1].preventDefault(),arguments[1].stopPropagation()}})},get2:function(e){var t=this;if(t.isLicenseValid){var i=t.get();e(i)}else if(0==t.isLicenseValid)e(t.work_under.Message_WARN);else{w.rolesAvailable(function(i){if(t.isLicenseCFGValid=i.isCFGRoleAvail,t.isLicenseCHGValid=i.isCHGRoleAvail,1!=t.isLicenseCFGValid&&1!=t.isLicenseCHGValid&&1!=t.isLicenseCSVValid)t.isLicenseValid,e(t.work_under.Message_WARN);else{t.isLicenseValid=!0;var n=t.get();e(n)}})}},get:function(e){return null!=this.authoringContextType&&enoviaServerAuthoringWidget.status?("change"===enoviaServerAuthoringWidget.saveMode?this.getChangeFromAuthoring(e):this.getEvolutionFromAuthoringContext(e),this.getComplementaryInformation()):this.getWorkUnderAuthDetailsEmtpy(),null!=this.model.get("configurationRevision")?this.work_under.Auth_Details.configurationRevision=this.model.get("configurationRevision"):this.work_under.Auth_Details.configurationRevision=null,this.work_under.Auth_Details},getWorkUnderAuthDetailsEmtpy:function(){this.work_under.Auth_Details.version="1.0",this.work_under.Auth_Details.change.id="",this.work_under.Auth_Details.change.name="",this.work_under.Auth_Details.change.context=[],this.work_under.Auth_Details.change.title="",this.work_under.Auth_Details.change.description="",this.work_under.Auth_Details.change.severity="",this.work_under.Auth_Details.evolution.id="",this.work_under.Auth_Details.evolution.displayExpression="",this.work_under.Auth_Details.evolution.expression="",this.work_under.CA_Auth_Name="",this.work_under.Auth_Details.AuthoringContextHeader=null,"disable"!=this.authoringContextType&&"sessionDisable"!=this.authoringContextType||("change"===enoviaServerAuthoringWidget.saveMode?this.work_under.CA_Auth_Name=this.model.get("title"):"session"===enoviaServerAuthoringWidget.saveMode&&(this.work_under.CA_Auth_Name=this.model.get("content")))},getChangeFromAuthoring:function(e){const t=this;t.work_under.Auth_Details.change.id=t.model.get("id");var i=null;""!=t.model.get("id")&&(i={"DS-Change-Authoring-Context":"pid:"+t.model.get("id")}),t.work_under.Auth_Details.AuthoringContextHeader=i,t.work_under.Auth_Details.change.description=t.model.get("content"),t.work_under.CA_Auth_Name=t.model.get("title"),t.getComplementaryInformation();try{null!=typeof e&&void 0!==e||g.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Change",settingBy:1==t.fromRefresh?"Refresh":"Authoring",usage:"Get",change:{applicability:""==t.model._attributes.applicability?"FALSE":"TRUE"},evolution:{xml:!1,noModel:0}}})}catch(e){console.error(e)}return t.work_under.Auth_Details},getEvolutionFromAuthoringContext:function(e){const t=this;t.work_under.Auth_Details.evolution.id=t.model.get("id"),t.work_under.Auth_Details.evolution.displayExpression=t.model.get("content"),t.work_under.iXML=t.model.get("evolExpression"),t.work_under.Auth_Details.evolution.expression=t.model.get("evolExpression"),t.work_under.dictionaryList=t.model.get("dictionaryContext");var i=null;""!=t.model.get("id")&&(i={"DS-Configuration-Authoring-Context":"pid:"+t.model.get("id")}),t.work_under.Auth_Details.AuthoringContextHeader=i,t.work_under.CA_Auth_Name=t.model.get("content"),t.getComplementaryInformation();try{null==typeof e||void 0===e?g.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Evolution",settingBy:1==t.fromRefresh?"Refresh":"Authoring",usage:"Get",change:{applicability:"FALSE"},evolution:{xml:t.model.get("evolExpression"),noModel:t.model.get("dictionaryContext").length||1}}}):Object.prototype.hasOwnProperty.call(e,"fromEdit")||g.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Evolution",settingBy:1==t.fromRefresh?"Refresh":"Authoring",usage:"Get",change:{applicability:"FALSE"},evolution:{xml:t.model.get("evolExpression"),noModel:t.model.get("dictionaryContext").length||1}}})}catch(e){console.error(e)}return t.work_under.Auth_Details},getComplementaryInformation:function(){return this.work_under.Auth_Details.version="1.0",this.work_under.Auth_Details.change.name=this.model.get("synopsis"),this.work_under.Auth_Details.change.context=this.model.get("context"),this.work_under.Auth_Details.change.title=this.model.get("title"),this.work_under.Auth_Details.change.severity=this.model.get("severity"),this.work_under.Auth_Details},set2:function(e,t){(Object.prototype.hasOwnProperty.call(e,"change")||Object.prototype.hasOwnProperty.call(e,"evolution"))&&(Object.prototype.hasOwnProperty.call(e.change,"id")||Object.prototype.hasOwnProperty.call(e.evolution,"id"))&&(""==e.change.id&&""==e.evolution.id||this.set(e,function(e){}))},set:function(e,t){var i=this,n=e.change.id;e.change.name,e.change.title,e.change.description,e.change.severity;let s=e.change.image;var a="",l=e.AuthoringContextHeader;null!=e.configurationRevision?i.model.set("configurationRevision",e.configurationRevision):i.model.set("configurationRevision",null),null!=l&&"DS-Configuration-Authoring-Context"in l&&(a="Evolution"),"Evolution"==a?i.setEffectivity(Object.assign(e,{authoringSettingBy:"Authoring"})):(D.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",""!=n&&void 0!==n&&w.populate3DSpaceURL().then(function(a){w.populateSecurityContext().then(function(a){g.getCAdetails(n).then(function(a){w.getObjectInfo(n).then(function(e){s||(s=e.data[0].dataelements.image),i.model.set("image",s||enoviaServerFilterWidget.computeUrl(i.caIcon))});var l=i.fromRefresh;i.fromRefresh=!1;for(var c="",u="",h="",C="",v="",p="",m="",f="",A=o.getUser().login,D=a.changeaction.attributes,y=0;y<D.length;y++)"currentNLS"==D[y].name&&(c=D[y].value),"current"==D[y].name?u=D[y].value:"attribute_Severity"==D[y].name?h=D[y].value:"attribute_Synopsis"==D[y].name?C=D[y].value:"interface[Change On Hold]"==D[y].name?v=D[y].value:"attribute_Originator"==D[y].name?m=D[y].value:"attribute_EstimatedCompletionDate"==D[y].name&&(f=D[y].value);for(var S=0;S<a.changeaction.people.length;S++){var b=a.changeaction.people[S].name,E=a.changeaction.people[S].role;b!=A||"contributor"!=E&&"owner"!=E||(p="TRUE")}if("In Work"==u&&"FALSE"==v&&"TRUE"==p&&0==i.isTenantChanged){var _=C,x=a.changeaction.description,U=a.changeaction.name,I=a.changeaction.context;h=h;try{g.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Change",settingBy:1==l?"Refresh":e.authoringSettingBy||"Authoring",usage:"Set",change:{applicability:a.changeaction.applicability.expressionXML?"TRUE":"FALSE"},evolution:{xml:!1,noModel:0}}})}catch(e){console.error(e)}if(i.model.set("id",n),i.model.set("context",I),i.model.set("title",_),i.model.set("content",x),i.model.set("synopsis",U),i.model.set("severity",h),i.model.set("subtitle",U),i.model.set("originator",m),i.model.set("maturityState",c),i.model.set("dueDate",f),i.model.set("applicability",a.changeaction.applicability.expressionXML),w.populateDisplayExpressionXSLT(),i.work_under.CA_Auth_Name=i.model.get("title"),l||e.fromEdit||(i.authoringContextType="change",i.activateBubble(),enoviaServerAuthoringWidget.status=!0),enoviaServerAuthoringWidget.saveMode="change",null!=t){var T=i.get();t(T)}if(!i.allowChangeConfguired)if(0!=a.changeaction.applicability.display.length)i.desactivateBubbleStyle(),g.removeClassFromDom("wp-authAlert"),(N=new r({className:"wp-authAlert",visible:!0,autoHide:!0,hideDelay:2e3}).inject(i.renderDiv,"top")).add({className:"error",message:d.CA_Applicability_Block})}else{i.desactivateBubbleStyle(),g.removeClassFromDom("wp-authAlert");var N=new r({className:"wp-authAlert",visible:!0,autoHide:!0,hideDelay:2e3}).inject(i.renderDiv,"top");1==i.isTenantChanged?i.isTenantChanged=!1:l?N.add({className:"warning",message:d.CFG_REFRESH_CA_STATE_CHECK}):N.add({className:"error",message:d.CFG_DROP_CA_ACTION_STATE_CHECK}),o.publish("removeAuthCtxEvent"+i.myAuthkey)}},function(e){i.desactivateBubbleStyle(),g.removeClassFromDom("wp-authAlert");var t=new r({className:"wp-authAlert",visible:!0,autoHide:!0,hideDelay:2e3}).inject(i.renderDiv,"top");return e&&7==e.errorID&&t.add({className:"error",message:d.CFG_DROP_CA_ACTION}),o.publish("removeAuthCtxEvent"+i.myAuthkey),Promise.reject(e)})},function(e){return Promise.reject(e)})},function(e){return Promise.reject(e)}))},setFromDrop:function(e,t){(console.groupCollapsed("Set Change objects from drop"),console.log("Pass information from 3DSpace/resources/modeler/change/changeaction WS response"),console.log(JSON.stringify(e,null,2)),console.groupEnd(),!1===UWA.is(e)||e.length>1||0==e.length)?new r({className:"wp-authAlert",visible:!0,autoHide:!0,hideDelay:2e3}).inject(this.renderDiv,"top").add({className:"error",message:d.CFG_Single_Change_Action}):!0!==this.isWorkUnderWarningToShow?this.setAfterDropValidation(e,t):this.showWorkUnderWarningMesssage(e,t)},setAfterDropValidation:function(e,t){if(UWA.is(e)){for(var i=e[0].changeaction,n=i.id.replace("pid:",""),o="",s=0;s<i.attributes.length;s++){var a=i.attributes[s];"attribute_Synopsis"==a.name&&(o=a.value)}var r=this.get();r.AuthoringContextHeader=null,r.change.id=n,r.change.name=o,enoviaServerAuthoringWidget.status=!0,this.authoringContextType="change",this.fromRefresh=!1;var l=this;this.update(r,function(){l.publish(l.myAuthkey,r)})}this.dispatchEvent("onAuthoringCtxVisible",{showAuthoringContext:!0})},showWorkUnderWarningMesssage:function(e,t){for(var i=this,n=e[0].changeaction,o="",s=0;s<n.attributes.length;s++){var a=n.attributes[s];"attribute_Synopsis"==a.name&&(o=a.value)}var r=function(){h.closeDialog(),i.setAfterDropValidation(e,t)}.bind(i),l=function(){h.closeDialog()}.bind(i),u=this.renderDiv;widget&&(u=widget.body);var g={width:360,height:215,isResizable:!1,dialogue:{header:d.CFG_DnD_PopOver,buttonArray:[{label:"Yes",labelValue:c.CFG_EFFECTIVITY_YES,handler:r,className:"primary"},{label:"No",labelValue:c.CFG_EFFECTIVITY_NO,handler:l,className:"default"}],target:u,object:null,postCrossHandler:l}},h=new E(g);h.render(),h.container.setStyle("overflow","auto"),h.container.setHTML(d.CFG_DropWarning+" "+o+" ?<br><br>");var C=new y({label:d.CFG_Checkbox_Warning});C.addEventListener("change",function(e){1==e.dsModel.checkFlag?i.isWorkUnderWarningToShow=!1:i.isWorkUnderWarningToShow=!0}),C.inject(h.container)},saveAsSessionEvolution:function(e){var t=this;""!=e["Evolution Expression"]?(widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",w.populate3DSpaceURL().then(function(i){w.populateSecurityContext().then(function(i){g.getAuthoringIDforEvolution(e).then(function(e){var i=t.get();i.evolution.id=e.ACId,i.evolution.displayExpression=e.XSLTExpr,o.publish("sessionEff",Object.assign(i,{PACID:t.myAuthkey}))},function(e){console.log(e),e&&"1"===e.errorID?w.showwarning(d.CFG_SET_FROZEN_EVOLUTION_FAILED,"error"):w.showwarning(d.CFG_WORK_UNDER_EVOLUTION_FAILED,"error")})},function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)})},function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)})):o.publish("removeAuthCtxSessionEvent"+t.myAuthkey)},setEffectivity:async function(e,t){const i=this;if(""!=e.ACId&&null!=e.ACId)!async function(t,n){i.model.set("evolExpression",t.evolutionExpression),i.model.set("id",t.ACId),i.model.set("dictionaryContext",t.dictionaryContext),i.model.set("content",e.displayExpression);let o=enoviaServerFilterWidget.computeUrl(i.modelIcon);const s=i.getInfoFromXml(t.evolutionExpression,"HolderName");try{D.init(),enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId")||"OnPremise",await w.populate3DSpaceURL(),await w.populateSecurityContext();const e=await g.getObjectFromEvolutionContextIds([s],"","model","");e&&i.model.set("image",i.getAttributeFromEvolutionObject(e.results[0].attributes,"preview_url"))}catch(e){i.model.set("image",o)}null!=i.model._attributes.image&&"undefined"!=i.model._attributes.image||i.model.set("image",o),Object.prototype.hasOwnProperty.call(t,"collection")&&(1==t.collection.length?(i.model.set("title",t.collection[0].marketingName),i.model.set("desc",t.collection[0].name)):(i.model.set("title",t.collection.map(e=>e.marketingName).join(", ")),i.model.set("desc",t.collection.map(e=>e.name||" ").join(", ")),i.model.set("image",o))),i.work_under.CA_Auth_Name=i.model.get("content"),"disable"===i.authoringContextType||"sessionDisable"===i.authoringContextType||i.fromRefresh||e.fromEdit||(i.authoringContextType="session",i.activateBubble()),enoviaServerAuthoringWidget.saveMode="session",null!=n&&n(i.get());try{let n=1;void 0!==t.collection&&(n=t.collection.length),g.sendTrackerAPIAuthoringContext({tenant:enoviaServerFilterWidget.tenant,widget:{id:widget.data.appId,name:widget.data.title||widget.options.title},authoring:{type:"Evolution",settingBy:1==i.fromRefresh?"Refresh":e.authoringSettingBy||"Authoring",usage:"Set",change:{applicability:"FALSE"},evolution:{xml:t.evolutionExpression,noModel:n||1}}})}catch(e){console.error(e)}i.fromRefresh&&(i.fromRefresh=!1)}(e,t);else if(null!=e.evolution&&""!=e.evolution.id){var n=e.evolution.id,s=e.evolution.displayExpression;i.model.set("content",s),D.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",w.populate3DSpaceURL().then(function(){w.populateSecurityContext().then(function(){g.readAuthroingContext().then(function(e){var o=e["Evolution Expression"],s=e["Dictionary Contexts"];if(i.model.set("id",n),i.model.set("context",""),i.model.set("title",""),i.model.set("synopsis",""),i.model.set("severity",""),i.model.set("subtitle",""),i.model.set("evolExpression",o),i.model.set("dictionaryContext",s),i.work_under.CA_Auth_Name=i.model.get("content"),i.renderDiv.querySelector("#iconAuthImg").src=h.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxSE.png"),i.authoringContextType="session",enoviaServerAuthoringWidget.saveMode="session",enoviaServerAuthoringWidget.status=!0,null!=t){var a=i.get();t(a)}},function(e){return console.log("create fail"),Promise.reject(e)})},function(e){return console.log("populateSecurityContext Failed"),Promise.reject(e)})},function(e){return console.log("populate3DSpaceURL Failed"),Promise.reject(e)})}else i.model.id=null,i.model._attributes.content="",i.model._attributes.id="",i.model._attributes.evolExpression="",i.model._attributes.dictionaryContext="",o.publish("removeAuthCtxSessionEvent"+i.myAuthkey)},getInfoFromXml:function(e,t){var i=e.substr(e.lastIndexOf(t));return(i=i.split('"'))[1]},getAttributeFromEvolutionObject:function(e,t){let i=null;return e.forEach(function(e){if(e.name==t)return i=e.value,!0}),i},publish:function(e,t){o.publish(e,t)},update:function(e,t){this.set(e,t)},updateSessionEff:async function(e){const t=this;if(null!=e.evolution.id&&""!=e.evolution.id){const i=function(e){t.setEffectivity({ACId:e.ACId,evolutionExpression:e["Evolution Expression"],dictionaryContext:e["Dictionary Contexts"],displayExpression:t.model.get("content")})};t.model.set("content",e.evolution.displayExpression),D.init(),widget.getValue("x3dPlatformId")?enoviaServerFilterWidget.tenant=widget.getValue("x3dPlatformId"):enoviaServerFilterWidget.tenant="OnPremise",await w.populate3DSpaceURL(),await w.populateSecurityContext(),i(await g.readAuthroingContext())}else t.model.id=null,t.model._attributes.content="",t.model._attributes.id="",t.model._attributes.evolExpression="",t.model._attributes.dictionaryContext="",o.publish("removeAuthCtxSessionEvent"+t.myAuthkey);t.fromRefresh=!1},getAllowedType:function(){return["Change Action"]},hide:function(){this.isVisible=!1;var e=this.renderDiv.querySelector("#BubbleContainer");void 0!==e&&null!=e&&(e.style.visibility="hidden")},show:function(){this.isVisible=!0;var e=this.renderDiv.querySelector("#BubbleContainer");void 0!==e&&null!=e&&(e.style.visibility="visible")},setPosition:function(e){var t=this.renderDiv.querySelector("#BubbleContainer");void 0!==t&&null!=t&&(t.classList.remove("position-bottom-right"),t.classList.remove("position-bottom-left"),t.classList.remove("position-top-left"),t.classList.remove("position-top-right"),t.classList.add("position-"+e),this.closePopoverDialog(!1))},setPositionOnResize:function(e,t){var i=this.renderDiv.querySelector("#BubbleContainer");if(void 0!==i&&null!=i){var n=i.getBoundingClientRect(),o=i.parentElement.getBoundingClientRect(),s=0,a=0,r=n.x-o.x;return null!=e&&null!=t&&(null!=this.lastX&&null!=this.lastY&&(this.lastX==r&&this.lastY==n.y||(e=r,t=n.y)),r<o.width?e<o.width?e>o.width-50?s=e-50:(s=e,e=null):s=n.y>o.height?r>o.width-50?r-50:r:o.width-50:s=o.width-50,n.y<o.height?t<o.height?t>o.height-50?a=t-50:(a=t,t=null):a=r>o.widht?n.y>o.height-50?n.y-50:n.y:o.height-50:a=o.height-50,i.style="left: "+s+"px; top:"+a+"px;"),{x:e,y:t,lastX:s,lastY:a}}},deactivateToggle:function(){const e=document.getElementById("autoggle");e&&e.removeAttribute("checked"),enoviaServerAuthoringWidget.status=!1},activateToggle:function(){const e=document.getElementById("autoggle");e&&e.setAttribute("checked",""),enoviaServerAuthoringWidget.status=!0},deactivateBubble:function(){this.desactivateBubbleStyle(),this.deactivateToggle()},activateBubble:function(){this.activateBubbleStyle(),this.activateToggle()},desactivateBubbleStyle:function(){this.renderDiv.querySelector("#iconAuthImg").src=h.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxEmpty.png"),this.renderDiv.querySelector("#BubbleContainer").setStyle("borderColor","#d3d3d3")},activateBubbleStyle:function(){var e=h.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxEmpty.png");"change"==this.authoringContextType?e=h.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxCA.png"):"session"==this.authoringContextType&&(e=h.getWebappsAssetUrl("CfgAuthoringContextUX","icons/32/I_AuthCtxSE.png")),this.renderDiv.querySelector("#iconAuthImg").src=e,this.renderDiv.querySelector("#BubbleContainer").setStyle("borderColor","#78befa")},clearConfigurationRevisionDetails:function(){this.model.set("configurationRevision",null)},setConfigurationRevisionDetails:function(e){this.model.set("configurationRevision",e)},getConfigurationRevisionDetails:function(){return null!=this.model.get("configurationRevision")?this.work_under.Auth_Details.configurationRevision=this.model.get("configurationRevision"):this.work_under.Auth_Details.configurationRevision=null,this.work_under.Auth_Details},cleanAuthDetails:async function(){const e=this;e.desactivateBubbleStyle(),e.authoringContextType=null,e.model._attributes.id="",e.model.id=null;{const t=document.querySelector("#workUnderDiv");t&&(g.cleanDraggableEvent(t),t.classList.contains("sessionAuthoringCtx")&&t.classList.remove("sessionAuthoringCtx")),e.closePopoverDialog(!0)}}})});