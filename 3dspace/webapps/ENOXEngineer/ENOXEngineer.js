define("DS/ENOXEngineer/utils/expand/ExpandErrorManager",[],()=>{class e{static buildErrorMsg(e){if(!Array.isArray(e))return"";return e.map(e=>{if("string"==typeof e)return e;const{message:t,reason:n}=e.error||{};let i="";return i="string"==typeof n&&""!==n.trim()?n:"string"==typeof t&&""!==t.trim()?t:e.toString()}).join("\n")}constructor(e){this.error=e}get isManaged(){return!1}fixPayload(){}}class t extends e{static buildErrorMsg(e,n){const i=e.filter(e=>e instanceof t);if(!i.length)return"";const r=i.map(e=>e.unkMeta),{i18nManager:o}=n;return`${o?o.get("error.Expand.unknownAttribute"):"unknown attribute(s)"}: ${r.join(", ")}`}constructor(e){super(e),this.unkMeta=null}get isManaged(){return"string"==typeof this.unkMeta&&""!==this.unkMeta.trim()}fixPayload(e){const{select_bo:t,select_rel:n}=e||{},i=e=>{return-1===this.unkMeta.replace(/\s+/g,"").split(",").indexOf(e)},r={...e};return Array.isArray(t)&&(r.select_bo=t.filter(i)),Array.isArray(n)&&(r.select_rel=n.filter(i)),r}}class n extends t{static isA(e,t){if(-1===["cv_expand_v2","multiexpand_v2"].indexOf(t))return!1;const{code:n}=e;return"UNKNOWN_META"===n}constructor(e){super(e);const{reason:t}=e;if("string"!=typeof this.unkMeta||!this.unkMeta.trim()){const e=/(Meta not found:)/g,n=t.search(e);-1!==n&&(this.unkMeta=-1!==n?t.substring(n+"Meta not found:".length).trim():null)}if("string"!=typeof this.unkMeta||!this.unkMeta.trim()){const e=/\[(.+)\]/g,[n]=t.match(e)||[];"string"==typeof n&&n.trim()&&(this.unkMeta=n.slice(1,n.length-1))}}}return class{constructor(e){this.errors=[],this.i18nManager=e&&e.core?e.core.i18nManager:null,this.ErrorsCtr=[n]}get managedErrorClasses(){return{CV2UnknownMeta:n,ExpandError:e}}get hasErrors(){return 0!==this.errors.length}get canErrorsBeFixed(){return!!this.errors.length&&void 0===this.errors.find(e=>!0!==e.isManaged)}fixPayload(e){if(!e)return e;let t=e;return this.errors.forEach(e=>{t=e.fixPayload(t)}),t}buildErrorMessage(t=!0){const n=[],i=[];if(this.errors.forEach(t=>{t.constructor.name!==e.name?n.push(t):i.push(t)}),i.length&&t)return"";let r="";if(n.length&&this.ErrorsCtr.forEach(e=>{const t=e.buildErrorMsg(n,{i18nManager:this.i18nManager});"string"==typeof t&&t.trim().length&&(r+=t)}),i.length&&!t){const t=e.buildErrorMsg(i);"string"==typeof t&&t.trim().length&&(r+=`\n${t}`)}return r}addNewErrors(t,n){Array.isArray(t)&&t.length&&t.forEach(t=>{const i=new(this.ErrorsCtr.find(e=>e.isA(t,n))||e)(t);this.errors.push(i)})}}}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/LevelSelector",["UWA/Core","DS/Controls/Abstract","DS/Controls/SpinBox","DS/Core/PointerEvents","DS/Utilities/Dom","css!DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/css/LevelSelector.css"],function(e,t,n,i,r){"use strict";return t.inherit({name:"LevelSelector",markForRecordFlag:!0,publishedProperties:{expandLevel:{defaultValue:"1",type:"string",category:"Appearance"},onLevelSelectorSet:{defaultValue:void 0,type:"function"},onLevelSelectorClose:{defaultValue:void 0,type:"function"}},buildView:function(){var t=this;this.elements.container.addClassName("enox-levelselector"),this.elements.levelSelContainer=new e.Element("div",{class:"enox-levelselector-container"}).inject(this.elements.container),this.elements.spinBox=new n({value:1,minValue:1,stepValue:1,pageStepValue:1}).inject(this.elements.levelSelContainer),this.elements.spinBox.getContent().addClassName("enox-levelselector-spinbox"),r.addEventOnElement(this,this.elements.spinBox.getContent(),"keydown",function(n){var i=e.Event.whichKey(n);"return"===i?t._levelSelected():"esc"===i&&t.close()}),this.elements.separator=new e.Element("div",{class:"enox-levelselector-separator",html:"|"}).inject(this.elements.levelSelContainer),this.elements.checkSelBtn=new e.Element("div",{class:"enox-levelselector-checkSel-btn"}).inject(this.elements.levelSelContainer),r.generateIcon("check",{target:this.elements.checkSelBtn}),r.addEventOnElement(this,this.elements.checkSelBtn,i.POINTERHIT,function(e){t._levelSelected(),e.stopPropagation()})},close:function(){this.visibleFlag=!1,this.onLevelSelectorClose&&this.onLevelSelectorClose()},_levelSelected:function(){var e=this.elements.spinBox.value;this.onLevelSelectorSet&&this.onLevelSelectorSet(e)}})}),define("DS/ENOXEngineer/componentsHelpers/XEngAutoComplete/XEngAutoComplete",["UWA/Core","DS/UIKIT/Autocomplete","WebappsUtils/WebappsUtils"],function(e,t,n){"use strict";return t.extend({defaultOptions:{placeholder:"Search ...",minLengthBeforeSearch:3,multiSelect:!0,closableItems:!0,floatingSuggestions:!0,nbResultsToShow:20,targetTypes:[],sources:[],precondition:null,datasetName:"xeng_data",typeDelayBeforeSearch:500,objectMapper:null},init:function(e){this._parent(e),this.appCore=e.appCore,this.initXEngAutocomplete()},autocompleteDataParser:function(t,n){var i=this;if(!e.is(i.options.objectMapper,"function"))throw new Error("options.objectMapper is a mandatory parameter");return n.map(function(e){return i.options.objectMapper(e)})},initXEngAutocomplete:function(){var t=this;this.addDataset({name:t.options.datasetName,items:[],remoteSearchEngine:function(n,i){var r,o=this;return new Promise(function(s,a){t.appCore.dataService.fireAutocompleteSearch({criteria:i,targetTypes:t.options.targetTypes,nresults:t.options.nbResultsToShow,sources:t.options.sources,precond:t.options.precondition}).then(function(t){(r={}).matchingItems=[],t&&(r.matchingItems=e.is(n.dataParser,"function")?n.dataParser.call(o,n,t):o.defaultDataParser(t)),r.dataset=n,s(r)}).catch(function(e){e.type="error",e.dataset=n,a(e)})})},dataParser:function(e,n){return t.autocompleteDataParser(e,n)}},{templateEngine:function(t,i,r){var o;t.addClassName("xeng-template"),(o=e.createElement("span",{class:"item-label"})).setText(r.label),t.setContent([e.createElement("img",{src:r.icon||n.getWebappsAssetUrl("ENOXEngineer","img/defaultIcon.png")}),o])},onError:function(){console.error(arguments)}})},_addSearchButton:function(){return UWA.createElement("span",{class:" fonticon fonticon-search"})},setSelection:function(e){Array.isArray(e)&&this.dispatchEvent("onSelect",e)},onSelect:function(e,t){this._parent(e,t),this.onSelectXeng&&this.onSelectXeng(e)},onUnselect:function(e,t,n,i){this._parent(e,t,n,i),this.onUnselectXeng&&this.onUnselectXeng(e)},buildSkeleton:function(){var e=this;this._parent();var t=this.elements,n=this.name;t.inputWrapper=UWA.createElement("div",{class:n+"-searchbox-wrapper xEng-autocomplete"}).inject(t.container,"top"),t.inputContainer.remove(),t.inputContainer.inject(t.inputWrapper),t.xengSearch=this._addSearchButton(),t.xengSearch.removeEvent("click"),t.xengSearch.addEvent("click",function(n){var i=t.inputContainer.getElement("input");i&&e.onSearchClick(i.value)}),t.xengSearch.inject(t.inputWrapper)},onSearchClick:function(e){console.warn("onSearchClick need to be implemented")}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/XENPanel",["DS/Windows/ImmersiveFrame","DS/Windows/Dialog"],(e,t)=>{"use strict";return class{constructor(n){this.elements={},this.options=n||{},this.options={target:null,events:{onClose:this.close.bind(this)},closeCB:void 0,...this.options},this.elements.immframe=new e;const i=Object.assign({immersiveFrame:this.elements.immframe,...this.options,resizableFlag:!1});return this.elements.dialog=new t(i),this.elements.dialog.addEventListener("close",this.close.bind(this)),this.options.target.appendChild(this.elements.immframe.getContent()),this}close(){this.elements.immframe.getContent().remove(),this.elements.dialog.destroy(),"function"==typeof this.options.closeCB&&this.options.closeCB()}closePanel(){this.elements.dialog.close()}getContent(){return this.elements.dialog.getContent()}}}),define("DS/ENOXEngineer/components/NavigationTopBar/NavigationTopBar",["DS/ENOXPageToolBar/js/PageToolBar","css!DS/ENOXEngineer/components/NavigationTopBar/NavigationTopBar.css"],function(e){"use strict";var t=function(){};return t.prototype.init=function(t,n){this._sandbox=t,this._modelEvent=t.getApplicationBroker(),this._subscribeList=[];var i={withInformationButton:!0,withWelcomePanelButton:!0,modelEvents:this._modelEvent,parentContainer:n};this._pageToolBar=new e(i),this._pageToolBar.render().inject(n),this._subscribeToEvents()},t.prototype._subscribeToEvents=function(){var e=this;this._subscribeList.push(this._modelEvent.subscribe({event:"welcome-panel-collapse"},function(){e._modelEvent.publish({event:"triptych-set-size",data:{size:40,side:"left"}}),e._modelEvent.publish({event:"triptych-show-panel",data:"left"})})),this._subscribeList.push(this._modelEvent.subscribe({event:"welcome-panel-expand"},function(){e._modelEvent.publish({event:"triptych-set-size",data:{size:300,side:"left"}}),e._modelEvent.publish({event:"triptych-show-panel",data:"left"})})),this._subscribeList.push(this._modelEvent.subscribe({event:"information-panel-close"},function(){e._modelEvent.publish({event:"triptych-hide-panel",data:"right"})})),this._subscribeList.push(this._modelEvent.subscribe({event:"information-panel-open"},function(){e._modelEvent.publish({event:"triptych-show-panel",data:"right"}),e._modelEvent.publish({event:"information-panel-visible",data:null})})),this._subscribeList.push(this._modelEvent.subscribe({event:"triptych-panel-hidden"},function(t){"right"===t&&e._modelEvent.publish({event:"information-panel-hidden",data:null})}))},t.prototype.setTitle=function(e){this._pageToolBar.getBodyContent().innerHTML=e},t.prototype.destroy=function(e){var t=0,n=this._subscribeList.length;for(t=0;t<n;t++)this._modelEvents.unsubscribe(this._subscribeList[t])},t}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelModal",["DS/Utilities/Dom","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame","DS/Windows/Dialog"],function(e,t,n,i){"use strict";function r(r){this.elements={},this.options=r||{},this.elements.immframe=new n,this.elements.immframe.getContent().addClassName("enox-level-selector-modal-immframe");var o=Object.assign({immersiveFrame:this.elements.immframe,resizableFlag:!0},this.options);return this.elements.dialog=new i(o),this.elements.dialog.addEventListener("close",this.close.bind(this)),t.createModal(this.options.target,this.elements.immframe.getContent()),this.options.modalOpened=!0,document.querySelector(".wux-controls-modalContent").addEventListener("click",function(t){e.firstParentWithClass(t.target,"wux-windows-window-content")||"function"!=typeof this.options.events.onClickOutsideContent||this.options.events.onClickOutsideContent()}.bind(this)),this}return r.prototype.close=function(){!0===this.options.modalOpened&&(this.options.modalOpened=!1,this.elements.dialog.destroy(),this.elements.dialog=null,delete this.elements.immframe,this.elements.immframe=null,t.removeModal(this.options.target))},r.prototype.destroy=function(){!0===this.options.modalOpened&&this.close(),delete this.options},r.prototype.getContent=function(){return this.elements.dialog.getContent()},r}),define("DS/ENOXEngineer/utils/expand/ExpandPayloadFactoryUtils",["UWA/Core"],e=>{const t={};function n(e){if("string"!=typeof e||!e.trim().length)return"";let t=e;const n=e.match(/\[[\S]+\]/g)||[];return[...new Set(n)].forEach(e=>{const n=e.toLowerCase().replaceAll("_","_95_").replaceAll("[","").replaceAll("]","").replaceAll(":","_58_").replaceAll(".","_46_").replaceAll(" ","_32_");t=t.replaceAll(e,n)}),t}t.definePropertiesOnObject=function(t,n,{getterFct:i=null,setterFct:r=null}){Array.isArray(n)&&e.is(t)?n.forEach(n=>{const o={};e.is(i)&&"string"==typeof i&&Reflect.has(t,i)&&(o.get=function(){return t[i](n)}),e.is(r)&&"string"==typeof r&&Reflect.has(t,r)&&(o.set=function(e){t[r](n,e)}),(Reflect.has(o,"get")||Reflect.has(o,"set"))&&Object.defineProperty(t,n,o)}):console.error("definePropertiesOnObject wrong inputs")},t.fixUqlWithCloudViewFormat=n,t.appendUqlValue=function(e,t,i="AND"){if("string"!=typeof t||!t.trim().length)return e;const r=n(t);let o="";return o="string"==typeof e&&e.trim().length?`${e} ${i} (${r})`:r};const i=["no_type_filter_rel","type_filter_rel","compute_select_bo","expand_iter","fcs_url_mode","select_bo","select_rel","locale","label","tenant","q.iterative_filter_query_bo","paths","root_path","root_physicalid","root_path_physicalid","config_filter","sequence_filter","max_count_path","find_in_context"];t.defaultProperties=i;t.defaultMultiProperties=["specVersion","union","intersection","minus","synthesis_mode"];return t.AbstractPayloadFactory=class{get json(){return null}get entries(){return i}updatePayloadWithEntries(){console.debug("updatePayloadWithEntries not implemented")}updateAnswer(){console.debug("updateAnswer not implemented")}},t}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent",[],()=>{return class{constructor(){this.isActivate=!1}get isActivated(){return this.isActivate}init(){}activate(){this.isActivate=!0}deactivate(){this.isActivate=!1}destroy(){}buildUIComponent(){}update(){}}}),define("DS/ENOXEngineer/componentsHelpers/UploadViewer/UploadViewer",["UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars4","DS/Windows/Dialog","DS/Controls/ProgressBar","text!DS/ENOXEngineer/componentsHelpers/UploadViewer/UploadTemplate.html","css!DS/ENOXEngineer/componentsHelpers/UploadViewer/XENUploadViewer.css"],function(e,t,n,i,r,o){"use strict";return t.extend({defaultOptions:{},init:function(e){if(this._parent(e),this.nls=e.nlsManager,!e.immersiveFrame)throw new Error("missing immersiveFrame");this.immersiveFrame=e.immersiveFrame,this.nls||(this.nls={get:function(e){return e},replace:function(e){return e}}),this._viewCounter=0,this._trackers=[],this.buildSkeleton()},_onProgressGenerator:function(e){var t=this;return function(n){t._onProgressUpdater(e,n)}},_onCompleteGenerator:function(e){var t=this;return function(n){t._onCompleteUpdater(e,n)}},_onCompleteUpdater:function(e,t){console.warn(" --\x3e "+e),console.warn(t);var n=this._getTracker(e),i=this;if(n){n.progressbar.destroy(),n.progressbar=null,n.state="done";var o=t?i.nls.get("job.complete.sucessful"):i.nls.get("job.complete.failed");i.panelContent.getElement(".xen-file-tile"+n.trackerId+" .status-name").setContent(o),n.progressbar=new r({displayStyle:"lite",value:100,emphasize:t?"success":"high-attention"}).inject(i.panelContent.getElement(".xen-file-tile"+n.trackerId+" .progress-bar")),setTimeout(function(){i._removeTrackerView(n);var e=i._trackers.findIndex(function(e){return e.trackerId===n.trackerId});i._trackers.splice(e,1),delete n.onProgress,delete n.onComplete,delete n.trackerId,delete n.state,delete n.progressbar,0===i._trackers.length&&i._displayEmptyView()},2e3)}},_onProgressUpdater:function(e,t){var n=this._getTracker(e);n&&t&&(n.progressbar.value=Math.round(t.loaded/t.total*100)/100*100,this._updateAllTrackers())},_updateAllTrackers:function(){var e=this;e._trackers.forEach(function(t){"inifinite"!==t.state&&100===t.progressbar.value&&e.changeStateToInfinte(t)})},changeStateToInfinte:function(e){e&&(e.progressbar.destroy(),e.progressbar=null,e.state="inifinite",this.panelContent.getElement(".xen-file-tile"+e.trackerId+" .status-name").setContent(this.nls.get("processing")),e.progressbar=new r({displayStyle:"lite",infiniteFlag:!0}).inject(this.panelContent.getElement(".xen-file-tile"+e.trackerId+" .progress-bar")))},_displayEmptyView:function(){if(this.panelContent){var e=this;this.panelContent.empty(),this.panelContent.setContent("<center> "+this.nls.get("notFileToUpload")+"</center>"),this.hideToken=setTimeout(function(){e.panel.hide()},1e3)}},_getTracker:function(e){return Array.isArray(this._trackers)&&e?this._trackers.find(function(t){return t.trackerId===e}):null},getUploadTracker:function(t){if(t&&t.fileName){var n=(65536*(1+Math.random())|0).toString(16).substring(1),i=e.extend({},t,!0),r={trackerId:n,onProgress:this._onProgressGenerator(n),onComplete:this._onCompleteGenerator(n)};return this.hideToken&&clearTimeout(this.hideToken),this.panel.visibleFlag||this.panel.show(),this.panel.show(),this._addNewUploadingViewer(i,r),this._trackers.push(r),r}},_getDisplaySize:function(e){if(e<1048576){var t=e/1024;return Math.round(100*t)/100+" KB"}t=e/1048576;return Math.round(100*t)/100+" MB"},_removeTrackerView:function(e){if(e){e.progressbar.destroy(),delete e.progressbar;var t=this.panelContent.getElement(".xen-file-tile"+e.trackerId);t&&(t.destroy(),t=null)}},_addNewUploadingViewer:function(t,n){if(t&&t.fileName){0===this._trackers.length&&this.panelContent.empty(),t.displaySize=this._getDisplaySize(t.fileSize),t.statusName=this.nls.get("uploading");var i=new e.Element("div",{html:this.template(t),class:"xen-file-upload-wrapper xen-file-tile"+n.trackerId});this.panelContent.appendChild(i),n.progressbar=new r({displayStyle:"lite",value:0}).inject(i.getElement(".progress-bar"))}},buildSkeleton:function(){this.template=n.compile(o),this.elements.container=e.createElement("div",{class:"XEN-upload-Viewer"}),this.panelContent=new e.Element("div",{html:""}),this.panel=new i({title:this.nls.get("uploadFileTitle"),identifier:"Uploader",resizableFlag:!0,content:this.panelContent,immersiveFrame:this.immersiveFrame,width:400,height:100,position:{my:"bottom right",at:"bottom right",offsetY:-20}}),this.panel.hide(),this.panel.close=this.panel.hide.bind(this.panel),this._displayEmptyView()},isInjected:function(){return!!this.getContent()&&this.getContent().isInjected()}})}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialNlsManager",["UWA/Core","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],(e,t)=>{class n{constructor(){this._fetchNLSDatas={}}fetchNlsValues(e,{apiVersion:t="R2019x",lang:n,tenantId:i}){return new Promise((r,o)=>{const s=(e,t,{value:n,dispValue:i})=>{Reflect.has(e,t)||(e[t]=new Map),e[t].set(n,i)},a=(e,t,n)=>{Reflect.has(e,t)||(e[t]=[]),e[t].push(...n)};try{let l={},c={};Reflect.ownKeys(e).forEach(t=>{if(Reflect.has(this._fetchNLSDatas,t)){const n=this._fetchNLSDatas[t];e[t].forEach(e=>{n.has(e)?s(l,t,{value:e,dispValue:n.get(e)}):a(c,t,[e])})}else a(c,t,e[t])}),Reflect.ownKeys(c).length?this.doASearch(c,{apiVersion:t,lang:n,tenantId:i}).then(e=>{e.forEach(e=>{s(l,e.sixw_key,{value:e.value,dispValue:e.dispValue})}),r(l)}):r(l)}catch(e){console.error("error: ENOXMaterialNlsManager/fetchNlsValues fails to retreive nls values"),o(e)}})}doASearch(e,{apiVersion:n="R2019x",lang:i,tenantId:r}){return new Promise((o,s)=>{try{t.getNlsOfPropertiesValues(JSON.stringify(e),{apiVersion:n,lang:i,tenantId:r,onComplete:e=>{const t=[];Reflect.ownKeys(e).forEach(n=>{Reflect.has(this._fetchNLSDatas,n)||(this._fetchNLSDatas[n]=new Map);const i=e[n];Reflect.ownKeys(i).forEach(e=>{const r=i[e];this._fetchNLSDatas[n].set(e,r),t.push({sixw_key:n,value:e,dispValue:r})})}),o(t)}})}catch(e){s(e)}})}}let i=null;return i||(i=new n),i}),define("DS/ENOXEngineer/utils/SizedMap",[],function(){"use strict";function e(e){this.maxSize=e.maxSize||10,this.content=e.initialContent||{}}return e.prototype.put=function(e,t){if(e&&t instanceof Object)for(t.LU=Date.now(),this.content[e]=t;this.getSize()>this.maxSize;)this.removeOldest()},e.prototype.removeOldest=function(){var e=this.getOldestKey();e&&this.delete(e)},e.prototype.getOldestKey=function(){if(!(this.content instanceof Object))return null;for(var e=this.keys(),t=e[0],n=this.get(t).LU||0,i=1;i<e.length;i++){const r=e[i];n>this.get(r).LU&&(n=this.get(r).LU,t=r)}return t},e.prototype.delete=function(e){this.content&&delete this.content[e]},e.prototype.has=function(e){return!(!this.content||!this.content[e])},e.prototype.keys=function(){return this.content instanceof Object?Object.keys(this.content):[]},e.prototype.get=function(e){return this.content instanceof Object?this.content[e]:null},e.prototype.values=function(){var e=this;return this.keys().map(function(t){return e.get(t)})},e.prototype.clear=function(){this.content={}},e.prototype.getContent=function(){return this.content},e.prototype.getSize=function(){if(!(this.content instanceof Object))return 0;var e="";try{e=JSON.stringify(this.content)}catch(t){e=""}return console.warn(e.length),e.length},e}),define("DS/ENOXEngineer/routerConfig/RouterConfig",[],function(){"use strict";return{routes:[{name:"myEngItems",path:"/myEngItems"},{name:"engItem_View",path:"/engItem/:pid"},{name:"recents_items",path:"/recents"}],options:{defaultRoute:"recents_items",defaultParams:{},trailingSlash:!1,useTrailingSlash:void 0,autoCleanUp:!0,strictQueryParams:!0,allowNotFound:!1}}}),define("DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal",["DS/UIKIT/Modal","UWA/Core","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n){"use strict";function i(i){this.options={title:"Dialog",className:"",withFooter:!0},this.options=t.extend(this.options,i),this.modal=function(t){return new e({className:t.className||"",closable:!0,header:"<h4>"+t.title+"</h4>",body:"",footer:""})}(this.options),this.modal.inject(widget.body),this.options.withFooter&&(this.options.customFooter?this.modal.setFooter(this.options.customFooter()):this.modal.setFooter("<button type='button' name='okButton' class='btn btn-primary'>"+n.get("eng.ui.button.ok")+"</button> <button type='button' name='cancelButton' class='btn btn-default'>"+n.get("eng.ui.button.cancel")+"</button>"),this._bindFooterEvent())}return i.prototype.show=function(){this.modal.show()},i.prototype.dispose=function(){this.modal.hide()},i.prototype.injectBody=function(e){this.modal.setBody(e)},i.prototype.getBody=function(){return this.modal.getBody()},i.prototype.injectHeader=function(e){this.modal.setHeader(e)},i.prototype.injectFooter=function(e){this.modal.setFooter(e)},i.prototype.onClose=function(e,t){this.modal.addEvent("onHide",function(n){e.call(t,n)},this)},i.prototype.onValidate=function(e,t){var n=this;this.options.withFooter&&this.modal.addEvent("onValidate",function(i){e.call(t,function(){n.destroy()})},this)},i.prototype._bindFooterEvent=function(){var e=this;this.modal.getFooter().getElements(".btn").forEach(function(t){"cancelButton"===t.name&&t.addEvent("click",function(){e.modal.hide()}),"okButton"===t.name&&t.addEvent("click",function(){e.modal.dispatchEvent("onValidate")})})},i.prototype.getContent=function(){return this.modal.getContent()},i.prototype.destroy=function(){void 0!==this.modal&&this.modal.destroy();for(var e=Object.keys(this),t=0;t<e.length;t++)console.log(e[t]),this[e[t]]=void 0},i}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel",["UWA/Core","DS/Controls/Button","DS/DataDragAndDrop/DataDragAndDrop","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel.css"],(e,t,n,i,r)=>{return class{constructor(t){this.appCore=t.appCore;const n=i.compile(r),o=e.createElement("div",{html:n()});this._container=o.getElement(".material-apply-panel"),e.is(t.onApplyEvent)&&(this.onApplyEvent=t.onApplyEvent),e.is(t.onDnDEvent)&&(this.onDnDEvent=t.onDnDEvent),this._buildSkeleton()}hide(){this.content.hide()}show(){this.content.show()}get content(){return this._container}_buildSkeleton(){const i=this.content.getElement(".material-apply-panel-button-div"),r=this.appCore.i18nManager.get("materialFacet.applyMaterial");if(new t({domId:"material-apply-button",label:e.is(r)?r:"Apply"}).inject(i).getContent().addEventListener("buttonclick",this.onApplyEvent),i.inject(this._container),e.is(this.onDnDEvent)){const e={drop:(e,t,n)=>{this._container.removeClassName("material-apply-panel-drag-over"),this.onDnDEvent({dataText:e,droptarget:t,evt:n})},enter:(e,t)=>{this._container.addClassName("material-apply-panel-drag-over")},over:(e,t)=>{this._container.addClassName("material-apply-panel-drag-over")},leave:(e,t)=>{this._container.removeClassName("material-apply-panel-drag-over")}};n.droppable(this._container,e)}}}}),define("DS/ENOXEngineer/services/XEngLocalStorage",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.singleton({init:function(t){if(e.is(localStorage)){var n=localStorage.getItem("xEngineerData");if(e.is(n))try{this.xEngData=JSON.parse(n)}catch(e){console.error("error during parsing !")}e.is(this.xEngData)||(this.xEngData={},this._commit()),e.is(this.xEngData.xEng_mode)||(this.xEngData.xEng_mode="index",this._commit()),this.xEngData.xEng_mode="index",this._commit()}},setItem:function(t,n){e.is(localStorage)&&(this.xEngData[t]=e.clone(n),this._commit())},getItem:function(t){if(e.is(localStorage))return this.xEngData[t]},_commit:function(){localStorage.setItem("xEngineerData",JSON.stringify(this.xEngData))},removeItem:function(t){e.is(localStorage)&&(delete this.xEngData[t],this._commit())},consumeItem:function(t){if(e.is(localStorage)){var n=this.getItem(t);return this.removeItem(t),n}}})}),define("DS/ENOXEngineer/utils/xEngPnOSCChoiceMngt",["DS/WAFData/WAFData","DS/ENOXEngineerCommonUtils/XENPlatform3DXSettings"],(e,t)=>{const n=" â— ";let i;return i=function(i){const r=i.url,o=i.platforminstance,s=[],a=[],l=[];let c,d;function u(e){let t,i,r,o=!1;const u=e.preferredcredentials;if(u.collabspace&&u.role&&u.organization){const e=u.collabspace,n=u.role,o=u.organization;t=e.name,i=n.name,r=o.name,c=`${i}.${r}.${t}`}const p=e.collabspaces;if(p&&p.length>0){let e,d=!1;for(var g=0;g<p.length;g++){for(var h=(f=p[g]).couples||[],m=0;m<h.length;m++){const t=h[m];if(void 0===e&&(e=t.organization.name),e!==t.organization.name){d=!0;break}}if(d)break}for(g=0;g<p.length;g++){var f;const e=(f=p[g]).name,u=f.title;for(h=f.couples,m=0;m<h.length;m++){const p=h[m],g=p.organization,f=p.role,E=g.name,C=g.title,_=f.name,y=f.nls,M=`${_}.${E}.${e}`,N=d?u+n+C+n+y:u+n+y;s.push(M),a.push(N),l.push(u),c?r===E&&i===_&&t===e&&(o=!0):o=!0}}}d(o)}return{RetrieveSCListAndPrefered(n){if(n&&n.callback){let i=`${r}/resources/modeler/pno/person?current=true`;i+="&select=preferredcredentials&select=collabspaces",i+=`&tenant=${o}`,d=n.callback,e.authenticatedRequest(i,{method:"GET",type:"json",onComplete:u,onFailure(){d(!1)},headers:{Accept:"application/json","Accept-Language":t.getLanguage()}})}},getSCPreference(e){const t={name:"SC",type:"list",label:e,options:[]};for(let e=0;e<s.length;e++)t.options.push({value:s[e],label:a[e],collabSpaceTitle:l[e]});return t.options.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),t},getSCPreferred(e){let t;return c?t=c:!function(e){let t=!1,n=0;for(;!t&&n<s.length;)e===s[n]&&(t=!0),n++;return t}(e)?(console.error("no security context available ! "),t=null):t=e,t}}}}),define("DS/ENOXEngineer/services/MaterialConstants",[],()=>{return{MaterialType:{core:"dsc_matref_ref_Core",covering:"dsc_matref_ref_Covering"}}}),define("DS/ENOXEngineer/utils/MaturityUtils",[],function(){"use strict";var e={};return{createCSSClass:function(e,t,n){if(null===document.getElementById(e)){var i=document.createElement("style");i.type="text/css",i.id=e;let r=n||"."+e;i.innerHTML=r+t,document.getElementsByTagName("head")[0].appendChild(i)}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},getAndCreateMaturityClass:function(e,t,n){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},addCSSMaturityClasses:function(t,n,i){if(void 0===t)return;let r=i.policies;for(let t=0;r&&t<r.length;t++){let n=r[t].policyName;e[n]=r[t].states}for(let i=0;i<t.length;i++){let r=t[i];if(e[r]){let t=e[r];for(let e=0;e<t.length;e++){let i=t[e].activeColor,o="{color:"+("#FFFFFF"===i?"#000000":"#FFFFFF")+" ; background-color:"+i+";}",s=this.cleanStatusForCSS(t[e].stateSysName),a="lc-status-"+this.cleanStatusForCSS(r)+"-"+s+(n?"-withClass":""),l="."+a+(n?" ."+n:"");this.createCSSClass(a,o,l)}}}}}}),define("DS/ENOXEngineer/utils/XEngineerConstants",["UWA/Core","DS/ENOXEngineerCommonUtils/XENCommonConstants"],function(e,t){"use strict";var n={ID_CARD_MINIFICATION:"Id_Card-minification-status",ID_CARD_EXPAND:"Id_card_expanded",ID_CARD_MINIFY:"Id_card_minified",EVENT_REFRESH_APP_CONTENT:"refresh-app-content",EVENT_REFRESH_WIDGETS:"refresh-widgets",EVENT_CLEAR_WIDGETS_CLIPBOARD:"clear-widgets-clipboard",EVENT_TRIPTYCH_PANEL_VISIBLE:"triptych-panel-visible",EVENT_TRIPTYCH_PANEL_HIDDEN:"triptych-panel-hidden",EVENT_TRIPTYCH_HIDE_PANEL:"triptych-hide-panel",EVENT_TRIPTYCH_SHOW_PANEL:"triptych-show-panel",EVENT_TRIPTYCH_RESIZE:"resizing-triptych-container",EVENT_TRIPTYCH_RESIZE_PANEL:"triptych-resized",EVENT_TRIPTYCH_TOGGLE_PANEL:"triptych-toggle-panel",EVENT_TRIPTYCH_SET_SIZE:"triptych-set-size",EVENT_SHOW_PROPERTIES:"show-properties",EVENT_WELCOME_PANEL_ACTION_SELECTED:"welcome-panel-action-selected",EVENT_WELCOME_PANEL_COLLAPSE:"welcome-panel-collapse",EVENT_WELCOME_PANEL_EXPAND:"welcome-panel-expand",EVENT_INFO_PANEL_CLOSE:"information-panel-close",EVENT_INFO_PANEL_OPEN:"information-panel-open",EVENT_INFO_PANEL_VISIBLE:"information-panel-visible",EVENT_INFO_PANEL_HIDDEN:"information-panel-hidden",EVENT_GO_BACK:"go-back-event",EVENT_REFRESH_ITEMVIEW:"xEngineer-refresh-itemView",EVENT_REFRESH_LANDING_DATA:"xEngineer-refresh-landing-data",EVENT_IDCARD_READY:"idCard-ready",EVENT_LIST_READY:"list-view-ready",EVENT_LIST_SELECT_ITEM:"item-selected",EVENT_REFRESH_LISTVIEW:"refresh-listview",EVENT_RELOAD_ENGINEERING_DEFINITION:"reload-list-content",EVENT_MY_EN_ITEM_READY:"myEngItem-view-ready",EVENT_IDCARD_ATTRIBUTES_CLICKED:"idcard-attributes-clicked",EVENT_IDCARD_CUSTOM_SHOW_LANDING:"custom-show-landing-page-event",EVENT_IDCARD_CUSTOM_WP_TOGGLE_EVENT:"custom-welcome-panel-toggle-event",EVENT_IDCARD_CUSTOM_INFORMATION_ICON:"custom-information-icon-event",EVENT_IDCARD_CUSTOM_GENERIC_ICON:"custom-generic-icon-event",SWITCH_MODE:"switch-mode",EVENT_IDCARD_CUSTOM_SHOW_CONFIGURATION:"custom-show-configuration-event",EVENT_IDCARD_CUSTOM_SHOW_MODELVERSION:"custom-show-modelversion-event",EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER:"custom-show-version-explorer-event",EVENT_IDCARD_CUSTOM_OPEN_ACTIONS_MENU:"custom-open-actions-menu-event",EVENT_IDCARD_CUSTOM_OPEN_BACK_BUTTON:"idcard-back",EVENT_UPDATE_IDCARD_RENDERING:"event-update-idcard-rendering",EVENT_IDCARD_CUSTOMIZE_ATTRIBUTES_MODIFICATION:"ENXViews/IDCardCustomization/idCardAttributesModification",EVENT_IDCARD_SAVED_ATTRIBUTES:"saved-displayedAttributes-idcard",EVENT_INDEX_MODE_DISABLE:"event_index_mode_disable",MANUFACTURING_RESPONSIBILITY:"Manufacturing Responsibility",MANUFACTURING:"Manufacturing",MANUFACTURING_RESPONSIBILITY_COLUMN:"ManufacturingResponsibilityColumn",SPECIFICATION_DOCUMENT:"SpecificationDocument",EVENT_UPLOAD_ATTACHMENT_COMPLETE:"upload-attachment-complete",EVENT_DETACH_ATTACHMENT_COMPLETE:"detach-attachment-complete",EVENT_ATTACH_ATTACHMENT_COMPLETE:"attach-attachment-complete",EVENT_COLLECTION_ACTION_UPDATE_COUNT:"enox-collection-toolbar-items-count-update",EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_PARTIAL:"enox-collection-toolbar-select-all-checkbox-partial",EVENT_COLLECTION_TOOLBAR_CHECKBOX_HIDE:"enox-collection-toolbar-hide-checkbox",EVENT_COLLECTION_TOOLBAR_CHECKBOX_SHOW:"enox-collection-toolbar-show-checkbox",EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_CHECKED:"enox-collection-toolbar-select-all-checkbox-checked",EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_UNCHECKED:"enox-collection-toolbar-select-all-checkbox-uncheck",EVENT_COLLECTION_SELECTALL:"enox-collection-toolbar-all-selected",EVENT_COLLECTION_UNSELECTALL:"enox-collection-toolbar-all-unselected",EVENT_TOOLBAR_MULTISEL_COUNT:"enox-collection-toolbar-selections-count-update",EVENT_TOOLBAR_SORT:"enox-collection-toolbar-sort-activated",EVENT_TOOLBAR_DISABLE:"enox-collection-toolbar-disable-action",EVENT_TOOLBAR_ENABLE:"enox-collection-toolbar-enable-action",EVENT_TOOLBAR_SEARCH:"enox-collection-toolbar-filter-search-value",EVENT_NOTIFY_CONTENT_SIZE_CHANGE:"notify-content-size-change",EVENT_UPDATE_INSTANCES_EFFECTIVITIES:"event-update-instances-effectivities",EVENT_COLORIZATION_UPDATED:"color-updated",EVENT_REAPPLY_DATAGRID_SORT_MODEL:"reply-datagrid-sort-model",EVENT_TOOLBAR_CHANGE_ICON:"enox-collection-toolbar-change-icon-action",EVENT_TOOLBAR_CHANGE_SELECTION:"enox-collection-toolbar-change-select-subMenu-action",EVENT_NEW_ENG_ITEM_CREATED:"new-eng-item-created",EVENT_DELETED_ENG_ITEM:"eng-item-deleted",EVENT_NEW_INSERTED_ENG_ITEM:"inserted-eng-item",EVENT_CREATED_NODES:"created-nodes",EVENT_REMOVED_NODES:"removed-nodes",EVENT_REMOVED_INSTANCES:"removed-instances",EVENT_NEW_ATTACHED_DOCUMENT:"new-attachement",EVENT_SET_ACTIVE_ENG_ITEM:"set-active-eng-item",EVENT_RESET_SELECTION:"reset-selection",EVENT_REPLACED_ENG_ITEM:"replaced-eng-item",EVENT_REPLACED_DOCUMENT:"replaced_document",EVENT_DOWNLOAD_ITEM:"download-item",EVENT_REMOVE_DOCUMENT:"remove-item",EVENT_DELETE_DOCUMENT:"delete-document",EVENT_REMOVED_INSTANCE:"removed-instance",EVENT_CONF_MODEL_UPDATED:"conf_model_updated",EVENT_QUALIFIED_AS_FINAL_ITEM:"event-qualified-as-final",EVENT_FLAT_LIST:"event-flat-list",EVENT_STRUCTURE_VIEW_CHANGED:"event-change-structure-view-changed",EVENT_CHANGE_QUANTITY_VIEW:"event-change-quantity-view",EVENT_SYNC_VIEW_WITH_EI_MODEL:"sync-view-with-model",EVENT_SYNC_MATURITY_WITH_MODEL:"sync-maturity-with-model",EVENT_COLUMNS_CHANGED:"columns-changed",EVENT_REBUILD_SESSION:"rebuild-user-session",EVENT_REMOVE_CUT_INSTANCES:"remove_selected_cut_items_from_parent",EVENT_MODIFIED_REFERENCES:"eng-item-modified",EVENT_MODIFIED_NODES:"modified-nodes",EVENT_REFRESH_ITEMS_BY_IDS:"event-refresh-items-by-id",EVENT_REMOVED_FROM_RECENT:"event-removed-from-recent",EVENT_AUTHORING_MATERIAL_START:"event-authoring-material-start",EVENT_AUTHORING_MATERIAL_END:"event-authoring-material-end",EVENT_CLOSE_RUNNING_CMD:"close-running-cmd",EVENT_INSTANCES_CREATED:"event-instances-created",EVENT_CLEAR_TAGGER:"event-clear-tagger",EVENT_CHANGE_DIRECT_VIEW:"event-change-direct-vieww",EVENT_TAGGER_GROUP_CHANGED:"event-tagger-group-changed",CHANGE_QUANTITY_LIMIT:100,CHANGE_QUANTITY_LIMIT_UNDER_CHANGE_ACTION:30,RUN_BACKGROUND_JOB_COUNT:100,MULTISEL_ACTIVATED:"multisel-activated",MULTISEL_DEACTIVATED:"multisel-deactivated",MULTISEL_ADD_ITEM:"multisel-add-item",MULTISEL_REMOVE_ITEM:"multisel-remove-item",MY_ENG_ITEMS_VIEW:"my_engItem",ENG_ITEM_VIEW:"eng_item_view",RECENT_ENG_ITEM_VIEW:"recent_eng_item_view",EVENT_LAUNCH_COMMAND:"show-light-component",EVENT_SET_PARTNUMBER_COMPLETED:"set-part-number-completed",EVENT_SET_WORKUNDER_EVOLUTION_COMPLETED:"set-workunder-evolution-completed",EVENT_NEVER_SHOW_WORKUNDER_DLG:"never-show-dialog-checkbox-checked",EVENT_NEW_VERSION_COMPLETED:"new_version_created",EVENT_OPEN_ITEM_WITH_COMPASS:"open_item_with_compass",WP_ADD_ENG_ITEM_ACTION:"add_engItem",WP_ADD_NEW_CONTENT:"add_newcontent",WP_ADD_NEW_PART_ACTION:"add_newPart",WP_OPEN_ENG_ITEM_ACTION:"open_engItem",WP_MY_ENG_ITEMS_ACTION:"my_eng_items",WP_RECENTS_ITEMS_ACTION:"recent_items",EVENT_SELECT_ACTION_WP:"welcome-panel-select-action",WP_IMPORT_ENG_ITEM_ACTION:"import_items",TRIPTYCH_CMP:"triptych",PROPERTY_CMP:"propertyView",ITEM_VIEW_CMP:"itemView",IDCARD_CMP:"IdCard",LIST_VIEW_CMP:"ListView",LIST_VIEW_NEW_CMP:"XEngListView",WELCOME_PANEL_CMP:"welcomePanel",MY_ENG_ITEM_CMP:"XEngGridView",CROSS_APP_SELECTION_EVENT:"DS/PADUtils/PADCommandProxy/select",DUPLICATE_CMD:"DuplicateHdr",COMPARE_CMD:"CompareHdr",MATURITY_GRAPH_CMD:"MaturityHdr",MATURITY_BULK_CMD:"maturity-bulk",CHANGE_OWNER_CMD:"ActionBar_ChangeOwner",DELETE_CMD:"DeleteHdr",REPLACE_BY_LATEST_REVISION:"UPSReplaceByLatestRevision",REPLACE_BY_EXISTING:"UPSAuthReplaceByExisting",REPLACE_BY_VERSION:"replaUPSAuthReplaceByRevisionceByVersion",REPLACE_BY_LATEST_VERSION:"UPSAuthReplaceByRevision",UPDATE_VERSION:"UPSAuthRevisionUpdate",UPDATE_WIDGET_TITLE:"XENG_UPDATE_WIDGET_TITLE",CREATE_NEW_ENG_ITEM:"ActionBar_NewProductCmd",CREATE_NEW_PART:"ActionBar_NewPartCmd",CREATE_NEW_CONTENT:"NewContent",CREATE_NEW_DRAWING:"ActionBar_NewDrawingCmd",ADD_EXISTING_DRAWING:"XENG_ADD_EXISTING_DRAWING",VERSION_GRAPH_CMD:"Show_Version_Graph",DETACH_ENG_ITEMS_CMD:"UPSAuthUnparent",ADD_EXISTING:"addExisting",ITEM_CUT_CMD:"UPSAuthCut",ITEM_COPY_CMD:"UPSAuthCopy",ITEM_PASTE_CMD:"UPSAuthPaste",ADD_TO_CLIPBOARD:"DS/UPSCommands/commands/UPSAuthCmdCutCopyPaste/clipboard",SET_PART_NUMBER_CMD:"SetThePartNumber",ADD_MATERIAL_QUANTITY_CMD:"addNewMaterialQuantity",CHANGE_QUANTITY_CMD:"ChangeTheQuantity",CHANGE_MASS_QUANTITY_CMD:"ChangeMassQuantity",CHANGE_VOLUME_QUANTITY_CMD:"ChangeVolumeQuantity",SHOW_HISTORY_CMD:"HistoryHdr",ADD_EXISTING_DOC_CMD:"XENG_ADD_EXISTING_DOC",ADD_NEW_DOC_CMD:"XENG_ADD_NEW_DOC",RELATEDOBJECTS_CMD:"RelatedObjectsHdr",OPENPRODUCT_CMD:"OpenProduct",REVISE_CMD:"RevisionHdr",REVISE_FROM_CMD:"ReviseFromHdr",NEW_BRANCH_CMD:"NewBranchHdr",EDIT_CONF_CONTEXT_CMD:"XENG_EDIT_CONF_CONTEXT",EDIT_VARIANT_EFFECTIVITY_CMD:"EditVariant",SET_EVOLUTION_EFFECTIVITY_CMD:"EditEvolution",SET_PROD_CONF_CMD:"XENG_SET_PROD_CONF",LAUNCH_ATTRIBUTES_MGT_CMD:"launchAttributesManager",FIND_ITEMS_CMD:"FindCmd",EXPORT_ITEMS_CMD:"Export",IMPORT_ITEMS_CMD:"Import",CONST_AUTHORING:"Authoring",CONST_INDEX:"Index",SET_WORKUNDER_EVOLUTION_CMD:"SetWorkunderEvolution",OPEN_ENG_ITEM:"XENG_OPEN_ENG_ITEM",LAUNCH_NG_FILTER_CMD:"DefineFilter",QUALIFIED_AS_FINAL_CMD:"QualifiedAsFinal",LEAF_MATERIALS_CMD:"LeafMaterials",FLAT_LIST_VIEW:"flatListView",DIRECT_CMD:"Direct",INSTANCE_CMD:"UsageView",REFERENCE_CMD:"ReferenceView",VALUE_INSTANCE_OR_REFERENCE_CMD:"value_instance_or_reference_cmd",PROPERTIES_CMD:"edit-properties",DOWNLOAD_DOCUMENT_CMD:"download-document",DETACH_DOCUMENT_CMD:"detach-document",DELETE_DOCUMENT_CMD:"delete-document",LAUNCH_REORDER_CMD:"UPSAuthReorderProduct",REPLACE_BY_LATEST_REVISION_DOCUEMNT_CMD:"ReplaceDocumentByLatestRevisionCmd",REPLACE_BY_REVISION_DOCUEMNT_CMD:"ReplaceDocumentByRevisionCmd",EDIT_DOCUMENT_CMD:"EditDocumentCmd",UPDATE_DOCUMENT_CMD:"UpdateDocumentCmd",UNDO_EDIT_DOCUEMNT_CMD:"UndoEditDocumentCmd",PROPERTIES_REF_CMD:"edit-properties-ref",PROPERTIES_INST_CMD:"edit-properties-inst",COMMENTS_CMD:"edit-comments",ATTACHMENTS_CMD:"edit-attachments",MATERIALS_CMD:"edit-materials",ALTERNATES_CMD:"edit-alternates",MADE_FROM_CMD:"edit-made-from",DERIVED_OUTPUT_CMD:"edit-derived-output",MANUF_RESP_CMD:"edit-manufacturing",SPEC_DOC_CMD:"edit-spec-doc",MATURITY_MODEL_VERSION_RELEASE:"Release",MATURITY_MODEL_VERSION_OBSOLETE:"Obsolete",OPEN_WITH_MENU:"XENG_OPEN_WITH",EDIT_DOCUMENT:"Edit",UPDATE_DOCUMENT:"Update",UNDO_EDIT_DOCUEMNT:"UndoEdit",REPLACE_BY_LATEST_REVISION_DOCUEMNT:"ReplacebyLatestRevision",REPLACE_BY_REVISION_DOCUEMNT:"ReplacebyRevision",USER_RECENTS_ENG_ITEMS:"xEngUserRecents",USER_CONF_PREFERENCES:"xEngineerUserConfPref",NLS_STORAGE_NAME:"xAppsElementsNLSNames",PREDICATE_NLS_STORAGE_NAME:"xAppsPredsValue",RDF_CLASSES_TO_LOAD:"rdfClassToLoad",MOST_USED_PROP_VALUE:"mostUsedPropValue",DS6W_CLASSES_WITH_NLS_PROP:"rdfClassWithNslProp",USER_SELECTED_NODE_IDS:"selectedNodeIDs",IS_INFORMATION_PANEL_LAUNCHED:"isInformationPanelLaunched",IS_INFORMATION_PANEL_LAUNCHED_FOR_HOME_PAGE:"isInformationPanelLaunchedInHomePage",INFORMATION_PANEL_WIDTH:"InformationPanelWidth",GROUPBY_OPTIONS:"groupBy",GROUPBY_MENU:"groupby",PREFERENCE_MAX_SIZE:"preferenceMaxSize",USER_EVOLUTION_PREF:"evol_filter_pref",USER_CUSTO_VIEW_PREF:"custo_view_saved_data",USER_WORKUNDER_EVOL_PREF:"evol_workunder_pref",CONF_OFFICIAL_VIEW:"Current",CONF_PROJECTED_VIEW:"Projected",PC_FILTER_MODE_PREF:"pc_filter_mode",CONF_STRICT_MODE:"Strict",CONF_150_MODE:"150%",TITLE_COLUMN_NO:"0",TITLE_PATH_OF_REFERENCE:"PLMEntity.V_Name",INSTANCE_PATH:"PLMInstance.PLM_ExternalID",DESCRIPTION_PATH_OF_INSTANCE:"PLMInstance.V_description",DESCRIPTION_PATH_OF_REFERENCE:"PLMEntity.V_description",TITLE_PATH_OF_DOCUMENT:"Title",DESCRIPTION_PATH_OF_DOCUMENT:"description",TITLE_PATH_OF_3DSHAPE:"PLMEntity.V_Name",DESCRIPTION_PATH_OF_3DSHAPE:"PLMEntity.V_description",XENGINEER_APP_NAME:"ENXENG_AP",ENORIPE_APP_NAME:"ENORIPE_AP",NAME_3DXCONTEXT:"3DXContent",VALUE_ASK_WORKUNDER_EVERYTIME:"ask_workunder_everytime",VALUE_SET_WORKUNDER_ALWAYS:"always_workunder_never_ask",VALUE_SET_WORKUNDER_NEVER:"never_workunder_never_ask",VALUE_QUALIFIED_AS_FINAL_COMPONENT:"value_qualified_as_final_component",VALUE_QUALIFIED_AS_LEAF_COMPONENT:"value_qualified_as_leaf_component",VALUE_QUANTITY_VIEW:"value-quantity-view",FINAL_ITEMS_PREF:"Final Item",FINAL_ITEMS_DEFAULT:"Not Selected(Leaf Item)",FINAL_ITEM_VALUE_LABEL:"final_item_value",FINAL_ITEM_VALUE_NAME:"final_item_name",USER_EXPORT_HEADER_TEMPLATE:"xEngineer_Export_HeaderTemplate",NOT_GROUPED:"Not Grouped",REFERENCE:"Reference",PART_NUMBER:"Part Number",DATA_LIMIT_FOR_FINAL:1e4,TYPE_VPMREFERENCE:"VPMReference",TYPE_DRAWING:"Drawing",TYPE_DOCUMENT:"Document",TYPE_ADVANCED_FILTER:"ENOStrRefinementSpecification",CHANGECONTROL_SHOW_STATE:"changeControlVisible",CHANGECONTROL_POSITION:"changeControlPosition",CHANGECONTROL_POSITION_TOPLEFT_VALUE:"top-left",CHANGECONTROL_POSITION_TOPRIGHT_VALUE:"top-right",CHANGECONTROL_POSITION_BOTTOMLEFT_VALUE:"bottom-left",CHANGECONTROL_POSITION_BOTTOMRIGHT_VALUE:"bottom-right",CHANGECONTROL_POSITION_FREE_VALUE:"free",PREFERRED_MASS_UNIT:"preferred-unit-mass",PREFERRED_VOLUME_UNIT:"preferred-unit-volume",NG_FILTER_PANEL_TAG:"dataFilterPanelCtn",IS_NGFILTER_PANEL_LAUNCHED:"isNGFilterPanelLaunched",PREFERRED_MASS_UNIT:"preferred-unit-mass",PREFERRED_VOLUME_UNIT:"preferred-unit-volume",PREFERRED_AREA_UNIT:"preferred-unit-area",PREFERRED_LENGTH_UNIT:"preferred-unit-length",APPEND_INSTANCE_COLUMN_KEYWORD:"-Instance",PREFERED_SHOW_NOT_IN_BOM:"ShowNotInBOM",DIMENSION_VOLUME:"VOLUME",DIMENSION_MASS:"MASS",DIMENSION_AREA:"AREA",DIMENSION_LENGTH:"LENGTH",CONT_QUANTITY_MASS:"ds6wg:DELFmiContQuantity_Mass.V_ContQuantity",CONT_QUANTITY_VOLUME:"ds6wg:DELFmiContQuantity_Volume.V_ContQuantity",CONT_RAWMAT_QUANTITY_LENGTH:"ro.madefromquantity_length.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_MASS:"ro.madefromquantity_mass.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_AREA:"ro.madefromquantity_area.V_ContQuantity-Instance",CONT_RAWMAT_QUANTITY_VOLUME:"ro.madefromquantity_volume.V_ContQuantity-Instance",DECLARED_VOLUME:"ds6wg:MaterialUsageExtension.DeclaredQuantity",PREFERRED_DIMENSION:"VOLUME",UNEXISTANT_ID:"#UNEXISTANT_ID",CHANGEQUANTITY_CHUNK_COUNT:100,ERR_FUN092398:"ERR_FUN092398",MANUFACTURING_INTENT_PREFERENCE:"isManufaturingIntentPrefActive",COMMAND_WS_EXPAND_CV:"cv_expand",COMMAND_WS_EXPAND_DB:"db_expand_new",COMMAND_WS_EXPAND_CV_V2:"cv_expand_v2",COMMAND_WS_MULTIEXPAND_V2:"multiexpand_v2",COMMAND_WS_MULTIEXPAND:"multiexpand",CONST_EMPTY_DGV_TILE_VIEW:"DGVorXENTile",EVENT_CHANGE_MFG_VIEW:"event-change-manufacturable-view",DS6W_MANUFACUTRABLE:"ds6w:manufacturable",VALUE_MFG_VIEW:"ManufacturableView",MANUFACTURING_CMD:"ManufacturingView",DATABASE_MODE_MULTIVALUES_SEPARATOR:"",INDEX_MODE_MULTIVALUES_SEPARATOR:",",CONST_YES:"Yes",CONST_AUTHORING_MODE:"authoringMode",UNSUPPORTED_TOOLBAR_ACTIONS_AUTHORING_MODE:"unSupportedToolbarActionsForAuthoringMode",CONST_DOC_AS_SPEC:"DocAsSpec",CONST_SPEC_FACET_NAME:"relateddocuments_spec",CONST_SPECIFICATIONS_TAB_UPDATE:"XEN/SPECIFICATIONS/TAB/UPDATE",EXPAND_MENU:"ExpandMenu",EVENT_EXPAND_BY_LEVEL:"ExpandByLevel",EXPAND_CMD:"ExpandCmd",EXPAND_ALL_CMD:"ExpandAllLevelCmd",EXPAND_N_LEVEL_CMD:"ExpandNLevelCmd",COLLAPSE_ALL_CMD:"CollapseAllCmd",CONST_EXPAND_ALL_LEVEL:"-1",CONST_ADV_FILTER:"nextGenFilter",XEN_CUSTO_KEY:"xen_app_custo",XEN_CUSTO_IDENTIFIER:"custom-view-identifier",XEN_CUSTO_VIEWS:"custom-views",CFG_EDIT_CONTEXT_CMD:"cfgEditConfigurationContext",EVENT_FIND_IN_CONTEXT_LAUNCH:"event-change-findincontext-launch",EVENT_FIND_IN_CONTEXT_VIEW_BUILT:"event-findincontext-view-built",CONST_FIND_IN_CONTEST_SELECTED_COLUMNS:"selected-columns-find-in-context",CONST_TARGET_LEVEL:"targetLevel",CONST_FIND_IN_CRITERIA:"findInContextCriteria",CONST_PARTIALLY_EXPANDED:"partiallyExpanded",CONST_FIND_IN_CONTEST_AUTOSELECT_OPTION:"find-in-context-autoselect-matched-node",EVENT_DISABLE_SORT_TO_DEFAULT:"DisableSortToDefault",CONST_DEFORMABLE:"Deformable",CONST_DS6W_DEFORMABLE:"ds6w:deformable",CONST_DS6W_DEFORMABILITY:"ds6w:deformability",CONST_DEFORMABLE_OBJECT_INFO:"DeformedObjectInfo",CONST_DEFORMABLE_SEMANTIC_REL_INFO:"pathsr",CONST_CURRENT_OBJECT_MATURITY_STATE:"currentObjectState",CONST_SPEC_RELATION_COLUMN_DATAINDEX:"v6_specdoc_to",CONST_DOC_AS_SPECS:"DocAsSpecs",SELECT_MODE:"data-grid-view-select-mode",SELECT_MODE_ROW:"data-grid-view-select-mode-row",SELECT_MODE_CELL:"data-grid-view-select-mode-cell",DGV_SELECTION_MULTIPLE:"multiple",DGV_SELECTION_SINGLE:"single",DGV_SELECTION_NONE:"none",PREFERENCE_TYPE_CHOOSER:"DisplayTypeChooser",PREFERENCE_INTERVAL_SWITCH_INDEX:"intervalToSwitch",PREFERENCE_USE_INDEX:"UseIndex",ENABLE_SELECTION_MODES:"enable-selection-modes",ENABLE_HISTORY_OPEN_CMD:"enable-history-open-cmd",IDCARD_SAVED_ATTRIBUTES:"savedAttributes",DEFAULT_IDCARD_DISPLAY_ATTRIBUTES:"defaultIdCardDisplayAttributes",CUSTOMIZE_HEADER_ATTRIBUTES:"customizeHeaderAttributes",FIND_MENU:"FindCmd",ADD_MENU:"Add"};return e.extend(n,t),Object.defineProperty(n,"use_expand_v2",{get:()=>!e.is(localStorage)||!e.is(localStorage.getItem("XEN_use_expand_v1"))||"true"!==localStorage.getItem("XEN_use_expand_v1")}),Object.defineProperty(n,"fetch_doc_expand_v2",{get(){return!!this.use_expand_v2&&(!e.is(localStorage)||!e.is(localStorage.getItem("XEN_fetch_doc_expand_v1"))||"true"!==localStorage.getItem("XEN_fetch_doc_expand_v1"))}}),Object.defineProperty(n,"useBIFilterExpandSynthesis",{get:()=>!e.is(localStorage)||!e.is(localStorage.getItem("XEN_BIFilterFetchSynthesisOnly"))||"true"!==localStorage.getItem("XEN_BIFilterFetchSynthesisOnly")}),Object.defineProperty(n,"supportTaggerGroupInViews",{get:()=>!(!e.is(localStorage)||!e.is(localStorage.getItem("XEN_TaggerGroupInIndentedViewOnly")))&&"false"===localStorage.getItem("XEN_TaggerGroupInIndentedViewOnly")}),Object.freeze(n)}),define("DS/ENOXEngineer/componentsHelpers/xEngExport/js/ExportProgressDialog",["DS/Windows/Dialog","DS/Controls/ProgressBar","DS/Controls/ModalContainer","DS/Windows/ImmersiveFrame"],function(e,t,n,i){"use strict";function r(r){this.options=r||{},this.options=Object.assign({width:230,height:45,progressBar:{displayStyle:"lite",infiniteFlag:!0},renderTo:document.body},this.options),this.elements={},this.elements.immframe=new i,this.elements.immframe.getContent().addClassName("enox-export-progressive-immframe"),this.elements.progressBar=new t(this.options.progressBar),this.elements.dialog=new e({immersiveFrame:this.elements.immframe,title:this.options.title,content:this.elements.progressBar.getContent(),closeButtonFlag:!1,width:this.options.width,height:this.options.height,showTitleFlag:!1}),this.elements.dialog.getContent().setStyle("z-index",void 0),n.createModal(this.options.target,this.elements.immframe.getContent()),this.options.modalOpened=!0}return r.prototype.close=function(){delete this.elements.progressBar,this.options.modalOpened=!1,this.elements.dialog.destroy(),this.elements.dialog=null,delete this.elements.immframe,this.elements.immframe=null,n.removeModal(this.options.target)},r}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils",["UWA/Core"],e=>{return{status:{New:"New",Kept:"Kept",Removed:"Removed",Modified:"Modified"},statusColor:{New:"#368ec4",Kept:"",Removed:"#EA4F37",Modified:"#FFE902"},isNodeKeptStatus(e){return!!this.checkNodeValidity(e)&&e.options.grid.changeQuantityStatus},isNodeKept(e){return this.getNodeStatus(e,this.status.Kept)},isNodeModified(e){return this.getNodeStatus(e,this.status.Modified)},isNodeNew(e){return this.getNodeStatus(e,this.status.New)},isNodeRemove(e){return this.getNodeStatus(e,this.status.Removed)},getNodeStatus(e,t){if(!this.checkNodeValidity(e))return!1;const{status:n}=e.options.grid;return t?n===t:n},updateNodeOptions(e,t){if(!this.checkNodeValidity(e)||!t)return;const n=t,{grid:i}=n;i&&(Object.assign(e.options.grid,i),delete n.grid),Object.assign(e.options,n)},hasGridAttributeValued(t,n){if(!this.checkNodeValidity(t)||!n)return!1;const{grid:i}=t.options;return!!Reflect.has(i,n)&&(!!e.is(i[n])&&("string"!=typeof i[n]||0!==i[n].trim().length))},truncateOccurrencePathFromRefID(e,t){if(!Array.isArray(e)||!e.length)return null;if("string"!=typeof t||!t.trim().length)return e;const n=e.findIndex(e=>e===t);return-1===n?e:e.slice(n)},checkNodeValidity:t=>e.is(t)&&e.is(t.options)&&e.is(t.options.grid)}}),define("DS/ENOXEngineer/services/OccurrencesService",[],()=>{const e=",";class t{constructor(e){this._path=e}get path(){return this._path}_isPathEqual(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(const[n,i]of t.entries())if(e[n]!==i)return!1;return!0}isEqual({path:e}){return this._isPathEqual(e,this.path)}_computeId(t){return t.join(e)}get id(){return this._computeId(this.path)}}class n extends t{constructor(e){super(e.filter((e,t)=>t%2!=0)),this._xen_path=e}get xen_path(){return this._xen_path}getPath(e=!0){return e?this.xen_path:this.path}get id(){return this._computeId(this.xen_path)}isEqual({xen_path:e,path:t},n=!0){return this._isPathEqual(n?e:t,n?this.xen_path:t)}}return{Occurrence:t,XENOccurrence:n,XENOccurrencesBag:class extends Array{constructor(e){if(super(),UWA.is(e)&&Array.isArray(e)){const t=e.map(e=>new n(e));this.push(...t)}}getXENOccurrencefromOccurrencePath(e){const n=new t(e),i=this.findIndex(e=>n.isEqual(e));return-1===i?(console.error("dont find the occurrence {} from the XENOccurrencesBag",e),null):this[i]}},OccPathSep:e}}),define("DS/ENOXEngineer/componentsHelpers/ENOXCustomizeView/js/CustomizeView",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/UIKIT/Input/Select","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","text!DS/ENOXEngineer/componentsHelpers/ENOXCustomizeView/html/CustomizeView.html","css!DS/ENOXEngineer/componentsHelpers/ENOXCustomizeView/css/CustomizeView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";UWA.debug=!0;p=t.compile(p);return e.extend({name:"xapp-cutomize-view",_dialog:null,className:function(){return this.getClassNames("-container")},setup:function(e){this._parent(e),this.contentSection=this._buildContent(),this.footerSection=this._buildFooter()},render:function(){return this.custoModal=new i({className:"customize-view-dialog",closable:!0,header:this.options.header,body:this.contentSection,footer:this.footerSection}).inject(widget.body).show(),this},_buildFooter:function(){var e=this,t=[];e.visibleViews=[],e.flag=0;for(var n=0;n<e.options.views.length;n++)e.visibleViews.push({text:e.options.views[n]});var i=new o({name:"okButton",value:e.options.buttons[1],className:"primary",events:{onClick:e._savingChanges.bind(e)}});return t.push(i),t.push(new o({name:"cancelButton",value:e.options.buttons[0],className:"default cancel",events:{onClick:function(){e.custoModal.destroy()}}})),t},_savingChanges:function(){var e={},t=this.options.customizedViews,n={};this.typeObj={};var i=this.currentView.getValue();1===this.flag&&this.visibleViews.push({text:i});for(var r=0;r<this.options.types.length;r++)this.typeObj[this.options.types[r].typeNls]=this.options.types[r].typeName;var o=[],s=[];if("VPMReference"===this.typeObj[this.selectType.getValue()[0]]){for(r=0;r<this.tree1.getRoots().length;r++)o.push(this.mappingObj[this.tree1.getNthRoot(r).options.label]),n[this.setType]={visibleAttr:o};s=this.options.customizedViews.Untitled&&"VPMReference"===this.setType&&this.options.customizedViews.Untitled.Document?this.options.customizedViews.Untitled.Document.visibleAttr:this.options.defaultAttributesDoc,n.Document={visibleAttr:s}}else{for(r=0;r<this.tree1.getRoots().length;r++)s.push(this.mappingObjDoc[this.tree1.getNthRoot(r).options.label]),n[this.setType]={visibleAttr:s};o=this.options.customizedViews.Untitled&&"Document"===this.setType&&this.options.customizedViews.Untitled.VPMReference?this.options.customizedViews.Untitled.VPMReference.visibleAttr:this.options.defaultAttributesEI,n.VPMReference={visibleAttr:o}}t[i]=n,t.type=this.setType,e.savedSettings=t,e.ctxView=i,this.options.onSubmitCallBack(e),this.custoModal.destroy()},_buildContent:function(){var e=this;e.check=0,e.mainAttrObj={},e.mainAttrObjDoc={},e.mappingObj={},e.mappingObjDoc={};for(var t=0;t<e.attributes.availableEI.length;t++)e.mainAttrObj[e.attributes.availableEI[t].sixWTag]=e.attributes.availableEI[t].attrNls,e.mappingObj[e.attributes.availableEI[t].attrNls]=e.attributes.availableEI[t].sixWTag;for(t=0;t<e.attributes.availableDoc.length;t++)e.mainAttrObjDoc[e.attributes.availableDoc[t].sixWTag]=e.attributes.availableDoc[t].attrNls,e.mappingObjDoc[e.attributes.availableDoc[t].attrNls]=e.attributes.availableDoc[t].sixWTag;var n=UWA.createElement("div",{class:"customise-view-body"});UWA.createElement("div",{class:"customized-views"}).inject(n);e._buildText();var i=[];for(t=0;t<e.options.views.length;t++)i.push({text:e.options.views[t],id:e.options.views[t]});e.availableTypes=[],e.displayTypes=[];for(t=0;t<e.options.types.length;t++)e.availableTypes.push(e.options.types[t].typeName);"Document"===e.options.customizedViews.type?(e.setType="Document",e.displayTypes.push({id:e.options.types[1].typeName,value:e.options.types[1].typeNls,selected:!0}),e.displayTypes.push({id:e.options.types[0].typeName,value:e.options.types[0].typeNls})):(e.setType="VPMReference",e.displayTypes.push({id:e.options.types[1].typeName,value:e.options.types[1].typeNls}),e.displayTypes.push({id:e.options.types[0].typeName,value:e.options.types[0].typeNls,selected:!0})),e.typeCountContainer=UWA.createElement("div",{class:"type-selection-display-container"}).inject(n);var r=UWA.createElement("div",{class:"type-selection-display"}).inject(e.typeCountContainer),o=(UWA.createElement("h5",{class:"type-text",text:e.options.titles.viewType}).inject(r),UWA.createElement("div",{class:"combo-box"}).inject(r));return e.selectType=new a({custom:!1,className:"combo-box",placeholder:!1,options:e.displayTypes}),e.selectType.inject(o),console.log(e.selectType),e.selectType.addEvent("onChange",function(t,n){e.selectType.getValue()[0]===e.options.types[0].typeNls?(e.select=!0,e.setType="VPMReference",e._buildVisibleList(),e._buildAvailableList(e.attributes.availableEI)):(e.select=!1,e.setType="Document",e._buildVisibleList(),e._buildAvailableList(e.attributes.availableDoc))}),this.attributeSection=UWA.createElement("div",{class:"attribute-display"}).inject(n),e._buildVisibleList().inject(this.attributeSection),e._updateLimitCount(e.tree1.getRoots().length).inject(e.typeCountContainer),e._buildButtons().inject(this.attributeSection),e.selectType.getValue()[0]===e.options.types[0].typeNls?e._buildAvailableList(e.attributes.availableEI).inject(this.attributeSection):e._buildAvailableList(e.attributes.availableDoc).inject(this.attributeSection),n},_buildButtons:function(){var e=this;e.buttonSection=UWA.createElement("div",{class:"button-section"}),e.buttonInput1=new o({name:"moveup",icon:"expand-up",className:"default button-move-up",events:{onClick:function(t){for(var n=e.tree2.getRoots().length,i=0;i<n;i++)if(e.tree2.getManager().getDocument()._trueRoot.options.children[i]&&!0===e.tree2.getManager().getDocument()._trueRoot.options.children[i]._isSelected){if(!(e.tree1.getRoots().length<e.options.maxAttributes))return void d.errorAlert(u.get("error.maxAttributesReached"));this.enable(),e.attributes.visible.push(e.tree2.getNthRoot(i).options.id),e.tree1.addRoot(e.tree2.getNthRoot(i)),n--,i--,e.tree1.getRoots().length===e.options.maxAttributes&&this.disable(),e._updateLimitCount(e.tree1.getRoots().length)}}}}).inject(e.buttonSection);new o({name:"movedown",icon:"expand-down",className:"default button-move-down",events:{onClick:function(){for(var t=0;t<e.attributes.visible.length;t++)e.tree1.getManager().getDocument()._trueRoot.options.children[t]&&!0===e.tree1.getManager().getDocument()._trueRoot.options.children[t]._isSelected&&(e.attributes.visible.splice(t,1),e.tree2.addRoot(e.tree1.getNthRoot(t)),t--,e.tree1.getRoots().length<e.options.maxAttributes&&(e.buttonInput1.enable(),e._updateLimitCount(e.tree1.getRoots().length)))}}}).inject(e.buttonSection);return e.buttonSection},_updateLimitCount:function(e){var t=u.get("no_of_visible_count_display").replace("{no}",e).replace("{limit}",this.options.maxAttributes);if(UWA.extendElement(this.typeCountContainer).getElement(".count-display"))UWA.extendElement(this.typeCountContainer).getElement(".count-display").setText(t);else var n=UWA.createElement("div",{class:"count-display",text:t});return n},_buildText:function(){this.textSection=UWA.createElement("div",{class:"text-section"});UWA.createElement("h5",{class:"view-text",text:this.options.titles.viewName}).inject(this.textSection);var e=UWA.createElement("div",{class:"view-input-text-container"}).inject(this.textSection),t=this.options.ctxView?this.options.ctxView:"Untitled";return this.currentView=new r({className:"view-input-text",value:t}).inject(e),this.currentView.disable(),this.textSection},_buildVisibleList:function(){var e;UWA.extendElement(this.attributeSection).getElement(".visible-attributes")?(e=UWA.extendElement(this.attributeSection).getElement(".visible-attributes")).empty():e=UWA.createElement("div",{class:"visible-attributes"});var t=this.currentView.getValue();this.options.customizedViews.type||this.setType||(this.setType="VPMReference");var n=[];if(this.options.customizedViews[t]&&this.options.customizedViews[t][this.setType]){if("VPMReference"===this.setType)var i=0!==this.options.customizedViews[t][this.setType].visibleAttr.length?this.options.customizedViews[t][this.setType].visibleAttr:this.options.defaultAttributesEI;else if("Document"===this.setType)i=0!==this.options.customizedViews[t][this.setType].visibleAttr.length?this.options.customizedViews[t][this.setType].visibleAttr:this.options.defaultAttributesDoc}else if("VPMReference"===this.setType)i=this.options.defaultAttributesEI;else i=this.options.defaultAttributesDoc;this.visibleAttrs=[];for(var r=0;r<i.length;r++)this.visibleAttrs.push(i[r]),this.attributes.visible.push(i[r]),"Document"===this.setType?n.push({id:i[r],label:this.mainAttrObjDoc[i[r]]}):n.push({id:i[r],label:this.mainAttrObj[i[r]]});return this._updateLimitCount(n.length),this.tree1=new l({columns:[{dataIndex:"selection",type:"selection",isHidden:!1},{dataIndex:"tree",text:this.options.titles.vTitle,height:"auto",width:"auto",isEditable:!0,isSortable:!0}],selection:{unselectAllOnEmptyArea:!0,canMultiSelect:!0},roots:n}).inject(e),e},_buildAvailableList:function(e){var t,n=this;UWA.extendElement(n.attributeSection).getElement(".available-attributes")?(t=UWA.extendElement(n.attributeSection).getElement(".available-attributes")).empty():t=UWA.createElement("div",{class:"available-attributes"});for(var i=[],r=[],o=0;o<e.length;o++)r[o]=e[o];n.visibleAttrs.length;r=r.filter(function(e,t){return!(-1!==n.visibleAttrs.indexOf(e.sixWTag))});for(o=0;o<r.length;o++)i.push({id:r[o].sixWTag,label:r[o].attrNls});return n.tree2=new l({columns:[{dataIndex:"selection",type:"selection",isHidden:!1},{dataIndex:"tree",text:n.options.titles.aTitle,width:"auto",isEditable:!0,isSortable:!0}],selection:{unselectAllOnEmptyArea:!0,canMultiSelect:!0},roots:i}).inject(t),t}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitGroupModes",[],()=>{class e{static groupUnitIndexesNone(e){return Array.from(e.keys()).sort((e,t)=>e-t).map(t=>{return{key:e.get(t).length,value:[t]}})}static groupUnitIndexesByQuantity(e){const t=Array.from(e.keys()).sort((e,t)=>e-t),n=new Map;return t.forEach(t=>{const i=e.get(t).length;n.has(i)?n.get(i).push(t):n.set(i,[t])}),Array.from(n.keys()).sort((e,t)=>e-t).map(e=>{return{key:e,value:n.get(e)}})}static isUnitNextContinous(e,t){if(!Array.isArray(t)||!t.length||!Number.isInteger(e))return!1;return e===t[t.length-1]+1}static groupUnitIndexesByNextQuantity(t){const n=[];let i=null;return Array.from(t.keys()).sort((e,t)=>e-t).forEach(r=>{const o=t.get(r).length;i?i.key===o&&e.isUnitNextContinous(r,i.value)?i.value.push(r):(n.push(i),i={key:o,value:[r]}):i={key:o,value:[r]}}),n.push(i),n}}return e}),define("DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite",["i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/Core/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Utils/Client","DS/UIKIT/Spinner","css!DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r,o,s){"use strict";return n.extend(i,r,{name:"dnd_invite",defaultOptions:{mode:"dynamic",invites:{drop:{nls:"drop",icon:"drag-drop"},insert:{icon:"plus",nls:"insert"}},active_invite:"drop",isTouchActivated:!1},init:function(e){this._parent(e),this.options.isTouchActivated=o.Features.touchEvents&&!o.Features.pointerEvents,this.options.isTouchActivated&&(this.options.invites.drop={nls:"drop",icon:"touch"}),this._createDynamicInvite()},_createDynamicInvite:function(){if(this.elements.container=UWA.createElement("div",{class:this.getClassNames("_container")}),this.options.isTouchActivated){this.elements.container.className+=" touch_look",this.elements.container.style.pointerEvents="auto",this.elements.container.addEventListener("touchend",function(e){})}for(var t=Object.getOwnPropertyNames(this.options.invites),n=0;n<t.length;n++){var i=t[n];this.elements.container[i]=UWA.createElement("div",{class:this.getClassNames("_display "+i),draggable:!1}),"add_in_context"===i?(new s({className:"large"}).inject(this.elements.container[i]).show(),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+i),text:e["DropInvit_"+this.options.invites[i].nls]}).inject(this.elements.container[i])):(UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-"+this.options.invites[i].icon)}).inject(this.elements.container[i]),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+i),text:e["DropInvit_"+this.options.invites[i].nls]}).inject(this.elements.container[i])),this.elements.container[i].inject(this.elements.container),this.options.active_invite!==i&&this.elements.container[i].hide()}this.getOption("renderTo")&&this.elements.container.inject(this.getOption("renderTo"))},removeBorder:function(){this.elements.container.addClassName("no-border")},addBorder:function(){this.elements.container.removeClassName("no-border")},show:function(e){this.options.active_invite!==e&&(UWA.is(e,"string")?(this.options.active_invite!==e&&""!==this.options.active_invite&&this.elements.container[this.options.active_invite].hide(),this.options.active_invite=e):this.options.active_invite="drop",this.elements.container[this.options.active_invite].show(),this.elements.container.show(),this.dispatchEvent("toggleInvite",!0))},hide:function(e){UWA.is(e,"string")?""!==this.options.active_invite&&this.options.active_invite===e&&(this.elements.container[this.options.active_invite].hide(),this.elements.container.hide()):""!==this.options.active_invite&&(this.elements.container[this.options.active_invite].hide(),this.elements.container.hide()),this.options.active_invite="",this.dispatchEvent("toggleInvite",!1)}})}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel",["UWA/Core","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Controls/TooltipModel","DS/Controls/Expander","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel.css"],(e,t,n,i,r,o,s,a)=>{return class{constructor(t){this.appCore=t.appCore,e.is(t.onContextualEvent)&&(this.onContextualEvent=t.onContextualEvent);const n=s.compile(a),i=e.createElement("div",{html:n()});this._container=i.getElement(".material-list-panel"),this._buildSkeleton()}get content(){return this._container}get isEmpty(){return this.isReferenceEmpty&&this.isPartialEmpty}get isReferenceEmpty(){return!this._matTreeModel.getRoots().length}get isPartialEmpty(){return!this._matPartialTreeModel.getRoots().length}get length(){return this._matTreeModel.getRoots().length+this._matPartialTreeModel.getRoots().length}empty(){this._matTreeModel.empty(),this._matPartialTreeModel.empty(),this.updateViewElements()}hide(){this._container.hide()}show(){this._container.show()}fill(t){t.forEach(t=>{const n=this._buildTreeNode(t);e.is(t.matDBInfos)&&Object.defineProperty(n,"matDBInfos",{get:function(){return t.matDBInfos}}),e.is(t.partial)?this._matPartialTreeModel.addRoot(n):this._matTreeModel.addRoot(n)}),this.updateViewElements()}_buildTreeNode(t){const i={label:(()=>{const n=[];e.is(t.partial)&&n.push(`[${this.appCore.i18nManager.get("partial")}]`);const i=t["ds6w:label"];return n.push(i),n.join(" ")})(),icons:t.icons,thumbnail:t.thumbnail,subLabel:(()=>{const n=[];return["type","ds6wg:revision","ds6w:status","ds6w:responsible","ds6w:identifier"].forEach(i=>{const r=e.is(t[i])?t[i]:"";""!==r&&n.push(r)}),n.join(" | ")})(),description:(()=>{const n=[];if(e.is(t.context)){const e=`${t.context.V_Name} ${t.context.revision}`;n.push(`${this.appCore.i18nManager.get("context")}: ${e}`)}return n.join(" ")})(),emptyStatusbarVisibleFlag:!0,activeFlag:!1};let o=null;if(e.is(t.partial)||e.is(t.context)){const n=[];if(e.is(t.partial)){const e=(({label:e,is_penetrating:t})=>{const n=this.appCore.i18nManager.get("partial"),i=this.appCore.i18nManager.get("penetrating");return`[${n}]: ${e} ${t?i:""}`})({label:`${t.partial.support.V_Name} ${t.partial.support.revision}`,is_penetrating:t.partial.is_penetrating});n.push(e)}if(e.is(t.context)){const e=(({label:e})=>`[${this.appCore.i18nManager.get("context")}]: ${e}`)({label:`${t.context.V_Name} ${t.context.revision}`});n.push(e)}o={shortHelp:t["ds6w:label"],longHelp:n.join("\n")}}if(o){const e=new r(o);i.customTooltip=e}else i.customTooltip=null;return e.is(this.onContextualEvent)&&e.is(t.menuEntry)&&(i.contextualMenu=[t.menuEntry]),new n(i)}_buildSkeleton(){this._buildMaterialListSkeleton(),this._buildPartialMaterialListSkeleton()}_buildMaterialListSkeleton(){const n=new i({class:"material_tiles_view",displayedOptionalCellProperties:["description","contextualMenu"]});e.is(this.onContextualEvent)&&(n.onContextualEvent={callback:this.onContextualEvent}),this._matTreeModel=new t,n.model=this._matTreeModel;const r=e.createElement("div",{class:"material-tilesView-div"});n.getContent().inject(r);const o=this.content.getElement(".material-list");r.inject(o),this._addElementToUpdateList(o,()=>{const e=this._matTreeModel.getRoots().length;this._updateContentSize(r,e),e?o.show():o.hide()})}_buildPartialMaterialListSkeleton(){const n=new i({class:"material_tiles-view",displayedOptionalCellProperties:["description","contextualMenu"]});e.is(this.onContextualEvent)&&(n.onContextualEvent={callback:this.onContextualEvent}),this._matPartialTreeModel=new t,n.model=this._matPartialTreeModel;const r=e.createElement("div",{class:"material-partial-tilesView-div"});n.getContent().inject(r),this._appliedOnShapeHeader=this.appCore.i18nManager.get("materialFacet.appliedOnShape");const s=this.content.getElement(".material-partial-list");new o({style:"simple",header:this._appliedOnShapeHeader,body:r,expandedFlag:!1,icon:{iconName:"3dpart",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(s),this._addElementToUpdateList(s,()=>{const e=this._matPartialTreeModel.getRoots().length;this._updateContentSize(r,e),s.getElement(".headerTitle").setText(`${this._appliedOnShapeHeader} (${e})`),e?s.show():s.hide()})}_addElementToUpdateList(e,t){Array.isArray(this._updateEltList)||(this._updateEltList=[]),e[Symbol.for("updateView")]=t,this._updateEltList.push(e)}_updateContentSize(e,t){let n=10;t&&(n=(1===t?110:100)*t),e.setStyle("height",`${n}px`)}updateViewElements(){this._updateEltList.forEach(e=>{e[Symbol.for("updateView")]()})}}}),define("DS/ENOXEngineer/utils/PlatformDataProvider",["UWA/Core","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,n){"use strict";return{getAllPlatforms:function(){return new t(function(t,i){n.getPlatformServices({onComplete:function(n){var r=function(t){if(e.is(t,"array")&&t.length>0){var n={};return t.forEach(function(e){n[e.platformId]=e}),n}return null}(n);if(null===r)return i("cannot retrieve platform data");t(r)},onFailure:i})})},getCurrentUser:function(){return new t(function(e,t){n.getUser({onComplete:function(t){e({id:t.id,email:t.email,firstName:t.firstname,lastName:t.lastname})},onFailure:t})})},loadCurrentUserRoles:function(){return new t(function(e,t){n.getGrantedRoles(function(t){e(t)})})}}}),define("DS/ENOXEngineer/commands/MaterialFacet/ENOXMaterialCommandManager",["UWA/Core","DS/CoreEvents/Events","DS/ENOXEngineerCommonUtils/XENTracker","text!DS/ENOXEngineer/assets/config/MaterialFacet/Commands.json","text!DS/ENOXEngineer/assets/config/MaterialFacet/MenuInfos.json","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],(e,t,n,i,r,o)=>{const s=new class{constructor(){this.commandList=[]}get menuInfosJson(){return JSON.parse(r)}get commandsJson(){return JSON.parse(i)}getMenu({menuEntry:e,menuOptions:t}){const n=this.getTemplateMenu(e);return this.buildMenu({menuTemplate:n,menuOptions:t})}getTemplateMenu(e){return Object.getOwnPropertyNames(this.menuInfosJson.templates).findIndex(t=>t==e)>=0?this.menuInfosJson.templates[e]:[]}getCommandDesc(e){return Object.getOwnPropertyNames(this.commandsJson).findIndex(t=>t==e)>=0?this.commandsJson[e]:null}getNls(e){const t=Object.getOwnPropertyNames(o).findIndex(t=>t==e);return t<0&&console.error(`ENOXMaterialCommandManager -> missing nls entry ${e}`),t>=0?o[e]:null}getCommandCtr({commandHdr:e,AmdLoader:t}){return new Promise((e,n)=>{require([t],t=>e(t))})}buildMenu({menuTemplate:t,menuOptions:n}){return t.map(t=>{if("command"===t.type){const i=this.getCommandDesc(t.ID);return{title:this.getNls(i.nls_key),type:"PushItem",fonticon:{family:"DSFontIcon",content:`wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-${i.fonticon}`},action:{this:this,callback:function(){e.is(n)&&e.is(n.onMenuItemClicked)&&n.onMenuItemClicked(i.commandHdr)}}}}if("separator"===t.type)return{type:"SeparatorItem"}})}get startedCommands(){return this.commandList}executeCommand({commandHeader:i,cmdOptions:r}){const o=this.getCommandDesc(i);if(!e.is(o))throw console.error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`),new Error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`);this.startedCommands.filter(e=>e._id===i).forEach(e=>e.cancel()),this.getCommandCtr(o).then(i=>{n.trackCommandLaunched(o.commandHdr);const s=new i({ID:o.commandHdr,...r}),a=[];e.is(r)&&Reflect.has(r,"onBegin")&&a.push(s.onBegin(r.onBegin)),e.is(r)&&Reflect.has(r,"onExecute")&&a.push(s.onExecute(r.onExecute)),a.push(s.onEnd(n=>{e.is(r)&&Reflect.has(r,"onEnd")&&r.onEnd(n),a.forEach(e=>t.unsubscribe(e));const i=this.startedCommands.findIndex(e=>e._id===n._id);-1!==i&&this.startedCommands.splice(i,1)})),this.startedCommands.push(s),s.begin()}).catch(e=>{throw console.error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`),new Error(`error: ENOXMaterialCommandManager/launchCommand failed to instanciate command Ctr ${i}`)})}};return Object.freeze(s),s}),define("DS/ENOXEngineer/services/MaterialExceptions",["i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],e=>{class t extends TypeError{}class n extends RangeError{}class i extends Error{constructor(t){let n=null;UWA.is(t.response)&&UWA.is(t.response.message)&&(n=t.response.message,UWA.is(t.response)&&UWA.is(t.response.internal)&&"no right access"===t.response.internal.toLowerCase()&&(n=`${e["error.ERR_RightAccess"]}`)),super(n)}}return{MaterialError:class{static isAMaterialError(e){return e instanceof t||e instanceof n||e instanceof i}},MaterialTypeError:t,MaterialSamePidError:n,MaterialServerError:i}}),define("DS/ENOXEngineer/utils/expand/ProgressiveExpand",["UWA/Core"],e=>{const t={utils:{}},n=(e,t)=>{if(typeof e!==t)throw new Error("wrong type value")};t.utils={checkValueWithType:n,...t.utils};const i=(e,t)=>{if(!Array.isArray(e))throw new Error("expecting an array value");e.forEach(e=>{n(e,t)})};t.utils={checkArrayValuesWithType:i,...t.utils};const r=(e,t)=>{if(!(e instanceof t))throw new Error("wrong type value")};t.utils={checkInstanceWithType:r,...t.utils};const o=(e,t)=>{if(!Array.isArray(e))throw new Error("expecting an array value");e.forEach(e=>{r(e,t)})};t.utils={checkArrayInstancesWithType:o,...t.utils};const s=e=>{const t=typeof e;return"string"===t&&("number"===e||"string"===e||"boolean"===e)||"function"===t},a=(t,i,o,a=null)=>{if(!e.is(t)||"string"!=typeof i||!e.is(o))throw new Error("invalid input");if(!1===s(o))throw new Error("invalid type");const l=`_${i}`;Object.defineProperty(t,i,{get:()=>(e.is(t[l])||(e.is(a)?t[l]=a():t[l]=null),t[l]),set(e){const i=typeof o;if("string"!==i||"number"!==o&&"string"!==o&&"boolean"!==o){if("function"!==i)throw new Error(`invalid type '${i}'`);r(e,o)}else n(e,o);t[l]=e}})};t.utils={declareValueProperty:a,...t.utils};const l=(t,n,r)=>{if(!e.is(t)||"string"!=typeof n||!e.is(r))throw new Error("invalid input");if(!1===s(r))throw new Error("invalid type");const a=`_${n}`;Object.defineProperty(t,n,{get:()=>(e.is(t[a])||(t[a]=[]),t[a]),set(e){const n=typeof r;if("string"!==n||"number"!==r&&"string"!==r&&"boolean"!==r){if("function"!==n)throw new Error(`invalid type '${n}'`);o(e,r)}else i(e,r);t[a]=e}})};t.utils={declareArrayValueProperty:l,...t.utils};class c{getImplKeys(){return Reflect.ownKeys(this).filter(e=>"string"==typeof e&&e.startsWith("_"))}getImplKey(e){const t=`_${e}`;return-1!==this.getImplKeys().indexOf(t)?this[t]:null}get json(){const t={};return this.getImplKeys().forEach(n=>{const i=n.slice(1);if(Reflect.has(this,n)){const r=this[n];if(Array.isArray(r)&&r.length){const e=r[0];t[i]=e instanceof c?r.map(e=>e.json):r}else r instanceof c?t[i]=r.json:e.is(r)&&(t[i]=r)}}),t}}t.utils={Base:c,...t.utils};class d extends c{constructor(){super(),l(this,"path","number"),l(this,"physical_id_path","string")}}t.Path=d;class u extends c{constructor(){super(),a(this,"id","number"),a(this,"physical_id","string")}}t.Physical_Object=u;class p extends c{constructor(){super(),a(this,"ellql","string"),a(this,"uql","string"),a(this,"uql_prefix_handler","string")}}t.Graph_Expression=p;class g extends c{constructor(){super(),a(this,"descending_condition",p,()=>new p),a(this,"descending_condition_object",p,()=>new p),a(this,"descending_condition_relation",p,()=>new p)}}t.Graph=g;class h extends c{}t.Matrices_Overload=h;class m extends c{constructor(){super(),l(this,"prefix_path",d)}}t.Prefix_Filter=m;class f extends c{constructor(){super(),a(this,"name","string"),a(this,"mode","string"),a(this,"synthesis_only","number"),a(this,"limit","number"),a(this,"group_by_facet","number")}}t.Synthesis=f,t.ENUM_FACET_MODE={flat:"flat",tree_leaf:"tree_leaf",tree_leaf_instance:"tree_leaf_instance",occurrence:"occurrence",matching_occurrence:"matching_occurrence"};class E extends c{constructor(){super(),a(this,"ellql","string"),a(this,"uql","string"),a(this,"uql_prefix_handler","string")}}t.Materials=E;class C extends c{constructor(){super(),a(this,"left",v,()=>new v),a(this,"right",v,()=>new v)}}t.And_Not=C;class _ extends c{constructor(){super(),l(this,"filters",v,()=>new v)}}t.And=_;class y extends c{constructor(){super(),l(this,"filters",v,()=>new v)}}t.Or=y;class M extends c{constructor(){super(),l(this,"predefined_computation","string")}}t.Hits=M;class N extends c{constructor(){super(),l(this,"sequence",p)}}t.SequenceFilter=N;t.BeginSequenceFilter=class extends N{get json(){const e=super.json,{sequence:t}=e||{};return Array.isArray(t)&&t.length&&t.splice(0,0,{statement:"BEGIN"}),e}};t.EndSequenceFilter=class extends N{get json(){const e=super.json,{sequence:t}=e||{};return Array.isArray(t)&&t.length&&t.push({statement:"END"}),e}};t.AllSequenceFilter=class extends N{get json(){const e=super.json,{sequence:t}=e||{};return Array.isArray(t)&&1===t.length&&t.splice(0,0,{statement:"ALL"}),e}};t.NextSequenceFilter=class extends N{get json(){const e=super.json,{sequence:t}=e||{};return Array.isArray(t)&&2===t.length&&t.splice(1,0,{statement:"NEXT"}),e}};class v extends c{constructor(){super(),a(this,"and",_,()=>new _),a(this,"or",y,()=>new y),a(this,"sequence_filter",N),a(this,"all","number"),a(this,"config_filter","string"),a(this,"config_filter_id",u,()=>new u),a(this,"referenced","string"),a(this,"and_not",C,()=>new C),a(this,"prefix_filter",m,()=>new m)}}t.Filter=v;class I extends c{constructor(){super(),a(this,"max_distance_from_prefix","number"),a(this,"compute_matching_subpaths_lengths","number"),a(this,"match_only_refs","number"),a(this,"and",_),a(this,"or",y),a(this,"and_not",C),a(this,"prefix_filter",m),a(this,"sequence_filter",N),a(this,"referenced","string"),a(this,"all","number")}}t.Truncate=I;class A extends c{constructor(){super(),a(this,"truncate",I,()=>new I),a(this,"synthesis",f,()=>new f),a(this,"materials",E,()=>new E)}}t.Aggregation_Processor=A;class b extends c{constructor(){super(),l(this,"select_object","string"),l(this,"select_relation","string"),l(this,"select_material","string"),l(this,"select_pgp","string"),l(this,"synthesis","string"),l(this,"filter_facets","string"),a(this,"facet_name","string"),a(this,"matching_lengths","number"),a(this,"format","string"),a(this,"hits",M,()=>new M)}}t.Outputs=b,t.ENUM_OUTPUT_FORMAT={entity_relation:"entity_relation",entity_relation_occurrence:"entity_relation_occurrence",entity_relation_occurrence_label:"entity_relation_occurrence_label"};class S extends c{}t.NamedFilters=S;class T extends c{constructor(){super(),a(this,"limit_max_path","number"),a(this,"limit_timeout_in_ms","number")}}t.Param=T;class D extends c{constructor(){super(),a(this,"label","string"),a(this,"root",u,()=>new u),a(this,"graph",g,()=>new g),a(this,"filter",v,()=>new v),a(this,"parameters",T,()=>new T),l(this,"aggregation_processors",A),l(this,"matrices_overloads",h)}}t.Expand=D;class w extends c{constructor(){super(),l(this,"expands",D)}}t.Batch=w;return t.Query=class extends c{constructor(){super(),a(this,"batch",w,()=>new w),a(this,"outputs",b,()=>new b),a(this,"namedFilters",S,()=>new S)}},t}),define("DS/ENOXEngineer/services/PersistencyManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("PersistencyManager manager initializing");e.core.PersistencyManager=e.sandboxBase.PersistencyManager=this,this.app=e,this._isWidgetRefreshing=null},saveUserSelectedNodes:function(e){var t=[];e.forEach(function(e){var n=e.buildNodeId?e.buildNodeId():null;n&&t.push(n)}),widget.setValue(i.USER_SELECTED_NODE_IDS,t)},saveUserSelectedNodeIDs:function(e){widget.setValue(i.USER_SELECTED_NODE_IDS,e)},getViewBasedIDForStorage:function(e){var t,n=this.app.core.localStorage.getItem(i.VALUE_QUANTITY_VIEW);return null==this.app.core.contextManager.getActiveEngItem()||n?t=e.getID():"function"==typeof e.getRelationID&&(t=e.getRelationID()),t},restoreView:function(e){var t=this.getUserSelectedNodeIDs();if(e.core.sessionManager.shouldShowLeafMaterials()||e.core.sessionManager.shouldShowFinalItems()||e.core.sessionManager.shouldShowFlatView())this.restoreSelection(e,t);else{let n=e.core.sessionManager.shouldShowQuantityView(),i=this.getFirstLevelSelectedIds(t,n);this.restoreSelection(e,i)}},getFirstLevelSelectedIds:function(e,t){if(Array.isArray(e)&&e.length>0){return e.filter(e=>{let n=e.split("/");return t?n.length<=2:n.length<=3})}return e},restoreSelection:function(e,t){Array.isArray(t)&&t.length>0&&e.findNodesByIds(t).forEach(function(e){e.select()})},restoreViewForHomePage:function(e,t){var n=this.getUserSelectedNodeIDs();Array.isArray(t)&&t.length>0&&(n=t),this.restoreSelection(e,n);var r=widget.getValue(i.IS_INFORMATION_PANEL_LAUNCHED_FOR_HOME_PAGE);this.restoreInformationPanel(r)},restoreInformationPanel:function(e){!0===e&&(this.restoreInformationPanelWidth(),this.app.core.mediator.publish(i.EVENT_TRIPTYCH_SHOW_PANEL,"right"),this.app.core.mediator.publish(i.EVENT_INFO_PANEL_VISIBLE))},getUserSelectedNodeIDs:function(){return widget.getValue(i.USER_SELECTED_NODE_IDS)},setInformationPanelStatus:function(e){widget.setValue(i.IS_INFORMATION_PANEL_LAUNCHED,e),!1===e&&this.resetInformationPanelWidth()},restoreInformationPanelForIdCard:function(e){if(widget.getValue(i.IS_INFORMATION_PANEL_LAUNCHED)){this.restoreInformationPanelWidth(),this.app.core.mediator.publish(i.EVENT_IDCARD_CUSTOM_INFORMATION_ICON);let t=e.getSelectedNodes().length>0?e.getSelectedNodes():[e.getEngineeringItem()];e.pushNodesToEditProperties(t)}},isIDCardMinified:function(){return widget.getValue(i.ID_CARD_MINIFICATION)!=i.ID_CARD_EXPAND},setIDCardMinificationsStatus:function(e){widget.setValue(i.ID_CARD_MINIFICATION,e)},setInformationPanelStatusForHomePage:function(e){widget.setValue(i.IS_INFORMATION_PANEL_LAUNCHED_FOR_HOME_PAGE,e),!1===e&&this.resetInformationPanelWidth()},setWidgetRefreshStatus:function(e){this._isWidgetRefreshing=e},getWidgetRefreshStatus:function(){return this._isWidgetRefreshing},restoreInformationPanelWidth:function(){const e=widget.getValue(i.INFORMATION_PANEL_WIDTH);"number"==typeof e&&e>0&&this.app.core.mediator.publish(i.EVENT_TRIPTYCH_SET_SIZE,{side:"right",size:e})},resetInformationPanelWidth:function(){widget.setValue(i.INFORMATION_PANEL_WIDTH,0)},setInformationPanelWidth:function(e){"number"==typeof e&&widget.setValue(i.INFORMATION_PANEL_WIDTH,e)},setNGFilterCmdLaunchState:function(e){widget.setValue(i.IS_NGFILTER_PANEL_LAUNCHED,e)},restoreNGFilterCmdLaunchSate:function(){!0===widget.getValue(i.IS_NGFILTER_PANEL_LAUNCHED)&&!1===this.app.core.contextManager.isRunningCmd(i.LAUNCH_NG_FILTER_CMD)&&this.app.core.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.LAUNCH_NG_FILTER_CMD,context:{}})},getNGFilter:function(){return widget.getValue("NGFilter")},setNGFilter:function(e){widget.setValue("NGFilter",e)},resetNGFilter:function(){widget.deleteValue("NGFilter")},setGroupByOption:function(e){widget.setValue(i.GROUPBY_OPTIONS,e)},getGroupByOption:function(){return widget.getValue(i.GROUPBY_OPTIONS)}})}),define("DS/ENOXEngineer/components/Triptych/TriptychWrapper",["DS/ENOXTriptych/js/ENOXTriptych","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Controls/Drag","css!DS/ENOXEngineer/components/Triptych/ENOXTriptych.css"],function(e,t,n,i){"use strict";function r(t){this.sandbox=t;var n={left:{resizable:!1,originalSize:300,originalState:"close",pushOnMobile:!0},right:{resizable:!0,originalSize:400,originalState:"close",pushOnMobile:!0},container:t.getContainer(),withtransition:!0,modelEvents:t.getApplicationBroker()};this.leftSideDiv=document.createElement("div"),this.leftSideDiv.classList.add("triptych-panel-wrapper"),this.centerDiv=document.createElement("div"),this.centerDiv.classList.add("triptych-panel-wrapper"),this.rightDiv=document.createElement("div"),this.rightDiv.classList.add("triptych-panel-wrapper"),this.rightDiv.classList.add("triptych-right-panel-wrapper"),this.triptych=new e,this.triptych.init(n,this.leftSideDiv,this.centerDiv,this.rightDiv),this.mainDiv=document.createElement("div"),this.mainDiv.classList.add("xen-main-panel-wrapper"),this.centerDiv.appendChild(this.mainDiv)}return r.prototype.start=function(){var e=this;const r=!0===e.sandbox.core.dataService.getUserWorkUnderShowPref()?"show":"hide";let o=e.sandbox.core.dataService.getUserWorkUnderPositionPref();o===n.CHANGECONTROL_POSITION_FREE_VALUE&&(o=widget.getValue("changeControlFreeDefaultPosition")),t.initialize2(e.centerDiv,e.sandbox.core.settingManager.getAppId(),r,o,function(e){console.warn(e)},{isEditable:!0,isEvolution:!0,isChange:!0,isMovable:!0,resetDefault:!0});let s=()=>{e.bubbleDragControl||(e.bubbleDragControl=new i.Move({container:e.centerDiv,delegate:"#BubbleContainer > *",centerHandles:!0,handles:function(e){return e.target.getClosest("#BubbleContainer")},stop:function(){let t=e.centerDiv.querySelector("#BubbleContainer");if(t){const e=t.style.top,n=t.style.left;widget.setValues({"bubble-top":e,"bubble-left":n})}}}))},a=()=>{let e=this.centerDiv.querySelector("#BubbleContainer");if(e){const t=e.style.top,n=e.style.left;(t||n)&&e.setStyles({top:null,left:null})}widget.setValue("bubble-top",null),widget.setValue("bubble-left",null)},l=()=>{let e=this.centerDiv.querySelector("#BubbleContainer"),t=null;if(e){let n=e.className;if("string"==typeof n){const e="position-",i=0===n.indexOf(e)?n.substring(e.length,n.length):null;"string"==typeof i&&i.length&&(t=i)}}return t};if(widget){widget.addEvents({onRefresh:()=>{e.sandbox.core.dataService.getUserWorkUnderPositionPref()!==n.CHANGECONTROL_POSITION_FREE_VALUE&&a()},endEdit:()=>{e.sandbox.core.dataService.getUserWorkUnderShowPref()?t.show():t.hide();const i=e.sandbox.core.dataService.getUserWorkUnderPositionPref();if(i===n.CHANGECONTROL_POSITION_FREE_VALUE){const e=l();"string"==typeof e&&e.length&&widget.setValue("changeControlFreeDefaultPosition",e),s()}else a(),e.bubbleDragControl&&(e.bubbleDragControl&&e.bubbleDragControl.destroy(),e.bubbleDragControl=null),t.setPosition(i)}}),(t=>{if(t!==n.CHANGECONTROL_POSITION_FREE_VALUE)return;if(!widget)return;const i=widget.getValue("bubble-top"),r=widget.getValue("bubble-left");let o=e.centerDiv.querySelector("#BubbleContainer");o&&(i&&r&&o.setStyles({top:i,left:r}),s())})(e.sandbox.core.dataService.getUserWorkUnderPositionPref())}},r}),define("DS/ENOXEngineer/sessionBuilders/GroupSessionBuilder",["DS/ENOXEngineer/utils/XEngineerConstants"],e=>{return class{constructor(e){if(!e||!e.appCore||!e.models)throw console.error("missing options for SessionBuildersManager"),new Error;this.appCore=e.appCore,this.models=e.models,this.engItem=this.models.getEngineeringItem()}async registerContentfetcher(t,n){if(!t)throw new Error("invalid engItem");let i;if(n&&n[e.CONST_FIND_IN_CRITERIA])i=this.models.registerContentFetcher(this.models.addFindEngItemChildren(t,n),"addFindEngItemChildren --\x3e",this.engItem,n);else if(Array.isArray(t)){const r=[],o=[];t.forEach(e=>!0===e.isGroupingNode?r.push(e):o.push(e)),r.length&&(i=this.models.registerContentFetcher(this.models.expandGroupedEngItemChildren(r),"expandGroupedEngItemChildren [multiexpand] --\x3e")),o.length&&(i=this.models.registerContentFetcher(this.models.addChildren(o,n?n[e.CONST_TARGET_LEVEL]:void 0),"expand node"))}else i=this.models.registerContentFetcher(this.models.addGroupedEngItemChildren(),"expand group nodes");i.fetchHolisticContentDefiniton(),delete this.appCore,delete this.models,delete this.engItem}async retrieveAdditionalColumnProviders(){return!0}async buildSession(e){return this.registerContentfetcher(this.engItem,e),!0}}}),define("DS/ENOXEngineer/commands/DocumentManagementCmd",["UWA/Class","DS/ApplicationFrame/Command","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n,i){"use strict";return t.extend({init:function(e){this._parent(e)},execute:function(e){var t=this,r={};let o=t.options.appCore.settingManager.getPlatformId(),s=Array.isArray(t.options.context.getSelectedNodes())&&t.options.context.getSelectedNodes()[0];r.document={id:s.getID(),contextId:t.options.context.getSecurityContext().SecurityContext,serviceId:"3DSpace",envId:o,data:{id:s.getID(),title:s.getTitleForIdcard(),relName:"SpecificationDocument",parentDirection:"from",parentId:t.options.context.getContext().getParent(s).getID(),files:s.options.files}},r.platformUrls=t.options.context._app.core.settingManager._platforms[o],r.getWorkUnderHeaders=function(){return t.options.context._app.core.settingManager.getWorkUnderHeaders()},r.onComplete=function(e){t.options.context.getContext().refresh(e),e.result&&e.result.message&&i.sucessAlert(e.result.message)},r.onFailure=function(e){i.errorAlert(e.result.message)},require(["DS/DocumentCommands/ENOXDocumentCommands","DS/DocumentCommands/Constants"],function(e,i){let o=new e;o.init(r);let s=o.render();switch(t.options.ID){case n.REPLACE_BY_REVISION_DOCUEMNT_CMD:s[i.REPLACE_BY_REVISION].items[0].handler();break;case n.REPLACE_BY_LATEST_REVISION_DOCUEMNT_CMD:s[i.REPLACE_BY_REVISION].items[1].handler();break;case n.EDIT_DOCUMENT_CMD:s[i.EDIT].handler();break;case n.UPDATE_DOCUMENT_CMD:s[i.UPDATE].handler();break;case n.UNDO_EDIT_DOCUEMNT_CMD:s[i.UNDO_EDIT].handler()}})}})}),define("DS/ENOXEngineer/components/EngItemViewer/EngItemViewer",["UWA/Core","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXSplitViewVertical/js/ENOXSplitViewVertical","text!DS/ENOXEngineer/components/EngItemViewer/EngItemViewer.html","text!DS/ENOXEngineer/components/EngItemViewer/EngListWrapper.html","DS/ENOXEngineer/utils/XEngineerConstants","DS/Controls/ProgressBar","css!DS/ENOXEngineer/components/EngItemViewer/EngItemViewer.css"],function(e,t,n,i,r,o,s){"use strict";var a=110,l=38;return function(e){return{container:e.getContainer(),start:function(){var n=this;this.isStarted=!0,this._modelEvents=e.getApplicationBroker(),e.emptyContainer(),e.addContent(i),this._itemViewerWrapper=this.container.firstChild,this._initDivs(),this._initDataLoaderIndicator(),this._subscribeToEvents(),this._progressBarContainer=this.listViewContainer.getElement(".data-loader-progress-bar"),t.mask(UWA.extendElement(this.container));var r=!1;e.subscribe(o.EVENT_LIST_READY,function(){t.unmask(n.listViewContainer),t.unmask(n.container),r||(t.mask(UWA.extendElement(n.idCardContainer)),r=!0)}),e.subscribe(o.EVENT_IDCARD_READY,function(){t.unmask(UWA.extendElement(n.container)),t.unmask(UWA.extendElement(n.idCardContainer)),r||(t.mask(UWA.extendElement(n.listViewContainer)),r=!0)})},_initDataLoaderIndicator:function(){this.dataProgressBar=new s({displayStyle:"lite"}),this.dataProgressBar.__isInjected=!1},_subscribeToEvents:function(){var t=this;e.subscribe("content-loader-indicator-start",function(){t.dataProgressBar.value=10,t.dataProgressBar.__isInjected||(t.dataProgressBar.__isInjected=!0,t._progressBarContainer.setStyles({"margin-top":"-6px",height:"5px"}),t.dataProgressBar.inject(t._progressBarContainer))}),e.subscribe("content-loader-indicator-progress",function(e){t.dataProgressBar.value+=Math.ceil(e)}),e.subscribe("content-loader-indicator-completed",function(){t.dataProgressBar.value=99,setTimeout(function(){t.dataProgressBar.__isInjected&&(t.dataProgressBar.__isInjected=!1,t.dataProgressBar.remove(),t._progressBarContainer.setStyles({"margin-top":"0",height:"0"}))},100)}),e.subscribe("idcard-container-minimize-idcard",function(){e.publish("splitview-vertical-set-top-size",l),e.publish("idcard-minify")}),e.subscribe("idcard-container-maximize-idcard",function(){e.publish("splitview-vertical-set-top-size",a),e.publish("idcard-expand")}),e.subscribe("idcard-minified",function(){e.publish("splitview-vertical-set-top-size",l),e.core.PersistencyManager.setIDCardMinificationsStatus(o.ID_CARD_MINIFY),e.publish("idcard-minify"),e.publish(o.EVENT_SYNC_MATURITY_WITH_MODEL)}),e.subscribe("idcard-expanded",function(){e.publish("splitview-vertical-set-top-size",a),e.core.PersistencyManager.setIDCardMinificationsStatus(o.ID_CARD_EXPAND),e.publish("idcard-expand"),e.publish(o.EVENT_SYNC_MATURITY_WITH_MODEL)}),e.subscribe("splitview-vertical-resized",function(t){t===l?e.publish("idcard-container-minified"):t===a&&e.publish("idcard-container-maximized")})},_initDivs:function(){var t={withtransition:!0,withoverflowhidden:!0,sizeType:"px"};t.originalTop=e.core.PersistencyManager.isIDCardMinified()?l:a,t.modelEvents=this._modelEvents,this._ENOXSplitViewVertical=new n,this._ENOXSplitViewVertical.init(t),this._itemViewerWrapper.appendChild(this._ENOXSplitViewVertical.getContent()),this.idCardContainer=UWA.extendElement(this._ENOXSplitViewVertical.getContent().querySelector(".top-container")),this.listViewContainer=UWA.extendElement(this._ENOXSplitViewVertical.getContent().querySelector(".bot-container")),this.listViewContainer.innerHTML=r},stop:function(){this._ENOXSplitViewVertical.destroy(),e.emptyContainer(),e.stop(this)}}}}),define("DS/ENOXEngineer/components/XEngWelcomePanel/XEngWelcomePanel",["UWA/Core","DS/ENOXWelcomePanel/js/ENOXWelcomePanel","DS/ENOXEngineer/utils/XEngineerConstants","css!DS/ENOXEngineer/components/XEngWelcomePanel/XEngWelcomePanel.css"],function(e,t,n){"use strict";return function(e){var i=e.getContainer();const r=[],o=e.core.PreferencesManager.isUserSelectedTypeChooserOption(),s={id:"add_engItem",text:e.i18nManager.get("add_engItem"),fonticon:"fonticon fonticon-3dproduct-add",className:"action-new",isNotHighlightable:!0},a={id:"add_newPart",text:e.i18nManager.get("add_new_part"),fonticon:"fonticon fonticon-3dpart-add",className:"action-new",isNotHighlightable:!0},l={id:"add_newcontent",text:e.i18nManager.get("add_engItem"),fonticon:"fonticon fonticon-3dproduct-add",className:"action-new",isNotHighlightable:!0},c={id:"import_items",text:e.i18nManager.get("eng.import.label"),fonticon:"fonticon fonticon-import",className:"action-new",isNotHighlightable:!0};return o?r.push(l):r.push(s),r.push(a),r.push(c),{isFirstDrop:!0,mainContainer:null,myWelcomePanel:null,isStarted:!1,start:function(){var o={collapsed:!1,title:e.i18nManager.get("APP_NAME"),subtitle:e.i18nManager.get("APP_SUBTITLE"),notifications:[],activities:[{id:"activity_browsing",title:e.i18nManager.get("quick-access"),actions:[{id:"recent_items",text:e.i18nManager.get("recent_items"),fonticon:"clock",className:"action-new"},{id:"my_eng_items",text:e.i18nManager.get("my_eng_items"),fonticon:"product",className:"action-new",isDefault:!0},{id:"open_engItem",text:e.i18nManager.get("open_engItem"),fonticon:"open",className:"action-new",isNotHighlightable:!0}]},{id:"activity_creation",title:e.i18nManager.get("start-activity"),actions:r}],selectedItem:"my_eng_items",parentContainer:i,footer:[{id:"setting_pref",text:e.i18nManager.get("setting_pref"),fonticon:"tools",actions:[]}],modelEvents:e.getApplicationBroker()};this.myWelcomePanel=new t(o),this.myWelcomePanel.render(),e.subscribe(n.EVENT_TRIPTYCH_PANEL_VISIBLE,function(e){"left"===e&&(i.style.visibility="visible")}),e.subscribe(n.EVENT_TRIPTYCH_PANEL_HIDDEN,function(e){"left"===e&&(i.style.visibility="hidden")})},reRender:function(){},stop:function(){e.publish("triptych-hide-panel","left")}}}}),define("DS/ENOXEngineer/sessionBuilders/NextGenFilterSessionBuilder",["DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t){"use strict";function n(e){if(!e||!e.appCore||!e.models)throw console.error("missing options for SessionBuildersManager"),new Error("");this.appCore=e.appCore,this.models=e.models,this.engItem=this.models.getEngineeringItem()}return n.prototype.registerContentfetcher=function(e,n){if(n&&n[t.CONST_FIND_IN_CRITERIA])i=this.models.registerContentFetcher(this.models.addFindEngItemChildren(e,n),"addFindEngItemChildren --\x3e",this.engItem,n);else{var i=this.models.registerContentFetcher(this.models.addFilteredEngItemChildren(),"addFilteredEngItemChildren [multiexpand] --\x3e");this.appCore.PreferencesManager.isSpecInProductStructureEnabled()&&((!t.fetch_doc_expand_v2||this.appCore.sessionManager.isUsingDB()||this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials())&&i.registerContentFetcher(this.models.addEngItemDocuments()," getRelatedDocument --\x3e"),i.registerContentFetcher(this.models.addEngItemDocuments("PLMDocConnection")," getRelatedDocument --\x3e"))}i.fetchHolisticContentDefiniton(),delete this.appCore,delete this.models,delete this.engItem},n.prototype.resolveFilteringContext=function(){var t=this;return e.wrappedWithPromise(function(e,n){if(t.engItem.hasValidTransientNextGenFilter()||t.engItem.hasValidPersistedNextGenFilter())return e(!0);let i=!1,r=null;t.engItem.hasPesistencyManagerdNGFilter()&&(r=t.appCore.PersistencyManager.getNGFilter(),i=!0),t.models.retrievePreferreedNGFilter(r).then(function(o){var s=o[0]||null;return s?(!0===i?t.engItem.setPersistedNGFilterContext(s,!1):(s.filterId=r.filterId,t.engItem.setPersistedNGFilterContext(s)),e(!0)):n(new Error("no filter found"))}).catch(function(e){console.error(e),n(e)})})},n.prototype.retrieveCurrentFilterInfo=function(){return{rootId:this.engItem.getID(),label:this.engItem.getNGFilterName(),CVQuery:this.engItem.getNextGenFilterExpandOptions().CVQuery,CVQueryV2:this.engItem.getNextGenFilterExpandOptions().CVQueryV2,filterId:this.engItem.getNGFilterId()}},n.prototype.retrieveAdditionalColumnProviders=function(){return e.wrappedWithPromise(function(e,t){return e(!0)})},n.prototype.buildSession=function(t){var n=this;return e.wrappedWithPromise(function(e,i){n.resolveFilteringContext().then(function(){var i=n.retrieveCurrentFilterInfo();n.appCore.sessionManager.saveCurrentOpenContext({rootId:i.rootId,filteringContext:"nextGenFilter",filterData:{CVQuery:i.CVQuery,CVQueryV2:i.CVQueryV2,label:i.label,filterId:i.filterId}}),n.registerContentfetcher(void 0,t),e(!0)}).catch(function(i){n.registerContentfetcher(void 0,t),e(!0)})})},n}),define("DS/ENOXEngineer/services/I18nManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("I18nManager manager initializing");e.core.i18nManager=this,e.sandboxBase.i18nManager=this,this.app=e,e.optionalStartupPromises.push(this.warmupNLS())},resolveMissingNls:function(e){if(!Array.isArray(e.classes)||!e.properties)throw new Error("Ouups ! invalid input");var t=[];return t.push(this.getResourcesInfo(e.classes.join(","))),t.push(this.getNlsOfPropertiesValues(e.properties)),n.allSettled(t)},resolveRangeValueNls:function(e){if(!e)throw new Error("Ouups ! invalid input");return this.getNlsOfPropertiesValues(e)},_isPropertyKey:function(e){return e.split("/").length>1},_isVocabularyElement:function(e){return e&&e.indexOf(":")>-1},replace:o.replace,get:function(t){if(!e.is(t,"string"))return null;if("ds6wg:MaterialUsageExtension.DeclaredQuantity"===t)return o.get("MaterialUsageExtension.DeclaredQuantity");if(t.endsWith("-Instance")&&(t=t.substring(0,t.length-"-Instance".length)),this._isVocabularyElement(t)){if(this._isPropertyKey(t)){var n=t.split("/"),i=n[0],r=n[1];return this.ds6wClassPropNls&&this.ds6wClassPropNls[i]&&this.ds6wClassPropNls[i][r]?this.ds6wClassPropNls[i][r]:r}return this.ds6wClassNls&&this.ds6wClassNls[t]?this.ds6wClassNls[t].nlsName:t}return o.get(t)},warmupNLS:function(){var e=this.app.core.settingManager.getSetting(r.RDF_CLASSES_TO_LOAD),t=[],i=this.app.core.dicoService.getAvailableAttributes().map(function(e){return e.ds6w}).concat(this.app.core.dicoService.getSelectedTypes()).join(",");i&&i.length>0&&(e=e+","+i),t.push(this.getResourcesInfo(e));var o=this.app.core.settingManager.getSetting(r.MOST_USED_PROP_VALUE);return t.push(this.getNlsOfPropertiesValues(o)),n.allSettled(t)},loadClassesNlsValue:function(e){var t=this;return new n(function(n,i){if(!Array.isArray(e)||0===e.length)return i("invalid input");t.getResourcesInfo(e).then(n).catch(i)})},getResourcesInfo:function(e){var t=this;return new n(function(n,r){i.getResourcesInfo(e,{apiVersion:"R2019x",tenantId:t.app.core.settingManager.getPlatformId(),lang:t.app.core.settingManager.getLanguage(),onComplete:function(e){Array.isArray(e)&&(t.ds6wClassNls||(t.ds6wClassNls={}),e.forEach(function(e){t.ds6wClassNls[e.curi]={nlsName:e.label,uri:e.curi}}),n(t.ds6wClassNls))},onFailure:function(){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getResourcesInfo failed for"+e),n()}})})},getNlsOfPropertiesValues:function(t){var r=this;return new n(function(n,o){i.getNlsOfPropertiesValues(JSON.stringify(t),{apiVersion:"R2019x",tenantId:r.app.core.settingManager.getPlatformId(),lang:r.app.core.settingManager.getLanguage(),onComplete:function(t){t&&(r.ds6wClassPropNls||(r.ds6wClassPropNls={}),e.extend(r.ds6wClassPropNls,t,!0),n(r.ds6wClassPropNls))},onFailure:function(){console.warn("DictionaryAccess## FedDictionaryAccessAPI.getNlsOfPropertiesValues failed for"+t),n()}})})}})}),define("DS/ENOXEngineer/columnsProviders/ManufacturingResponsibilityDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/DELPPWFacets/DataProvider/ManufacturingDataProvider"],function(e,t,n,i,r){"use strict";return t.singleton({_typeHierarchy:{},init:function(e){this._parent(e),r.init()},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");setTimeout(function(){t(!0)},500)},getName:function(){return i.MANUFACTURING_RESPONSIBILITY_COLUMN},getManagedColumnNames:function(){return[i.MANUFACTURING_RESPONSIBILITY]},toBeUpdated:function(t){var n=!0;return e.is(t)&&e.is(t[i.MANUFACTURING_RESPONSIBILITY])&&(n=!1),n},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return e.dataIndex===i.MANUFACTURING});e.splice(t,t>=0?1:0,{text:n.get(i.MANUFACTURING),dataIndex:i.MANUFACTURING,maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){return r._fetchData(e)},updateAttributes:function(t,n){var i={};if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(function(e){t.pids.forEach(function(t){i[t]={Manufacturing:e[t]}}),n({pids:i})}).catch(function(){t.pids.forEach(function(e){i[e]={Manufacturing:"None"}}),n({pids:i})})}})}),define("DS/ENOXEngineer/utils/ResponseParser",["UWA/Core","WebappsUtils/WebappsUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){const i=(t,n)=>{if(!e.is(t))return!1;if(!Reflect.has(t,n))return!1;return""!==("string"==typeof t[n]?t[n].trim():"")},r=()=>({get hasQuantity(){return i(this,"ds6wg:MaterialUsageExtension.DeclaredQuantity")||i(this,"ds6wg:DELFmiContQuantity_Mass.V_ContQuantity")||i(this,"ds6wg:DELFmiContQuantity_Volume.V_ContQuantity")},get getDeformableObjectIDFromDeformed(){let e=i(this,n.CONST_DEFORMABLE_SEMANTIC_REL_INFO)?this[n.CONST_DEFORMABLE_SEMANTIC_REL_INFO]:null;if(e&&Array.isArray(e.split(" "))){let t=e.split(" ");if(8==t.length)return t[6]}return null},get isCoreMaterialConsumption(){return i(this,"coreMaterialID")&&this.hasQuantity}});return{getListOfVersionsFromRoot:function(e,t){if(!e)return null;if(t.push(this._readVersionData(e)),Array.isArray(e.Derived)&&e.Derived.length>0)for(var n=0;n<e.Derived.length;n++)this.getListOfVersionsFromRoot(e.Derived[n],t);e["Main Derived"]&&e["Main Derived"].id&&this.getListOfVersionsFromRoot(e["Main Derived"],t)},_readVersionData:function(e){if(!e)return null;var t={type:e.type,type_NLS:e.type_NLS,revision:e.revision,state:e.current,state_NLS:e.current_NLS,physicalid:this._getPidWithoutPrefix(e.id),icons:["product"],name:e.name,thumbnail:e.image&&e.image.trim().length>0?e.image:null};return e.attributes&&(t.MarketingName=e.attributes.MarketingName||null),t.label=t.MarketingName?t.MarketingName:t.name,t.label+=" - "+t.revision,t.subLabel=t.type_NLS,t.description=t.state_NLS,t},retrieveProdConfsInfo:function(e){if(!e||!Array.isArray(e.productconfigurations))throw new Error("Ouups ! invalid response structure");var t=[],n=this;return e.productconfigurations.forEach(function(e){t.push({name:e.name,id:n._getPidWithoutPrefix(e.id),marketingName:e.marketingName,FilterCompiledForm:e.attributes?e.attributes.FilterCompiledForm:null})}),t},parseSetConfContext:function(e){var t=["ERROR","WARNING","notProcessed"],n=[];if(!e)return n.push({status:!1,message:"UNKNOWN Response"}),n;const{version:i}=e;switch(i){case"1.2":const{details:t}=e,[n]=Array.isArray(t)?t:[];contexts=n?n.contexts:null;break;default:contexts=e.contexts}const{content:r}=contexts||{};return Array.isArray(r)?(r.forEach(e=>{-1!==t.indexOf(e.status)?n.push({status:!1,message:e.errorMessage,modelId:e.modelId}):n.push({status:!0,message:e.errorMessage,modelId:e.modelId})}),n):(n.push({status:!1,message:"UNKNOWN Response"}),n)},configInfoParser:function(e){if(!(e&&e.contexts&&e.contexts.content&&Array.isArray(e.contexts.content.results)))throw new Error("Ouups ! invalid response structure");for(var t=[],n=e.contexts.content.results,i=0;i<n.length;i++)if(n[i].success){var r=this.maskBasedAttributesParser(n[i]);t.push(r)}return t},_getPidWithoutPrefix:function(e){return e.startsWith("pid:")?e.substr(4):e},modelVersionsParser:function(e){return e&&e.products?e.products:null},maskBasedAttributesParser:function(e){var t=this;if(!Array.isArray(e.basicData))return null;var n={};return e.basicData.forEach(function(e){switch(e.name){case"owner":n.subLabel=n["ds6w:responsible"]=t._getDBAttributeValue(e);break;case"description":n.description=n["ds6w:description"]=t._getDBAttributeValue(e);break;case"type":n.type=t._getDBAttributeValue(e);break;case"originated":n["ds6w:created"]=t._getDBAttributeValue(e);break;case"modified":n["ds6w:modified"]=t._getDBAttributeValue(e);break;case"revision":n["ds6wg:revision"]=t._getDBAttributeValue(e);break;case"current":n["ds6w:status"]=t._getDBAttributeValue(e);break;case"name":n.label=n["ds6w:label"]=t._getDBAttributeValue(e,"")}}),e.data.forEach(e=>{switch(e.name){case"Marketing Name":n["Marketing Name"]=t._getDBAttributeValue(e)}}),n.description="State : "+n["ds6w:status"],n.icons=["product"],n.physicalid=e.physicalID,n},_getDBAttributeValue:function(e,t){return Array.isArray(e.value)?e.value[0]:t},attributesParser:function(e,t,n,i){if(!Array.isArray(e))throw new Error("Ouups ! invalid input");for(var o=r(),s=e,a=0;a<s.length;a++){const e=s[a];this.convertAttributeAndAddToJsonNode(e,o,t,n,i)}return o},convertAttributeAndAddToJsonNode({name:e,value:t,format:i},r,o,s,a){let l=e;const c={value:t};switch(i&&"ds6w_facet"===i&&(l=e.split("/").pop()),o&&l.startsWith("ds6w")&&Array.isArray(o.classes)&&o.properties&&(-1===o.classes.indexOf(l)&&o.classes.push(l),Array.isArray(o.withNlsProp)&&-1!==o.withNlsProp.indexOf(l)&&(o.properties[l]||(o.properties[l]=[]),-1===o.properties[l].indexOf(c.value)&&o.properties[l].push(c.value))),l){case"resourceid":r.resourceid=c.value,r.physicalid=c.value;break;case"type_icon_url":case"icon":r.icons||(r.icons=[]),r.icons.push(c.value);break;case"preview_url":case"thumbnail_2d":r.thumbnail=c.value;break;case"ds6w:type":r.type=c.value;break;case"ds6wg:PLMReference.V_isLastVersion":r.isLastVersion="boolean"==typeof c.value?c.value:"TRUE"===c.value.toUpperCase(),r["ds6wg:PLMReference.V_isLastVersion"]=c.value;break;case"bo.PLMReference.v_versionid":r.versionid=c.value;break;case"ds6w:policy":a||(a=[]),-1==a.indexOf(c.value)&&a.push(c.value);default:let t=c.value;if(s)if(s.authoringMode)if("string"==typeof t&&t.startsWith("[")&&t.endsWith("]"))t=JSON.parse(t);else{const e=n.DATABASE_MODE_MULTIVALUES_SEPARATOR;t=-1!==t.indexOf(e)?t.split(e):t}else if("ds6w:label"===l||"ds6w:label-Instance"===l||"ds6w:description"===l||"ds6wg:PLMReference.V_versionComment"===l)t=c.value;else{const e=n.INDEX_MODE_MULTIVALUES_SEPARATOR;t=-1!==t.indexOf(e)?t.split(e):t}if(r.hasOwnProperty(l)&&r[l]!==t){const e=r[l];Array.isArray(e)||(r[l]=[e]),Array.isArray(t)?r[l].push(...t):r[l].push(t)}else r[l]=t}},parseFetchResult:function(e,t){var n=e.results||[],i=[],r=this,o=null;return t&&(o={withNlsProp:t,classes:[],properties:{}}),n.forEach(function(e){0===e.attributes.length||e.sort&&"#DELETE#"===e.sort.sortType?i.push({deleted:!0}):i.push(r.attributesParser(e.attributes,o))}),{results:i,nlsTracker:o}},cleanExpandParsedData:function(e){if(e){if(e.root=void 0,e.nodes){for(var t in e.nodes)e.nodes.hasOwnProperty(t)&&(e.nodes[t]=void 0);e.nodes=void 0}if(e.iconsSet&&(e.iconsSet=void 0),Array.isArray(e.paths)){for(var n=0;n<e.paths.length;n++)e.paths[n]=void 0;e.paths=void 0}e=void 0}},parseAndBuildIRPCStructureForLoad:function(t,n,i){const r=this.getExpandResponseVersionFct(t);if(!e.is(r))throw new Error("Parse server response function not found.");var o,s={visibleMultivaluedAttrs:i.visibleMultivaluedAttrs,authoringMode:i.authoringMode},a=Reflect.apply(r,this,[t,n,s]),l=(a.paths,null);if(i&&i.pathLength){for(var c=Object.keys(a.nodes),d=0;d<c.length;d++)if(a.nodes.hasOwnProperty(c[d])&&a.nodes[c[d]].physicalid===i.physicalId){o=a.nodes[c[d]].did;break}for(var u=0;u<a.paths[0].length;u++)if(a.paths[0][u]==o){l=u;break}}if(!a||!a.nodes||!Array.isArray(a.paths))throw new Error("Ouups ! invalid input");a.iconsSet=a.iconsSet||[];var p=null==l?0:l;return Array.isArray(a.paths[0])&&a.paths[0].length>0&&(a.root=p>0&&o>=0?a.nodes[o]:a.nodes[a.paths[0][0]]),a},parseAndBuildIRPCStructure:function(t,n,i){const r=this.getExpandResponseVersionFct(t);if(!e.is(r))throw new Error("Parse server response function not found.");var o,s={visibleMultivaluedAttrs:i.visibleMultivaluedAttrs,authoringMode:i.authoringMode},a=Reflect.apply(r,this,[t,n,s]),l=(a.paths,null);if(i&&i.pathLength){for(var c=Object.keys(a.nodes),d=0;d<c.length;d++)if(a.nodes.hasOwnProperty(c[d])&&a.nodes[c[d]].physicalid===i.physicalId){o=a.nodes[c[d]].did;break}for(var u=0;u<a.paths[0].length;u++)if(a.paths[0][u]==o){l=u;break}}if(!a||!a.nodes||!Array.isArray(a.paths))throw new Error("Ouups ! invalid input");a.iconsSet=a.iconsSet||[];for(u=0;u<a.iconsSet.length;u++){var p=a.iconsSet[u];for(d=0;d<p.did.length;d++){var g=p.did[d],h=a.nodes[g];h.icons&&Array.isArray(h.icons)||(h.icons=[]),h.icons.push(p.icon),h.thumbnail||(h.thumbnail=p.thumbnail_2d)}}var m=null==l?0:l;return a.paths.forEach(function(e){var t=e.length;if(1===Math.abs(t%2))for(var n=m;n<e.length;n++){var i=a.nodes[e[n]],r=n+1<t?a.nodes[e[n+1]]:null;if(0===Math.abs(n%2)){if(i.children||(i.children=[]),r){for(var o=!1,s=0;s<i.children.length;s++)if(i.children[s].did===r.did){o=!0;break}o||i.children.push(r)}}else r&&(i.instanceOf=r)}else console.error("incomplete path")}),Array.isArray(a.paths[0])&&a.paths[0].length>0&&(a.root=m>0&&o>=0?a.nodes[o]:a.nodes[a.paths[0][0]]),a},parseExpandResult:function(t,n,i){if(!t||!Array.isArray(t.results))throw new Error("Ouups ! invalid input");var r={nodes:{},root:null,paths:[],nlsTracker:{withNlsProp:n,classes:[],properties:{}},iconsSet:[],policies:[]},o=this;return t.results.forEach(function(t){if(t.hasOwnProperty("attributes")){var n=o.attributesParser(t.attributes,r.nlsTracker,i,r.policies);e.is(n.did)&&(r.nodes[n.did]=n)}else t.hasOwnProperty("path")?r.paths.push(t.path):t.hasOwnProperty("icon__default_thumbnail_2d")&&(r.iconsSet=t.icon__default_thumbnail_2d)}),this.updateNodeWithIconsData(r),r},updateNodeWithIconsData:function(e){var t=e.iconsSet,n=e.nodes;Array.isArray(t)&&t.forEach(function(e){e.did.forEach(function(t){let i=n[t],r=e.icon;i.thumbnail=i.thumbnail?i.thumbnail:e.thumbnail_2d,i&&i.icons?i.icons.push(r):i.icons=[r]})})},getInstanceName:function(e){if(!Array.isArray(e.results))throw"wrong server response";var t=[];return e.results.forEach(function(e){for(var n=0;n<e.data.length;n++)if("PLM_ExternalID"===e.data[n].name){t.push({name:e.data[n].value[0],instanceId:e.physicalID});break}}),t},getExpandResponseVersionFct:function(t){if(!e.is(t))return console.error("Invalid server response"),null;let n=this.parseExpandResult;return Reflect.has(t,"infos")&&(n=this.parseProgressiveExpandResult),n},parseProgressiveExpandResult:function(e,t){if(!e||!Array.isArray(e.results))throw new Error("Ouups ! invalid input");const n={nodes:{},root:null,paths:[],nlsTracker:{withNlsProp:t,classes:[],properties:{}},iconsSet:[],policies:[]};return e.results.forEach(e=>{if(e.hasOwnProperty("resourceid")){const t=r();Reflect.ownKeys(e).forEach(i=>{const r=e[i];return this.convertAttributeAndAddToJsonNode({name:i,value:r},t,n.nlsTracker,{authoringMode:!1},n.policies)}),t.did=t.resourceid,n.nodes[t.did]=t}else if(e.hasOwnProperty("Path")){const t=e.Path;n.paths.push(t)}else e.hasOwnProperty("icon__default_thumbnail_2d")?n.iconsSet=e.icon__default_thumbnail_2d:console.warn(`parseProgressiveExpandResult => unknown node : ${e}`)}),n}}}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils",["UWA/Class","DS/Utilities/Data","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.singleton({init:function(e){this._parent(e)},initialize:function(e){this.options=e},_expandChildren:function(e,t,n){var i=function(e,t,n){if((-1===t||n<t)&&e.isChildComputed()&&(e.isExpanded()||e.setState({state:"expanded"}),e.hasChildren()))for(var r=e.getChildren(),o=0;o<r.length;o++){var s=r[o];s.isChildComputed()&&"noExpandState"!==s._expandState&&(s.getNodeDepth()<t||-1===t)&&s.setState({state:"expanded"}),i(s,t,n+1)}};i(e,t,n)},expandItemsByLevel:function(e){if(this.options.appCore.mediator.publish(n.EVENT_DISABLE_SORT_TO_DEFAULT,!0),this.isServiceHitRequired())this.options.context._app.mediator.publish(n.EVENT_EXPAND_BY_LEVEL,e);else{var t=this.options.context._app.core.contextManager.getXENTreeDocument();let n=this.options.context._app.core.contextManager.isActiveEngItemSelected()?t.core.xengTreeDoc.getRoots():t.getSelectedNodes(),i={operation:"expand",targetLevel:e,currentLevel:0};this.chunckAndExecuteOperation(n,i)}},collapseChildren:function(){let e=[];e=this.options.context._app.core.contextManager.isActiveEngItemSelected()?this.options.context._app.core.xengTreeDoc.getRoots():this.options.context._app.core.contextManager.getXENTreeDocument().getSelectedNodes(),this.chunckAndExecuteOperation(e,{operation:"collapse"})},chunckAndExecuteOperation:function(e,n){var i=this;let{targetLevel:r,currentLevel:o,operation:s}=n;i.options.context._app.core.contextManager.getXENTreeDocument().prepareUpdate(),t.forEach(e,function(e){"collapse"===s?e.collapseAll():"expand"===s&&i._expandChildren(e,parseInt(r),o)},1,function(){i.options.context._app.core.contextManager.getXENTreeDocument().pushUpdate()})},isServiceHitRequired:function(){return!((this.options.context&&this.options.context.getActiveEngItemOpenContext()&&this.options.context.getActiveEngItemOpenContext().filteringContext?this.options.context.getActiveEngItemOpenContext().filteringContext:"")==n.CONST_ADV_FILTER||this.options.context._app.core.sessionManager.shouldShowMfgView())}})}),define("DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd",["UWA/Core","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/ApplicationFrame/Command","DS/ENOXEngineer/services/MaterialExceptions"],(e,t,n,i)=>{const{MaterialTypeError:r,MaterialSamePidError:o}=i;return class extends n{constructor(e){super(e),this._options=e}get context(){return this._options.context}get isAuthoringCmd(){return!1}get selectedItems(){const{_options:e}=this;return e?"function"!=typeof e.getSelectedItems?null:this._options.getSelectedItems():null}get securityContext(){const{context:e}=this;return e?"function"!=typeof e.getSecurityContext?null:e.getSecurityContext():null}get tenant(){const e=this.securityContext;return e?e.tenant:null}get selectedMaterials(){const{_options:e}=this;return e?"function"!=typeof e.getSelectedMaterials?null:this._options.getSelectedMaterials():null}buildDisplayedMessage(n,i=null){let s=null;return e.is(i)&&(s=i instanceof r?`${t["error.Material.WrongType"]}`:i instanceof o?`${t["error.Material.SameId"]}`:this.computeErrorMsgFromException(i)),e.is(s)?`${n}<br>${s}`:n}computeErrorMsgFromException(e){const{message:n}=e||{};if(!n)return"";let i="";return i=-1!==n.search(/create(Core|Covering)Input failed/g)?`${t["error.Material.CreateInput"]}`:n}}}),define("DS/ENOXEngineer/commands/MaterialFacet/ShowPropertiesCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],(e,t,n)=>{return class extends t{constructor(e){super(e)}execute(){const t=this.selectedMaterials;if(!e.is(t))throw console.error("error: MaterialFacet/ShowCommand missing matInfos parameter"),this.end(),new Error("error: MaterialFacet/ShowCommand missing matInfos parameter");const i=this.tenant;if(!e.is(i))throw console.error("error: MaterialFacet/ShowCommand missing tenant parameter"),this.end(),new Error("error: MaterialFacet/ShowCommand missing tenant parameter");const r={getSelectedNodes:()=>t.map(e=>{const{physicalid:t}=e;return{id:t,tenant:i,source:"3DSpace",getID:function(){return t}}})};(new n).launchProperties(r)}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder",["DS/Tree/TreeNodeModel","DS/Controls/ModalContainer","DS/Controls/Loader","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i)=>{return class{constructor(){this.isValid=!1,this.isLoading=!1,this.viewContext=null}init(e){this.viewContext=e,this.isValid=!0,this.isLoading=!1}release(){this.emptyView(),this.isLoading&&this.deactivateLoadingInfo(),this.isValid=!1}async buildView(e=null){this.activateLoadingInfo();let t=null;try{t=await this.buildNodes(e)}catch(e){throw new Error("failed building treeNode view")}finally{this.deactivateLoadingInfo()}Array.isArray(t)&&t.length&&this.addNodesToView(t)}updateView(){}emptyView(){if(!this.isValid)return;const{gridModel:e}=this.viewContext;e&&e.getRoots()&&(e.prepareUpdate(),e.removeRoots(),e.empty(),e.pushUpdate())}async buildNodes(e){throw new Error("not implemented")}addNodesToView(e){if(!this.isValid||!Array.isArray(e))return;const{gridModel:t}=this.viewContext;if(!t)throw new Error("unexpected state");t.prepareUpdate(),e.forEach(e=>t.addRoot(e)),t.pushUpdate()}activateLoadingInfo(){if(this.isLoading)return;const{gridModel:r,gridView:o}=this.viewContext;if(!r||!o)throw new Error("unexpected state");r.prepareUpdate();const s=new e;r.addRoot(s),r.pushUpdate();const a=i.get("loading"),l=new n({text:a});l.on(a),t.createModal(o.getContent(),l.elements.container),this.isLoading=!0}deactivateLoadingInfo(){if(!this.isLoading||!this.isValid)return;const{gridModel:e,gridView:n}=this.viewContext;if(!e||!n)throw new Error("unexpected state");this.emptyView(),t.removeModal(n.getContent()),this.isLoading=!1}}}),define("DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser",["DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/Tree/TreeDocument","DS/ENOXEngineerCommonUtils/XENMask","css!DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser.css"],function(e,t,n,i){"use strict";function r(t){var r=this;this.appCore=t.appCore,this.resolve=t.resolve,this.reject=t.reject,this.preferredId=t.preferred,this.modelsPromises=t.modelsPromises,this.grid=new e({useDragAndDrop:!1}),this.grid.selectionBehavior={unselectAllOnEmptyArea:!1,toggle:!0,canMultiSelect:!1,enableShiftSelection:!1,enableFeedbackForActiveCell:!0},this.modelsDocument=new n;var o=0;r.modelsPromises.forEach(function(e){e.then(function(e){o++,(e.length>0||o==r.modelsPromises.length)&&i.isMasked(r.modal.modal.elements.body)&&i.unmask(r.modal.modal.elements.body),r.modelsDocument.addRoot(e),1===r.modelsDocument._numberOfNodesInDocument&&e[0]&&e[0].select(),e.forEach(function(e){r.preferredId&&e.options.physicalid===r.preferredId&&e.select()})})}),this.grid.model=this.modelsDocument,this.buildView()}return r.prototype._buildModal=function(){return this.modal=new t({title:this.appCore.i18nManager.get("eng.ui.dialog.chooseModel"),className:"xeng-model-chooser",withFooter:!0}),this.modal},r.prototype.destroyView=function(){this.modelsDocument=void 0,this.grid&&this.grid.destroy(),this.modal&&this.modal.destroy(),this.modal=void 0},r.prototype._getModalContent=function(){return this.grid.getContent()},r.prototype.buildView=function(){var e=this;this._getModalContent().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){e.resolve&&e.resolve(e.modelsDocument.getSelectedNodes()[0]),t()},this),this.modal.onClose(function(){e.destroyView(),e.reject&&e.reject()},this),this.infoBox=UWA.createElement("div",{html:"text",class:"cancel_info"}),this.infoBox.setText(this.appCore.i18nManager.get("OnCancel_ModelChooser")),this.infoBox.inject(e.modal.modal.elements.body),this.modal.show(),i.mask(e.modal.modal.elements.body)},r}),define("DS/ENOXEngineer/sessionBuilders/ConfigSessionBuilder",["DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";function i(e){if(!e||!e.appCore||!e.models)throw console.error("missing options for SessionBuildersManager"),new Error("");this.appCore=e.appCore,this.models=e.models,this.engItem=this.models.getEngineeringItem()}return i.prototype.retrieveOpenInfos=function(){if(!this.engItem.isConfigured())return{rootId:this.engItem.getID(),filteringContext:"none"};var e=this.engItem.getPreferedAttachedConfigModel();return e?e.getPreferredConfiguration()?{rootId:this.engItem.getID(),filteringContext:"prodConf",filterData:{filterId:e.getPreferredConfiguration().id,label:e.getPreferredConfiguration().marketingName,filterBinary:e.getPreferredConfiguration().FilterCompiledForm}}:{rootId:this.engItem.getID(),filteringContext:"evolution",filterData:{filterId:e.getCurrentVersionID(),label:e.getCurrentVersionDisplayName(),filterBinary:null}}:void 0},i.prototype.registerContentfetcher=function(e,t){var i=this;const r=(t,r)=>{if(r&&r[n.CONST_FIND_IN_CRITERIA])return i.models.registerContentFetcher(i.models.addFindEngItemChildren(t,r),"addFindEngItemChildren --\x3e",i.engItem,r);{let o=r&&r[n.CONST_TARGET_LEVEL],s=1!=e.length||o?e:e[0],a=i.models.registerContentFetcher(i.models.addChildren(t,r?r[n.CONST_TARGET_LEVEL]:void 0),"addChildren --\x3e",i.engItem,r);return i.appCore.PreferencesManager.isSpecInProductStructureEnabled()&&1===e.length&&((!n.fetch_doc_expand_v2||this.appCore.sessionManager.isUsingDB()||this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials())&&a.registerContentFetcher(i.models.addChildDocuments(s)," getRelatedDocument --\x3e",s),a.registerContentFetcher(i.models.addChildDocuments(s,"PLMDocConnection")," getRelatedDocument --\x3e",s)),a}},o=e=>{let t=i.models.registerContentFetcher(i.models.addEngItemChildren(e),"addEngItemChildren --\x3e",i.engItem,e);return i.appCore.PreferencesManager.isSpecInProductStructureEnabled()&&!i.appCore.contextManager.isPreExpandEvent()&&((!n.fetch_doc_expand_v2||this.appCore.sessionManager.isUsingDB()||this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials())&&t.registerContentFetcher(i.models.addEngItemDocuments()," getRelatedDocument --\x3e",i.engItem),t.registerContentFetcher(i.models.addEngItemDocuments("PLMDocConnection")," getRelatedDocument --\x3e",i.engItem)),t};if(i.appCore.sessionManager.shareConfigSpecWithBIFilter(),i.appCore.sessionManager){var s;if(i.appCore.sessionManager.saveCurrentOpenContext(i.retrieveOpenInfos()),e){s=r(Array.isArray(e)?e:[e],t)}else s=o(t);s.fetchHolisticContentDefiniton()}delete i.appCore,delete i.models,delete i.engItem},i.prototype.retrieveAdditionalColumnProviders=function(){return e.wrappedWithPromise(function(e,t){return e(!0)})},i.prototype.buildSession=function(t){var i=this;return e.wrappedWithPromise(function(e,r){i.engItem.hasModelVersion().then(function(r){i.engItem.getPreferedAttachedConfigModel()&&r&&i.appCore.settingManager.isConfigAuthorized()&&i.appCore.mediator.publish(n.EVENT_LAUNCH_COMMAND,{commandId:n.SET_WORKUNDER_EVOLUTION_CMD,context:{item:i.engItem}}),i.engItem.updateUserConfigPreferences(),i.registerContentfetcher(void 0,t),e(!0)})})},i.prototype.getPathsArray=function(e){let t=[];return e.forEach((e,n)=>{t.push(e.getExpandPath())}),t},i}),define("DS/ENOXEngineer/componentsHelpers/GridViewConfigurator/GridViewConfigurator",["DS/ENOXEngineer/services/I18nManager"],function(e){"use strict";return{myEngItemsConfigurator:function(){return{getComponentData:function(e){return e.getCurrentUserRootEng()},getTitle:function(){return e.get("my_eng_items")},getViewName:function(){return"my_eng_items"},getPreferredView:function(e){return e.getItem("my_eng_items_view")}}},recentsEngItemsConfigurator:function(){return{getComponentData:function(e){return e.getCurrentUserRecentsItems()},getTitle:function(){return e.get("recent_items")},getViewName:function(){return"recent_items"},getPreferredView:function(e){return e.getItem("recent_items_view")}}}}}),define("DS/ENOXEngineer/utils/expand/CVPayloadFactory",["UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/expand/ExpandPayloadFactoryUtils"],(e,t,n)=>{const{defaultProperties:i,AbstractPayloadFactory:r}=n,o=[...i];return class extends r{constructor(){super(),this.payload={},n.definePropertiesOnObject(this,o,{getterFct:"getKey",setterFct:"setKey"})}get name(){return t.COMMAND_WS_EXPAND_CV}setKey(e,t){this.payload[e]=t}getKey(e){return Reflect.has(this,e)||console.error(`unable to retreive ${e} on ${this.name}`),this.payload[e]}get json(){return this.payload}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView",["UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/UIKIT/Input/Select","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/MaterialQuantityView.css"],(e,t,n,i)=>{return class{constructor(e,i){this.appCore=e,this.dimensionValues=[],this.unitValues=new Map,Reflect.ownKeys(this.appCore.PreferencesManager.dimensions).forEach(e=>{switch(e){case t.DIMENSION_MASS:case t.DIMENSION_VOLUME:this.dimensionValues.push({key:e,label:this.appCore.PreferencesManager.dimensions[e].NLS,value:this.appCore.PreferencesManager.dimensions[e].Name}),this.unitValues.set(this.appCore.PreferencesManager.dimensions[e].Name,this.appCore.PreferencesManager.dimensions[e].Units)}});const{title:r,className:o,withFooter:s,onOk:a,onCancel:l,dimOptions:c,unitOptions:d,inputOptions:u}=i;this._modal=new n({title:r,className:o,withFooter:s}),this._buildSkeleton(a,l,c,d,u),this._modal.show()}getDimensions(){return this.dimensionValues}getUnits(e){return this.unitValues.has(e)?this.unitValues.get(e).map(e=>({label:e.NLSName,value:e.Name,key:e.Name})):(console.warn(`unexpected dimension ${e}`),[])}_buildSkeleton(n,r,o,s,a){const l=(t,n,i)=>e.is(t)&&Reflect.has(t,n)?t[n]:i,c=l(o,"selected",e.is(widget.getValue(t.PREFERRED_DIMENSION))?widget.getValue(t.PREFERRED_DIMENSION):t.DIMENSION_VOLUME),d=l(s,"enable",!0),u=l(s,"selected","none"),p=(e,{selected:t="none",enable:n=!0})=>{const r="none"===t&&e.length?e[0].key:t,o=e.map(({key:e,label:t,value:n})=>({label:t,value:n,selected:e===r})),s=new i({custom:!1,className:"dim-combo-box",placeholder:!1,options:o});return n||s.disable(),s},g=document.createElement("div");g.className="input-add-group";let h=null;const m=l(o,"enable",!0),f=p(this.dimensionValues,{selected:c,enable:m});f.addEvent("onChange",()=>{const t=f.getValue()[0],n=this.getUnits(t),i=e.extendElement(g).getElement(".input-group-units");e.is(i)&&i.empty(),(h=p(n,{enable:d})).inject(i)});const E=document.createElement("div");E.className="input-dimension",f.inject(E),g.appendChild(E);const C=document.createElement("input");C.className="form-control",C.type="number",C.step=.1,C.placeholder=this.appCore.i18nManager.get("eng.ui.dialog.selectMaterialQuantity.placeholder");const _=l(a,"value",null);"number"==typeof+_&&(C.value=_),C.min=0,C.maxLength=9,C.style.marginLeft="10px",C.oninput=function(e){const t=e.data,n=parseFloat(this.value);void 0!==n&&!isNaN(n)||"."===t||(this.value=""),n<0&&(this.value="0"),this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength))},g.appendChild(C);const y=e.createElement("div",{class:"input-group-units"}),M=this.getUnits(c);(h=p(M,{selected:u,enable:d})).inject(y),g.appendChild(y),this._modal.getBody().appendChild(g),this._modal.onValidate(e=>{this._modal.onClose(()=>{});const t={value:C.value,dimension:f.getValue()[0],unit:h.getValue()[0]};"function"==typeof n?n(t,e):e()},this),this._modal.onClose(()=>{this._modal.destroy(),this._modal=null,"function"==typeof r&&r()},this)}}}),define("DS/ENOXEngineer/utils/expand/CV2PayloadFactory",["UWA/Core","DS/ENOXEngineer/utils/expand/ExpandPayloadFactoryUtils","DS/ENOXEngineer/utils/expand/ProgressiveExpand","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i)=>{const{AbstractPayloadFactory:r,fixUqlWithCloudViewFormat:o,appendUqlValue:s}=t;return class extends r{constructor(){super(),this.query=new n.Query,this.updateEltList=[]}addEltToUpdate(e,t){Array.isArray(this.updateEltList)||(this.updateEltList=[]),Array.isArray(e[Symbol.for("update")])||(e[Symbol.for("update")]=[],this.updateEltList.push(e)),e[Symbol.for("update")].push(t)}addEltForUpdate(e,t){this.eltForUpdateList||(this.eltForUpdateList={}),this.eltForUpdateList[e]=t}finalize(){this.updateEltList.forEach(e=>{e[Symbol.for("update")].forEach(e=>e(this.eltForUpdateList))}),this.updateEltList=[];const{outputs:e}=this;if(e.format=n.ENUM_OUTPUT_FORMAT.entity_relation_occurrence,!Reflect.has(this,"skipValidFilterCheck")){const{expands:e}=this.query.batch;e.forEach(e=>{e.getImplKey("filter")||(e.filter.all=1)})}}get json(){return this.finalize(),this.query.json}get name(){return i.COMMAND_WS_EXPAND_CV_V2}get currentExpand(){const{expands:e}=this.query.batch;if(!e.length){const{Expand:t}=n;e.push(new t)}return e[e.length-1]}get outputs(){return this.query.outputs}set no_type_filter_rel(e){const t=this.currentExpand,{descending_condition_relation:n}=t.graph;let i=null;Array.isArray(e)?i=e.map(e=>`NOT (flattenedtaxonomies:"reltypes/${e}")`).join(" OR "):"string"==typeof e&&(i=`NOT (flattenedtaxonomies:"reltypes/${e}")`),n.uql=s(n.uql,i,"AND")}set type_filter_rel(e){const t=this.currentExpand,{descending_condition_relation:n}=t.graph;let i=null;Array.isArray(e)?i=e.map(e=>`(flattenedtaxonomies:"reltypes/${e}")`).join(" OR "):"string"==typeof e&&(i=`(flattenedtaxonomies:"reltypes/${e}")`),n.uql=s(n.uql,i,"AND")}set compute_select_bo(e){const t=e.map(e=>{let t=e;switch(e){case"thumbnail_2d":t="urlstream|thumbnail_2d|2dthb";break;case"icon":t="icons"}return t});this.outputs.hits.predefined_computation=t}set expand_iter(t){const i=parseInt(t,10);if(Number.isNaN(i))return void console.error("expand_iter expand level cannot be computed");if(-1===i)return;const r=new n.Truncate;r.max_distance_from_prefix=i;const o=new n.Aggregation_Processor;o.truncate=r;const s=this.currentExpand;s.aggregation_processors.push(o),this.addEltToUpdate(r,t=>{if(t&&Reflect.has(t,"truncate_prefix_filter"))r.prefix_filter=t.truncate_prefix_filter.prefix_filter;else if(t&&Reflect.has(t,"truncate_or_filter"))r.or=t.truncate_or_filter.or;else if(e.is(s.root.physical_id)){const e=new n.Path;e.physical_id_path=[s.root.physical_id];const t=new n.Filter;t.prefix_filter.prefix_path.push(e),r.prefix_filter=t.prefix_filter}})}set select_bo(e){this.outputs.select_object=e}set select_rel(e){this.outputs.select_relation=e}set label(e){this.currentExpand.label=e}set"q.iterative_filter_query_bo"(e){const t=this.currentExpand,{descending_condition_object:n}=t.graph;n.uql=s(n.uql,e,"AND")}set root_physicalid(e){this.currentExpand.root.physical_id=e}set root_path_physicalid(e){const t=this.currentExpand;if(Array.isArray(e)&&e.length){const i=e.map(e=>{const t=new n.Path;t.physical_id_path=e;const i=new n.Filter;return i.prefix_filter.prefix_path.push(t),i});if(i.length>1){const e=new n.Filter;e.or.filters.push(...i),t.filter.and.filters.push(e),this.addEltForUpdate("truncate_or_filter",e)}else 1===i.length&&(t.filter.and.filters.push(i[0]),this.addEltForUpdate("truncate_prefix_filter",i[0]));if(!t.getImplKey("root")){const[n]=e[0];t.root.physical_id=n}}}set paths(t){let n=null;if(Array.isArray(t)&&t.length){const e=t[0];Array.isArray(e)&&e.length&&([n]=e)}if(!e.is(n))throw new Error("wrong root");this.root_physicalid=n}set max_count_path(e){const t=this.currentExpand;let n=e;Number.isInteger(e)||(n=Number.parseInt(e,10)),t.parameters.limit_max_path=n}set config_filter(e){const t=this.currentExpand,i=new n.Filter;t.filter.and.filters.push(i),i.config_filter=e}set find_in_context(e){const t=new n.SequenceFilter;e.forEach(e=>{const i=e["q.query"];if("string"!=typeof i||""===i.trim())return;const r=new n.Graph_Expression;r.uql=o(i),t.sequence.push(r)});const i=this.currentExpand,r=new n.Filter;r.sequence_filter=t,i.filter.and.filters.push(r);const s=new n.Aggregation_Processor;s.truncate.sequence_filter=t,i.aggregation_processors.push(s)}set sequence_filter(e){if(!Array.isArray(e)||!e.length)return;const t=this.currentExpand;e.forEach(e=>{const{definition:i,option:r}=e;Array.isArray(i)&&i.length&&i.forEach((e,i)=>{const o=new n.Filter;if(Array.isArray(r)&&r[i])switch(r[i]){case"seq_remove":case"seq_cut ":{const e=new n.Filter;t.filter.and.filters.push(e);const i=new n.Filter;i.all=1,e.and_not.left=i,e.and_not.right=o;break}default:t.filter.and.filters.push(o)}else t.filter.and.filters.push(o);(Array.isArray(e)?e:[e]).forEach(e=>{const t=new n.Filter;o.and.filters.push(t);const i=[];Array.isArray(e.type_filter_rel)&&e.type_filter_rel.forEach(e=>{i.push(`(flattenedtaxonomies:"reltypes/${e}")`)}),Array.isArray(e.type_filter_bo)&&e.type_filter_bo.forEach(e=>{i.push(`(flattenedtaxonomies:"reltypes/${e}")`)});let r="";i.length&&(r=s("",`(${i.join(" OR ")})`)),Reflect.has(e,"q.query")&&(r=s(r,e["q.query"],"AND"));const a=new n.Graph_Expression;a.uql=r,t.sequence_filter||(t.sequence_filter=new n.SequenceFilter),t.sequence_filter.sequence.push(a)})})})}}}),define("DS/ENOXEngineer/utils/expand/DBPayloadFactory",["UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/expand/ExpandPayloadFactoryUtils"],(e,t,n)=>{const{defaultProperties:i,AbstractPayloadFactory:r}=n,o=["types","extensions",...i];return class extends r{constructor(){super(),this.payload={},n.definePropertiesOnObject(this,o,{getterFct:"getKey",setterFct:"setKey"})}get name(){return t.COMMAND_WS_EXPAND_DB}setKey(e,t){this.payload[e]=t}getKey(e){return Reflect.has(this,e)||console.error(`unable to retreive ${e} on ${this.name}`),this.payload[e]}get json(){return this.payload}get entries(){return o}}}),define("DS/ENOXEngineer/controllers/ItemViewController",["DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineerCommonUtils/PromiseUtils"],function(e,t,n,i){"use strict";return function(r){this.idCardCmp=null,this.listViewCmp=null,this.itemViewCmp=null;var o=this;if(!r)throw new Error("options are mandatory");if(!r.app||!r.parentController)throw new Error("app and parentController are mandatory");var s=r.parentController,a=r.app;return{activate:function(r){a.core.sessionManager.cleanStaticMappingContext(),a.core.dataService.loadConfigurationSettings().finally(function(){r.params.pcInfo&&r.params.path&&a.core.sessionManager.setStaticMappingAsOpenContext(r.params.pid,{pcInfo:r.params.pcInfo,path:r.params.path}),o.engItemLoadingPromise=a.core.dataService.getEngItemData(r.params.pid,!0),a.mediator.publish(e.EVENT_TRIPTYCH_HIDE_PANEL,"right"),a.mediator.publish(e.EVENT_TRIPTYCH_HIDE_PANEL,"left"),o.landingPageListnerToken=a.mediator.subscribe(e.EVENT_IDCARD_CUSTOM_SHOW_LANDING,function(){a.router.navigate("recents_items",{replace:!1,reload:!0})}),o.setActiveEngItemListerToken=a.mediator.subscribe(e.EVENT_SET_ACTIVE_ENG_ITEM,function(e){a.core.contextManager.setActiveEngItem(e)}),o._NGFilterCmdStartToken=n.subscribe("Frame3DXInfra.Open",t=>{a.core.PersistencyManager.setNGFilterCmdLaunchState(!0),o._NGFilterCmdStopToken=n.subscribe("Frame3DXInfra.onPanelClose",t=>{(t?t.tag:null)==e.NG_FILTER_PANEL_TAG&&(a.core.PersistencyManager.setNGFilterCmdLaunchState(!1),o._NGFilterCmdStopToken&&n.unsubscribe(o._NGFilterCmdStopToken)),a.mediator.publish(e.SWITCH_MODE,{switchMode:a.core.sessionManager.determineAuthoringMode()})}),a.mediator.publish(e.SWITCH_MODE,{switchMode:"index"})}),a.componentsMgt.startInstances([{name:e.ITEM_VIEW_CMP,container:s.triptychCmp.mainDiv,contextData:{}}]).then(function(n){o.itemViewCmp=n[0],o.engItemLoadingPromise.then(function(n){if(!Array.isArray(n)||0===n.length)throw new Error("Unable to fetch the engineering item attributes");var s=n[0];s.isValidEngItem().then(function(){a.mediator.publish(e.EVENT_SET_ACTIVE_ENG_ITEM,s),r.params.pcInfo&&r.params.path&&s.setStaticMapping({pcInfo:r.params.pcInfo,path:r.params.path}),r.params.filter&&a.core.PersistencyManager.setNGFilter(r.params.filter),a.core.contextManager.getXENTreeDocument().addRoot(s),s.select(),o.activeTreeDocument=a.core.Factories.CollectionsFactory.getEngItemContentModels(s),o.activeTreeDocument.buildUserWorkingSession().then(function(){i.allSettled(o.activeTreeDocument._contentFetchers).then(function(t){!function(t){var n=UWA.extendElement(o.itemViewCmp.container.querySelector(".top-container")),i=UWA.extendElement(o.itemViewCmp.container.querySelector(".listContainer"));a.componentsMgt.startInstances([{name:e.IDCARD_CMP,container:n,contextData:{physicalId:t.params.pid,models:o.activeTreeDocument}},{name:e.LIST_VIEW_NEW_CMP,container:i,contextData:{physicalId:t.params.pid,models:o.activeTreeDocument}}]).then(function(t){o.idCardCmp=t[0],o.listViewCmp=t[1],a.core.PersistencyManager.restoreInformationPanelForIdCard(o.activeTreeDocument),a.core.PersistencyManager.restoreNGFilterCmdLaunchSate(),o.infoPanelToken=a.mediator.subscribe(e.EVENT_INFO_PANEL_VISIBLE,function(){var t=o.activeTreeDocument.getSelectedNodes();Array.isArray(t)&&0===t.length&&a.mediator.publish(e.EVENT_SHOW_PROPERTIES,{nodes:[{id:o.activeTreeDocument.getEngineeringItem().getID(),metatype:"businessobject"}]})})})}(r)})}).catch(function(n){t.errorAlert(a.core.i18nManager.get("eng.failed.to.open.EI")),a.mediator.publish(e.EVENT_GO_BACK)})}).catch(function(n){t.errorAlert(a.core.i18nManager.get("trying.toopen.not.engineering.item")),a.mediator.publish(e.EVENT_GO_BACK)})}).catch(function(n){var i=n&&n.message?n.message:a.core.i18nManager.get("error.fetch.deleted.item");t.errorAlert(i),a.mediator.publish(e.EVENT_GO_BACK)})})})},deactivate:function(){a.core.contextManager.resetSelection(),!a.core.settingManager.isWorkingUnderEvolution()||this&&this._isRefreshing||a.core.settingManager.resetWorkUnderBubble(),a.core.contextManager.getXENTreeDocument()&&a.core.contextManager.getXENTreeDocument().empty(),o.activeTreeDocument&&o.activeTreeDocument.freeXENContent(),a.mediator.publish(e.EVENT_SET_ACTIVE_ENG_ITEM,null),a.mediator.publish(e.EVENT_SHOW_PROPERTIES,{nodes:[]}),o.listViewCmp&&o.listViewCmp.stop(),o.idCardCmp&&o.idCardCmp.stop(),o.itemViewCmp&&o.itemViewCmp.stop(),o.itemViewCmp&&a.componentsMgt.deleteInstance(e.ITEM_VIEW_CMP,o.itemViewCmp.ref),o.listViewCmp&&a.componentsMgt.deleteInstance(e.LIST_VIEW_NEW_CMP,o.listViewCmp.ref),o.idCardCmp&&a.componentsMgt.deleteInstance(e.IDCARD_CMP,o.idCardCmp.ref),a.mediator.publish(e.EVENT_TRIPTYCH_HIDE_PANEL,"right"),o.landingPageListnerToken&&a.mediator.unsubscribe(o.landingPageListnerToken),o.setActiveEngItemListerToken&&a.mediator.unsubscribe(o.setActiveEngItemListerToken),o.infoPanelToken&&a.mediator.unsubscribe(o.infoPanelToken),o._NGFilterCmdStartToken&&n.unsubscribe(o._NGFilterCmdStartToken),o._NGFilterCmdStopToken&&n.unsubscribe(o._NGFilterCmdStopToken),o.activeTreeDocument&&delete o.activeTreeDocument.core,o.activeTreeDocument=null,o.listViewCmp=null,o.idCardCmp=null,o.itemViewCmp=null,o.resetListListnerToken=null,o.landingPageListnerToken=null,o.setActiveEngItemListerToken=null,a.mediator.publish(e.EVENT_RESET_SELECTION),a.mediator.publish(e.EVENT_LAUNCH_COMMAND,{commandId:e.UPDATE_WIDGET_TITLE,context:{label:null}})}}}}),define("DS/ENOXEngineer/utils/expand/MultiCVPayloadFactory",["UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/expand/ExpandPayloadFactoryUtils","DS/ENOXEngineer/utils/expand/CVPayloadFactory"],(e,t,n,i)=>{const{defaultMultiProperties:r}=n;return class extends i{constructor(){super(),this.payload={},n.definePropertiesOnObject(this,r,{getterFct:"getKey",setterFct:"setKey"})}get name(){return t.COMMAND_WS_MULTIEXPAND}setKey(e,t){this.payload[e]=t}getKey(e){return Reflect.has(this,e)||console.error(`unable to retreive ${e} on ${this.name}`),this.payload[e]}get entries(){return[...super.entries,...r]}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityNoneViewBuilder",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder"],e=>{return class extends e{buildNodes(){const{model:e}=this.viewContext;if(!e)throw new Error("unexpected state");const{nodes:t}=e;if(!Array.isArray(t))throw new Error("unexpected nodes");return t}updateView(e){const{gridModel:t}=this.viewContext;if(!t)throw new Error("unexpected state");if(!e)throw new Error("wrong input");const{create:n,modify:i,detach:r}=e;(Array.isArray(n)&&n.length||Array.isArray(i)&&i.length||Array.isArray(r)&&r.length)&&(t.prepareUpdate(),Array.isArray(n)&&n.length&&n.forEach(e=>t.addRoot(e)),Array.isArray(i)&&i.length&&i.forEach(e=>e.updateOptions(e.options)),Array.isArray(r)&&r.length&&r.forEach(e=>t.removeRoot(e)),t.pushUpdate())}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewBuilderComponent",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityNoneViewBuilder","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i)=>{const r={None:"None"},o=i.get("None");return new class extends e{init(e){if(!e)throw new Error("invalid input");this.viewContext=e;const{model:n}=e;this.viewModeBuilders=new Map([[r.None,{instance:new t(n),nls:o}]]),this.activeMode=null}activate(){this.activeMode||this.restoreDefaultBuilder(),super.activate()}update(e){const t=this.getActiveBuilder();t&&t.updateView(e)}get defaultModeEntry(){return{value:r.None,label:o}}registerBuilder(e,t,i){if(!(e&&i instanceof n))throw new Error("invalid input");this.viewModeBuilders.has(e)||this.viewModeBuilders.set(e,{instance:i,nls:t})}unregisterBuilder(e){e===this.activeMode&&this.restoreDefaultBuilder(),this.viewModeBuilders.has(e)&&this.viewModeBuilders.delete(e)}applyBuilder(e,t=null){let n=null;if(!(n=e!==this.activeMode?this.activateBuilder(e):this.getActiveBuilder()))throw new Error(`unregistered builder => ${e}`);n.buildView(t)}restoreDefaultBuilder(){this.applyBuilder(r.None)}activateBuilder(e){const t=this.getBuilder(e);if(t){t.init(this.viewContext);const n=this.getActiveBuilder();n&&n.release(),this.activeMode=e}return t}getActiveBuilder(){return this.activeMode?this.getBuilder(this.activeMode):null}getBuilder(e){if(!this.viewModeBuilders.has(e))return null;const{instance:t}=this.viewModeBuilders.get(e);return t}}}),define("DS/ENOXEngineer/controllers/LandingPageController",["DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineer/componentsHelpers/GridViewConfigurator/GridViewConfigurator","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return function(i){this.myEngCmp=null;var r=this;if(r.isFirstRendering=!0,!i)throw new Error("options are mandatory");if(!i.app||!i.parentController)throw new Error("app and parentController are mandatory");var o=i.parentController,s=i.app;return{activate:function(){s.mediator.publish(n.EVENT_TRIPTYCH_SHOW_PANEL,"left"),s.mediator.publish(n.EVENT_SELECT_ACTION_WP,{id:"my_eng_items"}),r.isFirstRendering?(r.isFirstRendering=!1,e.mask(UWA.extendElement(o.triptychCmp.mainDiv)),r.myEngCmp=s.componentsMgt.startNewInstance(n.MY_ENG_ITEM_CMP,o.triptychCmp.mainDiv,t.myEngItemsConfigurator())):(r.myEngCmp.reRender(),s.mediator.publish(n.EVENT_REFRESH_LANDING_DATA))},deactivate:function(){r.myEngCmp.stop()}}}}),define("DS/ENOXEngineer/services/PreferencesManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o){"use strict";const s=[{label:"top-left_label",value:o.CHANGECONTROL_POSITION_TOPLEFT_VALUE},{label:"top-right_label",value:o.CHANGECONTROL_POSITION_TOPRIGHT_VALUE},{label:"bottom-right_label",value:o.CHANGECONTROL_POSITION_BOTTOMRIGHT_VALUE},{label:"bottom-left_label",value:o.CHANGECONTROL_POSITION_BOTTOMLEFT_VALUE},{label:"free-position_label",value:o.CHANGECONTROL_POSITION_FREE_VALUE}];return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("PreferencesManager manager initializing"),e.core.PreferencesManager=e.sandboxBase.PreferencesManager=this,this.app=e,this.setPreferenceOnstartup()},saveEngItemOpenPreferences:function(e){if(this.app.core.Factories.ListItemFactory.getReferenceClass(e)){var t=null;if(e.isConfigured()){var n=e.getPreferedAttachedConfigModel();if(n){if(t={model:n.getID()},n.getPreferredVersion()){var i=n.getPreferredVersion();t.modelVersion=i.id||void 0;var r=n.getPreferredConfiguration();r&&(t.prodConf=r.id)}}else t={noModel:!0}}return e.hasValidPersistedNextGenFilter()&&(t||(t={}),t.filterId=e.getNGFilterId(),t.filterName=e.getNGFilterName()),this.app.core.dataService.saveEngItemOpenPref(e.getID(),t)}},getStaticMappingPreference:function(e){var t=this.app.core.sessionManager.getStaticForMappingAsOpenContext(e);return t&&t.pcInfo?t.pcInfo:null},getEngItemOpenPreferences:function(e){if(this.getStaticMappingPreference(e))return this.getStaticMappingPreference(e);var t=this.app.core.dataService.getOpenPrefMap();return t?t.get(e):null},catchUserPreference:function(){this.setPreferenceOnstartup(),this.app.mediator.publish(o.CONST_SPECIFICATIONS_TAB_UPDATE,this.app.editPropertyCmp.infoPanel.elements.UI._lFacets)},setPreferenceOnstartup:function(){let e=i.getCredentialPreferenceKey();widget&&widget.getValue("SC")&&widget.setValue(e,widget.getValue("SC")),this.app.core.settingManager.isCloud()&&this.set3DEXPERIENCEPlatformPreference(),this.setDisplayTypeChooserPreference(),this.setShowNotInBOMPreference(),this.setSpecDocDisplayPreference(),this.setDisableIndexPreference(),this.setIntervalSwitchPreference(),this.setTerminalItemOptions(),this.setWorkUnderPreferences(),this.setDimensionUnitPreferences(),this.removePreferences([o.CONST_DOC_AS_SPEC])},setDisplayTypeChooserPreference:function(){widget.addPreference({name:o.PREFERENCE_TYPE_CHOOSER,defaultValue:!1,type:"boolean",label:"displayTypeChooser"})},setShowNotInBOMPreference:function(){widget.addPreference({name:o.PREFERED_SHOW_NOT_IN_BOM,defaultValue:!1,type:"boolean",label:"show_excludefrombom"})},setSpecDocDisplayPreference:function(){let e=!0;widget.getValue(o.CONST_DOC_AS_SPEC)&&(e=!widget.getValue(o.CONST_DOC_AS_SPEC)),widget.addPreference({name:o.CONST_DOC_AS_SPECS,defaultValue:e,type:"boolean",label:"eng.docAsSpec.productStructure"}),widget.getValue(o.CONST_DOC_AS_SPEC)&&(widget.setValue(o.CONST_DOC_AS_SPECS,e),widget.deleteValue(o.CONST_DOC_AS_SPEC))},setDisableIndexPreference:function(){widget.addPreference({name:o.PREFERENCE_USE_INDEX,defaultValue:!0,type:"boolean",label:"use_index",onchange:"onUseOnlyDBChange"}),widget.addEvent("onUseOnlyDBChange",this.onUseOnlyDBChange.bind(this))},setWorkUnderPreferences:function(){widget.getValue(o.USER_WORKUNDER_EVOL_PREF)||widget.setValue(o.USER_WORKUNDER_EVOL_PREF,o.VALUE_ASK_WORKUNDER_EVERYTIME),widget.addPreference({name:o.USER_WORKUNDER_EVOL_PREF,defaultValue:o.VALUE_ASK_WORKUNDER_EVERYTIME,type:"list",label:"evol_workunder_pref",options:[{label:"evol_workunder_combochoice_alwaysask",value:o.VALUE_ASK_WORKUNDER_EVERYTIME},{label:"evol_workunder_combochoice_alwaysset",value:o.VALUE_SET_WORKUNDER_ALWAYS},{label:"evol_workunder_combochoice_never",value:o.VALUE_SET_WORKUNDER_NEVER}]});let e=widget.getValue(o.CHANGECONTROL_SHOW_STATE);"boolean"!=typeof e&&(e=!0,widget.setValue(o.CHANGECONTROL_SHOW_STATE,e)),widget.addPreference({name:o.CHANGECONTROL_SHOW_STATE,defaultValue:e,type:"boolean",label:"eng.chgCtrl.Show",onchange:"onChangeControl"});let t=widget.getValue(o.CHANGECONTROL_POSITION);"string"!=typeof t&&(t=o.CHANGECONTROL_POSITION_BOTTOMRIGHT_VALUE,widget.setValue(o.CHANGECONTROL_POSITION,t)),!0===e?widget.addPreference({name:o.CHANGECONTROL_POSITION,defaultValue:t,type:"list",label:"eng.chgCtrl.Position",options:s,onchange:"onChangeControl"}):widget.addPreference({name:o.CHANGECONTROL_POSITION,type:"hidden"})},setDimensionUnitPreferences:function(){this.dimensions&&0!=Object.keys(this.dimensions).length?this.addDimensionUnitPreference():(this.dimensions={},this.app.core.dataService.loadUnitsOfDimension().then(e=>{e&&(this.dimensions.listOfUnits=e,this.dimensions[o.DIMENSION_VOLUME]=e.results.find(e=>e.Name===o.DIMENSION_VOLUME),this.dimensions[o.DIMENSION_MASS]=e.results.find(e=>e.Name===o.DIMENSION_MASS),this.dimensions[o.DIMENSION_AREA]=e.results.find(e=>e.Name===o.DIMENSION_AREA),this.dimensions[o.DIMENSION_LENGTH]=e.results.find(e=>e.Name===o.DIMENSION_LENGTH)),this.addDimensionUnitPreference()}))},set3DEXPERIENCEPlatformPreference:function(){var e={name:"3DEXPERIENCEPlatform",defaultValue:this.app.core.settingManager.getPlatformId(),type:"list",label:"3DEXPERIENCEPlatform",options:this.app.core.settingManager.configuredTenantList,onchange:"onSetTenant"};1===this.app.core.settingManager.configuredTenantList.length&&(e.disabled="true"),widget.addPreference(e),widget.addEvent("onSetTenant",this.onSetTenant.bind(this))},addDimensionUnitPreference:function(){let e=this.getDefaultUnit(o.PREFERRED_MASS_UNIT,o.DIMENSION_MASS),t=this.getDefaultUnit(o.PREFERRED_VOLUME_UNIT,o.DIMENSION_VOLUME),n=this.getDefaultUnit(o.PREFERRED_AREA_UNIT,o.DIMENSION_AREA),i=this.getDefaultUnit(o.PREFERRED_LENGTH_UNIT,o.DIMENSION_LENGTH),r=this.getNLSValueForMassQuantity(e),s=this.getNLSValueForVolumeQuantity(t),a=this.getNLSValueForAreaQuantity(n),l=this.getNLSValueForLengthQuantity(i);widget.setValue(o.PREFERRED_MASS_UNIT,e),widget.setValue(o.PREFERRED_VOLUME_UNIT,t),widget.setValue(o.PREFERRED_AREA_UNIT,n),widget.setValue(o.PREFERRED_LENGTH_UNIT,i);let c=this.dimensions[o.DIMENSION_MASS].Units.map(function(e){return{value:e.Name,label:e.NLSName}}),d=this.dimensions[o.DIMENSION_VOLUME].Units.map(function(e){return{value:e.Name,label:e.NLSName}}),u=this.dimensions[o.DIMENSION_AREA].Units.map(function(e){return{value:e.Name,label:e.NLSName}}),p=this.dimensions[o.DIMENSION_LENGTH].Units.map(function(e){return{value:e.Name,label:e.NLSName}});widget.addEvent("onSetMassUnit",this.onSetMassUnit.bind(this)),widget.addPreference({name:o.PREFERRED_MASS_UNIT,defaultValue:r,type:"list",label:"eng.preferred_dimension_mass",options:c,onchange:"onSetMassUnit"}),widget.addEvent("onSetVolumeUnit",this.onSetVolumeUnit.bind(this)),widget.addPreference({name:o.PREFERRED_VOLUME_UNIT,defaultValue:s,type:"list",label:"eng.preferred_dimension_volume",options:d,onchange:"onSetVolumeUnit"}),widget.addEvent("onSetAreaUnit",this.onSetAreaUnit.bind(this)),widget.addPreference({name:o.PREFERRED_AREA_UNIT,defaultValue:a,type:"list",label:"eng.preferred_dimension_area",options:u,onchange:"onSetAreaUnit"}),widget.addPreference({name:o.PREFERRED_LENGTH_UNIT,defaultValue:l,type:"list",label:"eng.preferred_dimension_length",options:p,onchange:"onSetLengthUnit"}),widget.addEvent("onSetLengthUnit",this.onSetLengthUnit.bind(this))},setIntervalSwitchPreference:function(e){var t=e||widget.getValue(o.PREFERENCE_USE_INDEX),n={name:o.PREFERENCE_INTERVAL_SWITCH_INDEX,defaultValue:"180",type:"list",label:"interval_to_switch",options:[{label:"zero_min",value:"0"},{label:"one_min",value:"60"},{label:"three_mins",value:"180"},{label:"five_mins",value:"300"},{label:"ten_min",value:"600"}]};t||(n.disabled="true"),widget.addPreference(n)},onUseOnlyDBChange:function(e,t){this.setIntervalSwitchPreference(t),widget.dispatchEvent("onEdit")},setDisplayCreatePanelPreference:function(e){var t={name:"CADAuthoring",defaultValue:!1,type:"boolean",label:"Ask_Me_CADAuthoring"};(e||widget.getValue("DisplayTypeChooser"))&&(widget.setValue("CADAuthoring",!0),t.disabled="true"),widget.addPreference(t)},setTerminalItemOptions:function(){var e=this.app.core.dicoService.getTerminalItemAtributes(),t=widget.getValue("Final Item")?widget.getValue("Final Item"):o.FINAL_ITEMS_DEFAULT,n={name:o.FINAL_ITEMS_PREF,type:"list",label:"final_items_pref",options:[],defaultValue:t,onchange:"onTerminalItemChange"};n.options=n.options.concat(e),widget.addPreference(n),widget.addEvent("onTerminalItemChange",this.onTerminalItemChange.bind(this)),this.setTerminalItemValue(null,widget.getValue(o.FINAL_ITEM_VALUE_NAME))},onTerminalItemChange:function(e,t){this.app.core.PreferencesManager.setTerminalItemValue(t),widget.dispatchEvent("onEdit")},setTerminalItemValue:function(e,t){e=e||widget.getValue(o.FINAL_ITEMS_PREF);var n={name:o.FINAL_ITEM_VALUE_NAME,label:o.FINAL_ITEM_VALUE_LABEL};if(e===o.FINAL_ITEMS_DEFAULT)return n.type="hidden",widget.setValue(o.FINAL_ITEM_VALUE_NAME,""),void widget.addPreference(n);var i="",r=this.app.core.dicoService.getTerminalAttributesInfo(e);if(!r)return;var s=r.rangeValues?r.rangeValues:r.AuthorizedValues;r.defaultValue=r.Default;var a=r.Type?r.Type:r.kind;const l=this.app.core.i18nManager.get("eng.const.true"),c=this.app.core.i18nManager.get("eng.const.false");s&&s.length>0?(n.type="list",n.options=[],i=t||r.defaultValue,s.forEach(function(e){var t=e;"boolean"==a.toLowerCase()&&("TRUE"!=e||e.nlsValue?"FALSE"!=e||e.nlsValue||(t=c):t=l),n.options.push({label:e.nlsValue?e.nlsValue:t,value:e.value?e.value:e})})):"boolean"!=a.toLowerCase()||s&&s.length>0?(n.type="text",n.options=[],i=t||(r.defaultValue?r.defaultValue:""),n.onchange="onValidate"):(n.type="list",n.options=[],i=t||r.defaultValue,n.options.push({label:l,value:"true"},{label:c,value:"false"})),widget.setValue(o.FINAL_ITEM_VALUE_NAME,i),widget.addPreference(n),widget.addEvent("onValidate",this.onValidate.bind(this))},onValidate:function(e,t){var n=this.app.core.dicoService.getTerminalAttributesInfo(widget.getValue(o.FINAL_ITEMS_PREF)).type,i=t;return"Integer"===n?i=parseInt(t):"Real"===n&&(i=parseFloat(t)),i&&t===i.toString()?void 0:void console.log("Invalid Value")},onChangeControl:function(e,t){let n=widget.getValue(o.CHANGECONTROL_SHOW_STATE),i=widget.getValue(o.CHANGECONTROL_POSITION);!0===n?widget.addPreference({name:o.CHANGECONTROL_POSITION,defaultValue:i,type:"list",label:"eng.chgCtrl.Position",options:s}):widget.addPreference({name:o.CHANGECONTROL_POSITION,type:"hidden"}),widget.dispatchEvent("onEdit",{name:e,value:t})},getNLSValueForMassQuantity:function(){var e=this.dimensions[o.DIMENSION_MASS]&&this.dimensions[o.DIMENSION_MASS].Units&&Array.isArray(this.dimensions[o.DIMENSION_MASS].Units)?this.dimensions[o.DIMENSION_MASS].Units.find(e=>e.Name===widget.getValue(o.PREFERRED_MASS_UNIT)):null;return null!=e?e.NLSName:""},getNLSValueForVolumeQuantity:function(){var e=this.dimensions[o.DIMENSION_VOLUME]&&this.dimensions[o.DIMENSION_VOLUME].Units&&Array.isArray(this.dimensions[o.DIMENSION_VOLUME].Units)?this.dimensions[o.DIMENSION_VOLUME].Units.find(e=>e.Name===widget.getValue(o.PREFERRED_VOLUME_UNIT)):null;return null!=e?e.NLSName:""},getNLSValueForAreaQuantity:function(){var e=this.dimensions[o.DIMENSION_AREA]&&this.dimensions[o.DIMENSION_AREA].Units&&Array.isArray(this.dimensions[o.DIMENSION_AREA].Units)?this.dimensions[o.DIMENSION_AREA].Units.find(e=>e.Name===widget.getValue(o.PREFERRED_AREA_UNIT)):null;return null!=e?e.NLSName:""},getNLSValueForLengthQuantity:function(){var e=this.dimensions[o.DIMENSION_LENGTH]&&this.dimensions[o.DIMENSION_LENGTH].Units&&Array.isArray(this.dimensions[o.DIMENSION_LENGTH].Units)?this.dimensions[o.DIMENSION_LENGTH].Units.find(e=>e.Name===widget.getValue(o.PREFERRED_LENGTH_UNIT)):null;return null!=e?e.NLSName:""},getDefaultUnit:function(e,t){return widget.getValue(e)?widget.getValue(e):this.dimensions[t].MKSUnit},getTerminalItem:function(){return widget.getValue(o.FINAL_ITEMS_PREF)},onSetVolumeUnit:function(e,t){widget.setValue(o.PREFERRED_VOLUME_UNIT,t)},onSetMassUnit:function(e,t){widget.setValue(o.PREFERRED_MASS_UNIT,t)},onSetAreaUnit:function(e,t){widget.setValue(o.PREFERRED_AREA_UNIT,t)},onSetLengthUnit:function(e,t){widget.setValue(o.PREFERRED_LENGTH_UNIT,t)},onSetTenant:function(e,t){this.app.core.settingManager.switchPlatformId(t),widget.dispatchEvent("onEdit"),r.warningAlert(this.app.core.i18nManager.get("eng.platform.changed.msg"))},isSpecificationsTabEnabled:function(){return widget.getValue(o.CONST_DOC_AS_SPEC)},isSpecInProductStructureEnabled:function(){return widget.getValue(o.CONST_DOC_AS_SPECS)},removePreferences:function(e){let t=widget.getPreferences();e.forEach(e=>{let n=t.findIndex(t=>t.name==e);-1!=n&&t.splice(n,1)}),widget.setPreferences(t)},isUserSelectedTypeChooserOption:function(){return widget.getValue(o.PREFERENCE_TYPE_CHOOSER)}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitTreeNodeService",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitGroupModes","DS/Tree/TreeNodeModel"],(e,t)=>{const n="Unit";return class{constructor(e){this.viewContext=e}buildGroupNoneUnitsNode(t,n){return this.buildGroupNodeByQuantities(t,e.groupUnitIndexesNone,n)}buildGroupEqualQtyUnitsNode(t,n){return this.buildGroupNodeByQuantities(t,e.groupUnitIndexesByQuantity,n)}buildGroupNextEqualQtyUnitsNode(t,n){return this.buildGroupNodeByQuantities(t,e.groupUnitIndexesByNextQuantity,n)}computeQuantityLabelForGroupUnit(e,t,n){if(!Array.isArray(e)||!e.length)return"";const[i]=e;return this.computeQuantityLabelForUnit(i,t,n)}buildUnitTreeNode(e,n){return new t({label:e,grid:{"unit-quantity":n},children:[]})}buildGroupNodeByQuantities(e,t,n){if(!e||!e.size||"function"!=typeof t)return[];const i=t(e);return Array.isArray(i)?this.buildUnitNodesFromGroupUnits(i,e,n):[]}buildUnitNodesFromGroupUnits(e,t,n){return Array.isArray(e)&&e.length?e.map(({value:e})=>this.buildUnitNodeFromUnitIndexes(e,t,n)):[]}buildUnitNodeFromUnitIndexes(e,t,n){if(!Array.isArray(e)||!e.length)return[];let i=[];if(e.length>1){const r=this.computeQuantityLabelForGroupUnit(e,t,n);i=this.buildUnitsNode(e,t,r,n)}else if(1===e.length){const[r]=e;i=this.buildUnitNode(r,t,n)}return i}buildUnitsNode(e,t,i,r){const o=this.computeMinMaxLabelFromUnits(e),s=`${n}${o}`,a=this.buildUnitTreeNode(s,i);return e.forEach(e=>{const n=this.buildUnitNode(e,t,r);a.addChild(n)}),a}buildUnitNode(e,t,i){const r=`${n}[${e}]`,o=this.computeQuantityLabelForUnit(e,t,i),s=this.buildUnitTreeNode(r,o),{model:a}=this.viewContext;return this.getUnitNodeChildren(e,t,i).forEach(e=>{const t=a.duplicateNode(e);s.addChild(t)}),s}computeMinMaxLabelFromUnits(t){if(!Array.isArray(t)||!t.length)return"";const n=t.sort((e,t)=>e-t),i=[];let r=[];return n.forEach(t=>{r.length?e.isUnitNextContinous(t,r)?r.push(t):(i.push(r),r=[t]):r.push(t)}),i.push(r),i.reduce((e,t)=>e+(1===t.length?`[${t[0]}]`:`[${t[0]}-${t[t.length-1]}]`),"")}computeQuantityLabelForUnit(e,t,n){const i=this.getUnitNodeChildren(e,t,n),{model:r}=this.viewContext;return r.getRollup(i,{useReference:!0})}getUnitNodeChildren(e,t,n){return t.get(e).map(e=>n.get(e))}}}),define("DS/ENOXEngineer/componentsHelpers/CollectionView/DragAndDropRejectionView",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","text!DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXENIssuesList.html"],function(e,t,n,i,r,o){"use strict";var s=i.compile(o);return i.registerHelper("inc",function(e,t){return parseInt(e)+1}),t.extend({defaultOptions:{},init:function(e){this._parent(e);this.onAcceptAndIgnore=e.onAcceptAndIgnore,this.onCancel=e.onCancel,this.issues=e.issues,this.allFailed=e.allFailed,this.isResolved=!1,this.nlsService=e.nlsService||{get:function(e){return e}},this.buildView()},_isGlobalRendering:function(){if(!Array.isArray(this.issues))return!0;for(var e=0;e<this.issues.length;e++){if(this.issues[e].isGlobal)return!0}return!1},buildView:function(){var e=this,t=this._isGlobalRendering();this._buildModal().getBody().setHTML(s({items:this.issues,isGlobal:t,notGlobal:!t,nls_object_info:this.nlsService.get("object.description"),nls_reason:this.nlsService.get("issuse.description")})),this.modal.onValidate(function(t){e.onAcceptAndIgnore(),e.isResolved=!0,t(),e.destroyView()},this),this.modal.onClose(function(){!e.isResolved&&e.onCancel(),e.destroyView(),console.warn("onClose")},this),this.modal.show()},_getModalTitle:function(){return this._isGlobalRendering()?this.nlsService.get("eng.ui.dialog.inValidDrop"):this.allFailed?this.nlsService.get("eng.ui.dialog.allDropContentInvalidData"):this.nlsService.get("eng.ui.dialog.dropContentInvalidData")},_buildModal:function(){var e=this;return this.modal=new r({title:this._getModalTitle(),className:"xeng-dnd-rejection",withFooter:!0,customFooter:function(){return e.allFailed||e._isGlobalRendering()?"<button type='button' name='cancelButton' class='btn btn-default'>"+e.nlsService.get("eng.ui.button.cancel")+"</button>":"<button type='button' name='okButton' class='btn btn-primary'>"+e.nlsService.get("eng.ui.button.continueAndIgnore")+"</button> <button type='button' name='cancelButton' class='btn btn-default'>"+e.nlsService.get("eng.ui.button.cancel")+"</button>"}}),this.modal},destroyView:function(){this.onAcceptAndIgnore=null,this.onCancel=null,this.issues=null,this.modal&&this.modal.destroy(),this.modal=void 0}})}),define("DS/ENOXEngineer/controllers/RecentsEngItemsController",["DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineer/componentsHelpers/GridViewConfigurator/GridViewConfigurator","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return function(i){var r=this;if(this.recentsCmp=null,r.isFirstRendering=!0,!i)throw new Error("options are mandatory");if(!i.app||!i.parentController)throw new Error("app and parentController are mandatory");var o=i.parentController,s=i.app;return{activate:function(){s.mediator.publish(n.EVENT_SELECT_ACTION_WP,{id:"recent_items"}),s.mediator.publish(n.EVENT_TRIPTYCH_SHOW_PANEL,"left"),r.isFirstRendering?(r.isFirstRendering=!1,e.mask(UWA.extendElement(o.triptychCmp.mainDiv)),r.recentsCmp=s.componentsMgt.startNewInstance(n.MY_ENG_ITEM_CMP,o.triptychCmp.mainDiv,t.recentsEngItemsConfigurator())):(r.recentsCmp.reRender(),s.mediator.publish(n.EVENT_REFRESH_LANDING_DATA))},deactivate:function(){r.recentsCmp.stop()}}}}),define("DS/ENOXEngineer/utils/expand/MultiCV2PayloadFactory",["UWA/Core","DS/ENOXEngineer/utils/expand/CV2PayloadFactory","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/expand/ProgressiveExpand","DS/ENOXEngineer/utils/expand/ExpandPayloadFactoryUtils"],(e,t,n,i,r)=>{return class extends t{get name(){return n.COMMAND_WS_MULTIEXPAND_V2}get entries(){return[...super.entries,...r.defaultMultiProperties]}set label(e){this.addEltToUpdate(this.query.batch,()=>{const{expands:t}=this.query.batch;t.length||t.push(new i.Expand),t.forEach(t=>t.label=e)})}set max_count_path(e){this.addEltToUpdate(this.query.batch,()=>{const{expands:t}=this.query.batch;t.length||t.push(new i.Expand),t.forEach(t=>{let n=e;Number.isInteger(e)||(n=Number.parseInt(e,10)),t.parameters.limit_max_path=n})})}set synthesis_mode(e){Reflect.has(i.ENUM_FACET_MODE,e)?this.addEltToUpdate(this.query.batch,()=>{const{expands:t}=this.query.batch;t.length||t.push(new i.Expand),t.forEach((t,n)=>{const r=new i.Aggregation_Processor;t.aggregation_processors.push(r),r.synthesis.name=`synthesis${n.toString()}`,r.synthesis.mode=e,r.synthesis.group_by_facet=1,r.synthesis.synthesis_only=1,this.query.outputs.synthesis.push(r.synthesis.name),this.query.outputs.facet_name="ds6w"})}):console.error(`synthesis_mode unknown mode ${e}`)}set union(e){const{expand:t}=e||{};t.forEach(e=>{this.query.batch.expands.push(new i.Expand),Reflect.ownKeys(e).forEach(t=>{super[t]=e[t]})})}extractTagsFromCVQueryV2IfValuated(e,t=["filter","aggregation_processors"]){if(!e||!Array.isArray(t))return null;const{batch:n}=e||{},{expands:i}=n||{};let r=null;Array.isArray(i)&&1===i.length&&([r]=i);const o={};return t.forEach(t=>{let n=null;Reflect.has(e,t)?n=e:r&&Reflect.has(r,t)&&(n=r);const i=n?n[t]:null;Array.isArray(i)&&i.length?o[t]=i:!Array.isArray(i)&&i&&(o[t]=i)}),Reflect.ownKeys(o).length?o:null}updatePayloadWithEntries(e,t){if(e&&t&&Reflect.has(t,"CVQueryV2")){const{CVQueryV2:n}=t,i=this.extractTagsFromCVQueryV2IfValuated(n);Reflect.ownKeys(i).forEach(t=>{const n=i[t];if("filter"===t)this.updatePayloadWithFilter(e,n);else{const{expands:i}=e.batch;i.forEach(e=>{e[t]=n})}})}}updatePayloadWithFilter(e,t){if(!e||!t)return;const{expands:n}=e.batch;n.forEach(e=>{const{filter:n}=e;if(n){const{and:i}=n;if(i){const{filters:e}=i;e.push({and:{filters:[t]}})}else e.filter={and:{filters:[n,t]}}}else e.filter=t})}updateAnswer(e){e&&!Reflect.has(e,"facets")&&Object.defineProperty(e,"facets",{get(){const{results:t}=e;if(!Array.isArray(t)||!t.length)return null;const{synthesis:n}=t[0]||{};return n&&Array.isArray(n.facets)?n.facets:null}})}}}),define("DS/ENOXEngineer/utils/ExpandPayloadFactory",["UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/expand/MultiCV2PayloadFactory","DS/ENOXEngineer/utils/expand/MultiCVPayloadFactory","DS/ENOXEngineer/utils/expand/CV2PayloadFactory","DS/ENOXEngineer/utils/expand/CVPayloadFactory","DS/ENOXEngineer/utils/expand/DBPayloadFactory"],(e,t,n,i,r,o,s)=>{const a=e=>{const t=Reflect.getPrototypeOf(e);e.entries.forEach(n=>{Reflect.has(e,n)||Object.defineProperty(e,n,{set(e){console.warn(`${t.name} => ${n} not implemented`)}})})};class l{static getInstance(l){let c=null;switch(l){case t.COMMAND_WS_MULTIEXPAND_V2:c=new n;break;case t.COMMAND_WS_MULTIEXPAND:c=new i;break;case t.COMMAND_WS_EXPAND_CV_V2:c=new r;break;case t.COMMAND_WS_EXPAND_CV:c=new o;break;case t.COMMAND_WS_EXPAND_DB:c=new s}return e.is(c)&&a(c),c}static convertPayloadTo(e,t){if("object"!=typeof e)throw new Error("invalid payload input");const n=l.getInstance(t);if(!n)throw new Error(`unknown executorType ${t}`);Reflect.ownKeys(e).forEach(t=>{n[t]=e[t]});const i=n.json,{v2PayloadEntriesToAdd:r}=e;return Array.isArray(r)&&r.length&&r.forEach(e=>n.updatePayloadWithEntries(i,e)),i}static postTreatAnswer(e,t){if("object"!=typeof e)throw new Error("invalid payload input");const n=l.getInstance(t);if(!n)throw new Error(`unknown executorType ${t}`);n.updateAnswer(e)}}return l}),define("DS/ENOXEngineer/componentsHelpers/SecurityContextChooser/SCChooser",["DS/UIKIT/Input/Select","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","css!DS/ENOXEngineer/componentsHelpers/SecurityContextChooser/SCChooser.css"],function(e,t,n){"use strict";function i(e){this.SCManager=e.SCManager,this.resolve=e.resolve,this.reject=e.reject,this.buildView()}return i.prototype._buildModal=function(){return this.modal=new t({title:n.get("eng.ui.dialog.chooseSC"),className:"xeng-sc-chooser",withFooter:!0}),this.modal},i.prototype._getModalContent=function(){var t=this.SCManager.getSCPreference(),i=t&&Array.isArray(t.options)?t.options:[];return this.selector=new e({placeholder:n.get("eng.ui.dialog.SC.list"),options:i,events:{onChange:this.onChange.bind(this)}}),this.selector},i.prototype.onChange=function(){console.log(this.selector.getValue()),0===this.selector.getValue()[0].trim().length?this.disableValidateBtn():this.isDisableFooter()&&this.enableValidateBtn()},i.prototype.removeCancelBtn=function(){var e=document.body.querySelector('button[name="cancelButton"]');null!==e.parentNode&&e.parentNode.removeChild(e)},i.prototype.disableValidateBtn=function(){var e=document.body.querySelector('button[name="okButton"]');e&&(e.disabled=!0)},i.prototype.isDisableFooter=function(){var e=document.body.querySelector('button[name="okButton"]');return!!e&&e.disabled},i.prototype.enableValidateBtn=function(){var e=document.body.querySelector('button[name="okButton"]');e&&(e.disabled=!1)},i.prototype.buildView=function(){var e=this;this._getModalContent().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){var n=this.selector.getValue()[0];widget.setValue("SC",n),e.resolve&&e.resolve(n),t()},this),this.modal.onClose(function(){e.modal.show()},this),this.modal.show(),this.removeCancelBtn(),this.disableValidateBtn()},i}),define("DS/ENOXEngineer/services/EngineeringSettings",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/ENOXWidgetPreferences/js/ENOXWidgetPreferences","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/XENPlatform3DXSettings","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXEngineer/utils/xEngPnOSCChoiceMngt","DS/ENOXEngineer/componentsHelpers/SecurityContextChooser/SCChooser","DS/WebappsUtils/WebappsUtils","DS/ENOXEngineer/componentsHelpers/CollectionView/DragAndDropRejectionView","text!DS/ENOXEngineer/assets/config/xEngineer.conf.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g){"use strict";var h=JSON.parse(g);return t.singleton(n,o,{getSetting:function(t){return e.is(t,"string")&&e.is(h[t])?h[t]:null},_getUserPrefKey:function(e){return this.getPlatformId()+"_"+e},getIconUrl:function(e){return this.getIconPath(e)},getIconPath:function(e){return u.getWebappsAssetUrl("ENOXEngineer","icons/32/"+e+".png")},getLoadingIcon:function(){return this.getImagePath("loading22x22.gif")},getImagePath:function(e){return u.getWebappsAssetUrl("ENOXEngineer","img/"+e)},getNlsStorageName:function(){return r.NLS_STORAGE_NAME+"_"+this.getLanguage()},getPredicatesNlsStorageName:function(){return r.PREDICATE_NLS_STORAGE_NAME+this.getPlatformId()+"_"+this.getLanguage()},get3DXContentFromDrop:function(e){if(!e||!e.data||!Array.isArray(e.data.items))throw"Dopped data are not valid";return e.data.items},getAppConfigLabel:function(e){var t="",n=e?" (":"";return this._platforms&&Object.keys(this._platforms).length>1&&(t=n+this.getPlatformId()+")"),this.app.core.isInExperimentalLabMode()&&(t+=" "+this.app.core.i18nManager.get("eng.app.in.experimentalLab")),t},isWorkingUnderEvolution:function(){if(!l)return!1;var e=l.get();return e&&e.evolution&&e.evolution.id&&e.evolution.id.length>1},resetWorkUnderBubble:function(){l&&l.cleanAuthDetails()},droppedDataFilter:function(e,t,n){var i=this;return a.wrappedWithPromise(function(r,o){if(!Array.isArray(t))return o(i.app.core.i18nManager.get("error.expect.array.checker"));for(var s=n||"OPEN",l=0;l<t.length;l++){if("function"!=typeof(u=t[l]))return o(i.app.core.i18nManager.get("error.expect.array.ofFunction.checker"))}if(!e.data||!Array.isArray(e.data.items))return o(i.app.core.i18nManager.get("error.dropped.not.inright.format"));e.data.items.forEach(t=>{t.biProxyCtx=e.biProxyCtx});var c=[],d={invalids:[],valids:e.data.items};for(l=0;l<t.length;l++){var u=t[l];c.push(u.call(i,e.data.items,s,d))}a.all(c).then(function(){if(d.invalids.length>0){new p({issues:d.invalids,allFailed:0===d.valids.length,nlsService:i.app.core.i18nManager,onAcceptAndIgnore:function(){r(d.valids)},onCancel:function(){o()}})}else r(d.valids)}).catch(function(e){o(e)})})},isSetValidSelectionForOpen:function(e){var t=this;return a.wrappedWithPromise(function(n,i){if(!e)return i("no_selection");try{var o=JSON.parse(e),a=t.get3DXContentFromDrop(o);if(!Array.isArray(a)||1!==a.length)return s.errorAlert(t.app.core.i18nManager.get("error.tooMany.items.selected.forOpen")),i("error.tooMany.items.selected.forOpen");switch(a[0].objectType){case r.TYPE_ADVANCED_FILTER:t.app.core.Factories.ListItemFactory.getRootItemFromFilter(a[0]).then(function(e){let s=e[0];t.app.core.sessionManager.setNGFilterContextForNextOpen(s),o.data.items[0].objectId=s.rootId,o.data.items[0].objectType=r.TYPE_VPMREFERENCE,t.retrieveValidItemsForOpenFromDrop(o).then(function(e){n(e[0])}).catch(function(e){i("unmanaged_type_for_open")})}).catch(function(e){i("unmanaged_type_for_open")});break;default:t.retrieveValidItemsForOpenFromDrop(o).then(function(e){n(e[0])}).catch(function(e){i("unmanaged_type_for_open")})}}catch(e){return s.errorAlert(t.app.core.i18nManager.get("error.parse.3DXContent.failed")),i("error.parse.3DXContent.failed")}})},retrieveAllValidContentForXENFromDrop:function(e){return this.droppedDataFilter(e,[this._tenantChekerV2,this._typeComplianceChecker],"BOM")},retrieveValidItemsForOpenFromDrop:function(e){return this.droppedDataFilter(e,[this._tenantChekerV2,this._typeComplianceChecker,this._nbDroppedItemsChecker],"OPEN")},retrieveAllValidDocumentsFromDrop:function(e){return this.droppedDataFilter(e,[this._tenantChekerV2,this._typeComplianceChecker],"DOC")},_buildIssueEntry:function(e,t){var n="";return e.isGlobal||(n=this.app.core.i18nManager.replace(this.app.core.i18nManager.get("error.objectDescription"),{displayName:e.displayName,type:e.displayType})),{reason:t,isGlobal:e.isGlobal,source:e.serviceId,type:e.objectType,infos:n}},_nbDroppedItemsChecker:function(e,t,n){var i=this;return a.wrappedWithPromise(function(r,o){"OPEN"===t&&1!==e.length&&(n.invalids.push(i._buildIssueEntry({isGlobal:!0},i.app.core.i18nManager.get("error.drop.for.open.dont.support.multi"))),e.splice(0,e.length)),r(!0)})},_tenantChekerV2:function(e,t,n){var i=this,r=i.getPlatformId();return a.wrappedWithPromise(function(t,o){for(var s=0;s<e.length;s++){let t=e[s].envId;if(null!=t&&""!==t||(t=i.getPlatformId()),t!==r&&!i.switchPlatformId(t)){let t=i.app.core.i18nManager.replace(i.app.core.i18nManager.get("error.not.belong.toThePlatform"),{displayName:e[s].displayName,tenant:r});n.invalids.push(i._buildIssueEntry(e[s],t)),e.splice(s,1),s--}}t(!0)})},_getBOMContentTypes:function(e,t,n){var i=this;return this._genericDropTypeChecker(e,t,n,function(e){return i.app.core.dicoService.syncIsAnEngineeringItem(e.objectType)||i.app.core.dicoService.syncIsADocument(e.objectType)||i.app.core.dicoService.syncIsAMaterial(e.objectType)||i.app.core.dicoService.syncIsADrawing(e.objectType)})},_getAllOpenableItem:function(e,t,n){var i=this;return this._genericDropTypeChecker(e,t,n,function(e){return i.app.core.dicoService.syncIsAnEngineeringItem(e.objectType)||i.app.core.dicoService.isSavedFilter(e.objectType)})},_getAllAttachments:function(e,t,n){var i=this;return this._genericDropTypeChecker(e,t,n,function(e){return i.app.core.dicoService.syncIsADocument(e.objectType)||i.app.core.dicoService.syncIsADrawing(e.objectType)})},_genericDropTypeChecker:function(e,t,n,i){var r=this,o=this.app.core.dicoService;return a.wrappedWithPromise(function(s,a){if(!Array.isArray(e)||"function"!=typeof i)throw new Errow("invalid inputs");var l=e.map(function(e){return e.objectType});o.getRootTypes(l).finally(function(){for(var o=0;o<e.length;o++){const s=e[o];if(!i(s)){var a=r.app.core.i18nManager.replace(r.app.core.i18nManager.get("error.not.supported.type"),{type:s.displayType,operation:r.app.core.i18nManager.get("eng."+n)});t.invalids.push(r._buildIssueEntry(s,a)),e.splice(o,1),o--}}s(!0)})})},_typeComplianceChecker:function(e,t,n){switch(t){case"BOM":return this._getBOMContentTypes(e,n,t);case"OPEN":return this._getAllOpenableItem(e,n,t);case"DOC":return this._getAllAttachments(e,n,t);default:return this._getAllOpenableItem(e,n,t)}},isConfigAuthorized:function(){return!(!this.isConfigRoleGranted()||!this.isDecouplingActivated())},isDecouplingActivated:function(){for(var e=this.app.core.dataService.getConfigSettings(),t=null,n=0;n<e.length;n++)if("decoupleVariantEvolution"===e[n].settingName){t=e[n];break}return!(!t||"enabled"!=t.value)},isProductConfEnabled:function(){if(this.app&&this.app.core&&this.app.core.dataService){for(var e=this.app.core.dataService.getConfigSettings(),t=null,n=0;n<e.length;n++)if("StaticMappingActivation"===e[n].settingName){t=e[n];break}return t&&"enabled"==t.value}return!1},isAuthorizedTypeOnDrop:function(e,t,n){var i=this.app.core.dicoService;switch(t){case"BOM":return i.areBOMContentTypes(e,n);case"OPEN":return i.areEngeeringItems(e,n);case"DOC":return i.areDocuments(e,n);default:return i.areEngeeringItems(e,n)}},getAppId:function(){try{return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENXENG_AP"}catch(e){return"ENXENG_AP"}},getCommand:function(t){return e.is(t,"string")&&e.is(h.commands[t])?h.commands[t]:null},getCVRequestLabel:function(){return this.app.core.i18nManager.get("APP_NAME")+"-"+this.getCurrentUser().id+"-"+(new Date).getTime()},getUserImage:function(e){return this.getServiceURL(r.SERVICE_3DSWYM_NAME)+"/api/user/getpicture/login/"+e+"/format/normal"},get3DswymUrl:function(){return this.getServiceURL(r.SERVICE_3DSWYM_NAME)},getSecurityContext:function(){return widget.getValue("SC")},securityContextPromise:null,retrieveSecurityContextAndFillWidgetPref:function(e){var t=this;return this.scChooserHelper=new c(e),a.wrappedWithPromise(function(e,n){t.scChooserHelper.RetrieveSCListAndPrefered({callback:function(i){if(i){var r=t.scChooserHelper.getSCPreference("eng.user.credentials.chooser");widget.addPreference(r);var o=t.setSecurityContextOnWidget(r.options,widget.getValue("SC"));if(o)return e(!0);var s=t.scChooserHelper.getSCPreferred(o);if(s)return s&&widget.setValue("SC",s),e(!0);new d({SCManager:t.scChooserHelper,resolve:e,reject:n})}else n(!1)}})})},setSecurityContextOnWidget:function(e,t){if(t)for(let n in e)if(e[n].value==t)return widget.setValue("SC",t)},initialize:function(e){this.logger=e.core.logger.get("Setting manager");var t=this;return this.app=e,e.core.isConfigAuthorized=e.sandboxBase.isConfigAuthorized=t.isConfigAuthorized.bind(t),e.core.settingManager=t,widget.getValue("x3dAppId")||widget.setValue("x3dAppId","ENXENG_AP"),a.wrappedWithPromise(function(n,i){t.discoverRelated3DXPlatform().then(function(){let r=t.app.core.settingManager.getPlatformId();widget&&r&&(widget.setValue("x3dPlatformId",r),widget.setValue("tenantAware",!0)),t.securityContextPromise=t.retrieveSecurityContextAndFillWidgetPref({url:t.getDefault3DSpaceUrl(),platforminstance:r}),e.mandatoryStartupPromises.push(t.securityContextPromise),t.securityContextPromise.then(function(){return n()}).catch(function(e){t.logger.error("unable to retrieve SecurityContext"),i(e)})}).catch(function(e){throw i(e),new Error(e)})})},getDefaultSelectionMode:function(){return r.SELECT_MODE_CELL},isIndexModeEnabled:function(){return widget.getValue(r.PREFERENCE_USE_INDEX)},getRevisionsCommandCustomization(){let e=this;return{VersionExplorerCustomization:[function(){versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenVersion",function(e){return!0}),versionExplorer.subscribeEvent("ENOXVersionExplorerOpenVersion",function(e){customizations[1](e)},!1)}.toString(),function(t){if(!t)return;let n=t.options.id,i=t.options.grid.type||"VPMReference";e.app.core.mediator.publish(r.EVENT_LAUNCH_COMMAND,{commandId:r.OPEN_ENG_ITEM,context:{item:{objectId:n,objectType:i}}})}]}}})}),define("DS/ENOXEngineer/utils/XENHttpClient",["UWA/Core","DS/ENOXEngineerCommonUtils/XENGenericHttpClient","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return Object.assign(e.clone(t,!0),{decorateWithAddtionnaloptions:function(e,t){t.noSecurityContextNeeded||t.targetService!==i.SERVICE_3DSPACE_NAME||(e.headers.SecurityContext=encodeURIComponent("ctx::"+n.getSecurityContext()),e.headers.SecurityToken=encodeURIComponent(n.getSecurityToken()))},buildUrl:function(e){var t=n.getServiceURL(e.targetService);return n.isTenantBasedService(e.targetService)?t=this.decorateUrlWithTenant(t+e.url):t+=e.url,e.sc_tenant_in_url&&(t=this.decorateUrlWithSecuritycontext(t)),e.queryParameters&&(t=this.decorateUrlWithQueryParameters(t,e.queryParameters)),t},decorateUrlWithTenant:function(e){var t=e||"",i=t.indexOf("?");return t=i>-1?t+"&tenant="+n.getPlatformId():t+"?tenant="+n.getPlatformId()},decorateUrlWithSecuritycontext:function(e){var t=n.getSecurityContext(),i=e||"";if(e&&t&&t.length>0){var r=i.indexOf("?");i=r>-1?i+"&SecurityContext="+encodeURIComponent("ctx::"+n.getSecurityContext()):i+"?SecurityContext="+encodeURIComponent("ctx::"+n.getSecurityContext())}return i},decorateUrlWithQueryParameters:function(e,t){if("string"==typeof e&&Array.isArray(t)){e+=`&${t.join("&")}`}return e}})}),define("DS/ENOXEngineer/services/ExportService",["UWA/Class","UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o){"use strict";return e.singleton({initialize:function(e){this.app=e,e.core.exportService=this},_completePayload:function(e){var t=this;return n.wrappedWithCancellablePromise(function(n,i){if(!e)throw new Error("invalid input");var r=e.PersistentFilterCriteria&&e.PersistentFilterCriteria.filterData;if(!r)return n();var o=!(!e.PersistentFilterCriteria.filterData||!e.PersistentFilterCriteria.filterData.CVQuery)&&e.PersistentFilterCriteria.filterData.CVQuery;if(o&&o.union&&o.union.expand)for(var s=0;s<o.union.expand.length;s++)e.PersistentFilterCriteria.filterData.CVQuery.union.expand[s].expand_iter="Direct"==e.Components?"1":"-1";if(r?e.PersistentFilterCriteria.filterData.filterBinary:null)return n();t.app.core.dataService.createVolatileFilter(t.app.core.contextManager.getActiveEngItem()).then(function(t){e.PersistentFilterCriteria.filterData.filterBinary=t?t.filterBinaryForExpand:null,n()}).catch(function(e){console.error(e),n(null)})})},expandForQualifiedAsFinal:function(e,i){if(t.is(e)){var r=this,s=this.app.core.contextManager.getActiveEngItem();if(!s)return;var a=widget.getValue(o.FINAL_ITEMS_PREF),l=this.app.core.contextManager&&null!=this.app.core.contextManager.getActiveEngItemOpenContext()?this.app.core.contextManager.getActiveEngItemOpenContext().filteringContext:"";l=""!=l&&"none"!=l;var c=!!s.getPreferedAttachedConfigModel(),d=this.app.core.settingManager.getCommand("qualifiedAsFinal"),u=widget.getValue("ShowNotInBOM"),p=null==u||null==u?"true":u;d.url.contains("?root3DSpaceUrl")||(d.url=d.url+"?root3DSpaceUrl="+this.app.core.settingManager.getDefault3DSpaceUrl());var g={physicalid:e,Authored:!1,PersistentFilter:l,PersistentFilterCriteria:this.app.core.contextManager.getActiveEngItemOpenContext(),PreferredFinalItem:a,ShowNotInBOM:p+"",ConfiguredMode:c};return n.wrappedWithCancellablePromise(function(t,n){r._completePayload(g).then(function(){var n=g.PersistentFilterCriteria.filterData&&g.PersistentFilterCriteria.filterData.filterBinary?g.PersistentFilterCriteria.filterData.filterBinary:"";g.PersistentFilter&&"nextGenFilter"==g.PersistentFilterCriteria.filteringContext?t(r.expandForQualifiedAsFinalItemsUsingMultiExpand(e,n,"-1",g,i)):t(r.expandForQualifiedAsFinalItems(e,n,"-1",!0,i))})})}},expandForQualifiedAsFinalItemsUsingMultiExpand:function(e,t,r,o,s){var a=this,l=o.PersistentFilterCriteria.filterData.CVQuery,c=a.app.core.dicoService.getAvailableAttributesByType("VPMReference").map(function(e){return e.sixWTag});a.app.core.settingManager.getSetting("select_predicate").forEach(e=>{-1===c.indexOf(e)&&c.push(e)}),c.push("ds6w:globalType");var d=a.app.core.settingManager.getSetting("select_rel");l.select_bo=c,l.select_rel=d,l.compute_select_bo=a.app.core.settingManager.getSetting("compute_select_bo"),l.label=a.app.core.settingManager.getCVRequestLabel();var u=this.app.core.settingManager.getCommand("multiexpand");return n.wrappedWithCancellablePromise(function(e,t){i.perform(u,JSON.stringify(l)).then(function(n){a._processQualifiedAsFinalExpandResponse(n,e,t,s)}).catch(function(e){var n=e&&e.error&&e.error.message?e.error.message:e;n=e&&e.response&&e.response.message?e.response.message:n,t(n)})})},expandForQualifiedAsFinalItems:function(e,r,o,s,a){if(t.is(e)){var l=this.app.core.settingManager.getCommand("db_expand"),c=this.app.core.dataService.getExpandPayload(e,r,o,s,!1),d=this;return n.wrappedWithCancellablePromise(function(e,t){i.perform(l,JSON.stringify(c)).then(function(n){d._processQualifiedAsFinalExpandResponse(n,e,t,a)}).catch(function(e){var n=e&&e.error&&e.error.message?e.error.message:e;n=e&&e.response&&e.response.message?e.response.message:n,t(n)})})}},_processQualifiedAsFinalExpandResponse:function(e,t,n,i){if(e&&e.results&&(!Array.isArray(e.results)||0===e.results.length))return t([]);this.app.core.Factories.ListItemFactory.getListNodesFromServerExpand(e,i).then(function(e){return t(e)}).catch(function(e){n(e)})},downloadExportFile:function(e,t,s){var a=this,l={data:e};l.data.select_bo=a.app.core.dicoService.getTagsForBOWithMandatories(),l.data.select_rel=a.app.core.dicoService.getTagsForRelWithMandatories(),l.data.select_rel.push("ds6w:globalType"),l.data.compute_select_bo=a.app.core.settingManager.getSetting("compute_select_bo"),a.app.core.sessionManager.isUsingDB()&&(l.data.types=a.app.core.dicoService.getSelectedTypes(),l.data.extensions=a.app.core.dicoService.getSelectedExtensions());var c=l.data.ExportFileName,d=this.app.core.settingManager.getCommand("csrf_tocken_validation");n.wrappedWithCancellablePromise(function(e,n){i.perform(d,"").then(function(n){var d=a.app.core.settingManager.getCommand(t);a._completePayload(l.data).then(function(){d.url.contains("?root3DSpaceUrl")||(d.url=d.url+"?root3DSpaceUrl="+a.app.core.settingManager.getDefault3DSpaceUrl()+"&timezoneOffset="+(new Date).getTimezoneOffset()),i.perform(d,JSON.stringify(l.data)).then(function(e){a.downloadFile(c,e,".csv",!0)}).catch(function(t){if(t&&t.type&&t.type===o.ERROR_TYPE_TIMEOUT){let e=a.app.core.i18nManager.get("eng.generic.timedout.message.operationFailed");r.errorAlert(e)}else console.error(t),r.errorAlert(t.response);e()}).finally(function(){s.close()})})}).catch(function(e){n(e)})})},downloadFile:function(e,t,n,i){e+=n;var r="";i&&"en"!=this.app.core.settingManager.getLanguage()&&(r="\ufeff"),r+=t;var o=document.createElement("a");navigator.msSaveBlob?navigator.msSaveBlob(new Blob([r],{type:"text/csv;charset:utf-8"}),e):URL&&"download"in o?(o.href=URL.createObjectURL(new Blob([r],{type:"text/csv;charset:utf-8"})),o.style.visibility="hidden",o.setAttribute("download",e),document.body.appendChild(o),o.click(),document.body.removeChild(o)):location.href="data:application/octet-stream,"+encodeURIComponent(r)},normalizeStringInNFKDFormat:function(e){return e?e.normalize("NFKD"):e},getdefaultColumnsToExportEntireStructure:function(e){var t={},n=this.app.core.dicoService.getAvailableAttributesByType(["VPMReference"]),i={type:"string",attrName:"InstanceName",sixWTag:"InstanceName",attrNls:this.app.core.i18nManager.get("label_Instance_Name")};n.unshift(i);for(var r=["InstanceName","ds6w:description","ds6w:identifier","ds6wg:EnterpriseExtension.V_PartNumber","ds6wg:revision","ds6w:label","ds6w:type"],o=0;o<n.length;o++)r.indexOf(n[o].sixWTag)>-1&&(t[n[o].sixWTag]=n[o].attrNls);return t},getParametricalAttributesForExport:function(e){for(var t=this.app.core.dicoService.getParametricalAttributesOf(e),n=[],i=0;i<t.length;i++)n[i]=t[i].sixWTag;return n}})}),define("DS/ENOXEngineer/columnsProviders/DeformableDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"DeformableColumns"},getManagedColumnNames:function(){return[o.CONST_DEFORMABLE]},toBeUpdated:function(e){var t=!0;return e&&e[o.CONST_DEFORMABLE]&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return e.dataIndex===o.CONST_DEFORMABLE});e.splice(t,t>=0?1:0,{text:r.get(o.CONST_DEFORMABLE),dataIndex:o.CONST_DEFORMABLE,maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){if(Array.isArray(e)){var t={references:e};return i.wrappedWithCancellablePromise(function(e,i){s.perform(n.getCommand("deformable_info"),t).then(function(t){e(t)}).catch(function(e){return i(e)})})}xEngAlertManager.errorAlert("fetchData need an array as input")},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(function(e){var i={};if(t.pids.forEach(function(e){i[e]={Deformable:" "}}),Array.isArray(e.results)){var r=e.results;for(var s in r){let e=r[s],t=r[s].reference;if("success"==e.status&&e.deformedFrom["PLMEntity.V_Name"]){let n=e.deformedFrom&&e.deformedFrom.revision?e.deformedFrom.revision:"";i[t]={},i[t][o.CONST_DS6W_DEFORMABLE]=e.deformedFrom.reference,i[t][o.CONST_DEFORMABLE]=e.deformedFrom["PLMEntity.V_Name"]+" "+n}}}n({pids:i})})}})}),define("DS/ENOXEngineer/columnsProviders/AlternateDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/DocumentManagement/DocumentManagement","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"AlternateColumns"},getManagedColumnNames:function(){return["Alternate"]},toBeUpdated:function(e){var t=!0;return e&&e.Alternate&&e["ds6w:alternate"]&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return"Alternate"===e.dataIndex});e.splice(t,t>=0?1:0,{text:o.get("Alternate"),dataIndex:"Alternate",maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){if(Array.isArray(e)){var t={referenceIds:e};return r.wrappedWithCancellablePromise(function(e,i){s.perform(n.getCommand("alternate_info"),t).then(function(t){e(t)}).catch(function(e){return i(e)})})}xEngAlertManager.errorAlert("fetchData need an array as input")},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(function(e){var i={};if(t.pids.forEach(function(e){i[e]={Alternate:"","ds6w:alternate":o.get("label_no")}}),e&&"success"===e.status){var r=e.AlternateItemInfo;for(var s in r){var a=t.pids.indexOf(s),l=t.pids[a];null==i[l]&&(i[l]={}),i[l].Alternate="Yes",i[l]["ds6w:alternate"]=o.get("label_yes")}}n({pids:i})})}})}),define("DS/ENOXEngineer/columnsProviders/MadeFromDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"MadeFromColumns"},getManagedColumnNames:function(){return["MadeFrom"]},toBeUpdated:function(e){var t=!0;return e&&e.MadeFrom&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return"MadeFrom"===e.dataIndex});e.splice(t,t>=0?1:0,{text:r.get("MadeFrom"),dataIndex:"MadeFrom",maxWidth:800,minWidth:20,width:200})},_fetchData:function(e){return i.wrappedWithCancellablePromise((t,i)=>{const r=n.getCommand("madefrom_info_bulk"),s={Product_Ids:e};o.perform(r,JSON.stringify(s)).then(t).catch(i)})},updateAttributes:function(t,n){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");this._fetchData(t.pids).then(e=>{const i={};(e&&e.success&&Array.isArray(e.result)&&e.result.forEach(({Product_Id:e,MadeFromConnections:t})=>{let n=[];null==i[e]&&(i[e]={}),t.forEach(e=>{if(e){let t=e.madeFromProductTitle+" "+e.madeFromProductRevision;if(e.asRequired){let n=e.quantity&&"0"!=parseInt(e.quantity)?`, ${e.quantity} ${e.quantityUOM.nlsLabel}`:"";t+=` (${r.get("makeFromAsRequired")}${n})`}else e.quantity&&e.quantityUOM&&e.quantityUOM.nlsLabel&&(t+=` (${e.quantity} ${e.quantityUOM.nlsLabel})`);n.push(t)}}),i[e].MadeFrom=n.length>0?n.join(", "):" "}),Object.keys(i).length===t.pids.length)&&n({pids:i})}).catch(()=>{}).finally(()=>{})}})}),define("DS/ENOXEngineer/utils/Utils",["UWA/Core","UWA/Utils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/DataDragAndDrop/DataDragAndDrop","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/ExpandPayloadFactory"],(e,t,n,i,r,o,s,a,l)=>{const c={no_type_filter_rel:["XCADBaseDependency"],type_filter_rel:["PLMInstance"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"'};var d={getVersionByIdFromVersionGraph:function(e,t){return e&&e.Derived&&e["Main Derived"]?(t=t&&t.startsWith("pid:")?t:"pid:"+t,this._searchMatch(e,t)):null},_searchMatch:function(e,t){if(e.id===t)return e;if(e["Main Derived"]&&e["Main Derived"].id===t)return e["Main Derived"];if(Array.isArray(e.Derived)&&e.Derived.length>0)for(var n=0;n<e.Derived.length;n++)if(e.Derived[n].id===t)return e.Derived[n];if(Array.isArray(e.Derived)&&e.Derived.length>0){var i=[];for(n=0;n<e.Derived.length;n++)i.push(this._searchMatch(e.Derived[n],t));for(n=0;n<i.length;n++)if(i[n])return i[n]}if(Array.isArray(e["Main Derived"].Derived)&&e["Main Derived"].Derived.length>0){for(i=[],n=0;n<e["Main Derived"].Derived.length;n++)i.push(this._searchMatch(e["Main Derived"].Derived[n],t));for(n=0;n<i.length;n++)if(i[n])return i[n]}return e["Main Derived"]&&e["Main Derived"]["Main Derived"]&&e["Main Derived"]["Main Derived"].id?this._searchMatch(e["Main Derived"]["Main Derived"],t):null},loadFiles:function(e,t){return new Promise(function(t,n){var i=function(e){n(e)};Array.isArray(e)?require(e,function(){t(arguments)},i):i(e)})},getFetchTaggerColorMap:function(e){if(!Array.isArray(e)||!e.length)return{};const t={};return e.map(e=>{Reflect.has(t,e.id)||(t[e.id]=e.color)}),t},getExpandTaggerColorMap:function(e){const{tagColors:t}=e||{};if(!Array.isArray(t))return{};const n={};return t.forEach(e=>{const{predicate:t,dispValue:i,color:r,object:o}=e;if("string"!=typeof t||!t.trim().length)return;const s=t.slice(t.lastIndexOf("/")+1);n[s]||(n[s]={}),"string"==typeof i&&i.trim().length&&(n[s][i]={color:r}),"string"==typeof o&&o.trim().length&&(n[s][o]={color:r})}),n},colorizeNodeFromMap:function(t,n,i){if(!t||"string"!=typeof n||!n.trim().length||!i)throw new Error("invalid input");if(!i[n])throw console.debug(`colorizeNodeFromMap missing ${n} value in colorMap`),new Error(`colorizeNodeFromMap missing ${n} value in colorMap`);const r=t.getAttributeValue(n);if(!e.is(r))throw console.debug(`colorizeNodeFromMap missing ${n} in node ${t.getID()}`),new Error(`missing ${n} in node ${t.getID()}`,{cause:404});if(i[n][r]){const{color:e}=i[n][r]||{};e&&t.setColor(e)}},colorizeNodesStructure:function(e,t,n,i){Array.isArray(e)&&t&&n&&i instanceof Set!=!1&&Reflect.ownKeys(t).forEach(r=>{e.forEach(e=>{try{e.setColor(null),this.colorizeNodeFromMap(e,r,t)}catch(t){404===t.cause&&(n[e.getID()]=e,i.add(r))}if(!e.isExpanded()){const r=e.getChildNodes();Array.isArray(r)&&r.length&&this.colorizeNodesStructure(r,t,n,i)}})})},colorizeNodesWithCVFetch:async function(e,t,n,i){if(!(e&&Array.isArray(t)&&n&&i))return;const r=Reflect.ownKeys(e);let o=null;try{o=await this.fetchPredicatesOnIndex(r,t,i)}catch(e){return}const s=this.formatFetchPredicatesAnswer(o);s&&Reflect.ownKeys(s).length&&Reflect.ownKeys(s).forEach(t=>{const i=e[t];if(!i)return;const r=s[t];r&&Reflect.ownKeys(r).length&&Reflect.ownKeys(r).forEach(e=>{const t=r[e];if(t&&n[e][t]){i.setAttribute(e,t);try{this.colorizeNodeFromMap(i,e,n)}catch(t){console.debug(`failed to colorize node ${i.getID()} for predicate ${e}`)}}})})},colorizeNodesFromExpandTagger:async function(e,t,n){if(!Array.isArray(e)||!t||!n)return;const i={},r=new Set;if(this.colorizeNodesStructure(e,t,i,r),Reflect.ownKeys(i).length&&r.size)try{await this.colorizeNodesWithCVFetch(i,[...r.values()],t,n)}catch(e){}},formatFetchPredicatesAnswer:function(e){const{results:t}=e||{};if(!Array.isArray(t))return{};const n={};return t.forEach(e=>{let t="";const i={},{attributes:r}=e;r.forEach(e=>{const{name:n,value:r}=e;"resourceid"===n?t=r:i[n]=r}),n[t]=i}),n},fetchPredicatesOnIndex:async function(e,t,n){if(!n)return;if(!Array.isArray(e)||!e.length)return;if(!Array.isArray(t)||!t.length)return;var i={label:n.getCVRequestLabel(),physicalid:e,locale:n.getLanguage(),tenant:n.getPlatformId(),select_predicate:t,select_file:[]};let r={};try{const e=n.getCommand("cv_fetch");r=await a.perform(e,i)}catch(e){}return r},colorizeNodeFromExpandTagger:function(e,t){e&&t&&Reflect.ownKeys(t).forEach(n=>{if(!t[n])return void console.debug(`colorizeNodeFromExpandTagger missing ${n} in colorMap`);const i=e.getAttributeValue(n);if(t[n][i]){const{color:r}=t[n][i]||{};r&&e.setColor(r)}else console.debug(`colorizeNodeFromExpandTagger missing ${n} in colorMap`);if(!e.isExpanded()){const n=e.getChildNodes();Array.isArray(n)&&n.forEach(e=>this.colorizeNodeFromExpandTagger(e,t))}})},getAugmenttedQueryForSearch:function(t){if(e.is(t,"string")&&t.trim().length>0){var n=t;return"*"!==t.charAt(0)&&(n="*"+t),"*"!==t.charAt(t.length-1)&&(n+="*"),n}return null},buildFilterBIProxyOptions:function(e,t){const n={};return(e?Reflect.ownKeys(e).filter(e=>"appOptions"!==e):[]).forEach(t=>{n[t]=e[t]}),{tenant:r.getPlatformId(),processingMode:"appProcessing",colorize:!0,appId:t,widgetId:t,shareFilterSpec:!0,enableGrouping:{},appQueryParam:c,...n}},postInitFilterBIProxyForExpandSynthesis:function(e=!1){this.taggerProxy&&(this.taggerProxy.isExpandSynthesisON=!0,this.taggerProxy.setHighDepthTagsAvailability(!0),!0===e?this.taggerProxy.setSynthesisMode("flat"):this.taggerProxy.setSynthesisMode("occurrence"))},initFilterBIProxy:function(t={},n){const i=this.buildFilterBIProxyOptions(t,n);this.taggerProxy=new s(i),this.taggerProxy.filterOptions=e.clone(t),this.taggerProxy.isActivated=!0,this.taggerProxy.appQueryParam=c,this.taggerProxy.XENRoots=[];const{ExpandSynthesisON:r,appOptions:a}=t||{};if(!0===r){const{retreiveTagsonInstance:e}=a||{};this.postInitFilterBIProxyForExpandSynthesis("boolean"==typeof e&&e)}return this.taggerProxy.isExpandSyntesisActivated=function(){return"boolean"==typeof this.isExpandSynthesisON&&this.isExpandSynthesisON},this.taggerProxy.activateFilter=function(){this.activate(),this.isActivated=!0},this.taggerProxy.deactivateFilter=function(){this.deactivate(),this.isActivated=!1},this.taggerProxy.isFilterActivated=function(){return this.isActivated},this.taggerProxy.addRoots=function(e){if(!Array.isArray(e)||!e.length)throw new Error("invalid input => expected a valid array");if(this.isExpandSyntesisActivated()&&1!==e.length)throw new Error("invalid input => expected a valid array of only one element");if(JSON.stringify(e)!==JSON.stringify(this.XENRoots)){if(this.isExpandSyntesisActivated()){const[t]=e;this.setTagsWithExpandSynthesis(t)}else this.setTagsWithFetchSynthesis(e);this.XENRoots=e,console.debug(`XENFIlterBIPRoxy -> addRoots: ${this.XENRoots.length} ${this.XENRoots} to taggerProxy instance :  ${JSON.stringify(this.filterOptions)}`)}else console.debug(`XENFIlterBIPRoxy -> addRoots: roots already added, do nothing from taggerProxy instance :  ${JSON.stringify(this.filterOptions)}`)},this.taggerProxy.removeAllRoots=function(e=!1){console.debug(`XENFIlterBIPRoxy -> removeAllRoots: ${this.XENRoots} from taggerProxy instance :  ${JSON.stringify(this.filterOptions)}`),e&&this.XENRoots.length&&this.removeRoots(this.XENRoots),this.XENRoots=[]},this.taggerProxy.hasOptions=function(e){return!(!e||!this.filterOptions)&&JSON.stringify(e)===JSON.stringify(this.filterOptions)},this.taggerProxy.getDefaultApplicativeSpec=function(){return e.clone(c)},this.taggerProxy.setApplicativeSpec=function(t=!1,n=!1){const i=this.getDefaultApplicativeSpec();if(this.isExpandSyntesisActivated()){const r=e.clone(i);if(t){const e='(flattenedtaxonomies:"types/Document")';r["q.iterative_filter_query_bo"]=`${r["q.iterative_filter_query_bo"]} OR ${e}`;const t=["SpecificationDocument"];r.type_filter_rel.push(...t)}if(n){const e='(flattenedtaxonomies:"types/Raw_Material")';r["q.iterative_filter_query_bo"]=`${r["q.iterative_filter_query_bo"]} OR ${e}`;const t=["MustBeMadeFrom"];r.type_filter_rel.push(...t)}const s=l.convertPayloadTo(r,o.COMMAND_WS_EXPAND_CV_V2),{batch:a}=s||{},{expands:c}=a||{},[d]=c||[],{graph:u}=d||{};u&&(i.graph=u)}JSON.stringify(this.appQueryParam)!==JSON.stringify(i)&&(this.setAppQueryParam(i),this.isExpandSyntesisActivated()&&Array.isArray(this.XENRoots)&&this.XENRoots.length&&this.setTagsWithExpandSynthesis(this.XENRoots),this.appQueryParam=i)},this.taggerProxy},getFilterConfigType:function(){return this.taggerProxy.CONFIG_FILTER},createNodePathJson:function(e){var t={nodes:[],paths:[]},n=e;new Object;for(var i in n){var r=n[i],o=[];t.nodes.push(r.options?r.options.referenceId:null),o.push(i),t.paths.push(o)}return t},createNodePathJsonFromArray:function(e){var t={nodes:[],paths:[]};return e.forEach(function(e,n){t.nodes.push(e.getID());var i=[];i.push(n),t.paths.push(i)}),t},getDateFormater:function(){return this.dataFormatter2||(this.dataFormatter2=new Intl.DateTimeFormat(r.getLanguage(),{year:"numeric",month:"numeric",day:"numeric"})),this.dataFormatter2},getformatedDate:function(e){this.dataFormatter||(this.dataFormatter=new Intl.DateTimeFormat(r.getLanguage(),{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}));try{return this.dataFormatter.format(new Date(e)).replace(",","")}catch(t){return e}},dateFormatFromMilliSeconds:function(e){return isNaN(e)||(dateFormat=parseInt(e),dateFormat=1e3*date),new Date(e)},dateFormatFromDsToIso:function(e,t){if(!e||0===e.length)return null;var n=e;return n.indexOf("@")>-1&&n.indexOf(":GMT")>-1?n=n.replace("@","T").replace(/\//g,"-").replace(":GMT","Z"):!t||-1!==n.indexOf("T")&&-1!==n.indexOf("Z")||(n=null),n},formatCustomDateAttribute:function(t){if(!t||!e.is(t,"string")||0===t.length)return null;try{var n=this.dateFormatFromDsToIso(t);return n?this.getDateFormater().format(new Date(n)):null}catch(e){return t}},isServiceTimedOut:function(e){return e&&e.error&&e.error.message&&e.error.message.includes("timedout")},getArrayWithoutDuplicate:function(e){if(!Array.isArray(e)||0===e.length)return[];for(var t=[e[0]],n=1;n<e.length;n++)-1===t.indexOf(e[n])&&t.push(e[n]);return t},prepareDragData:function(e,t){var n={biProxyCtx:t&&t.getCtxForSharing?t.getCtxForSharing():{widgetId:r.getWidgetId(),appId:r.getWidgetId()},protocol:"3DXContent",version:"1.1",source:r.getWidgetId(),data:{items:[]}},i=[];return Array.isArray(e)&&e.length>0&&e[0]&&e.forEach(function(e){var t={envId:r.getPlatformId(),serviceId:o.SERVICE_3DSPACE_NAME,contextId:"",objectId:e.getID(),objectType:e.getType(),displayName:e.getLabel(),displayType:e.getType()};i.push(t)}),n.data.items=i,JSON.stringify(n)},get3DXContentFromDrop:function(e){if(!e||!e.data||!Array.isArray(e.data.items))throw"Dopped data are not valid";return e.data.items},_getItemsByTypeFromDroppedData:function(e,t){if(!Array.isArray(e)&&!t)return{};var n,i={};return e.forEach(function(e){n=e.objectType,t.kindOfEngItem&&t.kindOfEngItem.VPMReference&&t.kindOfEngItem.VPMReference.includes(e.objectType)?n=o.TYPE_VPMREFERENCE:t.kindOfDrawing&&t.kindOfDrawing.Drawing&&t.kindOfDrawing.Drawing.includes(e.objectType)?n=o.TYPE_DRAWING:t.kindOfDocument&&t.kindOfDocument.Document&&t.kindOfDocument.Document.includes(e.objectType)&&(n=o.TYPE_DOCUMENT),i[n]||(i[n]=[]),i[n].push(e)}),i},getCurrentTimeStamp:function(){return(new Date).getTime()},cleanDroppable:function(e){i.clean(e)},makeDroppable:function(t){var n={enter:function(n,i){"function"===e.typeOf(t.onDragEnter)&&t.onDragEnter.apply(t.context,[n,i])},leave:function(n,i){"function"===e.typeOf(t.onDragLeave)&&t.onDragLeave&&t.onDragLeave.apply(t.context,[n,i])},over:function(n,i){"function"===e.typeOf(t.onDragOver)&&t.onDragOver&&t.onDragOver.apply(t.context,[n,i])},drop:function(n,i,r){"function"===e.typeOf(t.onDrop)&&t.onDrop.apply(t.context,[n,i,r])}};i.droppable(t.element,n)},makeDraggable:function(e,t){i.draggable(e,t)},uid:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},createEvent:function(e,t){return{metadata:{uid:d.uid(),originUid:e,timestamp:Date.now(),appid:r.getAppId()+"_"+r.getWidgetId()},data:t}},isTouchDevice:function(){return"ontouchstart"in document.documentElement},getFileInput:function(e){var t=UWA.extendElement(widget.body).getElement("#fileExplorer");return t||(t=new UWA.createElement("input",{id:"fileExplorer",multiple:e?void 0:"multiple",type:"file",styles:{display:"none"}}).inject(widget.body),this.isTouchDevice()&&(t.accept="image/*;capture=camera")),t.removeEvents(),t},_downloadFromFCS:function(e,t){var n=document.createElement("div");n.style.display="none",e+="&__fcs__attachment=true",n.innerHTML='<a href="'+e+'" download></a>';var i=n.querySelector("a");document.body.appendChild(n),setTimeout(function(){i.click(),document.body.removeChild(n)},66)},launchDownloadfromURLs:function(e){var t=this;e.reduce(function(e,i){return n.wrappedWithCancellablePromise(function(n,r){e.then(function(){t._downloadFromFCS(i.downloadUrl),setTimeout(function(){n()},106)})})},n.wrappedWithCancellablePromise(function(e,t){e()}))},convertVolumeInIUForDisplay:function(e){return this.convertVolumeInIUTo(e,"L").toString()+" L"},convertVolumeInIUTo:function(e,t){var n=e*this._getVolumeConversionFactor(t);return Math.round(1e7*n)/1e7},convertVolumeToInternationalUnit:function(e,t){return e/this._getVolumeConversionFactor(t)},_getVolumeConversionFactor:function(e){return r.getSetting("volumeUnitOfMeasure")[e].factor},areObjectsGivenPropertyValuesEqual:function(e,t,n){if(e===t)return!1;if(!(e instanceof Object&&t instanceof Object))return!1;if(e.constructor!==t.constructor)return!1;let i=!0;for(let r=0;r<n.length;r++){let o=n[r];if(!e[o]&&t[o]||null!=e[o]&&null!=t[o]&&e[o].toString()!==t[o].toString()){i=!1;break}}return i},areEngItemsEqual:function(e,t){return e&&t&&e.getID()===t.getID()},removeOddIndexes:function(e){return function(t,n){return n%2==0&&(!e||n<=e)}},getAlphaNumericName:function(e){return e?e.replace(/[^a-zA-Z0-9 ]/g,""):""},hasMultiValues:function(e,t){let n=e.options.grid[t];return Array.isArray(n)&&n.length>1},convertDateNodeValueToCellValue(e,t,n=!1,i=!0){const o=n?e=>e instanceof Date&&!Number.isNaN(e.getMilliseconds()):null;let s=d.convertNodeValueToCellValue(e,t,d.dateFormatFromMilliSeconds,o,i);if(Array.isArray(s)){if(i){const e=s.map(e=>e.getTime());s=[...new Set(e)].map(e=>new Date(e))}const e=new Intl.DateTimeFormat(r.getLanguage(),{year:"numeric",month:"numeric",day:"numeric"});s=s.map(t=>{let n=t;try{n=e.format(t)}catch(e){n=t.toLocaleDateString?t.toLocaleDateString():t}return n})}return s},convertBooleanNodeValueToCellValue(e,t,n=!1,i=!0){const r=n?e=>!0===e||!1===e:null;return d.convertNodeValueToCellValue(e,t,e=>{const t=e.toLowerCase();if("true"!==t&&"false"!==t)throw new Error(`value ${t} is not a boolean`);return"true"==t},r,i)},convertIntegerNodeValueToCellValue(e,t,n=!0,i=!0){const r=n?e=>!Number.isNaN(e):null;return d.convertNodeValueToCellValue(e,t,Number.parseInt,r,i)},convertRealNodeValueToCellValue(e,t,n=!0,i=!0){const r=n?e=>!Number.isNaN(e):null;return d.convertNodeValueToCellValue(e,t,Number.parseFloat,r,i)},convertNodeValueToCellValue:function(e,t,n,i,r=!0){if(!e||!t)return null;if(n&&"function"!=typeof n)return null;if(i&&"function"!=typeof i)return null;const o=e.getAttributeValue(t);if(!o)return null;const s=e=>{let t=n?n(e):e;if(i&&!i(t))throw new Error("conversion check fails");return t};let a=null;if(Array.isArray(o))try{a=o.map(e=>s(e))}catch(e){a=null}else try{a=s(o)}catch(e){a=null}return Array.isArray(a)&&r&&(a=[...new Set(a)]),a},findNodesByIdsFromList:function(e,t){let n=[];return e&&Array.isArray(e)?0===e.length?n:t&&Array.isArray(t)?0===t.length?n:n=e.filter(e=>!!e.matchIDs(t)):(console.error("findNodesByIdsFromList: ids - bad input: expect Array"),n):(console.error("findNodesByIdsFromList: nodesList - bad input: expect Array "),n)},findQtyOrInstNodesByIdsFromList:function(e,t){let n=[];return e&&Array.isArray(e)?0===e.length?n:t&&Array.isArray(t)?0===t.length?n:n=e.filter(e=>!!e.matchQtyOrInstIDs(t)):(console.error("findNodesByIdsFromList: ids - bad input: expect Array"),n):(console.error("findNodesByIdsFromList: nodesList - bad input: expect Array "),n)},createMap:function(e,t,n){return e.reduce((e,i)=>(e[t(i)]=n(i),e),{})},getGroupIntentWithHelpers:t=>({...e.clone(t),getPredicates:function(){const e=this.groupingIntent;if(!Array.isArray(e))return[];const t=new Set;return e.forEach(e=>{const{predicate:n}=e;"string"==typeof n&&""!==n.trim()&&t.add(n)}),[...t]},getObjectToDispTextMap:function(){const e=new Map,t=this.groupingIntent;return Array.isArray(t)?(t.forEach(t=>{const{object:n,predLevel:i}=t;n.forEach(t=>{const{object:n,dispText:r}=t;let o=n;i&&Array.isArray(n)&&n.length&&(o=n[0]),o&&r&&e.set("string"!=typeof o?JSON.stringify(o):o,r)})}),e):e},getFirstGroupIntentObjectProperties:function(){const[e]=Array.isArray(this.groupingIntent)?this.groupingIntent:[],{object:t}=e||{},[n]=t||[],i=n&&Array.isArray(n.object);return{isALevelGroupObject:i,object:i?n.object:null,objectAsString:i?JSON.stringify(n.object):null,objectLength:i?n.object.length:0}}}),retreiveGroupsFromExpand:function(e,t,n=null){const{results:i}=e||{};if(!Array.isArray(i)||!i.length)return null;const r=this.getGroupIntentWithHelpers(t),o=r.getFirstGroupIntentObjectProperties(),{isALevelGroupObject:s,objectAsString:a,objectLength:l}=o||{},c=r.getObjectToDispTextMap(),d=r.getPredicates(),u=i.filter(e=>UWA.is(e.synthesis));if(!u.length)return null;const p=[];p.getFirstLevelChildren=function(){return this.filter(e=>0===e.level)},p.getChildren=function(e=null){return e?this.filter(t=>t.parent===e.key):null};let g=!1;if(u.forEach(({synthesis:e})=>{const{facets:n,value:i}=e;if(i)if(Array.isArray(n)){const e=n.filter(e=>{const{sixw:t}=e,n=t.split("/").pop();return-1!==d.indexOf(n)}),i=s?e.findIndex(e=>JSON.stringify(e.object)===a):-1;(-1!==i?e.slice(i):e).forEach(e=>{const{object:n,count:i}=e;i&&p.push({key:Array.isArray(n)?n.join("/"):n,level:Array.isArray(n)?n.length-l:0,parent:Array.isArray(n)&&n.length>1?n.slice(0,n.length-1).join("/"):null,facet:e,objects:n,groupIntent:t,getLabel:function(){const{groupingIntent:e}=this.groupIntent||{};if(!Array.isArray(e)||!this.objects)return"";let t=c.get("string"!=typeof this.objects?JSON.stringify(this.objects):this.objects);return t||(t=Array.isArray(this.objects)&&this.objects.length?this.objects[this.objects.length-1]:""),t},getGroupIntentForExpand(){const{sixw:e,object:t,type:n}=this.facet,i=e.split("/").pop(),{groupingIntent:r}=this.groupIntent||{},o=Array.isArray(r)?r.find(e=>e.predicate===i):null,{object:s}=o||{},a=Array.isArray(s)?s.find(e=>e.object===t):null;return{groupingIntent:[{predicate:i,object:a?[a]:[{object:t,type:n}],other:!1}]}}})})}else g=!0}),g){let e=null;if(p.length){const t={};p.forEach(e=>{const{groupingIntent:n}=e.getGroupIntentForExpand();n.forEach(e=>{const{predicate:n,object:i}=e;Array.isArray(t[n])||(t[n]=[]),t[n].push(...i)})}),e=Reflect.ownKeys(t).map(e=>({predicate:e,object:t[e],other:!0}))}else t&&t.groupingIntent&&(e=UWA.clone(t.groupingIntent)).forEach(e=>e.other=!0);p.push({key:"Others",groupingIntent:e,level:0,getLabel:function(){return n?n.get("eng.tagger.groups.others"):"Others"},getGroupIntentForExpand:function(){return{groupingIntent:this.groupingIntent}}})}return p},runBulkMode:function(e,t,n,i){if("string"!=typeof e||!e.trim().length)throw new Error("invalid input");if(this.bulkOperations||(this.bulkOperations={}),!this.bulkOperations[e]){const r={method:t,resolve:n,reject:i,add:function(e){console.log("add"),this.args||(this.args=[]),this.args.push(e)},activate:function(){},run:async function(e){setProgress=(t=>{!e||"number"!=typeof t||t<10||t>90||e.publish("content-loader-indicator-progress",t)});try{const e=await this.method(this.args,setProgress);"function"==typeof this.resolve&&this.resolve(e)}catch(e){"function"==typeof this.reject&&this.reject(e)}},end(){}};this.bulkOperations[e]=r}return this.bulkOperations[e]},startBulkMode:function(e,t=null){if("string"!=typeof e||!e.trim().length)throw new Error("invalid input");if(!this.bulkOperations)return;if(!this.bulkOperations[e])return;const n=this.bulkOperations[e];n.isRunning||(t&&t.publish("content-loader-indicator-start"),n.isRunning=!0,n.activate(t),n.run(t).finally(()=>{n.end(t),delete this.bulkOperations[e],t&&t.publish("content-loader-indicator-completed")}))}};return d}),define("DS/ENOXEngineer/components/IdCard/IdCard",["UWA/Core","UWA/Class/Model","DS/ENOXIDCard/js/IDCard","DS/ENOXEngineer/utils/Utils","DS/Utilities/Utils","DS/PlatformAPI/PlatformAPI","DS/LifecycleCmd/MaturityCmd","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/UIKIT/Tooltip","css!DS/ChangeMaturityWidget/ChangeMaturityWidget","css!DS/ENOXEngineer/components/IdCard/idCard.css"],(e,t,n,i,r,o,s,a,l,c)=>{return function(d){const u=d.getContainer();return{refreshSubscriptionEvent:null,start(){this.buildIDCardUI(d.options.models.getEngineeringItem())},buildMaturityBadge:function(){var e=this;let t=e.getMaturityContainer();if(t){e.maturityCmd=new s;let n=null;d&&d.core&&d.core.settingManager&&d.core.settingManager.getSecurityContext&&d.core.settingManager.getSecurityContext()?n=d.core.settingManager.getSecurityContext():!n&&widget&&widget.getValue&&widget.getValue("SC")&&(n=widget.getValue("SC"));let i={SecurityContext:n};e.maturityCmd.executeCompactViewAsync(widget,t,i,e.myModel.id).then(function(){console.log("Maturity  updated :"+e.maturityCmd.changeMaturityWidget)})}},getMaturityContainer:function(){var e,t;let n=this.myModel.get("attributes").filter(e=>"maturity"==e.id&&e.displayWhenMinified);n&&n.length>0?(e=u.getElements("#maturity")[0],t=u.getElements("#maturity")[1]):t=u.getElements("#maturity")[0];let i=u.querySelector(".xapp-id-card-container");return i&&i.hasClassName("minified")?e:t},getDiscriptionText(t){let n=d.i18nManager.get("no_description_text");return t.getDescription()&&t.getDescription().length>1&&(n=t.getDescription()),e.String.escapeHTML(n)},getDisplayAttributesOf(e){let t=d.core.dicoService.getIdCardPreferences()?d.core.dicoService.getIdCardPreferences():d.core.settingManager.getSetting(a.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES),n=[];for(var i in t)n.push(this.getDisplayAttributeValue(t[i],e));return n},getDisplayAttributeValue(e,t){if(e)switch(e.id){case"ds6wg:EnterpriseExtension.V_PartNumber":return{name:d.i18nManager.get(e.id),value:t.getAttributeValue(e.id)||d.i18nManager.get("None"),type:"type-hyperlink",editable:!0,displayWhenMinified:e.displayWhenMinified};case"ds6w:responsible":return{name:d.i18nManager.get(e.id),value:t.getOwner(),type:"type-hyperlink",editable:!0,displayWhenMinified:e.displayWhenMinified};case"ds6w:status":return{name:d.i18nManager.get(e.id),id:"maturity",value:"",displayWhenMinified:e.displayWhenMinified};case"ds6w:created":return{name:d.i18nManager.get(e.id),value:t.getCreatedDate(),type:"type-text",displayWhenMinified:e.displayWhenMinified};case"ds6w:modified":return{name:d.i18nManager.get(e.id),value:t.getModifedDate(),type:"type-text",displayWhenMinified:e.displayWhenMinified};default:let n=t.getAttributeValue(e.id),r=d.core.dicoService.getAttributeMetas(e.id)?d.core.dicoService.getAttributeMetas(e.id).kind:"";return r&&-1!==["datetime","timestamp"].indexOf(r.toLowerCase())&&(n=i.formatCustomDateAttribute(n)),{name:d.i18nManager.get(e.id),value:n,type:"type-text",displayWhenMinified:e.displayWhenMinified}}},getSerializedContent(){const e=d&&d.options&&d.options.models?d.options.models.getEngineeringItem():null;return e?i.prepareDragData([e],e.getContentModels().getBIFilter()):""},buildIDCardUI(e){const i=this;d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.UPDATE_WIDGET_TITLE,context:{label:e.getLabel()}});const s=d.i18nManager.get("ds6w:responsible"),p=(d.i18nManager.get("ds6w:status"),d.i18nManager.get("ds6wg:EnterpriseExtension.V_PartNumber")),g=(d.i18nManager.get("eng.attached.model"),d.options.physicalId),h=i.getDiscriptionText(e),m=d.core.sessionManager.determineCurrentModeState(),f={name:e.getTitleForIdcard(),model:null,id:g,label:e.getTitleForIdcard(),version:e.getReferenceVersionForIDCard(),versionModel:e.getVersionOfModelVersion(),configuration:e.getConfigurationDisplayName(),modelVersion:e.getModelVersionForIDCard(),ngfilter:e.getFilterForIdcard(),thumbnail:e.getThumbnail(),modelEvents:d.getApplicationBroker(),titleText:e.getTitleForIdcard()+e.getReferenceVersionForIDCard(),withHomeButton:!0,withInformationButton:!0,withGenericButton:!0,withToggleMinifiedButton:!0,minified:d.core.PersistencyManager.isIDCardMinified(),showBackButton:d.core.viewState.isChildView(),freezones:[`<p>${h}</p>`],attributes:i.getDisplayAttributesOf(e),customEvents:{homeIconClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_LANDING},expandCollapseIconClick:{event:a.EVENT_IDCARD_CUSTOM_WP_TOGGLE_EVENT},informationIconClick:{event:a.EVENT_IDCARD_CUSTOM_INFORMATION_ICON},indexDbIconClick:{event:a.EVENT_IDCARD_CUSTOM_GENERIC_ICON},configurationLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_CONFIGURATION},ngfilterLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_NGFILTER},modelVersionLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_MODELVERSION},versionLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER},versionModelLabelClick:{event:a.EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER},actionsMenuClick:{event:a.EVENT_IDCARD_CUSTOM_OPEN_ACTIONS_MENU},backIconClick:{event:a.EVENT_GO_BACK}}};i.myModel=new t(f),d.emptyContainer(),i.idcard=new n({model:i.myModel}),i.idcard.render().inject(u),i.idcard.attachResizeSensor(),d.publish(a.EVENT_IDCARD_READY),d.registerDnDManager({sandbox:d,container:u,draggable:!0,getSerializedContent:i.getSerializedContent.bind(i),droppable:!0,dropStrategy:"OPEN",onDrop:i.onValidDrop.bind(i)});var E=u.getElement(".generic-icon");E&&("index"===m?E.addClassName("fonticon fonticon-database-refresh"):"authoring"===m?(E.addClassName("fonticon fonticon-database-hourglass"),E.addClassName("hoverGlass")):"neverIndexMode"===m?(E.addClassName("fonticon fonticon-database"),E.addClassName("hoverGlass")):"useOnlyAuthoring"===m?(E.addClassName("fonticon fonticon-database"),E.addClassName("hoverGlass"),E.addClassName("disable")):"forceIndex"===m&&(E.addClassName("fonticon fonticon-database-refresh"),E.addClassName("disable")),i.setIndexDbIconTooltip(u.getElement(".title-section-buttons"))),d.subscribe(a.EVENT_MODIFIED_REFERENCES,e=>{e&&Array.isArray(e.references)&&e.references.findIndex(e=>e.physicalid===g)>-1&&i.refreshIdCard(!0)}),d.subscribe(a.EVENT_UPDATE_IDCARD_RENDERING,e=>{i.refreshIdCard(e)}),d.subscribe(a.EVENT_SYNC_VIEW_WITH_EI_MODEL,()=>{i.refreshIdCard()}),d.subscribe(a.EVENT_SYNC_MATURITY_WITH_MODEL,()=>{i.buildMaturityBadge()}),i.refreshSubscriptionEvent=o.subscribe("DS/PADUtils/PADCommandProxy/refresh",e=>{let t=!1;e.data.authored&&e.data.authored.modified&&(e.data.authored.modified.forEach(e=>{g!==e&&g!==e.physicalid||(t=!0)}),t&&i.refreshIdCard(!0))});const C=u.querySelector(".xapp-id-card-container .fonticon-open-down");d.subscribe(a.EVENT_IDCARD_CUSTOM_OPEN_ACTIONS_MENU,()=>{d.core.commandManager.renderIdCardMenu(C.getBoundingClientRect())}),d.subscribe(a.EVENT_IDCARD_CUSTOM_INFORMATION_ICON,()=>{d.core.isPropertyPanelVisibilty||d.publish(a.EVENT_INFO_PANEL_VISIBLE),d.publish(a.EVENT_TRIPTYCH_TOGGLE_PANEL,"right")}),d.subscribe(a.EVENT_IDCARD_CUSTOM_GENERIC_ICON,e=>{const t=u.querySelector(".generic-icon");t&&(t.hasClassName("fonticon-database-refresh")?(d.core.sessionManager.setAuthoringMode("authoring",!0),widget.appMediator.publish(a.EVENT_REFRESH_APP_CONTENT)):(t.hasClassName("fonticon-database-hourglass")||t.hasClassName("fonticon-database"))&&d.core.sessionManager.setAuthoringMode("index"))}),d.subscribe(a.SWITCH_MODE,e=>{switchMode=e.switchMode;const t=d.core.sessionManager.determineCurrentModeState();switchMode&&("forceIndex"===t&&"index"===switchMode?i.forceIndexModeIcon():"authoring"===switchMode&&"neverIndexMode"===t?this.setNeverIndexModeIcon():"authoring"===switchMode?this.setAuthoringModeIcon():this.setIndexModeIcon())}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_CONFIGURATION,()=>{!e.isConfigured()||e.hasValidConfigContext()?d.core.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.SET_PROD_CONF_CMD,context:{item:e}}):l.errorAlert(d.i18nManager.get("error.detachOrAddVersion.toModel"))}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_NGFILTER,()=>{(e.hasValidTransientNextGenFilter()||e.hasPesistencyManagerdNGFilter())&&d.core.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_NG_FILTER_CMD,context:{}})}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_MODELVERSION,()=>{d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.EDIT_CONF_CONTEXT_CMD,context:{item:e}})}),d.subscribe(a.EVENT_IDCARD_CUSTOM_SHOW_VERSION_EXPLORER,()=>{!e.isConfigured()||e.hasValidConfigContext()?d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.VERSION_GRAPH_CMD,context:{item:e}}):l.errorAlert(d.i18nManager.get("error.detachOrAddVersion.toModel"))}),d.subscribe(a.EVENT_IDCARD_ATTRIBUTES_CLICKED,r.debounce(t=>{switch(t.attributeName){case s:d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.CHANGE_OWNER_CMD,context:{item:e}});break;case p:d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.SET_PART_NUMBER_CMD,context:{item:e}})}},10)),i.freezoneTooltip=new c({target:u.getElement(".lower-main-section").getChildren()[1],trigger:"hover touch",body:i.getDiscriptionText(e)}),i.buildMaturityBadge()},onValidDrop(e){if(Array.isArray(e)&&e.length>0){const t=e[0],n=t.objectId;d.options.models.getBIFilter().removeRoot(n),d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.OPEN_ENG_ITEM,context:{item:{objectId:t.objectId,objectType:t.objectType,biProxyCtx:t.biProxyCtx}}})}},setAuthoringModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-refresh"),e.classList.remove("fonticon-database"),e.classList.remove("disable"),e.classList.add("fonticon-database-hourglass"),e.classList.add("hoverGlass"))},setIndexModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-hourglass"),e.classList.remove("hoverGlass"),e.classList.remove("fonticon-database"),e.classList.remove("disable"),e.classList.add("fonticon-database-refresh"))},setNeverIndexModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-hourglass"),e.classList.remove("fonticon-database-refresh"),e.classList.remove("disable"),e.classList.add("fonticon-database"),e.classList.add("hoverGlass"))},forceIndexModeIcon(){let e=u.querySelector(".generic-icon");null!==e&&(e.classList.remove("fonticon-database-hourglass"),e.classList.remove("hoverGlass"),e.classList.remove("fonticon-database"),e.classList.add("fonticon-database-refresh"),e.classList.add("disable"))},setIndexDbIconTooltip(e){e.onmouseover=function(e){const t=d.core.sessionManager.determineCurrentModeState(),n=d.core.sessionManager.determineAuthoringMode();let i,r=(new Date).getTime()-d.core.sessionManager.getFullViewLoadInfo().last_refreshed;if(r>=6e4)var o=Math.abs(Math.round(r/6e4));else var s=Math.abs(Math.round(r/1e3));const l=a.CONST_INDEX===d.core.sessionManager.getFullViewLoadInfo().state?d.i18nManager.get("mode_Index"):d.i18nManager.get("mode_Authoring");r=void 0!==o?o:s,"index"!==t&&"forceIndex"!==t||"authoring"===n?"authoring"===n&&"neverIndexMode"===t?(i=void 0!==o?d.i18nManager.get("never_use_index_minute"):d.i18nManager.get("never_use_index_seconds"),o&&o>1&&(i=d.i18nManager.get("never_use_index_minutes")),u.getElement(".title-section-buttons").title=d.i18nManager.replace(i,{time:r})):"authoring"===n&&"useOnlyAuthoring"===t?(i=void 0!==o?d.i18nManager.get("never_use_index_minute"):d.i18nManager.get("never_use_index_seconds"),o&&o>1&&(i=d.i18nManager.get("never_use_index_minutes")),u.getElement(".title-section-buttons").title=d.i18nManager.replace(i,{time:r})):"authoring"===n&&(i=void 0!==o?d.i18nManager.get("authoring_mode_minute"):d.i18nManager.get("authoring_mode_seconds"),o&&o>1&&(i=d.i18nManager.get("authoring_mode_minutes")),u.getElement(".title-section-buttons").title=d.i18nManager.replace(i,{time:r,mode:l,indexTime:widget.getValue("intervalToSwitch")/60})):(i=void 0!==o?d.i18nManager.get("index_mode_minute"):d.i18nManager.get("index_mode_seconds"),o&&o>1&&(i=d.i18nManager.get("index_mode_minutes")),u.getElement(".title-section-buttons").title=d.i18nManager.replace(i,{time:r,mode:l}))}},refreshIdCard(e){const t=this;e?d.options.models.getEngineeringItem().syncModel().then(()=>{t.updateIDCard(d.options.models.getEngineeringItem())}).catch(e=>{console.error(e)}):t.updateIDCard(d.options.models.getEngineeringItem())},updateIDCard(e){d.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.UPDATE_WIDGET_TITLE,context:{label:e.getTitleForIdcard()}}),this.myModel.set("name",e.getTitleForIdcard()),this.myModel.set("label",e.getTitleForIdcard()),this.myModel.set("version",e.getReferenceVersionForIDCard()),this.myModel.set("versionModel",e.getVersionOfModelVersion()),this.myModel.set("configuration",e.getConfigurationDisplayName()),this.myModel.set("ngfilter",e.getFilterForIdcard()),this.myModel.set("modelVersion",e.getModelVersionForIDCard()),this.myModel.set("thumbnail",e.getThumbnail()),this.myModel.set("minified",d.core.PersistencyManager.isIDCardMinified());const t=this.getDiscriptionText(e);this.myModel.set("freezones",[`<p>${t}</p>`]),this.myModel.set("attributes",this.getDisplayAttributesOf(e)),this.buildMaturityBadge(),this.freezoneTooltip.setBody(t)},stop(){o.unsubscribe(this.refreshSubscriptionEvent),this.idcard&&this.idcard.destroy(),d.emptyContainer(),d.publish(a.EVENT_SET_ACTIVE_ENG_ITEM,null),d.stop(this)}}}}),define("DS/ENOXEngineer/services/XENUserSessionManager",["UWA/Core","UWA/Class","require","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/componentsHelpers/UploadViewer/UploadViewer","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i,r,o,s,a){"use strict";var l=null;return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("XENUserSessionManager manager initializing");var t=this;e.core.sessionManager=e.sandboxBase.sessionManager=t,this.sessionBuilderIds=e.core.settingManager.getSetting("engItemOpenSessionBuilder"),this.app=e,this._nextOpenFilter=null,this._openContext=null,this._insertMaterialContext=null,this._uploadViewer=new o({nlsManager:e.core.i18nManager,immersiveFrame:e.core.moduleHelper.viewsService.getApplicationImmersiveFrame()}),t._currentStatticMapping={},t.app.core.mediator.subscribe(s.EVENT_CONF_MODEL_UPDATED,function(e){try{var n=t.app.core.contextManager.getActiveEngItem();n&&n.getID()===e&&(n.updateUserConfigPreferences(),t.app.core.mediator.publish(s.EVENT_SYNC_VIEW_WITH_EI_MODEL),t.buildCurrentSession())}catch(e){console.error(e)}}),t.app.core.mediator.subscribe(s.EVENT_REBUILD_SESSION,function(){try{var e=t.app.core.contextManager.getActiveEngItem();e&&e.getID()&&(t.buildCurrentSession(),t.app.core.mediator.publish(s.EVENT_COLUMNS_CHANGED))}catch(e){console.error(e)}});var n=t.app.core.localStorage.getItem(s.VALUE_QUALIFIED_AS_FINAL_COMPONENT);this._showQualifiedAsFinal=s.QUALIFIED_AS_FINAL_CMD===n,t._showLeafMaterials=n===s.LEAF_MATERIALS_CMD,t._flatList=n===s.FLAT_LIST_VIEW,t.app.core.mediator.subscribe(s.EVENT_QUALIFIED_AS_FINAL_ITEM,function(e){e.commandId!==t.getFlatViewOption()&&t.switchToFlattenedView(e)}),this._showQuantityView=t.app.core.localStorage.getItem(s.VALUE_QUANTITY_VIEW),t.app.core.mediator.subscribe(s.EVENT_CHANGE_QUANTITY_VIEW,function(e){e.commandId!==t.getQuantityViewOption()&&(t.setQuantityViewOption(e.commandId),t.app.core.mediator.publish(s.EVENT_STRUCTURE_VIEW_CHANGED),t.buildCurrentSession())}),this._showMFGView=t.app.core.localStorage.getItem(s.VALUE_MFG_VIEW),t.app.core.mediator.subscribe(s.EVENT_CHANGE_MFG_VIEW,function(e){e.isMFGView!==t.shouldShowMfgView()&&(t.setManufViewOption(e.isMFGView),t.app.core.mediator.publish(s.EVENT_STRUCTURE_VIEW_CHANGED),t.buildCurrentSession())}),t.app.core.mediator.subscribe(s.EVENT_EXPAND_BY_LEVEL,function(e){let n={};n[s.CONST_TARGET_LEVEL]=e,t.buildCurrentSession(n)}),t.app.core.mediator.subscribe(s.EVENT_FIND_IN_CONTEXT_LAUNCH,function(e){let n={};n[s.CONST_TARGET_LEVEL]="-1",n[s.CONST_FIND_IN_CRITERIA]=e,t.buildCurrentSession(n)})},setFlatViewOption:function(e){this.app.core.localStorage.setItem(s.VALUE_QUALIFIED_AS_FINAL_COMPONENT,e),this._showQualifiedAsFinal=e===s.QUALIFIED_AS_FINAL_CMD,this._flatList=e===s.FLAT_LIST_VIEW,this._showLeafMaterials=e===s.LEAF_MATERIALS_CMD},getFlatViewOption:function(){return this._showQualifiedAsFinal?s.QUALIFIED_AS_FINAL_CMD:this._flatList?s.FLAT_LIST_VIEW:this._showLeafMaterials?s.LEAF_MATERIALS_CMD:s.DIRECT_CMD},setQuantityViewOption:function(e){let t=e===s.REFERENCE_CMD;this.app.core.localStorage.setItem(s.VALUE_QUANTITY_VIEW,t),this.app.core.localStorage.setItem(s.VALUE_INSTANCE_OR_REFERENCE_CMD,e),this._showQuantityView=t},getQuantityViewOption:function(){let e=this.app.core.localStorage.getItem(s.VALUE_INSTANCE_OR_REFERENCE_CMD);return e||s.INSTANCE_CMD},setManufViewOption:function(e){this.app.core.localStorage.setItem(s.VALUE_MFG_VIEW,e),this._showMFGView=e},switchToFlattenedView:function(e){this.setFlatViewOption(e.commandId);let t=!0;switch(e.commandId){case s.FLAT_LIST_VIEW:case s.QUALIFIED_AS_FINAL_CMD:t=!1;break;case s.LEAF_MATERIALS_CMD:t=!1,this.shouldShowQuantityView()||r.notifyAlert(this.app.core.i18nManager.get("switching.to.referenceview")),this.setQuantityViewOption(s.REFERENCE_CMD)}this.buildCurrentSession(),this.app.core.mediator.publish(s.EVENT_STRUCTURE_VIEW_CHANGED),this.app.core.mediator.publish(s.EVENT_DISABLE_SORT_TO_DEFAULT,!t)},shareConfigSpecWithBIFilter:function(){let e=this;var t=e.app.core.contextManager.getActiveEngItem();let n=t.getPreferedAttachedConfigModel();if(n&&n.getPreferredConfiguration&&n.getPreferredVersion){e.app.core.contextManager.getXENTreeDocument().getXENBIFilterProxy().resetNGFilterUI({widgetId:e.app.core.settingManager.getWidgetId(),rootIds:t?[t.getID()]:[]});let r,o={model:{valueItem:n.getID(),labelItem:[n.getLabel()],name:[n.getLabel()]}},a=n.getPreferredConfiguration(),l=n.getPreferredVersion();a?r={PCID:a.id,context:o}:l&&(r={filterXML:`<?xml version="1.0"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="${s.CONF_150_MODE}"><TreeSeries Type="ProductState" Name="${l.name}"><Single Name="${l.name}" Revision="${l.revision}" DescId="1" /></TreeSeries></FilterSelection><Description><TreeSeries DescId="1" Revision="${l.revision}" DisplayName="${l.marketingName}" CurrentState="${l.state}"/></Description></CfgFilterExpression>`,context:o});var i={rootID:t.getID(),rootAlias:t.getDisplayName(),specification:{type:e.app.core.contextManager.getXENTreeDocument().getXENBIFilterProxy().CONFIG_FILTER,data:r},applyFilter:1,displayFilter:0};this.sessionAlreadyBuilt=!0,e.app.core.contextManager.getXENTreeDocument().getXENBIFilterProxy().setFilterSpecification(i)}},getUploadTracker:function(e){if(this._uploadViewer)return this._uploadViewer.isInjected()||this._uploadViewer.inject(widget.body),this._uploadViewer.getUploadTracker(e)},getRouterCurrentState:function(){if(!this.app||!this.app.router)return null;var t=this.app.router.getState();return t?e.extend({},t,!0):null},isItemView:function(){let e=this.getRouterCurrentState();return e&&"engItem_View"===e.name},isRecentItemViewView:function(){let e=this.getRouterCurrentState();return e&&"recents_items"===e.name},isMyENGViewView:function(){let e=this.getRouterCurrentState();return e&&"myEngItems"===e.name},buildCurrentSession:function(e){var t=e?e[s.CONST_TARGET_LEVEL]:void 0,n=e?e[s.CONST_FIND_IN_CRITERIA]:void 0,i=this.app.core.contextManager.getActiveEngItem(),r=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes();t&&!this.app.core.contextManager.isActiveEngItemSelected()?this.expandTheNodeOnEachLevel(this.app.core.xengTreeDoc,r,e):i&&(n?this.findinContextNode(this.app.core.xengTreeDoc,r,e):i.getContentModels().buildUserWorkingSession(e)),this.app.core.contextManager.isPreExpandEvent()&&this.app.core.contextManager.setPreExpandEvent(!1)},shouldShowFinalItems:function(){return this._showQualifiedAsFinal},shouldShowLeafMaterials:function(){return this._showLeafMaterials},shouldShowQuantityView:function(){return this._showQuantityView},shouldShowMfgView:function(){return this._showMFGView},shouldShowFlatView:function(){return this._flatList},refreshWithDroppedFilter:function(e){var t=e[0]||null;if(t&&t.rootId){this.setNGFilterContextForNextOpen(t),this.hasValidNGFilterContext()?(this.buildCurrentSession(),this.app.core.mediator.publish(s.EVENT_UPDATE_IDCARD_RENDERING,!1)):this.consumeAvailableNGFilterContext()}},openSessionFromDroppedFilter:function(e){console.warn(e);var t=e[0]||null;if(t&&t.rootId){t&&(this.setNGFilterContextForNextOpen(t),this.hasValidNGFilterContext()?this.app.core.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.OPEN_ENG_ITEM,context:{item:{objectId:t.rootId,objectType:"VPMReference"}}}):this.consumeAvailableNGFilterContext())}},getCurrentOpenContext:function(){return this._lastOpenContext},saveCurrentOpenContext:function(e){this._lastOpenContext=e},setMaterialForInsertContext:function(e){this._insertMaterialContext=e},consummeAvailableMaterialForInsert:function(){var e=this._insertMaterialContext;return this._insertMaterialContext=null,e},setNextOpenContext:function(e){this._openContext=e},consummeAvailableOpencontext:function(){var e=this._openContext;return this._openContext=null,e},setStaticMappingAsOpenContext:function(e,t){e&&t&&(this._currentStatticMapping[e]=t)},getStaticForMappingAsOpenContext:function(e){return this._currentStatticMapping[e]},cleanStaticMappingContext:function(){this._currentStatticMapping={}},setNGFilterContextForNextOpen:function(e){this._nextOpenFilter=e},consumeAvailableNGFilterContext:function(){var e=this._nextOpenFilter;return this._nextOpenFilter=null,e},hasValidNGFilterContext:function(){return!!(this._nextOpenFilter&&this._nextOpenFilter.rootId&&this._nextOpenFilter.filter&&this._nextOpenFilter.filter.CVQuery)},isUsingIndex:function(){return"index"===this.determineAuthoringMode()},isUsingDB:function(){return"authoring"===this.determineAuthoringMode()},_getWaitingTimeBeforeSwitchToIndexMode:function(){return parseInt(widget.getValue("intervalToSwitch"))},determineCurrentModeState:function(){var e=this.determineAuthoringMode();const t=this.app.core.localStorage.getItem(s.VALUE_QUALIFIED_AS_FINAL_COMPONENT),n=this.shouldShowLeafMaterials(),i=widget.getValue(s.IS_NGFILTER_PANEL_LAUNCHED),r=this._getWaitingTimeBeforeSwitchToIndexMode();return!0===i||t===s.QUALIFIED_AS_FINAL_CMD||n?e="forceIndex":"authoring"!==e||this.app.core.settingManager.isIndexModeEnabled()?"authoring"!==e||r||(e="neverIndexMode"):e="useOnlyAuthoring",e},getFullViewLoadInfo:function(){return this.modeInformation},determineAuthoringMode:function(){if(!this.app.core.settingManager.isIndexModeEnabled())return"authoring";const t=widget.getValue("xEng_mode")||{};if(e.is(t.state,"string")&&e.is(t.last_editing,"number")){const e=(new Date).getTime(),n=this._getWaitingTimeBeforeSwitchToIndexMode();return"index"===t.state||"authoring"===t.state&&t.last_editing+1e3*n<e&&n?"index":"authoring"}return"index"},setAuthoringMode:function(e,t){var n=this;this.isUsingIndex()&&"authoring"===e&&this._getWaitingTimeBeforeSwitchToIndexMode()&&(t||r.notifyAlert(this.app.core.i18nManager.get("disabling.index.acceleration")),n.app.core.mediator.publish(s.EVENT_INDEX_MODE_DISABLE));var i={state:e,last_editing:(new Date).getTime()};if(widget.setValue("xEng_mode",i),n.app.core.mediator.publish(s.SWITCH_MODE,{switchMode:e}),"authoring"===e&&this._getWaitingTimeBeforeSwitchToIndexMode()){l&&clearTimeout(l);var o=this._getWaitingTimeBeforeSwitchToIndexMode()||.02;l=setTimeout(function(){r.notifyAlert(n.app.core.i18nManager.get("enabling.index.acceleration")),n.app.core.mediator.publish(s.SWITCH_MODE,{switchMode:"index"}),l=null},1e3*o)}},buildAppropriateSession:function(e,t){var n=this;return i.wrappedWithPromise(function(i,r){const o=n.consumeAvailableNGFilterContext();if(o&&(o.filterId?e.getEngineeringItem().setPersistedNGFilterContext(o):o.filter&&e.getEngineeringItem().setTransientNGFilteringContext(o.filter)),!n.app.core.Factories.CollectionsFactory.isInstanceContentModels(e))throw new Error("invalid parameter for buildAppropriateSession ");n.app.core.dataService.addRecentsEngItem(e.getEngineeringItem().getID()),e.getEngineeringItem().getNGFilterId()&&n.app.core.dataService.addRecentsEngItem(e.getEngineeringItem().getNGFilterId()),n.getAppropriateSessionBuilder(e).then(function(o){n._processSessionBuilder(o,e,t).then(i).catch(function(t){n._buildFallbackSession(e).then(i).catch(r)})}).catch(function(t){console.error(t),n._buildFallbackSession(e).then(i).catch(r)})})},_buildFallbackSession:function(e){var t=this;return i.wrappedWithPromise(function(n,i){t.getDefaultSessionBuilder(e).then(function(o){t._processSessionBuilder(o,e).then(function(e){r.warningAlert(t.app.core.i18nManager.get("warning.failed.toBuildAppropriate.session")),n(e)}).catch(function(e){console.error(e),i(new Error(t.app.core.i18nManager.get("eng.failed.to.open.EI")))})}).catch(function(e){console.error(e),i(new Error(t.app.core.i18nManager.get("eng.failed.to.open.EI")))})})},_processSessionBuilder:function(e,t,n){var r=this;return r.setFullViewloadInfo(),i.wrappedWithPromise(function(i,o){if(!e||"function"!=typeof e.buildSession||"function"!=typeof e.retrieveAdditionalColumnProviders)throw new Error("appropriate sessionBuilder not found");r.loadAndRegisterColumnProvidersInModel(t).finally(function(){e.retrieveAdditionalColumnProviders().finally(function(){e.buildSession(n).then(i).catch(function(e){console.error(e),o("failed to build appropriate sessionBuilder")})})})})},setFullViewloadInfo:function(){var e=this.determineAuthoringMode();e="index"===e?s.CONST_INDEX:s.CONST_AUTHORING,this.modeInformation={state:e,last_refreshed:(new Date).getTime()}},_processContentFetch:function(e,t,n,r){var o=this;return i.wrappedWithPromise(function(i,s){if(!e||"function"!=typeof e.buildSession||"function"!=typeof e.retrieveAdditionalColumnProviders)throw new Error("appropriate sessionBuilder not found");o.loadAndRegisterColumnProvidersInModel(t).finally(function(){n=Array.isArray(n)?n:[n],e.retrieveAdditionalColumnProviders().finally(function(){e.registerContentfetcher(n,r)})})})},expandTheNodeOnEachLevel:function(e,t,n){var r=this;return i.wrappedWithPromise(function(i,o){r.getAppropriateSessionBuilder(e).then(function(o){r._processContentFetch(o,e,t,n).then(i).catch(function(e){})}).catch(function(e){console.error(e)})})},findinContextNode:function(e,t,n){var r=this;return i.wrappedWithPromise(function(t,i){r.getAppropriateSessionBuilder(e).then(function(i){r._processContentFetch(i,e,r.app.core.contextManager.getActiveEngItem(),n).then(t).catch(function(e){})}).catch(function(e){console.error(e)})})},getAppropriateSessionBuilder:function(e){var t=this;return i.wrappedWithPromise(function(i,r){if(!t.app.core.Factories.CollectionsFactory.isInstanceContentModels(e))throw new Error("invalid parameter for buildAppropriateSession ");var o=e.getAppropriateSessionBuilder();if(!o)throw new Error("failed to retrieve sessionBuilderId");if(!t.sessionBuilderIds[o])throw new Error(" sessionBuilderId not valid");n([t.sessionBuilderIds[o]],function(n){i(new n({appCore:t.app.core,models:e}))},r)})},getDefaultSessionBuilder:function(e){var t=this;return i.wrappedWithPromise(function(i,r){n([t.sessionBuilderIds.default],function(n){i(new n({appCore:t.app.core,models:e}))},r)})},loadAndRegisterColumnProvidersInModel:function(e){var t=this;return i.wrappedWithPromise(function(n,i){if(!e)return i("models not found :( !!");t.app.core.columnsManager.retrieveAvailableColumnProviders().then(function(t){Array.isArray(t)&&e.registerColumnsProviders(t),n(!0)}).catch(function(e){t.logger.error(e),i()})})},getSelectionMode:function(){const e=this.app.core.localStorage.getItem(s.SELECT_MODE);return e||this.app.core.settingManager.getDefaultSelectionMode()},setSelectionMode:function(e){this.app.core.localStorage.setItem(s.SELECT_MODE,e)}})}),define("DS/ENOXEngineer/services/XENDicoService",["UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","text!DS/ENOXEngineer/assets/config/ColumnsMetas.json"],function(e,t,n,i,r,o,s,a){"use strict";var l=null;return{initialize:function(e){l=e;var n=this;this.logger=l.core.logger.get("XENDicoService"),this.logger.info(" initializing Xeng Dictionary services"),e.core.dicoService=this,this._typeHierarchies=[];var i=this.loadListOfParametricalAttributes();l.optionalStartupPromises.push(i),this.mappingCusto6WAttributes={},this.mappingMultiValuatedAttributes=[],this.mappingRangeValueAttributes=[],this.mappingTerminalAttributes={},this.managedAppColumns=null;var r=this.getCustomerDeployedExpressionValues();l.optionalStartupPromises.push(r),this.mappingPredicates=l.core.settingManager.getSetting("mappingPredicates");var s=this.loadListOfExtensionAttributes();l.optionalStartupPromises.push(s),n.localDico={kindOfEngItem:{},kindOfFilter:{},kindOfDocument:{},kindOfMaterial:{},kindOfDrawing:{},unsupportedTypes:{}},l.core.settingManager.getSetting("acceptedTypeOnDropForOpen").forEach(function(e){n.localDico.kindOfEngItem[e]=[e]}),l.core.settingManager.getSetting("NextGenFilterTypes").forEach(function(e){n.localDico.kindOfFilter[e]=[e]}),l.core.settingManager.getSetting("acceptedDocumentsRoots").forEach(function(e){n.localDico.kindOfDocument[e]=[e]}),l.core.settingManager.getSetting("acceptedMaterialRoots").forEach(function(e){n.localDico.kindOfMaterial[e]=[e]}),l.core.settingManager.getSetting("acceptedDrawingRoots").forEach(function(e){n.localDico.kindOfDrawing[e]=[e]});var a=this.retrieveUserDicoPreferences();return n.paramAttributes={},l.core.mediator.subscribe("ENXViews/AttributesCustomization/columnModification",function(e){n._columnsModificationListener(e),l.core.PreferencesManager&&l.core.PreferencesManager.setTerminalItemOptions&&"function"==typeof l.core.PreferencesManager.setTerminalItemOptions&&l.core.PreferencesManager.setTerminalItemOptions()}),l.core.mediator.subscribe(o.EVENT_IDCARD_CUSTOMIZE_ATTRIBUTES_MODIFICATION,function(e){n._persistPreferences({selectedTypes:n.userDicoPreferences.selectedTypes,selectedExtensions:n.userDicoPreferences.selectedExtensions,columns:n.userDicoPreferences.columns,customViewsInfo:n.userDicoPreferences.customViewsInfo,customizeHeaderAttributes:e[o.CUSTOMIZE_HEADER_ATTRIBUTES]})}),t.all([i,a])},_columnsModificationListener:function(e){if(e&&e.what)switch(this.cacheDataIndex&&(this.cacheDataIndex={}),e.what){case"close":this._updateUserPreferences(e);break;case"addRemoveColumns":break;case"reset":this._resetToDefaultValue();break;case"visibilityColumn":case"changeTitle":break;case"exportColumn":case"pinChange":default:console.warn("column modification intent is not handle "+e.what)}},isSavedFilter:function(e){return!!e&&-1!==l.core.settingManager.getSetting("NextGenFilterTypes").indexOf(e)},getAvailableAttributesByTypeV2Adapter:function(e){var t=[];if(Array.isArray(e)&&"Document"!==e[0])t=this.getVisibleAttrForBO().map(function(e){return{type:e.kind,attrName:e.ds6w,sixWTag:e.ds6w,attrNls:e.text}});else{var n=this.getBasicsAttributes(e);t=n=Array.isArray(n)?n:[]}return t.sort(function(e,t){return e.attrNls.localeCompare(t.attrNls)}),t},getCustomerDeployedExpressionValues:function(){var e=this,i=l.core.settingManager.getCommand("get_Customer_Deployed_Expression_Values");return t.wrappedWithCancellablePromise(function(t,r){n.perform(i).then(function(n){var i=JSON.parse(n);e.customerExpression=i,t()}).catch(function(e){return r(e)})})},isDisplaySpecInTab:function(){return!!this.customerExpression&&(this.customerExpression.DisplaySpecInTab&&"True"===this.customerExpression.DisplaySpecInTab)},isHideNewQuantityOfMaterialCommand:function(){return!!this.customerExpression&&(this.customerExpression.HideNewQuantityOfMaterialCommand&&"True"===this.customerExpression.HideNewQuantityOfMaterialCommand)},getAttributeMetas:function(e){return this.getAvailableAttributeWithNls().find(function(t){return t.dataIndex===e})},isKnownAttributeByDataIndex:function(e){if("ds6w:label"===e)return!0;if(this.cacheDataIndex||(this.cacheDataIndex={}),void 0!==this.cacheDataIndex[e]&&null!==this.cacheDataIndex[e])return this.cacheDataIndex[e];{let t=this.getBOAndRelTagsWithRequired().some(function(t){return t===e});this.cacheDataIndex[e]=t}return this.cacheDataIndex[e]},getBOAndRelTagsWithRequired:function(){return this._mergeArrayWithoutDup(this.getTagsForBOWithMandatories(),this.getTagsForRelWithMandatories().map(function(e){return"physicalid"!==e?e+"-Instance":e}))},getTagsForBOWithMandatories:function(){var e=l.core.settingManager.getSetting("mandatorySixwForBO");let t=l.core.PreferencesManager&&l.core.PreferencesManager.getTerminalItem&&l.core.PreferencesManager.getTerminalItem()?l.core.PreferencesManager.getTerminalItem():null;return t&&t!=o.FINAL_ITEMS_DEFAULT&&Array.isArray(e)&&e.push(t),this._mergeArrayWithoutDup(e,this.getVisibleTagsForBO())},getTagsForRelWithMandatories:function(){var e=l.core.settingManager.getSetting("mandatorySixwForRel");return this._mergeArrayWithoutDup(e,this.getVisibleTagsForRel())},_mergeArrayWithoutDup:function(e,t){Array.isArray(e)&&Array.isArray(t)||console.error("invalid inputs");var n=e.slice();return t.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n},getAvailableAttributeWithNls:function(){return(this.getAvailableAttributes()||[]).map(function(e){return e.text=e.ds6w?l.core.i18nManager.get(e.ds6w):e.ds6w,e})},getVisibleTagsForBO:function(){return this.getVisibleAttrForBO().map(function(e){return e.ds6w})},getVisibleTagsForRel:function(){return this.getVisibleAttrForRel().map(function(e){return e.ds6w})},isAttributeManagedByApp(e){const{dataIndex:t}=e||{};return-1!==["level","occurence","Thumbnail","rollup","quantity"].findIndex(e=>e===t)},isRelAttribute(e){const{ds6wFrom:t}=e||{};return"string"==typeof t&&"rel"===t},getVisibleAttrForBO:function(){return this.getVisibleAttributes().filter(e=>!this.isRelAttribute(e)&&!this.isAttributeManagedByApp(e))},getVisibleAttrForRel:function(){return this.getVisibleAttributes().filter(e=>this.isRelAttribute(e)&&!this.isAttributeManagedByApp(e))},getVisibleAttributes:function(){return this.getAvailableAttributeWithNls().filter(function(e){return e.visibleFlag})},getAvailableAttributes:function(){return(this.getUserDicoPreferences()?this.getUserDicoPreferences().columns:[]).filter(function(e){return e.ds6w&&!e.isAdditionalColumn})},getAdditionalColumnMetaAttributes:function(){return(this.getUserDicoPreferences()?this.getUserDicoPreferences().columns:[]).filter(function(e){return e.isAdditionalColumn})},getSelectedTypes:function(){return this.getUserDicoPreferences()?this.getUserDicoPreferences().selectedTypes:[]},getSelectedExtensions:function(){return this.getUserDicoPreferences()?this.getUserDicoPreferences().selectedExtensions:[]},getUserDicoPreferences:function(){return this.userDicoPreferences},getBaseReferenceTypes:function(){return l.core.settingManager.getSetting("baseReferenceTypes")},getBaseExtensions:function(){var e=l.core.settingManager.getSetting("baseExtentions");return e.forEach(function(e){e.nlsName=l.core.i18nManager.get(e.ds6w)}),e},getBaseInstanceTypes:function(){return l.core.settingManager.getSetting("baseInstanceTypes")},_resetToDefaultValue:function(){let e=this._getDefaultAttributesPreferences();e[o.CUSTOMIZE_HEADER_ATTRIBUTES]=this.getCustomizeHeaderAttributesOnReset(),this._persistPreferences(e),l.core.mediator.publish(o.EVENT_REBUILD_SESSION),l.core.mediator.publish(o.EVENT_UPDATE_IDCARD_RENDERING)},isValidAttributeDBName:function(e){var t=e?e.split("."):null;return!(!t||2!==t.length)},isAPredicate:function(e){if(!e)return!1;const t=e.split(":");return!(!t||!Array.isArray(t)||2!==t.length)},isAGeneratedPredicate:function(e){return s.isAGeneratedPredicate(e)},_updateUserPreferences:function(e){const{selectedExtensions:n,selectedAttributes:i}=e,r=i.map(e=>{const{attrSelectable:t}=e;let i=t;if(this.isAPredicate(i)){const e=this.getAttributeNameFromPredicate("VPMReference",i);if(Array.isArray(e)&&1===e.length){const{Owner:r,Name:o}=e[0];t?i=t:r&&o&&(i=`${r}.${o}`,-1===n.indexOf(r)&&n.push(r))}}const r={dataIndex:e.dataIndex,ds6w:e.ds6w,kind:e.kind,dbName:i,visibleFlag:e.attrVisible},{attrNature:o,attrUserAccess:s,attrRangeValue:a,attrEditable:c}=e;return o&&(r.nature=o),s&&(r.userAccess=s),"boolean"==typeof c&&(r.editable=c),a&&(r.rangeValues=a),e.ds6wFrom&&(r.ds6wFrom=e.ds6wFrom,r.description=l.core.i18nManager.replace(l.core.i18nManager.get("tooltip_Instance_Column"),{label:e.text})),e.isAdditionalColumn&&e.provider&&(r.isAdditionalColumn=e.isAdditionalColumn,r.provider=e.provider),e.customisation&&e.customisation.layout&&Object.keys(e.customisation.layout).length>0&&(e.customisation.layout.canBeGroup||delete e.customisation.layout.canBeGroup,r.customisation=e.customisation),e.attrDim&&e.attrDim.length>0&&(r.attrDim=e.attrDim,e.attrUnit&&e.attrUnit.length>0&&(r.attrUnit=e.attrUnit)),r});if(e&&r&&n&&e.selectedTypes){const i=this.userDicoPreferences?this.userDicoPreferences:void 0,d=i&&i.customViewsInfo?i.customViewsInfo:void 0;this.userDicoPreferences={selectedTypes:e.selectedTypes,selectedExtensions:n,columns:r,customViewsInfo:d,customizeHeaderAttributes:this._updateIdCardPreferences(r)};var s=this._persistPreferences(this.userDicoPreferences),a=l.core.i18nManager.warmupNLS(),c=[];c.push(s),c.push(a),s&&t.allSettled(c).finally(function(){l.core.mediator.publish(o.EVENT_REBUILD_SESSION),l.core.mediator.publish(o.EVENT_UPDATE_IDCARD_RENDERING)})}},retrieveUserDicoPreferences:function(){return t.wrappedWithCancellablePromise(async(e,t)=>{if(this.userDicoPreferences=await this._retrievePreferenceFromWidget(),!this.userDicoPreferences)try{this.userDicoPreferences=await this._retrievePreferencesFromCompass()}catch(e){console.warn(e),this.userDicoPreferences=this._getDefaultAttributesPreferences()}try{await this.upgradeUserDicoPreferences()}catch(e){console.error("upgradeUserDicoPreferences failed !")}e(this.userDicoPreferences)})},upgradeUserDicoPreferences:async function(){await this.upgradeAttributeEditableColumns(),this.upgradeNoneDBAttribute(),this.upgradeDefaultColumns(["level","occurence","MadeFrom","rollup","quantity","Deformable","v6_specdoc_to","Manufacturing"]),this.upgradeQuantityAttributes()},upgradeQuantityAttributes(){const{columns:e}=this.userDicoPreferences||{};if(!Array.isArray(e))return;const t=e.findIndex(e=>"ds6wg:MaterialUsageExtension.DeclaredQuantity"===e.dataIndex);-1!==t&&e.splice(t,1),this.upgradeDefaultColumns(["ds6wg:DELFmiContQuantity_Mass.V_ContQuantity","ds6wg:DELFmiContQuantity_Volume.V_ContQuantity"])},upgradeDefaultColumns(e){if(!Array.isArray(e))return;const{columns:t}=this.userDicoPreferences||{},{columns:n}=this._getDefaultAttributesPreferences()||{};e.forEach(e=>this.upgradeDefaultColumn(e,t,n))},upgradeDefaultColumn(e,t,n){if("string"!=typeof e||!e.trim().length)return;if(!Array.isArray(t)||!Array.isArray(n))return;if(-1!==t.findIndex(t=>t.dataIndex===e))return;console.debug(`column: ${e} not found in stored user preferences => try to add it`);const i=n.findIndex(t=>t.dataIndex===e);if(-1!==i){let r=i;if(i>0){const e=n[i-1].dataIndex;if("string"==typeof e&&e.trim().length){const n=t.findIndex(t=>t.dataIndex===e);-1!==n&&(r=n+1)}}if(-1!=r){console.debug(`column: ${e} inserted at ${r} position`);const o={...n[i],visibleFlag:!1};r<t.length?t.splice(r,0,o):t.push(o)}}else console.error(`column: ${e} not found in default preferences`)},filterEditablePredicateColumnWithoutEditableFlag(e){if("object"!=typeof e)return!1;if(Reflect.has(e,"isAdditionalColumn"))return!1;const{dbName:t,dataIndex:n}=e||{};return"string"==typeof n&&0!==n.trim()&&(-1===Reflect.ownKeys(this.getControlledAppPredicates()).indexOf(n)&&(!Reflect.has(e,"editable")&&("string"==typeof t&&0!==t.trim()&&(!Reflect.has(e,"nature")&&this.isAGeneratedPredicate(e.dataIndex)))))},upgradeNoneDBAttribute:function(){const{columns:e}=this.userDicoPreferences||{};Array.isArray(e)&&e.filter(e=>"level"===e.dataIndex||"occurence"===e.dataIndex||"rollup"===e.dataIndex||"quantity"===e.dataIndex).forEach(e=>e.dbName="")},upgradeAttributeEditableColumns:async function(){const{columns:e,selectedExtensions:t,selectedTypes:n,customViewsInfo:i}=this.userDicoPreferences||{};if(!Array.isArray(e))return;const r=e.filter(this.filterEditablePredicateColumnWithoutEditableFlag.bind(this));if(r.length)try{const e=[...t,...n],i=await s.getPropertiesForClasses(e,l.core),o=s.getAttributePredicatesFromClassPredicates(i,this.getControlledAppPredicates(),this.getMultiValuedAtributes());Array.isArray(o)&&o.length&&r.forEach(e=>{const{dataIndex:t}=e,n=o.find(e=>e.uri===t);if(n){const{nature:t,userAccess:i}=n;t&&!e.nature&&(e.nature=t),i&&!e.userAccess&&(e.userAccess=i)}else console.warn(`column ds6w : ${t} not found in predicates`)})}catch(e){console.error(e)}},_getDefaultAttributesPreferences:function(){return{selectedTypes:l.core.settingManager.getSetting("defaultSelectedTypes"),selectedExtensions:l.core.settingManager.getSetting("defaultSelectedExtensions"),columns:l.core.settingManager.getSetting("defaultAttributes"),customViewsInfo:{},customizeHeaderAttributes:this.getIdCardPreferences()}},_persistPreferences:function(e){if(e&&e.columns&&e.selectedExtensions&&e.selectedTypes){this.userDicoPreferences=e;var t=JSON.stringify(e);return widget.setValue(o.XEN_CUSTO_KEY,t),l.core.dataService.setPreference(o.XEN_CUSTO_KEY,t)}},setCustoInfoToUser:function(e){return this.userDicoPreferences.customViewsInfo=e,e.newColumnPinnedInfo.forEach(e=>{for(let t in this.userDicoPreferences.columns)if(this.userDicoPreferences.columns[t].text==e.text){this.userDicoPreferences.columns[t].pinned=e.pinned?e.pinned:this.userDicoPreferences.columns[t].pinned;break}}),this._persistPreferences(this.userDicoPreferences)},_retrievePreferencesFromCompass:function(){return t.wrappedWithCancellablePromise(function(e,t){var i=l.core.settingManager.getCommand("my_app_getPreference"),r=Object.assign({},i);r.url=r.url+"?name="+l.core.settingManager._getUserPrefKey(o.XEN_CUSTO_KEY),n.perform(r).then(function(n){return n&&"string"==typeof n&&""===n.trim()?t(null):("string"==typeof n&&(widget.getValue(o.XEN_CUSTO_KEY)||widget.setValue(o.XEN_CUSTO_KEY,n),n=JSON.parse(n)),n.selectedTypes&&n.selectedExtensions&&n.columns?e(n):void t(null))}).catch(function(e){console.error(e),t(e)})})},_retrievePreferenceFromWidget:function(){var t={};try{(t=JSON.parse(widget.getValue(o.XEN_CUSTO_KEY)||"{}"))[o.CUSTOMIZE_HEADER_ATTRIBUTES]||(t[o.CUSTOMIZE_HEADER_ATTRIBUTES]=l.core.settingManager.getSetting(o.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES))}catch(e){console.error(e)}return t&&t.selectedExtensions&&Array.isArray(t.columns)&&t.columns.length>0&&t.selectedTypes?e.extend({},{columns:t.columns,selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes,customViewsInfo:t.customViewsInfo,customizeHeaderAttributes:t[o.CUSTOMIZE_HEADER_ATTRIBUTES]?t[o.CUSTOMIZE_HEADER_ATTRIBUTES]:{}}):null},getAttributeDefinition:function(e,t){return e&&t?"ds6w:FileDocument"!==e?this.getAttributeMetas(t):void 0:null},getAttributesForFinalItems:function(e){var t=this.getParametricalAttributesOf(e),n={};n[o.FINAL_ITEMS_DEFAULT]=l.core.i18nManager.get("eng.export.NotSelectedFinalItem");for(var i=0;i<t.length;i++){var r=t[i];l.core.settingManager.getSetting("endItemSupportedAttributeTypes").indexOf(r.type)>=0&&!r.isReadOnly&&(n[r.sixWTag]=r.attrNls)}return n},getParametricalAttributesOf:function(e){var t=this.paramAttributes[e];return t=Array.isArray(t)?t:[]},getBasicsAttributes:function(e){return l.core.settingManager.getSetting("basicsAttributes")[e].map(function(e){return{type:e.type,attrName:e.name,sixWTag:e.name,attrNls:l.core.i18nManager.get(e.name)}})},getAvailableAttributesByType:function(e){var t=this.getBasicsAttributes(e);t=Array.isArray(t)?t:[];var n=this.getParametricalAttributesOf(e),i=t.concat(Array.isArray(n)?n:[]);return i.sort(function(e,t){return e.attrNls.localeCompare(t.attrNls)}),i},loadListOfParametricalAttributes:function(){var e=this;return this._retrieveXENColumnsPromise?this._retrieveXENColumnsPromise:t.wrappedWithCancellablePromise(function(t,n){e._retrieveXENColumnsPromise=e.retrieveXENColumns().catch(()=>{}).finally(function(){t(!0)})})},loadListOfExtensionAttributes:function(){var e=this;return this._retrieveDicoCusto?this._retrieveDicoCusto:t.wrappedWithCancellablePromise(function(t,n){e._retrieveExtAttrPromise=e.retrieveDicoCusto().catch(e=>{}).finally(function(){t(!0)})})},retrieveDicoCusto:function(){var e=this;return t.wrappedWithCancellablePromise(function(t,i){var r=l.core.settingManager.getCommand("dictionary_custo"),o=Object.assign({},r);o.url=o.url.replace("{displayAttributes}","true"),n.perform(o).then(function(n){e._storeCustoAttributesDico(n),e._completeMappingPredicateWithDico(n),t(n)}).catch(function(e){console.error(e),i(e)})})},retrieveXENColumns:function(){var e=this;return t.wrappedWithCancellablePromise(function(t,i){var r=l.core.settingManager.getCommand("get_xen_columns"),o=Object.assign({},r);o.url=o.url.replace("{lang}",l.core.settingManager.getLanguage()),n.perform(o).then(function(n){n&&Array.isArray(n.VPMReference)&&(n.VPMReference=e._buildAuthorizedValuesArray(n.VPMReference)),e._storeTypeParamAttributes(n),t(n)}).catch(function(e){console.error(e),i(e)})})},_storeCustoAttributesDico:function(e){var t={};if(e&&e.Dictionary&&e.Dictionary.Interfaces){var n=e.Dictionary.Interfaces;for(var i in n){var r=n[i].Attributes;if(r)for(var o in r){const e=r[o].SixWPredicate;e&&(t[e]?t[e].push(r[o]):t[e]=[r[o]])}}}this.custoDictionary=e,this.mappingCusto6WAttributes=t},_storeAutomaticExtensionAttributes:function(e){var t=[];e&&e.results&&Array.isArray(e.results)&&e.results.forEach(function(e){e.name;var n=e.interfaces;n&&Array.isArray(n)&&n.forEach(function(e){var n=e.name;if(!(!e.automatic||"Yes"!==e.automatic)){var i=e.attributes;i&&Array.isArray(i)&&i.forEach(function(e){var i=e.name;t.push({attrName:n+"."+i,name:i})})}})}),this.autoExtAttributes=t},_storeTypeParamAttributes:function(e){this.paramAttributes=e},_buildAuthorizedValuesArray:function(e){return e.map(function(e){return e.authorizedValues=e.authorizedValues?e.authorizedValues.split(","):[],e.attrName&&(e.alphaNumAttrName=e.attrName.replace(/[^a-zA-Z0-9 ]/g,"")),e})},getCustomAttribute:function(e){return this.getParametricalAttributesOf("VPMReference").find(function(t){return e===t.sixWTag})},getAttributesInfoFromPredicate:function(e){return this.mappingCusto6WAttributes[e]},getAttributeInfosFromInternalName:function(e){var t=this.getParametricalAttributesOf("VPMReference").find(function(t){var n=t.attrName?t.attrName.split("."):[],i=n.length>1?n[1]:null;return i&&e===i});return t||this.autoExtAttributes.find(function(t){return e===t.name})},getMetaTypes:function(e,n){var i=this;return t.wrappedWithPromise(function(t,r){if(!Array.isArray(e))throw new Error("invalid input");var o=l.core.settingManager.getSetting("acceptedTypeForPropertiesAsInstance"),s=new Array(e.length);i.getRootTypes(e).then(function(e){for(var i=0;i<e.length;i++){var r=e[i];-1!==o.indexOf(r)?s[i]=n?"relationship":"businessobject":s[i]="businessobject"}return t(s)})})},getRootTypes:function(e){var n=this;return t.wrappedWithPromise(function(t,i){if(!Array.isArray(e))throw new Error("invalid input");var r=n._getUnknownTypes(e),o=new Array(e.length);if(0===r.length)return n._fillRootsFromDico(e,o),t(o);n.getUnknownTypesHierarchy(r).finally(function(){return n._fillRootsFromDico(e,o),t(o)})})},areBOMContentTypes:function(e,n){var i=this;return t.wrappedWithPromise(function(t,r){if(!Array.isArray(e))throw new Error("invalid input");var o=i._getUnknownTypes(e);if(0===o.length){for(var s=0;s<e.length;s++)if(i._isInUnsupportedTypes(e[s])){var a=n?n[e[s]]:e[s];return r([a])}return t(!0)}i.getUnknownTypesHierarchy(o).finally(function(){for(var o=0;o<e.length;o++)if(i._isInUnsupportedTypes(e[o])){var s=n?n[e[o]]:e[o];return r([s])}return t(!0)})})},_fillRootsFromDico:function(e,t){for(var n=Object.keys(this.localDico),i=0;i<e.length;i++){for(var r=!1,o=0;o<n.length;o++){var s=n[o];if(s.startsWith("kindOf")){var a=this._getBelongingRootFromKindOf(e[i],this.localDico[s]);if(a){t[i]=a;r=!0;break}}}r||(t[i]=null)}},syncIsAnEngineeringItem:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfEngItem)},syncIsAFilter:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfFilter)},syncIsADocument:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfDocument)},syncIsAMaterial:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfMaterial)},syncIsADrawing:function(e){return this._getBelongingRootFromKindOf(e,this.localDico.kindOfDrawing)},areEngeeringItems:function(e,t){return this.areA(e,this.localDico.kindOfEngItem,t)},areDocuments:function(e,t){return this.areA(e,this.localDico.kindOfDocument,t)},areDrawings:function(e,t){return this.areA(e,this.localDico.kindOfDrawing,t)},areA:function(e,n,i){var r=this;return t.wrappedWithPromise(function(t,o){if(!Array.isArray(e))throw new Error("invalid input");for(var s=!0,a=[],l=0;l<e.length;l++){var c=e[l];if(!r._getBelongingRootFromKindOf(c,n)||r._isInUnsupportedTypes(c)){s=!1;var d=i?i[c]:c;a.push(d);break}}if(s)return t(!0);var u=r._getUnknownTypes(e);if(0===u.length)return o(a);r.getUnknownTypesHierarchy(u).finally(function(){for(var e=0;e<u.length;e++){var s=u[e];if(!r._getBelongingRootFromKindOf(s,n)){var a=i?i[s]:s;return o([a])}}t(!0)})})},_getUnknownTypes:function(e){var t=[],n=this;return e.forEach(function(e){n._getBelongingRootFromKindOf(e,n.localDico.kindOfEngItem)||n._getBelongingRootFromKindOf(e,n.localDico.kindOfDocument)||n._getBelongingRootFromKindOf(e,n.localDico.kindOfMaterial)||n._getBelongingRootFromKindOf(e,n.localDico.kindOfDrawing)||n._isInUnsupportedTypes(e)||t.push(e)}),t},_isInUnsupportedTypes:function(e){return!!this.localDico.unsupportedTypes[e]},_applyTypeClassif:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var n=e[t],i=this._findMatchInHierarchy(this.localDico.kindOfEngItem,n);if(i)this.localDico.kindOfEngItem[i].push(n.type);else{var r=this._findMatchInHierarchy(this.localDico.kindOfDocument,n);r?this.localDico.kindOfDocument[r].push(n.type):this.localDico.unsupportedTypes[n.type]=!0}}else this.logger.error(" _applyTypeClassif called with invalid input")},_findMatchInHierarchy:function(e,t){for(var n=Object.keys(e),i=0;i<n.length;i++)if(-1!==t.hierarchy.indexOf(n[i]))return n[i];return null},_getBelongingRootFromKindOf:function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++)if(-1!==t[n[i]].indexOf(e))return n[i];return null},getUnknownTypesHierarchy:function(e){var i=this;return t.wrappedWithCancellablePromise(function(t,r){if(!Array.isArray(e))throw new Error("invalid input");var o={types:e},s=l.core.settingManager.getCommand("gettypeshierarchy");n.perform(s,o).then(function(e){i._applyTypeClassif(e.types_hierarchies),t(e)}).catch(function(e){r(e)})})},getTypeHierarchy:function(e){var i=this;return t.wrappedWithCancellablePromise(function(t,r){let o={};if(o=i._typeHierarchies.find(function(t){return e===t.type}))return void t(o);let s={types:[e]};var a=l.core.settingManager.getCommand("gettypeshierarchy");n.perform(a,s).then(function(e){i._typeHierarchies.push(e.types_hierarchies[0]),t(e.types_hierarchies[0])}).catch(function(n){t({type:e,hierarchy:[]})})})},_completeMappingPredicateForTypes:function(e,t){if(Array.isArray(e)&&t){var n=this;for(let i in t){let r=t[i].SixWPredicate;const s=t[i].Owner,a=t[i].Name,l=s?`${s}.${a}`:a;r||(r=`ds6wg:${l}`),r&&e.forEach(e=>{n.mappingPredicates[e]||(n.mappingPredicates[e]={}),n.mappingPredicates[e][r]?(Array.isArray(n.mappingPredicates[e][r])||(n.mappingPredicates[e][r]=[n.mappingPredicates[e][r]]),n.mappingPredicates[e][r].push(l)):n.mappingPredicates[e][r]=l,t[i].ds6w=r,o.CONST_YES===t[i].MultiValuated&&n.mappingMultiValuatedAttributes.push(t[i]),o.CONST_YES===t[i].HasRangeDefined&&n.mappingRangeValueAttributes.push(t[i]),n._mappingTerminalItemOptionalAttributes(t[i])})}}},retreiveParentTypesAttributes:function(e,t){let n={};if(e&&t){let i=e;for(;t[i]&&t[i].Attributes&&(n=Object.assign(n,t[i].Attributes),t[i].Parent);)i=t[i].Parent}return n},_completeMappingPredicateWithDico:function(e){if(e&&e.Dictionary&&e.Dictionary.Interfaces){const t=e.Dictionary.Interfaces;for(let e in t){const n=t[e].ScopeTypes?t[e].ScopeTypes:t[e].ScopeRelationships;let i=this.retreiveParentTypesAttributes(e,t);this._completeMappingPredicateForTypes(n,i)}const n=e.Dictionary.Types;for(let e in n){let t=this.retreiveParentTypesAttributes(e,n);this._completeMappingPredicateForTypes([e],t)}const i=e.Dictionary.Relationships;for(let e in i){let t=this.retreiveParentTypesAttributes(e,i);this._completeMappingPredicateForTypes([e],t)}}},getAttributeNameFromPredicate:function(e,t){const n=this.mappingPredicates[e];return n?n[t]:""},isMultiValuedAttribute:function(e){return this.getMultiValuedAtributes().find(function(t){return e===t.ds6w})},getMultiValuedAtributes:function(){return this.mappingMultiValuatedAttributes},getRangeValueAttribute:function(e){return this.mappingRangeValueAttributes.find(function(t){return e===t.ds6w})},getRangeValueAttributes:function(){return this.mappingRangeValueAttributes},getTerminalAttributesInfo:function(e){return this.mappingTerminalAttributes[e]?this.mappingTerminalAttributes[e]:this.getAttributeMetas(e)&&!["ds6w:reserved","ds6wg:PLMReference.V_isLastVersion"].includes(e)?this.getAttributeMetas(e):l.core.settingManager.getSetting("defaultAttributes").find(function(t){let n="tree"===t.dataIndex?"ds6w:label":t.dataIndex;return e===n?t:void 0})},_mappingTerminalItemOptionalAttributes:function(e){let t=e.Dimension;o.CONST_YES,e.MultiValuated;if(!t){let t=l.core.settingManager.getSetting("endItemSupportedAttributeTypes"),n=e.Type;t.includes(n)&&(this.mappingTerminalAttributes[e.ds6w]=e)}},getVisibleTerminalAttrForBO:function(){let e=this.getMappedTerminalItemAtributes(),t=l.core.settingManager.getSetting("excludeSixwForTerminalItem");return this.getVisibleAttrForBO().filter(function(n){let i=l.core.settingManager.getSetting("endItemSupportedAttributeTypes"),r=n.kind,o=n.attrDim;return(e.hasOwnProperty(n.ds6w)||!t.includes(n.ds6w))&&i.includes(r)&&!o})},getMappedTerminalItemAtributes:function(){return this.mappingTerminalAttributes},getTerminalItemAtributes:function(){let e=[{value:o.FINAL_ITEMS_DEFAULT,label:l.core.i18nManager.get("eng.export.NotSelectedFinalItem")}],t=this.getVisibleTerminalAttrForBO();return Array.isArray(t)&&t.length>0&&t.forEach(function(t){e.push({value:"tree"===t.dataIndex?"ds6w:label":t.dataIndex,label:t.text})}),e},getControlledAppPredicates:function(){if(this.managedAppColumns)return this.managedAppColumns;const{managedColumns:e}=JSON.parse(a),t=Reflect.ownKeys(e),n={};return t.map(t=>{const{options:i}=e[t],{editableFlag:r,typeRepresentation:o}=i||{};let s=t;"tree"===t&&(s="ds6w:label"),n[s]={},("string"==typeof r&&"true"===r||"string"==typeof o&&"url"===o)&&(n[s].userAccess="ReadWrite")}),this.managedAppColumns={...n,"ds6w:modified":{},"ds6w:created":{},"ds6w:reservedBy":{},"ds6w:type":{},"ds6w:identifier":{},"ds6w:project":{},"ds6w:organizationResponsible":{},"ds6w:organizationResponsible-Instance":{},"ds6w:project-Instance":{},"ds6w:kind":{},"ds6w:kind-Instance":{},"ds6w:library":{},"ds6w:folder":{},"ds6w:bookmarks":{},"ds6w:libraries":{},"ds6w:description-Instance":{userAccess:"ReadWrite"},"ds6wg:PLMReference.V_versionComment":{userAccess:"ReadWrite"},"ds6w:globalType":{ignored:!0},"ds6wg:MaterialUsageExtension.DeclaredQuantity":{ignored:!0}},this.managedAppColumns},getCustomizeHeaderAttributesOnReset:function(){let e=this.getIdCardPreferences(),t=this._getDefaultVisibleAttributes();for(let n in e)t.includes(n)||delete e[n];return e},_getDefaultVisibleAttributes:function(){let e=l.core.settingManager.getSetting("defaultAttributes"),t=[];for(let n=0;n<e.length;n++)e[n].visibleFlag&&t.push(e[n].ds6w);return t},getIdCardPreferences:function(){return this.getUserDicoPreferences()&&this.getUserDicoPreferences()[o.CUSTOMIZE_HEADER_ATTRIBUTES]?this.getUserDicoPreferences()[o.CUSTOMIZE_HEADER_ATTRIBUTES]:l.core.settingManager.getSetting(o.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES)},_updateIdCardPreferences:function(e){let t=this.getIdCardPreferences(),n=this._getVisibleAttributeTags(e);if(t){let e=Object.keys(t);for(let i=0;i<e.length;i++)n.includes(e[i])||delete t[e[i]]}return t},_getVisibleAttributeTags:function(e){let t=[];for(let n=0;n<e.length;n++)e[n].visibleFlag&&t.push(e[n].ds6w);return t}}}),define("DS/ENOXEngineer/utils/Search",["UWA/Core","UWA/Utils/InterCom","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerInfra/Mediator","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o){"use strict";var s=function(n){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var i=this;this.socket.addListener("onCloseTransient",function(e){i.socket.dispatchEvent("UnregisterContext",{widget_id:widget.id}),r.prototype.publish(o.EVENT_CLOSE_RUNNING_CMD)}),i.defaultOptions=n,i.defaultOptions={multiSel:!0,source:["3dspace"]},e.extend(i.defaultOptions,n||{})};return s.prototype.options=function(e,t,n,r,o,s){var a={};a.title=e,a.mode="furtive",a.app_socket_id=this.socketName,a.widget_id=widget.id;const l=!(!s||""===s.trim());return a.default_with_precond=l,a.multiSel=o,a.source=this.defaultOptions.source||[],a.tenant=i.getPlatformId(),a.role=n,Array.isArray(t)&&(a.precond="",t.forEach(function(e,t){0!==t&&(a.precond+=" OR "),a.precond+='flattenedtaxonomies:"types/'+e+'"',"Drawing"===e&&(a.precond+=" AND [ds6w:composed]:FALSE")})),a.precond&&""!==a.precond&&(a.precond="("+a.precond+")"),s&&a.precond&&(a.precond="("+a.precond+" AND "+s+")"),r&&""!==r.trim()&&(a.default_search_criteria=r),a},s.prototype.destroy=function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("UnregisterContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.removeListener("clearSearch",this.clearListener),this.socket.disconnect(),delete this.socket},s.prototype.activate=function(e,t,n,i,r,o,s){var a=this.options(e,t,n,i,r,o);UWA.is(s,"function")||(a.mode="default"),this.callback=s,this.socket.dispatchEvent("UnregisterContext",{widget_id:widget.id}),this.socket.dispatchEvent("RegisterContext",a),this.socket.dispatchEvent("InContextSearch",a)},s.prototype.isAvailable=function(){return UWA.is(this.socket)},s.prototype.launchASearch=function(e){this.isAvailable()&&(void 0!==e.multiSel&&null!==e.multiSel||(e.multiSel=this.defaultOptions.multiSel||!0),this.activate(e.title||"",e.allowedTypes||"VPMReference",e.role||"",n.getAugmenttedQueryForSearch(e.criteria),e.multiSel,e.precondition,function(t){e.in_apps_callback(t)}))},s.prototype.objectsSelected=function(e){this.callback&&this.callback(e)},s.prototype.clearOnCancel=function(e){this.socket.dispatchEvent("UnregisterContext",{widget_id:widget.id})},s}),define("DS/ENOXEngineer/services/EngineeringDataProvider",["UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/utils/ResponseParser","DS/DocumentManagement/DocumentManagement","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/SizedMap","DS/ENOXEngineer/utils/MaturityUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/ExpandPayloadFactory","DS/ENOXEngineer/utils/expand/ExpandErrorManager"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m){"use strict";var f=null;const{use_expand_v2:E,fetch_doc_expand_v2:C}=g,_=E?g.COMMAND_WS_EXPAND_CV_V2:g.COMMAND_WS_EXPAND_CV,y=E?g.COMMAND_WS_MULTIEXPAND_V2:g.COMMAND_WS_MULTIEXPAND,M=e=>e===g.COMMAND_WS_EXPAND_CV_V2||e===g.COMMAND_WS_EXPAND_CV,N=e=>e===g.COMMAND_WS_MULTIEXPAND_V2||e===g.COMMAND_WS_EXPAND_CV_V2;function v(e){return!(!e||!e.physicalId&&!e.paths)}return function(){return{initialize:function(e){f=e,this.DOC_REL_NAME=g.SPECIFICATION_DOCUMENT,this.logger=f.core.logger.get("EngineeringDataProvider"),this.logger.info(" initializing Xeng Data provider"),e.sandboxBase.dataService=this,e.core.dataService=this,e.core.dataService.searchManager=new r({multiSel:!1}),e.sandboxBase.localStorage=e.core.localStorage=o,f.optionalStartupPromises.push(this.loadOpenPreference())},_updateRecentsList:function(t,n){if(!e.is(n))return this.logger.error(" call of _updateRecentsList with missing parameter"),null;var i=null;for(i=t&&""!==t.trim()?t.trim().split(","):[];-1!==i.indexOf(n);){var r=i.indexOf(n);i.splice(r,1)}return i.length>=f.core.settingManager.getSetting("recentsEngItemsSize")?(i.pop(),i.unshift(n),i.join()):(i.unshift(n),i.join())},setPreference:function(i,r){if(this.logger.info(" call of setPreference"),!e.is(i)||!e.is(r))return this.logger.error(" call of setPreference with missing parameter"),null;var o=f.core.settingManager.getCommand("my_app_setPreference"),s={name:f.core.settingManager._getUserPrefKey(i),value:r};return t.wrappedWithCancellablePromise(function(e,t){n.perform(o,s).then(function(t){return e(t)}).catch(function(e){t(e)})})},getCommandSettings:function(){var e=f.core.settingManager.getCommand("get_command_settings");return t.wrappedWithCancellablePromise(function(t,i){n.perform(e).then(function(e){t(e)}).catch(function(e){return i(e)})})},getPreference:function(i){if(this.logger.info(" call of getPreference"),!e.is(i))return this.logger.error(" call of getPreference with missing parameter"),null;var r=f.core.settingManager.getCommand("my_app_getPreference"),o=Object.assign({},r);return o.url=o.url+"?name="+f.core.settingManager._getUserPrefKey(i),t.wrappedWithCancellablePromise(function(e,t){n.perform(o).then(function(t){return o=null,t&&""===t.trim()?e(null):e(t)}).catch(function(e){t(e)})})},addRecentsEngItem:function(e){var t=this;return this.getRecentsEngItems().then(function(n){var i=n.replace(new RegExp('"',"g"),"");if(e&&!(e.length<3)&&0!==i.indexOf(e)){var r=t._updateRecentsList(i,e);r&&t.setPreference(g.USER_RECENTS_ENG_ITEMS,r)}})},removeFromRecents:function(e){var t=this;return this.getRecentsEngItems().then(function(n){var i=null;i=n&&""!==n.trim()?n.split(","):[];for(var r=[],o=0;o<i.length;o++)-1===e.indexOf(i[o])&&r.push(i[o]);return t.setPreference(g.USER_RECENTS_ENG_ITEMS,r.join())})},loadUnitsOfDimension:function(){return t.wrappedWithCancellablePromise(function(e,t){var i=f.core.settingManager.getCommand("getDimensions");n.perform(i).then(function(t){e(t)}).catch(function(e){console.error(e),t(e)})})},dimensionsUnitsConverter:function(e){return t.wrappedWithCancellablePromise(function(t,i){if(!Array.isArray(e))throw new Error("invalid  input");var r=f.core.settingManager.getCommand("convertValues");n.perform(r,e).then(function(e){t(e)}).catch(function(e){console.error(e),i(e)})})},setQuantityOnMaterial:function(e){return t.wrappedWithCancellablePromise(function(t,i){var r=f.core.settingManager.getCommand("setQuantity");n.perform(r,e).then(function(e){f.core.sessionManager.setAuthoringMode("authoring"),t(e)}).catch(function(e){console.error(e),i(e)})})},modifyQuantityOnMaterial:function(e){return t.wrappedWithCancellablePromise(function(t,i){var r=f.core.settingManager.getCommand("modifyQuantity");n.perform(r,e).then(function(e){f.core.sessionManager.setAuthoringMode("authoring"),t(e)}).catch(function(e){console.error(e),i(e)})})},getStatesAttributes:function(e){this.logger.info(" call of getStatesAttributes ");var i=this;if(!Array.isArray(e))return;i.existingPolicies||(i.existingPolicies=[]);let r=e.filter(e=>-1==i.existingPolicies.indexOf(e));if(!(r.length<1)){var o={policies:r};return t.wrappedWithCancellablePromise(function(e,t){var s=f.core.settingManager.getCommand("getStatesAttributes");n.perform(s,o).then(function(t){i.existingPolicies.push(...r),p.addCSSMaturityClasses(o.policies,"wux-controls-label",t),e(t)}).catch(function(e){console.log(e),t(e)})})}},getConfigSettings:function(){return Array.isArray(this.configSettings)?this.configSettings:[]},loadConfigurationSettings:function(){var e=this;return t.wrappedWithCancellablePromise(function(t,i){if(!f.core.settingManager.isConfigRoleGranted())return i("user.not.granted.config");if(e.configSettingsIsLoaded)return t(e.getConfigSettings());var r=f.core.settingManager.getCommand("getConfigSettings");n.perform(r,{version:"1.0",settings:["DecoupleVariantEvolution","StaticMappingActivation"]}).then(function(n){e.configSettingsIsLoaded=!0,Array.isArray(n.settings)&&(e.configSettings=n.settings),t(n)}).catch(function(e){i(e)})})},getRecentsEngItems:function(){return this.getPreference(g.USER_RECENTS_ENG_ITEMS)},getCurrentUserRecentsItems:function(){this.logger.info(" call of getCurrentUserRecentsItems");var e=this;return t.wrappedWithCancellablePromise(function(t,n){e.getRecentsEngItems().then(function(i){e.recentsCache=i,e.logger.info(" stringPids : "+i),i&&i.length>0?e.getEngItemsData(i.split(",").filter(function(e){return e&&e.trim().length>0}),!1,!0).then(function(e){t(e)}).catch(function(e){n(e)}):t(null)}).catch(function(e){n(e)})})},loadOpenPreference:function(){var e=this;return e.openPrefPromise=this.getPreference(g.USER_CONF_PREFERENCES).then(function(t){e.openPrefMap=new u({maxSize:f.core.settingManager.getSetting(g.PREFERENCE_MAX_SIZE),initialContent:t?JSON.parse(t):{}}),console.log(e.openPrefMap)}).catch(function(e){console.error(e)}),e.openPrefPromise},getOpenPrefMap:function(){return this.openPrefMap},saveEngItemOpenPref:function(e,t){if(!e)throw new Error(" missing parameter");t?this.getOpenPrefMap().put(e,t):this.getOpenPrefMap().delete(e);var n=this.getOpenPrefMap()?this.getOpenPrefMap().getContent():{};return this.setPreference(g.USER_CONF_PREFERENCES,JSON.stringify(n)).then(function(){return!0}).catch(function(e){throw console.error(e),new Error(e)})},getEngItemConfigurationInfo:function(e){if(this.logger.info(" call of getEngItemConfigurationInfo "),!e.pid)throw new Error("pid is a mandatory parameter");var i=f.core.settingManager.getCommand("getConfiguredObjectInfo"),r=Object.assign({},i);return r.url=r.url.replace("{pid}",e.pid),t.wrappedWithCancellablePromise(function(e,t){n.perform(r).then(function(t){r=null,e(f.core.Factories.configItemsFactory.getModelsFromConfigInfo(t))}).catch(function(e){console.log(e),t(e)})})},getUserEvolutionViewPref:function(){try{return widget.getValue(g.USER_EVOLUTION_PREF)||g.CONF_OFFICIAL_VIEW}catch(e){return g.CONF_OFFICIAL_VIEW}},setUserEvolutionViewPref:function(e){try{widget.setValue(g.USER_EVOLUTION_PREF,e)}catch(e){this.logger.error(" fail to set evolution filter preference ")}},getUserWorkUnderEvolDlgPref:function(){try{return widget.getValue(g.USER_WORKUNDER_EVOL_PREF)}catch(e){return null}},getUserWorkUnderShowPref:function(){try{return widget.getValue(g.CHANGECONTROL_SHOW_STATE)}catch(e){return null}},getUserWorkUnderPositionPref:function(){try{return widget.getValue(g.CHANGECONTROL_POSITION)}catch(e){return null}},setUserWorkUnderEvolDlgPref:function(e){try{widget.setValue(g.USER_WORKUNDER_EVOL_PREF,e)}catch(e){this.logger.error(" fail to set work under evolution preference ")}},getModelVersionsFromModel:function(e){return t.wrappedWithCancellablePromise(function(t,i){if(!e)throw new Error("bad inputs");var r=f.core.settingManager.getCommand("modelInfo"),o=Object.assign({},r);o.url=o.url.replace("{pid}",e),n.perform(o).then(function(e){o=null,t(f.core.Factories.configItemsFactory.getModelVersionsFromModelInfo(e))}).catch(function(e){console.log(e),i(e)})})},getModelItemFromAVersion:function(e){return t.wrappedWithCancellablePromise(function(t,i){e||t(e);var r=f.core.settingManager.getCommand("modelFromVersion"),o=Object.assign({},r);o.url=o.url.replace("{pid}",e),n.perform(o).then(function(e){t(e)}).catch(function(e){console.log(e),i(e)})})},updateEngineeringItemConfigContext:function(e){return t.wrappedWithCancellablePromise(function(t,i){if(!e.activeEngItem||void 0===e.selectedModel)throw new Error("bad inputs");var r=f.core.settingManager.getCommand("setConfContext"),o=[];if(e.activeEngItem.getPreferedAttachedConfigModel()&&e.activeEngItem.getPreferedAttachedConfigModel().getID()&&e.selectedModel&&e.activeEngItem.getPreferedAttachedConfigModel().getID()===e.selectedModel)return t(!0);if(!f.core.settingManager.isConfigAuthorized())return i(f.core.i18nManager.get("error.config.model.cannotUpdate.license"));e.activeEngItem.getPreferedAttachedConfigModel()&&e.activeEngItem.getPreferedAttachedConfigModel().getID()&&!e.selectedModel&&(e.activeEngItem.attachPreferedConfigModel(e.selectedModel),e.activeEngItem.updateUserConfigPreferences(),e.activeEngItem.showModelVersionChooser=!1),e.selectedModel&&o.push(e.selectedModel);const a={version:r.inputVersion,content:{attachCfgCtxt:o,detachCfgCtxt:[],enabledCriteria:o.length>0?r.enabledCriteria:void 0}};switch(a.version){case"1.2":a.pidList=[e.activeEngItem.getID()];break;default:a.pid=e.activeEngItem.getID()}n.perform(r,a).then(function(e){for(var n=s.parseSetConfContext(e),r=0;r<n.length;r++)if(!n[r].status)return i(n[r].message);"SUCCESS"===e.status&&0===e.contexts.numberOf?d.notifyAlert(f.core.i18nManager.get("eng.operation.config.filtering.removed.notify")):d.sucessAlert(f.core.i18nManager.get("eng.operation.confContextUpdate.sucess")),t(!0)}).catch(function(e){return i(f.core.i18nManager.get("error.cannotUpdate.config.model"))})})},federadedSearch:function(e){if(this.logger.info(" call of federadedSearch "),!e.query)throw new Error("query is a mandatory parameter");var t=f.core.settingManager.getCommand("fed_myEng"),i={label:f.core.settingManager.getCVRequestLabel(),nresults:e.nresults||100,order_by:"desc",order_field:"ds6w:modified",query:e.query,select_predicate:e.predicates||f.core.settingManager.getSetting("select_predicate"),select_file:["icon","thumbnail_2d"],start:"0",tenant:f.core.settingManager.getPlatformId(),with_indexing_date:!0,with_nls:!0,source:e.source||t.source};return n.perform(t,JSON.stringify(i))},fireAutocompleteSearch:function(e){var n=this,r={predicates:["ds6w:label","physicalid","ds6wg:revision"],nresults:e.nresults};Array.isArray(e.sources)&&e.sources.length>0&&(r.sources=e.sources);var o=i.getAugmenttedQueryForSearch(e.criteria);if(Array.isArray(e.targetTypes)&&e.targetTypes.length>0){for(var a='flattenedtaxonomies:"types/'+e.targetTypes[0]+'"',l=1;l<e.targetTypes.length;l++)a+=' OR flattenedtaxonomies:"types/'+e.targetTypes[l]+'"';r.query="("+a+") AND "+o}else r.query=o;return e.precond&&(r.query=e.precond+" AND "+r.query),t.wrappedWithPromise(function(e,t){n.federadedSearch(r).then(function(t){var n=s.parseFetchResult(t);e(n.results)}).catch(function(e){t(e)})})},loadModelVersionProdConf:function(e,i){return t.wrappedWithCancellablePromise(function(t,r){e&&i||r(new Error("invalid input"));var o=f.core.settingManager.getCommand("getModelPCInfos"),s=Object.assign({},o);s.url=s.url.replace("{pid}",e),s.param=s.param.replace("{prodIds}","pid:"+i),s.url=s.url+"?filteringCriteria="+UWA.Utils.encodeUrl(s.param),n.perform(s).then(function(e){return s=null,t(e)}).catch(function(e){console.error(e),r(e)})})},createVolatileFilter:function(e){return this.logger.info(" call of createVolatileFilter"),t.wrappedWithCancellablePromise(function(t,i){if(!e.isConfigured()||!e.getPreferedAttachedConfigModel())return t(null);var r=e.getPreferedAttachedConfigModel().getPreferredConfiguration();if(r&&r.id)r.FilterCompiledForm||d.warningAlert(f.core.i18nManager.get("eng.missing.filterinfo.onPC")),t({filterBinaryForExpand:r.FilterCompiledForm});else{var o=f.core.settingManager.getCommand("createVolatileFilter"),s=e.getPreferedAttachedConfigModel().buildFilterXML(),a={version:o.version,output:o.output,dictionary:{version:"0.1",id:{pid:e.getPreferedAttachedConfigModel().getID()}},expression:{version:"0.1",format:"xml",content:s}};n.perform(o,JSON.stringify(a)).then(function(e){return t(e)}).catch(function(e){console.error(e),i(e)})}})},getCurrentUserRootEng:function(){this.logger.info(" call of getCurrentUserRootEng on index");var e=this,n={query:"[flattenedtaxonomies]:types/VPMReference AND [owner]:"+f.core.settingManager.getCurrentUser().id,nresults:40};return t.wrappedWithCancellablePromise(function(t,i){e.federadedSearch(n).then(function(n){var r={serverResponse:n};if(n.infos&&0===n.infos.nhits)return t([]);e._indexFormatFetchManager(r,t,i)}).catch(function(e){i(e)})})},getUserRecentEditedEngineeringItems:function(){this.logger.info(" call of getUserRecentEditedEngineeringItems");var e=this;return t.wrappedWithCancellablePromise(function(t,n){e._getRecentAuthoredItems().then(function(e){if(Array.isArray(e)){var n=e.map(function(e){return e.getType()||"##unknown##"}),i={"##unknown##":!0},r=n.filter(function(e){return!i.hasOwnProperty(e)&&(i[e]=!0)});f.core.dicoService.areEngeeringItems(r,r).finally(function(){var n=e.filter(function(e){return f.core.dicoService.syncIsAnEngineeringItem(e.getType())||f.core.dicoService.syncIsAFilter(e.getType())});t(Array.isArray(n)?n:[])})}}).catch(n)})},_getRecentAuthoredItems:function(){this.logger.info(" call of _getRecentAuthoredItems");var e=this;return t.wrappedWithCancellablePromise(function(t,i){var r=f.core.settingManager.getCommand("fed_myEng_on_Recent"),o={delta_time_interval:r.deltaTime,version:2,with_nls:!1,label:f.core.settingManager.getCVRequestLabel(),locale:f.core.settingManager.getLanguage(),select_predicate:f.core.settingManager.getSetting("select_predicate"),select_file:["icon","thumbnail_2d"],source:r.source,specific_source_parameter:{},tenant:f.core.settingManager.getPlatformId(),nresults:r.nresults||40};n.perform(r,JSON.stringify(o)).then(function(n){if(n.infos&&0===n.infos.nhits)return t([]);e._indexFormatFetchManager({serverResponse:n},t,i)}).catch(function(e){i(e)})})},getListNodesFromPaths:function(e){var n=this;return t.wrappedWithCancellablePromise(function(t,i){if(!e||!Array.isArray(e.paths))return i("invalid input");n.partialExpands(e).then(function(n){if(e&&!0===e.isRefreshing){const g=[],h=[];n.forEach(e=>{e.isCoreMaterialType()?h.push(e):g.push(e)});var i=[];if(g.length)for(var r=e.paths.length,o=0;o<r;o++)for(var s=e.paths[o],a=s.length>0?s[s.length-1]:null,l=s.length>2?s[s.length-2]:null,c=0;c<n.length;c++){var d=n[c],u=d.getRelationID?d.getRelationID():null,p=d.getID?d.getID():null;if(u){if(u===l){i.push(d);break}}else{if(p&&p===a&&e.isFromReplace&&"reference"==e.nodesType&&d.isEngineeringItem()){if(i.push(d),JSON.stringify(d.getOccurrencePath())!==JSON.stringify(s))continue;break}if(p&&p===a){i.push(d);break}}}h.length&&h.forEach(e=>i.push(e)),t(i)}else t(n)}).catch(function(e){console.warn(e),i(e)})})},multiExpand:function(e,n){var i=this;return t.wrappedWithCancellablePromise(function(t,r){i.doExpand(e,{executor:y}).then(function(e){i._processExpandResponse(e,t,r,n)}).catch(function(e){r(e)})})},multiExpandForFindInContext:function(e,n){let i=this;return e.label="FindInCtxFTS-"+f.core.settingManager.getCVRequestLabel(),t.wrappedWithCancellablePromise(function(t,n){e&&i.doExpand(e,{executor:y}).then(t).catch(n)})},getEngItemInstances:function(e,t,n,i){return this.expand(e,t,"1",n,i)},partialExpands:function(e){var n=this;return t.wrappedWithCancellablePromise(function(t,i){if(!e||!Array.isArray(e.paths)||0===e.paths.length)return i("invalid input");n.expand(null,null,"0",null,e).then(function(e){return t(e)}).catch(i)})},multiexpandBI:function(n,i){if(e.is(n)){const e={label:f.core.settingManager.getCVRequestLabel(),synthesis_mode:"flat",union:{expand:[{expand_iter:i,root_physicalid:n,"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency"]}]}};N(y)||(e.max_count_path="1");var r=this;return t.wrappedWithCancellablePromise(function(t,n){r.doExpand(e,{executor:y},new m(f),!1).then(function(e){t(e&&e.facets?e.facets:null)}).catch(function(e){n(e)})})}},getExpandPayload:function(t,n,i,r,o,s){var a=null;return e.is(t)&&(this.logger.info("call of getEngItemInstances on authoring mode = "+o),a={authored:o,include_param_Attributes:!(void 0!==r&&!r),no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',level:i,intent:"XEN_attributes",source:"cstorage"},s&&s.staticMapping&&Array.isArray(s.staticMapping.path)?a.paths=[s.staticMapping.path]:a.roots=[{id:t}],widget.getValue("ShowNotInBOM")||(a.sequence_filter=[{definition:[{type_filter_rel:["PLMInstance"],"q.query":'NOT ([ds6wg:SynchroEBOMExt.V_InEBOMUser]:"FALSE" )'}]}]),n&&!o?a.config_filter=n:n&&o&&console.log("cannot filter in authoring mode")),a},buildExpandGenericOption:function(t){var n=null;if(v(t)){if(n={no_type_filter_rel:["XCADBaseDependency"],"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',compute_select_bo:["thumbnail_2d","icon"],expand_iter:t.level,fcs_url_mode:"REDIRECT",select_bo:Array.isArray(t.referenceTags)?t.referenceTags:f.core.dicoService.getTagsForBOWithMandatories(),select_rel:Array.isArray(t.instanceTags)?t.instanceTags:f.core.dicoService.getTagsForRelWithMandatories(),locale:f.core.settingManager.getLanguage(),label:f.core.settingManager.getCVRequestLabel(),tenant:f.core.settingManager.getPlatformId()},t.configBinary&&(n.config_filter=t.configBinary),widget.getValue("ShowNotInBOM")||(n.sequence_filter=f.core.settingManager.getSetting("sequence_filter_exclude_NotInBOM")),t.staticMapping&&Array.isArray(t.staticMapping.path)&&!M(t.executor)?n.paths=[t.staticMapping.path]:t.staticMapping&&Array.isArray(t.staticMapping.path)?n.root_path_physicalid=[t.staticMapping.path]:t.optionsToExpandOnEachLevel&&Array.isArray(t.optionsToExpandOnEachLevel.multiLevelpaths)?(n.paths=t.optionsToExpandOnEachLevel.multiLevelpaths,n.root_path_physicalid=t.optionsToExpandOnEachLevel.multiLevelpaths):Array.isArray(t.paths)&&t.paths.length>0?n.root_path_physicalid=t.paths:n.root_physicalid=t.physicalId,t.isOnAuthoring){var i=f.core.dicoService.getSelectedExtensions()||[],r=[];i.forEach(function(e){r.indexOf(e)<0&&r.push(e)}),n.select_bo.forEach(function(e){var t;2===(t=e.split(":")).length&&(e=t[1]),2===(t=e.split(".")).length&&r.indexOf(t[0])<0&&r.push(t[0])}),n.select_rel.forEach(function(e){var t;2===(t=e.split(":")).length&&(e=t[1]),2===(t=e.split(".")).length&&r.indexOf(t[0])<0&&r.push(t[0])}),n=e.extend(n,{types:f.core.dicoService.getSelectedTypes()||[],extensions:r,root_path_physicalid:[[t.physicalId]]}),Array.isArray(t.paths)&&t.paths.length>0?n.root_path_physicalid=n.paths=t.paths:t.optionsToExpandOnEachLevel&&Array.isArray(t.optionsToExpandOnEachLevel.multiLevelpaths)&&(n.root_path_physicalid=t.optionsToExpandOnEachLevel.multiLevelpaths)}M(t.executor)&&(n.type_filter_rel=["PLMInstance"])}return n},expand:function(n,i,r,o,s){var a=this;return t.wrappedWithCancellablePromise(function(t,o){if(e.is(n)||s&&Array.isArray(s.paths)&&s.paths.length>0){var l={physicalId:n,configBinary:i,level:r};v(l=e.extend(l,s||{}))?(l.isOnAuthoring=l.isOnAuthoring?l.isOnAuthoring:f.core.sessionManager.isUsingDB(),l.executor=l.isOnAuthoring?g.COMMAND_WS_EXPAND_DB:_,a.expandRequestExecutor(l).then(t).catch(o)):o("invalid input")}else o("invalid input")})},expandRequestExecutor:function(e,n){var i=this;return t.wrappedWithCancellablePromise(function(t,n){i.logger.info("call of expandRequestExecutor ");var r=i.buildExpandGenericOption(e);if(!r||!e.executor)return i.logger.error("invalid input: failed to build request payload"),n("invalid options");i.logger.info((e.isOnAuthoring,"Database"));var o={physicalId:e.physicalId};Array.isArray(r.paths)&&(o.pathLength=r.paths.length),e&&e.nodesType&&(o.nodesType=e.nodesType),e&&e.flattenedView&&(o.level=e.flattenedView),e&&e.isRefreshing&&(o.isRefreshing=e.isRefreshing,o.isFromReplace=e.isFromReplace,o.level=!0),i.doExpand(r,e).then(function(e){i._processExpandResponse(e,t,n,o)}).catch(function(e){n(e)})})},_processExpandResponse:function(e,t,n,i){if(!Array.isArray(e.results)||0===e.results.length)return t([]);!0===i.isRefreshing?f.core.Factories.ListItemFactory.getListNodesFromServerExpandForEdition(e,i).then(function(e){return t(e)}).catch(function(e){n(e)}):f.core.Factories.ListItemFactory.getListNodesFromServerExpand(e,i).then(function(e){return t(e)}).catch(function(e){n(e)})},getEngItemData:function(n,i){var r=this;return e.is(n)?t.wrappedWithCancellablePromise(function(e,t){if(f.core.sessionManager.isUsingDB()){const o={level:"0",paths:[[n]]};r.expandV2(o).then(n=>{f.core.Factories.ListItemFactory.getEngItemFromServerExpandInDB(n,void 0,i).then(t=>e(t)).catch(e=>t(e))}).catch(e=>t(e))}else r.getEngItemsData([n],i).then(function(o){if(Array.isArray(o)&&0!==o.length||!f.core.sessionManager.isUsingIndex())return e(o);f.core.sessionManager.setAuthoringMode("authoring"),r.getEngItemsData([n],i).then(function(t){return e(t)}).catch(e=>t(e))}).catch(e=>t(e))}):null},getEngItemsData:function(e,i,r){var o=this;if(Array.isArray(e)){var s=f.core.sessionManager.isUsingDB();r&&(s=!1),this.logger.info("call of getEngItemData on authoring mode = "+s);var a={select_file:["icon","thumbnail_2d"],fcs_url_mode:"REDIRECT",label:f.core.settingManager.getCVRequestLabel(),physicalid:e,locale:f.core.settingManager.getLanguage(),tenant:f.core.settingManager.getPlatformId(),select_predicate:f.core.settingManager.getSetting("select_predicate")};return a.select_predicate=Array.from(new Set(a.select_predicate.concat(f.core.dicoService.getTagsForBOWithMandatories()))),t.wrappedWithCancellablePromise(function(e,t){var r=s?f.core.settingManager.getCommand("db_fetch"):f.core.settingManager.getCommand("cv_fetch");n.perform(r,a).then(function(n){var r={serverResponse:n,withconfig:i};if(n.infos&&0===n.infos.nhits)return e([]);o._indexFormatFetchManager(r,e,t)}).catch(function(e){return t(e)})})}throw new Error("pad inputs")},getStatticMappingPCInfo:function(e){if(Array.isArray(e)||!(!e.length>=1)){var i={version:"1.0",instanceIdList:e};return t.wrappedWithCancellablePromise(function(e,t){n.perform(f.core.settingManager.getCommand("get_configuration"),i).then(function(t){e(t)}).catch(function(e){return t(e)})})}d.errorAlert("fetchData need an array as input")},getModelVersionInformationFromPCID:function(e){if(Array.isArray(e)){var i=f.core.sessionManager.isUsingDB();this.logger.info("call of getEngItemData on authoring mode = "+i);var r={select_file:["icon","thumbnail_2d"],fcs_url_mode:"REDIRECT",label:f.core.settingManager.getCVRequestLabel(),physicalid:e,locale:f.core.settingManager.getLanguage(),tenant:f.core.settingManager.getPlatformId(),select_predicate:f.core.settingManager.getSetting("select_predicate_for_pc")};return t.wrappedWithCancellablePromise(function(e,t){var i=f.core.settingManager.getCommand("cv_fetch");n.perform(i,r).then(function(t){var n=s.parseFetchResult(t);e(n.results)}).catch(function(e){return t(e)})})}throw new Error("pad inputs")},fetch:function(e,i){if(Array.isArray(e)){var r={select_file:["icon","thumbnail_2d"],fcs_url_mode:"REDIRECT",label:f.core.settingManager.getCVRequestLabel(),physicalid:e,locale:f.core.settingManager.getLanguage(),tenant:f.core.settingManager.getPlatformId(),select_predicate:void 0!==i?i:[],with_synthesis_attribute:!0};return t.wrappedWithCancellablePromise(function(t,i){0===e.length&&t([]);var o=f.core.settingManager.getCommand("cv_fetch");n.perform(o,r).then(function(e){var n=s.parseFetchResult(e);t(n.results)}).catch(function(e){return i(e)})})}throw new Error("pad inputs")},_indexFormatFetchManager:function(e,t,n){if(!e||!e.serverResponse||!Array.isArray(e.serverResponse.results))return n?n("invalid input : missing serverResponse"):null;var i=this;f.core.Factories.ListItemFactory.getEngItemsListFromServerFetch(e.serverResponse,e.uwaModel,e.withconfig).then(function(e){for(var n=0;n<e.length;n++)if(e[n].deleted){let t=e[n].getID();i.removeFromRecents([t]),e.splice(n,1),n--}return t(e)}).catch(function(e){n(e)})},getEngItemRelatedDocuments:function(e,n){var i=this,r=!1,o=t.wrappedWithCancellablePromise(function(t,o){var s={relInfo:{parentId:e,parentRelName:n||i.DOC_REL_NAME,parentDirection:"from"},tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType",onComplete:function(e){if(Array.isArray(e.data))return r?t([]):void t(f.core.Factories.ListItemFactory.createListNodes(e.data,"fromDocAPI"))},onFailure:function(e){if(r)return t([]);o(e)}};a.getDocumentsFromParent(s)});return o.cancelEmbeddedRequest=function(){r=!0},o},fetchDocumentsData:function(e,t){return Array.isArray(e)?new Promise((n,i)=>{const r={getVersions:!0,relInfo:{parentRelName:t||this.DOC_REL_NAME,parentDirection:"from"},tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),onComplete:n,onFailure:i};a.getDocuments(e,r)}):Promise.reject()},fetchDocumentsDataAsNodes:function(e,n){if(Array.isArray(e))return t.wrappedWithPromise((t,i)=>{this.fetchDocumentsData(e,n).then(e=>{const n=f.core.Factories.ListItemFactory.createListNodes(e.data,"fromDocAPI");t(n)}).catch(e=>{d.errorAlert(e),i(e)})});d.errorAlert("fetchDocumentsData need an array as input")},applyCoreMaterialToEngItem:function(e,i){return t.wrappedWithPromise(function(t,r){var o={references:[{engItem:e.getID(),material:i}]},s=f.core.settingManager.getCommand("apply_material");n.perform(s,JSON.stringify(o)).then(function(e){return t(e)}).catch(function(e){return r(e)})})},getCoreMaterialToEngItem:function(e){return t.wrappedWithPromise(function(t,i){var r={references:e},o=f.core.settingManager.getCommand("get_material");n.perform(o,JSON.stringify(r)).then(function(e){return t(e)}).catch(function(e){return i(e)})})},attachDocumentToEngItem:function(e,n,i,r){var o=this;return t.wrappedWithPromise(function(t,s){o.fetchDocumentsDataAsNodes([n],r).then(function(n){var l=n[0],c=[],u=[];c.push(e),u.push(e.getID());var p={relInfo:{parentId:e.getID(),parentRelName:r||o.DOC_REL_NAME,parentDirection:"from"},tenant:f.core.settingManager.getPlatformId(),additionalHeaders:f.core.settingManager.getWorkUnderHeaders(),securityContext:f.core.settingManager.getSecurityContext(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),onComplete:function(n){if(g.fetch_doc_expand_v2&&f.core.sessionManager.setAuthoringMode("authoring"),r?d.sucessAlert(f.core.i18nManager.get("eng.operation.insertAttachment.sucess")):d.sucessAlert(f.core.i18nManager.get("eng.operation.insertDocument.sucess")),i){l.options.instanceId=n.data[0].relateddata.parents[0].relId;var o={nodes:[l],parentId:e.getID(),selectedNodesToInsert:c,physicalIdList:u};f.mediator.publish(g.EVENT_CREATED_NODES,o)}t(l)},onFailure:function(e){d.errorAlert(e.error||JSON.stringify(e)),s(e)}};a.connectDocumentToParent(l.getID(),p)})})},_createDocument:function(e,n){return t.wrappedWithPromise(function(t,i){var r=f.core.sessionManager.getUploadTracker({fileName:e.fileInfo.fileName,fileSize:e.fileInfo.file.size}),o={tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),additionalHeaders:f.core.settingManager.getWorkUnderHeaders(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),onFailure:function(e){r.onComplete(!1),d.errorAlert(e.error||JSON.stringify(e)),i(!1)},onProgress:r.onProgress,onComplete:function(e){e=e.data;for(var i=0;i<e.length;i++)var o=e[i],s={nodes:[f.core.Factories.ListItemFactory.createListNode(o,"fromDocAPI")],parentId:n};r.onComplete(!0),t(s),d.sucessAlert(f.core.i18nManager.get("eng.operation.addDocument.sucess"))}};a.createDocument(e,o)})},createDocumentOnSelectedType:function(e){let t=this.createDocumentListNode(e),n=[e.documents[0].dataelements.parentId];if(t&&t.isDocument()){let i={},r=f.core.contextManager.getActiveEngItem().getContentModels().findNodesByIds(n);i.selectedNodesToInsert=r,i.nodes=[t],i.physicalIdList=n,"SpecificationDocument"===this.DOC_REL_NAME?(g.fetch_doc_expand_v2&&f.core.sessionManager.setAuthoringMode("authoring"),f.core.mediator.publish(g.EVENT_CREATED_NODES,i)):f.core.mediator.publish(g.EVENT_NEW_ATTACHED_DOCUMENT,i),d.sucessAlert(e.notification.subtitle)}},createDocumentListNode:function(e){return f.core.Factories.ListItemFactory.createListNode(e.documents[0],"fromDocAPI")},addNewDocumentToEngItem:function(e){var t=this,n=e.relationName||t.DOC_REL_NAME;e.files?t._createDocumentsFromFiles(e.files,e.targetObjID,n):t._launchFileChooser(function(i){t._createDocumentsFromFiles(i,e.targetObjID,n)})},_createDocumentsFromFiles:function(e,t,n){if(e&&t&&n)for(var i=this,r=0;r<e.length;r++){const s=e[r];var o={fileInfo:{comments:"",file:s,fileName:s.name||"unNamed"},relInfo:{parentId:t,parentRelName:n,parentDirection:"from"}};i._createDocument(o,t).then(function(e){var t=f.core.contextManager.getActiveEngItem().getContentModels().findNodesByIds([e.parentId]);e.selectedNodesToInsert=t,e.physicalIdList=[e.parentId],f.core.contextManager.isActiveEngItemSelected()&&(n===i.DOC_REL_NAME?f.core.mediator.publish(g.EVENT_CREATED_NODES,e):f.core.mediator.publish(g.EVENT_NEW_ATTACHED_DOCUMENT,e))})}},_launchFileChooser:function(e,t){var n=i.getFileInput(t);n.addEvent("change",function(t){t.preventDefault(),t.stopImmediatePropagation();var i=t.target.files.length>0?t.target.files:t.dataTransfer.files;n.removeEvent("change"),n.destroy(),e&&e(i)}),n.click()},checkinDocument:function(e){this._launchFileChooser(function(t){var n=t[0],i=n?n.name:"";i=i.replace(/\.[^/.]+$/,"");var r={tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),additionalHeaders:f.core.settingManager.getWorkUnderHeaders(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),onComplete:e.onComplete,onFailure:e.onFailure},o={id:e.docId,title:i,fileInfo:{file:n}};a.modifyDocument(o,r)},!0)},downloadDocuments:function(e,t,n){this._downloadDocuments(e,function(e){d.sucessAlert(f.core.i18nManager.get("eng.operation.downloadDocument.sucess")),i.launchDownloadfromURLs(e),t&&t(e)},function(e){n&&n(e)},!1)},_downloadDocuments:function(e,t,n){if(Array.isArray(e)){var i=e.map(function(e){return e.getID()}),r={tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),additionalHeaders:f.core.settingManager.getWorkUnderHeaders(),asZip:!!(Array.isArray(i)&&i.length>1),onFailure:function(e){n(e),d.errorAlert(f.core.i18nManager.replace(f.core.i18nManager.get("error.operation.failed"),{operation:"download document ",error:e.data&&e.data[0]?e.data[0].updateMessage:e}))},onComplete:t};a.downloadDocuments(i,r)}},deleteDocuments:function(e,t){var n=this;e.length&&e.length>0&&e.forEach(function(e){n.deleteDocument(e,t)})},deleteDocument:function(e,t){var n=e.options.referenceId;if(n){var i={tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),additionalHeaders:f.core.settingManager.getWorkUnderHeaders(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),onComplete:function(n){g.fetch_doc_expand_v2&&f.core.sessionManager.setAuthoringMode("authoring"),d.sucessAlert(f.core.i18nManager.get("eng.operation.deleteDocument.sucess")),t?t(!0):f.core.contextManager.getContext().refresh({action:"unparent",instances:[e.getRelationID()]})},onFailure:function(e){t&&t(!1);var n={operation:"delete document ",error:e.error};d.errorAlert(f.core.i18nManager.replace(f.core.i18nManager.get("error.operation.failed"),n))}};a.deleteDocument(n,i)}},detachDocuments:function(e,t,n,i){var r=this;e.length&&e.length>0&&e.forEach(function(e){let o;o=e.getParent()._isFromOriginalModel()&&""!==e.getParent().getID()?e.getParent():t,r.removeDocument(e,o,n,i)})},removeDocument:function(e,t,n,i){var r=e.getID(),o=this;if(r){var s={relInfo:{parentId:t.getID(),parentRelName:n||o.DOC_REL_NAME,parentDirection:"from"},tenant:f.core.settingManager.getPlatformId(),securityContext:f.core.settingManager.getSecurityContext(),additionalHeaders:f.core.settingManager.getWorkUnderHeaders(),tenantUrl:f.core.settingManager.getDefault3DSpaceUrl(),onComplete:function(t){g.fetch_doc_expand_v2&&f.core.sessionManager.setAuthoringMode("authoring"),d.sucessAlert(f.core.i18nManager.get("eng.operation.removeDocument.sucess")),i&&i(!0),n&&n!==o.DOC_REL_NAME||f.core.contextManager.getContext().refresh({action:"unparent",instances:[e.getRelationID()]})},onFailure:function(e){i&&i(!1),d.errorAlert(f.core.i18nManager.replace(f.core.i18nManager.get("error.operation.failed"),{operation:"remove document ",error:e.error}))}};a.disconnectDocumentFromParent(r,s)}},loadElementsNLS:function(e){this.logger.info("call of loadElementsNLS");var i=f.core.settingManager.getCommand("dico_elements");return t.wrappedWithCancellablePromise(function(t,r){n.perform(i,e,{}).then(function(e){var n=sessionStorage.getItem(f.core.settingManager.getNlsStorageName());n=n?JSON.parse(n):{};for(var i=e.vocabularyElementNLSInfo,r=0;r<i.length;r++)n[i[r].curi]=i[r];return t(n)}).catch(function(e){r(e)})})},loadPredicateValues:function(e){this.logger.info(" call of loadPredicateValues");var i=f.core.settingManager.getCommand("dico_predicate_value");return t.wrappedWithCancellablePromise(function(t,r){n.perform(i,e).then(function(e){var n=f.core.settingManager.getPredicatesNlsStorageName(),i=sessionStorage.getItem(n);i=i?JSON.parse(i):{};var r=e;for(var o in r)if(i.hasOwnProperty(o))for(var s in r[o])i[o][s]=r[o][s];else i[o]=r[o];return t(i)}).catch(function(e){r(e)})})},applyWorkUnderEvolution:function(e,i,r,o,s,a,l){return t.wrappedWithPromise(function(t,d){e&&r||d(new Error("invalid input"));var u=f.core.settingManager.getCommand("workUnderEvolution"),p=u.evolutionExpression;p=(p=(p=(p=(p=p.replace(new RegExp("{modelName}","g"),i)).replace(new RegExp("{productName}","g"),o)).replace(new RegExp("{productRevision}","g"),s)).replace(new RegExp("{productTitle}","g"),l)).replace(new RegExp("{modelTitle}","g"),a);var g={"Dictionary Contexts":e,"Evolution Expression":p};n.perform(u,JSON.stringify(g)).then(function(e){if(null!=e.ACId&&""!=e.ACId&&null!=e.XSLTExpr&&""!=e.XSLTExpr){var n=c.get();return n.evolution.id=e.ACId,n.evolution.displayExpression=e.XSLTExpr,c.setEffectivity(n),f.core.mediator.publishPlatformEvent("sessionEff",n),f.core.mediator.publishPlatformEvent("toggleActiveSE"),t(e)}return d(!0)}).catch(function(e){console.error(e),d(e)})})},retreiveSuccessAndErrorsFromEditService:function(e,t){const{results:n}=e||{};if(!Array.isArray(n)||!Array.isArray(t))return{};const i=[],r=[],o=[];return n.forEach(({body:e,status:n})=>{if(!e)return;const{physicalid:s,errors:a,oldInstancePhysicalid:l}=e,c=t.find(e=>l?e.physicalid===l:e.physicalid===s),{attributePath:d,node:u}=c;Array.isArray(a)&&a.length?r.push({physicalid:s,oldInstancePhysicalid:l,errors:a,node:u}):-1!==Reflect.ownKeys(e).findIndex(e=>-1!==e.indexOf(d))?i.push({physicalid:s,oldInstancePhysicalid:l,node:u}):o.push({physicalid:s,oldInstancePhysicalid:l,node:u})}),{success:i,issues:r,notUpdated:o}},manageResultsFromUpdateAttributes(e){const{issues:t,success:n,notUpdated:i,invalidReadOnlyAttrs:r,invalidMandatoryAttrs:o}=e||{};function s(e){e&&e.code&&e.message&&("1900068"===e.code?d.errorAlert(f.core.i18nManager.get("error.object.update.message"),f.core.i18nManager.get("error.object.update.title")):d.errorAlert(f.core.i18nManager.replace(f.core.i18nManager.get("error.operation.failed"),{code:e.code,error:e.message})))}const a=new Set,l=[];if(Array.isArray(t)&&t.length&&t.forEach(({errors:e,physicalid:t,node:n})=>{l.push(n),a.add(t),function(e){Array.isArray(e)&&e.forEach(function(e){Array.isArray(e)?s(e[0]):s(e)})}(e)}),Array.isArray(i)&&i.length&&(d.errorAlert(f.core.i18nManager.get("attribute.update.none")),i.forEach(({physicalid:e,node:t})=>{l.push(t),a.add(e)})),Array.isArray(r)&&r.length&&r.forEach(({physicalid:e,node:t})=>{l.push(t),a.add(e)}),Array.isArray(o)&&o.length&&o.forEach(({physicalid:e,node:t})=>{l.push(t),a.add(e)}),Array.isArray(n)&&n.length&&(f.core.sessionManager.setAuthoringMode("authoring"),n.forEach(({physicalid:e})=>a.add(e))),l.size&&l.forEach(e=>{e.setRealAttributesConvertState(!1),e.setAttributeConvertionStarted(!1)}),a.size){const e=[...a.values()];f.core.mediator.publish(g.EVENT_REFRESH_ITEMS_BY_IDS,e)}},buildPayloadForEditService:e=>Array.isArray(e)?{requests:e.map(({physicalid:e,attribute:t,value:n})=>{const{path:i,ds6wFrom:r,kind:o,attrDim:s,attrUnit:a}=t||{},l={op:"replace",path:i,value:n};return o&&"real"===o.toLowerCase()&&s&&a&&(l.dimensionType="DSDim_"+s,l.unitName=a),{path:`model/${"rel"===r?"rel":"bus"}/${e}`,method:"PATCH",body:[l],queryParams:{select:["physicalid","modified",`attribute[${i}]`]}}})}:null,getAttributesAccessRights:async function(e){try{const t=e.map(({physicalid:e})=>e),n=await this.readAttributes({lIds:t}),{results:i}=n||{};if(!Array.isArray(i))return;const r={};i.forEach(({physicalID:e,data:t})=>r[e]=t);const o={};return e.forEach(({physicalid:e,attributePath:t})=>{const n=r[e],i=n?n.find(e=>e.path===t):null;o[e]=i}),o}catch(e){return{}}},parseAttributesFromAccessRightsAnswer(e,t){if(!Array.isArray(e)||!t)return{};const n=[],i=[],r=e.filter(({physicalid:e,value:r,node:o})=>{if(!t||!t[e])return!0;const{readOnly:s,mandatory:a}=t[e];return s?(n.push({physicalid:e,node:o}),!1):!(a&&!r&&(i.push({physicalid:e,node:o}),1))});return{invalidReadOnlyAttrs:n,invalidMandatoryAttrs:i,validAttrs:r}},updateAttributes:async function(e,t){if(!Array.isArray(e))return;const i=e.filter(e=>{const{physicalid:t,attribute:n}=e||{};return t&&n&&n.path}).map(({physicalid:e,attribute:t,value:n,node:i})=>({physicalid:e,attribute:t,attributePath:t.path,value:"string"==typeof n?n.replace("\r",""):n,node:i}));"function"==typeof t&&t(30);const r=await this.getAttributesAccessRights(i),{invalidReadOnlyAttrs:o,invalidMandatoryAttrs:s,validAttrs:a}=this.parseAttributesFromAccessRightsAnswer(i,r);let l={invalidReadOnlyAttrs:o,invalidMandatoryAttrs:s};if(!a.length)throw this.manageResultsFromUpdateAttributes(l),new Error(l);const c=this.buildPayloadForEditService(a);if(!c)throw new Error("buil paylod for mcs_setTitle failed");let u=null;try{"function"==typeof t&&t(30);const e=f.core.settingManager.getCommand("mcs_setTitle");if(!(u=await n.perform(e,JSON.stringify(c))))throw new Error("invalid mcs_setTitle command answer")}catch(e){throw e.response&&"EDITPROP_ERROR_0001"===e.response.error?d.errorNotif({title:f.core.i18nManager.get("error.instanceEvolved.notEditable"),subtitle:f.core.i18nManager.get("error.instanceEvolved.UpdateFailedDueToFrozenModelConnected")}):e.response&&e.response.error&&d.errorAlert(e.response.error),e}return"function"==typeof t&&t(30),l={...l,...this.retreiveSuccessAndErrorsFromEditService(u,a)},this.manageResultsFromUpdateAttributes(l),l},updateAttribute:async function(e,i,r){let{path:o,ds6wFrom:s,kind:a,attrDim:l,attrUnit:c}=i||{};if(!e||!o)return;const u=await this.getAttributeAccessRights({physicalid:e,attributePath:o});if(u&&u.readOnly)throw d.warningAlert(f.core.i18nManager.replace(f.core.i18nManager.get("attribute.readOnly"),{attribute:u.nls})),new Error("attribute.readOnly");if(u&&u.mandatory&&!r)throw d.warningAlert(f.core.i18nManager.replace(f.core.i18nManager.get("attribute.mandatory"),{attribute:u.nls})),new Error("attribute.mandatory");let p={op:"replace",path:o,value:r=r.replace("\r","")};a&&"real"===a.toLowerCase()&&l&&c&&(p.dimensionType="DSDim_"+l,p.unitName=c);var h={requests:[{path:`model/${"rel"===s?"rel":"bus"}/${e}`,method:"PATCH",body:[p],queryParams:{select:["physicalid","modified",`attribute[${o}]`]}}]};function m(e){e&&e.code&&e.message&&("1900068"===e.code?d.errorAlert(f.core.i18nManager.get("error.object.update.message"),f.core.i18nManager.get("error.object.update.title")):d.errorAlert(f.core.i18nManager.replace(f.core.i18nManager.get("error.operation.failed"),{code:e.code,error:e.message})))}return t.wrappedWithCancellablePromise((t,i)=>{const r=f.core.settingManager.getCommand("mcs_setTitle");n.perform(r,JSON.stringify(h)).then(function(n){var r,o=function(e){if(!e||!Array.isArray(e.results))return null;var t=e.results.filter(function(e){return e&&e.body&&Array.isArray(e.body.errors)&&e.body.errors.length>0}).map(function(e){return e.body&&e.body&&e.body.errors?e.body.errors:[]});return t.length>0?t:null}(n);if(o)return r=o,Array.isArray(r)&&r.forEach(function(e){Array.isArray(e)?m(e[0]):m(e)}),f.core.mediator.publish(g.EVENT_REFRESH_ITEMS_BY_IDS,[e]),i(o);var s=!1;if(n&&n.results&&Array.isArray(n.results)&&n.results.forEach(function(e){if(e.body)for(const t in e.body)t&&"errors"!==t&&"url"!==t&&"modified"!==t&&"physicalid"!==t&&(s=!0)}),s)return f.core.sessionManager.setAuthoringMode("authoring"),t(n);0==n.results[0].body.errors.length&&(d.errorAlert(f.core.i18nManager.get("attribute.update.none")),i())}).catch(function(e){e.response&&"EDITPROP_ERROR_0001"===e.response.error?d.errorNotif({title:f.core.i18nManager.get("error.instanceEvolved.notEditable"),subtitle:f.core.i18nManager.get("error.instanceEvolved.UpdateFailedDueToFrozenModelConnected")}):e.response&&e.response.error&&d.errorAlert(e.response.error),i(e)})})},getAttributeAccessRights:async function({physicalid:e,attributePath:t}){try{const n=await this.readAttributes({lIds:[e]});let i=n&&n.results&&n.results.length?n.results[0].data:null;if(!i||!Array.isArray(i))return;let r=i.find(e=>e.path===t);if(!r)return;return r}catch(e){return e}},readAttributes:async function({lIds:e=[],busIDs:t=[],relIDs:i=[]}){const r={lIds:e,relIDs:i,busIDs:t,plmparameters:"false",attributes:"true",navigateToMain:"false",readonly:"true",debug_properties:""},o=f.core.settingManager.getAuthorizedChange()?f.core.settingManager.getAuthorizedChange().AuthoringContextHeader:void 0,s=o?{...r,...o}:r;let a=f.core.settingManager.getCommand("mcs_attributes");try{return await n.perform(a,JSON.stringify(s))}catch(e){return e}},transformToMaterialQuantity:function(e,i){var r={references:e,quantity:i};return t.wrappedWithCancellablePromise(function(e,t){n.perform(f.core.settingManager.getCommand("add_quantity_of_material"),JSON.stringify(r)).then(function(t){return e(t)}).catch(function(e){t(e)})})},expandV2:function(e){return t.wrappedWithCancellablePromise((t,n)=>{!0===e.isOnAuthoring?e.executor=g.COMMAND_WS_EXPAND_DB:!1===e.isOnAuthoring?e.executor=_:e.executor=f.core.sessionManager.isUsingDB()?g.COMMAND_WS_EXPAND_DB:_;const i=this.buildExpandGenericOption2(e);i&&this.doExpand(i,e).then(t).catch(n)})},buildExpandGenericOption2:function({physicalid:e,paths:t,level:n="0",type_filter_rel:i=["PLMInstance"],select_bo:r=f.core.dicoService.getTagsForBOWithMandatories(),select_rel:o=f.core.dicoService.getTagsForRelWithMandatories(),executor:s=g.COMMAND_WS_EXPAND_CV,config_filter:a}){let l={no_type_filter_rel:["XCADBaseDependency"]};if(l.type_filter_rel=i,l["q.iterative_filter_query_bo"]='[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',l.compute_select_bo=f.core.settingManager.getSetting("compute_select_bo"),l.expand_iter=n,l.fcs_url_mode="REDIRECT",l.select_bo=r,l.select_rel=o,l.locale=f.core.settingManager.getLanguage(),l.label=f.core.settingManager.getCVRequestLabel(),l.tenant=f.core.settingManager.getPlatformId(),t&&Array.isArray(t))l.paths=t,l.root_path_physicalid=t;else{if(!e)return null;l.root_physicalid=e,l.root_path_physicalid=[[e]]}if(a&&(l.config_filter=a),widget.getValue("ShowNotInBOM")||(l.sequence_filter=f.core.settingManager.getSetting("sequence_filter_exclude_NotInBOM")),s===g.COMMAND_WS_EXPAND_DB){var c=f.core.dicoService.getSelectedExtensions()||[];l.select_bo.forEach(function(e){var t;2===(t=e.split(":")).length&&(e=t[1]),2===(t=e.split(".")).length&&c.indexOf(t[0])<0&&c.push(t[0])}),l.select_rel.forEach(function(e){var t;2===(t=e.split(":")).length&&(e=t[1]),2===(t=e.split(".")).length&&c.indexOf(t[0])<0&&c.push(t[0])}),l.types=f.core.dicoService.getSelectedTypes()||[],l.extensions=c}return C&&N(s)&&!f.core.sessionManager.shouldShowFinalItems()&&!f.core.sessionManager.shouldShowLeafMaterials()&&f.core.PreferencesManager.isSpecInProductStructureEnabled()&&(l=this.decoratePayloadWithSpecficationDocument(l)),l},decoratePayloadWithSpecficationDocument(t){if(!t)return;const n=e.clone(t),i='(flattenedtaxonomies:"types/Document")';n["q.iterative_filter_query_bo"]&&""!==n["q.iterative_filter_query_bo"].trim()?n["q.iterative_filter_query_bo"]=`${n["q.iterative_filter_query_bo"]} OR ${i}`:n["q.iterative_filter_query_bo"]=i;const r=["SpecificationDocument"];Array.isArray(n.type_filter_rel)?n.type_filter_rel.push(...r):n.type_filter_rel=r;const o=["ds6w:docextension","islastrevision","type","policy","current"];Array.isArray(n.select_bo)?n.select_bo.push(...o):n.select_bo=o;const s=["type"];if(Array.isArray(n.select_rel)?n.select_rel.push(...s):n.select_rel=s,!widget.getValue("ShowNotInBOM")&&Array.isArray(n.sequence_filter)){const[e]=n.sequence_filter,{definition:t}=e||{},[i]=t||{};Array.isArray(i.type_filter_rel)?i.type_filter_rel.push(...r):i.type_filter_rel=[...r]}return n},multiExpandV2:function(e){var n=this;return t.wrappedWithCancellablePromise(function(t,i){const r=n.buildMultiExpandGenericOption2(e);r&&n.doExpand(r,{executor:y}).then(t).catch(i)})},buildMultiExpandGenericOption2:function({select_bo:e=f.core.dicoService.getTagsForBOWithMandatories(),select_rel:t=f.core.dicoService.getTagsForRelWithMandatories(),nextGenFilterOption:n},i=E){let r=!i&&UWA.is(n.CVQuery)?UWA.clone(n.CVQuery):{};if(r.union&&r.union.expand&&r.union.expand.length>=1){for(var o=[],s=0;s<r.union.expand.length;s++){var a=r.union.expand[s];a.volume_filter?o.push(s):(a.expand_iter="-1",a.no_type_filter_rel=["XCADBaseDependency"],a["q.iterative_filter_query_bo"]='[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"')}for(var l=0;l<o.length;l++)r.union.expand.splice(o[l],1)}if(r.select_bo=e,r.select_rel=t,r.compute_select_bo=f.core.settingManager.getSetting("compute_select_bo"),r.label=f.core.settingManager.getCVRequestLabel(),i&&UWA.is(n.CVQueryV2)){const{CVQueryV2:e,filterRootIds:t}=n;r.v2PayloadEntriesToAdd=[{CVQueryV2:e}],r.expand_iter="-1",r.no_type_filter_rel=["XCADBaseDependency"],r["q.iterative_filter_query_bo"]='[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',r.root_path_physicalid=[t]}return C&&N(y)&&!f.core.sessionManager.shouldShowFinalItems()&&!f.core.sessionManager.shouldShowLeafMaterials()&&f.core.PreferencesManager.isSpecInProductStructureEnabled()&&(r.type_filter_rel=["PLMInstance"],r=this.decoratePayloadWithSpecficationDocument(r)),r},chunkInstances:function(e,t){var n=0,i=e.length,r=[];for(n=0;n<i;n+=t){let i=e.slice(n,n+t);r.push(i)}return r},createInstances:function({parentID:e,referencesIDs:i,existingInstancesIDs:r,quantitiesToAdd:o}){let s=this;if(!e||!i||!Array.isArray(i))throw"invalid input";if(i.some(t=>t===e))throw"Operation aborted as it creates cycle(s).";const a=0!==o?o:i.length,l=i[0],c=f.core.settingManager.isChangeAuthorized()||f.core.settingManager.isWorkingUnderEvolution()?g.CHANGE_QUANTITY_LIMIT_UNDER_CHANGE_ACTION:g.CHANGE_QUANTITY_LIMIT;if(a>c){const i=f.core.settingManager.getCommand("changeQuantities");return t.wrappedWithCancellablePromise(function(t,o){n.perform(i,JSON.stringify({parentID:e,firstRefID:l,existingInstancesIDs:r,totalQuantities:a})).then(function(e){"failure"===e.status?Array.isArray(e.message)&&e.message.length>=1&&d.errorAlert(JSON.stringify(e.message)):"true"==e.IncompleteJobObjectExists?d.errorAlert(f.core.i18nManager.get("eng.background.job.error")):d.sucessAlert(f.core.i18nManager.get("eng.background.job.success"))}).catch(function(e){s.logger.error(e),o(e)})})}return s.createInstancesService({parentID:e,referencesIDs:i,existingInstancesIDs:r})},createInstancesService:function({parentID:e,referencesIDs:i,existingInstancesIDs:r}){let o=this;if(this.logger.info("call of createInstance"),!e||!i||!Array.isArray(i))throw"invalid input";let s=f.core.settingManager.getCommand("powerBy_addExisting");if(i.some(t=>t===e))throw"Operation aborted as it creates cycle(s).";var a={version:"1.0",bAllOrNothing:!0,operations:[]},l=[],c=!1;return i.forEach(function(t){var n={},i=l.indexOf(t);-1===i?(n={isInstanceOf:t,cacheId:l.length},l.push(t)):n={cacheId:i};var o={};c?o={cacheId:0}:(o={isInstanceOf:e,children:r&&Array.isArray(r)?r:[],cacheId:0},c=!0),a.operations.push({parent:o,child:n})}),t.wrappedWithCancellablePromise(function(e,t){n.perform(s,JSON.stringify(a)).then(function(n){if("failure"!==n.status)return f.core.sessionManager.setAuthoringMode("authoring"),d.sucessAlert(f.core.i18nManager.get("eng.operation.addInstance.sucess")),n&&n.results&&Array.isArray(n.results)?e(n.results):t();if(Array.isArray(n.messages)&&n.messages.length>=2)d.errorAlert(n.messages.length>1?n.messages[1]:JSON.stringify(n.messages));else if(n.results&&n.results.length>1)n.results.forEach(function(e){e.results.forEach(function(e){d.errorAlert(Array.isArray(e.messages)&&e.messages.length>1?e.messages[2]:JSON.stringify(e))})});else if(Array.isArray(n.messages)&&1===n.messages.length){let e=n.messages[0];d.errorAlert(e===g.ERR_FUN092398?f.core.i18nManager.get("error.ERR_FUN092398"):e)}else d.errorAlert(JSON.stringify(n.status))}).catch(function(e){o.logger.error(e),t(e)})})},getRangeValueNlsTracker:function(){let e={};return f.core.columnsManager.getAvailableColumns().forEach(function(t){let n=f.core.dicoService.getRangeValueAttribute(t.dataIndex);n&&(e[n.ds6w]=n.AuthorizedValues)}),e},fetchMadeFromData:function(e){return t.wrappedWithCancellablePromise(function(t,i){var r=Object.assign({},f.core.settingManager.getCommand("madefrom_info"));r.url=r.url.replace("{pid}",e),n.perform(r).then(function(e){t(e)}).catch(function(e){return i(e)})})},retrieveMadeFromInfos:function(e,t){var n=this,i={};let r=e&&e.pids?new Set(e.pids):"";r&&r.forEach(function(e){n.fetchMadeFromData(e).then(function(n){if(n.success&&n.result&&n.result.MadeFromConnections){let t=[];null==i[e]&&(i[e]={}),n.result.MadeFromConnections.forEach(e=>{if(e){let n=e.madeFromProductTitle;if(e.asRequired){let t=e.quantity&&"0"!=parseInt(e.quantity)?`, ${e.quantity} ${e.quantityUOM.nlsLabel}`:"";n+=` (${f.core.i18nManager.get("makeFromAsRequired")}${t})`}else e.quantity&&e.quantityUOM&&e.quantityUOM.nlsLabel&&(n+=` (${e.quantity} ${e.quantityUOM.nlsLabel})`);t.push(n)}}),n.result.MadeFromConnections[0],i[e].MadeFrom=t.length>0?t.join(", "):" "}Object.keys(i).length===r.size&&t({pids:i})})})},completeWithCoreMaterialInformation:function(e){return new Promise((t,n)=>{let i={};for(let t in e){let n=e[t];n.hasQuantity&&(i[n.physicalid]=n)}let r=Object.keys(i);if(0===r.length)return t({});this.getCoreMaterialToEngItem(r).then(e=>{if(!e||!e.references)return t({});var n=[];e.references.forEach(e=>{var t=e.material.physicalid,r=e.engItem;i[r].coreMaterialID=t,n.push(t)});var r=f.core.dicoService.getTagsForBOWithMandatories();this.fetch(n,r).then(function(e){return e.forEach(e=>{e["ds6w:globalType"]="ds6w:Material";var t=e["ds6w:status"].split(".");e["ds6w:status"]=t[t.length-1]}),t(e)})}).catch(function(e){n()})})},doExpand:async function(e,t,i=new m(f),r=!0){const{executor:o,payloadAlreadyConverted:s}=t||{};if(!o||!e)throw new Error("invalid inputs");const a=f.core.settingManager.getCommand(o);if(!a)throw new Error(`unknow expand command executor ${o}`);const l=s?e:h.convertPayloadTo(e,o);if(!l)throw new Error("fails to convert payload");const c=Date.now();console.debug("lauch expands... ");const u=[];let p=null;try{p=await n.perform(a,JSON.stringify(l))}catch(e){u.push(e)}const g=Date.now();console.debug(`expand received in ${g-c} ms`);const{errors:E}=p||{};if(Array.isArray(E)&&E.length&&u.push(...E),N(o)){const{results:n}=p||{};if(!Array.isArray(n))if(i.addNewErrors(u,o),i.canErrorsBeFixed){const n=i.fixPayload(e);p=await this.doExpand(n,t,i,!1)}else p||(p={}),p.results=[]}if(r&&i.hasErrors){const e=i.buildErrorMessage(),t=e.trim().length?e:"Failed",n=i.canErrorsBeFixed?d.warningAlert:d.errorAlert;Reflect.apply(n,d,[t])}return h.postTreatAnswer(p,o),p},completeWithDeformableInformation:function(e){return new Promise((t,n)=>{let i=[];for(let t in e){let n=e[t]&&e[t].getDeformableObjectIDFromDeformed?e[t].getDeformableObjectIDFromDeformed:void 0;n&&i.push(n)}if(0===i.length)return t({});{let e=f.core.dicoService.getTagsForBOWithMandatories();this.fetch(i,e).then(function(e){return t(e)}).catch(function(e){n()})}})}}}}),define("DS/ENOXEngineer/services/MaterialService",["UWA/Core","DS/ENOXEngineer/services/MaterialConstants","DS/ENOXEngineer/services/MaterialExceptions","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XENHttpClient"],(e,t,n,i,r,o)=>{const{MaterialType:s}=t,{MaterialTypeError:a,MaterialServerError:l}=n,c={fetch_core_material:"get_core_material",fetch_covering_material:"get_covering_material",author_core_material:"post_core_material",author_covering_material:"post_covering_material",get_core_support_info:"get_core_support_info",get_covering_support_info:"get_covering_support_info"};return new class{constructor(){this.appCore=null}bindApp(e){this.appCore=e}fetchCoreMaterialData({pids:e}){const t=this._computePayloadForFetch({pids:e});return this._fetchMaterialData(t,c.fetch_core_material)}fetchCoveringMaterialData({pids:e,xen_occs:t}){const n=this._computePayloadForFetch({pids:e,xen_occs:t});return this._fetchMaterialData(n,c.fetch_covering_material)}authorCoreMaterialData({pids:e}){try{const t=this._computePayloadForAuthoring({pids:e},s.core);return this._authorMaterialData(t,c.author_core_material)}catch(e){return Promise.reject(e)}}authorCoveringMaterialData({pids:e}){try{const t=this._computePayloadForAuthoring({pids:e},s.covering);return this._authorMaterialData(t,c.author_covering_material)}catch(e){return Promise.reject(e)}}getCoreMaterialSupportInfo({pids:e}){const t=this._computePayloadForFetch({pids:e},!1);return this._fetchMaterialData(t,c.get_core_support_info)}getCoveringMaterialSupportInfo({pids:e}){const t=this._computePayloadForFetch({pids:e},!1);return this._fetchMaterialData(t,c.get_covering_support_info)}async getBaseMaterialType(e){if("string"!=typeof e||0===e.trim())throw new Error("wrong input");const t={types:[e]};let n="";try{const{types_hierarchies:i}=await this._fetchMaterialData(t,"gettypeshierarchy"),[r]=i,{hierarchy:o}=r;-1!==o.indexOf(s.core)?n=s.core:-1!==o.indexOf(s.covering)&&(n=s.covering)}catch(t){console.error(`getBaseMaterialType failed for type ${e}`)}return n}retreiveAuthorMaterialDataFct(e){let t=null;switch(e){case s.core:t="authorCoreMaterialData";break;case s.covering:t="authorCoveringMaterialData"}return t}_computePayloadForFetch({pids:t,xen_occs:n},i=!0){const r={};if(e.is(t)&&Array.isArray(t)&&t.length>=1&&(r.references=t),e.is(n)&&n.length>=1){const e=[];n.forEach(t=>{e.push(t.getPath(!1))}),r.occurrences=e}return i&&(r.with_partials=!0),r}_fetchMaterialData(e,t){return new Promise((n,i)=>{o.perform(r.getCommand(t),e).then(e=>n(e)).catch(e=>i(e))})}_computePayloadForAuthoring({pids:t,xen_occs:n},i){const r={as_bulk:!0,with_partials:!0};return e.is(t)&&Array.isArray(t)&&t.length>=1&&(r.references=t.map(e=>{const{physicalid:t,operations:n}=e;return{physicalid:t,changes:n.map(e=>{if(!e.isCompatibleWithType(i))throw new a(`incompatible operation type with ${i}`);return e.build()})}})),e.is(n)&&n.length>=1&&console.warn("not yet implemented"),r}_authorMaterialData(e,t){return this.appCore.mediator.publish(i.EVENT_AUTHORING_MATERIAL_START,{cmd:t,payload:e}),new Promise((n,s)=>o.perform(r.getCommand(t),e).then(r=>{!Reflect.has(r,"references")&&Reflect.has(e,"references")&&(r.references=e.references.map(e=>({physicalid:e.physicalid}))),this.appCore.mediator.publish(i.EVENT_AUTHORING_MATERIAL_END,{cmd:t,answer:r}),n(r)}).catch(e=>(this.appCore.mediator.publish(i.EVENT_AUTHORING_MATERIAL_END,{cmd:t,answer:{}}),console.log(`error authoring Material Data ${e}`),s(new l(e)))))}}}),define("DS/ENOXEngineer/columnsProviders/MaterialDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/services/MaterialService"],(e,t,n,i,r,o)=>{const{XENOccurrencesBag:s}=r,a="CoreMaterial",l="CoveringMaterial",c="CoveringMaterialInstance";return t.singleton({init(e){this._parent(e)},bindApp(e){this.appCore=e,o.bindApp(e)},isAdditionalColumnsAvailable(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:()=>"MaterialColumns",getManagedColumnNames:()=>[a,l,c],toBeUpdated(t){if(!e.is(t))return console.error("abnormal situation -> MaterialDataProvider/toBeUpdated wrong inputs"),!1;return!e.is(t.CoreMaterial)||!e.is(t.CoveringMaterial)||!e.is(t.CoveringMaterialInstance)},getAdditionalColumnsUX(e){this.getManagedColumnNames().forEach(t=>{let n={text:i.get(t),dataIndex:t,maxWidth:800,minWidth:20,width:200};switch(t){case c:const e=i.get("eng.export.instance.key");n.text=`${i.get(l)} (${e})`,n.icon=null}const r=e.findIndex(e=>e.dataIndex===t);e.splice(r,r>=0?1:0,n)})},_extractMaterialInfoFromCoveringCtx(e){let t=0,n=null;for(const[i,r]of e.entries()){const{materialref:e}=r;t+=e.length,0===i&&([n]=e)}return{matref:n,matref_number:t}},_buildMaterialInfoMsg({matref:t,matref_number:n,references_infos:r}){const o=e.is(r)?r.find(e=>e.physicalid==t.physicalid):t,s=e.is(o.V_Name)?o.V_Name:"no name",a=e.is(o.revision)?o.revision:"",l=e.is(t.partial)?`[${i.get("partial")}]`:"";let c=" ";return c=1===n?`${l} ${s} ${a}`:`${n>1?`[${n}]`:""} ${l} ${s} ${a}`},_retreiveVisibleMaterialColumn(){const{columns:t}=this.appCore.dicoService.getUserDicoPreferences();if(!Array.isArray(t))return[];const n=this.getManagedColumnNames(),i=t.filter(({dataIndex:e,visibleFlag:t})=>-1!==n.findIndex(t=>t===e)),r={};return i.forEach(({dataIndex:e,visibleFlag:t})=>{r[e]=t}),e.is(r[c])&&this.appCore.sessionManager.shouldShowQuantityView()&&(r[c]=!1),r},updateAttributes(t,i){if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(i,"function"))throw new Error("A callback function should be defined");const r={};e.is(t.pids)&&Array.isArray(t.pids)&&t.pids.length>=1&&t.pids.forEach(e=>{r[e]={CoreMaterial:" ",CoreMaterialID:" ",CoreMaterialInfo:{},CoveringMaterial:" ",CoveringMaterialInfo:{}}});const d={};e.is(t.occpaths)&&Array.isArray(t.occpaths)&&t.occpaths.length>=1&&(t.xen_occs=new s(t.occpaths),t.xen_occs.forEach(e=>{d[e.id]={CoveringMaterialInstance:" ",CoveringMaterialInstanceInfo:{}}}));const u=[],p=this._retreiveVisibleMaterialColumn();if(p[a]&&u.push(o.fetchCoreMaterialData(t)),p[l]||p[c]){const e=p[l]?t.pids:null,n=p[c]?t.xen_occs:null;u.push(o.fetchCoveringMaterialData({pids:e,xen_occs:n}))}n.allSettled(u).then(n=>{Array.isArray(n)&&n.length>0&&n.forEach(n=>{if("fullfilled"===n.state){const{references:i,references_infos:o}=n.value;e.is(i)&&Array.isArray(i)&&i.forEach(t=>{const{physicalid:n}=t;void 0===r[n]&&(console.error("abnormal node situation for node {}. Should have been declared",n),r[n]={});const{corematerial:i}=t;e.is(i)&&Array.isArray(i)&&i.length>0&&(r[n].CoreMaterial=this._buildMaterialInfoMsg({matref:i[0],matref_number:i.length,references_infos:o}),1===i.length&&(r[n].CoreMaterialID=i[0].physicalid,r[n].CoreMaterialInfo=i));const{coveringmaterial:s}=t;e.is(s)&&Array.isArray(s)&&s.length>0&&(r[n].CoveringMaterial=this._buildMaterialInfoMsg({matref:s[0],matref_number:s.length,references_infos:o}))});const{occurrences:s}=n.value,{xen_occs:a}=t;e.is(s)&&Array.isArray(s)&&e.is(a)&&s.forEach(t=>{const n=a.getXENOccurrencefromOccurrencePath(t.physicalid),{coveringmaterial:i}=t;if(e.is(n)&&e.is(i)&&Array.isArray(i)){const e=n.id;void 0===d[e]&&(console.error("abnormal node situation for node {}. Should have been declared",e),d[e]={});const{matref:t,matref_number:r}=this._extractMaterialInfoFromCoveringCtx(i);d[e].CoveringMaterialInstance=this._buildMaterialInfoMsg({matref:t,matref_number:r,references_infos:o})}})}}),i({pids:r,occpaths:d})})}})}),define("DS/ENOXEngineer/models/EngItemModel",["DS/Tree/TreeNodeModel","UWA/Core","UWA/Class/Promise","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o,s){"use strict";function a(n){this._parentNode={_nodeDepth:1},this.pathElement={externalPath:[]},this.showModelVersionChooser=!0,this.options={contextualMenu:[null],_relatedContent:null,_transientFilter:null,emptyStatusbarVisibleFlag:!0,_attributesAreConvertedToPreferred:!1,_isAttributeConvertionStarted:!1,type:"",color:"",isCut:!1,shading:null,referenceId:"",quantity:1,models:[],preferedModel:null,attributes:[],custtomAttributes:[],thumbnail:"",useAsyncPreExpand:!0,viewType:"reference",instances:[],filteringContext:{isFilterOutByTagger:!1,isFilterOutBySearch:!1},isLastVersion:null},this.options=t.extend(this.options,n),e.call(this,this.options),this.options.i18nManager=this.options.appCore?this.options.appCore.i18nManager:null}return a.prototype=Object.create(e.prototype),a.prototype.getType=function(){return this.options.type},a.prototype.isAttributeConvertionStarted=function(){return this.options._isAttributeConvertionStarted},a.prototype.setAttributeConvertionStarted=function(e){this.options._isAttributeConvertionStarted=e},a.prototype.isRealAttributesConverted=function(){return this.options._attributesAreConvertedToPreferred},a.prototype.setRealAttributesConvertState=function(e){this.options._attributesAreConvertedToPreferred=e},a.prototype.getIcons=function(){return[]},a.prototype.getRichIcons=function(){return this.options.icons},a.prototype.getTypeIcon=function(){var e=this.getRichIcons(),t="";return this._isFromOriginalModel()&&(t="picture"),e&&Array.isArray(e)&&e.length>0&&(t={iconPath:e[0],iconSize:{width:"16px",height:"16px"}}),t},a.prototype.completePath=function(e){return Array.isArray(e)?(e.push(this.getID()),e):[this.getID()]},a.prototype.getTypeName=function(){return this.options.grid["ds6w:type"]},a.prototype.getParentIdFromOccrencePath=function(){var e=this.getOccurrencePath();return e[e.length-3]},a.prototype.getIdForEditProperty=function(){return this.options.appCore.Factories.ListItemFactory.isInstanceOfListNodeModel(this)?this.getRelationID():this.getID()},a.prototype.getRealParent=function(){var e=this,t=this.options.appCore.contextManager.getActiveEngItem();if(null!==t)var n=t.getContentModels().getChildrenWithoutGroupingNodes().some(function(t){return t.getID()==e.getID()});return n?t:this._parentNode},a.prototype._groupChild=function(e,t,n){if(n&&0!==n.length){var i;null!=(i="reference"===n[0]?e.isMaterialQuantity()?e.options.grid.CoreMaterialID:e.getID():t.getNodeGroupingKey?t.getNodeGroupingKey(e,n[0]):e.getAttributeValue(n[0]))&&""!==i&&"NULL"!==i||(i="NA");var r=this._getFakeNodesTable(),o=r[i];o||(o=this.options.appCore.Factories.ListItemFactory.buildGroupNode({property:n[0],identifier:i,firstmember:e,fakeNodesTable:{},originalChildrenInformation:{childrenCount:0,notHiddenNotFilteredChildrenCount:0}}),r[i]=o,this.addChild(o)),o.isHidden()&&o.show(),n.shift(),o._groupChild(e,n)}else e.getParent()!==this&&this.moveChild(e)},a.prototype.attachContentModels=function(e){if(!this.options.appCore.Factories.CollectionsFactory.isInstanceContentModels(e))throw console.warn(" attachContentModel function expect a valid EngItemContentTreeDocument parameter"),new Error(" attachContentModel function expect a validEngItemContentTreeDocument parameter");this.options._relatedContent=e},a.prototype.getContentModels=function(){return this.options._relatedContent},a.prototype.isValidEngItem=function(){return this.options.appCore.dicoService.areEngeeringItems([this.getType()])},a.prototype.retrieveBIs=function(e){var t=this;return i.wrappedWithPromise(function(n,i){if(t.options._BIs&&t.options.level==e)return n(t.options._BIs);t.options.appCore.dataService.multiexpandBI(t.getID(),e).then(function(i){t.options._BIs=i,t.options.level=e,n(i)}).catch(function(e){t.options._BIs=null,t.options.level="1",n(null)})})},a.prototype.isValidForExpandLevel=function(e){var t=this;return i.wrappedWithPromise(function(n,i){t.retrieveBIs(e).then(function(){if(t.options._BIs){var e=t.options.appCore.settingManager.getSetting("BIsKey"),r=t.options.appCore.commandManager.isExportWithNoLimit();for(var o in t.options._BIs)if(t.options._BIs[o].sixw===e.type&&"VPMInstance"==t.options._BIs[o].object)return t.options._BIs[o].count>s.DATA_LIMIT_FOR_FINAL&&!r?i():n(!0);n(!0)}else n(!0)}).catch(function(e){i(e)})})},a.prototype.getPartNumber=function(){return this.options.grid["ds6wg:EnterpriseExtension.V_PartNumber"]},a.prototype.getEngineeringMenu=function(e){return"my_engItem"===e?this.options.appCore.commandManager.getMenu("standaloneReference"):"eng_item_view"===e?this.options.appCore.sessionManager.shouldShowFinalItems()||this.options.appCore.sessionManager.shouldShowMfgView()||this.options.appCore.sessionManager.shouldShowLeafMaterials()||this.options.appCore.sessionManager.shouldShowFlatView()?this.options.appCore.commandManager.getMenu("occurrence"):this.options.appCore.sessionManager.shouldShowQuantityView()?this.options.appCore.commandManager.getMenu("usedReference"):this.options.appCore.commandManager.getMenu("instance"):void 0},a.prototype.getCreatedDate=function(){return r.getformatedDate(this.options.grid["ds6w:created"])},a.prototype.getModifedDate=function(){return r.getformatedDate(this.options.grid["ds6w:modified"])},a.prototype.getDescription=function(){return this.options.grid["ds6w:description"]},a.prototype.setColor=function(e){this.updateOptions({color:e})},a.prototype.addInstance=function(e){this.options.instances.push(e)},a.prototype.setInstances=function(e){this.options.instances=e},a.prototype.getInstances=function(){return this.options.instances},a.prototype.refreshByModel=function(e,t,n){var i=this.options.appCore.Factories.ListItemFactory.extractOptionsFromNode(e,n);i&&(this.updateOptions(i),this.setRealAttributesConvertState(!1),this.setAttributeConvertionStarted(!1),t&&(e.destroy(),e=null))},a.prototype.syncModel=function(){var e=this;return new n(function(t,n){e.options.appCore.dataService.getEngItemData(e.getID()).then(function(n){e.refreshByModel(n[0],!0),t(!0)}).catch(function(e){n(e)})})},a.prototype.getRelatedDocument=function(e){var t=this.getID();return this.options.appCore.dataService.getEngItemRelatedDocuments(t,e)},a.prototype.getRootType=function(){return this.options.appCore.dicoService.getRootTypes([this.getType()])},a.prototype.getMetaType=function(){return i.wrappedWithPromise(function(e,t){return e("businessobject")})},a.prototype.launchFilteringCommand=function(){this.hasValidTransientNextGenFilter()||this.hasPesistencyManagerdNGFilter()?this.options.appCore.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.LAUNCH_NG_FILTER_CMD,context:{}}):this.isConfigured()&&this.options.appCore.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.SET_PROD_CONF_CMD,context:{item:this}})},a.prototype.setPersistedNGFilterContext=function(e,t){if(e){this.options._NGFilterId=e.filterId,this.options._NGFilterName=e.filter.filterTitle,delete e.filter.CVQuery3D,this.options._persistedFilter=e.filter,("boolean"!=typeof t||t)&&this.options.appCore.PreferencesManager.saveEngItemOpenPreferences(this)}},a.prototype.detachPersistedFilter=function(){(this.options._NGFilterId||this.options._NGFilterName)&&(this.options._NGFilterId=void 0,this.options._NGFilterName=void 0,this.options._persistedFilter=void 0,this.options.appCore.PreferencesManager.saveEngItemOpenPreferences(this))},a.prototype.hasPreferredNGFilterId=function(){return this.getPreferredNGFilter()},a.prototype.hasPesistencyManagerdNGFilter=function(){const e=this.options.appCore.PersistencyManager.getNGFilter();return e&&e.filterId&&e.filterName?e:null},a.prototype.getPreferredNGFilter=function(){var e=this.options.appCore.PreferencesManager.getEngItemOpenPreferences(this.getID());return e&&e.filterId&&e.filterName?e:null},a.prototype.getPersistedNGFilterContext=function(){return this.options._persistedFilter},a.prototype.hasValidPersistedNextGenFilter=function(){return!(!this.getNGFilterId()||!this.getNGFilterName())},a.prototype.getNGFilterId=function(){return this.options._NGFilterId},a.prototype.getNGFilterName=function(){return this.options._NGFilterName?this.options._NGFilterName:null},a.prototype.setTransientGroupingContext=function(e){this.options._transientGroup=e},a.prototype.getTransientGroupingContext=function(){return this.options._transientGroup},a.prototype.hasValidTransientGroupingContext=function(){return!!this.options._transientGroup},a.prototype.removeTransientGroupingContext=function(){delete this.options._transientGroup},a.prototype.setTransientNGFilteringContext=function(e){this.options._transientFilter=e,this.options._NGFilterName=e?e.filterTitle||this.options.i18nManager.get("transient.filter"):null},a.prototype.getTransientNGFilteringContext=function(){return this.hasValidTransientNextGenFilter()?this.options._transientFilter:null},a.prototype.hasValidTransientNextGenFilter=function(){var e=this.options._transientFilter;if(!e)return!1;const{CVQuery:t,CVQueryV2:n}=e;return!(!t||!t.union)||!!n},a.prototype.getNextGenFilterExpandOptions=function(){return this.hasValidTransientNextGenFilter()?this.getTransientNGFilteringContext():this.getPersistedNGFilterContext()},a.prototype.nextGenFilterMultiExpand=function(e){var t=this,n=!1,r=this.getNextGenFilterExpandOptions(),o=i.wrappedWithCancellablePromise(function(i,o){if(r){const s=t.options.appCore.dicoService.getTagsForBOWithMandatories(),a=t.options.appCore.dicoService.getTagsForRelWithMandatories(),l=t.options.appCore.dataService.buildMultiExpandGenericOption2({select_bo:s,select_rel:a,parameters:r});t.options.appCore.dataService.multiExpand(l,e).then(function(e){if(n)return i([]);i(e)}).catch(function(e){if(n)return i([]);console.error(e),o(e)})}else o(new Error("invalid filtering context"))});return o.cancelEmbeddedRequest=function(){n=!0},o},a.prototype.getQualifiedAsFinalChildren=function(e){var t=this,n=!1,r=i.wrappedWithCancellablePromise(function(i,r){t.options.appCore.exportService.expandForQualifiedAsFinal(t.getID(),e).then(function(e){if(n)return i([]);i(e)}).catch(function(e){if(n)return i([]);console.error(e),r(e)})});return r.cancelEmbeddedRequest=function(){n=!0},r},a.prototype.retrieveFilteringBinary=function(){var e=this;return new n(function(t,n){if(!e.isConfigured()||!e.hasValidConfigContext())return t(null);e.options.appCore.dataService.createVolatileFilter(e).then(function(e){t({FilterCompiledForm:e?e.filterBinaryForExpand:null})}).catch(function(e){n(e)})})},a.prototype.getID=function(){return this.options.referenceId},a.prototype.getUuid=function(){return this.getID()},a.prototype.getReferenceVersion=function(){return this.options.grid["ds6wg:revision"]},a.prototype.isLastVersion=function(){return!this.options.isLastVersion||"true"==this.options.isLastVersion.toLowerCase()},a.prototype.isConfigured=function(){return!!(Array.isArray(this.getAttachedConfigModels())&&this.getAttachedConfigModels().length>0)},a.prototype.hasValidConfigContext=function(){return!!(this.getPreferedAttachedConfigModel()&&this.getPreferedAttachedConfigModel().getModelVersion()&&this.getPreferedAttachedConfigModel().getModelVersion().id)},a.prototype.shouldAcceptConfiguration=function(){return this.options.appCore.settingManager.isConfigAuthorized()},a.prototype.getContextDisplayType=function(){return this.options.appCore.settingManager.isConfigAuthorized()?"type-hyperlink":"type-text"},a.prototype.getPreferedAttachedConfigModel=function(){return this.options.preferedModel},a.prototype.attachPreferedConfigModel=function(e){this.options.preferedModel=e,e&&e.setRelatedEngItem&&e.setRelatedEngItem(this)},a.prototype.updateUserConfigPreferences=function(){return this.options.appCore.PreferencesManager.saveEngItemOpenPreferences(this)},a.prototype.attachConfigModels=function(e){this.options.models=e},a.prototype.getAttachedConfigModels=function(){return this.options.models},a.prototype.hasModelVersion=function(){var e,t=this,n=[];return i.wrappedWithPromise(function(r,s){if(!t.isConfigured())return r();t.isConfigured()&&t.getAttachedConfigModels().forEach(function(t){n.push(t.VersionsLoaderWrapper().then(function(){var n=t.getModelVersion();e||(e=!!n)}))}),i.allSettled(n).then(function(){e?r(e):(o.errorAlert(t.options.appCore.i18nManager.get("error.noVersion.relatedToModel")),r())})})},a.prototype.getAllAvailableVersionsPromises=function(){if(!Array.isArray(this.getAttachedConfigModels()))return[];var e=[];return this.getAttachedConfigModels().forEach(function(t){e.push(t.getListOfVersionsPromise())}),e},a.prototype.unMatch=function(e){if(!e)return!1;var t=e.toLowerCase(),n=this.options.appCore.dicoService.getVisibleAttributes();if(Array.isArray(n))for(var i=0;i<n.length;i++){var r=n[i].dataIndex?n[i].dataIndex:n[i].ds6w;if((this.getGridValueForaKey(r)||"").toLowerCase().includes(t)||(this.getLabel()||"").toLowerCase().includes(t))return!1}var o=!0;return(this.getAttributes()||[]).forEach(function(e){e.value.toLowerCase().includes(t)&&(o=!1)}),o},a.prototype.applyFilters=function(){this.shouldBeVisible()?this.show():this.hide()},a.prototype.shouldBeVisible=function(e){return!this.isHiddenBySearch()&&!this.isHiddenByTagger()},a.prototype.isHiddenByTagger=function(){return this.options.filteringContext.isFilterOutByTagger},a.prototype.isHiddenBySearch=function(){return this.options.filteringContext.isFilterOutBySearch},a.prototype.setTaggerFilterState=function(e){this.options.filteringContext.isFilterOutByTagger=e},a.prototype.setSearchFilterState=function(e){this.options.filteringContext.isFilterOutBySearch=e},a.prototype.hasStaticMapping=function(){return!1},a.prototype.setPreferredModelById=function(e){if(e&&Array.isArray(this.getAttachedConfigModels())){var t=this.getAttachedConfigModels().find(function(t){return t.getID()===e});t&&this.attachPreferedConfigModel(t,!1)}},a.prototype._syncWithAttachedModel=function(){return this._syncWithAttachedModelAndVersion(null)},a.prototype._syncWithAttachedModelAndVersion=function(e){var t=this;return this.options.configInitPromise=new n(function(n,i){if(!t.getID())return i("not valid Object");var r=t.getID(),o={pid:r};t.options.appCore.dataService.getEngItemConfigurationInfo(o).then(function(i){if(i.length>0){if(t.attachConfigModels(i),t.options.appCore.PreferencesManager.getEngItemOpenPreferences(r)&&!t.getPreferedAttachedConfigModel()){var o=t.options.appCore.PreferencesManager.getEngItemOpenPreferences(r);o.noModel&&(t.showModelVersionChooser=!1);for(var s=0;s<i.length;s++)if(i[s].getID()===o.model){t.attachPreferedConfigModel(i[s]);break}}t.getPreferedAttachedConfigModel()&&t.getPreferedAttachedConfigModel()._synchronizeModelVersions?t.getPreferedAttachedConfigModel()._synchronizeModelVersions(e)&&t.getPreferedAttachedConfigModel()._synchronizeModelVersions(e).finally(function(){n(!0)}):n(!0)}else t.attachConfigModels([]),t.attachPreferedConfigModel(null),n(!0)}).catch(function(e){console.log(e),t.attachConfigModels([]),t.attachPreferedConfigModel(null),i(e)})}),this.options.configInitPromise},a.prototype.getConfigInitPromise=function(){return this.options.configInitPromise?this.options.configInitPromise:this._syncWithAttachedModel()},a.prototype.getTypeForVersionGraph=function(){return this.isConfigured()?"Model":this.getType()},a.prototype.getIdForVersionGraph=function(){return this.isConfigured()&&this.getPreferedAttachedConfigModel()?this.getPreferedAttachedConfigModel().getPreferredVersion()?this.getPreferedAttachedConfigModel().getCurrentVersionID():null:this.getID()},a.prototype.getVersionOfModelVersion=function(){return this.isConfigured()&&(this.hasValidTransientNextGenFilter()||this.hasValidPersistedNextGenFilter())?null:this.isConfigured()&&this.getPreferedAttachedConfigModel()&&this.getPreferedAttachedConfigModel().getPreferredVersion()?this.getPreferedAttachedConfigModel().getCurrentVersionRevision():null},a.prototype.getReferenceVersionForIDCard=function(){return this.isConfigured()&&this.getPreferedAttachedConfigModel()||this.isConfigured()&&(this.hasValidTransientNextGenFilter()||this.hasValidPersistedNextGenFilter())?null:this.getReferenceVersion()},a.prototype.getTitleForIdcard=function(){return this.getLabel()},a.prototype.getTitle=function(){return this.getLabel()},a.prototype.getFilterForIdcard=function(){return this.hasValidTransientNextGenFilter()||this.hasValidPersistedNextGenFilter()?"["+this.getNGFilterName()+"]":null},a.prototype.getConfigurationDisplayName=function(){if(this.isConfigured()&&this.getPreferedAttachedConfigModel()&&!this.getFilterForIdcard()){var e=this.getPreferedAttachedConfigModel().getPreferredConfiguration();return e?e.marketingName:this.options.appCore.i18nManager.get("eng.conf_placeholder")}return null},a.prototype.getModelVersionForIDCard=function(){var e=this.isConfigured()&&this.getPreferedAttachedConfigModel()?this.getPreferedAttachedConfigModel():null;return this.getFilterForIdcard()?null:e?e.getCurrentVersionMarketingName():this.isConfigured()?this.options.appCore.i18nManager.get("eng.model_placeholder"):null},a.prototype.getThumbnail=function(){return this.options.thumbnail},a.prototype.getViewType=function(){return this.options.viewType},a.prototype.toggleSelection=function(){return this.isSelected()?this.unselect():this.select()},a.prototype.getQuantity=function(){return this.getInstances().length},a.prototype.getAttributes=function(){return this.options.attributes},a.prototype.isAttributePending=function(e,n){if(!t.is(e,"string"))return!1;return Array.isArray(n)?-1!==(n.indexOf("#loading#")||n.indexOf("#queued#")):-1!==["#loading#","#queued#"].indexOf(this.getAttributeValue(e))},a.prototype.attributeRemoteLoadingNotStart=function(e){if(!t.is(e,"string"))return!1;var n=this.getAttributeValue(e);return"#queued#"===n||void 0===n},a.prototype.isAttributeLoadFailed=function(e){return"#failed#"===this.getAttributeValue(e)},a.prototype.getSortableAttributeValue=function(e){for(var t=this.getSortableAttributes(),n=0;n<t.length;n++)if(t[n].name===e)return t[n].value},a.prototype.getSortableAttributes=function(){var e=[];return this.options?(e.push({name:"Title",value:this.options.grid["ds6w:label"]}),e.push({name:"Maturity",value:this.options.grid["ds6w:status"]}),e.push({name:"Owner",value:this.options.grid["ds6w:responsible"]}),e.push({name:"CreationDate",value:this.options.grid["ds6w:created"]}),e.push({name:"ModifiedDate",value:this.options.grid["ds6w:modified"]}),e.push({name:"PartNumber",value:this.options.grid["ds6wg:EnterpriseExtension.V_PartNumber"]}),e.push({name:"TreeOrder",value:this.options.grid["ro.plminstance.V_treeorder-Instance"]}),e):(console.error(" you need to call basic method before !"),e)},a.prototype.getDateFormatAttributes=function(){return this.customDateAttrs||(this.customDateAttrs=this.options.appCore.dicoService.getVisibleAttributes()||[],this.customDateAttrs=this.customDateAttrs.filter(function(e){return"date"===e.kind.toLowerCase()}).map(function(e){return e.ds6w})),this.customDateAttrs},a.prototype.getOccurrencePath=function(){return null===this.getUsages()||this.getUsages().length<=0?[this.getID()]:this.getUsages()[0].getOccurrencePath()},a.prototype.buildNodeId=function(){var e=this.getDataPath();return e&&Array.isArray(e)?e.join("/"):null},a.prototype.getDataPath=function(){var e=this.getReferencePath();if(e&&Array.isArray(e))return e;var t=[],n=this.getID();return n&&t.push(n),t},a.prototype.getReferencePath=function(){if(this.isEngineeringItem()){var e=this.getOccurrencePath();if(!e||!Array.isArray(e))return null;for(var t=[],n=0;n<e.length;n+=2)t.push(e[n]);return t}return[this.getID()]},a.prototype.isChildComputed=function(){return this.options.childComputed},a.prototype.childrenToDisplay=function(){return this.options.children},a.prototype.addChildToTheTargetNode=function(e){var t=this;Array.isArray(e)&&e.length>0&&(t.prepareUpdate(),e.forEach(function(e){e.getID()!==t.getID()&&t.addChild(e)}),t.pushUpdate())},a.prototype.getOwner=function(){return this.options.grid["ds6w:responsible"]},a.prototype.getGridValueForaKey=function(e){let t=this.options.grid[e];return null==t||null==t?"":"string"==typeof t||"boolean"==typeof t||"number"==typeof t?t.toString():Array.isArray(t)&&"string"==typeof t[0]?t.join(","):""},a.prototype.getMaturity=function(){return this.options.grid["ds6w:status"]},a.prototype.setMaturity=function(e){e&&e.length>0&&(this.options.grid["ds6w:status"]=e)},a.prototype.getLabel=function(){return this.options.grid["ds6w:label"]},a.prototype.getName=function(){return this.options.grid["ds6w:identifier"]},a.prototype.getDisplayName=function(){const e=void 0!==this.getReferenceVersion()?this.getReferenceVersion():"";return this.getLabel()+" "+e},a.prototype.getShading=function(){return this.options.shading},a.prototype.isCut=function(){return this.options.isCut},a.prototype.getNodesByRelId=function(e){for(var t=[],n=this._getChildInstanceNodes(),i=0;i<n.length;i++)n[i].getRelationID()===e&&t.push(n[i]);return t},a.prototype._getChildInstanceNodes=function(){var e=this,t=[],n=this.getChildren();return n&&Array.isArray(n)&&n.length>0&&(n=e.options.appCore.contextManager.getActiveEngItem().getContentModels()._getNoFakeNodes(n)).forEach(function(n){e.options.appCore.Factories.ListItemFactory.isInstanceOfListNodeModel(n)?t.push(n):t.push(...n.getUsages())}),t},a.prototype.getGlobalType=function(){return this.options.padgrid["ds6w:globalType"]},a.prototype.isSpecificationDocument=function(){return this.getReferenceValue("isSpecificationDocument")},a.prototype.isRepresentation=function(){var e=!1;return"ds6w:Document"===this.getGlobalType()&&(e=!0),e},a.prototype.isDrawing=function(){var e=!1;return"ds6w:Document"===this.getGlobalType()&&"Drawing"===this.getType()&&(e=!0),e},a.prototype.isEngineeringItem=function(){var e=!1;return"ds6w:Part"===this.getGlobalType()&&(e=!0),e},a.prototype.isDocument=function(e){var t=!1;if("ds6w:FileDocument"===this.getGlobalType()&&(t=!0),t&&"string"==typeof e&&e.trim().length)switch(e){case s.SPECIFICATION_DOCUMENT:t=this.isSpecificationDocument()}return t},a.prototype.isCoreMaterialType=function(){return!(!this.options.padgrid||"ds6w:Material"!==this.options.padgrid["ds6w:globalType"])},a.prototype.isRawMaterialType=function(){return!(!this.options.grid||"Raw_Material"!==this.options.grid.type&&!this.options.grid["ds6wg:raw_material.v_dimensiontype-Instance"]&&!this.options.grid["ds6wg:raw_material.v_dimensiontype"])},a.prototype.isDeformedObject=function(){return!(!this.options.grid||null==this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO]&&null==this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO])},a.prototype.isDeformableObject=function(){return!(!this.options.grid||null==this.options.grid[s.CONST_DS6W_DEFORMABILITY]&&null==this.options.grid[s.CONST_DS6W_DEFORMABILITY])&&this.options.grid[s.CONST_DS6W_DEFORMABILITY]===this.options.appCore.i18nManager.get("ds6w:deformability/deformable")},a.prototype.getDeformableObjectIDFromDeformed=function(){let e=this.options.grid&&this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO]?this.options.grid[s.CONST_DEFORMABLE_SEMANTIC_REL_INFO]:void 0;if(e&&Array.isArray(e.split(" "))){let t=e.split(" ");if(8==t.length)return t[6]}return null},a.prototype.hasQuantity=function(){const e=e=>this.options.grid.hasOwnProperty(e)&&this.options.grid[e]&&0!==this.options.grid[e].trim().length;return e(s.DECLARED_VOLUME)||e(s.CONT_QUANTITY_MASS)||e(s.CONT_QUANTITY_VOLUME)},a.prototype.isMaterialQuantity=function(){var e=(e=>this.options.grid.hasOwnProperty(e)&&this.options.grid[e]&&0!==this.options.grid[e].trim().length)("CoreMaterial"),t=this.hasQuantity(),n=void 0!==this.getCoreMaterials()&&Array.isArray(this.getCoreMaterials())&&this.getCoreMaterials().length>0;return!(!e&&!n||!t)},a.prototype.getTenant=function(){return this.options.tenant},a.prototype.getDisplayedGridViewAttribute=function(){var e=[];e.push("ds6w:status"),e.push("ds6w:responsible"),e.push("ds6wg:EnterpriseExtension.V_PartNumber"),e.push("ds6w:created"),e.push("ds6w:modified"),e.push("ds6w:cadMaster"),e.push("ds6w:description"),e.push(s.CONT_QUANTITY_MASS),e.push(s.CONT_QUANTITY_VOLUME),e.push("ds6w:reservedBy");var t=this,n=[];return e.forEach(function(e){let i=t.options.grid[e];null!=i&&""!==i&&"Warning:JPO"!=i&&n.push(e)}),n},a.prototype.getAllGridViewAttribute=function(){var e=[];e.push("ds6w:label"),e.push("ds6wg:revision"),e.push("ds6w:type"),e.push("ds6w:cadMaster"),e.push("ds6w:status"),e.push("ds6w:responsible"),e.push("ds6wg:EnterpriseExtension.V_PartNumber"),e.push("ds6w:modified"),e.push("ds6w:created"),e.push("ds6w:description"),e.push(s.CONT_QUANTITY_MASS),e.push(s.CONT_QUANTITY_VOLUME),e.push("ds6w:reservedBy");var t=this,n=[];return e.forEach(function(e){let i=t.options.grid[e];null!=i&&""!==i&&"Warning:JPO"!=i&&n.push(e)}),n},a.prototype.setCoreMaterials=function(e){this.options.CoreMaterialNodes=e},a.prototype.getCoreMaterials=function(){return this.options.CoreMaterialNodes},a.prototype.addUsages=function(e){void 0!==this.options.grid.quantity&&Array.isArray(this.options.grid.quantity)?this.options.grid.quantity=this.options.grid.quantity.concat(e):this.setUsages(e)},a.prototype.addParentOccurences=function(e){void 0!==this.options.grid.parentOccurence&&Array.isArray(this.options.grid.parentOccurence)?this.options.grid.parentOccurence=this.options.grid.parentOccurence.concat(e):this.options.grid.parentOccurence=e},a.prototype.getParentOccurences=function(){return null!=this.options.grid.parentOccurence&&Array.isArray(this.options.grid.parentOccurence)?this.options.grid.parentOccurence:null},a.prototype.getUsages=function(){return null!=this.options.grid.quantity&&Array.isArray(this.options.grid.quantity)?this.options.grid.quantity:null},a.prototype.setUsages=function(e){this.options.grid.quantity=e},a.prototype.getCoreMaterialsRollup=function(){var e,t,n="",i="",r="";return this.getUsages().forEach(function(o){e=o.hasMassQuantity(),t=o.hasVolumeQuantity();var s=o.options.appCore.PreferencesManager.getNLSValueForVolumeQuantity(),a=o.options.appCore.PreferencesManager.getNLSValueForMassQuantity();o.hasVolumeQuantity()?r=String(r).trim().length>0&&t?parseFloat(r)+parseFloat(t):t:o.hasMassQuantity()&&(i=String(i).trim().length>0&&e?parseFloat(i)+parseFloat(e):e),String(i).trim().length>0&&String(r).trim().length>0?n=i+" "+a+" + "+r+" "+s:String(i).trim().length>0?n=i+" "+a:String(r).trim().length>0&&(n=r+" "+s)}),n},a.prototype.getUsedQuantity=function(){return this.getUsages()&&this.getUsages().length>0?this.getUsages().length:null},a.prototype.getRawMaterialsRollup=function(e){var t="";let n,i,r,o,s="",a="",l="",c="";n=e.hasRawMatMassQuantity(),i=e.hasRawMatVolumeQuantity(),r=e.hasRawMatAreaQuantity(),o=e.hasRawMatLengthQuantity();var d=e.options.appCore.PreferencesManager.getNLSValueForVolumeQuantity(),u=e.options.appCore.PreferencesManager.getNLSValueForMassQuantity(),p=e.options.appCore.PreferencesManager.getNLSValueForAreaQuantity(),g=e.options.appCore.PreferencesManager.getNLSValueForLengthQuantity();return i?a=String(a).trim().length>0&&i?parseFloat(a)+parseFloat(i):i:n?s=String(s).trim().length>0&&n?parseFloat(s)+parseFloat(n):n:r?l=String(l).trim().length>0&&r?parseFloat(l)+parseFloat(r):r:o&&(c=String(c).trim().length>0&&o?parseFloat(c)+parseFloat(o):o),String(c).trim().length>0?t=c+" "+g:String(a).trim().length>0?t=a+" "+d:String(s).trim().length>0?t=s+" "+u:String(l).trim().length>0&&(t=l+" "+p),t},a.prototype.getRollUpMaterials=function(){var e="";let t=this;if(this.isRawMaterialType()){if(this.hasConvertedValue())return t.getRawMaterialsRollup(this);let n,i,r,o,s="",a="",l="",c="";this.getUsages()&&this.getUsages().forEach(function(t){n=t.hasRawMatMassQuantity(),i=t.hasRawMatVolumeQuantity(),r=t.hasRawMatAreaQuantity(),o=t.hasRawMatLengthQuantity();var d=t.options.appCore.PreferencesManager.getNLSValueForVolumeQuantity(),u=t.options.appCore.PreferencesManager.getNLSValueForMassQuantity(),p=t.options.appCore.PreferencesManager.getNLSValueForAreaQuantity(),g=t.options.appCore.PreferencesManager.getNLSValueForLengthQuantity();i?a=String(a).trim().length>0&&i?parseFloat(a)+parseFloat(i):i:n?s=String(s).trim().length>0&&n?parseFloat(s)+parseFloat(n):n:r?l=String(l).trim().length>0&&r?parseFloat(l)+parseFloat(r):r:o&&(c=String(c).trim().length>0&&o?parseFloat(c)+parseFloat(o):o),String(c).trim().length>0?e=c+" "+g:String(a).trim().length>0?e=a+" "+d:String(s).trim().length>0?e=s+" "+u:String(l).trim().length>0&&(e=l+" "+p)})}else e=this.isCoreMaterialType()||this.isDeformableObject()?this.getCoreMaterialsRollup():"";return e},a.prototype.hasConvertedValue=function(){let e=!1;return(this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_MASS)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_MASS)]||this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_VOLUME)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_VOLUME)]||this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_AREA)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_AREA)]||this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_LENGTH)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_LENGTH)])&&(e=!0),e},a.prototype.hasMassQuantity=function(){return""!==this.getMassQuantity()&&this.getMassQuantity()},a.prototype.hasVolumeQuantity=function(){return""!==this.getVolumeQuantity()&&this.getVolumeQuantity()},a.prototype.hasRawMatVolumeQuantity=function(){return""!==this.getRawMatVolumeQuantity()&&this.getRawMatVolumeQuantity()},a.prototype.hasRawMatAreaQuantity=function(){return""!==this.getRawMatAreaQuantity()&&this.getRawMatAreaQuantity()},a.prototype.hasRawMatMassQuantity=function(){return""!==this.getRawMatMassQuantity()&&this.getRawMatMassQuantity()},a.prototype.hasRawMatLengthQuantity=function(){return""!==this.getRawMatLengthQuantity()&&this.getRawMatLengthQuantity()},a.prototype.getMassQuantity=function(){return this.options.grid[this.appendConverted(s.CONT_QUANTITY_MASS)]&&""!==this.options.grid[this.appendConverted(s.CONT_QUANTITY_MASS)]?this.options.grid[this.appendConverted(s.CONT_QUANTITY_MASS)]:this.options.grid[s.CONT_QUANTITY_MASS]&&""!==this.options.grid[s.CONT_QUANTITY_MASS]?this.options.grid[s.CONT_QUANTITY_MASS]:""},a.prototype.getVolumeQuantity=function(){return this.options.grid[this.appendConverted(s.CONT_QUANTITY_VOLUME)]&&""!==this.options.grid[this.appendConverted(s.CONT_QUANTITY_VOLUME)]?this.options.grid[this.appendConverted(s.CONT_QUANTITY_VOLUME)]:this.options.grid[s.CONT_QUANTITY_VOLUME]&&""!==this.options.grid[s.CONT_QUANTITY_VOLUME]?this.options.grid[s.CONT_QUANTITY_VOLUME]:this.options.grid[s.DECLARED_VOLUME]&&""!==this.options.grid[s.DECLARED_VOLUME]?this.options.grid[s.DECLARED_VOLUME]:""},a.prototype.getRawMatMassQuantity=function(){return this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_MASS)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_MASS)]?this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_MASS)]:this.options.grid[s.CONT_RAWMAT_QUANTITY_MASS]&&""!==this.options.grid[s.CONT_RAWMAT_QUANTITY_MASS]?this.options.grid[s.CONT_RAWMAT_QUANTITY_MASS]:""},a.prototype.getRawMatVolumeQuantity=function(){return this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_VOLUME)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_VOLUME)]?this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_VOLUME)]:this.options.grid[s.CONT_RAWMAT_QUANTITY_VOLUME]&&""!==this.options.grid[s.CONT_RAWMAT_QUANTITY_VOLUME]?this.options.grid[s.CONT_RAWMAT_QUANTITY_VOLUME]:""},a.prototype.getRawMatAreaQuantity=function(){return this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_AREA)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_AREA)]?this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_AREA)]:this.options.grid[s.CONT_RAWMAT_QUANTITY_AREA]&&""!==this.options.grid[s.CONT_RAWMAT_QUANTITY_AREA]?this.options.grid[s.CONT_RAWMAT_QUANTITY_AREA]:""},a.prototype.getRawMatLengthQuantity=function(){return this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_LENGTH)]&&""!==this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_LENGTH)]?this.options.grid[this.appendConverted(s.CONT_RAWMAT_QUANTITY_LENGTH)]:this.options.grid[s.CONT_RAWMAT_QUANTITY_LENGTH]&&""!==this.options.grid[s.CONT_RAWMAT_QUANTITY_LENGTH]?this.options.grid[s.CONT_RAWMAT_QUANTITY_LENGTH]:""},a.prototype.appendConverted=function(e){return e+"_converted"},a.prototype.getUsedReferenceID=function(){return this.isMaterialQuantity()?this.options.CoreMaterialNodes[0].getID():this.getID()},a.prototype.hasUsages=function(){var e=this.getUsages();return!!(null!=e&&Array.isArray(e)&&e.length>0)},a.prototype.findChildrenByIds=function(e){let t=this.getContentModels()&&this.isRoot()?this.getContentModels().getRoots():this.getChildren();return r.findNodesByIdsFromList(t,e)},a.prototype.findChildrenById=function(e){return this.findChildrenByIds([e])},a.prototype.setStaticMapping=function(e){this.options.staticMapping=e},a.prototype.getStaticMapping=function(){return this.options.staticMapping},a.prototype.getExpandPath=function(){let e;return this.getStaticMapping()&&(e=this.getStaticMapping().path),this.getOccurrencePath&&this.getOccurrencePath()&&Array.isArray(this.getOccurrencePath())&&this.getOccurrencePath().length>1&&(e=this.getOccurrencePath()),e},a.prototype.matchIDs=function(e){const t=this.getID?this.getID():null,n=this.buildNodeId?this.buildNodeId():null,i=this.getRelationID?this.getRelationID():null;return-1!==e.indexOf(t)||-1!==e.indexOf(i)||-1!==e.indexOf(n)},a.prototype.matchQtyOrInstIDs=function(e){if(this.options.appCore.sessionManager.shouldShowQuantityView()){const t=this.getID?this.getID():null,n=this.buildNodeId?this.buildNodeId():null,i=(this.getRelationID&&this.getRelationID(),this.options.grid.quantity);let r=!1;return i&&Array.isArray(i)&&i.forEach(i=>{const o=i.getRelationID?i.getRelationID():null;-1===e.indexOf(t)&&-1===e.indexOf(o)&&-1===e.indexOf(n)||(r=!0)}),r}return this.matchIDs(e)},a.prototype.matchChangeSet=function(e){let t=function(e){let t=e.referenceId||e.instanceId||e.occurrenceId;return Array.isArray(t)?t.join("/"):t}(e);return this.matchIDs([t])},a.prototype.updateWithChangeSet=function(e){let t=!1;this.matchChangeSet(e)&&(Object.assign(this.options.grid,e.options.grid),t=!0);const n=this.getUsages();n&&n.length&&n.forEach(n=>{n.matchChangeSet(e)&&(Object.assign(n.options.grid,e.options.grid),t=!0)}),t&&this.updateOptions(this.options)},a.prototype.getLevelForPayload=function({onlyFinal:e,onlyMFG:t,targetLevel:n}){return n||(e||t?"-1":"1")},a.prototype.isEndItem=function(){var e=widget.getValue(s.FINAL_ITEMS_PREF),t=this.options.appCore.dicoService.getTerminalAttributesInfo(e),n=t&&t.kind?t.kind:null,i=(n=t&&t.Type?t.Type:n)&&"boolean"==n.toLowerCase(),r=this.options.appCore.dicoService.getTerminalAttributesInfo(e),o=widget.getValue(s.FINAL_ITEM_VALUE_NAME),a=null;if(r){const t="tree"==e?"ds6w:label":e;void 0===(a=this.options.grid[t])&&(a=r.defaultValue)}return null!=a&&null!=o&&void 0!==o&&(Array.isArray(a)?a.includes(o):(i&&(a=i?a.toLowerCase():a,o=i&&o?o.toLowerCase():o),a===o))},a.prototype.getLeafNodes=function(){let e=[],t=this;if(this.isEndItem())this.options.appCore.sessionManager.shouldShowLeafMaterials()?e.push(this.getValidRawMaterialforEndItem()):e.push(this);else{let n=this.getChildren();n&&Array.isArray(n)&&0!==n.length?n.forEach(n=>{let i=n.isRawMaterialType&&n.isRawMaterialType()&&t.isDeformedObject&&t.isDeformedObject()?[t]:n.getLeafNodes();e.push(...i)}):e.push(this)}return e},a.prototype.getValidRawMaterialforEndItem=function(){let e=this.getChildren();if(Array.isArray(e)&&e.length>0)for(let t=0;t<e.length;t++)if(e[t].isRawMaterialType&&e[t].isRawMaterialType())return e[t];return this},a.prototype.getChildNodes=function(){let e=[],t=this.getChildren();return t&&Array.isArray(t)&&t.length>0&&t.forEach(t=>{e.push(t);let n=t.getChildNodes();e.push(...n)}),e},a}),define("DS/ENOXEngineer/models/EngItemGroupModel",["DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/services/I18nManager","UWA/Core"],function(e,t,n,i,r){"use strict";function o(t){this.options={useAsyncPreExpand:!1},this.options=r.extend(this.options,t),e.call(this,this.options),this.isGroupingNode=!0}return o.prototype=Object.create(e.prototype),o.prototype.getViewType=function(){return this.options.viewType},o.prototype.getIcons=function(){return this.options.icons},o.prototype.getTypeIcon=function(){return this.options.icons},o.prototype.isGroupFromExpand=function(){return!0===this.options.useAsyncPreExpand},o.prototype.getGlobalType=function(){return this.options.padgrid?this.options.padgrid["ds6w:globalType"]:null},o.prototype.getLabel=function(){return this.options.label},o.prototype.isCoreMaterialGroupNode=function(){return!0===this.getAttributeValue("isCoreMaterialGroupNode")},o.prototype.constructor=o,o.prototype.getIdentifier=function(){return this._options.identifier},o.prototype._getFakeNodesTable=function(){return this._options.fakeNodesTable},o.prototype.getInstanceType=function(){return""},o.prototype.getProperty=function(){return this._options.property},o.prototype.getGroupingNodeOptions=function(e){var t={},r=this.getProperty(),o=this.getIdentifier(),s=e.count,a=this.getChildren();if(Array.isArray(a)&&a.length>0){var l=a[0];if("reference"===r)if(l.isMaterialQuantity()){o=l.options.grid.CoreMaterial;var c=0;a.forEach(function(e){c+=parseFloat(e.options.grid["ds6wg:MaterialUsageExtension.DeclaredQuantity"])}),t.grid={"ds6wg:MaterialUsageExtension.DeclaredQuantity":c.toString()}}else o=l.options.grid["ds6w:label"]}var d=o;if(this._options.patch_isCustoDate&&d&&"NULL"!==d&&"NA"!==d){isNaN(d)||(d=parseInt(d),d*=1e3);var u=n.getDateFormater();try{d=u.format(new Date(d)).replace(",","")}catch(e){d=new Date(d)}}let p=r.endsWith("-Instance")?` (${i.get("eng.export.instance.key")})`:"";return t.label=i.get(r)+p+": "+d+" ("+s+")",t},o.prototype.getOriginalChildrenInformation=function(){return Object.assign({},this._options.originalChildrenInformation)},o.prototype._setOriginalChildrenInformation=function(e){e.childrenCount===this._options.originalChildrenInformation.childrenCount&&e.notHiddenNotFilteredChildrenCount===this._options.originalChildrenInformation.notHiddenNotFilteredChildrenCount||(this._options.originalChildrenInformation=Object.assign({},e)),e.notHiddenNotFilteredChildrenCount>0?(this.isHidden()&&this.show(),this.isExpanded()||this.expand()):this.isHidden()||this.hide(),0===e.childrenCount&&this.remove()},o.prototype._updateOriginalChildrenInformation=function(){var e=0,t=0,n=this.getChildren();if(n)for(var i=n.length;i>0;i--){var r=n[i-1],o=r._updateOriginalChildrenInformation();e+=o.childrenCount,t+=o.notHiddenNotFilteredChildrenCount,0===o.childrenCount&&delete this._getFakeNodesTable()[r.getIdentifier()]}return this._setOriginalChildrenInformation({childrenCount:e,notHiddenNotFilteredChildrenCount:t}),{childrenCount:e,notHiddenNotFilteredChildrenCount:t}},o.prototype._updateGroupingNodeOptions=function(e){var t=this.getChildren(),n=[];t&&t.forEach(function(t){n=n.concat(t._updateGroupingNodeOptions(e))});var i=this.getOriginalChildrenInformation();return e.updateGroupingNodeOptions?e.updateGroupingNodeOptions.call(this,n):this.updateOptions(this.getGroupingNodeOptions({count:i.notHiddenNotFilteredChildrenCount})),n},o.prototype._canBeGrouped=function(){return!1},o.prototype._isFromOriginalModel=function(){return!1},o.prototype._groupChildren=function(e){},o.prototype.groupChildren=function(e){},o.prototype._removeGrouping=function(e,t,n,i){var r=this.getChildren();if(r&&r.length>0){for(var o=i||!t||t.length<=n||t[n]!==this.getProperty(),s=r.length;s>0;s--){var a=r[s-1];a._removeGrouping(e,t,n+1,o)&&delete this._getFakeNodesTable()[a.getIdentifier()]}return o?this.remove():this.hide(),o}},o.prototype.ungroupChildren=function(e){},o.prototype.canBeFiltered=function(){return!1},o}),define("DS/ENOXEngineer/facets/SpecificationsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXSpecificationsUX/SpecificationsPane","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i,r,o,s)=>{return t.extend(n,i,{init(e){this._parent(e),this.buildView(e)},buildView(t){const n=this;this.elements.container=e.createElement("div",{class:"relatedDocuments_spec"}),this.multiselDisplay=e.createElement("div",{class:"notSupported"}).inject(this.elements.container),this.iconHolder=e.createElement("span",{class:"blockIcon"}).inject(this.multiselDisplay),this.infoMsgH2Tag=e.createElement("h2",{class:"information_msg"}).inject(this.multiselDisplay),this.multiselDisplay.hide(),t.appContext.settingManager.getAllPlatforms().then(e=>{const{includedTypes:i,excludedTypes:r}=t.appContext.settingManager.getSetting("SpecificationTypes"),a={parentObject:{parentId:n.getUniqueSelectedNodeID()},connectorOptions:{fetchSecurityContext:()=>t.appContext.contextManager.getSecurityContext().SecurityContext,getWorkUnderHeaders:function(){return t.appContext&&t.appContext.settingManager&&t.appContext.settingManager.getWorkUnderHeaders&&t.appContext.settingManager.getWorkUnderHeaders()},platformUrls:e[t.appContext.settingManager.getPlatformId()]},supportedTypes:{includedTypes:i,excludedTypes:r},webinwin:!1};n.specificationsPane=new o(a),n.specificationsPane.modelEvents.subscribe({event:s.EVENT_UPLOAD_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.specificationsPane.modelEvents.subscribe({event:s.EVENT_DETACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.specificationsPane.modelEvents.subscribe({event:s.EVENT_ATTACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.specificationsPane.inject(n.elements.container),n.multiselDisplay.isHidden()||n.specificationsPane.hide()})},updateFacet(){const e=this.getUniqueSelectedNodeID();this.selectionModified(e)},getUniqueSelectedNodeID(){let e,t=!0;const n=[],i=this.options.appContext.contextManager.getXENTreeDocument().getSelectedNodes();if(i.length>0&&i.forEach(e=>{n.push(e.getID()),e.isEngineeringItem()||(t=!1)}),!t)return;const r=[...new Set(n)];return 1===r.length?[e]=r:0===i.length&&1===this.options.appContext.contextManager.getSelectedNodes().length&&(e=this.options.appContext.contextManager.getSelectedNodes()[0].getID()),e},destroyComponent(){},notApplicable(){this.infoMsgH2Tag.setText(this.options.appContext.i18nManager.get("notSupportedSelection")),this.iconHolder.addClassName("wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-block"),this.multiselDisplay.show(),this.specificationsPane&&this.specificationsPane.hide()},selectionModified(e){if(!e)return void this.notApplicable();this.multiselDisplay.hide();const t={parentId:e};this.specificationsPane&&(this.specificationsPane.show(),this.specificationsPane.options.parentObject.parentId!==e&&this.specificationsPane.setParentObject(t))},onResize(){},onRefresh(){}})}),define("DS/ENOXEngineer/facets/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXAttachmentsUX/AttachmentsPane","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i,r,o,s)=>{return t.extend(n,i,{init(e){this._parent(e),this.buildView(e)},buildView(t){const n=this;this.elements.container=e.createElement("div",{class:"relatedDocuments"}),this.multiselDisplay=e.createElement("div",{class:"notSupported"}).inject(this.elements.container),this.iconHolder=e.createElement("span",{class:"blockIcon"}).inject(this.multiselDisplay),this.infoMsgH2Tag=e.createElement("h2",{class:"information_msg"}).inject(this.multiselDisplay),this.multiselDisplay.hide(),t.appContext.settingManager.getAllPlatforms().then(e=>{const i={parentObject:{parentId:n.getUniqueSelectedNodeID()},connectorOptions:{fetchSecurityContext:()=>t.appContext.contextManager.getSecurityContext().SecurityContext,platformUrls:e[t.appContext.settingManager.getPlatformId()]},supportedTypes:{includedTypes:t.appContext.settingManager.getSetting("includedAttachmentTypes"),excludedTypes:t.appContext.settingManager.getSetting("excludedAttachmentTypes")},webinwin:!1};n.attachmentsPane=new o(i),n.attachmentsPane.modelEvents.subscribe({event:s.EVENT_UPLOAD_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.attachmentsPane.modelEvents.subscribe({event:s.EVENT_DETACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.attachmentsPane.modelEvents.subscribe({event:s.EVENT_ATTACH_ATTACHMENT_COMPLETE},function(){n.options.appContext.sessionManager.setAuthoringMode("authoring")}),n.attachmentsPane.inject(n.elements.container),n.multiselDisplay.isHidden()||n.attachmentsPane.hide()})},updateFacet(){const e=this.getUniqueSelectedNodeID();this.selectionModified(e)},getUniqueSelectedNodeID(){let e,t=!0;const n=[],i=this.options.appContext.contextManager.getXENTreeDocument().getSelectedNodes();if(i.length>0&&i.forEach(e=>{n.push(e.getID()),e.isEngineeringItem()||(t=!1)}),!t)return;const r=[...new Set(n)];return 1===r.length?[e]=r:0===i.length&&1===this.options.appContext.contextManager.getSelectedNodes().length&&(e=this.options.appContext.contextManager.getSelectedNodes()[0].getID()),e},destroyComponent(){},notApplicable(){this.infoMsgH2Tag.setText(this.options.appContext.i18nManager.get("notSupportedSelection")),this.iconHolder.addClassName("wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-block"),this.multiselDisplay.show(),this.attachmentsPane&&this.attachmentsPane.hide()},selectionModified(e){if(!e)return void this.notApplicable();this.multiselDisplay.hide();const t={parentId:e};this.attachmentsPane&&(this.attachmentsPane.show(),this.attachmentsPane.options.parentObject.parentId!==e&&this.attachmentsPane.setParentObject(t))},onResize(){},onRefresh(){}})}),define("DS/ENOXEngineer/services/XEngContextManager",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineer/utils/ResponseParser","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";return t.singleton({_selectedItems:[],_is_XENG_widget:!0,_isMultiSelectMode:!1,_currentCommandContext:null,_app:null,_activeEngItem:null,_activeDocument:null,dragStartedInXENG:!1,_expectSingleCreation:!1,_modelsRawData:null,_currentRunningCmd:null,name:"pad_component",_activeList:null,_viewContext:{},_postProcess:!1,_isDataGridView:!1,_activeGridView:null,_multiselMenu:!1,_isDoubleClickEvent:!1,elements:{},initialize:function(e){this._app=e,e.core.contextManager=this;var t=this;this._XENContentProxy=e.core.Factories.CollectionsFactory.getXENProxyContentTreeDocument(),this._app.mediator.subscribe(r.EVENT_RESET_SELECTION,function(){t.resetSelection()}),this.options={widget:"undefined"!=typeof widget?widget:null},this._app.mediator.subscribe(r.EVENT_REMOVED_INSTANCES,function(e){if(t._app.core.sessionManager.shouldShowQuantityView()){var n=t.getActiveEngItem().getContentModels();let l=n.getChildrenWithoutGroupingNodes();var i=[],o=n.getSelectedNodes();let c=[];if(o=o.filter(function(e){return!0===e.isDocument()&&c.push(e),!0!==e.isDocument()}),c.length>0&&t._app.mediator.publish(r.EVENT_REMOVED_NODES,{nodes:c}),Array.isArray(o)&&o.length>=1){var s=o[0].getParentIdFromOccrencePath(),a=n.findNodesByIds([s]);l=s===t.getActiveEngItem().getID()?l:a[0].getChildren()}l.forEach(function(n){n.options;var o=n.getUsages();if(o&&Array.isArray(o)){var s=o.filter(function(t){return-1==e.instances.indexOf(t.options.instanceId)});0==s.length?i.push(n):o.length>s.length&&(n.setUsages(s),n.updateOptions(n.options),t._app.mediator.publish(r.EVENT_REFRESH_LISTVIEW))}}),i.length>0&&t._app.mediator.publish(r.EVENT_REMOVED_NODES,{nodes:i})}else t._app.mediator.publish(r.EVENT_REMOVED_INSTANCE,e)}),this._app.mediator.subscribe(r.EVENT_MODIFIED_REFERENCES,function(e){t._app.core.sessionManager.setAuthoringMode("authoring");let n=t._XENContentProxy.getCurrentTreeDocument().getAllDescendants(),i=t.updateNodeReferenceOptions(e,n);t._app.mediator.publish(r.EVENT_MODIFIED_NODES,i)}),this._app.mediator.subscribe(r.EVENT_NEW_VERSION_COMPLETED,function(e){t._app.core.sessionManager.setAuthoringMode("authoring");var n=[];e.forEach(function(e){let i=e.sourceObjectId,r=t._XENContentProxy.getCurrentTreeDocument().findNodesById(i),o="",s="";Array.isArray(r)&&r.length>0&&(o=r[0].getType(),s=r[0].getName()),t._XENContentProxy.getCurrentTreeDocument().getAllDescendants().forEach(function(e){(e.getID()===i||e.getType()===o&&e.getName()===s)&&n.push(e)})}),t._app.mediator.publish(r.EVENT_MODIFIED_NODES,n)}),t._refreshSubscription=d.subscribe("Lifecycle.Modification",function(e){var n=t.getSelectedNodes().map(function(e){return e.getID()}),i=JSON.parse(e);if(i&&i.Refresh&&i.Refresh.created&&Array.isArray(i.Refresh.created)){var o=i.Refresh.created.filter(function(e){return-1!==n.indexOf(e.sourceObjectId)});o&&Array.isArray(o)&&o.length>0&&t._app.mediator.publish(r.EVENT_NEW_VERSION_COMPLETED,o)}}),t._refreshSubscription=d.subscribe("cfgEffectivityModifications_"+widget.id,function(e){t.updateEffectivityModifications(e)}),d.subscribe("cfgEditConfigurationContextModification_"+widget.id,e=>{if(!e)return;let{commandName:n,reponse:i}=e;if(n===r.CFG_EDIT_CONTEXT_CMD){let e=t.getActiveEngItem().getID();t._app.core.dataService.getEngItemConfigurationInfo({pid:e}).then(e=>{t.getActiveEngItem().attachConfigModels(e),t._app.mediator.publish(r.EVENT_SYNC_VIEW_WITH_EI_MODEL)})}})},updateEffectivityModifications:function(e){let t=this;t._app.core.sessionManager.setAuthoringMode("authoring");let n=JSON.parse(e);if(!n)return;let i=n.response;if(!i)return;let o=[];switch(n.commandName){case"cfgEditVariant":case"cfgEditEvolution":case"cfgPasteVariant":case"cfgPasteEvolution":case"cfgMassEditVariant":let e=[];i.results.forEach(t=>{t.existing&&o.push(t.existing.pid),t.new&&e.push(t.new.pid)}),e&&e.length>0&&t.insertEffectivityNode(e);break;case"cfgExtendEvolutionEffectivity":o=i.resources.map(e=>e.identifier)}t._app.mediator.publish(r.EVENT_REFRESH_ITEMS_BY_IDS,o)},insertEffectivityNode:function(e){const t=this.getActiveEngItem().getContentModels().getSelectedNodes();if(t&&Array.isArray(t)&&t.length>0){let n=t[0].getID(),i=t[0].getRealParent().getID(),o=e.map(e=>({child:n,instance:e,parent:i}));this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,o)}},init:function(e){this._parent(e)},updateNodeReferenceOptions:function(e,t){var n=[];return e.references.forEach(function(e){var i=e.physicalid;t&&t.forEach(function(t){var r=!1;t.getID()===i&&(r=!0,n.push(t),e.attributes.forEach(function(e){t.options.grid[e.name]=e.value}));var o=t.getUsages();o&&Array.isArray(o)&&o.forEach(function(t){t.getID()===i&&(r=!0,e.attributes.forEach(function(e){t.options.grid[e.name]=e.value}))}),r&&t.updateOptions(t.options)})}),n},getXENTreeDocument:function(){return this._XENContentProxy},setCurrentViewPreference:function(e){this._isDataGridView="XENTile"!=e},setGridView:function(e){this._activeGridView="dataGridView"==e.name?e:null},isMultiLevelStructure:function(){var e=!1,t=this._app.core.localStorage.getItem(r.VALUE_QUALIFIED_AS_FINAL_COMPONENT);return t&&t===r.DIRECT_CMD&&this._isDataGridView&&(e=!0),e},setExpectSingleCreation:function(e){this._expectSingleCreation=e},expectSingleCreation:function(){return this._expectSingleCreation},setActiveDocument:function(e){this._activeDocument=e},withTransactionUpdate:function(e){if(this.getActiveEngItem()&&this.getActiveEngItem().getContentModels())return this.getActiveEngItem().getContentModels().withTransactionUpdate(e)},getActiveDocument:function(){return this._activeDocument},getActiveEngItem:function(){return this._activeEngItem},setActiveEngItem:function(e){this._activeEngItem=e},getNodesById:function(e){return this.getXENTreeDocument()?this.getXENTreeDocument().findNodesById(e):[]},getContext:function(){return this},get:function(){return this},getEditMode:function(){return!0},getENONewContext:function(){var e=this;const t={panelContent:{data:[{label:e._app.core.i18nManager.get("Type"),UIType:"Expander",expanded:!0,items:e.getTypesToDisplay()}]},getLaunchOptions:function(t){t.options.parentPIDs=[],e.getSelectedNodes instanceof Function&&e.getSelectedNodes().length>=1&&(t.options.parentPIDs=e.getSelectedNodes().map(function(e){return e.getID()})),t.context={header:{SecurityContext:"ctx::"+e._app.core.settingManager.getSecurityContext()},tenant:e._app.core.settingManager.getPlatformId(),service:""},t.events={onSuccess:function(t){"SUCCESS"===t.parsedResult.result?e.insertNodesFromNewContent(t):"FAILURE"===t.parsedResult.result&&i.errorAlert(t.parsedResult.message)},onFailure:function(){},onCancel:function(){}};let n=null;return t.options.typeName&&("PhysicalProductCBDAssembly"===t.options.typeName?n=e._app.core.i18nManager.get("eng.constant.new")+" "+e._app.core.i18nManager.get("ds6wg:CBDAssembly"):"PhysicalProductCBDBoard"===t.options.typeName?n=e._app.core.i18nManager.get("eng.constant.new")+" "+e._app.core.i18nManager.get("ds6wg:CBDBoard"):"PhysicalProductPLMPCBPhysicalComponent"===t.options.typeName&&(n=e._app.core.i18nManager.get("eng.constant.new")+" "+e._app.core.i18nManager.get("ds6wg:PLMPCBPhysicalComponent"))),null!=n&&null!=n||(n=e._app.core.i18nManager.get("add_new_engineering_item")),t.context.header=Object.assign(t.context.header,e._app.core.settingManager.getWorkUnderHeaders()),t.silentMode=!1,t.options.preferedType="",t.options.select=[],t.options.parentOrigin=[],t.responseFormat=2,t.labelTopBar=n,t},updatedListOfTypes:function(){return t.panelContent.data}};return t},getTypesToDisplay:function(){return[{label:this._app.core.i18nManager.get("physical_product_structure"),UIType:"Expander",expanded:!0,items:[{label:this._app.core.i18nManager.get("physical_product"),UIType:"Command",icon:this._app.core.Factories.ListItemFactory.getDefaultProductIcon(),launcherOptions:{labelTopBar:"",type:"VPMReference",options:{typeName:"assembly"}}}]},{label:this._app.core.i18nManager.get("electronic_items_structure"),UIType:"Expander",expanded:!0,items:[{label:this._app.core.i18nManager.get("ds6wg:CBDAssembly"),UIType:"Command",icon:this._app.core.Factories.ListItemFactory.getDefaultProductIcon(),launcherOptions:{labelTopBar:"",type:"VPMReference",options:{typeName:"PhysicalProductCBDAssembly"}}},{label:this._app.core.i18nManager.get("ds6wg:CBDBoard"),UIType:"Command",icon:this._app.core.Factories.ListItemFactory.getDefaultProductIcon(),launcherOptions:{labelTopBar:"",type:"VPMReference",options:{typeName:"PhysicalProductCBDBoard"}}},{label:this._app.core.i18nManager.get("ds6wg:PLMPCBPhysicalComponent"),UIType:"Command",icon:this._app.core.Factories.ListItemFactory.getDefaultProductIcon(),launcherOptions:{labelTopBar:"",type:"VPMReference",options:{typeName:"PhysicalProductPLMPCBPhysicalComponent"}}}]}]},insertNodesFromNewContent:function(e){const t=e.parsedResult,n=e.parsedResult.rawAttr;if(this._app.core.sessionManager.setAuthoringMode("authoring"),t.instances){let e=t.instances.map(e=>({child:t.physicalid,instance:e.relationphysicalid,parent:e.parentid}));this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,e)}else{var i=a.attributesParser(n[0].attributes);this._app.mediator.publish(r.EVENT_NEW_ENG_ITEM_CREATED,i)}},getAvailableAttributes:function(e){return this._app.core.dicoService.getAvailableAttributesByTypeV2Adapter(e)},updateInstancesEffectivities:function(e){},getSecurityContext:function(){return{SecurityContext:"ctx::"+this._app.core.settingManager.getSecurityContext(),tenant:this._app.core.settingManager.getPlatformId()}},getActiveEngItemOpenContext:function(){return this.getActiveEngItem()?this._app.core.sessionManager.getCurrentOpenContext():null},getPreferredConfigModel:function(){var e=this.getActiveEngItem();return e.isConfigured()&&e.getPreferedAttachedConfigModel()&&e.getPreferedAttachedConfigModel().getID()?[{physicalID:e.getPreferedAttachedConfigModel().getID()}]:e.isConfigured()&&e.getAttachedConfigModels()&&e.getAttachedConfigModels().length>0?e.getAttachedConfigModels().map(function(e){return e.getID()}):null},refreshView:function(e){e.created||e.deleted||e.modified},_updateSrcArrayWithProductNodes:function(e,t){if(!t.isDocument())if(this._app.core.Factories.ListItemFactory.isInstanceOfListNodeModel(t))e.push(t);else{var n=t.getUsages?t.getUsages():null;n&&Array.isArray(n)&&(e=e.concat(n))}},getChildren:function(e){var t=this,n=[];if(this.getActiveEngItem()&&void 0!==e&&this.getActiveEngItem().getID()===e.getID()){var i=this.getActiveEngItem().getContentModels(),r=i?i.getChildrenWithoutGroupingNodes():null;Array.isArray(r)&&r.forEach(function(e){t._updateSrcArrayWithProductNodes(n,e)})}else if(void 0!==e){var o=e.getChildren();Array.isArray(o)&&o.forEach(function(e){t._updateSrcArrayWithProductNodes(n,e)})}return n},getOrdering:function(){return{}},insertNodes:function(e){if(e.created){var t=a.attributesParser(e.created[0].attributes);this._app.mediator.publish(r.EVENT_NEW_ENG_ITEM_CREATED,t)}else if(e.inserted){if(!Array.isArray(e.inserted))return void console.warn("invalid input ");let t=[];e.inserted.forEach(e=>{let n=e.parent_id;e.children&&Array.isArray(e.children)&&e.children.forEach(e=>{let i=e.attributes.find(e=>"physicalid"===e.name).value,r=e.relationid;t.push({instance:r,child:i,parent:n})})}),this._postProcessEvent&&""!==this._postProcessEvent?this._app.mediator.publish(this._postProcessEvent,t):this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,t)}else if(e.paste&&Array.isArray(e.paste)){let t=e.paste.map(e=>({child:e.resourceid,instance:e.relationid,parent:e.hasParent}));this._app.mediator.publish(r.EVENT_INSTANCES_CREATED,t)}},setCurrentRunningCmd:function(e){this._currentRunningCmd=e},getCurrentRunningCmd:function(e){if(this._currentRunningCmd)return this._currentRunningCmd},isRunningCmd:function(e){return this._currentRunningCmd===e},author:function(e){return this._app.core.sessionManager.setAuthoringMode("authoring"),!0},getSelectedNodes:function(){return this._selectedItems&&0===this._selectedItems.length&&null!=this.getActiveEngItem()?[this.getActiveEngItem()]:this._selectedItems},getSelectedRealNodes:function(){let e=[];return e=this.getActiveEngItem()&&this.getActiveEngItem().getContentModels()?this.getActiveEngItem().getContentModels().getSelectedNodes().filter(function(e){return!(e instanceof s)}):this.getXENTreeDocument().getSelectedNodes()},resetSelection:function(){this._selectedItems=[]},addSelection:function(t,n){this._selectedItems=[];var i=this;e.is(t,"array")?t.forEach(function(e){i._selectedItems.push(e)}):this._selectedItems.push(t)},setViewContext:function(e,t){"string"==typeof e&&""!=e&&(this._viewContext.viewName=e),this._viewContext.options=t},getViewContext:function(){return this._viewContext},modalChooser:function(e){var t=!0===this.isRunningCmd(r.ADD_EXISTING_DRAWING)?"Drawing":"VPMReference";this._app.core.dataService.searchManager.launchASearch({title:"VPMReference"===t?this._app.core.i18nManager.get("eng.searchResult.InsertEngItem"):this._app.core.i18nManager.get("eng.searchResult.InsertDrawing"),allowedTypes:[t],role:"",criteria:"",in_apps_callback:e.in_apps_callback})},beginBlockingTransaction:function(e){n.mask(document.body,e)},isThereARootSelected:function(){for(var e=this.getSelectedNodes(),t=0;t<e.length;t++)if(e[t]===this.getActiveEngItem())return!0;return!1},isRoot:function(e){return e===this.getActiveEngItem()},getInstance:function(e){return e.getID()},getRelationID:function(e){return"function"==typeof e.getRelationID?e.getRelationID():""},getReference:function(e){return e.getID()},getParent:function(e){let t=e.getParent();return t&&"function"==typeof t.getType&&""!==t.getType()?t:this.getRoot(e)},getRoot:function(e){return this.getActiveEngItem()},getRoots:function(){return[this.getActiveEngItem()]},getType:function(e){return e.getType()},getName:function(e){return e?e.getLabel():null},getInstanceName:function(e){if(e){let t=e.getInstanceName();return t||e.getLabel()}return null},canInstantiate:function(e,t,n){let r=this._app.core.contextManager.getSelectedNodes();for(let e in r){let s=r[e].getOccurrencePath();for(var o=0;o<t.length;o++)if(s.some(e=>t.includes(e)))return n&&""!=n&&i.errorAlert(u.replace(u.get("error.operation.failed"),{operation:"Insert existing ",error:n})),!1}return!0},refresh:function(e){if(e)if("replace"===e.action){var t=Array.isArray(e.operations)?e.operations:[],n=[];t.forEach(function(e){var t={parentId:e.parent,replacedId:e.old,new:e.new};n.push(t)}),this._app.mediator.publish(r.EVENT_REPLACED_ENG_ITEM,n)}else if("unparent"===e.action){n={instances:e.instances};this._app.mediator.publish(r.EVENT_REMOVED_INSTANCES,n)}else if("insert"===e.action){let t=this,n=[];for(let t=0;t<e.instances.length;t++){let i=e.instances[t],r=e.references[t],o=e.parent;n.push({instance:i,child:r,parent:o})}t._app.mediator.publish(r.EVENT_INSTANCES_CREATED,n)}else if("updateRevision"===e.action){(t=Array.isArray(e.operations)?e.operations:[]).forEach(e=>{if(e.existing){let t=this.getNodesById(e.existing);this._app.mediator.publish(r.EVENT_MODIFIED_NODES,t)}})}else if(e.action===r.EDIT_DOCUMENT||e.action===r.UPDATE_DOCUMENT||e.action===r.UNDO_EDIT_DOCUEMNT){let t=(Array.isArray(e.data)?e.data:[]).map(e=>e.id);this._app.mediator.publish(r.EVENT_REFRESH_ITEMS_BY_IDS,t)}else e.action!==r.REPLACE_BY_LATEST_REVISION_DOCUEMNT&&e.action!==r.REPLACE_BY_REVISION_DOCUEMNT||this._app.mediator.publish(r.EVENT_REPLACED_DOCUMENT,{oldDocumentId:this.getSelectedNodes()&&this.getSelectedNodes()[0].getRelationID(),replacedDocumentId:e.targetDocumentId})},addRoot:function(e,t,n){},getSetting:function(e){var t=null;switch(e){case"tenant":t=this._app.core.settingManager.getPlatformId();break;case"lang":t=this._app.core.settingManager.getLanguage();break;case"securityContext":t=this._app.core.settingManager.getSecurityContext()}return t},endBlockingTransaction:function(){n.unmask(document.body)},displayNotification:function(e){"error"===e.eventID?i.errorAlert(u.replace(u.get("error.operation.failed"),{operation:"Replace by latest revision",error:e.msg||e})):"warning"===e.eventID?i.warningAlert(u.replace(u.get("error.operation.failed"),{operation:"Replace by latest revision",error:e.msg||e})):i.sucessAlert(u.replace(u.get("error.operation.failed"),{operation:"Replace by latest revision",error:e.msg||e}))},getSelectedRoots:function(){return[this.getActiveEngItem()]},getCustomAttribute:function(e){var t=this._app.core.dicoService.getParametricalAttributesOf("VPMReference").find(function(t){return e===t.sixWTag});return t&&t.authorizedValues.length>0?t:null},setMultiselMenu:function(e){this._multiselMenu=e},isMultiselMenu:function(){return this._multiselMenu},setDoubleClickEvent:function(){this._isDoubleClickEvent=!0},isDoubleClickEvent:function(){return this._isDoubleClickEvent},clearDoubleClickEvent:function(){this._isDoubleClickEvent=!1},getParentWithChild:function(e){if(null!=e&&e.length){for(var t=[],n=e.length,i=0;i<n;i++)for(var r=e[i],o=0;o<n;o++)if(i!==o)for(var s=e[o],a=s.getParent();a;)a===r&&t.push({parent:r,child:s}),a=a.getParent();return t}},areEngItemGridValuesEqual:function(e,t){if(e.options&&t.options){let n=this._app.core.columnsManager.getDatagridViewColumns().map(function(e){return"tree"===e.dataIndex?"ds6w:label":e.dataIndex});return o.areObjectsGivenPropertyValuesEqual(e.options.grid,t.options.grid,n)}return!1},isPartiallyExpanded:function(e,t){t&&t(!1)},isActiveEngItemSelected:function(){let e=this.getXENTreeDocument().getSelectedNodes(),t=this.getActiveEngItem();return!(e.length>0&&e[0].getID()!==t.getID())},isPreExpandEvent:function(){return this.onPreExpantEvent},setPreExpandEvent:function(e){this.onPreExpantEvent=e},hasFilter:function(e){let t=this.getXENTreeDocument?this.getXENTreeDocument()._FilterBI:null;return t&&t.hasFilter?t.hasFilter(e):void 0},GetFilterSpec:function(e,t){let n=this.getXENTreeDocument?this.getXENTreeDocument()._FilterBI:null;return n&&n.GetFilterSpec?n.GetFilterSpec(e,t):void 0},RetrievePrdFromFilterId:function(e){let t=this.getXENTreeDocument?this.getXENTreeDocument()._FilterBI:null;return t&&t.RetrievePrdFromFilterId?t.RetrievePrdFromFilterId(e):void 0},isIndexMode:function(){return"index"===this._app.core.sessionManager.determineAuthoringMode()},getDataForEffectivityCommands:function(){var e={selectedNodes:[]},t=this.getSelectedNodes();e.padNodes=t;var n,i=t.length;for(n=0;n<i;n++)if(this._app.core.contextManager.getActiveEngItem().getID()!==t[n].getID()&&t[n].getRelationID&&t[n].getRelationID()){var r={id:t[n].getRelationID(),alias:t[n].getLabel(),isRoot:!1,VPMRef:t[n].options.type,parentID:t[n].getTreeDocument().getEngineeringItem().getID(),parentalias:t[n].getTreeDocument().getEngineeringItem().getLabel(),effectivity:t[n].options.grid.Effectivity,variantEffectivity:t[n].options.grid.VariantEffectivity};null!=t[n].options.grid.EvolutionEffectivity?r.evolutionEffectivity=t[n].options.grid.EvolutionEffectivity:(r.currentEvolutionEffectivity=t[n].options.grid.CurrentEvolutionEffectivity,r.projectedEvolutionEffectivity=t[n].options.grid.ProjectedEvolutionEffectivity),e.selectedNodes.push(r)}return e}})}),define("DS/ENOXEngineer/columnsProviders/ConfigurationDataProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/DocumentManagement/DocumentManagement","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s,a){"use strict";return t.singleton({init:function(e){this._parent(e)},isAdditionalColumnsAvailable:function(t){if(!1===e.is(t,"function"))throw new Error("A callback function should be defined");t(!0)},getName:function(){return"Configuration"},getManagedColumnNames:function(){return["Configuration"]},toBeUpdated:function(e){var t=!0;return e&&e.Configuration&&(t=!1),t},getAdditionalColumnsUX:function(e){var t=e.findIndex(function(e){return"Configuration"===e.dataIndex});e.splice(t,t>=0?1:0,{text:o.get("Configuration"),dataIndex:"Configuration",maxWidth:800,minWidth:20,width:200})},updateAttributes:function(t,n){if(!Array.isArray(t.relids)||0===t.relids.length)return n({relids:{}});var i=s.getContext();if(!1===e.is(t,"object"))throw new Error("The object ids to modify must be specify");if(!1===e.is(n,"function"))throw new Error("A callback function should be defined");i._XENContentProxy.core.dataService.getStatticMappingPCInfo(t.relids).then(function(e){var i={};t.relids[0],t.relids.forEach(function(e){i[e=e]={Configuration:" ",ConfigurationID:" ",hasStaticMapping:" "}}),e&&t.relids.forEach(function(t){t&&"true"===e[t].hasStaticMapping&&(e[t].content.results[0].data.some(function(e){"Marketing Name"===e.name&&(i[t].Configuration=e.value[0])}),i[t].ConfigurationID=e[t].content.results[0].physicalID,i[t].hasStaticMapping=!0)}),n({relids:i})})}})}),define("DS/ENOXEngineer/commands/EditVariantEffectivityCmd",["DS/CfgEffectivityCommands/commands/CfgVariantEffectivityCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({init:function(e){var t=e||{};t.postOKHandler=this.updateSelectedNodesEffectivities.bind(this),this._parent(t,{mode:"exclusive",isAsynchronous:!0})},updateSelectedNodesEffectivities:function(e){t.updateInstancesEffectivities(e)},getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/XEngineerCutCopyPaste",["UWA/Class","DS/ApplicationFrame/Command","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/services/XEngContextManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a){"use strict";return t.extend({init:function(e){this._parent(e),console.info("#XEngineerCutCopyPaste: initialized...")},execute:function(e){"UPSAuthCut"===this.options.ID?this.cutEngItem(this.options.context):"UPSAuthCopy"===this.options.ID?this.copyEngItem(this.options.context):"UPSAuthPaste"===this.options.ID&&this.pasteEngItems(this.options.context),console.info("#XEngineerCutCopyPaste: "+this.options.ID+" execute called")},cutEngItem:function(e){this._setItemsInClipboard(e,["CX"])},copyEngItem:function(e){this._setItemsInClipboard(e,["CP"])},pasteEngItems:function(e){var t=o.getItem("clipboard");if(t&&0!=t.length){for(var l=t.startsWith("CX")?"CutPaste":"CopyPaste",c=[],d=[],u=(t=t.substring(3)).split(","),p=0;p<u.length;p++)d.push(u[p].split("|"));for(var g=0;g<d.length;g++){var h=d[g];c.push(h)}var m=c.map(function(e){return Array.isArray(e)&&e.length>2?e[1]:null}).filter(function(e){return null!==e});if(""==d[0])return o.removeItem("clipboard"),void n.errorAlert(a.get("clipboard_empty"));var f=this.options.context.getActiveEngItem().getContentModels().getSelectedNodes(),E=[];Array.isArray(f)&&f.length>=1&&f[0].getID()!==e.getActiveEngItem().getID()?f.forEach(function(e){E.push(e.getOccurrencePath()),f.push(e)}):E.push([e.getActiveEngItem().getID()]);var C={children:c,parents:E,mode:l,commit:!0},_=this;require(["DS/UPSCommands/commands/UPSAuthCmdCutCopyPaste"],function(t){new t({context:s.getContext(),ID:"InsertExisting"}).execute({mode:l,internal_call:!0,data:C,onSuccess:function(t){if("CutPaste"===l&&(r.publish(i.EVENT_REMOVE_CUT_INSTANCES,m),o.removeItem("clipboard")),Array.isArray(t)){let n=_.options.context.getSelectedNodes();Array.isArray(n)&&n.length>=1&&n.forEach(function(e){e.expand()}),e.insertNodes({paste:t})}},onFailure:function(e){console.warn("Error trace:"+e.messages.toString()),n.errorAlert(a.get("paste_error"))}})})}else n.errorAlert(a.get("clipboard_empty"))},_setItemsInClipboard:function(e,t){var o=e.getSelectedNodes(),s=e.getActiveEngItem().getID();if(Array.isArray(o)){for(var l=0,c=0;c<o.length;c++)o[c].getType(),t.push(s+"|"+o[c].getRelationID()+"|"+o[c].getID());l>0&&n.errorAlert(a.get("eng.operation.ccp.unSupportedOperation"))}else t.push(o.getParent().getID()+"|"+o.getRelationID()+"|"+o.getID());r.publish(i.ADD_TO_CLIPBOARD,t.toString())}})}),define("DS/ENOXEngineer/commands/ENOXCfgEvolutionCmd",["DS/CfgEffectivityCommands/commands/CfgEvolutionCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({init:function(e){var t=e||{};t.postCloseHandler=this.updateSelectedNodesEffectivities.bind(this),this._parent(t,{mode:"exclusive",isAsynchronous:!0})},updateSelectedNodesEffectivities:function(e){t.updateInstancesEffectivities(e)},getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/PasteVariantEffectivityCmd",["DS/CfgEffectivityCommands/commands/CfgPasteEffectivityCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/XenNextGenFilterCmd",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var n=this;this.name=name,this.appCore=e.appCore,null===e.context?this.context=t.getContext():this.context=e.context,this._parent(e),n.context.getXENTreeDocument().getModelEvents().subscribe({event:"empty"},function(e){var t=n.appCore.contextManager.getActiveEngItem();UWA.is(n.removeFilter,"function")&&t&&UWA.is(t.getID,"function")&&n.context.getXENTreeDocument().getXENBIFilterProxy()&&n.context.getXENTreeDocument().getXENBIFilterProxy().resetNGFilterUI({widgetId:n.appCore.settingManager.getWidgetId(),rootIds:[t.getID()]})})},getWidgetId:function(){return this.options.appCore.settingManager.getWidgetId()},getAppParams:function(){return{widgetId:this.getWidgetId(),shareFilterSpec:!0,appId:this.getWidgetId()}},getSelectorManager:function(){return this.context.getXENTreeDocument().getCurrentTreeDocument().getXSO()||null},getRoots:function(){var e=[];return this.appCore.contextManager.getActiveEngItem()&&(e=[this.appCore.contextManager.getActiveEngItem()]),e.map(function(e){return{id:e.getID(),filtered:0,Label:e.getLabel()}})},getSelection:function(){var e={path:[],label:[]},t=[];if(this.appCore.contextManager.getSelectedNodes()&&(t=this.appCore.contextManager.getSelectedNodes()),t.forEach(function(t){e.path.push([t.getID()]),e.label.push([t.getLabel()])}),this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()){var n=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();n.length>=1&&n[0].getID()!==t[0].getID()&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes().forEach(function(t){e.path.push(t.getOccurrencePath()),e.label.push([t.getLabel()])})}return e}})}),define("DS/ENOXEngineer/commands/AttachMultipleModels",["DS/CfgConfigurationCommands/commands/CfgEditConfigurationContextCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({init:function(e){var t=e||{};this._parent(t,{mode:"exclusive",isAsynchronous:!0})},getData:function(){var e,n={selectedNodes:[]},i=t.getSelectedNodes(),r=i.length;for(e=0;e<r;e++){var o={id:i[e].getID(),alias:i[e].getLabel()};n.selectedNodes.push(o)}return n}})}),define("DS/ENOXEngineer/commands/ExtendEvolutionEffectivityCmd",["DS/CfgEffectivityCommands/commands/CfgExtendEvolutionEffectivityCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/CopyVariantEffectivityCmd",["DS/CfgEffectivityCommands/commands/CfgCopyEffectivityCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/PasteEvolutionEffectivityCmd",["DS/CfgEffectivityCommands/commands/CfgPasteEvolutionEffectivityCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/CopyEvolutionEffectivityCmd",["DS/CfgEffectivityCommands/commands/CfgCopyEvolutionEffectivityCmd","DS/ENOXEngineer/services/XEngContextManager"],function(e,t){"use strict";return e.extend({getData:function(){return this.end(),t.getDataForEffectivityCommands()}})}),define("DS/ENOXEngineer/commands/XEngineerCommandBase",["DS/ApplicationFrame/Command","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n){"use strict";return e.extend({init:function(e,i){this.name=i,this.appCore=e.appCore,this.alertManager=n,null===(e=e||{ID:"NO_ID"}).context?this.context=t.getContext():this.context=e.context,this._parent(e,{mode:"exclusive",isAsynchronous:!UWA.is(e.isAsynchronous)||e.isAsynchronous})},endExecute:function(){console.error("end of command execution")},execute:function(e){}})}),define("DS/ENOXEngineer/commands/SetProdConfCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/ENOXEngineer/componentsHelpers/XEngAutoComplete/XEngAutoComplete","DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","UWA/Class/Promise","DS/UIKIT/Spinner","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";return e.extend({init:function(e){this._parent(e),this.search=new t({multiSel:!1})},_buildModal:function(){return this.modal=new r({title:this.options.appCore.i18nManager.get("eng.ui.dialog.selectProdConf"),className:"xeng-auto-complete",withFooter:!0}),this.modal},_configModelMapper:function(e){return{label:e["ds6w:label"],value:e.physicalid||e.resourceid,icon:Array.isArray(e.icons)?e.icons[0]:e.type_icon_url}},_updateConfigurationContext:function(){var e=this,t=e.autocomplete.selectedItems,n=t[0]?t[0].value:null,i=e.context.getActiveEngItem().getPreferedAttachedConfigModel()&&e.context.getActiveEngItem().getPreferedAttachedConfigModel()?e.context.getActiveEngItem().getPreferedAttachedConfigModel():null;if(n===(i.getPreferredConfiguration()?i.getPreferredConfiguration().id:null))return e.destroyView(),null;i&&i.setPreferredConfiguration(n||"N/A").then(function(){e.options.appCore.mediator.publish(u.EVENT_CONF_MODEL_UPDATED,e.context.getActiveEngItem().getID()),e.alertManager.sucessAlert(p.get("eng.operation.prodConfUpdated.sucess")),e.destroyView()}).catch(function(t){console.error(t),e.alertManager.errorAlert(p.replace(p.get("error.operation.failed"),{operation:e.options.appCore.i18nManager.get("eng.operation.editConfCxt"),error:JSON.stringify(t)})),e.destroyView()})},destroyView:function(){this.autocomplete&&this.autocomplete.destroy(),this.autocomplete=void 0,this.modal.destroy(),this.modal=void 0},buildView:function(){var e=this;this._getConfView().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){e._updateConfigurationContext(t),e.end()},this),this.modal.onClose(function(){e.destroyView(),e.end()},this)},_getConfView:function(){return this.autocomplete=new o({placeholder:this.options.appCore.i18nManager.get("eng.ui.autocomplete.conf.placeholder"),multiSelect:!1,datasetName:"xeng_prodConf",precondition:this.getPrecondition()?this.getPrecondition():null,targetTypes:["Product Configuration"],appCore:this.options.appCore,objectMapper:this._configModelMapper.bind(this)}),this.autocomplete.onSearchClick=this.launchASearch.bind(this),this.autocomplete},execute:function(e){this.modal||this.buildView();var t=this.context.getActiveEngItem().getPreferedAttachedConfigModel()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null,n=t.getPreferredConfiguration()?t.getPreferredConfiguration():null;if(n){var i={label:n.marketingName?n.marketingName:n.name,value:n.id,icon:[]};this.autocomplete.setSelection([i])}this.modal.show()},getPrecondition:function(){var e=this.context.getActiveEngItem()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null;if(!e)return null;e.getID();return' [BASED_ON_MODEL_VERSION_PID]:"'+e.getCurrentVersionID()+'" '},launchASearch:function(e){var t=e,n=this.getPrecondition();""===e.trim()&&(t=null),this.options.appCore.dataService.searchManager.launchASearch({title:this.options.appCore.i18nManager.get("eng.searchResult.ConfigurationFilter"),allowedTypes:["Product Configuration"],role:"",criteria:t,precondition:n,multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)})},onSelectedFromSearch:function(e){if(!this.context.getActiveEngItem())throw this.alertManager.errorAlert(this.options.appCore.i18nManager.get("error.noActiveEngineeringItem")),new Error("this command should be launch in context of active engineering Item");var t=this._configModelMapper(e[0]);this.autocomplete.setSelection([t])}})}),define("DS/ENOXEngineer/commands/OpenProduct",["DS/ENOXEngineer/commands/XEngineerCommandBase","UWA/Utils/InterCom","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e),console.log("#OpenEngItemCmd: init called")},execute:function(e){var r=this;console.log("#OpenEngItemCmd: execute called");var o=r.context.getSelectedNodes(),s=null;if(o.length>=1){var a=(s=o[0]).getID(),l=s.getType(),c=s.getDisplayName(),d=[];d.push({envId:r.appCore.settingManager.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:r.appCore.settingManager.getSecurityContext(),objectId:a,objectType:l,displayName:c});var u={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,data:{items:d}},p={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,appId:"ENXENG_AP",data:{items:d}},g=new t.Socket("compassPageSocket");g.subscribeServer("com.ds.compass",window.parent),g.dispatchEvent("onSetX3DContent",u,"compassPageSocket");g.addListener("launchApp",function(e){var t=s.getUuid(),o=i.createEvent(t,e);r.appCore.mediator.publishPlatformEvent(n.CROSS_APP_SELECTION_EVENT,o),console.log("Response = "+JSON.stringify(e))}),g.dispatchEvent("onLaunchApp",p,"compassPageSocket")}r.end()}})}),define("DS/ENOXEngineer/commands/DetachDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var t=this.appCore.contextManager.getSelectedNodes();this.appCore.mediator.publish(i.EVENT_REMOVE_DOCUMENT,{nodes:t})}})}),define("DS/ENOXEngineer/commands/AddNewSubTypeDocumentCmd",["UWA/Core","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/UIKIT/Input/Button","DS/Windows/ImmersiveFrame","DS/ENOXEngineerInfra/Mediator","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices"],function(e,t,n,i,r,o,s,a,l){"use strict";return a.extend({execute:async function(){if(!this.appCore.PreferencesManager.isSpecInProductStructureEnabled())return void t.errorAlert(this.appCore.i18nManager.get("error.contact.admin"));let e=null;try{e=await l.loadRuntimeLibrary("DS/DocumentCreateNew/CreateNew")}catch(e){return void t.errorAlert(this.appCore.i18nManager.get("error.contact.admin"))}var n=this,i=o.getSelectedNodes()[0];new e({tenantUrl:this.appCore.settingManager.getDefault3DSpaceUrl(),securityContext:this.appCore.settingManager.getSecurityContext(),tenant:this.appCore.settingManager.getPlatformId(),immersiveFrame:this.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),parentId:i.getID(),parentRelName:s.SPECIFICATION_DOCUMENT,getWorkUnderHeaders:function(){return n.appCore&&n.appCore.settingManager&&n.appCore.settingManager.getWorkUnderHeaders&&n.appCore.settingManager.getWorkUnderHeaders()},onUploadStart:function(e){},onCancel:function(){console.log("onCancel fired before upload starts")},onError:function(e){console.error(e),t.errorAlert(e.message)},onDocumentUpload:function(e){this.appCore.dataService.createDocumentOnSelectedType(e)}.bind(this)}).selectFilesAndCreate(),r.prototype.publish(s.EVENT_CLOSE_RUNNING_CMD)}})}),define("DS/ENOXEngineer/commands/EditConfigurationContextCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/ENOXEngineer/componentsHelpers/XEngAutoComplete/XEngAutoComplete","DS/ENOXEngineer/componentsHelpers/ModelChooser/XEngModelChooser","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/UIKIT/Spinner","DS/ENOXEngineer/utils/ResponseParser","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return e.extend({init:function(e){this._parent(e),this.search=new t({multiSel:!1})},_buildModal:function(){return this.modal=new n({title:this.options.appCore.i18nManager.get("eng.ui.dialog.attachModel"),className:"xeng-auto-complete",withFooter:!0}),this.modal},_configModelVersionMapper:function(e){return{label:e["ds6w:label"]+" "+e["ds6wg:revision"],id:e.physicalid||e.resourceid,value:e.physicalid||e.resourceid,revision:e["ds6wg:revision"],name:e["ds6w:identifier"],attributes:{MarketingName:e["ds6w:label"]+" "+e["ds6wg:revision"]},icon:Array.isArray(e.icons)?e.icons[0]:e.type_icon_url}},_configModelMapper:function(e){return{label:e["ds6w:label"]+" "+e["ds6wg:revision"],value:e.physicalid||e.resourceid,icon:Array.isArray(e.icons)?e.icons[0]:e.type_icon_url}},_updateConfigurationContext:function(){var e=document.body.querySelector('button[name="okButton"]');this.spinner=(new a).inject(e).show(),e.disabled=!0;var t=this,n=t.autocomplete.selectedItems,i=n[0]?n[0].value:null;let r=t.context.getActiveEngItem();t.options.appCore.dataService.getModelItemFromAVersion(i).then(function(n){var o=null;n&&n.member&&n.member.length>0&&(o=n.member[0].modelID);var a={activeEngItem:t.context.getActiveEngItem(),selectedModel:o,selectedModelVersion:i};t.options.appCore.dataService.updateEngineeringItemConfigContext(a).then(function(n){var o={id:i};i||(o=null),i&&r.getAttachedConfigModels().forEach(function(e){var t=[];t.push(e.getAllModelVersions()),t[0].forEach(function(t){t.options.physicalid===i&&r.attachPreferedConfigModel(e)})}),e.disabled=!1,r._syncWithAttachedModelAndVersion(o).finally(function(){t.options.appCore.mediator.publish(s.EVENT_CONF_MODEL_UPDATED,r.getID())}),t.spinner.destroy(),t.destroyView()}).catch(function(e){t._cancelWithError(e)})}).catch(function(e){t._cancelWithError(e)})},_cancelWithError:function(e){document.body.querySelector('button[name="okButton"]').disabled=!1,console.error(e),this.spinner&&this.spinner.destroy(),this.alertManager.errorAlert(c.replace(c.get("error.operation.failed"),{error:e,operation:this.options.appCore.i18nManager.get("eng.operation.editConfCxt")})),this.destroyView()},destroyView:function(){this.autocomplete&&this.autocomplete.destroy(),this.autocomplete=void 0,this.modal.destroy(),this.modal=void 0},buildView:function(){var e=this;this._editionView().inject(this._buildModal().getBody()),this.modal.onValidate(function(t){e._updateConfigurationContext(t),e.end()},this),this.modal.onClose(function(){e.end()},this)},_editionView:function(){var e=this._getPrecondition();return this.autocomplete=new i({placeholder:this.options.appCore.i18nManager.get("eng.ui.autocomplete.placeholder"),multiSelect:!1,datasetName:"xeng_model",targetTypes:["Products"],appCore:this.options.appCore,precondition:e,objectMapper:this._configModelMapper.bind(this)}),this.autocomplete.onSearchClick=this.launchASearch.bind(this),this.autocomplete},_getPrecondition:function(){var e="",t=this.context.getActiveEngItem();if(!t)return"";var n=t.getAttachedConfigModels(),i=[];n.forEach(function(e){l.getListOfVersionsFromRoot(e.getModelVersion(),i)});var r=0;return i.length>0&&(i.forEach(function(t){e=0===r?'(physicalid:"'+t.physicalid+'"':e+' OR physicalid:"'+t.physicalid+'"',r++}),e+=")"),e},_setCommandMode:function(){var e=this.context.getActiveEngItem();e.isConfigured()&&e.getAttachedConfigModels().length>1?this.editMode=!1:this.editMode=!0},buildEditionView:function(){this.modal||this.buildView();var e=this.context.getActiveEngItem()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null,t=e?e.getPreferredVersion():null;if(e&&t&&t.id){var n={label:e.getCurrentVersionDisplayMarketingName(),value:t.id,icon:e.getIcon()};this.autocomplete.setSelection([n])}else this.autocomplete.reset();this.modal.show()},buildSelectionView:function(){var e=this.context.getActiveEngItem()&&this.context.getActiveEngItem().getPreferedAttachedConfigModel()?this.context.getActiveEngItem().getPreferedAttachedConfigModel():null,t=void 0;e&&(t=e.getPreferredVersion()?e.getPreferredVersion().id:void 0);var n={appCore:this.options.appCore,preferred:t,modelsPromises:this.context.getActiveEngItem().getAllAvailableVersionsPromises(),resolve:this._onModelChoosen.bind(this),reject:this._onModelUnChoosen.bind(this)};this.modelChooser=new r(n)},_onModelChoosen:function(e){var t=this;t.end();var n=this.context.getActiveEngItem();n.setPreferredModelById(e.options.modelId),n.getPreferedAttachedConfigModel()&&n.getPreferedAttachedConfigModel()._synchronizeModelVersions({id:e.options.physicalid}).finally(function(){t.options.appCore.mediator.publish(s.EVENT_CONF_MODEL_UPDATED,t.context.getActiveEngItem().getID())})},_onModelUnChoosen:function(e){this.end()},execute:function(e){var t=this;t.setModelsandModelVersions().then(function(){var e;if(t.context.getActiveEngItem().getAttachedConfigModels().forEach(function(t){e||(e=!(t&&t.getAllModelVersions&&t.getAllModelVersions()&&0===t.getAllModelVersions().length))}),0===t.context.getActiveEngItem().getAttachedConfigModels().length)t.alertManager.errorAlert(t.options.appCore.i18nManager.get("no_model_attached")),t.end();else{if(!t.context.getActiveEngItem().getAttachedConfigModels()||e)return t.buildEditionView();t.alertManager.errorAlert(t.options.appCore.i18nManager.get("error.noVersion.relatedToModel")),t.end()}})},setModelsandModelVersions:function(){var e=this.context.getActiveEngItem(),t={pid:e.getID()},n=this;return o.wrappedWithPromise(function(i,r){n.options.appCore.dataService.getEngItemConfigurationInfo(t).then(function(t){e.attachConfigModels(t);var r=[];0!==t.length?t.length>0&&(t.forEach(function(e){r.push(e.loadVersions(e).then(function(t){var i=n.options.appCore.Factories.configItemsFactory.createModelVersionsFromRootVersion(t,e.getID());e.setAllModelVersions(i),l.getListOfVersionsFromRoot(t,modelRevisions)}))}),o.allSettled(r).then(function(){i()})):i()}).catch(function(e){n.alertManager.errorAlert(e.response.errorMessage),r(e),n.end()})})},launchASearch:function(e){var t=e;""===e.trim()&&(t=null);var n=this._getPrecondition();this.options.appCore.dataService.searchManager.launchASearch({title:this.options.appCore.i18nManager.get("eng.searchResult.configurationContext"),allowedTypes:["Products"],role:"",criteria:t,precondition:n,multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)})},onSelectedFromSearch:function(e){var t=this.context.getActiveEngItem();if(!t)throw this.alertManager.errorAlert(this.options.appCore.i18nManager.get("error.noActiveEngineeringItem")),new Error("this command should be launch in context of active engineering Item");t.getAttachedConfigModels().forEach(function(n){var i=[];i.push(n.getAllModelVersions()),i[0].forEach(function(i){i.options.physicalid===e[0].id&&(n.setPreferredVersion(e[0].id),t.attachPreferedConfigModel(n))})});var n=this._configModelVersionMapper(e[0]);n.label=this.unescapeString(n.label),this.autocomplete.setSelection([n])},unescapeString:function(e){if("string"==typeof e||e instanceof String){const t=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#x27;"]]);for(const[n,i]of t)e=e.replace(new RegExp(i,"g"),n)}return e}})}),define("DS/ENOXEngineer/commands/OpenEngineeringItemCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var n,i=this.appCore.sessionManager.consummeAvailableOpencontext();(n=i)&&(n.searchForOpen||n.objectId&&n.objectType)?i.searchForOpen?this.appCore.dataService.searchManager.launchASearch({title:this.appCore.i18nManager.get("eng.searchResult.OpenEngItem"),allowedTypes:["VPMReference","ENOStrRefinementSpecification"],role:"",criteria:"",multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)}):i.objectId&&i.objectType&&this.launchOpenItem(i):t.errorAlert(this.appCore.i18nManager.get("error.invalid.input.forOpen"))},onSelectedFromSearch:function(e){this.launchOpenItem({objectId:e[0].id,objectType:e[0]["ds6w:type_value"]})},launchOpenItem:function(e){if(e){var t=this;switch(e.objectType){case"ENOStrRefinementSpecification":this.openAdvancedFilter(e);break;default:if(e.itemListModel&&e.itemListModel.hasStaticMapping())e.path=[this.appCore.contextManager.getActiveEngItem().getID(),e.itemListModel.getRelationID(),e.objectId],this.appCore.dataService.getModelVersionInformationFromPCID([e.itemListModel.getConfigurationID()]).then(function(n){console.warn(n),n=t._getStaticMappingInfo(n),e.pcInfo=n,t.genericOpen(e)});else if(e.biProxyCtx){var n=this._getBIFilterProxy();n||t.genericOpen(e),n&&n.areRootsSharable([e.objectId],e.biProxyCtx).then(n=>{n&&Array.isArray(n)&&0!==n.length||t.genericOpen(e);const{rootId:i,hasFilter:r}=n[0];i===e.objectId&&r?t.openWithSharedFilter(e):t.genericOpen(e)}).catch(t=>{this.genericOpen(e)})}else this.genericOpen(e)}}},_getStaticMappingInfo:function(e){return Array.isArray(e)&&!e.length>0?null:{model:e[0].BASED_ON_MODEL_PID,modelVersion:e[0].BASED_ON_MODEL_VERSION_PID,prodConf:e[0].physicalid,confLabel:e[0]["ds6w:label"],type:e[0].type,resourceid:e[0].resourceid,revision:e[0]["ds6wg:revision"]}},_getBIFilterProxy:function(){var e=this.appCore.contextManager.getXENTreeDocument();return e?e.getXENBIFilterProxy():null},_previousFilterCleanup:function(){var e=this,t=this._getBIFilterProxy();return n.wrappedWithCancellablePromise(function(n,i){if(e.appCore.PersistencyManager.resetNGFilter(),e.appCore.sessionManager.isItemView())try{var r=e.context.getActiveEngItem();if(!r||!r.hasValidPersistedNextGenFilter()&&!r.hasValidTransientNextGenFilter())return n(!1);t.resetNGFilterUI({widgetId:e.appCore.settingManager.getWidgetId(),rootIds:e.context.getActiveEngItem()?[e.context.getActiveEngItem().getID()]:[]}),setTimeout(function(){n(!0)},100)}catch(e){console.error(e),i(!1)}else n(!0)})},openAdvancedFilter:function(e){var n=this._getBIFilterProxy(),r=this;n?r._previousFilterCleanup().catch(()=>{}).finally(function(){r.context.beginBlockingTransaction(r.appCore.i18nManager.get("processing.ngFilter")),r.appCore.mediator.publish(i.EVENT_CLEAR_TAGGER),r.wasCallbackCalled=!1,n.retrieveFilters({filterObjects:[{envId:r.appCore.settingManager.getPlatformId(),serviceId:"3DSpace",contextId:r.appCore.settingManager.getSecurityContext(),objectId:e.objectId,objectType:"ENOStrRefinementSpecification"}],droppedEnvId:r.appCore.settingManager.getPlatformId(),doNotFillTheTagger:!1,callback:function(e){if(r.wasCallbackCalled=!0,r.context.endBlockingTransaction(),e&&Array.isArray(e.success)&&e.success.length>0){let t=e.success[0],n={objectId:t.rootId,objectType:"VPMReference"};if(t.filterId){let e={filterId:t.filterId,filterName:t.filterTitle};r.appCore.PersistencyManager.setNGFilter(e)}r.genericOpen(n)}else if(e&&Array.isArray(e.failure)&&e.failure.length>0){const{eventID:n,msg:i}=e.failure[0];let r=i||this.appCore.i18nManager.get("error.dataNotRetrieved");n&&"warning"===n?t.warningAlert(r):t.errorAlert(r)}}}),setTimeout(function(){if(!r.wasCallbackCalled){if(r.wasCallbackCalled=!0,r.context.endBlockingTransaction(),r.appCore.sessionManager.isItemView()){var t=r.context.getActiveEngItem();if(t&&t.getID()===e.objectId)return void r.appCore.mediator.publish(i.EVENT_REFRESH_APP_CONTENT)}r.genericOpen(e)}},1e4)}):console.error("nextNenFilter proxy not found")},openWithSharedFilter:function(e){var t=this._getBIFilterProxy(),n=this;t?n._previousFilterCleanup().finally(function(){n.context.beginBlockingTransaction(n.appCore.i18nManager.get("processing.ngFilter")),n.wasCallbackCalled=!1,t.shareFilterSpec({fromRootId:e.objectId,fromSourceCtx:e.biProxyCtx,callback:function(t){if(n.wasCallbackCalled=!0,n.context.endBlockingTransaction(),t&&Array.isArray(t.success)&&t.success.length>0){let i=t.success[0];if(i.filterId){let e={filterId:i.filterId,filterName:i.filterTitle};n.appCore.PersistencyManager.setNGFilter(e)}n.appCore.sessionManager.setNGFilterContextForNextOpen(i),n.genericOpen(e)}}}),setTimeout(function(){if(!n.wasCallbackCalled){if(n.context.endBlockingTransaction(),n.appCore.sessionManager.isItemView()){var t=n.context.getActiveEngItem();if(t&&t.getID()===e.objectId)return void n.appCore.mediator.publish(i.EVENT_REFRESH_APP_CONTENT)}n.genericOpen(e)}},1e4)}):console.error("nextNenFilter proxy not found")},genericOpen:function(e){var n=this;if(n.appCore.sessionManager.isItemView()){var r=n.context.getActiveEngItem();if(r&&r.getID()===e.objectId)return void n.appCore.mediator.publish(i.EVENT_REFRESH_APP_CONTENT,{filter:e.filter})}n.appCore.mediator.publish(i.EVENT_OPEN_ITEM_WITH_COMPASS,!0),this.appCore.dicoService.areEngeeringItems([e.objectType]).then(function(){e.path&&e.pcInfo?n.navigateToConfiguredEngItemViewer(e):e.filter?n.navigateToFilteredEngItemViewer(e):n.navigateToEngItemViewer(e)}).catch(function(e){t.errorAlert(n.appCore.i18nManager.get("trying.toopen.not.engineering.item"))})},navigateToEngItemViewer:function(e){this.appCore.navigate("engItem_View",{pid:e.objectId},{replace:!1,reload:!0})},navigateToFilteredEngItemViewer:function(e){this.appCore.navigate("engItem_View",{pid:e.objectId,filter:e.filter},{replace:!1,reload:!0})},navigateToConfiguredEngItemViewer:function(e){this.appCore.navigate("engItem_View",{pid:e.objectId,path:e.path,pcInfo:e.pcInfo},{replace:!1,reload:!0})}})}),define("DS/ENOXEngineer/commands/DeleteDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var t=this.appCore.contextManager.getSelectedNodes();this.appCore.mediator.publish(i.EVENT_DELETE_DOCUMENT,{nodes:t})}})}),define("DS/ENOXEngineer/commands/CustomizeHeaderCmd",["UWA/Core","UWA/Class/Model","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i){"use strict";return n.extend({init:function(e){this._parent(e)},execute:function(n){var r=this;require(["DS/ENOXIDCard/IDCardDisplayedAttributes/js/IDCardDisplayedAttributes"],function(e){let n=r.context.getActiveEngItem(),i=r.context._app.core.dicoService.getIdCardPreferences()?r.context._app.core.dicoService.getIdCardPreferences():void 0,o={};const s={id:n.getID(),modelEvents:r.context._app.core.mediator.getApplicationBroker(),fullListAvailableAttributes:r.getDisplayAttributes()};let a=s.fullListAvailableAttributes;if(i){for(let e=0;e<a.length;e++){let t=null;t=i[a[e].id]?{displayWhenMinified:i[a[e].id].displayWhenMinified,defaultVisibility:a[e].defaultVisibility,id:i[a[e].id].id,name:a[e].name,kind:a[e].kind,visibility:a[e].visibility}:a[e],o[a[e].id]={attribute:t,order:i[a[e].id]&&i[a[e].id].order?i[a[e].id].order:null,visibility:!(!i[a[e].id]||!i[a[e].id].visibility)&&i[a[e].id].visibility}}s.savedAttributesList=o}r.myModel=new t(s),r.idCard=new e({model:r.myModel}),r.idCard.render()}),r.context._app.core.mediator.subscribe(i.EVENT_IDCARD_SAVED_ATTRIBUTES,function(t){var n=[],o={};for(var s in t[i.IDCARD_SAVED_ATTRIBUTES])n.push(t[i.IDCARD_SAVED_ATTRIBUTES][s]);n.sort((e,t)=>e.order-t.order);var a=[],l=null;for(var c of n)l=e.clone(c.attribute),c.visibility&&(a.push(l),o[l.id]={displayWhenMinified:l.displayWhenMinified,id:l.id,visibility:l.visibility,order:c.order});r.idCard.modelEvents.publish({event:i.EVENT_IDCARD_CUSTOMIZE_ATTRIBUTES_MODIFICATION,data:{what:"customizeIDCard",customizeHeaderAttributes:o}}),r.context._app.core.mediator.publish(i.EVENT_UPDATE_IDCARD_RENDERING,!0)}),this.end()},getDisplayAttributes(){let e=this.context._app.core.settingManager.getSetting(i.DEFAULT_IDCARD_DISPLAY_ATTRIBUTES),t=this.context._app.core.dicoService.getVisibleAttrForBO(),n=["ds6w:label","ds6wg:revision","ds6w:description"],r=[];for(var o=0;o<t.length;o++)n.includes(t[o].ds6w)||r.push({name:this.context._app.core.i18nManager.get(t[o].ds6w),id:t[o].ds6w,kind:t[o].kind,defaultVisibility:!!e[t[o].ds6w],displayWhenMinified:!!e[t[o].ds6w],visibility:!0});return r}})}),define("DS/ENOXEngineer/commands/RelatedObjectsCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","UWA/Utils/InterCom","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e),console.log("#RelatedObjectsCmd: init called")},execute:function(e){var r=this;console.log("#RelatedObjectsCmd: execute called");var o=r.context.getSelectedNodes(),s=null;if(o.length>=1){var a=(s=o[0]).getID(),l=s.getType(),c=s.getDisplayName(),d=[];d.push({envId:r.appCore.settingManager.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:r.appCore.settingManager.getSecurityContext(),objectId:a,objectType:l,displayName:c});var u={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,data:{items:d}},p={protocol:n.NAME_3DXCONTEXT,version:"1.0",source:n.XENGINEER_APP_NAME,appId:n.ENORIPE_APP_NAME,data:{items:d}},g=new t.Socket("compassPageSocket");g.subscribeServer("com.ds.compass",window.parent),g.dispatchEvent("onSetX3DContent",u,"compassPageSocket");g.addListener("launchApp",function(e){var t=s.getUuid(),o=i.createEvent(t,e);r.appCore.mediator.publishPlatformEvent(n.CROSS_APP_SELECTION_EVENT,o),console.log("Response = "+JSON.stringify(e))}),g.dispatchEvent("onLaunchApp",p,"compassPageSocket")}r.end()}})}),define("DS/ENOXEngineer/commands/AttributesManagementCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOX3DSpaceAttributesMgt/views/AttributesCustomization","DS/ENOX3DSpaceAttributesMgt/views/AttributesContants","DS/Windows/Dialog","DS/Controls/Button","DS/ENOXEngineer/utils/Utils"],(e,t,n,i,r,o)=>{function s(e){if(e){if(!e.elements||!e.elements.container)return void(e=null);const t=e.getContent();if(t){const e=t.querySelector(".wux-windows-window-content.wux-element-contentbox");e&&(e.innerHTML="")}}}return class extends e{constructor(e){super(e),this.dialog=null,this.options.appCore.mediator.subscribe("ENXViews/Views/showInWidgetBody",e=>{if(console.warn(e),e&&e.restore)try{s(this.dialog),this.dialog&&this.dialog.close(),this.dialog=null}catch(e){console.error(e),this.dialog=null}else{try{s(this.dialog),this.dialog&&this.dialog.close(),this.dialog=null}catch(e){console.error(e),this.dialog=null}this.dialog=new i({title:"customize"===e.idView?this.options.appCore.i18nManager.get("label_attributesManagement"):this.options.appCore.i18nManager.get("label_attributesBrowser"),content:e.html,immersiveFrame:this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),resizableFlag:!0}),this.dialog.maximizedFlag=!0,this.dialog.maximizeButtonFlag=!1}})}execute(e){new t({settingManager:this.options.appCore.settingManager,modelEvents:this.options.appCore.mediator.getApplicationBroker(),viewMode:"comfortable",configuration:{providedColumns:[],selectedColumns:[]},toolbarActions:n.TOOLBAR_DEFAULT_ACTIONS,appColumns:this.options.appCore.columnsManager.getAvailableColumnsWithNls(),baseTypes:this.options.appCore.dicoService.getBaseReferenceTypes(),baseExtensions:this.options.appCore.dicoService.getBaseExtensions(),baseInstanceTypes:this.options.appCore.dicoService.getBaseInstanceTypes(),selectedTypes:this.options.appCore.dicoService.getSelectedTypes(),selectedExtensions:this.options.appCore.dicoService.getSelectedExtensions(),withDgv:!1,rowHeaderActivated:!0,predicatesManagedByApplication:this.options.appCore.dicoService.getControlledAppPredicates(),multiValuatedAttributes:this.options.appCore.dicoService.getMultiValuedAtributes()}),this.end()}}}),define("DS/ENOXEngineer/commands/RemoveRecentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){var n=this;this.end();var i=this.appCore.contextManager.getSelectedNodes();if(Array.isArray(i)&&i.length>0){var r=i.map(function(e){return e.getID()});this.appCore.dataService.removeFromRecents(r).then(function(e){n.appCore.mediator.publish(t.EVENT_REMOVED_FROM_RECENT,{nodes:i})})}}})}),define("DS/ENOXEngineer/commands/UpdateWidgetTitleCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase"],e=>{return e.extend({init(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute(){const e=this.context.getActiveEngItem();let t="";e&&UWA.is(e.getLabel,"function")&&(t=e.getLabel()),widget.setTitle(`${t}`)}})}),define("DS/ENOXEngineer/commands/ExportEngineeringItems",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/Handlebars/Handlebars4","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/UIKIT/Input/Text","DS/Controls/LineEditor","DS/Controls/ComboBox","DS/Controls/Toggle","DS/Controls/Button","DS/DataGridView/DataGridView","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/componentsHelpers/xEngExport/js/ExportProgressDialog","DS/ENOXEngineer/utils/XEngineerConstants","text!DS/ENOXEngineer/componentsHelpers/xEngExport/html/ExportEngineeringItems.html","text!DS/ENOXEngineer/componentsHelpers/xEngExport/html/ExportEngineeringSettings.html","text!DS/ENOXEngineer/componentsHelpers/xEngExport/html/ExportEngineeringPreviewFormat.html","css!DS/ENOXEngineer/componentsHelpers/xEngExport/css/ExportEngineeringItems.css","css!DS/ENOXEngineer/componentsHelpers/xEngExport/css/ExportEngineeringSettings.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m,f,E){"use strict";var C,_,y,M="div",N="ul",v="li",I="span",A=3,b=["Quantity","thumbnail","v6_specdoc_to"],S=["ds6wg:MaterialUsageExtension.DeclaredQuantity","thumbnail","v6_specdoc_to"],T=["Variant","Evolution","VariantEffectivity","ProjectedEvolutionEffectivity","Effectivity","CurrentEvolutionEffectivity","thumbnail","v6_specdoc_to"],D=["CoreMaterialName"],w={},O={};function x(){var e={settingsTemplate:!0,components:!0,groupBy:!0,advancedFilter:!0,fileName:!0};this._columnsOrderNlsJson={},this._xenColumnsArray=[],this._userPreferredColumns={},this.modalOptions={title:_.options.appCore.i18nManager.get("eng.export.label"),className:"set-exportCommand-modal",withFooter:!1},this.modal=new n(this.modalOptions),this.modal.injectFooter("<button type='button'  name='exportButton' id='export-button' class='btn btn-primary'>"+_.options.appCore.i18nManager.get("eng.export.button.export")+"</button> <button type='button' name='previewButton' id='preview-format-button' class='btn btn-default'>"+_.options.appCore.i18nManager.get("eng.export.button.previewFormat")+"</button><button type='button' name='cancelButton' id='cancel-button' class='btn btn-default'>"+_.options.appCore.i18nManager.get("eng.ui.button.cancel")+"</button>");var i=t.compile(m);this._options=e?UWA.clone(e,!1):{},this._container=this.modal.getBody(),this._container.innerHTML=i(this._options),this._container=this._container.querySelector(".enox-export"),this._settingsContainer=this._container.querySelector(".enox-export-settings-template-icon"),this._componentsHeader=this._container.querySelector(".enox-export-components-header"),this._directComponent=this._container.querySelector(".enox-export-components-direct"),this._finalItem=this._container.querySelector(".enox-export-components-qualified-as-final"),this._inculdeIntermediate=this._container.querySelector(".enox-export-components-include-intermediate"),this._groupByHeader=this._container.querySelector(".enox-export-groupby-header"),this._groupByCombobox=this._container.querySelector(".enox-export-groupby-combobox"),this._advancedFilterContainer=this._container.querySelector(".enox-export-advanced-apply-filter"),this._fileHeader=this._container.querySelector(".enox-export-file-name-header"),this._fileComponent=this._container.querySelector(".enox-export-file-name-component"),this._fileFormat=this._container.querySelector(".enox-export-file-format"),this.createSettingsIcon(),this.createLevelComponents(),this.createGroupBy(),this.createApplyFilters(),this.createFileName(),this._xenColumnsArray=this.getAvailableXENColumns()}return x.prototype={constructor:x,createSettingsIcon:function(){this._settingsContainer.title=_.options.appCore.i18nManager.get("eng.export.settingsTemplateDialogboxTitle")},createLevelComponents:function(){this._componentsHeader.innerHTML="<b>"+_.options.appCore.i18nManager.get("eng.export.components.label")+"&nbsp;:</b>",this._COMPONENT_DIRECT=new l({type:"radio",label:_.options.appCore.i18nManager.get("eng.export.components.direct"),value:"Direct",checkFlag:!0,domId:"direct-component"}).inject(this._directComponent),this._COMPONENT_FINALITEM=new l({type:"radio",label:_.options.appCore.i18nManager.get("eng.export.components.qualifiedAsFinal"),value:"QualifiedAsFinal",domId:"final-component"}).inject(this._finalItem),this._INCLUDE_INTERMEDIATE=new l({type:"checkbox",label:_.options.appCore.i18nManager.get("eng.export.components.includeIntermmediate"),value:"IncludeIntermediate",disabled:!0,domId:"include-intermediate-component"}).inject(this._inculdeIntermediate),this._COMPONENT_FINALITEM.addEventListener("click",function(){C._COMPONENT_DIRECT.checkFlag=!1,C._INCLUDE_INTERMEDIATE.disabled=!1}),this._COMPONENT_DIRECT.addEventListener("click",function(){C._INCLUDE_INTERMEDIATE.checkFlag=!1,C._INCLUDE_INTERMEDIATE.disabled=!0,C._COMPONENT_FINALITEM.checkFlag=!1})},createGroupBy:function(){this._groupByHeader.innerHTML="<b>"+_.options.appCore.i18nManager.get("eng.export.consolidation.label")+"&nbsp;:</b>";this._GroupByOptionsList=new a({elementsList:y,enableSearchFlag:!1,domId:"groupBy",width:150}),this._GroupByOptionsList.inject(this._groupByCombobox),this._GroupByOptionsList.elements.container.style.width="150px"},createApplyFilters:function(){var e=_.context&&_.context.getActiveEngItemOpenContext()&&_.context.getActiveEngItemOpenContext().filteringContext?_.context.getActiveEngItemOpenContext().filteringContext:"",t=!0,n=!1;""!=e&&"none"!=e&&(t=!1,n=!0),this._persistentFilterCheckbox=new l({type:"checkbox",label:_.options.appCore.i18nManager.get("eng.export.applyFilter.label"),value:e,checkFlag:n,disabled:t,domId:"advanced-filter"}).inject(this._advancedFilterContainer)},createCustomHeaderColumnSelections:function(){var e=this.getLoadedXENAttributes(),t={};this.isUserPreferredColumnsExists()&&(e=this.reArrangeToUserPreferredOrder(this._columnsOrder,e),t=this.getCachedUserPreferredColumns()),this._columnsOrder=[];var n=UWA.createElement(M);n.id="columns_with_list";var i=UWA.createElement(M);i.className="divTagForAllColumns",n.className="columnsHeader";var r=UWA.createElement(M);r.className="listitem_checkbox",n.appendChild(r);var o=UWA.createElement(M);o.className="listitem_header_name",n.appendChild(o);var s=UWA.createElement(M);s.className="listitem_custom_name",n.appendChild(s);var a=UWA.createElement(M);a.className="column_header_drag_drop",n.appendChild(a),this._selectAllCheckbox=new l({type:"checkbox",checkFlag:!0}),this._selectAllCheckbox.inject(r),o.innerHTML="<b>"+_.appCore.i18nManager.get("eng.export.column.header")+"</b>",s.innerHTML="<b>"+_.appCore.i18nManager.get("eng.export.column.customheader")+"</b>",this._exportTableContainer.appendChild(n),this._exportTableContainer.appendChild(i);for(var c={},d=0;d<e.length;d++){var u=UWA.createElement(M);u.className="columns";var p=!0,g="";this.isUserPreferredColumnsExists()&&(p=this.isColumnSelectionExists(e[d].dataIndex),g=t[e[d].dataIndex]);var h=new l({type:"checkbox",checkFlag:p,domId:"domId_"+e[d].dataIndex});c[e[d].dataIndex]=h;var m=UWA.createElement(M);m.className="listitem_checkbox","ds6w:label"==e[d].dataIndex?m.innerHTML='<span class="fonticon fonticon-block" title="'+_.options.appCore.i18nManager.get("eng.import.CkeckboxImageTooltip")+'"></span>':h.inject(m);var f=UWA.createElement(M);f.className="listitem_header_name hover_info",f.setText(e[d].text);var E=UWA.createElement(M);E.className="listitem_custom_name display_text enable_textbox",E.id=e[d].dataIndex+"_displayValue";var C=g||e[d].text;E.setText(C);var y=UWA.createElement(M);y.className="listitem_drag_drop wux-ui-hamburgers",y.id=e[d].dataIndex,y.draggable=!0,u.appendChild(m),u.appendChild(f),u.appendChild(E),u.appendChild(y),i.appendChild(u),this._columnsOrder.push(e[d].dataIndex),this._columnsOrderNlsJson[e[d].dataIndex+"_displayValue"]=e[d].text}this._columnsCheckboxJson=c,this.isUserPreferredColumnsExists()||this.unselectColumnsByDefault(D),this.validateSelectAllCheckBox()},createFileName:function(){this._fileFormat.innerHTML=".csv",this._fileHeader.innerHTML="<b>"+_.options.appCore.i18nManager.get("eng.export.fileName.label")+"&nbsp;:</b>",this._fileName=(new o).inject(this._fileComponent),this._fileName.elements.container.value=_.context.getActiveEngItem()._options.label},getActualAndCustomHeaderForSelectedColumns:function(){var e={},t=this.getCachedUserPreferredColumns();if(this.isUserPreferredColumnsExists()){for(var n=0;n<this._columnsOrder.length;n++)this._columnsCheckboxJson[this._columnsOrder[n]]&&this._columnsCheckboxJson[this._columnsOrder[n]].checkFlag&&(e[this._columnsOrder[n]]=t[this._columnsOrder[n]]);this.excludeNotSupportedColumns(e,this._GroupByOptionsList.value,this.isFlattendView())}else e=this.getDefaultColumns();return e},selectAllColumns:function(){for(var e in this._columnsCheckboxJson)this._columnsCheckboxJson[e].checkFlag=!0},unselectAllColumns:function(){for(var e in this._columnsCheckboxJson)"ds6w:label"!=e&&(this._columnsCheckboxJson[e].checkFlag=!1)},disableExportAndPreviewFormatButtons:function(){document.getElementById("export-button").disabled=!0,document.getElementById("preview-format-button").disabled=!0},enableExportAndPreviewFormatButtons:function(){document.getElementById("export-button").disabled=!1,document.getElementById("preview-format-button").disabled=!1},isAllColumnsSelected:function(){var e=!0;for(var t in this._columnsCheckboxJson)if(!this._columnsCheckboxJson[t].checkFlag){e=!1;break}return e},anyColumnSelected:function(){var e=!1;for(var t in this._columnsCheckboxJson)if(this._columnsCheckboxJson[t].checkFlag&&"ds6w:label"!=t){e=!0;break}return e},validateSelectAllCheckBox:function(){this.isAllColumnsSelected()?this._selectAllCheckbox.checkFlag=!0:this._selectAllCheckbox.checkFlag=!1},validateExportOptions:function(){var e=!0;return this._GroupByOptionsList.value==h.PART_NUMBER&&1==this._INCLUDE_INTERMEDIATE.checkFlag&&(u.errorAlert(_.appCore.i18nManager.get("eng.export.components.groupby.invalidselectionmessage")),e=!1),e},getUserSelectedExportOptions:function(){var e=this._fileName.elements.container.value;w.physicalid=_.context.getSelectedNodes()[0].getID(),w.Components=this._COMPONENT_DIRECT.checkFlag?this._COMPONENT_DIRECT.value:this._COMPONENT_FINALITEM.value,w.IncludeIntermediateComponent=this._INCLUDE_INTERMEDIATE.checkFlag,w.GroupingConsolidatedQuantity=this._GroupByOptionsList.value,w.Authored=!!this._COMPONENT_DIRECT.checkFlag&&_.appCore.sessionManager.isUsingDB(),w.PersistentFilter=this._persistentFilterCheckbox.checkFlag,w.PersistentFilterCriteria=_.context.getActiveEngItemOpenContext()?_.context.getActiveEngItemOpenContext():"",w.appendInstanceColumnKeyword=h.APPEND_INSTANCE_COLUMN_KEYWORD,w.preferredMassUnit=widget&&widget.getValue&&widget.getValue(h.PREFERRED_MASS_UNIT)?widget.getValue(h.PREFERRED_MASS_UNIT):"KILOGRAM",w.preferredMassUnitNLS=_.appCore.exportService.normalizeStringInNFKDFormat(_.appCore.PreferencesManager.getNLSValueForMassQuantity()),w.preferredVolumeUnit=widget&&widget.getValue&&widget.getValue(h.PREFERRED_VOLUME_UNIT)?widget.getValue(h.PREFERRED_VOLUME_UNIT):"METER3",w.preferredVolumeUnitNLS=_.appCore.exportService.normalizeStringInNFKDFormat(_.appCore.PreferencesManager.getNLSValueForVolumeQuantity()),w.ShowNotInBOM=widget&&widget.getValue&&widget.getValue(h.PREFERED_SHOW_NOT_IN_BOM)?widget.getValue(h.PREFERED_SHOW_NOT_IN_BOM)+"":"false",w.ExportFileName=null==e||""==e?_.context.getActiveEngItem()._options.label:this._fileName.elements.container.value;for(var t=this.getActualAndCustomHeaderForSelectedColumns(),n=widget.getPreferences(),i=0;i<n.length;i++)n[i].name==h.FINAL_ITEMS_PREF&&(w.PreferredFinalItem="tree"==widget.getPreferences()[i].value?"ds6w:label":widget.getPreferences()[i].value,w.PreferredFinalItemNLS=widget.getPreferences()[i].value===h.FINAL_ITEMS_DEFAULT?_.options.appCore.i18nManager.get("eng.export.NotSelectedFinalItem"):this.getTerminalItemNLSValue(widget.getPreferences()[i].value)),n[i].name===h.FINAL_ITEM_VALUE_NAME&&(w.PreferredFinalItemValue=widget.getPreferences()[i].value);return w.dimentionAttributeInfo=this.getDimentionalAttributesInfo(_.appCore.xengTreeDoc.getConvertissibleAttributes()),w.SelectedColumns=JSON.stringify(t),w.ParametricAttributes=_.appCore.exportService.getParametricalAttributesForExport("VPMReference"),w.ds6wAttributeMapping=this.actualAttributeNames,w},getDimentionalAttributesInfo:function(e){let t={};return Array.isArray(e)&&e.forEach(function(e){t[e.dataIndex]={dimension:e.attrDim,toUnit:e.attrUnit}}),t},getTerminalItemNLSValue:function(e){return _.appCore.dicoService.getAttributeMetas(e)?_.appCore.dicoService.getAttributeMetas(e).text:e},getPreviewFormatSelectedOptions:function(){O[_.options.appCore.i18nManager.get("eng.export.settingsTemplate.optionsHeader.exportedOnDate")]=p.getformatedDate(new Date),O[_.options.appCore.i18nManager.get("eng.export.components.label")]=this._COMPONENT_DIRECT.checkFlag?this._COMPONENT_DIRECT.label:this._COMPONENT_FINALITEM.label,O[_.options.appCore.i18nManager.get("eng.export.components.includeIntermmediate")]=this._INCLUDE_INTERMEDIATE.checkFlag?_.options.appCore.i18nManager.get("eng.export.true"):_.options.appCore.i18nManager.get("eng.export.false"),O[_.options.appCore.i18nManager.get("final_items_pref")]=this.getTerminalItemNLSValue(widget.getValue(h.FINAL_ITEMS_PREF)),O[_.options.appCore.i18nManager.get("final_item_value")]=widget.getValue(h.FINAL_ITEM_VALUE_NAME),O[_.options.appCore.i18nManager.get("eng.export.consolidation.label")]=this._GroupByOptionsList.label,O[_.options.appCore.i18nManager.get("eng.export.applyFilter.label")]=this._persistentFilterCheckbox.checkFlag?_.options.appCore.i18nManager.get("eng.export.true"):_.options.appCore.i18nManager.get("eng.export.false")},cacheUserPreferredColumns:function(){for(var e=0;e<this._columnsOrder.length;e++)this._columnsCheckboxJson[this._columnsOrder[e]]&&this._columnsCheckboxJson[this._columnsOrder[e]].checkFlag?this._userPreferredColumns[this._columnsOrder[e]]=document.getElementById(this._columnsOrder[e]+"_displayValue").getText():this._userPreferredColumns[this._columnsOrder[e]]&&delete this._userPreferredColumns[this._columnsOrder[e]]},getCachedUserPreferredColumns:function(){return this._userPreferredColumns},getAvailableXENColumns:function(){var e,t,n=JSON.stringify(_.appCore.columnsManager.getDatagridViewColumns()),i=JSON.parse(n);if(!this.isQuantityColumnExists(i)){var r={dataIndex:"quantity",text:`${_.appCore.i18nManager.get("instances")}/${_.appCore.i18nManager.get("occurences")}`};i.length>6?i.splice(6,0,r):i.push(r)}if(i.find(function(n,i){"ds6wg:MaterialUsageExtension.DeclaredQuantity"===n.dataIndex?e=i:"quantity"===n.dataIndex?(n.dataIndex="Quantity",n.text=`${_.appCore.i18nManager.get("instances")}/${_.appCore.i18nManager.get("occurences")}`,t=i):"ds6w:label-Instance"==n.dataIndex?n.dataIndex="InstanceName":"InstanceName"==n.dataIndex?n.text=_.appCore.i18nManager.get("label_Instance_Name"):"tree"==n.dataIndex?n.dataIndex="ds6w:label":n.dataIndex.includes("CoreMaterial")?n.dataIndex="CoreMaterialName":n.dataIndex.indexOf("ds6wg:DELFmiContQuantity_Mass.V_ContQuantity")>=0?n.text=_.appCore.exportService.normalizeStringInNFKDFormat(n.text):n.dataIndex.indexOf("ds6wg:DELFmiContQuantity_Volume.V_ContQuantity")>=0&&(n.text=_.appCore.exportService.normalizeStringInNFKDFormat(n.text))}),e){var o=i[t];i[t]=i[e],i[t+1]=o,i.splice(e,1)}var s=-1,a=_.appCore.i18nManager.get("Title");i.find(function(e,t){if(e&&e.text&&e.text===a)return s=t,t}),i.unshift(i[s]),i.splice(s+1,1),this.actualAttributeNames={};for(var l=["Alternate","Manufacturing","MadeFrom","occurence","CoveringMaterial","CoveringMaterialInstance","Configuration","ConfigurationRevision","rollup","Deformable","level",,"thumbnail","v6_specdoc_to"],c=[],d=0;d<i.length;d++)l.includes(i[d].dataIndex)?c.push(d):this.actualAttributeNames[i[d].dataIndex]=i[d].dataIndex;if(c.length>0)for(d=c.length;d>0;d--)i.splice(c[d-1],1);return i},isUserPreferredColumnsExists:function(){return Object.keys(this._userPreferredColumns).length>0},getDefaultColumns:function(){for(var e=this.getLoadedXENAttributes(),t={},n=0;n<e.length;n++)t[e[n].dataIndex]=e[n].text;return this.excludeNotSupportedColumns(t,this._GroupByOptionsList.value,this.isFlattendView()),this.excludeDefaultUnselectedColumns(t,D),t},excludeNotSupportedColumns:function(e,t,n){var i=[];if(t==h.NOT_GROUPED?i=b:t!=h.REFERENCE&&t!=h.PART_NUMBER||(i=S),this.removeColumnsFromUserSelection(i,e),n){if(i=T,e.Quantity){let t=e.Quantity.split("/");e.Quantity=t.length>1?t[1]:t[0]}}else if(e.Quantity){let t=e.Quantity.split("/");e.Quantity=t[0]}this.removeColumnsFromUserSelection(i,e)},excludeDefaultUnselectedColumns:function(e,t){this.removeColumnsFromUserSelection(t,e)},removeColumnsFromUserSelection:function(e,t){for(var n=0;n<e.length;n++)t[e[n]]&&delete t[e[n]]},unselectColumnsByDefault:function(e){for(var t=0;t<e.length;t++)this._columnsCheckboxJson[e[t]]&&(this._columnsCheckboxJson[e[t]].checkFlag=!1)},isQuantityColumnExists:function(e){for(var t=0;t<e.length;t++)if("quantity"==e[t].dataIndex)return!0;return!1},getLoadedXENAttributes:function(){return this._xenColumnsArray},isFlattendView:function(){return this._COMPONENT_FINALITEM.checkFlag},reArrangeToUserPreferredOrder:function(e,t){for(var n=[],i=0;i<e.length;i++){var r=this.columnExistsInAvailableAttributes(e[i],t);r>=0&&n.push(t[r])}return n},columnExistsInAvailableAttributes:function(e,t){for(var n=-1,i=0;i<t.length;i++)if(e==t[i].dataIndex)return n=i;return n},isColumnSelectionExists:function(e){return!!this.getCachedUserPreferredColumns()[e]}},e.extend({init:function(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute:function(){(_=this)._exportFileDialog()},_exportFileDialog:function(e){var n=this;function o(e,t){for(var n=0,i=0;i<t.length;i++)if(t[i]==e){n=i;break}return n}y=[{labelItem:n.options.appCore.i18nManager.get("eng.export.notGrouped"),valueItem:h.NOT_GROUPED},{labelItem:n.options.appCore.i18nManager.get("eng.export.reference"),valueItem:h.REFERENCE},{labelItem:n.options.appCore.i18nManager.get("eng.export.partNumber"),valueItem:h.PART_NUMBER}],C=new x,w={ExportedOn:!0,ExportSettings:!0},C.modal.getContent().getElements(".btn").forEach(function(e){"cancelButton"===e.name?e.addEvent("click",function(){w={},C.modal.destroy()}):"previewButton"===e.name?e.addEvent("click",function(){C.validateExportOptions()&&n.appCore.dicoService.loadListOfParametricalAttributes().finally(function(){C.getUserSelectedExportOptions(),C.getPreviewFormatSelectedOptions(),function(){var e=new r;e.inject(C.modal.modal.elements.container);var o={exportSettings:!0,exportTable:!0},s=t.compile(E),a=o?UWA.clone(o,!1):{},l=document.createElement(M);l.innerHTML=s(a);l.querySelector(".enox-export-preview-format");var u=l.querySelector(".enox-export-preview-format-export-settings"),p=l.querySelector(".enox-export-preview-format-export-table"),g=UWA.createElement(N);for(var h in O){var m=UWA.createElement(v),f=UWA.createElement(I);f.style.fontWeight="bold",f.setText(h+" : ");var _=UWA.createElement(I);_.setText(O[h]),m.appendChild(f),m.appendChild(_),g.appendChild(m)}u.appendChild(g);var y=JSON.parse(w.SelectedColumns),A=[];(b={}).text=n.options.appCore.i18nManager.get("eng.export.preview.level"),b.dataIndex=n.options.appCore.i18nManager.get("eng.export.preview.level"),A.push(b);for(let e in y){var b={};b.text=y[e],b.dataIndex=e,A.push(b)}new d({columns:A,placeholder:"",defaultColumnDef:{width:"auto",typeRepresentation:"string"},onContextualEvent:function(e){return[]}}).inject(p).layout.rowsHeader=!1;var S=new i({title:n.options.appCore.i18nManager.get("eng.export.previewFormat.dialogbox.title"),content:l,width:1100,height:350,position:{at:"center",my:"center"},immersiveFrame:e,resizableFlag:!0,buttons:{Cancel:new c({label:n.options.appCore.i18nManager.get("eng.ui.button.cancel"),onClick:function(e){S.immersiveFrame.getModel().elements.container.destroy()}})}});S.elements._contentDiv.style.background="white",S.elements._contentDiv.style.display="block",S.addEventListener("close",function(e){S.immersiveFrame.getModel().elements.container.destroy()})}(),O={}})}):"exportButton"===e.name&&e.addEvent("click",function(){C.validateExportOptions()&&(n._progressDiag=new g({target:widget.body,title:n.appCore.i18nManager.get("eng.export.progressDialog.Title"),progressBar:{displayStyle:"normal",infiniteFlag:!0}}),n.appCore.dicoService.loadListOfParametricalAttributes().finally(function(){var e="Direct"===(w=C.getUserSelectedExportOptions()).Components?"1":"-1";C.disableExportAndPreviewFormatButtons(),n.appCore.contextManager.getActiveEngItem().isValidForExpandLevel(e).then(function(){n.appCore.exportService.downloadExportFile(w,"export_fetch",n._progressDiag),w={},C.modal.destroy()}).catch(function(e){u.errorAlert(n.appCore.i18nManager.get("eng.export.alert.largeExportdata")),C.enableExportAndPreviewFormatButtons(),n._progressDiag.close()})}))})}),C.modal.getContent().getElement(".enox-export-settings-template").addEvent("click",function(e){!function(){var e=new r;e.inject(C.modal.modal.elements.container);var a={columnsTable:!0},l=t.compile(f),d=a?UWA.clone(a,!1):{},u=document.createElement(M);u.className="enox-exports-settings-wrapper",u.innerHTML=l(d),C._exportTableContainer=u.querySelector(".enox-export-columns-table");var p,g=new i({title:n.options.appCore.i18nManager.get("eng.export.settingsTemplateDialogboxTitle"),content:u,immersiveFrame:e,width:500,buttons:{Cancel:new c({label:n.options.appCore.i18nManager.get("eng.ui.button.cancel"),onClick:function(e){g.immersiveFrame.getModel().elements.container.destroy()}}),Ok:new c({label:n.options.appCore.i18nManager.get("eng.ui.button.save"),onClick:function(e){C.anyColumnSelected()?C.enableExportAndPreviewFormatButtons():C.disableExportAndPreviewFormatButtons(),C.cacheUserPreferredColumns(),g.immersiveFrame.getModel().elements.container.destroy()}})}});g.addEventListener("close",function(e){g.immersiveFrame.getModel().elements.container.destroy()}),C.createCustomHeaderColumnSelections(),C._selectAllCheckbox.addEventListener("click",function(){var e=C._selectAllCheckbox.checkFlag;e?C.selectAllColumns():C.unselectAllColumns()}),g.getContent().getElements(".hover_info").forEach(function(e){e.addEvent("mouseover",function(e){var t=this.title;this.title=e.target.getText(),this.setAttribute("tooltip",t)})}),g.getContent().getElements(".display_text").forEach(function(e){e.addEvent("mouseenter",function(e){var t=document.body.getElementsByClassName("enable_textbox")[e.target.id],n=t.getText();t.empty(),p=new s({value:n,sizeInCharNumber:34,selectAllOnFocus:!0}).inject(t)})}),g.getContent().getElements(".display_text").forEach(function(e){e.addEvent("mouseleave",function(e){var t=document.body.getElementsByClassName("enable_textbox")[e.target.id],n=t.children;n.length>0&&(t.empty(n),""==p.valueToCommit||null==p.valueToCommit?t.setText(C._columnsOrderNlsJson[e.target.id]):(p.value=p.valueToCommit,t.setText(p.value)))})}),g.getContent().getElements(".listitem_checkbox").forEach(function(e){e.addEvent("click",function(e){C.validateSelectAllCheckBox()})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("dragstart",function(e){e.dataTransfer.setData("Text",e.target.id)})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("dragover",function(t){t.preventDefault(),t.stopPropagation(),e.getChildren()[A].addClassName("listitem_drag_drop_highlight")})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e.getChildren()[A].removeClassName("listitem_drag_drop_highlight")})}),g.getContent().getElements(".columns").forEach(function(e){e.addEvent("drop",function(t){t.preventDefault();var n=t.dataTransfer.getData("Text"),i=document.getElementById(t.target.id)?document.getElementById(t.target.id).parentNode:"",r=document.getElementById(n).parentNode,s=t.target.id;if(s.indexOf("_displayValue")<0&&""!=s){var a=!1,l=o(n,C._columnsOrder),c=o(t.target.id,C._columnsOrder);c-l==1&&(a=!0),a?r.parentNode.insertBefore(i,r):r.parentNode.insertBefore(r,i);for(var d=[],u=0;u<C._columnsOrder.length;u++)C._columnsOrder[u]!=n&&(C._columnsOrder[u]!=t.target.id?d.push(C._columnsOrder[u]):a?(d.push(C._columnsOrder[u]),d.push(n)):(d.push(n),d.push(C._columnsOrder[u])));C._columnsOrder=d}t.stopPropagation(),e.getChildren()[A].removeClassName("listitem_drag_drop_highlight")})})}()}),C.modal.modal.elements.header.getChildren()[0].addEvent("click",function(){w={},C.modal.destroy()}),C.modal.show()}})}),define("DS/ENOXEngineer/commands/AddNewDocumentsCmd",["UWA/Core","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/commands/XEngineerCommandBase"],function(e,t,n){"use strict";return n.extend({execute:function(){if(this.appCore.PreferencesManager.isSpecInProductStructureEnabled()){var e=this.context.getSelectedNodes();Array.isArray(e)&&1===e.length&&this.appCore.dataService.addNewDocumentToEngItem({targetObjID:e[0].getID()}),this.end()}else t.errorAlert(this.appCore.i18nManager.get("error.dragdrop.specifications.failed"))}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/CollapseAll",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),t.initialize(this)},execute:function(){t.collapseChildren(),this.end()}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandTaggerGroup",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils"],(e,t)=>{return class extends e{constructor(e){super(e),t.initialize(this)}execute(){const e=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes(null,e=>Reflect.has(e,"isGroupFromExpand")&&e.isGroupFromExpand());Array.isArray(e)&&e.length&&(e.forEach(e=>e.expand()),this.end())}}}),define("DS/ENOXEngineer/commands/SetWorkUnderEvolutionPrefCmd",["UWA/Core","DS/UIKIT/Input/Toggle","UWA/Class/View","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o,s){"use strict";return r.extend({init:function(t){t=e.extend(t,{isAsynchronous:!1}),this._parent(t)},execute:function(e){var t=this,n=t.options.context.getActiveEngItem();n&&(!n.getPreferedAttachedConfigModel()||!n.getPreferedAttachedConfigModel().getPreferredVersion()||n.getPreferedAttachedConfigModel().getPreferredVersion().state!==s.MATURITY_MODEL_VERSION_RELEASE&&n.getPreferedAttachedConfigModel().getPreferredVersion().state!==s.MATURITY_MODEL_VERSION_OBSOLETE)&&n.hasValidConfigContext()&&t.options.context._app.core.dataService.getUserWorkUnderEvolDlgPref()!==s.VALUE_SET_WORKUNDER_NEVER?(t.activeEngItem=n,t.activeModel=t.activeEngItem.getPreferedAttachedConfigModel(),t.modelId=t.activeModel.getID(),t.modelName=t.activeModel.getLabel(),t.productId=t.activeModel.getCurrentVersionID(),t.productName=t.activeModel.getCurrentVersionName(),t.productTitle=t.activeModel.getCurrentVersionMarketingName(),t.productRevision=t.activeModel.getCurrentVersionRevision(),t.modelTitle=t.activeModel.getMarketingName(),t.options.context._app.core.dataService.getUserWorkUnderEvolDlgPref()===s.VALUE_SET_WORKUNDER_ALWAYS?(t.end(),t.options.context._app.core.dataService.applyWorkUnderEvolution(t.modelId,t.modelName,t.productId,t.productName,t.productRevision,t.modelTitle,t.productTitle).then(function(e){null!=e&&t.options.context._app.mediator.publish(s.EVENT_SET_WORKUNDER_EVOLUTION_COMPLETED,e)})):t._buildEvolutionPrefDialog()):t.end()},_buildEvolutionPrefDialog:function(){var e=this;e.end(),e.workunderPrefmodal=new i({title:e.options.appCore.i18nManager.get("workunder_evolution_pref"),className:"xeng-workunder-preference",withFooter:!0}),(new(e._getEvolutionPrefView())).render().inject(e.workunderPrefmodal.modal.elements.body),e.dontAskCheckbox=new t({type:"checkbox",value:e.options.appCore.i18nManager.get("checkbox_dontaskagain"),className:"primary",label:e.options.appCore.i18nManager.get("checkbox_dontaskagain"),events:{}}),e.dontAskCheckbox.inject(e.workunderPrefmodal.modal.elements.body),e.workunderPrefmodal.modal.getContent().getElements(".btn").forEach(function(t){"okButton"===t.name?(t.setText(e.options.appCore.i18nManager.get("label_yes")),t.addEvent("click",function(){e.dontAskCheckbox.isChecked()&&(e.options.context._app.core.dataService.setUserWorkUnderEvolDlgPref(s.VALUE_SET_WORKUNDER_ALWAYS),o.sucessAlert(e.options.appCore.i18nManager.get("eng.operation.setNoShowWorkUnderDlg.sucess")),e.options.context._app.mediator.publish(s.EVENT_NEVER_SHOW_WORKUNDER_DLG,s.VALUE_SET_WORKUNDER_ALWAYS)),e.options.context._app.core.dataService.applyWorkUnderEvolution(e.modelId,e.modelName,e.productId,e.productName,e.productRevision,e.modelTitle,e.productTitle).then(function(t){null!=t&&e.options.context._app.mediator.publish(s.EVENT_SET_WORKUNDER_EVOLUTION_COMPLETED,t),e.destroy()})})):"cancelButton"===t.name&&(t.setText(e.options.appCore.i18nManager.get("label_no")),t.addEvent("click",function(){e.dontAskCheckbox.isChecked()&&(e.options.context._app.core.dataService.setUserWorkUnderEvolDlgPref(s.VALUE_SET_WORKUNDER_NEVER),o.sucessAlert(e.options.appCore.i18nManager.get("eng.operation.setNoShowWorkUnderDlg.sucess")),e.options.context._app.mediator.publish(s.EVENT_NEVER_SHOW_WORKUNDER_DLG,s.VALUE_SET_WORKUNDER_NEVER)),e.destroy()}))}),e.options.context._app.core.dataService.getUserWorkUnderEvolDlgPref()===s.VALUE_ASK_WORKUNDER_EVERYTIME&&e.workunderPrefmodal.show()},destroy:function(){this.workunderPrefmodal&&this.workunderPrefmodal.destroy()},_getEvolutionPrefView:function(){var t=this;e.createElement("div",{html:"test",styles:{height:"600px",position:"relative"}});return t.workunderEvolDlgView=n.extend({name:"set-workunder-pref",render:function(){return t.textboxElement=e.createElement("div",{html:t.options.appCore.i18nManager.get("evolutionprefdlg.prefquestion").replace("{model}",t.productTitle).replace("{version}",t.productRevision).replace("{model}",t.productTitle).replace("{version}",t.productRevision),styles:{height:"auto",position:"relative",padding:"5px"}}),this.container.setContent(t.textboxElement),this}}),t.workunderEvolDlgView}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandNLevel",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelModal","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/LevelSelector","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){this._parent(e),n.initialize(this)},execute:function(){this.buildLevelSelector(),this.end()},expandByNLevel:function(e){n.expandItemsByLevel(e)},buildLevelSelector:function(e){var n=this;this.levelSelectorModal=new t({target:widget.body,modalFlag:!0,resizableFlag:!1,closeButtonFlag:!1,titleBarVisibleFlag:!1,width:"auto",height:"auto",position:{my:"top right",at:"top right",offsetX:-50,offsetY:150},content:n.injectLevelSelectorComponent(),events:{onClickOutsideContent:function(){n.closeLevelSelector()}}})},injectLevelSelectorComponent:function(){var e=this;return this.levelSelectorContainer=new i({onLevelSelectorSet:function(t){e.context._app.core.contextManager.isActiveEngItemSelected()&&n.isServiceHitRequired()&&(t+=1),e.expandByNLevel(t.toString()),e.closeLevelSelector()},onLevelSelectorClose:function(){e.closeLevelSelector()}}),this.levelSelectorContainer.getContent()},closeLevelSelector:function(){this.levelSelectorModal&&this.levelSelectorModal.close()}})}),define("DS/ENOXEngineer/commands/DownloadDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end();var t=this.appCore.contextManager.getSelectedNodes();this.appCore.mediator.publish(i.EVENT_DOWNLOAD_ITEM,{nodes:t})}})}),define("DS/ENOXEngineer/commands/AddExistingDocumentCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","UWA/Class/Promise","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){this.end(),this.appCore.PreferencesManager.isSpecInProductStructureEnabled()?e&&"dropped"===e.mode||this.appCore.dataService.searchManager.launchASearch({title:this.appCore.i18nManager.get("eng.searchResult.InsertDocument"),allowedTypes:["Document"],role:"",criteria:"",multiSel:!0,in_apps_callback:this.onSelectedFromSearch.bind(this)}):r.errorAlert(this.appCore.i18nManager.get("error.dragdrop.specifications.failed"))},onSelectedFromSearch:function(e){this.context.getSelectedNodes()&&0!==this.context.getSelectedNodes().length||this.alertManager.errorAlert(o.get("error.noSelection")),this.context.getSelectedNodes().length>1&&this.alertManager.errorAlert(o.get("error.notSupport.multisel"));for(var t=0;t<this.context.getSelectedNodes().length;t++)for(var n=0;n<e.length;n++)this.appCore.dataService.attachDocumentToEngItem(this.context.getSelectedNodes()[t],e[n].id,!0)}})}),define("DS/ENOXEngineer/commands/EditPropertiesCmd",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Search","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/EditPropWidget/constants/EditPropConstants","UWA/Class/Promise","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a){"use strict";return e.extend({init:function(e){this._parent(e)},execute:function(e){var t=this;let n;switch(this.getId()){case"edit-materials":n="MaterialFacet";break;case"edit-properties-ref":n=o.FACET_PROPERTIES;break;case"edit-properties-inst":n=o.FACET_INSTANCE;break;case"edit-comments":n=o.FACET_SWYMCOMMENTS;break;case"edit-alternates":n="alternateFacet";break;case"edit-made-from":n="specsMadeFromFacet";break;case"edit-derived-output":n="derivedoutputs";break;case"edit-manufacturing":n="ManufactureIntent";break;case"edit-spec-doc":n=r.CONST_SPEC_FACET_NAME;break;default:n=this.getArguments()[0]}if(this.appCore){var s=this.appCore.contextManager.getSelectedNodes(),a=[];s.filter(function(e){return!(e instanceof i)}).forEach(function(e){var n=!1;"ENOStrRefinementSpecification"===e.getType()&&(n=!0),e.getRelationID&&e.getRelationID()&&!t.appCore.sessionManager.shouldShowQuantityView()&&!e.isDocument()?a.push({id:e.getRelationID(),metatype:"relationship",instrefid:e.getID(),readOnly:n}):a.push({id:e.getID(),metatype:"businessobject",readOnly:n})}),t.appCore.mediator.publish(r.EVENT_SHOW_PROPERTIES,{nodes:a,facet:n}),t.appCore.mediator.publish(r.EVENT_TRIPTYCH_SHOW_PANEL,"right"),this.end()}}})}),define("DS/ENOXEngineer/commands/ChangeMaturityBulkCmd",["UWA/Core","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return t.extend({init:function(e){this._parent(e)},execute:function(e){var t=this,i=this.options.context.getSelectedNodes(),r=null;i.length>=1&&(r=i[0]),t.options.expandPromise=new Promise(function(e,i){t.options.appCore.dataService.getEngItemStructure(r.getID(),null).then(function(i){var o=[];o.push(r),i.forEach(function(e){o.push(e)}),t.options.context._app.mediator.publish(n.EVENT_LAUNCH_COMMAND,{commandId:n.MATURITY_GRAPH_CMD,context:{item:o}}),e(i)}).catch(function(e){console.error(e),i(e)})})},destroy:function(){}})}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/Expand",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils"],(e,t)=>{return class extends e{constructor(e){super(e),t.initialize(this)}execute(){let e=1;this.context._app.core.contextManager.isActiveEngItemSelected()&&t.isServiceHitRequired()&&(e+=1),t.expandItemsByLevel(e.toString()),this.end()}}}),define("DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandAllLevel",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e),t.initialize(this)},execute:function(){t.expandItemsByLevel(n.CONST_EXPAND_ALL_LEVEL),this.end()}})}),define("DS/ENOXEngineer/collections/XEngGridTreeDocument",["DS/Tree/TreeDocument","DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/Utilities/Utils","DS/ENOXEngineerCommonUtils/xEngAlertManager"],function(e,t,n,i,r,o,s){"use strict";return e.extend({useAsyncPreExpand:!0,defaultOptions:{nodeModelClass:t},init:function(e){var t=e||{};this.core=t.core||{},delete t.core,this._parent(t),this._getTrueRoot().options.appCore=this.core,this.getXSO().onPostAdd(this.selectionUpdated.bind(this)),this.getXSO().onPostRemove(this.selectionUpdated.bind(this)),this.onPreExpand(this._onPreExpand.bind(this)),this._xEngGroupedBy=[];var n=this;this.core.xengTreeDoc=this,this.onUpdate(this.onModelUpdateCB.bind(this));const r=this.core.contextManager.getXENTreeDocument()?this.core.contextManager.getXENTreeDocument().getFilterOptionsFromSessionManager():null;this._FilterBI=this.core.contextManager.getXENTreeDocument()?this.core.contextManager.getXENTreeDocument().getXENBIFilterProxy(r):null,this._FilterBI&&(this.subscribeToFilterBIProxyEvents(this._FilterBI),this.filterBIRemoveToken=this.core.mediator.subscribe("XENFilterBIProxy_remove",()=>{this._FilterBI&&this.unsubscribeToFilterBIProxyEvents(this._FilterBI)}),this.filterBIInitToken=this.core.mediator.subscribe("XENFilterBIProxy_init",e=>{this._FilterBI=e,this.subscribeToFilterBIProxyEvents(this._FilterBI)})),this.xHighlightToken=this.core.mediator.subscribePlatformEvent(i.CROSS_APP_SELECTION_EVENT,this.applyCrossHighlight.bind(this)),this.cleanBIFilterProxyToken=this.core.mediator.subscribe(i.EVENT_CLEAR_TAGGER,function(){n.cleanBIFilterProxy()})},onModelUpdateCB(e){r.startBulkMode("updateAttributes",this.core.mediator)},destroy(){this.filterBIInitToken&&(this.core.mediator.unsubscribe(this.filterBIInitToken),this.filterBIInitToken=null),this.filterBIRemoveToken&&(this.core.mediator.unsubscribe(this.filterBIRemoveToken),this.filterBIRemoveToken=null),this.unsubscribeToFilterBIProxyEvents(this._FilterBI),this._parent()},subscribeToFilterBIProxyEvents(e){e&&(e.addEvent("fetchFilterBIFilteringEvent",this.onFilterBIFilteringEvent.bind(this)),e.addEvent("fetchFilterBIColorizeEvent",this.onFetchFilterBIColorize.bind(this)),e.addEvent("FilterBIColorize",this.onFilterBIColorize.bind(this)),e.addEvent("FilterBIUnColorize",this.onFilterBIUnColorize.bind(this)))},unsubscribeToFilterBIProxyEvents(e){e&&(e.removeEvent("fetchFilterBIFilteringEvent"),e.removeEvent("fetchFilterBIColorizeEvent"),e.removeEvent("FilterBIColorize"),e.removeEvent("FilterBIUnColorize"))},onApplyNGFilter:function(){console.warn(" ########### from grid onApplyNGFilter")},getSelectedItemsCommonMenu:function(e){if(e)return this.core.sessionManager.isMyENGViewView()||this.core.sessionManager.isRecentItemViewView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("standaloneReference")):this.core.sessionManager.shouldShowFinalItems()||this.core.sessionManager.shouldShowMfgView()||this.core.sessionManager.shouldShowLeafMaterials()||this.core.sessionManager.shouldShowFlatView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("occurrence")):this.core.sessionManager.shouldShowQuantityView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("usedReference")):this.core.sessionManager.isItemView()?this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("instance")):this.core.commandManager.showMenu(e,this.core.commandManager.getMenu("standaloneReference"))},_buildFilteredContent:function(e){console.error("_buildFilteredSession need to be overriden")},onSelectionUpdated:function(){},_onPreExpand:function(e){if(e.data.nodeModel._isFromOriginalModel()||e.data.nodeModel.options.useAsyncPreExpand){var t=e.data,n=t.nodeModel,i=(!!t.nodeModel.expandAll&&t.expandAll,t.numberOfLevelsToExpand?t.numberOfLevelsToExpand.toString():"1");parseInt(i);if(this.core.contextManager.setPreExpandEvent(!0),n.options.childComputed)e.target.preExpandDone({preventExpandAll:!0});else try{this.prepareUpdate(),this.core.sessionManager.expandTheNodeOnEachLevel(this,n),this.core.sessionManager.setTargetNodeModel(n)}catch(e){}finally{this.pushUpdate(),e.target.preExpandDone({preventExpandAll:!0}),!0&&(n.options.childComputed=!0)}}else e.target.preExpandDone({})},getBIFilter:function(){return this._FilterBI},mergeContent:function(e,t){var n=this,i=!(!t||!t.onlyUpdateExistingNodes)&&t.onlyUpdateExistingNodes,r=t&&t.additionalIds?t.additionalIds:null;if(Array.isArray(e)&&e.length>0){var o={};try{n.getChildren().forEach(function(t,i){var r=e[0]instanceof n.core.Factories.ListItemFactory.getListInstanceClass(),s=e.findIndex(function(e){return r?e.getRelationID()===t.getRelationID():e.getID()===t.getID()});if(-1!==s){console.warn("merging the element at "+i);let r=t.isSelected();t.remove();let o=e[s];n.addChild(o,i),r&&o.select(),e.splice(s,1)}if(0===e.length)throw o}),e.forEach(function(e){console.warn('###########" adding content '),(!i||i&&r&&-1!==r.indexOf(e.getID()))&&n.addChild(e,0)})}catch(e){if(console.warn("no need to go throught all the element"),e!==o)throw e}}},findNodesByIds:function(e){let t=this.getAllDescendants();return t.forEach(e=>{Array.isArray(e.getUsages())&&e.getUsages().length>=1&&e.getUsages().forEach(e=>{t.push(e)})}),r.findNodesByIdsFromList(t,e)},findQtyOrInstNodeByIds:function(e){let t=this.getAllDescendants();return r.findQtyOrInstNodesByIdsFromList(t,e)},findNodesById:function(e){return this.findNodesByIds([e])},updateNodesWithChangeSet:function(e,t){(t&&t.length?t:this.getAllDescendants()).forEach(t=>{t.updateWithChangeSet(e)})},_getChildrenUnderRootItem:function(e){if(e&&e.isExpanded()&&e.getChildren()&&Array.isArray(e.getChildren()))for(var t=0;t<e.getChildren().length;t++){var n=e.getChildren()[t];this.nodes.push(n),this._getChildrenUnderRootItem(n)}},getAllTheExpanedNodes:function(){this.nodes=[];var e=this.getRoots();if(e.length>0)for(var t=0;t<e.length;t++)this.nodes.push(e[t]),this._getChildrenUnderRootItem(e[t]);return this.nodes},buildReferenceList:function(e,t){var i=[],r=t&&Array.isArray(t.getChildren())?t:this;return 0==(i=r.getChildren().filter(t=>t.getID()===e.getID())).length?this.getChildren().forEach(function(t){if(n=t.getChildren()){var n=n.filter(function(t){return t.getID()===e.getID()});i=i.concat(n)}}):1==i.length&&i[0]instanceof n&&(i=i[0].getChildren()),i},syncContent:function(e){var t=this.getChildren().length,n=this.core.PersistencyManager.getUserSelectedNodeIDs();this.empty(),this.addChild(e),this.core.PersistencyManager.saveUserSelectedNodeIDs(n),t!==e.length&&this.refreshTagger()},selectionUpdated:function(e){var t=this.getSelectedNodes()||[],r=!1;if(this.core.PersistencyManager.getWidgetRefreshStatus()||this.core.PersistencyManager.saveUserSelectedNodes(t),1==this.isViewGrouped()&&e.forEach(function(e){!e._isFromOriginalModel()&&e.getChildren()&&e.getChildren().length>0&&(e.isSelected()&&!e.areAllChildrenSelected()?(r=!0,e.selectAll()):e.isSelected()||e.areAllChildrenUnselected()||(r=!0,e.unselectAll()))}),!1===r){if(1==this.isViewGrouped())var o=t.filter(function(e){return!(e instanceof n)});else o=t;if("function"==typeof this.onSelectionUpdated&&this.onSelectionUpdated(o.length),0===o.length&&this.core.contextManager.getActiveEngItem()){var s=this.core.contextManager.getActiveEngItem();o.push(s),this.updateXHighlight(null)}else this.updateXHighlight(o);this.pushNodesToEditProperties(o)}this.core.mediator.publish(i.EVENT_OPEN_ITEM_WITH_COMPASS,!1)},applyCrossHighlight:function(e){var t=this;if(!(e&&e.data&&Array.isArray(e.data.paths)&&e.data.paths.length&&this.getChildren()))return;if(e.metadata&&e.metadata.appid===this.core.settingManager.getAppId()+"_"+this.core.settingManager.getWidgetId())return;if(e.metadata&&e.metadata.origin&&("ENORIPE_Relations"===e.metadata.origin||"ENOSPEC_AP"===e.metadata.origin||"SNNavigationMap"===e.metadata.origin))return;if(e.data&&e.data.metadata&&"ENOLCMI_AP"===e.data.metadata.origin)return;var n={};e.data.paths.forEach(function(e){e.length>1&&(n[e[e.length-2]]=!0)});let i=[];e.data.paths.forEach(e=>{const t=e.join("/");i.push(t);let n=[];for(var r=0;r<e.length;r+=2)n.push(e[r]);const o=n.join("/");i.push(o)});this.prepareUpdate(),t.notApplyXhightlight=!0,t.unselectAll(),this.getAllDescendants().filter(e=>e._isFromOriginalModel()).forEach(function(e){const t=e.buildNodeId?e.buildNodeId():null;i.forEach(n=>{n&&(t===n||t.endsWith(n)||n.endsWith(t))&&e.select()})}),this.pushUpdate(),this.notApplyXhightlight=!1},updateXHighlight:function(e){if(!this.notApplyXhightlight){var t={paths:[],version:"1.1"};if(e&&Array.isArray(e)){var n=[];e.forEach(function(e){e.isEngineeringItem()&&e.getUsages&&e.getUsages()?n=n.concat(e.getUsages()):n.push(e)});var o={};if(this.core&&this.core.contextManager.getActiveEngItem()){var s=this.core.contextManager.getActiveEngItem();o[s.getID()]={type:s.getType(),label:s.getLabel()}}t.attributes=n.reduce(function(e,t){return t&&(e[t.getID()]={type:t.getType(),label:t.getLabel()}),e},o),t.paths=n.map(function(e){let t=[];return e&&(t=e.isEngineeringItem()?e.getOccurrencePath():[e.getID()]),t});const i=this.core.settingManager.getAuthorizedChange();i&&(t.changeControl=i)}var a=r.createEvent((65536*(1+Math.random())|0).toString(16).substring(1),t);this.core.mediator.publishPlatformEvent(i.CROSS_APP_SELECTION_EVENT,a)}},pushNodesToEditProperties:function(e){var t=this;if(this.core){var n=e||this.getSelectedNodes(),r=[];n.forEach(function(e){var n=!1;"ENOStrRefinementSpecification"===e.getType()&&(n=!0),e.getRelationID&&e.getRelationID()&&!t.core.sessionManager.shouldShowQuantityView()&&!e.isDocument()?r.push({id:e.getRelationID(),metatype:"relationship",instrefid:e.getID(),readOnly:n}):r.push({id:e.getID(),metatype:"businessobject",readOnly:n})}),this.core.mediator.publish(i.EVENT_SHOW_PROPERTIES,{nodes:r})}},getAvailableAttributesForGrouping:function(){return this.core.dicoService.getVisibleAttributes().filter(function(e){return e.customisation&&e.customisation.layout&&e.customisation.layout.canBeGrouped})},_shouldAcceptDrop:function(){return!0},_shouldAcceptDrag:function(e,t){return console.error("drag"),!0},getNoTFilteredNodes:function(){return this.getChildren().filter(function(e){return e.shouldBeVisible()})},refreshTagger:function(){this.removeFromTagger(),this.pushToTagger()},removeFromTagger:function(e){if(this.core.mediator.unsubscribePlatformEvent(this.xHighlightToken),this.core.mediator.unsubscribe(this.cleanBIFilterProxyToken),this._FilterBI&&(this._FilterBI.removeEvent(),this._FilterBI.resetNGFilterUI({widgetId:this.core.settingManager.getWidgetId(),rootIds:Array.isArray(e)?e:void 0}),this._FilterBI.removeAllRoots(),this.core&&this.core.contextManager&&this.core.contextManager.getXENTreeDocument())){this.core.PersistencyManager.getWidgetRefreshStatus()||this.core.contextManager.getXENTreeDocument().resetXENBIFilterProxy()}},cleanBIFilterProxy:function(){this._FilterBI&&this._FilterBI.cleanProxy()},pushToTagger:function(){if(!this._FilterBI)return;const e=[];if(this._FilterBI.isExpandSyntesisActivated()){const t=this.core.contextManager.getActiveEngItem()?this.core.contextManager.getActiveEngItem().getID():null;t&&e.push(t)}else this.getAllTheExpanedNodes().forEach(t=>{t.getID()&&e.push(t.getID())});e.length&&(this._FilterBI.addRoots(e),this._colorizeState&&this._colorizeOptions&&(this._FilterBI.isExpandSyntesisActivated()?this.onFilterBIColorize(this._colorizeOptions):this.onFetchFilterBIColorize(this._colorizeOptions)))},onFetchFilterBIColorize:function(e){const t=r.getFetchTaggerColorMap(e);t&&Reflect.ownKeys(t).length&&(this.withTransactionUpdate(()=>{this.getAllTheExpanedNodes().forEach(e=>{t[e.getID()]&&e.setColor(t[e.getID()])})}),this._colorizeState=!0,this._colorizeOptions=e,this.core.mediator.publish(i.EVENT_COLORIZATION_UPDATED,this._colorizeState))},onFilterBIColorize:function(e){const t=r.getExpandTaggerColorMap(e);t&&Reflect.ownKeys(t).length&&(this.withTransactionUpdate(()=>{r.colorizeNodesFromExpandTagger(this.getAllTheExpanedNodes(),t,this.core.settingManager)}),this._colorizeState=!0,this._colorizeOptions=e,this.core.mediator.publish(i.EVENT_COLORIZATION_UPDATED,this._colorizeState))},isColorizeEnabled:function(){return this._colorizeState},onFilterBIUnColorize:function(){this.withTransactionUpdate(()=>{this.getAllTheExpanedNodes().forEach(e=>e.setColor(null))}),this._colorizeState=!1,this._colorizeOptions=null,this.core.mediator.publish(i.EVENT_COLORIZATION_UPDATED,this._colorizeState)},onFilterBIFilteringEvent:function(e){const{allfilters:t}=e||{},n=t&&Object.keys(t).length>0;this.prepareUpdate(),this.getAllTheExpanedNodes().forEach(t=>{if(n){const n=-1===e.matchingIDs.indexOf(t.getID());t.setTaggerFilterState(n)}else t.setTaggerFilterState(!1);t.applyFilters()}),this.pushUpdate(),this.onPostENOXFiltering()},onPostENOXFiltering:function(){this.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)},getAvailableAttributesToSort:function(){return[{id:"Title",text:this.core.i18nManager.get("ds6w:label"),type:"string"},{id:"Maturity",text:this.core.i18nManager.get("ds6w:status"),type:"string"},{id:"Owner",text:this.core.i18nManager.get("ds6w:responsible"),type:"string"},{id:"CreationDate",text:this.core.i18nManager.get("ds6w:created"),type:"string"},{id:"PartNumber",text:this.core.i18nManager.get("ds6wg:EnterpriseExtension.V_PartNumber"),type:"string"}]},_isProvided:function(e){return!0},groupRoots:function(e){const t=this.core.contextManager.getActiveEngItem(),n=t&&t.hasValidTransientGroupingContext();if(1===e.propertiesToGroup.length||0===e.propertiesToGroup.length){if("reference"===(r=e.propertiesToGroup[0]))this.isNotWaitingForAttributes()||(e={propertiesToGroup:[]},r=void 0,s.notifyAlert(this.core.i18nManager.get("error.grouping.notProvided")));else{var i=this.core.dicoService.getVisibleAttributes();if(i&&Array.isArray(i)&&i.length>0)-1===i.map(function(e){return e.dataIndex}).indexOf(r)&&(e={propertiesToGroup:[]},r=void 0)}n||this._parent(e),this._xEngGroupedBy=e.propertiesToGroup,this.core.PersistencyManager.setGroupByOption(r)}else{n||this._parent({propertiesToGroup:[e.propertiesToGroup[0]]}),this._xEngGroupedBy=[e.propertiesToGroup[0]];var r=e.propertiesToGroup[0];this.core.PersistencyManager.setGroupByOption(r),s.errorAlert(this.core.i18nManager.get("error.single.level.grouping"))}},isViewGrouped:function(){return!(!Array.isArray(this._xEngGroupedBy)||0==this._xEngGroupedBy.length)},getViewGroupedByAttributes:function(e){return this._xEngGroupedBy}})}),define("DS/ENOXEngineer/services/MaterialAuthoringOperations",["UWA/Core","DS/ENOXEngineer/services/MaterialConstants","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialExceptions"],(e,t,n,i)=>{const{MaterialType:r}=t,{MaterialTypeError:o,MaterialSamePidError:s}=i,a={apply:"apply",remove:"remove",replace:"replace"},l=async e=>{const t=e.physicalid||e.id||e.objectId;let i=e.V_discipline||e["ds6w:type_value"]||e.objectType;return i!==r.core&&i!==r.covering&&(Reflect.has(e,"baseMatType")||(e.baseMatType=await n.getBaseMaterialType(i)),i=e.baseMatType),{physicalid:t,type:i}};class c{constructor(e,t){this.type=t,this.matref=e}get operation(){return this.type}build(){const{physicalid:e}=this.matref;return{materialref:{physicalid:e},operation:this.buildOperation()}}buildOperation(){return{type:this.operation}}isCompatibleWithType(e){return!1}}class d extends c{constructor(e){super(e,a.apply)}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / ApplyMaterial.Create -> wrong inputs"),null;const{type:n}=await l(t);return n===r.core?u.create(t):n===r.covering?p.create(t):null}}class u extends d{isCompatibleWithType(e){return e===r.core}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoreApplyMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);if(i!==r.core){throw console.error(`MaterialAuthoringOperation / CoreApplyMaterial.Create -> matref (${n}) is not a ${r.core}`),new o(`Wrong material type ${i} => expecting ${r.core}`)}return new u({physicalid:n})}}class p extends d{isCompatibleWithType(e){return e===r.covering}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoveringApplyMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);if(i!==r.covering)throw console.error(`MaterialAuthoringOperation / CoveringApplyMaterial.Create -> matref (${n}) is not a ${r.covering}`),new o(`Wrong material type ${i} => expecting ${r.covering}`);return new p({physicalid:n})}}class g extends c{constructor(e){super(e,a.remove)}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / RemoveMaterial.Create -> wrong inputs"),null;const{type:n}=await l(t);return n===r.core?h.create(t):n===r.covering?m.create(t):null}}class h extends g{isCompatibleWithType(e){return e===r.core}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoreRemoveMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);return i!==r.core?(console.error(`MaterialAuthoringOperation / CoreRemoveMaterial.Create -> matref (${n}) is not a ${r.core}`),null):new h({physicalid:n})}}class m extends g{isCompatibleWithType(e){return e===r.covering}static async create(t){if(!e.is(t))return console.error("MaterialAuthoringOperation / CoveringRemoveMaterial.Create -> wrong inputs"),null;const{physicalid:n,type:i}=await l(t);return i!==r.covering?(console.error(`MaterialAuthoringOperation / CoveringRemoveMaterial.Create -> matref (${n}) is not a ${r.covering}`),null):new m({physicalid:n})}}class f extends c{constructor(e){super(e,a.replace)}static async create(t,n){if(!e.is(t))return console.error("MaterialAuthoringOperation / ReplaceMaterial.Create -> wrong inputs"),null;const{type:i}=await l(t);return i===r.core?E.create(t,n):i===r.covering?C.create(t,n):null}}class E extends f{isCompatibleWithType(e){return e===r.core}constructor({physicalid:e},t){super({physicalid:e}),this.new_matref=t}static async create(t,n){if(!e.is(t)||!e.is(n))return console.error("MaterialAuthoringOperation / CoreReplaceMaterial.Create -> wrong inputs"),null;const{physicalid:i,type:a}=await l(t),{physicalid:c,type:d}=await l(n);if(a!==r.core||d!==r.core)throw console.error(`MaterialAuthoringOperation / CoreReplaceMaterial.Create -> matref (${i}) or new_matref (${c}) is not a ${r.core}`),new o("Wrong material type");if(i===c)throw console.error(`MaterialAuthoringOperation / CoreReplaceMaterial.Create -> matref (${i}) and new_matref (${c}) are equals`),new s("Same material physicalid");return new E({physicalid:i},{physicalid:c})}buildOperation(){return{type:this.operation,with:{materialref:{physicalid:this.new_matref.physicalid}}}}}class C extends f{constructor({physicalid:e},t){super({physicalid:e}),this.new_matref=t}isCompatibleWithType(e){return e===r.covering}static async create(t,n){if(!e.is(t)||!e.is(n))return console.error("MaterialAuthoringOperation / CoveringReplaceMaterial.Create -> wrong inputs"),null;const{physicalid:i,type:a}=await l(t),{physicalid:c,type:d}=await l(n);if(a!==r.covering||d!==r.covering)throw console.error(`MaterialAuthoringOperation / CoveringReplaceMaterial.Create -> matref (${i}) or new_matref (${c}) is not a ${r.covering}`),new o("Wrong material type");if(i===c)throw console.error(`MaterialAuthoringOperation / CoveringReplaceMaterial.Create -> matref (${i}) and new_matref (${c}) are equals`),new s("Same material physicalid");return new C({physicalid:i},{physicalid:c})}buildOperation(){return{type:this.operation,with:{materialref:{physicalid:this.new_matref.physicalid}}}}}return{ApplyMaterial:d,RemoveMaterial:g,ReplaceMaterial:f,extractMatInfos:l}}),define("DS/ENOXEngineer/commands/MaterialFacet/ApplyMaterialCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialAuthoringOperations","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/ENOXEngineerCommonUtils/xEngAlertManager"],(e,t,n,i,r,o)=>{return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"exclusive"})}get isAuthoringCmd(){return!0}getMaxTime(e=5){return 60*e*1e3}get searchManager(){return e.is(this.options.searchManager)?this.options.searchManager:null}get dragdropFct(){return e.is(this.options.getDnDSelectedItems)?this.options.getDnDSelectedItems:null}get materialType(){return this.options.materialType}getNls(e){const t=Object.getOwnPropertyNames(r).findIndex(t=>t===e);return t<0&&console.error(`error: ApplyMaterialCmd -> missing nls entry ${e}`),t>=0?r[e]:null}cancel(e=!1,t=null){if(e){const e=this.buildDisplayedMessage(`${this.getNls("materialFacet.applyMaterial")} ${this.getNls("materialFacet.authoring.failed")}`,t);o.errorAlert(e)}super.cancel()}launchMaterialSearch(t){if(!e.is(t))return console.error("error: ApplyMaterialCmd/launchMaterialSearch missing materialType parameter"),Promise.reject();const{searchManager:n}=this;return e.is(n)?new Promise((e,i)=>{try{n.launchASearch({title:this.getNls("materialFacet.searchResult.ApplyMaterial"),allowedTypes:[t],role:"",criteria:"",multiSel:!1,in_apps_callback:t=>{e(t)}})}catch(e){i(e)}}):(console.error("error: ApplyMaterialCmd/launchMaterialSearch missing searchManager parameter"),Promise.reject())}lauchMaterialDnD(t){if(!e.is(t))return console.error("error: ApplyMaterialCmd/lauchMaterialDnD missing materialType parameter"),Promise.reject();const{dragdropFct:n}=this;if(!e.is(n))return console.error("error: ApplyMaterialCmd/launchMaterialSearch missing lauchMaterialDnD parameter"),Promise.reject();const i=this.dragdropFct();if(!Array.isArray(i)||!i.length)return console.error("error: ApplyMaterialCmd/launchMaterialSearch no retreive D&D datas"),Promise.reject();let r=[];try{r=i.map(e=>{const{objectId:t,objectType:n}=e;return{physicalid:t,V_discipline:n}})}catch(e){return Promise.reject()}return Promise.resolve(r)}endExecute(){const{searchManager:t}=this;e.is(this.options.searchManager)}async execute(){const{selectedItems:t}=this;if(!Array.isArray(t)||!t.length)return console.error("error: ApplyMaterialCmd/execute missing selectedItems parameter"),this.cancel(!0);const r=new Promise(e=>{setTimeout(()=>e([]),this.getMaxTime(.5))});let o=[];e.is(this.searchManager)?(o.push(r),o.push(this.launchMaterialSearch(this.materialType))):e.is(this.dragdropFct)&&o.push(this.lauchMaterialDnD(this.materialType));let s=null;try{s=await Promise.race(o)}catch(e){return console.warn("error: ApplyMaterialCmd/execute authoring operation failed, no ref material selected"),this.cancel()}if(!Array.isArray(s)||!s.length)return this.cancel();try{const{ApplyMaterial:r}=i;o=s.map(e=>new Promise((t,n)=>{r.create(e).then(t).catch(n)}));const a=await Promise.all(o),l=t.map(e=>({physicalid:e,operations:a})),c=n.retreiveAuthorMaterialDataFct(this.materialType);if(!e.is(c))return console.error(`error: ApplyMaterialCmd/execute no authoring function found for type ${this.materialType}`),this.cancel(!0);await n[c]({pids:l})}catch(e){return console.error("error: ApplyMaterialCmd/execute authoring operation failed"),this.cancel(!0,e)}return this.end()}}}),define("DS/ENOXEngineer/commands/MaterialFacet/ReplaceMaterialCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialAuthoringOperations","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/MaterialExceptions"],(e,t,n,i,r,o,s)=>{const{MaterialError:a}=s;return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"exclusive"})}get isAuthoringCmd(){return!0}getMaxTime(e=5){return 60*e*1e3}get searchManager(){return this.options.searchManager}get materialType(){return this.options.materialType}getNls(e){const t=Object.getOwnPropertyNames(r).findIndex(t=>t===e);return t<0&&console.error(`error: ReplaceMaterialCmd missing nls entry ${e}`),t>=0?r[e]:null}launchMaterialSearch(t){if(!e.is(t))return console.error("error: ReplaceMaterialCmd/launchMaterialSearch missing materialType parameter"),Promise.reject();const{searchManager:n}=this;return e.is(this.options.searchManager)?new Promise((e,i)=>{try{n.launchASearch({title:this.getNls("materialFacet.searchResult.ReplaceMaterial"),allowedTypes:[t],role:"",criteria:"",multiSel:!1,in_apps_callback:t=>{e(t)}})}catch(e){i(e)}}):(console.error("error: ReplaceMaterialCmd/launchMaterialSearch missing searchManager parameter"),Promise.reject())}endExecute(){const{searchManager:t}=this;e.is(this.options.searchManager)}cancel(e=!1,t=null){if(e){const e=this.buildDisplayedMessage(`${this.getNls("materialFacet.replaceMaterial")} ${this.getNls("materialFacet.authoring.failed")}`,t);o.errorAlert(e)}super.cancel()}async execute(){const{selectedItems:t}=this;if(!Array.isArray(t)||!t.length)return console.error("error: ReplaceMaterialCmd/execute missing selectedItems parameter"),this.cancel(!0);const r=this.selectedMaterials;if(!e.is(r))return console.error("error: ReplaceMaterialCmd/execute missing matRefs parameter"),this.cancel(!0);const o=new Promise(e=>{setTimeout(()=>e([]),this.getMaxTime(.5))});let s=[];s.push(o),s.push(this.launchMaterialSearch(this.materialType));let l=null;try{l=await Promise.race(s)}catch(e){console.warn("error: ReplaceMaterialCmd/execute authoring operation failed, no ref material selected");const t=a.isAMaterialError(e);return this.cancel(t,e)}if(!Array.isArray(l)||!l.length||l.length>1)return this.cancel();try{const{ReplaceMaterial:o}=i;s=r.map(e=>new Promise((t,n)=>{o.create(e,l[0]).then(t).catch(n)}));const a=await Promise.all(s),c=t.map(e=>({physicalid:e,operations:a})),d=n.retreiveAuthorMaterialDataFct(this.materialType);if(!e.is(d))return console.error(`error: ReplaceMaterialCmd/execute no authoring function found for type ${this.materialType}`),this.cancel(!0);await n[d]({pids:c})}catch(e){return console.error("error: ReplaceMaterialCmd/execute authoring operation failed"),this.cancel(!0,e)}return this.end()}}}),define("DS/ENOXEngineer/commands/AddNewMaterialQuantityCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/MaterialAuthoringOperations","DS/ENOXEngineer/services/MaterialConstants","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r,o,s)=>{const{MaterialType:a}=s,{extractMatInfos:l}=o;return class extends n{constructor(e){super(e),this.material=null}execute(){const t=this.appCore.sessionManager.consummeAvailableMaterialForInsert();e.is(t)?(this.material=t,this.showView()):this.appCore.dataService.searchManager.launchASearch({title:this.appCore.i18nManager.get("eng.searchResult.InsertMaterial"),allowedTypes:[a.core],role:"",criteria:"",multiSel:!1,in_apps_callback:this.onSelectedFromSearch.bind(this)})}async onSelectedFromSearch(e){if(!Array.isArray(e)||1!==e.length)return console.error("unexpected selection"),this.abort();const{type:t}=await l(e[0]);if(t!==a.core)return console.error("unexpected selection"),this.abort();[this.material]=e,this.showView()}showView(){const n=(()=>e.is(this.material)?`${this.material["ds6w:label"]} ${this.material["ds6wg:revision"]}`:"")();widget.setValue(i.PREFERRED_DIMENSION,i.DIMENSION_VOLUME),new t(this.appCore,{title:this.options.appCore.i18nManager.get("eng.ui.dialog.selectMaterialQuantity").replace("{mat}",n),className:"new-material-quantity-dlg",withFooter:!0,onOk:this.onOk.bind(this),onCancel:this.onCancel.bind(this)})}onOk(e,t){"function"==typeof t&&t();const{value:n}=e;if(!n.trim().length||isNaN(n)||n<0)return console.warn("unexpected input value"),this.abort();this._createEngineeringItem(e)}onCancel(){this.end()}_lauchCreateCommand(){this.appCore.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.CREATE_NEW_ENG_ITEM,context:{isInsert:!0}})}abort(){const e=this.appCore.i18nManager.get("createQuantityFailed");r.errorAlert(e),this.end()}_createEngineeringItem({value:e,dimension:t,unit:n}){const o=this.appCore.PreferencesManager.dimensions[t].Units.find(e=>e.Name===n),s={physicalid:this.material.id},a={name:this.appCore.PreferencesManager.dimensions[t].Name,value:e,unit:o.Name};this.appCore.contextManager._postProcessEvent="AddNewMaterialQuantityCmd_setAdditionalInfo";const l=this.appCore.mediator.subscribe("AddNewMaterialQuantityCmd_setAdditionalInfo",async e=>{if(l&&(this.appCore.mediator.unsubscribe(l),this.appCore.contextManager._postProcess=!1,this.appCore.contextManager._postProcessEvent=""),!Array.isArray(e))return void this.abort();const t={items:[...new Set(e.map(e=>e.child))].map(e=>({materialref:s,quantity:a,reference:{physicalid:e}}))};try{await this.appCore.dataService.setQuantityOnMaterial(t),this.appCore.mediator.publish(i.EVENT_INSTANCES_CREATED,e)}catch(e){const t=this.appCore.i18nManager.get("createQuantityFailed");r.errorAlert(t)}this.end()});this._lauchCreateCommand()}}}),define("DS/ENOXEngineer/commands/MaterialFacet/RemoveMaterialCmd",["UWA/Core","DS/ENOXEngineer/commands/MaterialFacet/BaseMatCmd","DS/ENOXEngineer/services/MaterialService","DS/ENOXEngineer/services/MaterialAuthoringOperations","DS/ENOXEngineerCommonUtils/xEngAlertManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],(e,t,n,i,r,o)=>{return class extends t{constructor(e){super({...e,isAsynchronous:!0,mode:"shared"})}get isAuthoringCmd(){return!0}get materialType(){return this.options.materialType}getNls(e){const t=Object.getOwnPropertyNames(o).findIndex(t=>t===e);return t<0&&console.error(`RemoveMaterialCmd -> missing nls entry ${e}`),t>=0?o[e]:null}cancel(e=!1,t=null){if(e){const e=this.buildDisplayedMessage(`${this.getNls("materialFacet.removeMaterial")} ${this.getNls("materialFacet.authoring.failed")}`,t);r.errorAlert(e)}super.cancel()}async execute(){const{selectedItems:t}=this;if(!Array.isArray(t)||!t.length)return console.error("error: RemoveMaterialCmd/execute missing selectedItems parameter"),this.cancel(!0);const r=this.selectedMaterials;if(!e.is(r))return console.error("error: RemoveMaterialCmd/execute missing matRefs parameter"),this.cancel(!0);try{const{RemoveMaterial:o}=i,s=r.map(e=>new Promise((t,n)=>{o.create(e).then(t).catch(n)})),a=await Promise.all(s),l=t.map(e=>({physicalid:e,operations:a})),c=n.retreiveAuthorMaterialDataFct(this.materialType);if(!e.is(c))return console.error(`error: RemoveMaterialCmd/execute no authoring function found for type ${this.materialType}`),this.cancel(!0);await n[c]({pids:l})}catch(e){return console.error("error: RemoveMaterialCmd/execute authoring opration failed"),this.cancel(!0,e)}return this.end()}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/I18nManager","DS/Tree/TreeNodeModel","DS/ENOXEngineer/utils/XENHttpClient"],(e,t,n,i,r,o)=>{return class{constructor({appCore:e,referenceNode:t,context:n}){this.appCore=e,this.referenceNode=t,this.context=n,this.usages=[],this.usagesAddedAsBulk=0}computeNodeLabel(e){const{grid:t}=e.options,n=Reflect.has(t,"ds6w:label-Instance")?t["ds6w:label-Instance"]:"";return n&&n.trim().length?n:e.getLabel()}computeNodeOccurrencePath(e,n){if(!n)return e.getOccurrencePath();const i=e.getOccurrencePath(),{parentId:r}=this.context;return t.truncateOccurrencePathFromRefID(i,r)}set nodes(e){if(!Array.isArray(e)||!e.length)return;const n=this.appCore.sessionManager.shouldShowFinalItems();this.usages=e.map(e=>{const i=this.computeNodeLabel(e),r=this.computeNodeOccurrencePath(e,n);return t.updateNodeOptions(e,{grid:{status:t.status.Kept,changeQuantityStatus:!0},label:i,children:null,occurrencePath:r}),e})}get nodes(){return this.usages}getRollup(e){}getModelAttached(){return Array.isArray(this.models)?this.models:[]}getReferenceIDForModel(){return this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowFinalItems()?this.context.activeId:this.context.parentId}fetchModelAttached(){if(!this.referenceNode)return Promise.reject(new Error("invalid reference"));if(Array.isArray(this.models))return Promise.resolve(this.models);const e=this.getReferenceIDForModel();return this.fetchModel(e).then(e=>(this.models=e,Promise.resolve(this.models))).catch(()=>Promise.reject(new Error("failed to retreive attached Model")))}fetchModel(e){const t={...this.appCore.settingManager.getCommand("getConfiguredObjectInfo")};return t.url=t.url.replace("{pid}",e),o.perform(t).then(e=>{const t=this.appCore.Factories.configItemsFactory.getModelsFromConfigInfo(e);return Promise.resolve(t)}).catch(e=>Promise.reject(e))}executeChangeQuantity(e){}get editableProperties(){return[]}getInstanceIcon(){return{iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}}getColumns(){const e=[],t=i.get("eng.export.instance.key");var r=i.get("ds6w:label-Instance")+` (${t})`;e.push({text:r,dataIndex:"tree",pinned:"left",width:220}),e.push({text:i.get("ds6w:label"),dataIndex:"ds6w:label"}),e.push({text:i.get("ds6wg:revision"),dataIndex:"ds6wg:revision"});const o=this.buildMaterialColumn(n.CONT_QUANTITY_MASS);e.push(o);const s=this.buildMaterialColumn(n.CONT_QUANTITY_VOLUME);return e.push(s),e}buildMaterialColumn(e){const t=e===n.CONT_QUANTITY_MASS?"eng.ui.dialog.changeQuantity.massQuantityHeader":"eng.ui.dialog.changeQuantity.volumeQuantityHeader";return{text:i.get(t).replace("{unit}",this.getUnitDisplay(e)),dataIndex:e,editableFlag:!1,typeRepresentation:"float",editionPolicy:"EditionOnClick",getCellValue:e===n.CONT_QUANTITY_MASS?this.getMassCellMaterialValue.bind(this):this.getVolumeCellMaterialValue.bind(this)}}getUnitDisplay(e){return e===n.CONT_QUANTITY_MASS?this.appCore.PreferencesManager.getNLSValueForMassQuantity():this.appCore.PreferencesManager.getNLSValueForVolumeQuantity()}getMassCellMaterialValue(e){return this.getCellMaterialValue(n.CONT_QUANTITY_MASS,e)}getVolumeCellMaterialValue(e){return this.getCellMaterialValue(n.CONT_QUANTITY_VOLUME,e)}getCellMaterialValue(e,t){const i=this.getUnitDisplay(e);let r=null;return e===n.CONT_QUANTITY_MASS?r=t.nodeModel.hasMassQuantity&&t.nodeModel.hasMassQuantity():e===n.CONT_QUANTITY_VOLUME&&(r=t.nodeModel.hasVolumeQuantity&&t.nodeModel.hasVolumeQuantity()),r?`${r}${i}`:""}get isAddRemoveNodeAuthorized(){return!1}findFirstModifiedNode(){return this.usages.find(e=>!t.isNodeKept(e))}findLastNonRemoveNode(){return[...this.usages].reverse().find(e=>!t.isNodeRemove(e))}hasModifiedNode(){const t=this.findFirstModifiedNode();return e.is(t)}createNodeInfo(){return null}udpateAsNewNode(e){t.updateNodeOptions(e,{grid:{changeQuantityStatus:!0,status:t.status.Kept},color:t.statusColor.Kept}),this.notifyUpdate({modify:[e]})}udpateAsRemoveNode(e){t.updateNodeOptions(e,{grid:{changeQuantityStatus:!1,status:t.status.Removed},color:t.statusColor.Removed}),this.notifyUpdate({modify:[e]})}udpateAsModifyNode(e,n){t.updateNodeOptions(e,{grid:{status:t.status.Modified,...n},color:t.statusColor.Modified}),this.notifyUpdate({modify:[e]})}udpateAsNonModifyNode(e,n){t.updateNodeOptions(e,{grid:{status:t.status.Kept,...n},color:t.statusColor.Kept}),this.notifyUpdate({modify:[e]})}createAndAddNode(){const e=this.createNodeInfo();if(!e)return;const n=new r({label:e.Text,grid:e});t.updateNodeOptions(n,{grid:{status:t.status.New,changeQuantityStatus:!0},color:t.statusColor.New}),this.usages.push(n),this.notifyUpdate({create:[n]})}duplicateNode(e){const{options:t}=e,n=t?{...t}:{};return n.icons=[],new r(n)}destroyNode(e){this.usages=this.usages.filter(t=>e._id!==t._id),this.notifyUpdate({detach:[e]})}addNode(e){let n=null;(n=e||this.findFirstModifiedNode())&&t.isNodeRemove(n)?this.udpateAsNewNode(n):this.createAndAddNode()}addNodeAsBulk(e){this.usagesAddedAsBulk=e,this.notifyBulkUpdate({createAsBulk:e})}removeNode(e){e&&(t.isNodeNew(e)?this.destroyNode(e):this.udpateAsRemoveNode(e))}removeLastNode(){const e=this.findLastNonRemoveNode();return this.removeNode(e)}getModificationsResult(){const e=[],n=[],i=[];return this.usages.forEach(r=>{switch(t.getNodeStatus(r)){case t.status.Removed:n.push(r);break;case t.status.New:e.push(r);break;case t.status.Modified:i.push(r)}}),{create:e,detach:n,modify:i}}get updateSessionEvent(){return"ChangeQuantitySessionUpdate"}notifyUpdate(e){const{mediator:t}=this.appCore;t&&t.publish(this.updateSessionEvent,e)}notifyBulkUpdate(e){const t=`${this.updateSessionEvent}AsBulk`,{mediator:n}=this.appCore;n&&n.publish(t,e)}}}),define("DS/ENOXEngineer/models/EngItemListModel",["DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineerCommonUtils/PromiseUtils","UWA/Core"],function(e,t,n){"use strict";function i(t){this.options={instanceId:"",instanceMainAttribute:{name:"Effectivity",value:""},viewType:"instance",group:null},this.options=n.extend(this.options,t),e.call(this,this.options)}return i.prototype=Object.create(e.prototype),i.prototype.getEffectivity=function(){return this.options.instanceMainAttribute.value},i.prototype.completePath=function(e){return Array.isArray(e)?(e.push(this.getRelationID()),e.push(this.getID()),e):[]},i.prototype.getViewType=function(){return this.options.viewType},i.prototype.getUuid=function(){return this.getRelationID()},i.prototype.getRelationID=function(){return this.options.instanceId},i.prototype.getFirstLevelInstanceID=function(){return Array.isArray(this.getOccurrencePath())?this.getOccurrencePath()[1]:null},i.prototype.getOccurrencePath=function(){return this.options.occurrencePath},i.prototype.getDataPath=function(){var e=this.getOccurrencePath();if(e&&Array.isArray(e))return e;var t=[],n=this.getRelationID(),i=this.getID();return n&&t.push(n),i&&t.push(i),t},i.prototype.setOccurencePath=function(e){var t=e;t.push(this.options.instanceId),t.push(this.getID()),this.options.occurrencePath=t},i.prototype.setGroup=function(e){this.options.group=e},i.prototype.getGroup=function(){return this.options.group},i.prototype.getInstanceName=function(){return this.options.grid["ds6w:label-Instance"]},i.prototype.getInstanceEvolution=function(){return this.options.grid.CurrentEvolutionEffectivity},i.prototype.getInstanceVariant=function(){return this.options.grid.VariantEffectivity},i.prototype.getInstanceConfiguration=function(){return this.options.grid.Configuration},i.prototype.hasStaticMapping=function(){return this.options.grid.hasStaticMapping},i.prototype.getConfigurationID=function(){return this.options.grid.ConfigurationID},i.prototype.getInstanceType=function(){return this.options["ds6w:type-Instance"]},i.prototype.getInstanceTypeNLS=function(){return this.options.grid.instanceTypeNLS?this.options.grid.instanceTypeNLS:this.options.instanceType},i.prototype.isInstance=function(){var e=!0;return!0===this.isRepresentation()&&(e=!1),e},i.prototype.getMetaType=function(){var e=this;return t.wrappedWithPromise(function(t,n){e.options.appCore.dicoService.getMetaTypes([e.getType()],e instanceof e.options.appCore.Factories.ListItemFactory.getListInstanceClass()).then(function(e){return t(e[0])}).catch(function(e){return t("businessobject")})})},i.prototype.getUsedReference=function(){return this.isMaterialQuantity()?this.getCoreMaterials()[0]:this.options.appCore.Factories.ListItemFactory.listNodeToEngItem(this)},i.prototype.updateWithChangeSet=function(e){this.matchChangeSet(e)&&this.updateOptions(e.options)},i}),define("DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView",["UWA/Core","UWA/Class/Options","UWA/Controls/Abstract","UWA/Class/Promise","DS/Core/ModelEvents","DS/ENOXEngineer/utils/Utils","DS/Handlebars/Handlebars4","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/MaturityUtils","DS/Utilities/Dom","DS/Controls/TooltipModel","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","css!DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g){"use strict";return n.extend(t,{name:"ENOXResponsiveSetView",_views:[{id:"Tile",loader:"DS/CollectionView/ResponsiveTilesCollectionView",text:g.get("Tile"),fonticon:"view-small-tile"},{id:"Thumbnail",text:g.get("ThumbnailView"),loader:"DS/CollectionView/ResponsiveThumbnailsCollectionView",fonticon:"view-big-thb"},{id:"bigTile",text:g.get("big_tiles_view"),loader:"DS/CollectionView/ResponsiveLargeTilesCollectionView",fonticon:"view-big-tile"}],defaultOptions:{models:null},instanciedViews:{},buildAvailableViewsList:function(){var e=this;this.views=[],e.options.keepDefaultViews&&(this.views=this._views),Array.isArray(e.options.views)&&e.options.views.forEach(function(t){if(t.id&&t.loader&&t.fonticon){var n=(i=t.id,e.views.find(function(e){return e.id===i}));n?(n.loader=t.loader,n.fonticon=t.fonticon):e.views.push(t)}var i})},init:function(t){var n=this;this._parent(t),this.options.models=t.models,delete t.models,this.options.models.pushToTagger(),this.options.models.onPostENOXFiltering=this.afterFiltering.bind(this),this.options.models.onSelectionUpdated=this.updateSelectedItemsCount.bind(this),"function"==typeof this.options.onCellDoubleClick&&(this.onCellDoubleClick=this.options.onCellDoubleClick),this.options=e.extend(this.options,t,!0),this._modelEvents=this.options.modelEvents?this.options.modelEvents:new r,this.buildAvailableViewsList(),this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.loadViewsClass().then(function(e){n.buildView()}).catch(function(e){console.error(e)})},updateSelectedItemsCount:function(e){var t=this.options.models.getSelectedNodes();void 0===e&&t.length;this.setMultiselMenuStatus(e)},selectAll:function(){this.isToolbarSearchApplied?this.options.models.getChildren().forEach(function(e){e.shouldBeVisible()&&e.select()}):this.options.models.selectAll()},unSelectAll:function(){this.options.models.unselectAll()},buildView:function(){this.elements.container=e.createElement("div",{class:this.getClassNames()}),this.elements.gridviewContainer=e.createElement("div",{class:this.getClassNames()+"-gridview"}),this.options.toolbar&&(this.elements.toolbarContainer=e.createElement("div",{class:this.getClassNames()+"-toolbar"}),this.elements.toolbarContainer.inject(this.elements.container,"top"),this.toolbar=this.buildToolbar(),this.toolbar.inject(this.elements.toolbarContainer)),this.elements.gridviewContainer.inject(this.elements.container),this._listenToToolbarEvents(),this.renderPreferredView(),this.elements.container.inject(this.options.container),this.updateCount()},afterFiltering:function(){this.updateCount()},buildToolbar:function(){var e=this.options.toolbar||{},t={modelEvents:this._modelEvents,withmultisel:!0,showItemCount:!0,multiselActionCallback:null,multiselActions:[],sort:e.sort,views:this.views.map(function(e){return{id:e.id,text:e.text,fonticon:e.fonticon}}),currentView:this.getPreferredView(),currentSort:{id:"Title",order:"ASC"},currentNbitems:0,currentNbSelections:0};return new l(t)},search:function(e){this.fileredDocuemnt=null},_listenToToolbarEvents:function(){this.eventsTokens=[];var e=this;this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(t){e.switchView(t)}));let t=a.EVENT_TOOLBAR_SEARCH;this.eventsTokens.push(e.options.models.core.mediator.subscribe(t,function(t){var n=Array.isArray(t.searchValue)?t.searchValue[0]:"",i=(new Date).getTime();e.options.models.prepareUpdate(),e.options.models.getChildren().forEach(function(e){e.unMatch(n)?e.setSearchFilterState(!0):e.setSearchFilterState(!1),e.applyFilters()}),e.options.models.pushUpdate(),e.updateCount(),e.isToolbarSearchApplied=!!n,console.warn("ending search in "+((new Date).getTime()-i)+"ms")})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-selected"},function(){e.selectAll()})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-unselected"},function(){e.unSelectAll()})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-click-multiselect-icon"},function(t){e.onMultiselClick(t.object.elements.container)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){var n=(new Date).getTime();e.options.models.prepareUpdate(),console.warn(t);var i="asc"===(t.sortOrder||"").toLowerCase()?1:-1;e.options.models._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(e,n){return i*(e.getSortableAttributeValue(t.sortAttribute)<n.getSortableAttributeValue(t.sortAttribute)?-1:1)}}),e.options.models.pushUpdate(),console.warn("ending search in "+((new Date).getTime()-n)+"ms")}))},updateCount:function(){var e=this.options.models?this.options.models._getTrueRoot():null,t=this.options.models?this.options.models.getSelectedNodes():[],n=e?e.getNumberOfVisibleDescendants():0;this._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:n}),n||this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1}),this.setMultiselMenuStatus(t.length)},setMultiselMenuStatus:function(e){e>0?(this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!0}),this._modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:e})):(this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1}),this._modelEvents.publish({event:"enox-collection-toolbar-select-all-checkbox-uncheck",data:""}))},applyFilter:function(){},switchView:function(e){this.hidePreviousView(),this.preferredView=e,this._modelEvents.publish({event:"event-persist-view",data:e}),this.renderPreferredView()},hidePreviousView:function(){var e=this;Object.keys(this.instanciedViews).forEach(function(t){e.instanciedViews[t].elements.container.classList.remove("visible")})},renderPreferredView:function(){this.getPreferredViewInstance().elements.container.classList.add("visible")},onMultiselClick:function(e){e&&(this.options.models.core.contextManager.setMultiselMenu(!0),this.options.models.getSelectedItemsCommonMenu(e.getBoundingClientRect()))},onCellDoubleClick:function(){console.log("doubleclick observed ! ")},getViewOptions:function(){return e.extend({},{height:"inherit",displayedOptionalCellProperties:["contextualMenu","activeFlag"],useDragAndDrop:!0,onDragStartCell:function(e,t){var n,i=t.nodeModel;i&&(n=i.getTreeDocument()),e.dataTransfer.effectAllowed="all";var r=o.prepareDragData(n.getSelectedNodes());return e.dataTransfer.setData("Text",r),!0}},!0)},getSubLabel:function(e){var t=e.options.appCore.settingManager.getSetting("defaultPolicies");e.options.appCore.dataService.getStatesAttributes(t);var n=e.getDisplayedGridViewAttribute();return this.buildSpanSublabel(e.options,n)},buildSpanSublabel:function(e,t){var n=this;let i=u.createElement("span",{class:"eno-xen-tile-subLabel"});return t.forEach(function(t){var r=null,s=null;"ds6w:status"===t?n.buildSpanStatus(i,e.grid[a.CONST_CURRENT_OBJECT_MATURITY_STATE],e.grid[t],!1):((r=u.createElement("span",{class:"eno-xen-tile-subLabel-divider"})).innerText="|",i.appendChild(r),"ds6w:responsible"===t?n.buildSpanOwner(i,e.grid[t]):((s=u.createElement("span",{class:"eno-xen-tile-subLabel-value"})).innerText="ds6w:created"===t||"ds6w:modified"===t?o.getformatedDate(e.grid[t]):e.grid[t],i.appendChild(s)))}),i},buildSpanStatus:function(e,t,n,i){if(t&&n){var r=d.getAndCreateMaturityClass(t,"wux-controls-label");let o=u.createElement("div",{class:r}),s=u.createElement("span",{class:"wux-controls-label"});i?s.classList.add("eno-xen-tile-tooltip-status"):s.classList.add("eno-xen-tile-status"),s.innerText=n,o.appendChild(s),e.appendChild(o)}},buildSpanOwner:function(e,t){if(t){let n=u.createElement("span",{class:"eno-xen-tile-owner"}),i={iconName:"topbar-user",fontIconFamily:1,className:"eno-xen-tile-owner-icon owner-font"},r=u.generateIcon(i);n.appendChild(r);let o=u.createElement("span",{class:"eno-xen-tile-subLabel-owner-label"});o.innerText=t,n.appendChild(o),e.appendChild(n)}},getTooltip:function(e){var t=e.getAllGridViewAttribute();let n=this.buildSpanTooltip(e.options,t);return new p({title:e.getLabel(),shortHelp:n,allowUnsafeHTMLShortHelp:!0,updateModel:!1,wrapThreshold:375})},buildSpanTooltip:function(e,t){var n=this;let i=u.createElement("div",{class:"eno-xen-tile-tooltip"});return t.forEach(function(t){var r=null,s=null,l=null;r=u.createElement("span",{class:"eno-xen-tile-tooltip-row"}),i.appendChild(r),(s=u.createElement("span",{class:"eno-xen-tile-tooltip-label"})).innerText=e.appCore.i18nManager.get(t),r.appendChild(s),l=u.createElement("span",{class:"eno-xen-tile-tooltip-value"}),"ds6w:responsible"===t?n.buildSpanOwner(r,e.grid[t]):"ds6w:status"===t?n.buildSpanStatus(r,e.grid[a.CONST_CURRENT_OBJECT_MATURITY_STATE],e.grid[t],!0):(l.innerText="ds6w:created"===t||"ds6w:modified"===t?o.getformatedDate(e.grid[t]):e.grid[t],r.appendChild(l))}),i},configureViewInstance:function(t){var n=this;t.selectionBehavior={canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!0,unselectAllOnEmptyArea:!0},t.onDragStartCellDefault=function(e){return!0},t.onCellDoubleClick(n.onCellDoubleClick.bind(n)),t.allowUnsafeHTMLContent=!0,t.getLabel=function(t){return e.String.escapeHTML(t.getLabel())+" - "+t.getReferenceVersion()},t.getSubLabel=function(e){return n.getSubLabel(e)},t.allowUnsafeHTMLContent=!0,t.getCustomTooltip=function(e){return n.getTooltip(e)},t.onContextualEvent={callback:function(e){var t=[];e&&e.cellInfos&&(e.cellInfos.cellModel&&(t=e.cellInfos.cellModel.getEngineeringMenu(a.MY_ENG_ITEMS_VIEW)));return t}},t.model=n.options.models},getPreferredViewInstance:function(){if(!this.instanciedViews[this.getPreferredView()]){var e=this._getViewClass(this.getPreferredView());this.instanciedViews[this.getPreferredView()]=new e(this.getViewOptions()),this.activeView=this.instanciedViews[this.getPreferredView()],this.activeView.getContent().inject(this.elements.gridviewContainer),this.configureViewInstance(this.activeView)}return this.instanciedViews[this.getPreferredView()]},getPreferredView:function(){if(this.preferredView)return this.preferredView;if(this.options.defaultView){this.views=this.views||[];for(var e=0;e<this.views.length;e++)if(this.views[e].id===this.options.defaultView)return this.preferredView=this.views[e].id,this.views[e].id}return this.preferredView=this.views[0].id,this.views[0].id},_getViewClass:function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].id===e)return this.views[t].Clazz;return null},loadViewsClass:function(){var e=this;return this.classLoaderPromise?this.classLoaderPromise:(this.classLoaderPromise=new i(function(t,n){var r;(r=e.views.map(function(e){return e.loader}),new i(function(e,t){var n=function(e){t(e)};Array.isArray(r)?require(r,function(){e(arguments)},n):n(r)})).then(function(n){for(var i=0;i<e.views.length;i++)e.views[i].Clazz=n[i];e.views=Object.freeze(e.views),t(e.views)}).catch(function(e){n(e)})}),this.classLoaderPromise)},destroy:function(){for(var e=this,t=Object.keys(this.instanciedViews),n=0;n<t.length;n++){if("function"==typeof this.instanciedViews[t[n]].destroy)try{this.instanciedViews[t[n]].destroy()}catch(e){console.error(e)}delete this.instanciedViews[t[n]]}this.options.models.getChildren().forEach(function(e){e._unsetParent()}),this.options.models.removeFromTagger(),this.eventsTokens&&this.eventsTokens.forEach(function(t){e._modelEvents.unsubscribe(t)})}})}),define("DS/ENOXEngineer/components/XEngGridView/js/XEngGridViewV2",["DS/ENOXEngineerCommonUtils/XENMask","DS/ResizeSensor/js/ResizeSensor","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/components/NavigationTopBar/NavigationTopBar","DS/ENOXEngineer/collections/XEngGridTreeDocument","DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView","DS/PlatformAPI/PlatformAPI","css!DS/ENOXEngineer/components/XEngGridView/css/XEngGridView.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return function(d){var u=d.getContainer(),p=document.createElement("div");p.classList.add("xen-landingpage-topbar");var g=document.createElement("div");return g.classList.add("xen-landingpage-list"),{_authoredDataPromise:null,_refreshSubscription:null,start:function(){var e=this;this.preloadLatestUpdates(),d.options.getComponentData(d.dataService).then(function(t){e.nodesCache=t||[],e._buildUI(t||[]),e.reflectUpdates(),d.publish(i.EVENT_MY_EN_ITEM_READY)}).catch(function(t){e._buildUI([]),d.core.PersistencyManager.restoreViewForHomePage(this.models),d.publish(i.EVENT_MY_EN_ITEM_READY),o.errorAlert(d.i18nManager.get("error.dataNotRetrieved"))}),e._navigationTopBar=new s,e._navigationTopBar.init(d,p),e._navigationTopBar.setTitle(d.options.getTitle())},shouldUseDBRefreseh:function(){return"my_eng_items"===d.options.getViewName()&&d.core.sessionManager.isUsingDB()},preloadLatestUpdates:function(){this._authoredDataPromise=d.dataService.getUserRecentEditedEngineeringItems()},reflectUpdates:function(){var t=this;this._authoredDataPromise?(e.mask(u,d.i18nManager.get("processing.synchronization.with.server")),this._authoredDataPromise.then(function(n){if(Array.isArray(n)){var i={onlyUpdateExistingNodes:"recent_items"===d.options.getViewName(),additionalIds:d.dataService.recentsCache};t.models.mergeContent(n,i),t.nodesCache=t.models.getChildren(),t.models.core.PersistencyManager.restoreViewForHomePage(t.models),t.models.pushToTagger(),t.myResponsiveSetView&&t.myResponsiveSetView.updateCount(),e.unmask(u),t.switchView()}}).catch(function(e){console.error(e)})):t.switchView()},reRender:function(){this._buildUI(this.nodesCache),d.core.PersistencyManager.restoreViewForHomePage(this.models)},stop:function(){this.resizor&&this.resizor.detach(u),this.resizor=void 0,c.unsubscribe(this._refreshSubscription),d.publish(i.EVENT_SHOW_PROPERTIES,{nodes:[]}),this.destroyCurrentView(),this._navigationTopBar&&(this._navigationTopBar=void 0),this.models=null,d.core&&d.core.contextManager.setActiveDocument(null),n.cleanDroppable(u),d.emptyContainer(),d.unsubscribeAll()},destroyCurrentView:function(){if(this.myResponsiveSetView){this.myResponsiveSetView._modelEvents&&this.myResponsiveSetView._modelEvents.unsubscribe(this.PersistToken);try{this.myResponsiveSetView.destroy()}catch(e){console.error(e)}this.myResponsiveSetView=null}if(this.emptyView){try{this.emptyView.destroy()}catch(e){console.error(e)}this.emptyView=null}g.innerHTML=""},switchView:function(){this.myResponsiveSetView||this.emptyView?this.myResponsiveSetView&&this.isEmpty()?(this.destroyCurrentView(),this.renderEmptyView()):this.emptyView&&!this.isEmpty()&&(this.destroyCurrentView(),this.RenderSetView()):this.isEmpty()?this.renderEmptyView():this.RenderSetView()},isEmpty:function(){return!this.models||0===this.models.getChildren().length},renderEmptyView:function(){this.emptyView=d.core.moduleHelper.viewsService.getGridEmptyView(d.options.getViewName()),this.emptyView&&this.emptyView.inject(g)},_buildUI:function(n){var r=this,s=new a({core:d.core,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(e){return!0}});s._FilterBI.cleanProxy(),n&&s.addChild(n),e.unmask(u),this.models=s,d.core.contextManager.setActiveDocument(s),this.switchView(),d.subscribe(i.EVENT_DELETED_ENG_ITEM,function(e){for(var t=e.ids,n=[],i=s.getChildren(),o=0;o<i.length;o++)-1!=t.indexOf(i[o].getID())&&n.push(i[o]);s.prepareUpdate(),n.forEach(function(e){s.removeRoot(e)}),s.pushUpdate(),r.myResponsiveSetView.updateCount(),r.isEmpty()&&(r.destroyCurrentView(),r.renderEmptyView())}),d.subscribe(i.EVENT_REMOVED_FROM_RECENT,function(e){for(var t=e.nodes.map(function(e){return e.getID()}),n=[],i=s.getChildren(),o=0;o<i.length;o++)-1!=t.indexOf(i[o].getID())&&n.push(i[o]);s.prepareUpdate(),n.forEach(function(e){s.removeRoot(e)}),s.pushUpdate(),r.myResponsiveSetView.updateCount(),r.isEmpty()&&(r.destroyCurrentView(),r.renderEmptyView())}),r._refreshSubscription=c.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(e){var t=[];e.data.authored&&e.data.authored.modified&&e.data.authored.modified.forEach(function(e){"object"==typeof e?t.push(e.physicalid):t.push(e)}),d.dataService.getEngItemsData(t,!0).then(function(e){s.prepareUpdate(),e.forEach(function(e){var t=s.findNodesById(e.getID());t.length>0&&t.forEach(function(t){"ENOStrRefinementSpecification"===t.getType()||t.updateOptions(e.options)})}),s.pushUpdate()}).catch(function(e){console.error(e)})}),r._makeDroppable(),u.appendChild(p),u.appendChild(g),d.subscribe(i.EVENT_REFRESH_LANDING_DATA,function(){r.preloadLatestUpdates(),d.options.getComponentData(d.dataService).then(function(e){r.nodesCache=e||[],r.models&&r.models.syncContent(e||[]),r.myResponsiveSetView&&r.myResponsiveSetView.updateCount(),r.reflectUpdates()}).catch(function(e){console.error(e),o.errorAlert(d.i18nManager.get("error.dataNotRetrieved"))})}),d.subscribe(i.EVENT_TRIPTYCH_PANEL_VISIBLE,function(e){"right"===e&&d.core.PersistencyManager.setInformationPanelStatusForHomePage(!0)}),d.subscribe(i.EVENT_TRIPTYCH_PANEL_HIDDEN,function(e){"right"===e&&d.core.PersistencyManager.setInformationPanelStatusForHomePage(!1)}),d.subscribe(i.EVENT_TRIPTYCH_RESIZE_PANEL,e=>{const t=e?e.side:null,n=e?e.width:null;if("right"===t&&n){const e=d.core.PersistencyManager;e&&e.setInformationPanelWidth(n)}}),r.resizor=new t(u,function(){})},_makeDroppable:function(){var e,t=function(e){var t=new r({renderTo:e});return t.hide(),t}(u),s=this;n.makeDroppable({element:u,context:this,onDragEnter:function(){clearTimeout(e),s.isEmpty()||(t.addBorder(),t.show("drop")),u.hasClassName("dragging")||u.addClassName("dragging")},onDragLeave:function(){e=setTimeout(function(){s.isEmpty()||t.hide(),u.hasClassName("dragging")&&u.removeClassName("dragging")},200)},onDragOver:function(){s.isEmpty()||t.show("drop"),u.hasClassName("dragging")||u.addClassName("dragging")},onDrop:function(e,n){var r=null;s.isEmpty()||t.hide(),u.removeClassName("dragging");try{r=JSON.parse(e)}catch(e){return void o.errorAlert(d.i18nManager.get("error.parse.droppeddata.failed"))}d.core.settingManager.retrieveValidItemsForOpenFromDrop(r).then(function(e){Array.isArray(e)&&e.length>0&&d.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{objectId:e[0].objectId,objectType:e[0].objectType,biProxyCtx:e[0].biProxyCtx}}})}).catch(function(e){e&&e.message&&o.errorAlert(d.i18nManager.get(e.message))})}})},onFilterBIFilteringEvent:function(){},onMultiselClick:function(e){e&&(this.models.core.contextManager.setMultiselMenu(!0),this.models.getSelectedItemsCommonMenu(e.getBoundingClientRect()))},RenderSetView:function(){var e={views:[],keepDefaultViews:!0,models:this.models,withmultisel:!0,container:g,modelEvents:null,onCellDoubleClick:function(e){var t=e.cellModel;t&&d.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{objectId:t.getID(),objectType:t.getType()}}})},defaultView:d.options.getPreferredView(d.core.localStorage)||"Thumbnail",toolbar:{showItemCount:!0,multiselActionCallback:null,multiselActions:[],actions:[],sort:[{id:"Title",text:d.i18nManager.get("ds6w:label"),type:"string"},{id:"Maturity",text:d.i18nManager.get("ds6w:status"),type:"string"},{id:"Owner",text:d.i18nManager.get("ds6w:responsible"),type:"string"},{id:"CreationDate",text:d.i18nManager.get("ds6w:created"),type:"string"},{id:"ModifiedDate",text:d.i18nManager.get("ds6w:modified"),type:"string"}]}};this.myResponsiveSetView=new l(e),this.PersistToken=this.myResponsiveSetView._modelEvents.subscribe({event:"event-persist-view"},function(e){d.core.localStorage.setItem(d.options.getViewName()+"_view",e)})}}}}),define("DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialQuantityView","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r)=>{return class extends n{constructor(e){super(e),this._selectedItem=null}getQuantity(){return null}hasQuantity(){return null}get settings(){return null}showView(){const e=this.selectedItem.getAttributeValue("CoreMaterial"),n=this.selectedItem.getDisplayName(),i=this.getQuantity(this.selectedItem),{dimension:r,unit:o}=this.settings;new t(this.appCore,{title:this.options.appCore.i18nManager.replace(this.options.appCore.i18nManager.get(this.settings.title),{EngItem:n,mat:`${e} : ${i}`}),className:"change-material-quantity-dlg",withFooter:!0,onOk:this.onOk.bind(this),onCancel:this.onCancel.bind(this),dimOptions:{enable:!1,selected:r},unitOptions:{selected:widget.getValue(o)},inputOptions:{value:i}})}onOk(e,t){"function"==typeof t&&t();const{value:n}=e;(isNaN(n)||n<0)&&(console.warn("unexpected input value"),this.abort()),this._modifyEngineeringItem(e)}onCancel(){this.end()}abort(){const e=this.appCore.i18nManager.get("modifyQuantityFailed");r.errorAlert(e),this.end()}get selectedItem(){return this._selectedItem}async _modifyEngineeringItem({value:e,dimension:t,unit:n}){if(isNaN(e)||e<0)return void this.abort();const o=this.appCore.PreferencesManager.dimensions[this.settings.dimension].Units.find(e=>e.Name===n),s=this.selectedItem.getID(),a={items:[{physicalid:s,quantity:{name:t,value:e,unit:o.Name}}]};try{await this.appCore.dataService.modifyQuantityOnMaterial(a),this.appCore.mediator.publish(i.EVENT_REFRESH_ITEMS_BY_IDS,[s])}catch(e){let t="modifyQuantityFailed";if(Reflect.has(e,"response")){const{response:n}=e;if(Reflect.has(n,"internal")){const{internal:e}=n;switch(e){case"no right access":t="error.ERR_RightAccess"}}}r.errorAlert(this.appCore.i18nManager.get(t))}this.end()}execute(){const e=this.options.context.getSelectedNodes();if(!Array.isArray(e)||1!==e.length)return r.notifyAlert(this.appCore.i18nManager.get("eng.materialQuantity.notif.multiselection")),void this.end();[this._selectedItem]=e,this.hasQuantity(this._selectedItem)?this.showView():this.end()}}}),define("DS/ENOXEngineer/commands/ChangeMassQuantityCmd",["DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd","UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n)=>{return class extends e{getQuantity(e){return t.is(e)?e.getMassQuantity():null}hasQuantity(e){return!!t.is(e)&&e.hasMassQuantity()}get settings(){return{title:"eng.ui.dialog.changeMaterialQuantity",dimension:n.DIMENSION_MASS,unit:n.PREFERRED_MASS_UNIT}}}}),define("DS/ENOXEngineer/commands/ChangeVolumeQuantityCmd",["DS/ENOXEngineer/commands/ChangeMaterialQuantityCmd","UWA/Core","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n)=>{return class extends e{getQuantity(e){return t.is(e)?e.getVolumeQuantity():null}hasQuantity(e){return!!t.is(e)&&e.hasVolumeQuantity()}get settings(){return{title:"eng.ui.dialog.changeMaterialQuantity",dimension:n.DIMENSION_VOLUME,unit:n.PREFERRED_VOLUME_UNIT}}}}),define("DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/I18nManager","DS/ENOXEngineer/utils/XENHttpClient"],function(e,t,n,i,r,o,s){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){e&&(this.appCore=e.appCore||{})},getName:function(){return"convertingColumns"},buildServerInput:function(e){if(!Array.isArray(e))return null;var t={};return e.forEach(function(e){t[e.dimension]||(t[e.dimension]={}),t[e.dimension][e.toUnit]||(t[e.dimension][e.toUnit]={values:[]}),null!==e.value&&void 0!==e.value&&(Array.isArray(e.value)?t[e.dimension][e.toUnit].values.push(...e.value):t[e.dimension][e.toUnit].values.push(e.value))}),{mapping:t,inputs:this._fromMappingToInput(t)}},_fromMappingToInput:function(e){var t=Object.keys(e),n=[];return t.forEach(function(t){Object.keys(e[t]).forEach(function(i){var r=e[t][i];n.push({values:[...new Set(r.values)],dimension:t,toUnit:i})})}),n},parseAndMapResponse:function(e,t){var n={};t.forEach(function(e){var t=e.dimension+e.toUnit;n[t]||(n[t]={}),e.values.forEach(function(e){n[t][e.from]=e.to})});var i={};return e.forEach(function(e){i[e.pid]||(i[e.pid]={});var t=e.dimension+e.toUnit;Array.isArray(e.value)?i[e.pid][e.sixw+"_converted"]=n[t]&&e.value.map(e=>n[t][e])||null:i[e.pid][e.sixw+"_converted"]=n[t]&&n[t][e.value]||null}),{pids:i}},isRawMaterialUnits:function(e){return e==r.CONT_RAWMAT_QUANTITY_LENGTH||e==r.CONT_RAWMAT_QUANTITY_MASS||e==r.CONT_RAWMAT_QUANTITY_AREA||e==r.CONT_RAWMAT_QUANTITY_VOLUME},updateAttributes:function(e,t){if(!Array.isArray(e))return t([]);var n=this,i=this.buildServerInput(e).inputs.filter(function(e){if(e&&Array.isArray(e.values)&&e.values.length>0){var t=e.values.filter(function(e){return!!e});if(t.length>0)return e.values=t,!0}return!1});Array.isArray(i)&&this.appCore.dataService.dimensionsUnitsConverter(i).then(function(i){t(n.parseAndMapResponse(e,i))}).catch(function(e){console.error(e)})}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitFetchService",["DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XENHttpClient"],(e,t)=>{return class{constructor(e){this.viewContext=e}async fetchUnits(n,i){const r=this.buildPayload(n,i);try{const n=await t.perform(e.getCommand("getOccurrencesEffectivitiesAsUnits"),r);return this.parseUnitsAnswer(n)}catch(e){return[]}}parseUnitsAnswer(e){const{occurrences:t,GlobalStatus:n}=e||{};if("Success"!==n||!Array.isArray(t))return null;const i=new Map;return t.forEach(({pids:e,status:t,viewCurrentUnits:n})=>{if("Success"===t){const t=this.convertPidsToOcc(e);if("string"==typeof t&&t.trim().length){const e=JSON.parse(n);Array.isArray(e)&&e.forEach(e=>{i.has(e)?i.get(e).push(t):i.set(e,[t])})}}}),i}convertPidsToOcc(e){return"string"==typeof e&&e.trim().length?e.slice(1,-1).split(",").map(e=>e.trim()).join("/"):""}buildPayload(e,t){return Array.isArray(e)&&e.length&&t&&t.trim().length?{version:"1.0",modelIdentifier:t,withBinaries:"FALSE",view:"Current",unitsXML:"FALSE",occurrences:e.map(e=>({path:e.split("/").map(e=>({instanceIdentifier:e}))}))}:null}}}),define("DS/ENOXEngineer/services/ColumnsMgtService",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/MaturityUtils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOX3DSpaceAttributesMgt/services/predicatesServices","text!DS/ENOXEngineer/assets/config/ColumnsMetas.json"],function(e,t,n,i,r,o,s,a,l){"use strict";var c=JSON.parse(l),d=null;return t.singleton({init:function(e){this._parent(e)},initialize:function(e){d=e;return this.logger=d.core.logger.get("Columns Manager"),this.logger.info(" initializing Xeng Columns Manager services"),e.core.columnsManager=e.sandboxBase.columnsManager=this,this.i18nManager=d.core.i18nManager,this.loadedProviders=null,Object.defineProperty(this,"useArrayCellTypeRepresentation",{get:()=>!1,configurable:!0}),this._loadColumnsProviders()},isProvidedColumn:function(e){return!!e&&this.getVisibleAdditionalColumns().some(function(t){return t.dataIndex===e})},getVisibleAdditionalColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag&&e.isAdditionalColumn})},getVisibleColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag})},getAvailableColumnsWithNls:function(){return(this.getAvailableColumns()||[]).map(function(e){return e.ds6w?e.text=d.core.i18nManager.get(e.ds6w):e.text=d.core.i18nManager.get(e.dataIndex),e})},getAvailableColumns:function(){var e=d.core.dicoService.getUserDicoPreferences()?d.core.dicoService.getUserDicoPreferences().columns:[],t={};return e.forEach(function(e){t[e.dataIndex]=!0}),this.getAllProvidedColumns().forEach(function(n){t[n.dataIndex]||e.push(n)}),t=null,e},getDatagridViewColumns:function(e){var t=this,n=d.core.sessionManager.shouldShowQuantityView();this.getMappingOfAdditionalColumns(!0);var i=this.getVisibleColumns();return i=this.removeColumnsBasedOnView(i),n?i.map(function(e){var n=e.isAdditionalColumn?t.getAdditionalColumnDefinitionInReferenceView(e.dataIndex):t.getColumnDefinition(e.dataIndex);return n&&(n.pinned=e&&e.pinned?e.pinned:n.pinned),n}).filter(function(e){return e}):i.map(function(e){var n=e.isAdditionalColumn?t.getAdditionalColumnDefinition(e.dataIndex):t.getColumnDefinition(e.dataIndex);return n&&(n.pinned=e&&e.pinned?e.pinned:n.pinned),n}).filter(function(e){return e})},removeColumnsBasedOnView:function(e){let t=[];return d.core.sessionManager.shouldShowLeafMaterials()&&(t.push("MadeFrom"),e=e.filter(e=>!e.ds6wFrom||"rel"!=e.ds6wFrom||"occurence"==e.dataIndex)),d.core.sessionManager.shouldShowLeafMaterials()||t.push("rollup"),d.core.sessionManager.shouldShowQuantityView()&&t.push("CoveringMaterialInstance"),d.core.sessionManager.shouldShowQuantityView()||t.push("quantity"),d.core.sessionManager.shouldShowFlatView()||t.push("level"),e=e.filter(function(e){return-1===t.indexOf(e.dataIndex)})},getColumnMetas:function(e){return c.managedColumns[e]&&c.managedColumns[e].options?c.managedColumns[e].options:{}},publishNodesToRefresh:function(e){Array.isArray(e)&&d.core.mediator.publish(i.EVENT_REFRESH_ITEMS_BY_IDS,e)},getColumnDefinition:function(t){if(!t)return null;var n=this,s="quantity"!==t&&"rollup"!=t?d.core.dicoService.getAttributeMetas(t):{kind:"string",dataIndex:t};let a=n.i18nManager.get(s.ds6w);const l=n.i18nManager.get("eng.export.instance.key");a=s.ds6wFrom&&"rel"===s.ds6wFrom?a+` (${l})`:a;var c=s.description;let u=null;switch(d.core.sessionManager.isUsingDB()&&"computed"===s.nature&&!s.dbName?(u={fontIconFamily:1,iconName:"attention dgv-header-icon"},c=n.i18nManager.get("data-index-not-available-authoring-mode").replace("{dataIndex}",a)):(c=n.i18nManager.get(s.ds6w),"rel"===s.ds6wFrom&&(c=n.i18nManager.replace(n.i18nManager.get("tooltip_Instance_Column"),{label:n.i18nManager.get(s.ds6w)}))),t){case"tree":return e.extend(this.getColumnMetas("tree"),{text:a,icon:u,description:c,getCellValue:function(e){return e&&e.nodeModel?{icon:e.nodeModel.getTypeIcon(),label:e.nodeModel.options.label,url:"#UNEXISTANT_ID"}:{}},setCellValue:function(e,t){n._setCellValue(e,"tree",t.label)},getCellValueForCopy:function(e){return e.cellModel.label},processCellValueFromPaste:function(e,t){return{label:t}},getCellEditableState:function(e){return e&&e.nodeModel&&e.nodeModel.isCoreMaterialType&&e.nodeModel.isCoreMaterialType instanceof Function&&!e.nodeModel.isCoreMaterialType()},getCellGroupingKey:function(e){return e.nodeModel.options.grid["ds6w:label"]}});case"level":return{text:n.i18nManager.get(s.ds6w),description:c,dataIndex:t,getCellValue:function(e){return e.nodeModel.options.grid[t]}};case"ds6wg:revision":return e.extend(this.getColumnMetas("ds6wg:revision"),{text:a,icon:u,description:c,getCellValue:function(e){return e&&e.nodeModel?{label:e.nodeModel.options.grid[t]?e.nodeModel.options.grid[t]:"",url:"#UNEXISTANT_ID"}:{}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]}});case"ds6w:modified":case"ds6w:created":return{text:a,dataIndex:t,icon:u,description:c,getCellValue:function(e){return r.getformatedDate(e.nodeModel.options.grid[t])}};case"occurence":return{text:n.i18nManager.get(s.ds6w),dataIndex:t,description:c,sortableFlag:!1,getCellValue:function(e){return n._getCellValue(e,s,"occurenceTitle")}};case"ds6w:reservedBy":case"ds6w:type":case"ds6w:identifier":case"ds6w:project":return{text:a,dataIndex:t,description:c,icon:u};case"ds6w:reserved":return e.extend(this.getColumnMetas(t),{text:a,icon:u,description:c,getCellValue:function(e){if(e&&e.nodeModel){if(!e.nodeModel._isFromOriginalModel()&&!e.nodeModel.isEngineeringItem())return"N/A";var n=d.core.settingManager.getUserName();return e.nodeModel.isDocument()?"N/A":"FALSE"===e.nodeModel.options.grid[t]?d.core.settingManager.getIconPath("I_CheckIn"):e.nodeModel.options.grid["ds6w:reservedBy"]==n?d.core.settingManager.getIconPath("I_lock"):d.core.settingManager.getIconPath("I_ReservedByOthers")}},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]}});case"ds6w:status":return e.extend(this.getColumnMetas(t),{text:a,icon:u,kind:"tag",minWidth:50,typeRepresentation:"tag",className:"lc-maturity-state",description:c,getCellValue:function(e){return e&&e.nodeModel?void 0===e.nodeModel.options.grid[t]?"":e.nodeModel.options.grid[t]:{}},getCellClassName:function(e){if(e.nodeModel){var t,n=e.nodeModel.options.grid[i.CONST_CURRENT_OBJECT_MATURITY_STATE],r=d.core.settingManager.getSetting("defaultPolicies");if(n){if(!1===n.contains(".")){var s=e.nodeModel.getReferenceValue("ds6w:policy");s&&d.core.dataService.getStatesAttributes([s]),n=s?s+"."+n:r[0]+"."+n}t=o.getAndCreateMaturityClass(n,"wux-controls-label")}return t}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]}});case"ds6w:responsible":return e.extend(this.getColumnMetas(t),{text:a,icon:u,className:"xen-owner-icon",description:c,getCellValue:function(e){if(!e||!e.nodeModel||!e.nodeModel._isFromOriginalModel())return{};let n=d.core.settingManager.getCurrentUser&&d.core.settingManager.getCurrentUser()&&d.core.settingManager.getCurrentUser().id?d.core.settingManager.getCurrentUser().id:null,i=e.nodeModel.options.grid.owner?e.nodeModel.options.grid.owner:n;return{icon:d.core.settingManager.get3DswymUrl&&d.core.settingManager.get3DswymUrl()&&i?d.core.settingManager.getUserImage(i):"fonticon fonticon-user-alt",label:void 0===e.nodeModel.options.grid[t]?"":e.nodeModel.options.grid[t],url:"#UNEXISTANT_ID"}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]}});case"ds6w:label-Instance":return e.extend(this.getColumnMetas(t),{text:a,icon:u,description:c,getCellEditableState:function(e){return e&&e.nodeModel&&(e.nodeModel.isEngineeringItem()||e.nodeModel.isDrawing())&&!("reference"===e.nodeModel.getViewType())},setCellValue:function(e,i){n._setCellValue(e,t,i)},getCellValue:function(e){return n._getCellValue(e,s,t)}});case"ds6wg:EnterpriseExtension.V_PartNumber":return e.extend(this.getColumnMetas(t),{text:a,icon:u,description:c,getCellValue:function(e){return e&&e.nodeModel?e.nodeModel.isEngineeringItem()&&!1!==e.nodeModel._isFromOriginalModel()?{label:e.nodeModel.options.grid[t]?e.nodeModel.options.grid[t]:n.i18nManager.get("None"),url:"#UNEXISTANT_ID"}:{label:"",url:"#UNEXISTANT_ID"}:{}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]}});case"ds6wg:PLMReference.V_isLastVersion":return e.extend(this.getColumnMetas(t),{text:a,icon:u,description:c,getCellValue:function(e){if(!e||!e.nodeModel)return null;var n=e.nodeModel.options.grid[t];return""!==n&&void 0!==n?"true"==n.toLowerCase():void 0},getCellClassName:function(e){if(!e||!e.nodeModel)return null;let n=e.nodeModel.options.grid[t];return n&&"true"==n.toLowerCase()?"xeng-lastRev-column-check":"xeng-lastRev-column-close"}});case"ds6w:description":return e.extend(this.getColumnMetas(t),{text:a,icon:u,description:c,setCellValue:function(e,i){i=i.trim(),n._setCellValue(e,t,i)},getCellEditableState:function(e){return e&&e.nodeModel&&!e.nodeModel.isCoreMaterialType()}});case"ds6w:cadMaster":return e.extend(this.getColumnMetas(t),{text:a,icon:u,description:c,getCellValue:function(e){if(e&&e.nodeModel)return!e.nodeModel.isEngineeringItem()&&!e.nodeModel.isRepresentation()||e.nodeModel.isCoreMaterialType()?"N/A":d.core.Factories.ListItemFactory.getCADIcon(e.nodeModel.options.grid[t])},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]}});case i.CONT_QUANTITY_MASS:return e.extend(this.getColumnMetas(t),{text:n.i18nManager.get("quantity_column_header").replace("{header}",n.i18nManager.get(t)).replace("{unit}",d.core.PreferencesManager.getNLSValueForMassQuantity()),icon:u,description:n.i18nManager.get("quantity_column_header").replace("{header}",n.i18nManager.get(t)).replace("{unit}",d.core.PreferencesManager.getNLSValueForMassQuantity()),getCellValue:function(e){if(!e||!e.nodeModel)return{};if(!e.nodeModel.isEngineeringItem())return{label:"",url:i.UNEXISTANT_ID};let t=e.nodeModel.getMassQuantity();return t&&0!==t.trim().length||(t=""),{label:t,url:i.UNEXISTANT_ID}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){let t=e.nodeModel.getMassQuantity();return t&&0!==t.trim().length||(t=""),t}});case i.CONT_QUANTITY_VOLUME:return e.extend(this.getColumnMetas(t),{text:n.i18nManager.get("quantity_column_header").replace("{header}",n.i18nManager.get(t)).replace("{unit}",d.core.PreferencesManager.getNLSValueForVolumeQuantity()),icon:u,description:n.i18nManager.get("quantity_column_header").replace("{header}",n.i18nManager.get(t)).replace("{unit}",d.core.PreferencesManager.getNLSValueForVolumeQuantity()),getCellValue:function(e){if(!e||!e.nodeModel)return{};if(!e.nodeModel.isEngineeringItem())return{label:"",url:i.UNEXISTANT_ID};let t=e.nodeModel.getVolumeQuantity();return t&&0!==t.trim().length||(t=""),{label:t,url:i.UNEXISTANT_ID}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){let t=e.nodeModel.getVolumeQuantity();return t&&0!==t.trim().length||(t=""),t}});case"quantity":return e.extend(this.getColumnMetas(t),{text:d.core.sessionManager.shouldShowLeafMaterials()||d.core.sessionManager.shouldShowFinalItems()?n.i18nManager.get("occurences"):n.i18nManager.get("instances"),description:d.core.sessionManager.shouldShowLeafMaterials()||d.core.sessionManager.shouldShowFinalItems()?n.i18nManager.get("occurences"):n.i18nManager.get("instances"),getCellValue:function(e){var t=e.nodeModel;return{label:t._isFromOriginalModel()?t.getUsedQuantity():null,url:"#UNEXISTANT_ID"}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){const t=e.nodeModel;let n=t._isFromOriginalModel()?t.getUsedQuantity():null;return(!n||"string"==typeof n&&0===n.trim().length)&&(n=""),n}});case"rollup":return e.extend(this.getColumnMetas(t),{text:n.i18nManager.get("rollup"),description:n.i18nManager.get("rollup"),editableFlag:!1,getCellValue:function(e){var t=e.nodeModel;return t._isFromOriginalModel()?t.getRollUpMaterials():null},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){let t=node._isFromOriginalModel()?node.getRollUpMaterials():null;return t&&0!==t.trim().length||(t=""),t}});case"Thumbnail":return e.extend(this.getColumnMetas(t),{text:n.i18nManager.get(t),description:n.i18nManager.get(t),getCellValue:function(e){return e&&e.nodeModel&&e.nodeModel.options.grid[t]?e.nodeModel.options.grid[t]:void 0}});case"ds6w:organizationResponsible":case"ds6w:organizationResponsible-Instance":case"ds6w:project-Instance":return e.extend(this.getColumnMetas(t),{text:a,dataIndex:t,editableFlag:!1,description:c,icon:u,getCellValue:function(e){return n._getCellValue(e,s,t)}});case"ds6w:kind":case"ds6w:kind-Instance":return e.extend(this.getColumnMetas(t),{text:a,dataIndex:t,editableFlag:!1,description:c,icon:u,getCellValue:function(e){if(!e||!e.nodeModel)return;const n=new Set;if("rel"===s.ds6wFrom&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){return e.nodeModel.getUsages().forEach(e=>{let i=d.core.settingManager.getSetting("mapSubTypeNLSKey")[e.options.grid[t]];i=i?d.core.i18nManager.get(i):e.options.grid[t],n.add(i)}),[...n]}{let n=d.core.settingManager.getSetting("mapSubTypeNLSKey")[e.nodeModel.options.grid[t]];return n?d.core.i18nManager.get(n):e.nodeModel.options.grid[t]}}});default:if(s){let e,i=d.core.dicoService.getRangeValueAttribute(s.ds6w),o=d.core.dicoService.isMultiValuedAttribute(s.ds6w);if(s.attrDim&&s.attrUnit&&(e=this.getUnitLabelForDimension(s.attrDim,s.attrUnit)),o){if(s.kind&&-1!==["datetime","timestamp"].indexOf(s.kind.toLowerCase()))return{text:a,typeRepresentation:"date",dataIndex:t,editableFlag:!1,description:c,icon:u,getCellValue:function(e){return n._getCellValue(e,s,t)}};if(!Reflect.has(s,"editable"))return{text:a,dataIndex:t,editableFlag:!1,description:c,icon:u,getCellValue:function(e){return n._getCellValue(e,s,t)}}}if(i&&"Boolean"!==i.type){const e=r.getAlphaNumericName(s.ds6w);return{text:a,dataIndex:t,editableFlag:!0,description:c,typeRepresentation:e,editionPolicy:"EditionOnDoubleClick",icon:u,getCellTypeRepresentation:function(i){return n.getCellTypeRepresentation(i,s,t,e)},getCellEditableState:function(e){return e&&e.nodeModel&&e.nodeModel.isEngineeringItem()&&!e.nodeModel.isCoreMaterialType()&&!("rel"===s.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&n.isAnEditablePredicate(t)},setCellValue:function(e,i){i=i.toString(),n._setCellValue(e,t,i)},getCellValue:function(e){return n._getCellValue(e,s,t)}}}if(s.kind&&-1!==["datetime","timestamp"].indexOf(s.kind.toLowerCase())){const e="date";return{text:a,dataIndex:t,editableFlag:!0,typeRepresentation:e,description:c,editionPolicy:"EditionOnDoubleClick",icon:u,getCellTypeRepresentation:function(i){return n.getCellTypeRepresentation(i,s,t,e)},getCellEditableState:function(e){return e&&e.nodeModel&&e.nodeModel.isEngineeringItem()&&!e.nodeModel.isCoreMaterialType()&&!("rel"===s.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&n.isAnEditablePredicate(t)},getCellValue:function(e){if(!e||!e.nodeModel)return;const n=new Set;if(e&&e.nodeModel){if("rel"===s.ds6wFrom&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){e.nodeModel.getUsages().forEach(e=>{if(e.options.grid[t]&&""!==e.options.grid[t].trim()&&"NULL"!==e.options.grid[t].trim()){var i=e.options.grid[t];i=r.convertDateNodeValueToCellValue(e,t),n.add(i)}});const i=[...n];return 1==i.length?i[0]:i}var i=e.nodeModel.options.grid[t];return i&&"NULL"!==i?r.convertDateNodeValueToCellValue(e.nodeModel,t):null}},setCellValue:function(e,i){null!==i&&(i=(i=new Date(i)).toGMTString(),n._setCellValue(e,t,i))}}}if(s.kind&&"boolean"===s.kind.toLowerCase()){const e=!0===d.core.sessionManager.shouldShowQuantityView()&&"rel"===s.ds6wFrom?"string":"boolean";return{text:a,dataIndex:t,editableFlag:!0,typeRepresentation:e,description:c,editionPolicy:"EditionOnDoubleClick",icon:u,getCellTypeRepresentation:function(i){return n.getCellTypeRepresentation(i,s,t,e)},getCellEditableState:function(e){return e&&e.nodeModel&&e.nodeModel.isEngineeringItem()&&!e.nodeModel.isCoreMaterialType()&&!("rel"===s.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&n.isAnEditablePredicate(t)},getCellValue:function(e){const n=new Set;if(!e||!e.nodeModel)return null;if("rel"===s.ds6wFrom&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){return e.nodeModel.getUsages().forEach(e=>{var i=e.options.grid[t];"string"==typeof i&&""!==i.trim()?n.add(r.convertBooleanNodeValueToCellValue(e,t)):"boolean"==typeof i&&n.add(i)}),[...n]}var i=e.nodeModel.options.grid[t];return"string"==typeof i&&""!==i.trim()?r.convertBooleanNodeValueToCellValue(e.nodeModel,t):"boolean"==typeof i?i:void 0},setCellValue:function(e,i){i=i.toString(),n._setCellValue(e,t,i)}}}if(s.kind&&"integer"===s.kind.toLowerCase()){const e="integer";return{text:a,dataIndex:t,editableFlag:!0,typeRepresentation:e,allowResetToUndefinedByUIFlag:!0,description:c,editionPolicy:"EditionOnDoubleClick",icon:u,getCellTypeRepresentation:function(i){return n.getCellTypeRepresentation(i,s,t,e)},getCellEditableState:function(e){return!(!e||!e.nodeModel)&&(e.nodeModel.isEngineeringItem()&&!e.nodeModel.isCoreMaterialType()&&!("rel"===s.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&n.isAnEditablePredicate(t))},compareFunction:function(e,t){return e&&t?parseInt(e)-parseInt(t):0},getCellValue:function(e){if(e&&e.nodeModel){if("rel"===s.ds6wFrom&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){const n=new Set;return e.nodeModel.getUsages().forEach(e=>{e.options.grid[t]&&""!==e.options.grid[t].trim()&&n.add(r.convertIntegerNodeValueToCellValue(e,t))}),[...n]}return r.convertIntegerNodeValueToCellValue(e.nodeModel,t)}},setCellValue:function(e,i){i=null!=i?i.toString():"",n._setCellValue(e,t,i)}}}if(s.kind&&"real"===s.kind.toLowerCase()){const i="float";var p=s.attrUnit&&s.attrUnit.length>0;if(e)var g=e&&e.NLSName?" ("+e.NLSName+")":" ("+s.attrUnit+")";return{text:a+(p?g:""),dataIndex:t,editableFlag:!0,sortableFlag:!p||!d.core.contextManager.getActiveEngItem().getContentModels().areAttributesWithDimensionPartiallyConverted(),groupableFlag:!p||!d.core.contextManager.getActiveEngItem().getContentModels().areAttributesWithDimensionPartiallyConverted(),typeRepresentation:i,allowResetToUndefinedByUIFlag:!0,description:d.core.contextManager.getActiveEngItem().getContentModels().areAttributesWithDimensionPartiallyConverted()?n.i18nManager.get("warning.column.limitation.largeData"):c,editionPolicy:"EditionOnDoubleClick",icon:u,getCellTypeRepresentation:function(e){return n.getCellTypeRepresentation(e,s,t,i)},getCellEditableState:function(e){return e&&e.nodeModel&&e.nodeModel.isEngineeringItem()&&!e.nodeModel.isCoreMaterialType()&&!("rel"===s.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&n.isAnEditablePredicate(t)},compareFunction:function(e,t){return e&&t?parseFloat(e)-parseFloat(t):0},getCellValue:function(e){const n=new Set;if(e&&e.nodeModel&&e.nodeModel.isEngineeringItem()){if("rel"===s.ds6wFrom&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){return e.nodeModel.getUsages().forEach(e=>{e.options.grid[t]&&""!==e.options.grid[t].trim()&&(s.attrUnit&&0!=s.attrUnit.trim().length?n.add(r.convertRealNodeValueToCellValue(e,`${t}_converted`)):n.add(r.convertRealNodeValueToCellValue(e,t)))}),[...n]}return s.attrUnit&&0!=s.attrUnit.trim().length?r.convertRealNodeValueToCellValue(e.nodeModel,`${t}_converted`):r.convertRealNodeValueToCellValue(e.nodeModel,t)}},setCellValue:function(e,i){i=null!=i?i.toString():"",e.nodeModel.options.grid[t+"_converted"]=i,n._setCellValue(e,t,i)}}}{const e="string";return{text:a,dataIndex:t,editableFlag:!0,description:c,editionPolicy:"EditionOnDoubleClick",icon:u,getCellTypeRepresentation:function(i){return n.getCellTypeRepresentation(i,s,t,e)},getCellEditableState:function(e){return e&&e.nodeModel&&e.nodeModel.isEngineeringItem()&&!e.nodeModel.isCoreMaterialType()&&!("rel"===s.ds6wFrom&&"reference"===e.nodeModel.getViewType())&&n.isAnEditablePredicate(t)},setCellValue:function(e,i){n._setCellValue(e,t,i)},getCellValue:function(e){return n._getCellValue(e,s,t)}}}}}},getDimensionDetails:function(e){if(e&&d.core.PreferencesManager.dimensions&&d.core.PreferencesManager.dimensions.listOfUnits&&Array.isArray(d.core.PreferencesManager.dimensions.listOfUnits.results))return d.core.PreferencesManager.dimensions.listOfUnits.results.find(t=>t.Name===e)},getUnitLabelForDimension:function(e,t){if(d.core.PreferencesManager.dimensions&&d.core.PreferencesManager.dimensions.listOfUnits){let n=this.getDimensionDetails(e);if(Array.isArray(n.Units))return n.Units.find(e=>e.Name===t)}},getCellTypeRepresentation:function(e,t,n,i){if(!(t&&n&&e&&e.nodeModel))return i;const r=this.useArrayCellTypeRepresentation?`array<${i}>`:"string";return"rel"===t.ds6wFrom&&"function"==typeof e.nodeModel.getUsages&&Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1||Array.isArray(e.nodeModel.getAttributeValue(n))?r:i},_getCellValue:function(t,n,i){if(t&&t.nodeModel){if("rel"===n.ds6wFrom&&Array.isArray(t.nodeModel.getUsages())&&t.nodeModel.getUsages().length>=1){let o=new Set;return t.nodeModel.getUsages().forEach(t=>{const s=t.options.grid[i];if(s&&e.is(s,"string")&&""!==s.trim())o.add(s);else if(Array.isArray(s)&&s.length>=1){if(n.kind&&-1!==["datetime","timestamp"].indexOf(n.kind.toLowerCase()))return s.forEach(e=>{o.add(e)}),1==(o=[...o]).length?o[0].map(r.formatCustomDateAttribute.bind(r)):o.map(r.formatCustomDateAttribute.bind(r));s.forEach(e=>{o.add(e)})}}),[...o]}return t.nodeModel.options.grid[i]}},getAdditionalColumnDefinition:function(t){var n=this,r=this.getMappingOfAdditionalColumns()[t];if(r){var o={text:r.text,dataIndex:r.dataIndex,maxWidth:r.maxWidth,minWidth:r.minWidth,width:r.width,icon:r.icon,sortableFlag:!1,groupableFlag:!1,description:n.i18nManager.replace(n.i18nManager.get("warning.column.limitation"),{columnName:r.text})};return-1!==["Effectivity","ProjectedEvolutionEffectivity","Configuration","EvolutionEffectivity","ConfigurationRevision"].indexOf(r.dataIndex)||-1!==["VariantEffectivity"].indexOf(r.dataIndex)&&!d.core.settingManager.isConfigAuthorized()||-1!==["VariantEffectivity","CurrentEvolutionEffectivity"].indexOf(r.dataIndex)&&(d.core.sessionManager.shouldShowFinalItems()||d.core.sessionManager.shouldShowFlatView())?e.extend(o,{getCellValue:function(e){if(e&&e.nodeModel){if(!e.nodeModel.isEngineeringItem())return"";var t=e.nodeModel.options.grid[r.dataIndex];return!t||e.nodeModel.isAttributePending(r.dataIndex)?t="reference"===e.nodeModel.getViewType()?"":n.i18nManager.get("loading"):"Configuration"==r.dataIndex&&0===t.trim().length?t="":"function"==typeof t.trim&&0===t.trim().length&&(t=n.i18nManager.get("None")),t}}}):e.extend(o,{typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(!e||!e.nodeModel)return{};if(!e.nodeModel.isEngineeringItem())return{label:"",url:"#UNEXISTANT_ID"};var t=e.nodeModel.options.grid[r.dataIndex];if(r.dataIndex==i.CONST_SPEC_RELATION_COLUMN_DATAINDEX){var o="",s="";return t>0&&(o=n&&n.loadedProviders&&n.loadedProviders.SpecificationDocumentsColumnsProvider?n.loadedProviders.SpecificationDocumentsColumnsProvider.columnsPreference.patterns.v6_specdoc_to.typeRepresentations.v6_specdoc_toCheck.semantics.icon:{iconName:"docs",fontIconFamily:1}),{icon:o,label:s,url:"#UNEXISTANT_ID"}}if(t=t?t.replace("\n",""):t,"Alternate"==r.dataIndex){o="",s="";return"Yes"==t?o="fonticon fonticon-exchange alternateColumn":""!=t&&e.nodeModel.isAttributePending(r.dataIndex)&&(s=""),{icon:o,label:s,url:"#UNEXISTANT_ID"}}return-1!==["CoreMaterial","CoveringMaterial","CoveringMaterialInstance","MadeFrom",i.CONST_DEFORMABLE].indexOf(r.dataIndex)?(!t||e.nodeModel.isAttributePending(r.dataIndex)?t=n.i18nManager.get("loading"):"function"==typeof t.trim&&0===t.trim().length&&(t=r.dataIndex===i.CONST_DEFORMABLE?"":n.i18nManager.get("None")),{label:t,dataIndex:r.dataIndex,url:"#UNEXISTANT_ID"}):(!t||e.nodeModel.isAttributePending(r.dataIndex)?t="reference"===e.nodeModel.getViewType()?"":n.i18nManager.get("loading"):0===t.trim().length&&(t=n.i18nManager.get("None")),{label:t,url:"#UNEXISTANT_ID"})},getCellValueForCopy:function(e){return e.cellModel.label}})}},getAdditionalColumnDefinitionInReferenceView:function(t){var n=this,r=this.getMappingOfAdditionalColumns()[t];if(r){var o={text:r.text,dataIndex:r.dataIndex,maxWidth:r.maxWidth,minWidth:r.minWidth,width:r.width,icon:r.icon,sortableFlag:!1,groupableFlag:!1,description:n.i18nManager.replace(n.i18nManager.get("warning.column.limitation"),{columnName:r.text})};return-1!==["Effectivity","ProjectedEvolutionEffectivity","Configuration","EvolutionEffectivity"].indexOf(r.dataIndex)||-1!==["VariantEffectivity"].indexOf(r.dataIndex)&&!d.core.settingManager.isConfigAuthorized()||-1!==["VariantEffectivity","CurrentEvolutionEffectivity"].indexOf(r.dataIndex)&&(d.core.sessionManager.shouldShowFinalItems()||d.core.sessionManager.shouldShowQuantityView()||d.core.sessionManager.shouldShowFlatView())?e.extend(o,{getCellValue:function(e){if(!e||!e.nodeModel)return;if(!e.nodeModel.isEngineeringItem())return"";const i=new Set;if(Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){e.nodeModel.getUsages().forEach(function(e){e.options.grid[t]&&""!==e.options.grid[t].trim()&&i.add(e.options.grid[t])});var o=[...i]}return!o||e.nodeModel.isAttributePending(r.dataIndex,o)?o=n.i18nManager.get("loading"):"Configuration"==r.dataIndex&&0===o.length?o="":Array.isArray(o)&&0===o.length&&(o=n.i18nManager.get("None")),o}}):e.extend(o,{typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(!e||!e.nodeModel)return{};if(!e.nodeModel.isEngineeringItem())return{label:"",url:"#UNEXISTANT_ID"};const o=new Set;if(Array.isArray(e.nodeModel.getUsages())&&e.nodeModel.getUsages().length>=1){r.dataIndex==i.CONST_DEFORMABLE?o.add(e.nodeModel.options.grid[t]):e.nodeModel.getUsages().forEach(function(e){t==i.CONST_SPEC_RELATION_COLUMN_DATAINDEX?e.options.grid[t]&&o.add(e.options.grid[t]):e.options.grid[t]&&""!==e.options.grid[t].trim()&&o.add(e.options.grid[t])});var s=[...o]}if(r.dataIndex==i.CONST_SPEC_RELATION_COLUMN_DATAINDEX){var a="",l="";return s>0&&(a=n&&n.loadedProviders&&n.loadedProviders.SpecificationDocumentsColumnsProvider?n.loadedProviders.SpecificationDocumentsColumnsProvider.columnsPreference.patterns.v6_specdoc_to.typeRepresentations.v6_specdoc_toCheck.semantics.icon:{iconName:"docs",fontIconFamily:1}),{icon:a,label:l,url:"#UNEXISTANT_ID"}}if("Alternate"==r.dataIndex){a="",l="";return"Yes"==s?a="fonticon fonticon-exchange alternateColumn":""!=s&&e.nodeModel.isAttributePending(r.dataIndex)&&(l=""),{icon:a,label:l,url:"#UNEXISTANT_ID"}}return-1!==["CoreMaterial","CoveringMaterial","MadeFrom",i.CONST_DEFORMABLE].indexOf(r.dataIndex)?(!s||e.nodeModel.isAttributePending(r.dataIndex)?s=n.i18nManager.get("loading"):Array.isArray(s)&&0===s.length&&(s=r.dataIndex===i.CONST_DEFORMABLE?"":n.i18nManager.get("None")),{label:s,dataIndex:r.dataIndex,url:"#UNEXISTANT_ID"}):(!s||e.nodeModel.isAttributePending(r.dataIndex,s)?s=n.i18nManager.get("loading"):Array.isArray(s)&&0===s.length&&(s=n.i18nManager.get("None")),{label:s,url:"#UNEXISTANT_ID"})},getCellValueForCopy:function(e){return e.cellModel.label}})}},_setCellValue:function(e,t,n){let o=e.nodeModel,s=d.core.dicoService.getAttributeDefinition(o.getGlobalType(),t);if(s||(s=this.getColumnMetas(t)),void 0!==(s={...s}).dbName){if(d.core.dicoService.isAPredicate(s.dbName)&&(s.dbName=d.core.dicoService.getAttributeNameFromPredicate(e.nodeModel.getType(),s.dbName),Array.isArray(s.dbName)))return Promise.reject("multi selectable attribute");s.path=s.dbName}let a=o.getID();if(t.endsWith(i.APPEND_INSTANCE_COLUMN_KEYWORD)&&(a=o.getRelationID(),s.ds6wFrom="rel",s.dbName&&!s.dbName.includes(".")&&(s.path="PLMInstance."+s.dbName)),o.isDocument())"tree"===t?s.path=i.TITLE_PATH_OF_DOCUMENT:"ds6w:description"===t&&(s.path=i.DESCRIPTION_PATH_OF_DOCUMENT);else switch(t){case"tree":s.path=i.TITLE_PATH_OF_REFERENCE;break;case"ds6w:label-Instance":s.path=i.INSTANCE_PATH;break;case"ds6w:description":s.path=i.DESCRIPTION_PATH_OF_REFERENCE;break;case"ds6w:description-Instance":s.path=i.DESCRIPTION_PATH_OF_INSTANCE}const{dataService:l,contextManager:c}=d.core;c.getActiveEngItem()&&c.getActiveEngItem().getContentModels()&&c.getActiveEngItem().getContentModels().isInTransaction()?r.runBulkMode("updateAttributes",l.updateAttributes.bind(l),e=>{e&&e.success&&this._refreshInstanceSplit(e.success,void 0,"copyPaste")}).add({physicalid:a,attribute:s,value:n,node:o}):l.updateAttribute(a,s,n).then(e=>{null!=e&&(Object.keys(e).length&&e.results&&this._refreshInstanceSplit(e.results,o,"update"),this.publishNodesToRefresh([a]))}).catch(()=>{o.setRealAttributesConvertState(!1),o.setAttributeConvertionStarted(!1),this.publishNodesToRefresh([a])})},_getColumnsProvidersDefinitions:function(){return d.core.settingManager.getSetting("columnsProviders")},_providerValidateAndRegister:function(e,t,n){var i=this;return s.wrappedWithPromise(function(r,o){e.isAdditionalColumnsAvailable(function(o){!0===o&&(n[t||e.getName()]=e,"RelationsColumns"===e.getName()&&i.setAndDefineRelationMethods(e)),r()})})},setAndDefineRelationMethods:function(e){var t=[i.CONST_SPEC_RELATION_COLUMN_DATAINDEX];e.setPreferenceProxy({setPreference:function(e){self.widget.setValue("enx-relation-pref",e)},getPreference:function(){var e=self.widget.getValue("enx-relation-pref");return"null"===e&&(e=null),e},relationsColumnsList:t}),e.getAdditionalColumnsUX=function(n){t.forEach(function(t){var i=n.findIndex(function(e){return e.dataIndex===t});i>=0?e.getAdditionalColumnsUXDGV(Array(n[i])):n.splice(i,0,{text:d.core.i18nManager.get(t),dataIndex:t,maxWidth:800,minWidth:20,width:200})})}},getColumnsProviderWithMetas:function(e){var t=this._getColumnsProvidersDefinitions().find(function(t){return t.ID===e});return t&&this.loadedProviders?(t.instance=this.loadedProviders[e],t):null},_isVisibleAndProvidedColumn:function(e){},_shouldLoadColumnProvider:function(e){return"whole"===e.loadingPolicy||this.getVisibleAdditionalColumns().some(function(t){return t.provider===e.ID})},getAllProvidedColumns:function(){return this._retrieveProvidedColumns().map(function(e){return{dataIndex:e.dataIndex,kind:"string",provider:e.provider,visibleFlag:!1,isAdditionalColumn:!0,customisation:{layout:{removableFromView:!0,groupingLocked:!0,removable:!1}}}})},getMappingOfAdditionalColumns:function(e){if(!e&&this._cachedAdditionalColumnsMapping)return this._cachedAdditionalColumnsMapping;var t={};return this._retrieveProvidedColumns().forEach(function(e){t[e.dataIndex]=e}),this._cachedAdditionalColumnsMapping=t},_retrieveProvidedColumns:function(){if(Array.isArray(this._cachedAdditionalCols)&&this._cachedAdditionalCols.length>0)return this._cachedAdditionalCols;var e=[];return this.getLoadedColumnProvidersAsArray().forEach(function(t){if(t&&t.instance&&"function"==typeof t.instance.getAdditionalColumnsUX){var n=[];t.instance.getAdditionalColumnsUX(n),e=e.concat(n.map(function(e){return e.provider=t.ID,e}))}}),this._cachedAdditionalCols=e,e},getLoadedColumnProvidersAsArray:function(){var e=this;return this.getLoadedColumnProvidersIDAsArray().map(function(t){return e.getColumnsProviderWithMetas(t)})},getLoadedColumnProvidersIDAsArray:function(){return this.loadedProviders?Object.keys(this.loadedProviders):[]},retrieveAvailableColumnProviders:function(){var e=this;return s.wrappedWithPromise(function(t,n){e._loadColumnsProviders().finally(function(){try{var i=e.getLoadedColumnProvidersAsArray().filter(e._shouldLoadColumnProvider.bind(e));t(i)}catch(e){n(e)}})})},_loadColumnsProviders:function(){var e=this;return e._cachedColProvPromise?e._cachedColProvPromise:s.wrappedWithPromise(function(t,n){if(e.loadedProviders)return t();e._cachedColProvPromise=r.loadFiles(e._getColumnsProvidersDefinitions().map(function(e){return e.loader})).then(function(){for(var n=arguments[0],i=[],r={},o=0;o<n.length;o++){var a=e._getColumnsProvidersDefinitions()[o],l=n[o];a&&l&&(i.push(e._providerValidateAndRegister(l,a.ID,r)),a.isInternal&&"function"==typeof l.bindApp&&l.bindApp(d.core))}s.allSettled(i).then(function(){e.loadedProviders=r,t(!0)})}).catch(function(e){n(e)})})},isAnEditablePredicate:function(e){if(!(d&&d.core&&d.core.dicoService&&e))return!1;const t=d.core.dicoService.getAttributeMetas(e),{editable:n,nature:i,userAccess:r,dbName:o}=t||{};if("boolean"==typeof n)return n;const s=d.core.dicoService.getControlledAppPredicates();return a.isPredicateControlledByApplication(e,s)?a.isAnEditablePredicateControlledByApplication(e,s):a.isAPredicateEditable({curi:e,nature:i,userAccess:r,selectable:o,multiValuated:d.core.dicoService.isMultiValuedAttribute(e)})},_refreshInstanceSplit:function(e,t,r){let o=[],s=[];e.forEach(function(e){(e.oldInstancePhysicalid||e.body&&e.body.oldInstancePhysicalid)&&(o.push({child:"update"===r?t.getID():e.node.getID(),instance:"update"===r?e.body.physicalid:e.physicalid,parent:"update"===r?t.getParentIdFromOccrencePath():e.node.getParentIdFromOccrencePath()}),s.push("update"===r?e.body.oldInstancePhysicalid:e.oldInstancePhysicalid))}),o.length&&(d.core.mediator.publish(i.EVENT_INSTANCES_CREATED,o),n.notifyAlert(d.core.i18nManager.get("notify.instanceEvolved")),this.publishNodesToRefresh(s))}})}),define("DS/ENOXEngineer/components/PropertiesView/PropertiesServices",["UWA/Core","UWA/Class","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants","css!DS/ENOXEngineer/components/PropertiesView/ENOXProperties.css"],(e,t,n,i)=>{return t.singleton({init(e){},getSecurityContext:()=>({SecurityContext:n.getSecurityContext()}),getpropOptions(e){const t=this,r=[e.FACET_PROPERTIES,e.FACET_SHARING,e.FACET_INSTANCE,e.FACET_REVISIONS,e.FACET_RELATIONS,e.FACET_EFFECTIVITY,e.FACET_CHANGE,e.FACET_IPPROTECTION,e.FACET_SWYMCOMMENTS],o={typeOfDisplay:e.ALL,selectionType:e.NO_SELECTION,facets:r,readOnly:!1,extraNotif:!0,editMode:!1,context:{getSecurityContext:()=>t.getSecurityContext()}};return"true"===localStorage.getItem(i.ENABLE_HISTORY_OPEN_CMD)&&(o.infoForCustomization=n.getRevisionsCommandCustomization()),o},getPropModel(e,t,r){const o=[];let s=[];return e.items instanceof Array?s=e.items:s[0]=e.items,s.forEach(e=>{o.push({metatype:e.metatype,objectId:e.id,instrefid:e.instrefid,tenant:n.getPlatformId(),source:i.SERVICE_3DSPACE_NAME})}),o},isManufActive:()=>!0,getManufFacetConfiguration:e=>({require:"DS/DELPPWFacets/facets/ManufacturingIntentFacet",inheritance:!0,alwaysVisible:!0,services:["3DSpace"],actions:[{name:"Add",text:e.i18nManager.get("eng.manufacture.facet.add"),icon:"fonticon fonticon-plus"}],content:null,facet:{name:"ManufactureIntent",icon:"factory",text:e.i18nManager.get("eng.manufacture.facet.title")},options:{appContext:e.core,securityContext:n.getSecurityContext(),immersiveFrame:e.core.moduleHelper.viewsService.getApplicationImmersiveFrame()}})})}),define("DS/ENOXEngineer/components/PropertiesView/PropertiesPanel",["DS/Utilities/Utils","DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/models/EditPropAttributeModel","DS/ENOXEngineer/components/PropertiesView/PropertiesServices","DS/Core/ModelEvents","DS/ENOXEngineer/utils/XEngineerConstants"],(e,t,n,i,r,o,s,a)=>{return class{constructor(e){this.sandbox=e;const i=o.getpropOptions(n);this.infoPanel=new t(i),this.infoPanel.addFacets([{require:"DS/ENOXEngineer/facets/SpecificationsFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:a.CONST_SPEC_FACET_NAME,icon:"docs",text:this.sandbox.i18nManager.get("document.asspec")},options:{appContext:e.core}}]),e.core.specViewerModelEvents=e.core.mediator,this.infoPanel.addFacets([{require:"DS/ENOXEngineer/facets/AttachmentsFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"relateddocuments",icon:"attach",text:this.sandbox.i18nManager.get("title_related_Documents")},options:{appContext:e.core}},{require:"DS/ENOXAlternateSubstitute/facets/AlternateFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"alternateFacet",icon:"exchange",text:this.sandbox.i18nManager.get("eng.alternate.facet.title")},options:{appContext:e.core}},{require:"DS/ENODODisplay/commands/facets/DerivedOutputFacet",inheritance:!0,alwaysVisible:!0,services:["3DSpace"],content:null,facet:{name:"derivedoutputs",icon:"derived-output",text:this.sandbox.i18nManager.get("derived_output")},options:{activateActions:!0},actions:[{name:"refreshDOView",text:this.sandbox.i18nManager.get("derivedOutputFacet.refreshDOView"),icon:"refresh"},{name:"bulkDownloadDO",text:this.sandbox.i18nManager.get("derivedOutputFacet.bulkDownloadDO"),icon:"folder-zipped-download"}]},{require:"DS/ENOMadeFromUX/view/MBMFFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"specsMadeFromFacet",icon:"part-made-from",text:this.sandbox.i18nManager.get("eng.makefrom.facet.title")},options:{appContext:e.core,itemTreeDoc:e.core.xengTreeDoc?e.core.xengTreeDoc:e.xengTreeDoc}},{require:"DS/ENOXEngineer/facets/ENOXMaterialFacet",alwaysVisible:!0,services:["3DSpace"],inheritance:!0,content:null,facet:{name:"MaterialFacet",icon:"material",text:this.sandbox.i18nManager.get("materialFacet.title")},options:{appContext:e.core}}]),this.infoPanel.addFacets([o.getManufFacetConfiguration(this.sandbox)])}start(){const t=this;this.setState(this.sandbox.options.items),this.currentId=this.sandbox.options.physicalId,this.infoPanel.initDatas(this.getPropertyModels()),this.infoPanel.elements.container.inject(this.sandbox.getContainer()),this.reRender=e.debounce(function(){this.infoPanel.initDatas(this.getPropertyModels(),this.getFacet()),this.infoPanel.elements.container.onResize()},10),this.sandbox.subscribe(a.EVENT_TRIPTYCH_PANEL_VISIBLE,e=>{t.reRender(),"right"===e&&setTimeout(()=>{t.infoPanel.elements.container.onResize()},500)})}getState(){return this.currentSelection}getFacet(){return this.currentFacet}setState(e,t){this.currentSelection={items:Array.isArray(e)?e:[]},this.currentFacet=t,this.sandbox.core.isPropertyPanelVisibilty&&this.reRender&&this.reRender()}setReadonlyStatus(e){return this.infoPanel.setReadonlyStatus(e)}getPropertyModels(){return o.getPropModel(this.getState(),i,r)}}}),define("DS/ENOXEngineer/services/XEngineerItemsFactory",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/Utils","UWA/Utils/InterCom","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineer/models/EngItemListModel","DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineer/models/EngItemGroupModel","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/collections/XEngGridTreeDocument","WebappsUtils/WebappsUtils"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e,this.app.core.Factories||(this.app.core.Factories={}),this.app.core.Factories.ListItemFactory=this,this.i18nManager=this.app.core.i18nManager},buildGroupNode:function(t){if(!t||!t.property||null==!t.identifier||!t.firstmember)throw new Error("missing attribute to build grouping node");var n=e.extend(t,this.getGroupAttributes(t));return new l(n)},getGroupAttributes:function(t){var n=t.property,i=t.identifier,r=t.firstmember,o={};switch(n){case"reference":if("NA"!==i)if(e.extend(o,r.options),o.grid={},o.padgrid={},e.extend(o.padgrid,r.options.padgrid),o.viewType="reference",delete o.instanceId,delete o.grid["ds6w:label-Instance"],delete o.instanceMainAttribute,delete o.children,delete o.useAsyncPreExpand,r.isMaterialQuantity())o.grid["ds6w:label"]=r.options.grid.CoreMaterial,o.grid.CoreMaterial=r.options.grid.CoreMaterial,o.grid.CoreMaterialID=r.options.grid.CoreMaterialID,o.grid.CoreMaterialInfo=r.options.grid.CoreMaterialInfo,o.grid.isCoreMaterialGroupNode=!0,o.padgrid["ds6w:globalType"]="ds6w:Material";else this.app.core.dicoService.getTagsForBOWithMandatories().forEach(function(e){o.grid[e]=r.options.grid[e]});else o.property=t.property,o.viewType="attributeNode";break;default:var s=this.app.core.dicoService.getVisibleAttributes();if(Array.isArray(s))for(var a=0;a<s.length;a++){const e=s[a];if(e&&e.ds6w===n){"date"===e.kind.toLowerCase()&&(o.patch_isCustoDate=!0);break}}o.property=t.property,o.viewType="attributeNode"}return o.appCore=this.app.core,o},computeFullPathPhysicalId:function(e,t,n,i){if(t[n].toString()===e.root.did)i=[e.root.physicalid];else if(n%2==1){var r=e.nodes[t[n]];i.push(r.physicalid),i.push(r.instanceOf.physicalid)}return i},updateNodeWithStructureInfo:function(e,t,n){var i=n+1<e.length?t.nodes[e[n+1]]:null;if(0===Math.abs(n%2)){if(t.nodes[e[n]].children||(t.nodes[e[n]].children=[]),i){for(var r=!1,o=0;o<t.nodes[e[n]].children.length;o++)if(t.nodes[e[n]].children[o].did===i.did){r=!0;break}r||t.nodes[e[n]].children.push(i)}}else i&&(t.nodes[e[n]].instanceOf=i)},computeOccurancePath:function(e,t,n,i){if(i)return this.computeOccurancePathForMFGView(e,t,n);var r=[t.root.physicalid];return n.forEach(function(e){var n=t.nodes[e];n&&(r.push(n.physicalid),r.push(n.instanceOf.physicalid))}),r},computeOccuranceTitle:function(e,t){var n=[];return t.forEach(function(t){var i=e.nodes[t];i&&i["ds6w:label"]&&n.push(i["ds6w:label"])}),n.join("/")},computeLevel:function(e){return(e.length-1)/2},updateOccurancePathOfNlevelStructure:function(e){var t=e&&e.occurrencePath&&e.occurrencePath.indexOf(e.instanceOf.physicalid)>-1?e.occurrencePath.indexOf(e.instanceOf.physicalid)+1:e.occurrencePath.length;e.occurrencePath=e.occurrencePath.slice(0,t)},getListNodesFromServerExpand:function(t,i,r){var s=this;let a=r?r.targetLevel:void 0;console.log("building nodes... "+Date.now());var l=s.app.core.settingManager;return i[d.CONST_AUTHORING_MODE]=s.app.core.sessionManager.isUsingDB(),new n(function(n,r){var c=o.parseAndBuildIRPCStructureForLoad(t,l.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),i);s.getStatesAttributesForPolicies(c.policies),s.app.core.i18nManager.resolveMissingNls(c.nlsTracker).then(function(r){if(!c.root)return n([]);const l=!(!i||!i.nodesType)&&"reference"===i.nodesType;var d=[],u=[],p=[],g=new Map,h={},m=s.app.core.sessionManager.shouldShowMfgView();const f=s.app.core.sessionManager.shouldShowLeafMaterials(),E=s.app.core.sessionManager.shouldShowFlatView(),C=!(!i||!i.flattenedView)&&i.flattenedView;var _=[];c.paths.forEach(function(t){for(var n=[],r=[],o=0;o<t.length;o++)t[o].toString()===c.root.did?n=[]:(s.updateNodeWithStructureInfo(t,c,o),o%2==1&&n.push(c.nodes[t[o]])),r=s.computeFullPathPhysicalId(c,t,o,r);var _=s.getFinalPath(n,m),y=s.computeOccurancePath(r,c,_,m),M=s.computeOccuranceTitle(c,_);if(_&&_.length>0){const n=e=>{const n=t.findIndex(t=>t==e.did);return(n<t.length?t.slice(0,n+1):t).join("/")},r=e=>{const t=c.nodes[e];return n(t)},o=e=>{const t=r(e);return g.get(t)},A=e=>{return c.nodes[e].instanceOf},b=(t,n)=>{e.is(t)&&e.is(n)&&(e.is(t.childrenForViewModel)||(t.childrenForViewModel=[]),t.childrenForViewModel.push(n))},S=(e,t)=>{const n=e.did,i=t.did;let r=!1;if(c.nodes.hasOwnProperty(n)){r=-1===c.nodes[n].quantity.findIndex(e=>e.did===i)}return r},T=!(!i||!i.expand_iter||"-1"!==i.expand_iter);let D=T&&!0!==C&&!0!==f?0:_.length-1;m?D=!0===C?_.length-1:0:a&&(D=s.app.core.contextManager.isActiveEngItemSelected()?0:s.getTargetLevelToBuildNodeFromResponse(y,D));for(let e=D;e<_.length;++e){const t=_[e],r=c.nodes[t];var N=n(r);if(!1===g.has(N)){var v=Object.assign({},r);v.occurrencePath=y,v.occurenceTitle=M,i&&"1"!=i.expand_iter&&s.updateOccurancePathOfNlevelStructure(v),g.set(N,v),!0===C||"VPMRepInstance"===v.type||!0===T||m||1==f||E||(v.children=[]),v.childComputed=!1;var I=v.instanceOf;if(l&&s.isReusableReference(I))if(p.indexOf(I.did)<0){if(p.push(I.did),I.hasQuantity)h[I.physicalid]=I;else if(T||I.children&&(!I.children||0!=I.children.length)||(I.children=[],I.childComputed=!1),e===D)u.push(I);else{b(A(_[e-1]),I)}c.nodes[I.did].quantity=[v]}else!0!==C&&!0!==S(I,v)&&1!=f||c.nodes[I.did].quantity.push(v);else if(e===D)d.push(v);else{b(o(_[e-1]),v)}}}}}),s.createCoreMaterialNodes(h).then(function(e){if(u.length>0){var i=s.createEngItemNodes(u,s.genericEngItemOptionsMapper.bind(s),a);_=_.concat(i)}if(e&&Array.isArray(e)&&e.length>0&&(_=_.concat(e)),d.length>0){var r=s.createListNodes(d,s.expandListNodeOptionsMapper.bind(s),a);_=_.concat(r)}return o.cleanExpandParsedData(c),t=void 0,console.log("Nodes built! "+Date.now()),n(_)}).catch(function(e){})})})},computeOccurancePathForMFGView:function(e,t,n){var i=n.length>0?t.nodes[n[n.length-1]].instanceOf.physicalid:"";return e.slice(0,e.indexOf(i)+1)},isManufactuableNode:function(e){return!("FALSE"===e[d.DS6W_MANUFACUTRABLE]||e.instanceOf&&"FALSE"===e.instanceOf[d.DS6W_MANUFACUTRABLE])},removeChildFromNode:function(e){(!e.children||e.children&&0==e.children.length)&&(e.children=[],e.childComputed=!1)},getListNodesFromServerExpandForEdition:function(e,t){var i=this,r=i.app.core.settingManager;return t[d.CONST_AUTHORING_MODE]=!0,new n(function(n,s){var a=o.parseAndBuildIRPCStructure(e,r.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),t);i.getStatesAttributesForPolicies(a.policies),i.app.core.i18nManager.resolveMissingNls(a.nlsTracker).then(function(r){if(!a.root)return n([]);var s=!1;if(t&&t.nodesType)s="reference"===t.nodesType;var l=[],c=[],d=[],u=[],p={},g=(t.flattenedView,t.isRefreshing,[]);a.paths.forEach(function(e){var n=[],r=[];a.root=e[0]!=a.root.did?a.nodes[e[0]]:a.root;for(var o=0;o<e.length;o++)e[o].toString()===a.root.did?r=[]:o%2==1&&r.push(a.nodes[e[o]]),n=i.computeFullPathPhysicalId(a,e,o,n);const g=i.app.core.sessionManager.shouldShowMfgView(),h=i.getFinalPath(r,g),m=i.computeOccurancePath(n,a,h,g),f=i.computeOccuranceTitle(a,h),E=i.computeLevel(m);r.forEach(function(e){e.occurrencePath=m,e.occurenceTitle=f,e.level=E,i.updateOccurancePathOfNlevelStructure(e);var n=e.instanceOf;if(s&&i.isReusableReference(n)&&!n.hasQuantity)if(d.indexOf(n.did)<0||u.indexOf(m[0])<0)if(d.push(n.did),u.push(m[0]),n.hasQuantity)p[n.physicalid]=n,Reflect.has(p[n.physicalid],"quantity")?p[n.physicalid].quantity.push(e):p[n.physicalid].quantity=[e];else if(i.removeChildFromNode(e),n.quantity&&!0===t.isFromReplace){let t=Object.assign({},n);t.quantity=[e],c.push(t)}else!0===t.isFromReplace&&(n.quantity=[e]),c.push(n);else!0===t.isFromReplace&&(i.removeChildFromNode(e),n.quantity.push(e));else!0===t.isFromReplace&&(e.children=[]),l.push(e)})}),i.createCoreMaterialNodes(p).then(function(r){if(c.length>0){var s=i.createEngItemNodes(c,i.genericEngItemOptionsMapper.bind(i));g=g.concat(s)}if(r&&Array.isArray(r)&&r.length>0&&(g=g.concat(r)),l.length>0){var d=i.createListNodes(l,i.expandListNodeOptionsMapper.bind(i));g=g.concat(d)}return o.cleanExpandParsedData(a),e=void 0,!0===t.isFromReplace?n(g):(g=i.removeDuplicates(g),n(g))}).catch(function(e){})})})},removeDuplicates:function(e){let t=[],n={};for(let t in e){n[e[t].getRelationID?e[t].getRelationID():e[t].getID()]=e[t]}for(let e in n)t.push(n[e]);return t},createCoreMaterialNodes:function(e){var t=this;return new n(function(n,i){if(!(Object.keys(e).length>0))return n([]);var r=[];for(var o in e)r.push(o);t.app.core.dataService.getCoreMaterialToEngItem(r).then(function(i){var r=i.references.map(function(e){return e.material.physicalid}),o=t.app.core.dicoService.getTagsForBOWithMandatories();t.app.core.dataService.fetch(r,o).then(function(r){if(i.references){var o={};i.references.forEach(function(t){var n=t.material.physicalid,i=t.engItem,s=r.filter(function(e){return e.physicalid===n})[0];e[i].quantity.forEach(function(e){e.instanceOf.CoreMaterial=s["ds6w:label"]+" "+s["ds6wg:revision"],e.instanceOf.CoreMaterialID=s.physicalid,e.instanceOf.CoreMaterialInfos=s}),null!=o[n]?o[n].quantity=o[n].quantity.concat(e[i].quantity):(s.quantity=e[i].quantity,o[n]=s)});var s=[];for(var a in o)s.push(o[a]);var l=[];return s.length>0&&(l=t.createEngItemNodes(s,t.materialFromIndexNodeOptionsMapper.bind(t))),n(l)}})}).catch(function(e){})})},isReusableReference:function(e){return"ds6w:Part"===e["ds6w:globalType"]},isFinalItem:function(e){var t=widget.getValue(d.FINAL_ITEMS_PREF),n=this.app.core.dicoService.getCustomAttribute(t),i=widget.getValue(d.FINAL_ITEM_VALUE_NAME),r=null;return n&&void 0===(r=e[t])&&(r=n.defaultValue),null!=r&&null!=i&&void 0!==i&&r===i},showInBOM:function(e){if(void 0===widget.getValue("ShowNotInBOM")||!widget.getValue("ShowNotInBOM")){var t=e["ds6wg:SynchroEBOMExt.V_InEBOMUser"];return!(t&&"FALSE"==t)}return!0},getFinalPath:function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i];if(this.shouldBeExcluded(r))break;if(this.shouldBeSkipped(r,t)||n.push(r.did),this.isFinal(r))break}return n},shouldBeSkipped:function(e,t){return!(!t||this.isManufactuableNode(e))},shouldBeExcluded:function(e){return!this.showInBOM(e)},isFinal:function(e){var t=this.app.core.contextManager.isMultiLevelStructure(),n=this.app.core.sessionManager.shouldShowFinalItems();const i=this.app.core.sessionManager.shouldShowLeafMaterials();var r=!1,o=e.instanceOf?e.instanceOf.children:null;if(o&&0!=o.length){var s=!1;o.forEach(function(e){if(!0===t)var n="ds6w:Part"===e.instanceOf["ds6w:globalType"]||"VPMRepInstance"===e.type;else n="ds6w:Part"===e.instanceOf["ds6w:globalType"];if(n)return s=!0,!1}),s||(r=!0)}else r=!0;var a=this.isFinalItem(e.instanceOf);return!!(r||a&&(n||i))},getNlsedListNodes:function(e){var t=this;return new n(function(n,i){if(!Array.isArray(e))return i(new Error(" inputs error"));var r=t.app.core.settingManager,s=[],a={withNlsProp:r.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),classes:[],properties:{}};e.forEach(function(e){s.push(o.attributesParser(e,a))}),t.app.core.i18nManager.resolveMissingNls(a).finally(function(e){return n(t.createListNodes(s,t.genericEngItemOptionsMapper.bind(t)))})})},getEngItemsListFromServerFetch:function(e,t,i){var r=this,s=r.app.core.settingManager;return new n(function(t,n){if(!Array.isArray(e.results))return n(e);var a=o.parseFetchResult(e,s.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP));r._getCreatedEngItemNodes(a,a.results,i).then(function(e){return t(e)})})},getEngItemFromServerExpandInDB:function(e,t,i){var r=this,s=r.app.core.settingManager,a={};return new n(function(t,n){if(!Array.isArray(e.results))return n(e);a[d.CONST_AUTHORING_MODE]=r.app.core.sessionManager.isUsingDB();var l=o.parseAndBuildIRPCStructureForLoad(e,s.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),a);if(r.getStatesAttributesForPolicies(l.policies),!l.root)return t();r._getCreatedEngItemNodes(l,[l.root],i).then(function(e){return t(e)})})},_getCreatedEngItemNodes:function(e,t,n){var i=this;return c.wrappedWithCancellablePromise(function(r,o){i.app.core.i18nManager.resolveMissingNls(e.nlsTracker).finally(function(e){var o=i.createEngItemNodes(t,i.genericEngItemOptionsMapper.bind(i));if(!n||1!==o.length)return r(o);var s=o[0];s.getConfigInitPromise().finally(function(){r([s])})})})},expandListNodeOptionsMapper:function(e){var t=this.genericEngItemOptionsMapper(e.instanceOf);return t.instanceId=e.physicalid,t.childComputed=e.childComputed,t.children=e.children,t.occurrencePath=e.occurrencePath,t.occurenceTitle=e.occurenceTitle,t.level=e.level,t["ds6w:label-Instance"]="VPMRepInstance"!==e.type||"VPMRepInstance"===e.type&&"Drawing"===e.instanceOf.type?e["ds6w:label"]||e["ro.PLMInstance.PLM_ExternalID"]:"",t.instanceType=e.type,t.instanceTypeNLS=this.i18nManager.get("ds6w:type/"+e.type),this.app.core.dicoService.getTagsForRelWithMandatories().filter(function(e){return-1===["physicalid","ds6w:label","ds6w:type"].indexOf(e)}).forEach(function(n){t[n+d.APPEND_INSTANCE_COLUMN_KEYWORD]=void 0===e[n]?"":e[n]}),t},genericEngItemOptionsMapper:function(e){return e["ds6w:created"]=e["ds6w:created"],e["ds6w:modified"]=e["ds6w:modified"],e.occurrencePath&&(e.occurrencePath=e.occurrencePath),e},materialFromIndexNodeOptionsMapper:function(e){var t=this.genericEngItemOptionsMapper(e);if(void 0!==e["ds6w:status"]&&null!==e["ds6w:status"]){var n=e["ds6w:status"].split(".");t[d.CONST_CURRENT_OBJECT_MATURITY_STATE]||(t[d.CONST_CURRENT_OBJECT_MATURITY_STATE]=e["ds6w:status"]),t["ds6w:status"]=this.i18nManager.get("ds6w:status/"+n[n.length-1])}return t["ds6w:globalType"]="ds6w:Material",t},listNodeToEngItem:function(e){let t={...e.options};return t.grid={...e.options.grid},t.viewType="reference",delete t.instances,t.children&&(t.children=[]),t.grid.hasOwnProperty("instanceId")&&delete t.grid.instanceId,t.grid.hasOwnProperty("instanceType")&&delete t.grid.instanceType,t.grid.hasOwnProperty("occurrencePath")&&delete t.grid.occurrencePath,e.options.appCore.dicoService.getAvailableAttributes().filter(e=>"rel"===e.ds6wFrom).map(e=>e.dataIndex).forEach(e=>{delete t.grid[e]}),new a(t)},_optionsRetrievor:function(t,n){return n&&"function"===e.typeOf(n)?n(t):n&&"fromSearch"===n?this.retrieveNodeDataFromSearchResult(t):n&&"fromDocAPI"===n?this.retrieveNodeDataFromDocumentAPI(t):n&&"docFromGenericExpand"===n?this.retreiveNodeDataFromDocumentGenericExpand(t):n&&"coreMaterialFromSearch"===n?this.retrieveNodeDataFromSearchMaterial(t):n&&"instFromGenericExpand"===n?this.expandListNodeOptionsMapper(t):n&&"refFromGenericExpand"===n?this.genericEngItemOptionsMapper(t):t},getReferenceClass:function(){return a},getListInstanceClass:function(){return s},getGroupInstanceClass:function(){return l},isInstanceOfEngItem:function(e){return e instanceof this.getReferenceClass()},isInstanceOfListNodeModel:function(e){return e instanceof this.getListInstanceClass()},extractAttributesFromNode:function(t){var n={};if(this.isInstanceOfListNodeModel(t)||this.isInstanceOfEngItem(t)){const i={...t.options.grid},r={...t.options.padgrid};(n=e.merge(i,r)).type=t.options.type,n.physicalid=t.options.referenceId,n.thumbnail=t.options.thumbnail,n.icons=t.options.icons,n.occurrencePath=t.options.occurrencePath,n.locker=t.options.locker,n.files=t.options.files,n["ds6wg:PLMReference.V_isLastVersion"]=t.options.isLastVersion,n["ds6w:globalType"]=t.options.padgrid["ds6w:globalType"],t.getRelationID&&(n.instanceId=t.getRelationID())}return n},extractOptionsFromNode:function(e,t){var n=null,i=this.extractAttributesFromNode(e);return(n=this.isInstanceOfListNodeModel(e)?this.basicOptionsBuilder(i).addInstanceOptionsBuilder(i,"",t).Options:this.basicOptionsBuilder(i).Options)&&(delete n.isCut,delete n.quantity,delete n.showMoreInfo,delete n.appCore,n.grid["ds6w:label-Instance"]&&n.grid["ds6w:label-Instance"]!==this.i18nManager.get("loading")||delete n.grid["ds6w:label-Instance"]),n},createEngItem:function(t,n,i){var r=this,o=r._optionsRetrievor(t,n),s=r.basicOptionsBuilder(o).Options;if(t.quantity&&t.quantity.length>0){var l=[];t.quantity.forEach(function(e){var t=r.createListNode(e,r.expandListNodeOptionsMapper.bind(r),i);l.push(t)}),s.grid.quantity=l}s.children=t.children,t.occurrencePath&&(s.occurrencePath=t.occurrencePath),s.childComputed=t.childComputed;var c=new a(s);return e.is(t.childrenForViewModel)&&(this._createNodeChildrenForViewModel(c,t.childrenForViewModel,n,r.createEngItemNodes.bind(r),i),delete t.childrenForViewModel),r.isExpandOperation(i,c)&&c.expand(),c},createListNode:function(e,t,n){var i=this._optionsRetrievor(e,t),r=this.basicOptionsBuilder(i).addInstanceOptionsBuilder(i).Options;return new s(r)},_createNodeChildrenForViewModel:function(t,n,i,r,o){if(e.is(t)&&"function"==typeof r&&n instanceof Array&&n.length){const e=r(n,i,o);t._options.children=[],t._options.childComputed=!0,t.addChildToTheTargetNode(e)}},basicOptionsBuilder:function(e,t){var n="ds6w:Part";return e["ds6w:globalType"]&&(n=e["ds6w:globalType"]),this.Options={type:e.type,isCut:!1,quantity:1,tenant:this.app.core.settingManager.getPlatformId(),label:e["ds6w:label"],grid:{},padgrid:{"ds6w:globalType":n},showMoreInfo:!0,subLabel:e["ds6w:responsible"]+" \n"+e["ds6w:modified"],attributes:[],referenceId:e.physicalid,thumbnail:e.thumbnail||this.getDefaultProductThumbnail(),appCore:this.app.core,icons:e.icons,isLastVersion:e["ds6wg:PLMReference.V_isLastVersion"]},e.children&&(this.Options.children=e.children),null!==e.childComputed&&void 0!==e.childComputed&&(this.Options.childComputed=e.childComputed),"ds6w:FileDocument"===e["ds6w:globalType"]&&(this.Options.locker=e.locker,this.Options.checkedOut=this.Options.locker&&this.Options.locker.length>0,this.Options.files=e.files,this.Options.isMultiFile=e.isMultiFile,this.Options["ds6w:docExtension"]=e["ds6w:docExtension"],this.Options.thumbnail=e.thumbnail||p.getWebappsAssetUrl("ENOXEngineer","img/document.png")),"ENOStrRefinementSpecification"===e.type&&(this.Options.padgrid["ds6w:globalType"]="ds6w:Filter"),this._fillAttributes(e),t?this.Options:this},_fillAttributes:function(e){var t=this;return this.Options.grid||(this.Options.grid={}),t._fillStringAttributesToDefault(this.Options),Object.keys(e).forEach(function(n){t.Options.grid[n]=e[n]}),e["ds6wg:SynchroEBOMExt.V_InEBOMUser-Instance"]&&"TRUE"===e["ds6wg:SynchroEBOMExt.V_InEBOMUser-Instance"].toUpperCase()&&(t.Options.grid["ds6wg:SynchroEBOMExt.V_InEBOMUser-Instance"]=!0),e.CoreMaterial&&e.CoreMaterialID&&(t.Options.grid.CoreMaterial=e.CoreMaterial,t.Options.grid.CoreMaterialID=e.CoreMaterialID),"ds6w:Part"===t.Options.padgrid["ds6w:globalType"]&&t._parseDateAttributesToISO(this.Options),(e.thumbnail||t.Options.thumbnail)&&(t.Options.grid.Thumbnail=e.thumbnail||t.Options.thumbnail),e["ds6w:deformability"]&&(t.Options.grid["ds6w:deformability"]=e["ds6w:deformability"]?t.i18nManager.get("ds6w:deformability/"+e["ds6w:deformability"]):""),e["ds6w:status"]&&!t.Options.grid[d.CONST_CURRENT_OBJECT_MATURITY_STATE]&&(t.Options.grid[d.CONST_CURRENT_OBJECT_MATURITY_STATE]=e["ds6w:status"]),t.Options.grid["ds6w:status"]=t.i18nManager.get("ds6w:status/"+e["ds6w:status"]),t.Options.grid["ds6w:type"]=t.i18nManager.get("ds6w:type/"+e.type),t.Options.grid["ds6w:organizationResponsible"]=e["ds6w:organizationResponsible"]?t.i18nManager.get("ds6w:organizationResponsible/"+e["ds6w:organizationResponsible"]):"",t.Options.grid["ds6w:organizationResponsible-Instance"]=e["ds6w:organizationResponsible-Instance"]?t.i18nManager.get("ds6w:organizationResponsible/"+e["ds6w:organizationResponsible-Instance"]):"",t.Options.grid["ds6w:project"]=e["ds6w:project"]?t.i18nManager.get("ds6w:project/"+e["ds6w:project"]):"",t.Options.grid["ds6w:project-Instance"]=e["ds6w:project-Instance"]?t.i18nManager.get("ds6w:project/"+e["ds6w:project-Instance"]):"",this.Options},_fillStringAttributesToDefault:function(e){this.customStringDefault||(this.customStringDefault=this.app.core.dicoService.getVisibleAttrForBO()||[],this.customStringDefault=this.customStringDefault.filter(function(e){return!e.isReadOnly&&e.kind&&"string"===e.kind.toLowerCase()}).map(function(e){return e.ds6w})),e&&e.grid&&this.customStringDefault.forEach(function(t){e.grid[t]=""})},_parseDateAttributesToISO:function(e){this.customDateAttrs||(this.customDateAttrs=this.app.core.dicoService.getVisibleAttributes()||[],this.customDateAttrs=this.customDateAttrs.filter(function(e){return e.kind&&-1!==["datetime","timestamp"].indexOf(e.kind.toLowerCase())&&-1===["ds6w:modified","ds6w:created"].indexOf(e.dataIndex)}).map(function(e){return e.ds6w})),e&&e.grid&&this.customDateAttrs.forEach(function(t){var n=i.dateFormatFromDsToIso(e.grid[t]);e.grid[t]=n||""})},getDefaultProductThumbnail:function(){return this.defaultThumbnail?this.defaultThumbnail:(this.defaultThumbnail=p.getWebappsAssetUrl("ENOXEngineer","img/product.png"),this.defaultThumbnail)},getAttachmentTileIcon:function(e){return[e.dataelements.type_icon_url?e.dataelements.type_icon_url:"Drawing"===e.type?this.getDefaultDrawingIcon():this.getDefaultDocumentIcon()]},getDefaultDrawingIcon:function(){return p.getWebappsAssetUrl("ENOXEngineer","icons/32/I_PLMInsertNewDrawing.png")},getDefaultDocumentIcon:function(){return p.getWebappsAssetUrl("ENOXEngineer","icons/32/I_CDM_Document.png")},getDefaultProductIcon:function(){return this.app.core.settingManager.getDefault3DSpaceUrl()+"/snresources/images/icons/small/I_VPMNavProduct.png"},getCADIcon:function(e){return e&&0!==e.trim().length?this.app.core.settingManager.getIconPath("I_"+e):""},addInstanceOptionsBuilder:function(e,t,n){return this.Options?(this.Options.instanceId=e.instanceId,this.Options.instanceType=e.instanceType,n||(this.Options.childComputed=e.childComputed,this.Options.children=e.children,this.Options.occurrencePath=e.occurrencePath),t?this.Options:this):(console.error(" you need to call basic method before !"),null)},retrieveNodeDataFromSearchResult:function(e){return{type:e["ds6w:type"],instanceId:e.id,"ds6w:description":"","ds6w:label":e["ds6w:identifier"],"ds6wg:revision":"-","ds6w:status":e["ds6w:status"],"ds6w:responsible":e["ds6w:responsible"],"ds6w:created":e["ds6w:created"],"ds6w:modified":e["ds6w:modified"],"ds6w:label-Instance":e["ds6w:label"],physicalid:e.id,thumbnail:e.preview_url}},retrieveNodeDataFromSearchMaterial:function(e){var t=this.genericEngItemOptionsMapper(e);return t.type=e["ds6w:type"],t.physicalid=e.id,t.thumbnail=e.preview_url,t.icons=[e.type_icon_url],t["ds6w:globalType"]="ds6w:Material",t["ds6w:reserved"]=e["ds6w:reserved_value"],t},retreiveNodeDataFromDocumentGenericExpand:function(e){const{physicalid:t,instanceOf:n,level:i,type:r}=e||{};return n?{level:i,type:n.type,instanceId:t,instanceType:"DocInstance","ds6w:label-Instance":"","ds6w:globalType":"ds6w:FileDocument","ds6w:description":n["ds6w:description"],"ds6w:label":n["ds6w:label"],"ds6wg:revision":n["ds6wg:revision"],"ds6wg:PLMReference.V_isLastVersion":n.islastrevision,"ds6w:status":this.i18nManager.get(n.current),"ds6w:responsible":n["ds6w:responsible"],"ds6w:created":n["ds6w:created"],"ds6w:modified":n["ds6w:modified"],"ds6w:identifier":n["ds6w:identifier"],"ds6w:docExtension":n.docExtension,icons:Array.isArray(n.icons)&&n.icons.length?n.icons:that.getAttachmentTileIcon(doc),physicalid:n.physicalid,isSpecificationDocument:r===d.SPECIFICATION_DOCUMENT,thumbnail:n.thumbnail||p.getWebappsAssetUrl("ENOXEngineer","img/document.png")}:null},retrieveNodeDataFromDocumentAPI:function(e){if(!e)return null;var t=e;if(!t)return null;var n=t.relateddata.ownerInfo[0].dataelements,i=t&&t.relateddata&&t.relateddata.files?t.relateddata.files[0]:null;return{type:t.type,instanceId:i&&i.relId?i.relId:t.relId,"ds6w:description":t.dataelements.description,"ds6w:globalType":"ds6w:FileDocument","ds6w:label":t.dataelements.title?t.dataelements.title:t.dataelements.secondaryTitle,"ds6wg:revision":t.dataelements.revision,"ds6wg:PLMReference.V_isLastVersion":t.dataelements.isLatestRevision,"ds6w:status":t.dataelements.stateNLS?t.dataelements.stateNLS:this.i18nManager.get(t.dataelements.state),currentObjectState:t.dataelements.state,"ds6w:responsible":n.firstname+" "+n.lastname,"ds6w:created":t.dataelements.originated,"ds6w:modified":t.dataelements.modified,"ds6w:identifier":t.dataelements.name,locker:i&&i.dataelements.locker&&i.dataelements.locker.length>1?i.dataelements.locker:null,"ds6w:label-Instance":"","ds6w:docExtension":i?i.dataelements.title.split(".").pop():null,icons:t.dataelements.indexedTypeicon?[t.dataelements.indexedTypeicon]:this.getAttachmentTileIcon(t),instanceType:"DocInstance",files:t.relateddata.files,isMultiFile:!!i&&t.relateddata.files.length>1,physicalid:t.id,thumbnail:t.dataelements.image.endsWith(".gif")?p.getWebappsAssetUrl("ENOXEngineer","img/document.png"):t.dataelements.image}},createListNodes:function(t,n,i){var r=[],o=this;return t.forEach(function(t){var s=o.createListNode(t,n,i);e.is(s)&&(void 0===widget.getValue("ShowNotInBOM")||widget.getValue("ShowNotInBOM")||!widget.getValue("ShowNotInBOM")&&"FALSE"!==s.getAttributeValue("ds6wg:SynchroEBOMExt.V_InEBOMUser"))&&r.push(s)}),r},createEngItemNodes:function(t,n,i){var r=[],o=this;return t.forEach(function(t){if(t.deleted)r.push(t);else{var s=o.createEngItem(t,n,i);e.is(s)&&r.push(s)}}),r},_getBIFilterProxy:function(){var e=this.app.core.contextManager.getXENTreeDocument();return e?e.getXENBIFilterProxy():null},getRootItemFromFilter:function(e){var t=this;return c.wrappedWithPromise(function(n,i){if(!e)return i(new Error("no filters found in preference"));var r=t._getBIFilterProxy();if(!r)return i(new Error("no BIFilter infra to manage Filters"));r.retrieveFilters({filterObjects:[{envId:t.app.core.settingManager.getPlatformId(),serviceId:e.serviceId,contextId:e.contextId,objectId:e.objectId,objectType:d.TYPE_ADVANCED_FILTER,displayName:e.displayName}],filterIds:[e.objectId],droppedEnvId:t.app.core.settingManager.getPlatformId(),doNotFillTheTagger:!1,callback:function(e){return e&&Array.isArray(e.success)&&e.success.length>0?n(e.success):e&&Array.isArray(e.errors)&&e.errors.length>0?i(new Error("unable to retrieve Filters")):void 0}})})},openItemWithCompass:function(t){var n=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(),i=e.is(widget)&&widget.id?"xEngCompassSocket_"+widget.id:"xEngCompassSocket";if(this._compass_socket||(this._compass_socket=new r.Socket(i),this._compass_socket.subscribeServer("com.ds.compass",window.parent)),!t&&n&&n.length>0&&!this.app.core.contextManager.isRoot(n[0])){var o=this.getContentForCompassInteraction(),s=e.clone(o.data.items[0]);this._compass_socket.dispatchEvent("onSetX3DContent",o,i),this._compass_socket.dispatchEvent("onSetObject",s,i)}else this._compass_socket.dispatchEvent("onResetX3DContent",{},i),this._compass_socket.dispatchEvent("onResetObject",{},i)},getContentForCompassInteraction:function(e,t){var n=[];if(t){var i={objectId:t.getID(),objectType:t.getType(),displayName:t.getDisplayName(),displayType:t.getType(),facetName:"realized"};n.push(i)}else{let t="root"==e?[this.app.core.contextManager.getActiveEngItem()]:this.app.core.contextManager.getXENTreeDocument().getSelectedNodes();for(var r=0;r<t.length;r++){var o={objectId:t[r].getID(),objectType:t[r].getType(),displayName:t[r].getDisplayName(),displayType:t[r].getType(),facetName:"realized"};n.push(o)}}var s=this.app.core.settingManager.getSecurityContext(),a=[];return n.forEach(function(e){var t={envId:widget.getValue("x3dPlatformId"),serviceId:"3DSpace",contextId:s,objectId:e.objectId,objectType:e.objectType,displayName:e.displayName,displayType:e.displayType,facetName:e.facetName?e.facetName:"",path:[{resourceid:e.objectId,type:e.objectType}]};a.push(t)}),{protocol:"3DXContent",version:"1.1",source:widget.data.appId,widgetId:widget.id,data:{items:a}}},getContentForOpenWithMenu(e,t){var n=this;return c.wrappedWithPromise(function(i,r){let o="";o=t?t.getType():"root"===e?n.app.core.contextManager.getActiveEngItem().getType():n.app.core.contextManager.getXENTreeDocument().getSelectedNodes()[0].getType(),n.app.core.dicoService.getTypeHierarchy(o).then(function(r){let s=n.getContentForCompassInteraction(e,t),a=JSON.parse(JSON.stringify(r));s.data.items[0].objectTaxonomies=a.hierarchy,s.data.items[0].objectTaxonomies.push(o),i(s)})})},createListNodeFromOptions:function(t){var n={};return e.extend(n,t),new s(n)},createEngItemNodeFromOptions:function(t){var n={};return e.extend(n,t),new a(n)},buildListNodeOptions:function(e,t){var n=this._optionsRetrievor(e,t);return this.basicOptionsBuilder(n).addInstanceOptionsBuilder(n).Options},buildEngItemNodeOptions:function(e,t){var n=this._optionsRetrievor(e,t);return this.basicOptionsBuilder(n).Options},getStatesAttributesForPolicies:function(e){let t=this.app.core.settingManager.getSetting("defaultPolicies");if(e){let n=e.filter(e=>-1==t.indexOf(e));n.length>0&&t.push(...n)}this.app.core.dataService.getStatesAttributes(t)},buildGroupNodesFromExpandResult:function(e,t){return c.wrappedWithCancellablePromise((n,r)=>{const o=i.retreiveGroupsFromExpand(e,t,this.app.core.i18nManager);return Array.isArray(o)&&o.length?n(o.getFirstLevelChildren().map(e=>new l({label:e.getLabel(),groups:o,group:e,icons:[{iconName:"group"}],useAsyncPreExpand:!0,children:[],padgrid:{"ds6w:globalType":"groupNodeFromTagger"},appCore:this.app.core}))):(console.warn("no group found"),r(new Error("no group found")))})},buildNodesFromExpandResult:function(e,t,n){let r=this,s={};return c.wrappedWithCancellablePromise(function(a,l){s[d.CONST_AUTHORING_MODE]=r.app.core.sessionManager.isUsingDB();let c=o.parseAndBuildIRPCStructureForLoad(e,r.app.core.settingManager.getSetting(d.DS6W_CLASSES_WITH_NLS_PROP),s);r.getStatesAttributesForPolicies(c.policies),r.app.core.i18nManager.resolveMissingNls(c.nlsTracker).then(e=>{let{nodes:o,paths:s}=c;r.app.core.dataService.completeWithCoreMaterialInformation(o).then(e=>{let l=e;r.app.core.dataService.completeWithDeformableInformation(o).then(e=>{let c=l&&Array.isArray(l)?i.createMap(l,e=>e.physicalid,e=>e):null,d=e&&Array.isArray(e)?i.createMap(e,e=>e.physicalid,e=>e):null,u={nodes:{...o,...c,...d},paths:s},p=r.buildTreeStructure(u.paths,u.nodes,t,n);(r.app.core.sessionManager.shouldShowFinalItems()||r.app.core.sessionManager.shouldShowLeafMaterials())&&(p=r.buildLeafNodes(p)),r.app.core.sessionManager.shouldShowQuantityView()&&(p=r.buildReferenceNodes(p)),r.app.core.sessionManager.shouldShowFlatView()&&(p=r.buildFlatList(p)),a(p)})})})})},buildTreeStructure(e,t,n,r){let o=this;const s={nodeType:o.app.core.sessionManager.shouldShowQuantityView()?"reference":"instance",onlyLeaf:o.app.core.sessionManager.shouldShowFinalItems()||o.app.core.sessionManager.shouldShowLeafMaterials(),showManufOnly:o.app.core.sessionManager.shouldShowMfgView(),showFlatList:o.app.core.sessionManager.shouldShowFlatView()};function a(e,t){return(!e.showManufOnly||!t.instanceOf["ds6w:manufacturable"]||"FALSE"!==t.instanceOf["ds6w:manufacturable"])&&(!o.shouldBeExcluded(t)&&(!e.onlyLeaf||!t.instanceOf["ds6w:globalType"]||"ds6w:Part"===t.instanceOf["ds6w:globalType"]))}function l(e,t){if(n[d.CONST_PARTIALLY_EXPANDED]&&t.length>4){let n=t.slice(0,t.length-2),i=e.find(e=>n.join("/")===e.join("/"));return i||l(e,n)}return e.find(e=>t.join("/").startsWith(e.join("/")))}let c=parseInt(n.level),u=r.parentPaths,p=n.paths,g=i.createMap(u,e=>e.join("/"),e=>[]),h={},m=1===u.length?u[0]:null,f=1===p.length?p[0]:null;return e.forEach(e=>{if(e.length<3&&n[d.CONST_PARTIALLY_EXPANDED])return;let i=function(e,t){return e.map(e=>t[e].physicalid)}(e,t),r=m||null;r||(r=l(u,i));let E=Array.isArray(r)?r.length-1:-1;if(-1===E)return;let C=f||null;C||(C=l(p,i));let _=C.length-1,y=r.join("/"),M={parentID:"",instanceDid:"",occurrencePath:[],occurenceTitle:[]};for(let i=0;i<e.length;++i){const l=e[i];if(M.occurrencePath.push(t[l].physicalid),i%2==1&&t[l]["ds6w:label"]&&M.occurenceTitle.push(t[l]["ds6w:label"]),!(i<=E)&&(i%2==1&&(M.instanceDid=l),i%2==0)){let e=t[l],u=t[M.instanceDid],p=M.parentID,m=M.occurrencePath.join("/"),f=e.coreMaterialID;f&&(e.CoreMaterialInfo=t[f],e.CoreMaterial=t[f]["ds6w:label"]);let E=e.getDeformableObjectIDFromDeformed?e.getDeformableObjectIDFromDeformed:void 0;E&&t[E]&&(e[d.CONST_DEFORMABLE_OBJECT_INFO]=t[E]);let C={...u};C.instanceOf={...e},C.occurrencePath=[...M.occurrencePath],C.occurenceTitle=M.occurenceTitle.join("/"),C.level=(C.occurrencePath.length-1)/2,C.childComputed=(-1===c||i-_<2*c)&&!n[d.CONST_PARTIALLY_EXPANDED],-1!==c&&C.childComputed||"ds6w:Part"!==e["ds6w:globalType"]||s.showFlatList||(C.children=[]);let N=h[m];if(!N){if(o.shouldBeExcluded(C))break;if(!a(s,C))continue;switch(C.type){case d.SPECIFICATION_DOCUMENT:N=o.createListNode(C,"docFromGenericExpand");break;default:N=o.createListNode(C,"instFromGenericExpand")}let e=h[p],t=N&&N.options&&N.options.grid&&N.options.grid.level?N.options.grid.level:null;e?e.addChild(N):1!=t&&"ds6w:Part"!=N.getGlobalType()?N.getOccurrencePath&&N.getOccurrencePath()&&r[r.length-1]===N.getParentIdFromOccrencePath()&&g[y].push(N):g[y].push(N),h[m]=N}N&&(M.parentID=m)}}}),g},buildLeafNodes(e){let t=this,n={};for(let i in e){let r=e[i],o=t.getLeafNodes(r);n[i]=o}return n},buildFlatList(e){let t=this,n={};for(let i in e){let r=e[i],o=t.getFlatNodes(r);n[i]=o}return n},buildReferenceNodes(e){let t=this,n={};for(let i in e){let r=e[i],o=t.getReferenceNodes(r);n[i]=o}return n},getReferenceNodes(e){let t=this,n={};return e.forEach(e=>{if(e.isEngineeringItem()){let i=e.isDeformedObject()&&t.app.core.sessionManager.shouldShowLeafMaterials()?e.getDeformableObjectIDFromDeformed():void 0;i||(i=e.isMaterialQuantity()&&t.app.core.sessionManager.shouldShowLeafMaterials()?e.options.grid.coreMaterialID:e.getID());let r=n[i];if(!r){t.app.core.sessionManager.shouldShowLeafMaterials()&&(e.isDeformedObject()&&e.options.grid[d.CONST_DEFORMABLE_OBJECT_INFO]?r=t.createDeformableNode(e.options.grid[d.CONST_DEFORMABLE_OBJECT_INFO]):e.isMaterialQuantity()&&(r=t.createMaterialNode(e.options.grid.CoreMaterialInfo))),r||(r=t.listNodeToEngItem(e));let o=e.getChildren();if(o){let e=t.getReferenceNodes(o);r.addChild(e)}n[i]=r}e.isRawMaterialType&&e.isRawMaterialType()&&e.getParent()&&r.addParentOccurences([e.getParent()]),r.addUsages([e])}else n[e.buildNodeId()]=e}),Object.keys(n).map(e=>n[e])},getLeafNodes(e){let t=[];return e.forEach(e=>{if(e.isRawMaterialType&&e.isRawMaterialType()&&!e.getParent())return;let n=e.getLeafNodes();n.forEach(e=>{e.options.children=void 0}),t=[...t,...n]}),t},getFlatNodes(e){let t=[];return e.forEach(e=>{t.push(e);let n=e.getChildNodes();t=[...t,...n]}),Array.isArray(t)&&t.length>0&&t.forEach(e=>{e.removeChildren(),e.options.children=void 0}),t},createMaterialNode:function(e){return this.createEngItem(e,this.materialFromIndexNodeOptionsMapper.bind(this))},createDeformableNode:function(e){return this.createEngItem(e,this.genericEngItemOptionsMapper.bind(this))},getTargetLevelToBuildNodeFromResponse:function(e,t){let n=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(),i=!1;return n.forEach(n=>{if(e.indexOf(n.getID())==n.getOccurrencePath().length-1)return t=e.indexOf(n.getID())/2-1,void(i=!0)}),t},isExpandOperation:function(e,t){let n=t.getChildren()?t.getChildren().length:0;return"-1"===e&&0==n||("-1"===e||e>=1)&&t.isChildComputed()}})}),define("DS/ENOXEngineer/componentsHelpers/mixins/ListToolbarBuilder",["DS/ENOXCollectionToolBar/js/ENOXCollectionToolBarV2","i18n!DS/ENOXCollectionToolBar/assets/nls/ENOXCollectionToolBar","DS/ENOXEngineer/componentsHelpers/CollectionView/ENOXResponsiveSetView"],function(e,t,n){"use strict";function i(e){if(this.buildDefaultOptionsSkeleton(),!e||!e.modelEvents)throw new Error("modelEvents is a mandatory parameter");if(this.options.modelEvents=e.modelEvents,this.parentSandbox=e.sandbox,this.releatedView=e.ListView,!e||!e.container)throw new Error("container is a mandatory parameter");this.toolbarContainer=this.createActionBarWrapper(),this.toolbarContainer.inject(e.container,"top")}return i.prototype.getActions=function(){return this.options.actions},i.prototype.getSorts=function(){return this.options.sort},i.prototype.addAction=function(e){if(!e||!e.id||!e.text)throw new Error("invalid action definition for addAction");return this.getActions().push(e),this},i.prototype.addActions=function(e){if(!Array.isArray(e))throw new Error("invalid input for addActions ");var t=this;return e.forEach(function(e){t.addAction(e)}),this},i.prototype.setDefaultView=function(e){if(!e)throw new Error("invalid viewId");return this.options.currentView=e,this},i.prototype.addSort=function(e){if(!(e&&e.id&&e.text&&e.type))throw new Error("invalid sort definition for addSort");return this.getSorts().push({id:e.id,text:e.text,type:e.type}),widget.getValue("sorting")?this.options.currentSort={id:widget.getValue("sorting").sortAttribute,order:widget.getValue("sorting").sortOrder}:1===this.getSorts().length&&(this.options.currentSort={id:e.id,order:"ASC"}),this},i.prototype.addSorts=function(e){if(!Array.isArray(e))throw new Error("invalid input for addSorts ");var t=this;return e.forEach(function(e){t.addSort(e)}),this},i.prototype.getViews=function(){return this.options.views},i.prototype.addView=function(e){if(!(e&&e.id&&e.text&&e.fonticon))throw new Error("invalid view definition for addView");return this.getViews().push({id:e.id,text:e.text,fonticon:e.fonticon}),this},i.prototype.addViews=function(e){if(!Array.isArray(e))throw new Error("invalid input for addViews ");var t=this;return e.forEach(function(e){t.addView(e)}),this},i.prototype.getMultselActions=function(){return this.options.multiselActions},i.prototype.addMultiselAction=function(e){if(!(e&&e.id&&e.text&&e.fonticon&&e.handler instanceof Function))throw new Error("invalid MultiselAction definition for addMultiselAction");return this.getMultselActions().push({id:e.id,text:e.text,handler:e.handler,fonticon:e.fonticon}),this},i.prototype.addMultiselActions=function(e){if(!Array.isArray(e))throw new Error("invalid input for addViews ");var t=this;return e.forEach(function(e){t.addMultiselAction(e)}),this},i.prototype.registeronMultiselClick=function(e){return this.options.multiselActionCallback=e,this},i.prototype.buildDefaultOptionsSkeleton=function(){return this.options={modelEvents:null,withmultisel:!0,showItemCount:!0,components:!0,multiselActions:[],multiselActionCallback:null,actions:[],sort:[],views:[],currentView:null,currentSort:null,currentNbitems:0,currentNbSelections:0},this},i.prototype.build=function(){let t=Object.assign({},this.options);delete t.views,delete t.sort,this.toolbarView=new e(t),this.toolbarContainer.empty instanceof Function?this.toolbarContainer.empty():this.toolbarContainer.innerHTML="",this.toolbarView._modelEvents.subscribe("enox-collection-toolbar-all-selected",function(){console.log("inside of subscribe"),this.selectAll()}),this.toolbarView.inject(this.toolbarContainer),this.toolbarView.attachResizeSensor()},i.prototype.createActionBarWrapper=function(){return UWA.createElement("div",{id:"listview-toolbar",styles:{height:"40px",width:"inherit"}})},i.prototype.updateCount=function(){console.warn("new count "+count)},i.prototype.destroy=function(){this.options=null,this.toolbarView=null,this.toolbarContainer.empty instanceof Function?this.toolbarContainer.empty():this.toolbarContainer.innerHTML="",this.toolbarView=null},i}),define("DS/ENOXEngineer/collections/XENContentProxyTreeDocument",["DS/Tree/TreeDocument","DS/ENOXEngineer/models/EngItemModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils"],(e,t,n,i)=>{return e.extend({defaultOptions:{nodeModelClass:t},init:function(e){var t=e||{};this.core=t.core||{},delete t.core,this._parent(t)},buildSynthesisOptions:function(e){return{ExpandSynthesisON:!0,appOptions:{retreiveTagsonInstance:!0,ident:e}}},buildFetchOptions:function(e){return{appOptions:{ident:e}}},buildFilterOptionsFromViewKey:function(e){let t=null;switch(e){case"fetchSyntesis":t=this.buildFetchOptions;break;default:t=this.buildSynthesisOptions}return Reflect.apply(t,this,[e])},getAvailableFilterOptionKeys:function(){return["fetchSyntesis","expandSyntesis"]},getFilterOptionsFromSessionManager(){const{sessionManager:e}=this.core||{};if(!e)return null;let t="expandSyntesis";return(e.isMyENGViewView()||e.isRecentItemViewView())&&(t="fetchSyntesis"),-1===this.getAvailableFilterOptionKeys().indexOf(t)?(console.debug(`XENFIlterBIPRoxy -> getFilterOptionsFromSessionManager => filterKey ${t} not available from ${this.getAvailableFilterOptionKeys()}`),null):this.buildFilterOptionsFromViewKey(t)},initXENBIFilterProxy:function(e){const t=e?JSON.stringify(e):JSON.stringify({});if(this.filterBIs&&this.filterBIs.has(t))return this._FilterBI=this.filterBIs.get(t),this._FilterBI;const r=this.core.settingManager.getWidgetId(),o=this.core.settingManager.getAppId();return this._FilterBI=function(e,t,r){if(!t||!r)return null;const o=i.initFilterBIProxy(e,t);if("function"==typeof o.setNGFilterOptions){const e={expandServices:n.use_expand_v2?["progressive","expand"]:"expand",appID:r};o.setNGFilterOptions(e)}return o}(e,r,o),this.filterBIs||(this.filterBIs=new Map),this.filterBIs.set(t,this._FilterBI),console.debug(`XENFIlterBIPRoxy -> initXENBIFilterProxy => new instance ${t}`),console.debug(`XENFIlterBIPRoxy -> Map contains => ${this.filterBIs.size} filter instances`),this.filterBIs.forEach((e,t)=>{console.debug(`XENFIlterBIPRoxy ->  =>  ${t} instance`)}),this._FilterBI},updateXENBIFilterProxy:function(e){return(!this._FilterBI||!this._FilterBI.hasOptions(e))&&(this._FilterBI&&(console.debug(`XENFIlterBIPRoxy -> updateXENBIFilterProxy switching from options -> ${JSON.stringify(this._FilterBI.filterOptions)} to  ${JSON.stringify(e)}`),this._FilterBI.deactivateFilter(),this.core.mediator.publish("XENFilterBIProxy_remove",this._FilterBI),this._FilterBI.removeEvent()),this.initXENBIFilterProxy(e),this._FilterBI&&(this.core.mediator.publish("XENFilterBIProxy_init",this._FilterBI),this._FilterBI.removeAllRoots(!1),this._FilterBI.activateFilter(),console.debug(`XENFIlterBIPRoxy -> updateXENBIFilterProxy activate with ${this._FilterBI.XENRoots.length} roots ${this._FilterBI.XENRoots}`)),!0)},resetXENBIFilterProxy:function(){console.debug("XENFIlterBIPRoxy -> resetXENBIFilterProxy"),this.filterBIs.forEach((e,t)=>{e.removeAllRoots(),e.die()}),this.filterBIs.clear(),this._FilterBI=null},getXENBIFilterProxy:function(e){return this._FilterBI||this.initXENBIFilterProxy(e),this._FilterBI},getSelectedNodes:function(e,t=null){if(!this.core)return[];if(this.core.sessionManager.isItemView()){var n=this._parent();if(!Array.isArray(n)||0===n.length)return[];var i=n[0].getContentModels()&&n[0].getContentModels().getXSO()?n[0].getContentModels().getSelectedNodes():[],r=i.length>0;const o="function"!=typeof t?i.filter(e=>e._isFromOriginalModel()):i.filter(t);return"root"===e||"addToolBar"===e&&!r?[n[0]]:r?o:[n[0]]}var o=this.core.contextManager.getActiveDocument();return o?o.getSelectedNodes():[]},getCurrentTreeDocument:function(){var e=null;if(this.core.sessionManager.isItemView()){var t=this.getChildren()[0];t&&(e=t.getContentModels())}else e=this.core.contextManager.getActiveDocument();return e},findNodesById:function(e){if(!this.core)return[];var t=null;if(this.core.sessionManager.isItemView()){var n=this.getChildren()[0];if(n&&n.getID()===e)return[n];n&&(t=n.getContentModels())}else t=this.core.contextManager.getActiveDocument();return t?t.findNodesById(e):[]},getNodesForCommands:function(e){if(!this.core)return[];if(this.core.sessionManager.isItemView()){var t=this._parent();if(!Array.isArray(t)||0===t.length)return[];var n=t[0].getContentModels()?t[0].getContentModels().getSelectedNodes():[];return n.length>0&&-1!==["root","addToolBar"].indexOf(e)?n:[t[0]]}var i=this.core.contextManager.getActiveDocument();return i?i.getSelectedNodes():[]}})}),define("DS/ENOXEngineer/components/XEngListView/js/mixins/EngItemViewsManager",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/Utils","DS/Utilities/Utils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/XEngContextManager","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/Core/PointerEvents","css!DS/ENOXEngineer/components/XEngListView/css/EngItemContentView.css"],function(e,t,n,i,r,o,s,a,l,c,d){"use strict";return t.extend({init:function(e){throw new Error("this is an abstract class it shouldn't be instanciated")},instanciedViews:{},switchView:function(e){"DataGridView"!==e?this.launchTheModelDialog(e):this.performAction(e)},launchTheModelDialog:function(t){var n=this,i=localStorage.getItem(".displayConfirmMsg"),r=!1;if(r=n.getModels().getRoots().some(function(e){return n.getModels().isViewGrouped()?r=e.getChildren().some(function(e){if(e.hasChildren()&&e.isExpanded())return!0}):!(!e.hasChildren()||!e.isExpanded())||void 0}),"true"==i)n.collapseNodes(),n.performAction(t);else if(!1===r)n.performAction(t);else{var o=n.sandbox.core.i18nManager.get("only.first.level.nodes"),s=n.sandbox.core.i18nManager.get("eng.ui.button.ok"),a=n.sandbox.core.i18nManager.get("big_tiles_view"),d=new c({className:"alternateDlgConfirm_modal",closable:!0,okButtonText:s,animate:!0,renderTo:widget.body}),u=new e.Element("div",{html:o});this.displayToggle=new l({type:"checkbox",label:n.sandbox.core.i18nManager.get("checkbox_dontshowagain"),checked:!1}),d.dialog({body:u,title:a,buttons:[{className:"primary",value:s,action:function(e){var i=n.displayToggle.isChecked();i&&localStorage.setItem(".displayConfirmMsg",i),n.collapseNodes(),n.performAction(t),e.hide()}},{value:n.sandbox.core.i18nManager.get("eng.ui.button.cancel"),action:function(e){e.hide(),t="DataGridView",n.performAction(t),n.eventsTokens.push(n._modelEvents.publish({event:"enox-collection-toolbar-change-icon-action",data:{id:"iconViewsActionBar",fonticon:"fonticon fonticon-tree-table site-icon",text:n.sandbox.core.i18nManager.get("DataGridView")}})),n.eventsTokens.push(n._modelEvents.publish({event:"enox-collection-toolbar-change-select-subMenu-action",data:{id:"DataGridView",selected:!0}})),n.eventsTokens.push(n._modelEvents.publish({event:"enox-collection-toolbar-change-select-subMenu-action",data:{id:"XENTile",selected:!1}}))}}]});var p=document.querySelector(".alternateDlgConfirm_modal .modal-footer");this.displayToggle.inject(p)}},collapseNodes:function(){var e=this;e.getModels().getRoots().forEach(function(t){e.getModels().isViewGrouped()?t.getChildren().forEach(function(e){e.hasChildren()&&e.isExpanded()&&e.collapseAll()}):t.hasChildren()&&t.isExpanded()&&t.collapseAll()})},performAction:function(e){this.hidePreviousView(),this.preferredView=e,this.toggleToolbarItems();try{this.getModels()&&this.renderPreferredView()}catch(e){console.error(e),this.renderPreferredView()}this._persistPreferredView(e)},_persistPreferredView:function(e){this.sandbox.core.localStorage.setItem(this.sandbox.getComponentName()+"_PrefView",e)},_getPersistedPrefView:function(){return this.sandbox.core.localStorage.getItem(this.sandbox.getComponentName()+"_PrefView")},hidePreviousView:function(){var e=this;Object.keys(this.instanciedViews).forEach(function(t){e.instanciedViews[t].elements.container.classList.remove("visible")}),e._emptyViewRendered&&e.removeEmptyView()},renderEmptyView:function(){this._emptyViewRendered&&this.emptyView||(this.emptyView=this.sandbox.core.moduleHelper.viewsService.getGridEmptyView(o.CONST_EMPTY_DGV_TILE_VIEW),this.emptyView&&(this._emptyViewRendered=!0,this.emptyView.inject(this.getContent())))},removeEmptyView:function(){if(this.emptyView){try{this.emptyView._containerEmptyContent&&(this.getContent().removeChild(this.emptyView._containerEmptyContent),this.emptyView._containerEmptyContent.innerHTML=""),this.emptyView.destroy()}catch(e){console.error(e)}this.emptyView=null}this._emptyViewRendered=!1},updateViewsFromCountChange:function(){(this._emptyViewRendered&&!this.isEmpty()||this.isEmpty()&&"XENTile"===this.getPreferredView())&&(this.hidePreviousView(),this.renderPreferredView())},renderPreferredView:function(){if(this.isEmpty()&&"XENTile"===this.getPreferredView())this.renderEmptyView();else{var e=this.getPreferredViewInstance();e&&e.elements.container.classList.add("visible")}},getPreferredViewInstance:function(){var e=this.getPreferredView();return this.instanciedViews[e]||this.createViewInstance(e),a.setGridView(this.activeView),a.setCurrentViewPreference(this.getPreferredView()),this.instanciedViews[e]},customViewsPersistence:function(){var e=this;this.instanciedViews.DataGridView.subscribeOnceToAllCellsRendered(function(){var t=e.instanciedViews.DataGridView.getCustomViewsManager();t.getCustomViews(),t.getCurrentCustomViewIdentifier();let n=e.sandbox.core.dicoService.userDicoPreferences.customViewsInfo;if(n){let e=n[o.XEN_CUSTO_VIEWS];for(let n in e)e&&e[n]&&t.addCustomView(e[n]);t.setCurrentCustomView(n[o.XEN_CUSTO_IDENTIFIER])}t.onCustomViewsSave=function(t,n){var i={};i[o.XEN_CUSTO_IDENTIFIER]=n,i[o.XEN_CUSTO_VIEWS]=t,i.newColumnPinnedInfo=e.instanciedViews.DataGridView.columns,e.sandbox.core.dicoService.setCustoInfoToUser(i)}})},createViewInstance:function(e){var t=this._getViewClass(e);if(!t)return null;this.instanciedViews[e]=new t(this.getViewOptions(e)),this.activeView=this.instanciedViews[e],this.activeView.getContent().inject(this.getContent()),this.configureViewInstance(this.activeView),this.registerOnViewInstance(this.activeView)},registerOnViewInstance:function(e){"DataGridView"===this.getPreferredView()&&this.buildCustomTypeRepresentation().then(function(t){e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))})},onCellDoubleClick:function(e){this.openItem(e)},openItem:function(e){var t=e.cellModel;if(t&&typeof t===Object||(t=e.nodeModel),t)if(t.isEngineeringItem()){let n=t&&e.cellModel.dataIndex&&e.cellModel.dataIndex===o.CONST_DEFORMABLE?t.options.grid[o.CONST_DS6W_DEFORMABLE]:t.getID();this.sandbox.publish(o.EVENT_LAUNCH_COMMAND,{commandId:o.OPEN_ENG_ITEM,context:{item:{objectId:n,objectType:t.getType(),itemListModel:t}}})}else t.isSelected()||(this.getModels().unselectAll(),t.select()),this.sandbox.core.mediator.publish(o.EVENT_TRIPTYCH_SHOW_PANEL,"right")},getDefauftView:function(){return"DataGridView"},getPreferredView:function(){if(this.preferredView)return this.preferredView;var e=this.getDefauftView();if(e){this.views=this.views||[];for(var t=0;t<this.views.length;t++)if(this.views[t].id===e)return this.preferredView=this.views[t].id,this.views[t].id}return this.preferredView=this.views[0].id,this.views[0].id},configureViewInstance:function(e){var t=this;e.onDelayedModelDataRequest=r.debounce(function(e){if(e&&e.collectionView&&e.collectionView.model&&t.getModels()){var n=e.collectionView.model.slice(e.startNodeIndex,e.endNodeIndex+1);Array.isArray(n)&&n.length>0&&t.getModels().fillAttributesAsync4VisibleNodes(n)}},200),"DataGridView"===this.getPreferredView()?t.eventHandlerOnGridView(e):(e.selectionBehavior={canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!0,unselectAllOnEmptyArea:!0},e.onDragStartCellDefault=function(e){return!0},e.onCellDoubleClick(t.onCellDoubleClick.bind(t)),e.allowUnsafeHTMLContent=!0,e._onCellTitleClick=function(e){var n=e;t.openItem(n)},e._onPostRequestCellCB=function(e){e.cellView.contentView.elements.picture.setStyle("background-size","contain")},e.model=t.getModels())},eventHandlerOnGridView:function(e){var t=this,n=0,r=!1;this.customViewsPersistence(),e.onDragStartCell=((e,t)=>{t.nodeModel;e.dataTransfer.effectAllowed="all",a.dragStartedInXENG=!0;const n=i.prepareDragData(a.getSelectedRealNodes());return e.dataTransfer.setData("Text",n),!1}),e.addEventListener("dragend",function(e,t){a.dragStartedInXENG=!1}),e.addEventListener(d.POINTERHIT,function(e,i){(void 0!==i&&i.columnID==o.TITLE_COLUMN_NO||i&&i.cellModel&&i.cellModel.dataIndex&&i.cellModel.dataIndex==o.CONST_DEFORMABLE&&i.nodeModel.options.grid[o.CONST_DS6W_DEFORMABLE])&&(1===e.multipleHitCount?n=setTimeout(function(){if(!r&&e.target.hasClassName("wux-tweakers-string-label")){var n=i;t.openItem(n)}r=!1},500):e.multipleHitCount>=2&&(clearTimeout(n),r=!0))}),e.addEventListener("dblclick",function(e,n){t.sandbox.core.contextManager.setDoubleClickEvent(),t.sandbox.publish(o.EVENT_REFRESH_ITEMS_BY_IDS,[n.nodeModel.getID()])}),e.addEventListener("click",function(e,i){if(void 0!==i&&-1!==i.rowID){var s=e.dsModel.layout.getDataIndexFromColumnIndex(i.columnID);if(!(e.target.hasClassName("wux-tweakers-string-label")||e.target.hasClassName("wux-tweakers-string-icon")||"ds6w:status"===s))return;switch(s){case o.TITLE_COLUMN_NO:1===e.multipleHitCount?n=setTimeout(function(){if(!r&&e.target.hasClassName("wux-tweakers-string-label")){var n=i;t.openItem(n)}r=!1},500):e.multipleHitCount>=2&&(clearTimeout(n),r=!0);break;case"ds6w:status":if(t.selectSingleInstance(i),t.getModels().getSelectedNodes()[0].isCoreMaterialType())break;t.launchCommand(o.MATURITY_GRAPH_CMD);break;case"ds6w:responsible":if(t.selectSingleInstance(i),t.getModels().getSelectedNodes()[0].isCoreMaterialType())break;t.launchCommand(o.CHANGE_OWNER_CMD);break;case"ds6wg:EnterpriseExtension.V_PartNumber":t.selectSingleInstance(i),t.launchCommand(o.SET_PART_NUMBER_CMD);break;case"ds6wg:revision":t.selectSingleInstance(i),t.launchCommand(o.VERSION_GRAPH_CMD);break;case"VariantEffectivity":t.sandbox.core.sessionManager.shouldShowFinalItems()||t.sandbox.core.sessionManager.shouldShowFlatView()||!t.sandbox.core.settingManager.isConfigAuthorized()||(t.selectSingleInstance(i),t.launchCommand(o.EDIT_VARIANT_EFFECTIVITY_CMD));break;case"CurrentEvolutionEffectivity":t.sandbox.core.sessionManager.shouldShowFinalItems()||t.sandbox.core.sessionManager.shouldShowFlatView()||!t.sandbox.core.settingManager.isConfigAuthorized()||(t.selectSingleInstance(i),t.launchCommand(o.SET_EVOLUTION_EFFECTIVITY_CMD));break;case o.CONT_QUANTITY_MASS:t.selectSingleInstance(i),t.launchCommand(o.CHANGE_MASS_QUANTITY_CMD);break;case o.CONT_QUANTITY_VOLUME:t.selectSingleInstance(i),t.launchCommand(o.CHANGE_VOLUME_QUANTITY_CMD);break;case"quantity":t.selectSingleInstance(i),t.launchCommand(o.CHANGE_QUANTITY_CMD);break;case"CoreMaterial":case"CoveringMaterial":case"CoveringMaterialInstance":t.selectSingleInstance(i),t.launchCommand(o.MATERIALS_CMD);break;case"Alternate":t.selectSingleInstance(i),t.launchCommand(o.ALTERNATES_CMD);break;case"Manufacturing":t.selectSingleInstance(i),t.launchCommand(o.MANUF_RESP_CMD);break;case"MadeFrom":t.selectSingleInstance(i),t.launchCommand(o.MADE_FROM_CMD);break;case o.CONST_SPEC_RELATION_COLUMN_DATAINDEX:t.selectSingleInstance(i),t.launchCommand(o.SPEC_DOC_CMD)}}})},launchCommand:function(e,t){this.sandbox.core.mediator.publish(o.EVENT_LAUNCH_COMMAND,{commandId:e,context:t||{item:this.getModels().getSelectedNodes()}})},selectSingleInstance:function(e){this.getModels().getSelectedNodes().length>=1&&this.unSelectAll(),e.nodeModel.select()},getDGVCellSelection:function(){const e=o.DGV_SELECTION_MULTIPLE;switch(this.sandbox.core.sessionManager.getSelectionMode()){case o.SELECT_MODE_CELL:return o.DGV_SELECTION_MULTIPLE;case o.SELECT_MODE_ROW:return o.DGV_SELECTION_NONE;default:return e}},getViewOptions:function(e){var t={};return"DataGridView"==e?(this.getModels().addFilterModel(),(t={treeDocument:this.getModels(),columns:this.sandbox.columnsManager.getDatagridViewColumns(this.getModels()),showNodeKPIColorFlag:this.getModels().isColorizeEnabled(),rowSelection:o.DGV_SELECTION_MULTIPLE,cellSelection:this.getDGVCellSelection(),identifier:"XEN-DatagridView_"+this.sandbox.core.settingManager.getWidgetId(),defaultColumnDef:{width:"auto",typeRepresentation:"string",editionPolicy:"EditionOnDoubleClick"},rowDragEnabledFlag:!0,rowReorderEnabledFlag:!1,useAsyncPreExpand:!0,placeholder:"",onContextualEvent:e=>{let t=[];if(!e||!e.cellInfos||!e.collectionView)return t;if(-1===e.cellInfos.rowID){t=e.collectionView.buildDefaultContextualMenu(e,{}),this.sandbox.core.commandManager._buildMenuEnty({nls_key:"Clear Sort",fonticon:"clear"},"PushItem").action.callback=(()=>{let t=e.collectionView;t.prepareUpdateView(),t.sortModel=null,t.sortModel=[{dataIndex:"ro.plminstance.V_treeorder-Instance",sort:"asc"}],t.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0)});this.sandbox.core.commandManager._buildMenuEnty({nls_key:"Attribute Management",fonticon:"attributes",commandHdr:o.LAUNCH_ATTRIBUTES_MGT_CMD},"PushItem")}else{var n=e.cellInfos.nodeModel;n.isSelected()||(this.unSelectAll(),n&&n.select()),t=n?n.getEngineeringMenu(o.ENG_ITEM_VIEW):[]}return t}}).onDragStartRowHeader=function(e,t){var n=t.nodeModel;n&&n.getTreeDocument(),e.dataTransfer.effectAllowed="all",a.dragStartedInXENG=!0;var r=i.prepareDragData(a.getSelectedRealNodes());return e.dataTransfer.setData("Text",r),console.log(r),!1},t.onDragStartColumnHeader=function(e,t){return a.dragStartedInXENG=!0,!0}):t={height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","description","activeFlag"],useDragAndDrop:!0,sandbox:this.sandbox,onDragStartCell:function(e,t){var n=t.nodeModel;n&&n.getTreeDocument(),e.dataTransfer.effectAllowed="all",a.dragStartedInXENG=!0;var r=i.prepareDragData(a.getSelectedRealNodes());return e.dataTransfer.setData("Text",r),!0},onDragEndCell:function(e,t){return a.dragStartedInXENG=!1,!0}},t},_getViewClass:function(e){for(var t=0;t<this.views.length;t++)if(this.views[t].id===e)return this.views[t].Clazz;return null},loadViewsClass:function(){var e=this;return this.classLoaderPromise?this.classLoaderPromise:(this.classLoaderPromise=new n(function(t,n){i.loadFiles(e.views.map(function(e){return e.loader})).then(function(n){for(var i=0;i<e.views.length;i++)e.views[i].Clazz=n[i];e.views=Object.freeze(e.views),t(e.views)}).catch(function(e){n(e)})}),this.classLoaderPromise)},initializeViews:function(){var e=this;this.views=this._views,this.containerInstance=document.createElement("div"),this.loadViewsClass().then(function(t){e.renderPreferredView(),e.sandbox.subscribe(o.EVENT_COLORIZATION_UPDATED,function(t){var n=e.instanciedViews.DataGridView;n&&(n.showNodeKPIColorFlag=t)}),e.sandbox.subscribe(o.EVENT_REAPPLY_DATAGRID_SORT_MODEL,function(){var t=e.instanciedViews.DataGridView;t&&t.reapplySortModel()})}).catch(function(e){console.error(e)})},reDrawColumns:function(e){if(this.instanciedViews.DataGridView){var t=this.instanciedViews.DataGridView;if(!t)return;var n=this.sandbox.columnsManager.getDatagridViewColumns(this.getModels());if(Array.isArray(n)&&n.length>0){var i=(t.columns||[]).map(function(e){return e.dataIndex});t.prepareUpdateView(),i.forEach(function(i){var r=n.find(function(e){return e.dataIndex===i});"tree"===i||!e&&r||t.removeColumnOrGroup(i)});var r=0;n.forEach(function(n){var o=i.find(function(e){return n.dataIndex===e});"tree"===n.dataIndex||!e&&o||t.addColumnOrGroup(n,r),r++}),t.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}}},launchGroupBy:function(e){this.getModels().groupRoots(e)},destroyLoadedViews:function(){this.getModels()&&this.getModels().getModelEvents()&&this.getModels().getModelEvents().unsubscribeAll({event:"modelUpdate"});for(var e=Object.keys(this.instanciedViews),t=0;t<e.length;t++){var n=this.instanciedViews[e[t]];if("function"==typeof n.destroy)try{n.destroy();for(var i=Object.keys(n||{}),r=0;r<i.length;r++)n[i[r]]=void 0}catch(e){console.error(e)}delete this.instanciedViews[e[t]]}this.activeView=null},destroyViews:function(){this.destroyLoadedViews(),this.classLoaderPromise=null,this.views=null,this._views=null},getAvailableViews:function(){return this._views.map(function(e){return{id:e.id,text:e.text,fonticon:e.fonticon}})},getDataUpdateConfirmationDailog:function(t,n,i,r){var o=this,s=localStorage.getItem(".isDbRefreshPromotChecked");if("true"!==s){if("false"!==s){var a=o.sandbox.core.i18nManager.get("eng.ui.confirm.refresh.db.info"),c=o.sandbox.core.i18nManager.get("eng.ui.button.ok"),d=o.sandbox.core.i18nManager.get("eng.db.data.refresh.prompt.title");new e.Element("div",{html:a});this.displayToggle=new l({type:"checkbox",label:o.sandbox.core.i18nManager.get("checkbox_dontshowagain"),checked:!1});var u=this.getSuperModelDailog(c);u.dialog({body:a,title:d,buttons:[{className:"primary",value:c,action:function(e){var s=o.displayToggle.isChecked();s&&localStorage.setItem(".isDbRefreshPromotChecked",s),o.refresh(t,n,i,r),e.hide()}},{value:o.sandbox.core.i18nManager.get("eng.ui.button.cancel"),action:function(e){o.displayToggle.isChecked()&&localStorage.setItem(".isDbRefreshPromotChecked","false"),e.hide()}}]});var p=document.querySelector(".alternateDlgConfirm_modal .modal-footer");return this.displayToggle.inject(p),u}}else o.refresh(t,n,i,r)},getSuperModelDailog:function(e){return new c({className:"alternateDlgConfirm_modal",closable:!0,okButtonText:e,animate:!0,renderTo:widget.body})}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/FindCommandView",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/XENPanel","DS/Utilities/Utils","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/WUXAutoComplete/AutoComplete","DS/Controls/Button","DS/Controls/ButtonGroup","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/Expander","DS/Core/PointerEvents","DS/Utilities/TouchUtils","DS/UIKIT/Spinner","DS/UIKIT/Tooltip","DS/Utilities/Dom","DS/ENOXEngineer/utils/XEngineerConstants","css!DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/css/XENFindView.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m,f){"use strict";function E(e){return this.appCore=e.appCore,this.elements={},this.options=e||{},this.options=Object.assign({},this.options),this.options.strString="",this.currentValue=0,this.options.matchingStringCount=0,this.buildFindPanel(),this}return E.prototype.buildFindPanel=function(){let e=this.getselectedProductLable();this.findContainer=this._buildContent(),this.elements.panelFind=new t({target:widget.body,closeButtonFlag:!0,title:this.appCore.i18nManager.get("find-cmd")+" - "+e,titleBarVisibleFlag:!0,width:"auto",height:"auto",content:this.findContainer,position:{my:"top right",at:"top right",offsetX:-50,offsetY:150},resizableFlag:!0,closeCB:this.close.bind(this)}),this.elements.panelFind.getContent().addClassName("eno-xen-find-panel")},E.prototype._buildContent=function(){return this.elements.content=m.createElement("div",{class:"eno-xen-find-panel-content"}),this.elements.actions=m.createElement("div",{class:"eno-xen-find-panel-actions"}),!0===p.getTouchMode()&&this.elements.content.setAttributeNode(document.createAttribute("touch-mode")),this.elements.wuxautocomplete=this._buildAutoCompleteModel().inject(this.elements.content),this.__integrateFindResults(),this.elements.findBtn=this._buildWUXButton("eno-xen-controls-find-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.searchButton.tooltip"),"check",!0).inject(this.elements.actions),this.elements.findBtn.getContent().addEventListener("buttonclick",this._launchSearch.bind(this)),this.elements.previousBtn=this._buildWUXButton("eno-xen-controls-arrow-up-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.previousButton.tooltip"),"chevron-up",!0),this.elements.previousBtn.getContent().addEventListener("buttonclick",this._goToPreviousFindResult.bind(this)),this.elements.nextBtn=this._buildWUXButton("eno-xen-controls-arrow-down-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.nextButton.tooltip"),"chevron-down",!0),this.elements.nextBtn.getContent().addEventListener("buttonclick",this._goToNextFindResult.bind(this)),this.elements.navGrp=new a({}).inject(this.elements.actions),this.elements.navGrp.addChild(this.elements.previousBtn),this.elements.navGrp.addChild(this.elements.nextBtn),this.elements.selectBtn=this._buildWUXButton("eno-xen-controls-select-btn eno-xen-controls-button",this.appCore.i18nManager.get("eng.findCmd.selectButton.tooltip"),"select-on",!0).inject(this.elements.actions),this.elements.selectBtn.getContent().addEventListener("buttonclick",this._launchSelect.bind(this)),this.elements.content.appendChild(this.elements.actions),this.elements.content.classList.add("eno-xen-find-with-cols-chooser"),this.buildOptionsDiv(this.elements.content),this.elements.content},E.prototype.buildOptionsDiv=function(e){var t=this;this.options.selectPredicates=[],e.classList.add("eno-xen-find-with-cols-chooser");let n=m.createElement("div",{class:"eno-xen-find-options"});this.elements.selectMatch=new l({type:"checkbox",label:this.appCore.i18nManager.get("eng.findCmd.options"),checkFlag:"boolean"==typeof this.options.availableCols.selectedMatch&&this.options.availableCols.selectedMatch}),this.elements.selectMatch.getContent().addClassName("eno-xen-find-options-select"),n.appendChild(this.elements.selectMatch.getContent());let o=m.createElement("span",{class:"eno-xen-find-options-findIn"});o.innerText=this.appCore.i18nManager.get("eng.findCmd.findIn"),n.appendChild(o);let s=this.colModel=new i({}),a=this.options.availableCols.allCols,u=["ds6wg:DELFmiContQuantity_Mass.V_ContQuantity","ds6wg:DELFmiContQuantity_Volume.V_ContQuantity","ds6w:reserved"];for(let e=0;e<a.length;e++){let t=a[e];if(!u.includes(t.ds6w)&&("string"===t.kind||"tag"===t.kind||"url"===t.kind)){let e=new r({label:t.text,grid:{ds6w:t.ds6w},value:t.ds6w});this.options.selectPredicates.push(t.ds6w),s.addRoot(e)}}this.elements.selectedColList=new c({elementsTree:s,placeholder:this.appCore.i18nManager.get("eng.findCmd.find.none"),enableSearchFlag:!1,autocompleteFlag:!1,multiSelFlag:!0}),this.elements.selectedColList.getContent().addClassName("eno-xen-controls-autocomplete-colList");let p=s.getRoots();for(let e=0;e<p.length;e++)-1!==this.options.availableCols.selectedCols.indexOf(p[e].getReferenceValue("ds6w"))&&p[e].select();n.appendChild(this.elements.selectedColList.getContent());let g=new d({header:this.appCore.i18nManager.get("eng.findCmd.header.options"),body:n,style:"simple"});g.getContent().addClassName("eno-xen-controls-colList-expander"),t.elements.selectedColList.addEventListener("click",function(){t.__checkLaunchBtn()}),e.appendChild(g.getContent())},E.prototype._buildAutoCompleteModel=function(){let e=this;this.options.autocompleteModel=new i;let t=e.appCore.localStorage.getItem("eno-xen-find-panel");if(t){let n=JSON.parse(t);Array.isArray(n)&&n.forEach(function(t){e.options.autocompleteModel.addRoot(t)})}let n=new o({elementsTree:this.options.autocompleteModel,multiSearchMode:!1,placeholder:""});return n.getContent().addClassName("eno-xen-controls-autocomplete"),n.addEventListener("change",function(){if(e.count=0,e.currentValue=0,n.selectedItems){let t=n.selectedItems.getLabel();e.options.strString=t,e._addAutocompleteModelNode(t)}else e.options.strString="";e.__checkLaunchBtn(),e._displayCurrentValue()}),n},E.prototype._buildWUXButton=function(e,t,n,i){let r=new s({icon:{iconName:n,fontIconFamily:1},disabled:i});if(r.getContent().addClassName(e),t){new h({target:r.elements.button}).setBody(t)}return r},E.prototype.getselectedProductLable=function(){let e="";if(this.appCore&&this.appCore.contextManager&&this.appCore.contextManager.getXENTreeDocument&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes&&this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()){let t=this.options.selectedNodes=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();e=t.length>1?t.length+" "+this.appCore.i18nManager.get("eng.findCmd.multiple.title"):this.appCore.contextManager.getXENTreeDocument().getSelectedNodes()[0].getLabel()}return e},E.prototype._addAutocompleteModelNode=function(e){if(0===this.options.autocompleteModel.search({match:function(t){return t.nodeModel.getLabel()===e}}).length){let t=this.options.autocompleteModel.getRoots();5===t.length&&(this.options.autocompleteModel.removeRoot(t[4]),t=this.options.autocompleteModel.getRoots());let n=new r({label:e,icons:[{iconName:"clock",fontIconFamily:1}]});0===t.length?this.options.autocompleteModel.addRoot(n):this.options.autocompleteModel.insertBefore(n,t[0]),this._storeAutocompleteModel()}},E.prototype._storeAutocompleteModel=function(){let e=[],t=this.options.autocompleteModel.getRoots();Array.isArray(t)&&t.forEach(function(t){e.push(t.dump())}),this.appCore.localStorage.setItem("eno-xen-find-panel",JSON.stringify(e))},E.prototype.getsetlectedPredicates=function(){let e=this,t=(e.options.selectPredicates,[]);if(e.elements.selectedColList){let n=e.colModel.getSelectedNodes();Array.isArray(n)&&(t.push("physicalid"),n.forEach(function(e){let n=e.getReferenceValue("ds6w");t.push(n)}))}return t},E.prototype._launchSearch=function(e){let t=this,i=function(){if(t.options.events&&t.options.events.onSearch){t.options.autocompleteModel.getSelectedNodes();let e=t.getsetlectedPredicates(),n={searchFts:""===t.options.strString?t.elements.wuxautocomplete._editor.value:t.options.strString,selectMatch:!!t.elements.selectMatch&&t.elements.selectMatch.checkFlag,selectedNodes:t.options.selectedNodes,selectedPredicates:e};t.options.events.onSearch(n)}},r=n.debounce(i,500);e?r():i()},E.prototype.close=function(){this.options.events.onClose&&this.options.events.onClose(),this.elements.panelFind&&this.elements.panelFind.closePanel();let e=Object.keys(this.elements);for(let t=0;t<e.length;t++)this.elements[e[t]]&&(this.elements[e[t]].destroy?this.elements[e[t]].destroy():delete this.elements[e[t]],this.elements[e[t]]=void 0)},E.prototype._goToPreviousFindResult=function(){let e=this,t=e.currentValue;e.count&&0!==e.count&&(e.currentValue>1?e.currentValue--:e.currentValue=e.count,e._displayCurrentValue()),e.currentValue&&t!==e.currentValue&&e.options.events&&e.options.events.onFindPreviousResult&&e.options.events.onFindPreviousResult()},E.prototype._goToNextFindResult=function(){let e=this,t=e.currentValue;e.count&&0!==e.count&&(e.currentValue<e.count?e.currentValue++:e.currentValue=1,e._displayCurrentValue()),e.currentValue&&t!==e.currentValue&&e.options.events&&e.options.events.onFindNextResult&&e.options.events.onFindNextResult()},E.prototype._launchSelect=function(){this.options.events&&this.options.events.onSelect&&this.options.events.onSelect({})},E.prototype.__checkLaunchBtn=function(){let e=this.colModel.getSelectedNodes();this.options.strString&&this.options.strString.length>0&&Array.isArray(e)&&e.length>0?this.elements.findBtn.disabled=!1:this.elements.findBtn.disabled=!0},E.prototype._displayCurrentValue=function(){if(this.elements.findCounter&&(this.elements.findCounter.innerText=!1===this.elements.findBtn.disabled&&this.options.strString&&""!==this.options.strString&&void 0!==this.currentValue&&void 0!==this.count?this.currentValue+"/"+this.count:""),void 0===this.count)this.elements.selectBtn.disabled=!0,this.elements.previousBtn.disabled=!0,this.elements.nextBtn.disabled=!0;else{let e=!(this.count>1);this.elements.previousBtn&&this.elements.nextBtn&&this.elements.selectBtn&&(this.elements.previousBtn.disabled=e,this.elements.nextBtn.disabled=e),0===this.count?this.elements.selectBtn.disabled=!0:this.elements.selectBtn.disabled=!1}},E.prototype.__integrateFindResults=function(){let e=this.elements.wuxautocomplete.getContent().querySelector(".wux-controls-autoComplete-editor");e.classList.add("eno-xen-autoComplete-editor-with-counter"),e.firstChild.classList.add("eno-xen-autoComplete-input"),this.elements.results=m.createElement("div",{class:"eno-xen-controls-find-results"}),this.elements.findCounter=m.createElement("span",{class:"eno-xen-controls-find-counter"}),this.elements.results.appendChild(this.elements.findCounter),this.elements.loader=new g({visible:!1,animate:!0,spin:!0}),this.elements.results.appendChild(this.elements.loader.getContent()),this.elements.loader.getContent().addClassName("eno-xen-controls-find-loader"),e.insertBefore(this.elements.results,e.childNodes[1])},E.prototype.setMatchingStringCount=function(e){this.count=e,this.currentValue=0,this.count>0&&(this.currentValue=1),this._displayCurrentValue()},E}),define("DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/FindCommand",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/componentsHelpers/ENOXFindCommand/js/FindCommandView","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e),this.options=e},execute:function(e){var i=this;i.end(),this.findCmdView=new t({availableCols:{selectedCols:i._getSelectedColumnsForFind(),allCols:i.appCore.dicoService.getVisibleAttrForBO(),selectedMatch:i._isAutoSelectOptionSelected()},events:{onSearch:function(e){i.appCore.mediator.subscribe(n.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,function(e){i.getGridView()&&i.getGridView().setFindStr&&(i.getGridView().getNodeModelToProcessForFind=function(t,n){let r=[],o=1==i._selectNodes.length&&i.appCore.contextManager&&i.appCore.contextManager.getActiveEngItem&&i.appCore.contextManager.getActiveEngItem()&&i.appCore.contextManager.getActiveEngItem().getID()===i._selectNodes[0].getID()?i.appCore.contextManager.getActiveEngItem().getChildren():i._selectNodes;return e&&Array.isArray(o)&&o.forEach(function(e){Array.isArray(e.getAllDescendants())&&e.getAllDescendants().length>0&&e.getAllDescendants().forEach(function(e){r.push(e)}),r.push(e)}),r},i.getGridView().setFindStr(i._selectMatchStr,void 0,void 0,void 0,!0),i._selectFirstMatchingCellAndNode())}),i.appCore.mediator.publish(n.EVENT_FIND_IN_CONTEXT_LAUNCH,e),i._selectMatch=e.selectMatch,i._selectMatchStr=e.searchFts,i._selectNodes=e.selectedNodes,i.appCore.localStorage.setItem(n.CONST_FIND_IN_CONTEST_AUTOSELECT_OPTION,i._selectMatch),i.appCore.localStorage.setItem(n.CONST_FIND_IN_CONTEST_SELECTED_COLUMNS,JSON.stringify(e.selectedPredicates))},onFindPreviousResult:i._goToPreviousMatchingCell.bind(i),onFindNextResult:i._goToNextMatchingCell.bind(i),onSelect:i._selectAllNodesWithMatchCell.bind(i),onClose:i._onClose.bind(i)},appCore:i.appCore})},_isAutoSelectOptionSelected:function(){return this.appCore.localStorage.getItem(n.CONST_FIND_IN_CONTEST_AUTOSELECT_OPTION)},_getSelectedColumnsForFind:function(){let e=this.appCore.localStorage.getItem(n.CONST_FIND_IN_CONTEST_SELECTED_COLUMNS);if(e)return JSON.parse(e);{e=[];let t=this.appCore.dicoService.getVisibleAttrForBO();return Array.isArray(t)&&t.forEach(function(t){"string"!==t.kind&&"tag"!==t.kind&&"url"!==t.kind||e.push(t.ds6w)}),e}},_selectFirstMatchingCellAndNode:function(){this._selectNodeFromMatchCell(),this.findCmdView.setMatchingStringCount(this.getGridView().matchingStringCount)},getGridView:function(){return!!(this.appCore&&this.appCore.contextManager&&this.appCore.contextManager._activeGridView)&&this.appCore.contextManager._activeGridView},_goToPreviousMatchingCell:function(){let e=this;e.getGridView()&&e.getGridView().goToPreviousMatchingCell&&(e.getGridView().goToPreviousMatchingCell(),e._selectNodeFromMatchCell())},_goToNextMatchingCell:function(){let e=this;e.getGridView()&&e.getGridView().goToNextMatchingCell&&(e.getGridView().goToNextMatchingCell(),e._selectNodeFromMatchCell())},_selectNodeFromMatchCell:function(){if(this._selectMatch){this.getGridView().unselectAll();let e=this.appCore.contextManager._activeGridView.getNodeModelAt(this.appCore.contextManager._activeGridView._getMatchingCellID(this.appCore.contextManager._activeGridView._currentMatchingCellIDIndex));e&&!0!==e.isSelected()&&e.select()}},_selectAllNodesWithMatchCell:function(){this.getGridView().unselectAll();let e=this.getGridView().getMatchingFindNodeModelArray();Array.isArray(e)&&e.forEach(function(e){e.select()})},_onClose:function(){this.getGridView().onFindClose()},endExecute(){this.findCmdView&&this.findCmdView.close()}})}),define("DS/ENOXEngineer/components/XEngListView/js/mixins/ToolBarManager",["UWA/Core","UWA/Class","DS/Core/ModelEvents","DS/ENOXEngineer/componentsHelpers/mixins/ListToolbarBuilder","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/UIKIT/Input/Toggle","DS/UIKIT/SuperModal","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/ENOXEngineer/models/EngItemGroupModel"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";var p=null;const g="enox-collection-toolbar-change-select-subMenu-action";return t.extend({init:function(e){throw new Error("this is an abstract class it shouldn't be instanciated")},initializeToolbar:function(){this._modelEvents=new n,p=new i({modelEvents:this._modelEvents,container:this.getContent(),ListView:this}),this.buildToolBar(),this._listenToToolbarEvents()},updateCount:function(){var e=this.getModels()?this.getModels():null;let t=e?e.getSelectedNodes():[],n=this.sandbox.core.contextManager.getActiveEngItem();var i=(e?e.getChildrenWithoutGroupingNodes():[]).filter(e=>!e.isHiddenByTagger()&&!e.isHiddenBySearch()).length;this._modelEvents.publish({event:"enox-collection-toolbar-items-count-update",data:i}),i||(this.disableMultisel(),this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1})),1!==t.length?this.setMultiselMenuStatus(t.length):l.areEngItemsEqual(t[0],n)||this.setMultiselMenuStatus(t.length),this.updateViewsFromCountChange()},updateSelectedItemsCount:function(e){var t=this.getModels()._numberOfNodesInDocument,n=this.getModels().getSelectedNodes(),i=n.length;"XENTile"===this.preferredView&&(i>0?t===i?this._modelEvents.publish({event:a.EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_CHECKED}):this._modelEvents.publish({event:a.EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_PARTIAL}):this._modelEvents.publish({event:a.EVENT_COLLECTION_SELECTALL_CHECKBOX_STATUS_UNCHECKED})),e||this.disableMultisel(),this.setMultiselMenuStatus(e),this.setExpandMenuStatus(n),this.setFindMenuStatus(n),this.setAddMenuStatus(n),this.setGroupByMenuStatus(n)},setGroupByMenuStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;t=this.sandbox.core.contextManager.getActiveEngItem().hasValidTransientGroupingContext()?a.EVENT_TOOLBAR_DISABLE:a.EVENT_TOOLBAR_ENABLE,this._modelEvents.publish({event:t,data:a.GROUPBY_MENU})},setAddMenuStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;const{sessionManager:n}=this.sandbox.core;if((n.shouldShowFinalItems()||n.shouldShowMfgView()||n.shouldShowLeafMaterials()||n.shouldShowFlatView())&&(t=a.EVENT_TOOLBAR_DISABLE),t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const i=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(i)&&i.length)for(let e=0;e<i.length;e++)if("ds6w:Part"!==i[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),n=Array.isArray(i)?i.filter(t=>e.getID()!=t.getID()):null;!e.hasValidTransientGroupingContext()||Array.isArray(n)&&n.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.ADD_MENU})},setFindMenuStatus:function(e){let t=a.EVENT_TOOLBAR_ENABLE;const{sessionManager:n}=this.sandbox.core;if((n.shouldShowFinalItems()||n.shouldShowMfgView()||n.shouldShowLeafMaterials())&&(t=a.EVENT_TOOLBAR_DISABLE),t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const i=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(i)&&i.length)for(let e=0;e<i.length;e++)if("ds6w:Part"!==i[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),r=Array.isArray(i)?i.filter(t=>e.getID()!=t.getID()):null;!e||!e.hasValidTransientGroupingContext()||n.shouldShowFlatView()||Array.isArray(r)&&r.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.FIND_MENU})},setExpandMenuStatus:function(e){let t=this.sandbox.sessionManager.shouldShowFinalItems()||this.sandbox.sessionManager.shouldShowLeafMaterials()||this.sandbox.sessionManager.shouldShowFlatView()?a.EVENT_TOOLBAR_DISABLE:a.EVENT_TOOLBAR_ENABLE;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(e)&&e.length)for(let n=0;n<e.length;n++)if(e[n]instanceof u&&e[n].isGroupFromExpand()){t=a.EVENT_TOOLBAR_DISABLE;break}const n=Array.isArray(e)?e.filter(e=>!(e instanceof u)):null;if(t===a.EVENT_TOOLBAR_ENABLE&&Array.isArray(n)&&n.length)for(let e=0;e<n.length;e++)if("ds6w:Part"!==n[e]._options.grid["ds6w:globalType"]){t=a.EVENT_TOOLBAR_DISABLE;break}if(t===a.EVENT_TOOLBAR_ENABLE){const e=this.sandbox.core.contextManager.getActiveEngItem(),i=Array.isArray(n)?n.filter(t=>e.getID()!=t.getID()):null;!e.hasValidTransientGroupingContext()||Array.isArray(i)&&i.length||(t=a.EVENT_TOOLBAR_DISABLE)}this._modelEvents.publish({event:t,data:a.EXPAND_MENU})},setMultiselMenuStatus:function(e){e?(this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!0}),this._modelEvents.publish({event:"enox-collection-toolbar-multiselect-icon-update-count",data:e})):this._modelEvents.publish({event:"enox-collection-toolbar-visibility-iconMultipleActionBar",data:!1})},disableMultisel:function(){this.activeView&&"function"==typeof this.activeView.deactivateInteractiveCumulativeSelection&&this.activeView.deactivateInteractiveCumulativeSelection()},_listenToToolbarEvents:function(){this.eventsTokens=[];var e=this;this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-switch-view-activated"},function(t){console.warn("switching view to  --\x3e "+t),e.switchView(t)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"event-persist-view"},function(t){e.sandbox.core.localStorage.setItem("List_view",t)}));let t=a.EVENT_TOOLBAR_SEARCH;this.eventsTokens.push(e.sandbox.subscribe(t,function(t){var n=Array.isArray(t.searchValue)?t.searchValue[0]:"",i=(new Date).getTime();e.getModels().prepareUpdate(),e.getModels().getAllTheExpanedNodes().forEach(function(t){t.unMatch(n)?t.setSearchFilterState(!0):t.setSearchFilterState(!1),t.unMatch(n)||e.setIsHiddenState(t),t.applyFilters()}),e.getModels().pushUpdate(),e.updateCount(),console.warn("ending search in "+((new Date).getTime()-i)+"ms")})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-sort-activated"},function(t){e.getModels().onSorting(t)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-selected"},function(){e.selectAll()})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-click-multiselect-icon"},function(t){e.onMultiselClick(t.object.elements.container)})),this.eventsTokens.push(e._modelEvents.subscribe({event:"enox-collection-toolbar-all-unselected"},function(){e.unSelectAll(),e.activeView&&"function"==typeof e.activeView.deactivateInteractiveCumulativeSelection&&e.activeView.deactivateInteractiveCumulativeSelection()})),this.eventsTokens.push(e._modelEvents.subscribe({event:a.EVENT_STRUCTURE_VIEW_CHANGED},function(t){e.refreshToolBar()}))},setIsHiddenState:function(e){if(e.getParent()&&""!==e.getParent().getID()){var t=e.getParent();t._isHidden=!1,this.setIsHiddenState(t)}},destroyToolbar:function(){var e=this;this.eventsTokens.forEach(function(t){e._modelEvents.unsubscribe(t)}),p.destroy(),p=null},getAvailableActions:function(){var e=[this.buildAddMenu(),this.buildPasteCmd(),this.buildFindCmd(),this.buildFilterCmd(),this.buildExpandMenu(),this.buildStructureViewsMenu(),this.buildGroupByMenu(),this.buildAttributeManagementCmd()];return"true"===localStorage.getItem(a.ENABLE_SELECTION_MODES)&&e.push(this.buildSelectModeSwitch()),e},buildAddMenu:function(){return{id:a.ADD_MENU,text:this.i18nManager.get("Add"),fonticon:"fonticon fonticon-plus",handler:e=>{"XENTile"===this.getPreferredView()&&this.getModels().unselectAll(),this.sandbox.core.commandManager.renderMenu(e.target.getBoundingClientRect(),"addToolBar")}}},buildPasteCmd:function(){return{id:"paste",text:this.sandbox.i18nManager.get("Paste"),fonticon:"fonticon fonticon-paste",handler:e=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.ITEM_PASTE_CMD,context:{item:this.getModels().getSelectedNodes()}})}}},buildFindCmd:function(){return{id:a.FIND_MENU,text:this.sandbox.i18nManager.get("find-cmd"),fonticon:"fonticon fonticon-find",handler:(e,t)=>{this.sandbox.sessionManager.isUsingIndex()?(this.findInCMD(e),this.sandbox.publish(a.SWITCH_MODE,{switchMode:"index"})):this.launchModelDialog(a.FIND_ITEMS_CMD,e)}}},buildFilterCmd:function(){return{id:"NG_Filtering",text:this.i18nManager.get("NG_Filtering"),fonticon:"fonticon fonticon-filter",handler:e=>{console.warn("NG_Filtering"),this.sandbox.sessionManager.isUsingIndex()?(this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_NG_FILTER_CMD,context:{}}),this.sandbox.sessionManager.setAuthoringMode("index")):this.launchModelDialog()}}},buildExpandMenu:function(){return{id:a.EXPAND_MENU,text:this.sandbox.i18nManager.get("expand_menu"),fonticon:"fonticon fonticon-flow-tree-expand-down",content:[{id:a.EXPAND_CMD,text:this.sandbox.i18nManager.get(this.sandbox.core.commandManager.getCommandMetaData(a.EXPAND_CMD).nls_key),fonticon:this.sandbox.core.commandManager.getCommandMetaData(a.EXPAND_CMD).fonticon,changeIconSelection:!0,selectable:!1,handler:(e,t)=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.EXPAND_CMD,context:{appCore:this,event:e,item:this.getModels().getSelectedNodes()}})}},{id:a.EXPAND_ALL_CMD,text:this.sandbox.i18nManager.get(this.sandbox.core.commandManager.getCommandMetaData(a.EXPAND_ALL_CMD).nls_key),fonticon:this.sandbox.core.commandManager.getCommandMetaData(a.EXPAND_ALL_CMD).fonticon,changeIconSelection:!0,selectable:!1,handler:(e,t)=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.EXPAND_ALL_CMD,context:{appCore:this,event:e,item:this.getModels().getSelectedNodes()}})}},{id:a.EXPAND_N_LEVEL_CMD,text:this.sandbox.i18nManager.get(this.sandbox.core.commandManager.getCommandMetaData(a.EXPAND_N_LEVEL_CMD).nls_key),fonticon:this.sandbox.core.commandManager.getCommandMetaData(a.EXPAND_N_LEVEL_CMD).fonticon,changeIconSelection:!0,selectable:!1,handler:(e,t)=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.EXPAND_N_LEVEL_CMD,context:{appCore:this,event:e,item:this.getModels().getSelectedNodes()}})}},{id:a.COLLAPSE_ALL_CMD,text:this.sandbox.i18nManager.get(this.sandbox.core.commandManager.getCommandMetaData(a.COLLAPSE_ALL_CMD).nls_key),fonticon:this.sandbox.core.commandManager.getCommandMetaData(a.COLLAPSE_ALL_CMD).fonticon,changeIconSelection:!0,selectable:!1,handler:(e,t)=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.COLLAPSE_ALL_CMD,context:{appCore:this,event:e}})}}]}},buildStructureViewsMenu:function(){return{id:"structureView",text:this.sandbox.i18nManager.get("structureViews"),fonticon:"fonticon fonticon-tree-view-flattened-cog",multiSelect:!0,content:[this.buildTreeViewCmd({changeIconSelection:!1}),this.buildFlatViewCmd({changeIconSelection:!1}),this.buildLeafViewCmd({changeIconSelection:!1}),this.buildMadeFromViewCmd({changeIconSelection:!1}),this.buildSeparator(),this.buildUsageViewCmd({changeIconSelection:!1}),this.buildReferenceViewCmd({changeIconSelection:!1}),this.buildSeparator(),this.buildManufViewCmd({changeIconSelection:!1})]}},buildSeparator:function(){return{className:"divider"}},buildTitle:function(e){return{text:this.sandbox.i18nManager.get(e),className:"header"}},buildTreeViewCmd:function(){return this.buildStructureViewCmd({id:a.DIRECT_CMD,label:"eng.displayOption.structure.tree",icon:"tree-view-all"})},buildFlatViewCmd:function(){return this.buildStructureViewCmd({id:a.FLAT_LIST_VIEW,label:"eng.displayOption.structure.flat",icon:"view-list"})},buildLeafViewCmd:function(){return this.buildStructureViewCmd({id:a.QUALIFIED_AS_FINAL_CMD,label:"eng.export.components.qualifiedAsFinal",icon:"tree-view-leaf",indexOnly:!0})},buildMadeFromViewCmd:function(){return this.buildStructureViewCmd({id:a.LEAF_MATERIALS_CMD,label:"eng.export.components.leafMaterials",icon:"raw-material",indexOnly:!0})},buildUsageViewCmd:function(){return this.buildQuantityViewCmd({id:a.INSTANCE_CMD,label:"instanceView",icon:"object-instance"})},buildReferenceViewCmd:function(){return this.buildQuantityViewCmd({id:a.REFERENCE_CMD,label:"quantityView",icon:"object-reference"})},buildStructureViewCmd:function({id:e,label:t,icon:n,indexOnly:i}){return{id:e,text:this.sandbox.i18nManager.get(t),fonticon:`fonticon fonticon-${n}`,changeIconSelection:!1,selectable:!0,selected:e===this.sandbox.sessionManager.getFlatViewOption(),handler:()=>{this.updateDisplayOptionMenu(a.VALUE_QUALIFIED_AS_FINAL_COMPONENT,e),i&&!this.sandbox.sessionManager.isUsingIndex()?this.launchModelDialog(e):(this.sandbox.publish(a.EVENT_QUALIFIED_AS_FINAL_ITEM,{commandId:e}),this.sandbox.publish(a.SWITCH_MODE,{switchMode:i?"index":this.sandbox.sessionManager.determineAuthoringMode()}))}}},buildQuantityViewCmd:function({id:e,label:t,icon:n,indexOnly:i}){return{id:e,text:this.sandbox.i18nManager.get(t),fonticon:`fonticon fonticon-${n}`,changeIconSelection:!1,selectable:!0,selected:e===this.sandbox.sessionManager.getQuantityViewOption(),handler:(t,n)=>{this.updateDisplayOptionMenu("quantityView",e),this.sandbox.publish(a.EVENT_CHANGE_QUANTITY_VIEW,{commandId:e})}}},updateDisplayOptionMenu:function(e,t){switch(e){case a.VALUE_QUALIFIED_AS_FINAL_COMPONENT:this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.DIRECT_CMD,selected:t===a.DIRECT_CMD}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.FLAT_LIST_VIEW,selected:"flatListView"===t}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.QUALIFIED_AS_FINAL_CMD,selected:t===a.QUALIFIED_AS_FINAL_CMD}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.LEAF_MATERIALS_CMD,selected:t===a.LEAF_MATERIALS_CMD}});break;case"quantityView":this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.REFERENCE_CMD,selected:t===a.REFERENCE_CMD}}),this._modelEvents.publish({event:a.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:a.INSTANCE_CMD,selected:t===a.INSTANCE_CMD}})}},buildManufViewCmd:function(){var e=this.sandbox.core.sessionManager.shouldShowMfgView();return{id:a.MANUFACTURING_CMD,text:this.sandbox.i18nManager.get("manufacturableView").replace("$1",this.sandbox.i18nManager.get(a.DS6W_MANUFACUTRABLE)),fonticon:"fonticon fonticon-factory",selectable:!0,selected:e,className:e?"xeng-app-mfgview-icon":"",handler:(e,t)=>{this.sandbox.sessionManager.isUsingIndex()?(this.switchToMFGView(e),this.sandbox.publish(a.SWITCH_MODE,{switchMode:"index"})):this.launchModelDialog(a.MANUFACTURING_CMD,e)}}},buildReorderCmd:function(){return{id:"UPSAuthReorderProduct",text:this.i18nManager.get("reorder-cmd"),fonticon:"fonticon fonticon-list-ordered",handler:e=>{console.warn("Reorder"),this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_REORDER_CMD,context:{}})}}},buildGroupByMenu:function(){return{id:a.GROUPBY_MENU,text:this.i18nManager.get("tooltip_GroupBy"),fonticon:"fonticon fonticon-group",handler:this.showGroupByMenu.bind(this)}},buildAttributeManagementCmd:function(){return{id:"AttributesManager",text:this.i18nManager.get("label_attributesManagement"),fonticon:"fonticon fonticon-attributes",handler:e=>{this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_ATTRIBUTES_MGT_CMD,context:{}})}}},buildSelectModeSwitch:function(){let e=this.sandbox.core.sessionManager.getSelectionMode();return{id:"SelectMode",text:this.i18nManager.get("Select"),fonticon:"fonticon fonticon-select-on",className:e&&e===a.SELECT_MODE_ROW?"xeng-app-mfgview-icon":"",handler:e=>{this.switchSelectMode(),this.updateSelectModeIcon()}}},updateSelectModeIcon:function(){let e=this.getSelectMode();var t=document.querySelector("#SelectMode");e===a.SELECT_MODE_ROW?t.addClassName("xeng-app-mfgview-icon"):e===a.SELECT_MODE_CELL&&t.removeClassName("xeng-app-mfgview-icon")},switchSelectMode:function(){let e=this.getSelectMode();e===a.SELECT_MODE_ROW&&this.setSelectMode(a.SELECT_MODE_CELL),e===a.SELECT_MODE_CELL&&this.setSelectMode(a.SELECT_MODE_ROW)},setSelectMode:function(e){switch(e){case a.SELECT_MODE_CELL:this.sandbox.core.contextManager._activeGridView.cellSelection=a.DGV_SELECTION_MULTIPLE;break;case a.SELECT_MODE_ROW:this.sandbox.core.contextManager._activeGridView.cellSelection=a.DGV_SELECTION_NONE;break;default:console.log("invalid select mode")}this.sandbox.core.sessionManager.setSelectionMode(e)},getSelectMode:function(){const e=this.sandbox.core.settingManager.getDefaultSelectionMode();return this.sandbox.core.contextManager._activeGridView&&this.sandbox.core.contextManager._activeGridView.cellSelection?this.sandbox.core.contextManager._activeGridView.cellSelection===a.DGV_SELECTION_NONE?a.SELECT_MODE_ROW:this.sandbox.core.contextManager._activeGridView.cellSelection===a.DGV_SELECTION_MULTIPLE?a.SELECT_MODE_CELL:e:e},switchToMFGView:function(e){var t=this.sandbox.core.sessionManager.shouldShowMfgView();this.sandbox.publish(a.EVENT_CHANGE_MFG_VIEW,{isMFGView:!t,commandId:a.MANUFACTURING_CMD})},launchModelDialog:function(t,n){var i=this;switch(t){case a.QUALIFIED_AS_FINAL_CMD:var r=i.sandbox.i18nManager.get("flattened.view");break;case a.MANUFACTURING_CMD:r=i.sandbox.i18nManager.get("manufacturable.view");break;case a.LEAF_MATERIALS_CMD:r=i.sandbox.i18nManager.get("leafmaterials.view");break;case a.FIND_ITEMS_CMD:r=i.sandbox.i18nManager.get("find-cmd");break;default:r=i.sandbox.i18nManager.get("NG_Filtering")}var o=i.sandbox.i18nManager.replace(i.sandbox.i18nManager.get("index_Flattened_Advanced"),{view:r}),l=i.sandbox.i18nManager.get("eng.ui.button.ok"),c=new s({className:"alternateDlgConfirm",closable:!0,okButtonText:l,animate:!0,renderTo:widget.body}),d=new e.Element("div",{html:o});c.dialog({body:d,title:r,buttons:[{className:"primary",value:l,action:function(e){t===a.MANUFACTURING_CMD?i.switchToMFGView(n):t===a.FIND_ITEMS_CMD?i.findInCMD(n):t===a.QUALIFIED_AS_FINAL_CMD?i.sandbox.sessionManager.switchToFlattenedView({commandId:"QualifiedAsFinal"}):t===a.LEAF_MATERIALS_CMD?i.sandbox.sessionManager.switchToFlattenedView({commandId:a.LEAF_MATERIALS_CMD}):i.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.LAUNCH_NG_FILTER_CMD,context:{}}),i.sandbox.sessionManager.setAuthoringMode("index"),e.hide()}},{value:i.sandbox.i18nManager.get("eng.ui.button.cancel"),action:function(e){t===a.MANUFACTURING_CMD&&i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.MANUFACTURING_CMD,selected:!1}})),t!==a.QUALIFIED_AS_FINAL_CMD&&t!==a.LEAF_MATERIALS_CMD||(i.sandbox.sessionManager.shouldShowFlatView()?(i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.DIRECT_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.FLAT_LIST_VIEW,selected:!0}}))):(i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.DIRECT_CMD,selected:!0}})),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.FLAT_LIST_VIEW,selected:!1}}))),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.QUALIFIED_AS_FINAL_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.LEAF_MATERIALS_CMD,selected:!1}}))),e.hide()}}]});document.querySelector(".alternateDlgConfirm .modal-footer");var u=document.getElementsByClassName("close fonticon fonticon-cancel");null!=u&&(u[0].onclick=function(){t===a.MANUFACTURING_CMD&&i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.MANUFACTURING_CMD,selected:!1}})),t!==a.QUALIFIED_AS_FINAL_CMD&&t!==a.LEAF_MATERIALS_CMD||(i.sandbox.sessionManager.shouldShowFlatView()?(i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.DIRECT_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.FLAT_LIST_VIEW,selected:!0}}))):(i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.DIRECT_CMD,selected:!0}})),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.FLAT_LIST_VIEW,selected:!1}}))),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.QUALIFIED_AS_FINAL_CMD,selected:!1}})),i.eventsTokens.push(i._modelEvents.publish({event:g,data:{id:a.LEAF_MATERIALS_CMD,selected:!1}}))),modal.hide()})},findInCMD:function(e){this.sandbox.publish(a.EVENT_LAUNCH_COMMAND,{commandId:a.FIND_ITEMS_CMD,context:{appCore:this,event:e}})},onMultiselClick:function(e){e&&(this.sandbox.core.contextManager.setMultiselMenu(!0),this.getModels().getSelectedItemsCommonMenu(e.getBoundingClientRect()))},refreshToolBar:function(){if(!p)throw new Error(" toolbar not yet initialized")},buildToolBar:function(){if(!p)throw new Error(" toolbar not yet initialized");p.addActions(this.getAvailableActions()).setDefaultView(this.getDefauftView()).addViews(this.getAvailableViews()).build()},showGroupByMenu:function(e){var t=[],n=this,i=widget.getValue("groupBy");t.push(n.sandbox.core.commandManager.getGenericMenuEnty({nls_key:n.sandbox.i18nManager.get("None"),callback:function(e){n.launchGroupBy({propertiesToGroup:[]})},args:["None"],state:void 0===i?"selected":"unselected",type:"CheckItem"})),n.sandbox.core.sessionManager.shouldShowQuantityView()||t.push(n.sandbox.core.commandManager.getGenericMenuEnty({state:!0===n.getModels().isNotWaitingForAttributes()?"enabled":"disabled",nls_key:n.sandbox.i18nManager.get("Reference"),callback:function(e){n.sandbox.core.sessionManager.shouldShowQuantityView()||n.launchGroupBy({propertiesToGroup:["reference"]})},args:["Reference"],state:"reference"===i?"selected":"unselected",type:"CheckItem"}));n.getModels().getAvailableAttributesForGrouping().forEach(function(e){if(!e.ds6wFrom||"rel"!==e.ds6wFrom||!n.sandbox.core.sessionManager.shouldShowQuantityView()){const r=n.i18nManager.get("eng.export.instance.key");let o=e.ds6wFrom&&"rel"===e.ds6wFrom?e.text+` (${r})`:e.text;t.push(n.sandbox.core.commandManager.getGenericMenuEnty({nls_key:o,callback:function(t){n.launchGroupBy({propertiesToGroup:[e.dataIndex]})},args:[e.ds6w],state:i===e.dataIndex?"selected":"unselected",type:"CheckItem"}))}});n.sandbox.core.commandManager.showMenu(e.target.getBoundingClientRect(),t)}})}),define("DS/ENOXEngineer/components/XEngListView/js/EngItemContentViewer",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/components/XEngListView/js/mixins/ToolBarManager","DS/ENOXEngineer/components/XEngListView/js/mixins/EngItemViewsManager","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i,r,o,s,a,l,c,d,u,p){"use strict";return t.extend(n,s,a,{defaultOptions:{useToolBar:!0},contentType:"BOM",init:function(e){this.sandbox=e,this.sandbox.logger.info("initializing EngItemContentViewer ..."),this._parent({}),this.elements.container=e.container,this.i18nManager=e.i18nManager,this._views=[{id:"DataGridView",text:this.i18nManager.get("DataGridView"),loader:"DS/DataGridView/DataGridView",fonticon:"fonticon fonticon-tree-table site-icon"}]},start:function(){this.sandbox.logger.info("starting EngItemContentViewer ...");var e=this;e.sandbox.subscribe(r.EVENT_CHANGE_DIRECT_VIEW,function(){e.switchToDirectView()}),e.initializeToolbar(),e.initializeViews(),e.toggleToolbarItems(),this.sandbox.registerDnDManager({sandbox:this.sandbox,container:this.getContent(),dropStrategy:"BOM",droppable:!0,onDrop:e.onValidDrop.bind(e)}),this.getModels().onPostENOXFiltering=this.updateCount.bind(this),this.getModels().onSelectionUpdated=this.updateSelectedItemsCount.bind(this),e.sandbox.subscribe(r.EVENT_CREATED_NODES,function(t){e.addContentToModels(t)}),e.sandbox.subscribe(r.EVENT_INSTANCES_CREATED,function(t){e.getModels().addNewInstances(t)}),e.sandbox.subscribe(r.EVENT_INDEX_MODE_DISABLE,function(){}),e.sandbox.subscribe(r.EVENT_REPLACED_ENG_ITEM,function(t){e.replaceContent(t)}),e.sandbox.subscribe(r.EVENT_REPLACED_DOCUMENT,function(t){e.replaceDocument(t)}),e.sandbox.subscribe(r.EVENT_LIST_SELECT_ITEM,function(t){e.select(data[t.rowID])}),e.sandbox.subscribe(r.EVENT_NOTIFY_CONTENT_SIZE_CHANGE,function(){e.updateCount()}),e.sandbox.subscribe(r.EVENT_DELETED_ENG_ITEM,function(t){Array.isArray(t.ids)&&-1!==t.ids.indexOf(e.sandbox.options.physicalId)&&e.sandbox.publish(r.EVENT_GO_BACK)});e.sandbox.subscribe(r.EVENT_TRIPTYCH_PANEL_VISIBLE,function(t){"right"===t&&e.sandbox.core.PersistencyManager.setInformationPanelStatus(!0)}),e.sandbox.subscribe(r.EVENT_TRIPTYCH_PANEL_HIDDEN,function(t){"right"===t&&e.sandbox.core.PersistencyManager.setInformationPanelStatus(!1)}),e.sandbox.subscribe(r.EVENT_TRIPTYCH_RESIZE_PANEL,t=>{const n=t?t.side:null,i=t?t.width:null;if("right"===n&&i){const t=e.sandbox.core.PersistencyManager;t&&t.setInformationPanelWidth(i)}});e.sandbox.subscribe(r.EVENT_DOWNLOAD_ITEM,function(t){e.sandbox.dataService.downloadDocuments(t.nodes)}),e.sandbox.subscribe(r.EVENT_REMOVE_DOCUMENT,function(t){e.sandbox.dataService.detachDocuments(t.nodes,e.getModels().getEngineeringItem())}),e.sandbox.subscribe(r.EVENT_DELETE_DOCUMENT,function(t){e.sandbox.dataService.deleteDocuments(t.nodes)}),e.sandbox.subscribe(r.EVENT_REMOVED_INSTANCE,function(t){e.getModels().deleteNodesByInstanceID(t),e.updateCount()}),e.sandbox.subscribe(r.EVENT_REMOVED_NODES,function(t){e.getModels().prepareUpdate(),t.nodes.forEach(function(t){e.getModels().removeRoot(t)}),e.getModels().pushUpdate(),e.updateCount()}),e._refreshSubscription=i.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){var n=[];if(t.data.authored)if(t.data.authored.deleted&&t.data.authored.deleted.length>0)t.data.authored.deleted.forEach(function(e){n.push(e)}),e.removeNodes(n);else if(t.data.authored.modified)t.data.authored.modified.forEach(function(e){let t="object"==typeof e?e.physicalid:e;n.push(t)}),e.updateContent(n);else if(Array.isArray(t.data.authored)){let i=[],o=e.getModels().getEngineeringItem(),s=o.getID(),a=[];t.data.authored.forEach(function(e){e.modified&&e.previous&&(i.push({instance:e.modified,child:o.getNodesByRelId(e.previous)[0].getID(),parent:s,split:!0}),n.push(e.previous),e.modified===e.previous&&a.push(o.getNodesByRelId(e.previous)[0]))}),i.length&&e.sandbox.publish(r.EVENT_INSTANCES_CREATED,i),a.forEach(function(e){e.select()}),e.updateContent(n)}}),e.sandbox.subscribe(r.EVENT_REFRESH_ITEMS_BY_IDS,function(t){Array.isArray(t)&&e.updateContent(t)}),e.sandbox.subscribe(r.EVENT_REFRESH_LISTVIEW,function(){e.getModels().prepareUpdate(),e.getModels().pushUpdate()}),e.sandbox.subscribe(r.EVENT_STRUCTURE_VIEW_CHANGED,function(){e.toggleToolbarItems(),e.sandbox.publish(r.EVENT_COLUMNS_CHANGED,{updateExitingColumns:!0})}),e.sandbox.subscribe(r.EVENT_TAGGER_GROUP_CHANGED,function(){e.launchGroupBy({propertiesToGroup:[]})}),e.sandbox.subscribe(r.EVENT_COLUMNS_CHANGED,function(t){var n=!1;t&&t.updateExitingColumns&&(n=!0),e.reDrawColumns(n)}),e.sandbox.subscribe(r.EVENT_MODIFIED_NODES,function(t){t&&Array.isArray(t)&&e.updateNodes(t)}),e.sandbox.subscribe(r.EVENT_SET_PARTNUMBER_COMPLETED,function(t){t&&Array.isArray(t.references)&&e.updateContent(t.references.map(function(e){return e.physicalid}),function(e){if(e.isEngineeringItem())for(var n=0;n<t.references.length;n++)if(t.references[n].physicalid===e.getID()){var i=t.references[n].partNumber?t.references[n].partNumber.trim():null;return i&&0===i.length&&(i=null),void e.updateOptions({grid:{"ds6wg:EnterpriseExtension.V_PartNumber":i}})}})}),e._clipBoard=i.subscribe(r.ADD_TO_CLIPBOARD,function(t){l.setItem("clipboard",t),e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:"paste"});var n=[];if((t||0!=t.length)&&t.startsWith("CX"))for(var i=t.substring(3).split(","),o=0;o<i.length;o++)n.push(i[o].split("|")[1])}),e.sandbox.publish(r.EVENT_LIST_READY),e.updateCount()},toggleToolbarItems:function(){var e=this;const t=e.sandbox.core.contextManager.getActiveEngItem(),n=!!t&&t.hasValidTransientGroupingContext();let i=e.sandbox.sessionManager.shouldShowMfgView();if(!e.sandbox.core.settingManager.isIndexModeEnabled()){e.sandbox.sessionManager.shouldShowFinalItems()&&e.sandbox.publish(r.EVENT_CHANGE_DIRECT_VIEW),i&&e.sandbox.publish(r.EVENT_CHANGE_MFG_VIEW,{commandId:r.MANUFACTURING_CMD,isMFGView:!1}),e.sandbox.core.settingManager.getSetting(r.UNSUPPORTED_TOOLBAR_ACTIONS_AUTHORING_MODE).forEach(t=>{e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:t})})}const o=e.getModels().getSelectedNodes();e.updateSelectedItemsCount(Array.isArray(o)?o.length:0),e.sandbox.sessionManager.shouldShowLeafMaterials()?(e._modelEvents.publish({event:r.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:r.REFERENCE_CMD,selected:!0}}),e._modelEvents.publish({event:r.EVENT_TOOLBAR_CHANGE_SELECTION,data:{id:r.INSTANCE_CMD,selected:!1}}),e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.INSTANCE_CMD})):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.INSTANCE_CMD}),e.sandbox.sessionManager.shouldShowFinalItems()||null==l.getItem("clipboard")||e.sandbox.sessionManager.shouldShowMfgView()||e.sandbox.sessionManager.shouldShowLeafMaterials()||e.sandbox.sessionManager.shouldShowFlatView()?e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:"paste"}):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:"paste"}),n?e._modelEvents.publish({event:r.EVENT_TOOLBAR_DISABLE,data:r.GROUPBY_MENU}):e._modelEvents.publish({event:r.EVENT_TOOLBAR_ENABLE,data:r.GROUPBY_MENU})},removeNodes:function(e){var t=[];this.getModels().findNodesByIds(e).forEach(function(e){t.push(e.options.instanceId)}),this.sandbox.publish(r.EVENT_REMOVED_INSTANCE,{instances:t})},updateContent:function(e,t){var n=this.getModels().findNodesByIds(e);this.updateNodes(n,t)},updateNodes:function(e,t){var n=this,i=[],r=[];let o=e.filter(function(e){return e._isFromOriginalModel()});o.forEach(e=>{if("function"==typeof t&&t(e),e.isDocument())i.push(e);else if(n.sandbox.core.Factories.ListItemFactory.isInstanceOfListNodeModel(e)){const t=e.getOccurrencePath?e.getOccurrencePath():null;r.push(t)}else{var o=e.getUsages?e.getUsages():[];if(o&&Array.isArray(o)&&o.length>0)if(e.isCoreMaterialType()){const e=o.map(e=>e.getOccurrencePath());r.push(...e)}else{const e=o[0].getOccurrencePath?o[0].getOccurrencePath():null;r.push(e)}}}),i.length>0&&n.updateDocument(i),r.length>0&&n.update(o,r)},onValidDrop:function(e){let t=this;const n=p._getItemsByTypeFromDroppedData(e,t.sandbox.core.dicoService.localDico),i=t.getModels().getEngineeringItem()._getChildInstanceNodes().map(e=>e.getRelationID()),o=t.getModels().getEngineeringItem().getID();if(null!=n.VPMReference||null!=n.Document||null!=n.Drawing){if(Array.isArray(n.dsc_matref_ref_Core)){const e=n.dsc_matref_ref_Core.map(e=>e.displayName).join(", ");d.warningAlert(t.sandbox.i18nManager.replace(t.sandbox.i18nManager.get("eng.ui.dialog.multisel.drop.material.ignored"),{materials:e}))}if(Array.isArray(n.VPMReference)){let e=n.VPMReference.map(e=>e.objectId);t.sandbox.dataService.createInstances({parentID:o,referencesIDs:e,existingInstancesIDs:i}).then(e=>{let n=e.filter(e=>"success"===e.status);t.sandbox.publish(r.EVENT_INSTANCES_CREATED,n)}).catch(e=>{console.error(e);const{error:n,type:i}=e||{};let{message:r}=n||{};"string"==typeof r&&r.trim().length||(r=t.sandbox.i18nManager.get("error.drop.failed")),d.errorAlert(t.sandbox.i18nManager.replace(t.sandbox.i18nManager.get("error.operation.failed"),{operation:"",error:r}))})}if(Array.isArray(n.Drawing)){let e=n.Drawing.map(e=>e.objectId);t.sandbox.dataService.createInstances({parentID:o,referencesIDs:e}).then(e=>{let n=e.filter(e=>"success"===e.status);t.sandbox.publish(r.EVENT_INSTANCES_CREATED,n)}).catch(e=>{console.error(e),d.errorAlert(t.sandbox.i18nManager.replace(t.sandbox.i18nManager.get("error.operation.failed"),{operation:"",error:e}))})}Array.isArray(n.Document)&&n.Document.forEach(function(e){t.sandbox.dataService.attachDocumentToEngItem(t.getModels().getEngineeringItem(),e.objectId,!1).then(e=>{t.addContentToModels({nodes:[e],parentId:o})}).catch(e=>{console.error(e)})})}else if(Array.isArray(n.dsc_matref_ref_Core)&&1===n.dsc_matref_ref_Core.length){var s=n.dsc_matref_ref_Core[0],a={id:s.objectId,"ds6w:label":s.displayName,"ds6wg:revision":"","ds6w:type":s.displayType,"ds6w:type_value":s.objectType};t.sandbox.publish(r.EVENT_LAUNCH_COMMAND,{commandId:r.ADD_MATERIAL_QUANTITY_CMD,context:{item:a}})}},replaceContent:function(e){var t=[],n=[];e.forEach(function(e){t.push(e.replacedId),n.push([e.parentId,e.new.instance,e.new.reference])});var i=this.getModels().findQtyOrInstNodeByIds(t);this.update(i,n,!0)},update:function(e,t,n){var i=this,r=this.sandbox.core.sessionManager.shouldShowQuantityView()?"reference":"instance";this.sandbox.core.dataService.getListNodesFromPaths({paths:t,nodesType:r,isRefreshing:!0,isFromReplace:n,isOnAuthoring:!0}).then(function(t){i.sandbox.core.contextManager.isDoubleClickEvent()?(i.sandbox.core.contextManager.areEngItemGridValuesEqual(e[0],t[0])||i.getDataUpdateConfirmationDailog(e,t,n,!0),i.sandbox.core.contextManager.clearDoubleClickEvent()):i.refresh(e,t,n,!0)}).catch(function(e){e.error&&e.error.message&&e.error.message.contains("timedout")&&d.warningAlert(i.sandbox.i18nManager.get("timeout_alert_refresh")),console.error(e)})},refresh:function(e,t,n,i){this.getModels().prepareUpdate();var r=this.sandbox.core.contextManager.getActiveEngItem();if(!0===n)this.getModels().isViewGrouped()&&this.getModels().ungroupRoots(),e.forEach(function(n){var i=n.getParent();n.isEngineeringItem()?(i.removeChild(n),t.forEach(function(e){let t=e.getOccurrencePath();(""==i.getID()||null==i.getID()||null==i.getID()?r.getID():i.getID())===t[t.length-3]&&i.addChild(e)})):(i.removeChild(e[0]),i.addChild(t[0]))});else for(var o=0;o<e.length;o++)t[o]&&t[o].options&&t[o].options.grid&&t[o].options.grid.children&&delete t[o].options.grid.children,e[o].refreshByModel(t[o],"",i);this.getModels().refreshProvidedColumns(e,!0),this.getModels().pushUpdate(),this.getModels().reApplyUserCurrentViewOptions(),this.getModels().reApplyGroups()},updateDocument:function(e){var t=this;let n=e.map(e=>e.getID());this.sandbox.core.dataService.fetchDocumentsDataAsNodes(n).then(function(n){t.sandbox.core.contextManager.isDoubleClickEvent()?(t.sandbox.core.contextManager.areEngItemGridValuesEqual(e,n)||t.getDataUpdateConfirmationDailog(e,n),t.sandbox.core.contextManager.clearDoubleClickEvent()):t.refresh(e,n)}).catch(function(e){console.error(e)})},replaceDocument:function(e){var t=this,n=this.getModels().findNodesById(e.oldDocumentId);this.sandbox.core.dataService.fetchDocumentsDataAsNodes([e.replacedDocumentId],"SpecificationDocument").then(function(e){t.refresh(n,e,!0)}).catch(function(e){console.error(e)})},selectAll:function(){this.getModels().selectAll()},unSelectAll:function(){this.getModels().unselectAll()},addContentToModels:function(e){this.sandbox.logger.info("adding content --\x3e"),this.getModels().mainAddContent(e.nodes,void 0,e.physicalIdList,e.selectedNodesToInsert,e.isChangeQuntity),this.updateCount(),void 0!==e.physicalIdList&&e.physicalIdList.length>0&&this.sandbox.options.physicalId!==e.physicalIdList[0]&&this.getModels().getSelectedNodes().forEach(function(e){e.expandAll()}),this.getModels().pushToTagger()},getModels:function(){return this.sandbox&&this.sandbox.options?this.sandbox.options.models:null},isEmpty:function(){return!this.getModels()||0===this.getModels().getChildren().length},buildCustomTypeRepresentation:function(){var e=this,t={};return new Promise(function(n,i){let r=e.sandbox.core.dataService.getRangeValueNlsTracker();e.i18nManager.resolveRangeValueNls(r).finally(function(){e.sandbox.core.dicoService.getRangeValueAttributes().forEach(function(n){let i=n.AuthorizedValues.sort().map(function(t){return{value:t,label:e.i18nManager.get(`${n.ds6w}/${t}`)}});t[p.getAlphaNumericName(n.ds6w)]={stdTemplate:"enumCombo",semantics:{valueType:"enumString",possibleValues:i}}}),n(t)})})},stop:function(){this.getModels().removeFromTagger([this.sandbox.options.physicalId]),i.unsubscribe(this._refreshSubscription),i.unsubscribe(this._clipBoard),this.sandbox.logger.info("stopping EngItemContentViewer ..."),this.destroyToolbar(),this.destroyViews(),this.sandbox.stop(this)}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialChangeQuantityViewModel",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o)=>{const s=`${i.CONT_QUANTITY_MASS}_reference`,a=`${i.CONT_QUANTITY_VOLUME}_reference`;return class extends n{initViewOptions(e){e.addRemoveNodeAuthorized=!1,e.editableProperties.push(...[i.DECLARED_VOLUME,i.CONT_QUANTITY_MASS,i.CONT_QUANTITY_VOLUME])}set nodes(e){super.nodes=e,e.forEach(e=>{let t=null,n=null;e.hasMassQuantity()?(t=e.getMassQuantity(),n=s):e.hasVolumeQuantity()&&(t=e.getVolumeQuantity(),n=a),this.setQuantityReferenceValueAndGetter(e,n,t)})}setQuantityReferenceValueAndGetter(e,n,i){if(!e||!n||Number.isNaN(i))return;const r={};r[`${n}`]=parseFloat(i),t.updateNodeOptions(e,{grid:r}),e.getQuantityReferenceValue=(()=>e.options.grid[n])}get nodes(){return super.nodes}getNodeReferenceValue(e){return e&&e.getQuantityReferenceValue?e.getQuantityReferenceValue():null}computeNodeRollUpValue(e,t,n){return!e||Number.isNaN(t)?null:(n&&n.useReference?this.getNodeReferenceValue(e):null)||parseFloat(t)}getRollup(e,t){let n=0,i=0;e.forEach(e=>{const r=e.hasVolumeQuantity();if(r){const n=this.computeNodeRollUpValue(e,r,t);return void(n&&(i+=n))}const o=e.hasMassQuantity();if(o){const i=this.computeNodeRollUpValue(e,o,t);i&&(n+=i)}});const r=[];if(n){const e=this.appCore.PreferencesManager.getNLSValueForMassQuantity();r.push(`${n} ${e}`)}if(i){const e=this.appCore.PreferencesManager.getNLSValueForVolumeQuantity();r.push(`${i} ${e}`)}return r.join(" + ")}get editableProperties(){return[i.DECLARED_VOLUME,i.CONT_QUANTITY_MASS,i.CONT_QUANTITY_VOLUME]}getColumns(){let e=[];e.push(...super.getColumns());const t=-1!==this.usages.findIndex(e=>e.hasMassQuantity());if(t){const t=e.find(e=>e.dataIndex===i.CONT_QUANTITY_MASS);t&&(t.pinned="left",t.width=100,t.editableFlag=!0,t.setCellValue=this.setCellMassQuantityValue.bind(this),t.getCellSemantics=(()=>({minValue:0})),t.getCellEditableState=this.getCellMassEditableState.bind(this))}else e=e.filter(e=>e.dataIndex!==i.CONT_QUANTITY_MASS);const n=-1!==this.usages.findIndex(e=>e.hasVolumeQuantity());if(n){const t=e.find(e=>e.dataIndex===i.CONT_QUANTITY_VOLUME);t&&(t.pinned="left",t.width=100,t.editableFlag=!0,t.setCellValue=this.setCellVolumeQuantityValue.bind(this),t.getCellSemantics=(()=>({minValue:0})),t.getCellEditableState=this.getCellVolumeEditableState.bind(this))}else e=e.filter(e=>e.dataIndex!==i.CONT_QUANTITY_VOLUME);return(n||t)&&e.push({pinned:"left",width:100,editableFlag:!1,text:o.get("savedQuantityColumnTitle"),getCellValue:this.getCellQuantityReferenceValue.bind(this),visibleFlag:!1,dataIndex:"getQuantityReferenceValue"}),e}getCellQuantityReferenceValue(e){const{nodeModel:t}=e;let n=null;return t.getQuantityReferenceValue&&(n=t.getQuantityReferenceValue()),n}getCellMassEditableState(t){return!!(e.is(t)&&e.is(t.nodeModel)&&e.is(t.nodeModel.hasMassQuantity))&&t.nodeModel.hasMassQuantity()}getCellVolumeEditableState(t){return!!(e.is(t)&&e.is(t.nodeModel)&&e.is(t.nodeModel.hasVolumeQuantity))&&t.nodeModel.hasVolumeQuantity()}computeGridForMassUpdate(e,t){const n={};return n[i.CONT_QUANTITY_MASS]=t,n[`${i.CONT_QUANTITY_MASS}_converted`]=t,n}computeGridForVolumeUpdate(e,n){const r={};return t.hasGridAttributeValued(e,i.DECLARED_VOLUME)?r[i.DECLARED_VOLUME]=n:r[i.CONT_QUANTITY_VOLUME]=n,r[`${i.CONT_QUANTITY_VOLUME}_converted`]=n,r}setCellQuantityValue(e,t,n){const i=e.nodeModel.getID(),r=this.usages.filter(e=>e.getID()===i),o=t.toString();r.forEach(e=>{const i=n===s?this.computeGridForMassUpdate(e,o):this.computeGridForVolumeUpdate(e,o),r=this.getNodeReferenceValue(e);t!==r?this.udpateAsModifyNode(e,i):this.udpateAsNonModifyNode(e,i)})}setCellMassQuantityValue(e,t){return this.setCellQuantityValue(e,t,s)}setCellVolumeQuantityValue(e,t){return this.setCellQuantityValue(e,t,a)}findFirstModifiedNode(){return this.usages.find(e=>t.isNodeModified(e))}executeChangeQuantity({modify:e}){const t=[];e.forEach(e=>{e.hasMassQuantity()?t.push({physicalid:e.getID(),quantity:{name:i.DIMENSION_MASS,value:e.getMassQuantity(),unit:widget.getValue(i.PREFERRED_MASS_UNIT)}}):e.hasVolumeQuantity()&&t.push({physicalid:e.getID(),quantity:{name:i.DIMENSION_VOLUME,value:e.getVolumeQuantity(),unit:widget.getValue(i.PREFERRED_VOLUME_UNIT)}})}),t.length&&this.appCore.dataService.modifyQuantityOnMaterial({items:t}).then(e=>{let t=[];t=this.appCore.sessionManager.shouldShowQuantityView()&&this.referenceNode?[this.referenceNode.getID()]:e.references.map(e=>e.physicalid),this.appCore.mediator.publish(i.EVENT_REFRESH_ITEMS_BY_IDS,t)}).catch(e=>{let t="modifyQuantityFailed";if(Reflect.has(e,"response")){const{response:n}=e;if(Reflect.has(n,"internal"))switch(n.internal){case"no right access":t="error.ERR_RightAccess"}}r.errorAlert(this.appCore.i18nManager.get(t))})}duplicateNode(e){const t=super.duplicateNode(e);return["hasMassQuantity","hasVolumeQuantity","getMassQuantity","getVolumeQuantity","appendConverted","getQuantityReferenceValue"].forEach(n=>{Reflect.has(e,n)&&(t[n]=e[n].bind(t))}),t}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ItemChangeQuantityViewModel",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel","DS/ENOXEngineer/models/EngItemListModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r)=>{return class extends e{initViewOptions(e){e.addRemoveNodeAuthorized=this.isAddRemoveNodeAuthorized}get isAddRemoveNodeAuthorized(){const e=this.appCore.sessionManager.shouldShowMfgView(),t=this.appCore.sessionManager.shouldShowFinalItems()||this.appCore.sessionManager.shouldShowLeafMaterials(),n=this.appCore.sessionManager.shouldShowFlatView();return!e&&!t&&!n}getRollup(e){return e.length}getColumns(){let e=super.getColumns(),t=!0,i=!0;return e=(e=e.filter(e=>"ds6w:label"!==e.dataIndex)).filter(e=>"ds6wg:revision"!==e.dataIndex),this.referenceNode&&this.referenceNode.getUsages&&Array.isArray(this.referenceNode.getUsages())&&this.referenceNode.getUsages().forEach(function(e){t=!e.hasMassQuantity()&&t,i=!e.hasVolumeQuantity()&&i}),e=t?e.filter(e=>e.dataIndex!==n.CONT_QUANTITY_MASS):e,e=i?e.filter(e=>e.dataIndex!==n.CONT_QUANTITY_VOLUME):e,this.appCore.sessionManager.shouldShowLeafMaterials()&&e.push({pinned:"left",width:100,editableFlag:!1,icon:this.getInstanceIcon(),text:r.get("occurence"),getCellValue:function(e){return e.nodeModel.options.grid.occurenceTitle},dataIndex:"occurence"}),e}executeChangeQuantity({create:e,detach:o}){if(e.length>0||this.usagesAddedAsBulk>0){const o=this.referenceNode.getID(),s=Array.isArray(e)&&e.length>1?e.map(()=>o):[o],a=(this.runBackGroundInBackEnd,this.usagesAddedAsBulk),l=this.usages.filter(e=>e instanceof t).map(e=>e.getRelationID());this.appCore.dataService.createInstances({parentID:this.context.parentId,referencesIDs:s,existingInstancesIDs:l,quantitiesToAdd:a}).then(e=>{this.appCore.mediator.publish(n.EVENT_INSTANCES_CREATED,e)}).catch(e=>{e&&e.type&&e.type===n.ERROR_TYPE_TIMEOUT?i.errorAlert(r.get("timeout_alert_refresh")):i.errorAlert(e&&e.error&&e.error.message?e.error.message:JSON.stringify(e))})}o.length>0&&this.appCore.mediator.publish(n.EVENT_LAUNCH_COMMAND,{commandId:n.DETACH_ENG_ITEMS_CMD,context:{item:o}})}createNodeInfo(){return{Text:"New Instance","ds6w:label-Instance":r.get("eng.ui.dialog.changeQuantity.NewInst"),"ds6w:label":this.referenceNode.getLabel(),"ds6wg:revision":this.referenceNode.options.grid["ds6wg:revision"]}}}}),define("DS/ENOXEngineer/services/OpenWithService",["UWA/Core","UWA/Class","DS/i3DXCompassPlatformServices/OpenWith","UWA/Class/Promise","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this.option=e},initialize:function(e){this.app=e},getOpenWithMenu:function(t,i){var o=this;let s=[];var a=new n;if(e.is(a.retrieveCompatibleApps,"function"))return r.wrappedWithCancellablePromise(function(e,n){o.app.core.Factories.ListItemFactory.getContentForOpenWithMenu(t,i).then(function(t){a.set3DXContent(t),a.retrieveCompatibleApps(function(t){t.forEach(function(e){s.push(o.getSubmenuOptions(e,i))}),e(s)})})})},getSubmenuOptions:function(e,t){return{id:e.text,title:e.text,icon:e.fonticon?e.fonticon:e.icon,type:"PushItem",multisel:!1,action:{context:t,callback:e.handler}}}})}),define("DS/ENOXEngineer/services/CommandsService",["UWA/Class","UWA/Core","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/Menu/Menu","DS/ApplicationFrame/CommandsManager","DS/ENOXEngineer/services/OpenWithService","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/XENTracker","text!DS/ENOXEngineer/assets/config/Commands.json","text!DS/ENOXEngineer/assets/config/MenuInfos.json"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";return e.singleton({init:function(e){this._commandConfig=JSON.parse(d),this._menuInfos=JSON.parse(u),this._commandsLaunchedWithDelay=new Map},initialize:function(e,t){var n=this;n.app=e,n.app.core.commandManager=n,n._refreshedSubscription=i.subscribe("DS/PADUtils/PADCommandProxy/authored",function(t){e.core.sessionManager.setAuthoringMode("authoring")}),this._eventToken=e.mediator.subscribe(a.EVENT_LAUNCH_COMMAND,function(e){n._commandsListener(e)}),t||e.mandatoryStartupPromises.push(n.loadAllCommands()),e.optionalStartupPromises.push(n._getCommandSettings())},_getCommandSettings:function(){var e=this;return l.wrappedWithCancellablePromise(function(t,n){e.app.core.dataService.getCommandSettings().then(function(n){var i=JSON.parse(n);return e._isMaterialQuantityAuthorized=i.materialUsageAuthorization,e._isExportNoLimit=i.exportNoLimit,t(n)}).catch(function(t){return e._isMaterialQuantityAuthorized=!1,e._isExportNoLimit=!1,n(t)})})},_getObjectAdditionnalData:function(e){return Array.isArray(e)?{}:{revision:e.getReferenceVersion(),type:e.getType()}},showMenu:function(e,t){if(!e||!Array.isArray(t))throw new Error("unable to build the menu");r.show(t,{position:{x:e.left,y:e.bottom},submenu:"outside"})},renderMenu:function(e,t){e&&t&&this.showMenu(e,this.getMenu(t))},renderIdCardMenu:function(e){e&&this.getIDCardMenu().then(t=>{this.showMenu(e,t)})},getIDCardMenu:function(){return this.getMenu("root")},isMaterialQuantityAuthorized:function(){return!!this._isMaterialQuantityAuthorized&&this._isMaterialQuantityAuthorized},isExportWithNoLimit:function(){return!!this._isExportNoLimit&&this._isExportNoLimit},getMenu:function(e){const t=this.app.core.contextManager.getActiveEngItem(),n=t&&t.hasValidTransientGroupingContext()?e=>e._isFromOriginalModel()||e.isGroupFromExpand():null;var i=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(e,n),r=this.getSelectionInfos(i),o=this.getAllActionIds(r),s=this._getTemplateMenu(e);return this._allowSubMenu(s,e)?this._buildSubMenu(o,s,e):this.buildMenu(o,s,e)},getAllActionIds:function(e){var t=[];if(0===e.nbSelected)return t;var n=this.getCommandRepo();for(var i in n){var r=this.getCommandMetaData(i);let n=!0;var o=-1!==e.filteredCommands.indexOf(r.commandHdr),s=!0,l=e.types,c=r.authorizedTypes;void 0!==c?l.forEach(function(e){-1===c.indexOf(e)&&(s=!1)}):c=!0;var d=void 0!==r.edit&&!1===r.edit||e.editable,u=void 0===r.nbSelectedMax||r.nbSelectedMax>=e.nbSelected,p=void 0===r.nbSelectedRefMax||r.nbSelectedRefMax>=e.nbRefSelected,g=!(!u||!p),h=!0===r.multiType||1===e.types.length,m=!0;!0===r.availabilityOnCheckedOut?m=e.checkedOut:!1===r.availabilityOnCheckedOut&&(m=!e.checkedOut);var f=!0;this.app.core.PreferencesManager.isSpecInProductStructureEnabled()||r.commandHdr!=a.ADD_NEW_DOC_CMD&&r.commandHdr!=a.ADD_EXISTING_DOC_CMD||(f=!1),r.commandHdr==a.CREATE_NEW_ENG_ITEM&&this.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?n=!1:r.commandHdr!=a.CREATE_NEW_CONTENT||this.app.core.PreferencesManager.isUserSelectedTypeChooserOption()||(n=!1),s&&d&&g&&h&&!o&&m&&f&&n&&t.push(r)}return t},_allowSubMenu:function(e,t){let n=!1,i=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(t);return n=!this.app.core.contextManager.isMultiselMenu()&&1===i.length&&Array.isArray(e)&&e.find(function(e){return"menu"===e.type}),this.app.core.contextManager.setMultiselMenu(!1),n},_buildSubMenu:function(e,t,n){var i=this;return s.getOpenWithMenu(n).then(function(r){return i.buildMenu(e,t,n,r)}).catch(function(e){console.warn(e)})},buildMenu:function(e,t,n,i){var r=this,o=[];return t.forEach(function(t){if("group"===t.type){var s=t.commands,a=r.buildMenu(e,s,n);a.length>0&&o.push(r._buildMenuGroup(r.getGroupMetaData(t.ID),"PushItem",a))}else"title"===t.type?o.push({type:"TitleItem",title:r.app.core.i18nManager.get(t.ID),state:"enabled"}):"separator"===t.type?o.push({type:"SeparatorItem"}):"command"===t.type?e.forEach(function(e){e.commandHdr!==t.ID||o.push(r._buildMenuEnty(e,"PushItem",[],n))}):"menu"===t.type&&i&&Array.isArray(i)&&i.length>0&&o.push({type:"PushItem",icon:"fonticon fonticon-open-menu-dot",submenu:i,title:r.app.core.i18nManager.get("open_with")})}),this._cleanMenu(o)},_cleanMenu:function(e){var t=[];if(e&&Array.isArray(e)&&e.length>0)for(var n=0;n<e.length;n++){var i=e[n];if("SeparatorItem"===i.type){if(0===n)continue;if(n===e.length-1)continue;if("SeparatorItem"===e[n+1].type)continue}if("TitleItem"===i.type){if(n===e.length-1)continue;if("TitleItem"===e[n+1].type)continue}t.push(i)}return t},_buildMenuEnty:function(e,t,n,i){var r=this;return{title:r.app.core.i18nManager.get(e.nls_key),type:t,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon},action:{this:this,callback:function(t){r.commandHandler(e,n,i)}}}},_buildMenuGroup:function(e,t,n){return{title:this.app.core.i18nManager.get(e.nls_key),type:t,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon},submenu:n}},getGenericMenuEnty:function(e){if(!(e.callback instanceof Function&&e.nls_key))throw new Error("invalid menu input");var t={title:this.app.core.i18nManager.get(e.nls_key),type:e.type?e.type:"PushItem",state:e.state?e.state:"unselected",action:{this:this,callback:function(){e.callback.apply(null,e.args)}}};return e.fonticon&&(t.fonticon={family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+e.fonticon}),e.icon&&(t.icon=this.app.core.settingManager.getIconUrl(e.icon),delete t.fonticon),t},getSelectionInfos:function(e){var t,n=e.length,i=[];this.app.core.contextManager.getActiveEngItem()&&!this.app.core.settingManager.isConfigAuthorized()&&i.push("EditConfigContext"),this.app.core.settingManager.isConfigAuthorized()||(i.push("CopyVariantEffectivity"),i.push("PasteVariantEffectivity"),i.push("EditVariant"),i.push("CopyEvolutionEffectivity"),i.push("PasteEvolutionEffectivity"),i.push("EditEvolution"),i.push("ExtendEvolutionEffectivity")),this.app.core.settingManager.isProductConfEnabled()||(i.push("addProductConfiguration"),i.push("UPSAuthReplaceByProductConfiguration")),this.isMaterialQuantityAuthorized()&&!this.app.core.dicoService.isHideNewQuantityOfMaterialCommand()||i.push("addNewMaterialQuantity"),e[0]&&e[0].options&&e[0].options.grid&&e[0].options.grid[a.CONST_DS6W_DEFORMABLE]||i.push("XENG_OPEN_DEFORMABLE_ENG_ITEM"),"recents_items"===this.app.router.getState().name||i.push("RemoveRecentCmd"),this.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?i.push(a.CREATE_NEW_ENG_ITEM):i.push(a.CREATE_NEW_CONTENT),this.app.core.PreferencesManager.isSpecificationsTabEnabled()&&(i.push(a.ADD_NEW_DOC_CMD),i.push(a.ADD_EXISTING_DOC_CMD));var r=e.filter(function(e){return!!e._isFromOriginalModel()});r.length>0&&(this.app.core.sessionManager.shouldShowFinalItems()||this.app.core.sessionManager.shouldShowMfgView()||this.app.core.sessionManager.shouldShowLeafMaterials()?(i.push("ChangeTheQuantity"),i.push("ChangeMassQuantity"),i.push("ChangeVolumeQuantity")):r[0].isMaterialQuantity()?(i.push("ChangeVolumeQuantity"),i.push("ChangeMassQuantity"),r[0].getMassQuantity()?i.push("ChangeVolumeQuantity"):r[0].getVolumeQuantity()&&i.push("ChangeMassQuantity")):(i.push("ChangeMassQuantity"),i.push("ChangeVolumeQuantity"))),e.filter(e=>Reflect.has(e,"isGroupFromExpand")&&e.isGroupFromExpand()).length&&(i.push("RelatedObjectsHdr"),r.length||i.push("edit-properties")),(this.app.core.sessionManager.shouldShowFinalItems()||this.app.core.sessionManager.shouldShowQuantityView()||this.app.core.sessionManager.shouldShowMfgView()||this.app.core.sessionManager.shouldShowLeafMaterials()||this.app.core.sessionManager.shouldShowFlatView())&&i.push("UPSAuthRevisionUpdate");var o=[],s=[],l=!1,c=[];return e.forEach(function(e){var t="function"==typeof e.getGlobalType?e.getGlobalType():e.getType();-1===o.indexOf(t)&&o.push(t),-1===s.indexOf(e.getID())&&s.push(e.getID()),l=e.options.checkedOut,c=e.options.files}),t=s.length,{types:o,editable:!0,nbSelected:n,nbRefSelected:t,filteredCommands:i,checkedOut:l,files:c}},getCommandMetaData:function(e){return this._commandConfig[e]},getCommandRepo:function(){return this._commandConfig},getGroupMetaData:function(e){return this._menuInfos.groupsInfos[e]||null},_getTemplateMenu:function(e){return this._menuInfos.templates[e]||[]},_commandsListener:function(e){var t=this;t.executeCommand(e.commandId,function(){t.prepareCmdInput(t._commandConfig[e.commandId],e.context)})},_getReferenceNodeLength:function(e){if(e&&e.length<=0)return 0;e[0].getID();var t=[];return e.forEach(function(e){var n=e.getID();-1===t.indexOf(n)&&t.push(n)}),t.length},commandHandler:function(e,n,i){if(t.is(e)){var r=this;this.executeCommand(e.commandHdr,function(){var t=this.app.core.contextManager.getXENTreeDocument().getSelectedNodes(i);switch(e.commandHdr){case"XENG_OPEN_ENG_ITEM":1===this._getReferenceNodeLength(t)&&this.app.core.sessionManager.setNextOpenContext({objectId:t[0].getID(),objectType:t[0].getType(),itemListModel:t[0]});break;case"XENG_OPEN_DEFORMABLE_ENG_ITEM":1===this._getReferenceNodeLength(t)&&this.app.core.sessionManager.setNextOpenContext({objectId:t[0]&&t[0].options&&t[0].options.grid&&t[0].options.grid[a.CONST_DS6W_DEFORMABLE]?t[0].options.grid[a.CONST_DS6W_DEFORMABLE]:void 0,objectType:t[0].getType()});break;case"UPSReplaceByLatestRevision":case"UPSAuthReplaceByExisting":case"UPSAuthReplaceByRevision":if(this.app.core.sessionManager.shouldShowQuantityView()){let e=[];for(let i=0;i<t.length;i++){var n=t[i];if(n&&n.getUsages&&Array.isArray(n.getUsages())){let t=n.getUsages();t.forEach(function(e){e._setParent(n.getParent())}),e=e.concat(t)}else e.push(t[i])}this.app.core.contextManager.addSelection(e,!0)}else{let e=[],n=this.app.core.Factories&&this.app.core.Factories.ListItemFactory&&this.app.core.Factories.ListItemFactory.getGroupInstanceClass&&this.app.core.Factories.ListItemFactory.getGroupInstanceClass();Array.isArray(t)&&t.forEach(function(t){n&&t&&t.getParent&&t.getParent()instanceof n&&t._setParent(t.getRealParent()),e.push(t)}),this.app.core.contextManager.addSelection(e,!0)}break;case"ActionBar_NewProductCmd":case"addExisting":case"ActionBar_NewPartCmd":case"addNewMaterialQuantity":case"addProductConfiguration":case"ActionBar_NewDrawingCmd":case"XENG_ADD_EXISTING_DRAWING":case"addNewMaterialQuantity":case"XENG_ADD_NEW_DOC":case"XENG_ADD_EXISTING_DOC":t.forEach(e=>{e.expand()}),this.app.core.contextManager.addSelection(t,!0);break;case"ExpandCmd":case"ExpandAllLevelCmd":case"ExpandNLevelCmd":r.app.core.contextManager.getActiveEngItem&&r.app.core.contextManager.getActiveEngItem()&&(r.app.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||r.app.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()||r.app.core.sessionManager.shouldShowMfgView())||r._emptyChildren(t),this.app.core.contextManager.addSelection(t,!0);break;default:this.app.core.contextManager.addSelection(t,!0)}}.bind(this))}return null},executeCommand:function(e,t){var n=this;if(!e)throw new Error("commandId is a mandatory parameter");if(!n._commandConfig[e])throw new Error("inexistant command");var i=n._commandConfig[e];n.commandLoaderStatus.then(function(){c.trackCommandLaunched(i.commandHdr),t&&t();var e=o.getCommand(i.commandHdr,widget);switch(n.app.core.contextManager.setCurrentRunningCmd(i.commandHdr),i.commandHdr){case"edit-properties":i.context&&i.context.facetName&&(e._arguments=[i.context.facetName])}if(Reflect.has(i,"launchDelay")){if(n._commandsLaunchedWithDelay.has(i.commandHdr))return void console.warn(`CommandsService -> command ${i.commandHdr} has already been launched`);const e=Number.isInteger(i.launchDelay)?i.launchDelay:1e3;console.log(`CommandsService -> adding command  ${i.commandHdr} to delay stack`),n._commandsLaunchedWithDelay.set(i.commandHdr,setTimeout(()=>{n._commandsLaunchedWithDelay.delete(i.commandHdr),console.log(`CommandsService -> removing command  ${i.commandHdr} from delay stack`)},e))}n.launchCommand(e),n.app.mediator.subscribe(a.EVENT_CLOSE_RUNNING_CMD,function(){let e=n.app.core.contextManager.getCurrentRunningCmd(),t=n._commandConfig[e];o.getCommand(t.commandHdr,widget).cancel()})})},launchCommand:function(e){["EditVariant","EditEvolution"].indexOf(e.getId())>=0?e.begin(!1):e.begin()},loadAllCommands:function(){var e=this,t=[];for(var i in this._commandConfig)if(this._commandConfig.hasOwnProperty(i)){var r=e._commandConfig[i],o=new n(function(t,n){e.loadCommand(r,t,n)});t.push(o)}return e.commandLoaderStatus=n.allSettled(t),e.commandLoaderStatus},loadCommand:function(e,t,n){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void n("Oups ! no valid command description");var i=this;return require([e.AmdLoader],function(r){var o={context:i.app.core.contextManager.getContext(),ID:e.commandHdr};e.isInternalCmd&&(o.appCore=i.app.core),void 0!==e.activeTopBar&&(o.activeTopBar=e.activeTopBar);try{new r(o)}catch(e){n(e)}t()},function(e){n(e)})},prepareCmdInput:function(e,t){switch(e.context=t,e.commandHdr){case"ActionBar_NewProductCmd":if(t&&t.isInsert){if(!this.app.core.contextManager.getActiveEngItem())return void console.error("you should select a parent")}else this.app.core.contextManager.resetSelection();break;case"XENG_UPDATE_WIDGET_TITLE":break;case"XENG_OPEN_ENG_ITEM":this.app.core.sessionManager.setNextOpenContext(t.item);break;case"Import":case"ActionBar_NewPartCmd":case"XENG_ADD_EXISTING_DRAWING":case"ActionBar_NewDrawingCmd":case"NewContent":break;case"addNewMaterialQuantity":this.app.core.sessionManager.setMaterialForInsertContext(t.item);break;case"ExpandCmd":case"ExpandAllLevelCmd":case"ExpandNLevelCmd":this.app.core.contextManager.getActiveEngItem&&this.app.core.contextManager.getActiveEngItem()&&(this.app.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||this.app.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()||this.app.core.sessionManager.shouldShowMfgView())||this._emptyChildren(t.item),this.app.core.contextManager.addSelection(t.item,!0);break;default:if(t.item){var n=t.item;Array.isArray(n)||(n=[t.item]);for(var i=0;i<n.length;i++)n[i].object=this._getObjectAdditionnalData(n[i]);this.app.core.contextManager.addSelection(n,!0)}}},_emptyChildren:function(e){e.forEach(e=>{e.options.childComputed=!e.options.childComputed&&e.options.childComputed,e.options.children=e.options.children?[]:e.options.children})}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialViewModel",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewModel","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o)=>{return class extends n{initViewOptions(e){e.addRemoveNodeAuthorized=!1}set nodes(e){super.nodes=e}get nodes(){return super.nodes}updateMadeFromColumn(){let n=[],i=this,r=new Map;this.nodes.forEach((e,t)=>{let i=e.getID();n.push(i),r.has(i)?r.set(i,[...r.get(i),e]):r.set(i,[e])});var o={relids:[],pids:n};this.appCore.dataService.retrieveMadeFromInfos&&this.appCore.dataService.retrieveMadeFromInfos(o,function(n){var o=e.is(n,"string")?JSON.parse(n):n;Object.getOwnPropertyNames(o.pids).map(function(e){r.get(e).forEach((n,i)=>{t.updateNodeOptions(n,{grid:o.pids[e]})})}),i.notifyUpdate({modify:i.nodes})})}getColumns(){let e=[];return e.push(...super.getColumns()),e.push({pinned:"left",width:100,editableFlag:!1,text:o.get("occurence"),getCellValue:function(e){return e.nodeModel.options.grid.occurenceTitle},dataIndex:"occurence"}),e.push({pinned:"left",width:100,editableFlag:!1,typeRepresentation:"string",text:o.get("MadeFrom"),getCellValue:function(e){var t=e.nodeModel.options.grid.MadeFrom;return!(t=t?t.replace("\n",""):t)||e.nodeModel.isAttributePending("MadeFrom")?t=o.get("loading"):"function"==typeof t.trim&&0===t.trim().length&&(t=o.get("None")),t},dataIndex:"MadeFrom"}),this.updateMadeFromColumn(),e}getRollup(e){return e.length}}}),define("DS/ENOXEngineer/models/ConfigContextModel",["DS/Tree/TreeNodeModel","UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/utils/XEngineerConstants"],function(e,t,n,i,r,o,s){"use strict";function a(n){this._parentNode={_nodeDepth:1},this.pathElement={externalPath:[]},this.options={type:"",physicalid:"",thumbnail:"","ds6w:created":"","ds6w:modified":"","ds6w:description":"","ds6w:responsible":"","ds6wg:revision":"","ds6w:status":"","ds6w:label":"",modelVersion:null,preferedVersion:null,relatedEngItem:null,preferredConfiguration:null,versionPCs:null},this.options=t.extend(this.options,n),e.call(this,this.options)}return a.prototype=Object.create(e.prototype),a.prototype.destroy=function(){},a.prototype.setModelVersion=function(e){this.options.modelVersion=e},a.prototype.setAllModelVersions=function(e){this.options.allModelVersions=e},a.prototype.getAllModelVersions=function(){return this.options.allModelVersions},a.prototype.setRelatedEngItem=function(e){this.options.relatedEngItem=e},a.prototype.getRelatedEngItem=function(){return this.options.relatedEngItem},a.prototype.catchUserPreferences=function(){return{modelId:this.getID(),modelVersionId:this.getPreferredVersion()?this.getPreferredVersion().id:"N/A",prodConfId:this.getPreferredConfiguration()?this.getPreferredConfiguration().id:"N/A"}},a.prototype.getModelVersion=function(){return this.options.modelVersion},a.prototype.getCurrentVersionName=function(){return this.getPreferredVersion()?this.getPreferredVersion().name:null},a.prototype.getCurrentVersionMarketingName=function(){return this.getPreferredVersion()?this.getPreferredVersion().marketingName:null},a.prototype.getMarketingName=function(){return this.getModelVersion()?this.getModelVersion().attributes.MarketingName:null},a.prototype.getCurrentVersionID=function(){return this.getPreferredVersion()?this.getPreferredVersion().id:null},a.prototype.getCurrentVersionRevision=function(){return this.getPreferredVersion()?this.getPreferredVersion().revision:null},a.prototype.getCurrentVersionDisplayName=function(){return this.getCurrentVersionName()+" "+this.getCurrentVersionRevision()},a.prototype.getCurrentVersionDisplayMarketingName=function(){return this.getCurrentVersionMarketingName()+" "+this.getCurrentVersionRevision()},a.prototype.setVersionProdConfs=function(e){this.options.versionPCs=e},a.prototype.getVersionProdConfs=function(){return this.options.versionPCs},a.prototype.getProdConfById=function(e){var t=this.getVersionProdConfs()?this.getVersionProdConfs():[];console.warn(t);for(var n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null},a.prototype.getPreferredConfiguration=function(){return this.options.preferredConfiguration},a.prototype.setPreferredConfiguration=function(e){var t=this;return n.wrappedWithPromise(function(n,i){t.loadProdConfInfos().then(function(){t.options.preferredConfiguration=e?t.getProdConfById(e):null,n()}).catch(function(e){console.error(e),i(e)})})},a.prototype.getPreferredVersion=function(){return this.options.preferedVersion},a.prototype.setPreferredVersion=function(e){var t=i.getVersionByIdFromVersionGraph(this.getModelVersion(),e)||this.getModelVersion();t&&Object.keys(t).length>0?(this.options.preferedVersion={id:r._getPidWithoutPrefix(t.id),revision:t.revision,name:t.name,marketingName:t.attributes.MarketingName,state:t.current},this.options.preferredConfiguration=null,this.loadProdConfInfos(!0)):o.errorAlert(this.options.appCore.i18nManager.get("error.selectedVersion.notFound"))},a.prototype.getListOfVersionsPromise=function(){var e=this;return n.wrappedWithPromise(function(t,n){e.loadVersions().then(function(n){t(n?e.options.appCore.Factories.configItemsFactory.createModelVersionsFromRootVersion(n,e.getID()):[])}).catch(function(e){t([]),console.error(e)})})},a.prototype.loadVersions=function(e){var t=e||this;return n.wrappedWithPromise(function(e,n){t.options.appCore.dataService.getModelVersionsFromModel(t.getID()).then(function(n){n.id&&n.revision?(t.setModelVersion(n),e(n)):(t.setModelVersion(null),e(null))}).catch(function(e){t.setModelVersion(null),n(e),console.error(e)})})},a.prototype.VersionsLoaderWrapper=function(){var e=this;return n.wrappedWithPromise(function(t,n){if(e.getModelVersion())return t(e.getModelVersion());e.loadVersions().then(t).catch(n)})},a.prototype._synchronizeModelVersions=function(e){var t=this.getID(),i=this;return t?n.wrappedWithPromise(function(t,n){i.VersionsLoaderWrapper().then(function(){var n=i.getModelVersion();if(n){var r=i.options.appCore.PreferencesManager.getEngItemOpenPreferences(i.getRelatedEngItem().getID()),s=r&&r.modelVersion?r.modelVersion:null,a=r&&r.prodConf?r.prodConf:null,l=e&&e.id?e.id:s;l||(l=n.id),i.setPreferredVersion(l),i.loadProdConfInfos().finally(function(){i.setPreferredConfiguration(a),t(n)})}else o.errorAlert(i.options.appCore.i18nManager.get("error.noVersion.relatedToModel"))}).catch(function(e){console.error(e),n()})}):null},a.prototype.loadProdConfInfos=function(e){var t=this;return t.options.prodConfPromise&&!e?t.options.prodConfPromise:(t.options.prodConfPromise=n.wrappedWithPromise(function(e,n){t.options.appCore.dataService.loadModelVersionProdConf(t.getID(),t.getCurrentVersionID()).then(function(n){t.setVersionProdConfs(r.retrieveProdConfsInfo(n)),e(!0)}).catch(function(e){console.warn(e),n(e)})}),t.options.prodConfPromise)},a.prototype.getType=function(){return this.options.type},a.prototype.getID=function(){return this.options.physicalid},a.prototype.getLabel=function(){return this.options["ds6w:label"]},a.prototype.getDisplayName=function(){return this.options["Marketing Name"]},a.prototype.getVersion=function(){return this.options["ds6wg:revision"]},a.prototype.getThumbnail=function(){return this.options.thumbnail},a.prototype.getOwner=function(){return this.options["ds6w:responsible"]},a.prototype.getCreatedDate=function(){return this.options["ds6w:created"]},a.prototype.getModifedDate=function(){return this.options["ds6w:modified"]},a.prototype.getMaturity=function(){return this.options["ds6w:status"]},a.prototype.getDescription=function(){return this.options["ds6w:description"]},a.prototype.getIcon=function(){return this.options.icons&&this.options.icons[0]},a.prototype.getTenant=function(){return this.options.tenant},a.prototype.buildFilterXML=function(){var e=this.options.appCore.settingManager.getCommand("createVolatileFilter"),t=e.contentFormat,n=s.CONF_150_MODE,i=e.ModelVersionFormat;return i=(i=(i=i.replace("{modelName}",UWA.String.escapeHTML(this.getLabel()))).replace("{modelVersionName}",UWA.String.escapeHTML(this.getCurrentVersionName()))).replace("{modelVersionRevision}",UWA.String.escapeHTML(this.getCurrentVersionRevision())),t=(t=(t=t.replace("{filter}",i)).replace("{mode}",n)).replace("{SelectionView}",UWA.String.escapeHTML(this.options.appCore.dataService.getUserEvolutionViewPref()))},a}),define("DS/ENOXEngineer/services/ConfigItemsFactory",["UWA/Core","UWA/Class","UWA/Class/Promise","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/ResponseParser","DS/ENOXEngineer/models/ConfigContextModel","DS/Tree/TreeNodeModel","DS/ENOXEngineer/utils/XEngineerConstants","WebappsUtils/WebappsUtils"],function(e,t,n,i,r,o,s,a,l){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e,this.app.core.Factories||(this.app.core.Factories={}),this.app.core.Factories.configItemsFactory=this,this.i18nManager=this.app.core.i18nManager},createModelVersionsFromRootVersion:function(e,t){if(!e)return[];var n=[],i=this;return r.getListOfVersionsFromRoot(e,n),n.map(function(e){return e.modelId=t,e.thumbnail||(e.thumbnail=i.app.core.settingManager.getDefault3DSpaceUrl()+"/snresources/images/icons/large/I_Product_Thumbnail.png"),new s(e)})},getModelsFromConfigInfo:function(e){var t=r.configInfoParser(e);return this.createConfigModelNodes(t)},getModelVersionsFromModelInfo:function(e){return r.modelVersionsParser(e)},createConfigModelNode:function(t,n){var i=t;return e.is(n,"function")&&(i=n(t)),i.appCore=this.app.core,i.thumbnail=this.app.core.settingManager.getDefault3DSpaceUrl()+"/snresources/images/icons/large/I_Product_Thumbnail.png",new o(i)},createConfigModelNodes:function(t,n){var i=[],r=this;return t.forEach(function(t){var o=r.createConfigModelNode(t,n);e.is(o)&&i.push(o)}),i}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewModelFactory",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ItemChangeQuantityViewModel","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/MaterialChangeQuantityViewModel","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/RawMaterialViewModel"],(e,t,n)=>{return class{static create(t){const{referenceNode:i}=t;if(!i)throw new Error("wrong input");const r=new(i.isRawMaterialType&&i.isRawMaterialType()?n:e)(t),{usages:o}=t;return r.nodes=o,r}}}),define("DS/ENOXEngineer/componentsHelpers/mixins/XEngDnDManager",["DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/XEngContextManager","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o){"use strict";function s(e){this.container=e.container;if(!e.sandbox||e.droppable&&(!e.onDrop||!e.dropStrategy)||e.draggable&&!e.getSerializedContent)throw new Error("invalid parameter for XEngDnDManager constructor");this.sandbox=e.sandbox,e.droppable&&(this.onDrop=e.onDrop,this.dropStrategy=e.dropStrategy,this.invite=this.sandbox.core.moduleHelper.viewsService.getDnDInvite(),this.invite&&this.invite.hide(),this._makeDroppable()),e.draggable&&(this.getSerializedContent=e.getSerializedContent,this._makeDraggable())}return s.prototype.dropValidator=function(t){var i=this;if("OPEN"===this.dropStrategy||this.sandbox.sessionManager.getFlatViewOption()===r.DIRECT_CMD)if("OPEN"!==this.dropStrategy&&this.sandbox.sessionManager.shouldShowMfgView())n.errorNotif({title:this.sandbox.i18nManager.get("failure.insert.drop"),subtitle:this.sandbox.i18nManager.get("error.insert.drop.view"),message:this.sandbox.i18nManager.get("drop.insert.view.noManuf")});else{try{e.get3DXContentFromDrop(t),i.sandbox.core.PreferencesManager.isSpecInProductStructureEnabled()||i.ignoreDroppedSpecifications(t)}catch(e){return void n.errorAlert(i.sandbox.i18nManager.get("error.parse.droppeddata.failed"))}i.validateByStrategy(t).then(function(e){i.onDrop(e)}).catch(function(e){if(console.log(e),e&&e.globalIssue){let t=i.sandbox.i18nManager.get("app.failure"),r="OPEN"!==i.dropStrategy?i.sandbox.i18nManager.get("failure.insert.drop"):i.sandbox.i18nManager.get("failure.open.drop");e.msg&&(t=e.msg),n.errorNotif({title:r,subtitle:t})}})}else n.errorNotif({title:this.sandbox.i18nManager.get("failure.insert.drop"),subtitle:this.sandbox.i18nManager.get("error.insert.drop.view"),message:this.sandbox.i18nManager.get("drop.insert.view.direct")})},s.prototype.validateByStrategy=function(e){var n=this;return t.wrappedWithPromise(function(t,i){var r=null;switch(n.dropStrategy){case"OPEN":r=n.sandbox.core.settingManager.retrieveValidItemsForOpenFromDrop(e);break;case"BOM":r=n.sandbox.core.settingManager.retrieveAllValidContentForXENFromDrop(e);break;case"DOC":r=n.sandbox.core.settingManager.retrieveAllValidDocumentsFromDrop(e)}if(!r)return i({globalIssue:!0,msg:n.sandbox.i18nManager.get("error.drop.failed")});r.then(function(e){t(e)}).catch(function(e){i(e)})})},s.prototype.getOnDropLabel=function(){switch(this.dropStrategy){case"OPEN":return"drop";default:return"insert"}},s.prototype.destroy=function(){e.cleanDroppable(this.container),this.container=null,this.sandbox=null,this.invite=null},s.prototype._makeDraggable=function(){e.makeDraggable(this.container,{data:this.getSerializedContent(),start:function(e,t){i.dragStartedInXENG=!0,console.log("##drag start")},stop:function(e){i.dragStartedInXENG=!1,console.log("###drag end")}})},s.prototype._makeDroppable=function(){var t=this;e.makeDroppable({element:t.container,context:this,onDragEnter:function(){!0!==i.dragStartedInXENG?(t.invite.addBorder(),t.invite.show(t.getOnDropLabel()),t.container.hasClassName("dragging")||t.container.addClassName("dragging")):t.container.removeClassName("dragging")},onDragLeave:function(){t.invite.hide(),t.container.hasClassName("dragging")&&t.container.removeClassName("dragging")},onDragOver:function(){!0!==i.dragStartedInXENG&&(t.invite.show(t.getOnDropLabel()),t.container.hasClassName("dragging")||t.container.addClassName("dragging"))},onDrop:function(e,r){if(!0!==i.dragStartedInXENG){t.invite.hide(),t.container.removeClassName("dragging");try{t.dropValidator(JSON.parse(e))}catch(e){return void n.errorAlert(o.get("error.parse.droppeddata.failed"))}}}})},s.prototype.ignoreDroppedSpecifications=function(e){var t=!1;e.data.items=e.data.items.filter(e=>{if("Document"!=e.objectType)return e;t=!0}),t&&n.errorAlert(this.sandbox.i18nManager.get("error.dragdrop.specifications.failed"))},s}),define("DS/ENOXEngineer/services/ViewsService",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/UIKIT/Input/Button","DS/Windows/ImmersiveFrame","DS/ENOXEngineer/componentsHelpers/InviteDnD/DnDInvite","DS/ENOXEngineer/componentsHelpers/mixins/XEngDnDManager","DS/ENOXEngineer/utils/XEngineerConstants","require"],function(e,t,n,i,r,o,s,a,l){"use strict";var c=null;function d(e){e.registerDnDManager=function(e){if(e){var t=(65536*(1+Math.random())|0).toString(16).substring(1);return Array.isArray(this._DnDManagers)||(this._DnDManagers=[]),this._DnDManagers.push({token:t,manager:new s(e)}),t}}}return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.logger=e.core.logger.get("emptyview manager"),this.app=e,e.core.moduleHelper.viewsService=this,this.immersiveFrame=null,e.optionalStartupPromises.push(this._temporaryLoadEmptyView()),d(e.sandboxBase)},_temporaryLoadEmptyView:function(){return n.wrappedWithPromise(function(e,t){l(["DS/ENOXEmptyContent/js/ENOXEmptyContent"],function(t){c=t,e(!0)},function(e){t(e)})})},getApplicationImmersiveFrame:function(){return this.immersiveFrame||(this.immersiveFrame=new r({identifier:"XENImmersiveFrame"})),this.immersiveFrame},getGridOptions:function(e){var t=null,n=this,r="eng.ui.start.byCreate.content",o="DropInvit_drop";switch(e){case a.CONST_EMPTY_DGV_TILE_VIEW:r="add_new_engineering_item",o="DropInvit_insert";default:var s=new i({value:this.app.core.i18nManager.get(r),className:"primary"});t={sentences:[{type:"drop",text:this.app.core.i18nManager.get(o)},{type:"dom",DOMelement:s.getContent(),events:{onclick:function(){let e=n.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?a.CREATE_NEW_CONTENT:a.CREATE_NEW_ENG_ITEM;n.app.core.mediator.publish(a.EVENT_LAUNCH_COMMAND,{commandId:e})}}}],fontSize:"16px",orderedListType:"none",modelEvents:this.app.core.mediator.getApplicationBroker()}}return t},getGridEmptyView:function(e){return this._instanciateEmptyViewer(this.getGridOptions(e))},_instanciateEmptyViewer:function(e){return new c(e)},getDnDInvite:function(){return this.invite||(this.invite=new o({renderTo:widget.body})),this.invite}})}),define("DS/ENOXEngineer/componentsHelpers/FilterView/ENOXFilterView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/utils/XEngineerConstants","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r,o){"use strict";return t.extend({isLicenseValid:!1,toggle:[],init:function(e){this._parent(e);this.isLicenseValid=!0,this.render()},setup:function(e){},render:function(){if(1==this.isLicenseValid){var e=UWA.createElement("div",{});UWA.createElement("div",{html:"<H5>"+o.Evolution+":</H5>",styles:{position:"relative",width:"auto",display:"inline-block"}}).inject(e);var t=UWA.createElement("div",{styles:{position:"relative",width:"auto",display:"inline-block","margin-left":"20px"}});t.setStyles({width:"auto",display:"inline-block"});var i=UWA.createElement("div",{styles:{position:"relative",width:"auto",display:"inline-block","margin-left":"10px"}});i.setStyles({width:"auto"}),this.toggle[0]=new n({checked:!0,name:"ViewOptions_xeng",id:"ofcView_xeng",value:o.Filter_official_view,className:"primary"}).inject(t),this.toggle[1]=new n({name:"ViewOptions_xeng",id:"prjView_xeng",value:o.Filter_projected_view,className:"primary"}).inject(i),t.inject(e),i.inject(e),e.inject(this.options.parentElement),null!=this.options.viewJson&&this.setSelectedView(this.options.viewJson.view)}},getJSON:function(){return{view:this.getSelectedView()}},getSelectedView:function(){return this.isLicenseValid?this.toggle[0].isChecked()?r.CONF_OFFICIAL_VIEW:this.toggle[1].isChecked()?r.CONF_PROJECTED_VIEW:void 0:r.CONF_OFFICIAL_VIEW},setSelectedView:function(e){e==r.CONF_OFFICIAL_VIEW?this.toggle[0].check():e==r.CONF_PROJECTED_VIEW&&this.toggle[1].check()}})}),define("DS/ENOXEngineer/commands/LaunchVersionGraphCmd",["UWA/Core","DS/UIKIT/Modal","DS/ENOXEngineerCommonUtils/XENModal","DS/ENOXEngineer/commands/XEngineerCommandBase","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXEngineer/componentsHelpers/FilterView/ENOXFilterView","DS/ENOXVersionExplorerController/VersionExplorerController","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return i.extend({init:function(t){t=e.extend(t,{isAsynchronous:!1}),this._parent(t)},_buildModal:function(){var e=this,t=e.appCore.dataService.getUserEvolutionViewPref(),i=e.appCore.contextManager.getSelectedNodes()[0];this.modal=new n({title:this.options.appCore.i18nManager.get("manage_versions"),className:"xeng-versionG-container",withFooter:!1,onClose:function(){e.end();var n=e.filterView.getSelectedView();n!==t&&e.appCore.dataService.setUserEvolutionViewPref(n),!e.isCloseForOpen&&n!==t&&i&&e.appCore.mediator.publish(o.EVENT_CONF_MODEL_UPDATED,i.getID()),(i.getPreferedAttachedConfigModel()||null)&&e.appCore.mediator.publish(o.EVENT_VERSION_EXPLORER_CLOSED),e.modal.dispose(),e.modal=null,e.filterView=null,delete e.versionExplorer}})},_configModelVersionMapper:function(e){return{label:e.displayName,id:e.id,value:e.id,revision:e.revision,attributes:{MarketingName:e.displayName}}},execute:function(){var t=this;t.isCloseForOpen=!1,this._buildModal(),this.modal.show();var n=e.createElement("div",{html:'<div class="filter-view"></div><div class="version-graph"></div>',styles:{height:"100%",position:"relative",overflow:"auto"}}).inject(t.modal.getBody()),i=n.getElement(".version-graph"),r={parentElement:n.getElement(".filter-view"),viewJson:{view:t.appCore.dataService.getUserEvolutionViewPref()}};t.filterView=new a(r),t.versionExplorer=new l({versionGraphContainer:i,widget:widget});var s=t.appCore.contextManager.getSelectedNodes()[0];t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerCreateNewRevision",function(e){return!s.isConfigured()&&!s.isCoreMaterialType()}),t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerDeleteVersion",function(e){return!s.isConfigured()&&!s.isCoreMaterialType()}),t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerShowMaturity",function(e){return!s.isConfigured()&&!s.isCoreMaterialType()}),t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerNewRevisionFrom",function(e){return!s.isConfigured()&&!s.isCoreMaterialType()}),t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerCreateNewBranch",function(e){return!s.isConfigured()&&!s.isCoreMaterialType()}),t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerDuplicate",function(e){return!s.isConfigured()&&!s.isCoreMaterialType()}),t.versionExplorer.setCheckVersionExternalFunction("ENOXVersionExplorerOpenVersion",function(e){return s.isEngineeringItem()&&!s.isCoreMaterialType()}),t.versionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:s.getIdForVersionGraph(),tenantId:t.appCore.settingManager.getPlatformId(),type:s.getTypeForVersionGraph(),securityContext:t.appCore.settingManager.getSecurityContext()}),t.versionExplorer.subscribeEvent("ENOXVersionExplorerOpenVersion",function(e){t.isCloseForOpen=!0,t.modal.destroy();var n=t.appCore.dataService.getUserEvolutionViewPref(),i=t.filterView.getSelectedView();i!==n&&t.appCore.dataService.setUserEvolutionViewPref(i);var r=(e.data||e).options.id;if(s.isConfigured()){var a=s.getPreferedAttachedConfigModel()||null;a&&(s.options.staticMapping=void 0,t.appCore.sessionManager.cleanStaticMappingContext(),a.setPreferredVersion(r),t.appCore.mediator.publish(o.EVENT_CONF_MODEL_UPDATED,s.getID()))}else{(t.appCore.contextManager.getActiveEngItem()?t.appCore.contextManager.getActiveEngItem().getID():null)===r?t.appCore.mediator.publish(o.EVENT_REFRESH_APP_CONTENT):r&&t.appCore.mediator.publish(o.EVENT_LAUNCH_COMMAND,{commandId:o.OPEN_ENG_ITEM,context:{item:{objectId:r,objectType:s.getType()}}}),t.appCore.mediator.publish(o.EVENT_SHOW_PROPERTIES,{nodes:[{id:r,metatype:"businessobject"}]})}}),t.versionExplorer.subscribeEvent("ENOXVersionExplorerNewVersionCreated",function(e){t.appCore.sessionManager.setAuthoringMode("authoring"),t.appCore.mediator.publish(o.EVENT_NEW_VERSION_COMPLETED,e)})}})}),define("DS/ENOXEngineer/controllers/XEngineerBootstrap",["DS/ENOXEngineer/controllers/LandingPageController","DS/ENOXEngineer/controllers/ItemViewController","DS/ENOXEngineer/controllers/RecentsEngItemsController","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider","DS/AuthGenericCommands/AuthGenericCmdWSAccess"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e){this.app=e;var t=widget.getValue("routerState")?widget.getValue("routerState"):{};this._states=t.previousStates?t.previousStates:[]}return c.prototype.initialize=function(){var o=this;this.triptychCmp=null,this.app.editPropertyCmp=null,this.welcomePanelCmp=null,this.eventsBroker=this.app.mediator.getApplicationBroker(),widget.body.empty(),r.unmask(widget.body);var s=document.createElement("div");s.classList.add("xeng-app-container");var a=this.app.core.moduleHelper.viewsService.getApplicationImmersiveFrame();this.app.core.contextManager.elements.container=document.body,a.setContentInBackgroundLayer(s),widget.body.appendChild(a.getContent()),this.triptychCmp=this.app.componentsMgt.startNewInstance(i.TRIPTYCH_CMP,s),this.welcomePanelCmp=this.app.componentsMgt.startNewInstance(i.WELCOME_PANEL_CMP,this.triptychCmp.leftSideDiv),o.app.componentsMgt.startInstances([{name:i.PROPERTY_CMP,container:o.triptychCmp.rightDiv,contextData:{items:[]}}]).then(function(e){o.app.editPropertyCmp=e[0]}),this.globalEventsManagement(),this.app.router.routerMethods={},this.addRouteManager("myEngItems",new e({app:this.app,parentController:this})),this.addRouteManager("engItem_View",new t({app:this.app,parentController:this})),this.addRouteManager("recents_items",new n({app:this.app,parentController:this})),this.app.routerUtils.listenToRouterStateChanges(this.app.router);this.app.router.useMiddleware(function(e){return function(e,t){return"recents_items"===e.name&&(o._states=[]),o.pushNewRouterState(e),!0}}),this.app.core.viewState={isChildView:function(){return o.isChildView()}}},c.prototype.pushNewRouterState=function(e){var t=!1,n=widget.getValue("routerState");if(n&&e.name===n.current_State.name){for(var i in e.params)if(e.params.hasOwnProperty(i)&&e.params[i]!==n.current_State.params[i]){t=!0;break}if(!t)return null}this._states.push(e),widget.setValue("routerState",{current_State:e,previousStates:this._states})},c.prototype.popPreviousState=function(){return this._states.pop(),this._states.pop()},c.prototype.replaceCurrentRouterState=function(e){var t=!0,n=widget.getValue("routerState");if(n&&e.name===n.current_State.name){for(var i in e.params)if(e.params.hasOwnProperty(i)&&e.params[i]!==n.current_State.params[i]){t=!0;break}if(!t)return null}this._states.push(e),widget.setValue("routerState",{current_State:e,previousStates:this._states})},c.prototype.isChildView=function(){var e=this._states.length<2?null:this._states[this._states.length-2];return!!e&&"engItem_View"===e.name},c.prototype.globalEventsManagement=function(){var e=this;a.initialize({appCore:e.app.core}),s.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){t.data&&t.data.authored&&t.data.authored.deleted&&e.app.sandboxBase.dataService.removeFromRecents(t.data.authored.deleted).then(function(n){e.app.mediator.publish(i.EVENT_DELETED_ENG_ITEM,{ids:t.data.authored.deleted})})}),s.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/PART_NUMBER_UPDATED",function(t){if(e.app.mediator){var n=[];t.references.forEach(function(e){e={physicalid:e.physicalid,attributes:[{name:"ds6wg:EnterpriseExtension.V_PartNumber",value:e.partNumber}]};n.push(e)});var r={references:n};e.app.mediator.publish(i.EVENT_MODIFIED_REFERENCES,r)}}),s.subscribe("XEN/PUBLIC_EVENT/ENGINEERING_ITEM/ALTERNATE_UPDATED",function(t){if(e.app.mediator){var n=[];t.forEach(function(e){e={physicalid:e.physicalid,attributes:[{name:"Alternate",value:e.alternate}]};n.push(e)});var r={references:n};e.app.mediator.publish(i.EVENT_MODIFIED_REFERENCES,r)}}),s.subscribe("XSR/PUBLIC_EVENT/MAKE_FROM_UPDATE",function(t){if(e.app.mediator){var n=[];let s=[];t&&t.forEach(function(t){if(t&&"remove"!=t.actionMode){let n=t.details["ds6w:label"];if(t.details.asNeededActualValue){let i=t.details.quantity&&"0"!=parseInt(t.details.quantity)?`, ${t.details.quantity} ${t.details.quantityUOMNLS}`:"";n+=` (${e.app.core.i18nManager.get("makeFromAsRequired")}${i})`}else t.details.quantity&&t.details.quantityUOMNLS&&(n+=` (${t.details.quantity} ${t.details.quantityUOMNLS})`);s.push(n)}});var r={physicalid:t[0]&&t[0].details.parentId,attributes:[{name:"MadeFrom",value:s.length>0?s.join(", "):" "}]};n.push(r);var o={references:n};e.app.mediator.publish(i.EVENT_MODIFIED_REFERENCES,o)}}),s.subscribe(i.EVENT_REMOVE_CUT_INSTANCES,function(t){Array.isArray(t)&&e.app.core.contextManager.getContext().refresh({action:"unparent",instances:t})});e.app.mediator.subscribe(i.EVENT_TRIPTYCH_PANEL_VISIBLE,function(t){"right"===t&&(e.app.core.isPropertyPanelVisibilty=!0,e.app.editPropertyCmp||e.app.mediator.publish(i.EVENT_SHOW_PROPERTIES,{nodes:[]}))}),e.app.mediator.subscribe(i.EVENT_TRIPTYCH_PANEL_HIDDEN,function(t){"right"===t&&(e.app.core.isPropertyPanelVisibilty=!1)}),e.app.mediator.subscribe(i.EVENT_SHOW_PROPERTIES,function(t){let n=t.nodes;var r=!1;n&&Array.isArray(n)&&n.forEach(function(e){!0===e.readOnly&&(r=!0)}),e.app.editPropertyCmp?e.app.editPropertyCmp.setState(n,t.facet):e.app.componentsMgt.startInstances([{name:i.PROPERTY_CMP,container:e.triptychCmp.rightDiv,contextData:{items:n}}]).then(function(t){e.app.editPropertyCmp=t[0]}),e.app.editPropertyCmp.setReadonlyStatus(r)}),e.app.mediator.subscribe(i.EVENT_WELCOME_PANEL_ACTION_SELECTED,function(t){if(t.id===i.WP_ADD_NEW_CONTENT||t.id===i.WP_ADD_ENG_ITEM_ACTION){let t=e.app.core.PreferencesManager.isUserSelectedTypeChooserOption()?i.CREATE_NEW_CONTENT:i.CREATE_NEW_ENG_ITEM;e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:t})}else t.id===i.WP_MY_ENG_ITEMS_ACTION?e.app.router.navigate("myEngItems",{},{replace:!1,reload:!1}):t.id===i.WP_RECENTS_ITEMS_ACTION?e.app.router.navigate("recents_items",{},{replace:!1,reload:!1}):t.id===i.WP_IMPORT_ENG_ITEM_ACTION?(e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.IMPORT_ITEMS_CMD})):t.id===i.WP_OPEN_ENG_ITEM_ACTION?(e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{searchForOpen:!0}}})):t.id===i.WP_ADD_NEW_PART_ACTION&&(e.app.mediator.publish(i.EVENT_RESET_SELECTION),e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.CREATE_NEW_PART}))});e.createdItemsToken=e.app.mediator.subscribe(i.EVENT_NEW_ENG_ITEM_CREATED,function(t){e.app.mediator.publish(i.EVENT_LAUNCH_COMMAND,{commandId:i.OPEN_ENG_ITEM,context:{item:{objectId:t.physicalid,objectType:t.type}}})}),e.goBackToken=e.app.mediator.subscribe(i.EVENT_GO_BACK,function(){e.app.core.contextManager.setPreExpandEvent(!1);var t=e.popPreviousState();t?e.app.router.navigate(t.name,t.params,{replace:!1,reload:!0}):e.app.router.navigate("recents_items",{},{replace:!1,reload:!0})}),e.deletedItemsToken=e.app.mediator.subscribe(i.EVENT_DELETED_ENG_ITEM,function(t){var n=e.app.router.getState()||{};"engItem_View"===n.name&&t.ids.indexOf(n.params.pid)>-1&&e.app.mediator.publish(i.EVENT_GO_BACK)}),e.openItemWithCompassToken=e.app.mediator.subscribe(i.EVENT_OPEN_ITEM_WITH_COMPASS,function(t){e.app.core.contextManager.setPreExpandEvent(!1),e.app.core.Factories.ListItemFactory.openItemWithCompass(t)}),e.refreshToken=e.app.mediator.subscribe(i.EVENT_REFRESH_APP_CONTENT,function(t){e.app.core.contextManager.setPreExpandEvent(!1);var n=e.app.router.getState();n=n||{},"forceIndex"===e.app.core.sessionManager.determineCurrentModeState()&&(e.app.core.sessionManager.setAuthoringMode("index"),o.notifyAlert(e.app.core.i18nManager.get("force_index_mode"))),console.log("refreshing the view"),widget.data.appId="ENXENG_AP";var i=e.getRouteManager(n.name);e.app.core.PersistencyManager.setWidgetRefreshStatus(!0),(i=i||{})._isRefreshing=!0,i.deactivate(),i.activate(n),e.app.core.PersistencyManager.setWidgetRefreshStatus(!1),delete i._isRefreshing}),e.resizeTriptychToken=e.app.mediator.subscribe(i.EVENT_TRIPTYCH_RESIZE,function(t){"engItem_View"!==(e.app.router.getState()||{}).name&&(t<550?e.app.mediator.publish(i.EVENT_TRIPTYCH_HIDE_PANEL,"left"):e.app.mediator.publish(i.EVENT_TRIPTYCH_SHOW_PANEL,"left"))})},c.prototype.getRouteManager=function(e){return this.app.router.routerMethods[e]},c.prototype.addRouteManager=function(e,t){if(this.app.router.routerMethods[e])throw new Error("route manager is already defined");if(e.indexOf(" ")>=0)throw new Error("route name shouldn't contain spaces");if(!t)throw new Error("route manager is mandatory");if("function"!=typeof t.activate||"function"!=typeof t.deactivate)throw new Error("all mandatory methods are not define on this route "+e);this.app.router.routerMethods[e]=t},c}),define("DS/ENOXEngineer/ENOXEngineer",["WebappsUtils/WebappsUtils","DS/ENOXEngineerCommonUtils/XENMask","DS/ENOXEngineerInfra/ENOXEngineerCore","DS/ENOXEngineer/controllers/XEngineerBootstrap","DS/ENOXEngineer/routerConfig/RouterConfig","DS/LifecycleServices/LifecycleServicesSettings","DS/ENOXEngineer/utils/XEngineerConstants","DS/PlatformAPI/PlatformAPI","DS/ENOXEngineer/services/XEngLocalStorage","DS/ENOXEngineer/services/PreferencesManager","DS/ENOXEngineerExternalLibs/ENOXEngineerProfills","css!DS/ENOXEngineer/styles/ENOXEngineerApp.css"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return{onLoad:function(){widget.body.empty(),t.mask(widget.body),n({debug:"1"===widget.getValue("debug_me"),eagerComponentsLoading:!0,extensionsFolder:"DS/ENOXEngineer/services/",componentsRepository:"DS/ENOXEngineer/assets/config/componentsDef.json"}).use("EngineeringSettings").use("XENDicoService").use("EngineeringDataProvider").use("I18nManager").use("PreferencesManager").use("ViewsService").use("XENUserSessionManager").use("XENCollectionsFactory").use("XEngineerItemsFactory").use("XEngContextManager").use("CommandsService").use("ConfigItemsFactory").use("ColumnsMgtService").use("PersistencyManager").use("ExportService").use("OpenWithService").useRouter5({config:r,applicationController:i}).start().then(function(e){widget.appMediator=e.mediator,e.logger.info("#### xEngineer started in "+e.getStartupTime()+"ms !"),e.core.settingManager.isSetValidSelectionForOpen(widget.getValue("X3DContentId")).then(function(t){if(t&&t.objectId&&t.objectId.trim().length>0){var n=e.router.buildState("engItem_View",{pid:t.objectId});e.router.start(e.router.buildPath(n.name,n.params))}}).catch(function(t){e.logger.info(t);var n=widget.getValue("routerState")?widget.getValue("routerState"):{};e.mediator.publish(s.EVENT_LAUNCH_COMMAND,{commandId:s.UPDATE_WIDGET_TITLE,context:{label:null}}),n.current_State?("engItem_View"===n.current_State.name&&(e.core.isReloadedState=!0),e.router.start(n.current_State)):e.router.start("recents_items",{replace:!1})}),a.subscribe(s.EVENT_REFRESH_WIDGETS,function(e){widget.appMediator.publish(s.EVENT_REFRESH_APP_CONTENT)}),a.subscribe(s.EVENT_CLEAR_WIDGETS_CLIPBOARD,function(e){l.removeItem("clipboard")})})},onStop:function(){},onRefresh:function(){widget.appMediator.publish(s.EVENT_REFRESH_APP_CONTENT),a.publish(s.EVENT_CLEAR_WIDGETS_CLIPBOARD)},endEdit:function(){c.catchUserPreference()},onSearch:function(e){widget.appMediator.publish("enox-collection-toolbar-filter-search-value",{searchValue:[e]})},onResetSearch:function(e){widget.appMediator.publish("enox-collection-toolbar-filter-search-value",{searchValue:[]})}}}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialCVFetch",["UWA/Core","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialNlsManager"],(e,t,n)=>{class i{perform(n,{pids:i,requestData:r,nls_values:o},{fcs_url_mode:s,label:a,locale:l,tenant:c}){return e.is(n)&&e.is(i)&&e.is(r)?new Promise((e,d)=>{const u={...r,fcs_url_mode:s,label:a,physicalid:i,locale:l,tenant:c};t.perform(n,u).then(t=>{if(!Array.isArray(o)||!o.length)return e(t);this.updateAttributesWithNls(t,o,{locale:l,tenant:c}).then(t=>{e(t)})}).catch(e=>{console.error("error: ENOXMaterialCVFetch/perfom, something get wrong with the query"),d(e)})}):Promise.reject("error: ENOXMaterialCVFetch/perfom, wrong inputs")}updateAttributesWithNls(t,i,{locale:r,tenant:o}){if(!e.is(t)||!Array.isArray(i))return console.error("error: ENOXMaterialCVFetch/updateAttributesWithNls wrong input"),Promise.reject({});const s=Reflect.has(t,"results")?t.results:[];return new Promise((a,l)=>{s.forEach(s=>{const c=Reflect.has(s,"attributes")?s.attributes:[];if(!Array.isArray(c)||!c.length)return console.error("error: ENOXMaterialCVFetch/updateAttributesWithNls no attributes found"),l();const d={};if(c.forEach(t=>{Reflect.has(t,"dispValue")||-1===i.findIndex(e=>e===t.name)||(e.is(d[t.name])?d[t.name].push(t.value):d[t.name]=[t.value])}),!Reflect.ownKeys(d).length)return a(t);n.fetchNlsValues(d,{lang:r,tenantId:o}).then(e=>{Reflect.ownKeys(e).forEach(t=>{const n=c.find(e=>e.name===t);n.dispValue=e[t].get(n.value)}),a(t)}).catch(e=>{l(e)})})})}}let r=null;return r||(r=new i),r}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityUnitViewBuilder",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitFetchService","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/units/ChangeQuantityUnitTreeNodeService","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityViewBuilder","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/services/OccurrencesService","DS/Tweakers/GeneratedToolbar","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o,s)=>{const a=s.get("with"),l={None:{value:"None",label:s.get("None")},EqualQty:{value:"EqualQty",label:s.get("sameQuantities")},NextEqualQty:{value:"NextEqualQty",label:s.get("sameQuantitiesConsecutives")}},c="unit-quantity";return class extends n{constructor(){super(),this.groupModeTweaker=null,this.instPaths2Nodes=null,this.units=null}init(n){super.init(n),this.changeQuantityUnitTreeNodeService=new t(n),this.changeQuantityUnitFetchService=new e(n),this.addUnitTweakerInToolbar(),this.addUnitColumnInView(),this.persistentNodes=this.filterNonPersistentNodesFromModel()}release(){this.removeUnitTweakerFromToolbar(),this.removeUnitColumnFromView(),this.restoreNonPersistentNodesFromModel(),super.release()}async buildNodes(e){const{model:t}=e||{},n=t?t.getID():"";if(!n.trim().length)return Promise.reject(new Error("wrong input"));if(!Array.isArray(this.persistentNodes)||!this.persistentNodes.length)return Promise.reject(new Error("unexpected nodes"));this.instPaths2Nodes=this.getInstanceMapFromNode(this.persistentNodes);const i=Array.from(this.instPaths2Nodes.keys());return this.units=await this.changeQuantityUnitFetchService.fetchUnits(i,n),this.convertUnitsAsTreeNode(this.units,this.instPaths2Nodes,this.groupMode)}get groupMode(){if(!this.groupModeTweaker)return l.None;const e=this.groupModeTweaker.getAttributeValue("data");let t=l.None;switch(e){case l.None.value:t=l.None;break;case l.EqualQty.value:t=l.EqualQty;break;case l.NextEqualQty.value:t=l.NextEqualQty}return t}addUnitTweakerInToolbar(){this.groupModeTweaker||(this.groupModeTweaker=this.buildUnitGroupModeTweaker());const{toolbar:e}=this.viewContext||{};if(!e)throw new Error("invalid State");e.prepareUpdateView(),e.items.addRoot(this.groupModeTweaker),e.pushUpdateView()}removeUnitTweakerFromToolbar(){if(!this.groupModeTweaker)return;const{toolbar:e}=this.viewContext||{};if(!e)throw new Error("invalid State");e.prepareUpdateView(),e.items.removeRoot(this.groupModeTweaker),e.pushUpdateView()}addUnitColumnInView(){const{gridView:e}=this.viewContext||{},{columns:t}=e||{};if(!t)throw new Error("invalid State");const n=[...t],i={text:s.get("eng.ui.dialog.changeQuantity.headerQuantity"),dataIndex:c,editableFlag:!1,pinned:"left",width:75};e.prepareUpdateView();const r=t.findIndex(e=>"tree"===e.dataIndex);-1!==r?n.splice(r+1,0,i):n.push(i),e.columns=n,e.pushUpdateView()}removeUnitColumnFromView(){const{gridView:e}=this.viewContext||{},{columns:t}=e||{};if(!t)throw new Error("invalid State");const n=t.filter(e=>e.dataIndex!==c);e.prepareUpdateView(),e.columns=n,e.pushUpdateView()}buildUnitGroupModeTweaker(){const{toolbar:e}=this.viewContext;if(!e)throw new Error("invalid state");e.typeRepresentationFactory.registerTypeRepresentations({GroupModeEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:[l.None,l.EqualQty,l.NextEqualQty],valueType:"enumString"}}});const t={entries:[{id:"groupModeInput",dataElements:{typeRepresentation:"GroupModeEnum",position:"near",category:2,label:`${a}:`,displayLabel:!0,value:l.None.value,domId:"groupModeInput"},onNodeUpdate:this.onElementGroupModeEnum.bind(this)}]},n=o.prototype.createTreeDocument(t),[i]=n.getChildren();return i}onElementGroupModeEnum(){const e=this.convertUnitsAsTreeNode(this.units,this.instPaths2Nodes,this.groupMode);this.emptyView(),this.addNodesToView(e)}getInstanceMapFromNode(e){if(!Array.isArray(e))return null;const t=new Map;return e.forEach(e=>{const n=this.getInstancePathsFromNodeOccurencePath(e).join("/");n&&t.set(n,e)}),t}getInstancePathsFromNodeOccurencePath(e){if(!e||!e.getOccurrencePath)return null;const{XENOccurrence:t}=r;return new t(e.getOccurrencePath()).getPath(!1)}filterNonPersistentNodesFromModel(){const{model:e}=this.viewContext,{nodes:t}=e;return t.filter(e=>{const t=i.isNodeNew(e);return t&&e.hide(),!t})}restoreNonPersistentNodesFromModel(){const{model:e}=this.viewContext,{nodes:t}=e;t.filter(e=>i.isNodeNew(e)).forEach(e=>e.show())}convertUnitsAsTreeNode(e,t,n){let i=[];switch(n){case l.None:i=this.changeQuantityUnitTreeNodeService.buildGroupNoneUnitsNode(e,t);break;case l.EqualQty:i=this.changeQuantityUnitTreeNodeService.buildGroupEqualQtyUnitsNode(e,t);break;case l.NextEqualQty:i=this.changeQuantityUnitTreeNodeService.buildGroupNextEqualQtyUnitsNode(e,t)}return i}}}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialSections",["UWA/Core","UWA/Class","DS/Controls/Expander","DS/Controls/Loader","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialCVFetch","DS/ENOXEngineer/services/MaterialService","WebappsUtils/WebappsUtils","DS/ENOXEngineer/commands/MaterialFacet/ENOXMaterialCommandManager","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialApplyPanel","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialListPanel","DS/ENOXEngineer/services/MaterialConstants","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialExpandSectionContent.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialExpandSectionContent.css"],(e,t,n,i,r,o,s,a,l,c,d,u,p)=>{const{MaterialType:g}=d;class h extends t{constructor(t){super(t),this.facet=e.is(t.facet)?t.facet:null,this.appCore=e.is(t.appCore)?t.appCore:null,this._container=e.createElement("div",{class:"material-section"}),this._buildSkeleton(t),this._processingdMatIds=null,this.authoringIsRunning=!1,this.authoringEventTokens=[],this.authoringEventTokens.push(this.appCore.mediator.subscribe("event-authoring-material-start",this.onAuthoringMaterialStart.bind(this))),this.authoringEventTokens.push(this.appCore.mediator.subscribe("event-authoring-material-end",this.onAuthoringMaterialEnd.bind(this)))}destroy(){this.authoringEventTokens.forEach(e=>this.appCore.mediator.unsubscribe(e)),this.authoringEventTokens=[]}get commandManager(){return a}get content(){return this._container}get commandMenuEntryforCommandManager(){return null}get isApplyCommandAvailable(){return!1}update(e,t){return this._update(e,t)}get idsBeingProcessing(){return this._processingdMatIds}set idsBeingProcessing(e){this._processingdMatIds=e}get materialListPanel(){return this._materialList}_isIdsCurrentlyDisplayed(e){if(Array.isArray(this.idsBeingProcessing)&&Array.isArray(e)){if(this.idsBeingProcessing.length!=e.length)return!1;for(const t of e){if(-1===this.idsBeingProcessing.findIndex(({physicalid:e})=>t.physicalid===e))return!1}return!0}return!1}_update(t,n){return this.authoringIsRunning||this._isIdsCurrentlyDisplayed(t)?Promise.reject("update already running"):(this.materialListPanel.empty(),Array.isArray(t)&&t.length?new Promise((i,r)=>{this.idsBeingProcessing=t;const o=t.map(t=>{const i=e=>n.find(t=>e===t.physicalid),r=(t,n)=>e.is(n)?{...t,...n}:t,o=r(t,i(t.physicalid));if(e.is(o.partial)&&e.is(o.partial.support)){const e=t.partial.support,n=i(e.physicalid);o.partial.support=r(e,n)}return o});this._fetchMaterialInfos(o).then(e=>{this.materialListPanel.fill(e),this._updateViewFromModel(),this.idsBeingProcessing=null,i()}).catch(e=>{this.idsBeingProcessing=null,r(e)})}):(this._updateViewFromModel(),Promise.resolve([])))}_updateViewFromModel(){this._updateEltList.forEach(e=>{e[Symbol.for("updateView")]()})}onAuthoringMaterialStart({cmd:e,payload:t}){this.authoringIsRunning=!0,this.displayLoadingMode()}onAuthoringMaterialEnd(e,t){this.authoringIsRunning=!1}displayLoadingMode(){this.content.getElement(".section-material-list").hide(),this.content.getElement(".section-material-apply").hide(),this.content.getElement(".section-material-loading").show()}_buildSkeleton(t){const r=u.compile(p),o=e.createElement("div",{html:r()}),s=new l({...t,onApplyEvent:()=>{const e={context:this.appCore.contextManager.getContext(),searchManager:this.appCore.dataService.searchManager,getSelectedItems:this.getSelectedItems.bind(this),materialType:this.managedMaterialType};this.commandManager.executeCommand({commandHeader:"apply-material",cmdOptions:e})},onDnDEvent:({dataText:t})=>{e.is(t)&&"string"==typeof t||(t='{"data":{"items":[]}}');const n=JSON.parse(t),{data:i}=n;if(e.is(i)&&Array.isArray(i.items)){const e={context:this.appCore.contextManager.getContext(),getSelectedItems:this.getSelectedItems.bind(this),materialType:this.managedMaterialType,getDnDSelectedItems:()=>i.items},t="apply-material";this.commandManager.executeCommand({commandHeader:t,cmdOptions:e})}}}),a=o.getElement(".section-material-apply");s.content.inject(a),this._addElementToUpdateList(s,()=>{if(this.materialListPanel.isReferenceEmpty)if(this.isApplyCommandAvailable){const{dsModel:e}=a.querySelector("#material-apply-button")||{},[t]=this.getSelectedItems()||[];this.isAccessToSupportMaterialAvailable(t).then(n=>{const{references:i}=n,r=i.find(e=>e.physicalid===t);let o=!r||!r.supportAccessAvailable;e&&(e.disabled=o)}).catch(()=>{e&&(e.disabled=!0)}).finally(a.show())}else a.hide();else a.hide()});const d=o.getElement(".section-material-list-empty");this._addElementToUpdateList(a,()=>{this.materialListPanel.isEmpty?this.isApplyCommandAvailable?d.hide():d.show():d.hide()}),this._materialList=new c({...t,onContextualEvent:t=>{const n=t.cellInfos.cellModel;if(!e.is(n))return void console.error("error: ENOXMaterialSection/onContextualEvent -> no cellModel");if(!e.is(n.matDBInfos))return void console.error("error: ENOXMaterialSection/onContextualEvent -> no matInfos");const{matDBInfos:i}=n,r=Array.isArray(t.menu)?t.menu[0]:null;if(!e.is(r))return void console.warn("ENOXMaterialSection/onContextualEvent -> no menu entry found");const o={context:this.appCore.contextManager.getContext(),getSelectedMaterials:()=>[i],searchManager:this.appCore.dataService.searchManager,getSelectedItems:this.getSelectedItems.bind(this),materialType:this.managedMaterialType},s={onMenuItemClicked:e=>{this.commandManager.executeCommand({commandHeader:e,cmdOptions:o})}};return this.commandManager.getMenu({menuEntry:r,menuOptions:s})}});const g=o.getElement(".section-material-list");this.materialListPanel.content.inject(g),this._addElementToUpdateList(this.materialListPanel,()=>{this.materialListPanel.isEmpty?g.hide():g.show()});const h=o.getElement(".section-material-loading-Bar");new i({text:`${this.appCore.i18nManager.get("materialFacet.authoring.running")} ...`}).inject(h).on();const m=o.getElement(".section-material-loading");this._addElementToUpdateList(m,()=>{m.hide()});const f=o.getElement(".material-section-expand-content"),E="string"==typeof t.labelHeader?t.labelHeader:"",C=this.appCore.i18nManager.get(E),_=new n({header:this.expanderLabel,body:f,expandedFlag:!1,style:"simple"});_.inject(this._container),this._addElementToUpdateList(_,()=>{const e=this.materialListPanel.length;e||this.isApplyCommandAvailable?_.expand():_.close(),this._container.getElement(".headerTitle").setText(`${C} (${e})`)})}_addElementToUpdateList(e,t){Array.isArray(this._updateEltList)||(this._updateEltList=[]),e[Symbol.for("updateView")]=t,this._updateEltList.push(e)}_fetchCVInfos({pids:t,requestData:n}){return new Promise((i,o)=>{const s=this.appCore.settingManager.getCommand("cv_fetch");r.perform(s,{pids:t,requestData:n,nls_values:["ds6w:type","ds6w:status","ds6w:materialDomain"]},{fcs_url_mode:"REDIRECT",label:this.appCore.settingManager.getCVRequestLabel(),locale:this.appCore.settingManager.getLanguage(),tenant:this.appCore.settingManager.getPlatformId()}).then(t=>{const n=(Reflect.has(t,"results")?t.results:[]).map(t=>(t=>{if(!Array.isArray(t))return console.error("error: attributesParser input should be an array"),{};const n={};return t.forEach(t=>{let i=t.name;t.format&&"ds6w_facet"===t.format&&(i=t.name.split("/").pop());const r=t=>e.is(t.dispValue)?t.dispValue:t.value;switch(i){case"resourceid":n.resourceid=t.value,n.physicalid=t.value;break;case"type_icon_url":n.icons||(n.icons=[]),n.icons.push(t.value);break;case"preview_url":case"thumbnail_2d":n.thumbnail=t.value;break;case"ds6w:type":n.type=r(t);break;case"ds6wg:PLMReference.V_isLastVersion":n.isLastVersion="boolean"==typeof t.value?t.value:"TRUE"===t.value.toUpperCase(),n["ds6wg:PLMReference.V_isLastVersion"]=t.value;break;case"bo.PLMReference.v_versionid":n.versionid=t.value;break;default:n.hasOwnProperty(i)&&n[i]!==t.value?n[i]="":n[i]=r(t)}}),n})(t.attributes));i(n)}).catch(e=>{o(e)})})}_buildDisplayInfos({refs:e,requestData:t,displayFct:n}){return Array.isArray(e)&&e.length?new Promise((i,r)=>{const o=e.map(e=>e.physicalid);this._fetchCVInfos({pids:o,requestData:t}).then(t=>{const r=e.map(e=>{const i=t.find(t=>t.physicalid===e.physicalid);return n(e,i)});i(r)}).catch(e=>{r(e)})}):Promise.reject("wrong inputs")}_fetchMaterialInfos(t){return this._buildDisplayInfos({refs:t,requestData:{select_file:["icon","thumbnail_2d"],select_predicate:["ds6w:label","ds6w:type","ds6w:identifier","ds6w:status","ds6w:responsible","ds6wg:revision","ds6w:globalType","ds6w:discipline","ds6w:classification","ds6w:how/ds6w:materialDomain"]},displayFct:(t,n)=>{const i=(i,r,o="")=>e.is(n)&&e.is(n[i])?n[i]:e.is(t)&&e.is(t[r])?t[r]:o,r={icons:i("icons","",(()=>{const e=i("type","V_discipline").includes("Core")?"I_Material_Nav_core.png":"I_Material_Nav_covering.png";return[s.getWebappsAssetUrl("ENOXEngineer",`icons/32/${e}`)]})()),thumbnail:i("thumbnail","",(()=>{const e=i("type","V_discipline").includes("Core")?"I_Material_Nav_core.png":"I_Material_Nav_covering.png";return s.getWebappsAssetUrl("ENOXEngineer",`img/${e}`)})()),type:i("type","V_discipline"),"ds6w:label":i("ds6w:label","V_Name"),"ds6wg:revision":i("ds6wg:revision","revision"),"ds6w:status":i("ds6w:status","current"),"ds6w:responsible":i("ds6w:responsible","owner"),"ds6w:identifier":i("ds6w:identifier","name")};e.is(t.partial)&&Object.defineProperty(r,"partial",{get:function(){return t.partial}}),e.is(t.context)&&Object.defineProperty(r,"context",{get:function(){return t.context}});const o=e.is(t.partial)?"partialMaterial":this.commandMenuEntryforCommandManager;return e.is(o)&&Object.defineProperty(r,"menuEntry",{get:function(){return o}}),Object.defineProperty(r,"matDBInfos",{get:function(){return t}}),r}})}}return{ENOXMaterialCoreSection:class extends h{constructor(e){super({...e,labelHeader:"materialSection.coreref.title"})}get commandMenuEntryforCommandManager(){return"coreMaterial"}get isApplyCommandAvailable(){return!0}get managedMaterialType(){return g.core}isAccessToSupportMaterialAvailable(e){return o.getCoreMaterialSupportInfo({pids:[e]})}getSelectedItems(){const t=[],n=e.is(this.facet)?this.facet.selectedNode:null;return e.is(n)&&t.push(n.getID()),t}isEditedReferences(e){const t=this.getSelectedItems();for(const n of e)if(-1===t.findIndex(e=>e===n.physicalid))return!1;return!0}onAuthoringMaterialStart({cmd:e,payload:t}){"post_core_material"===e&&super.onAuthoringMaterialStart({cmd:e,payload:t})}onAuthoringMaterialEnd({cmd:t,answer:n}){if("post_core_material"!==t)return;super.onAuthoringMaterialEnd({cmd:t,answer:n});const i=[],r=[],{references:o}=n;if(!e.is(o))return void this._updateViewFromModel();if(Array.isArray(o)&&o.length>0){if(!this.isEditedReferences(o))return console.error("error: onAuthoringMaterialEnd -> send references don't match with the edited ones"),void this._updateViewFromModel();const t=o[0],{corematerial:n}=(this.getSelectedItems(),t);e.is(n)&&Array.isArray(n)&&i.push(...n)}const{references_infos:s}=n;e.is(s)&&Array.isArray(s)&&s.forEach(e=>{-1===r.findIndex(({physicalid:t})=>t===e.physicalid)&&r.push(e)}),this.update(i,r)}},ENOXMaterialCoveringSection:class extends h{constructor(e){super({...e,labelHeader:"materialSection.coverref.title"})}get commandMenuEntryforCommandManager(){return"coveringMaterial"}get isApplyCommandAvailable(){return!0}get managedMaterialType(){return g.covering}isAccessToSupportMaterialAvailable(e){return o.getCoveringMaterialSupportInfo({pids:[e]})}getSelectedItems(){const t=[],n=e.is(this.facet)?this.facet.selectedNode:null;return e.is(n)&&t.push(n.getID()),t}isEditedReferences(e){const t=this.getSelectedItems();for(const n of e)if(-1===t.findIndex(e=>e===n.physicalid))return!1;return!0}onAuthoringMaterialStart({cmd:e,payload:t}){"post_covering_material"===e&&super.onAuthoringMaterialStart({cmd:e,payload:t})}onAuthoringMaterialEnd({cmd:t,answer:n}){if("post_covering_material"!==t)return;super.onAuthoringMaterialEnd({cmd:t,answer:n});const i=[],r=[],{references:o}=n;if(!e.is(o))return void this._updateViewFromModel();if(Array.isArray(o)&&o.length>0){if(!this.isEditedReferences(o))return console.error("error: onAuthoringMaterialEnd -> send references don't match with the edited ones"),void this._updateViewFromModel();const t=o[0],{coveringmaterial:n}=t;e.is(n)&&Array.isArray(n)&&i.push(...n)}const{references_infos:s}=n;e.is(s)&&Array.isArray(s)&&s.forEach(e=>{-1===r.findIndex(({physicalid:t})=>t===e.physicalid)&&r.push(e)}),this.update(i,r)}},ENOXMaterialCoveringInstSection:class extends h{constructor(e){super({...e,labelHeader:"materialSection.coverinst.title"})}get commandMenuEntryforCommandManager(){return"covering-instMaterial"}get managedMaterialType(){return g.covering}getSelectedItems(){return null}onAuthoringMaterialStart({cmd:e,payload:t}){}onAuthoringMaterialEnd({cmd:e,answer:t}){}_update(t,n){let i=[];return Array.isArray(t)&&t.forEach(t=>{let r=t.context;const o=(e=>n.find(t=>e===t.physicalid))(r.physicalid);r=((t,n)=>e.is(n)?{...t,...n}:t)(r,o),t.materialref.forEach(e=>{const t={physicalid:e.physicalid,context:r};i.push(t)})}),super._update(i,n)}}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityModelEffectivityComponent",["UWA/Core","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewBuilderComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityUnitViewBuilder","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/Tweakers/GeneratedToolbar","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o,s,a)=>{const l=`${a.get("tooltip_GroupBy")}:`,c=a.get("Units"),d=`${a.get("Model")}:`,u={Unit:"Unit"},p="None";return new class extends t{init(e){this.viewContext=e,this.modelTweaker=null,this.effTypeTweaker=null;const{model:t}=e;this.unitsViewBuilder=new i(t),n.registerBuilder(u.Unit,c,this.unitsViewBuilder)}activate({toolbar:e}){e.prepareUpdateView(),e.items.addRoot(this.modelTweaker,0),e.items.addRoot(this.effTypeTweaker,1),e.pushUpdateView(),this.applyViewBuilder()}buildUIComponent(t){const n=this.buildModelTweaker(t),i=e.is(n.dataElements.value),r={entries:[n,this.buildEffTweaker(t,i)]},o=s.prototype.createTreeDocument(r);[this.modelTweaker,this.effTypeTweaker]=o.getChildren()}deactivate({toolbar:e}){e.prepareUpdateView(),e.items.removeRoot(this.modelTweaker),e.items.removeRoot(this.effTypeTweaker),e.pushUpdateView(),n.restoreDefaultBuilder(),super.deactivate()}destroy(){n.unregisterBuilder(u.Unit),super.destroy()}get isModelValueSettled(){return e.is(this.modelTweaker.getAttributeValue("data"))}applyViewBuilder(){const e=this.modelTweaker.getAttributeValue("data"),t=this.effTypeTweaker.getAttributeValue("data");e&&t&&n.applyBuilder(t,e)}computeAvailableValuesForModel(e){const t={None:{value:p,label:a.get("None")}};return e.getModelAttached().forEach((e,n)=>{const i=e.getDisplayName(),r="string"==typeof i&&i.trim().length?e.getDisplayName():e.getLabel();t[`Model${n}`]={value:{modelID:e.getID(),model:e},label:r}}),Reflect.ownKeys(t).map(e=>t[e])}buildModelTweaker({toolbar:e,model:t}){const n=this.computeAvailableValuesForModel(t),i=e.typeRepresentationFactory.getRegisteredTypeRepresentation("ModelEnum");i?i.semantics.possibleValues=n:e.typeRepresentationFactory.registerTypeRepresentations({ModelEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:n,valueType:"enumString"}}});const r={id:"modelItem",dataElements:{typeRepresentation:"ModelEnum",position:"near",category:1,label:d,displayLabel:!0,domId:"modelInput"},onNodeUpdate:this.onModelTweaker.bind(this)};return n.length>1&&(r.dataElements.value=n[n.length-1].value),r}computeAvailableValuesForEffectivities(){const e={None:n.defaultModeEntry,Units:{value:u.Unit,label:c}};return Reflect.ownKeys(e).map(t=>e[t])}buildEffTweaker({toolbar:e},t){const n=this.computeAvailableValuesForEffectivities();e.typeRepresentationFactory.getRegisteredTypeRepresentation("EffTypeEnum")||e.typeRepresentationFactory.registerTypeRepresentations({EffTypeEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:n,valueType:"enumString"}}});const i={id:"effTypeItem",dataElements:{typeRepresentation:"EffTypeEnum",position:"near",category:2,label:l,disabled:!t,displayLabel:!0,domId:"effectivityInput"},onNodeUpdate:this.onEffTypeTweaker.bind(this)};return n.length&&(i.dataElements.value=n[0].value),i}enableModelView(){this.enableEffTwicker()}disableModelView(){this.disableEffTwicker()}enableEffTwicker(){const{toolbar:e}=this.viewContext;e.updateNodeModel("effTypeItem",{disabled:!1})}disableEffTwicker(){const{toolbar:e}=this.viewContext;e.updateNodeModel("effTypeItem",{disabled:!0,grid:{data:"None"}})}onModelTweaker(e){e.getAttributeValue("data")!==p?this.enableModelView():this.disableModelView()}onEffTypeTweaker(){this.applyViewBuilder()}}}),define("DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials",["UWA/Core","UWA/Class","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/facets/MaterialFacet/ENOXMaterialSections","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/services/MaterialService","DS/Controls/ModalContainer","DS/Controls/Loader","DS/ENOXEngineer/services/I18nManager","DS/Handlebars/Handlebars","text!DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials.html","css!DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials.css"],(e,t,n,i,r,o,s,a,l,c,d)=>{const u={noselection:"noselection",nomaterial:"nomaterial",multiselection:"multiselection",unknowntype:"unknowntype"},p={vpm_instance:"VPMInstance",vpm_reference:"VPMReference"};return class extends t{constructor(t){super(t),this.appCore=t.appCore;const n=c.compile(d),i=e.createElement("div",{html:n()});this._container=i.getElement(".relatedmaterials-container"),this._buildSkeleton(t),this._selectedNode=null}get content(){return this._container}get selectedNode(){return this._selectedNode}_buildSkeleton(e){this._referenceMaterialBox=this.content.getElement(".relatedmaterials-reference");const{ENOXMaterialCoreSection:t,ENOXMaterialCoveringSection:n,ENOXMaterialCoveringInstSection:r}=i,o={facet:this,...e};this._referenceMaterialBox.core=new t(o),this._referenceMaterialBox.core.content.inject(this._referenceMaterialBox),this._referenceMaterialBox.cover=new n(o),this._referenceMaterialBox.cover.content.inject(this._referenceMaterialBox),this._referenceMaterialBox.hide(),this._instanceMaterialBox=this.content.getElement(".relatedmaterials-instance"),this._instanceMaterialBox.core=new t(o),this._instanceMaterialBox.core.content.inject(this._instanceMaterialBox),this._instanceMaterialBox.cover=new n(o),this._instanceMaterialBox.cover.content.inject(this._instanceMaterialBox),this._instanceMaterialBox.cover_inst=new r(o),this._instanceMaterialBox.cover_inst.content.inject(this._instanceMaterialBox),this._instanceMaterialBox.hide(),this._informationBox=this.content.getElement(".relatedmaterials-information"),this._messageInformationBox=this.content.getElement(".relatedmaterials-information-msg"),this._informationBox.hide(),this._loadingBox=this.content.getElement(".relatedmaterials-loading");const c=l.get("loading"),d=new a({text:c});d.on(c),s.createModal(this._loadingBox,d.elements.container),this._loadingBox.hide()}_displayInformationBox(t){if(!e.is(this._messageInformationBox))return void console.error("error: messageInformationBox is null");let n="";t===u.noselection?n=this.appCore.i18nManager.get("materialFacet.noSelection"):t===u.multiselection?n=this.appCore.i18nManager.get("materialFacet.multiSelection"):t===u.nomaterial?n=this.appCore.i18nManager.get("materialFacet.noMaterial"):t===u.unknowntype?n=this.appCore.i18nManager.get("notSupportedSelection"):console.error("error: input should be 'noselection' or 'multiselection' or 'nomaterial'"),this._messageInformationBox.setText(n),this._referenceMaterialBox.hide(),this._instanceMaterialBox.hide(),this._informationBox.show()}isInstanceNode(e){return e instanceof this.appCore.Factories.ListItemFactory.getListInstanceClass()}async selectionModified(t){if(!e.is(t)||!Array.isArray(t))throw new Error("selectedNodes unexpected value");if(!e.is(this._messageInformationBox))throw new Error("messageInformationBox is null");if(!e.is(t)||0===t.length)return this._selectedNode=null,void this._displayInformationBox(u.noselection);if(t.length>1)return this._selectedNode=null,void this._displayInformationBox(u.multiselection);const n=t[0];if(!Reflect.has(n,"isEngineeringItem")||!n.isEngineeringItem())return void this._displayInformationBox(u.unknowntype);if(e.is(this._selectedNode)&&n.getID()===this._selectedNode.getID())return;this._loadingBox.show(),this._informationBox.hide(),this._instanceMaterialBox.hide(),this._referenceMaterialBox.hide();let i={};if(this.isInstanceNode(n)){const e=p.vpm_instance,t=[n.getID()],{XENOccurrencesBag:o,XENOccurrence:s}=r,a=new s(n.getOccurrencePath()),l=new o;l.push(a),i={type:e,pids:t,xen_occs:l}}else i={type:p.vpm_reference,pids:[n.getID()]};this._selectedNode=n;const o=await this._extractMaterialInfoFromNode(i);this._loadingBox.hide(),await this._displayMaterialInfo(o,n.getID())}_extractMaterialInfoFromNode({type:t,pids:i,xen_occs:r}){return new Promise(s=>{const a=[];a.push(o.fetchCoreMaterialData({pids:i})),a.push(o.fetchCoveringMaterialData({pids:i,xen_occs:r})),n.allSettled(a).then(n=>{const i=[],o=[],a=[],l=[];n.forEach(t=>{if("fullfilled"===t.state){const{references:n}=t.value;if(e.is(n)&&Array.isArray(n)&&n.length>0){const t=n[0],{corematerial:r,coveringmaterial:s}=t;e.is(r)&&Array.isArray(r)&&i.push(...r),e.is(s)&&Array.isArray(s)&&s.length>0&&o.push(...s)}const{occurrences:s}=t.value;if(e.is(s)&&Array.isArray(s)){const t=s[0],n=r.getXENOccurrencefromOccurrencePath(t.physicalid),{coveringmaterial:i}=t;e.is(n)&&e.is(i)&&Array.isArray(i)&&a.push(...i)}const{references_infos:c}=t.value;e.is(c)&&Array.isArray(c)&&c.forEach(e=>{-1===l.findIndex(({physicalid:t})=>t===e.physicalid)&&l.push(e)})}else console.error("error: fetching material data failed")}),s({type:t,coreMaterialInfo:i,coveringMaterialInfo:o,coveringMaterialInstanceInfo:a,referencesInfo:l})})})}async _displayMaterialInfo({type:e,coreMaterialInfo:t,coveringMaterialInfo:n,coveringMaterialInstanceInfo:i,referencesInfo:r},o){switch(e){case p.vpm_instance:await this._buildInstanceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,coveringMaterialInstanceInfo:i,referencesInfo:r},o);break;case p.vpm_reference:await this._buildReferenceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,referencesInfo:r},o)}}async _buildReferenceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,referencesInfo:i},r){const o=[];o.push(this._referenceMaterialBox.core.update(t,i)),o.push(this._referenceMaterialBox.cover.update(n,i)),await Promise.all(o),e.is(this._selectedNode)&&r===this._selectedNode.getID()&&this._referenceMaterialBox.show()}async _buildInstanceMaterialInfoDisplay({coreMaterialInfo:t,coveringMaterialInfo:n,coveringMaterialInstanceInfo:i,referencesInfo:r},o){const s=[];s.push(this._instanceMaterialBox.core.update(t,r)),s.push(this._instanceMaterialBox.cover.update(n,r)),s.push(this._instanceMaterialBox.cover_inst.update(i,r)),await Promise.all(s),e.is(this._selectedNode)&&o===this._selectedNode.getID()&&this._instanceMaterialBox.show()}}}),define("DS/ENOXEngineer/facets/ENOXMaterialFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXEngineer/facets/MaterialFacet/ENOXRelatedMaterials","css!DS/ENOXEngineer/styles/ENOXMaterialFacet.css"],(e,t,n,i,r)=>{"use strict";return t.extend(n,i,{init(e){this._parent(e),this._buildView(e)},_buildView(t){this._relatedMats||(this.elements.container=e.createElement("div",{class:"relatedMaterials"}),this._relatedMats=new r({appCore:this.options.appContext}),this.appCore=this.options.appContext,this._relatedMats.content.inject(this.elements.container))},updateFacet(){const e=this.appCore.contextManager.getXENTreeDocument().getSelectedNodes();return this._relatedMats.selectionModified(e)},destroyComponent(){console.warn("destroyComponent called")},onResize(){console.warn("onResize")},onRefresh(){this.updateFacet()},onAction(e){}})}),define("DS/ENOXEngineer/collections/EngItemContentTreeDocument",["UWA/Core","DS/ENOXEngineer/collections/XEngGridTreeDocument","DS/ENOXEngineer/columnsFormatter/PreferredUnitColumnProvider","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/utils/Utils","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineerCommonUtils/xEngAlertManager","DS/ENOXEngineer/services/OccurrencesService","DS/ENOXEngineer/componentsHelpers/ExpandLevelCmds/js/ExpandLevelUtils","require","DS/ENOXEngineer/models/EngItemGroupModel"],function(e,t,n,i,r,o,s,a,l,c,d){"use strict";return t.extend({init:function(e,t){var n=this;if(!e||!t)throw new Error("EngItemContentTreeDocument require two valid parameters");this._parent(t),this._contentFetchers=[],this._countOnGoingAttributesLoaders=0,this.additionalColumnsProvidersDef=[],this._contentIsLoading=!0,this._effAllLoadJobIds=[],this._wholeContentLoaderJobIds=[],this._wholeContentLoaderJobPromises=[],this._colorizeState=!1,this._effInstanceIDs=[],this.isFilledByASessionManager=!1,this._embeddedEngItem=e,e.attachContentModels(this),e.getChildren=function(){return n.getChildren()},this.enableEventListners()},subscribeToFilterBIProxyEvents(e){e&&"function"==typeof e.setNGFilterOptions&&(e.addEvent("ApplyNGFilter",this.onApplyNGFilter.bind(this),this),e.addEvent("FilterBIGroupingEvent",this.onFilterBIGroupingEvent.bind(this),this)),this._parent(e)},unsubscribeToFilterBIProxyEvents(e){e&&(e.removeEvent("ApplyNGFilter"),e.removeEvent("FilterBIGroupingEvent")),this._parent(e)},getEngineeringItem:function(){return this._embeddedEngItem},_getProvidersForOnlyVisibleAttributes:function(){return this._getProvidersByPolicy("visible")},_getProvidersForWholeContentAttributes:function(){return this._getProvidersByPolicy("whole")},getColumnsProvidersInstancesByPolicy:function(e){return this.getColumnsProvidersDefinitionByPolicy(e).map(function(e){return e.instance})},getColumnsProvidersDefinitionByPolicy:function(e){var t=null;switch(e){case"visible":t=this._getProvidersForOnlyVisibleAttributes();break;case"whole":t=this._getProvidersForWholeContentAttributes();break;default:t=this.getColumnsProviders()}return t||[]},_getProvidersByPolicy:function(e){return this.getColumnsProviders().filter(function(t){return t.loadingPolicy===e})},getColumnsProviders:function(){return Array.isArray(this.additionalColumnsProvidersDef)?this.additionalColumnsProvidersDef:[]},isThereAProvider:function(){return this.getColumnsProviders().length>0},getColumnsProvidersInstances:function(){return this.getColumnsProviders().map(function(e){return e.instance})},registerColumnsProviders:function(e){if(Array.isArray(e)){var t=e.filter(function(e){return e&&e.ID&&e.instance&&e.loadingPolicy}),n=this;t.forEach(function(e){!n.getColumnsProviders().find(function(t){return t.ID===e.ID})&&e&&n.getColumnsProviders().push(e)})}},unregisterColumnsProviders:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var n=t.getColumnsProviders().findIndex(function(t){return t.ID===e});n>-1&&t.getColumnsProviders().splice(n,1)})},freeXENContent:function(){this.removeRoots(),this.getBIFilter().resetNGFilterUI({widgetId:widget.id,rootIDs:[this.core.contextManager.getActiveEngItem().getID()]}),this.core.PersistencyManager.resetNGFilter(),this.getBIFilter().removeRoot(this.core.contextManager.getActiveEngItem().getID()),this._contentFetchers=[],this._embeddedEngItem=void 0;var e=this;Array.isArray(this._modeleventsTokens)&&this._modeleventsTokens.forEach(function(t){e.core.mediator.unsubscribe(t)}),e.getModelEvents()&&e.getModelEvents().unsubscribeAll(),this.stopAllLoadingJobs(),this.destroy()},enableEventListners:function(){this._modeleventsTokens=[];var e=this;this._modeleventsTokens.push(e.core.mediator.subscribe(i.EVENT_UPDATE_INSTANCES_EFFECTIVITIES,function(t){e.applyUpdatedEffectivities(t)})),this._modeleventsTokens.push(e.core.mediator.subscribe(i.EVENT_UPDATE_NODES_WITH_CHANGESETS,function(t){e.withTransactionUpdate(function(){e.changeSetMerger(t)})})),this._modeleventsTokens.push(e.core.mediator.subscribe(i.EVENT_AUTHORING_MATERIAL_END,function({answer:t}){e.withTransactionUpdate(()=>{const{references:n}=t;if(Array.isArray(n)){const t=n.map(e=>e.physicalid),i=e.findNodesByIds(t);i.length&&e.refreshProvidedColumns(i,!0)}})}))},deleteNodesByInstanceID:function(e){var t=this;this.withTransactionUpdate(function(){t._getNoFakeNodes(t.findNodesByIds(e.instances)).forEach(function(e){e.remove()})}),t.reApplyUserCurrentViewOptions(),t.reApplyGroups()},getChildrenWithoutGroupingNodes:function(){return this._getNoFakeNodes(this.getRoots()||[])},_getNoFakeNodes:function(e){if(e.length>0){if(e[0]._isFromOriginalModel())return e;var t=[];return e.forEach(function(e){var n=e.getChildren();null!=n&&(t=t.concat(n))}),this._getNoFakeNodes(t)}return[]},onApplyNGFilter:function(t){this.core.logger.info(" onApplyNGFilter updating user filterd view");var n=t||null;if(delete(n=e.is(n,"string")?JSON.parse(n):n).CVQuery3D,n.appId!==this.core.settingManager.getWidgetId()||this.core.sessionManager.sessionAlreadyBuilt)this.core.sessionManager.sessionAlreadyBuilt=!1;else{if(t.empty)this.core.PersistencyManager.resetNGFilter();else{var i=this.getBIFilter();if(i){var r=this.getEngineeringItem().getID(),o=i.HasFilter(r);if(o.filterId){let e={filterName:t.filterTitle,filterId:o.filterId};this.core.PersistencyManager.setNGFilter(e)}}}this._buildFilteredContent(n)}},onFilterBIGroupingEvent:async function(e){await this._buildGroupedContent(e),this.getBIFilter().setGroupingStatus({status:!0})},hasConvertissibleColumns:function(){return this.core.dicoService.getVisibleAttributes().some(function(e){return"rollup"===e.dataIndex||e.attrUnit&&e.attrUnit.length>0})},getConvertissibleAttributes:function(){return this.core.dicoService.getVisibleAttributes().filter(function(e){return e.attrUnit&&e.attrUnit.length>0})},filterVisibleAttributes:function(e){const t=this.core.dicoService.getVisibleAttributes().map(e=>e.ds6w);return e.filter(e=>-1!==t.indexOf(e.ds6w))},getAdditionalColumns:function(e){var t=[];return this.getColumnsProvidersInstancesByPolicy(e).forEach(function(e){var n=e.getManagedColumnNames();n=n.map(function(e){return{dataIndex:e}}),e.getAdditionalColumnsUX(n),t=t.concat(n)}),t},_bypassForConfigColumns:function(){var e=this;e.getColumnsProvidersInstances().forEach(function(t){var n={relids:[],pids:[e.getEngineeringItem().getID()]};t.updateAttributes(n,function(e){console.warn(e)})})},_getCandidateForChunkLoading:function(e,t,n){if(!Array.isArray(e))return[];var r=this,o=r.getAdditionalColumns(t).map(function(e){return e.dataIndex});return e.filter(function(e){if(!e)return!1;if(n)return!0;if(e.isDocument(i.SPECIFICATION_DOCUMENT))return!0;if(r.hasConvertissibleColumns()&&e.isAttributeConvertionStarted&&!e.isAttributeConvertionStarted())return!0;for(var t=0;t<o.length;t++){const n=o[t];
//!that._isNodeAttributeManagedByALoader(node, attrName) &&
if(e.attributeRemoteLoadingNotStart(n))return!0}return!1})},_isNodeAttributeManagedByALoader:function(e,t){return!!(e&&e.isAttributeLoadFailed&&e.isAttributePending&&t)&&(e.isAttributeLoadFailed(t)||e.isAttributePending(t))},prepareNodesForLoadAdditionalColumns:function(e,t,n,i){if(Array.isArray(e)){var r=t&&Array.isArray(t)&&t.length>0?t:this.getAdditionalColumns(i).map(function(e){return e.dataIndex});this.withTransactionUpdate(function(){e.forEach(function(e){var t={};r.forEach(function(i){(n||void 0===e.getAttributeValue(i))&&(t[i]="#queued#")}),e.updateOptions({grid:t})})})}},fillAttributesAsync4VisibleNodes:function(e,t,n,i){return this._prepareAndLaunchLoaderJob(e,this.loadVisibleColumnsByChunk.bind(this),n,i,t)},loadVisibleColumnsByChunk:function(e,t,n){var i=this.core.settingManager.getSetting("effectivityChunkSize");return this._genericChunksLoader(e,t,i,n)},isNotWaitingForAttributes:function(){return 0===this._countOnGoingAttributesLoaders},asyncRetrieveMissingAttributes:function(e,t){var n=this,i=this._prepareAndLaunchLoaderJob(e,this.loadWholeContentColumnsByChunk.bind(this),t,"whole");if(i){var r=n.getJobInfos(i);if(r&&r.promise)return n._countOnGoingAttributesLoaders++,r.promise.finally(function(){n._countOnGoingAttributesLoaders--}),i}},loadWholeContentColumnsByChunk:function(e,t,n){var i=this.core.settingManager.getSetting("conversionChunkSize");return this._genericChunksLoader(e,t,i,n)},getJobInfos:function(e){if(e&&this.chunkLoaders&&this.chunkLoaders[e])return this.chunkLoaders[e]},stopAllLoadingJobs:function(){this.chunkLoaders&&this.cancelJobByIds(Object.getOwnPropertyNames(this.chunkLoaders))},cancelJobByIds:function(e){var t=this;t.chunkLoaders&&Array.isArray(e)&&e.forEach(function(e){var n=t.getJobInfos(e);n&&n.promise&&n.promise.cancelEmbeddedRequest()})},_prepareAndLaunchLoaderJob:function(e,t,n,i,o){if(Array.isArray(e)&&0!==e.length){if(0!==(e=this._getCandidateForChunkLoading(e,i,o)).length){var s=n;Array.isArray(n)||(s=[]),this.prepareNodesForLoadAdditionalColumns(e,s,o),this.chunkLoaders||(this.chunkLoaders={});var a=r.uid();return this.chunkLoaders[a]={},this.chunkLoaders[a].promise=t.call(this,e,a,i),a}}},_genericChunksLoader:function(e,t,n,i){var r=this,s=o.wrappedWithCancellablePromise(function(s,a){for(var l=n||r.core.settingManager.getSetting("defaultChunksize"),c=Math.ceil(e.length/l),d=[],u=0;u<c;u++)d[u]=u;r.chunkLoaders[t].remainingChunks=d;var p=o.wrappedWithCancellablePromise(function(e,t){e()});r.chunkLoaders[t].remainingChunks.reduce(function(n,s,a){return o.wrappedWithCancellablePromise(function(o,s){n.finally(function(n){if(!r||!r.chunkLoaders||!r.chunkLoaders[t]||r.chunkLoaders[t].shouldStop)return o();var c=l*a;r.loadAChunk(e.slice(c,c+l),i).then(function(){o()}).catch(function(e){s(e)})})})},p).finally(function(){r&&r.chunkLoaders&&delete r.chunkLoaders[t],s()})});return s.xEngEmbeddedRequest={cancel:function(e){r.chunkLoaders[t].shouldStop=!0}},s},filterAndUpdateColumnsState:function(e,t){if(Array.isArray(e)){var n=this.getAdditionalColumns(t).map(function(e){return e.dataIndex}),i=this.hasConvertissibleColumns();return e=e.filter(function(e){if(i&&!e.isAttributeConvertionStarted())return!0;for(var t=0;t<n.length;t++){const i=n[t];if(e.attributeRemoteLoadingNotStart(i))return!0}return!e.isRealAttributesConverted()}),this.withTransactionUpdate(function(){e.forEach(function(e){var t={};n.forEach(function(n){e.attributeRemoteLoadingNotStart(n)&&(t[n]="#loading#")}),i&&!e.isAttributeConvertionStarted()&&e.setAttributeConvertionStarted(!0),e.updateOptions({grid:t})})}),e}},loadAChunk:function(t,r){var s=this;return o.wrappedWithCancellablePromise(function(a,l){if(0===(t=s.filterAndUpdateColumnsState(t,r)).length)return a();var c=s.getColumnsProvidersDefinitionByPolicy(r).map(function(n){var i={},r=n.instance;return t.forEach(function(e){e.isGroupingNode||(!n.isTargetingOnlyInstance||e.getViewType&&"reference"!==e.getViewType())&&function(e,t,n){for(var i=n.getManagedColumnNames(),r={},o=0;o<i.length;o++){var a=i[o],l=e.isAttributePending(a)?void 0:e.options.grid[a];r[a]=l}if(!0===n.toBeUpdated(r)){void 0===t[n.getName()]&&(t[n.getName()]={pids:[],relids:[],occpaths:[]});var c=e.getID();if(-1===t[n.getName()].pids.indexOf(c)&&(e.getUsages&&Array.isArray(e.getUsages())&&e.getUsages().length>=1?e.getUsages().forEach(e=>{let i=e.getID(),r=n.getName();-1===t[r].pids.indexOf(i)&&t[r].pids.push(i)}):t[n.getName()].pids.push(c)),e.getRelationID&&"function"==typeof e.getRelationID?t=s.getAdditionalColumnsInfo(e,t,n):e.getUsages&&Array.isArray(e.getUsages())&&e.getUsages().length>=1&&e.getUsages().forEach(e=>{t=s.getAdditionalColumnsInfo(e,t,n)}),e.getOccurrencePath&&"function"==typeof e.getOccurrencePath){var d=e.getOccurrencePath();d&&t[n.getName()].occpaths.push(d)}}}(e,i,r)}),o.wrappedWithPromise(function(n,o){var a=setTimeout(function(){var e=r.getManagedColumnNames();s&&s.withTransactionUpdate(function(){t.forEach(function(t){var n={};e.forEach(function(e){(t.isAttributePending(e)||void 0===t.getAttributeValue(e))&&(n[e]="#failed#")}),t.updateOptions({grid:n})})}),console.warn("timeout reached"),o("timeout")},6e4);r.updateAttributes(i[r.getName()],function(i){var o=e.is(i,"string")?JSON.parse(i):i;s.core.sessionManager.shouldShowFinalItems()&&"CfgEffectivityColumns"===r.getName()&&(o=s.updateFlattenedViewEffectivityOptions(o,t)),s._applyAttributesInListContent(o,t),n(o),clearTimeout(a)})})});c.push(o.wrappedWithPromise(function(e,i){var r=[],o=t.filter(function(e){return!e.isRealAttributesConverted()||e.hasQuantity()});o.forEach(function(e){if(s.getConvertissibleAttributes().forEach(function(t){var n={};let i=t.ds6wFrom&&"rel"===t.ds6wFrom?t.dataIndex:t.ds6w;n.value=e.getAttributeValue(i),n.dimension=t.attrDim,n.toUnit=t.attrUnit,n.sixw=i,n.pid=e.getID(),r.push(n)}),e.isRawMaterialType()||s.getAttributesToConvert(e,r),s.core.sessionManager.shouldShowQuantityView())if(e.isRawMaterialType()){let t=[];e&&e.options.grid.quantity&&e.options.grid.quantity.forEach(function(e){s.getAttributesToConvert(e,t)});let n=t.reduce((e,t)=>e+parseFloat(t.value),0),i={...t[0],value:n.toString()};r.push(i)}else e&&e.options.grid.quantity&&e.options.grid.quantity.forEach(function(e){s.getAttributesToConvert(e,r)})}),n.updateAttributes(r,function(n){o.forEach(function(e){e.setRealAttributesConvertState(!0)}),s._applyAttributesInListContent(n,t),e()})})),i.fetch_doc_expand_v2&&c.push(o.wrappedWithPromise(function(e,n){const r=t.filter(e=>e.isDocument(i.SPECIFICATION_DOCUMENT));if(r.length){const t=r.map(e=>e.getID());s.core.dataService.fetchDocumentsData(t).then(t=>{const{data:n}=t;Array.isArray(n)&&n.length||e();const i=n.map(e=>{const t=e.relateddata&&e.relateddata.files?e.relateddata.files[0]:null,n=t&&t.dataelements.locker&&t.dataelements.locker.length>1?t.dataelements.locker:null,i=e.relateddata.files,r=!!t&&e.relateddata.files.length>1,o=e.dataelements.image.endsWith(".gif")?WebappsUtils.getWebappsAssetUrl("ENOXEngineer","img/document.png"):e.dataelements.image,s=n&&n.length>0;return{referenceId:e.id,options:{locker:n,files:i,isMultiFile:r,thumbnail:o,checkedOut:s}}});s.changeSetMerger(i,r),e()})}else e()})),o.allSettled(c).then(function(e){Array.isArray(e)&&e.length,a()})})},getAdditionalColumnsInfo:function(e,t,n){if(e.isDocument())return t;var i=e.getRelationID();if(i&&(-1===t[n.getName()].relids.indexOf(i)&&t[n.getName()].relids.push(i),e.getFirstLevelInstanceID&&"function"==typeof e.getFirstLevelInstanceID&&"CfgEffectivityColumns"===n.getName())){var r=e.getFirstLevelInstanceID();r&&t[n.getName()].relids.push(r),this._effInstanceIDs.push(i)}return t},getAttributesToConvert:function(e,t){let n={};e.hasQuantity()&&(e.hasMassQuantity()?(n.value=e.options.grid[i.CONT_QUANTITY_MASS],n.dimension=i.DIMENSION_MASS,n.toUnit=widget.getValue(i.PREFERRED_MASS_UNIT),n.sixw=i.CONT_QUANTITY_MASS,n.pid=e.getID(),t.push(n)):e.hasVolumeQuantity()&&(n.value=e.options.grid[i.CONT_QUANTITY_VOLUME]||e.options.grid[i.DECLARED_VOLUME],n.dimension=i.DIMENSION_VOLUME,n.toUnit=widget.getValue(i.PREFERRED_VOLUME_UNIT),n.sixw=i.CONT_QUANTITY_VOLUME,n.pid=e.getID(),t.push(n))),e.isRawMaterialType()&&(e.hasRawMatVolumeQuantity()?(n.value=e.options.grid[i.CONT_RAWMAT_QUANTITY_VOLUME],n.dimension=i.DIMENSION_VOLUME,n.toUnit=widget.getValue(i.PREFERRED_VOLUME_UNIT),n.sixw=i.CONT_RAWMAT_QUANTITY_VOLUME,n.pid=e.getID(),t.push(n)):e.hasRawMatMassQuantity()?(n.value=e.options.grid[i.CONT_RAWMAT_QUANTITY_MASS],n.dimension=i.DIMENSION_MASS,n.toUnit=widget.getValue(i.PREFERRED_MASS_UNIT),n.sixw=i.CONT_RAWMAT_QUANTITY_MASS,n.pid=e.getID(),t.push(n)):e.hasRawMatAreaQuantity()?(n.value=e.options.grid[i.CONT_RAWMAT_QUANTITY_AREA],n.dimension=i.DIMENSION_AREA,n.toUnit=widget.getValue(i.PREFERRED_AREA_UNIT),n.sixw=i.CONT_RAWMAT_QUANTITY_AREA,n.pid=e.getID(),t.push(n)):e.hasRawMatLengthQuantity()&&(n.value=e.options.grid[i.CONT_RAWMAT_QUANTITY_LENGTH],n.dimension=i.DIMENSION_LENGTH,n.toUnit=widget.getValue(i.PREFERRED_LENGTH_UNIT),n.sixw=i.CONT_RAWMAT_QUANTITY_LENGTH,n.pid=e.getID(),t.push(n)))},applyUpdatedEffectivities:function(e){var t=this,n={relids:{}};if("SUCCESS"===e.GlobalStatus&&e.results){var i=e.results;Object.getOwnPropertyNames(i).forEach(function(e){var r=i[e];if("SUCCESS"===r.status&&r.existing.content){var o=r.existing.content;o&&o.Evolution?n.relids[r.existing.pid]={Effectivity:t.core.i18nManager.get("Yes"),CurrentEvolutionEffectivity:o.Evolution.Current,ProjectedEvolutionEffectivity:o.Evolution.Projected}:o&&o.Variant&&(n.relids[r.existing.id]={Effectivity:t.core.i18nManager.get("Yes"),VariantEffectivity:o.Variant})}else if("SUCCESS"===r.status)if(r.existing.id)t.getSelectedNodes().length>0&&" "!==t.getSelectedNodes()[0].getInstanceEvolution()&&t.getSelectedNodes()[0].getInstanceEvolution()!==t.core.i18nManager.get("None")?n.relids[r.existing.id]={VariantEffectivity:t.core.i18nManager.get("None")}:n.relids[r.existing.id]={Effectivity:t.core.i18nManager.get("label_no"),VariantEffectivity:t.core.i18nManager.get("None")};else{if(!r.existing.pid)return;t.getSelectedNodes().length>0&&" "!==t.getSelectedNodes()[0].getInstanceVariant()&&t.getSelectedNodes()[0].getInstanceVariant()!==t.core.i18nManager.get("None")?n.relids[r.existing.pid]={CurrentEvolutionEffectivity:t.core.i18nManager.get("None"),ProjectedEvolutionEffectivity:t.core.i18nManager.get("None")}:n.relids[r.existing.pid]={Effectivity:t.core.i18nManager.get("label_no"),CurrentEvolutionEffectivity:t.core.i18nManager.get("None"),ProjectedEvolutionEffectivity:t.core.i18nManager.get("None")}}})}else"ERROR"===e.GlobalStatus&&e.results&&"FAILED"===e.results[0].status&&s.errorAlert(e.results[0].errorDetails);this._applyAttributesInListContent(n)},updateFlattenedViewEffectivityOptions:function(e,t){let n={},i=[];return t.forEach(e=>{if(e.getRelationID&&e.getFirstLevelInstanceID)i.push(e);else{let t=e.getUsages?e.getUsages():[];i.push(...t)}}),i.forEach(t=>{if(t.getRelationID&&t.getFirstLevelInstanceID){let i=t.getRelationID(),r=t.getFirstLevelInstanceID();i&&r&&e.relids[r]&&(n[i]=e.relids[r])}}),e.relids=n,e},_applyAttributesInListContent:function(e,t){if(e){var n=[];if(e.hasOwnProperty("relids")&&e.hasOwnProperty("pids")&&!function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(e.relids)&&delete e.pids,e.hasOwnProperty("relids")){var i=Object.getOwnPropertyNames(e.relids).map(function(t){var n=e.relids[t],i={instanceId:t,options:{grid:{}}};return Object.getOwnPropertyNames(n).forEach(function(e){i.options.grid[e]=n[e]}),i});n=n.concat(i)}if(e.hasOwnProperty("pids")){var r=Object.getOwnPropertyNames(e.pids).map(function(t){var n=e.pids[t],i={referenceId:t,options:{grid:{}}};return Object.getOwnPropertyNames(n).forEach(function(e){i.options.grid[e]=n[e]}),i});n=n.concat(r)}if(e.hasOwnProperty("occpaths")){const t=Object.getOwnPropertyNames(e.occpaths).map(t=>{const n=e.occpaths[t],i={occurrenceId:t.split(a.OccPathSep),options:{grid:{}}};return Object.getOwnPropertyNames(n).forEach(function(e){i.options.grid[e]=n[e]}),i});n=n.concat(t)}this.changeSetMerger(n,t)}},changeSetMerger:function(e,t){if(!Array.isArray(e))return;let n=this;this.prepareUpdate(),e.forEach(function(e){n.updateNodesWithChangeSet(e,t)}),this.pushUpdate()},onLoadGroupBy:function(){const e=this.core.PersistencyManager.getGroupByOption();this.ungroupRoots(),!e||"reference"===e&&this.core.sessionManager.shouldShowQuantityView()||this.groupRoots({propertiesToGroup:[e]})},onSorting:function(e){this.prepareUpdate(),widget.setValue("sorting",e);var t="asc"===(e.sortOrder||"").toLowerCase()?1:-1;this._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(n,i){return t*(n.getSortableAttributeValue(e.sortAttribute)<i.getSortableAttributeValue(e.sortAttribute)?-1:1)}}),this.pushUpdate()},applyDefaultSort:function(){let e=function(e){let t=e.options.grid["ro.plminstance.V_treeorder-Instance"];return!t&&e.getUsages&&e.getUsages()&&e.getUsages().length>0&&(t=e.getUsages()[0].options.grid["ro.plminstance.V_treeorder-Instance"]),t?parseFloat(t):0};this._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(t,n){return e(t)<e(n)?-1:1}})},addFilterModel:function(){let e=this;if(this.core.columnsManager.getVisibleColumns()){var t=this.core.columnsManager.getVisibleColumns();let r=["ds6w:status","ds6wg:PLMReference.V_isLastVersion","ds6w:responsible","ds6w:reserved","ds6w:type","ds6wg:revision","ds6w:cadMaster","ds6w:reservedBy-Instance","ds6w:reservedBy"];var n={};for(let e in t){var i=t[e].dataIndex;this.core.sessionManager.shouldShowQuantityView()&&"rel"==t[e].ds6wFrom||(t[e].provider||"occurence"===i||("tree"==t[e].dataIndex?n.label={filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:""}}}:r.includes(t[e].dataIndex)||"boolean"==t[e].kind?n[i]={filterId:"set"}:"string"!=t[e].kind&&"integer"!=t[e].kind&&"real"!=t[e].kind||(n[i]={filterId:"stringRegexp",filterModel:{condition1:{type:"contains",filter:""}}})))}e.setFilterModel(n)}},removeFilterView:function(){const e=this.core&&this.core.contextManager&&this.core.contextManager._activeGridView&&this.core.contextManager._activeGridView.getFilterViewManager?this.core.contextManager._activeGridView.getFilterViewManager():null,t=e?e.getFilterViews():null;e&&!e.isEmpty()&&(console.debug("DGV: Reset View Filter"),Object.keys(t).forEach(e=>{t[e].filter.filterModel=void 0}))},reApplyUserCurrentViewOptions:function(){try{this.core.PersistencyManager.restoreView(this)}catch(e){console.error("something went wrong when re-applying user view options")}},reApplyGroups:function(){try{this.onLoadGroupBy()}catch(e){console.error("something went wrong when re-applying user view options")}},refreshProvidedColumns:function(e,t){this._effAllLoadJobIds.push(this.fillAttributesAsync4VisibleNodes(e,t,void 0,"visible"))},mainAddContent:function(e,t,n,r,o,s){if(Array.isArray(e)&&0!==e.length){var a=this,l=this.core.contextManager.getActiveEngItem()?this.core.contextManager.getActiveEngItem().getID():null,c=!0;void 0!==n&&n.length>0&&l&&l!==n[0]&&(c=!1);try{if(s&&!a.core.contextManager.isActiveEngItemSelected())a.insertNodesAtRowId(e);else if(t&&t.getID()!==l)t.addChildToTheTargetNode(e);else if(c)a.addRoot(e);else if(o){if(void 0!==r)for(var d=0;d<r.length;d++)if(r[d].isChildComputed())for(var u=0;u<e.length;u++)r[d].addChild(e[u])}else if(void 0!==r)for(d=0;d<r.length;d++)r[d].isChildComputed()&&r[d].addChild(e[d]);a.fetchAdditionalColumns(e).then(()=>{a.reApplyGroups(),a.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)})}catch(e){console.error(e)}}},_contentUpdated:function(e,t,n){if(Array.isArray(e)){var r=this;r.core.mediator.subscribe(i.EVENT_DISABLE_SORT_TO_DEFAULT,function(e){r.applyDefaultSortOnNodes=!e}),r.addFilterModel(),r.fetchAdditionalColumns(e).then(()=>{r.reApplyGroups(),r.applyDefaultSortOnNodes&&r.applyDefaultSort(),r.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)}),r.core.mediator.publish("content-loader-indicator-progress",90/r._contentFetchers.length),e.length>0&&r.core.mediator.publish(i.EVENT_NOTIFY_CONTENT_SIZE_CHANGE)}else console.error("_contentUpdated expect an array as input")},getAppropriateSessionBuilder:function(){if(this.getEngineeringItem().hasValidTransientGroupingContext()){if(i.supportTaggerGroupInViews)return"group";if(!(this.core.sessionManager.shouldShowFinalItems()||this.core.sessionManager.shouldShowMfgView()||this.core.sessionManager.shouldShowLeafMaterials()||this.core.sessionManager.shouldShowFlatView()))return"group";s.warningNotif({title:this.core.i18nManager.get("eng.failed.apply.expand.group.title"),subtitle:this.core.i18nManager.get("eng.failed.apply.expand.group.subtitle")})}return this.getEngineeringItem().hasValidTransientNextGenFilter()||this.getEngineeringItem().hasValidPersistedNextGenFilter()||this.getEngineeringItem().hasPesistencyManagerdNGFilter()?"nextGenFilter":"default"},retrievePreferreedNGFilter:function(e){var t=this;return o.wrappedWithPromise(function(n,i){if(!e)return i(new Error("no filters found in preference"));var r=t.getBIFilter();if(!r)return i(new Error("no BIFilter infra to manage Filters"));r.retrieveFilters({filterObjects:[{envId:t.core.settingManager.getPlatformId(),serviceId:"3DSpace",contextId:"",objectId:e.filterId,objectType:"ENOStrRefinementSpecification",displayName:e.filterName}],droppedEnvId:t.core.settingManager.getPlatformId(),doNotFillTheTagger:!1,callback:function(e){return e&&Array.isArray(e.success)&&e.success.length>0?n(e.success):e&&Array.isArray(e.failure)&&e.failure.length>0?i(e.failure[0].msg):e&&Array.isArray(e.errors)&&e.errors.length>0?i(new Error("unable to retrieve Filters")):void 0}})})},_buildGroupedContent:async function(e){const{groups:t}=e||{};if(Array.isArray(t)){t.length?this.getEngineeringItem().setTransientGroupingContext(t):this.getEngineeringItem().removeTransientGroupingContext(),this._contentFetchers=[],this._contentIsLoading=!1;try{await this.buildUserWorkingSession()}catch(e){console.error(e),xEngAlertManager.errorAlert(app.core.i18nManager.get("eng.failed.to.open.EI"))}this.core.mediator.publish(i.EVENT_STRUCTURE_VIEW_CHANGED)}},_buildFilteredContent:function(e){if(!e||!Array.isArray(e.filterRootIds)||e.filterRootIds.indexOf(this.getEngineeringItem().getID())<0)return null;e.empty&&(e=null,this.getEngineeringItem().detachPersistedFilter()),this.getEngineeringItem().setTransientNGFilteringContext(e),this.getEngineeringItem().attachPreferedConfigModel(null),this.core.mediator.publish(i.EVENT_UPDATE_IDCARD_RENDERING,!1),this._contentFetchers=[],this._contentIsLoading=!1,this.buildUserWorkingSession().then(function(e){console.log(e)}).catch(function(e){console.error(e),xEngAlertManager.errorAlert(app.core.i18nManager.get("eng.failed.to.open.EI"))})},buildUserWorkingSession:function(e){return this.withTransactionUpdate(()=>this.ungroupRoots()),this.stopAllLoadingJobs(),this.empty(),Array.isArray(this._contentFetchers)&&this._contentFetchers.forEach(e=>{e.cancelEmbeddedRequest&&e.cancelEmbeddedRequest()}),this.attributesWithDimensionPartiallyConverted=!1,this.updateBIFilterFromViewOptions(),o.wrappedWithPromise((t,n)=>{this.core.sessionManager.buildAppropriateSession(this,e).then(()=>{Promise.allSettled(this._contentFetchers).then(()=>{this.core.sessionManager.shouldShowFlatView()||this.core.mediator.publish(i.EVENT_REAPPLY_DATAGRID_SORT_MODEL)}),t(!0)}).catch(e=>n(e))})},updateBIFilterFromViewOptions(){if(!i.useBIFilterExpandSynthesis)return;const{contextManager:e,sessionManager:t,mediator:n,PreferencesManager:r}=this.core||{};if(!(t&&n&&e&&r&&e.getXENTreeDocument()&&e.getActiveEngItem()))return;const o=e.getXENTreeDocument().getFilterOptionsFromSessionManager();e.getXENTreeDocument().updateXENBIFilterProxy(o);const s=r.isSpecInProductStructureEnabled(),a=t.shouldShowLeafMaterials();this.getBIFilter().setApplicativeSpec(s,a)},hasBeenHandledByASessionManager:function(){return this.isFilledByASessionManager},fetchHolisticContentDefiniton:function(){if(this.core.logger.info("fetch HolisticContentDefiniton "+Date.now()),!Array.isArray(this._contentFetchers))throw new Error("invalid _contentFetchers ");o.allSettled(this._contentFetchers).then(e=>{this._contentFetchers=[],this._contentIsLoading=!1,this.reApplyUserCurrentViewOptions(),this.isFilledByASessionManager=!0,this.core.mediator.publish("content-loader-indicator-completed"),this.pushToTagger(),this.core.logger.info("all HolisticContentDefiniton is loaded "+Date.now())})},registerContentFetcher:function(e,t,n,o){if(!e||!t)throw new Error("invalid input of registerContentFetcher");var a=this;return a._contentFetchers.push(e),1===a._contentFetchers.length&&(a._contentIsLoading=!0,a.core.mediator.publish("content-loader-indicator-start")),e.then(function(e){a.core.logger.info(t+" content fetched successfully "),a._contentUpdated(e,n,o?o[i.CONST_TARGET_LEVEL]:void 0)}).catch(function(e){console.error(e),a.core.mediator.publish("content-loader-indicator-progress",90/a._contentFetchers.length),a.core.logger.error(e),a.core.logger.error(t),r.isServiceTimedOut(e)?s.warningAlert(a.core.i18nManager.get("switch_index_mode_on_large_data")):s.errorAlert(a.core.i18nManager.replace(a.core.i18nManager.get("error.operation.failed"),{operation:"content loading issue",error:JSON.stringify(e)}))}),a},insertNodesAtRowId:function(e){var t=this;let n=t.mapSelectedItemsByOccurencePath();e.forEach(e=>{let i=n[e.getOccurrencePath().join("/")];if(i.getOccurrencePath().join("/")===e.getOccurrencePath().join("/")){let n=i.getParent(),r=n._getRowID(),o=i._getRowID();if(t.core.sessionManager.shouldShowQuantityView()&&e.setUsages(i.getUsages()),i.remove(),r>=0&&null!=r){let t=o-r;n.addChild(e,t)}else t.addRoot(e,o)}})},mapSelectedItemsByOccurencePath:function(){let e={};return this.core.contextManager.getXENTreeDocument().getSelectedNodes().forEach(t=>{e[t.getOccurrencePath().join("/")]=t}),e},fetchAdditionalColumns:function(e){let t=this;return o.wrappedWithPromise((n,r)=>{if(e||n(),e.length<=t.core.settingManager.getSetting("limitSizeForFullNodesConversion")){const i=t.asyncRetrieveMissingAttributes(e),r=t.getJobInfos(i);t._wholeContentLoaderJobIds.push(i),r&&r.promise&&t._wholeContentLoaderJobPromises.push(r.promise),Promise.all(t._wholeContentLoaderJobPromises).then(()=>{t._wholeContentLoaderJobPromises=[],n()})}else{t.attributesWithDimensionPartiallyConverted=!0,t.core.columnsManager.getVisibleColumns().find(e=>"real"===e.kind)&&t.core.mediator.publish(i.EVENT_COLUMNS_CHANGED,{updateExitingColumns:!0}),n()}})},areAttributesWithDimensionPartiallyConverted(){return this.attributesWithDimensionPartiallyConverted},addEngItemDocuments:function(e){let t=this;const n=t.getEngineeringItem().getID();return o.wrappedWithCancellablePromise(function(i,r){t.core.dataService.getEngItemRelatedDocuments(n,e).then(e=>{t.withTransactionUpdate(function(){e.forEach(function(e){e.options.grid.level=1}),t.addRoot(e)}),i(e)}).catch(e=>r(e))})},addChildDocuments:function(e,t){let n=this;const i=Array.isArray(e)?e[0].getID():e.getID(),r=Array.isArray(e)?e[0]:e;return o.wrappedWithCancellablePromise(function(e,o){n.core.dataService.getEngItemRelatedDocuments(i,t).then(t=>{n.withTransactionUpdate(function(){t.forEach(e=>{r.addChild(e)})}),e(t)}).catch(e=>o(e))})},buildFindInContextQuery:function(e){let t,n=e&&e.searchFts?"*"+e.searchFts+"*":null,i=e&&e.selectedPredicates&&Array.isArray(e.selectedPredicates)?e.selectedPredicates:["ds6w:label"];if(Array.isArray(i)&&n){let e=null;i.forEach(function(t){if("physicalid"===t)return;let i="["+t+"]:"+n;e=e?e+" OR "+i:i}),t={"q.query":e}}return t?[t]:[{"q.query":"[ds6w:label]:* *"}]},buildpayloadForFindIncontext:function(e,t){let n={};n.select_bo=this.core.dicoService.getTagsForBOWithMandatories(),n.select_rel=this.core.dicoService.getTagsForRelWithMandatories(),n.compute_select_bo=this.core.settingManager.getSetting("compute_select_bo"),n.max_output_paths="300",n.fcs_url_mode="REDIRECT",n.specVersion="420.6.1",n.union={};const i={};return i.root_path_physicalid=e,i.expand_iter="-1",i.no_type_filter_rel=["XCADBaseDependency"],i.type_filter_rel=["PLMInstance"],i["q.iterative_filter_query_bo"]='[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',i.find_in_context=this.buildFindInContextQuery(t),n.union.expand=[i],n},expandGroupedEngItemChildren:function(e,t){if(!Array.isArray(e))throw new Error("invalid input parameters");const n=this.core.contextManager.getActiveEngItem().getID();if(!n)throw new Error("abnormal situation");let r=!1;const s=[[n]];let a=t?t[i.CONST_TARGET_LEVEL]:void 0,l=a||"1";const c=this.core.sessionManager.shouldShowFinalItems(),u=this.core.sessionManager.shouldShowMfgView(),p=this.core.sessionManager.shouldShowLeafMaterials(),g=this.core.sessionManager.shouldShowFlatView(),h={level:l=c||u||p||g?"-1":l,paths:s},m={parentPaths:s};return this.options.expandPromise=o.wrappedWithCancellablePromise((t,o)=>{e.forEach(e=>{if(!e.isGroupingNode)return;const{groups:s,group:a}=e.options;if(!a||!s)return void console.error("abnormal situation");s.getChildren(a).forEach(t=>e.addChild(new d({label:t.getLabel(),groups:s,group:t,icons:[{iconName:"group"}],useAsyncPreExpand:!0,children:[],padgrid:{"ds6w:globalType":"groupNodeFromTagger"},appCore:this.core})));const c=this._FilterBI.getExpandSpec(n,a.getGroupIntentForExpand(),"group");c.outputs={select_object:this.core.dicoService.getTagsForBOWithMandatories(),select_relation:this.core.dicoService.getTagsForRelWithMandatories(),hits:{predefined_computation:["icons","urlstream|thumbnail_2d|2dthb"]},format:"entity_relation_occurrence"},this.core.dataService.doExpand(c,{executor:i.COMMAND_WS_EXPAND_CV_V2,payloadAlreadyConverted:!0}).then(o=>{if(r)return t([]);this.core.Factories.ListItemFactory.buildNodesFromExpandResult(o,h,m).then(r=>{const o=r[n];i.supportTaggerGroupInViews?"1"!==l&&o.length?this.addChildren(o,l).then(t=>{Array.isArray(t)&&t.length?(g&&o.forEach(t=>e.addChild(t)),t.forEach(t=>e.addChild(t))):o.forEach(t=>e.addChild(t))}):o.forEach(t=>e.addChild(t)):o.forEach(t=>e.addChild(t)),t(o)})}).catch(function(e){console.error(e),o(e)})})}),this.options.expandPromise.cancelEmbeddedRequest=(()=>r=!0),this.options.expandPromise},addGroupedEngItemChildren:function(e){let t=!1;const n=this.getEngineeringItem().getID(),r=this.getEngineeringItem().getTransientGroupingContext(),s=this.getBIFilter().getGroupingSpec([[n]],r,"group");return this.options.expandPromise=o.wrappedWithCancellablePromise((e,o)=>{this.core.dataService.doExpand(s,{executor:i.COMMAND_WS_EXPAND_CV_V2,payloadAlreadyConverted:!0}).then(i=>{if(t)return e([]);const s={groupingIntent:r};this.core.Factories.ListItemFactory.buildGroupNodesFromExpandResult(i,s).then(t=>{Array.isArray(t)&&t.length||e([]);const i={};i[n]=t;const r=this.addNewNodes(null,i);e(r)}).catch(t=>{console.debug(t);const{message:n}=t||{};"no group found"===n&&e([]),o(t)})}).catch(function(e){console.error(e),o(e)})}),this.options.expandPromise.cancelEmbeddedRequest=(()=>t=!0),this.options.expandPromise},addFilteredEngItemChildren:function(e){let t=this,n=e?e[i.CONST_TARGET_LEVEL]:void 0,r=!1;const s=t.getEngineeringItem().getID(),a={nextGenFilterOption:t.getEngineeringItem().getNextGenFilterExpandOptions()};let l=[[s]];const c={level:"-1",paths:l},d={parentPaths:l};return t.options.expandPromise=o.wrappedWithCancellablePromise(function(e,i){t.core.dataService.multiExpandV2(a).then(i=>{if(r)return e([]);t.core.Factories.ListItemFactory.buildNodesFromExpandResult(i,c,d).then(i=>{let r=t.addNewNodes(null,i);n&&t.withTransactionUpdate(()=>{let e=parseInt(n)-1;t.expandVisuNodes(r,e)}),e(r)})}).catch(function(e){console.error(e),i(e)})}),t.options.expandPromise.cancelEmbeddedRequest=function(){r=!0},t.options.expandPromise},addEngItemChildren:function(e){let t=this,n=e?e[i.CONST_TARGET_LEVEL]:void 0,r=!1;const s=t.getEngineeringItem().getID();let a=n||"1";const l=t.core.sessionManager.shouldShowFinalItems(),c=t.core.sessionManager.shouldShowMfgView(),d=t.core.sessionManager.shouldShowLeafMaterials(),u=t.core.sessionManager.shouldShowFlatView();let p=[[s]];const g={level:a=l||c||d||u?"-1":a,paths:p,type_filter_rel:d?["PLMInstance","MustBeMadeFrom"]:["PLMInstance"]},h={parentPaths:p};return t.options.expandPromise=o.wrappedWithCancellablePromise(function(e,i){t.getEngineeringItem().retrieveFilteringBinary().then(o=>{o&&o.FilterCompiledForm&&(g.config_filter=o.FilterCompiledForm),t.core.dataService.expandV2(g).then(i=>{if(r)return e([]);t.core.Factories.ListItemFactory.buildNodesFromExpandResult(i,g,h).then(i=>{let r=t.addNewNodes(null,i);if(n){let e=parseInt(n)-1;t.withTransactionUpdate(()=>{t.expandVisuNodes(r,e)})}e(r)})}).catch(function(e){console.error(e),i(e)})}).catch(function(t){if(r)return e([]);console.error(t),i(t)})}),t.options.expandPromise.cancelEmbeddedRequest=function(){r=!0},t.options.expandPromise},addOrUpdateRoots:function(e){let t=this,n=this.getRoots(),i=[];if(n&&n.length>0){let t=r.createMap(n,e=>e.buildNodeId(),e=>e);e.forEach(e=>{let n=t[e.buildNodeId()];if(n){let t=e.getUsages();n.addUsages(t),n.updateOptions(n.options)}else i.push(e)})}else i=e;i&&t.withTransactionUpdate(()=>{t.addRoot(i)})},addOrUpdateChildrenToNodes:function(e,t,n){let i=r.createMap(e,e=>e.getOccurrencePath().join("/"),e=>e),o=[];return this.withTransactionUpdate(function(){for(let e in i){let s=i[e].getChildren(),a=t[e]?t[e]:void 0,l=[];if(s&&s.length>0){let e=r.createMap(s,e=>e.buildNodeId(),e=>e);a&&a.forEach(t=>{let i=e[t.buildNodeId()];if(i){let e=t.getUsages();n||(i.addUsages(e),i.updateOptions(i.options))}else l.push(t)})}else l=a;l&&(i[e].addChild(l),i[e].options.childComputed=!n,o=[...o,...l])}}),o},addChildren:function(e,t="1"){let n=this,i=!1;const r=n.core.sessionManager.shouldShowFinalItems(),s=n.core.sessionManager.shouldShowMfgView(),a=n.core.sessionManager.shouldShowLeafMaterials();let l=r||s||a?"-1":t,c=e.map(e=>e.getOccurrencePath());const d={level:l,paths:c,type_filter_rel:a?["PLMInstance","MustBeMadeFrom"]:["PLMInstance"]},u={parentPaths:c};return n.options.expandPromise=o.wrappedWithCancellablePromise(function(r,o){n.core.contextManager.getActiveEngItem().retrieveFilteringBinary().then(s=>{s&&s.FilterCompiledForm&&(d.config_filter=s.FilterCompiledForm),n.core.dataService.expandV2(d).then(o=>{if(i)return r([]);n.core.Factories.ListItemFactory.buildNodesFromExpandResult(o,d,u).then(i=>{let o=n.addNewNodes(e,i);n.expandVisuNodes(e,parseInt(t)),r(o)})}).catch(function(e){if(i)return r([]);console.error(e),o(e)})}).catch(function(e){if(i)return r([]);console.error(e),o(e)})}),n.options.expandPromise.cancelEmbeddedRequest=function(){i=!0},n.options.expandPromise},addFindEngItemChildren:function(e,t){let n=this,r=!1,a=[],l=[],c=t?t[i.CONST_TARGET_LEVEL]:void 0,d=t[i.CONST_FIND_IN_CRITERIA];if(e=d.selectedNodes,!Array.isArray(e))throw new Error("EngItemContentTreeDocument require two valid parameters");e.forEach(function(e){a.push(e.getOccurrencePath())});const u={level:"-1",paths:a,partiallyExpanded:!0};n.removeFilterView();let p=n.core.contextManager&&n.core.contextManager._activeGridView&&n.core.contextManager._activeGridView.model?n.core.contextManager._activeGridView.model:e,g=[];Array.isArray(p)&&p.forEach(function(e){(e.isEngineeringItem()||e.isDrawing())&&(Array.isArray(e.getUsages())&&e.getUsages().length>0&&e.getUsages().forEach(function(e){l.push(e.getOccurrencePath())}),g.push(e),l.push(e.getOccurrencePath()))});const h={parentPaths:l};let m=n.buildpayloadForFindIncontext(a,d);return n.options.expandPromise=o.wrappedWithCancellablePromise(function(t,o){n.core.sessionManager.shouldShowFlatView()||n.core.contextManager.getActiveEngItem().hasValidTransientNextGenFilter()||n.core.contextManager.getActiveEngItem().hasValidPersistedNextGenFilter()?(n.core.mediator.publish(i.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,!0),n.expandVisuNodes(e,parseInt(c),!0),t(n.getAllDescendants())):n.core.dataService.multiExpandForFindInContext(m,u).then(o=>o.results&&Array.isArray(o.results)&&0==o.results.length?(s.notifyAlert(n.core.i18nManager.get("eng.findCmd.find.noResultsFound")),n.core.mediator.publish(i.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,!1),n.core.mediator.publish(i.EVENT_DISABLE_SORT_TO_DEFAULT,!0),t([])):r?t([]):void n.core.Factories.ListItemFactory.buildNodesFromExpandResult(o,u,h).then(r=>{n.addNewNodes(g,r,!0);n.expandVisuNodes(e,parseInt(c),!0),n.core.mediator.publish(i.EVENT_FIND_IN_CONTEXT_VIEW_BUILT,!0),n.core.mediator.publish(i.EVENT_DISABLE_SORT_TO_DEFAULT,!0),t(e)})).catch(function(e){console.error(e),o(e)})}),n.options.expandPromise.cancelEmbeddedRequest=function(){r=!0},n.options.expandPromise},expandVisuNodes(e,t,n){let r=this,o=n?i.CONST_PARTIALLY_EXPANDED:"expanded";e&&Array.isArray(e)&&0!==e.length&&e.forEach(e=>{0!==t&&e.isEngineeringItem()&&(e.setState({state:o}),r.expandVisuNodes(e.getChildren(),t-1,n))})},addNewInstances(e){let t=this.getEngineeringItem().getID(),n=!1,i=e.map(e=>e.parent),r=[...new Set(i)],s=this.findNodesByIds(r).filter(e=>e.isChildComputed()),a=s.reduce((e,t)=>{let n=t.getID();return e[n]||(e[n]=[]),e[n].push(t.getOccurrencePath()),e},{}),l=[],c=[];e.forEach(e=>{let i=[[t]];if(e.parent!==t&&(i=a[e.parent]),i){let t=i.map(t=>[...t,e.instance,e.child]);l.push(...t),c.push(...i)}e.split&&(n=!0)});const d={level:"0",paths:l};let u=o.wrappedWithCancellablePromise((e,t)=>{this.core.dataService.expandV2(d).then(t=>{const i={parentPaths:c};this.core.Factories.ListItemFactory.buildNodesFromExpandResult(t,d,i).then(t=>{let i=this.addNewNodes(s,t);n&&i.forEach(function(e){e.select()}),e(i)})})});this.registerContentFetcher(u,"addNewInstances",null,null),this.fetchHolisticContentDefiniton()},addNewNodes(e,t,n){let i;if(e&&e.length>0)i=this.addOrUpdateChildrenToNodes(e,t,n);else{i=t[this.getEngineeringItem().getID()],this.addOrUpdateRoots(i)}return i}})}),define("DS/ENOXEngineer/services/XENCollectionsFactory",["UWA/Core","UWA/Class","DS/ENOXEngineer/collections/XEngGridTreeDocument","DS/ENOXEngineer/collections/EngItemContentTreeDocument","DS/ENOXEngineer/collections/XENContentProxyTreeDocument"],function(e,t,n,i,r){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e,this.app.core.Factories||(this.app.core.Factories={}),this.app.core.logger.info("initializing XENCollectionsFactory ..."),this.app.core.Factories.CollectionsFactory=this,this.i18nManager=this.app.core.i18nManager},isInstanceContentModels:function(e){return e instanceof i},getEngItemContentModels:function(e,t){if(!this.app.core.Factories.ListItemFactory.isInstanceOfEngItem(e))throw console.warn(" getEngItemContentModels function expect a valid engineering item parameter"),new Error(" getEngItemContentModels function expect a valid engineering item parameter");var n=t||{};return n.core=this.app.core,n.enableNGFilter=!0,new i(e,n)},getXENProxyContentTreeDocument:function(){var e={core:this.app.core};return new r(e)}})}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityEditComponent",["DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityNodeUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/EngineeringSettings","DS/Tweakers/GeneratedToolbar","DS/ENOXEngineer/services/I18nManager","i18n!DS/ENOXEngineer/assets/nls/xEngineer.json"],(e,t,n,i,r,o,s)=>{const a=`${o.get("editQuantities")}:`,l=`${o.get("totalQuantities")}:`,c=n.CHANGEQUANTITY_CHUNK_COUNT,d=n.RUN_BACKGROUND_JOB_COUNT;return new class extends e{init(e){super.init(),this.viewContext=e,this.numberInputTweaker=null,this.rollUpInputTweaker=null,this.quantityChangeTweaker=null,this.buildTweakerTypes()}buildTweakerTypes(){const{toolbar:e}=this.viewContext||{};e&&(e.typeRepresentationFactory.getRegisteredTypeRepresentation("removeBoolean")||e.typeRepresentationFactory.registerTypeRepresentations({removeBoolean:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:"remove"},{value:"false",icon:"undo"},{value:"undefined",icon:""}]}}}))}activate(e){super.activate();const{gridView:t,toolbar:n,model:i}=e;this.quantityChangeTweaker=n.getNodeModelByID("quantityChangeItem"),n.prepareUpdateView(),i.isAddRemoveNodeAuthorized?n.items.addRoot(this.numberInputTweaker,0):n.items.addRoot(this.rollUpInputTweaker,0),n.pushUpdateView();const{columns:r}=t,a=[...r];t.prepareUpdateView(),i.isAddRemoveNodeAuthorized&&a.push({text:o.get("eng.ui.dialog.changeQuantity.headerAction"),editableFlag:!0,editionPolicy:"EditionOnOver",dataIndex:"changeQuantityStatus",typeRepresentation:"removeBoolean",className:"custom-boolean-action-change-quantity",pinned:"left",width:75,setCellValue:(e,t)=>{t?i.addNode(e.nodeModel):i.removeNode(e.nodeModel)}}),a.push({text:o.get("eng.ui.dialog.changeQuantity.headerStatus"),dataIndex:"status",pinned:"left",width:100,getCellValue:e=>{if(!e||!e.nodeModel)return"";const{status:t}=e.nodeModel.options.grid;return"Kept"!==t?s.get(`eng.ui.dialog.changeQuantity.status${t}`):""}}),t.columns=a,t.pushUpdateView()}deactivate(e){super.deactivate();const{gridView:t,toolbar:n,model:i}=e;n.prepareUpdateView(),i.isAddRemoveNodeAuthorized?n.items.removeRoot(this.numberInputTweaker):n.items.removeRoot(this.rollUpInputTweaker),n.pushUpdateView();const{columns:r}=t,o=r.filter(e=>"changeQuantityStatus"!==e.dataIndex&&"status"!==e.dataIndex);t.prepareUpdateView(),t.columns=o,t.pushUpdateView()}update(e){const{createAsBulk:n}=e||{};if("number"==typeof n&&n>0)return void this.updateModificationStatusLabel(n,!0);const{model:i}=this.viewContext,r=i.nodes.filter(e=>t.isNodeKeptStatus(e));if(this.newQuantity=i.getRollup(r),this.updateQuantityInputData(this.newQuantity),this.udpateQuantityRollupLabel(this.newQuantity),this.quantityChangeTweaker){const e="number"==typeof this.newQuantity&&"number"==typeof this.initialQuantity?this.newQuantity-this.initialQuantity:0;this.updateModificationStatusLabel(e)}}udpateQuantityRollupLabel(e){this.rollUpInputTweaker.setAttribute("data",e)}updateQuantityInputData(e){this.numberInputTweaker.setAttribute("data",e)}get min(){return this.initialQuantity-c<0?0:this.initialQuantity-c}get max(){return this.initialQuantity+c}buildUIComponent(e){const{model:t}=e;this.initialQuantity=t.getRollup(t.nodes),this.newQuantity=this.initialQuantity;const n={entries:[{id:"numberInputItem",dataElements:{typeRepresentation:"integer",value:this.initialQuantity,minValue:0,stepValue:1,position:"near",category:1,label:a,displayLabel:!0},onNodeUpdate:this.onElementSpinBoxEdit.bind(this)},{id:"rollUpItem",dataElements:{value:this.initialQuantity,typeRepresentation:"string",position:"near",label:l,category:1,displayLabel:!0,readOnly:!0}}]},i=r.prototype.createTreeDocument(n);[this.numberInputTweaker,this.rollUpInputTweaker]=i.getChildren(),this.udpateQuantityRollupLabel(this.initialQuantity)}onElementSpinBoxEdit(e){const t=e.getAttributeValue("data");this.addOrRemoveNodes(t)}addOrRemoveNodes(e){const{model:n}=this.viewContext,i=e-n.nodes.filter(e=>t.isNodeKeptStatus(e)).length;if(i){const e=i>0?n.addNode.bind(n):n.removeLastNode.bind(n),t=Math.abs(i);if(i>d)n.addNodeAsBulk(t);else for(let n=0;n<t;n+=1)e()}}updateModificationStatusLabel(e,n){let r="";if(e>0)r=this.computeModificationStatusLabelFromNLSKey(e,{max:"eng.ui.dialog.changeQuantity.newAddedItemsLimit",unit:"eng.ui.dialog.changeQuantity.newItemAddedCount",multi:"eng.ui.dialog.changeQuantity.newItemsAddedCount"});else if(e)r=this.computeModificationStatusLabelFromNLSKey(-e,{max:"eng.ui.dialog.changeQuantity.newRemovedItemsLimit",unit:"eng.ui.dialog.changeQuantity.newItemRemovedCount",multi:"eng.ui.dialog.changeQuantity.newItemsRemovedCount"});else{const{model:e}=this.viewContext,n=e.nodes.filter(e=>t.isNodeModified(e)).length;n&&(r=this.computeModificationStatusLabelFromNLSKey(n,{max:"eng.ui.dialog.changeQuantity.newModifiedItemsLimit",unit:"eng.ui.dialog.changeQuantity.newItemModifiedCount",multi:"eng.ui.dialog.changeQuantity.newItemsModifiedCount"}))}(n||e>100||(i.isChangeAuthorized()||i.isWorkingUnderEvolution())&&e>30)&&(r=s.get("eng.ui.dialog.changeQuantity.newAddedItemsLimit").replace("{chunkCount}",e)),this.quantityChangeTweaker.setAttribute("data",r)}computeModificationStatusLabelFromNLSKey(e,{max:t,unit:n,multi:i}){if(!e)return"";let r="";switch(e){case 1:r=n;break;case c:r=t;break;default:r=i}return s.get(r).replace("{chunkCount}",e)}}}),define("DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityView",["UWA/Core","DS/Handlebars/Handlebars4","DS/DataGridView/DataGridView","DS/Tree/TreeDocument","DS/Tweakers/GeneratedToolbar","DS/Tweakers/TypeRepresentationFactory","DS/ENOXEngineer/services/ColumnsMgtService","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityEditComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityModelEffectivityComponent","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewBuilderComponent","text!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/html/ChangeQuantityView.html","css!DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/css/ChangeQuantityView.css"],(e,t,n,i,r,o,s,a,l,c,d,u)=>{return class{constructor(t){const{referenceNode:n,chgQtModel:r}=t||{};this.referenceNode=n||null,this.chgQtModel=r||null,this.treeModel=new i,this.viewToolbar=null,this.viewComponents=[d,l,c],this.container=e.createElement("div",{class:"xapp-change-quantity-tab-container"})}get content(){return this.container}get viewContext(){const e=this.chgQtModel,t=this.viewToolbar,n=this.dataGridView,i=this.treeModel;return{get model(){return e},get toolbar(){return t},get gridView(){return n},get gridModel(){return i}}}buildView(){this.buildUI(),this.buildToolbar(),this.viewComponents.forEach(e=>{e.init(this.viewContext),e.buildUIComponent(this.viewContext)}),d.activate()}buildUI(){var e=this;const n=t.compile(u);this.container.innerHTML=n();const i=this.chgQtModel.getColumns();this.editableColumns=i.filter(e=>Reflect.has(e,"editableFlag")&&e.editableFlag).map(e=>{const t={column:e,editableFlag:e.editableFlag};return Reflect.has(e,"getCellEditableState")&&(t.getCellEditableState=e.getCellEditableState),t});const r=s.getVisibleColumns().filter(t=>{const{dataIndex:n}=t;if("tree"===n||n===a.CONT_QUANTITY_MASS||n===a.CONT_QUANTITY_VOLUME)return!1;const r=e&&e.chgQtModel&&e.chgQtModel.appCore&&e.chgQtModel.appCore.i18nManager&&e.chgQtModel.appCore.i18nManager.get?e.chgQtModel.appCore.i18nManager.get("eng.export.instance.key"):" ";return t.text=t.ds6wFrom&&"rel"===t.ds6wFrom?t.text+` (${r})`:t.text,-1===i.findIndex(e=>e.dataIndex===n)}).map(e=>({...e,visibleFlag:!0,editableFlag:!1}));this.dataGridView=this.instanciateDataGridView({treeDocument:this.treeModel,columns:[...i,...r],defaultColumnDef:{width:"auto",typeRepresentation:"string"},showNodeKPIColorFlag:!0});const o=this.container.getElement(".change-quantity-gridview");this.dataGridView.inject(o)}instanciateDataGridView(e){const t=new n(e);return t.onContextualEvent=(()=>[]),t}activateEditableColumns(){this.editableColumns.forEach(e=>{e.getCellEditableState&&(e.column.getCellEditableState=e.getCellEditableState.bind(e.column)),e.column.editableFlag=e.editableFlag})}deactivateEditableColumns(){this.editableColumns.forEach(e=>{Reflect.has(e.column,"getCellEditableState")&&(e.column.getCellEditableState=(()=>!1)),e.column.editableFlag=!1})}editModeEnable(){l.activate(this.viewContext),this.activateEditableColumns()}editModeDisable(){l.deactivate(this.viewContext),this.deactivateEditableColumns()}browseModelEffectivitiesEnable(){c.activate(this.viewContext)}browseModelEffectivitiesDisable(){c.deactivate(this.viewContext)}update(e){this.viewComponents.forEach(t=>{t.isActivated&&t.update(e)})}generateToolbarModels(e){if(!e)throw new Error("invalid json toolbar input");return r.prototype.createTreeDocument(e)}buildToolbar(){if(!this.dataGridView)return;const e={entries:[{id:"quantityChangeItem",readOnly:!0,dataElements:{value:"",typeRepresentation:"string",position:"far",category:0}}]},t=r.prototype.createTreeDocument(e);this.viewToolbar=new r({overflowManagement:"dropdown",direction:"horizontal",items:t,typeRepresentationFactory:new o}),this.container.getElement(".change-quantity-toolbar").appendChild(this.viewToolbar.getContent())}destroy(){this.viewComponents.forEach(e=>e.destroy()),this.referenceNode=null,this.chgQtModel=null,this.dataGridView=null,this.treeModel=null,this.viewToolbar=null}}}),define("DS/ENOXEngineer/commands/ENOXChangeQuantityCmd",["UWA/Core","DS/StateCommandEngine/StateCommand","DS/Controls/Tab","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/ChangeQuantityView","DS/ENOXEngineer/componentsHelpers/ENOXChangeQuantityView/js/changeQuantityViewModelFactory","DS/Windows/Dialog","DS/Controls/Button","DS/ENOXEngineer/services/XEngineerItemsFactory","DS/ENOXEngineer/services/I18nManager"],(e,t,n,i,r,o,s,a,l)=>{const c=l.get("totalQuantities"),d=l.get("quantitiesByModel"),u=l.get("eng.ui.button.save"),p=l.get("eng.ui.button.cancel"),g=l.get("save"),h=l.get("dontSave"),m=l.get("confirmationTitle"),f=l.get("confirmationMessage"),E={onOKBtn:"onOK",onCancelBtn:"onCancel",onAbortBtn:"onAbort",onEditQtyTab:"onEditQtyTab",onQtyByModelTab:"onQtyByModelTab"};return class extends t{constructor(e){super({mode:"exclusive",...e})}beginExecute(){this.slctdNode=null,this.actEngItem=null,this.fPNode=null,this.modal=null,this.chgQtModel=null,this.chgQtView=null,this.currentChgQtyView=null,this.error=null,this.performChangesAtEnd=!1,this.onRefreshEventFctToBeCalled=null,widget&&widget.addEventOnce("onRefresh",this.onWidgetRefresh.bind(this)),super.beginExecute()}buildGraph(){const e=this.createInitialState("startState"),t=this.createState("initState"),n=this.createState("abortState"),i=this.createState("showDialogState"),r=this.createState("editQtyState"),o=this.createState("qtyByModelState"),s=this.createState("validateChangesState"),a=this.createState("confirmValidateChangesState"),l=this.getFinalState();this.setEnterStateAction(r,this.onEnterEditQuantityState),this.setExitStateAction(r,this.onExitEditQuantityState),this.setEnterStateAction(o,this.onEnterQtyByModelState),this.setExitStateAction(o,this.onExitQtyByModelState),this.addTransition({iInitialState:n,iFinalState:l,iAction:this.abort}),this.addTransition({iInitialState:s,iFinalState:l,iAction:this.close}),this.addTransition({iInitialState:e,iFinalState:t,iAction:this.init}),this.addTransition({iInitialState:t,iFinalState:n,iCondition:this.notCondition(this.isInitPassed)}),this.addTransition({iInitialState:t,iFinalState:i,iAction:this.buildModalView}),this.addTransition({iInitialState:i,iFinalState:r,iAction:this.activateEditQuantityState}),this.addTransition({iInitialState:r,iFinalState:s,iAction:this.onValidate,iEvent:E.onOKBtn,iSender:this}),this.addTransition({iInitialState:r,iFinalState:n,iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:r,iFinalState:o,iEvent:E.onQtyByModelTab,iSender:this}),this.addTransition({iInitialState:o,iFinalState:a,iCondition:this.hasAuthoringModification,iAction:this.onAskForValidate,iEvent:E.onOKBtn,iSender:this}),this.addTransition({iInitialState:o,iFinalState:a,iCondition:this.hasAuthoringModification,iAction:this.onAskForValidate,iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:o,iFinalState:n,iCondition:this.notCondition(this.hasAuthoringModification),iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:o,iFinalState:r,iEvent:E.onEditQtyTab,iSender:this}),this.addTransition({iInitialState:a,iFinalState:o,iEvent:E.onAbortBtn,iSender:this}),this.addTransition({iInitialState:a,iFinalState:n,iEvent:E.onCancelBtn,iSender:this}),this.addTransition({iInitialState:a,iFinalState:s,iAction:this.onValidate,iEvent:E.onOKBtn,iSender:this})}endExecute(){super.endExecute(),this.performChangesAtEnd&&this.executeChanges(),this.slctdNode=null,this.actEngItem=null,this.fPNode=null,this.modal=null,this.chgQtModel=null,this.chgQtView=null,this.currentChgQtyView=null,this.error=null}isInitPassed(){return!e.is(this.error)}hasAuthoringModification(){return!!this.chgQtModel&&this.chgQtModel.hasModifiedNode()}async init(e){try{if(this.actEngItem=this.options.context.getActiveEngItem(),!this.actEngItem)throw new Error("wrong state, expected actEngItem not to be null");const t=this.options.context.getSelectedNodes();if(this.slctdNode=Array.isArray(t)&&t.length?t[0]:null,!this.slctdNode)throw new Error("wrong state, expected slctdNode not to be null");const n=this.slctdNode.getParent();if(this.fPNode=n&&n.getID()?n:this.actEngItem,!this.fPNode)throw new Error("wrong state, expected fPNode not to be null");const i=this.buildAllUsagesOf(this.slctdNode,this.fPNode);if(!Array.isArray(i))throw new Error("wrong state, expected usages not to be null");await this.buildViewModel(i),this.buildView()}catch(e){this.error=e}finally{e&&e()}}abort(e){this.close(e)}close(e){if(this.modal&&this.modal.close(),this.sessionEventToken){const{mediator:e}=this.options.appCore;e&&e.unsubscribe(this.sessionEventToken)}if(this.sessionEventToken=null,this.sessionEventAsBulkToken){const{mediator:e}=this.options.appCore;e&&e.unsubscribe(this.sessionEventAsBulkToken)}this.sessionEventAsBulkToken=null,this.chgQtView&&this.chgQtView.destroy(),this.chgQtView=null,this.modal&&this.modal.destroy(),this.modal=null,e&&e()}async buildViewModel(e){const{appCore:t}=this.options;if(!t||!Array.isArray(e))throw new Error("Invalid input");try{this.chgQtModel=r.create({appCore:t,referenceNode:this.slctdNode,usages:e,context:{parentNode:this.fPNode,parentId:this.fPNode.getID(),activeNode:this.actEngItem,activeId:this.actEngItem.getID()}})}catch(e){throw new Error("failed to instanciate model")}if(!this.chgQtModel)throw new Error("failed to instanciate model");const{mediator:n}=this.options.appCore;if(n){this.sessionEventToken=n.subscribe(this.chgQtModel.updateSessionEvent,this.onSessionModelUpdate.bind(this));const e=`${this.chgQtModel.updateSessionEvent}AsBulk`;this.sessionEventAsBulkToken=n.subscribe(e,this.onSessionModelAsBulkUpdate.bind(this))}let i=null;try{i=await this.chgQtModel.fetchModelAttached()}catch(e){console.error("fails to retreive config information")}return i}buildView(){if(!this.chgQtModel)throw new Error("Invalid input");this.chgQtView=new i({chgQtModel:this.chgQtModel})}instanciateTab(){return new n({displayStyle:"strip"})}buildTabView(){const t=e.createElement("div",{class:"xapp-change-quantity-body-container"});try{this.chgQtView.buildView()}catch(e){throw new Error("should have a view built")}const n=this.chgQtView.content;if(!n)throw new Error("should have a view built");return this.chgQtTab=this.instanciateTab(),this.chgQtTab.inject(t),this.chgQtTab.addEventListener("change",this.onTabChange.bind(this)),this.chgQtTab.add({label:c,content:n}),this.chgQtTab.add({label:d,content:n}),t}onTabChange(e){if(!e.srcElement.hasClassName("wux-controls-tab"))return;const[t]=e.dsModel.value;let n=null;switch(t){case 0:n=E.onEditQtyTab;break;case 1:n=E.onQtyByModelTab}n&&this.publish({event:n})}instanciateDialog(e){return new o(e)}buildModalView(e){const t=this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),n=this.getModalTitle(),i=this.buildTabView();this.modal=this.instanciateDialog({title:n,content:i,immersiveFrame:t,closeButtonFlag:!1,usePaddingFlag:!1,resizableFlag:!1,modalFlag:!0,width:900,buttons:{Ok:new s({label:u,disabled:!0,onClick:this.onOkButton.bind(this)}),Cancel:new s({label:p,onClick:this.onCancelButton.bind(this)})}}),this.modal.show(),e&&e()}buildConfirmationModalView(){const t=this.options.appCore.moduleHelper.viewsService.getApplicationImmersiveFrame(),n=new e.Element("div",{styles:{height:"auto",position:"relative",padding:"5px"},html:`<p>${f}</p>`}),i=new o({title:m,content:n,immersiveFrame:t,closeButtonFlag:!1,modalFlag:!0,buttons:{Yes:new s({label:g,onClick:()=>{i.close(),this.onOkButton()}}),No:new s({label:h,onClick:()=>{i.close(),this.onCancelButton()}}),Cancel:new s({label:p,onClick:()=>{this.removeFromWidgetRefreh("modal"),i.close(),this.onAbortButton()}})}});this.addToWidgetRefresh("modal",i.close.bind(i)),i.show()}onOkButton(){this.publish({event:E.onOKBtn})}onCancelButton(){this.publish({event:E.onCancelBtn})}onAbortButton(){this.publish({event:E.onAbortBtn})}getModalTitle(){if(!this.slctdNode||!this.chgQtModel)throw new Error("Invalid input");const e=this.chgQtModel.getRollup(this.chgQtModel.nodes),t=this.slctdNode.getDisplayName(),n=this.options.appCore.sessionManager.shouldShowLeafMaterials()||this.options.appCore.sessionManager.shouldShowFinalItems()?this.options.appCore.i18nManager.get("occurences"):this.options.appCore.i18nManager.get("instances");return this.options.appCore.i18nManager.get("eng.ui.dialog.changeQuantity").replace("{title}",n).replace("{engItem}",t).replace("{mat}",e)}activateEditQuantityState(e){this.chgQtTab.value=[0],e&&e()}onEnterEditQuantityState(){this.chgQtView.editModeEnable()}onExitEditQuantityState(){this.chgQtView.editModeDisable()}onEnterQtyByModelState(){this.chgQtView.browseModelEffectivitiesEnable()}onExitQtyByModelState(){this.chgQtView.browseModelEffectivitiesDisable()}onAskForValidate(e){this.buildConfirmationModalView(),e&&e()}onValidate(e){this.performChangesAtEnd=!0,e&&e()}executeChanges(){const e=this.chgQtModel.getModificationsResult();e&&this.chgQtModel.executeChangeQuantity(e)}buildAllUsagesOf(e,t){const n=[];return e instanceof a.getListInstanceClass()?this.actEngItem.getContentModels().buildReferenceList(e,t).forEach(e=>{const t={...e.options};t.children&&delete t.children;const{grid:i}=t;t.grid=i?{...i}:{};const r=a.createListNode(t);r.options=t,n.push(r)}):e.isRawMaterialType&&e.isRawMaterialType()?this.getNodesFromQuantity(e.getParentOccurences(),n):this.getNodesFromQuantity(e.options.grid.quantity,n),n}getNodesFromQuantity(e,t){return e&&e.forEach(e=>{if(null==e||null==e)return;const n=a.createListNode(e.options),{options:i}=e;n.options=i?{...i}:{};const{grid:r}=n.options;n.options.grid=r?{...r}:{},t.push(n)}),t}enableModalOKButton(e){this.modal.buttons.Ok.disabled=!e}onSessionModelUpdate(e){this.enableModalOKButton(this.chgQtModel.hasModifiedNode()),this.chgQtView.update(e)}onSessionModelAsBulkUpdate(e){const{createAsBulk:t}=e||{};this.enableModalOKButton("number"==typeof t&&t>0),this.chgQtView.update(e)}onWidgetRefresh(){this.onRefreshEventFctToBeCalled&&Reflect.ownKeys(this.onRefreshEventFctToBeCalled).forEach(e=>this.onRefreshEventFctToBeCalled[e]()),this.onCancelButton()}addToWidgetRefresh(e,t){if("string"==typeof e&&""!==e.trim()&&"function"==typeof t){if(this.onRefreshEventFctToBeCalled){if(-1!==Reflect.ownKeys(this.onRefreshEventFctToBeCalled).findIndex(t=>t===e))return}else this.onRefreshEventFctToBeCalled={};this.onRefreshEventFctToBeCalled[e]=t}}removeFromWidgetRefreh(e){"string"==typeof e&&""!==e.trim()&&this.onRefreshEventFctToBeCalled&&-1!==Reflect.ownKeys(this.onRefreshEventFctToBeCalled).findIndex(t=>t===e)&&delete this.onRefreshEventFctToBeCalled[e]}}}),define("DS/ENOXEngineer/commands/ENOXImportItemUX",["DS/ENOXEngineer/commands/XEngineerCommandBase","DS/Handlebars/Handlebars4","DS/ENOXEngineer/componentsHelpers/commandModal/XEngineerModal","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/UIKIT/Input/Text","DS/Controls/LineEditor","DS/Controls/Button","DS/DataGridView/DataGridView","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/ENOXEngineer/utils/XEngineerConstants","DS/ENOXEngineer/services/EngineeringSettings","DS/ENOXEngineer/services/ImportService","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/TreeModel/DataModelSet","DS/Controls/ComboBox","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Controls/Toggle","text!DS/ENOXEngineer/componentsHelpers/xEngImport/html/ImportEngineeringItems.html","css!DS/ENOXEngineer/componentsHelpers/xEngImport/css/ImportEngineeringItems.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,g,h,m,f,E,C,_,y){"use strict";var M,N,v="div",I=7,A="</br>",b=[".csv",".xls",".xlsx"],S={},T=0;function D(){var e={importfiledownloadtemplate:!0,importfilechooser:!0};this.appCore=N.options.appCore?N.context._app.core:N._ctx._app.core,this.i18nManager=N.options.appCore&&N.options.appCore.i18nManager?N.context._app.core.i18nManager:N._ctx._app.core.i18nManager,this.modalOptions={title:this.i18nManager.get("eng.import.label"),className:"enox-import-dialog",withFooter:!1},this.modal=new n(this.modalOptions),this.modal.injectFooter(this.getFooter());var i=t.compile(y);this._options=e?UWA.clone(e,!1):{},this._container=this.modal.getBody(),this._container.innerHTML=i(this._options),this._container=this._container.querySelector(".enox-import"),this._importFileTemplateDownload=this._container.querySelector(".enox-import-template-download"),this._importFileChooserLabel=this._container.querySelector(".enox-import-file-chooser-label"),this._importFileChooser=this._container.querySelector(".enox-import-file-chooser-browser"),this._importFileManageHeader=this._container.querySelector(".enox-import-file-chooser-manageheader"),this._importFileValidationImageIndicator=this._container.querySelector(".enox-import-file-imageindicator"),this._importFileValidationResultDescriptions=this._container.querySelector(".enox-import-file-validationdescriptions"),this.createImportTemplateDownloadLink(),this.createImportFileChooser(),this.loaderVisualCue="",this.createOnClickEventForImport(),this.createOnClickEventForCancelButton(),this.createOnClickEventForCloseButton(),this.userMappedColumnHeadersColumns={}}function w(){S={}}return D.prototype.getImageSource=function(e){return'<img src="'+d.getWebappsAssetUrl("ENOXEngineer","icons/32/"+e+".png")+'">'},D.prototype.getSucessIcon=function(){return this.getImageSource("I_Right")},D.prototype.getWarningIcon=function(){return this.getImageSource("I_Warning")},D.prototype.getErrorIcon=function(){return this.getImageSource("I_Error")},D.prototype.getDownloadIcon=function(){return this.getImageSource("I_DownloadDocument")},D.prototype.getBlockedIcon=function(){return'<span class="fonticon fonticon-block" title="'+M.i18nManager.get("eng.import.CkeckboxImageTooltip")+'"></span>'},D.prototype.setValidationResults=function(e){this.jsonImportValidationResults=e},D.prototype.getContextPhysicalId=function(){return this.appCore.contextManager.getActiveEngItem()?this.appCore.contextManager.getActiveEngItem().getID():null},D.prototype.isOperationPerformedFromContextItem=function(){return null!=M.getContextPhysicalId()},D.prototype.getIgnoreColumnsArray=function(){return this.splitData(this.getValue("IgnoreColumnList"))},D.prototype.clearTransactionCachedInfo=function(e){this.jsonImportValidationResults=null,M.clearUserMappedColumnCache()},D.prototype.displayValidationResultsOnUX=function(e){e.ColumnHeadersDefined&&"No"===e.ColumnHeadersDefined||this.displayManageHeaderLink(),this.isValidation_Success()?(M.enableImportButton(),this.displayActionSummaryReport()):(M.disableImportButton(),M.isUnMappedColumnExists()||M.isMandatoryColumnMissing()?(this.displayImageIndicator_Error(),UWA.Event.dispatchEvent(this._importFileManageHeader,"click"),this.displayUnMappedUserMessage()):this.displayReportedError())},D.prototype.isMandatoryColumnMissing=function(){return this.containsKey("MandColumnsMissing")},D.prototype.getAllMandatoryColumns=function(){for(var e=this.getValue("MandColumns"),t={},n=0;n<e.length;n++)t[e[n]]=e[n];return e},D.prototype.getMissingMandatoryColumns=function(){if(this.isMandatoryColumnMissing()){for(var e=this.splitData(this.getValue("MandColumnsMissing")),t=this.getAllMandatoryColumns(),n={},i=0;i<e.length;i++)n[e[i]]=t[e[i]];return n}return{}},D.prototype.getMissingMandatoryColumnsDisplayValues=function(){return this.getAllValuesFromJson(this.getMissingMandatoryColumns())},D.prototype.getAllValuesFromJson=function(e){var t=[],n=0;for(var i in e)t[n++]=e[i];return t},D.prototype.getAllKeysFromJson=function(e){var t=[],n=0;for(var i in e)t[n++]=i;return t},D.prototype.splitData=function(e){return e.split(this.getValue("ImportDataSeparator"))},D.prototype.getMappedSpreadsheetColumns=function(){return this.jsonImportValidationResults.MappedSpreadSheetColumns},D.prototype.getUnMappedSpreadsheetColumns=function(){var e=[];return this.containsKey("UnmappedSpreadsheetColumns")&&(e=this.splitData(this.getValue("UnmappedSpreadsheetColumns"))),e},D.prototype.isUnMappedColumnExists=function(){return this.getUnMappedSpreadsheetColumns().length>0},D.prototype.getBasicsList=function(){return this.getValue("ObjectBasics")},D.prototype.getObjectAttributeList=function(){return this.getValue("TypeAttributes")},D.prototype.getRelationShipAttributeList=function(){return this.getValue("RelationshipAttributes")},D.prototype.isValidation_Success=function(){return"Success"==this.getValue("Action")},D.prototype.isValidation_Error=function(){return"Error"==this.getValue("Action")},D.prototype.getContentErrorReports=function(){return this.jsonImportValidationResults.ReportedErrors},D.prototype.isContains=function(e,t){for(var n=!1,i=0;i<e.length;i++)if(e[i]==t){n=!0;break}return n},D.prototype.isRootItemCreate=function(){return parseInt(this.getValue("COUNT_ROOTITEM"))>0},D.prototype.getCount_AddNewInstances=function(){return parseInt(this.getValue("COUNT_ADDNEWINSTANCE"))+parseInt(this.getValue("COUNT_ADDEXISTINGINSTANCE"))},D.prototype.getCount_AddNewReference=function(){return parseInt(this.getValue("COUNT_ADDNEWREFRENCE"))},D.prototype.getCount_AddExistingInstances=function(){return parseInt(this.getValue("COUNT_ADDEXISTINGINSTANCE"))},D.prototype.getCount_Modify=function(){return parseInt(this.getValue("COUNT_MODIFY"))},D.prototype.getCount_Remove=function(){return parseInt(this.getValue("COUNT_REMOVE"))},D.prototype.containsKey=function(e){return this.jsonImportValidationResults.hasOwnProperty(e)},D.prototype.getValue=function(e){return this.containsKey(e)?this.jsonImportValidationResults[e]:""},D.prototype.displayImageIndicator_Error=function(){this.displayImageIndicator(this.getErrorIcon()),this._importFileValidationImageIndicator.removeAttribute("id")},D.prototype.displayImageIndicator_Success=function(){this.displayImageIndicator(this.getSucessIcon()),this._importFileValidationImageIndicator.setAttribute("id","success_image_indicator")},D.prototype.displayImageIndicator=function(e){this._importFileValidationImageIndicator.innerHTML=e},D.prototype.setValidationMessage=function(e){this._importFileValidationResultDescriptions.innerHTML=e},D.prototype.displayReportedError=function(){this.displayImageIndicator_Error();var e=this.getValue("ErrorMessage");""==e?(e='<span class="enox-import-text-underline">'+this.getValue("ErrorCount")+" "+M.i18nManager.get("eng.import.summary.contenterrorexists")+"</span>",this.createOnClickEventForErrorReports()):e='<span class="enox-import-redtext">'+e+"</span>";this.setValidationMessage(e)},D.prototype.displayManageHeaderLink=function(){this._importFileManageHeader.innerHTML='<span class"enox-import-text-underline">'+M.i18nManager.get("eng.import.label.managecolumnnames")+"</span>",this.createOnClickEventForManageHeaderName()},D.prototype.getElementId=function(e){return e.replace(" ","_")+"_ID"},D.prototype.createLoaderVisualCue=function(){return""==M.loaderVisualCue&&(M.loaderVisualCue=UWA.createElement(v),M.loaderVisualCue.className="enox-import-file-loader"),M.loaderVisualCue},D.prototype.showLoaderVisualCue=function(e){var t=M.createLoaderVisualCue();M.clearMessagesDisplayedOnUX(),M._importFileValidationResultDescriptions.innerHTML='<span class="enox-import-blackBoldtext">'+function(e){var t="";"Author"==e?t=M.i18nManager.get("eng.import.VisualCueAuthoringMessage")+"...":"Validate"==e&&(t=M.i18nManager.get("eng.import.VisualCueValidateMessage")+"...");return t}(e)+"</span>",M._importFileValidationImageIndicator.appendChild(t)},D.prototype.clearMessagesDisplayedOnUX=function(){M._importFileValidationImageIndicator.innerHTML="",M._importFileValidationResultDescriptions.innerHTML="",M._importFileManageHeader.innerHTML=""},D.prototype.hideLoaderVisualCue=function(){M._importFileValidationImageIndicator.innerHTML="",M._importFileValidationResultDescriptions.innerHTML=""},D.prototype.getCountMessage=function(e,t){return'<span class="enox-import-greentext">'+(this.getCount_Modify()>0?"&nbsp;":"")+t+" "+e+"</span>"},D.prototype.displayActionSummaryReport=function(){this.displayImageIndicator_Success();var e="";if(this.isRootItemCreate()?e='<span class="enox-import-greentext">'+M.i18nManager.get("eng.import.summary.rootitemcreate")+"</span>":0==this.getCount_AddNewReference()&&0==this.getCount_AddNewInstances()&&0==this.getCount_Modify()?(this.displayImageIndicator(this.getWarningIcon()),e='<span class="enox-import-graytext">&nbsp;'+M.i18nManager.get("eng.import.summary.noItemModification")+"</span>",this.disableImportButton()):e='<span class="enox-import-greentext">&nbsp;'+M.i18nManager.get("eng.import.summary.rootitemupdate")+"</span>",this.getCount_AddNewReference()>0){var t=1==this.getCount_AddNewReference()?"eng.import.summary.addsinglenewitem":"eng.import.summary.addmultiplenewitems";""!=e&&(e+=A),e+=this.getCountMessage(M.i18nManager.get(t),this.getCount_AddNewReference())}if(this.getCount_AddNewInstances()>0){t=1==this.getCount_AddNewInstances()?"eng.import.summary.addsinglenewinstances":"eng.import.summary.addmultiplenewinstances";""!=e&&(e+=A),e+=this.getCountMessage(M.i18nManager.get(t),this.getCount_AddNewInstances())}if(this.getCount_Modify()>0){t=1==this.getCount_Modify()?"eng.import.summary.existingitemmodify":"eng.import.summary.existingitemsmodify";""!=e&&(e+=A),e+=this.getWarningIcon()+' <span class="enox-import-orangetext">'+this.getCount_Modify()+" "+M.i18nManager.get(t)+"</span>"}this.setValidationMessage(e)},D.prototype.getFooter=function(){return"<button type='button' disabled='true' id='import-button' class='btn btn-primary'>"+this.i18nManager.get("eng.ui.button.import")+"</button><button type='button' id='cancel-button' class='btn btn-default'>"+this.i18nManager.get("eng.ui.button.cancel")+"</button>"},D.prototype.downloadTemplateFile=function(){var e="Level,Title,Type,Name,Revision,Description,Enterprise Item Number";e+=",Title (Instance)",this.appCore.exportService.downloadFile("Create from Spreadsheet Template",e,".csv",!1)},D.prototype.mergeExportColumnAndAttributesInfo=function(e){for(var t=this.appCore.dicoService.getAvailableAttributesByType([u.TYPE_VPMREFERENCE]),n=["identifier","type","revision"],i=0;i<t.length;i++){var r=t[i].sixWTag.replace("ds6w:","").replace("ds6wg:","");M.isContains(n,r)||(e[t[i].attrNls]=r)}return e},D.prototype.createOnClickEventForTemplateDownload=function(){var e=this;this._importFileTemplateDownload.onclick=function(){e.downloadTemplateFile()}},D.prototype.createImportTemplateDownloadLink=function(){this._importFileTemplateDownload.innerHTML=this.getDownloadIcon()+"&nbsp;"+this.i18nManager.get("eng.ui.import.downloadtemplate"),this.createOnClickEventForTemplateDownload()},D.prototype.createImportFileChooser=function(){this._importFileChooserLabel.innerHTML=" "+this.i18nManager.get("eng.ui.import.filechooserlabel"),this._importFileChooserElement=new UWA.Controls.Input.File({attributes:{id:"import_CSV_File",title:this.i18nManager.get("eng.import.nofileChosen.tooltip")},events:{onChange:function(){M._importFileValidationImageIndicator.removeAttribute("id","success_image_indicator");var e=M.modal.getContent().getElement(".uwa-file").getChildren()[0].files[0];M.clearUserMappedColumnCache(),null==e?(M.clearMessagesDisplayedOnUX(),M._importFileChooserElement.elements.input.title=M.i18nManager.get("eng.import.nofileChosen.tooltip")):(M._importFileChooserElement.elements.input.title=e.name,M.isSupportedFileFormat(e)?M.doServerCall("Validate"):(M.displayImageIndicator_Error(),M.setValidationMessage('<span class="enox-import-redtext">'+M.i18nManager.get("eng.ui.alert.file.type")+"</span>"),M.clearTransactionCachedInfo(),M._importFileManageHeader.innerHTML="",M.disableImportButton()))}}}).inject(this._importFileChooser)},D.prototype.doServerCall=function(e){var t=M.modal.getContent().getElement(".uwa-file").getChildren()[0].files[0];M.showLoaderVisualCue(e);var n={};n.operation=e,n.ContextEntityPhysicalId=M.getContextPhysicalId();var i=M.getUserIgnoreColumnsFromManageHeaders();n.IgnoreColumnList=i,n.userMappedColumns=M.getUserMappedColumnValuesFromManageHeaders(),g.getResults(t,n).then(function(t){if(M.hideLoaderVisualCue(),t.error)M.clearTransactionCachedInfo(),M.displayUnExpectedErrors(t);else{var n=JSON.parse(t);n.IgnoreColumnList=i,"Validate"==e?("Error"==n.Action&&(M.clearTransactionCachedInfo(),M._importFileValidationResultDescriptions.innerHTML='<span class="enox-import-redtext">'+n.ErrorMessage+"</span>"),M.setValidationResults(n),M.displayValidationResultsOnUX(n)):(M.clearTransactionCachedInfo(),M.refreshOnSuccess(n))}})},D.prototype.displayUnExpectedErrors=function(e){this.displayImageIndicator_Error();let t=e.response;e&&e.type&&e.type===u.ERROR_TYPE_TIMEOUT&&(t=this.appCore.i18nManager.get("eng.generic.timedout.message.operationFailed"));var n='<span class="enox-import-redtext">'+t+"</span>";this.setValidationMessage(n),this.enableCancelButton()},D.prototype.enableManageHeaderOkButton=function(e){document.querySelector("#manageHeaderOkButton").dsModel.disabled=!e},D.prototype.createOnClickEventForManageHeaderName=function(){var e=this;this._importFileManageHeader.onclick=function(){var t=function(){var e=M.getAllMandatoryColumns(),t=UWA.createElement(v);t.className="enox-import-columncontainer";var n=UWA.createElement(v);n.className="enox-import-importColumnContainerForInfo";var i=UWA.createElement(v);i.className="importColumnContainerForErrorMessage";var r=UWA.createElement(v);r.className="importMandColumnMissingContainerForErrorMessage";var o=UWA.createElement(v);o.id="enox-import-columns_container_list",n.innerHTML=M.getManageHeaderNotes()+A,t.appendChild(i),t.appendChild(r),t.appendChild(o);var s=UWA.createElement(v);s.id="columns_with_import_list",s.className="enox-import-columnsHeaderForImport";var a=UWA.createElement(v);a.className="enox-import-column-checkbox",a.innerHTML="",s.appendChild(a);var l=UWA.createElement(v);l.className="enox-import-listitem_header_name",s.appendChild(l);var c=UWA.createElement(v);c.className="enox-import-listitem_custom_name",s.appendChild(c),l.innerHTML="<b>"+M.i18nManager.get("eng.import.manageheader.spreadsheetcolumn")+"</b>",c.innerHTML="<b>"+M.i18nManager.get("eng.import.manageheader.schemaname")+"</b>",o.appendChild(s);var d=UWA.createElement(v);d.className="enox-import-divTagForAllColumns",o.appendChild(d);var u=M.getMappedSpreadsheetColumns(),p=M.getUnMappedSpreadsheetColumns(),g=M.getUserMappedColumnsCBoxFromManageHeaders();for(var h in M.clearUserMappedColumnCache(),w(),u){var m=UWA.createElement(v);m.className="columns",Object.keys(u).length>I?d.style.overflowY="scroll":m.style.borderRight="1px solid #ccc";var E=UWA.createElement(v);E.className="enox-import-columnmapping-checkbox";var C=UWA.createElement(v);C.className="enox-import-listitem_header_name hover_info",C.innerHTML=u[h];var y=UWA.createElement(v);y.className="enox-import-listitem_custom_name display_text enable_textbox";var N={elementsTree:M.populateComboboxContents(),enableSearchFlag:!0,domId:M.getElementId(h)},b=!0;if(g.hasOwnProperty(u[h])){var T=g[u[h]];null!=T.value?N.value=T.value:b=!1}else M.isContains(p,u[h])||M.isContains(M.getIgnoreColumnsArray(),u[h])?b=!1:M.isContains(p,u[h])||(N.value=h);var D=new _({type:"checkbox",checkFlag:b,value:u[h]}),O=new f(N);O.addEventListener("change",function(e){M.validateUserMappedColumns(e)}),O.addEventListener("preDropdown",function(e){M.hideAlreadyMappedValues()}),M.userMappedColumnHeadersColumns[u[h]]=O,M.userMappedColumnHeadersColumns[u[h]+"_CheckBox"]=D,S[u[h]]=O.value,e.hasOwnProperty(h)?(O.disabled=!0,E.innerHTML=M.getBlockedIcon()):D.inject(E),O.inject(y),d.appendChild(m),m.appendChild(E),m.appendChild(C),m.appendChild(y),o.appendChild(d)}return t}(),n=new r;n.inject(M.modal.modal.elements.container),e.manageHeaderDialogbox=new i({title:M.i18nManager.get("eng.import.ManageHeaderDialogboxTitle"),content:t,width:536,height:350,position:{at:"top center",my:"center"},immersiveFrame:n,resizableFlag:!0,buttons:{Cancel:new a({label:e.i18nManager.get("eng.ui.button.cancel"),domId:"manageHeaderCancelButton",onClick:function(e){M.restorePreviousHeaderValuesOnCancel(),M.manageHeaderDialogbox.immersiveFrame.getModel().elements.container.destroy()}}),Ok:new a({label:e.i18nManager.get("eng.ui.button.ok"),domId:"manageHeaderOkButton",onClick:function(e){w(),M.doServerCall("Validate"),M.manageHeaderDialogbox.immersiveFrame.getModel().elements.container.destroy()}})}}),M.manageHeaderDialogbox.addEventListener("close",function(e){M.restorePreviousHeaderValuesOnCancel(),M.manageHeaderDialogbox.immersiveFrame.getModel().elements.container.destroy()}),M.manageHeaderDialogbox.getContent().getElements(".enox-import-columnmapping-checkbox").forEach(function(e){e.addEvent("click",function(t){var n=e.children[0].dsModel.value,i=M.userMappedColumnHeadersColumns[n];e.children[0].dsModel.checkFlag||(i.value=void 0),M.validateUserMappedColumns(null)})}),M.displayUnMappedUserMessage(),M.displayMandColumnsMissingErrorMessageonUX(M.getMissingMandatoryColumnsDisplayValues())}},D.prototype.createOnClickEventForErrorReports=function(){this._importFileValidationResultDescriptions.onclick=function(){M.createDataGridErrorContentReports()}},D.prototype.getContentErrorNotes=function(){return this.i18nManager.get("eng.import.error.ContentErrorNotes")},D.prototype.restorePreviousHeaderValuesOnCancel=function(){var e=S,t=M.getUserMappedColumnsCBoxFromManageHeaders();for(var n in t)n.indexOf("_CheckBox")>-1||(t[n].value=e[n]);w()},D.prototype.createOnClickEventForCancelButton=function(){var e=this;document.getElementById("cancel-button").onclick=function(){M.clearTransactionCachedInfo(),e.modal.destroy()}},D.prototype.createOnClickEventForCloseButton=function(){var e=this,t=document.getElementsByClassName("close fonticon fonticon-cancel");null!=t&&(t[0].onclick=function(){M.clearTransactionCachedInfo(),e.modal.destroy()})},D.prototype.createDataGridErrorContentReports=function(){var e=[{text:M.i18nManager.get("eng.import.contenterrorreport.rownumber"),dataIndex:"RowNumber"},{text:M.i18nManager.get("eng.import.contenterrorreport.errordescription"),dataIndex:"Error Description"},{text:M.i18nManager.get("eng.import.contenterrorreport.columnname"),dataIndex:"Column Name"},{text:M.i18nManager.get("eng.import.contenterrorreport.columnvalue"),dataIndex:"Column Value"}],t=new m,n=new E({dataModelSet:t});n.prepareUpdate();for(var o=M.getContentErrorReports(),s=0,c=o.length;s<c;s++){var d=o[s],u=C.createTreeNodeDataModel(t,{label:d.text,grid:d});n.addChild(u)}n.expandAll(),n.pushUpdate();var p=UWA.createElement(v);p.className="enox-import-dialogboxContent";var g=document.createElement(v);g.className="dialogboxHeaderContent";var h=document.createElement(v);h.className="enox-import-dialogboxBodyContent";new l({treeDocument:n,columns:e,defaultColumnDef:{width:"auto",typeRepresentation:"string"}}).inject(h);var f=new r;f.inject(M.modal.modal.elements.container),g.innerHTML=M.getContentErrorNotes(),p.appendChild(g),p.appendChild(h);var _=new i({title:M.i18nManager.get("eng.import.validateImportTitle"),content:p,immersiveFrame:f,resizableFlag:!0,position:{at:"top center",my:"center"},buttons:{Cancel:new a({label:M.i18nManager.get("eng.ui.button.cancel"),onClick:function(e){_.immersiveFrame.getModel().elements.container.destroy()}})}});_.addEventListener("close",function(e){_.immersiveFrame.getModel().elements.container.destroy()})},D.prototype.enableImportButton=function(){document.getElementById("import-button").disabled=!1},D.prototype.disableImportButton=function(){document.getElementById("import-button").disabled=!0},D.prototype.disableCancelButton=function(){document.getElementById("cancel-button").disabled=!0},D.prototype.enableCancelButton=function(){document.getElementById("cancel-button").disabled=!1},D.prototype.getRootPhysicalId=function(e){return e.ROOT_PHYSICALID},D.prototype.refreshOnSuccess=function(e){M.modal.destroy(),this.appCore.sessionManager.setAuthoringMode("authoring"),M.appCore.mediator.publish(u.EVENT_LAUNCH_COMMAND,{commandId:u.OPEN_ENG_ITEM,context:{item:{objectId:M.getRootPhysicalId(e),objectType:u.TYPE_VPMREFERENCE}}})},D.prototype.createOnClickEventForImport=function(){document.getElementById("import-button").onclick=function(){M.disableImportButton(),M.disableCancelButton(),M.doServerCall("Author")}},D.prototype.getUserMappedColumnValuesFromManageHeaders=function(){var e=M.getUserMappedColumnsCBoxFromManageHeaders(),t={};for(var n in e)if(!(n.indexOf("_CheckBox")>-1)){var i=e[n];null!=i.value&&(t[n]=i.value)}return t},D.prototype.getUserIgnoreColumnsFromManageHeaders=function(){var e=M.getUserMappedColumnsCBoxFromManageHeaders(),t="";for(var n in e){if(!(n.indexOf("_CheckBox")>-1))null==e[n].value&&(t=""==t?n:t+"|@|"+n)}return t},D.prototype.clearUserMappedColumnCache=function(){this.userMappedColumnHeadersColumns={}},D.prototype.getUserMappedColumnsCBoxFromManageHeaders=function(){return this.userMappedColumnHeadersColumns},D.prototype.getUnMappedIgnoredSpreadsheetColumns=function(){var e;return this.containsKey("IgnoreColumnList")&&(1==(e=this.splitData(this.getValue("IgnoreColumnList"))).length&&""==e[0]||null==e[0])&&(e=[]),e},D.prototype.displayUnMappedUserMessage=function(){var e=1==M.getUnMappedSpreadsheetColumns().length?"eng.import.summary.unmappedcolumnexists":"eng.import.summary.unmappedcolumnsexists";if(M.getUnMappedSpreadsheetColumns().length>0||M.getUnMappedIgnoredSpreadsheetColumns().length>0){var t=M.getUnMappedSpreadsheetColumns().length>0?M.getUnMappedSpreadsheetColumns().length:M.getUnMappedIgnoredSpreadsheetColumns().length;document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML="<span>"+M.i18nManager.get(e).replace("{1}","<b>"+t+"</b>")+"</span>"}else document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML="<span>"+M.i18nManager.get("eng.import.summary.allmappedcolumnexists")+"</span>"},D.prototype.displayUnMappedUserMessageOnUserSelection=function(e){document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML=e>0?"<span>"+M.i18nManager.get("eng.import.summary.unmappedcolumnexists").replace("{1}","<b>"+e+"</b>")+"</span>":"<span>"+M.i18nManager.get("eng.import.summary.allmappedcolumnexists")+"</span>"},D.prototype.displayMandColumnsMissingErrorMessageonUX=function(e){if(e.length>0){M.enableManageHeaderOkButton(!1);var t=M.i18nManager.get("eng.import.manageheader.mandcolumnsmissing");t=t.replace("$1",e),document.getElementsByClassName("importMandColumnMissingContainerForErrorMessage")[0].innerHTML='<span class="enox-import-redtext">'+t+"</span>"}else M.enableManageHeaderOkButton(!0),document.getElementsByClassName("importMandColumnMissingContainerForErrorMessage")[0].innerHTML='<span class="enox-import-greentext">'+M.i18nManager.get("eng.import.manageheader.allmandattributesmapped")+"</span>"},D.prototype.clearManageHeaderSameAttributeErrorMessage=function(){document.getElementsByClassName("importColumnContainerForErrorMessage")[0].innerHTML=""},D.prototype.isSupportedFileFormat=function(e){for(var t=!1,n=e.name,i=0;i<b.length;i++)if(n.endsWith(b[i])){t=!0;break}return t},D.prototype.hideAlreadyMappedValues=function(){var e=M.getAllValuesFromJson(M.getUserMappedColumnValuesFromManageHeaders()),t=M.getUserMappedColumnsCBoxFromManageHeaders();for(var n in t)for(var i=t[n],r=i._allDescendants&&i._allDescendants.length?i._allDescendants.length:0,o=0;o<r-1;o++){i._allDescendants[o].getLabel();var s=i._allDescendants[o].options.grid.valueItem;M.isContains(e,s)?i._allDescendants[o].hide():i._allDescendants[o].show()}},D.prototype.validateUserMappedColumns=function(e){var t=M.getUserMappedColumnsCBoxFromManageHeaders();0==T&&M.clearManageHeaderSameAttributeErrorMessage(),T+=1;var n=null==e?"":e.dsModel.domId,i={},r=0,o=!1;for(var s in t)if(!(s.indexOf("_CheckBox")>-1)){var a=t[s],l=t[s+"_CheckBox"];if(null!=a.value){if(i.hasOwnProperty(a.value)){if(!1,o=!0,a.domId==n)a.value=void 0;else i[a.value].value=void 0;break}a.domId==n&&null!=a.value&&(l.checkFlag=!0),i[a.value]=a}else l.checkFlag&&!1,r+=1}M.displayMandColumnsMissingErrorMessageonUX(function(e){var t=M.getAllMandatoryColumns(),n=[],i=0;for(var r in t)e.hasOwnProperty(r)||(n[i++]=t[r]);return n}(i)),o||M.displayUnMappedUserMessageOnUserSelection(r),T=0},D.prototype.getManageHeaderNotes=function(){return M.i18nManager.get("eng.import.alert.manageheadernotes")},D.prototype.populateComboboxContents=function(){var e=new E({shouldBeSelected:function(e){return"section"!==e.options.comboBoxSemantics}});return e.addRoot(M.getObjectAttributes()),e.addRoot(M.getRelAttributes()),e.expandAll(),e},D.prototype.getObjectAttributes=function(){var e={labelItem:this.i18nManager.get("eng.import.objectAttributes"),valueItem:"TypeAttributes"},t=M.getBasicsList(),n=M.getObjectAttributeList();return M.updateListContents(t,n),M.addAttrToRootObject(e,t)},D.prototype.getRelAttributes=function(){var e={labelItem:this.i18nManager.get("eng.import.relationshipAttributes"),valueItem:"RelationshipAttributes"},t=M.getRelationShipAttributeList();return M.addAttrToRootObject(e,t)},D.prototype.updateListContents=function(e,t){for(var n in t)e[n]=t[n]},D.prototype.addAttrToRootObject=function(e,t){var n=new C({label:e.labelItem,value:e.valueItem,comboBoxSemantics:"section"});for(var i in t)n.addChild(new C({label:t[i],grid:{valueItem:i},useMatchingSearchFunction:!0,comboBoxSemantics:"subsection"}));return n},e.extend({init:function(e){e=UWA.extend(e,{isAsynchronous:!1}),this._parent(e)},execute:function(){return this.initializeENOXImportItemUX()},initializeENOXImportItemUX:function(e){return N=this,(M=new D).modal.show(),M}})}),define("DS/ENOXEngineer/services/ImportService",["UWA/Class","UWA/Core","DS/ENOXEngineerCommonUtils/PromiseUtils","DS/ENOXEngineer/utils/XENHttpClient","DS/ENOXEngineer/utils/XEngineerConstants","DS/WAFData/WAFData","DS/ENOXEngineer/commands/ENOXImportItemUX","DS/ENOXEngineer/services/EngineeringSettings"],function(e,t,n,i,r,o,s,a){"use strict";return{getResults:function(e,t){var r=a.getCommand("importService");t.TimeoutConstraintsInMS=r.timeout;var o=new FormData;o.append("file",e),o.append("text",JSON.stringify(t));var s={data:o};return n.wrappedWithCancellablePromise(function(e,t){i.perform(r,s.data).then(function(t){return e(t)}).catch(function(t){return e(t)})})}}});