define("DS/xCityGlobeUtils/xCityGlobeServices",["UWA/Core","UWA/Class/Promise","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration"],function(e,t,n,o){"use strict";var r="X-DS-CSRFTOKEN",i="";function a(){if(!e.is(i,"string")||""===i)throw new Error("Invalid CSRF token");return i}function s(i,s,u){return new t(function(t,l){var d=o.urlGlobe,p={headers:{"Content-Type":"application/json"},type:"json",onComplete:t,onFailure:l};switch(i&&delete i.relatedObjects,s){case"POST":case"PATCH":d+="/authoring/geoitem",p.data=JSON.stringify(i);break;case"DELETE":d+="/authoring/geoitem";break;default:d+="/datasupplier/geoitem",s="GET"}if(p.method=s,e.is(u,"string")?d+="/"+u:"GET"===s&&(d+="/type"),"GET"!==s){var c=a();p.headers[r]=c}var f=o.addTenantId(d);n.authenticatedRequest(f,p)})}return{authenticate:function(){var a;return(a="authoring",e.is(a,"string")&&""!==a?new t(function(e,t){var r=o.urlGlobe+"/"+a+"/login",i=o.addTenantId(r),s={method:"GET",type:"json",onComplete:e,onFailure:function(e,n,o){t(new Error("Unable to login on 3DGlobe"))}};n.authenticatedRequest(i,s)}):t.reject(new Error("Invalid input parameter"))).then(function(e){if(!e)return t.reject(new Error("Unable to authenticate on 3DGlobe service"));var n=e[r];return i=n,t.resolve()})},addToken:function(e){var t=a();return e[r]=t,e},getInformation:function(){return new t(function(e,t){var r=o.urlGlobe+"/datasupplier/information",i=o.addTenantId(r),a={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(i,a)}).then(function(n){return e.is(n,"object")?t.resolve():t.reject(new Error("Unable to retrieve information about 3DGlobe service"))})},search:function(r){return function(e){return new t(function(t,r){var i=o.urlGlobe+"/datasupplier/search",a=o.addTenantId(i),s={method:"POST",headers:{"Content-Type":"application/json"},type:"json",data:JSON.stringify(e),onComplete:t,onFailure:r};n.authenticatedRequest(a,s)})}(r).then(function(n){return e.is(n,"object")?t.resolve(n):t.reject(new Error("Unable to search information on 3DGlobe service"))})},getAllReferentials:function(){return new t(function(e,t){var r=o.urlGlobe+"/authoring/referential",i=o.addTenantId(r),a={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(i,a)}).then(function(n){return e.is(n,"array")?t.resolve(n):t.reject(new Error("Unable to get all available referentials information on 3DGlobe service"))})},manageGeoItem:function(n,o,r){return s(n,o,r).then(function(n){return e.is(n,"object")||"PATCH"===o?t.resolve(n):t.reject(new Error("Unable to manage geoitem information on 3DGlobe service"))})},readGeoItem:function(n){return s(null,"GET",n).then(function(n){return e.is(n,"object")?t.resolve(n):t.reject(new Error("Unable to retrieve geoitem information on 3DGlobe service"))})},readDataset:function(i){return function(i,s,u){return new t(function(t,l){var d=o.urlGlobe,p={headers:{"Content-Type":"application/json"},type:"json",onComplete:t,onFailure:l};switch(i&&delete i.relatedObjects,s){case"POST":case"PATCH":d+="/authoring/geoitem",p.data=JSON.stringify(i);break;case"DELETE":d+="/authoring/dataset";break;default:d+="/datasupplier/dataset",s="GET"}if(p.method=s,e.is(u,"string")?d+="/"+u:"GET"==s&&(d+="/type"),"GET"!==s){var c=a();p.headers[r]=c}var f=o.addTenantId(d);n.authenticatedRequest(f,p)})}(null,"GET",i).then(function(n){return e.is(n,"object")?t.resolve(n):t.reject(new Error("Unable to retrieve dataset information on 3DGlobe service"))})},geoBuffer:function(e,i){return new t(function(t,s){var u=o.urlGlobe+"/datasupplier/cv/geo-api",l=o.addTenantId(u),d={geo:"#geobuffer2d("+e+", "+i+")"},p={method:"POST",headers:{"Content-Type":"application/json"},type:"json",data:JSON.stringify(d),onComplete:t,onFailure:s},c=a();p.headers[r]=c,n.authenticatedRequest(l,p)})}}}),define("DS/xCityGlobeUtils/GeoitemModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration"],function(e,t,n,o,r){"use strict";return n.extend({idAttribute:"uuid",defaults:{},fetchItem:function(){var e=this,n=r.urlGlobe+"/datasupplier/geoitem/"+this.get(this.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},fetchTypes:function(){var e=this,n=r.urlGlobe+"/datasupplier/geoitem/type",i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})}})}),define("DS/xCityGlobeUtils/xCitySourceServices",["UWA/Core","UWA/Class/Promise","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration"],function(e,t,n,o){"use strict";return{retrieveReport:function(r){return e.is(r,"string")&&""!==r?function(e){return new t(function(t,r){var i=o.urlGlobe+"/datasupplier/geoitemsource/"+e+"/import/report",a=o.addTenantId(i),s={method:"GET",onComplete:t,onFailure:function(e,t,n){r({error:e,response:t,headers:n})}};n.authenticatedRequest(a,s)})}(r):t.reject(new Error("Invalid input for dataset identifier"))}}}),define("DS/xCityGlobeUtils/xCityDatasetServices",["UWA/Core","UWA/Class/Promise","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r){"use strict";var i={reservedWords:[],supportedTypes:[],predefinedAttributesByType:{},retrieveSupportedTypes:function(){return 0!==i.reservedWords.length&&0!==i.supportedTypes.length&&0!==Object.keys(i.predefinedAttributesByType).length?t.resolve():new t(function(e,t){var r=o.urlGlobe+"/authoring/dataset/type",i=o.addTenantId(r),a={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(i,a)}).then(function(n){if(!e.is(n,"object")||n==={})return t.reject(new Error("Invalid response when trying to retrieve supported dataset types"));for(var o=n.reservedWordList,r=n.datasetTypeList,a=0;a<r.length;a++){var s=r[a],u=s.type,l=s.predefinedAttributeList;i.supportedTypes.push(u),i.predefinedAttributesByType[u]=l}return i.reservedWords=o,t.resolve()})},extractTilesInformation:function(r){return e.is(r,"string")&&""!==r?function(e){return new t(function(t,r){var i=o.urlGlobe+"/datasupplier/dataset/"+e+"/resources/tiles.ctds",a=o.addTenantId(i),s={method:"GET",type:"json",onComplete:t,onFailure:r};n.authenticatedRequest(a,s)})}(r).then(function(n){return!e.is(n,"object")||e.equals(n,{})?t.reject(new Error("Invalid response for tiles description")):n.sourceType&&n.sourceLevel&&n.sourceBbox&&n.tileUrl?t.resolve(n):t.reject(new Error("Incomplete content for tiles description"))}):t.reject(new Error("Invalid input for dataset identifier"))},uploadStyle:function(i,a){return e.is(i,"string")&&""!==i?!e.is(a,"object")||e.equals(a,{})?t.reject(new Error("Invalid input for style description")):function(e,i){return new t(function(t,a){var s=o.urlGlobe+"/authoring/dataset/"+e+"/style";s=o.addTenantId(s);var u={"content-type":"application/json"},l={type:"json",method:"PUT",headers:u=r.addToken(u),data:JSON.stringify(i),onComplete:t,onFailure:function(e,t,n){a({error:e,response:t,headers:n})}};n.authenticatedRequest(s,l)})}(i,a):t.reject(new Error("Invalid input for dataset identifier"))},resetStyle:function(i){return e.is(i,"string")&&""!==i?function(e){return new t(function(t,i){var a=o.urlGlobe+"/authoring/dataset/"+e+"/style";a=o.addTenantId(a);var s={"content-type":"application/json"},u={type:"json",method:"DELETE",headers:s=r.addToken(s),onComplete:t,onFailure:function(e,t,n){i({error:e,response:t,headers:n})}};n.authenticatedRequest(a,u)})}(i):t.reject(new Error("Invalid input for dataset identifier"))},retrieveReport:function(r){return e.is(r,"string")&&""!==r?function(e){return new t(function(t,r){var i=o.urlGlobe+"/datasupplier/dataset/"+e+"/preparation/report",a=o.addTenantId(i),s={method:"GET",onComplete:t,onFailure:function(e,t,n){r({error:e,response:t,headers:n})}};n.authenticatedRequest(a,s)})}(r):t.reject(new Error("Invalid input for dataset identifier"))},retrieveResourcesIndex:function(r){return e.is(r,"string")&&""!==r?function(e){var r=o.urlGlobe+"/datasupplier/dataset/"+e+"/resources/index.json",i=o.addTenantId(r);return new t(function(e,t){var o={method:"GET",type:"json",onComplete:e,onFailure:t};n.authenticatedRequest(i,o)})}(r):t.reject(new Error("Invalid input for dataset identifier"))},getProxyInformation:function(r){return e.is(r,"string")&&""!==r?function(e){return new t(function(t,r){var i=o.urlGlobe+"/datasupplier/dataset/"+e+"/proxyinformation",a=o.addTenantId(i),s={method:"GET",type:"json",onComplete:function(e,n,o){200===o.status||202===o.status?t({request:o,data:e,headers:n}):r()},onFailure:r};n.authenticatedRequest(a,s)})}(r):t.reject(new Error("Invalid input for dataset identifier"))}};return i}),define("DS/xCityGlobeUtils/xCityAdministrativeServices",["UWA/Core","UWA/Class/Promise","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r){"use strict";var i={retrieveHealthState:function(){return new t(function(e,t){var r=o.urlGlobe+"/authoring/admin/health/state",i=o.addTenantId(r),a={method:"GET",type:"json",headers:{"content-type":"application/json"},onComplete:e,onFailure:t};n.authenticatedRequest(i,a)}).then(function(e){return i.health=e,t.resolve(e)})},retrieveTenantUsage:function(r){return e.is(r,"string")&&""!==r?function(e){return new t(function(t,r){var i=o.urlGlobe+"/authoring/admin/tenant/"+e,a=o.addTenantId(i),s={method:"GET",type:"json",onComplete:t,onFailure:r};n.authenticatedRequest(a,s)})}(r).then(function(e){return i.usage=e,t.resolve(e)}):t.reject(new Error("Invalid input for tenant identifier"))}};return i}),define("DS/xCityGlobeUtils/GeoitemSourceModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialUuid:""},validate:function(t){return e.is(t.name,"string")&&""!==t.name?e.is(t.referentialUuid,"string")&&""!==t.referentialUuid?void 0:new Error("Invalid referential identifier (should be a non-empty string)."):new Error("Invalid source name (should be a non-empty string).")},createSource:function(e){var n=this,a=r.urlGlobe+"/authoring/geoitemsource",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",wait:!0,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},transferSource:function(){var e=this,n=r.urlGlobe+"/authoring/geoitemsource/"+this.get(this.idAttribute)+"/transfer",a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"PUT",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.save(null,r)||n(e.validationError)})},importSource:function(){var e=this,n=r.urlGlobe+"/authoring/geoitemsource/"+this.get(this.idAttribute)+"/import",a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"PUT",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.save(null,r)||n(e.validationError)})},fetchSource:function(){var e=this,n=r.urlGlobe+"/datasupplier/geoitemsource/"+this.get(this.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},updateSource:function(e){var n=this,a=r.urlGlobe+"/authoring/geoitemsource/"+this.get(this.idAttribute);a=r.addTenantId(a);var s={"content-type":"application/json"};return s=i.addToken(s),new t(function(t,r){var i={type:"json",method:"PATCH",wait:!0,patch:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},deleteSource:function(){var e=this,n=r.urlGlobe+"/authoring/geoitemsource/"+this.get(this.idAttribute);n=r.addTenantId(n);var a={"content-type":"application/json"};return a=i.addToken(a),new t(function(t,r){var i={type:"json",method:"DELETE",wait:!0,url:n,headers:a,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};e.destroy(i)})}})}),define("DS/xCityGlobeUtils/GeoitemSourceCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/GeoitemSourceModel"],function(e,t,n,o,r,i){"use strict";return n.extend({model:i,url:function(){return r.urlGlobe+"/datasupplier/geoitemsource"},fetchAllSources:function(e){var n=this;return new t(function(t,i){var a=n.url();e&&(a+="?referentialUuid="+e);var s={type:"json",method:"GET",url:r.addTenantId(a),headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){i({error:e,response:t,headers:n})}};n.fetch(s)})}})}),define("DS/xCityGlobeUtils/NetworkModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialUuid:"",enoviaPhysicalId:""},urlRoot:function(){var e=r.urlGlobe+"/authoring/routingnetwork";return r.addTenantId(e)},validate:function(t){return e.is(t.name,"string")&&""!==t.name?e.is(t.referentialUuid,"string")&&""!==t.referentialUuid?e.is(t.enoviaPhysicalId,"string")&&""!==t.enoviaPhysicalId?void 0:new Error("Invalid physical id (should be a non-empty string)"):new Error("Invalid referential identifier (should be a non-empty string)."):new Error("Invalid network name (should be a non-empty string)")},fetchNetwork:function(){var e=this,n=r.urlGlobe+"/datasupplier/routingnetwork/"+this.get(this.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={url:i,type:"json",method:"GET",headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(){n(new Error("Unable to fetch routing network from 3DGlobe"))}};return e.fetch(r)})},fetchNetworkInformation:function(){var e=this,n=r.urlGlobe+"/datasupplier/routingnetwork/"+this.get(this.idAttribute)+"/information",i=r.addTenantId(n);return new t(function(t,n){var r={url:i,type:"json",method:"GET",headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(){n(new Error("Unable to fetch routing network information from 3DGlobe"))}};return e.fetch(r)})},createNetwork:function(e){var n=this,a=r.urlGlobe+"/authoring/routingnetwork",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",wait:!0,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},transferNetwork:function(){var e=this,n=r.urlGlobe+"/authoring/routingnetwork/"+this.get(this.idAttribute)+"/transfer",a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"PUT",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.save(null,r)||n(e.validationError)})},deleteNetwork:function(){var e=this,n=r.urlGlobe+"/authoring/routingnetwork/"+this.get(this.idAttribute),a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"DELETE",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.destroy(r)})}})}),define("DS/xCityGlobeUtils/NetworkCollection",["UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityGlobeUtils/NetworkModel","DS/xCityPlatformUtils/xCityPlatformIntegration"],function(e,t,n,o,r){"use strict";return t.extend({model:o,url:function(){return r.urlGlobe+"/datasupplier/routingnetwork"},createNetwork:function(t){var r=this,i=new o({name:t.name,referentialName:t.referentialName,physicalId:t.physicalId});return new e(function(e,t){i.save(null,{type:"json",method:"POST",header:{"Content-Type":"application/json"},proxy:"passport",ajax:n.authenticatedRequest,onComplete:function(t,n,o){r.add(t),e({model:t,response:n,options:o})},onFailure:function(e,n,o){t({model:e,response:n,options:o})}}),i.validationError&&t(i.validationError)})},fetchNetworkDetails:function(t){var n=this;return new e(function(e,o){var r=n.get(t);r?r.fetchNetworkInformation().then(e,o):o(new Error("Unable to fetch City Network information from 3DGlobe"))})},fetchAllNetworks:function(t,o){var i=this;return new e(function(e,a){var s=i.url();t?s+="?referentialUuid="+t:o&&(s+="?referentialName="+o);var u={type:"json",method:"GET",url:r.addTenantId(s),headers:{"content-type":"application/json"},proxy:"passport",ajax:n.authenticatedRequest,onComplete:function(t,n,o){e({collection:t,response:n,options:o})},onFailure:function(e,t,n){a({error:e,response:t,headers:n})}};i.fetch(u)})}})}),define("DS/xCityGlobeUtils/RawSourceModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialUuid:""},validate:function(t){return e.is(t.name,"string")&&""!==t.name?e.is(t.referentialUuid,"string")&&""!==t.referentialUuid?void 0:new Error("Invalid referential identifier (should be a non-empty string)."):new Error("Invalid source name (should be a non-empty string).")},fetchSource:function(){var e=this,n=r.urlGlobe+"/datasupplier/rawsource/"+this.get(this.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},createSource:function(e){var n=this,a=r.urlGlobe+"/authoring/rawsource",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",wait:!0,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},transferSource:function(){var e=this,n=r.urlGlobe+"/authoring/rawsource/"+this.get(this.idAttribute)+"/transfer",a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"PUT",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.save(null,r)||n(e.validationError)})},updateSource:function(e){var n=this,a=r.urlGlobe+"/authoring/rawsource/"+this.get(this.idAttribute),s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"PATCH",wait:!0,patch:!1,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},deleteSource:function(){var e=this,n=r.urlGlobe+"/authoring/rawsource/"+e.get(e.idAttribute),a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"DELETE",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.destroy(r)})}})}),define("DS/xCityGlobeUtils/RawSourceCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/RawSourceModel"],function(e,t,n,o,r,i){"use strict";return n.extend({model:i,url:function(){return r.urlGlobe+"/datasupplier/rawsource"},fetchAllSources:function(e){var n=this;return new t(function(t,i){var a={type:"json",method:"GET",data:{referentialUuid:e},url:r.addTenantId(n.url()),headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){i({collection:e,response:t,options:n})}};n.fetch(a)})}})}),define("DS/xCityGlobeUtils/DatasetModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialUuid:""},urlRoot:function(){var e=r.urlGlobe+"/authoring/dataset";return r.addTenantId(e)},validate:function(t){return e.is(t.name,"string")&&""!==t.name?e.is(t.referentialUuid,"string")&&""!==t.referentialUuid?this.has("exposedAttributeList")&&!e.is(t.exposedAttributeList,"array")?new Error("Invalid exposed attributes list (if existing, should be a non-empty array)."):this.has("startLevel")&&this.has("endLevel")&&t.startLevel>t.endLevel?new Error("End level must be greater than start level."):this.has("type")&&""===t.type?new Error("Invalid dataset type (should be a non-empty string)."):void 0:new Error("Invalid referential name (should be a non-empty string)."):new Error("Invalid dataset name (should be a non-empty string).")},fetchDatasetWithDetails:function(t,n,i){e.is(t,"object")||(t={}),t.tenant=r.getTenantId(),t.referential=this.get("referential");var a={data:t,type:"json",method:"GET",header:{"Content-Type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest};return a.url=r.urlGlobe+"/authoring/dataset/"+this.get(this.idAttribute),e.is(n,"function")&&(a.onComplete=n),e.is(i,"function")&&(a.onFailure=i),this.fetch(a)},fetchDataset:function(){var e=this,n=r.urlGlobe+"/datasupplier/dataset/"+e.get(e.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headerd:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},createDataset:function(e){var n=this,a=r.urlGlobe+"/authoring/dataset",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},deleteDataset:function(){var e=this,n=r.urlGlobe+"/authoring/dataset/"+e.get(e.idAttribute),a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"DELETE",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.destroy(r)})},updateDataset:function(e){var n=this,a=r.urlGlobe+"/authoring/dataset/"+this.get(this.idAttribute),s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"PATCH",wait:!0,patch:!1,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},prepareDataset:function(){var e=this,n=r.urlGlobe+"/authoring/dataset/"+this.get(this.idAttribute)+"/prepare",a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"PUT",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.save(null,r)||n(e.validationError)})},get3DXContent:function(){return{protocol:"3DXContent",version:"2.0",source:widget.getValue("appId"),widgetId:widget.id,data:{items:[{envId:r.getTenantId(),objectId:this.get(this.idAttribute),serviceId:"globe",objectType:"dataset",displayName:this.get("name"),contextId:this.get("referentialUuid")}]}}},tweakDatasetState:function(e){var t=this.get("state");if("New"!==t)return t;var n=this.get("query");if(!n)return t;var o=n.filterList[0][0].value,r=e.get(o);if(!r)return"Unknown";var i=r.get("state");return i?"Ready"===i?"Imported":i||t:"Transferring"},retrieveSource:function(e){var t=this.get("query");if(!t)return null;var n=t.filterList[0][0].value,o=e.get(n);return o||null},retrieveSourcesIds:function(){var t=this.get("query");if(!t)return null;var n=t.filterList;if(!e.is(n,"array")||0===n.length)return null;var o=n[0];return e.is(o,"array")&&0!==o.length?o.map(function(e){if("geoItemSourceUuid"===e.attribute&&e.value)return e.value}):null},isRawData:function(){var e=this.get("query"),t=this.get("outputFormat");return!e&&!t}})}),define("DS/xCityGlobeUtils/DatasetCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/DatasetModel"],function(e,t,n,o,r,i){"use strict";return n.extend({model:i,setup:function(){this.partial=!1},url:function(){return r.urlGlobe+"/datasupplier/dataset"},isPartial:function(){return this.partial},fetchDatasetsByReferentialId:function(n,i){var a=this;return e.is(n,"string")&&""!==n?new t(function(e,t){var s={url:r.addTenantId(a.url()),data:{referentialUuid:n},type:"json",method:"GET",headers:{"content-Type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(t,n,o){o&&o.request&&o.request.xhr&&o.request.xhr.status&&206===o.request.xhr.status?a.partial=!0:a.partial=!1,e({collection:t,response:n,options:o})},onFailure:function(e,n,o){t({collection:e,response:n,options:o})}};!1!==i&&(s.silent=!0),a.fetch(s)}):t.reject(new Error("Invalid input argument given for referential identifier"))}})}),define("DS/xCityGlobeUtils/ExperienceModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialName:"",type:"",default:!1,thumbnail:"",pointOfView:{},datasetList:[]},validate:function(t,n){return e.is(t.name,"string")&&""!==t.name?e.is(t.type,"string")&&""!==t.type?void 0:new Error("Invalid experience type (should be a non-empty string)"):new Error("Invalid experience name (should be a non-empty string)")},publishExperience:function(e){var n=this,a=r.urlGlobe+"/authoring/experience",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};return n.save(e,i)})},updateExperience:function(e){var n=this,a=r.urlGlobe+"/authoring/experience/"+this.get(this.idAttribute),s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"PATCH",wait:!0,patch:!1,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},deleteExperience:function(e){var n=this,a=r.urlGlobe+"/authoring/experience/"+n.get(n.idAttribute),s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"DELETE",wait:!0,node:e,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:t,onFailure:function(e,t,n){r({error:e,response:t,headers:n})}};n.destroy(i)})},fetchExperience:function(){var e=this,n=r.urlGlobe+"/datasupplier/experience/"+e.get(e.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={url:i,data:{extended:!0},type:"json",method:"GET",header:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t(n)},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},addThumbnail:function(){var e=r.urlGlobe+"/datasupplier/experience/"+this.get(this.idAttribute)+"/thumbnail",t=r.addTenantId(e);return!0===this.set("thumbnail",t)?t:null},get3DXContent:function(){var e="",t=this.get("type");return"Navigation"===t?e="Navigation Experience":"Referential"===t?e="Referential Experience":"Collaboration"===t&&(e="Collaboration Experience"),{protocol:"3DXContent",version:"2.0",source:widget.getValue("appId"),widgetId:widget.id,data:{items:[{envId:r.getTenantId(),objectId:this.get(this.idAttribute),serviceId:"globe",objectType:e,displayName:this.get("name"),contextId:this.get("referentialUuid")}]}}}})}),define("DS/xCityGlobeUtils/ExperienceCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityGlobeUtils/ExperienceModel","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i,a){"use strict";return n.extend({model:r,setup:function(){this.partial=!1},url:function(t){var n=i.urlGlobe+"/datasupplier/experience";return e.is(t,"string")&&t.length&&(n+="?referential="+t),n},isPartial:function(){return this.partial},fetchAllExperiences:function(e){var n=this;return new t(function(t,r){var a={url:i.addTenantId(n.url()),type:"json",method:"GET",headers:{"content-Type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){r({collection:e,response:t,options:n})}};!1!==e&&(a.silent=!0),n.fetch(a)})},fetchExperiencesByReferentialId:function(e,n){var r=this;return new t(function(t,a){var s={url:i.addTenantId(r.url()),data:{referentialUuid:e},type:"json",method:"GET",headers:{"content-Type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){o&&o.request&&o.request.xhr&&o.request.xhr.status&&206===o.request.xhr.status?r.partial=!0:r.partial=!1,t({collection:e,response:n,options:o})},onFailure:function(e,t,n){a({collection:e,response:t,options:n})}};!1!==n&&(s.silent=!0),r.fetch(s)})},createExperience:function(e){var n=this,r=i.urlGlobe+"/authoring/experience",s=i.addTenantId(r),u=a.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",wait:!0,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}},a=n.create(e,i);a.validationError&&r(a.validationError)})},addThumbnails:function(){this.map(function(e){var t=this.url()+"/"+e.get("uuid")+"/thumbnail",n=i.addTenantId(t);e.set("thumbnail",n)},this)}})}),define("DS/xCityGlobeUtils/LinkageSourceModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialUuid:""},validate:function(t){return e.is(t.name,"string")&&""!==t.name?e.is(t.referentialUuid,"string")&&""!==t.referentialUuid?void 0:new Error("Invalid referential identifier (should be a non-empty string)."):new Error("Invalid source name (should be a non-empty string).")},fetchSource:function(){var e=this,n=r.urlGlobe+"/datasupplier/linkagesource/"+this.get(this.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},createSource:function(e){var n=this,a=r.urlGlobe+"/authoring/linkagesource",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",wait:!0,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},transferSource:function(){var e=this,n=r.urlGlobe+"/authoring/linkagesource/"+this.get(this.idAttribute)+"/transfer",a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"PUT",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.save(null,r)||n(e.validationError)})}})}),define("DS/xCityGlobeUtils/LinkageSourceCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/LinkageSourceModel"],function(e,t,n,o,r,i){"use strict";return n.extend({model:i,url:function(){return r.urlGlobe+"/datasupplier/linkagesource"},fetchAllSources:function(e){var n=this;return new t(function(t,i){var a={type:"json",method:"GET",data:{referentialUuid:e},url:r.addTenantId(n.url()),headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){i({collection:e,response:t,options:n})}};n.fetch(a)})}})}),define("DS/xCityGlobeUtils/ReferentialModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{uuid:"",title:"",proj:"",bbox:{xmin:0,xmax:1e3,ymin:0,ymax:1e3}},urlRoot:function(){var e=r.urlGlobe+"/authoring/referential";return r.addTenantId(e)},validate:function(t,n){if(!e.is(t.name,"string")||""===t.name)return new Error("Invalid referential name");var o=new RegExp("EPSG:[0-9]{4,6}").test(t.projection);return e.is(t.projection,"string")&&""!==t.projection&&o?void 0:new Error("Invalid EPSG code")},fetchReferential:function(e){var n=this,i=r.urlGlobe+"/datasupplier/referential/"+e;return new t(function(e,t){var a={type:"json",method:"GET",proxy:"passport",url:r.addTenantId(i),headers:{"content-type":"application/json"},ajax:o.authenticatedRequest,onComplete:function(t,n,o){e(n)},onFailure:function(e,n,o){t({model:e,response:n,options:o})}};n.fetch(a)})},retrieveReferential:function(){var e=this,n=r.urlGlobe+"/datasupplier/referential/"+e.get(e.idAttribute),i=r.addTenantId(n);return new t(function(t,n){var r={type:"json",method:"GET",url:i,headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};return e.fetch(r)})},createReferential:function(e){var n=this,a=r.urlGlobe+"/authoring/referential",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},patchReferential:function(e){var n=this;return new t(function(t,a){var s=r.urlGlobe+"/authoring/referential/"+n.get(n.idAttribute);s=r.addTenantId(s);var u={"content-type":"application/json"},l={type:"json",method:"PATCH",headers:u=i.addToken(u),data:JSON.stringify(e),onComplete:function(){n.retrieveReferential().then(t,a)},onFailure:function(e,t,o){a({model:n,response:e,options:o})}};o.authenticatedRequest(s,l)})},deleteReferential:function(){var e=this,n=r.urlGlobe+"/authoring/referential/"+e.get(e.idAttribute),a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"DELETE",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.destroy(r)})},checkProjParameter:function(e){return e!==this.get("proj")},checkBBoxParameters:function(e,t){var n=this.get("bbox");null==t?t=0:t>20&&(t=20);var o=(n.xmax-n.xmin)/Math.pow(2,t)*.01,r=[];return["xmin","ymin","xmax","ymax"].forEach(function(t){Math.abs(e[t]-n[t])>o&&r.push(t)}),r.length>0&&r}})}),define("DS/xCityGlobeUtils/ReferentialCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/ReferentialModel"],function(e,t,n,o,r,i){"use strict";return n.extend({model:i,url:function(){return r.urlGlobe+"/datasupplier/referential"},fetchAllReferentials:function(e){var n=this;return new t(function(t,i){var a={url:r.addTenantId(n.url()),type:"json",method:"GET",headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){i({collection:e,response:t,options:n})}};return!1!==e&&(a.silent=!0),n.fetch(a)})}})}),define("DS/xCityGlobeUtils/SiteModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/xCityGlobeServices"],function(e,t,n,o,r,i){"use strict";return n.extend({idAttribute:"uuid",defaults:{name:"",referentialUuid:""},validate:function(t){return e.is(t.name,"string")&&""!==t.name?e.is(t.referential,"string")&&""!==t.referential?void 0:new Error("Invalid referential identifier (should be a non-empty string)."):new Error("Invalid site name (should be a non-empty string).")},createSite:function(e){var n=this,a=r.urlGlobe+"/authoring/site",s=r.addTenantId(a),u=i.addToken({"content-type":"application/json"});return new t(function(t,r){var i={type:"json",method:"POST",wait:!0,url:s,headers:u,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,n){r({model:e,response:t,options:n})}};n.save(e,i)||r(n.validationError)})},deleteSite:function(){var e=this,n=r.urlGlobe+"/authoring/site/"+e.get(e.idAttribute),a=r.addTenantId(n),s=i.addToken({"content-type":"application/json"});return new t(function(t,n){var r={type:"json",method:"DELETE",wait:!0,url:a,headers:s,proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({model:e,response:n,options:o})},onFailure:function(e,t,o){n({model:e,response:t,options:o})}};e.destroy(r)})}})}),define("DS/xCityGlobeUtils/SiteCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/WAFData/WAFData","DS/xCityPlatformUtils/xCityPlatformIntegration","DS/xCityGlobeUtils/SiteModel"],function(e,t,n,o,r,i){"use strict";return n.extend({model:i,url:function(){return r.urlGlobe+"/authoring/site"},fetchSitesByReferentialName:function(e,n){var i=this;return new t(function(t,a){var s={url:r.addTenantId(i.url()),data:{referential:e},type:"json",method:"GET",headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){a({collection:e,response:t,options:n})}};!1!==n&&(s.silent=!0),i.fetch(s)})},fetchSitesByReferentialId:function(e,n){var i=this;return new t(function(t,a){var s={url:r.addTenantId(i.url()),data:{referentialUuid:e},type:"json",method:"GET",headers:{"content-type":"application/json"},proxy:"passport",ajax:o.authenticatedRequest,onComplete:function(e,n,o){t({collection:e,response:n,options:o})},onFailure:function(e,t,n){a({collection:e,response:t,options:n})}};!1!==n&&(s.silent=!0),i.fetch(s)})}})});