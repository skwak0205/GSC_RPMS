define("DS/CfgEvolutionUX/CfgUnitMilestoneLayout",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Modal","DS/UIKIT/Input","DS/UIKIT/Input/Button","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Input/Text","DS/Tree/TreeListView","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Input/Toggle","DS/UIKIT/Iconbar","DS/UIKIT/Tooltip","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgContainerView","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h,g){"use strict";return{}}),define("DS/CfgEvolutionUX/CfgVariants",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgXMLServices","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgFilterUX/CfgVariantEditor","DS/UIKIT/Alert","DS/CfgFilterUX/CfgPCChooser","DS/CfgBaseUX/scripts/CfgData","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Iconbar","DS/CfgBaseUX/scripts/CfgSearchConfiguration","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h,g,f,v,C,D,b,x,E,y){"use strict";return n.extend({textBox:null,editButton:null,textdiv:null,buttondiv:null,xml:null,json:null,displayExpression:"",currentModel:null,xmlExpression:"",xmlDisplayExpression:"",configuratorButton:null,binaryExpression:"",selectedPCPID:"",selectedPCDisplayName:"",selectedPCMode:"",selectedPCPName:"",BasedOnMVID:"",BasedOnModelID:"",BasedOnModelName:"",displayCompactMode:!1,setup:function(e){this._parent(e)},render:function(){var e=this;this.displayCompactMode=this.options.displayCompactMode,this.rootrevisionarray=[],this.options.parentElement.addClassName("variant-decidesActionButtonPosition"),this.wrapperContainer=UWA.createElement("div",{styles:{}}).inject(this.options.parentElement),this.imgContainer=UWA.createElement("div",{styles:{}}).inject(this.wrapperContainer),this.pcwrapperDiv=UWA.createElement("div",{id:"pcwrapperDivId",styles:{visibility:"hidden"}}).inject(this.wrapperContainer),this.textdiv=UWA.createElement("div",{styles:{float:"left",width:"100%","margin-bottom":"10px"}}).inject(this.options.parentElement),this.textBox=UWA.createElement("div",{styles:{"overflow-wrap":"break-word"}}).inject(this.textdiv),this.textBox.addClassName("CfgEditorVariants"),this.textBox.innerHTML=this.options.iUnitJson.displayExpression,this.displayExpression=this.options.iUnitJson.displayExpression,this.xmlExpression=this.options.iUnitJson.xmlExpression,this.selectedPCPID=a.isParamDefined(this.options.iUnitJson.selectedPCPID)?this.options.iUnitJson.selectedPCPID:"",this.selectedPCDisplayName=a.isParamDefined(this.options.iUnitJson.selectedPCDisplayName)?this.options.iUnitJson.selectedPCDisplayName:"",this.selectedPCMode=a.isParamDefined(this.options.iUnitJson.selectedPCMode)?this.options.iUnitJson.selectedPCMode:"",this.configuratorOptions=this.options.iUnitJson.configuratorOptions,this.xmlDesc=this.options.iUnitJson.xmlDesc,null==this.options.iUnitJson.binaryExpression?this.binaryExpression="":this.binaryExpression=this.options.iUnitJson.binaryExpression,this.variant=this.options.iUnitJson.variant,this.status=this.options.status,this.getDefaultIcon(),this.pcIconButton=UWA.createElement("img",{src:this.iconProductConfiguration22,id:"pcIconButton"}).inject(this.pcwrapperDiv),this.labelPCIcon=UWA.createElement("Label",{html:"Demo Product Configuration",id:"pciconLabelId"}).inject(this.pcwrapperDiv),a.isParamDefined(this.selectedPCDisplayName)&&(this.labelPCIcon.innerHTML=this.selectedPCDisplayName,this.pcwrapperDiv.addClassName("enablePCLabel")),this.editButton=UWA.createElement("img",{src:this.iconProductConfiguration22,id:"editbuttonid"}).inject(this.imgContainer),this.editButton.addClassName("editButtoncss"),this.editButton.set({events:{click:function(t){1!=e.editButton.hasClassName("disableButton")&&e.onVariantsDialogLaunched(t,e)}}}),new d({target:this.editButton,className:"editButtontooltip",body:E.Filter_Variant__ProductConfiguration_Button}),this.divider=UWA.createElement("div",{id:"dividerid"}).inject(this.imgContainer),this.divider.addClassName("cfgdivider"),1==this.options.userGrantedRoles.isCFGRoleAvail&&(this.configuratorButton=UWA.createElement("img",{id:"edit",src:this.iconActionConfigurator}).inject(this.imgContainer),this.configuratorButton.addClassName("configuratorButton"),new d({target:this.configuratorButton,className:"configuratorbuttontooltip",body:E.Filter_Variant_Configurator_Button}),e.options.status?e.configuratorButton.addClassName("disableButton"):e.configuratorButton.removeClassName("disableButton"),this.configuratorButton.set({events:{click:function(t){if(a.isParamDefined(g.singleProductId)||g.ModelEvents.publish({event:"NoSingleProductId"}),1!=e.configuratorButton.hasClassName("disableButton")&&1!=e.configuratorButton.hasClassName("cfgWaitCursor"))if("Filter"==e.options.invokeFrom&&(u.mask(e.options.filterParentContainer),u.mask(e.options.filterParent)),e.currentDictionary=s.getDictionary(e.currentDictionaryId.replace("pid:","")),console.log(g.singleProductId),""!=e.displayExpression?e.selectedOptionsforConfigurator=g.selectedOptionsforConfigurator:e.selectedOptionsforConfigurator="",""==g.singleProductId?e.options.status=!1:e.options.status=!0,e.options={parentContainer:document.body,model_id:e.currentModel.model.valueItem,tenant:e.options.tenant,invokeFrom:e.options.invokeFrom,status:e.options.status,filterParent:e.options.filterParent,filterParentContainer:e.options.filterParentContainer,variantEditorOnOK:function(t){e.data=t,e.configuratorOptions=e.data.configuratorOptions,console.log(t),console.log(t.xml),e.variantSpinner=new c({className:"variantSpinner"}).inject(e.textBox),e.variantSpinner.spin(),e.calculateVariantSpinnerPosition(),e.clearButton.addClassName("disableButton"),e.editButton.addClassName("disableButton"),e.divider.addClassName("disableButton"),""==t.xml?(e.editButton.addClassName("editButton"),e.configuratorButton.addClassName("configuratorButton")):(e.editButton.addClassName("editButtonresize"),e.configuratorButton.addClassName("configuratorButtonresize")),e.clearProductConfLabelInfo(),u.mask(e.textBox),""!==t.xml?(e.variant={},e.variant.pcid=t.PCId,e.variant.configuration=t.configuration,e.processProductConfiguration(t,e)):(e.variant||(e.variant={},e.variant.pcid=t.PCId,e.variant.configuration=[]),e.getNoConfAlert())},variantEditorOnCancel:function(e){console.log("cancelled")}},""==e.selectedPCPID){var i=new p({displayCompactMode:e.displayCompactMode,parentContainer:document.body,productId:g.singleProductId,modelId:e.currentModel.model.valueItem,configuration:e.selectedOptionsforConfigurator,configuratorOptions:e.configuratorOptions,tenant:e.options.tenant,invokeFrom:e.options.invokeFrom,status:e.options.status,filterParent:e.options.filterParent,filterParentContainer:e.options.filterParentContainer,onOK:function(t){console.log("On OK Data : "+t.xml),e.options.variantEditorOnOK(t)},onCancel:function(t){console.log("On Cancel Data : "+t.xml),e.options.variantEditorOnCancel(t)}});setTimeout(function(){i.render()},1e3)}else e.launchVariantEditorfrompcId()}}})),g.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(t){""!=t.xml&&null!=t.xml||"PRODUCTS"!=t.mode||(g.singleProductId=""),e.xml=t.xml,e.options.psJson=t.json,e.xml=t.xml,e.textBox.innerHTML="",e.displayExpression="",e.xmlExpression="",e.binaryExpression="",e.variant={},e.clearButton.hide(),e.divider.hide(),null==e.configuratorButton?e.editButton.removeClassName("configuratorButtonresize"):(e.editButton.removeClassName("editButtonresize"),e.configuratorButton.removeClassName("configuratorButtonresize")),"PRODUCTS"==t.mode&&(""==g.singleProductId?e.options.status=!1:e.options.status=!0),e.enableDisableEditVariantfromProductEvolution(),e.clearProductConfLabelInfo()}),null==this.configuratorButton?this.editButton.addClassName("configuratorButton"):this.editButton.addClassName("editButtoncss"),this.clearButton=UWA.createElement("img",{styles:{position:"absolute",right:"5px",height:"27px"},id:"clearbuttonid",src:this.iconTrash}).inject(this.imgContainer),this.clearButton.set({events:{click:function(t){1!=e.clearButton.hasClassName("disableButton")&&(e.textBox.innerHTML="",e.displayExpression="",e.xmlExpression="",e.binaryExpression="",e.variant={},e.clearButton.hide(),e.divider.hide(),null==e.configuratorButton?e.editButton.removeClassName("configuratorButtonresize"):(e.editButton.removeClassName("editButtonresize"),e.configuratorButton.removeClassName("configuratorButtonresize")),e.pcwrapperDiv.removeClassName("enablePCLabel"),e.clearProductConfLabelInfo(),g.productstateCheckbox&&0==g.productstateCheckbox.checkFlag||""==g.singleProductId?e.configuratorButton.addClassName("disableButton"):e.configuratorButton.removeClassName("disableButton"))}}}),new d({target:this.clearButton,body:E.Filter_Variant_ClearButton}),this.textBox&&this.textBox.innerText&&"undefined"!==this.textBox.innerText?(this.clearButton.show(),this.divider.show(),null==this.configuratorButton?this.editButton.addClassName("configuratorButtonresize"):(this.editButton.addClassName("editButtonresize"),this.configuratorButton.addClassName("configuratorButtonresize"))):(this.clearButton.hide(),this.divider.hide()),g.ModelEvents.subscribe({event:"ProductStatecheckbox"},function(t){e.checkboxStatus=t.model,0!=t.isRoot&&null!=t.isRoot||1!=t.psJsonLength?(null!=e.configuratorButton&&e.configuratorButton.addClassName("disableButton"),e.options.status=!1,e.clearProductConfLabelInfo()):1==e.checkboxStatus?(null!=e.configuratorButton&&e.configuratorButton.removeClassName("disableButton"),e.options.status=!0):(null!=e.configuratorButton&&e.configuratorButton.addClassName("disableButton"),e.options.status=!1,e.clearProductConfLabelInfo())}),g.ModelEvents.subscribe({event:"modelUpdated"},function(t){e.currentModel=t;var i="";i=t.model.valueItem.constructor==Array?t.model.value[0]:t.model.valueItem,e.currentDictionaryId=i,""!=e.options.iUnitJson&&null!=e.options.iUnitJson?e.options.iUnitJson="":(e.textBox.innerHTML="",e.xmlExpression="",e.displayExpression="",e.clearButton.hide(),e.divider.hide(),null==e.configuratorButton?e.editButton.removeClassName("configuratorButtonresize"):(e.editButton.removeClassName("editButtonresize"),e.configuratorButton.removeClassName("configuratorButtonresize"))),null!=t.noEvolutionUpdate&&1==t.noEvolutionUpdate||(e.options.status=!1,e.enableDisableEditVariantfromProductEvolution(),e.clearProductConfLabelInfo())})},launchVariantEditorfrompcId:function(){var e=this,t=new p({displayCompactMode:e.displayCompactMode,parentContainer:document.body,modelId:this.options.model_id,PCId:this.selectedPCPID,tenant:e.options.tenant,invokeFrom:this.options.invokeFrom,status:this.options.status,filterParent:this.options.filterParent,filterParentContainer:this.options.filterParentContainer,onOK:function(t){console.log("On OK Data : "+t.xml),e.options.variantEditorOnOK(t)},onCancel:function(t){console.log("On Cancel Data : "+t.xml),e.options.variantEditorOnCancel(t)}});this.modelView=t,setTimeout(function(){t.render()},1e3)},getDefaultIcon:function(){this.iconProductConfiguration22=enoviaServerFilterWidget.baseURL+"/snresources/images/icons/small/ProductConfiguration22.png",this.iconActionConfigurator=C.getWebappsAssetUrl("CfgBaseUX","icons/32/iconActionConfigurator.png"),this.iconTrash=C.getWebappsAssetUrl("CfgBaseUX","icons/32/SWXMbUiDeleteObjects.png")},enableDisableEditVariantfromProductEvolution:function(){null!=this.configuratorButton&&(1==this.options.status?this.configuratorButton.removeClassName("disableButton"):this.configuratorButton.addClassName("disableButton"))},show:function(){this.visibleFlag=!0,this.textBox.show(),this.editButton.show(),this.configuratorButton.show(),""!=this.textBox.innerText&&(this.clearButton.show(),this.divider.show()),a.isDefined(document.getElementsByClassName("filter-dialog-variantslabel")[0])&&document.getElementsByClassName("filter-dialog-variantslabel")[0].show(),a.isDefined(document.getElementsByClassName("filter-dialog-150-checkbox")[0])&&document.getElementsByClassName("filter-dialog-150-checkbox")[0].show()},hide:function(){this.visibleFlag=!1,this.textBox.hide(),this.editButton.hide(),this.configuratorButton.hide(),this.clearButton.hide(),this.divider.hide(),this.pcwrapperDiv.removeClassName("enablePCLabel"),a.isDefined(document.getElementsByClassName("filter-dialog-variantslabel")[0])&&document.getElementsByClassName("filter-dialog-variantslabel")[0].setAttribute("style","display:none"),a.isDefined(document.getElementsByClassName("filter-dialog-150-checkbox")[0])&&document.getElementsByClassName("filter-dialog-150-checkbox")[0].setAttribute("style","display:none")},getBinaryExpression:function(e){if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var t=0;t<e.results[0].attributes.length;t++)"FILTER_COMPILED_FORM"==e.results[0].attributes[t].name&&(this.binaryExpression=e.results[0].attributes[t].value);return this.binaryExpression},getAssociatedMV:function(e){var t="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var i=0;i<e.results[0].attributes.length;i++)"ds6w:where/ds6w:context/ds6w:product"==e.results[0].attributes[i].name&&(t=e.results[0].attributes[i].value);return t},getBasedOnMVID:function(e){var t="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var i=0;i<e.results[0].attributes.length;i++)"BASED_ON_MODEL_VERSION_PID"==e.results[0].attributes[i].name&&(t=e.results[0].attributes[i].value);return t},getBasedOnModelID:function(e){var t="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var i=0;i<e.results[0].attributes.length;i++)"BASED_ON_MODEL_PID"==e.results[0].attributes[i].name&&(t=e.results[0].attributes[i].value);return t},getAttrValue:function(e,t){var i="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var o=0;o<e.results[0].attributes.length;o++)if(e.results[0].attributes[o].name==t)i=e.results[0].attributes[o].value;return i},getDisplayXMLExpression:function(e){var t={},i="";if(e.seletedoptionsexist=!1,null!=e.results[0]&&e.results[0].attributes.length>0){for(var o=0;o<e.results[0].attributes.length;o++)if("CONFIGURATION_FEATURE"==e.results[0].attributes[o].name){var n=e.results[0].attributes[o].value.split(":");if(null==t[n[0]]){if(n[0]===this.currentModel.model.name[0])continue;t[n[0]]=[n[1]],(s=[]).push(n[1]),t[n[0]]=s,e.seletedoptionsexist=!0}else{var s;(s=t[n[0]]).push(n[1]),t[n[0]]=s}}Object.keys(t).forEach(function(e,o){for(var n="",s=0;s<t[e].length;s++){var a=encodeURIComponent(t[e][s]);n+=r.buildOption(a)}if(0!=t[e].length.length){var l=encodeURIComponent(e);i+=r.buildFeature(l,n)}})}return i},getDisplayXMLExpressionFromPCCriteria:function(e){var t={},i="";if(e.seletedoptionsexist=!1,!a.isDefined(e.member)||!Array.isArray(e.member))return;return e.member.forEach(i=>{null==t[i.parentDisplayName]&&(t[i.parentDisplayName]={values:[]});let o={};o.selectionState=i.status,o.displayName=[i.displayName],t[i.parentDisplayName].values.push(o),e.seletedoptionsexist=!0}),Object.keys(t).forEach(function(e,o){let n="",s="",a=t[e].values;for(let e=0;e<a.length;e++){let t=encodeURIComponent(a[e].displayName[0]);"Dismissed"==a[e].selectionState||"Incompatible"==a[e].selectionState?s+=r.buildOption(t):n+=r.buildOption(t)}if(0!=a.length){var l=encodeURIComponent(e);""!=n&&(i+=r.buildFeature(l,n)),""!=s&&(i+=r.buildNot(),i+=r.buildFeature(l,s),i+=r.endNot())}}),i},isDisplayNameFetched:function(e){var t=!1;if(e.results[0])for(var i=0;i<e.results[0].attributes.length;i++)if("CONFIGURATION_FEATURE"==e.results[0].attributes[i].name){t=!0;break}return t},getXMLExpression:function(e){var t={},i="";if(e.seletedoptionsexist=!1,null!=e.results[0]&&e.results[0].attributes.length>0){for(var o=0;o<e.results[0].attributes.length;o++)if("PC_FEATURE_OPTIONS"==e.results[0].attributes[o].name){var n,s=e.results[0].attributes[o].value.split(":");if(null==t[s[0]])t[s[0]]=[s[1]],(n=[]).push(s[1]),t[s[0]]=n,e.seletedoptionsexist=!0;else(n=t[s[0]]).push(s[1]),t[s[0]]=n}Object.keys(t).forEach(function(e,o){for(var n="",s=0;s<t[e].length;s++)n+=r.buildOption(t[e][s]);0!=t[e].length.length&&(i+=r.buildFeature(e,n))})}return i},getXMLExpressionFromPCCriteria:function(e){var t={},i="";if(e.seletedoptionsexist=!1,!a.isDefined(e.member)||!Array.isArray(e.member))return;return e.member.forEach(i=>{null==t[i.parentName]&&(t[i.parentName]={values:[]});let o={};o.selectionState=i.status,o.name=[i.name],t[i.parentName].values.push(o),e.seletedoptionsexist=!0}),Object.keys(t).forEach(function(e,o){let n="",s="",a=t[e].values;for(var l=0;l<a.length;l++)"Dismissed"==a[l].selectionState||"Incompatible"==a[l].selectionState?s+=r.buildOption(a[l].name[0]):n+=r.buildOption(a[l].name[0]);0!=a.length&&(""!=n&&(i+=r.buildFeature(e,n)),""!=s&&(i+=r.buildNot(),i+=r.buildFeature(e,s),i+=r.endNot()))}),i},getNoConfAlert:function(){u.unmask(this.textBox),this.textBox.innerText="",this.displayExpression="",this.xmlExpression="",this.binaryExpression="",this.variant={},this.editButton.removeClassName("disableButton"),""!==this.textBox.innerText?this.clearButton.isHidden()?this.clearButton.show():(this.clearButton.removeClassName("disableButton"),this.divider.removeClassName("disableButton")):(this.clearButton.isHidden()||this.clearButton.hide(),this.divider.hide(),null==this.configuratorButton?this.editButton.removeClassName("configuratorButtonresize"):(this.editButton.removeClassName("editButtonresize"),this.configuratorButton.removeClassName("configuratorButtonresize"))),null!=this.data&&"selectionMode_Refine"===this.data.selectionmode?g.filter150Checkbox.checkFlag=!0:null!=this.data&&"selectionMode_Build"===this.data.selectionmode&&(g.filter150Checkbox.checkFlag=!1)},replaceAmp:function(e){var t=e.indexOf("&"),i=e.indexOf("</CfgFilterExpression>");if(-1!==e.indexOf("&")){var o=e.slice(0,t+1);o=o.replace("&","&amp;"),this.formattedXML=this.formattedXML+o,e=e.slice(t+1,i+22),this.replaceAmp(e)}else this.formattedXML=this.formattedXML+e},checkRefineMode:function(e){"selectionMode_Refine"===e||"Refine"===e?g.filter150Checkbox.checkFlag=!0:"selectionMode_Build"===e||"Build"===e?g.filter150Checkbox.checkFlag=!1:null==e&&g.filter150Checkbox.checkFlag&&(g.filter150Checkbox.checkFlag=!1)},processProductConfiguration:function(e,t){window.notifs=f,v.setNotificationManager(window.notifs),e.selectionmode&&this.checkRefineMode(e.selectionmode);var i=new l(function(i,o){if(e.xml)i();else{let o={id:JSON.parse(e.displayExpression).id},n=JSON.stringify(o);a.makeWSCall("/resources/v1/modeler/dspfl/invoke/dspfl:getCriteriaConfigurationInstances?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,function(e){a.isDefined(e.member)&&Array.isArray(e.member)?(t.selectedPCMode=e.selectionMode,t.checkRefineMode(e.selectionMode),t.getXMLExpressionFromPCCriteria(e),"Native"==window.enoviaServerFilterWidget.mode&&(t.selectedPCDisplayName=e.title,t.labelPCIcon.innerHTML=t.selectedPCDisplayName,t.selectedPCPName=e.name,null!=t.configuratorButton&&t.configuratorButton.removeClassName("disableButton"),t.pcwrapperDiv.addClassName("enablePCLabel"),t.clearButton.addClassName("disableButton"),t.editButton.addClassName("disableButton"),null==t.configuratorButton?t.editButton.addClassName("configuratorButtonresize"):(t.editButton.addClassName("editButtonresize"),t.configuratorButton.addClassName("configuratorButtonresize"))),1==e.seletedoptionsexist?i(e):t.getNoConfAlert()):t.getNoConfAlert()},function(e){t.variant.pcid=t.previousPC,u.unmask(t.textBox),t.variantSpinner.hide(),t.textBox.innerText="",t.editButton.removeClassName("disableButton"),""!==t.textBox.innerText?t.clearButton.isHidden()?(t.clearButton.show(),t.divider.show()):(t.clearButton.removeClassName("disableButton"),t.divider.removeClassName("disableButton")):(t.clearButton.isHidden()||t.clearButton.hide(),t.divider.hide(),null==t.configuratorButton?t.editButton.addClassName("configuratorButtonresize"):(t.editButton.addClassName("editButtonresize"),t.configuratorButton.addClassName("configuratorButtonresize")))},!0,null)}});return i.then(function(i){t.xmlExpression=e.xml?e.xml:t.getXMLExpressionFromPCCriteria(i),t.xmlDesc=e.xmlDesc?e.xmlDesc:"",t.xmlExpression=t.xmlExpression.replace(/&(?!amp;)/g,"&amp;");r.startFilterXML(),t.xmlExpression,r.endFilterXML();if(t.currentModel.model.valueItem.constructor==Array&&(t.currentModel.model.valueItem=t.currentModel.model.valueItem),e.xml){t.xmlDisplayExpression=e&&e.displayXml?e.displayXml:t.xmlExpression;var o=r.startFilterXML()+t.xmlDisplayExpression+r.endFilterXML();t.displayExpression=decodeURIComponent(a.getDisplayExpressionUsingXSLT(o))}else{t.xmlDisplayExpression=t.getDisplayXMLExpressionFromPCCriteria(i),t.xmlDisplayExpression=t.xmlDisplayExpression.replace(/&(?!amp;)/g,"&amp;");o=r.startFilterXML()+t.xmlDisplayExpression+r.endFilterXML();t.displayExpression=decodeURIComponent(a.getDisplayExpressionUsingXSLT(o))}t.clearButton.removeClassName("disableButton"),t.editButton.removeClassName("disableButton"),t.divider.removeClassName("disableButton"),u.unmask(t.textBox),t.textBox.innerHTML=t.displayExpression=t.displayExpression.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),""!==t.textBox.innerHTML&&(t.clearButton.show(),t.divider.show())}),i},calculateVariantSpinnerPosition:function(){var e=this.textBox.getPosition(),t=this.textBox.getDimensions().width,i=this.textBox.getDimensions().height,o=e.x+t/2,n=e.y+i/2;this.variantSpinner.elements.container.setStyles({top:n+"px",left:o+"px"})},getJson:function(){return this.displayExpression},getXml:function(){return this.xmlExpression},getDisplayExpression:function(){return this.displayExpression},getSelectedVariant:function(){return this.variant},getConfiguratorOptions:function(){return this.configuratorOptions},clearProductConfLabelInfo:function(){this.pcwrapperDiv.removeClassName("enablePCLabel"),this.selectedPCPID="",this.selectedPCMode="",1==this.options.status?null!=this.configuratorButton&&this.configuratorButton.removeClassName("disableButton"):null!=this.configuratorButton&&this.configuratorButton.addClassName("disableButton")},onVariantsDialogLaunched:function(e,t){var i=E.selectProductConfigurationForFilter,o=enoviaServerFilterWidget.myRole,n="",s=g.singleProductId;if(0==g.productstateCheckbox.checkFlag)s="";var l=t.currentModel.model.valueItem;n=(t.checkboxStatus||null==t.checkboxStatus)&&s?"(based_95_on_95_model_95_version_95_pid:"+s+")":"(based_95_on_95_model_95_pid:"+l+")";if("Native"==window.enoviaServerFilterWidget.mode){var r={precondition:n},d={eventName:"cfgConfigurationFilter",operation:"ActivateSearchPC",operationVersion:"1.0",content:JSON.stringify(r)};a.sendNotificationWebInWin(d)}else{new x(!1,i).activate(i,"Product Configuration",o,function(e){var i={},o=["id","ds6w:label"],n="",s="";Object.keys(e[0]._attributes).forEach(function(t){-1!==o.indexOf(t)&&("ds6w:label"==t?(i.label=e[0].get(t),n=e[0].get(t)):(i[t]=e[0].get(t),s=e[0].get(t)))}),t.labelPCIcon.innerHTML=n,t.selectedPCDisplayName=n,t.selectedPCPID=s,null!=t.configuratorButton&&t.configuratorButton.removeClassName("disableButton"),t.pcwrapperDiv.addClassName("enablePCLabel"),t.clearButton.addClassName("disableButton"),t.editButton.addClassName("disableButton"),null==t.configuratorButton?t.editButton.addClassName("configuratorButtonresize"):(t.editButton.addClassName("editButtonresize"),t.configuratorButton.addClassName("configuratorButtonresize"));var a={displayExpression:JSON.stringify(i),xmlExpression:""};t.processProductConfiguration(a,t)},"","",n)}}})}),define("DS/CfgEvolutionUX/CfgEvolutionViewSelector",["UWA/Class/View","DS/Controls/ComboBox"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},render:function(){var e=this;return null!=e.options.elementsList||null!=e.options.elementsList&&e.options.elementsList.length>0?this.viewCombobox=new t({selectedIndex:0,enableSearchFlag:!1,elementsList:e.options.elementsList,touchMode:!e.options.displayCompactMode}).inject(this.container):this.viewCombobox=new t({selectedIndex:0,enableSearchFlag:!1,elementsList:[{labelItem:e.options.officialViewLabel,valueItem:"Official"},{labelItem:e.options.projectedViewLabel,valueItem:"Projected"}],touchMode:!e.options.displayCompactMode}).inject(this.container),this.viewCombobox.addEventListener("change",function(t){var i=e.viewCombobox.currentValue;"Official"==i&&e.options.officialViewHandler?e.options.officialViewHandler():"Projected"==i&&e.options.projectedViewHandler?e.options.projectedViewHandler():"Change"==i&&e.options.changeViewHandler&&e.options.changeViewHandler()}),this.viewCombobox.addEventListener("click",function(e){e.stopPropagation()}),this.viewCombobox.addEventListener("show",function(e){document.getElementsByClassName("wux-controls-combobox-popup")[0].setStyle("zIndex","99999")}),this.container},set:function(e){"Official"==e.view?this.viewCombobox.selectedIndex=0:"Projected"==e.view?this.viewCombobox.selectedIndex=1:"Change"!=e.view&&"Source"!=e.view||(this.viewCombobox.selectedIndex=2)},get:function(){var e={view:""};return"Official"==this.viewCombobox.currentValue?e.view="Official":"Projected"==this.viewCombobox.currentValue?e.view="Projected":"Change"==this.viewCombobox.currentValue&&(e.view="Source"),e},enable:function(){this.viewCombobox.disabled=!1},disable:function(){this.viewCombobox.disabled=!0}})}),define("DS/CfgEvolutionUX/CfgConfigurationRevisionPicker",["DS/UIKIT/Input/Text","DS/Controls/TooltipModel","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgConfigurationRevisionFactory","DS/CfgFilterUX/CfgFilterSlideInComponent","DS/CfgBaseUX/scripts/CfgContainerView","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d){"use strict";return i.extend({editButton:null,textdiv:null,xml:null,xmlDesc:[],selectedNode:null,displayExpression:"",setup:function(e){this._parent(e)},render:function(){var e=this;this.textBox=UWA.createElement("div").inject(this.options.parentElement),this.textBox.addClassName("CfgEditor"),this.textBox.setStyle("marginBottom","10px"),this.textBox.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.textBox.setAttributeNode(document.createAttribute("edit-mode")),this.editButton=UWA.createElement("span").inject(this.options.parentElement),this.editButton.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),this.options.iSelectedId&&(this.selectedNode=this.options.iSelectedId),this.selectedNode&&this.textBox.setText(this.selectedNode.displayName+"-"+this.selectedNode.revision),this.applyCompactComfortableMode()},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.textBox.setAttributeNode(document.createAttribute("touch-mode")),this.editButton&&this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.removeAttribute("touch-mode"),this.editButton&&this.editButton.removeAttribute("touch-mode"))},onCriteriaClickHandler:function(e){this.editButton&&1==this.editButton.hasClassName("disableButton")||1==this.textBox.hasClassName("disableButton")||(this.editButton&&this.editButton.addClassName("disableButton"),this.textBox.addClassName("disableButton"),this.createContainer(),this.createVersionExplorer(),this.editButton&&this.editButton.removeClassName("disableButton"),this.textBox.removeClassName("disableButton"))},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},buildFilterXML:function(){return this.xml},buildDescription:function(){return this.xmlDesc},show:function(){this.textBox.show(),this.editButton&&this.editButton.show()},hide:function(){this.textBox.hide(),this.editButton&&this.editButton.hide()},createVersionExplorer:function(){this.cfgConfigurationRevisionPicker=new n;this.cfgConfigurationRevisionPicker.create(this.options.iRootId,()=>{},enoviaServerFilterWidget.tenant,enoviaServerFilterWidget.baseURL,enoviaServerFilterWidget.getSecurityContext(),this.MainContainer,this.selectedNode,this.cfgConfigurationRevisionPicker.vEObject)},onOK:function(){var e=this.cfgConfigurationRevisionPicker.getVEObject().getSelectedNodes();0!=e.length?(this.selectedNode=e[0]._options.data,this.textBox.setText(e[0]._options.data.displayName+"-"+e[0]._options.data.revision),o.ModelEvents.publish({event:"CRSelected"})):(this.textBox.setText(""),this.selectedNode=null,o.ModelEvents.publish({event:"CRDelected"}))},createContainer:function(){this.MainContainer=new UWA.createElement("div",{styles:{height:"100%",width:"100%"}}),this.MainContainer.setAttribute("id","MainPrdContainer");var e=this;if("Native"==window.enoviaServerFilterWidget.mode){o.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var t={isHeader:!0,isFooter:!0,firstButtonText:d.CFG_Apply,secondButtonText:d.CFG_Back,headerText:r.SelectConfiguredRevision,onButtonClickCB:function(t){"firstButton"==t.buttonId?(e.onOK(),o.ModelEvents.publish({event:"ConfigRevisionDialogClosed",data:{}})):"secondButton"==t.buttonId&&o.ModelEvents.publish({event:"ConfigRevisionDialogClosed",data:{model:null}}),e.containerView.destroy()}};this.containerView=new a(t).render(),this.containerView.inject(o.renderToApp),this.MainContainer.inject(this.containerView._body)}else{t={dialogue:{buttonArray:[{label:r.CfgLabelCancel,handler:function(){document.querySelector(".operations-main-container").destroy(),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){e.showFilter()})},className:"default"},{label:r.CfgLabelOK,handler:function(t){e.onOK(),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){document.querySelector(".operations-main-container").destroy(),e.showFilter()})},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:r.SelectConfiguredRevision,displayCompactMode:this.options.displayCompactMode};s.init(o.renderToApp,this.MainContainer,t,l)}}})}),define("DS/CfgEvolutionUX/CfgModelSelection",["UWA/Drivers/Alone","DS/Core/Core","DS/Controls/ComboBox","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","UWA/Class/Promise","DS/CfgBaseUX/scripts/CfgUtility"],function(e,t,i,o,n,s,a){"use strict";return o.extend({combobox:null,setup:function(e){this._parent(e)},render:function(){var e=this;this.options.Data.length>1?(e.combobox=new i({elementsList:this.options.Data,selectedIndex:this.options.currentindex}).inject(this.options.parentElement),e.combobox.addEventListener("change",function(){e.getcriteriasAvailable(e).then(function(t){n.criteriasAvailable=t.criteria[0],console.log(n.criteriasAvailable);var i={valueItem:e.combobox.currentValue,labelItem:e.combobox.currentLabel,name:e.getSelectedModelName(),criteriasAvailable:n.criteriasAvailable};n.CurrentFilterModel={model:i},n.ModelEvents.publish({event:"modelUpdated",data:{model:i}})})})):new UWA.Element("div",{class:"wux-control-inline-container modelNameFilter",text:this.options.Data[0].labelItem}).inject(this.options.parentElement)},getcriteriasAvailable:function(e){var t=e;return new s(function(e,i){var o={version:"1.0.0",modelIds:[{id:"pid:"+t.get()}]};o=JSON.stringify(o);a.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",o,function(t){e(t)},function(e){console.log("fail to get last product evolution")},!0)})},get:function(){return this.options.Data.length>1?this.combobox.currentValue:this.options.Data[0].valueItem},getSelectedModelName:function(){for(var e=this.get(),t=0;t<this.options.Data.length;t++)if(this.options.Data[t].valueItem==e)return this.options.Data[t].name},setModel:function(e){this.combobox.selectedIndex=this.options.Data.findIndex(function(t){return t.valueItem==e})}})}),define("DS/CfgEvolutionUX/CfgWUXUnitLayout",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Iconbar","DS/UIKIT/Modal","DS/UIKIT/Input","DS/UIKIT/Input/Button","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/Tree/TreeListView","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Tooltip","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgToggle","DS/Controls/LineEditor","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h,g,f,v){"use strict";return{CfgExpressionBox:!1,create:function(e,t,o,n){var s=this;this.fields=t,this.event1,this.ExpressionMode=!1,this.selectedNodes=[],this.currentModel=o,this.MainContainer=new UWA.Element("div",{class:" maincontainer-class"}),this.opts=n,this.CfgUnitToolbarContainer=UWA.createElement("div",{class:"unitToolbarContainer"});var d={displayCompactMode:s.opts.displayCompactMode,toggleID:"cfgUnitInfiniteToggle",toggleLabel:a.Filter_InfinitySelectionMode,toggleTooltip:a.Infinitytooltip,width:"auto"};this.unitInfiniteToggle=new g(d),this.unitInfiniteToggleContainer=this.unitInfiniteToggle.render(),!0===this.opts.isReadOnly&&this.unitInfiniteToggleContainer.hide(),n.rangeEnable&&this.unitInfiniteToggle.setToggleState(!0),this.expressionToolbarContainer=UWA.createElement("div",{class:"expressionToolbarContainer"}),this.expressionToolbar=new i({renderTo:s.expressionToolbarContainer,items:[{className:"divider"},{fonticon:"book-open",text:l.CfgExpressionView,handler:function(){!1===s.CfgExpressionBox?(s.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#b4b6ba"),s.CfgExpressionBox=!0,s.cfgExpressionViewObj.hideShowExpressionContainer()):(s.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#42a2da"),s.CfgExpressionBox=!1,s.cfgExpressionViewObj.hideShowExpressionContainer())}}]}),this.unitInfiniteToggleContainer.appendChild(this.expressionToolbarContainer),this.unitInfiniteToggleContainer.inject(this.CfgUnitToolbarContainer),this.applyCompactComfortableModeViewExpressionIcon(),this.inputContainer=new UWA.Element("div",{class:"cfgSearchUnitInputContainer"}).inject(this.CfgUnitToolbarContainer),this.CfgUnitToolbarContainer.appendChild(this.unitInfiniteToggleContainer),this.tooltipForFilter=new c({className:"mytooltip",target:this.inputContainer,body:a.TypeFilter_Number,position:"left"}),this.lineEditor=new f({placeholder:a.Filter_Dialod_Unit_Search_Placeholder,selectAllOnFocus:!0,displayClearFieldButtonFlag:!0}).inject(this.inputContainer),null==this.opts.displayCompactMode||!1===this.opts.displayCompactMode?this.lineEditor.touchMode=!0:this.lineEditor.touchMode=!1,this.lineEditor.addEventListener("uncommittedChange",function(){s.buildSequenceInsideTable()}),this.MainContainer.addClassName("mainContainerFilterUnit");var u=[];this.selectedRow=[],this.textboxinput=this.fields.split(",");var p=e.builds;this.rootBuildsData(u,p);var h={apiVersion:2,margin:"2px",padding:"2px",defaultCellHeight:38,changeColorOnFocus:!1,selection:{canMultiSelect:!0,isDraggable:!1,unselectAllOnEmptyArea:!1,nodes:!s.opts.isReadOnly},resize:{rows:!1,columns:!0},columns:[{text:"",dataIndex:"tree",isHidden:!0,enableDragAndDrop:!1,isSortable:!1,isDraggable:!1},{text:a.Filter_Name,dataIndex:"label",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1,width:120},{text:a.Filter_Number,dataIndex:"buidnumber",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1},{text:a.Filter_Status,dataIndex:"status",enableDragAndDrop:!1,isSortable:!1,isDraggable:!1,width:"auto"}],roots:u,alternateRowColor:!0};h.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:45,isDraggable:!1,isHidden:!!s.opts.isReadOnly});var v=new r(h);v.getManager().forceMultiSelection(!0),null==this.opts.displayCompactMode||!1===this.opts.displayCompactMode?v.getManager().touchMode=!0:v.getManager().touchMode=!1,v.getDocument().options.shouldAcceptDrag=function(){return!1},v.getDocument().options.shouldAcceptDrop=function(){return!1},this.unitLayoutTreeListViewContainer=new UWA.Element("div",{class:"unitLayoutTreeListViewContainer"}),v.inject(this.unitLayoutTreeListViewContainer),v.elements.container.addClassName("unitalternaterow"),v.elements.container.addClassName("unitheader"),v.elements.container.addClassName("unithighlighted"),v.getNthRoot(0).hide(),this.unitLayoutExpressionDiv=new UWA.Element("div",{class:"unitLayoutExpressionDiv"}),s.initialiseExpressionContainer(),s.tree=v,UWA.Element.addEvent.call(document,"keyup",function(e){s.event1=e.shiftKey,s.tree.getManager().forceMultiSelection(!0)}),UWA.Element.addEvent.call(document,"keydown",function(e){s.event1=e.shiftKey,s.tree.getManager().forceMultiSelection(!0)}),s.tree.onNodeClick(function(e){!0!==s.opts.isReadOnly&&("label"!=e.dataIndex&&"buidnumber"!=e.dataIndex&&"status"!=e.dataIndex||""!=e.nodeModel)&&("selection"==e.dataIndex&&""==e.nodeModel?s.selectionNodeData(e):1==s.event1&&0==s.unitInfiniteToggle.cfgToggle.checkFlag&&s.tree.getManager().getDocument().getXSO().get().length>=1?s.selectionNodewithShiftKey(e):s.selectionNodeData(e))}),this.buildOrderSequence(this.textboxinput),"Filter"!=this.opts.invokeFrom||"Native"==window.enoviaServerFilterWidget.mode?this.getLayout():this.getPanel(),require(["DS/CfgEvolutionUX/CfgUnit"],function(t){s.CfgUnit=new t({displayCompactMode:s.opts.displayCompactMode,parentElement:s.unitLayoutExpressionDiv}),s.CfgUnit.ExpressionMode=!0,s.CfgUnit.allRoots=s.tree.getRoots(),s.CfgUnit.selectedNodes=s.selectedNodes,s.CfgUnit.currentDictionary=e,s.CfgUnit.currentModel=s.currentModel,s.CfgUnit.fields=s.fields,s.CfgUnit.render(),s.CfgUnit.editButton.hide(),s.CfgUnit.textBox.value=s.CfgUnit.fields,!0===s.opts.isReadOnly&&(s.CfgUnit.textBox.disabled=!0),"Filter"==s.opts.invokeFrom&&m.unmask(s.opts.filterParent)}),new ResizeObserver(e=>{e[0].target.getDimensions().width<530&&a.Filter_InfinitySelectionMode.length>25||e[0].target.getDimensions().width<460&&a.Filter_InfinitySelectionMode.length>20||e[0].target.getDimensions().width<370?this.unitInfiniteToggle.hideToggleLabel("UNIT"):(e[0].target.getDimensions().width>=420&&a.Filter_InfinitySelectionMode.length<=20||e[0].target.getDimensions().width>=475&&a.Filter_InfinitySelectionMode.length<=25||e[0].target.getDimensions().width>=530)&&this.unitInfiniteToggle.showToggleLabel("UNIT")}).observe(this.CfgUnitToolbarContainer),this.CfgUnitToolbarContainer.getDimensions().width<420&&a.Filter_InfinitySelectionMode.length>25&&this.unitInfiniteToggle.hideToggleLabel("UNIT")},applyCompactComfortableModeViewExpressionIcon:function(){null==this.opts.displayCompactMode||0==this.opts.displayCompactMode?(this.expressionToolbarContainer.getElement(".divider").setAttributeNode(document.createAttribute("touch-mode")),this.expressionToolbarContainer.getElement("span.fonticon-book-open").setAttributeNode(document.createAttribute("touch-mode")),this.expressionToolbarContainer.getElement(".item").setAttributeNode(document.createAttribute("touch-mode"))):(this.expressionToolbarContainer.getElement(".divider").removeAttribute("touch-mode"),this.expressionToolbarContainer.getElementsByClassName("fonticon-book-open")[0].removeAttribute("touch-mode"),this.expressionToolbarContainer.getElement(".item").removeAttribute("touch-mode"))},initialiseExpressionContainer:function(){UWA.createElement("div",{styles:{height:"100%"},html:[this.CfgUnitToolbarContainer,this.unitLayoutTreeListViewContainer]}).inject(this.MainContainer);var e={viewContainer:this.MainContainer,effExpHeaderTitle:a.Filter_UnitExpression,expressionContainer:this.unitLayoutExpressionDiv,defaultExpressionContainerHeight:57,displayCompactMode:this.opts.displayCompactMode,inputData:"",minimizeTooltip:l.CfgLabelMinimize,maximizeTooltip:l.CfgLabelMaximize};this.cfgExpressionViewObj=new v(e),this.cfgExpressionViewObj.render()},selectionNodewithShiftKey:function(e){var t=this.tree.getManager().getDocument().getAllDescendants();t.splice(0,1);var i=this.tree.getManager().getDocument().getXSO().get().length;"selection"==e.dataIndex?this.lastselectedNode=this.tree.getManager().getDocument().getXSO().get()[i-1]:this.lastselectedNode=this.tree.getManager().getDocument().getXSO().get()[i-2];var o=t.length;if(parseInt(this.lastselectedNode.options.buildnumber)>parseInt(e.nodeModel.options.buildnumber))for(var n=0;n<o;n++){(s=t[n]).options.buildnumber==this.lastselectedNode.options.buildnumber&&(a=0),0==a&&(s.select(),-1==this.selectedNodes.indexOf(s.options.buildnumber)&&this.selectedNodes.push(s.options.buildnumber)),e.nodeModel.options.buildnumber==s.options.buildnumber&&(a=1)}else for(n=0;n<o;n++){var s,a;(s=t[n]).options.buildnumber==e.nodeModel.options.buildnumber&&(a=0),0==a&&(s.select(),-1==this.selectedNodes.indexOf(s.options.buildnumber)&&this.selectedNodes.push(s.options.buildnumber)),s.options.buildnumber==this.lastselectedNode.options.buildnumber&&(a=1)}var l={model:this.selectedNodes};this.CfgUnit.selectionBuilds(l)},selectionNodeData:function(e){var t=this;if(""!=e.nodeModel){if(1!=this.unitInfiniteToggle.cfgToggle.checkFlag||e.isHeader)this.selectionCheck=e.nodeModel.isSelected(),this.selectionCheck?-1==t.selectedNodes.indexOf(e.nodeModel.options.buildnumber)&&t.selectedNodes.push(e.nodeModel.options.buildnumber):(t.selectedNodes.indexOf(e.nodeModel.options.buildnumber)>-1&&(t.selectedNodes.erase(e.nodeModel.options.buildnumber),e.nodeModel.unselect()),-1==t.selectedNodes.indexOf(t.tree.getNthRoot(1).options.buildnumber)&&t.selectedNodes.indexOf(a.unitInfinity)>-1&&(t.selectedNodes.erase(a.unitInfinity),t.tree.getNthRoot(0).unselect()));else if(this.selectionCheck=e.nodeModel.isSelected(),this.selectionCheck)for(var i=(l=this.tree.getManager().getDocument().getAllDescendants()).length,o=0,n=0;n<i;n++){var s=(r=l[n]).isRoot();0==o&&1==s&&(r.select(),-1==this.selectedNodes.indexOf(r.options.buildnumber)&&this.selectedNodes.push(r.options.buildnumber)),e.nodeModel.options.buildnumber==r.options.buildnumber&&(o=1)}else{var l;for(i=(l=this.tree.getManager().getDocument().getAllDescendants()).length,o=0,n=0;n<i;n++){var r;s=(r=l[n]).isRoot();0==o&&1==s&&(r.unselect(),this.selectedNodes.indexOf(r.options.buildnumber)>-1&&this.selectedNodes.erase(r.options.buildnumber)),e.nodeModel.options.buildnumber==r.options.buildnumber&&(o=1)}}c={model:t.selectedNodes},u=t.CfgUnit.selectionBuilds(c);t.CfgUnit.textBox.value=u}else{if(0!=t.tree.getManager().getDocument().getXSO().get().length){t.tree.getRoots().forEach(function(e){e.select()});var d=t.tree.getManager().getDocument().getSelectedNodes();t.selectedNodes=[],d.forEach(function(e){t.selectedNodes.push(e.options.buildnumber)})}else t.tree.getRoots().forEach(function(e){e.unselect(),t.selectedNodes=[]});var c={model:t.selectedNodes},u=t.CfgUnit.selectionBuilds(c);t.CfgUnit.textBox.value=u}},rootBuildsData:function(e,t){var i={label:" ",buildnumber:a.unitInfinity,status:" ",grid:{label:" ",buidnumber:a.unitInfinity,status:" "}};if(e.push(i),null!=t&&(0!==Object.keys(t).length||t.constructor!==Object)){for(var o=0;o<t.length;o++){var n={label:t[o].name,buildnumber:t[o].buildOrder,id:t[o].id,status:t[o].current,grid:{label:t[o].name,buidnumber:t[o].buildOrder,status:t[o].current_NLS}};e.push(n)}e.sort(function(e,t){return parseInt(t.buildnumber)-parseInt(e.buildnumber)})}},getModal:function(){var e=this;e.dialog=new o({className:"site-reset",closable:!0,header:"<h4>"+a.Filter_Dialog_Unit_Header+"</h4>",body:this.MainContainer,footer:this.createActionsPresenter(),events:{onHide:function(){d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),e.dialog.destroy()}}}).inject(d.renderTo=document.body),e.dialog.elements.body.addClassName("unitbody-modal-body"),e.dialog.elements.content.addClassName("unit-modal-content"),e.dialog.show(),e.dialog.getContent().getElements(".btn-primary").forEach(function(t){t.addEvent("click",function(){d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}}),e.dialog.destroy()})}),e.dialog.getContent().getElements(".btn-default").forEach(function(t){t.addEvent("click",function(){e.selectedNodes=[],d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),e.dialog.destroy()})})},getLayout:function(){var e=this,t={isHeader:!0,isFooter:!0,firstButtonText:a.CFG_Apply,secondButtonText:a.CFG_Back,headerText:a.Filter_Dialog_Unit_Header,onButtonClickCB:function(t){if("firstButton"==t.buttonId){if(0==e.CfgUnit.validate()||e.CfgUnit.fields.length>0&&e.CfgUnit.fields[0].includes("NOT"))return void e.CfgUnit.showAlert();d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}})}else"secondButton"==t.buttonId&&d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}});e.containerView.destroy()}};this.containerView=new h(t).render(),this.containerView.getContent().addClassName("CfgContainerView-EditEvolution-SelectEvolutionData"),this.containerView.inject(d.renderTo),this.MainContainer.inject(this.containerView._body)},getPanel:function(){var e=this,t={dialogue:{buttonArray:[{label:a.Filter_Cancel,handler:function(){e.selectedNodes=[],d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:null}}),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){document.querySelector(".operations-main-container").destroy(),e.showFilter()})},className:"default"},{label:a.Filter_Apply,handler:function(t){d.ModelEvents.publish({event:"UnitsDialogClosed",data:{model:e.selectedNodes}}),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){document.querySelector(".operations-main-container").destroy(),e.showFilter()})},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:a.Filter_Dialog_Unit_Header,displayCompactMode:this.opts.displayCompactMode};u.init(d.renderToApp,this.MainContainer,t,p)},createActionsPresenter:function(){var e=UWA.createElement("div",{});new s({value:a.Filter_Apply,className:"primary btn btn-primary okBtn"}).inject(e),new s({value:a.Filter_Cancel}).inject(e);return e},selectNodesByBuildNumber:function(e){var t=this;t.selectedNodes=[];for(var i=this.tree.getManager().getDocument().getAllDescendants(),o=0;o<e.length;o++)if(-1!=e[o].indexOf("+")){var n=e[o].split("+").slice(0,-1);i.forEach(function(e){(parseInt(e.options.buildnumber)>=parseInt(n)||e.options.buildnumber==a.unitInfinity)&&(e.select(),-1==t.selectedNodes.indexOf(e.options.buildnumber)&&t.selectedNodes.push(e.options.buildnumber))})}else i.forEach(function(i){i.options.buildnumber==e[o]&&(i.select(),-1==t.selectedNodes.indexOf(i.options.buildnumber)&&t.selectedNodes.push(i.options.buildnumber))})},unitsFilterFromTable:function(e){var t=this;if(this.selectedRow=[],this.filterStatus=!1,void 0!==this.selectedNodes)for(var i=0;i<this.selectedNodes.length;i++)this.selectedRow.push(this.selectedNodes[i]);this.roots=this.tree.getRoots(),this.roots.length>0&&this.roots[0].prepareUpdate();for(i=0;i<e.length;i++)t.buildorder=e[i],this.roots.forEach(function(e){if(e.options.buildnumber.indexOf(t.buildorder)>-1||e.options.label.toUpperCase().indexOf(t.buildorder.toUpperCase())>-1){for(var i=0;i<t.selectedRow.length;i++)e.options.buildnumber==t.selectedRow[i]&&e.select();e.options.buildnumber==a.unitInfinity?e.hide():e.show()}else e.hide()});this.roots[0].pushUpdate()},buildOrderSequence:function(e){this.sequenceNumber=[];for(var t=0;t<e.length;t++){if(-1!==e[t].indexOf("-"))for(var i=e[t].split("-");parseInt(i[0])<=parseInt(i[1]);){this.sequenceNumber.push(i[0]);var o=i[0];o++,i[0]=o.toString()}else this.sequenceNumber.push(e[t])}this.selectNodesByBuildNumber(this.sequenceNumber)},buildSequenceInsideTable:function(){this.sequenceNumber=[];for(var e=this.lineEditor.valueToCommit.split(","),t=0;t<e.length;t++)this.sequenceNumber.push(e[t]);this.unitsFilterFromTable(this.sequenceNumber)}}}),define("DS/CfgEvolutionUX/CfgFilterView",["DS/CfgBaseUX/scripts/CfgUtility","UWA/Drivers/Alone","DS/Core/Core","UWA/Class/View","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","css!DS/UIKIT/UIKIT.css"],function(e,t,i,o,n,s,a,l,r,d){"use strict";return o.extend({isLicenseValid:!1,toggle:[],init:function(t){this._parent(t);var i=this;e.rolesAvailable(function(e){if(i.userGrantedRoles=e,e.isCFGRoleAvail)return i.isLicenseValid=!0,void i.render();e.isCSVRoleAvail&&(i.isLicenseValid=!1)})},setup:function(e){},render:function(){if(1==this.isLicenseValid){var e=UWA.createElement("div",{}),t=UWA.createElement("div");t.setStyles({width:"auto",float:"left",marginLeft:"0px"});var i=UWA.createElement("div");i.setStyles({width:"auto",float:"left",marginLeft:"10px"}),this.toggle[0]=new n({checkFlag:!0,name:"ViewOptions",type:"radio",id:"ofcView",label:r.Filter_official_view,className:"primary"}).inject(t),this.toggle[1]=new n({name:"ViewOptions",type:"radio",id:"prjView",label:r.Filter_projected_view,className:"primary"}).inject(i),t.inject(e),i.inject(e),e.inject(this.options.parentElement);var o=new s;o.inject(e),o.addChild(this.toggle[0]),o.addChild(this.toggle[1]),o.getContent().setStyle("display","flex"),this.toggle[1].getContent().setStyle("margin-left","20px"),this.toggle[1].getContent().setAttribute("id","prjView"),this.toggle[0].getContent().setAttribute("id","ofcView"),null!=this.options.viewJson&&this.setSelectedView(this.options.viewJson.view)}},getJSON:function(){return{view:this.getSelectedView()}},getSelectedView:function(){return this.toggle[0].checkFlag?"Current":this.toggle[1].checkFlag?"Projected":void 0},setSelectedView:function(e){"Current"==e?this.toggle[0].checkFlag=!0:"Projected"==e&&(this.toggle[1].checkFlag=!0)}})}),define("DS/CfgEvolutionUX/CfgDatePickerUtilities",["UWA/Core","DS/UIKIT/Input/Date","DS/UIKIT/Input/Button","DS/UIKIT/Alert","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n){return{}}),define("DS/CfgEvolutionUX/CfgEvolutionUtils",["UWA/Core","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility"],function(e,t,i,o,n){return{getEvolutionDisplayExpression:function(e,t,i){var s=i.xml,a="";-1==s.search("TreeSeries")&&-1==s.search("MilestonesTrack")?"PRODUCTS"==t?a=o.buildTreeSeries("ProductState",e,s):"MANUFACTURINGPLAN"==t&&(a=o.buildTreeSeries("ManufPlan",e,s)):a=s;var l="";return l=i.description?o.startEvolutionXML()+a+"</Expression><Description>"+i.description+"</Description></CfgEffectivityExpression>":o.startFilterXML()+a+o.endFilterXML(),n.getDisplayExpressionUsingXSLT(l)},GetEvolutionExpressionAndJson:function(e){var i={xml:"",json:[]};if(e){var o=e.getRoots()[0];if(o){var n=[],s=e.getAllDescendants(),a=[];if(e.getSelectedNodes().forEach(function(e){a.push(e.options.id)}),a.indexOf(o.options.id)>=0&&""==o.__LISTVIEWCOPY__.options.grid.range){var l=o.options.name,r=o.options.revision,d=o.options.displayname?o.options.displayname:o.options.label,c=t.getRange(l,r,d);n.push(c)}this.parseEffectivity(null,o,n,s,a);var u=this.buildFilterXML(n);i.xml=u.xml,i.json=n,i.description=u.descTag}}return i},buildFilterXML:function(e){var t="";null==window.DescriptionCount&&(window.DescriptionCount=1);for(var i={iCount:window.DescriptionCount,iDescriptionTag:[]},o=0;o<e.length;o++)t+=e[o].buildXML(i),i.iCount++,window.DescriptionCount++;return{xml:t,descTag:i.iDescriptionTag}},parseEffectivity:function(e,i,o,n,s){if(i){if(s.indexOf(i.options.id)>=0&&""!=i.__LISTVIEWCOPY__.options.grid.range&&null==e){var a=i.options.name,l=i.options.revision,r=i.options.displayname?i.options.displayname:i.options.label;e=t.getRange(a,l,r,!0),o.push(e)}var d=i.getChildren();null==d&&(d=[]);var c=null;if(1==(g=i.isRoot()))for(var u=n.length,p=0,m=0;m<u;m++){var h=n[m],g=h.isRoot();if(1==p&&1==g){c=h;break}1==g&&i.options.name==h.options.name&&i.options.revision==h.options.revision&&(p=1)}for(u=d.length,m=0;m<=u;m++){var f=null;if(m==u){if(null==c)continue;f=c}if(null==f&&(f=d[m]),""!=f.options.label||1!=f.options.isEmpty){var v="";if(s.indexOf(f.options.id)>=0&&""!=f.__LISTVIEWCOPY__.options.grid.range?v="infinity":-1==s.indexOf(f.options.id)?v="unselected":s.indexOf(f.options.id)>=0&&""==f.__LISTVIEWCOPY__.options.grid.range&&(v="selected"),"unselected"!=v&&"selected"!=v||null==e){if("infinity"==v&&null!=e)this.parseEffectivity(e,f,o,n,s);else if("unselected"==v&&null==e){E=null;this.parseEffectivity(E,f,o,n,s)}else if("infinity"==v&&null==e){E=null;this.parseEffectivity(E,f,o,n,s)}else if("selected"==v&&null==e){b=f.options.name,x=f.options.revision,r=f.options.displayname?f.options.displayname:f.options.label;var C=t.getRange(b,x,r,!1);o.push(C);C=null;this.parseEffectivity(C,f,o,n,s)}}else{var D=!0;"selected"==v&&(D=!1);var b=f.options.name,x=f.options.revision,r=f.options.displayname?f.options.displayname:f.options.label;e.addLeaves(b,x,r,D);var E=null;this.parseEffectivity(E,f,o,n,s)}}}}},parseRootBranches:function(e,t){var i=[],o=!1;"Obsolete"!=e.current&&"Release"!=e.current&&"Review"!=e.current&&"Archived"!=e.current||"FILTER"==t||(o=!0);var n=e.displayValue;null!=n&&null!=n&&0!=n.length||(n=e.name);var s={label:n,image:e.image,name:e.name,displayname:n,originated:e.originated,data:{frozen:o},icons:[],revision:e.revision,current:e.current_NLS,grid:{revision:e.revision},id:e.id,parentid:null,input:"Revision"};return i.push(s),e.Derived&&this.addChildren(s,e.Derived,e.id,"Derivation",t),this.mainderived(i,e["Main Derived"],e.id,"Revision",t),i},mainderived:function(e,t,i,o,n){if(null!=t&&(0!==Object.keys(t).length||t.constructor!==Object)){var s=!1;"Obsolete"!=t.current&&"Release"!=t.current&&"Review"!=t.current&&"Archived"!=t.current||"FILTER"==n||(s=!0);var a=t.displayValue;null!=a&&null!=a&&0!=a.length||(a=t.name);var l={label:a,image:t.image,name:t.name,displayname:a,originated:t.originated,data:{frozen:s},icons:[],revision:t.revision,current:t.current_NLS,grid:{revision:t.revision},id:t.id,parentid:i,input:o};e.push(l),this.addChildren(l,t.Derived,t.id,"Derivation",n),this.mainderived(e,t["Main Derived"],t.id,"Revision",n)}},addChildren:function(e,t,i,o,n){null!=e.children&&0!=e.children.length||(e.children=[]);for(var s=0;s<t.length;s++){var a=!1;"Obsolete"!=t[s].current&&"Release"!=t[s].current&&"Review"!=t[s].current&&"Archived"!=t[s].current||"FILTER"==n||(a=!0);var l=t[s].displayValue;null!=l&&null!=l&&0!=l.length||(l=t[s].name);var r={label:l,image:t[s].image,name:t[s].name,displayname:l,originated:t[s].originated,data:{frozen:a},revision:t[s].revision,current:t[s].current_NLS,grid:{revision:t[s].revision},id:t[s].id,parentid:i,input:o};e.children.push(r),this.addChildren(r,t[s].Derived,r.id,"Derivation",n);var d=t[s]["Main Derived"];0!=Object.keys(d).length&&d.constructor===Object&&this.addChildren(e.children[e.children.length-1],[d],e.children[e.children.length-1].id,"Revision",n)}}}}),define("DS/CfgEvolutionUX/CfgDateModel",["UWA/Core","UWA/Class/Model","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX"],function(e,t,i,o){return t.extend({urlRoot:"/Date",id:"",type:"",fromDate:"",fromDateMilliSec:"",fromDateMinValue:"",toDate:"",toDateMilliSec:"",toDateMinValue:"",isThisOnlyModelInCollection:!1,defaults:function(){return{id:"",type:"",fromDate:"",fromDateMilliSec:"",fromDateMinValue:"",toDate:o.CfgDateInf,toDateMilliSec:"",toDateMinValue:"",isThisOnlyModelInCollection:!1}},isEmpty:function(){return"single"==this.get("type")?""==this.get("fromDateMilliSec"):"range"==this.get("type")?""==this.get("fromDateMilliSec")&&""==this.get("toDateMilliSec"):void 0}})}),define("DS/CfgEvolutionUX/CfgUnit",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/Controls/TooltipModel","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","UWA/Class/View","UWA/Controls/Input","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgEvolutionUX/CfgWUXUnitLayout","DS/Controls/LineEditor","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m){"use strict";return s.extend({textBox:null,textdiv:null,currentDictionary:null,atLeastOneUnitAllocated:!1,currentModel:null,setup:function(e){this._parent(e)},render:function(){var e=this;if(this.existingEffFrozenBuildsArr=[],this.textdiv=UWA.createElement("div",{id:"textDiv",class:"unitTextDiv",styles:{width:"100%","font-weight":"normal"}}).inject(this.options.parentElement),"EFF_VIEW"!=e.options.use)return this.textBox=new p({}).inject(this.textdiv),null==this.options.displayCompactMode||0==this.options.displayCompactMode?(this.textBox.touchMode=!0,this.textBox.elements.container.getElement("input").setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.touchMode=!1,this.textBox.elements.container.getElement("input").removeAttribute("touch-mode")),this.textBox.addEventListener("uncommittedChange",function(t){t.keyCode;8!=t.keyCode&&46!=t.keyCode&&e.textBox.valueToCommit.endsWith(",")&&(e.textBox.value=e.textBox.valueToCommit+" ");var i=e.validate();e.ExpressionMode&&1==i&&(e.fields=e.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(","),e.allRoots.forEach(function(e){e.unselect()}),u.buildOrderSequence(e.fields)),e&&e.textBox&&e.textBox.tooltipInfos&&e.textBox.tooltipInfos.shortHelp&&(e.textBox.tooltipInfos.shortHelp=e.textBox.valueToCommit)}),this.label=UWA.createElement("Label",{html:n.Filter_UnitLabel,styles:{"font-weight":"normal"}}).inject(this.textdiv),this.editButton=UWA.createElement("span",{class:"fonticon fonticon-search "}).inject(this.options.parentElement),this.editButton.set({events:{click:function(t){1!=e.editButton.hasClassName("disableButton")&&e.validate()&&("Filter"==e.options.invokeFrom&&m.mask(e.options.filterParent),e.onUnitSelectionDialogLaunched(t,e))}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),"UnitFiring"==e.options.usage&&e.editButton.hide(),!0===e.options.isReadOnly&&(this.textBox.disabled=!0),l.ModelEvents.subscribe({event:"UnitsDialogClosed"},function(t){e.selectionBuilds(t)}),l.ModelEvents.subscribe({event:"modelUpdated"},function(t){e.atLeastOneUnitAllocated=!1,null==t.noEvolutionUpdate&&e.updateDictionary(t)}),this.label.addClassName("CfgUnitTextBoxLabel"),this.applyCompactComfortableMode(),this},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.label.setAttributeNode(document.createAttribute("touch-mode")),this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.label.removeAttribute("touch-mode"),this.editButton.removeAttribute("touch-mode"))},updateDictionary:function(e){var t=this;return new Promise(function(i,o){m.mask(l.renderTo);var n=e;t.currentModel=n;var s="";s=n.model.valueItem.constructor==Array?n.model.value[0]:n.model.valueItem;var a=l.getDictionaryByCriteria(s,"builds");if(null==a.builds){var d=r.getDictionaryFromServer(s,"builds"),c=t;d.then(function(e){l.addDictionaryByCriteria(s,e,"builds"),c.currentDictionary=l.getDictionaryByCriteria(s,"builds"),c.checkingcurrentDictionary(),m.unmask(l.renderTo),i()})}else t.currentDictionary=a,t.checkingcurrentDictionary(),m.unmask(l.renderTo),i()})},checkingcurrentDictionary:function(){var e=this.currentDictionary.builds;if(u.rootBuildsData([],e),null==e||0==e.length?(this.textBox.value="",this.editButton.addClassName("disableButton"),this.textBox.disabled=!0):(!0===this.options.isReadOnly?this.textBox.disabled=!0:this.textBox.disabled=!1,this.editButton.removeClassName("disableButton")),r.isParamDefined(this.existingUnitsExpr)){let e=this.existingUnitsExpr.replace(/\s*,\s*/g,",").split(",");e.length>0&&(this.existingEffFrozenBuildsArr=this.frozenUnitCheck(e))}},checkUnitsAllocation:function(){for(var e=0;e<this.currentDictionary.builds.length;e++)if(""!=this.currentDictionary.builds[e].allocated){this.atLeastOneUnitAllocated=!0,l.ModelEvents.publish({event:"showOrHideComponentsExceptUnit",data:{unitAllocation:this.atLeastOneUnitAllocated}});break}},selectionBuilds:function(e){if(null!==e.model){var t=this;this.arr=[],this.Final="";var i=!1,o=!1;e.model.forEach(function(e){var i=parseInt(e);t.arr.push(i),t.arr.sort(function(e,t){return isFinite(e-t)?e-t:isFinite(e)?-1:1})});for(var n=0;n<this.arr.length;n++){if(0==isFinite(this.arr[n])||i&&0==isFinite(this.arr[n+1])&&n+1<this.arr.length){o=!0;break}i||(this.Final=this.Final+this.arr[n]),parseInt(this.arr[n])+1==parseInt(this.arr[n+1])?i||(this.Final=this.Final+"-",i=!0):i?(this.Final=this.Final+this.arr[n]+",",i=!1):this.Final=this.Final+","}return this.Final=this.Final.slice(0,-1),o&&(this.Final=this.Final+"+"),this.textBox.value=this.Final.replace(/\s*,\s*/g,", "),this.Final.replace(/\s*,\s*/g,", ")}},onUnitSelectionDialogLaunched:function(e,t){var i={};this.fields=t.textBox.valueToCommit.replace(/\s*,\s*/g,",");var o,n="";n=t.currentModel.model.valueItem.constructor==Array?t.currentModel.model.value[0]:t.currentModel.model.valueItem;var s=l.renderTo.getElements(".cfgEvoCritModalVariableHeight");o=void 0!==s&&s.length>0?s[0].parentElement:void 0!==l.renderTo&&null!=l.renderTo?l.renderTo:l.renderTo.getElements(".modal-content")[0],m.mask(o),t.currentDictionary=l.getDictionaryByCriteria(n,"builds"),i.mode=t.options.mode,i.invokeFrom=t.options.invokeFrom,i.filterParent=t.options.filterParent,i.rangeEnable="",i.displayCompactMode=t.options.displayCompactMode,i.isReadOnly=t.options.isReadOnly,m.unmask(o),0!=t.options.parentElement.className.indexOf("filter")&&(i.rangeEnable=!0),l.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}}),u.create(this.currentDictionary,this.fields,this.currentModel,i)},show:function(){this.textBox.show(),this.label.show(),this.editButton.show()},hide:function(){this.textBox.hide(),this.label.hide(),this.editButton.hide()},getJson:function(){if(""==this.textBox.valueToCommit){var e={builds:[]};return JSON.stringify(e)}if(0!=this.validate()){for(var t=this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(","),i=(e={builds:[]},0),o=t.length;i<o;i++){var n=t[i].indexOf("-"),s=t[i].indexOf("+");if(-1!==n||-1!==s){if(-1!==n)var a=t[i].split("-");if(-1!==s)a=t[i].split("+");if(""==a[1]){var l={start:{buildOrder:a[0]},end:{buildOrder:"INF"}};e.builds.push(l)}else{l={start:{buildOrder:a[0]},end:{buildOrder:a[1]}};e.builds.push(l)}}else{var r={start:{buildOrder:t[i]},end:null};e.builds.push(r)}}return JSON.stringify(e)}},SetJson:function(e){if(void 0!==e&&null!=e&&0!=e.length){for(var t=JSON.parse(e).builds,i=[],n=0;n<t.length;n++){var s=t[n].start.buildOrder,a=t[n].end;if(null!=a)var l=a.buildOrder;null==a?i.push(s):"INF"==l?i.push(s+"+"):i.push(s+"-"+l)}var d="";for(n=0;n<i.length;n++)d=0==n?i[0]:d+","+i[n];return"EFF_VIEW"==this.options.use?(this.textdiv.innerHTML=d,this.textdiv.tooltipInfos=new o({shortHelp:d})):(""==d&&null!=this.options.expression&&r.isParamDefined(this.options.expression.notUnitDesc)&&(d=this.options.expression.notUnitDesc.toString().trim()),this.textBox.value=d,this.textBox.tooltipInfos=new o({shortHelp:d}),this.existingUnitsExpr=this.textBox.value),d}},buildUnitXML:function(e,t){let i=this;if(0==this.validate())return this.showAlert(),null;this.textBox.value=this.textBox.valueToCommit.replace(/(\s*,\s*)+/g,","),this.textBox.valueToCommit.endsWith(",")&&(this.textBox.value=this.textBox.valueToCommit.substr(0,this.textBox.valueToCommit.length-1)),this.textBox.valueToCommit.startsWith(",")&&(this.textBox.value=this.textBox.valueToCommit.substr(1,this.textBox.valueToCommit.length));var o="";if(o=r.isDefined(t)&&0==t?"":this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(","),"Filter"!=this.options.invokeFrom){let e=[];if((e=this.frozenUnitCheck(o)).length>0&&("SessionEffectivity"===this.options.invokeFrom||"Applicability"===this.options.invokeFrom||"EditEvolution"===this.options.invokeFrom&&0==this.existingEffFrozenBuildsArr.length))return this.showAlert(n.CfgFrozenUnitErrorInEditEvol),null;if("EditEvolution"===this.options.invokeFrom&&this.existingEffFrozenBuildsArr.length>0){if(e.filter(function(e){return i.existingEffFrozenBuildsArr.includes(e)}).length<this.existingEffFrozenBuildsArr.length)return this.showAlert(n.CfgFrozenUnitRemovedFromExisting),null;if(e.length>this.existingEffFrozenBuildsArr.length)return this.showAlert(n.CfgNewFrozenUnits),null}}if(""==o)return"";for(var s="",a=0,l=o.length;a<l;a++){var d=o[a].indexOf("-"),u=o[a].indexOf("+");if(-1!==d||-1!==u){if(-1!==d)var p=o[a].split("-");if(-1!==u)p=o[a].split("+");var m=p[0],h=p[1],g=c.buildFrom(m),f=c.buildTo(h),v=c.buildRange(g,f);0==a?s=v:s+=v}else{var C=o[a],D=c.buildSingleValue(C);0==a?s=D:s+=D}}return c.buildSeries("Unit",e,s)},frozenUnitCheck:function(e){let t=[];for(let i=0;i<e.length;i++){let o=!1,n=!1;if(-1!==e[i].indexOf("-")){let n=e[i].split("-");for(;parseInt(n[0])<=parseInt(n[1]);){t.push(n[0]);let e=n[0];e++,n[0]=e.toString()}o=!0}if(-1!==e[i].indexOf("+")){let o=e[i].split("+");o=o.slice(0,-1),o=parseInt(o),this.currentDictionary.builds.forEach(function(e){parseInt(e.buildOrder)>=o&&-1==t.indexOf(e.buildOrder)&&t.push(e.buildOrder)}),n=!0}o||n||t.push(e[i])}if(0==t.length)return t;let i=[];for(let e=0;e<t.length;e++)this.isFrozen(t[e])&&i.push(t[e]);return i},isFrozen:function(e){let t=!1;for(let i=0;i<this.currentDictionary.builds.length;i++){let o=this.currentDictionary.builds[i];if(o.buildOrder==e&&"Complete"==o.current){t=!0;break}}return t},validate:function(){var e="";if(null!=this.currentModel){e=this.currentModel.model.valueItem.constructor==Array?this.currentModel.model.value[0]:this.currentModel.model.valueItem,this.currentDictionary=l.getDictionaryByCriteria(e,"builds"),this.checkingcurrentDictionary();var t=!0;if(""==this.textBox.valueToCommit)return this.alertStatus(t),t;if(", "==this.textBox.valueToCommit){t=!1;return this.alertStatus(t),t}var i=this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(",");if(-1!=this.textBox.valueToCommit.indexOf("."))t=!1;else if(this.textBox.valueToCommit.indexOf("NOT")>=0)t=!0;else for(var o=0,n=(i=this.textBox.valueToCommit.replace(/\s*,\s*/g,",").split(",")).length;o<n&&0!=t;o++){if(-1!==i[o].indexOf("-")&&"-"!=i[o]){var s=(r=i[o].split("-")).length,a=parseInt(r[0]);if((d=parseInt(r[1]))!=r[1]){t=!1;break}if(i[o].indexOf("-")&&isNaN(d)||isNaN(a)){t=!1;break}if(!isNaN(a)&&!isNaN(d)&&a<d&&null!=d&&2==s)t=1==this.isPresent(a,this.currentDictionary)&&this.isPresent(d,this.currentDictionary);else if(isNaN(a)||isNaN(d)){if(!isFinite(a)&&isFinite(a))t=""==r[1]}else if(a==d||a>d){t=!1;break}}else{if(-1!==i[o].indexOf("+")&&"+"!=i[o]){s=(r=i[o].split("+")).length,a=parseInt(r[0]);var r,d=parseInt(r[1]);if(isNaN(a)||!isNaN(d)){t=!1;break}if(1!=this.isPresent(a,this.currentDictionary)){t=!1;break}t=!0}else if(0==(t=this.isPresent(i[o],this.currentDictionary)))break}}return this.alertStatus(t),t}},alertStatus:function(e){e?e&&this.textBox.elements.container.getElement("input").removeClassName("AlertStyles"):(null!=this.alert&&this.alert.hide(),this.textBox.elements.container.getElement("input").addClassName("AlertStyles"))},showAlert:function(e){this.alert=new d({visible:!0,autoHide:!0,hideDelay:3500}).inject(this.options.parentElement,"top"),this.alert.elements.container.addClassName("CfgAlert");let t=r.isParamDefined(e)?e:n.Filter_UnitAlert+this.buildUnitNumbers();this.alert.add({className:"error",style:{position:"absolute"},message:t})},buildUnitNumbers:function(){for(var e=new Array(this.currentDictionary.builds.length),t=0;t<this.currentDictionary.builds.length;t++)e[t]=parseInt(this.currentDictionary.builds[t].buildOrder,10);e.sort(function(e,t){return e-t});var i="",o=null,n=null,s=null,a=null;for(t=0;t<e.length;t++)o=e[t],0!=t?o-(n=e[t-1])>1?(s==(a=n)?i=s+",":i+=s+"-"+a+",",s=o):a=o:s=o;return null!=s&&(i+=s),null!=a&&(i+="-"+a),i},initialiseComponent:function(){if("EFF_VIEW"!=this.options.use){this.currentModel={model:{labelItem:[this.options.expression.name],valueItem:this.options.expression.modelId}};var e="";e=this.currentModel.model.valueItem.constructor==Array?this.currentModel.model.value[0]:this.currentModel.model.valueItem;var t=l.getDictionaryByCriteria(e,"builds");if(null==t.builds){var i=r.getDictionaryFromServer(e,"builds"),o=this;i.then(function(t){l.addDictionaryByCriteria(e,t,"builds"),o.currentDictionary=l.getDictionaryByCriteria(e,"builds"),o.checkingcurrentDictionary()})}else this.currentDictionary=t,this.checkingcurrentDictionary()}},isPresent:function(e,t){for(var i=!1,o=0;o<this.currentDictionary.builds.length;o++){this.currentDictionary.builds[o].buildOrder!=e&&""!=e||(i=!0)}return i}})}),define("DS/CfgEvolutionUX/CfgUnitFilterDialog",["DS/Core/Core","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgUnit","DS/CfgEvolutionUX/CfgModelSelection","DS/Controls/Toggle","DS/Controls/TooltipModel","DS/UIKIT/Spinner","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d){"use strict";return{}}),define("DS/CfgEvolutionUX/CfgVersionGraphLayout",["DS/UIKIT/Modal","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgEvolutionUtils","DS/CfgVersionGraphUX/scripts/CfgVersionGraph","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r){"use strict";return UWA.Class.extend({_options:null,init:function(e){this._parent(e)},create:function(e){return this._options=e,this.MainContainer=new UWA.createElement("div",{styles:{height:"100%",width:"100%"}}),this.MainContainer.setAttribute("id","MainPrdContainer"),this.versionGraph=new s(this._options),this.versionGraph.getVersionGraph().inject(this.MainContainer),this.buildContainers(),this},render:function(e){this._options.data.rootBranches=e;var t=[];if(this._options.data.rootBranches.constructor===Array)for(var i=0;i<this._options.data.rootBranches.length;i++){if(this._options.data.rootBranches[i]&&Object.keys(this._options.data.rootBranches[i]).length>0&&this._options.data.rootBranches[i].constructor===Object)var o=n.parseRootBranches(this._options.data.rootBranches[i],this._options.use);o&&o.length>0&&o.forEach(function(e){t.push(e)})}else n.mainderived(t,this._options.data.rootBranches,this._options.data.rootBranches.id,"Revision",this._options.use);this.versionGraph.render(t)},buildContainers:function(){var o=this,n="";if("PRODUCTS"==o._options.mode?n=r.Filter_Dialog_Product:"MANUFACTURINGPLAN"==o._options.mode&&(n=r.Filter_Dialog_ManufacturingPlan),"EFF_VIEW"!=o._options.use){if(""==o._options.use||"Native"==window.enoviaServerFilterWidget.mode){var s={isHeader:!0,isFooter:!0,firstButtonText:o._options.firstButtonText||r.CFG_Apply,secondButtonText:o._options.secondButtonText||r.CFG_Back,headerText:n,toggleSessionEffectivity:o._options.propagateSessionEffectivity,onButtonClickCB:function(e){if("firstButton"==e.buttonId){var t=o.versionGraph.get();"Native"==window.enoviaServerFilterWidget.mode&&o.setSingleProductId(t),i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:t.xml,json:t.json,xmlDesc:t.description,mode:o._options.mode,event:e}})}else"secondButton"==e.buttonId&&i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{mode:"",event:e}});"singlePageTransition"!=o._options.transition&&o.containerView.destroy()}};o.containerView=new t(s).render(),o.containerView.getContent().addClassName("CfgContainerView-EditEvolution-SelectEvolutionData"),o.containerView.inject(i.renderTo),o.MainContainer.inject(o.containerView._body)}else if("EFFECTIVITY"==o._options.use)o.dialog=new e({className:"cfg-site-reset",closable:!0,header:"<h4>"+n+"</h4>",body:o.MainContainer,footer:'<button type="button" class="btn btn-primary">'+r.Filter_Apply+'</button> <button type="button" class="btn btn-default">'+r.Filter_Cancel+"</button>",events:{onHide:function(){o.dialog.destroy()}}}).inject(i.renderTo),o.dialog.show(),o.dialog.getContent().getElements(".btn-primary").forEach(function(e){e.addEvent("click",function(){var e=o.versionGraph.get();i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:e.xml,json:e.json,xmlDesc:e.description,mode:o._options.mode}}),o.dialog.destroy()}),o.dialog.getContent().getElements(".btn-default").forEach(function(e){e.addEvent("click",function(){o.dialog.destroy()})})});else if("FILTER"==o._options.use){s={dialogue:{buttonArray:[{label:r.Filter_Cancel,handler:function(){document.querySelector(".operations-main-container").destroy(),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){e.showFilter()})},className:"default"},{label:r.Filter_Apply,handler:function(e){var t=o.versionGraph.get();o.setSingleProductId(t),i.ModelEvents.publish({event:"ProductStateDialogClosed",data:{model:null,xml:t.xml,json:t.json,xmlDesc:t.description,mode:o._options.mode}}),require(["DS/CfgFilterUX/CfgFilterFactory"],function(e){document.querySelector(".operations-main-container").destroy(),e.showFilter()})},className:"primary"}],showHeader:!0,showButton:!0},HeaderLabel:n,displayCompactMode:this._options.displayCompactMode};a.init(i.renderToApp,o.MainContainer,s,l)}}else o.MainContainer.inject(o._options.parentGraphElement)},setSingleProductId:function(e){if("PRODUCTS"==this._options.mode&&(0!=e.json.length&&(i.singleProductId=""),1==e.json.length&&-1==e.xml.indexOf("<Tree>"))){var t=this.versionGraph.CfgSelectedNode[0].options.id;t&&(i.singleProductId=t.replace("pid:",""))}}})}),define("DS/CfgEvolutionUX/CfgProductState",["UWA/Drivers/Alone","DS/Core/Core","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/Controls/TooltipModel","UWA/Class/View","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Promise","DS/CfgEvolutionUX/CfgVersionGraphLayout","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgEvolutionRange","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p){"use strict";return s.extend({editButton:null,textdiv:null,xml:null,xmlDesc:[],json:null,displayExpression:"",setup:function(e){this._parent(e)},render:function(){var e=this;this.CfgVersionGraphLayoutInstance=new d,this.textBox=UWA.createElement("div").inject(this.options.parentElement),this.textBox.addClassName("CfgEditor"),this.textBox.set({events:{click:function(t){"EFF_VIEW"!=e.options.use&&e.onCriteriaClickHandler(t)}}}),this.textBox.tooltipInfos=new n({shortHelp:""}),"EFF_VIEW"!=e.options.use&&(this.editButton=UWA.createElement("span").inject(this.options.parentElement),this.editButton.set({events:{click:function(t){e.onCriteriaClickHandler(t)}}}),this.editButton.addClassName("fonticon"),this.editButton.addClassName("fonticon-1.5x"),this.editButton.addClassName("fonticon-search"),this.editButton.addClassName("searchbutton"),a.ModelEvents.subscribe({event:"modelUpdated"},function(t){e.setLastMainEvolution(t),e.editButton.removeClassName("disableButton"),e.textBox.removeClassName("disableButton")}),a.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(t){e.editButton.removeClassName("disableButton"),e.textBox.removeClassName("disableButton"),t.mode==e.options.mode&&(e.xml=t.xml,e.xmlDesc=t.xmlDesc,e.options.psJson=t.json,e.updateDisplayExpression())})),this.applyCompactComfortableMode()},applyCompactComfortableMode:function(){null==this.options.displayCompactMode||!1===this.options.displayCompactMode?(this.textBox.setAttributeNode(document.createAttribute("touch-mode")),this.editButton&&this.editButton.setAttributeNode(document.createAttribute("touch-mode"))):(this.textBox.removeAttribute("touch-mode"),this.editButton&&this.editButton.removeAttribute("touch-mode")),"EFF_VIEW"==this.options.use?this.textBox.setAttributeNode(document.createAttribute("readOnly-mode")):(this.textBox.setAttributeNode(document.createAttribute("edit-mode")),this.textBox.removeAttribute("readOnly-mode"))},onCriteriaClickHandler:function(e){var t=this;if(!(t.editButton&&1==t.editButton.hasClassName("disableButton")||1==t.textBox.hasClassName("disableButton"))){var i="";"PRODUCTS"==t.options.mode?i="products":"MANUFACTURINGPLAN"==t.options.mode?i="manufacturingPlans":"MILESTONES"==t.options.mode&&(i="milestones"),t.editButton&&t.editButton.addClassName("disableButton"),t.textBox.addClassName("disableButton");var o={};if(o.psJson=this.options.psJson,o.mode=this.options.mode,o.use=this.options.use,o.appUse=this.options.appUse,o.appEnv=this.options.appEnv,o.propagateSessionEffectivity=this.options.propagateSessionEffectivity,o.ModelLabel=this.ModalLabel.constructor==Array?this.ModalLabel[0]:this.ModalLabel,o.displayexpression=this.options.expression.displayexpression?this.options.expression.displayexpression:"",o.displayexpression.indexOf(":")>=0&&(o.displayexpression=o.displayexpression.substring(o.displayexpression.indexOf(":")+1),o.displayexpression.trim()),o.displayCompactMode=this.options.displayCompactMode,"EFF_VIEW"==this.options.use?(o.isReadOnly=!0,o.parentGraphElement=this.options.parentGraphElement):(o.isReadOnly=!1,a.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}})),"products"!=i&&"manufacturingPlans"!=i||t.CfgVersionGraphLayoutInstance.create(o),null==a.getDictionaryByCriteria(t.ModalId,i)[i]){var n;if("products"!=i&&"manufacturingPlans"!=i||"FILTER"==t.options.use)n=l.getDictionaryFromServer(t.ModalId,i);else{var s="",r="",d='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="Strict">',u="</FilterSelection></CfgFilterExpression>";"products"==i?r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.options.expression.name+'" >'+t.options.expression.xmlExpression+"</Context>"+u:"manufacturingPlans"==i&&(r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.options.expression.name+'" >'+t.options.expression.impXml+"</Context>"+u),""!==r&&(s={evolutionExpression:JSON.stringify({filterExpression:c.getValidXmlWithoutDescId(r)})},console.log("CfgProductState evoExpression = "+r+" wParam after descId removed = "+s.evolutionExpression)),n=l.getDictionaryFromServer(t.ModalId,"onlyUnfrozenNodes=1&"+i,null,s)}n.then(function(e){a.addDictionaryByCriteria(t.ModalId,e,i),o.data=a.getDictionaryByCriteria(t.ModalId,i),setTimeout(function(){"products"==i?t.CfgVersionGraphLayoutInstance.render(o.data.products):"manufacturingPlans"==i?t.CfgVersionGraphLayoutInstance.render(o.data.manufacturingPlans):"milestones"==i&&CfgProductStateSelectionDialog.create(o)},100),t.editButton&&t.editButton.removeClassName("disableButton"),t.textBox.removeClassName("disableButton")})}else o.data=a.getDictionaryByCriteria(t.ModalId,i),setTimeout(function(){"products"==i?t.CfgVersionGraphLayoutInstance.render(o.data.products):"manufacturingPlans"==i?t.CfgVersionGraphLayoutInstance.render(o.data.manufacturingPlans):"milestones"==i&&CfgProductStateSelectionDialog.create(o)},100),t.editButton&&t.editButton.removeClassName("disableButton"),t.textBox.removeClassName("disableButton")}},updateDisplayExpression:function(){var e=this.buildFilterXML();if(null!=e){var t="",i=this.buildDescription();-1==e.search("TreeSeries")&&-1==e.search("MilestonesTrack")?"PRODUCTS"==this.options.mode?t=c.buildTreeSeries("ProductState",this.ModalLabel,e):"MANUFACTURINGPLAN"==this.options.mode?t=c.buildTreeSeries("ManufPlan",this.ModalLabel,e):"MILESTONES"==this.options.mode&&(t=c.buildmilestonetrack(e)):t=e;var o="";o=null==i||0==i.length?c.startFilterXML()+t+c.endFilterXML():c.startEvolutionXML()+t+"</Expression><Description>"+i+"</Description></CfgEffectivityExpression>",this.displayExpression=decodeURIComponent(l.getDisplayExpressionUsingXSLT(o)),null!=this.CfgVersionGraphLayoutInstance.versionGraph&&1==this.CfgVersionGraphLayoutInstance.versionGraph.IsExpressionModified&&(this.options.notExpression=""),""==this.displayExpression&&l.isParamDefined(this.options.notExpression)&&(this.displayExpression=this.options.notExpression),this.textBox.innerHTML=this.displayExpression,this.textBox.tooltipInfos.shortHelp=this.displayExpression,this.options.expression.displayexpression=this.displayExpression}},buildDisplayExpression:function(){return this.displayExpression},buildFilterJson:function(){return this.options.psJson},buildFilterXML:function(){return this.xml},buildDescription:function(){return this.xmlDesc},setMVAssociatedWithPC:function(e,t){var i=this;this.iData=e,this.basedOnMVID=t;var o,n="";n={with_indexing_date:!0,with_nls:!1,label:"yus-1515078503005",locale:"en",select_predicate:["ds6w:label","ds6wg:revision","revision","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:"flattenedtaxonomies:(types/Products) AND ( physicalid:("+i.basedOnMVID+") ) ",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant},o={isfederated:"true"};n=JSON.stringify(n);l.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,function(e){var t="",o="",n="";if(null!=e.results[0]&&e.results[0].attributes.length>0)for(var s=0;s<e.results[0].attributes.length;s++)"ds6wg:revision"==e.results[0].attributes[s].name&&(t=e.results[0].attributes[s].value),"ds6w:label"==e.results[0].attributes[s].name&&(n=e.results[0].attributes[s].value),"ds6w:identifier"==e.results[0].attributes[s].name&&(o=e.results[0].attributes[s].value);if(""!=t&&""!=o&&""!=n){null==window.DescriptionCount&&(window.DescriptionCount=1),i.xml='<Single Name = "'+o+'" Revision = "'+t+'" DescId = "'+window.DescriptionCount+'"/>',i.modelName=i.iData.model.name[0];var r=c.buildTreeSeries("ProductState",i.modelName,i.xml),d=n;i.xmlDesc='<TreeSeries DescId = "'+window.DescriptionCount+'" Revision = "'+t+'" DisplayName="'+encodeURIComponent(d)+'"/>',window.DescriptionCount++,r=c.startEvolutionXML()+r+"</Expression><Description>"+i.xmlDesc+"</Description></CfgEffectivityExpression>",i.displayExpression=decodeURIComponent(l.getDisplayExpressionUsingXSLT(r)),i.options.psJson=[u.getRange(o,t,d)],i.editButton&&i.editButton.removeClassName("disableButton"),a.singleProductId=i.basedOnMVID,1!=i.textBox.isHidden()&&null!=i.options.psJson&&1==i.options.psJson.length&&1!=i.options.psJson[0].start.isRoot&&null!=document.getElementById("edit")&&document.getElementById("edit").removeClassName("disableButton"),a.ProductStateComponent.textBox.innerHTML=i.displayExpression,a.ProductStateComponent.textBox.tooltipInfos.shortHelp=i.displayExpression}},function(){},!0,o)},setLastMainEvolution:function(e){if((i=this).criteriasAvailable=a.CurrentFilterModel.model.criteriasAvailable,null!=i.criteriasAvailable&&(null!=i.criteriasAvailable&&"False"==i.criteriasAvailable.manufacturingPlans&&null!=a.manufacturingplanComponent?(a.manufacturingplanCheckbox.hide(),a.manufacturingplanComponent.hide(),a.manufacturingplanComponent.textBox.setText("")):1==a.manufacturingplanCheckbox.checkFlag?(a.manufacturingplanComponent.show(),a.manufacturingplanCheckbox.show(),a.manufacturingplanCheckbox.checkFlag=!1):(a.manufacturingplanComponent.hide(),a.manufacturingplanComponent.textBox.setText(""),a.manufacturingplanCheckbox.show()),null!=i.criteriasAvailable&&"FALSE"==i.criteriasAvailable.products&&null!=a.ProductStateComponent?(a.productstateCheckbox.hide(),a.ProductStateComponent.hide(),a.ProductStateComponent.textBox.setText("")):(a.ProductStateComponent.show(),a.productstateCheckbox.show(),a.productstateCheckbox.checkFlag=!0,a.ProductStateComponent.textBox.setText("")),null!=a.UnitComponent&&(null!=i.criteriasAvailable&&"FALSE"==i.criteriasAvailable.builds?(a.UnitCheckbox.hide(),a.UnitComponent.hide(),a.UnitComponent.textBox.value=""):1==a.UnitCheckbox.checkFlag?(a.UnitComponent.show(),a.UnitCheckbox.show(),a.UnitCheckbox.checkFlag=!1):(a.UnitComponent.hide(),a.UnitComponent.textBox.value="",a.UnitCheckbox.show())),null!=a.DateCheckbox&&1==a.DateCheckbox.checkFlag&&(a.DateCheckbox.checkFlag=!1,a.DatePicker.hide())),e.model.valueItem.constructor==Array?(this.ModalId=e.model.value[0],this.ModalLabel=e.model.label[0].label):(this.ModalId=e.model.valueItem,this.ModalLabel=e.model.labelItem),null==e.noEvolutionUpdate||1!=e.noEvolutionUpdate){var t=new r(function(t,i){var o="/resources/modeler/browsing/browseservice/pid:"+e.model.valueItem+"/configurationdictionary?latestMainProductNode=1";l.makeWSCall(o,"POST","enovia","application/x-www-form-urlencoded","productstates",function(e){t(e)},function(e){console.log("fail to get last product evolution")},!0)});this.iData=e;var i=this;t.then(function(e){var t=e;if(0==Object.keys(t.products).length)i.displayExpression="",i.xml="",i.options.psJson=null,i.editButton&&i.editButton.addClassName("disableButton"),null!=document.getElementById("edit")&&document.getElementById("edit").addClassName("disableButton"),a.singleProductId="";else{null==window.DescriptionCount&&(window.DescriptionCount=1),i.xml='<Single Name = "'+t.products.name+'" Revision = "'+t.products.revision+'" DescId = "'+window.DescriptionCount+'"/>',i.modelName=i.iData.model.name[0];var o=c.buildTreeSeries("ProductState",i.modelName,i.xml),n=t.products.displayValue;null!=n&&" "!=n||(n=t.products.name),i.xmlDesc='<TreeSeries DescId = "'+window.DescriptionCount+'" Revision = "'+t.products.revision+'" DisplayName="'+encodeURIComponent(n)+'"/>',window.DescriptionCount++,o=c.startEvolutionXML()+o+"</Expression><Description>"+i.xmlDesc+"</Description></CfgEffectivityExpression>",i.displayExpression=decodeURIComponent(l.getDisplayExpressionUsingXSLT(o)),i.options.psJson=[u.getRange(t.products.name,t.products.revision,n)],i.editButton&&i.editButton.removeClassName("disableButton"),a.singleProductId=t.products.id.replace("pid:",""),1!=i.textBox.isHidden()&&null!=i.options.psJson&&1==i.options.psJson.length&&1!=i.options.psJson[0].start.isRoot&&null!=document.getElementById("edit")&&document.getElementById("edit").removeClassName("disableButton")}a.ProductStateComponent.textBox.innerHTML=i.displayExpression,a.ProductStateComponent.textBox.tooltipInfos.shortHelp=i.displayExpression})}},setExpression:function(e){e.model.valueItem.constructor==Array?(this.ModalId=e.model.value[0],this.ModalLabel=e.model.label[0].label):(this.ModalId=e.model.valueItem,this.ModalLabel=e.model.labelItem),"PRODUCTS"==this.options.mode&&(this.xml=this.options.expression.xmlExpression,this.xmlDesc=this.options.expression.psXmlDesc),"MANUFACTURINGPLAN"==this.options.mode&&0!=Object.keys(this.options.expression).length&&(this.xml=this.options.expression.impXml,this.xmlDesc=this.options.expression.mpXmlDesc),this.updateDisplayExpression()},show:function(){this.textBox.show(),this.editButton&&this.editButton.show()},hide:function(){this.textBox.hide(),this.editButton&&this.editButton.hide()},onProductStateSelectionDialogLaunched:function(e){var t="";"PRODUCTS"==this.options.mode?t="products":"MANUFACTURINGPLAN"==this.options.mode?t="manufacturingPlans":"MILESTONES"==this.options.mode&&(t="milestones"),a.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var i={};i.psJson=this.options.psJson,i.data=a.getDictionaryByCriteria(this.ModalId,t),i.mode=this.options.mode,i.use=this.options.use,i.appUse=this.options.appUse,i.appEnv=this.options.appEnv,i.propagateSessionEffectivity=this.options.propagateSessionEffectivity,i.ModelLabel=this.ModalLabel.constructor==Array?this.ModalLabel[0]:this.ModalLabel,CfgProductStateSelectionDialog.create(i)},getSelectedModelId:function(){return this.ModalId},initialiseComponent:function(){null==this.ModalId&&null==this.ModalLabel&&(this.ModalId=this.options.expression.modelId,this.ModalLabel=this.options.expression.name),"PRODUCTS"==this.options.mode?(this.xml=this.options.expression.xmlExpression,this.psJson=this.options.expression.psJson,this.xmlDesc=this.options.expression.psXmlDesc):"MANUFACTURINGPLAN"==this.options.mode?(this.xml=this.options.expression.impXml,this.psJson=this.options.expression.mpJson,this.xmlDesc=this.options.expression.mpXmlDesc):"MILESTONES"==this.options.mode&&(this.xml=this.options.expression.milestoneXml,this.psJson=this.options.expression.milestoneJson,this.options.psJson=this.options.expression.milestoneJson),this.updateDisplayExpression(this)}})}),define("DS/CfgEvolutionUX/CfgDatePicker",["UWA/Core","UWA/Date","DS/UIKIT/Input/Toggle","DS/CfgEvolutionUX/CfgDatePickerUtilities","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","css!DS/UIKIT/UIKIT.css"],function(e,t,i,o,n,s){return{}}),define("DS/CfgEvolutionUX/CfgEvolutionCriteriasDialog",["DS/UIKIT/Spinner","UWA/Drivers/Alone","DS/CfgBaseUX/scripts/CfgUtility","DS/Core/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/Handlebars/Handlebars4","text!DS/CfgEvolutionUX/CfgEvolutionCriteriasDialogTemplate.html","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h){"use strict";return{}}),define("DS/CfgEvolutionUX/CfgEvolutionLayoutFactory",["DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgController","DS/CfgEvolutionUX/CfgVersionGraphLayout","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/UIKIT/Iconbar","DS/CfgBaseUX/scripts/CfgCollection","DS/CfgBaseUX/scripts/CfgModel","DS/CfgBaseUX/scripts/CfgModelView","DS/UIKIT/Input/Button","DS/CfgBaseUX/scripts/CfgContainerView","DS/PlatformAPI/PlatformAPI","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/CfgBaseUX/scripts/CfgAutocompleteControl","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h,g,f,v){"use strict";var C={modelListView:null,empty_models:null,showImportAppIcon:!1,enableImportButton:!1,applicabilityCO:"",descriptionMap:{},createNative:function(i){var a=this;this.CfgVersionGraphLayoutInstance=new o;var l={isHeader:!1,isFooter:!0,firstButtonText:m.CFG_Ok,secondButtonText:m.CFG_Cancel,headerText:m.Header_SessionEffectivity,toggleSessionEffectivity:!1,onButtonClickCB:function(e){if("Native"==window.enoviaServerFilterWidget.mode){var i={modelIdsWithEffectivity:a.collection.getEffectivityModelsIDs(),globalEffectivityExpression:a.collection.getGlobalSessionExpression()},o={eventName:"cfgEditEvolutionEffectivity",operation:"firstButton"==e.buttonId?"OK":"Cancel",operationVersion:"1.0",content:JSON.stringify(i)};t.sendNotificationWebInWin(o)}}};i.dialogue={},i.dialogue.modelViewContainer=new u(l).render(),i.dialogue.modelViewContainer.inject(i.parent),i.parentElement=i.parent,i.dialogue.object={resizeDialog:function(){},container:i.parent},this.options=i;a=this;s.clear(),s.ModelEvents=new e,s.Models=[],a.evolutionSpinner=new g({className:"evolutionSpinner"}).inject(a.options.parent),a.evolutionSpinner.spin(),a.evolutionSpinner.show(),t.populateDisplayExpressionXSLT().then(function(e){t.checkDecouplingActivation().then(function(e){console.log(e),s.configurationCriteria=e,a.options.expressionJson=n.EvolutionXMLtoJSONConvertor(a.options.iXml),a.populateModels(a)})}),a.subscribeModelEvents()},create:function(n){this.options=n;var a=this;a.toggleHidden=!1,s.clear(),s.ModelEvents=new e,s.Models=[],this.CfgVersionGraphLayoutInstance=new o,a.evolutionSpinner=new g({className:"evolutionSpinner"}).inject(a.options.parent),a.evolutionSpinner.spin(),a.evolutionSpinner.show(),i.init(),enoviaServerFilterWidget.mode=this.options.environment,enoviaServerFilterWidget.tenant=this.options.tenant,t.populate3DSpaceURL().then(function(){var e=t.populateSecurityContext();e.then(function(){t.populateDisplayExpressionXSLT().then(function(){t.checkDecouplingActivation().then(function(e){console.log(e),s.configurationCriteria=e,function(e){if("Applicability"==a.options.mode){enoviaServerFilterWidget.fromCaller="Applicability";for(var i=["Change Action","Decision","Change Order"],o=[],n=0;n<i.length;n++){var l=new Promise(function(e,i){var o="/resources/v2/e6w/service/ApplicabilityTypeInfo/"+a.options.objectid;t.makeWSCall(o,"GET","enovia","application/json","",function(t){e(t)},i,!0)});o.push(l)}Promise.all(o).then(function(i){for(var o=0;o<i.length;o++){let l;if(null!=i[o].data&&"Change Action"==i[o].data[0].dataelements.applicabilityType&&(s.type="Change Action"),null!=i[o].data&&"Decision"==i[o].data[0].dataelements.applicabilityType&&(s.type="Decision"),null==i[o].data||"Change Order"!=i[o].data[0].dataelements.applicabilityType&&"Change Request"!=i[o].data[0].dataelements.applicabilityType||(s.type="Change Order"),null!=i[o].data&&"Change Order"==i[o].data[0].dataelements.applicabilityType&&(l="Change Order"),null!=i[o].data&&"Change Request"==i[o].data[0].dataelements.applicabilityType&&(l="Change Request"),2==o){var n=document.querySelector("#FacetDivForApplicabilityContext");n&&n.setStyle("margin-top","5px"),1==a.options.readOnly?a.onSecurityContext(e,a):"Change Action"==s.type?t.populateChangeActionAccess(a.options.objectid).then(function(){a.onSecurityContext(e,a)}):"Change Order"==s.type?t.populateChangeOrderOrChangeRequestAccess(a.options.objectid,l).then(function(){a.onSecurityContext(e,a)}):a.onSecurityContext(e,a)}}},function(e){})}else"SessionEffectivity"==a.options.mode&&(enoviaServerFilterWidget.fromCaller="SessionEffectivity",a.onSecurityContext(e,a))}()})})}),a.subscribeModelEvents()})},onSecurityContext:function(e,i){"Applicability"==i.options.mode?new Promise(function(e,o){var n=t.getChangeUrl(i.options.objectid,"GET");t.makeWSCall(n,"GET","enovia","application/json","",function(t){e(t)},function(e){o(e)},!0)}).then(async function(e){if(i.showImportAppIcon=!1,"Change Action"==s.type||"Change Order"==s.type){"Change Action"==s.type?i.expressionXml=e.changeaction.applicability.expressionXML:i.expressionXml=e.applicability.expressionXML?e.applicability.expressionXML:e.applicability.xml;try{let e=(await t.fetchApplicabilityFrom(i.options.objectid)).data[0].copyAppIds;if(!e||e.length>1||0===e.length)i.showImportAppIcon=!1;else{let o=e[0];i.showImportAppIcon=!0;let n="/resources/ecm/modeler/changeorder/pid:"+o+"/getapplicability",s=await t.getChangeApplicability(n);i.appToBeCopied=s.applicability.expressionXML?s.applicability.expressionXML:s.applicability.xml,i.enableImportButton=""!==i.appToBeCopied}i.options.expressionJson=n.EvolutionXMLtoJSONConvertor(i.expressionXml),i.populateModels(i)}catch(e){console.log("Error fetchApplicabilityFrom web service call"),console.log(e),i.showImportAppIcon=!1,i.options.expressionJson=n.EvolutionXMLtoJSONConvertor(i.expressionXml),i.populateModels(i)}}else i.expressionXml=e.applicability.expressionXML?e.applicability.expressionXML:e.applicability.xml,"Decision"===s.type&&(s.ChangeAccessDetails={},s.ChangeAccessDetails.SetApplicability=e.hasEditAccess),i.preValidateApplicabilityXMLForReadability(),i.options.expressionJson=n.EvolutionXMLtoJSONConvertor(i.expressionXml),i.populateModels(i)},function(e){if("Change Action"!=s.type)return i.expressionXml="",s.ChangeAccessDetails={},s.ChangeAccessDetails.SetApplicability="false",i.options.expressionJson=n.EvolutionXMLtoJSONConvertor(i.expressionXml),void i.populateModels(i);i.evolutionSpinner.hide(),t.showwarning(h.Get_Applicability_Failed,"error")}):"SessionEffectivity"==i.options.mode&&(i.options.expressionJson=n.EvolutionXMLtoJSONConvertor(i.options.iXml),i.populateModels(i))},isInaccessibleNodesInXml:function(e){let t=!1;let i={iExpression:(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("Expression")[0],iTagName:"Context",iAttributeName:"HolderName"};return t=this.checkForInaccessibleNodesInXml(i),i.iTagName="Root",i.iAttributeName="Name",0==t&&1==(t=this.checkForInaccessibleNodesInXml(i))?t:(i.iTagName="Leaf",i.iAttributeName="Name",0==t&&1==(t=this.checkForInaccessibleNodesInXml(i))?t:(i.iTagName="Single",i.iAttributeName="Name",0==t&&(t=this.checkForInaccessibleNodesInXml(i)),t))},preValidateApplicabilityXMLForReadability:function(){null!=this.expressionXml&&null!=this.expressionXml||(this.expressionXml="");var e=(new DOMParser).parseFromString(this.expressionXml,"text/xml").getElementsByTagName("Expression");if(e.length>0){var t={iExpression:e[0],iTagName:"Context",iAttributeName:"HolderName"};let i=!1;i=this.checkForInaccessibleNodesInXml(t),t.iTagName="Root",t.iAttributeName="Name",0==i&&(i=this.checkForInaccessibleNodesInXml(t)),t.iTagName="Leaf",t.iAttributeName="Name",0==i&&(i=this.checkForInaccessibleNodesInXml(t)),t.iTagName="Single",t.iAttributeName="Name",0==i&&(i=this.checkForInaccessibleNodesInXml(t)),1==i&&(s.ChangeAccessDetails.SetApplicability="false",this.expressionXml="")}},checkForInaccessibleNodesInXml:function(e){var t=e.iExpression.getElementsByTagName(e.iTagName);if(t.length>0)for(var i=0;i<t.length;i++){if("###"===t[i].attributes[e.iAttributeName].value)return!0}return!1},onUpdate:function(e){if(s.evolutionModelItemClickCount=0,!e||"firstButton"!=e.buttonId)return C.criteriaViewContainer&&C.criteriaViewContainer.destroy(),null!=C.options.dialogue&&"undefined"!=C.options.dialogue&&null!=C.options.dialogue.object&&"undefined"!=C.options.dialogue.object&&C.options.dialogue.modelViewContainer.show(),C.modelListView.modelSetView.show(),C.modelListView.adjustResponsiveView(),void C.autocompleteParent.show();var t=!0,i=null;if(null!=C.CfgEvolutionCriteriaView&&(t=null!=(i=C.CfgEvolutionCriteriaView.buildData())),null!=C.CfgEvolutionCriteriaView&&null!=i&&0!=t&&C.updateCollection(i),"Applicability"==C.options.mode){if(0==t)return;""==C.options.selectedcollection.getGlobalEvolutionExpression()&&(C.criteriaViewContainer&&C.criteriaViewContainer.destroy(),C.modelListView.modelSetView.show(),C.modelListView.adjustResponsiveView(),C.autocompleteParent.show()),C.showSpinnerforSaveApplicability("mask"),C.onSaveApplicability(e)}else if("SessionEffectivity"==C.options.mode){if(0==t)return;C.criteriaViewContainer&&C.criteriaViewContainer.destroy(),null!=C.options.dialogue&&"undefined"!=C.options.dialogue&&null!=C.options.dialogue.object&&"undefined"!=C.options.dialogue.object&&C.options.dialogue.modelViewContainer.show(),C.modelListView.modelSetView.show(),C.modelListView.adjustResponsiveView(),C.autocompleteParent.show()}},subscribeModelEvents:function(){s.ModelEvents.subscribe({event:"LaunchingDictionarySelection"},function(e){C.criteriaViewContainer&&C.criteriaViewContainer.hide()}),s.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(e){C.criteriaViewContainer&&C.criteriaViewContainer.show()}),s.ModelEvents.subscribe({event:"UnitsDialogClosed"},function(e){C.criteriaViewContainer&&C.criteriaViewContainer.show()})},updateCollection:function(e){C.options.selectedmodel.set("expression",e);var i="",o="";"SessionEffectivity"==C.options.mode?(i=C.options.selectedcollection.getGlobalSessionExpression(),o=C.options.selectedmodel.getContextSessionExpression()):"Applicability"==C.options.mode&&(i=C.options.selectedcollection.getGlobalChangeExpression(),o=C.options.selectedmodel.getContextEvolutionExpression()),i=i.replace(/&(?!amp;)/g,"&amp;"),C.globalexpression=i;var n=t.getDisplayExpressionUsingXSLT(o);null!=n&&null!=n&&""!=n||(n=C.options.emptyContextText),C.options.selectedmodel.set("displayexpression",n)},sendApplicabilityChangeEvent:function(){var e=C.collection.getGlobalSessionExpression();""!=(e=e.replace(/&(?!amp;)/g,"&amp;"))&&(e=t.getDisplayExpressionUsingXSLT(e));var i={operation:"applicability_update",operationVersion:"1.0",content:{id:C.options.objectid,applicability_DisplayValue:e}};p.publish("applicability:update:notification",JSON.stringify(i)),console.log(i)},showSpinnerforSaveApplicability:function(e){"mask"==e?null!=document.querySelector("#FacetDivForApplicabilityContext")?f.mask(document.querySelector("#FacetDivForApplicabilityContext")," "):null!=document.querySelector("#contentAppdiv")&&f.mask(document.querySelector("#contentAppdiv")," "):"unmask"==e&&(null!=document.querySelector("#FacetDivForApplicabilityContext")?f.unmask(document.querySelector("#FacetDivForApplicabilityContext")):null!=document.querySelector("#contentAppdiv")&&f.unmask(document.querySelector("#contentAppdiv")))},onSaveApplicability:function(e){var i=this;new Promise(function(e,i){var o=t.getChangeUrl(C.options.objectid,"PUT"),n={};n="Change Action"==s.type?{version:"v0",changeaction:{modify:{applicability:{xml:C.globalexpression}}}}:{version:"1.0",applicability:{xml:C.globalexpression}};n=JSON.stringify(n);t.makeWSCall(o,"PUT","enovia","application/json",n,function(t){e(t)},function(e,t){C.showSpinnerforSaveApplicability("unmask"),i(t)},!0)}).then(function(e){C.criteriaViewContainer&&C.criteriaViewContainer.destroy(),C.modelListView.modelSetView.show(),C.modelListView.adjustResponsiveView(),C.autocompleteParent.show(),null!=C.options.dialogue&&"undefined"!=C.options.dialogue&&null!=C.options.dialogue.object&&"undefined"!=C.options.dialogue.object&&C.options.dialogue.modelViewContainer.show(),t.showwarning(h.Save_Successful_Applicability,"success","Fast",i.warningMsgContainer),C.sendApplicabilityChangeEvent(),C.showSpinnerforSaveApplicability("unmask")},function(e){C.criteriaViewContainer&&C.criteriaViewContainer.destroy(),C.modelListView.modelSetView.show(),C.modelListView.adjustResponsiveView(),C.autocompleteParent.show(),null!=C.options.dialogue&&"undefined"!=C.options.dialogue&&null!=C.options.dialogue.object&&"undefined"!=C.options.dialogue.object&&C.options.dialogue.modelViewContainer.show(),e?t.showwarning(e.errorMessage,"error"):t.showwarning(h.Set_Fail_Applicability,"error")})},isOneCriteriaCondition:function(e){var t=e.products,i=e.manufacturingPlans,o=e.builds;null==o&&(o="False");var n="False";return 1==s.configurationCriteria.contextualDate&&(n="TRUE"),0==s.configurationCriteria.unit&&(o="False"),"TRUE"==t.toUpperCase()&&"FALSE"==i.toUpperCase()&&"FALSE"==n.toUpperCase()&&"FALSE"==o.toUpperCase()?"products":"FALSE"==t.toUpperCase()&&"TRUE"==i.toUpperCase()&&"FALSE"==n.toUpperCase()&&"FALSE"==o.toUpperCase()?"manufacturingPlans":""},getModelsFromServer:function(e){var i,o=this.options.expressionJson;i=o.map(function(e){var t=e.expression.name;return"(([ds6w:label]:(*"+t+"*)) OR ([name]:(*"+t+"*)))"}).join(" OR ");return new Promise(function(o,n){enoviaServerFilterWidget.contextUser;var s={};s=e?{with_indexing_date:!0,with_nls:!1,label:"cfgLabel",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Model") AND ('+i+")",order_by:"desc",order_field:"relevance",nresults:1e3,next_start:e,source:[],tenant:enoviaServerFilterWidget.tenant}:{with_indexing_date:!0,with_nls:!1,label:"cfgLabel",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Model") AND ('+i+")",order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant},s=JSON.stringify(s);t.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",s,function(e){o(e)},function(){n()},!0,{isfederated:"true"})})},addModelsFromServer:function(e){var t=this;this.options.expressionJson.length>0?t.getModelsFromServer(e).then(function(e){0==e.infos.nhits?s.Models=[]:s.Models=s.Models.concat(e.results),t.postModelProcessing()}):(s.Models=[],t.postModelProcessing())},postModelProcessing:function(){var e=this;e.processexpressionJsonForIds(e),"Applicability"==e.options.mode?(e.options.noModelsErrorMessage=h.Empty_Applicability,e.options.editActionLabel=h.Edit_Applicability,e.options.clearActionLabel=h.Clear_Expression,e.options.removeActionLabel=h.Remove_Model,e.options.emptyContextText=h.emptyContextText_Applicability,e.options.parentElement=e.options.parent,e.options.expressionArray=e.options.expressionJson,e.options.Models=s.Models,e.options.Access=s.ChangeAccessDetails):"SessionEffectivity"==e.options.mode&&(e.options.noModelsErrorMessage=h.Empty_SessionEffectivity,e.options.editActionLabel=h.Edit_SessionEffectivity,e.options.clearActionLabel=h.Clear_SessionEffectivity,e.options.removeActionLabel=h.Remove_Model,e.options.emptyContextText=h.emptyContextText_SessionEffectivity,e.options.parentElement=e.options.parent,e.options.expressionArray=e.options.expressionJson,e.options.Models=s.Models),e.options.editActionCallback=function(i){if("Applicability"==e.options.mode||"SessionEffectivity"==e.options.mode){if(null!=e.options.Access&&(e.options.Access.SetApplicability&&"false"==e.options.Access.SetApplicability||e.options.Access.SetSessionEffectvity&&"false"==e.options.Access.SetSessionEffectvity||e.options.Access.SetEvolutionEffectvity&&"false"==e.options.Access.SetEvolutionEffectvity)||1==e.options.readOnly)return;e.options.expression=i.get("expression"),e.options.selectedmodel=i,e.options.selectedcollection=e.collection,new Promise(function(i,o){var n={version:"1.0.0",modelIds:[{id:"pid:"+e.options.expression.modelId}]};n=JSON.stringify(n);t.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",n,function(e){i(e)},function(e){console.log("fail to get last product evolution")},!0)}).then(function(i){if(null==i.criteria[0].products||"FALSE"!=i.criteria[0].products.toUpperCase()||null==i.criteria[0].manufacturingPlans||"FALSE"!=i.criteria[0].manufacturingPlans.toUpperCase()||null==i.criteria[0].builds||"FALSE"!=i.criteria[0].builds.toUpperCase()){e.options.criteriasAvailable=i.criteria[0],e.options.parentElement=e.options.parent,e.modelListView.modelSetView.hide(),e.autocompleteParent.hide(),null!=C.options.dialogue&&"undefined"!=C.options.dialogue&&null!=C.options.dialogue.object&&"undefined"!=C.options.dialogue.object&&C.options.dialogue.modelViewContainer.hide();var o=e.isOneCriteriaCondition(e.options.criteriasAvailable);if(""!=o){e.createDictionarySelectionView(o,e.options.expression),C.CfgEvolutionCriteriaView=void 0;var n=s.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(t){null!=t.xml&&("products"==o?(e.options.expression.xmlExpression=t.xml,e.options.expression.psXmlDesc=t.xmlDesc,e.options.expression.psJson=t.json):"manufacturingPlans"==o&&(e.options.expression.impXml=t.xml,e.options.expression.mpXmlDesc=t.xmlDesc,e.options.expression.mpJson=t.json)),null!=t.xml&&e.updateCollection(e.options.expression);var i={buttonId:""};null!=t.xml&&(i.buttonId="firstButton"),e.onUpdate(i),s.ModelEvents.unsubscribe(n)})}else require(["DS/CfgEvolutionUX/CfgEvolutionCriteriaView"],function(t){e.options.parentElement=e.options.parent;var i,o=m.CFG_Ok,n=m.CFG_Cancel;"SessionEffectivity"==e.options.mode&&(o=m.CFG_Apply,n=m.CFG_Back);i=e.onUpdate;var s={isHeader:!0,isFooter:!0,firstButtonText:o,secondButtonText:n,headerText:e.options.selectedmodel.get("marketingName")?e.options.selectedmodel.get("marketingName"):e.options.selectedmodel.get("name"),toggleSessionEffectivity:!1,onButtonClickCB:i};e.criteriaViewContainer=new u(s).render(),e.criteriaViewContainer.getContent().addClassName("CfgContainerView-EditEvolution"),e.options.parent=e.criteriaViewContainer._body,e.CfgEvolutionCriteriaView=new t(e.options),e.CfgEvolutionCriteriaView.render(),e.criteriaViewContainer.inject(e.options.parentElement),e.options.parent=e.options.parentElement})}else t.showwarning(h.Not_Accessible_Eff_Error,"error")})}},e.options.removeModelCallback=function(i){if(e.collection.removeModel(i),"Applicability"==e.options.mode){e.collection.getselectedModelsIDs();var o=e.collection.getGlobalChangeExpression();o=o.replace(/&(?!amp;)/g,"&amp;"),new Promise(function(i,n){var a=t.getChangeUrl(e.options.objectid,"PUT"),l={};l="Change Action"==s.type?{version:"v0",changeaction:{modify:{applicability:{xml:o}}}}:{version:"1.0",applicability:{xml:o}};l=JSON.stringify(l);t.makeWSCall(a,"PUT","enovia","application/json",l,function(e){i(e)},function(e){n(e)},!0)}).then(function(i){e.CfgAutocompleteControlEvolutionObj.disableSelection(),t.showwarning(h.model_Successful_Removal,"success"),C.sendApplicabilityChangeEvent()},function(e){t.showwarning(h.Save_Fail_Applicability,"error")})}else if("SessionEffectivity"==e.options.mode){e.CfgAutocompleteControlEvolutionObj.disableSelection();e.collection.getselectedModelsIDs()}};var i=e.options.parentElement;"SessionEffectivity"==e.options.mode&&null!=C.options.dialogue&&"undefined"!=C.options.dialogue&&null!=C.options.dialogue.object&&"undefined"!=C.options.dialogue.object&&(e.options.parentElement=C.options.dialogue.modelViewContainer._body,e.options.parent=C.options.dialogue.modelViewContainer._body),e.warningMsgContainer=UWA.createElement("div",{class:"cfg-warning-msg-container"}),e.warningMsgContainer.inject(e.options.parent),e.autocompleteParent=UWA.createElement("div",{class:"Cfg-autocompleteParentClass",styles:{display:"flex",float:"right",padding:"0 5px"}}),e.autocompleteParent.inject(e.options.parent),(null!=e.options.Access&&"false"==e.options.Access.SetApplicability||1==e.options.readOnly)&&(e.autocompleteParent.hide(),e.options.noModelsErrorMessage=h.Empty_Applicability_beyond_active_state);var o=new DOMParser;null!==e.expressionXml&&void 0!==e.expressionXml||(e.expressionXml="");var n=o.parseFromString(e.expressionXml,"text/xml").getElementsByTagName("Description");e.collection=new l(e.options),e.collection.reset(),e.collection.initialising(e.options),"Applicability"==e.options.mode&&C.sendApplicabilityChangeEvent();var r="";e.options.mode&&(r=e.options.mode),e.CfgAutocompleteControlEvolutionObj=new v({placeholder:h.Autocomplete_Placeholder,multiSelect:!1,typeOfObject:"Model",collection:e.collection,environment:e.options.environment,mode:r,onSelect:function(t,i){console.log("item selected : "+t+" position : "+i),t._attributes.forEach(function(e){"ds6w:label"==e.name&&(t.marketingName=e.value),"ds6w:identifier"==e.name&&(t.name=e.value),"ds6w:who/ds6w:responsible"==e.name&&(t.owner=e.value),"ds6w:what/ds6w:status"==e.name&&-1!=e.value.indexOf("Model.")&&(t.state=e.value.split("Model.").pop())}),e.addModel(t),"Applicability"==e.options.mode&&e.getCAApplicability()},searchCallback:function(t){if(console.log(t),"3DSpace"==e.options.environment)t.length>0&&(t.forEach(function(t){var i={};t.attributes.forEach(function(e){"resourceid"==e.name&&(i.value=e.value),"preview_url"==e.name&&(i.image=e.value),"type_icon_url"==e.name&&(i.icon=e.value),"ds6w:label"==e.name&&(i.marketingName=e.value),"ds6w:identifier"==e.name&&(i.name=e.value),"ds6w:who/ds6w:responsible/ds6w:originator"==e.name&&(i.owner=e.value),"ds6w:what/ds6w:status"==e.name&&-1!=e.value.indexOf("Model.")&&(i.state=e.value.split("Model.").pop())}),e.addModel(i)}),"Applicability"==e.options.mode&&e.getCAApplicability());else if(t.length>0){for(var i=0;i<t.length;i++){var o={};o.value=t[i].get("id"),o.image=t[i].get("preview_url"),o.icon=t[i].get("type_icon_url"),o.marketingName=t[i].get("ds6w:label"),o.name=t[i].get("ds6w:identifier"),o.owner=t[i].get("ds6w:originator"),o.state=t[i].get("ds6w:status"),e.addModel(o)}"Applicability"==e.options.mode&&e.getCAApplicability()}}}),e.autocompletecontainer=UWA.createElement("div",{class:"Cfg-autocompletecontainerClass",html:this.CfgAutocompleteControlEvolutionObj}),e.autocompletecontainer.inject(e.autocompleteParent),e.autocompletecontainer.hide();var c=[];if(c.push({fonticon:"plus",text:m.Add_Model,handler:function(t,i){null!=e.toolBar.menu.items[0].elements.container.children[0]&&e.toolBar.menu.items[0].elements.container.children[0].toggleClassName("cfg-active-plus"),e.toggleHidden?e.autocompletecontainer.hide():(e.autocompletecontainer.show(),e.CfgAutocompleteControlEvolutionObj.elements.input.focus()),e.toggleHidden=!e.toggleHidden}}),null!=e.showImportAppIcon&&1==e.showImportAppIcon&&c.push({fonticon:"import ",text:m.Copy_Applicability,handler:function(t,i){null!=e&&null!=e&&null!=e.enableImportButton&&0==e.enableImportButton||(e.copyApplicability(),e.enableImportButton=!1,null!=e.toolBar.menu.items[1]&&e.toolBar.menu.items[1].elements.container.children[0].addClassName("disableButton"))}}),e.toolBar=new a({renderTo:e.autocompleteParent,items:c}),e.enableDisableIcons(),"Applicability"!=e.options.mode||0!=n.length||""==e.expressionXml){e.modelListView=new d(e.options),e.modelListView.render(e.collection);e.collection.getselectedModelsIDs();s.ModelEvents.subscribe({event:"ModelSelected"},function(t){e.addModel(t)}),e.options.parentElement=i,e.options.parent=i,e.evolutionSpinner.hide()}else e.processexpressionsForDescriptionForApplicability()},populateModels:function(e){e.addModelsFromServer()},createDictionarySelectionView:function(e,i){var o=this;s.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var a={};if("products"==e?(a.mode="PRODUCTS",a.psJson=i.psJson):"manufacturingPlans"==e&&(a.mode="MANUFACTURINGPLAN",a.psJson=i.mpJson),a.use="","SessionEffectivity"==o.options.mode?(a.firstButtonText=m.CFG_Apply,a.secondButtonText=m.CFG_Back):(a.firstButtonText=m.CFG_Ok,a.secondButtonText=m.CFG_Cancel),s.renderTo=a.parentElement=o.options.parentElement,a.ModelLabel=o.options.selectedmodel.get("marketingName")?o.options.selectedmodel.get("marketingName"):o.options.selectedmodel.get("name"),a.displayexpression=i.displayexpression?i.displayexpression:"",a.displayexpression=a.displayexpression.substring(a.displayexpression.indexOf(":")+1),a.displayexpression.trim(),o.options.evolutionSpinner&&o.options.evolutionSpinner.hide(),"PRODUCTS"!=a.mode&&"MANUFACTURINGPLAN"!=a.mode||o.CfgVersionGraphLayoutInstance.create(a),null==s.getDictionaryByCriteria(i.modelId,e)[e]){var l="",r="",d='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="Strict">',c="</FilterSelection></CfgFilterExpression>";"products"==e?r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+i.name+'" >'+i.xmlExpression+"</Context>"+c:"manufacturingPlans"==e&&(r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+i.name+'" >'+i.impXml+"</Context>"+c),""!==r&&(l={evolutionExpression:JSON.stringify({filterExpression:n.getValidXmlWithoutDescId(r)})},console.log("CfgEvolutionLayoutFactory evoExpression = "+r+" wParam after descId removed = "+l.evolutionExpression)),("products"==e||"manufacturingPlans"==e?t.getDictionaryFromServer(i.modelId,"onlyUnfrozenNodes=1&"+e,null,l):t.getDictionaryFromServer(i.modelId,e)).then(function(t){s.addDictionaryByCriteria(i.modelId,t,e),a.data=s.getDictionaryByCriteria(i.modelId,e),"PRODUCTS"==a.mode?o.CfgVersionGraphLayoutInstance.render(a.data.products):"MANUFACTURINGPLAN"==a.mode&&o.CfgVersionGraphLayoutInstance.render(a.data.manufacturingPlans)})}else a.data=s.getDictionaryByCriteria(i.modelId,e),setTimeout(function(){"PRODUCTS"==a.mode?o.CfgVersionGraphLayoutInstance.render(a.data.products):"MANUFACTURINGPLAN"==a.mode&&o.CfgVersionGraphLayoutInstance.render(a.data.manufacturingPlans)},100)},addModelFromNative:function(e){var t=this;e.length>0&&(e.forEach(function(e){var i={};e.basicData.forEach(function(e){"resourceid"==e.name&&(i.value=e.value),"preview_url"==e.name&&(i.image=e.value),"type_icon_url"==e.name&&(i.icon=e.value),"ds6w:label"==e.name&&(i.marketingName=e.value),"ds6w:identifier"==e.name&&(i.name=e.value),"ds6w:who/ds6w:responsible/ds6w:originator"==e.name&&(i.owner=e.value),"ds6w:what/ds6w:status"==e.name&&-1!=e.value.indexOf("Model.")&&(i.state=e.value.split("Model.").pop())}),t.addModel(i)}),"Applicability"==t.options.mode&&t.getCAApplicability())},addModel:function(e){var t=e,i=[];i=JSON.stringify({builds:i});var o={modelId:t.value,psJson:[],mpJson:[],viewJson:null,iDateJson:{DateRanges:[]},iUnitJson:i,xmlExpression:"",iDateXml:"",iUnitXml:"",impXml:"",productstatecheckbox:!0,unitcheckbox:!0,datestatecheckbox:!0,manufacturingplanstatecheckbox:!0,milestoneJson:[],milestoneXml:"",milestoneCheckbox:!0},n={};n.expression=o,n.image=t.image,n.icon=t.icon,n.expression.modelId=n.modelId=t.value,n.expression.id=n.id=t.value,n.marketingName=n.expression.marketingName=t.marketingName,n.expression.name=n.name=t.name,n.expression.owner=n.owner=t.owner,n.expression.state=n.state=t.state,this.collection.addModel(n),this.CfgAutocompleteControlEvolutionObj.updateCollection(this.collection),this.modelListView.adjustTileFlexStyles(),this.modelListView.adjustResponsiveView();this.collection.getselectedModelsIDs()},getCAApplicability:function(){var e=this,i=e.collection.getGlobalChangeExpression();i=i.replace(/&(?!amp;)/g,"&amp;");new Promise(function(o,n){var a=t.getChangeUrl(e.options.objectid,"PUT"),l={};l="Change Action"==s.type?{version:"v0",changeaction:{modify:{applicability:{xml:i}}}}:{version:"1.0",applicability:{xml:i}};l=JSON.stringify(l);t.makeWSCall(a,"PUT","enovia","application/json",l,function(e){o(e),C.sendApplicabilityChangeEvent()},function(e){n(e)},!0)})},oniconbar:function(e,t){},processexpressionJsonForIds:function(e){for(var t=e.options.expressionJson.length,i=0;i<t;i++)for(var o=e.options.expressionJson[i],n=0;n<s.Models.length;n++)for(var a=s.Models[n].attributes.length,l=0;l<a;l++)"ds6w:identifier"==s.Models[n].attributes[l].name&&s.Models[n].attributes[l].value==o.expression.name&&(o.expression.modelId=o.modelId=s.Models[n].attributes[0].value,o.id=s.Models[n].attributes[0].value);for(var r=0;r<t;r++)for(o=e.options.expressionJson[r],n=0;n<s.Models.length;n++)for(a=s.Models[n].attributes.length,l=0;l<a;l++)s.Models[n].attributes[0].value==o.id&&"ds6w:label"==s.Models[n].attributes[l].name&&(o.expression.marketingName=o.marketingName=s.Models[n].attributes[l].value),s.Models[n].attributes[0].value==o.id&&"ds6w:identifier"==s.Models[n].attributes[l].name&&(o.name=s.Models[n].attributes[l].value),s.Models[n].attributes[0].value==o.id&&"ds6w:who/ds6w:responsible/ds6w:originator"==s.Models[n].attributes[l].name&&(o.owner=s.Models[n].attributes[l].value),s.Models[n].attributes[0].value==o.id&&"ds6w:what/ds6w:status"==s.Models[n].attributes[l].name&&(o.state=s.Models[n].attributes[l].value.replace("Model.","")),s.Models[n].attributes[0].value==o.id&&"preview_url"==s.Models[n].attributes[l].name&&(o.image=s.Models[n].attributes[l].value),s.Models[n].attributes[0].value==o.id&&"type_icon_url"==s.Models[n].attributes[l].name&&(o.icon=s.Models[n].attributes[l].value)},AddModelsFromNative:function(e){var t=this,i=e.split(",");t.getConfigurationContext(i).then(function(e){var i=e.results;i.length>0&&(i.forEach(function(e){var i={};e.attributes.forEach(function(e){"resourceid"==e.name&&(i.value=e.value),"preview_url"==e.name&&(i.image=e.value),"type_icon_url"==e.name&&(i.icon=e.value),"ds6w:label"==e.name&&(i.marketingName=e.value),"ds6w:identifier"==e.name&&(i.name=e.value),"ds6w:who/ds6w:responsible/ds6w:originator"==e.name&&(i.owner=e.value),"ds6w:what/ds6w:status"==e.name&&-1!=e.value.indexOf("Model.")&&(i.state=e.value.split("Model.").pop())}),t.addModel(i)}),"Applicability"==t.options.mode&&t.getCAApplicability())})},getGlobalSessiondata:function(){return this.collection.getGlobalSessiondata()},copyApplicability:function(){var e=this;new Promise(function(i,o){var n=t.getChangeUrl(e.options.objectid,"PUT"),a={};"Change Action"==s.type&&(a={version:"v0",changeaction:{modify:{applicability:{xml:e.appToBeCopied}}}}),"Change Order"==s.type&&(a={version:"1.0",applicability:{xml:e.appToBeCopied}});a=JSON.stringify(a);t.makeWSCall(n,"PUT","enovia","application/json",a,function(o){console.log("import successful");var n=document.querySelector("#FacetDivForApplicabilityContext");for("3DSpace"==enoviaServerFilterWidget.mode&&(n=document.querySelector("#contentAppdiv"));n&&n.hasChildNodes();)n.removeChild(n.lastChild);e.create(e.options),t.showwarning(h.Import_Applicability_FromCO_Successful,"success"),i(o)},function(e){console.log("import failed"),t.showwarning(h.Import_Applicability_FromCO_Failed,"error"),o(e)},!0)})},processexpressionsForDescriptionForApplicability:function(){var e=this;console.log(e.options.expressionJson);e=this;for(var i=[],o=0;o<e.options.expressionJson.length;o++){var n="products";null==s.getDictionaryByCriteria(e.options.expressionJson[o].id,n)[n]&&(n="products=1&manufacturingPlans",i.push(t.getDictionaryFromServer(e.options.expressionJson[o].id,n)))}if(0==e.options.expressionJson.length){e.collection=new l(e.options),e.collection.reset(),e.collection.initialising(e.options),e.modelListView=new d(e.options),e.modelListView.render(e.collection);e.collection.getselectedModelsIDs();return s.ModelEvents.subscribe({event:"ModelSelected"},function(t){e.addModel(t)}),void e.evolutionSpinner.hide()}Promise.all(i).then(function(t){t.forEach(function(t){var i="products";s.addDictionaryByCriteria(t.id,t,i);i="manufacturingPlans";s.addDictionaryByCriteria(t.id,t,i),0,e.populateDisplayNames(t),null==window.DescriptionCount&&(window.DescriptionCount=1);for(var o=0;o<e.options.expressionJson.length;o++){var n=e.options.expressionJson[o].expression;if(e.options.expressionJson[o].id==t.id.replace("pid:","")){var a=n.psJson,l=[],r=[];if(0!=a.length)for(var d=0;d<a.length;d++){window.DescriptionCount++;var c=window.DescriptionCount;a[d].start.displayname=e.descriptionMap[t.id]["products"+a[d].start.name+"_"+a[d].start.revision],r.push('<TreeSeries DescId = "'+c+'" DisplayName="'+a[d].start.displayname+'"></TreeSeries>'),n.xmlExpression=n.xmlExpression.replace("products"+a[d].start.name+"_"+a[d].start.revision,c);for(var u=0;u<a[d].end.length;u++)window.DescriptionCount++,c=window.DescriptionCount,a[d].end[u].displayname=e.descriptionMap[t.id]["products"+a[d].end[u].name+"_"+a[d].end[u].revision],r.push('<TreeSeries DescId = "'+c+'" DisplayName="'+a[d].end[u].displayname+'"></TreeSeries>'),n.xmlExpression=n.xmlExpression.replace("products"+a[d].end[u].name+"_"+a[d].end[u].revision,c)}var p=n.mpJson;if(0!=p.length)for(var m=0;m<p.length;m++){window.DescriptionCount++;c=window.DescriptionCount;p[m].start.displayname=e.descriptionMap[t.id]["manufacturingPlans"+p[m].start.name+"_"+p[m].start.revision],l.push('<TreeSeries DescId = "'+c+'" DisplayName="'+p[m].start.displayname+'"></TreeSeries>'),n.impXml=n.impXml.replace("manufacturingPlans"+p[m].start.name+"_"+p[m].start.revision,c);for(var h=0;h<p[m].end.length;h++)window.DescriptionCount++,c=window.DescriptionCount,p[m].end[h].displayname=e.descriptionMap[t.id]["manufacturingPlans"+p[m].end[h].name+"_"+p[m].end[h].revision],l.push('<TreeSeries DescId = "'+c+'" DisplayName="'+p[m].end[h].displayname+'"></TreeSeries>'),n.impXml=n.impXml.replace("manufacturingPlans"+p[m].end[h].name+"_"+p[m].end[h].revision,c)}n.psXmlDesc=r,n.mpXmlDesc=l}}}),e.collection=new l(e.options),e.collection.reset(),e.collection.initialising(e.options),e.collection.updatedisplayExpressionsAsPerDisplayNames(),e.modelListView=new d(e.options),e.modelListView.render(e.collection);e.collection.getselectedModelsIDs();s.ModelEvents.subscribe({event:"ModelSelected"},function(t){e.addModel(t)}),e.evolutionSpinner.hide()})},populateDisplayNames:function(e){this.tnrArray={},this.tnrArray.type="products",this.rootrevisionarray=[];var t=e.products;this.mainderived(this.rootrevisionarray,t),this.descriptionMap[e.id]={},this.tnrArray.type="manufacturingPlans",this.rootrevisionarray=[];t=e.manufacturingPlans;this.mainderived(this.rootrevisionarray,t),this.descriptionMap[e.id]=this.tnrArray},mainderived:function(e,t){if(null!=t&&(0!==Object.keys(t).length||t.constructor!==Object)){var i={name:t.name,displayname:t.displayValue,revision:t.revision};this.tnrArray[this.tnrArray.type+t.name+"_"+t.revision]=t.displayValue,e.push(i),this.addChildren(i,t.Derived),this.mainderived(e,t["Main Derived"])}},addChildren:function(e,t){if(""!=t&&null!=t){null!=e.children&&0!=e.children.length||(e.children=[]);for(var i=0;i<t.length;i++){var o={name:t[i].name,displayname:t[i].displayValue,revision:t[i].revision};this.tnrArray[this.tnrArray.type+o.name+"_"+o.revision]=o.displayname,e.children.push(o),this.lastrevision=o,this.addChildren(o,t[i].Derived);var n=t[i]["Main Derived"];0!=Object.keys(n).length&&n.constructor===Object&&this.addChildren(e.children[e.children.length-1],[n])}}},getConfigurationContext:function(e){var i=e.map(function(e){return"physicalid : "+e}).join(" OR ");return new Promise(function(e,o){var n={};n={with_indexing_date:!0,with_nls:!1,label:"cfgLabel",locale:"en",select_predicate:["ds6w:label","ds6w:type","ds6w:description","ds6w:identifier","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:lastModifiedBy","ds6wg:marketing_Name"],select_file:["icon","thumbnail_2d"],query:'(flattenedtaxonomies:"types/Model") AND '+i,order_by:"desc",order_field:"relevance",nresults:1e3,start:"0",source:[],tenant:enoviaServerFilterWidget.tenant},n=JSON.stringify(n);t.makeWSCall("/search?xrequestedwith=xmlhttprequest","POST","enovia","application/json",n,function(t){e(t)},function(){o()},!0,{isfederated:"true"})})},enableDisableIcons:function(){null!=this.toolBar.menu.items[1]&&null!=this.toolBar.menu.items[1].elements.container&&(null!=this.enableImportButton&&1==this.enableImportButton?this.toolBar.menu.items[1].elements.container.removeClassName("disableButton"):null!=this.enableImportButton&&0==this.enableImportButton&&this.toolBar.menu.items[1].elements.container.addClassName("disableButton"))}};return C}),define("DS/CfgEvolutionUX/CfgDateView",["UWA/Core","UWA/Class/View","UWA/Class/Model","DS/Handlebars/Handlebars","DS/CfgEvolutionUX/CfgDateModel","text!DS/CfgEvolutionUX/CfgDateTemplate.html","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/Controls/DatePicker","DS/CfgBaseUX/scripts/CfgUtility","UWA/Date","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d){"use strict";var c=o.compile(s);return t.extend({className:"CfgDateView",model:null,tagName:"div",name:"CfgDateView",setup:function(){},hideORShowDeleteForfirstDate:function(){1==this.model.get("isThisOnlyModelInCollection")?this._dateDiv.getElement(".cfgDeleteDateDiv").hide():this._dateDiv.getElement(".cfgDeleteDateDiv").show()},updateMinValOfFromDP:function(){""==this.model.get("fromDateMinValue")?this._fromDatePicker.minValue=void 0:this._fromDatePicker.minValue=new Date(r.convertMillisectoDate(this.model.get("fromDateMinValue")))},updateMinValOfToDP:function(){""==this.model.get("toDateMinValue")?this._toDatePicker.minValue=void 0:this._toDatePicker.minValue=new Date(r.convertMillisectoDate(this.model.get("toDateMinValue")))},updatetoDate:function(){this._toDatePicker.value=r.convertMillisectoDate(this.model.get("toDateMilliSec"))},init:function(e){this.model=e.model,this.displayCompactMode=e.displayCompactMode,this.isReadOnly=e.isReadOnly,this.listenTo(this.model,"onChange:toDateMilliSec",this.updatetoDate),this.listenTo(this.model,"onChange:isThisOnlyModelInCollection",this.hideORShowDeleteForfirstDate),this.listenTo(this.model,"onChange:fromDateMinValue",this.updateMinValOfFromDP),this.listenTo(this.model,"onChange:toDateMinValue",this.updateMinValOfToDP)},render:function(){if(!0===this.isReadOnly)var e=this.addDateReadOnly();else{e=this.addDate();this.applyCompactComfortableMode()}return e},applyCompactComfortableMode:function(){null==this.displayCompactMode||!1===this.displayCompactMode?(this._fromDatePicker.touchMode=!0,this._toDatePicker.touchMode=!0,this._dateDiv.getElement(".cfgFromLabelDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgToLabelDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgSwitchDateDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgWUXDate").setAttributeNode(document.createAttribute("touch-mode"))):(this._fromDatePicker.touchMode=!1,this._toDatePicker.touchMode=!1,this._dateDiv.getElement(".cfgFromLabelDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgToLabelDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgSwitchDateDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgWUXDate").removeAttribute("touch-mode"))},convertMillisectoDateReadMode:function(e){var t=parseInt(e);if(isNaN(t))return null;var i=new Date(t);return d.strftime(i,"%b %d %Y")},addDateReadOnly:function(){this._dateDiv=new e.createElement("div",{id:this.model.id,class:"dateDiv"}),this._dateDiv.setHTML(c()),this.dateViewToolTip="";var t=this._dateDiv.getElement(".cfgFromLabelDiv");t.setHTML(a.Filter_Date_From),t.setStyle("display","none");var i=this._dateDiv.getElement(".cfgFromDateDiv");i.addClassName("cfgFromDateDivReadOnly"),i.removeClassName("cfgFromDateDiv"),e.is(this.model.get("fromDateMilliSec"))&&""!=this.model.get("fromDateMilliSec")?i.innerHTML=this.convertMillisectoDateReadMode(this.model.get("fromDateMilliSec")):"-INF"==this.model.get("fromDate")&&(i.innerHTML=a.CfgDateMinusInf);var o=this._dateDiv.getElement(".cfgToLabelDiv");o.setHTML(a.Filter_Date_To),o.addClassName("cfgToLabelDivReadOnly");var n=this._dateDiv.getElement(".cfgToDateDiv");return n.addClassName("cfgToDateDivReadOnly"),n.removeClassName("cfgToDateDiv"),e.is(this.model.get("toDateMilliSec"))&&""!=this.model.get("toDateMilliSec")?n.innerHTML=this.convertMillisectoDateReadMode(this.model.get("toDateMilliSec")):"INF"==this.model.get("toDate")&&(n.innerHTML=a.CfgDateInf),this._dateDiv.getElement(".fromGroup").addClassName("fromGroupReadOnly"),"single"==this.model.get("type")?(this._dateDiv.getElement(".toGroup").addClassName("cfgDateDisplayNone"),this._dateDiv.getElement(".cfgFromLabelDiv").addClassName("cfgDateDisplayNone"),this.dateViewToolTip=this.dateViewToolTip.concat(i.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat("\n")):"range"==this.model.get("type")&&(this._dateDiv.getElement(".cfgFromLabelDiv").removeClassName("cfgDateDisplayNone"),this._dateDiv.getElement(".toGroup").removeClassName("cfgDateDisplayNone"),this.dateViewToolTip=this.dateViewToolTip.concat(i.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat(" "),this.dateViewToolTip=this.dateViewToolTip.concat(o.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat(" "),this.dateViewToolTip=this.dateViewToolTip.concat(n.innerHTML),this.dateViewToolTip=this.dateViewToolTip.concat("\n")),null==this.displayCompactMode||!1===this.displayCompactMode?(this._dateDiv.getElement(".cfgToLabelDiv").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgFromDateDivReadOnly").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgToDateDivReadOnly").setAttributeNode(document.createAttribute("touch-mode")),this._dateDiv.getElement(".cfgWUXDate").setAttributeNode(document.createAttribute("touch-mode"))):(this._dateDiv.getElement(".cfgToLabelDiv").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgFromDateDivReadOnly").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgToDateDivReadOnly").removeAttribute("touch-mode"),this._dateDiv.getElement(".cfgWUXDate").removeAttribute("touch-mode")),this._dateDiv},addDate:function(){var t=this;this._fromDatePickerChangeEventActive=!1,this._dateDiv=new e.createElement("div",{id:this.model.id,class:"dateDiv"}),this._dateDiv.setHTML(c()),this._dateDiv.getElement(".cfgFromLabelDiv").setHTML(a.Filter_Date_From);var i=this._dateDiv.getElement(".cfgFromDateDiv");this._fromDatePicker=new l({value:void 0,minValue:void 0,maxValue:void 0,allowUndefinedFlag:!0}).inject(i),e.is(this.model.get("fromDateMilliSec"))&&""!=this.model.get("fromDateMilliSec")?this._fromDatePicker.value=r.convertMillisectoDate(this.model.get("fromDateMilliSec")):"-INF"==this.model.get("fromDate")&&(this._fromDatePicker.elements.inputField.placeholder=a.CfgDateMinusInf),""!=this.model.get("fromDateMinValue")&&(this._fromDatePicker.minValue=new Date(r.convertMillisectoDate(this.model.get("fromDateMinValue")))),this._fromDatePicker.addEventListener("change",function(e){null==t._fromDatePicker.value?(t.model.set("fromDateMilliSec",""),t.model.set("fromDate","-INF"),t.model.set("toDateMinValue",t.model.get("fromDateMilliSec")),"INF"==t.model.get("toDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.dispatchEvent("onChangeDate",arguments),t.validate(e)):(t.model.set("fromDateMilliSec",e.dsModel.value.getTime()),t.model.set("fromDate",e.dsModel.value.toDateString()),t.model.set("toDateMinValue",t.model.get("fromDateMilliSec")),t.dispatchEvent("onChangeDate",arguments),t.validate(e))}),this._fromDatePicker.addEventListener("blur",function(e){null==t._fromDatePicker.value&&(t.model.set("fromDateMilliSec",""),t.model.set("fromDate","-INF"),"INF"==t.model.get("toDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.validate(e))}),this._dateDiv.getElement(".cfgToLabelDiv").setHTML(a.Filter_Date_To);var o=this._dateDiv.getElement(".cfgToDateDiv");this._toDatePicker=new l({value:void 0,minValue:this._fromDatePicker.value?this._fromDatePicker.value:this._fromDatePicker.minValue,maxValue:void 0,allowUndefinedFlag:!0}).inject(o),e.is(this.model.get("toDateMilliSec"))&&""!=this.model.get("toDateMilliSec")?this._toDatePicker.value=r.convertMillisectoDate(this.model.get("toDateMilliSec")):"INF"==this.model.get("toDate")&&(this._toDatePicker.elements.inputField.placeholder=a.CfgDateInf),this._toDatePicker.addEventListener("change",function(e){null==t._toDatePicker.value?(t.model.set("toDateMilliSec",""),t.model.set("toDate","INF"),"-INF"==t.model.get("fromDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.dispatchEvent("onChangeDate",arguments),t.validate(e)):(t.model.set("toDateMilliSec",e.dsModel.value.getTime()),t.model.set("toDate",e.dsModel.value.toDateString()),t.dispatchEvent("onChangeDate",arguments),t.validate(e))}),this._toDatePicker.addEventListener("blur",function(e){null==t._toDatePicker.value&&(t.model.set("toDateMilliSec",""),t.model.set("toDate","INF"),"-INF"==t.model.get("fromDate")&&"range"==t.model.get("type")&&(this.getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),t._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")),t.validate(e))});var n=this._dateDiv.getElement(".cfgSwitchDateDiv");e.createElement("Label",{html:"single"==this.model.get("type")?a.Filter_Date_DateRange:a.Filter_Date_SingleDate,class:"cfgDateSingleOrRange"}).inject(n);n.addEventListener("click",function(e){"range"==t.model.get("type")?(t.model.set("type","single"),t.singleOrRangeDisplay()):"single"==t.model.get("type")&&(t.model.set("toDateMilliSec",t.model.get("fromDateMilliSec")),t.model.set("type","range"),t.singleOrRangeDisplay()),t.dispatchEvent("onChangeDate",arguments),t.validate()}),n.addEventListener("mouseover",t.onHyperLink);var s=this._dateDiv.getElement(".cfgDeleteDateDiv");return s.addClassName("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear "),1==this.model.get("isThisOnlyModelInCollection")&&s.hide(),s.addEventListener("click",function(e){this.parentElement.parentElement.remove(),t.dispatchEvent("onDeleteDate",arguments),t.dispatchEvent("onChangeDate",arguments)}),this.singleOrRangeDisplay(),this._dateDiv},singleOrRangeDisplay:function(){var e=this._dateDiv.getElement(".cfgWUXDate");"single"==this.model.get("type")?(e.getElement(".toGroup").addClassName("cfgDateDisplayNone"),e.getElement(".cfgFromLabelDiv").addClassName("cfgDateDisplayNone"),e.getElement(".cfgSwitchDateDiv").innerText=a.Filter_Date_DateRange):"range"==this.model.get("type")&&(e.getElement(".cfgFromLabelDiv").removeClassName("cfgDateDisplayNone"),e.getElement(".toGroup").removeClassName("cfgDateDisplayNone"),e.getElement(".cfgSwitchDateDiv").innerText=a.Filter_Date_SingleDate)},onHyperLink:function(){this.style.cursor="pointer"},validate:function(e){var t=this.model.get("fromDate"),i=this.model.get("toDate");"single"==this.model.get("type")?(this._fromDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._toDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._dateDiv.getElement(".cfgDeleteDateDiv").removeClassName("cfgWUXDateCrossInvalid"),"-INF"==t&&this.model.set("fromDate",""),this._fromDatePicker.elements.inputField.placeholder=""):("-INF"==t&&(this._fromDatePicker.elements.inputField.placeholder=a.CfgDateMinusInf),"INF"==i&&(this._toDatePicker.elements.inputField.placeholder=a.CfgDateInf),"-INF"==t&&"INF"==i?(this._fromDatePicker.getContent().getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),this._toDatePicker.getContent().getElement(".wux-ui-state-undefined").addClassName("cfgWUXDateInvalid"),this._dateDiv.getElement(".cfgDeleteDateDiv").addClassName("cfgWUXDateCrossInvalid")):(this._fromDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._toDatePicker.getContent().getElement(".wux-ui-state-undefined").removeClassName("cfgWUXDateInvalid"),this._dateDiv.getElement(".cfgDeleteDateDiv").removeClassName("cfgWUXDateCrossInvalid")))},adjustResponsiveViewDate:function(e){null==this._dateDiv.getElement(".cfgWUXDate")||e<=0||(!0===this.isReadOnly?e<210&&e>130?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay")):e>=210?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").removeClassName("flexColumn"),this._dateDiv.getElement(".toGroup").removeClassName("toGroupSmallDisplay")):e<=130&&(this._dateDiv.getElement(".cfgWUXDate").addClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay")):e<=520&&e>282?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay"),this._dateDiv.getElement(".cfgToLabelDiv").addClassName("cfgToLabelDivSmallDisplay")):e>520?(this._dateDiv.getElement(".cfgWUXDate").removeClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").removeClassName("flexColumn"),this._dateDiv.getElement(".toGroup").removeClassName("toGroupSmallDisplay"),this._dateDiv.getElement(".cfgToLabelDiv").removeClassName("cfgToLabelDivSmallDisplay")):e<=282&&(this._dateDiv.getElement(".cfgWUXDate").addClassName("flexColumn"),this._dateDiv.getElement(".fromToGroup").addClassName("flexColumn"),this._dateDiv.getElement(".toGroup").addClassName("toGroupSmallDisplay"),this._dateDiv.getElement(".cfgToLabelDiv").addClassName("cfgToLabelDivSmallDisplay")))}})}),define("DS/CfgEvolutionUX/CfgWUXDatePicker",["UWA/Class/View","UWA/Class/Model","UWA/Class/Collection","DS/Controls/TooltipModel","DS/CfgEvolutionUX/CfgDateView","DS/CfgEvolutionUX/CfgDateModel","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgUtility","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r){"use strict";return e.extend({className:"CfgWUXDatePicker",collection:null,viewCollection:[],init:function(e,t,o,n){this.options=o;var a=this,l=[];if(UWA.is(t)&&(l=t.DateRanges),this.count=0,this.disableAddDate=!1,this.dateToolTip="",this.collection=new i,this.collection.addEvent("onRemove",function(e,t,i){1==this.length&&this.last().set("isThisOnlyModelInCollection",!0)}),this.collection.addEvent("onAdd",function(e,t,i){1==this.length?this.first().set("isThisOnlyModelInCollection",!0):this.length>1&&this.first().set("isThisOnlyModelInCollection",!1)}),this.evolutionDlgDateDiv=e,this.cfgDateDiv=UWA.createElement("div",{id:"cfgDateDiv"}),this.datesParentDiv=UWA.createElement("div",{id:"datesParentDiv"}),this.datesParentDiv.inject(this.cfgDateDiv),null==this.evolutionDlgDateDiv)return null;if(this.cfgDateDiv.inject(this.evolutionDlgDateDiv),this.viewCollection=[],this.cfgDateDiv.addEvent&&this.cfgDateDiv.addEvent("resize",function(){a.viewCollection.forEach(function(e,t){e.adjustResponsiveViewDate(a.cfgDateDiv.getDimensions().width)})}),0==l.length){this.count++;let e="range";"SingleDate"==o.defaultDateBehavior&&(e="single");var d=new s({id:this.count,type:e,fromDate:"",fromDateMilliSec:"",fromDateMinValue:"",toDate:r.CfgDateInf,toDateMilliSec:"",toDateMinValue:"",isThisOnlyModelInCollection:!0});this.collection.add(d)}else{for(var c=0;c<l.length;c++)"null"==l[c].Start&&(l[c].Start=""),"null"==l[c].End&&(l[c].End=""),"null"==l[c].millisecStart&&(l[c].millisecStart=""),"null"==l[c].millisecEnd&&(l[c].millisecEnd="");for(c=0;c<l.length;c++){this.count++;d=null;var u="";l[c].Start==l[c].End?(0!=c&&(u=l[c-1].millisecStart),d=new s({id:this.count,type:"single",fromDate:l[c].Start,fromDateMilliSec:l[c].millisecStart,fromDateMinValue:u,toDate:r.CfgDateInf,toDateMilliSec:"",toDateMinValue:l[c].millisecStart,isThisOnlyModelInCollection:!1})):(0!=c&&(u=l[c-1].millisecEnd),d=new s({id:this.count,type:"range",fromDate:l[c].Start,fromDateMilliSec:l[c].millisecStart,fromDateMinValue:u,toDate:l[c].End,toDateMilliSec:l[c].millisecEnd,toDateMinValue:l[c].millisecStart,isThisOnlyModelInCollection:!1})),this.collection.add(d)}}return this},isToDisableAddDate:function(){this.disableAddDate=!1;for(var e=0;e<this.collection.length;e++){var t=this.collection.at(e);if("single"==t.get("type")&&e==this.collection.length-1&&""==t.get("fromDateMilliSec")||"range"==t.get("type")&&"INF"==t.get("toDate"))return this.addRangeLabel.addClassName("cfgLabelAddDateDisabled"),void(this.disableAddDate=!0)}this.disableAddDate||this.addRangeLabel.removeClassName("cfgLabelAddDateDisabled")},createExistingDate:function(){var e=this;e.count++,this.collection.forEach(function(t,i){e.renderCfgDateView(t)})},render:function(){var e=this;this.createExistingDate(),this.datesParentDiv.tooltipInfos=new o({shortHelp:this.dateToolTip}),this.addRangeLabel=UWA.createElement("div",{class:"cfgLabelAddDate",html:r.Filter_Date_AddDateRange}),this.isToDisableAddDate(),this.addRangeLabel.inject(this.cfgDateDiv),!0===this.options.isReadOnly&&this.addRangeLabel.hide(),this.addRangeLabel.addEventListener("mouseover",function(){e.disableAddDate?this.style.cursor="":this.style.cursor="pointer"}),this.addRangeLabel.addEventListener("click",function(){if(!e.disableAddDate){e.count++;var t="",i="",o="";e.collection.length>0&&("range"==e.collection.last().get("type")&&""!=e.collection.last().get("toDateMilliSec")?(o=t=e.collection.last().get("toDateMilliSec"),t+=864e5,i=l.convertMillisectoDate(t)):"single"==e.collection.last().get("type")&&(o=e.collection.last().get("fromDateMilliSec")));var n=new s({id:e.count,type:e.collection.last().get("type"),fromDate:i,fromDateMilliSec:t,fromDateMinValue:o,toDate:r.CfgDateInf,toDateMilliSec:"",toDateMinValue:t,isThisOnlyModelInCollection:!1});e.collection.add(n),e.renderCfgDateView(n),e.isToDisableAddDate()}}),null==this.options.displayCompactMode||!1===this.options.displayCompactMode?this.addRangeLabel.setAttributeNode(document.createAttribute("touch-mode")):this.addRangeLabel.removeAttribute("touch-mode")},show:function(){this.cfgDateDiv.show()},hide:function(){this.cfgDateDiv.hide()},renderCfgDateView:function(e){var t=this,i=new n({model:e,id:this.count,displayCompactMode:this.options.displayCompactMode,isReadOnly:this.options.isReadOnly}),o=i.render();return i.adjustResponsiveViewDate(this.cfgDateDiv.getDimensions().width),o.inject(this.datesParentDiv),this.viewCollection.push(i),!0===this.options.isReadOnly&&(this.dateToolTip=this.dateToolTip.concat(i.dateViewToolTip)),i.listenTo(i,"onChangeDate",function(e){t.isToDisableAddDate();var i=t.collection.indexOf(this.model);-1!=i&&i!=t.collection.length-1&&("single"==this.model.get("type")?t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i).get("fromDateMilliSec")):t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i).get("toDateMilliSec")))}),i.listenTo(i,"onDeleteDate",function(e){var i=t.collection.indexOf(this.model);-1!=i&&i!=t.collection.length-1&&(0==i?t.collection.at(i+1).set("fromDateMinValue",""):"single"==t.collection.at(i-1).get("type")?t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i-1).get("fromDateMilliSec")):t.collection.at(i+1).set("fromDateMinValue",t.collection.at(i-1).get("toDateMilliSec"))),this.model.destroy()}),i},validateCollection:function(){for(var e=0;e<this.collection.length;e++){var t=this.collection.at(e);if("single"!=t.get("type")&&("range"==t.get("type")&&"-INF"==t.get("fromDate")&&"INF"==t.get("toDate")))return!1}return!0},getXML:function(){var e="",t="",i="";return this.validateCollection()?(this.collection.forEach(function(o,n){if(!o.isEmpty()){if("single"==o.get("type")){var s=l.convertMillisectoDateOnly(o.get("fromDateMilliSec"));e+=a.buildSingleDateValue(s)}else{var r="";if(""==o.get("fromDateMilliSec")||"-INF"==o.get("fromDate"))r="-INF";else{s=l.convertMillisectoDateOnly(o.get("fromDateMilliSec"));r=a.buildFromDate(s)}var d="";if(""==o.get("toDateMilliSec")||"INF"==o.get("toDate"))d="INF";else{s=l.convertMillisectoDateOnly(o.get("toDateMilliSec"));d=a.buildToDate(s)}i="-INF"==r?d:"INF"==d?r:r+d,e+=a.buildInterval(i)}t=a.buildDate(e)}}),t):null},getJSON:function(){if(!this.validateCollection())return null;var e={DateRanges:[]};this.collection.forEach(function(t,i){if(t.isEmpty())return null;var o={};"single"==t.get("type")?(o.Start=t.get("fromDate"),o.millisecStart=t.get("fromDateMilliSec"),o.End=t.get("fromDate"),o.millisecEnd=t.get("fromDateMilliSec")):(""==t.get("fromDateMilliSec")?(o.Start="-INF",o.millisecStart=""):(o.Start=t.get("fromDate"),o.millisecStart=t.get("fromDateMilliSec")),""==t.get("toDateMilliSec")?(o.End="INF",o.millisecEnd=""):(o.End=t.get("toDate"),o.millisecEnd=t.get("toDateMilliSec"))),e.DateRanges.push(o)});var t=JSON.stringify(e.DateRanges);return"[]"==t||"{}"==t?null:e}})}),define("DS/CfgEvolutionUX/CfgEvolutionCriteriaView",["DS/UIKIT/Spinner","UWA/Drivers/Alone","DS/CfgBaseUX/scripts/CfgUtility","DS/Core/Core","UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/Handlebars/Handlebars4","text!DS/CfgEvolutionUX/CfgEvolutionCriteriasDialogTemplate.html","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgDatePicker","DS/CfgEvolutionUX/CfgWUXDatePicker","DS/CfgEvolutionUX/CfgUnit","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgXMLServices","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h,g,f){"use strict";var v=l.compile(r);return n.extend({name:"evolution-criteria-dialog-view",tagName:"div",init:function(e){this._parent(e),e},setup:function(e){},render:function(){var t=this;m.renderTo=t.options.parentElement,this.container.setHTML(v(this.options));"EditEvolution"==t.options.mode&&f.Header_EditEvolution;var o=null,n=null,s=!0,l=!1,r=!1,c=!1;0!=Object.keys(t.options.expression).length&&(t.options.expression.modelId,o=t.options.expression.psJson,n=t.options.expression.mpJson,s=t.options.expression.productstatecheckbox,l=t.options.expression.unitcheckbox,r=t.options.expression.datestatecheckbox,c=t.options.expression.manufacturingplanstatecheckbox,t.options.expression.milestoneJson,t.options.expression.milestoneXml,t.options.expression.milestoneCheckbox);var h=t.options.criteriasAvailable,g={};g.parentElement=this.container.getElement(".evolution-dialog-productstates"),g.psJson=o,g.expression=t.options.expression,g.notExpression=t.options.expression.notPSDesc,g.mode="PRODUCTS",g.use="",g.propagateSessionEffectivity=t.options.propagateSessionEffectivity,this.productstateCheckbox=new a({type:"checkbox",value:"PSComponent",className:"primary",label:f.Product_State,events:{onChange:function(){!0===this.isChecked()?t.ProductStateComponent.show():t.ProductStateComponent.hide()}}}).inject(this.container.getElement(".evolution-dialog-productstates-checkbox")),this.ProductStateComponent=new d(g),this.ProductStateComponent.render(),1==s?(this.productstateCheckbox.check(),this.ProductStateComponent.show()):this.ProductStateComponent.hide(),this.ProductStateComponent.initialiseComponent(),("False"==h.products||null!=t.options.enabledCritData&&"undefined"!=t.options.enabledCritData&&"false"==t.options.enabledCritData.productState)&&(this.productstateCheckbox.uncheck(),this.productstateCheckbox.hide(),this.ProductStateComponent.hide());var C={};C.parentElement=this.container.getElement(".evolution-dialog-manufacturingplans"),C.psJson=n,C.expression=t.options.expression,C.notExpression=t.options.expression.notMPDesc,C.mode="MANUFACTURINGPLAN",C.use="",this.manufacturingplanCheckbox=new a({type:"checkbox",value:"PSComponent",className:"primary",label:f.Manufacturing_Plan,events:{onChange:function(){!0===this.isChecked()?t.manufacturingplanComponent.show():t.manufacturingplanComponent.hide()}}}).inject(this.container.getElement(".evolution-dialog-manufacturingplans-checkbox")),this.manufacturingplanComponent=new d(C),this.manufacturingplanComponent.render(),1==c?(this.manufacturingplanCheckbox.check(),this.manufacturingplanComponent.show()):this.manufacturingplanComponent.hide(),this.manufacturingplanComponent.initialiseComponent(),("False"==h.manufacturingPlans||null!=t.options.enabledCritData&&"undefined"!=t.options.enabledCritData&&"false"==t.options.enabledCritData.manufacturingPlan)&&(this.manufacturingplanCheckbox.uncheck(),this.manufacturingplanCheckbox.hide(),this.manufacturingplanComponent.hide()),this.UnitCheckbox=new a({type:"checkbox",value:"UnitComponent",className:"primary",label:f.Unit,events:{onChange:function(){!0===this.isChecked()?t.UnitComponent.show():t.UnitComponent.hide()}}}).inject(this.container.getElement(".evolution-dialog-unit-checkbox")),this.UnitCheckbox.elements.container.getElement(".control-label").addClassName("unitlabel");var D=null;0!=Object.keys(t.options.expression).length&&(D=t.options.expression.iUnitJson).length>0&&JSON.parse(t.options.expression.iUnitJson).builds.length;var b=this.container.getElement(".evolution-dialog-unit");(this.UnitComponent=new p({parentElement:b,mode:"UNIT",expression:t.options.expression,invokeFrom:t.options.mode}),this.UnitComponent.render(),this.UnitComponent.SetJson(D),1==l?(this.UnitComponent.show(),this.UnitCheckbox.check()):this.UnitComponent.hide(),null!=m.configurationCriteria&&0==m.configurationCriteria.unit||"FALSE"==h.builds||null!=t.options.enabledCritData&&"undefined"!=t.options.enabledCritData&&"false"==t.options.enabledCritData.unit?(this.UnitCheckbox.uncheck(),this.UnitCheckbox.hide(),this.UnitComponent.hide()):this.UnitComponent.initialiseComponent(),null==t.options.enabledCritData&&(t.options.enabledCritData={milestone:"true"}),"False"!=h.milestones)&&i.checkMilestoneActivation().then(function(o){(t.milestoneActivationStatus=o,"Enabled"==o&&null!=t.options.enabledCritData&&null!=t.options.enabledCritData&&"true"==t.options.enabledCritData.milestone)&&(t.milestoneCheckbox=new a({type:"checkbox",value:"MSComponent",className:"primary",label:f.Milestone,events:{onChange:function(){!0===this.isChecked()?t.milestoneComponent.show():t.milestoneComponent.hide()}}}).inject(t.container.getElement(".evolution-dialog-milestones-checkbox")),t.milestoneCheckbox.check(),t.DateCheckbox.hide(),t.DatePicker.hide(),t.evolutionSpinner=new e({className:"evolutionSpinner"}).inject(t.container.getElement(".evolution-dialog-milestones")),t.evolutionSpinner.spin(),t.evolutionSpinner.show(),null==m.getDictionaryByCriteria(t.options.expression.modelId,"milestones").milestones?i.getDictionaryFromServer(t.options.expression.modelId,"milestones=1&attributes").then(function(e){m.addDictionaryByCriteria(t.options.expression.modelId,e,"milestones"),t.processmilestones()}):t.processmilestones())},function(e){});this.DateCheckbox=new a({type:"checkbox",value:"DateComponent",className:"primary",label:f.Date,checked:!1,events:{onChange:function(){!0===this.isChecked()?t.DatePicker.show():t.DatePicker.hide()}}}).inject(this.container.getElement(".evolution-dialog-date-checkbox"));var x=null;0!=Object.keys(t.options.expression).length&&(x=t.options.expression.iDateJson);var E=this.container.getElement(".evolution-dialog-date");this.DatePicker=new u(E,x,{view:"show",defaultDateBehavior:"DateRange"}),this.DatePicker.render(),1==r?(t.DatePicker.show(),this.DateCheckbox.check()):this.DatePicker.hide(),(null!=m.configurationCriteria&&0==m.configurationCriteria.contextualDate||null!=t.options.enabledCritData&&null!=t.options.enabledCritData&&"false"==t.options.enabledCritData.contextualDate||"Enabled"==t.milestoneActivationStatus)&&(this.DatePicker.hide(),this.DateCheckbox.hide()),this.toggles=this.container.getElements(".toggle-primary"),this.inject(this.options.parent),this.options.evolutionSpinner&&this.options.evolutionSpinner.hide()},processmilestones:function(){var e=m.getDictionaryByCriteria(this.options.expression.modelId,"milestones"),t={};if(t.parentElement=this.container.getElement(".evolution-dialog-milestones"),0!=Object.keys(e.milestones).length&&Object.keys(this.options.expression.milestoneJson).length)for(var i=this.options.expression.milestoneJson,o=i.length,n=0;n<o;n++){for(var s=e.milestones[0].sequence,a=0;a<s.length;a++)s[a].name==i[n].start.name&&(i[n].start.revision=s[a].date);for(var l=i[n],r=0;r<=l.length;r++)for(a=0;a<s.length;a++)s[a].name==l[r].name&&(l[r].revision=s[a].date)}t.milestoneJson=this.options.expression.milestoneJson,t.milestoneXml=this.options.expression.xmlExpression,t.modelId=this.options.expression.modelId,t.mode="MILESTONES",t.expression=this.options.expression,t.use="",this.milestoneComponent=new d(t),this.milestoneComponent.render(),1==this.options.expression.milestoneCheckbox?(this.milestoneCheckbox.check(),this.milestoneComponent.show()):this.milestoneComponent.hide(),this.milestoneComponent.initialiseComponent(),this.evolutionSpinner.hide()},buildData:function(){var e=this.ProductStateComponent.buildFilterXML(),t=this.ProductStateComponent.buildDescription();0==this.productstateCheckbox.isChecked()&&(e="",t=[]),""==this.ProductStateComponent.displayExpression&&(this.options.expression.notPSDesc="");var i=this.UnitComponent.buildUnitXML(this.options.expression.name,this.UnitCheckbox.isChecked());if(null==i)return null;var o=this.DatePicker.getXML();if(0==this.DateCheckbox.isChecked()&&(o=""),null==o)return null;var n=this.manufacturingplanComponent.buildFilterXML(),s=this.manufacturingplanComponent.buildDescription();0==this.manufacturingplanCheckbox.isChecked()&&(n="",s=[]),""==this.manufacturingplanComponent.displayExpression&&(this.options.expression.notMPDesc="");var a="";null!=this.milestoneComponent&&(a=this.milestoneComponent.buildFilterXML(),0==this.milestoneCheckbox.isChecked()&&(a=""));var l=this.ProductStateComponent.buildFilterJson();0==this.productstateCheckbox.isChecked()&&(l=[]);var r=this.DatePicker.getJSON();null!=o&&0!=this.DateCheckbox.isChecked()||(r={DateRanges:[]});var d=this.UnitComponent.getJson();0==this.UnitCheckbox.isChecked()&&(d=JSON.stringify({builds:[]}));var c=this.manufacturingplanComponent.buildFilterJson();0==this.manufacturingplanCheckbox.isChecked()&&(c=[]);var u=u=[];return null!=this.milestoneComponent&&(this.milestoneComponent.buildFilterJson(),0==this.milestoneCheckbox.isChecked()&&(u=[])),this.options.expression.psJson=l,this.options.expression.viewJson=null,this.options.expression.iDateJson=r,this.options.expression.mpJson=c,this.options.expression.iUnitJson=d,this.options.expression.milestoneJson=u,this.options.expression.xmlExpression=e,this.options.expression.psXmlDesc=t,this.options.expression.iDateXml=o,this.options.expression.iUnitXml=i,this.options.expression.impXml=n,this.options.expression.mpXmlDesc=s,this.options.expression.milestoneXml=a,this.options.expression.productstatecheckbox=this.productstateCheckbox.isChecked(),this.options.expression.unitcheckbox=this.UnitCheckbox.isChecked(),this.options.expression.datestatecheckbox=this.DateCheckbox.isChecked(),this.options.expression.manufacturingplanstatecheckbox=this.manufacturingplanCheckbox.isChecked(),this.options.expression}})}),define("DS/CfgEvolutionUX/CfgEvolutionCriteriaBaseView",["UWA/Class/View","DS/Handlebars/Handlebars4","DS/Controls/Toggle","DS/CfgEvolutionUX/CfgProductState","DS/CfgEvolutionUX/CfgUnit","DS/CfgEvolutionUX/CfgWUXDatePicker","text!DS/CfgEvolutionUX/CfgEvolutionCriteriaTemplate.html","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l){"use strict";return e.extend({tagName:"div",className:"evolution-criteria-base-view",init:function(e){this._parent(e),this.panelTemplate=t.compile(a)},setup:function(){this.criteriaViewMode=this.options.mode,this.modelLabel=this.options.modelLabel,this.modelName=this.options.modelName,this.modelID=this.options.modelID,this.displayCompactMode=null==this.options.displayCompactMode||null==this.options.displayCompactMode||0!=this.options.displayCompactMode,"Official"==this.options.evolutionView&&this.options.criteria?this.configureCriteria(this.options.criteria):"Projected"==this.options.evolutionView&&this.options.projectedCriteria&&this.configureCriteria(this.options.projectedCriteria)},configureCriteria:function(e){var t=this;e.forEach(function(e){"MV"==e.name.toUpperCase()?t.mv_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,displayExpression:e.displayExpression?e.displayExpression:"",xmlDesc:e.xmlDesc?e.xmlDesc:"",cb:null,component:null}:"MP"==e.name.toUpperCase()?t.mp_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,xmlDesc:e.xmlDesc?e.xmlDesc:"",cb:null,component:null}:"UNIT"==e.name.toUpperCase()?t.unit_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,cb:null,component:null}:"DATE"==e.name.toUpperCase()&&(t.date_criteria={isCheckboxRequired:!(!e.isCheckboxRequired||1!=e.isCheckboxRequired),isReadOnly:!(!e.isReadOnly||1!=e.isReadOnly),expression:e.value?e.value:"",expressionJson:e.valueJson&&0!==Object.keys(e.valueJson).length?e.valueJson:null,cb:null,component:null})})},clickCriteriaComponent:function(e){"MV"==e?this.mv_criteria.component.onCriteriaClickHandler():"MP"==e&&this.mp_criteria.component.onCriteriaClickHandler()},render:function(){var e=this;if(this.container.setHTML(this.panelTemplate({mv_criteria:e.mv_criteria,mp_criteria:e.mp_criteria,unit_criteria:e.unit_criteria,date_criteria:e.date_criteria})),this.mv_criteria){var t={};t.parentElement=this.container.getElement(".mv-component"),t.parentGraphElement=this.container.getElement(".mv-graph-component"),t.psJson=this.mv_criteria.expressionJson,t.expression={name:e.modelName,modelId:e.modelID,xmlExpression:e.mv_criteria.expression,displayexpression:e.mv_criteria.displayExpression,psXmlDesc:e.mv_criteria.xmlDesc,psJson:e.mv_criteria.expressionJson},t.mode="PRODUCTS",t.displayCompactMode=e.displayCompactMode,t.use=e.criteriaViewMode,t.propagateSessionEffectivity=this.options.propagateSessionEffectivity,!0===this.mv_criteria.isCheckboxRequired?(this.mv_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"mv_cb",label:l.Product_State,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".mv-checkbox-label")),this.mv_criteria.cb.addEventListener("change",function(i){!0===e.mv_criteria.cb.checkFlag?(e.mv_criteria.component.show(),t.parentElement.setStyles({border:"1px solid lightgray"})):(e.mv_criteria.component.hide(),t.parentElement.setStyles({border:"none"}))})):(this.container.getElement(".mv-checkbox-label").setHTML(l.Product_State),this.container.getElement(".mv-checkbox-label").addClassName("evo-crit-label")),this.mv_criteria.component=new o(t),this.mv_criteria.component.render(),this.mv_criteria.component.initialiseComponent()}if(this.mp_criteria){var a={};a.parentElement=this.container.getElement(".mp-component"),a.parentGraphElement=this.container.getElement(".mp-graph-component"),a.psJson=this.mp_criteria.expressionJson,a.expression={name:e.modelName,modelId:e.modelID,impXml:e.mp_criteria.expression,displayexpression:e.mp_criteria.displayExpression,mpXmlDesc:e.mp_criteria.xmlDesc,mpJson:e.mp_criteria.expressionJson},a.mode="MANUFACTURINGPLAN",a.displayCompactMode=e.displayCompactMode,a.use=e.criteriaViewMode,!0===this.mp_criteria.isCheckboxRequired?(this.mp_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"mp_cb",label:l.Manufacturing_Plan,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".mp-checkbox-label")),this.mp_criteria.cb.addEventListener("change",function(t){!0===e.mp_criteria.cb.checkFlag?(e.mp_criteria.component.show(),a.parentElement.setStyles({border:"1px solid lightgray"})):(e.mp_criteria.component.hide(),a.parentElement.setStyles({border:"none"}))})):(this.container.getElement(".mp-checkbox-label").setHTML(l.Manufacturing_Plan),this.container.getElement(".mp-checkbox-label").addClassName("evo-crit-label")),this.mp_criteria.component=new o(a),this.mp_criteria.component.render(),this.mp_criteria.component.initialiseComponent()}if(this.unit_criteria){var r={};r.parentElement=this.container.getElement(".unit-component"),r.iUnitJson=this.unit_criteria.expressionJson,r.expression={name:e.modelName,modelId:e.modelID,impXml:e.unit_criteria.expression,displayexpression:e.unit_criteria.displayExpression,mpXmlDesc:e.unit_criteria.xmlDesc,iUnitJson:e.unit_criteria.expressionJson},r.mode="UNIT",r.displayCompactMode=e.displayCompactMode,r.use=e.criteriaViewMode,r.invokeFrom="",!0===this.unit_criteria.isCheckboxRequired?(this.unit_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"unit_cb",label:l.Unit,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".unit-checkbox-label")),this.unit_criteria.cb.addEventListener("change",function(t){!0===e.unit_criteria.cb.checkFlag?(e.unit_criteria.component.show(),r.parentElement.getElement("#textDiv").setStyles({border:"1px solid lightgray"})):(e.unit_criteria.component.hide(),r.parentElement.getElement("#textDiv").setStyles({border:"none"}))})):(this.container.getElement(".unit-checkbox-label").setHTML(l.Unit),this.container.getElement(".unit-checkbox-label").addClassName("evo-crit-label")),this.unit_criteria.component=new n(r),this.unit_criteria.component.render(),this.unit_criteria.component.SetJson(r.iUnitJson),this.unit_criteria.component.initialiseComponent()}if(this.date_criteria){var d={};d.parentElement=this.container.getElement(".date-component"),d.dateJson=this.date_criteria.expressionJson,!0===this.date_criteria.isCheckboxRequired?(this.date_criteria.cb=new i({type:"checkbox",checkFlag:!0,value:"date_cb",label:l.Date,touchMode:!e.displayCompactMode}).inject(this.container.getElement(".date-checkbox-label")),this.date_criteria.cb.addEventListener("change",function(t){!0===e.date_criteria.cb.checkFlag?e.date_criteria.component.show():e.date_criteria.component.hide()})):(this.container.getElement(".date-checkbox-label").setHTML(l.Date),this.container.getElement(".date-checkbox-label").addClassName("evo-crit-label")),this.date_criteria.component=new s(d.parentElement,d.dateJson,{displayCompactMode:e.displayCompactMode,isReadOnly:e.date_criteria.isReadOnly,view:"show",defaultDateBehavior:"DateRange"}),this.date_criteria.component.render()}this.applyCompactComfortableMode(),this.container.inject(this.options.parentElement)},applyCompactComfortableMode:function(){0==this.displayCompactMode?(this.container.getElements(".evo-crit-in-filler").forEach(function(e){e.setAttributeNode(document.createAttribute("touch-mode"))}),this.container.getElements(".evo-crit-out-filler").forEach(function(e){e.setAttributeNode(document.createAttribute("touch-mode"))}),this.container.getElements(".evo-crit-label").forEach(function(e){e.setAttributeNode(document.createAttribute("touch-mode"))})):(this.container.getElements(".evo-crit-in-filler").forEach(function(e){e.removeAttribute("touch-mode")}),this.container.getElements(".evo-crit-out-filler").forEach(function(e){e.removeAttribute("touch-mode")}),this.container.getElements(".evo-crit-label").forEach(function(e){e.removeAttribute("touch-mode")}))},get:function(){}})}),define("DS/CfgEvolutionUX/CfgEvolutionController",["DS/CfgBaseUX/scripts/CfgModelView","DS/CfgBaseUX/scripts/CfgContainerView","DS/CfgBaseUX/scripts/CfgData","DS/CoreEvents/ModelEvents","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgEvolutionUX/CfgVersionGraphLayout","DS/CfgFilterUX/CfgFilterSlideInComponent","text!DS/CfgFilterUX/CfgFilterslideInDialogTemplate.html","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgEvolutionUX/CfgEvolutionLayoutFactory","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUX","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","css!DS/CfgBaseUX/styles/CfgDialog.css"],function(e,t,i,o,n,s,a,l,r,d,c,u,p,m,h,g,f){"use strict";var v={render:function(e){if(this.options=e,this.parent=this.options.parent,this.propagateSessionEffectivity=!0,this.criteriaViewValidate=!0,this.notExpressionValidate=!0,i.clear(),i.ModelEvents=new o,this.CfgVersionGraphLayoutInstance=new s,1==this.options.collection.length){var t=this.options.collection.at(0);v.options.expression=t.get("expression");var a=this;new Promise(function(e,t){var i={version:"1.0.0",modelIds:[{id:"pid:"+a.options.expression.modelId}]};i=JSON.stringify(i);n.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",i,function(t){e(t)},function(e){console.log("fail to get criterias")},!0)}).then(function(e){if(null!=e.criteria[0].products&&"FALSE"==e.criteria[0].products.toUpperCase()&&null!=e.criteria[0].manufacturingPlans&&"FALSE"==e.criteria[0].manufacturingPlans.toUpperCase()&&null!=e.criteria[0].builds&&"FALSE"==e.criteria[0].builds.toUpperCase())return a.options.evolutionSpinner&&a.options.evolutionSpinner.hide(),void n.showwarning(f.Not_Accessible_Eff_Error,"error");v.options.criteriasAvailable=e.criteria[0],v.options.selectedmodel=t,v.options.selectedcollection=v.options.collection;var i=a.isOneModelOneCriteriaCondition(v.options.criteriasAvailable,v.options.enabledCritData);""!=i?a.manageTransitionForSingleModelSingleCriteria(i,a.options.expression):(v.createCriteriasView(v.options.collection.at(0)),v.subscribeModelEvents())})}else{if(null!=this.options.expressionJson)for(var l=0;l<this.options.expressionJson.length;l++){let e=this.options.expressionJson[l].expression;(n.isDefined(e.notPSDesc)&&e.notPSDesc.length>0||n.isDefined(e.notMPDesc)&&e.notMPDesc.length>0||n.isDefined(e.notUnitDesc)&&e.notUnitDesc.length>0)&&(this.notExpressionValidate=!1)}this.createModelListView(),this.subscribeModelEvents()}v.globalexpression=this.options.dialogue.effExpressionXml,null==v.globalexpression&&(v.globalexpression="")},isOneModelOneCriteriaCondition:function(e,t){var i=e.products,o=e.manufacturingPlans,n=e.builds,s=e.contextualDate,a=t.productState,l=t.manufacturingPlan,r=t.unit,d=t.contextualDate;return"TRUE"==i&&"true"==a&&"false"==l&&"false"==r&&"false"==d?"products":"TRUE"==o&&"false"==a&&"true"==l&&"false"==r&&"false"==d?"manufacturingPlans":"TRUE"==i&&"False"==o&&"False"==n&&"False"==s&&"true"==a?"products":"False"==i&&"TRUE"==o&&"False"==n&&"False"==s&&"true"==l?"manufacturingPlans":""},manageTransitionForSingleModelSingleCriteria:function(e,t){this.createDictionarySelectionView(e,t,"singlePageTransition"),i.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(i){var o={buttonId:"firstButton",propagateSessionEffectivity:i.event.propagateSessionEffectivity};null==i.xml?o.buttonId="secondButton":(v.notExpressionValidate=!0,"products"==e?(t.xmlExpression=i.xml,t.psXmlDesc=i.xmlDesc,t.psJson=i.json,0==t.psJson.length&&null!=t.notPSDesc&&t.notPSDesc.length>0&&(v.notExpressionValidate=!1,v.CfgVersionGraphLayoutInstance&&v.CfgVersionGraphLayoutInstance.versionGraph&&1==v.CfgVersionGraphLayoutInstance.versionGraph.IsExpressionModified&&(v.notExpressionValidate=!0))):"manufacturingPlans"==e&&(t.impXml=i.xml,t.mpXmlDesc=i.xmlDesc,t.mpJson=i.json,0==t.mpJson.length&&null!=t.notMPDesc&&t.notMPDesc.length>0&&(v.notExpressionValidate=!1,v.CfgVersionGraphLayoutInstance&&v.CfgVersionGraphLayoutInstance.versionGraph&&1==v.CfgVersionGraphLayoutInstance.versionGraph.IsExpressionModified&&(v.notExpressionValidate=!0))),1==v.notExpressionValidate&&v.updateCollection(t)),v.onSaveEffectivity(o)})},createDictionarySelectionView:function(e,t,o){var s=this;i.ModelEvents.publish({event:"LaunchingDictionarySelection",data:{}});var a={};if("products"==e?(a.mode="PRODUCTS",a.psJson=t.psJson):"manufacturingPlans"==e&&(a.mode="MANUFACTURINGPLAN",a.psJson=t.mpJson),a.use="",a.transition=UWA.is(o)?o:"","intermidiateTransition"==o?(a.firstButtonText=g.CFG_Apply,a.secondButtonText=g.CFG_Back):(a.firstButtonText=g.CFG_Ok,a.secondButtonText=g.CFG_Cancel,a.propagateSessionEffectivity=s.propagateSessionEffectivity),i.renderTo=a.parentElement=v.options.parentElement,a.ModelLabel=v.options.selectedmodel.get("marketingName")?v.options.selectedmodel.get("marketingName"):v.options.selectedmodel.get("name"),a.displayexpression=t.displayexpression?t.displayexpression:"",a.displayexpression=a.displayexpression.substring(a.displayexpression.indexOf(":")+1),a.displayexpression.trim(),s.options.evolutionSpinner&&s.options.evolutionSpinner.hide(),"PRODUCTS"!=a.mode&&"MANUFACTURINGPLAN"!=a.mode||s.CfgVersionGraphLayoutInstance.create(a),null==i.getDictionaryByCriteria(t.modelId,e)[e]){var l="",r="",d='<?xml version="1.0" encoding="UTF-8"?><CfgFilterExpression xmlns="urn:com:dassault_systemes:config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="urn:com:dassault_systemes:config CfgFilterExpression.xsd"><FilterSelection SelectionMode="Strict">',u="</FilterSelection></CfgFilterExpression>";"products"==e?r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.name+'" >'+t.xmlExpression+"</Context>"+u:"manufacturingPlans"==e&&(r=d+'<Context xmlns="urn:com:dassault_systemes:config" HolderType="Model" HolderName="'+t.name+'" >'+t.impXml+"</Context>"+u),""!==r&&(l={evolutionExpression:JSON.stringify({filterExpression:c.getValidXmlWithoutDescId(r)})},console.log("CfgEvolutionController evoExpression = "+r+" wParam after descId removed = "+l.evolutionExpression)),("products"==e||"manufacturingPlans"==e?n.getDictionaryFromServer(t.modelId,"onlyUnfrozenNodes=1&"+e,null,l):n.getDictionaryFromServer(t.modelId,e)).then(function(o){i.addDictionaryByCriteria(t.modelId,o,e),a.data=i.getDictionaryByCriteria(t.modelId,e),"PRODUCTS"==a.mode?s.CfgVersionGraphLayoutInstance.render(a.data.products):"MANUFACTURINGPLAN"==a.mode&&s.CfgVersionGraphLayoutInstance.render(a.data.manufacturingPlans)})}else a.data=i.getDictionaryByCriteria(t.modelId,e),setTimeout(function(){"PRODUCTS"==a.mode?s.CfgVersionGraphLayoutInstance.render(a.data.products):"MANUFACTURINGPLAN"==a.mode&&s.CfgVersionGraphLayoutInstance.render(a.data.manufacturingPlans)},100)},manageTransitionForSingleModelMultipleCriteria:function(){this.createCriteriasView(this.options.collection.at(0)),this.subscribeModelEvents()},createModelListView:function(){this.options.editActionCallback=this.onEditActionCallback,this.createModelViewContainer(),this.modelListView=new e(this.options),this.modelListView.render(this.options.collection)},createCriteriasView:function(e){v.options.expression=e.get("expression");var o=this;new Promise(function(e,t){var i={version:"1.0.0",modelIds:[{id:"pid:"+o.options.expression.modelId}]};i=JSON.stringify(i);n.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",i,function(t){e(t)},function(e){console.log("fail to get criterias")},!0)}).then(function(n){v.options.criteriasAvailable=n.criteria[0],v.options.selectedmodel=e,v.options.selectedcollection=v.options.collection,o.options.parentElement=v.options.parent,o.options.parentElement.innerHTML="";var s=o.isOneModelOneCriteriaCondition(v.options.criteriasAvailable,v.options.enabledCritData);if(""!=s){o.createDictionarySelectionView(s,v.options.expression,"intermidiateTransition");var a=i.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(e){null!=e.xml&&(v.notExpressionValidate=!0,"products"==s?(v.options.expression.xmlExpression=e.xml,v.options.expression.psXmlDesc=e.xmlDesc,v.options.expression.psJson=e.json,0==v.options.expression.psJson.length&&null!=v.options.expression.notPSDesc&&v.options.expression.notPSDesc.length>0&&(v.notExpressionValidate=!1)):"manufacturingPlans"==s&&(v.options.expression.impXml=e.xml,v.options.expression.mpXmlDesc=e.xmlDesc,v.options.expression.mpJson=e.json,0==v.options.expression.mpJson.length&&null!=v.options.expression.notMPDesc&&v.options.expression.notMPDesc.length>0&&(v.notExpressionValidate=!1))),null!=e.xml&&1==v.notExpressionValidate&&v.updateCollection(v.options.expression),v.onUpdateEffectivity(),i.ModelEvents.unsubscribe(a)})}else require(["DS/CfgEvolutionUX/CfgEvolutionCriteriaView"],function(i){o.options.parentElement=v.options.parent,o.options.parentElement.innerHTML="";var n="",s=g.CFG_Apply,a=g.CFG_Back,l=!1;1==o.options.collection.length?(n=o.onUpdateAndSaveEffectivity,s=g.CFG_Ok,a=g.CFG_Cancel,l=o.propagateSessionEffectivity):n=o.onUpdateEffectivity;var r={isHeader:!0,isFooter:!0,firstButtonText:s,secondButtonText:a,headerText:e.get("marketingName")?e.get("marketingName"):e.get("name"),toggleSessionEffectivity:l,onButtonClickCB:n};v.criteriaViewContainer=new t(r).render(),v.criteriaViewContainer.getContent().addClassName("CfgContainerView-EditEvolution"),v.options.parent=v.criteriaViewContainer._body,v.options.propagateSessionEffectivity=!1,v.CfgEvolutionCriteriaView=new i(v.options),v.CfgEvolutionCriteriaView.render(),v.criteriaViewContainer.inject(o.options.parentElement)})})},onUpdateAndSaveEffectivity:function(e){if(e&&"firstButton"==e.buttonId){v.notExpressionValidate=!0;var t=null;null!=v.CfgEvolutionCriteriaView&&(t=v.CfgEvolutionCriteriaView.buildData(),v.criteriaViewValidate=null!=t,(t.productstatecheckbox&&0==t.psJson.length&&null!=t.notPSDesc&&t.notPSDesc.length>0||t.manufacturingplanstatecheckbox&&0==t.mpJson.length&&null!=t.notMPDesc&&t.notMPDesc.length>0||t.unitcheckbox&&t.iUnitJson.indexOf("NOT")>=0&&null!=t.notUnitDesc&&t.notUnitDesc.length>0)&&(v.notExpressionValidate=!1)),null!=v.CfgEvolutionCriteriaView&&null!=t&&0!=v.criteriaViewValidate&&0!=v.notExpressionValidate&&v.updateCollection(t)}v.onSaveEffectivity(e)},onEditActionCallback:function(e){v.createCriteriasView(e)},checkBoxClicked:function(e){v.propagateSessionEffectivity=e.propagateSessionEffectivity?"checked":"unchecked"},sendEditEvolutionTrackerEvent:function(e){let t="",i="",o=e.noOfContext,n=e.totalProductRangeLength,s=e.totalProductSingleLength,a=e.totalManuPlanRangeLength,l=e.totalManuPlanSingleLength,r=e.totalUnitRangeLength,d=e.totalUnitSingleLength,c=e.totalDateRangeLength,h=e.totalDateSingleLength;"Native"==e.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,i=null!=widget.options?widget.options.title:"ODT Environment");let g=u.getDeviceUsedForOperation(),f=u.ConfigOperationMode.CREATE;"Edit"==e.evolutionMode&&(f=u.ConfigOperationMode.EDIT);let v=u.ConfigCriteriaSelected.NONE;"NONE"!=e.modelVersionCriteria&&(v=u.ConfigCriteriaSelected[e.modelVersionCriteria]);let C=u.ConfigCriteriaSelected.NONE;"NONE"!=e.manufacturingPlanCriteria&&(C=u.ConfigCriteriaSelected[e.manufacturingPlanCriteria]);let D=u.ConfigCriteriaSelected.NONE;"NONE"!=e.unitCriteria&&(D=u.ConfigCriteriaSelected[e.unitCriteria]);let b=u.ConfigCriteriaSelected.NONE;"NONE"!=e.dateCriteria&&(b=u.ConfigCriteriaSelected[e.dateCriteria]);var x=u.KeepSessionEffectivity.FALSE;"checked"==e.keepSessionEffectivity&&(x=u.KeepSessionEffectivity.TRUE),u.createEventBuilder({category:u.Category.USAGE,action:u.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(u.Labels.EDIT_EVOLUTION_EFFECTIVITY).setAppId(t).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_EFFECTIVITY_WIDGET,i).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_EFFECTIVITY_MEDIA,g).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_EFFECTIVITY_MODE,f).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_MODEL_VERSION,v).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_MANUFACTURING_PLAN,C).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_UNIT,D).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_CRITERIA_DATE,b).addDimension(p.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_KEEP_SESSION_EFFECTIVITY,x).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_NO_OF_MODEL,o).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_PRODUCT_RANGE,n).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_PRODUCT_SINGLE,s).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_MANUFACTURING_PLAN_RANGE,a).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_MANUFACTURING_PLAN_SINGLE,l).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_UNIT_RANGE,r).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_UNIT_SINGLE,d).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_DATE_RANGE,c).addPersonalValue(m.EDIT_EVOLUTION_EFFECTIVITY.EDIT_EVOLUTION_TOTAL_NO_OF_DATE_SINGLE,h).send()},onSaveEffectivity:function(e){if("firstButton"==e.buttonId){if(v.options.collection.length>0)for(var t=0;t<v.options.collection.length;t++){let e=v.options.collection._models[t]._changed;null!=e&&null!=e.expression&&(null!=e.expression.notPSDesc&&e.expression.notPSDesc.length>0||null!=e.expression.notMPDesc&&e.expression.notMPDesc.length>0||null!=e.expression.notUnitDesc&&e.expression.notUnitDesc.length>0)&&(v.notExpressionValidate=!1)}if(0==v.notExpressionValidate)return void n.showwarning(f.Not_Effectivity_Error,"error")}if(v.propagateSessionEffectivity=e.propagateSessionEffectivity?"checked":"unchecked","Native"==window.enoviaServerFilterWidget.mode){var o={modelIdsWithEffectivity:v.options.collection.getEffectivityModelsIDs(),globalEffectivityExpression:v.options.collection.getGlobalEvolutionExpression(),propagateSessionEffectivity:e.propagateSessionEffectivity,hasFrozenNodeInExpression:i._hasFrozenNodeInExpression},s={eventName:"cfgEditEvolutionEffectivity",operation:"firstButton"==e.buttonId?"OK":"Cancel",operationVersion:"1.0",content:JSON.stringify(o)};if("firstButton"==e.buttonId){if(0==v.criteriaViewValidate)return;n.sendNotificationWebInWin(s)}else n.sendNotificationWebInWin(s)}else{var a=JSON.parse(h);if("firstButton"==e.buttonId){if(0==v.criteriaViewValidate)return;v.saveEffectivity(),1==a.isWUXDialogEnabled?v.options.dialogue.object.closeDialog():v.options.dialogue.object.CfgFloatingPanel.destroy()}else 1==a.isWUXDialogEnabled?v.options.dialogue.object.closeDialog():v.options.dialogue.object.CfgFloatingPanel.destroy()}if("firstButton"==e.buttonId){let e={noOfContext:v.options.collection.length,mode:"Dashboard"};"Native"==window.enoviaServerFilterWidget.mode&&(e.mode="Native"),e.evolutionMode="Create",1==v.options.dialogue.hasEffectivity&&(e.evolutionMode="Edit"),e.keepSessionEffectivity="unchecked","checked"==v.propagateSessionEffectivity&&(e.keepSessionEffectivity="checked");let t=c.getProbesEvolutionCriteria(v.globalexpression);e.totalProductRangeLength=t.totalProductRangeLength,e.totalProductSingleLength=t.totalProductSingleLength,e.totalManuPlanRangeLength=t.totalManuPlanRangeLength,e.totalManuPlanSingleLength=t.totalManuPlanSingleLength,e.totalUnitRangeLength=t.totalUnitRangeLength,e.totalUnitSingleLength=t.totalUnitSingleLength,e.totalDateRangeLength=t.totalDateRangeLength,e.totalDateSingleLength=t.totalDateSingleLength,e.modelVersionCriteria="NONE","NONE"!=t.mvCriteria&&(e.modelVersionCriteria=t.mvCriteria),e.manufacturingPlanCriteria="NONE","NONE"!=t.mpCriteria&&(e.manufacturingPlanCriteria=t.mpCriteria),e.unitCriteria="NONE","NONE"!=t.unitCriteria&&(e.unitCriteria=t.unitCriteria),e.dateCriteria="NONE","NONE"!=t.dateCriteria&&(e.dateCriteria=t.dateCriteria),v.sendEditEvolutionTrackerEvent(e)}},onUpdateEffectivity:function(e){if(v.criteriaViewValidate=!0,e&&"firstButton"==e.buttonId){v.notExpressionValidate=!0;var t=null;if(null!=v.CfgEvolutionCriteriaView&&(t=v.CfgEvolutionCriteriaView.buildData(),v.criteriaViewValidate=null!=t,(t.productstatecheckbox&&0==t.psJson.length&&null!=t.notPSDesc&&t.notPSDesc.length>0||t.manufacturingplanstatecheckbox&&0==t.mpJson.length&&null!=t.notMPDesc&&t.notMPDesc.length>0||t.unitcheckbox&&t.iUnitJson.indexOf("NOT")>=0&&null!=t.notUnitDesc&&t.notUnitDesc.length>0)&&(v.notExpressionValidate=!1,n.showwarning(f.Not_Effectivity_Error,"error"))),null!=v.CfgEvolutionCriteriaView&&null!=t&&0!=v.criteriaViewValidate&&0!=v.notExpressionValidate&&v.updateCollection(t),0==v.criteriaViewValidate||0==v.notExpressionValidate)return}v.createModelListView(),v.criteriaViewContainer&&v.criteriaViewContainer.hide()},subscribeModelEvents:function(){i.ModelEvents.subscribe({event:"LaunchingDictionarySelection"},function(e){v.criteriaViewContainer&&v.criteriaViewContainer.hide()}),i.ModelEvents.subscribe({event:"ProductStateDialogClosed"},function(e){v.criteriaViewContainer&&v.criteriaViewContainer.show()}),i.ModelEvents.subscribe({event:"UnitsDialogClosed"},function(e){v.criteriaViewContainer&&v.criteriaViewContainer.show()})},createModelViewContainer:function(){this.options.parent=this.parent;var e={isHeader:!1,isFooter:!0,firstButtonText:g.CFG_Ok,secondButtonText:g.CFG_Cancel,headerText:"",toggleSessionEffectivity:this.propagateSessionEffectivity,onCheckBoxClick:this.checkBoxClicked,onButtonClickCB:this.onSaveEffectivity};v.modelListViewContainer&&v.modelListViewContainer.destroy(),v.modelListViewContainer=new t(e).render(),v.modelListViewContainer.getContent().addClassName("CfgContainerView-EditEvolution-CustomTile"),v.modelListViewContainer.inject(this.parent),v.options.parentElement=v.modelListViewContainer._body},updateCollection:function(e){v.options.selectedmodel.set("expression",e);var t,i="";i=v.options.selectedcollection.getGlobalEvolutionExpression(),t=v.options.selectedmodel.getContextEvolutionExpression(),i=i.replace(/&(?!amp;)/g,"&amp;"),v.globalexpression=i;var o=n.getDisplayExpressionUsingXSLT(t);null!=o&&null!=o&&""!=o||(o=v.options.emptyContextText),v.options.selectedmodel.set("displayexpression",o),e.displayexpression=o},saveEffectivity:function(){this.CfgUXEnvVariables=JSON.parse(h);var e,t=function(e){for(var t in"checked"==v.propagateSessionEffectivity&&(n.isDefined(i._hasFrozenNodeInExpression)&&!1===i._hasFrozenNodeInExpression?(v.options.selectedcollection?d.collection=v.options.selectedcollection:d.collection=v.options.collection,r.saveAsSessionEvolution(d.getGlobalSessiondata())):n.showwarning(f.Frozen_Ref,"warning")),e.expressions)if(e.expressions.hasOwnProperty(t)&&null!=e.expressions[t].content&&null!=e.expressions[t].content.Evolution){if(null!=e.expressions[t].content.Evolution.Current){var o=e.expressions[t].content.Evolution.Current;e.expressions[t].content.Evolution.currentDisplayExpression=n.getDisplayExpressionUsingXSLT(o)}if(null!=e.expressions[t].content.Evolution.Projected){var s=e.expressions[t].content.Evolution.Projected;e.expressions[t].content.Evolution.projectedDisplayExpression=n.getDisplayExpressionUsingXSLT(s)}}if(null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus){var a=e.results[0].existing;if(null!=a&&null!=a.content&&null!=a.content.Evolution){if(null!=a.content.Evolution.Current){o=a.content.Evolution.Current;e.results[0].existing.content.Evolution.currentDisplayExpression=n.getDisplayExpressionUsingXSLT(o)}if(null!=a.content.Evolution.Projected){s=a.content.Evolution.Projected;e.results[0].existing.content.Evolution.projectedDisplayExpression=n.getDisplayExpressionUsingXSLT(s)}}}if(v.options.postCloseHandler&&v.options.postCloseHandler(e),null!=e.GlobalStatus&&"SUCCESS"==e.GlobalStatus||v.options.PADContext){var l={commandName:"cfgEditEvolution",widgetId:widget.id,response:n.getEventResponse(e),data:{}};n.publishPostProcessingEventForApplications(l)}void 0!==e.GlobalStatus&&"SUCCESS"==e.GlobalStatus||void 0!==e.unset&&("SUCCESS"===e.unset.Evolution.status.toUpperCase()||"WARNING"===e.unset.Evolution.status.toUpperCase())?n.showwarning(f.Save_Successful_Evo_Effectivity,"success"):void 0!==e.GlobalStatus&&"ERROR"==e.GlobalStatus?n.showwarning(e.results[0].errorDetails,"error"):n.showwarning(f.Save_Fail_Evo_Effectivity,"error")},o=function(e){n.isDefined(e)&&n.isDefined(e.errorMessage)?n.showwarning(f.Save_Fail_Evo_Effectivity+"\n"+e.errorMessage,"error"):n.showwarning(f.Save_Fail_Evo_Effectivity,"error")},s=null;v.options.dialogue.ca.headers.length>0&&(s={operationheader:{key:v.options.dialogue.ca.headers[0].key,value:v.options.dialogue.ca.headers[0].value}}),""==v.globalexpression?(e={wsOptions:s,instanceID:v.options.objectid},n.unsetEvolutionEffectivities(e).then(function(e){t(e)},function(e){o(e)})):(e={version:"1.1",domain:"Evolution",view:"All",expressionList:[{pid:v.options.objectid,EvolutionContent:v.globalexpression}],wsOptions:s},n.setEvolutionEffectivities(e).then(function(e){t(e)},function(e){o(e)}))}};return v}),define("DS/CfgEvolutionUX/CfgEditEvolutionLayout",["DS/CoreEvents/ModelEvents","DS/CfgEvolutionUX/CfgEvolutionController","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgXMLServices","DS/CfgBaseUX/scripts/CfgData","DS/CfgBaseUX/scripts/CfgCollection","i18n!DS/CfgEvolutionUX/assets/nls/CfgEvolutionUX","DS/UIKIT/Spinner","DS/UIKIT/Mask","css!DS/CfgEvolutionUX/CfgEvolutionUX.css"],function(e,t,i,o,n,s,a,l,r){"use strict";return{modelListView:null,empty_models:null,updateModelEffectivity:function(){var e=this;e.options.expressionJson=o.EvolutionXMLtoJSONConvertor(e.options.dialogue.effExpressionXml);for(var t=e.options.expressionJson.length,i=0;i<t;i++){var n=e.options.expressionJson[i];e.collection.forEach(function(t){if(t.get("name")==n.expression.name){n.expression.modelId=n.modelId=t.get("id");var i=e.options.emptyContextText;i=null==n.displayexpression||null==n.displayexpression||""==n.displayexpression?e.options.emptyContextText:n.displayexpression,t.set("displayexpression",i),t.set("expression",n.expression)}})}},getAttributeValue:function(e,t){for(var i="",o=0;o<e.length;o++)if(e[o].name==t){null!=(i=e[o].value)&&"undefined"!=i||(i="");break}return i},initModelsWithNoEffectivity:function(){this.expressionXml="",this.options.expressionArray=[],this.empty_models=new Array;for(var e=0;e<this.options.modelList.length;e++){var t=this.options.modelList[e],i={marketingName:this.getAttributeValue(t.data,"Marketing Name"),name:this.getAttributeValue(t.basicData,"name"),image:t.preview_url,icon:"",id:t.physicalID,state:this.getAttributeValue(t.basicData,"current"),owner:this.getAttributeValue(t.basicData,"owner"),expression:"",displayexpression:""};null!=t.type_icon_large_url&&(i.image=t.type_icon_large_url),null!=t.type_icon_url?i.icon=t.type_icon_url:null!=this.getAttributeValue(t.basicData,"type_icon_url")&&(i.icon=this.getAttributeValue(t.basicData,"type_icon_url"));var o=[];o=JSON.stringify({builds:o});var n={modelId:i.id,psJson:[],mpJson:[],viewJson:null,iDateJson:{DateRanges:[]},iUnitJson:o,xmlExpression:"",iDateXml:"",iUnitXml:"",impXml:"",productstatecheckbox:!0,unitcheckbox:!0,datestatecheckbox:!0,manufacturingplanstatecheckbox:!0,milestoneJson:[],milestoneXml:"",milestoneCheckbox:!0,name:i.name,marketingName:i.marketingName};i.expression=n,this.empty_models.push(i)}this.collection=new s(this.options),this.collection.reset();for(e=0;e<this.empty_models.length;e++)this.collection.addModel(this.empty_models[e])},initEditEvolution:function(){enoviaServerFilterWidget.mode=this.options.environment,enoviaServerFilterWidget.tenant=this.options.tenant;var e=this;i.populateDisplayExpressionXSLT().then(function(i){n.Models=e.options.modelList,e.options.Models=n.Models,e.options.noModelsErrorMessage="",e.options.editActionLabel=a.Edit_Evo_Effectivity,e.options.emptyContextText=a.emptyContextText_Evo_Effectivity,e.initModelsWithNoEffectivity(),1==e.options.dialogue.hasEffectivity&&e.updateModelEffectivity(),e.options.collection=e.collection,t.render(e.options)})},create:function(t){this.options=t;var o=this;n.clear(),n._hasFrozenNodeInExpression=!1,n.ModelEvents=new e,o.options.evolutionSpinner=new l({className:"evolutionSpinner"}).inject(o.options.parent),o.options.evolutionSpinner.spin(),o.options.evolutionSpinner.show(),i.checkDecouplingActivation().then(function(e){console.log(e),n.configurationCriteria=e,o.initEditEvolution()})}}});