define("DS/DELPPWAuthorLinksModule/AuthorLinksUI",["UWA/Core"],function(e){"use strict";return function(t,n,r){var a,i,s,o,c,l,u,f,I,h,g,d,P,p,L,D,k,m,A=r.getComponent("Button"),S=r.getComponent("TooltipModel"),b=r.getComponent("Accordeon"),y={dialogTitle:null,parentAccHeader:null,childAccHeader:null,modalFlag:null},R=null,v=null;return d=function(i){P(),e.is(r)?((a=r.create("Dialog",{title:y.dialogTitle,domId:"AuthorLinks-UI",content:I,modalFlag:y.modalFlag,resizableFlag:!0,buttons:{Cancel:new A({onClick:function(){a.close()}}),Apply:new A({label:n.getNLSValue("AuthorLinks.Switch"),icon:n.getIconURLFromKey("SwitchFromTo"),class:"AuthorLinksUI-SwitchBtn",tooltipInfos:new S({shortHelp:n.getNLSValue("AuthorLinks.tooltipSwitchFromTo")}),onClick:function(){i()}})}})).close=function(){e.is(I)&&I.destroy(),this.destroy(),a=null},a.buttons.Apply.hide()):t.debug("uxFactoryBehavior is not available.")},P=function(){I=r.createElement("div",{class:"AuthorLinksUI-Dialog"}),i=r.createElement("div",{class:"fromToDiv-section"}).inject(I),s=r.createElement("div",{class:"instanceOrMoveSection-container"}).inject(I),o=r.createElement("div",{class:"instance-withAccordeon-section"}).inject(s),c=r.createElement("div",{class:"instance-section"}).inject(o),l=r.createElement("div",{class:"linkSection-container"}).inject(I),u=r.createElement("div",{class:"link-withAccordeon-section"}).inject(l),f=r.createElement("div",{class:"link-section"}).inject(u),h=r.create("SelectionControl",{title:y.parentAccHeader,message:n.getNLSValue("AuthorLinks.SelectAnObject"),renderTo:i,multiSelection:!0}),g=r.create("SelectionControl",{title:y.childAccHeader,message:n.getNLSValue("AuthorLinks.SelectAnObject"),renderTo:i,multiSelection:!0})},p=function(e,t,n){return new b({items:[{header:e,content:t,expandedFlag:!0}],style:"filled-separate"}).inject(n)},L=function(t,n){e.is(t)&&h.updateLabel(t),e.is(n)&&g.updateLabel(n)},D=function(e,t,n){"parentSection"===e&&h.updateAccordeon(t,n),"childSection"===e&&g.updateAccordeon(t,n),"instanceSection"===e&&v.updateItem(t,n)},k=function(){u&&(u.empty(),f.empty(),R=null)},m=function(){e.is(o)&&(o.empty(),c.empty(),v=null)},{buildSkeleton:function(t,n){e.is(t)&&e.extend(y,t),e.is(a)||d(n)},createInstanceOrMoveButton:function(t){var r,i;for(i in e.is(v)||(v=p(n.getNLSValue("AuthorLinks.MoveOrCreateInstanceTitle"),c,o)),r=function(e){new A({label:e.label,icon:e.icon,tooltipInfos:new S({shortHelp:e.tooltipInfos}),onClick:function(){e.callback(),a.close()}}).inject(c)},t)e.is(t[i])&&r(t[i])},createLinkButtons:function(t,i){var s,o,c;for(o in e.is(R)||(R=p(n.getNLSValue("AuthorLinks.LinksUITitle"),f,u)),t)if(t.hasOwnProperty(o)){if(1===(c=Object.keys(t[o])).length){let e={linkType:o,linksData:t[o][c[0]]};s=e.linksData[0].displayText,new A({icon:n.getIconURLFromKey(o),label:s,value:s,tooltipInfos:new S({shortHelp:n.getNLSValue(o,null,"CreateLink")}),onClick:function(){i(e),a.close()}}).inject(f)}else{let e=r.getComponent("ComboBox"),s=[];c.forEach(function(e){let r={linkType:o,linksData:t[o][e]};s.push({icon:n.getIconURLFromKey(o),label:t[o][e][0].displayText,value:r})});let l=new e({elementsList:s,enableSearchFlag:!1,actionOnClickFlag:!0,tooltipInfos:new S({shortHelp:n.getNLSValue(o,null,"CreateLink")})});l.addEventListener("click",function(e){i(l.value),a.close()}),l.inject(f)}c.forEach(function(e){t[o][e].forEach(function(e){delete e.displayText,delete e.buttonIdentifier})})}},switchLabels:function(e,t){h.updateLabel(e),g.updateLabel(t)},updateLabels:function(e,t){L(e,t)},isVisible:function(){return!!e.is(a)&&a.visibleFlag},updateDialogTitle:function(e){a.title=e},updateAccordeonHeader:function(e,t,n){D(e,t,n)},showSwitchButton:function(){a.buttons.Apply.show()},hideSwitchButton:function(){a.buttons.Apply.hide()},showMessages:function(e,n){"info"===n?a.info(e):"warning"===n?a.warning(e):"error"===n?a.error(e):t.debug("type of message is invalid")},clearMessages:function(){a.clearMessages()},destroyDialog:function(){e.is(a)&&(a.destroy(),a=null)},emptyLinkUIContainer:function(){k()},emptyInstanceUIContainer:function(){m()}}}}),define("DS/DELPPWAuthorLinksModule/AuthorLinksUIManager",["UWA/Core","DS/DELPPWAuthorLinksModule/AuthorLinksUI"],function(e,t){"use strict";return function(n,r,a,i,s,o){var c,l,u,f,I,h,g,d=new t(n,r,a),P={},p=!1,L=!1,D=!1,k={_parameters:[],_isSwitched:!1,_isMultiParent:!1,set:function(t){this._parameters=e.is(t,"array")?t.slice(0):[]},get:function(){return this._parameters||[]},setMultiParent:function(e){this._isMultiParent=e||!1},isMultiParent:function(){return this._isMultiParent},isUnique:function(e){return this.getChilds().indexOf(e)<0&&this.getParents().indexOf(e)<0},getChilds:function(){return this._parameters.map(function(e){return e.referencePID}).filter(function(e,t,n){return n.indexOf(e)===t})},getParents:function(){return this._parameters.map(function(e){return e.targetReferencePID}).filter(function(e,t,n){return n.indexOf(e)===t})},isEmpty:function(){return e.is(this._parameters)&&this._parameters.length<1},swap:function(){this.isEmpty()||(this._parameters=this._parameters.map(function(e){return{rootReferencePID:e.targetRootReferencePID,referencePID:e.targetReferencePID,instancePID:e.targetInstancePID,instancePIDsArray:e.targetInstancePIDsArray,targetRootReferencePID:e.rootReferencePID,targetReferencePID:e.referencePID,targetInstancePID:e.instancePID,targetInstancePIDsArray:e.instancePIDsArray,allowMove:e.allowMove}}),this._isSwitched=!this._isSwitched)},getToFromLabel:function(){var e={firstFromLabel:"",toLabel:""};return this._parameters.forEach(function(t,n){var r=i.getReference(t.targetReferencePID),a=i.getReference(t.referencePID),s=0===n?"":", ";r&&a&&(0===n&&(e.firstFromLabel=r.get("V_Name")),e.toLabel+=s+a.get("V_Name"))}),e},reset:function(){this._parameters=[],this._isSwitched=!1,this._isMultiParent=!1},isSwitched:function(){return this._isSwitched},isParentChildAvailable:function(){return this._parameters.every(function(t){return e.is(t.targetReferencePID)&&e.is(t.referencePID)})}};return c=function(e){d.destroyDialog(),d.buildSkeleton(e,function(){k.swap(),f()})},f=function t(){var n=k.get(),a=!0,o=!0,c=!0,u=!0,f=P.isInstanceUI&&!P.isLinkUI,g=P.isInstanceUI&&P.isLinkUI,m=[],A=[],S={},b={},y={},R=null,v=null;if(!k.isEmpty()){if(L=!1,p=!1,D=!1,n.forEach(function(t){var n=i.getReference(t.targetReferencePID),r=i.getReference(t.referencePID),l=i.getInstance(t.targetInstancePID),f=i.getInstance(t.instancePID),I={parent:n,child:r,targetAbsPath:t.targetInstancePIDsArray};e.is(n)&&e.is(r)&&(i.isReferencesHasReadOnlyType([n,r])&&(u=a=o=c=!1),a=a&&i.isInstancePossible(I),I={parent:r,child:n,targetAbsPath:t.instancePIDsArray},u=u&&i.isInstancePossible(I),o=o&&s.isLinkPossible(n,r,l,f),c=c&&a&&i.isMovePossible(n,f)),n&&m.push(n),r&&A.push(r)}),f&&!a&&u){k.swap();let e=A;A=m,m=e,a=!0,u=!1}k.getParents().length>1?d.updateLabels(m,A[0]):d.updateLabels(m[0],A),d.clearMessages(),d.emptyInstanceUIContainer(),d.emptyLinkUIContainer(),k.isParentChildAvailable()&&(P.isInstanceUI&&a||P.isLinkUI&&o?(P.isInstanceUI&&a&&(y={header:r.getNLSValue("AuthorLinks.InstanceUITitle")},R={label:r.getNLSValue("AuthorLinks.tooltipInstanceBtn"),icon:r.getIconURLFromKey("CreateInstance"),tooltipInfos:r.getNLSValue("AuthorLinks.tooltipInstanceBtn"),callback:l},c&&(y={header:r.getNLSValue("AuthorLinks.MoveOrCreateInstanceTitle")},v={label:r.getNLSValue("AuthorLinks.tooltipMoveBtn"),icon:r.getIconURLFromKey("MoveInstance"),tooltipInfos:r.getNLSValue("AuthorLinks.tooltipMoveBtn"),callback:h}),d.createInstanceOrMoveButton({instanceObj:R,moveObj:v}),d.updateAccordeonHeader("instanceSection",0,y),a&&u&&(L=!0)),P.isLinkUI&&o?I(null,{onComplete:function(){(L||p)&&d.showSwitchButton(),g&&!D&&!a&&u&&(k.swap(),t())}}):L&&d.showSwitchButton()):d.showMessages(P.errorMsg,"error"),!(P.isDragDrop&&P.isLinkUI&&o)||P.isInstanceUI&&a||(S={header:r.getNLSValue("AuthorLinks.From")},b={header:r.getNLSValue("AuthorLinks.To")},d.updateDialogTitle(r.getNLSValue("AuthorLinks.LinksUITitle")),d.updateAccordeonHeader("parentSection",0,S),d.updateAccordeonHeader("childSection",0,b)))}},l=function(){var e=k.getToFromLabel();i.createMultipleInstances(k.get(),e.firstFromLabel,e.toLabel)},h=function(){var t=k.get(),n=k.getToFromLabel(),r={instancesPIDsToReparent:null,formerInstancesParentPIDs:null,newParentPID:null,newParentInstancesOrder:null};t.forEach(function(t,n){var a=i.getInstance(t.instancePID),s=e.is(a)?a.get("isAggregatedBy"):null;0===n&&(r.instancesPIDsToReparent=[],r.formerInstancesParentPIDs=[],r.newParentPID=t.targetReferencePID,r.newParentInstancesOrder=i.getInstancesFromCollection(t.targetReferencePID).map(function(e){return e.get("PID")})),r.instancesPIDsToReparent.push(t.instancePID),r.formerInstancesParentPIDs.push(s),r.newParentInstancesOrder.push(null)}),i.moveMultipleInstances(r,n.firstFromLabel,n.toLabel)},I=function(t,n){var a,o,c=[],l=[],u={},f={},I=[],h=[],g={},P=k.get(),L=function(e){s.createConnectionsByType(e)},m=function(e){var t;return t=function(e){var t,n;for(t in e)if(e.hasOwnProperty(t)){let r=e[t];(n=Object.keys(r)).length>1&&n.forEach(function(e){r[e].length!==P.length&&delete r[e]})}return e}(e),Object.keys(t).forEach(function(t){0===Object.keys(e[t]).length&&delete e[t]}),e},A=function(e){var t;return t=function(e){var t,n={};for(t in e)if(e.hasOwnProperty(t)){let r,a=e[t].data,i={};r=function(e,t){var n=e.buttonIdentifier;t.hasOwnProperty(n)?t[n].push(e):t[n]=[e]},a.forEach(function(e){r(e,i)}),n[t]=i}return n}(e),t=m(t)};n=n||{},Array.isArray(P)&&P.length>0&&(o=[],P.forEach(function(t){var n=t.instancePID||t.referencePID,r=t.instancePIDsArray||[];e.is(g[n])||(o.push({id:n,path:r}),g[n]=!0),n=t.targetInstancePID||t.targetReferencePID,r=t.targetInstancePIDsArray||[],e.is(g[n])||(o.push({id:n,path:r}),g[n]=!0)})),s.getRelations(o).then(function(o){if(o.isRelationsLoaded){if(d.emptyLinkUIContainer(),P.forEach(function(e,t){var n,r,a,o=i.getReference(e.targetReferencePID),c=i.getReference(e.referencePID),l={fromSideAbsPath:e.targetInstancePIDsArray,toSideAbsPath:e.instancePIDsArray,fromSideRefPID:e.targetReferencePID,toSideRefPID:e.referencePID,fromSideInstPID:e.targetInstancePID,toSideInstPID:e.instancePID,fromSideRootRefPID:e.targetRootReferencePID,toSideRootRefPID:e.rootReferencePID},g=function(t){return{fromSideAbsPath:t.toSideAbsPath,toSideAbsPath:t.fromSideAbsPath,fromSideRefPID:t.toSideRefPID,toSideRefPID:t.fromSideRefPID,fromSideInstPID:e.instancePID,toSideInstPID:e.targetInstancePID,fromSideRootRefPID:e.rootReferencePID,toSideRootRefPID:e.targetRootReferencePID}},d=function(e,t){var n,r={};for(n in e)t.hasOwnProperty(n)&&(r[n]={data:e[n].data.concat(t[n].data)});return r};0===t?(u=s.getPossibleRelationTypes(l),a=g(l),f=s.getPossibleRelationTypes(a)):(n=s.getPossibleRelationTypes(l),u=d(n,u),a=g(l),r=s.getPossibleRelationTypes(a),f=d(r,f)),I.push(o),h.push(c)}),u=A(u),f=A(f),c=Object.keys(u),l=Object.keys(f),p=c.length>0&&l.length>0,D=c.length>0||l.length>0,0===c.length&&l.length>0&&(k.swap(),a=h,h=I,I=a,k.getParents().length>1?d.updateLabels(I,h[0]):d.updateLabels(I[0],h),c=l,u=f),e.is(t)){if(c.indexOf(t)>-1){let e={linkType:t,linksData:Object.values(u[t])[0]};L(e)}return}c.length<1?d.showMessages(r.getNLSValue("AuthorLinks.LinkNotPossible"),"error"):d.createLinkButtons(u,L),e.is(n.onComplete)&&n.onComplete()}})},u=function(t){var n=[],r=k.get().slice(0),a=function(e,t){var n;return e=e||{},t=t||{},k.isSwitched()&&(n=t,t=e,e=n),{targetRootReferencePID:e.targetRootReferencePID||null,targetReferencePID:e.targetReferencePID||e.referenceId,targetInstancePID:e.targetInstancePID||e.instanceId,targetInstancePIDsArray:e.targetInstancePIDsArray||e.path,rootReferencePID:null,referencePID:t.referenceId||t.referencePID,instancePID:t.instanceId||t.instancePID,instancePIDsArray:t.path||t.instancePIDsArray}};e.is(t,"array")&&t.length>0&&(0===r.length?(t.forEach(function(e){n.push(a(e))}),k.setMultiParent(n.length>1)):k.isMultiParent()?n=r.map(function(e){return a(e,t[0])}):k.isParentChildAvailable()?(n=r,k.isUnique(t[0].referenceId)&&n.push(a(r[r.length-1],t[0]))):k.isUnique(t[0].referenceId)&&n.push(a(r[0],t[0])),k.set(n))},g=function(){var t,n=!1,r=new Set;return k.get().forEach(function(t){var n,a,o,c;t.linkType&&(n=i.getReference(t.targetReferencePID),a=i.getReference(t.referencePID),o=i.getInstance(t.targetInstancePID),c=i.getInstance(t.instancePID),e.is(n)&&e.is(a)&&s.isLinkPossible(n,a,o,c)&&r.add(t.linkType))}),1===r.size&&(n=!0,t=r.values().next().value,I(t)),n},{createLinkOrInstanceUI:function(t){var n={};e.is(t,"array")&&t.length>0&&(P.isLinkUI=!0,P.isInstanceUI=!0,P.isDragDrop=!0,P.errorMsg=r.getNLSValue("AuthorLinks.NoPossibleAction"),n={dialogTitle:r.getNLSValue("AuthorLinks.AuthorLinksUITitle"),parentAccHeader:r.getNLSValue("AuthorLinks.FromOrParent"),childAccHeader:r.getNLSValue("AuthorLinks.ToOrChild"),modalFlag:!0},k.set(t),g()||(c(n),f()))},createLinkUI:function(e){var t;P.isLinkUI=!0,P.isInstanceUI=!1,P.isDragDrop=!1,P.errorMsg=r.getNLSValue("AuthorLinks.LinkNotPossible"),u(e),t={dialogTitle:r.getNLSValue("AuthorLinks.LinksUITitle"),parentAccHeader:r.getNLSValue("AuthorLinks.From"),childAccHeader:r.getNLSValue("AuthorLinks.To"),modalFlag:!1},c(t),f()},createInstanceUI:function(e){var t;P.isLinkUI=!1,P.isInstanceUI=!0,P.isDragDrop=!1,P.errorMsg=r.getNLSValue("AuthorLinks.InstanceNotPossible"),u(e),t={dialogTitle:r.getNLSValue("AuthorLinks.InstanceUITitle"),parentAccHeader:r.getNLSValue("AuthorLinks.Parent"),childAccHeader:r.getNLSValue("AuthorLinks.Child"),modalFlag:!1},c(t),f()},updateSelectionUI:function(e){u(e),f()},isDialogVisible:function(){return d.isVisible()},reset:function(){k.reset()}}}}),define("DS/DELPPWAuthorLinksModule/AuthorLinksModule",["UWA/Core","DS/DELPPWAuthorLinksModule/AuthorLinksUIManager"],function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ResourceBehavior","ModelBehavior","LinkBehavior","ImplementBehavior","ProductFlowLinkBehavior","CapableResourceLinkBehaviour","MfgProcessBehavior","SelectionBehavior"],creator:function(n,r,a,i,s,o,c,l,u,f){var I=new t(n,a,r,i,s,o),h=function(t){var n,r,a,s=[];return e.is(t,"array")&&t.forEach(function(t){n=i.getInstance(t.id),a=e.is(n)?n.get("isInstanceOf"):t.id,r=e.is(n)?n.get("PID"):null,s.push({referenceId:a,instanceId:r,path:t.path})}),s},g=function(){var t,n=f.getSelectionsWithPaths(),r=[],a=[];return e.is(n,"array")&&n.forEach(function(n){e.is(n,"array")&&n.length>0&&(0===a.length||0===r.length)&&(t=[],n.forEach(function(e){t.push({id:e.id,path:e.path})}),0===a.length&&t.length>0?a=h(t):0===r.length&&t.length>0&&(r=h(t)))}),{target:a,source:r}},d=function(){I.reset()},P=function(t){var n=[],r=[],a=[],c=[];e.is(t,"array")&&t.forEach(function(t){var r=i.getReference(t.referencePID),a=i.getReference(t.targetReferencePID);e.is(r)&&e.is(a)&&((r.isProduct()||r.isPart())&&a.isProcess()?n.push(t):c.push(t))}),c.length>0&&I.createLinkOrInstanceUI(c),n.length>0&&((r=[{instancePID:n[0].targetInstancePID,instancePIDsArray:n[0].targetInstancePIDsArray,referencePID:n[0].targetReferencePID,rootReferencePID:n[0].targetRootReferencePID}]).forEach(function(e){a=a.concat(e.instancePIDsArray),e.instancePIDsArray.forEach(function(e){var t=i.getReferenceIdFromInstance(e);a.push(t)})}),s.getRelations([{id:r[0].instancePID,path:a}]).then(function(e){e.isRelationsLoaded&&o.consumeImplementedItems(n)}))};return{name:"AuthorLinksModule",listenTo:function(){return{select:this.onSelect,CreateLinkOrInstance:this.onCreateLinkOrInstance,CreateMultipleLinks:P,CreateCapableResourceStructureLink:this.onCreateCapableResourceStructureLink,CreateLink:this.onCreateLink,CreatePartialScopeLinkOnHeaderOperation:this.onCreatePartialScopeLinkOnHeaderOperation,CreateInstance:this.onCreateInstance}},onStart:function(){},onStop:function(){},onCreateLinkOrInstance:function(t){var r=[],a=t[0].targetReferencePID,c=t[0].targetInstancePIDsArray,l=t[0].referencePID,u=n.getPreferenceValue("isOutputActivated"),f=n.getPreferenceValue("isAutomaticDragNDropEnabled"),h=i.getPPRType(l);if(e.is(t,"array"))if(d(),f&&"PROCESS"===h)switch(i.getPPRType(a)){case"SYSTEM":u?I.createLinkOrInstanceUI(t):(r.push({implementedAbsPath:[],implementedPID:l,implementingAbsPath:[],implementingPID:a}),o.createScopeLink(r));break;case"OPERATION":t.forEach(function(e){r.push({implementedAbsPath:e.instancePIDsArray,implementingAbsPath:c,type:o.getImplementLinkType()})}),s.createConnection(r);break;default:I.createLinkOrInstanceUI(t)}else I.createLinkOrInstanceUI(t);else n.debug(this.name,"Invalid input parameters to createLinkorInstance.")},onCreateCapableResourceStructureLink:function(){var t,n=[];f.getSelectionsWithPaths().forEach(function(t){e.is(t,"array")&&t.length>0&&t.forEach(function(e){n.push({id:e.id,path:e.path})})}),t=h(n),e.is(t,"array")&&1===t.length&&l.createCapableResourceStructureLink(t[0].referenceId)},onCreateLink:function(){var t=g();d(),e.is(t)&&(Array.isArray(t.target)&&I.createLinkUI(t.target),Array.isArray(t.source)&&I.updateSelectionUI(t.source))},onCreatePartialScopeLinkOnHeaderOperation:function(t){var r=s.getPossiblePartialScopeLinkOnHeaderOperation(t);e.is(r.errorMessage)?n.warn(r.errorMessage):s.createHOPMfgItemPartialScopeLink(r.linksData)},onCreateInstance:function(){var t=g();d(),e.is(t)&&(t.target&&I.createInstanceUI(t.target),t.source.length>0&&I.updateSelectionUI(t.source))},onSelect:function(e){var t={},n=[];e&&I.isDialogVisible()&&!0===e.changed.isSelected&&(n.push({id:e.changed.nodeId,path:e.changed.absPath}),(t=h(n))&&I.updateSelectionUI(t))}}}}});