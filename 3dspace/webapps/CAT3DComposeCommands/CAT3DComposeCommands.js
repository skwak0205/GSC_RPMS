/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CAT3DComposeCommands/CAT3DComposeRobotSnapMove",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/CATW3DRobot/CATW3DRobot","DS/PADUtils/PADContext","DS/CATW3DRobot/CATC3DRobotSnapPanel"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0});var a=i.get(),r=this;this.execute=function(){var e,i=n.getMove3DRobot({context:a}),s=t.get();1===s.length&&(s[0].event&&(e=t._items[0].pathElement.getBoundingSphere().center),i.modifyTargetAndPosition({pathElement:s[0].pathElement,robotPosition:e}),r._panel=new o({immersiveFrame:a.getFrameWindow().getImmersiveFrame(),controller:r,_robot:i,robotP:e}))}}})}),define("DS/CAT3DComposeCommands/CATC3DReverseDirectionCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/PADUtils/PADContext","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DConstraints/CATW3DConstraintsController","DS/CATW3DMoveManager/CATW3DMoveManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n,i,o,a,r,s){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!1}),this.setRepeatMode(!1),this.execute=function(){var e=t.get();if(e.length){var c,l=i.get(),u=r.giveMoveManager({context:l}),d=o.getMoveReferentManager({context:l}),m=a.giveConstraintsController({context:l});if(e.some(function(e){var t;return c=d.getMoveReferent(e.pathElement),!!(m&&c&&(t=c.getLastElement(!0))&&s.isInstance(t)&&t.children.length>0)&&(c.addElement(t.children[0]),m.isThereACstSuppportingReverseDirection(c))})&&c&&m){var C=m.simulateReverseDirection(c)||{},E=C.matrix||new n.Matrix4,S=new n.Matrix4,p=C.rc,A=C.redundancy;0!==p||A||(u.onMoveBegin({objectsMoved:e,from:this,moveMode:"Persistent"}),e.forEach(function(e){u.onMove({objectsMoved:[{path:e.pathElement}],from:this,worldMatrix:S.multiplyMatrices(E,e.pathElement.getWorldMatrix())})},this),u.onMoveEnd({from:this,status:"Moved"}))}}}}})}),define("DS/CAT3DComposeCommands/CATC3DPasteAtLocalCoordinatesCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/Selection/CSOManager","DS/PADUtils/PADContext","DS/Visualization/ThreeJS_DS","DS/ApplicationFrame/CommandsManager","DS/CATW3DMoveManager/CATW3DMoveManager"],function(e,t,n,i,o,a){"use strict";var r=new i.Matrix4;return e.extend({init:function(e){this._parent(e);var i=this,s=a.giveMoveManager({context:n.get()});this.onStateChange(function(){if(i.getState()){var e=[];t.get().forEach(function(t){e.push({path:t.pathElement})}),e.length&&(s.onMoveBegin({objectsMoved:e,from:i,moveMode:"Persistent"}),s.onMove({objectsMoved:e,from:i,leafMatrix:r}),s.onMoveEnd({from:i,status:"Moved"}),n.get().getViewer().render());var a=n.get();o.getCommandCheckHeader("CATC3DPasteAtOriginalPositionHdr",a.getCommandContext?a.getCommandContext():null).setState(!1)}}),this.toggleState=function(){i.getState()||i.setState(!0)},this._destroy=function(){Object.getPrototypeOf(this)._destroy&&Object.getPrototypeOf(this)._destroy.apply(this,arguments),i=void 0}}})}),define("DS/CAT3DComposeCommands/CATC3DPasteAtOriginalPositionCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/Visualization/ThreeJS_DS","DS/CATW3DMoveManager/CATW3DMoveManager","DS/ApplicationFrame/CommandsManager"],function(e,t,n,i,o,a,r){"use strict";var s=new o.Matrix4;return e.extend({init:function(e){this._parent(e);var n,o=this,c=!1,l=[],u=i.get().getFrameWindow().getContextualUIManager(),d=a.giveMoveManager({context:i.get()}),m=function(){n=[],u.hideContextualMenus(),t.get().forEach(function(e){var t=d.getSubPathToMovable(e.pathElement);if(t){var i=t.getMatrix();i.equals(s)||n.push({pathElement:e.pathElement,path:t,matrix:i})}}),n.length>0&&(u.showContextualBar({x:i.get().getViewer().SCREEN_WIDTH/2,y:i.get().getViewer().SCREEN_HEIGHT/2,hideWithDistance:!1,fillingList:[{onContextualBarReady:function(){return{cmdList:[{name:"CATC3DPasteAtOriginalPositionStr",line:1,hdr_list:["CATC3DPasteAtOriginalPositionHdr"]},{name:"CATC3DPasteAtLocalCoordinatesStr",line:1,hdr_list:["CATC3DPasteAtLocalCoordinatesHdr"]}]}},context:i.get().getCommandContext?i.get().getCommandContext():null,workbenchName:"CAT3DComposeWidgetWkb",module:"CAT3DComposeWidget",cmdPrefix:""}]}),c=!0,o.setState(!0))},C=i.get().subscribe({event:"onAuthoringTransactionEnd"},m);require(["DS/CAT3DComposeUtils/CATC3DDropManager"],function(e){var t=e.getDropManager({context:i.get()});l.push(t.subscribe({event:"onBeginInsertDrop3D"},function(){i.get().unsubscribe(C)})),l.push(t.subscribe({event:"onEndInsertDrop3D"},function(e){e&&"inPosition"===e.type&&m(),C=i.get().subscribe({event:"onAuthoringTransactionEnd"},m)}))}),this.onStateChange(function(){if(o.getState()){c?c=!1:n.length>0&&(d.onMoveBegin({objectsMoved:n,from:o,moveMode:"Persistent"}),n.forEach(function(e){!e.path.getMatrix().equals(e.matrix)&&t.isIn(e)&&d.onMove({objectsMoved:[e],from:o,leafMatrix:e.matrix})}),d.onMoveEnd({from:o,status:"Moved"}),i.get().getViewer().render());var e=i.get();r.getCommandCheckHeader("CATC3DPasteAtLocalCoordinatesHdr",e.getCommandContext?e.getCommandContext():null).setState(!1)}}),this.toggleState=function(){this.getState()||o.setState(!0)},this._destroy=function(){i.get().unsubscribe(C),require(["DS/CAT3DComposeUtils/CATC3DDropManager"],function(e){var t=e.getDropManager({context:i.get()});t&&l.forEach(function(e){t.unsubscribe(e)}),l=[]}),Object.getPrototypeOf(this)._destroy&&Object.getPrototypeOf(this)._destroy.apply(this,arguments),d=n=c=C=u=m=o=void 0}}})}),define("DS/CAT3DComposeCommands/CAT3DComposeCtxMenuAgent",["UWA/Class","DS/Selection/CSOManager","DS/Visualization/ThreeJS_DS","DS/ApplicationFrame/CommandsManager","DS/CATW3DGeometry/CATW3DGeometryEnums","DS/CATW3DConstraints/CATW3DConstraintsController","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n,i,o,a,r,s){"use strict";var c=0;return e.extend({init:function(e){this._parent(e);var l,u,d=e.context,m=d.getCommandContext?d.getCommandContext():null,C=[];this.activate=function(){0===C.length&&(l=d.getViewer(),u=r.getMoveReferentManager({context:d}),C=["CAT3DComposeCtxMenuAgent_"+c++,"CAT3DComposeCtxMenuAgent_"+c++],d.getFrameWindow().getContextualUIManager().register({onContextualBarReady:function(e,r){var c=t.get();if(0!==c.length){var C=s.getRoots(d),E=[],S=!1,p=!1,A=a.giveConstraintsController({context:d});c.some(function(e){var t,n=u.getMoveReferent(e.pathElement);if(n&&(t=n.getLastElement(!0))&&s.isInstance(t)&&t.children.length>0){n.addElement(t.children[0]),A&&A.isThereACstSuppportingReverseDirection(n)&&(S=!0);var a=A?A.getAxisTypeIfCstOnProductAxis(n):null;return a&&(p=!0,a===o.GeometryType.AXISX?i.getCommandCheckHeader("CATC3DSwitchAxisXHdr",m).setState(!0):a===o.GeometryType.AXISY?i.getCommandCheckHeader("CATC3DSwitchAxisYHdr",m).setState(!0):i.getCommandCheckHeader("CATC3DSwitchAxisZHdr",m).setState(!0)),S&&p}return!1}),p&&E.push({name:"CATC3DSwitchAxisIcb",line:1,hdr_list:["CATC3DSwitchAxisXHdr","CATC3DSwitchAxisYHdr","CATC3DSwitchAxisZHdr"]}),S&&E.push({name:"CATC3DReverseDirectionStr",line:1,hdr_list:["CATC3DReverseDirectionHdr"]});var g=c.some(function(e){var t=e.pathElement.getLastElement(!0);return C.some(function(n){var i=n!==t,o=e.pathElement.externalPath.some(function(e){return n===e});return i&&o})});if(g&&r&&r.withContextMenu&&"number"==typeof r.XmousePosition&&"number"==typeof r.YmousePosition)0===l.pick(l.getMousePosition(new n.Vector2(r.XmousePosition,r.YmousePosition)),"mesh",!1).path.length&&(g=!1);return g&&(i.getCommand("CAT3DComposeExamineSelectionHdr",m).canBeEnabled(c)&&E.push({name:"CAT3DComposeExamineSelectionStr",line:1,hdr_list:["CAT3DComposeExamineSelectionHdr"]}),1===c.length&&(E.push({name:"RobotSnapMove",line:1,hdr_list:["CAT3DComposeRobotSnapMoveHdr"]}),E.push({name:"LevelSelector",line:1,hdr_list:["LevelSelectorHdr"]}))),E.length?{cmdList:E}:void 0}},context:m,workbenchName:"CAT3DComposeWidgetWkb",module:"CAT3DComposeWidget",cmdPrefix:"",merge:!0,subscriberId:C[0]}),d.getFrameWindow().getContextualUIManager().register({onContextualBarReady:function(e,i){var o=[],a=t.get();if(1===a.length){var r=a[0].pathElement.getLastElement(!0);s.getRoots(d).some(function(e){return e===r})&&o.push({name:"RemoveRoot",line:1,hdr_list:["RemoveRootHdr"]})}if(i&&i.withContextMenu&&"number"==typeof i.XmousePosition&&"number"==typeof i.YmousePosition&&0===l.pick(l.getMousePosition(new n.Vector2(i.XmousePosition,i.YmousePosition)),"mesh",!1).path.length)return;return o.length?{cmdList:o}:void 0},context:m,workbenchName:"ENOPAD3DViewerContextualBar",module:"ENOPAD3DViewer",cmdPrefix:"",merge:!0,subscriberId:C[1]}))},this.deactivate=function(){l=u=null,C.forEach(function(e){d.getFrameWindow().getContextualUIManager().unregister(e)}),C=[]}}})}),define("DS/CAT3DComposeCommands/CATC3DSwitchAxisCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/CommandsManager","DS/Selection/CSOManager","DS/PADUtils/PADContext","DS/Visualization/ThreeJS_DS","DS/CATW3DConstraints/CATW3DConstraintsController","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DMoveManager/CATW3DMoveManager","DS/CATW3DGeometry/CATW3DGeometryEnums","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n,i,o,a,r,s,c,l){"use strict";var u=c.GeometryType;return e.extend({init:function(e){var c,d;switch(this._parent(e),e.ID){case"CATC3DSwitchAxisXHdr":c=u.AXISX,d=["CATC3DSwitchAxisYHdr","CATC3DSwitchAxisZHdr"];break;case"CATC3DSwitchAxisYHdr":c=u.AXISY,d=["CATC3DSwitchAxisXHdr","CATC3DSwitchAxisZHdr"];break;default:c=u.AXISZ,d=["CATC3DSwitchAxisXHdr","CATC3DSwitchAxisYHdr"]}var m=this.onStateChange(function(){if(this.getState()){var e,u,m=a.giveConstraintsController({context:i.get()}),C=s.giveMoveManager({context:i.get()}),E=r.getMoveReferentManager({context:i.get()}),S=n.get();if(S.some(function(t){var n;return u=E.getMoveReferent(t.pathElement),!!(m&&u&&(n=u.getLastElement(!0))&&l.isInstance(n)&&n.children.length>0)&&(u.addElement(n.children[0]),e=m.getAxisTypeIfCstOnProductAxis(u))}),m&&e&&e!==c&&u){var p=m.simulateSwitchAxis(u,c)||{},A=p.matrix||new o.Matrix4,g=new o.Matrix4,h=p.rc,f=p.redundancy;0!==h||f||(C.onMoveBegin({objectsMoved:S,from:this,moveMode:"Persistent"}),S.forEach(function(e){C.onMove({objectsMoved:[{path:e.pathElement}],from:this,worldMatrix:g.multiplyMatrices(A,e.pathElement.getWorldMatrix())})},this),C.onMoveEnd({from:this,status:"Moved"}),m.setProductAxisForConstraint(c))}var v=i.get();d.forEach(function(e){t.getCommandCheckHeader(e,v.getCommandContext?v.getCommandContext():null).setState(!1)})}});this._destroy=function(){this._modelEvents.unsubscribe(m),Object.getPrototypeOf(this)._destroy.call(this),m=d=null}},toggleState:function(){this.getState()||this.setState(!0,!0)},_destroy:function(){this._parent()}})}),define("DS/CAT3DComposeCommands/CATC3DAxisSystemDisplayAgent",["UWA/Class","DS/Visualization/PathElement","DS/Selection/PSOManager","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/CATW3DAnims/CATW3DAnimation3D","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/RenderStyle","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"],function(e,t,n,i,o,a,r,s,c){"use strict";var l="AxisSystems";return e.extend({init:function(e){var u,d,m,C,E,S,p,A=e.context,g=A.getViewer().getSceneGraphOverrideSetManager();function h(e,t){return e&&t&&e.isEqual(t)}function f(e){for(var n,i=e?new t(e.externalPath):null;i&&(!(n=i.getLastElement())||!c.is3DLeaf(n));)i=i.getParentPath();return i}function v(e){var t,n,i,o,a=f(e),r=null;if(a&&(i=[],n=(t=a.getLastElement(!0)).getChildByName(l))){for(o=n.getParents();o&&o[0]&&o[0]!==t;)i.unshift(o[0]),o=o[0].getParents();i.push(n),r=a,i.forEach(function(e){r.addElement(e)})}if(r){var s=r.getChildrenPathes(),c=[];return s.forEach(function(e){var t={paths:[]};!function e(t,n){var i=null;n.push(t),(i=t.getChildrenPathes())&&i.length>0&&i.forEach(function(t){e(t,n)})}(e,t.paths),c.push(t)}),{axisBagPath:r,axisSystems:c}}return null}function T(e){if(!e||!e.pathElement)return null;if(A.getViewer().getAxisFilter())return p&&(g.removeSceneGraphOverrideSet(p),p=null,A.getViewer().render()),null;p&&-1===g.getSceneGraphOverrideSetIndex(p)&&g.pushSceneGraphOverrideSet(p);var t=v(e.pathElement);if(t&&t.axisSystems&&t.axisSystems.length>0){var n=[];t.axisSystems.forEach(function(e){var t;t=e.paths[0],C&&!C.get().some(function(e){return e.pathElement.getLastElement(!0)===t.getLastElement(!0)})&&(e.node=e.paths[0].getLastElement(!0),n.push(e))}),n.length===t.axisSystems.length&&n.push({paths:[t.axisBagPath]}),n.length>0&&n.forEach(function(e){p||(p=new r(A.getRootBagPath().externalPath[0]),g.pushSceneGraphOverrideSet(p));var t,n=p.getUniqueOverrideFromPathElement(e.paths[0]);n||(n=p.createOverride({pathes:e.paths}),(t=new s).setRenderMode("AxisSystem",!0),n.setRenderStyle(t)),e.override=n}),a.getAnimation3DEngine({viewer:A.getViewer()}).axisSystemVisibility({objectListToAnimate:n,visibility:e.visibility,pickability:e.pickability})}return e.pathElement}function D(e){var t=f(e.pathElement);h(E,t)||(T({pathElement:E,visibility:!1,pickability:!1}),E=T({pathElement:t,visibility:!0,pickability:!0}))}function y(){var e=n.get();clearTimeout(S),S=null,1===e.length?D({pathElement:e[0].pathElement?e[0].pathElement:e[0].originalPathElement}):T({pathElement:E,visibility:!1,pickability:!1})}function I(e){var t=f(e.pathElement?e.pathElement:e.originalPathElement);t&&(S=setTimeout(function(){T({pathElement:t,visibility:!1,pickability:!1}),E=null},1e3))}function R(e){var t=f(e.pathElement);(!E||E&&t&&!h(t,E))&&T({pathElement:e.pathElement,visibility:!1,pickability:!1})}A.getViewer().onAxisFilterChange(function(){p&&(g.removeSceneGraphOverrideSet(p),p=null,A.getViewer().render())}),this.activate=function(e){C||(p&&(g.pushSceneGraphOverrideSet(p),A.getViewer().render()),u=n.onPostAdd(y),d=n.onRemove(I),C=e&&"HSO"===e.type?i:o,m=C.onRemove(R))},this.analyze=D,this.deactivate=function(){C&&(p&&(g.removeSceneGraphOverrideSet(p),A.getViewer().render()),n.unsubscribe(u),n.unsubscribe(d),C.unsubscribe(m),u=d=m=C=null)}}})}),define("DS/CAT3DComposeCommands/CATC3DDefaultSelectionFilter",["UWA/Class","DS/Visualization/PathElement","DS/Selection/PSOManager","DS/WebappsUtils/WebappsUtils","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/CAT3DComposeCommands/CATC3DAxisSystemDisplayAgent","DS/CATW3DGeometry/CATW3DEquivalentGeometry","DS/CATW3DGeometry/CATW3DGeometryEnums","DS/CATW3DUtils/CATW3DUtils"],function(e,t,n,i,o,a,r,s,c){"use strict";var l={};require(["i18n!DS/CAT3DComposeCommands/assets/nls/CAT3DComposeCommands"],function(e){l.point=e.point,l.center=e.center,l.axisSystem=e.axisSystem,l.line=e.line,l.plane=e.plane,l.cylinder=e.cylinder,l.surface=e.surface,l.product=e.product});var u,d,m=i.getWebappsAssetUrl("DMUMeasure","icons/32/"),C=i.getWebappsAssetUrl("CAT3DComposeCommands","icons/32/"),E=function(e){u?e():d||(d=!0,require(["DS/Web3DUXFilterBar/Web3DUXFilterBar"],function(t){d=!1,u=t,e()}))},S=e.extend({init:function(e){var i,d,S,p,A,g,h,f,v=e.context,T=!0,D=v.getViewer(),y={none:0,point:0,center:0,axisSystem:1,line:0,plane:1,cylinder:1,surface:0,product:1},I=localStorage.getItem("C3DSelectionFilter"),R=new a({context:v}),N=function(){y={none:1,point:0,center:0,axisSystem:0,line:0,plane:0,cylinder:0,surface:0,product:0},A.getActiveState("point")&&(y.none=0,y.point=1),A.getActiveState("center")&&(y.none=0,y.center=1),A.getActiveState("axisSystem")&&(y.none=0,y.axisSystem=1),A.getActiveState("line")&&(y.none=0,y.line=1),A.getActiveState("plane")&&(y.none=0,y.plane=1),A.getActiveState("cylinder")&&(y.none=0,y.cylinder=1),A.getActiveState("surface")&&(y.none=0,y.surface=1),A.getActiveState("product")&&(y.none=0,y.product=1);var e="1-"+y.point+y.center+y.axisSystem+y.line+y.plane+y.cylinder+y.surface+y.product+"-"+(T?1:0);localStorage.setItem("C3DSelectionFilter",e),y.axisSystem?R.activate():R.deactivate()},b=function(){var e;function t(t){if(!t)return e=!1,void(A&&A.setVisibleFlag(!1));e=!0,T?A?A.setVisibleFlag(!0):E(function(){(A=new u({body:v.getFrameWindow().getUIFrame(),frmWindow:v.getFrameWindow(),Idpanel:"c3dSelectionFilter",classpanel:"c3dSelectionFilter",typeSeparator:"bubble",lJsonElement:[{type:"element",id:"point",nls:l.point,url:m+"I_Meas_Point.png",callback:N,bexclude:!1,bstateActif:y.point},{type:"element",id:"center",nls:l.center,url:m+"I_Meas_PointCircle.png",callback:N,bexclude:!1,bstateActif:y.center},{type:"element",id:"axisSystem",nls:l.axisSystem,url:C+"I_3DComposeAxisSystem.png",callback:N,bexclude:!1,bstateActif:y.axisSystem},{type:"element",id:"line",nls:l.line,url:m+"I_Meas_Line.png",callback:N,bexclude:!1,bstateActif:y.line},{type:"element",id:"plane",nls:l.plane,url:m+"I_Meas_Plane.png",callback:N,bexclude:!1,bstateActif:y.plane},{type:"element",id:"cylinder",nls:l.cylinder,url:m+"I_Meas_Cylinder.png",callback:N,bexclude:!1,bstateActif:y.cylinder},{type:"element",id:"surface",nls:l.surface,url:m+"I_Meas_Surface.png",callback:N,bexclude:!1,bstateActif:y.surface},{type:"element",id:"product",nls:l.product,url:m+"I_Meas_Product.png",callback:N,bexclude:!1,bstateActif:y.product}]})).build();var t=document.querySelector(".c3dSelectionFilter");t&&(t.style.position="absolute"),A.setVisibleFlag(!1),e&&T&&A.setVisibleFlag(!0)}):A&&A.setVisibleFlag(!1)}return function(){t(!!g&&(v&&o.getRoots(v).length>0))}}();if(I&&I.length>8){var P=2,M=parseInt(I.split("-")[0]);y.point="1"===I.charAt(P++)?1:0,y.center="1"===I.charAt(P++)?1:0,y.axisSystem="1"===I.charAt(P++)?1:0,y.line="1"===I.charAt(P++)?1:0,y.plane="1"===I.charAt(P++)?1:0,y.cylinder="1"===I.charAt(P++)?1:0,M&&(y.surface="1"===I.charAt(P++)?1:0),y.product="1"===I.charAt(P++)?1:0,y.point||y.center||y.axisSystem||y.line||y.plane||y.cylinder||y.surface||y.product||(y.none=1),I.length>P&&"-"===I.charAt(P++)&&(T="1"===I.charAt(P))}function x(e){var n=e.pathElement;return e.pathElement=new t,n.externalPath.some(function(t){return e.pathElement.addElement(t),t&&o.is3DLeaf(t)}),n.internalPath.length>0&&(e.originalPathElement=n),e}function L(e){if(!(e&&e.pathElement&&e.pathElement.externalPath.length&&o.isAModelPath(e.pathElement)))return e;if(!g||y.none)return x(e);if(y.axisSystem||y.point||y.center||y.line||y.plane||y.cylinder||y.surface){var t=r.getEquivalentGeometry({pathElement:e.pathElement,viewer:D,nonCanonicGeometry:Boolean(y.surface)}),n=t?t.getType():null;if(y.axisSystem&&n===s.GeometryType.AXISSYSTEM)return e.originalPathElement=e.pathElement,e.pathElement=t.getPathElement(),e.equivalentGeometry=t,e;if(y.point&&n===s.GeometryType.POINT||y.center&&(n===s.GeometryType.CIRCLE||n===s.GeometryType.SPHERE)||y.line&&n===s.GeometryType.LINE||y.plane&&(n===s.GeometryType.PLANE||n===s.GeometryType.REFPLANE)||y.cylinder&&(n===s.GeometryType.CYLINDER||n===s.GeometryType.CONE)||y.surface&&n===s.GeometryType.SURFACE)return e.equivalentGeometry=t,e;if(y.surface&&(n===s.GeometryType.PLANE||n===s.GeometryType.CYLINDER||n===s.GeometryType.CONE||n===s.GeometryType.SPHERE)&&(n=(t=r.getEquivalentGeometry({pathElement:e.pathElement,viewer:D,canonicGeometry:!1,nonCanonicGeometry:!0}))?t.getType():null)===s.GeometryType.SURFACE)return e.equivalentGeometry=t,e}if(y.surface){for(var i,a=e.pathElement.externalPath.length-1;a>=0&&!i;a--)o.isRepReference(e.pathElement.externalPath[a])&&(i=e.pathElement.externalPath[a]);if(i&&!v.getController().hasMeshInRAM(o.getNodeID(i)))return x(e)}return y.product?x(e):(e.originalPathElement=e.pathElement,e.pathElement=null,e)}function _(e){Array.isArray(e)?e.forEach(L):L(e)}function F(){return{point:y.point,center:y.center,line:y.line,axisSystem:y.axisSystem,plane:y.plane,cylinder:y.cylinder,surface:y.surface,product:y.product}}function w(e){d&&d.cancel&&d.cancel(),d=null,e&&e.pickingResult&&e.pickingResult.path&&e.pickingResult.path.length&&(d=c.switchToAV1withMesh({pathElement:e.pickingResult.path[0],pad3DViewer:v,selectionFilter:F(),onComplete:function(){d=null},onFailure:function(){d=null}}))}function O(){if(g){var e=v.getViewer();e.setPicking(p),e.setPrePicking({primitive:S}),i&&e.unsubscribe(i),i=null,n.unsubscribe(g),v.unsubscribe(h),v.unsubscribe(f),g=h=f=null,b(),R.deactivate()}}this.filter={activate:function(e){if(!g){var t=v.getViewer();p={primitive:t.picking.primitive,trapSelection:t.picking.trapSelection,trapPrimitive:t.picking.trapPrimitive,trapGPU:t.picking.trapGPU},S=t.pPicking.primitive,t.setPicking({primitive:1,trapSelection:!0,trapPrimitive:!1,trapGPU:!0}),t.setPrePicking({primitive:1}),e&&e.switchToAV1withMesh&&(i=t.onPreactivate(w)),g=n.onPreAdd(_),h=v.subscribe({event:"onRootAdded"},b),f=v.subscribe({event:"onRootRemoved"},b),b(),y.axisSystem&&R.activate()}},deactivate:O,isActive:function(){return Boolean(g)},display:function(e){"boolean"==typeof e&&e!==T&&(T=e,b())},filterPath:L,switchToAV1withMesh:w,getFiltersState:F},Object.freeze(this.filter),this.unreference=function(){O(),A&&A.clear(),R=A=v=null}}}),p=[];return e.singleton({init:function(){},giveDefaultSelectionFilter:function(e){var t;return e&&e.context&&"ENOPAD3DViewer"===e.context.name&&p.some(function(n){return n.context===e.context&&(t=n.mng.filter,!0)}),t},getDefaultSelectionFilter:function(e){var t;if(e&&e.context&&"ENOPAD3DViewer"===e.context.name&&(p.some(function(n){return n.context===e.context&&(t=n.mng.filter,!0)}),!t)){var n=new S({context:e.context});p.push({context:e.context,mng:n}),t=n.filter}return t},unreferenceDefaultSelectionFilter:function(e){e&&e.context&&p.some(function(t,n){return t.context===e.context&&(t.mng.unreference(),p.splice(n,1),!0)})}})}),define("DS/CAT3DComposeCommands/CAT3DComposeMoveCmd",["DS/ApplicationFrame/Command","DS/Visualization/SceneGraphUtils","DS/CATRelatedData3DGrid/CATRelatedData3DGridController","DS/CAT3DComposeCommands/CATC3DDefaultSelectionFilter","DS/CATW3DAnims/CATW3DAnimation3D","DS/CATW3DBoxes/CATW3DBoxController","DS/ApplicationFrame/CommandsManager","DS/CAT3DComposeCommands/CAT3DComposeCtxMenuAgent","DS/PADUtils/PADContext","DS/CATW3DMoveManager/CATW3DMoveManager","DS/CATW3DCommands/CATW3DCmdsUtils","DS/CATW3DCommands/CATW3DMoveBarUX"],function(e,t,n,i,o,a,r,s,c,l,u,d){"use strict";var m,C,E,S,p,A;return require(["i18n!DS/CAT3DComposeCommands/assets/nls/CAT3DComposeCommands"],function(e){m=e.PositionModifiedSaveOK,C=e.PositionModifiedSaveKO,E=e.singleSplitInstance,S=e.multipleSplitInstance}),require(["DS/Selection/CSOManager"],function(e){p=e}),e.extend({init:function(g){this._parent(g,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var h,f,v,T=this,D=!0,y=!1,I=c.get(),R=I.getCommandContext(),N=l.giveMoveManager({context:I}),b=new s({context:I}),P=i.getDefaultSelectionFilter({context:I}),M=function(){y=!0,D=!1,N.terminateMove({save:!1}),T.end()},x=function(){y=!0,D=!1,N.terminateMove({save:!0}),T.end()},L=function(){N.cancelLocked()},_=!1,F=new e({ID:"CAT3DComposeFakeMoveHdr",mode:"shared",isAsynchronous:!1,context:R}),w=N.subscribe("MoveBegin",function(){if(T.isRunning()){r.getCommand("CAT3DComposeExamineSelectionHdr",R).deactivate();var e=n.give3DGridController({context:I});e&&e.hide3DGrids()}}),O=N.subscribe("Move",function(e){e.objectsMoved.length>0&&"Persistent"===e.moveMode&&e.objectsMoved.forEach(function(e){var t=e.path.getLastElement(!0);u.isPLMInstanceNode(t)&&(T._isRunning||(_=!0,T.begin()),h.showSpinner(),N.isPathLocked({pathElement:e.path,onCompleted:function(e){h&&(h.hideSpinner(),e.isLocked?h.showLock():h.showSave())}}))})}),U=N.subscribe("MoveEnd",function(){if(T.isRunning()){var e=a.getBoxController({context:I});e&&e.setActiveState(!0),r.getCommand("CAT3DComposeExamineSelectionHdr",R).activate();var t=n.give3DGridController({context:I});t&&t.display3DGrids()}_=!1}),k=function(e){var n="success"===e.eventID&&e.objectsMoved.length>0?m:"error"===e.eventID&&e.objectsCancelled.length>0?C:null;n&&I.displayNotification({eventID:e.eventID,msg:n});var i=o.getAnimation3DEngine({viewer:I.getViewer()});if(e&&e.splitInstances&&e.splitInstances.length){I.displayNotification({eventID:"info",msg:e.splitInstances.length>1?S:E});var a=[],r=I.getController(),s=I.getRootBagPath().getLastElement(!0);if(e.splitInstances.forEach(function(e){a=a.concat(t.buildPathesLeadingToNode(r.getNode({id:e.newId}),s).map(function(e){return{path:e}}))}),i.addAnimation({animationType:"opacityOnOff",objectListToAnimate:a,duration:1e3,createOverrideSet:!0}),i.addAnimation({animationType:"color",objectListToAnimate:a,duration:1e3,createOverrideSet:!0,color:"#ff821e"}),p){var c=p.get();c.length&&p.empty(),a.length&&p.add(a.map(function(e){return{pathElement:e.path}})),c.length&&p.empty(),p.add(c)}}e.objectsCancelled&&e.objectsCancelled.length>0&&i.addAnimation({animationType:"cancel",objectListToAnimate:e.objectsCancelled,callBackFct:function(){setTimeout(function(){F.begin()},0)},createOverrideSet:!0}),i.startAnimation(),y&&(N.unsubscribe(f),N.unsubscribe(v))},G=function(e){if(h&&!0===e.bEmptyMove?(h.hideSave(),h.hideLock()):h&&!e.someMovedObjectsAreLocked&&h.hideLock(),e.objectsCancelled&&e.objectsCancelled.length>0){var t=o.getAnimation3DEngine({viewer:I.getViewer()}),n={animationType:"cancel",objectListToAnimate:e.objectsCancelled,callBackFct:function(){setTimeout(function(){F.begin()},0)},createOverrideSet:!0};t.addAnimation(n),t.startAnimation()}else I.getViewer().render();y&&(N.unsubscribe(f),N.unsubscribe(v))},X=function(e){"Enter"!==e.key&&13!==e.keyCode||!1===e.ctrlKey&&!1===e.altKey&&!1===e.shiftKey&&!1===e.metaKey&&(x(),document.removeEventListener("keydown",X))};A||require(["DS/CAT3DComposeDirectMove/CAT3DComposeDirectMove"],function(e){A=e,T.isRunning()&&A.activate({context:I,withSnap:!0,selectionFilter:P})}),this.beginExecute=function(){D=!0,y=!1,(h=new d({uiFrame:I.getFrameWindow().getUIFrame(),onSave:x,onCancel:M,onCancelLocked:L})).show(),b.activate();var e=a.getBoxController({context:I});e&&e.setActiveState(!_);var t=n.give3DGridController({context:I});(t&&t[_?"hide3DGrids":"display3DGrids"](),_)||r.getCommand("CAT3DComposeExamineSelectionHdr",R).activate();A&&A.activate({context:I,withSnap:!0,selectionFilter:P}),P.activate({switchToAV1withMesh:!0}),document.addEventListener("keydown",X),f=N.subscribe("onValidateMove",k),v=N.subscribe("onCancelMove",G)},this.endExecute=function(){document.removeEventListener("keydown",X),require(["DS/CAT3DComposeUtils/CATC3DUtils"],function(e){e._sendUsageProbe("command",D?"MoveCancel":"MoveOK")}),D&&(y=!0,N.terminateMove({save:!1})),h.destroy(),h=null,b.deactivate(),P&&P.deactivate();var e=a.getBoxController({context:I});e&&e.setActiveState(!1);var t=r.getCommand("CAT3DComposeExamineSelectionHdr",R);t&&t.deactivate(),I.getFrameWindow().getContextualUIManager().hideContextualMenus(),A&&A.deactivate({context:I})},this.pauseExecute=function(){var e=a.getBoxController({context:I});e&&e.setActiveState(!1),h.hide(),b.deactivate(),P.deactivate(),r.getCommand("CAT3DComposeExamineSelectionHdr",R).deactivate(),A&&A.deactivate({context:I}),document.removeEventListener("keydown",X)},this.resumeExecute=function(){var e=a.getBoxController({context:I});e&&e.setActiveState(!0),h.show(),b.activate(),P.activate({switchToAV1withMesh:!0}),r.getCommand("CAT3DComposeExamineSelectionHdr",R).activate(),A&&A.activate({context:I,withSnap:!0,selectionFilter:P}),document.addEventListener("keydown",X)},this.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},this.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},this._destroy=function(){Object.getPrototypeOf(this)._destroy.apply(this,arguments),N.unsubscribe(w),N.unsubscribe(O),N.unsubscribe(U),N.unsubscribe(f),N.unsubscribe(v),A&&A.unreference({context:I}),I=N=b=h=f=v=w=O=U=T=null}}})}),define("DS/CAT3DComposeCommands/CAT3DComposeExamineSelection",["UWA/Core","DS/ApplicationFrame/Command","DS/Selection/HSOManager","DS/Selection/CSOManager","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/CATW3DAnims/CATW3DAnimation3D","DS/PADUtils/PADContext","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/PathElement","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATW3DMoveManager/CATW3DMoveManager","DS/LevelSelector/LevelSelector","DS/CATW3DCommands/CATW3DCmdsUtils","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/CAT3DComposeCommands/CATC3DDefaultSelectionFilter","css!DS/CAT3DComposeUI/CAT3DComposeUI.css"],function(e,t,n,i,o,a,r,s,c,l,u,d,m,C,E,S){"use strict";var p=Math.PI/4;function A(e){var t,n,i,o=e&&e.externalPath.length>1;for(t=0;o&&t<e.externalPath.length-1;++t)n=e.externalPath[t],i=e.externalPath[t+1],n.children.indexOf(i)<0&&(o=!1);return o}var g,h,f=function(){var e,t,n,i,o,r;this.store=function(s,c){e=t=n=i=o=r=void 0;var l=c?(new a.Matrix4).extractRotation(c):null;e=s.getEyePosition(),c&&e.applyMatrix4(c),t=s.getUpDirection(),l&&t.applyMatrix4(l),n=s.getSightDirection(),l&&n.applyMatrix4(l),i=s.getTargetDistance(),o=s.getProjectionType(),r=s.getAngle()},this.restore=function(s,c){if(e){var l=c?(new a.Matrix4).extractRotation(c):null;s.moveTo({eyePosition:c?e.applyMatrix4(c):e,upDirection:l?t.applyMatrix4(l):t,sightDirection:l?n.applyMatrix4(l):n,distanceToTarget:i}),s.setProjectionType(o),s.setAngle(r)}}};return f.prototype={constructor:f},Object.freeze(f),t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0}),this.setRepeatMode(!1);var v,T,D,y,I,R,N,b,P,M,x,L,_,F,w,O,U,k,G,X=this,W=s.get(),V=W.getViewer(),Y=W.getController(),B=V.getSceneGraphOverrideSetManager(),H=d.giveMoveManager({context:W}),j=[],q=[],K=[],z={},J=u.getMoveReferentManager({context:W});function Z(){X.canBeEnabled()?X.isEnabled()||X.enable():X.isEnabled()&&!X.isRunning()&&X.disable()}function Q(){q.some(function(e){return"boolean"!=typeof B.getCurrentVisibility(e.path)})&&X.end()}function $(){v=null}function ee(e){if(e&&e.from&&e.from.some(function(e){return e.view.id===V.canvas.id})){var t=e.gesture?e.gesture.getEvents()[0]:e.from[0];if(t&&t.event&&0===t.event.button&&0===t.event.buttons){var n=V.pick(V.getMousePosition(t.getCurrentPosition(V.canvas)),"mesh",!1);n&&n.path&&0!==n.path.length||($(),X.end())}}}require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e){U=e}),g||require(["DS/CAT3DComposeDirectMove/CAT3DComposeDirectMove"],function(e){if(g=e,X.isRunning()){var t=S.giveDefaultSelectionFilter({context:W});t&&g.activate({context:W,withSnap:!0,selectionFilter:t})}}),h||require(["DS/CATC3DNavigation/CATC3DNavigationContoller"],function(e){h=e}),this.canBeEnabled=function(){var e=i.get();return!!(X&&e&&Array.isArray(e))&&(e.length>50||e.some(function(e){if(!e||!e.pathElement||e.pathElement.externalPath.length<2||!E.isAModelPath(e.pathElement))return!1;var t=e.pathElement,n=B.getCurrentVisibilityFree(t);return"boolean"==typeof n&&((!0!==n||B.getCurrentVisibility(t))&&(!t.getBoundingBox(null,V,"visibleSpace").isNaN()||!t.getBoundingBox(null,V,"invisibleSpace").isNaN()))}))};var te,ne=function(){var e=W.getFrameWindow().getViewpoint(),t=new a.Matrix4,n=e.getUpDirection(),i=e.getSightDirection();this.className.search("right")>=0?t.makeRotationAxis(n,p):this.className.search("left")>=0?t.makeRotationAxis(n,-p):this.className.search("top")>=0?t.makeRotationAxis(i.cross(n),-p):t.makeRotationAxis(i.cross(n),p),q.forEach(function(e){e.matrixRotation=t}),D.addAnimation({animationType:"rotate",objectListToAnimate:q.filter(function(e){return e.rotate}),callBackFct:function(){q.forEach(function(e){e.matrixSource=e.override.getPosition()})}}),D.startAnimation()},ie=function(e,t,n,i){var o=[];if(e){var a=e.getKey();-1!==n.indexOf(a)||!0===i.getCurrentVisibilityFree(e)&&!i.getCurrentVisibility(e)||(t.some(function(t){return e.isAParentOf(t)})?e.getChildrenPathes().forEach(function(e){o=o.concat(ie(e,t,n,i))}):o.push(e))}return o},oe=(te=new a.Color,function(){return te.set(V.backgroundColor),255*te.getHSL().l>120?"black":"white"});function ae(){var e=60*Math.sqrt(2),t=W.getViewer(),n=t.SCREEN_WIDTH/2,i=t.SCREEN_HEIGHT/2;z.main.setStyles({top:i+"px",left:n+"px"}),z.right.setStyle("left",n-e-10+"px"),z.left.setStyle("left",-1*n+e+10+"px"),z.top.setStyle("top",-1*i+e+10+"px");var o="true"===W.getFrameWindow().getActionBar().elements.container.getAttribute("data-open")?73:30;z.bottom.setStyle("top",i-e-o+"px")}function re(e){var t;D.forward(),"ArrowLeft"===e.key||37===e.keyCode?t=z.left:"ArrowUp"===e.key||38===e.keyCode?t=z.top:"ArrowRight"===e.key||39===e.keyCode?t=z.right:"ArrowDown"!==e.key&&40!==e.keyCode||(t=z.bottom),t&&(t.addClassName("active"),ne.call(t))}function se(e){var t;"ArrowLeft"===e.key||37===e.keyCode?t=z.left:"ArrowUp"===e.key||38===e.keyCode?t=z.top:"ArrowRight"===e.key||39===e.keyCode?t=z.right:"ArrowDown"!==e.key&&40!==e.keyCode||(t=z.bottom),t&&t.removeClassName("active")}function ce(){q.length&&(F||(F=new l(q[0].path.externalPath)),A(F)?(O=new f).store(W.getFrameWindow().getViewpoint(),(new a.Matrix4).getInverse(F.getWorldMatrix())):F=O=null)}function le(e){X.deactivate();var t=S.giveDefaultSelectionFilter({context:W});t&&(g&&!e&&g.deactivate({context:W}),e||t.deactivate()),W.setRobotVisibility(T),U&&window.widget&&"true"===window.widget.getValue("changeControlActivation")&&U.show(),o.removeEvent(V.canvas,"onPrimaryPointerClick",ee),b&&(H.unsubscribe(b),b=void 0),!e&&N&&(H.unsubscribe(N),N=void 0),K.forEach(function(e){W.unsubscribe(e)}),K=[],m.destroyView(),z.main&&z.main.hide(),x&&W.getViewer().unsubscribe(x);var n=W.getFrameWindow().getActionBar();L&&n.removeCallback(L),_&&n.removeCallback(_),x=L=_=void 0,document.removeEventListener("keydown",re),document.removeEventListener("keyup",se)}function ue(){ce(),q=[],$(),le(!0);var e=W.getViewer();e.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(y),y=I=null,e.render(),w.restore(W.getFrameWindow().getViewpoint())}function de(){X.activate();var e=S.giveDefaultSelectionFilter({context:W});e&&g&&h&&!h.isNavigationActivated({context:W})&&g.activate({context:W,withSnap:!0,selectionFilter:e}),e&&e.activate({switchToAV1withMesh:!0}),W.getFrameWindow().getContextualUIManager().hideContextualMenus(),T=W.isRobotVisible(),W.setRobotVisibility(!1),U&&U.hide(),o.addEvent(V.canvas,"onPrimaryPointerClick",ee),b=H.subscribe("Move",ue),N=H.subscribe("MoveEnd",X.end.bind(X)),["onRootRemoved","onRootDetached","onAuthoringTransactionEnd","onEndDelete"].forEach(function(e){K.push(W.subscribe({event:e},Q))}),function(e){if(e){var t,o=J.getMoveReferent(e)||e,a=o.getLastElement(!0);if(C.isPLMInstanceNode(a)){a&&a.children.length&&o.addElement(a.children[0]);var r={display:{type:"docked",marginW:10,marginH:10},background:V,disableKeyboard:!0,displayWhileViewpointIsManipulated:!0,uiFrame:W.getFrameWindow().getUIFrame(),getLevels:function(t){var n=C.getLevelSelectorLevels({pathElement:e,pathElementCurrent:o,onInfoCompleted:t,context:W});if(n){n.selectColor="#ff821e",n.selectOverColor="#ffb477";for(var i=n.levels.length-1;i>=0;--i){var a=n.levels[i];C.isPLMReferenceNode(a.pathElement.getLastElement(!0))&&J.getMoveReferent(a.pathElement)||(a.selection="notSelectable")}}return n},onHover:function(e){I&&(I.setColor(oe(),!1),I.setOpacity(.05,!1),I.setVisibility(!0),I.setVisibilityFree(null)),(t=y.createOverride({pathes:[o]})).setColor(16744448,!0),t.setOpacity(1,!0),V.render(),n.empty(),n.add(e)},onLeave:function(){I&&(I.setColor(null,null),I.setOpacity(null,null),I.setVisibility(!1),I.setVisibilityFree(!0)),y.deleteOverride(t),t=null,V.render(),n.empty(),n.add(i.get())},onSelect:function(n){if(n&&n.pathElement&&J){if(J.addMoveReferent(n.pathElement),y.deleteOverride(t),t=null,!(o=J.getMoveReferent(e)))return;(a=o.getLastElement(!0))&&a.children.length&&o.addElement(a.children[0]),(t=y.createOverride({pathes:[o]})).setColor(16744448,!0),t.setOpacity(1,!0),V.render()}}};m.createView(r)}}}(1===q.length?q[0].path:null),z.main.show(),ae(),x=V.onViewerResize(ae);var t=W.getFrameWindow().getActionBar();L=t.onActionBarOpen(ae),_=t.onActionBarClose(ae),document.addEventListener("keydown",re),document.addEventListener("keyup",se)}k=function(e){" "!==e.key&&"Spacebar"!==e.key&&32!==e.keyCode||!1===e.ctrlKey&&!1===e.altKey&&!1===e.shiftKey&&!1===e.metaKey&&(document.removeEventListener("keypress",k),document.addEventListener("keyup",G),0===q.length?X.begin():X.end())},G=function(e){" "!==e.key&&"Spacebar"!==e.key&&32!==e.keyCode||(document.removeEventListener("keyup",G),document.addEventListener("keypress",k))},this.execute=function(){(R=E.getRoots(W).map(E.getNodeID,E).some(Y.isLargeDataStructure,Y))&&Y.pauseProgressiveLoading(),(w=new f).store(W.getFrameWindow().getViewpoint()),W.getFrameWindow().getActionBar().close(),D=r.getAnimation3DEngine({viewer:V}),q=[],y=new c(W.getRootBagPath().externalPath[0]),B.pushSceneGraphOverrideSet(y);var t=[],o=[],s=new a.Box3,u=V.getVisibleSpace();if(v=[],i.get().forEach(function(e){v.push(e);for(var n=new l(e.pathElement.externalPath);n&&!C.isPLMNode(n.getLastElement(!0));)n=n.getParentPath();if(n&&n.externalPath.length&&(!1===B.getCurrentVisibilityFree(n)||"boolean"==typeof B.getCurrentVisibility(n))){var i=n.getParentPath().getWorldMatrix(),r=(new a.Matrix4).getInverse(i),c=n.getMatrix(),d={path:n,override:y.createOverride({pathes:[n]}),matrixSource:c,matrixParent:i,matrixParentInv:r,rotate:!0},m=u?n.getBoundingBox(null,V,"visibleSpace"):n.getBoundingBox(null,V,"invisibleSpace");m&&!m.isNaN()?(m.applyMatrix4(n.getWorldMatrix()),s.union(m)):d.rotate=!1,q.push(d),t.push(n),o.push(n.getKey())}}),t.length>0){var d=s.center();q.forEach(function(e){e.centerRotation=(new a.Vector3).copy(d).applyMatrix4(e.matrixParentInv)});var m=!1;F&&(F.isEqual(new l(t[0].externalPath))&&A(F)||(O=F=null)),O||(m=!0);var S=ie(W.getRootBagPath(),t,o,B);I=y.createOverride({pathes:S}),D.addAnimation({animationType:"mask",objectListToAnimate:[{override:I}],callBackFct:function(){m?W.getFrameWindow().getViewpoint().reframe(null,0,s.getBoundingSphere()):O&&(O.restore(W.getFrameWindow().getViewpoint(),F.getWorldMatrix()),O=null)}}),D.startAnimation();z.main=e.createElement("div",{id:"C3D-viewpoint"}).inject(W.getFrameWindow().getUIFrame()),["left","top","right","bottom"].forEach(function(t){var n=new e.createElement("div",{class:t}).inject(z.main);n.addEvents({click:ne}),new e.createElement("div",{class:"background"}).inject(n);var i=new e.createElement("div",{class:"arrow"}).inject(n);new e.createElement("div",{class:"borderBottom"}).inject(i),new e.createElement("div",{class:"borderRight"}).inject(i),z[t]=n}),de(),n.empty(),i.empty(),require(["DS/CAT3DComposeUtils/CATC3DUtils"],function(e){e._sendUsageProbe("command","ExamineSelection")})}else X.end()},this.endExecute=function(){if(ce(),q=[],le(),z.main&&z.main.destroy(),z={},y){var e=W.getViewer();e.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(y),y=I=null,e.render(),W.getFrameWindow().getActionBar().open(),w.restore(W.getFrameWindow().getViewpoint())}v&&v.length&&0===i.get().length&&(n.empty(),i.empty(),v.filter(function(e){return"boolean"==typeof B.getCurrentVisibility(e.pathElement)}).length&&(n.add(v),i.add(v)));$(),R&&Y.resumeProgressiveLoading(),R=!1},this.pauseExecute=function(){le(!1)},this.resumeExecute=function(){de(),n.empty(),i.empty();var e=new a.Box3,t=V.getVisibleSpace();q.forEach(function(n){var i=n.path,o=t?i.getBoundingBox(null,V,"visibleSpace"):i.getBoundingBox(null,V,"invisibleSpace");o&&!o.isNaN()?(o.applyMatrix4(i.getWorldMatrix()),e.union(o),n.rotate=!0):n.rotate=!1});var o=e.center();q.forEach(function(e){e.centerRotation=(new a.Vector3).copy(o).applyMatrix4(e.matrixParentInv)})},this.activate=function(){X&&(X.enable(),document.addEventListener("keypress",k),0===j.length&&(j.push(i.onPostAdd(Z)),j.push(i.onPostRemove(Z))),P||(P=W.subscribe({event:"onShow"},Z)),M||(M=W.subscribe({event:"onHide"},Z)),Z())},this.deactivate=function(){X&&(document.removeEventListener("keypress",k),document.removeEventListener("keyup",G),j.forEach(function(e){i.unsubscribe(e)}),W.unsubscribe(P),W.unsubscribe(M),j.length=0,P=M=null,this.isRunning()||this.disable())},this.disable(),this.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},this.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},this._destroy=function(){X&&(X.deactivate(),g&&g.unreference({context:W}),Object.getPrototypeOf(this)._destroy.apply(this,arguments),X=W=Y=V=B=null)}}})}),define("DS/CAT3DComposeCommands/CAT3DComposeWidgetDefaultCmd",["DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/CATW3DBoxes/CATW3DBoxController","DS/CATRelatedData3DGrid/CATRelatedData3DGridController","DS/CATW3DMoveManager/CATW3DMoveReferent","DS/CATRelatedDataLauncher/CATRelatedDataController","DS/CAT3DComposeCommands/CAT3DComposeCtxMenuAgent","DS/PADUtils/PADContext","DS/CATW3DMoveManager/CATW3DMoveManager","DS/CAT3DComposeCommands/CATC3DDefaultSelectionFilter","DS/CATW3DRobot/CATW3DRobot","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager"],function(e,t,n,i,o,a,r,s,c,l,u,d,m,C){"use strict";var E;return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var S=this,p=!1,A=s.get(),g=A.getCommandContext(),h=new r({context:A}),f=n.getBoxController({context:A}),v=c.giveMoveManager({context:A}),T=C.getSelectionManager({context:A}),D=l.getDefaultSelectionFilter({context:A}),y=u.getMove3DRobot({context:A}),I=[],R=[];function N(){if(S.isRunning()){var e=i.give3DGridController({context:A});e&&e.hide3DGrids(),S&&S.isRunning()&&(D&&D.activate(),T&&T.setActiveState(!1)),f&&f.setActiveState(!1)}}function b(){if(S.isRunning()){var e=i.give3DGridController({context:A});e&&e.display3DGrids(),S&&S.isRunning()&&D&&!y.hasTarget()&&(D.deactivate(),T&&T.setActiveState(!0)),f&&f.setActiveState(!0)}}E||require(["DS/CAT3DComposeDirectMove/CAT3DComposeDirectMove"],function(e){E=e,S.isRunning()&&(E.activate({context:A,withSnap:!0,selectionFilter:D}),R.length||(R.push(E.subscribe("onDirectMoveBegin",N)),R.push(E.subscribe("onDirectMoveEnd",b))))}),y.setSelectionFilter(D),D.deactivate(),I.push(y.subscribe("onRobotMoveBegin",N)),I.push(y.subscribe("onRobotMoveEnd",b));var P=[];function M(){P.length>0||(P.push(v.subscribe("MoveBegin",function(){t.getCommand("CAT3DComposeExamineSelectionHdr",g).deactivate()})),P.push(v.subscribe("Move",function(){var e=a.giveDataLauncherController({context:A});e&&e.setVisibility(!1)})),P.push(v.subscribe("MoveEnd",function(){var e=a.giveDataLauncherController({context:A});e&&e.setVisibility(!0),t.getCommand("CAT3DComposeExamineSelectionHdr",g).activate()})))}function x(){P.forEach(function(e){v.unsubscribe(e)}),P=[]}var L=d.givePreferenceManager({context:A.getFrameWindow()}),_=[];L.addPreferences(o.getPreferencesDefinition()),L.setUnitsPreferencesDisplayFlag(!0),L.setDisplayPreferencesDisplayFlag(!0),L.set3DSelectionPreferencesDisplayFlag(!0),L.setPreferredPreferenceContainersOrder(["W3MprefMove","MeasurePreferences","SectionPreferences"]),_.push(L.subscribe("CATWebUXPreferences_GravitationalEffects",function(e){var t=A?A.getViewer():null;t&&t.currentViewpoint&&t.currentViewpoint.control&&(t.currentViewpoint.getControl().setRotationRolling(!e),t.currentViewpoint.getControl().setRollingForTouchAvailable(!e))})),_.push(L.subscribe("CATWebUXPreferences_ProjectionType",function(e){var t=A?A.getViewer():null;t&&t.currentViewpoint&&t.currentViewpoint.setProjectionType(e)})),_.push(L.subscribe("CATWebUXPreferences_Select3DGeometry",function(e){T.setPicking(e?0:1)})),_.CATWebUXPreferences_SelectParentReferenceOr3DShape=L.subscribe("CATWebUXPreferences_SelectParentReferenceOr3DShape",function(e){T&&T.selectParentReference("select3DShape"!==e)});var F=m.getPreference("CATWebUXPreferences_GravitationalEffects","boolean");"boolean"==typeof F&&(A.getViewer().currentViewpoint.getControl().setRotationRolling(!F),A.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!F));var w=m.getPreference("CATWebUXPreferences_ProjectionType","int");0!==w&&1!==w||A.getViewer().currentViewpoint.setProjectionType(w),T.setPicking(m.getPreference("CATWebUXPreferences_Select3DGeometry","boolean")?0:1);let O=m.getPreference("CATWebUXPreferences_SelectParentReferenceOr3DShape","string");T&&T.selectParentReference("select3DShape"!==O),this.execute=function(){if(A&&!p){h.activate(),f.setActiveState(!0);var e=a.giveDataLauncherController({context:A});e&&e.setActiveState(!0),E&&E.activate({context:A,withSnap:!0,selectionFilter:D}),D&&D.deactivate(),t.getCommand("CAT3DComposeExamineSelectionHdr",g).activate(),M()}},this.beginExecute=function(){A&&(T.setActiveState(!0),A.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0}))},this.endExecute=function(){if(A){h.deactivate(),f.setActiveState(!1);var e=a.giveDataLauncherController({context:A});e&&e.setActiveState(!1),E&&E.deactivate({context:A}),T.setActiveState(!1);var n=t.getCommand("CAT3DComposeExamineSelectionHdr",g);n&&n.deactivate(),x()}},this.pauseExecute=function(){h.deactivate(),f.setActiveState(!1);var e=a.giveDataLauncherController({context:A});e&&e.setActiveState(!1),E&&E.deactivate({context:A}),D&&D.deactivate(),T.setActiveState(!1),t.getCommand("CAT3DComposeExamineSelectionHdr",g).deactivate(),x()},this.resumeExecute=function(){if(A){D&&y.hasTarget()?(D.activate(),T.setActiveState(!1)):T.setActiveState(!0),A.getViewer().setPicking({trapSelection:!0,trapPrimitive:!1,trapGPU:!0}),h.activate(),f.setActiveState(!0);var e=a.giveDataLauncherController({context:A});e&&e.setActiveState(!0),E&&E.activate({context:A,withSnap:!0,selectionFilter:D}),t.getCommand("CAT3DComposeExamineSelectionHdr",g).activate(),M()}},this.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},this.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},this._destroy=function(){x(),I.forEach(y.unsubscribe,y),R.forEach(y.unsubscribe,R),E&&(R.forEach(E.unsubscribe,R),E.unreference({context:A})),p=!0,_.forEach(L.unsubscribe,L),l.unreferenceDefaultSelectionFilter({context:A}),C.unreferenceSelectionManager({context:A}),Object.getPrototypeOf(this)._destroy.apply(this,arguments),S=D=A=h=f=v=y=L=_=T=null}}})}),
/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DComposeCommands/CATC3DPathElementAgentWithFilter",["DS/StateCommandEngine/PathElementAgent","DS/CATW3DGeometry/CATW3DEquivalentGeometry","DS/CATW3DGeometry/CATW3DGeometryEnums","DS/Web3DUXFilterBar/Web3DUXFilterBar","DS/CAT3DComposeCommands/CATC3DAxisSystemDisplayAgent","DS/WebappsUtils/WebappsUtils","DS/Selection/CSOManager","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","i18n!DS/CAT3DComposeCommands/assets/nls/CAT3DComposeCommands"],function(e,t,n,i,o,a,r,s,c){"use strict";var l;return e.extend({_frameWindow:null,_filterUI:null,_activeFilters:null,_filtersEnum:null,_postFilter:null,_axisAgent:null,geometryTypesEnum:{POINT:n.GeometryType.POINT,LINE:n.GeometryType.LINE,CIRCLE:n.GeometryType.CIRCLE,PLANE:n.GeometryType.PLANE,CYLINDER:n.GeometryType.CYLINDER,CONE:n.GeometryType.CONE,SPHERE:n.GeometryType.SPHERE,REFERENCE:10,AXISSYSTEM:n.GeometryType.AXISSYSTEM,AXISSYSTEMAXIS:n.GeometryType.AXISSYSTEMAXIS,AXISSYSTEMORIGIN:n.GeometryType.AXISSYSTEMORIGIN},init:function(e){var i,r=a.getWebappsAssetUrl("DMUBaseCommands","icons/32/"),u=a.getWebappsAssetUrl("CAT3DComposeCommands","icons/32/");return this._preselection=!0,l=this,e.context?(this._frameWindow=e.context.getFrameWindow(),this._axisAgent=new o({context:e.context}),this._activeFilters=e.activeFilters||{POINT:1,CENTER:1,CIRCLE:1,AXISSYSTEM:1,AXISSYSTEMAXIS:1,AXISSYSTEMORIGIN:1,LINE:1,PLANE:1,CYLINDER:1,REFERENCE:1},this._postFilter=e.postFilter,this._filtersEnum={POINT:{type:"element",id:"POINT",nls:c.point,url:r+"I_Meas_Point.png",callback:function(){l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.POINT},CENTER:{type:"element",id:"CENTER",nls:c.center,url:r+"I_Meas_PointCircle.png",callback:function(){l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.CENTER},CIRCLE:{type:"element",id:"CIRCLE",nls:c.circle,url:r+"I_WebMarkerCircle.png",callback:function(){l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.CIRCLE},AXISSYSTEM:{type:"element",id:"AXISSYSTEM",nls:c.axisSystem,url:u+"I_3DComposeAxisSystem.png",callback:function(){l._lastClicked="AXISSYSTEM",l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.AXISSYSTEM},AXISSYSTEMAXIS:{type:"element",id:"AXISSYSTEMAXIS",nls:c.axisSystemAxis,url:u+"I_C3DAxisAxis.png",callback:function(){l._lastClicked="AXISSYSTEMAXIS",l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.AXISSYSTEMAXIS},AXISSYSTEMORIGIN:{type:"element",id:"AXISSYSTEMORIGIN",nls:c.axisSystemOrigin,url:u+"I_C3DAxisOrigin.png",callback:function(){l._lastClicked="AXISSYSTEMORIGIN",l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.AXISSYSTEMORIGIN},LINE:{type:"element",id:"LINE",nls:c.line,url:r+"I_Meas_Line.png",callback:function(){l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.LINE},PLANE:{type:"element",id:"PLANE",nls:c.plane,url:r+"I_Meas_Plane.png",callback:function(){l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.PLANE},CYLINDER:{type:"element",id:"CYLINDER",nls:c.cylinder,url:r+"I_Meas_Cylinder.png",callback:function(){l.updateFilters()},bexclude:!1,bstateActif:l._activeFilters.CYLINDER},REFERENCE:{type:"element",id:"REFERENCE",nls:c.reference,url:r+"I_Meas_Product.png",callback:function(){l.updateFilters()},bexclude:!0,bstateActif:l._activeFilters.REFERENCE}},(i={agentId:"CAT3DComposeAssemblyPatternSelect",frameWindow:this._frameWindow,withPrevaluation:!1,engWithPSOHSO:!1,withPSO:!0,withHSO:!1,valuedFromCSO:!1,saveToCSO:!1,multiAcquisition:!1,multiAcquisitionCtrl:!1,pickingMode:"primHybrid",prePickingMode:"primHybrid",withUndoStep:!1}).prePickingFilter=i.pickingFilter=function(i){var o,a,r=!1,c=0,u=t.getEquivalentGeometry({pathElement:i,axisSystemSub:!l._activeFilters.AXISSYSTEM,axisSystemOrigin:!l._activeFilters.AXISSYSTEMORIGIN,viewer:e.context.getViewer()}),d=u?u.getType():null;if((l._activeFilters.AXISSYSTEM||l._activeFilters.AXISSYSTEMAXIS||l._activeFilters.AXISSYSTEMORIGIN)&&l._axisAgent.analyze({pathElement:i}),(1===l._activeFilters.AXISSYSTEM&&d===l.geometryTypesEnum.AXISSYSTEM||1===l._activeFilters.AXISSYSTEMAXIS&&d===l.geometryTypesEnum.AXISSYSTEMAXIS||1===l._activeFilters.AXISSYSTEMORIGIN&&d===l.geometryTypesEnum.AXISSYSTEMORIGIN)&&(u&&(a=u.getPathElement())&&(i.internalPath=a.internalPath,i.externalPath=a.externalPath),r=!0),!r&&(1===l._activeFilters.POINT&&d===l.geometryTypesEnum.POINT||1===l._activeFilters.CENTER&&(d===l.geometryTypesEnum.CIRCLE||d===l.geometryTypesEnum.SPHERE)||1===l._activeFilters.CIRCLE&&d===l.geometryTypesEnum.CIRCLE||1===l._activeFilters.LINE&&d===l.geometryTypesEnum.LINE||1===l._activeFilters.PLANE&&(d===l.geometryTypesEnum.PLANE||n.GeometryType.REFPLANE)||1===l._activeFilters.CYLINDER&&(d===l.geometryTypesEnum.CYLINDER||d===l.geometryTypesEnum.CONE))&&(r=!0),!r&&1===l._activeFilters.REFERENCE)for(c=i.externalPath.length-1;c>=0;--c)if((o=i.externalPath[c])&&s.isReference(o)){i.setFromArray(i.externalPath.slice(0,c+1)),r=!0;break}return r&&"function"==typeof l._postFilter&&(r=l._postFilter(i)),r},this._parent(i),this.updateFilters(),null):null},activate:function(){var e=r.get();this._parent(),this._preselection&&e.length>0&&(this._preselection=!1,this.object3D=[],this.options.pickingFilter(e[0].pathElement)&&(this.object3D.push(e[0]),this._modelEvents.publish({event:this._agentId,data:this.object3D}))),this.updateFilters()},deactivate:function(){this._filterUI&&(this._filterUI.clear(),this._filterUI.destroy(),this._filterUI=null),l._axisAgent.deactivate(),this._parent()},getSelType:function(e){var n=t.getEquivalentGeometry({pathElement:e,axisSystemSub:!l._activeFilters.AXISSYSTEM}),i=n?n.getType():null;return e&&e.externalPath&&s.isAModelPath(e)?!i&&0===e.internalPath.length&&e.externalPath.some(function(e){return e&&s.isReference(e)})?this.geometryTypesEnum.REFERENCE:"number"==typeof i?i:null:null},getActiveFilters:function(){return this._activeFilters},updateFilters:function(e,t){var n,o,a,r=!1,s=[];if("boolean"!=typeof t&&(t=!0),e&&"object"==typeof e){for(n in l._activeFilters={},e)e.hasOwnProperty(n)&&l._filtersEnum.hasOwnProperty(n)&&(l._activeFilters[n]=e[n],1!==l._activeFilters[n]&&(l._activeFilters[n]=0));r=!0}if(l._filterUI&&t)for(o in l._activeFilters)l._activeFilters.hasOwnProperty(o)&&(l._activeFilters[o]=l._filterUI.getActiveState(o)?1:0);if(l._lastClicked&&1===l._activeFilters[l._lastClicked]&&(l._activeFilters.AXISSYSTEM&&(l._activeFilters.AXISSYSTEM=0),l._activeFilters.AXISSYSTEMAXIS&&(l._activeFilters.AXISSYSTEMAXIS=0),l._activeFilters.AXISSYSTEMORIGIN&&(l._activeFilters.AXISSYSTEMORIGIN=0),l._activeFilters[l._lastClicked]=1,r=!0),l._lastClicked=null,l._activeFilters.AXISSYSTEM||l._activeFilters.AXISSYSTEMAXIS||l._activeFilters.AXISSYSTEMORIGIN?l._axisAgent.activate({type:"HSO",noPSOcb:!0}):l._axisAgent.deactivate(),r&&l._filterUI&&(l._filterUI.clear(),l._filterUI.destroy(),l._filterUI=null),!l._filterUI){for(o in l._activeFilters)l._activeFilters.hasOwnProperty(o)&&l._filtersEnum.hasOwnProperty(o)&&((a=l._filtersEnum[o]).bstateActif=l._activeFilters[o],s.push(a));l._filterUI=new i({body:l._frameWindow.getUIFrame(),frmWindow:l._frameWindow,Idpanel:"c3dPatternSelectionFilter",typeSeparator:"bubble",lJsonElement:s}),l._filterUI.build(),l._viewer.render()}}})}),
/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DComposeCommands/CAT3DComposeAssemblyPatternCmd",["DS/StateCommandEngine/StateCommand","DS/CoreEvents/Events","DS/CATWebUXComponents/CATWebUXNotifBar","DS/FlagPanel/FlagPanel","DS/FlagPanel/FlagPanelEnums","DS/FlagPanel/FlagPanelManager","DS/PADUtils/PADContext","DS/CATW3DGeometry/CATW3DEquivalentGeometry","DS/CAT3DComposeCommands/CATC3DPathElementAgentWithFilter","DS/Selection/HSOManager","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/CAT3DComposeUtils/CATC3DUtils","DS/WebappsUtils/WebappsUtils","DS/SceneGraphNodes/AxisSystemNode","DS/CATW3DAnims/CATW3DAnimation3D","DS/Mesh/Mesh","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","i18n!DS/CAT3DComposeCommands/assets/nls/CAT3DComposeAssemblyPatternCmd","css!DS/UIKIT/UIKIT"],function(e,t,n,i,o,a,r,s,c,l,u,d,m,C,E,S,p,A,g,h){"use strict";return e.extend({init:function(e){var f,v,T,D,y,I,R,N,b,P=this,M=this.beginExecute,x=this.endExecute,L=0,_=r.get(),F=_.getFrameWindow(),w=_.getViewer(),O=!1,U=!1,k={},G={},X="NOPATTERN",W=!0,V="LINEAR",Y="LINEAR",B={count:2,spacing:50,angle:30,reverse:!1},H={count:2,spacing:50,angle:30,reverse:!1},j={NOPATTERN:{REFERENCE:1,POINT:0,CENTER:0,LINE:0,CYLINDER:0,AXISSYSTEM:0,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:0},NOPATTERN_LINEAR:{POINT:1,CENTER:1,LINE:1,CYLINDER:1,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:1},NOPATTERN_RECTANGULAR:{POINT:1,CENTER:1,LINE:1,CYLINDER:1,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:1},NOPATTERN_CIRCULAR:{POINT:1,CENTER:1,LINE:1,CYLINDER:1,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:1},NOPATTERN_USERDEFINED:{POINT:1,CENTER:1,AXISSYSTEM:1},LINEAR:{POINT:1,CENTER:1,LINE:1,CYLINDER:1,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:1},RECTANGULAR:{POINT:1,CENTER:1,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:1},CIRCULAR:{POINT:1,CENTER:1,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:1},USERDEFINED:{POINT:1,CENTER:1,AXISSYSTEM:1}},q={NOPATTERN:["POINT","CENTER","LINE","CYLINDER","AXISSYSTEM","AXISSYSTEMORIGIN","AXISSYSTEMAXIS","REFERENCE"],NOPATTERN_LINEAR:["POINT","CENTER","LINE","CYLINDER","AXISSYSTEMORIGIN","AXISSYSTEMAXIS"],NOPATTERN_RECTANGULAR:["POINT","CENTER","LINE","CYLINDER","AXISSYSTEMORIGIN","AXISSYSTEMAXIS"],NOPATTERN_CIRCULAR:["POINT","CENTER","LINE","CYLINDER","AXISSYSTEMORIGIN","AXISSYSTEMAXIS"],NOPATTERN_USERDEFINED:["POINT","CENTER","AXISSYSTEM"],LINEAR:["POINT","CENTER","LINE","CYLINDER","AXISSYSTEMORIGIN","AXISSYSTEMAXIS"],RECTANGULAR:["POINT","CENTER","AXISSYSTEMORIGIN","AXISSYSTEMAXIS"],CIRCULAR:["POINT","CENTER","AXISSYSTEMORIGIN","AXISSYSTEMAXIS"],USERDEFINED:["POINT","CENTER","AXISSYSTEM"]},K=new a(w),z=function(e){return e===R.geometryTypesEnum.POINT||e===R.geometryTypesEnum.CIRCLE||e===R.geometryTypesEnum.AXISSYSTEM||e===R.geometryTypesEnum.AXISSYSTEMORIGIN},J=function(){var e={version:3,reuse:W,radioPattern:Y,direction1:B,direction2:H,filters:j};e.reuse=!0,localStorage.setItem("CAT3DComposeAssemblyPatternCmd",JSON.stringify(e))},Z=function(e,n,i,o){var a;i=void 0===i||i,o=void 0===o||o,K.removeFlag(v[e]),v[e].destroy(),delete v[e],e!==U&&o&&delete k[e],e===D?(D=null,y&&(B.count=H.count,B.spacing=H.spacing,B.reverse=H.reverse,v[y].destroy(),delete v[y],D=y,y=null)):e===y?y=null:e===O&&(n&&"NOPATTERN"===n&&(a="NOPATTERN",U&&(a=a+"_"+Y),j[a]=R.getActiveFilters(),X=null),w.removeNode(I),O=null),R.object3D[0]=null,i&&t.publish({event:"C3D_UNSELECT_EVT"})},Q=function(e){var t,n,i,o,a,r,s=0,c=function(e){var t,n,i={bReference:Boolean(U),bOrigin:Boolean(O),typesCount:{}};for(t in R.geometryTypesEnum)R.geometryTypesEnum.hasOwnProperty(t)&&(i.typesCount[R.geometryTypesEnum[t]]=0);for(t in k)k.hasOwnProperty(t)&&t!==O&&t!==U&&i.typesCount[k[t].type]++;return R.object3D[0]&&!k[R.object3D[0].pathElement.getKey()]&&(n=R.getSelType(R.object3D[0].pathElement),U||n!==R.geometryTypesEnum.REFERENCE?!O&&z(n)?i.bOrigin=!0:!O&&e!==N.USERDEFINED.id&&z(n)||i.typesCount[n]++:i.bReference=!0),i}(e.stateID);if(!c||!c.bReference)return!1;for(s=0,a=(o=Object.keys(c.typesCount)).length,i=e.validTypes.length,t=0;t<a;++t)if(c.typesCount[o[t]]>0){for(r=!1,n=0;n<i;++n)if(o[t]===e.validTypes[n].type.toString()&&!(e.validTypes[n].maxcount&&c.typesCount[o[t]]>e.validTypes[n].maxcount)){s+=c.typesCount[o[t]],r=!0;break}if(!r)return!1}return e.stateID===N.USERDEFINED.id&&c.bOrigin&&s++,e.stateID===N.CIRCULAR.id&&c.bOrigin&&0===s&&s++,e.validSelCount>-1&&s===e.validSelCount||-1===e.validSelCount&&s>0},$=function(e,t,n){var i=new u.Vector3;return e.type===R.geometryTypesEnum.POINT?i.subVectors(e.canonicGeom.getPoint(),t.position):e.type===R.geometryTypesEnum.LINE?i.subVectors(e.canonicGeom.getEndPoints().endPoint,e.canonicGeom.getEndPoints().beginPoint):e.type===R.geometryTypesEnum.CIRCLE?i.subVectors(e.canonicGeom.getCenter(),t.position):e.type===R.geometryTypesEnum.CYLINDER?i.subVectors(e.canonicGeom.getEndPoints().endPoint,e.canonicGeom.getEndPoints().beginPoint):e.type===R.geometryTypesEnum.AXISSYSTEM||e.type===R.geometryTypesEnum.AXISSYSTEMORIGIN?i.subVectors(e.position,t.position):e.type===R.geometryTypesEnum.AXISSYSTEMAXIS&&(i=e.canonicGeom.getDirection()),n?i.normalize():i},ee=function(e){var t,n,i;if(!e.getParentPath)return null;for(i=(n=e.getParentPath().clone()).getLength()-1;i>=0;--i)if((t=n.externalPath[i])&&g.isReference(t))return n.setFromArray(n.externalPath.slice(0,i+1)),n;return null},te=function(e){G.hasOwnProperty(e)&&(G[e].pRefParent.getLastElement().removeChild(G[e].node),delete G[e],L--),w.render()},ne=function(){var e;if(G)for(e in G)G.hasOwnProperty(e)&&te(e)},ie=function(e,t,n){var i,o,a,r,s;return a=t.clone(),(s=t.getWorldMatrix()).getInverse(s),(i=new u.Matrix4).multiplyMatrices(s,n),(o=new d("PreviewNode"+ ++L)).setMatrix(i),o.addChild(e.pathElement.getLastElement()),t.getLastElement().addChild(o),a.addElement(o),r=a.getKey(),G[r]={node:o,activated:!0,pathElement:a,pRefParent:t},r},oe=function(e,t,n){var o={position:(new u.Matrix4).setPosition(k[e].position),iconUrl:k[e].iconUrl?k[e].iconUrl:"",closeButton:!0,closeCB:function(){Z(e,n)}};v[e]=new i(w,o),t&&v[e].setOffset(t),K.addFlag(v[e])},ae=function(e,n,a,r,s){var c={position:k[n].clickPos?(new u.Matrix4).setPosition(k[n].clickPos):new u.Matrix4,label:a,iconUrl:k[n].iconUrl?k[n].iconUrl:"",closeButton:!0,closeCB:function(){Z(n,e)},dialogs:[{type:o.fieldsTypeEnum.INTEGER,value:r.count,suffix:h.SUFFIX_INSTANCES,fnCallback:function(e){r.count=parseInt(e),t.publish({event:"C3D_PARAMETERS_CHG"})}},{type:o.fieldsTypeEnum.DOUBLE,prefix:h.PREFIX_SPACING,value:"CIRCULAR"===e?r.angle:r.spacing,suffix:"CIRCULAR"===e?"°":"mm",fnCallback:function(n){"CIRCULAR"===e?r.angle=parseInt(n):r.spacing=parseInt(n),t.publish({event:"C3D_PARAMETERS_CHG"})}},{type:o.fieldsTypeEnum.BOOLEAN,iconUrl:E.getWebappsAssetUrl("CAT3DComposeCommands","icons/32/")+"I_C3DReverseDirection.png",value:r.reverse,fnCallback:function(e){r.reverse=e,t.publish({event:"C3D_PARAMETERS_CHG"})}}]};v[n]=new i(w,c),s&&v[n].setOffset(s),K.addFlag(v[n])},re=function(e){var n,a,r,s,c,l,d,m,C,g,f,T,b="NOPATTERN"===e?Y:e,P={};for(a in v)v.hasOwnProperty(a)&&(P[a]=v[a].getOffset(),K.removeFlag(v[a]),v[a].destroy(),delete v[a]);if(I&&w.removeNode(I),U){for(l=function(){var e,t=[];for(e in N)(N[e].conditions&&Q(N[e].conditions)||U&&O&&2===Object.keys(k).length&&-1!==["LINEAR","CIRCULAR","USERDEFINED"].indexOf(e))&&t.push(e);return 0===t.length&&(t=["LINEAR","CIRCULAR","USERDEFINED"]),t}(),n=[{value:b,iconUrl:N[b].iconUrl,label:h["LABEL_"+b],isdefault:!0}],c=l.length||0,s=0;s<c;++s)l[s]!==b&&n.push({value:l[s],iconUrl:N[l[s]].iconUrl,label:h["LABEL_"+l[s]]});d={position:k[U].clickPos?(new u.Matrix4).setPosition(k[U].clickPos):(new u.Matrix4).setPosition(k[U].position),label:h.FLAG_REF_LABEL,iconUrl:k[U].iconUrl?k[U].iconUrl:"",closeButton:!0,closeCB:function(){K.removeFlag(v[U+"ref"]),v[U+"ref"].destroy(),delete v[U+"ref"],U!==O&&delete k[U],"NOPATTERN"===e&&(m="NOPATTERN",U&&(m=m+"_"+Y),j[m]=R.getActiveFilters(),X=null),U=null,R.object3D[0]=null,t.publish({event:"C3D_UNSELECT_EVT"})},dialogs:[{type:o.fieldsTypeEnum.RADIO,radios:n,fnCallback:function(e){V=Y,re(Y=e),t.publish({event:"C3D_PATTERN_CHG"})}},{type:o.fieldsTypeEnum.BOOLEAN,iconUrl:E.getWebappsAssetUrl("CAT3DComposeCommands","icons/32/")+"I_C3DReuse.png",value:W}]},v[U+"ref"]=new i(w,d),v[U+"ref"].setOffset(P[U+"ref"]),(C=v[U+"ref"].flagPanel.getElement().getElementsByClassName("WUXFlagPanelBtnDialog")[1]).style.width=0,C.style.border=0,C.style.padding=0,C.style.margin=0,K.addFlag(v[U+"ref"])}if(U&&v[U+"ref"]&&U!==O?v[U+"ref"].flagPanel.getElement().getElementsByClassName("WUXFlagPanelBtnDialog")[1].removeClassName("hidden"):U&&v[U+"ref"]&&v[U+"ref"].flagPanel.getElement().getElementsByClassName("WUXFlagPanelBtnDialog")[1].addClassName("hidden"),O&&e!==N.USERDEFINED.id&&b!==N.USERDEFINED.id&&(g=k[O].worldMatrix.clone().setPosition(k[O].position),f=p.getAnimation3DEngine({viewer:w}),(T=new S({headLength:10,arrowLength:50,arrowWidth:2,colors:{colorX:new A.Color(.25,.63,.85,1),colorY:new A.Color(.25,.63,.85,1),colorZ:new A.Color(.25,.63,.85,1)},head:S.types.ARROW})).exludeFromBounding(!0),T.setVisibilityInTree(!1),T.setPickable(A.PICKTHROUGH),T.setMatrix(g),w.addNode(T),f.axisSystemVisibility({objectListToAnimate:[T],visibility:!0,pickability:!1}),f.startAnimation(),I=T,e!==N.CIRCULAR.id||D||y?(d={position:(new u.Matrix4).setPosition(k[O].position),label:h.FLAG_ORIGIN_LABEL,iconUrl:k[O].iconUrl?k[O].iconUrl:"",closeButton:!0,closeCB:function(){Z(O,e)}},O===U&&(d.offset=new u.Vector2(0,50)),v[O]=new i(w,d),v[O].setOffset(P[O]),K.addFlag(v[O])):ae(e,O,h.LABEL_AXIS,B,P[O])),e===N.USERDEFINED.id||b===N.USERDEFINED.id)for(r in k)k.hasOwnProperty(r)&&r!==U&&oe(r,P[r],e);else D&&ae(e,D,h.LABEL_DIR1,B,P[D]),y&&ae(e,y,h.LABEL_DIR2,H,P[y])},se=function(e){var t,n,i,o,a,r,s,c,l,d,C,E,S,p,A,g,h,f,v,I,b=[],P=w.getSceneGraphOverrideSetManager();for(t in T&&(P.removeSceneGraphOverrideSet(T),T=null),T=new m(_.getRootBagPath().externalPath[0]),G)G.hasOwnProperty(t)&&te(t);if(U)switch(b.push(k[U].pathElement),i=O&&k.hasOwnProperty(O)?k[O]:null,"USERDEFINED"!==e&&"USERDEFINED"!==Y&&(O&&(s=O),D&&(p=$(k[D],i,!0),s=D,h=p.clone().setLength((B.reverse?-1:1)*B.spacing),A=(new u.Matrix4).makeTranslation(h.x,h.y,h.z)),y&&(h=$(k[y],i,!0).clone().setLength((H.reverse?-1:1)*H.spacing),g=(new u.Matrix4).makeTranslation(h.x,h.y,h.z))),S=k[U],(E=(C=ee(S.pathElement)).getWorldMatrix()).getInverse(E),f=W?S.worldMatrix.clone().setPosition(S.position):S.worldMatrix.clone().setPosition(i.position),e){case N.LINEAR.id:if(D)for(o=0;o<B.count;++o)(0!==o||W)&&o>0&&(f=A.clone().multiply(f),v=ie(S,C,f),b.push(G[v].pathElement));break;case N.RECTANGULAR.id:if(D&&y)for(d=f.clone(),l=0;l<H.count;++l)for(l>0&&(d=g.clone().multiply(d)),f=d.clone(),o=0;o<B.count;++o)0===o&&(l>0||!W)?(v=ie(S,C,f),b.push(G[v].pathElement)):o>0&&(f=A.clone().multiply(f),v=ie(S,C,f),b.push(G[v].pathElement));break;case N.CIRCULAR.id:if(s)for(r=p||k[s].canonicGeom.getNormal().clone(),n=(new u.Matrix4).makeRotationAxis(r,(B.reverse?-1:1)*B.angle*Math.PI/180),c=(new u.Matrix4).setPosition(k[s].position),o=0;o<B.count;++o)(0!==o||W)&&o>0&&(f=c.clone().multiply(n.clone().multiply((new u.Matrix4).getInverse(c).multiply(f))),v=ie(S,C,f),b.push(G[v].pathElement));break;case N.USERDEFINED.id:for(a in k)k.hasOwnProperty(a)&&a!==U&&(f=k[a].type===R.geometryTypesEnum.AXISSYSTEM?k[a].worldMatrix.clone():S.worldMatrix.clone().setPosition(k[a].position),v=ie(S,C,f),b.push(G[v].pathElement))}T&&((I=T.createOverride({pathes:b}))&&(I.setOpacity(.5),I.setPickability("IGNORED")),P.pushSceneGraphOverrideSet(T))},ce=function(){var e;for(e in l.empty(),k)k.hasOwnProperty(e)&&l.add(k[e]);for(e in G)G.hasOwnProperty(e)&&l.add(G[e])},le=function(e){O=e},ue=function(e){var t,n,i,o,a=e;for(X&&(j[X]=R.getActiveFilters()),U&&a===N.NOPATTERN.id&&(a=a+"_"+Y),o=j[a],U&&o.REFERENCE&&delete o.REFERENCE,n=0,i=q[a].length;n<i;++n)o.hasOwnProperty(q[a][n])||(o[q[a][n]]=0);for(t in o)o.hasOwnProperty(t)&&-1===q[a].indexOf(t)&&delete o[t];e===N.CIRCULAR.id&&D&&(o={}),R.updateFilters(o,!1)},de=function(e){var t,n=Object.keys(k),i=n.length;for(O||(y&&z(k[y].type)&&Z(y,e,!1,!1),D&&z(k[D].type)&&Z(D,e,!1,!1)),t=0;t<i;++t)if(z(k[n[t]].type)){if(!O&&n[t]!==D&&n[t]!==y){le(n[t]);continue}if(!D&&n[t]!==O&&n[t]!==y){D=n[t];continue}if(!y&&n[t]!==D&&n[t]!==O){y=n[t];continue}}re(e)},me=function(e,n,i){var o,a,r,c,l,d,m=null,C=new u.Vector3;R.object3D[0]&&R.object3D[0].pathElement&&(m=R.object3D[0].pathElement),m&&!k[m.getKey()]&&(r=(o=s.getEquivalentGeometry({pathElement:m,axisSystemSub:!0,viewer:w}))?o.getType():R.geometryTypesEnum.REFERENCE,c=m.getWorldMatrix(),a=m.getKey(),r===R.geometryTypesEnum.REFERENCE||r===R.geometryTypesEnum.AXISSYSTEM||r===R.geometryTypesEnum.AXISSYSTEMAXIS?C.getPositionFromMatrix(c):C=function(e){var t=null,n=e.getType();if(void 0===n)return null;switch(n){case R.geometryTypesEnum.POINT:t=e.getPoint();break;case R.geometryTypesEnum.LINE:case R.geometryTypesEnum.CYLINDER:t=e.getEndPoints().beginPoint;break;case R.geometryTypesEnum.CIRCLE:case R.geometryTypesEnum.CENTER:t=e.getCenter()}return t}(o),k[a]={pathElement:m,type:r,worldMatrix:c,position:C,clickPos:R.object3D[0].position,canonicGeom:o,iconUrl:function(e){var t=null,n=E.getWebappsAssetUrl("DMUBaseCommands","icons/32/"),i=E.getWebappsAssetUrl("CAT3DComposeCommands","icons/32/");switch(e){case R.geometryTypesEnum.POINT:t=n+"I_Meas_Point.png";break;case R.geometryTypesEnum.CENTER:case R.geometryTypesEnum.CIRCLE:t=n+"I_Meas_PointCircle.png";break;case R.geometryTypesEnum.AXISSYSTEM:t=i+"I_3DComposeAxisSystem.png";break;case R.geometryTypesEnum.AXISSYSTEMORIGIN:t=i+"I_C3DAxisOrigin.png";break;case R.geometryTypesEnum.AXISSYSTEMAXIS:t=i+"I_C3DAxisAxis.png";break;case R.geometryTypesEnum.PLANE:t=n+"I_Meas_Plane.png";break;case R.geometryTypesEnum.CYLINDER:t=n+"I_Meas_Cylinder.png";break;case R.geometryTypesEnum.LINE:t=n+"I_Meas_Line.png"}return t}(r)},r===R.geometryTypesEnum.AXISSYSTEM&&(k[a].clickPos=C),U||r!==R.geometryTypesEnum.REFERENCE?!O&&e.id!==N.USERDEFINED.id&&z(r)?le(a):a!==O&&a!==U&&(D?y||(y=a,!O||r!==R.geometryTypesEnum.POINT&&r!==R.geometryTypesEnum.CIRCLE&&r!==R.geometryTypesEnum.AXISSYSTEM||(H.spacing=Math.round(1e3*k[O].position.distanceTo(C))/1e3)):(D=a,!O||r!==R.geometryTypesEnum.POINT&&r!==R.geometryTypesEnum.CIRCLE&&r!==R.geometryTypesEnum.AXISSYSTEMORIGIN||(B.spacing=Math.round(1e3*k[O].position.distanceTo(C))/1e3))):(l=a,d=g.getNodeID(k[l].pathElement.getLastElement(!0)),U=l,k[l].iconUrl="",_.getController().getAttributes({ids:[d],attributes:["type_icon_url"],callbacks:{onComplete:function(e){k[l].iconUrl=e[d]?e[d].type_icon_url:"",v[l+"ref"]&&v[l+"ref"].setIcon(k[l].iconUrl)},onFailure:function(){}}})),R.object3D=[]),re(e.id),ue(e.id),J(),se(e.id),e.id!==N.NOPATTERN.id?f.removeAll(function(){f.add({message:h["LABEL_"+e.id],closable:!1,buttons:[{label:h.SAVEBTN,className:"primary",onClick:function(){t.publish({event:"C3D_SAVE_CLICK"})},doClose:!0},{label:h.CANCELBTN,className:"default",onClick:function(){t.publish({event:"C3D_CANCEL_CLICK"})},doClose:!0}]})}):f.removeAll(function(){var n=0;U&&(n=1),f.add({message:h["LABEL_"+e.id+"_"+n],closable:!1,buttons:[{label:h.CANCELBTN,className:"default",onClick:function(){t.publish({event:"C3D_CANCEL_CLICK"})},doClose:!0}]})}),i(),ce()},Ce=function(e,t,n){se(e.id),ue(e.id),J(),n(),ce()},Ee=function(){return!!U||(f.add({message:h.NOREFERROR,msgType:"warning",autoHide:!0,closable:!0}),!1)},Se=function(e){var t,n,i,o=w,a={context:_,parentID:null,children:[],onCompleted:function(t){var n=t.length||0;0!==n?t.forEach(function(t){n--,!t.instID&&t.message&&f.add({message:t.message,msgType:"error",autoHide:!0,closable:!0}),0===n&&e()}):e()}};if(G&&k){for(t in n=k[U],i=g.getNodeID(n.pathElement.getLastElement()),a.parentID=g.getNodeID(ee(n.pathElement).getLastElement()),G)G.hasOwnProperty(t)&&G[t].activated&&a.children.push({id:i,matrix:G[t].pathElement.getMatrix(o)});C.insertExisting(a)}},pe=function(e){e()};this.beginExecute=function(){O=null,U=null,D=null,y=null,k={},f=(new n).inject(F.getUIFrame()),v=[],l.isEmpty()&&f.add({message:h.LABEL_NOPATTERN_0,closable:!1,buttons:[{label:h.CANCELBTN,className:"default",onClick:function(){t.publish({event:"C3D_CANCEL_CLICK"})},doClose:!0}]}),w.setDefaultPicking(!1),M.call(P)},this.endExecute=function(){var e;for(e in J(),l.empty(),O=null,U=null,D=null,y=null,G&&ne(),T&&(w.getSceneGraphOverrideSetManager().removeSceneGraphOverrideSet(T),T=null),w.setDefaultPicking(!0),R&&R.deactivate(),ne(),f&&(f.destroy(),f=null),I&&w.removeNode(I),v)v.hasOwnProperty(e)&&(K.removeFlag(v[e]),v[e].destroy(),delete v[e]);v.length=0,x.call(P)},this.buildGraph=function(){var e=E.getWebappsAssetUrl("CAT3DComposeCommands","icons/32/"),t=this.createInitialState("NoPatternState"),n=this.createState("LinearState"),i=this.createState("RectangularState"),o=this.createState("CircularState"),a=this.createState("UserDefineState"),r=this.getFinalState(),s=j.NOPATTERN;U||(s={POINT:0,CENTER:0,LINE:0,CYLINDER:0,AXISSYSTEM:0,AXISSYSTEMORIGIN:0,AXISSYSTEMAXIS:0,REFERENCE:1}),R=new c({context:_,activeFilters:s,postFilter:function(e){var t=g.getRoots(_);return!!g.isAModelPath(e)&&(!Array.isArray(t)||-1===t.indexOf(e.getLastElement()))}}),N={NOPATTERN:{id:"NOPATTERN",iconUrl:"",chkConditions:function(){return!0},actions:function(e){me(N.NOPATTERN,0,e)}},LINEAR:{id:"LINEAR",iconUrl:e+"I_C3DRectangularPattern.png",chkConditions:function(){return("LINEAR"===Y||"RECTANGULAR"===Y)&&Q(N.LINEAR.conditions)},conditions:{stateID:"LINEAR",debugTxt:"Linear pattern condition",validSelCount:1,validTypes:[{type:R.geometryTypesEnum.POINT},{type:R.geometryTypesEnum.CIRCLE},{type:R.geometryTypesEnum.LINE},{type:R.geometryTypesEnum.AXISSYSTEM},{type:R.geometryTypesEnum.AXISSYSTEMAXIS},{type:R.geometryTypesEnum.CYLINDER}]},actions:function(e){me(N.LINEAR,0,e)}},RECTANGULAR:{id:"RECTANGULAR",iconUrl:e+"I_C3DRectangularPattern.png",chkConditions:function(){return!("LINEAR"!==Y&&"RECTANGULAR"!==Y||!D)&&Q(N.RECTANGULAR.conditions)},conditions:{stateID:"RECTANGULAR",debugTxt:"Rectangular pattern condition",validSelCount:2,validTypes:[{type:R.geometryTypesEnum.POINT},{type:R.geometryTypesEnum.CIRCLE},{type:R.geometryTypesEnum.LINE},{type:R.geometryTypesEnum.CYLINDER},{type:R.geometryTypesEnum.AXISSYSTEM},{type:R.geometryTypesEnum.AXISSYSTEMAXIS}]},actions:function(e){me(N.RECTANGULAR,0,e),w.setDefaultPicking(!1)}},CIRCULAR:{id:"CIRCULAR",iconUrl:e+"I_C3DCircularPattern.png",chkConditions:function(){return"CIRCULAR"===Y&&Q(N.CIRCULAR.conditions)},conditions:{stateID:"CIRCULAR",debugTxt:"Circular pattern condition",validSelCount:1,validTypes:[{type:R.geometryTypesEnum.POINT},{type:R.geometryTypesEnum.CIRCLE},{type:R.geometryTypesEnum.CYLINDER},{type:R.geometryTypesEnum.LINE},{type:R.geometryTypesEnum.AXISSYSTEM},{type:R.geometryTypesEnum.AXISSYSTEMAXIS}]},actions:function(e){me(N.CIRCULAR,0,e)}},USERDEFINED:{id:"USERDEFINED",iconUrl:e+"I_C3DUserPattern.png",chkConditions:function(){return"USERDEFINED"===Y&&Q(N.USERDEFINED.conditions)},conditions:{stateID:"USERDEFINED",debugTxt:"User defined pattern condition",validSelCount:-1,validTypes:[{type:R.geometryTypesEnum.POINT},{type:R.geometryTypesEnum.CIRCLE},{type:R.geometryTypesEnum.AXISSYSTEM}]},actions:function(e){me(N.USERDEFINED,0,e)}}},this.addTransition({iInitialState:t,iFinalState:n,iEvent:R,iCondition:function(){return N.LINEAR.chkConditions()},iAction:function(e){X="NOPATTERN_LINEAR",N.LINEAR.actions(e)},iSender:P}),this.addTransition({iInitialState:t,iFinalState:i,iEvent:R,iCondition:function(){return N.RECTANGULAR.chkConditions()},iAction:function(e){X="NOPATTERN_LINEAR",N.RECTANGULAR.actions(e)},iSender:P}),this.addTransition({iInitialState:t,iFinalState:o,iEvent:R,iCondition:function(){return N.CIRCULAR.chkConditions()},iAction:function(e){X="NOPATTERN_CIRCULAR",N.CIRCULAR.actions(e)},iSender:P}),this.addTransition({iInitialState:t,iFinalState:a,iEvent:R,iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){X="NOPATTERN_USERDEFINED",N.USERDEFINED.actions(e)},iSender:P}),this.addTransition({iInitialState:t,iFinalState:r,iEvent:"C3D_CANCEL_CLICK",iAction:function(e){X="NOPATTERN",U&&(X=X+"_"+Y),pe(e)}}),this.addTransition({iInitialState:t,iFinalState:t,iEvent:R,iCondition:function(){return N.NOPATTERN.chkConditions()},iAction:function(e){X="NOPATTERN",U&&(X=X+"_"+Y),N.NOPATTERN.actions(e)},iSender:P}),this.addTransition({iInitialState:n,iFinalState:n,iEvent:R,iCondition:function(){return N.LINEAR.chkConditions()},iAction:function(e){X="LINEAR",N.LINEAR.actions(e)},iSender:P}),this.addTransition({iInitialState:n,iFinalState:n,iEvent:"C3D_PARAMETERS_CHG",iAction:function(e){X="LINEAR",Ce(N.LINEAR,0,e)}}),this.addTransition({iInitialState:n,iFinalState:i,iEvent:R,iCondition:function(){return N.RECTANGULAR.chkConditions()},iAction:function(e){X="LINEAR",N.RECTANGULAR.actions(e)},iSender:P}),this.addTransition({iInitialState:n,iFinalState:r,iEvent:"C3D_CANCEL_CLICK",iAction:function(e){X="LINEAR",pe(e)}}),this.addTransition({iInitialState:n,iFinalState:r,iEvent:"C3D_SAVE_CLICK",iCondition:function(){return Ee()},iAction:function(e){X="LINEAR",Se(e)}}),this.addTransition({iInitialState:i,iFinalState:i,iEvent:"C3D_PARAMETERS_CHG",iAction:function(e){X="RECTANGULAR",Ce(N.RECTANGULAR,0,e)}}),this.addTransition({iInitialState:i,iFinalState:r,iEvent:"C3D_CANCEL_CLICK",iAction:function(e){X="RECTANGULAR",pe(e)}}),this.addTransition({iInitialState:i,iFinalState:r,iEvent:"C3D_SAVE_CLICK",iCondition:function(){return Ee()},iAction:function(e){X="RECTANGULAR",Se(e)}}),this.addTransition({iInitialState:o,iFinalState:o,iEvent:R,iCondition:function(){return N.CIRCULAR.chkConditions()},iAction:function(e){X="CIRCULAR",N.CIRCULAR.actions(e)},iSender:P}),this.addTransition({iInitialState:o,iFinalState:o,iEvent:"C3D_PARAMETERS_CHG",iAction:function(e){X="CIRCULAR",Ce(N.CIRCULAR,0,e)}}),this.addTransition({iInitialState:o,iFinalState:r,iEvent:"C3D_CANCEL_CLICK",iAction:function(e){X="CIRCULAR",pe(e)}}),this.addTransition({iInitialState:o,iFinalState:r,iEvent:"C3D_SAVE_CLICK",iCondition:function(){return Ee()},iAction:function(e){X="CIRCULAR",Se(e)}}),this.addTransition({iInitialState:a,iFinalState:a,iEvent:R,iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){X="USERDEFINED",N.USERDEFINED.actions(e)},iSender:P}),this.addTransition({iInitialState:a,iFinalState:r,iEvent:"C3D_CANCEL_CLICK",iAction:function(e){X="USERDEFINED",pe(e)}}),this.addTransition({iInitialState:a,iFinalState:r,iEvent:"C3D_SAVE_CLICK",iCondition:function(){return Ee()},iAction:function(e){X="USERDEFINED",Se(e)}}),this.addTransition({iInitialState:n,iFinalState:o,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.CIRCULAR.chkConditions()},iAction:function(e){X="LINEAR",N.CIRCULAR.actions(e)}}),this.addTransition({iInitialState:n,iFinalState:a,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){X="LINEAR",N.USERDEFINED.actions(e)}}),this.addTransition({iInitialState:o,iFinalState:n,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.LINEAR.chkConditions()},iAction:function(e){X="CIRCULAR",N.LINEAR.actions(e)}}),this.addTransition({iInitialState:o,iFinalState:a,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){X="CIRCULAR",N.USERDEFINED.actions(e)}}),this.addTransition({iInitialState:a,iFinalState:o,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.CIRCULAR.chkConditions()},iAction:function(e){de(N.CIRCULAR.id),X="USERDEFINED",N.CIRCULAR.actions(e)}}),this.addTransition({iInitialState:i,iFinalState:a,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){X="RECTANGULAR",N.USERDEFINED.actions(e)}}),this.addTransition({iInitialState:a,iFinalState:i,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.RECTANGULAR.chkConditions()},iAction:function(e){de(N.RECTANGULAR.id),X="USERDEFINED",N.RECTANGULAR.actions(e)}}),this.addTransition({iInitialState:a,iFinalState:n,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.LINEAR.chkConditions()},iAction:function(e){de(N.LINEAR.id),X="USERDEFINED",N.LINEAR.actions(e)}}),this.addTransition({iInitialState:n,iFinalState:t,iEvent:"C3D_PATTERN_CHG",iAction:function(e){X="LINEAR",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:i,iFinalState:t,iEvent:"C3D_PATTERN_CHG",iAction:function(e){X="RECTANGULAR",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:o,iFinalState:t,iEvent:"C3D_PATTERN_CHG",iAction:function(e){X="CIRCULAR",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:a,iFinalState:t,iEvent:"C3D_PATTERN_CHG",iAction:function(e){X="USERDEFINED",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:t,iFinalState:n,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.LINEAR.chkConditions()},iAction:function(e){X="NOPATTERN",N.LINEAR.actions(e)}}),this.addTransition({iInitialState:t,iFinalState:i,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.RECTANGULAR.chkConditions()},iAction:function(e){X="NOPATTERN",N.RECTANGULAR.actions(e)}}),this.addTransition({iInitialState:t,iFinalState:o,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.CIRCULAR.chkConditions()},iAction:function(e){X="NOPATTERN",N.CIRCULAR.actions(e)}}),this.addTransition({iInitialState:t,iFinalState:a,iEvent:"C3D_PATTERN_CHG",iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){X="NOPATTERN",N.USERDEFINED.actions(e)}}),this.addTransition({iInitialState:t,iFinalState:t,iEvent:"C3D_PATTERN_CHG",iAction:function(e){X="NOPATTERN",U&&(X=X+"_"+V),N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:i,iFinalState:n,iEvent:"C3D_UNSELECT_EVT",iCondition:function(){return N.LINEAR.chkConditions()},iAction:function(e){X="RECTANGULAR",N.LINEAR.actions(e)}}),this.addTransition({iInitialState:a,iFinalState:a,iEvent:"C3D_UNSELECT_EVT",iCondition:function(){return N.USERDEFINED.chkConditions()},iAction:function(e){N.USERDEFINED.actions(e)}}),this.addTransition({iInitialState:n,iFinalState:t,iEvent:"C3D_UNSELECT_EVT",iAction:function(e){X="LINEAR",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:o,iFinalState:o,iEvent:"C3D_UNSELECT_EVT",iCondition:function(){return N.CIRCULAR.chkConditions()},iAction:function(e){X="CIRCULAR",N.CIRCULAR.actions(e)}}),this.addTransition({iInitialState:o,iFinalState:t,iEvent:"C3D_UNSELECT_EVT",iAction:function(e){X="CIRCULAR",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:a,iFinalState:t,iEvent:"C3D_UNSELECT_EVT",iAction:function(e){X="USERDEFINED",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:i,iFinalState:t,iEvent:"C3D_UNSELECT_EVT",iAction:function(e){X="RECTANGULAR",N.NOPATTERN.actions(e)}}),this.addTransition({iInitialState:t,iFinalState:t,iEvent:"C3D_UNSELECT_EVT",iAction:function(e){N.NOPATTERN.actions(e)}})},(b=JSON.parse(localStorage.getItem("CAT3DComposeAssemblyPatternCmd")))&&3===b.version&&(W="object"==typeof b.reuse?b.reuse:W,Y="object"==typeof b.radioPattern?b.radioPattern:Y,B="object"==typeof b.direction1?b.direction1:B,H="object"==typeof b.direction2?b.direction2:H,j="object"==typeof b.filters?b.filters:j),this._parent(e,{mode:"exclusive",isAsynchronous:!0,doServerCall:!1}),this.odtUtilsSetDefaultNbInstances=function(e){B.count=e,H.count=e}}})});