define("DS/IterationsWidget/IterationsTable",["UWA/Controls/Abstract","UWA/Core","DS/IterationsWidget/IterationsGrid","DS/Tree/TreeDocument","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","i18n!DS/IterationsWidget/assets/nls/IterationsWidget"],function(t,e,i,n,s,o,r){"use strict";var a=t.extend({init:function(t,e,i,n){this._parent({}),this._oid=i.oid,this.NLS=t,this.lang=e,this._isODT=n,this._parentContainer=i.parentContainer,this.newGETRequestPromise=i.newGETRequestPromise,this.list=i.iterations,this._treeList=null,this.selectedObjects=[],this.buildUITree(i.iterations);var s=this._treeList.elements;null!==s&&(null!==s.container&&this.setODTVariables(s.container),null!==s.formContainer&&this.setODTVariables(s.formContainer),null!==s.formSubmitButton&&this.setODTVariables(s.formSubmitButton)),this._treeModel&&(this._treeModel["data-rec-id"]="treeDocument"),this._treeList&&(this._treeList["data-rec-id"]="treeList");for(var o=document.getElementsByClassName("wux-layouts-gridengine-poolcontainer-rel"),r=0;r<o.length;r++){o.item(r).setAttribute("data-rec-id","wux-layouts-gridengine-poolcontainer-rel_"+r)}var a=this._treeList.getManager().elements.poolContainerRel.querySelectorAll("wux-datagrid-cell wux-layouts-treeview-cell wux-datagrid-cell-even");for(r=0;r<a.length;r++){a.item(r).setAttribute("data-rec-id","wux-datagrid-cell wux-layouts-treeview-cell wux-datagrid-cell-even-"+r)}},buildUITree:function(t){var i=this;this.container=e.createElement("div",{class:"iterationsTreeListViewContainer"}),this._treeModel=new n({id:"iterations-webinwin-list",class:"iterations-webinwin-list"});var a=!1,l=!1;t.forEach(t=>{t.isMIB?a=!0:l=!0});for(var d=[],h=0;h<t.length;h++){var c=t[h],u=h.toString();c.isMIB&&(u=c.displayed_iteration.toString());var m=c.name;void 0!==c.selectedobject&&1==c.selectedobject&&(m+=r.LastSavedModelString);var g=new Date(parseInt(c.date_ms)).toLocaleString();c.date.indexOf("*")>=0&&(g+="(*)");var f=new o({label:h,data:c,grid:{tree:c,number:u,name:m,description:c.description,date:g,modified_by:c.modified_by,iternumber:c.iternumber,isMIB:c.isMIB,iterationObj:h}});f.onSelect(this.onNodeClick.bind(this)),this._treeModel.addChild(f),d.push(f)}var p=[];p=p.concat([{dataIndex:"tree",isHidden:!0,width:"auto",onCellRequest:function(t){if(t.isHeader)t.cellView.getContent().setAttribute("data-rec-id","tree-header");else{var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(t.nodeModel.options.grid.tree),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}},{text:r.iterationNumber,dataIndex:"number",width:"10%",fontWeight:"bolder",isSortable:!0,onCellRequest:function(t){if(t.isHeader)t.cellView.getContent().setAttribute("data-rec-id","number-header");else{var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(t.nodeModel.options.grid.number),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}}]),l&&p.push({text:r.iterationName,dataIndex:"name",width:"auto",fontWeight:"bolder",onCellRequest:function(t){if(t.isHeader)t.cellView.getContent().setAttribute("data-rec-id","name-header");else{var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(t.nodeModel.options.grid.name),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}}),a&&p.push({text:r.modifiedBy,dataIndex:"modified_by",width:"auto",fontWeight:"bolder",isSortable:!1,onCellRequest:function(t){if(t.isHeader)t.cellView.getContent().setAttribute("data-rec-id","modified_by-header");else{var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(t.nodeModel.options.grid.modified_by),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}}),p=p.concat([{text:r.iterationDate,dataIndex:"date",width:"auto",fontWeight:"bolder",isSortable:!1,onCellRequest:function(t){if(t.isHeader)t.cellView.getContent().setAttribute("data-rec-id","date-header");else{var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(t.nodeModel.options.grid.date),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}},{text:r.iterationDescription,dataIndex:"description",width:"auto",fontWeight:"bolder",isSortable:!1,onCellRequest:function(t){if(t.isHeader)t.cellView.getContent().setAttribute("data-rec-id","description-header");else{var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(t.nodeModel.options.grid.description),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}},{dataIndex:"iterationObj",isHidden:!0,width:"auto",onCellRequest:function(t){var e=t.cellView;t.nodeModel&&t.nodeModel.options&&(e.getContent().setContent(String(model.count)),e.getContent().setAttribute("data-rec-id",t.virtualRowID+"-"+t.dataIndex))}}]);var w=new s({class:"iterationsTreeListView",id:"iterationsTreeListViewId",enableListSelection:!0,height:"auto",resize:{columns:!0,rows:!0},selection:{nodes:!0,rowHeaders:!0,columnHeaders:!1,toggle:!0,canMultiSelect:!0,unselectAllOnEmptyArea:!0},columns:p,treeDocument:this._treeModel});if(this._treeList=w,this._treeList.inject(this.container),this._treeList.getManager().onPostUpdateViewOnce(function(){var t=this.getScroller();void 0!==typeof t&&null!=t&&t.elements.container.setAttribute("data-rec-id","wux-scroller")}),null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()){this.container.getElement(".wux-tree-treelistview").setStyle("height","inherit"),this.container.getElement(".wux-datagrid").setStyle("height","inherit"),this.container.getElement(".wux-layouts-gridengine").setStyle("height","inherit");var v=28*(t.length+1);v>=280?this.container.getElement(".wux-layouts-gridengine").setStyle("min-height","280px"):this.container.getElement(".wux-layouts-gridengine").setStyle("min-height",v+"px")}var b=[],y=new Map;this._treeModel.getRoots().forEach(t=>{if(t.options.grid.modified_by){var e=t.options.grid.modified_by;y.has(e)||(y.set(e,[]),b.push(i.newGETRequestPromise("resources/modeler/pno/person/"+encodeURIComponent(e)).then(t=>t.OK?{key:e,val:t.OK}:{key:e,val:null}))),y.get(e).push(t)}}),Promise.all(b).then(t=>{this._treeModel.prepareUpdate(),t.forEach(t=>{if(t.key&&t.val&&y.has(t.key)){var e=y.get(t.key),i=t.val.firstname?t.val.firstname:"",n=t.val.lastname?t.val.lastname:"";e.forEach(t=>{i&&n?t.options.grid.modified_by=i+" "+n:i?t.options.grid.modified_by=i:n&&(t.options.grid.modified_by=n)})}}),this._treeModel.pushUpdate()}).catch(t=>{console.log(t)})},checkRestoreBtn:function(){var t=this._treeList.options.treeDocument.getSelectedNodes();Array.isArray(t)&&0==t.length&&null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()&&null!=window.buttonRestore&&(window.buttonRestore.disabled=!0)},setODTVariables:function(t){var e=[];if(null!=t){var i=t.childNodes;if(null!==i)for(var n=0;n<i.length;n++)1==i[n].nodeType&&s(i[n],e,n,n);function s(t,e,i,n){if(null!==t){var o="";o=""==t.className?t.nodeName:t.className,t.setAttribute("data-rec-id",o),e.push(t.className);for(var r=t.childNodes,a=0;a<r.length;a++)1==r[a].nodeType&&s(r[a],e,a,i)}}}}});return a.prototype.onNodeClick=function(t){var e=document.getElementById("iterationCompareViewContainer"),n=document.getElementById("iterationPlayerContainer");if(this._treeList&&!this._treeList.clicked){this._treeList.clicked=!1;this._treeList.getManager().getDocument().getChildren();for(var s=this._treeList.getManager().getSelectedRows(),o=[],r=0;r<s.length;r++){var a=this._treeList.getManager().getTreeNodeModelFromRowID(s[r]);if(null!=a){var l=a.options.grid.iterationObj;o.push(l)}}if(this.selectedObjects=o,o&&2==o.length){if(null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()&&(window.buttonRestore.disabled=!0),window.hasOwnProperty("restoreBtn")&&window.restoreBtn.disable(),!0===window._disableCompareBtn?window.hasOwnProperty("compareBtn")&&window.compareBtn.disable():window.hasOwnProperty("compareBtn")&&window.compareBtn.enable(),window.hasOwnProperty("openBtn")&&window.openBtn.enable(),e&&n){e.hidden="",n.hidden="hidden";var d=[];for(r=0;r<o.length;r++)d.push(this.list[o[r]]);for(;e.hasChildNodes();)e.removeChild(e.lastChild);(m=new i(d,30,this.NLS,!0)).show(),m.inject(e)}}else{if(o&&0==o.length?(window.hasOwnProperty("openBtn")&&window.openBtn.disable(),null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()&&(window.buttonRestore.disabled=!0)):window.hasOwnProperty("openBtn")&&window.openBtn.enable(),o&&1==o.length){var h=this.list[o[0]].name,c=this.list[o[0]].isMIBLastIter,u=this.NLS.get("LastSavedModelString");-1!==h.indexOf(u)||c?(window.hasOwnProperty("restoreBtn")&&window.restoreBtn.disable(),window.hasOwnProperty("openBtn")&&window.openBtn.disable(),null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()&&(window.buttonRestore.disabled=!0)):null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()?window.buttonRestore.disabled=!1:(window.hasOwnProperty("restoreBtn")&&window.restoreBtn.enable(),window.hasOwnProperty("openBtn")&&window.openBtn.enable())}else window.hasOwnProperty("restoreBtn")&&window.restoreBtn.disable(),null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()&&(window.buttonRestore.disabled=!1);var m;if(window.hasOwnProperty("compareBtn")&&window.compareBtn.disable(),e&&n)(m=window.iterationsGrid)&&m.hide(),e.hidden="hidden",n.hidden=""}if(o&&1!=o.length&&null!=window.addinmode&&"catiav5"===window.addinmode.toLowerCase()&&(window.buttonRestore.disabled=!0),void 0!==typeof window.iterationsPlayer&&null!=window.iterationsPlayer&&1==o.length){var g=this.list[o[0]].id;window.iterationsPlayer.timepointChangeFromList(g)}}},a}),define("DS/IterationsWidget/Toolbar",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t,e,i,n){this._parent({}),this.buttonWidth=t,this.buttons=[],this.align=n;var s="calc(100% - "+e+"px)";"top"==i&&(s="0px"),this.container=new UWA.Element("div",{styles:{position:"absolute",height:e+"px",top:s,width:"100%","z-index":"100"}}),this.container.setAttribute("data-rec-id","toolbarDiv")},inject:function(t){this.container.inject(t)},center:function(){var t=this.buttonWidth*this.buttons.length;this.container.style.left="calc(50% - "+t/2+"px)"},recomputeButtonsPosition:function(){var t=0;this.buttons.forEach(e=>{"none"!=e.style.display&&("right"==this.align?e.style.right=t*this.buttonWidth+"px":e.style.left=t*this.buttonWidth+"px",t++)})},addButton:function(t,e,i,n){var s=this,o=null;(o="right"==this.align?new UWA.Element("div",{styles:{position:"absolute",top:"0px",right:this.buttons.length*this.buttonWidth+"px",height:"100%"},title:e}):new UWA.Element("div",{styles:{position:"absolute",top:"0px",left:this.buttons.length*this.buttonWidth+"px",height:"100%"},title:e})).onclickFun=n,this.buttons.push(o),o.setAttribute("data-rec-id",e+"-div");var r=new UWA.Element("img",{src:t});return r.setAttribute("data-rec-id",t+"img-"+e),r.inject(o),o.inject(this.container),o.check=function(){r.src=i,r.style.cursor="default"},o.uncheck=function(){r.src=t,r.style.cursor="pointer"},o.hide=function(){o.style.visibility="hidden"},o.show=function(){o.style.visibility="inherit"},o.displayNone=function(){o.style.display="none",s.recomputeButtonsPosition()},o.displayOn=function(){o.style.display="inherit",s.recomputeButtonsPosition()},o.disable=function(){o.style.opacity="0.5",o.style.cursor="default",o.disabled=!0},o.enable=function(){o.style.opacity="1.0",o.style.cursor="pointer",o.disabled=!1},o.onclick=function(){o.disabled||o.onclickFun()},o},appendChild:function(t){this.container.appendChild(t)}})}),define("DS/IterationsWidget/TimeAxis",["UWA/Controls/Abstract"],function(t){"use strict";return t.extend({init:function(t){this.offFillColor="#42a2da",this.offStrokeColor="#368ec4",this.overStrokeColor="#005685",this.onStrokeColor="#003c5a",this.onFillColor="#005685",this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.setAttribute("class","timeline-timeAxis"),this.container.setAttribute("data-rec-id","timeline-timeAxis"),this.timeline=t,this._parent({}),this.fillLinearGradient=this.addLinearGradient(this.container,"fill_lg",this.offFillColor,"#f2f2f2"),this.strokeLinearGradient=this.addLinearGradient(this.container,"stroke_lg",this.offStrokeColor,"#b4b6ba"),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rect.setAttribute("rx","5"),this.rect.setAttribute("ry","5"),this.rect.setAttribute("data-rec-id","svg-rect-timeAxis"),this.rect.setAttribute("fill","url(#fill_lg)"),this.rect.setAttribute("stroke","url(#stroke_lg)"),this.rect.setAttribute("stroke-width","2"),this.container.appendChild(this.rect),this.setMouseOffSliderStyle()},addLinearGradient:function(t,e,i,n){var s=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");s.setAttribute("id",e),s.setAttribute("x1","0"),s.setAttribute("x2","1"),s.addStop=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg","stop");return i.setAttribute("offset",t),i.setAttribute("stop-opacity","1"),i.setAttribute("stop-color",e),s.appendChild(i),i};var o=s.addStop("0%",i),r=s.addStop("20%",i),a=s.addStop("20%",n);s.addStop("100%",n);return s.setColorChangePos=function(t){r.setAttribute("offset",100*t+"%"),a.setAttribute("offset",100*t+"%")},s.updateColor1=function(t){o.setAttribute("stop-color",t),r.setAttribute("stop-color",t)},t.appendChild(s),s},inject:function(t){t.appendChild(this.container)},setMouseOffSliderStyle:function(){this.fillLinearGradient.updateColor1(this.offFillColor),this.strokeLinearGradient.updateColor1(this.offStrokeColor)},setMouseOverSliderStyle:function(){this.fillLinearGradient.updateColor1(this.offStrokeColor),this.strokeLinearGradient.updateColor1(this.overStrokeColor)},setMouseOnSliderStyle:function(){this.fillLinearGradient.updateColor1(this.onFillColor),this.strokeLinearGradient.updateColor1(this.onStrokeColor)},onSliderMoved:function(t){this.fillLinearGradient.setColorChangePos(t),this.strokeLinearGradient.setColorChangePos(t)},onResize:function(t){var e=this.timeline.getWidth()+this.timeline.config.getSliderWidth(),i=this.timeline.config.getTimepointHeight(),n=this.timeline.config.getPaddingTop();this.rect.setAttribute("x",this.timeline.config.getPaddingLeft()),this.rect.setAttribute("y",n),this.rect.setAttribute("width",e),this.rect.setAttribute("height",i)}})}),define("DS/IterationsWidget/Point",["UWA/Class"],function(t){"use strict";var e=t.extend({init:function(t,e){this.x=t,this.y=e},add:function(t,i){return new e(this.x+t,this.y+i)},toString:function(){return this.x+","+this.y}});return e}),define("DS/IterationsWidget/TimelineConfig",["UWA/Class"],function(t){"use strict";return t.extend({init:function(){this.timepointHeight=12,this.timepointTopMargin=20,this.height=50,this.paddingLeft=8,this.paddingRight=8,this.paddingTop=60,this.timespanMinWidth=5,this.sliderWidth=10},getTimespanMinWidth:function(){return this.timespanMinWidth},getSliderWidth:function(){return this.sliderWidth},getTimepointTopMargin:function(){return this.timepointTopMargin},getTimepointHeight:function(){return this.timepointHeight},getWidth:function(){return this.width},getHeight:function(){return this.height},getPaddingLeft:function(){return this.paddingLeft},getPaddingRight:function(){return this.paddingRight},getPaddingTop:function(){return this.paddingTop}})}),define("DS/IterationsWidget/IterationsSWWidget",["UWA/Controls/Abstract","UWA/Core","DS/PlatformAPI/PlatformAPI","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/Tree/TreeDocument","DS/Tree/TreeListView","DS/Tree/TreeNodeModel","DS/UIKIT/Mask","i18n!DS/IterationsWidget/assets/nls/IterationsWidget"],function(t,e,i,n,s,o,r,a,l,d,h){"use strict";return t.extend({executeCmd:function(t,e,n){var s=this;s._parent(e),s.familyPhysicalid=null,s.selected=null,s.object=t[0],s.buildUI(),d.mask(s.tableContainer),i.subscribe("webinwin:win:notification",function(t){var e=JSON.parse(t);"iterations/getFamilyPhysicalid"==e.operation&&null==s.familyPhysicalid&&(s.familyPhysicalid=e.familyPhysicalid,s.selected=e.iterationPhysicalid,s.onGetFamilyPhysicalid(e.familyPhysicalid))});var o='{"operation":"iterations/getFamilyPhysicalid","confPhysicalid":"'+s.object.physicalid+'"}';i.publish("webinwin:web:notification",o),n()},onGetFamilyPhysicalid:function(t){var i=this;if(""==t){i.close();var r=e.createElement("div",{styles:{height:"100%"}}),a=o.get3DSpaceBaseUrl(widget.getValue("x3dPlatformId"))+"/webapps/IterationsWidget/assets/images/warning.png";r.innerHTML='<img src="'+a+'"></img>'+h.invalidTypeSW;var l=new n,c=l.create(r,{title:h.Title,closeButton:!0,resizable:!0,buttonStyle:l.buttonStyle.ok,onOk:function(){l.destroy()}},this);return c.inject(widget.body),void c.setNewSize({width:400})}o.app_initialization(function(){var e={objectId:t};s.get(i.object.tenant,"/resources/iteration/list/iterationlist",e,function(t){d.unmask(i.tableContainer);var e=t.results;e.sort(function(t,e){return t.date_ms==e.date_ms?0:t.date_ms<e.date_ms?1:-1}),i.currentState=e[0].physicalid,i.buildTable(e)},function(t){d.unmask(i.tableContainer),i.tableContainer.innerHTML='<label style="font-family: arial; font-size: 13px;">'+h.LoadFail+"</label>",console.log("loadIterations failed: "+t)})})},buildUI:function(){this.tableContainer=e.createElement("div",{styles:{height:"100%"}});var t=new n,s=this;this.dlg=t.create(this.tableContainer,{title:h.Title+" - "+this.object.displayName,OKBtnText:h.RestoreIterationSW,closeButton:!0,resizable:!0,buttonStyle:t.buttonStyle.okCancel,enableCmd:function(){return null!=s.selected},onOk:function(){s.close();var t='{"operation":"iterations/replaceContent","iterationPhysicalid":"'+s.selected+'","familyPhysicalid":"'+s.familyPhysicalid+'"}';i.publish("webinwin:web:notification",t)},onClose:function(){s.close()}},this),this.dlg.cmdDlg=t,this.dlg.inject(widget.body);var o=widget.getValue("iterations_dlg_size");null==o&&(o='{ "width":600, "height":300 }'),this.dlg.setNewSize(JSON.parse(o)),setTimeout(function(){s.dlg.setMinSize(280,220)},10)},onSelect:function(t){this.selected=t,this.dlg.cmdDlg.updateUI()},buildTable:function(t){for(var e=this,n=new r({}),s=-1,o=0;o<t.length;o++){var d=t[o],c=t.length-o-1,u=new l({grid:{numberLabel:c.toString(),name:d.name.replace("*(Current State)"," "+h.LastSavedModelStringSW),date:d.date.replace("(*)","")}});u.physicalid=d.physicalid,e.selected==d.physicalid&&(s=o),n.addChild(u)}var m=new a({class:"iterationsTreeListView2",enableListSelection:!0,treeDocument:n,selection:{rowHeaders:!1,columnHeaders:!0,canMultiSelect:!1},resize:{columns:!0,rows:!1},columns:[{dataIndex:"tree",isHidden:!0},{text:h.iterationNumberSW,dataIndex:"numberLabel",width:"10%",fontWeight:"bolder",sortFunction:function(t,e){var i=parseInt(t.options.grid.numberLabel,10),n=parseInt(e.options.grid.numberLabel,10);return i===n?0:i>n?1:-1}},{text:h.iterationNameSW,dataIndex:"name",width:"auto",fontWeight:"bolder"},{text:h.iterationDate,dataIndex:"date",width:"auto",fontWeight:"bolder"}]});m.getManager().onReady(function(){i.publish("odt:iterations:sw",{event:"iterations_table_ready"})}),m.getManager().getNodesXSO().onChange(function(){var t=m.getManager(),i=t.getSelectedRows();if(i.length>0){var n=t.getTreeNodeModelFromRowID(i[0]);e.onSelect(n.physicalid)}else e.onSelect(null)}),m.inject(this.tableContainer),-1!=s&&(m.getNthRoot(s).select(),m.elements.container.getElementsByClassName("wux-datagrid")[0].focus()),this.tableContainer.getElement(".wux-tree-treelistview").setStyle("height","100%"),this.tableContainer.getElement(".wux-datagrid").setStyle("height","100%"),this.tableContainer.getElement(".wux-layouts-gridengine").setStyle("height","100%"),this.tableContainer.getElement(".wux-layouts-gridengine").setStyle("min-height","80px")},close:function(){var t=this.dlg.getModalBodySize();t.height=this.dlg.getContainerHeight();var e="iterations_dlg_size";widget.getValue(e)||widget.addPreference({name:e,type:"hidden",defaultValue:"{}"}),widget.setValue(e,JSON.stringify(t)),this.dlg.cmdDlg.destroy()}})}),define("DS/IterationsWidget/Checkbox",["UWA/Controls/Abstract"],function(t){"use strict";return t.extend({init:function(t){this.label=t,this._parent({}),this.buildUI(),this.oncheck=null,this.onuncheck=null,this.checked=!1},buildUI:function(){this.elements.container=new UWA.Element("label",{text:" "+this.label,styles:{"font-family":"arial","font-size":"13px"}})}})}),define("DS/IterationsWidget/CGRViewer",["UWA/Controls/Abstract","DS/Visualization/WebGLV6Viewer","DS/Visualization/Node3D","DS/Visualization/Viewpoint","DS/Visualization/ModelLoader","DS/Visualization/ThreeJS_DS"],function(t,e,i,n,s,o){"use strict";return t.extend({init:function(t,e,i){this._parent({}),this.buildUI(),this.onViewpointMove=null},buildUI:function(){this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%"}}),this.elements.container.setAttribute("data-rec-id","iterationsPlayer-CGRViewerContainer"),this.viewer=new e({div:this.elements.container,antiAliasing:"SMAA",useShadowMap:!1,infinitePlane:!1,displayGrid:!1,usePicking:!1}),this.viewer.setVisuEnv("None"),this.viewer.setLightOnViewpoint(!0),this.viewpoint=new n(this.viewer),this.viewpoint.setDefaultController(!0,"CATIA"),this.viewer.setPicking({activated:!0,computeNormalDepth:!0,displayHL:!0,primitive:!1,trapSelection:!0}),this.viewer.setPrePicking({activated:!0,computeNormalDepth:!0,disableWhileMoving:!0,displayHL:!0,gpu:!0,primitive:!1});var t=this;this.viewpoint.onMove(function(){if(t.viewer.render(),null!=t.onViewpointMove){var e=t.getViewpointJson();t.onViewpointMove(e)}}),this.viewer.addViewpoint(this.viewpoint),this.modelLoader=new s(this.viewer.getWebGLContext(),!1),this.sceneGraph=new i,this.viewer.addNode(this.sceneGraph),this.modelLoader.setSceneGraph(this.sceneGraph),this.modelLoader.setRenderCallback(this.viewer.render),this.modelLoader.setFileType("cgr")},getViewpointJson:function(){var t={target:this.viewpoint.control.target,orientation:this.viewpoint.control.orientation,distanceToTarget:this.viewpoint.control.distanceToTarget};return JSON.stringify(t)},setViewpoint:function(t){if(this.getViewpointJson()!=t){var e=JSON.parse(t),i={};i.target=new o.Vector3(e.target.x,e.target.y,e.target.z),i.orientation=new o.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),i.distanceToTarget=e.distanceToTarget,this.viewpoint.control.moveTo(i)}},loadModels:function(t){if(null!=t){var e=0,i=this;!function t(n){if(!(e>=n.length)){var s=n[e];i.loadModel(s,function(){e++,t(n)})}}(t)}},loadModel:function(t,e){var n=this,s=new i(t);s.setVisibility(!1),this.sceneGraph.addChild(s);var o=t;this.modelLoader.setOnLoadedCallback(function(){n.viewpoint.reframe(),e()});var r=new XMLHttpRequest;r.onload=function(t){var e=new Uint8Array(t.target.response);n.modelLoader.loadModelFromBuffer(e,s)},r.onerror=function(){console.log("Load failed !")},r.open("GET",o,!0),r.responseType="arraybuffer",r.send(null)},showModel:function(t){if(this.hideAll(),null!=t){var e=this.sceneGraph.getChildByName(t);null!=e&&(e.setVisibility(!0),this.viewer.render())}},hideAll:function(){for(var t=this.sceneGraph.children.length,e=0;e<t;e++){this.sceneGraph.children[e].setVisibility(!1)}this.viewer.render()}})}),define("DS/IterationsWidget/CGRViewerWidget",["UWA/Controls/Abstract"],function(t){"use strict";return t.extend({init:function(t,e,i){this._parent({}),this.lang=t,this._isWebInWin=e,this._isODT=i,this.bufferedModels=null,this.bufferedActiveModel=null,this.id=this.register(),this.cgrViewerLoaded=!1,this.bufferedOnViewpointMove=null,this.onViewpointMove=null,window["onCGRViewerFrameLoaded"+this.id]=this.onCGRViewerFrameLoaded,window["onCGRViewerViewpointMove"+this.id]=this.onCGRViewerViewpointMove,this.buildUI()},loadModels:function(t){this.bufferedModels=t,this.loadBufferedModels()},showModel:function(t){this.bufferedActiveModel=t,this.showBufferedModel()},setViewpoint:function(t){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.setViewpoint(t)},register:function(){window.cgrViewers=window.cgrViewers||[];var t=window.cgrViewers.length;return window.cgrViewers[t]=this,t},buildUI:function(){this.iframe=UWA.createElement("iframe"),this.iframe.src="CGRViewer.html?id="+this.id+"&lang="+this.lang,this.iframe.className="CGRViewerWidget",this.iframe.width="100%",this.iframe.height="100%",this.iframe.style.border="0px",this.elements.container=this.iframe,this.iframe.setAttribute("data-rec-id","CGRViewerWidget"),this.iframe.setAttribute("data-rec-frame-id","CGRViewerWidget")},onCGRViewerFrameLoaded:function(t){var e=window.cgrViewers[t];e.cgrViewerLoaded=!0,e.loadBufferedModels(),e.showBufferedModel(),e.addBufferedViewpointMoveEventListener()},onCGRViewerViewpointMove:function(t,e){var i=window.cgrViewers[t];null!=i.onViewpointMove&&i.onViewpointMove(e)},loadBufferedModels:function(){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.loadModels(this.bufferedModels)},showBufferedModel:function(){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&this.iframe.contentWindow.showModel(this.bufferedActiveModel)},addViewpointMoveEventListener:function(t){this.bufferedOnViewpointMove=t,addBufferedViewpointMoveEventListener()},addBufferedViewpointMoveEventListener:function(){1==this.cgrViewerLoaded&&null!=this.iframe.contentWindow&&(this.iframe.contentWindow.onViewpointMove=this.bufferedOnViewpointMove)}})}),define("DS/IterationsWidget/TimelineData",["UWA/Class"],function(t){"use strict";return t.extend({init:function(){this.data=[]},add:function(t,e,i,n){var s={id:t,time:e,label:i,img:n};this.data.push(s)},getCount:function(){return this.data.length},get:function(t){return this.data[t]},getMaxTimespan:function(){var t=this.data.length;return 0==t||1==t?0:this.data[t-1].time-this.data[0].time},getMinTimespan:function(){for(var t=this.data.length,e=0,i=0;i<t-1;i++){var n=this.data[i+1].time-this.data[i].time;0==i?e=n:n<e&&(e=n)}return e}})}),define("DS/IterationsWidget/IterationsWidget",["UWA/Controls/Abstract","UWA/Core","DS/UIKIT/Modal","i18n!DS/IterationsWidget/assets/nls/IterationsWidget","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WebappsUtils/WebappsUtils","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/LifecycleControls/assets/styles/LifecycleModals"],function(t,e,i,n,s,o,r,a,l){"use strict";return t.extend({defaultOptions:{wintop:!1,addinmode:null},setOptions:function(t){this._options=t},setODT:function(t){this._isODT=t},executeCmd:function(t,e,i){this.usage=null;null!=e&&e.context&&e.context.selectedNodesObjects&&Array.isArray(e.context.selectedNodesObjects)&&e.context.selectedNodesObjects.length>0&&(this.usage=e.context.selectedNodesObjects[0]["attribute[PLMEntity.V_usage]"]),null!=e&&this.setODT(e.isODT),console.log("options = "+e.isODT),this.setOptions({wintop:!1}),this._parent(e),this.buildUI(),this.setObject(t.length>0?t[0]:null),this.showDialog(document.body),i()},buildUI:function(){var t=this.elements.container=e.createElement("iframe");t.style.width="100%",t.style.height="100%"},buildWebInWinUI:function(t,i,n){this._isWebInWinODTMode=i;var s=null;s=this.elements.container=null==n?e.createElement("iframe",{id:"iterationsWidgetIframe","data-socket":t}):e.createElement("iframe",{id:"iterationsWidgetIframe","data-socket":t,"data-addinmode":n}),this.addinmode=n,s.style.width="100%",s.style.height="100%",1==this._isWebInWinODTMode&&(s.setAttribute("data-rec-id",s.id+t),s.setAttribute("data-rec-frame-id",s.id))},setObject:function(t){var e;if(this.object=t,null==t)throw n.NoInput;if("clear"!==(e=t.physicalid)){if(1!=this._options.wintop){if("Folder"==t.type||"RootFolder"==t.type)throw n.Folder+n.iterationUnsupportedType;var i=!1;if(e.startsWith("cid:")&&(i=!0),"CATPart"===t.type&&(i=!0),"3DShape"===t.type&&(i=!0),"3DPart"===this.usage&&(i=!0),!i)throw t.type+n.iterationUnsupportedType}this.tenant=t.tenant;var a="";if(!0===this._isWebInWinODTMode||!0===this._isODT)a=r.getWebappsBaseUrl()+"../IterationsWidget/Iterations.html?objectId="+e,a+="&_isWebInWinODTMode=true";else try{var l="";this.addinMode&&(l=this.addinmode),a=o.get3DSpaceWSUrl(this.tenant,"/webapps/IterationsWidget/Iterations.html","objectId="+e+"&addinmode="+l)}catch(t){}var d=widget.lang;a+="&lang="+d;var h=this;!0===this._isWebInWinODTMode||!0===this._isODT?h.elements.container.src=a:require(["DS/UWPClientCode/PublicAPI"],function(t){s.getSecurityContextPromise(h.tenant).then(function(t){a+="&SecurityContext="+t,h.elements.container.src=a})})}else this.elements.container.src="clear"},showDialog:function(t){var e=this,s="";null!=this.object&&(s=" - "+this.object.name+" "+this.object.revision);for(var o="IterationsWidgetDialog Lifecycle_Modals",r=t.getElementsByClassName(o),l=r.length,d=0;d<l;d++){var h=r[d];t.removeChild(h)}var c=new i({className:o,closable:!0,header:n.get("Title")+s});if(c.inject(t),c.setBody(this),c.elements.container.setStyle("top","20px"),c.elements.wrapper.setStyle("width","100%"),c.elements.wrapper.setStyle("height","100%"),c.elements.content.setStyle("height","100%"),c&&c.elements&&c.elements.header){var u=c.elements.header.getElement(".close.fonticon.fonticon-cancel");u&&(u.setText("×"),u.removeClassName("fonticon"),u.removeClassName("fonticon-cancel"),u.setAttributes({title:a.close})),c.elements.closeTooltip&&c.elements.closeTooltip.elements&&c.elements.closeTooltip.elements.container.addClassName("hideDefaultTooltip")}c.show(),e.myModal=c,widget.addEvent("onRefresh",function(){null!=e.myModal&&(e.myModal.destroy(),e.myModal=null)});var m=!1;this.object&&this.object.physicalid&&this.object.physicalid.startsWith("cid:")&&(m=!0),m&&c.elements.content.setStyle("resize","both"),m&&c.elements.content.setStyle("overflow","hidden"),m&&c.elements.content.setStyle("cursor","move");var g=c.elements.content,f=0,p=0,w=0,v=0;function b(t){(t=t||window.event).preventDefault(),f=w-t.clientX,p=v-t.clientY,w=t.clientX,v=t.clientY,g.style.top=g.offsetTop-p+"px",g.style.left=g.offsetLeft-f+"px"}function y(){document.onmouseup=null,document.onmousemove=null}m&&(c.elements.header.getChildren()[1].onmousedown=function(t){if((t=t||window.event).preventDefault(),w=t.clientX,v=t.clientY,document.onmouseup=y,document.onmousemove=b,"absolute"!==g.style.position){var e=g.clientHeight,i=g.clientWidth;g.style.position="absolute",g.style.height=e+"px",g.style.width=i+"px"}})}})}),define("DS/IterationsWidget/ContextMenu",["UWA/Class"],function(t){"use strict";return t.extend({init:function(){this._parent({}),this.contextMenu=new UWA.Element("div",{class:"wux-afr-contextual-menu",styles:{position:"absolute",top:"115px",left:"210px",visibility:"hidden"}});var t=new UWA.Element("div",{class:"wux-afr wux-afr-view wux-afr-state-labels"});t.inject(this.contextMenu);var e=new UWA.Element("div",{class:"wux-afr-cmdWorkbench",styles:{display:"inline-block"}});e.inject(t),this.cmdContainer=new UWA.Element("div",{class:"wux-afr-cmdContainer","data-name":"Views","data-visibility":"1","data-representationtype":"AfrActionBarSection"}),this.cmdContainer.inject(e)},inject:function(t){this.contextMenu.inject(t);var e=this,i=!1,n=!1;t.onmousedown=function(t){2==t.button&&(i=!0)},t.onmousemove=function(t){i&&(n=!0)},t.oncontextmenu=function(t){if(n)return i=!1,n=!1,!0;if(0!=t.buttons)return!0;i=!1,n=!1;var s=t.clientX,o=t.clientY;return e.contextMenu.setStyle("top",o+"px"),e.contextMenu.setStyle("left",s+"px"),e.contextMenu.setStyle("visibility","visible"),!1},t.onclick=function(t){e.contextMenu.setStyle("visibility","hidden")}},addMenuItem:function(t,e,i){var n=this,s=new UWA.Element("div",{class:"wux-afr-cmdstarter",events:{click:function(){i(),n.contextMenu.setStyle("visibility","hidden")}}});s.inject(this.cmdContainer),new UWA.Element("div",{styles:{width:"32px",height:"32px","line-height":"32px",display:"inline-block","vertical-align":"top","background-size":"cover","background-image":'url("'+t+'")'}}).inject(s),new UWA.Element("div",{class:"wux-afr-label",styles:{display:"inline-block"},text:e}).inject(s)}})}),define("DS/IterationsWidget/Timer",["UWA/Class"],function(t){"use strict";return t.extend({init:function(t,e){this.interval=t,this.timeout=e,this.ontick=null,this.ontimeout=null,this.id=null,this.elapsed=0},start:function(){this.elapsed=0,this.stop(),this.resume()},stop:function(){this.pause()},pause:function(){clearInterval(this.id)},resume:function(){var t=this;this.id=setInterval(function(){if(t.elapsed+=t.interval,null!=t.timeout&&t.elapsed>=t.timeout)return t.stop(),void t.postTimeoutEvent();t.postIntervalEvent()},t.interval)},postIntervalEvent:function(){null!=this.ontick&&this.ontick()},postTimeoutEvent:function(){null!=this.ontimeout&&this.ontimeout()}})}),define("DS/IterationsWidget/CGRViewerContextMenu",["UWA/Class","DS/IterationsWidget/ContextMenu"],function(t,e){"use strict";return t.extend({init:function(t){this._parent({}),this.cgrViewer=t,this.root3DSpaceUrl=this.get3DSpaceUrl(),this.menu=new e;var i=this;this.getNls(function(t){i.addMenuItems(t)})},getNls:function(t){var e=getUrlParamVal("lang"),i={};require(["text!DS/IterationsWidget/assets/nls/IterationsWidget_"+e+".json"],function(e){i.json=JSON.parse(e),i.get=function(t){return i.json[t]},t(i)})},addMenuItems:function(t){this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_NoVisuEnv.png",t.get("Basic"),"None"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_WhiteMirrorVisuEnv.png",t.get("WhiteReview"),"V6"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_CleanSpaceVisuEnv.png",t.get("PureWhite"),"CleanSpace"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_DarkBlueVisuEnv.png",t.get("BlueDesign"),"DarkBlue"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_DarkGreyVisuEnv.png",t.get("DarkReview"),"DarkGrey"),this.addMenuItem("/webapps/ViewerCommands/assets/icons/32/$/I_ShinyVisuEnv.png",t.get("DarkMirror"),"Shiny")},addMenuItem:function(t,e,i){var n=this;this.menu.addMenuItem(this.root3DSpaceUrl+t,e,function(){n.cgrViewer.setVisuEnv(i)})},get3DSpaceUrl:function(){var t=window.location.href,e=t.indexOf("webapps");return t.substring(0,e)},inject:function(t){this.menu.inject(t)}})}),define("DS/IterationsWidget/Tooltip",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],function(t,e){"use strict";var i=t.singleton({init:function(){this.fontSize=12,this.frameThickness=3,i.container=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.container.setAttribute("style","position:absolute;z-index:1000"),i.text=document.createElementNS("http://www.w3.org/2000/svg","text"),i.text.setAttribute("style","-webkit-user-select:none"),i.text.setAttribute("font-family","Arial, sans-serif"),i.text.setAttribute("font-size",this.fontSize),i.text.setAttribute("y",0),i.text.setAttribute("text-anchor","middle"),i.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),i.container.appendChild(i.rect),i.container.appendChild(i.text),i.rect.setAttribute("style","fill:#fff;stroke-width:1;stroke:#000"),this._parent({})},show:function(t,e,n,s){i.text.textContent="",this.addTextContent(n),document.body.appendChild(i.container);var o=i.text.getBoundingClientRect();this.w=o.width+2*this.frameThickness,this.h=o.height+2*this.frameThickness,i.container.style.width=this.w+1,i.container.style.height=this.h+1,i.container.setAttribute("height",this.h+1),i.container.style.top=e+"px",i.container.style.left=t-o.width/2+"px",i.rect.setAttribute("width",this.w),i.rect.setAttribute("height",this.h),i.rect.setAttribute("transform","translate(1, 0)"),i.text.setAttribute("transform","translate("+this.w/2+", 0)"),i.container.offsetLeft<0?i.container.style.left="0px":i.container.offsetLeft+this.w>window.innerWidth&&(i.container.style.left=window.innerWidth-this.w+"px"),i.container.offsetTop<0?i.container.style.top="0px":i.container.offsetTop+this.h>window.innerHeight&&(i.container.style.top=window.innerHeight-this.h+"px")},addTextContent:function(t){var e=t.split("<br>"),i=e.length;this.lines=i;for(var n=0;n<i;n++){var s=document.createElementNS("http://www.w3.org/2000/svg","tspan");s.setAttribute("x","0"),s.setAttribute("dy","1.2em"),s.textContent=e[n],this.text.appendChild(s)}},hide:function(){null!=i.container.parentNode&&i.container.parentNode.removeChild(i.container)}});return UWA.namespace("DS/IterationsWidget/Tooltip",i)}),define("DS/IterationsWidget/TimelineSlider",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],function(t,e){"use strict";return t.extend({init:function(t){this.mouseOffStrokeColor="#368ec4",this.mouseOverStrokeColor="#77797c",this.mouseOnStrokeColor="#003c5a",this.mouseOffFillColor="#f1f1f1",this.mouseOverFillColor="#f1f1f1",this.mouseOnFillColor="#005685",this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.setAttribute("class","timeline-slider"),this.container.setAttribute("data-rec-id","timeline-slider"),this.mousedown=!1,this.x=0,this.thickness=6,this.timeline=t,this._parent({}),this.rect=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.rect.setAttribute("data-rec-id","timeline-slider-polygon"),this.rect.setAttribute("style","fill:"+this.mouseOffFillColor+";stroke:"+this.mouseOffStrokeColor+";stroke-width:2"),this.container.appendChild(this.rect),this.rect.onmousedown=this.onmousedown.bind(this),this.rect.onmouseenter=this.onmouseenter.bind(this),this.rect.onmouseleave=this.onmouseleave.bind(this),document.addEventListener("mousemove",this.onmousemove.bind(this)),document.addEventListener("mouseup",this.onmouseup.bind(this)),this.onmove=null,this.onbegindrag=null,this.onenddrag=null,this.onmousehover=null,this.onmouseout=null,this.w=this.timeline.config.getSliderWidth(),this.onmouseup()},inject:function(t){t.appendChild(this.container)},setPosition:function(t){t>1?t=1:t<0&&(t=0);var i=this.timeline.getWidth();this.x=i*t;var n=this.timeline.config.getSliderWidth(),s=this.timeline.timelineToCanvas(this.x),o=this.timeline.config.getPaddingTop()-this.thickness,r=this.timeline.config.getTimepointHeight()+2*this.thickness;new e(s-n/2,o).add(n,0).add(0,r).add(-n,0);this.rect.setAttribute("cx",s),this.rect.setAttribute("cy",o+r/2),this.rect.setAttribute("r",r/2),null!=this.onmove&&this.onmove(t)},onmousedown:function(t){var e=null==t.offsetX?t.layerX:t.offsetX;this.clickXOffset=this.timeline.canvasToTimeline(e)-this.x,this.mousedown=!0,t.cancelBubble=!0,t.stopPropagation(),t.preventDefault(),null!=this.onbegindrag&&this.onbegindrag(),this.rect.setAttribute("style","fill:"+this.mouseOnFillColor+";stroke:"+this.mouseOnStrokeColor+";stroke-width:2")},onmouseenter:function(t){this.mousedown||(this.onmousehover&&this.onmousehover(),this.rect.setAttribute("style","fill:"+this.mouseOverFillColor+";stroke:"+this.mouseOverStrokeColor+";stroke-width:2"))},onmouseleave:function(t){this.mousedown||(this.onmouseout&&this.onmouseout(),this.rect.setAttribute("style","fill:"+this.mouseOffFillColor+";stroke:"+this.mouseOffStrokeColor+";stroke-width:2"))},onmousemove:function(t){if(this.mousedown){t.preventDefault();var e=this.timeline.clientToTimeline(t.clientX)-this.clickXOffset;this.setPosition(e/this.timeline.getWidth())}},onmouseup:function(t){this.mousedown&&(this.rect.setAttribute("style","fill:"+this.mouseOverFillColor+";stroke:"+this.mouseOverStrokeColor+";stroke-width:2"),this.mousedown=!1,null!=this.onenddrag&&this.onenddrag())}})}),define("DS/IterationsWidget/Label",["UWA/Controls/Abstract","DS/IterationsWidget/Point"],function(t,e){"use strict";return t.extend({init:function(t,e){this.arrowWidth=5,this.arrowHeight=3,this.textHeight=18,this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.text=document.createElementNS("http://www.w3.org/2000/svg","text"),this.addTextContent(t),this.text.setAttribute("style","-webkit-user-select:none"),this.text.setAttribute("font-family","Arial, sans-serif");this.text.setAttribute("font-size",12),this.text.setAttribute("text-anchor","middle"),this.frameThickness=3,this.frame=document.createElementNS("http://www.w3.org/2000/svg","polygon"),this.frame.setAttribute("style","fill:#eee;stroke-width:1;stroke:#000"),this.container.appendChild(this.frame),this.container.appendChild(this.text),this.hide(),this.text.setAttribute("data-rec-id",t),this.frame.setAttribute("data-rec-id",t+"polygon")},addTextContent:function(t){var e=t.split("<br>"),i=e.length;this.lines=i;for(var n=0;n<i;n++){var s=document.createElementNS("http://www.w3.org/2000/svg","tspan");s.setAttribute("x","0"),s.setAttribute("dy","1.2em"),s.textContent=e[n],this.text.appendChild(s),s.setAttribute("data-rec-id",e[n])}},inject:function(t){t.appendChild(this.container)},show:function(){this.container.style.visibility="visible"},hide:function(){this.container.style.visibility="hidden"},getWidth:function(){return this.text.getBoundingClientRect().width+2*this.frameThickness},getHeight:function(){return this.text.getBoundingClientRect().height+2*this.frameThickness},updateFrame:function(t){var i=this.getWidth(),n=this.getHeight(),s=new e(-i/2,0),o=s.add(i,0),r=o.add(0,n),a=r.add(-3,0),l=r.add(-i,0),d=l.add(3,0),h=new e(-t,n+this.arrowHeight),c=h.add(-this.arrowWidth/2,-this.arrowHeight),u=c.add(this.arrowWidth,0);c.x<d.x?u=(c=d).add(1.5*this.arrowWidth,0):c.x+this.arrowWidth>a.x&&(c=a.add(1.5*-this.arrowWidth,0),u=a);var m=[s,o,r,a,u,h,c,d,l];this.frame.setAttribute("points",this.pointsToString(m))},update:function(t,e){var i=e+15;this.container.setAttribute("transform","translate("+t+","+i+")"),this.text.setAttribute("x","0"),this.updateFrame(t)},pointsToString:function(t){for(var e="",i=0;i<t.length;i++)0!=i&&(e+=" "),e+=t[i].toString();return e}})}),define("DS/IterationsWidget/CGRGridView",["UWA/Controls/Abstract","DS/IterationsWidget/CGRViewerWidget","DS/IterationsWidget/Checkbox"],function(t,e,i){"use strict";return t.extend({init:function(t,e,i){this._parent({}),this.elements.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%","overflow-y":"auto"},class:"CGRGridView"}),this._isODT=i,this._webinwin=e,this.elements.container.setAttribute("data-rec-id","cgrgridviewdiv"),this.cgrViewers=[],this.viewerDivs=[],this.onselectchange=null;for(var n=t.length,s=0;s<n;s++)this.addViewer(t[s])},onViewpointMove:function(t){for(var e=this.cgrViewers.length,i=0;i<e;i++){this.cgrViewers[i].setViewpoint(t)}},showSelected:function(){for(var t=this.viewerDivs.length,e=0;e<t;e++){var i=this.viewerDivs[e];i.selected?i.show():i.hide()}},showAll:function(){for(var t=this.viewerDivs.length,e=0;e<t;e++){this.viewerDivs[e].show()}},addViewer:function(t){var n=new UWA.Element("div",{styles:{display:"inline - block",width:"250px",height:"250px",border:"1px solid grey",position:"relative",float:"left","margin-top":"10px","margin-left":"20px","margin-right":"30px","margin-bottom":"0px"},class:"CGRGridViewCell"}).inject(this.elements.container);n.setAttribute("data-rec-id",t.label+"-CGRGridViewCell");var s=new e(this._isODT);this.cgrViewers.push(s),this.viewerDivs.push(n),s.inject(n);var o=[t.url];if(s.loadModels(o),s.showModel(o[0]),s.onViewpointMove=this.onViewpointMove.bind(this),null!=t.label){var r=new UWA.Element("div",{styles:{width:"100%",height:"20px",bottom:"0px",position:"absolute",color:"rgb(142, 142, 142)","text-align":"center","background-color":"rgba(255,255,255,0.9)","font-family":"arial","font-size":"13px"},class:"CGRGridViewCellLabel"});r.setAttribute("data-rec-id",t.label+"CGRGridViewCellLabel"+this.viewerDivs.length),r.inject(n),new i(t.label).inject(r)}},setODT:function(t){this._isODT=t}})}),define("DS/IterationsWidget/IterationsGrid",["UWA/Controls/Abstract","DS/IterationsWidget/CGRGridView","DS/IterationsWidget/Checkbox"],function(t,e,i){"use strict";return t.extend({init:function(t,e,i,n,s){i,this.iterations=t,this.top=e,this._webinwin=n,this._parent({}),this._isODT=s,this.elements.container=new UWA.Element("div",{styles:{position:"absolute",top:this.top+"px",height:"calc(100% - "+this.top+"px)",width:"100%"},class:"IterationsGrid"}),this.elements.container.setAttribute("data-rec-id","IterationsGridDiv"),this.hide(),this.uiBuilt=!1},hide:function(){this.elements.container.style.visibility="hidden"},show:function(){this.elements.container.style.visibility="visible",0==this.uiBuilt&&(this.uiBuilt=!0,this.buildUI())},buildUI:function(){new UWA.Element("div",{styles:{position:"absolute",top:"-22px",left:"150px","z-index":"200"}}).inject(this.elements.container).setAttribute("data-rec-id","IterationsGridShowOptionsDiv");for(var t=[],i=this.iterations.length,n=0;n<i;n++){var s=this.iterations[n];t.push({url:s.cgr,label:s.date})}var o=new e(t,this._webinwin,this._isODT);o.inject(this.elements.container),o.showAll(),o.onselectchange=function(){}}})}),define("DS/IterationsWidget/Timepoint",["UWA/Controls/Abstract","DS/IterationsWidget/Label","DS/IterationsWidget/Tooltip"],function(t,e,i){"use strict";return t.extend({init:function(t,i,n,s,o){this.container=document.createElementNS("http://www.w3.org/2000/svg","g"),this.container.setAttribute("class","timeline-timepoint"),this._isODT=o,this.parent=s,this.obj=t,this.timeline=i,this.nextTimepoint=null,this.previousTimepoint=n,null!=n&&(n.nextTimepoint=this),this.h=this.timeline.config.getTimepointHeight(),this.y=this.timeline.config.getPaddingTop(),this._parent({}),this.color="rgb(54, 142, 196)",this.line=document.createElementNS("http://www.w3.org/2000/svg","line"),this.line.setAttribute("style","stroke:"+this.color+";stroke-width:2"),this.line.setAttribute("x1",0),this.line.setAttribute("y1",this.y),this.line.setAttribute("x2",0),this.line.setAttribute("y2",this.y+this.h),this.rect=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.rect.setAttribute("y",this.y-5),this.container.appendChild(this.rect),this.container.appendChild(this.line),this.from=0,this.to=this.timeline.getWidth(),this.hilighted=!1,this.label=new e(this.obj.label,this._isODT),this.label.inject(this.container),this.resetRectStyle(),this.container.setAttribute("data-rec-id","timeline-timepoint"),this.rect.setAttribute("data-rec-id","timeline-timepoint-rectangle")},getNext:function(){return this.nextTimepoint},getPrevious:function(){return this.previousTimepoint},activate:function(){var t=this.getPercentPosition();this.timeline.moveSlider(t)},inject:function(t){t.appendChild(this.container)},hilight:function(){this.unprehilight(),this.hilighted=!0,this.rect.setAttribute("style","fill:#368ec4;stroke-width:0"),this.rect.setAttribute("height",2),this.label.show()},unhilight:function(){this.hilighted=!1,this.resetRectStyle(),this.line.style.stroke=this.color,this.label.hide()},prehilight:function(t){if(!this.hilighted){this.rect.setAttribute("style","fill:#ccc;stroke-width:0"),this.rect.setAttribute("height","2");var e=this.container.getBoundingClientRect(),n=this.timeline.timelineToClient(t);i.show(n,e.top,this.obj.label)}},unprehilight:function(){this.hilighted||(this.resetRectStyle(),i.hide())},resetRectStyle:function(){this.rect.setAttribute("height","0")},getPercentPosition:function(){var t=this.timeline.getData(),e=t.getCount();if(1==e)return.5;var i=t.get(0).time,n=t.get(e-1).time;return(this.obj.time-i)/(n-i)},getPosition:function(){var t=this.timeline.getWidth();return this.getPercentPosition()*t},calcFromTo:function(){this.from=0,this.to=this.timeline.getWidth(),null!=this.previousTimepoint&&(this.from=(this.previousTimepoint.x+this.x)/2,this.previousTimepoint.to=this.from)},updateLabel:function(){var t=0,e=this.label.getWidth();this.x-e/2<0?t=e/2-this.x:this.timeline.getWidth()-this.x<e/2&&(t=this.timeline.getWidth()-this.x-e/2),this.label.update(t,0)},onResize:function(t){this.y;this.x=this.getPosition(),this.updateLabel(),this.calcFromTo()},onResized:function(){this.container.setAttribute("transform","translate("+this.x+")"),this.rect.setAttribute("x",this.from-this.x);var t=this.to-this.from;t>0&&this.rect.setAttribute("width",t)},getPercent:function(t){return(t*this.timeline.getWidth()-this.from)/(this.to-this.from)},hitTestX:function(t){return this.from<=t&&t<=this.to},hitTestY:function(t){return t>=this.y&&t<=this.y+this.h},hitTest:function(t,e){return null==e?this.hitTestX(t):this.hitTestX(t)&&this.hitTestY(e)},onmousemove:function(t,e){this.prehilight(t)},onmouseout:function(){this.unprehilight()}})}),define("DS/IterationsWidget/TimelineWidget",["UWA/Controls/Abstract","DS/IterationsWidget/Timepoint","DS/IterationsWidget/TimeAxis","DS/IterationsWidget/TimelineSlider","DS/IterationsWidget/TimelineConfig"],function(t,e,i,n,s){"use strict";return t.extend({init:function(t,e){this.width=500,this.config=new s,this.data=t,this._isODT=e,this.svg=null,this._parent({}),window.addEventListener("resize",this.onResize.bind(this)),this.timepoints=[],this.timeaxis=null,this.slider=null,this.buildUI(),this.activeTimepoint=null,this.lastActiveTimepoint=null,this.sliderPosition=0,this.lastHoverTimepoint=null,this.activeTimepointChanged=null,this.activeTimepointChangedFromList=null,this.onsliderbegindrag=null,this.onsliderenddrag=null},buildUI:function(){this.container=new UWA.Element("div",{styles:{"overflow-x":"auto","overflow-y":"hidden",width:"100%",height:"100%"},class:"timeline-container"}),this.container.setAttribute("data-rec-id","timeline-container"),this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("class","timeline-canvas"),this.svg.setAttribute("style","position:relative;height:100%;"),this.container.appendChild(this.svg),this.buildTimeAxis(),this.timepointContainer=document.createElementNS("http://www.w3.org/2000/svg","g"),this.timepointContainer.setAttribute("class","timeline-timepoints");var t=this.config.getPaddingLeft()+this.config.getSliderWidth()/2;this.timepointContainer.setAttribute("transform","translate("+t+")"),this.svg.appendChild(this.timepointContainer),this.buildTimepoints(),this.buildSlider(),this.container.addEventListener("mousedown",this.onmousedown.bind(this)),this.container.addEventListener("mousemove",this.onmousemove.bind(this)),this.svg.setAttribute("data-rec-id","timeline-canvas"),this.timepointContainer.setAttribute("data-rec-id","timeline-timepoints")},getActiveTimepoint:function(){return this.activeTimepoint},moveSlider:function(t){this.slider.setPosition(t)},moveSliderFromList:function(t){this.slider.setPosition(t)},getWidth:function(){return this.width},onmousedown:function(t){var e=null==t.offsetY?t.layerY:t.offsetY;if(this.hitTestY(e)){var i=null==t.offsetX?t.layerX:t.offsetX,n=this.canvasToTimeline(i)/this.getWidth();this.moveSlider(n)}},hitTestY:function(t){var e=this.config.getTimepointHeight(),i=this.config.getPaddingTop();return t>=i&&t<=i+e},onmousemove:function(t){var e=null==t.offsetY?t.layerY:t.offsetY,i=null==t.offsetX?t.layerX:t.offsetX,n=this.canvasToTimeline(i);null!=this.lastHoverTimepoint&&0==this.lastHoverTimepoint.hitTest(n,e)&&this.lastHoverTimepoint.onmouseout();for(var s=0;s<this.timepoints.length;s++){var o=this.timepoints[s];if(o.hitTest(n,e)){this.lastHoverTimepoint=o,o.onmousemove(n,e);break}}},buildTimepoints:function(){for(var t=null,i=0;i<this.data.getCount();i++){var n=new e(this.data.get(i),this,t,this,this._isODT);n.inject(this.timepointContainer),t=n,this.timepoints.push(n)}},buildTimeAxis:function(){this.timeaxis=new i(this),this.timeaxis.inject(this.svg)},buildSlider:function(){this.slider=new n(this),this.slider.onmove=this.onSliderMoved.bind(this),this.slider.onenddrag=this.onSliderEndDragged.bind(this),this.slider.onbegindrag=this.onSliderBeginDragged.bind(this),this.slider.onmousehover=this.onSliderMouseHover.bind(this),this.slider.onmouseout=this.onSliderMouseOut.bind(this),this.slider.inject(this.svg)},getTimepoint:function(t){for(var e=t*this.getWidth(),i=this.timepoints.length,n=0;n<i;n++){var s=this.timepoints[n];if(s.hitTest(e))return s.index=n,s}return null},getSliderPosition:function(){return this.sliderPosition},getSlider:function(){return this.slider},getScrollLeft:function(){return this.container.scrollLeft},recalcWidth:function(){var t=this.container.offsetWidth;this.width=t,this.width-=this.config.getPaddingLeft(),this.width-=this.config.getPaddingRight(),this.width-=this.config.getSliderWidth()},getData:function(){return this.data},onResize:function(t){this.recalcWidth(),this.svg.style.width=this.getWidth()+this.config.getSliderWidth()+this.config.getPaddingLeft()+this.config.getPaddingRight()+"px";for(var e=0;e<this.timepoints.length;e++)this.timepoints[e].dispatchEvent("onResize");for(e=0;e<this.timepoints.length;e++)this.timepoints[e].onResized();this.timeaxis.dispatchEvent("onResize"),this.moveSlider(this.sliderPosition)},onSliderMoved:function(t){null!=this.activeTimepoint&&this.activeTimepoint.unhilight(),this.activeTimepoint=this.getTimepoint(t),null!=this.activeTimepoint&&this.activeTimepoint.hilight(),this.sliderPosition=t,null!=this.activeTimepointChanged&&null!=this.activeTimepoint&&this.lastActiveTimepoint!=this.activeTimepoint&&(this.activeTimepointChanged(this.activeTimepoint.obj.id),this.lastActiveTimepoint=this.activeTimepoint),this.timeaxis.onSliderMoved(t)},onSliderMovedFromList:function(t){this.activeTimepoint=this.getTimepoint(t),null!=this.activeTimepoint&&this.activeTimepoint.hilight(),this.sliderPosition=t,null!=this.activeTimepointChangedFromList&&null!=this.activeTimepoint&&this.lastActiveTimepoint!=this.activeTimepoint&&(this.activeTimepointChangedFromList(this.activeTimepoint.obj.id),this.lastActiveTimepoint=this.activeTimepoint,this.lastHoverTimepoint.unhilight(),this.lastHoverTimepoint=this.activeTimepoint,this.lastHoverTimepoint.hilight())},onSliderMouseHover:function(){this.timeaxis.setMouseOverSliderStyle()},onSliderMouseOut:function(){this.timeaxis.setMouseOffSliderStyle()},onSliderBeginDragged:function(){null!=this.onsliderbegindrag&&this.onsliderbegindrag(),this.timeaxis.setMouseOnSliderStyle()},onSliderEndDragged:function(){null!=this.onsliderenddrag&&this.onsliderenddrag(),this.timeaxis.setMouseOverSliderStyle()},addActiveTimepointChangeEventListener:function(t){this.activeTimepointChanged=t},addActiveTimepointChangeFromListEventListener:function(t){this.activeTimepointChangedFromList=t},clientToTimeline:function(t){var e=this.clientToCanvas(t);return this.canvasToTimeline(e)},canvasToTimeline:function(t){return t-this.config.getPaddingLeft()-this.config.getSliderWidth()/2},timelineToCanvas:function(t){return t+this.config.getPaddingLeft()+this.config.getSliderWidth()/2},timelineToClient:function(t){var e=this.timelineToCanvas(t);return this.canvasToClient(e)},clientToCanvas:function(t){var e=this.getCanvasClientLeft();return t+this.getScrollLeft()-e},canvasToClient:function(t){var e=this.getCanvasClientLeft();return t-this.getScrollLeft()+e},getCanvasClientLeft:function(){return this.container.getClientRects()[0].left}})}),define("DS/IterationsWidget/IterationsPlayer",["UWA/Controls/Abstract","DS/IterationsWidget/Toolbar","DS/IterationsWidget/CGRViewerWidget","DS/IterationsWidget/TimelineData","DS/IterationsWidget/TimelineWidget","DS/IterationsWidget/Timer","DS/IterationsWidget/Tooltip"],function(t,e,i,n,s,o,r){"use strict";var a=null;return t.extend({init:function(t,e,i,n,s,r){a=i,this.lang=n,this.paused=!1,this.viewEvenly=e,this.iterations=t,this._bIsWebinwin=s,this._isODT=r,this._parent({}),this.buildUI(),this.hide(),this.interval=10,this.iterationDuration=1e3,this.timer=null,this.timer=new o(this.interval),this.timer.ontick=this.onTimerTick.bind(this),this.timer2=null,this.timer2=new o(this.interval),this.timer2.ontick=this.onTimer2Tick.bind(this)},buildUI:function(){this.container=new UWA.Element("div",{styles:{position:"absolute",height:"100%",width:"100%"},class:"IterationsPlayer"});this.timelineContainer=new UWA.Element("div",{styles:{position:"absolute",height:"80px",width:"100%",left:"0px",bottom:"25px"}}),this.timelineContainer.inject(this.container);var t=new e(25,25,"bottom");this.firstButton=t.addButton("assets/images/first.png",a.get("First")),this.firstButton.onclick=this.first.bind(this),this.previousButton=t.addButton("assets/images/previous.png",a.get("Previous")),this.previousButton.onclick=this.previous.bind(this),this.backPlayButton=t.addButton("assets/images/back_play.png",a.get("BackPlay")),this.backPlayButton.onclick=this.backPlay.bind(this),this.pauseButton=t.addButton("assets/images/pause.png",a.get("Pause")),this.pauseButton.onclick=this.pause.bind(this),this.playButton=t.addButton("assets/images/play.png",a.get("Play")),this.playButton.onclick=this.play.bind(this),this.nextButton=t.addButton("assets/images/next.png",a.get("Next")),this.nextButton.onclick=this.next.bind(this),this.lastButton=t.addButton("assets/images/last.png",a.get("Last")),this.lastButton.onclick=this.last.bind(this),t.inject(this.container),t.center(),this.buildTimeline(this.iterations),this.buildCGRViewer(this.iterations),this.timelineContainer["data-rec-id"]="timeLineContainer",this.container["data-rec-id"]="iterationsPlayer"},hide:function(){this.container.style.visibility="hidden",this.removeTimeline(),r.hide()},showEvenly:function(){this.container.style.visibility="visible",this.viewEvenly=!0,this.buildTimeline(this.iterations)},showPropotionally:function(){this.container.style.visibility="visible",this.viewEvenly=!1,this.buildTimeline(this.iterations)},buildTimeline:function(t){if(this.removeTimeline(),null!=t){this.timelineData=this.getTimelineData(t),this.timeline=new s(this.timelineData,this._isODT),this.timeline.inject(this.timelineContainer),this.timeline.addActiveTimepointChangeEventListener(this.onActiveTimepointChange.bind(this)),!0===this._bIsWebinwin&&this.timeline.addActiveTimepointChangeFromListEventListener(this.onActiveTimepointChangeFromList.bind(this));var e=this;this.timeline.onslidermove=function(){e.container.style.pointerEvents="none"},this.timeline.onsliderenddrag=function(){e.container.style.pointerEvents=""},1==this.timelineData.getCount()?this.timeline.moveSlider(.5):this.timeline.moveSlider(1)}},buildCGRViewer:function(t){this.cgrViewer=new i(this.lang,this._bIsWebinwin,this._isODT),this.cgrViewer.inject(this.container);for(var e=[],n=t.length-1;n>=0;n--){var s=t[n];e.push(s.cgr)}e.length>0&&(this.cgrViewer.loadModels(e),this.cgrViewer.showModel(e[0]))},removeTimeline:function(){for(;this.timelineContainer.firstChild;)this.timelineContainer.removeChild(this.timelineContainer.firstChild)},getTimelineData:function(t){var e=new n,i=t.length;if(i>0)for(var s=0;s<i;s++){var o=t[s],r=o.id,l=o.date_ms;this.viewEvenly&&(l=s);var d=o.title;if(null==d&&(d=s),o.fullcontenturl)l=s,d=a.get("Iteration")+" "+o.displayed_iteration,e.add(r,l,d);else{var h=new Date(parseInt(o.date_ms)).toLocaleString();o.date.indexOf("*")>=0&&(h+="(*)");var c=(d=a.get("Iteration")+" "+d)+"<br>"+h;e.add(r,l,c)}}return e},onActiveTimepointChange:function(t){if(null!=this.cgrViewer){var e=this.getCgr(t);this.cgrViewer.showModel(e)}},onActiveTimepointChangeFromList:function(t){if(null!=this.cgrViewer){var e=this.getCgr(t);this.cgrViewer.showModel(e)}},timepointChangeFromList:function(t){if(null!=this.cgrViewer){var e=this.getCgr(t);this.cgrViewer.showModel(e);var i=this.getRowId(t),n=this.iterations.length,s=0;s=n>1?0==i?0:i==n-1?1:i/(n-1):.5,this.timeline.moveSliderFromList(s)}},getCgr:function(t){for(var e=this.iterations.length,i=0;i<e;i++){var n=this.iterations[i];if(n.id==t)return n.cgr}return null},getRowId:function(t){for(var e=this.iterations.length,i=0;i<e;i++){if(this.iterations[i].id==t)return i}return null},onTimerTick:function(){var t=this.timeline.getSliderPosition(),e=this.timeline.getTimepoint(t),i=e.index,n=e.getPercent(t),s=this.interval/this.iterationDuration;(n+=s)>=1&&(n=s/10,i++);if(i<this.iterations.length){t=this.getTimelinePosition(i,n);this.timeline.moveSlider(t)}else this.timer.stop(),this.timeline.moveSlider(1)},onTimer2Tick:function(){var t=this.timeline.getSliderPosition(),e=this.timeline.getTimepoint(t),i=e.index,n=e.getPercent(t),s=this.interval/this.iterationDuration;(n-=s)<=0&&(n=1-s/10,i--);if(i>=0){t=this.getTimelinePosition(i,n);this.timeline.moveSlider(t)}else this.timer2.stop(),this.timeline.moveSlider(0)},getTimelinePosition:function(t,e){var i=this.iterations.length;if(0==i)return 0;if(1==i)return e;var n=this.getTimepointTime(0),s=this.getTimepointTime(i-1),o=this.getTimepointTime(t),r=n;t>0&&(r=(o+this.getTimepointTime(t-1))/2);var a=s;t<i-1&&(a=(o+this.getTimepointTime(t+1))/2);return(r+e*(a-r)-n)/(s-n)},getTimepointTime:function(t){return parseInt(this.timelineData.data[t].time)},first:function(){this.pause(),this.iterations&&(this.iterations.length<=1?this.timeline.moveSlider(.5):this.timeline.moveSlider(0))},previous:function(){if(this.pause(),this.iterations)if(this.iterations.length<=1)this.timeline.moveSlider(.5);else{var t=this.timeline.getActiveTimepoint().getPrevious();null!=t&&t.activate()}},backPlay:function(){(this.timer.stop(),this.iterations)&&(this.iterations.length<=1?this.timeline.moveSlider(.5):(0==this.timeline.getSliderPosition()&&this.timeline.moveSlider(1),this.timer2.start()))},pause:function(){this.timer.stop(),this.timer2.stop()},play:function(){(this.timer2.stop(),this.iterations)&&(this.iterations.length<=1?this.timeline.moveSlider(.5):(1==this.timeline.getSliderPosition()&&this.timeline.moveSlider(0),this.timer.start()))},next:function(){if(this.pause(),this.iterations)if(this.iterations.length<=1)this.timeline.moveSlider(.5);else{var t=this.timeline.getActiveTimepoint().getNext();null!=t&&t.activate()}},last:function(){this.pause(),this.iterations&&(this.iterations.length<=1?this.timeline.moveSlider(.5):this.timeline.moveSlider(1))}})});