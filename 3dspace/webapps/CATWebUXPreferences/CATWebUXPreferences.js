/*!  Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/CATWebUXPreferences/CATWebUXPreferencesUtils",["i18n!DS/CATWebUXPreferences/assets/nls/CATWebUXPreferences"],function(e){"use strict";var t=e&&e.units?e.units:{},n=function(e){var t;if(e)switch(e.toLowerCase()){case"length":t="Length";break;case"area":t="Area";break;case"angle":t="Angle";break;case"volume":t="Volume";break;case"mass":t="Mass"}return t},i={convertValueToString:function(e,t,a){var l=a||{},r=n(t);if(!r)return window.console.warn("Magnitude not supported"),parseFloat(e);var s=localStorage.getItem("CATWebUXPreferences_Units");s&&s.length&&(s=JSON.parse(s));var o=i.Types[r],c=s&&s[r]&&s[r].unit?s[r].unit:o.defaultValue;l.unit&&(c=l.unit);var u=s&&s[r]&&"number"==typeof s[r].decimalPlaceRW&&s[r].decimalPlaceRW>=0?s[r].decimalPlaceRW:o.defaultDecimalPlaceRW,p=s&&s[r]&&"number"==typeof s[r].decimalPlaceRO&&s[r].decimalPlaceRO>=0?s[r].decimalPlaceRO:o.defaultDecimalPlaceRO;if(i[r]&&i[r][c]){var d=l.readWrite?u:p,f=parseFloat(e)*i[r][c].ratio;return f=Math.round(f*Math.pow(10,d))/Math.pow(10,d),f="true"===localStorage.getItem("CATWebUXPreferences_TrailingZeros")&&d>0?f.toFixed(d):f.toString(),l.displayUnit||void 0===l.displayUnit?f+(l.displaySpace?" ":"")+i[r][c].nls:f}return parseFloat(e)},convert:function(e,t,a,l){var r=n(t);return r?i[r][a]?i[r][l]?e/i[r][a].ratio*i[r][l].ratio:(window.console.warn("Bad second unit parameter"),e):(window.console.warn("Bad first unit parameter"),e):(window.console.warn("Magnitude not supported"),e)},isMagnitudeSupported:function(e){return void 0!==n(e)},getCurrentUnit:function(e){var t=n(e);if(!t)return window.console.warn("Magnitude not supported"),{unit:"",nls:""};var a,l=localStorage.getItem("CATWebUXPreferences_Units");l&&l.length&&(l=JSON.parse(l)),l&&l[t]&&(a=l[t].unit);var r=i.Types[t];return a||(a=r.defaultValue),{unit:a,nls:i[t][a].nls,decimalPlaceRW:l&&l[t]&&l[t].decimalPlaceRW?l[t].decimalPlaceRW:r.defaultDecimalPlaceRW,decimalPlaceRO:l&&l[t]&&l[t].decimalPlaceRO?l[t].decimalPlaceRO:r.defaultDecimalPlaceRO}},getPreference:function(e,t){var n=localStorage.getItem(e);if(n){if("int"===t)return parseInt(n);if("boolean"===t)return"true"===n}return n},Types:{Length:{name:"Length",defaultValue:"mm",defaultDecimalPlaceRW:3,defaultDecimalPlaceRO:3},Angle:{name:"Angle",defaultValue:"deg",defaultDecimalPlaceRW:3,defaultDecimalPlaceRO:3},Volume:{name:"Volume",defaultValue:"mm3",defaultDecimalPlaceRW:3,defaultDecimalPlaceRO:3},Area:{name:"Area",defaultValue:"mm2",defaultDecimalPlaceRW:3,defaultDecimalPlaceRO:3},Mass:{name:"Mass",defaultValue:"kg",defaultDecimalPlaceRW:3,defaultDecimalPlaceRO:3}},Length:{mm:{name:"mm",nls:t.mm,ratio:Math.pow(10,3)},cm:{name:"cm",nls:t.cm,ratio:Math.pow(10,2)},m:{name:"m",nls:t.m,ratio:1},km:{name:"km",nls:t.km,ratio:Math.pow(10,-3)},inch:{name:"inch",nls:t.inch,ratio:Math.pow(10,3)/25.4},foot:{name:"foot",nls:t.foot,ratio:Math.pow(10,3)/304.8}},Angle:{deg:{name:"deg",nls:t.deg,ratio:180/Math.PI},rad:{name:"rad",nls:t.rad,ratio:1}},Volume:{mm3:{name:"mm3",nls:t.mm3,ratio:Math.pow(10,9)},cm3:{name:"cm3",nls:t.cm3,ratio:Math.pow(10,6)},m3:{name:"m3",nls:t.m3,ratio:1},km3:{name:"km3",nls:t.km3,ratio:Math.pow(10,-9)},inch3:{name:"inch3",nls:t.inch3,ratio:Math.pow(10,9)/16387.064},foot3:{name:"foot3",nls:t.foot3,ratio:Math.pow(10,9)/28316846.6}},Area:{mm2:{name:"mm2",nls:t.mm2,ratio:Math.pow(10,6)},cm2:{name:"cm2",nls:t.cm2,ratio:Math.pow(10,4)},m2:{name:"m2",nls:t.m2,ratio:1},km2:{name:"km2",nls:t.km2,ratio:Math.pow(10,-6)},inch2:{name:"inch2",nls:t.inch2,ratio:Math.pow(10,6)/645.16},foot2:{name:"foot2",nls:t.foot2,ratio:Math.pow(10,6)/92903.04}},Mass:{mg:{name:"mg",nls:t.mg,ratio:Math.pow(10,6)},g:{name:"g",nls:t.g,ratio:Math.pow(10,3)},hg:{name:"hg",nls:t.hg,ratio:Math.pow(10,1)},kg:{name:"kg",nls:t.kg,ratio:1},t:{name:"t",nls:t.t,ratio:Math.pow(10,-3)},lb:{name:"lb",nls:t.lb,ratio:.45359237},oz:{name:"oz",nls:t.oz,ratio:.02835}}};return Object.freeze(i)}),define("DS/CATWebUXPreferences/CATWebUXPreferencesManager",["UWA/Core","UWA/Class","DS/Controls/Toggle","DS/Controls/SpinBox","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Expander","DS/Controls/ColorPicker","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/Label","DS/Controls/ButtonGroup","DS/DataGridView/DataGridView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/CoreEvents/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","i18n!DS/CATWebUXPreferences/assets/nls/CATWebUXPreferences"],function(e,t,n,i,a,l,r,s,o,c,u,p,d,f,g,m,b,h,v){"use strict";var x=v&&v.units?v.units:{},y=v&&v.types?v.types:{},P=t.extend({init:function(t){var P=t||{};this._parent(P);var D,C=[],S=[],V=[],W=[],T={display:!1,units:!1,sel3D:!1,sel2D:!1},A=new m,w=this;function E(e,t){A&&A.publish({event:e,data:t})}var k=b.subscribe("onWidgetPreferenceModified",function(e){var t=e?JSON.parse(e):null;t&&E(t.name,t.value)});function U(e){var t=localStorage.getItem("CATWebUXPreferences_ExpandedFlags");return t&&t.length&&(t=JSON.parse(t)),!t||"true"!==t[e]&&"false"!==t[e]||"true"===t[e]}function O(e,t){var n=localStorage.getItem("CATWebUXPreferences_ExpandedFlags");(n=n&&n.length?JSON.parse(n):{})[e]=t?"true":"false",localStorage.setItem("CATWebUXPreferences_ExpandedFlags",JSON.stringify(n))}function R(e,t){for(var n=0;n<S.length;n++)"checkbox+spinbox"!==S[n].spec.type&&"spinbox"!==S[n].spec.type||("Angle"===e?S[n].ui.spinbox.units===x.deg&&"rad"===t?(S[n].ui.spinbox.minValue=Math.PI/180,S[n].ui.spinbox.stepValue=.01,S[n].ui.spinbox.pageStepValue=.01,S[n].ui.spinbox.value=h.convert(S[n].ui.spinbox.value,e,"deg",t),S[n].ui.spinbox.maxValue=2*Math.PI,S[n].ui.spinbox.units=x.rad):S[n].ui.spinbox.units===x.rad&&"deg"===t&&(S[n].ui.spinbox.maxValue=360,S[n].ui.spinbox.value=h.convert(S[n].ui.spinbox.value,e,"rad",t),S[n].ui.spinbox.stepValue=1,S[n].ui.spinbox.pageStepValue=1,S[n].ui.spinbox.minValue=1,S[n].ui.spinbox.units=x.deg):"Length"===e&&(S[n].ui.spinbox.units===x.mm?"inch"!==t&&"foot"!==t||(S[n].ui.spinbox.minValue=.01,S[n].ui.spinbox.stepValue=.01,S[n].ui.spinbox.pageStepValue=.01,S[n].ui.spinbox.value=h.convert(S[n].ui.spinbox.value,e,"mm","inch"),S[n].ui.spinbox.units=x.inch):S[n].ui.spinbox.units===x.inch&&("mm"!==t&&"cm"!==t&&"m"!==t&&"km"!==t||(S[n].ui.spinbox.value=h.convert(S[n].ui.spinbox.value,e,"inch","mm"),S[n].ui.spinbox.minValue=1,S[n].ui.spinbox.stepValue=1,S[n].ui.spinbox.pageStepValue=1,S[n].ui.spinbox.units=x.mm))))}var F={},X={},M={},I=!1;function j(e,t){if(-1!==e.rowID)for(var n=h.Types,i=Object.keys(n),a=0;a<i.length;a++)y[n[i[a]].name]===e.nodeModel.options.label&&(R(n[i[a]].name,t),F[n[i[a]].name]=t,I=!0)}function _(e,t){if(-1!==e.rowID)for(var n=h.Types,i=Object.keys(n),a=0;a<i.length;a++)y[n[i[a]].name]===e.nodeModel.options.label&&(X[n[i[a]].name]=parseInt(t),I=!0)}function L(e,t){if(-1!==e.rowID)for(var n=h.Types,i=Object.keys(n),a=0;a<i.length;a++)y[n[i[a]].name]===e.nodeModel.options.label&&(M[n[i[a]].name]=parseInt(t),I=!0)}function B(){for(var e=0;e<S.length;e++)if(S[e].spec.visibilityCondition)for(var t=0;t<S.length;t++)if(S[t].spec.id===S[e].spec.visibilityCondition.id){var n;if("checkbox"===S[t].spec.type)n=S[t].ui.checkFlag;else if("radio"===S[t].spec.type||"radiobutton"===S[t].spec.type){for(var i=0;i<S[t].ui.length;i++)if(S[t].ui[i].checkFlag){n=S[t].ui[i].value;break}}else"combo"===S[t].spec.type?n=S[t].ui.value:"editor"===S[t].spec.type?n=S[t].ui.value:"color"===S[t].spec.type?n=S[t].ui.value:"checkbox+spinbox"===S[t].spec.type?n=S[t].ui.checkbox.checkFlag:"spinbox"===S[t].spec.type&&(n=S[t].ui.spinbox.value);S[e].prefDiv.setStyle("display",n===S[e].spec.visibilityCondition.value?"":"none");break}}function G(t,n){if(n&&n.columnInfo&&n.id&&n.type){var i=e.createElement("div");if(n.withExpander&&n.expanderHeader&&n.expanderID){var a=new r({header:n.expanderHeader,body:i,style:"divided"});a.expandedFlag=U(n.expanderID),a.getContent().addEventListener("expand",function(){O(n.expanderID,!0)}),a.getContent().addEventListener("collapse",function(){O(n.expanderID,!1)}),a.inject(t)}else i.inject(t);if(n.gridTitle){var l=new u({value:n.gridTitle});l.getContent().setStyles({"font-weight":"bold","text-align":"left"}),l.getContent().style.background="none",l.inject(i)}var s=new f({useAsyncPreExpand:!1,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}}),o={identifier:n.id,treeDocument:s,defaultColumnDef:{width:"auto"},columns:n.columnInfo,rowSelection:"single",showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1,cellSelection:{defaultValue:"none"},rowDragEnabledFlag:!1,cellDragEnabledFlag:!1,activateAllCellsRenderedEventFlag:!0,showRowBorderFlag:!0,placeholder:"",recId:n.id},c=new d(o);c.layout.rowsHeader=!1,n.enumID&&n.enumVal&&c.getTypeRepresentationFactory().registerEnum(n.enumID,n.enumVal),n.typeRepresentation&&c.getTypeRepresentationFactory().registerTypeRepresentations(n.typeRepresentation);var p=e.createElement("div",{styles:{position:"relative",height:25*((n.displayHeight?n.displayHeight:5)+1)+2+"px",margin:"10px 0px"}}).inject(i);return c.inject(p),n.initGridDataCB(s),S.push({prefDiv:c,ui:i,spec:{id:n.id,type:n.type,refreshDefaultValues:function(){var e=s.getRoots();n.refreshDefaultValuesCB(e)},updateGridValues:function(){n.updateGridValuesCB()}}}),i}}function N(t,l){var r;if("checkbox"===t.type)r=new n({label:t.nls,value:t.id,type:t.type,checkFlag:t.getValue()}).inject(l),-1!==W.indexOf(t.id)&&r.addEventListener("change",B),S.push({prefDiv:r,ui:r,spec:t});else if("radio"===t.type){let i=e.createElement("label",{text:t.nls,class:"CATWebUXRadioSectionTitle",styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(l);t.nls||i.setStyle("display","none");let a=e.createElement("div",{styles:{"padding-bottom":"10px","margin-left":"10px"}}).inject(l),s=t.getValue(),o=[];for(let i=0;i<t.options.length;i++){if(r=new n({label:t.options[i].nls,value:t.options[i].id,type:"radio",checkFlag:t.options[i].id===s}).inject(a),t.options[i].content){let n=e.createElement("div",{styles:{"margin-left":"25px"}}).inject(a);for(let e=0;e<t.options[i].content.length;e++){N(t.options[i].content[e],n)}}o.push(r),-1!==W.indexOf(t.id)&&r.addEventListener("change",B),t.onChange&&r.addEventListener("change",e=>{e.dsModel.checkFlag&&t.onChange(e.dsModel.value)})}S.push({prefDiv:a,ui:o,spec:t})}else if("radiobutton"===t.type){let n=e.createElement("div",{styles:{display:"grid","grid-template-columns":"30% 60%",margin:"2px 0"}}).inject(l),i=e.createElement("span",{text:t.nls,class:"CATWebUXRadioSectionTitle",styles:{margin:"auto 0px"}}).inject(n);t.nls||i.setStyle("display","none");let s=t.getValue(),o=[],c=new p({}).inject(n);for(let e=0;e<t.options.length;e++)r=new a({label:t.options[e].nls,value:t.options[e].id,type:"radio",disabled:t.isDisabled&&t.isDisabled(),icon:t.options[e].icon?{iconName:t.options[e].icon,fontIconFamily:WUXManagedFontIcons.Font3DS}:void 0,checkFlag:t.options[e].id===s}),c.addChild(r),o.push(r),-1!==W.indexOf(t.id)&&r.addEventListener("change",B),t.onChange&&r.addEventListener("change",e=>{e.dsModel.checkFlag&&t.onChange(e.dsModel.value)});S.push({prefDiv:n,ui:o,spec:t})}else if("editor"===t.type){let n=e.createElement("div",{class:"CATWebUXEditorSectionTitle",styles:{width:"100%"}}).inject(l),i=e.createElement("label",{text:t.nls,class:"CATWebUXEditorSectionTitle",styles:{"margin-bottom":"0px",padding:"10px 0px",display:"inline-block","font-weight":"normal"}}).inject(n);t.nls||i.setStyle("display","none");let a=new c({value:t.getValue(),selectAllOnFocus:!0,autoCommitFlag:!0}).inject(n);a.elements.container.setStyles({display:"inline-block","padding-left":"10px"}),S.push({prefDiv:a,ui:a,spec:t})}else if("combo"===t.type){let n=e.createElement("div",{styles:{display:"grid","grid-template-columns":"30% 60%",margin:"2px 0"}}).inject(l),i=e.createElement("span",{text:t.nls,class:"CATWebUXComboSectionTitle",styles:{margin:"auto 0px"}}).inject(n);t.nls||i.setStyle("display","none");let a=[];t.options.forEach(function(e){a.push({labelItem:e.nls,valueItem:e.id})});let r=new o({elementsList:a,value:t.getValue(),disabled:t.isDisabled&&t.isDisabled(),enableSearchFlag:"undefined"===t.enableSearchFlag||t.enableSearchFlag}).inject(n);-1!==W.indexOf(t.id)&&r.addEventListener("change",B),t.onChange&&r.addEventListener("change",e=>{t.onChange(e.dsModel.value)}),S.push({prefDiv:n,ui:r,spec:t})}else if("color"===t.type){var u=e.createElement("div",{class:"CATWebUXColorPickerDiv"}).inject(l);if(r=new s({value:t.getValue(),alignment:"left"}).inject(u),t.nls)e.createElement("p",{class:"CATWebUXColorPickerLabel",styles:{display:"inline-block","vertical-align":"super","margin-left":"5px"}}).inject(u).innerText=t.nls;-1!==W.indexOf(t.id)&&r.addEventListener("change",B),S.push({prefDiv:u,ui:r,spec:t})}else if("checkbox+spinbox"===t.type){let a=e.createElement("div",{class:"CATWebUXCheckSpinboxCombo",styles:{display:"flex","align-items":"center","margin-bottom":"5px"}}).inject(l);r=new n({label:t.prefixnls+": ",value:t.id,type:"checkbox",checkFlag:t.getValue()}).inject(a);let s=e.createElement("div",{styles:{display:"flex","margin-left":"5px",width:"150px"}}).inject(a),o=t.getSpinBoxValues(),c=new i({value:o.value,units:x[o.units],minValue:o.minValue,maxValue:o.maxValue,stepValue:o.stepValue,disabled:t.disableSpinboxAtUncheck&&!t.getValue(),pageStepValue:1}).inject(s);e.createElement("label",{text:t.suffixnls,class:"wux-label",styles:{"margin-bottom":"0px",padding:"5px","font-weight":"inherit"}}).inject(a),t.disableSpinboxAtUncheck&&r.addEventListener("change",function(e){c.disabled=!e.dsModel.checkFlag}),-1!==W.indexOf(t.id)&&(r.addEventListener("change",B),c.addEventListener("change",B)),S.push({prefDiv:r,ui:{checkbox:r,spinbox:c},spec:t})}else if("spinbox"===t.type){let n=e.createElement("div",{class:"CATWebUXSpinboxCombo",styles:{display:"grid","grid-template-columns":"30% 70%",margin:"2px 0"}}).inject(l),a=e.createElement("span",{text:t.nls,class:"CATWebUXSpinboxTitle",styles:{margin:"auto 0px"}}).inject(n);t.nls||a.setStyle("display","none");let s=e.createElement("div").inject(n),o=t.getSpinBoxValues(),c=new i({value:o.value,units:x[o.units],minValue:o.minValue,maxValue:o.maxValue,stepValue:o.stepValue,disabled:t.isDisabled&&t.isDisabled()||t.disableSpinboxAtUncheck&&!t.getValue(),pageStepValue:1}).inject(s);S.push({prefDiv:r,ui:{spinbox:c},spec:t})}else"dataGrid"===t.type&&G(l,t)}let J;function H(t,n){var i=e.createElement("div"),a=new r({header:t.nls,body:i,style:"divided"});a.expandedFlag=U(t.id),a.getContent().addEventListener("expand",function(){O(t.id,!0)}),a.getContent().addEventListener("collapse",function(){O(t.id,!1)}),a.inject(n);for(var l=t.preferences,s=0;s<l.length;s++)"section"===l[s].type?H(l[s],i):"sectionNoExpander"===l[s].type?J(l[s],i):N(l[s],i)}J=function(t,n){var i=e.createElement("div",{styles:{"padding-bottom":"10px"}});i.inject(n);var a=new u({value:t.nls});a.getContent().setStyles({"font-weight":"bold","text-align":"left"}),a.getContent().style.background="none",a.inject(i),i=e.createElement("div",{styles:{"margin-left":"10px"}}).inject(i);for(var l=t.preferences,r=0;r<l.length;r++)"section"===l[r].type?H(l[r],i):"sectionNoExpander"===l[r].type?J(l[r],i):N(l[r],i)},this.displayPreferencePanel=function(t){if(!D&&t&&(C&&C.length||T.units||T.display||T.sel3D||T.sel2D)){W.length=0;var n,i,s,o,c=e.createElement("div"),u=function(e){if(e.visibilityCondition&&W.push(e.visibilityCondition.id),"section"===e.type||"sectionNoExpander"===e.type)for(var t=0;t<e.preferences.length;t++)u(e.preferences[t])};for(n=0;n<C.length;n++)u(C[n]);if(V&&V.length)for(var p=0;p<V.length;p++)for(n=0;n<C.length;n++)if(C[n].id===V[p]){"section"===C[n].type?H(C[n],c):"sectionNoExpander"===C[n].type?J(C[n],c):N(C[n],c);break}for(n=0;n<C.length;n++)-1===V.indexOf(C[n].id)&&("section"===C[n].type?H(C[n],c):"sectionNoExpander"===C[n].type?J(C[n],c):N(C[n],c));T.units&&function(e){var t,n,i,a,l=h.Types,r=Object.keys(l),s={};for(t=0;t<r.length;t++){n={},i=h[r[t]],a=Object.keys(i);for(var o=0;o<a.length;o++)n[i[a[o]].nls]=i[a[o]].name;s[r[t]]={stdTemplate:"enumCombo",semantics:{possibleValues:n,valueType:"enumCustom"}}}var c,u,p,d=[];d.push({text:v.magnitudeCol,dataIndex:"tree",editableFlag:!1}),d.push({text:v.unitCol,dataIndex:"unit",editableFlag:!0,getCellTypeRepresentation:function(e){if(-1!==e.rowID){for(var t=0;t<r.length;t++)if(y[l[r[t]].name]===e.nodeModel.options.label)return l[r[t]].name;return""}},editionPolicy:"EditionOnOver",setCellValue:j}),d.push({icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock-open",description:v.decimalPlaceRW,dataIndex:"decimalPlaceRW",editionPolicy:"EditionOnOver",editableFlag:!0,typeRepresentation:"DecimalPlaceEnum",setCellValue:_}),d.push({icon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-lock",description:v.decimalPlaceRO,dataIndex:"decimalPlaceRO",editionPolicy:"EditionOnOver",editableFlag:!0,typeRepresentation:"DecimalPlaceEnum",setCellValue:L});var f=localStorage.getItem("CATWebUXPreferences_Units"),m=G(e,{withExpander:!0,expanderID:"Units",expanderHeader:v.unitsLabel,columnInfo:d,id:"CATWebUXPreferences_UnitsAndDecimalPlace",type:"dataGrid",displayHeight:r.length,typeRepresentation:s,enumID:"DecimalPlaceEnum",enumVal:[0,1,2,3,4,5,6,7,8,9],initGridDataCB:function(e){for(f&&f.length&&(f=JSON.parse(f)),t=0;t<r.length;t++)p=l[r[t]].name,(u=f&&f[p]?f[p]:null)||(u={unit:l[r[t]].defaultValue,decimalPlaceRW:l[r[t]].defaultDecimalPlaceRW,decimalPlaceRO:l[r[t]].defaultDecimalPlaceRO}),c=new g({label:y[p],grid:{unit:u.unit,decimalPlaceRW:u.decimalPlaceRW,decimalPlaceRO:u.decimalPlaceRO}}),e.addRoot(c)},refreshDefaultValuesCB:function(e){for(t=0;t<r.length;t++){p=l[r[t]].name,F[p]!==l[r[t]].defaultValue&&(F[p]=l[r[t]].defaultValue,I=!0),X[p]!==l[r[t]].defaultDecimalPlaceRW&&(X[p]=l[r[t]].defaultDecimalPlaceRW,I=!0),M[p]!==l[r[t]].defaultDecimalPlaceRO&&(M[p]=l[r[t]].defaultDecimalPlaceRO,I=!0);for(var n=0;n<e.length;n++)if(y[p]===e[n].options.label){e[n].updateOptions({grid:{unit:x[l[r[t]].defaultValue],decimalPlaceRW:l[r[t]].defaultDecimalPlaceRW,decimalPlaceRO:l[r[t]].defaultDecimalPlaceRO}});break}}},updateGridValuesCB:function(){if(I){var e={};for(t=0;t<r.length;t++){p=l[r[t]].name,(u=f&&f[p]?f[p]:null)||(u={unit:l[r[t]].defaultValue,decimalPlaceRW:l[r[t]].defaultDecimalPlaceRW,decimalPlaceRO:l[r[t]].defaultDecimalPlaceRO});var n=u.unit;if(F[p])for(var i=Object.keys(x),a=0;a<i.length;a++)if(i[a]===F[p]){n=i[a];break}e[r[t]]={unit:n,decimalPlaceRW:"number"==typeof X[p]&&X[p]>=0?X[p]:u.decimalPlaceRW,decimalPlaceRO:"number"==typeof M[p]&&M[p]>=0?M[p]:u.decimalPlaceRO}}var s=JSON.stringify(e);return s!==JSON.stringify(f)?(localStorage.setItem("CATWebUXPreferences_Units",s),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_UnitsAndDecimalPlace",value:e})),e):void 0}}});N({id:"CATWebUXPreferences_TrailingZeros",nls:v.trailingZeros,type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXPreferences_TrailingZeros")},getDefaultValue:function(){return!1},setValue:function(e){"true"===localStorage.getItem("CATWebUXPreferences_TrailingZeros")!==e&&(localStorage.setItem("CATWebUXPreferences_TrailingZeros",e?"true":"false"),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_TrailingZeros",value:e})))}},m)}(c),T.display&&(i=c,s=e.createElement("div"),(o=new r({header:v.displayLabel,body:s,style:"divided"})).expandedFlag=U("Display"),o.getContent().addEventListener("expand",function(){O("Display",!0)}),o.getContent().addEventListener("collapse",function(){O("Display",!1)}),o.inject(i),N({id:"CATWebUXPreferences_GravitationalEffects",nls:v.gravitationalEffects,type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXPreferences_GravitationalEffects")},getDefaultValue:function(){return!1},setValue:function(e){localStorage.setItem("CATWebUXPreferences_GravitationalEffects",e?"true":"false"),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_GravitationalEffects",value:e}))}},s),N({id:"CATWebUXPreferences_ProjectionType",nls:v.projectionType,type:"radio",getValue:function(){return"1"===localStorage.getItem("CATWebUXPreferences_ProjectionType")?"CATWebUXPreferences_Ortho":"CATWebUXPreferences_Perspective"},getDefaultValue:function(){return"CATWebUXPreferences_Perspective"},setValue:function(e){localStorage.setItem("CATWebUXPreferences_ProjectionType","CATWebUXPreferences_Ortho"===e?"1":"0"),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_ProjectionType",value:"CATWebUXPreferences_Ortho"===e?1:0}))},options:[{id:"CATWebUXPreferences_Ortho",nls:v.orthographic},{id:"CATWebUXPreferences_Perspective",nls:v.perspective}]},s)),(T.sel3D||T.sel2D)&&function(t){var n=e.createElement("div"),i=new r({header:v.selectionLabel,body:n,style:"divided"});i.expandedFlag=U("Selection"),i.getContent().addEventListener("expand",function(){O("Selection",!0)}),i.getContent().addEventListener("collapse",function(){O("Selection",!1)}),i.inject(t),T.sel3D&&(N({id:"CATWebUXPreferences_Select3DGeometry",nls:v.select3DGeometry,type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXPreferences_Select3DGeometry")},getDefaultValue:function(){return!1},setValue:function(e){localStorage.setItem("CATWebUXPreferences_Select3DGeometry",e?"true":"false"),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_Select3DGeometry",value:e}))}},n),N({id:"CATWebUXPreferences_SelectParentReferenceOr3DShape",nls:v.selectParentReferenceOr3DShape,type:"radio",options:[{id:"selectParentReference",nls:v.selectParentReference},{id:"select3DShape",nls:v.select3DShape}],getValue:function(){return"select3DShape"===localStorage.getItem("CATWebUXPreferences_SelectParentReferenceOr3DShape")?"select3DShape":"selectParentReference"},getDefaultValue:function(){return"selectParentReference"},setValue:function(e){localStorage.setItem("CATWebUXPreferences_SelectParentReferenceOr3DShape",e),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_SelectParentReferenceOr3DShape",value:e}))}},n)),T.sel2D&&N({id:"CATWebUXPreferences_Select2DGeometry",nls:v.select2DGeometry,type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXPreferences_Select2DGeometry")},getDefaultValue:function(){return!1},setValue:function(e){localStorage.setItem("CATWebUXPreferences_Select2DGeometry",e?"true":"false"),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_Select2DGeometry",value:e}))}},n)}(c),T.exportSection&&function(t){var n=e.createElement("div"),i=new r({header:v.exportLabel,body:n,style:"divided"});i.expandedFlag=U("Export"),i.getContent().addEventListener("expand",function(){O("Export",!0)}),i.getContent().addEventListener("collapse",function(){O("Export",!1)}),i.inject(t),N({id:"CATWebUXPreferences_ExportPersonalData",nls:v.exportPersonalData,type:"checkbox",getValue:function(){return"true"===localStorage.getItem("CATWebUXPreferences_ExportPersonalData")},getDefaultValue:function(){return!1},setValue:function(e){localStorage.setItem("CATWebUXPreferences_ExportPersonalData",e?"true":"false"),b.publish("onWidgetPreferenceModified",JSON.stringify({name:"CATWebUXPreferences_ExportPersonalData",value:e}))}},n)}(c),W.length&&B();var d=new a({emphasize:"primary",label:v.saveButton,onClick:function(){E("onBeforeChangingPreferences");var e=[];S.forEach(function(t){if("checkbox"===t.spec.type)t.spec.getValue()!==t.ui.checkFlag&&(t.spec.setValue(t.ui.checkFlag),e.push({id:t.spec.id,value:t.ui.checkFlag}));else if("radio"===t.spec.type||"radiobutton"===t.spec.type){for(let n=0;n<t.ui.length;n++)if(t.ui[n].checkFlag&&t.spec.getValue()!==t.ui[n].value){t.spec.setValue(t.ui[n].value),e.push({id:t.spec.id,value:t.ui[n].value});break}}else if("editor"===t.spec.type)t.spec.getValue()!==t.ui.value&&(t.spec.setValue(t.ui.value),e.push({id:t.spec.id,value:t.ui.value}));else if("combo"===t.spec.type)t.spec.getValue()!==t.ui.value&&(t.spec.setValue(t.ui.value),e.push({id:t.spec.id,value:t.ui.value}));else if("color"===t.spec.type)t.spec.getValue()!==t.ui.value&&t.spec.getValue()!=="#"+t.ui.value&&(t.spec.setValue(t.ui.value),e.push({id:t.spec.id,value:t.ui.value}));else if("dataGrid"===t.spec.type){var n=t.spec.updateGridValues();n&&e.push({id:t.spec.id,value:n})}else if("checkbox+spinbox"===t.spec.type){let n=t.spec.getSpinBoxValues();t.spec.getValue()===t.ui.checkbox.checkFlag&&t.ui.spinbox.value===n.value||(t.spec.setValue(t.ui.checkbox.checkFlag),t.ui.spinbox.units===x.rad?t.spec.setSpinBoxValue(h.convert(t.ui.spinbox.value,"Angle","rad","deg")):t.ui.spinbox.units===x.inch?t.spec.setSpinBoxValue(h.convert(t.ui.spinbox.value,"Length","inch","mm")):t.spec.setSpinBoxValue(t.ui.spinbox.value),e.push({id:t.spec.id,value:t.ui.checkbox.checkFlag,spinBoxValue:t.ui.spinbox.value,units:t.ui.spinbox.units}))}else if("spinbox"===t.spec.type){let n=t.spec.getSpinBoxValues();t.ui.spinbox.value!==n.value&&(t.ui.units===x.rad?t.spec.setSpinBoxValue(h.convert(t.ui.spinbox.value,"Angle","rad","deg")):t.ui.units===x.inch?t.spec.setSpinBoxValue(h.convert(t.ui.spinbox.value,"Length","inch","mm")):t.spec.setSpinBoxValue(t.ui.spinbox.value),e.push({id:t.spec.id,spinBoxValue:t.ui.spinbox.value,units:t.ui.units}))}}),w.clearPreferencePanel(),e.length&&E("onPreferencesChanged",e),E("onAfterChangingPreferences")}}),f=new a({label:v.resetButton,onClick:function(){S.forEach(function(e){if("dataGrid"===e.spec.type)e.spec.refreshDefaultValues();else{var t=e.spec.getDefaultValue&&e.spec.getDefaultValue();if("checkbox"===e.spec.type)e.ui.checkFlag=t;else if("radio"===e.spec.type||"radiobutton"===e.spec.type)for(var n=0;n<e.ui.length;n++)e.ui[n].value===t&&(e.ui[n].checkFlag=!0);else if("combo"===e.spec.type)e.ui.value=t;else if("editor"===e.spec.type)e.ui.value=t;else if("color"===e.spec.type)e.ui.value=t;else if("checkbox+spinbox"===e.spec.type){e.ui.checkbox.checkFlag=t;let n=e.spec.getSpinBoxDefaultValues();e.ui.spinbox.value=n.value,e.ui.spinbox.units=n.units,e.ui.spinbox.minValue=n.minValue,e.ui.spinbox.maxValue=n.maxValue,e.ui.spinbox.stepValue=n.stepValue}else if("spinbox"===e.spec.type){let t=e.spec.getSpinBoxDefaultValues();e.ui.spinbox.value=t.value,e.ui.spinbox.units=t.units,e.ui.spinbox.minValue=t.minValue,e.ui.spinbox.maxValue=t.maxValue,e.ui.spinbox.stepValue=t.stepValue}}})}}),m=new a({label:v.cancelButton,onClick:w.clearPreferencePanel}),P=t.getImmersiveFrame?t.getImmersiveFrame().getFreeZone().getSize().height:t&&t.getOffsetHeight?t.getOffsetHeight():650;P-=150,P=Math.max(P,300),D=new l({modalFlag:!!t.getImmersiveFrame||void 0,ensureHeightDefinitionOnHierarchy:!0,title:v.panelTitle,content:c,resizableFlag:!0,immersiveFrame:t.getImmersiveFrame?t.getImmersiveFrame():void 0,height:P,buttons:{Abort:m,Ok:d,Apply:f}}),t.getImmersiveFrame||t.appendChild(D.elements.container),D.addEventListener("close",w.clearPreferencePanel)}},this.setPreferencesEnableFlag=function(e,t){S.filter(t=>e.includes(t.spec.id)).forEach(e=>{if("disabled"in e.ui)e.ui.disabled=!t;else{Object.keys(e.ui).forEach(n=>{e.ui[n].disabled=!t})}})},this.setPreferenceValue=function(e,t){let n=S.find(t=>t.spec.id===e);if("value"in n.ui)n.ui.value=t;else{Object.keys(n.ui).forEach(e=>{"value"in n.ui[e]&&(n.ui[e].value=t)})}},this.getPreferenceValue=function(e){let t=S.find(t=>t.spec.id===e);if("value"in t.ui)return t.ui.value;if("radiobutton"===t.spec.type)return t.ui.find(e=>e.checkFlag).value;let n=Object.keys(t.ui);for(let e=0;e<n.length;e++){const i=n[e];if("value"in t.ui[i])return t.ui[i].value}},this.clearPreferencePanel=function(){S.length=0,D&&(D.destroy(),D=null),E("onPreferencesPanelDestroyed")},this.addPreferences=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)if(e[t].id){for(var n=!1,i=0;i<C.length;i++)C[i].id===e[t].id&&(n=!0);n||C.push(e[t])}},this.removeAllPreferences=function(){T={display:!1,units:!1,sel3D:!1,sel2D:!1},w.removePreferences()},this.removePreferences=function(e){if(!e)return C.length=0,void(V.length=0);for(var t=0;t<e.length;t++)for(var n=C.length-1;n>=0;n--)if(C[n].id===e[t]){C.splice(n,1);break}},this.setUnitsPreferencesDisplayFlag=function(e){T.units!==e&&(T.units=e)},this.setDisplayPreferencesDisplayFlag=function(e){T.display!==e&&(T.display=e)},this.set3DSelectionPreferencesDisplayFlag=function(e){T.sel3D!==e&&(T.sel3D=e)},this.set2DSelectionPreferencesDisplayFlag=function(e){T.sel2D!==e&&(T.sel2D=e)},this.setExportPreferencesDisplayFlag=function(e){T.exportSection!==e&&(T.exportSection=e)},this.getGenericPreferencesDisplayFlag=function(){return{units:T.units,display:T.display}},this.setPreferredPreferenceContainersOrder=function(e){V.length=0,e&&e.length&&(V=V.concat(e))},this.clearPreferenceManager=function(){w.clearPreferencePanel(),k&&(b.unsubscribe(k),k=0),C.length=0,V.length=0},this.subscribe=function(e,t){if(e&&t&&A)return A.subscribe({event:e},t)},this.unsubscribe=function(e){A&&e&&A.unsubscribe(e)}}}),D=[];return t.singleton({init:function(){},givePreferenceManager:function(e){var t;return e&&e.context&&D.some(function(n){if(n.context===e.context)return t=n.preferenceMng,!0}),t},getPreferenceManager:function(e){var t,n;return e&&e.context&&D.some(function(n){if(n.context===e.context)return t=n,!0}),!t&&e&&e.context?(n=new P({context:e.context}),D.push({context:e.context,preferenceMng:n,counter:1})):t&&(t.counter++,n=t.preferenceMng),n},unreferencePreferenceManager:function(e){e&&e.context&&D.some(function(t,n){if(t.context===e.context)return D[n].counter--,D[n].counter<=0&&(D[n].preferenceMng.clearPreferenceManager(),D.splice(n,1)),!0})}})}),define("DS/CATWebUXPreferences/CATWebUXPreferencesCmd",["DS/ApplicationFrame/Command","DS/CATWebUXPreferences/CATWebUXPreferencesManager"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"shared",isAsynchronous:!0}),this.setRepeatMode(!1);var n=this;this.beginExecute=function(){var e=t.givePreferenceManager({context:n.getFrameWindow()});e&&e.displayPreferencePanel(n.getFrameWindow()),n.end()}}})});