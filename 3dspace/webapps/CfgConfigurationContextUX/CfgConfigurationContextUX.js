define("DS/CfgConfigurationContextUX/CfgConfigurationContextCriteria",["DS/UIKIT/Spinner","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Collection","UWA/Class/Model","UWA/Class/View","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","DS/Controls/Toggle","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],function(e,t,i,a,n,o,r,l,s,c,d){"use strict";return r.extend({collection:null,className:"CfgConfigurationContextCriteria",enabledCriteria:{feature:"false",productState:"false",unit:"false",contextualDate:"false",milestone:"false",manufacturingPlan:"false"},setup:function(){},init:function(e){var t=this;this.alertDiv=new i({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"}),this.options=e,this.enabledCriteriaFromNative=JSON.parse(JSON.stringify(e.enabledCriterias));if(s.get2(function(e){console.log(e),null!=e.isLicenseValid&&0==e.isLicenseValid||(t.caid=e.change.id)}),t.availableChangeControlledObjectsCount=0,"Native"!==window.enoviaServerFilterWidget.mode){var n=this.options.selection;a.isChangeControlledList(n).then(function(e){t.availableChangeControlledObjectsCount=a.isChangeControlledObjectAvailable(e)})}},render:function(e){this.collection=e;return this.createCriteriaView()},getActiveCriteria:function(){var e=c.ActivatedCriteria,t=this.ROCriteriaView=new UWA.createElement("div",{class:"ROCriteria-container",title:e,html:e});return this.renderActiveCriteria(this.options.enabledCriterias),t},renderActiveCriteria:function(e){var t="<b>"+c.ActivatedCriteria+"  :  </b>",i="";("true"===e.productState||"mixedState"===e.productState)&&(i+=c.Product_state+", "),("true"===e.manufacturingPlan||"mixedState"===e.manufacturingPlan)&&(i+=c.Manufacturing_Plan+", "),("true"===e.contextualDate||"mixedState"===e.contextualDate)&&(i+=c.Date+", "),("true"===e.milestone||"mixedState"===e.milestone)&&(i+=c.Milestone+", "),("true"===e.unit||"mixedState"===e.unit)&&(i+=c.Unit+", "),("true"===e.feature||"mixedState"===e.feature)&&(i+=c.Variant_Options+", "),i=i.replace(/,\s*$/,""),this.ROCriteriaView.setContent(t+i),this.ROCriteriaView.setAttributes({title:i})},onResize:function(){this.criteriaContent&&"none"!=this.criteriaContent.getParent().getStyle("display")&&(this.criteriaContent.getParent().offsetWidth<=448?(this.criteriaContent.addClassName("main-CriteriaContent-mobilemode"),this.evolutionCritView&&this.evolutionCritView.addClassName("evolutionCrit-containert-mobilemode"),this.variantCritView&&this.variantCritView.addClassName("variantCrit-container-mobilemode")):(this.criteriaContent.removeClassName("main-CriteriaContent-mobilemode"),this.evolutionCritView&&this.evolutionCritView.removeClassName("evolutionCrit-containert-mobilemode"),this.variantCritView&&this.variantCritView.removeClassName("variantCrit-container-mobilemode")))},createCriteriaView:function(){var t=this,i=this.evolutionCritView=new UWA.createElement("div",{class:"evolutionCrit-container",html:[{tag:"div",class:"evoCritContainer",html:['<h5 class="evoCritHeader">'+c.Evolution+"</h5>",{tag:"div",class:"evoCritContent"}]}]}),n=this.separator=new UWA.createElement("div",{class:"separator-line",styles:{Float:"left",height:"inherit",width:"1px","background-color":" #e2e4e3",margin:"0px 2px"}}),o=this.variantCritView=new UWA.createElement("div",{class:"variantCrit-container",html:[{tag:"div",class:"varCritContainer",html:['<h5 class="varCritHeader">'+c.Variants+"</h5>",{tag:"div",class:"varCritContent"}]}]}),r=this.criteriaContent=new UWA.createElement("div",{class:"main-CriteriaContent"});this.Spinner=new e({className:"Spinners"}).inject(r),i.inject(this.criteriaContent),n.inject(this.criteriaContent),o.inject(this.criteriaContent);var l=t.options.enabledCriterias?t.options.enabledCriterias:t.enabledCriteria;return t.enabledCriteriasUX=l,a.checkDecouplingActivation().then(function(e){t.AllowedCriteria=e,t.renderCriteriaView(t.enabledCriteriasUX),t.criteriaContent.addEvent("resize",function(){t.onResize()})}),r},updateCollection:function(e,t){this.collection=e,UWA.is(t)&&(this.enabledCriteriasUX=t,this.renderActiveCriteria(this.enabledCriteriasUX)),0==this.collection.length&&"Native"==window.enoviaServerFilterWidget.mode&&(this.enabledCriteriaFromNative=this.enabledCriteriasUX=JSON.parse(JSON.stringify(this.enabledCriteria)))},renderCriteriaViewNative:function(e){var t=this,i=t.enabledCriteriasUX,a=t.evolutionCritView.getElement(".evoCritContent"),n=t.variantCritView.getElement(".varCritContent");t.evolutionCritView.getElement(".evoCritHeader"),t.variantCritView.getElement(".varCritHeader");n.setContent(""),a.setContent(""),e.indexOf("products")>=0||-1==e.indexOf("products")&&"true"==i.productState?(t.productstateCheckbox=new d({type:"checkbox",value:"productState",className:"primary",checkFlag:"true"===i.productState||"mixedState"===i.productState,label:c.Product_state,mixedState:"mixedState"===i.productState,disabled:"true"==t.enabledCriteriaFromNative.productState}).inject(a),t.productstateCheckbox.elements.container.classList.add("productStateCheckBox"),t.productstateCheckbox.addEventListener("click",function(e){"mixedState"==t.enabledCriteriasUX[t.productstateCheckbox.value]&&t.productstateCheckbox.checkFlag&&(t.productstateCheckbox.disabled=!0),t.setUnsetCriteria(t.productstateCheckbox)})):(t.enabledCriteriasUX.productState="false",t.enabledCriteriaFromNative.productState="false"),(e.indexOf("manufacturingPlans")>=0||-1==e.indexOf("manufacturingPlans")&&"true"==i.manufacturingPlan)&&t.options.IsManufPlanAllowedFromNative?(t.manufacturingPlanCheckbox=new d({type:"checkbox",value:"manufacturingPlan",className:"primary",checkFlag:"true"===i.manufacturingPlan||"mixedState"===i.manufacturingPlan,label:c.Manufacturing_Plan,mixedState:"mixedState"===i.manufacturingPlan,disabled:"true"==t.enabledCriteriaFromNative.manufacturingPlan}).inject(a),t.manufacturingPlanCheckbox.elements.container.classList.add("manufacturingPlanCheckBox"),t.manufacturingPlanCheckbox.addEventListener("click",function(e){"mixedState"==t.enabledCriteriasUX[t.manufacturingPlanCheckbox.value]&&t.manufacturingPlanCheckbox.checkFlag&&(t.manufacturingPlanCheckbox.disabled=!0),t.setUnsetCriteria(t.manufacturingPlanCheckbox)})):(t.enabledCriteriasUX.manufacturingPlan="false",t.enabledCriteriaFromNative.manufacturingPlan="false"),t.AllowedCriteria.contextualDate?(t.contextualDatebox=new d({type:"checkbox",value:"contextualDate",className:"primary",checkFlag:"true"===i.contextualDate||"mixedState"===i.contextualDate,label:c.Date,mixedState:"mixedState"===i.contextualDate,disabled:"true"==t.enabledCriteriaFromNative.contextualDate}).inject(a),t.contextualDatebox.elements.container.classList.add("contextualDateCheckBox"),t.contextualDatebox.addEventListener("click",function(e){"mixedState"==t.enabledCriteriasUX[t.contextualDatebox.value]&&t.contextualDatebox.checkFlag&&(t.contextualDatebox.disabled=!0),t.setUnsetCriteria(t.contextualDatebox)})):(t.enabledCriteriasUX.contextualDate="false",t.enabledCriteriaFromNative.contextualDate="false"),t.AllowedCriteria.unit&&e.indexOf("builds")>=0||-1==e.indexOf("builds")&&"true"==i.unit?(t.unitCheckbox=new d({type:"checkbox",value:"unit",className:"primary",checkFlag:"true"===i.unit||"mixedState"===i.unit,label:c.Unit,mixedState:"mixedState"===i.unit,disabled:"true"==t.enabledCriteriaFromNative.unit}).inject(a),t.unitCheckbox.elements.container.classList.add("unitCheckBox"),t.unitCheckbox.addEventListener("click",function(e){"mixedState"==t.enabledCriteriasUX[t.unitCheckbox.value]&&t.unitCheckbox.checkFlag&&(t.unitCheckbox.disabled=!0),t.setUnsetCriteria(t.unitCheckbox)})):(t.enabledCriteriasUX.unit="false",t.enabledCriteriaFromNative.unit="false"),e.indexOf("variant")>=0||-1==e.indexOf("variant")&&"true"==i.feature?(t.featureCheckbox=new d({type:"checkbox",value:"feature",className:"primary",checkFlag:"true"===i.feature||"mixedState"===i.feature,label:c.Variant_Options,mixedState:"mixedState"===i.feature,disabled:"true"==t.enabledCriteriaFromNative.feature}).inject(n),t.featureCheckbox.elements.container.classList.add("featureCheckBox"),t.featureCheckbox.addEventListener("click",function(e){"mixedState"==t.enabledCriteriasUX[t.featureCheckbox.value]&&t.featureCheckbox.checkFlag&&(t.featureCheckbox.disabled=!0),t.setUnsetCriteria(t.featureCheckbox)})):(t.enabledCriteriasUX.feature="false",t.enabledCriteriaFromNative.feature="false"),t.renderActiveCriteria(t.enabledCriteriasUX)},renderCriteriaView:function(){var e=this,t=e.enabledCriteriasUX;new Promise(function(t,i){var n=[];e.collection.forEach(function(e,t){n.push({id:"pid:"+e.id})});var o={version:"1.0.0",modelIds:n};o=JSON.stringify(o);a.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",o,function(e){t(e)},function(e){console.log("fail to get last product evolution")},!0)}).then(function(i){var a=i,n=[];for(var o in a.criteria){var r=a.criteria[o],l=Object.keys(r);for(var s in l)"TRUE"!=r[l[s]]&&"True"!=r[l[s]]||-1!=n.indexOf(l[s])||n.push(l[s])}if("Native"==window.enoviaServerFilterWidget.mode)e.renderCriteriaViewNative(n);else{var u=e.evolutionCritView.getElement(".evoCritContent"),C=e.variantCritView.getElement(".varCritContent");e.evolutionCritView.getElement(".evoCritHeader"),e.variantCritView.getElement(".varCritHeader");C.setContent(""),u.setContent(""),(n.indexOf("products")>=0||-1==n.indexOf("products")&&"true"==t.productState)&&(e.productstateCheckbox=new d({type:"checkbox",value:"productState",className:"primary",checkFlag:"true"===t.productState||"mixedState"===t.productState,label:c.Product_state,mixedState:"mixedState"===t.productState,disabled:-1==n.indexOf("products")&&"true"==t.productState}).inject(u),e.productstateCheckbox.elements.container.classList.add("productStateCheckBox"),e.productstateCheckbox.addEventListener("click",function(t){e.setUnsetCriteria(e.productstateCheckbox)})),(n.indexOf("manufacturingPlans")>=0||-1==n.indexOf("manufacturingPlans")&&"true"==t.manufacturingPlan)&&(e.manufacturingPlanCheckbox=new d({type:"checkbox",value:"manufacturingPlan",className:"primary",checkFlag:"true"===t.manufacturingPlan||"mixedState"===t.manufacturingPlan,label:c.Manufacturing_Plan,mixedState:"mixedState"===t.manufacturingPlan,disabled:-1==n.indexOf("manufacturingPlans")&&"true"==t.manufacturingPlan}).inject(u),e.manufacturingPlanCheckbox.elements.container.classList.add("manufacturingPlanCheckBox"),e.manufacturingPlanCheckbox.addEventListener("click",function(t){e.setUnsetCriteria(e.manufacturingPlanCheckbox)})),e.AllowedCriteria.contextualDate&&(e.contextualDatebox=new d({type:"checkbox",value:"contextualDate",className:"primary",checkFlag:"true"===t.contextualDate||"mixedState"===t.contextualDate,label:c.Date,mixedState:"mixedState"===t.contextualDate}).inject(u),e.contextualDatebox.elements.container.classList.add("contextualDateCheckBox"),e.contextualDatebox.addEventListener("click",function(t){e.setUnsetCriteria(e.contextualDatebox)})),(e.AllowedCriteria.unit&&n.indexOf("builds")>=0||-1==n.indexOf("builds")&&"true"==t.unit)&&(e.unitCheckbox=new d({type:"checkbox",value:"unit",className:"primary",checkFlag:"true"===t.unit||"mixedState"===t.unit,label:c.Unit,mixedState:"mixedState"===t.unit,disabled:-1==n.indexOf("builds")&&"true"==t.unit}).inject(u),e.unitCheckbox.elements.container.classList.add("unitCheckBox"),e.unitCheckbox.addEventListener("click",function(t){e.setUnsetCriteria(e.unitCheckbox)})),(n.indexOf("variant")>=0||-1==n.indexOf("variant")&&"true"==t.feature)&&(e.featureCheckbox=new d({type:"checkbox",value:"feature",className:"primary",checkFlag:"true"===t.feature||"mixedState"===t.feature,label:c.Variant_Options,mixedState:"mixedState"===t.feature,disabled:-1==n.indexOf("variant")&&"true"==t.feature}).inject(C),e.featureCheckbox.elements.container.classList.add("featureCheckBox"),e.featureCheckbox.addEventListener("click",function(t){e.setUnsetCriteria(e.featureCheckbox)}))}})},readOnlyCriteriaView:function(){[this.productstateCheckbox,this.manufacturingPlanCheckbox,this.contextualDatebox,this.unitCheckbox,this.featureCheckbox].forEach(function(e){e&&(e.disabled=!0)})},setUnsetCriteria:function(e){var i=this;let n=e.checkFlag;if(i.toggleLastState=i.enabledCriteriasUX[e.value],i.enabledCriteriasUX[e.value]=e.checkFlag.toString(),t.mask(this.criteriaContent),"Native"==window.enoviaServerFilterWidget.mode)i.renderActiveCriteria(i.enabledCriteriasUX),t.unmask(this.criteriaContent);else{var o=null;i.caid&&(o={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+i.caid}});for(var r=[],l=0;l<i.options.selection.length;l++)r.push(i.options.selection[l].id);if(null==o&&i.availableChangeControlledObjectsCount>0&&i.options.selection.length>i.availableChangeControlledObjectsCount)a.showwarning(c.CfgErrorSomeChangeControlled,"error"),i.revertToggleState(e),t.unmask(i.criteriaContent);else if(null==o&&i.availableChangeControlledObjectsCount>0&&i.options.selection.length==i.availableChangeControlledObjectsCount)a.showwarning(c.CfgErrorAllChangeControlled,"error"),i.revertToggleState(e),t.unmask(i.criteriaContent);else{new Promise(function(t,n){var l={version:"1.2",pidList:r,content:{enabledCriteria:i.enabledCriteriasUX}};l=JSON.stringify(l);a.makeWSCall("/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1","POST","enovia","application/json",l,function(e){t(e)},function(t,a){i.revertToggleState(e),n(a)},!0,o)}).then(function(e){i.renderActiveCriteria(i.enabledCriteriasUX),t.unmask(i.criteriaContent)},function(e){i.alertDiv.add({message:c.SetCriteriaFailed,style:{position:"absolute"},className:"error"}),i.alertDiv.show(),1==e.errorMessage.contains("No model(s) attached to the reference")?a.showwarning(c.EnableCriteriaFail,"error"):e.errorMessage?a.showwarning(c.EditContextFailed+e.errorMessage,"error"):!1===n?a.showwarning(c.DisableCriteriaFailGeneric,"error"):a.showwarning(c.EnableCriteriaFailGeneric,"error"),t.unmask(i.criteriaContent)})}}},revertToggleState:function(e){"mixedState"==this.toggleLastState?(this.enabledCriteriasUX[e.value]=this.toggleLastState,e.mixedState=!0):(this.enabledCriteriasUX[e.value]=(!e.checkFlag).toString(),e.checkFlag=!e.checkFlag)}})}),define("DS/CfgConfigurationContextUX/CfgContextTileView",["DS/W3DXComponents/Views/Item/TileView"],function(e){return""}),define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView",["DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/CollectionView/ResponsiveTilesCollectionView","DS/CollectionView/modelProviders/CollectionViewUWACollectionModelProvider","DS/UIKIT/Iconbar","DS/CfgBaseUX/scripts/CfgUtility","UWA/Class/Collection","UWA/Class/Model","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","text!DS/CfgConfigurationContextUX/CfgEditConfigurationContextDialogTemplate.html","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","i18n!DS/CfgBaseUX/assets/nls/CfgBaseUXNLS","DS/WebappsUtils/WebappsUtils","UWA/Class/View","DS/UIKIT/Tooltip","DS/CfgBaseUX/scripts/CfgSearchConfiguration","DS/PlatformAPI/PlatformAPI","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgConfigurationContextUX/CfgConfigurationContextCriteria","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","DS/UIKIT/Mask","UWA/Date","DS/CfgBaseUX/scripts/CfgAutocompleteControl","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],function(e,t,i,a,n,o,r,l,s,c,d,u,C,g,h,f,m,v,p,b,w,x,D,E){"use strict";c.compile(d);var S=null;return h.extend({collection:null,className:"CfgEditConfigurationContextView",gridListView:null,CfgFloatingPanel:null,toolBar:null,activatedView:"ModelView",tileCollection:null,caid:"",selectedModelsList:[],modelDefination:l.extend({defaults:function(){return{id:null,type:"",marketingName:"",name:"",state:"",description:"",owner:"",label:"",subLabel:"",icon:"",thumbnail:"",maturity:"",isactive:!1}}}),setup:function(){},init:function(t){this._parent(t),this.alertDiv=new e({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"});var i={};"Native"!==window.enoviaServerFilterWidget.mode&&(i.selection=t.selection),i.enabledCriterias=t.enabledCriteriaArray,null!=t.IsManufPlanAllowedFromNative&&(i.IsManufPlanAllowedFromNative=t.IsManufPlanAllowedFromNative),this.criteriaView=new b(i);var a=this;p.get2(function(e){console.log(e),null!=e.isLicenseValid&&0==e.isLicenseValid||(a.caid=e.change.id)})},render:function(){this.selectedModelsList=[];var e={};e.NoModelAttached=u.NoModelAttached;var t=this;x.mask(this.container),x.unmask(this.container),this.getDefaultImage(),this.createCollection(this.options);var i=UWA.createElement("div",{class:"main-Context-container"}),a="Dashboard";window.enoviaServerFilterWidget.mode&&"Native"==window.enoviaServerFilterWidget.mode&&(a="Native"),this.CfgAutocompleteControlObj=new E({placeholder:u.Autocomplete_PlaceHolder,multiSelect:!1,typeOfObject:"Model",collection:this.collection,environment:a,mode:"configurationcontext",onSelect:function(e,i){"Native"==e.environment&&e.mode,t.Textcomponentcallback(e)},searchCallback:function(e){t.searchcomponentcallback(t,e)}});var n=this.headercontainer=new UWA.createElement("div",{class:"header-container",html:[{tag:"div",class:"currCriteria-container"},{tag:"div",class:"toolbar-container"}]}),r=UWA.createElement("div",{class:"no-model-attached"}),l=UWA.createElement("div",{class:"gridlistview-dialog-container",styles:{position:"absolute"}});this.criteriaContent=new UWA.createElement("div",{class:"CriteriaContent"});if(this.container.addContent(n),this.criteriaView&&(this.criteriaContent.setContent(this.criteriaView.render(this.collection)),this.options.pandOAccess)){let e=this.options.pandOAccess;"Not Granted"!=e.AttachModels&&"Not Granted"!=e.GetAttachedModels||this.criteriaContent.addClassName("cfg-readonly-criteria")}if(this.container.addContent(this.criteriaContent),this.AutocompleteContainer=UWA.createElement("div",{class:"autocompleteContainer",html:this.CfgAutocompleteControlObj}),this.AutocompleteContainer.hide(),this.container.addContent(this.AutocompleteContainer),i.addContent(r),i.addContent(l),new s({element:i}).inject(this.container),t.availableChangeControlledObjectsCount=0,"Native"!==window.enoviaServerFilterWidget.mode){var c=t.options.selection;o.isChangeControlledList(c).then(function(e){t.availableChangeControlledObjectsCount=o.isChangeControlledObjectAvailable(e)})}return this.createToolbar(),this.refreshToolbar(),this.createHeader(),this.createView(),this.GridView=this.container.getElement(".gridlistview-dialog-container"),this.EmptyView=this.container.getElement(".no-model-attached"),this.EmptyView.setContent("<span><img src="+this.defaultIcon+' style="width:25%;"></img></span><br>'),this.EmptyView.addContent('<font-size="17px">'+e.NoModelAttached+"</font>"),this.EmptyView.setStyle("color","silver"),this.EmptyView.setStyle("text-align","center"),this.EmptyView.setStyle("display","inline-flex"),this.EmptyView.setStyle("flex-direction","column"),this.EmptyView.setStyle("justify-content","center"),this.filpflopDivs(),this.alertDiv.inject(this.container,"top"),this.collection.addEvent("onAdd",function(){if(t.refreshToolbar(),t.filpflopDivs(),t.collection&&1==t.collection.length){var e=[];t.collection.forEach(function(t,i){e.push({id:"pid:"+t.id})}),t.isModelVersionAvailable(e).then(function(e){e;var i=e.criteria,a=[];i.forEach(function(e,t){var n=i[t],o=[];(o=Object.keys(n)).forEach(function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=a.indexOf(o[t])||a.push(o[t])})});var n={feature:a.indexOf("variant")>=0?"true":"false",productState:a.indexOf("products")>=0?"true":"false"};t.criteriaView&&t.criteriaView.updateCollection(t.collection,n),t.criteriaView&&t.criteriaView.renderCriteriaView()})}else t.criteriaView&&t.criteriaView.updateCollection(t.collection),t.criteriaView&&t.criteriaView.renderCriteriaView();t.createView()}),this.collection.addEvent("onRemove",function(){t.refreshToolbar(),t.filpflopDivs(),t.criteriaView&&(t.criteriaView.updateCollection(t.collection),t.criteriaView.renderCriteriaView()),t.CfgAutocompleteControlObj.disableSelection(t.collection),t.createView()}),i.addEvent("resize",function(){if("ModelView"===t.activatedView){var e=0,i=t.headercontainer.getDimensions().height,a=t.criteriaContent.getDimensions().height,n=t.AutocompleteContainer.getDimensions().height;t.AutocompleteContainer.isHidden()||(e=n+5),this.setStyle("height","calc(100% - "+(i+e+5)+"px)")}else if("CriteriaView"===t.activatedView){i=t.headercontainer.getDimensions().height,a=t.criteriaContent.getDimensions().height;this.setStyle("height","calc(100% - "+(i+a+10)+"px)")}}),this.container},createToolbar:function(){this.toolBar&&this.toolBar.destroy();this.toolBar=new n({renderTo:this.container.getElement(".toolbar-container"),items:this.getToolBarItems2()})},getToolBarItems2:function(){var e=this;return e.isCogEnabled=!1,[{fonticon:"plus",text:u.Attach,handler:function(t,i){var a=null;""!=e.caid&&(a={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+e.caid}}),null==a&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length>e.availableChangeControlledObjectsCount?(o.showwarning(u.CfgErrorSomeChangeControlled,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container)):null==a&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length==e.availableChangeControlledObjectsCount?(o.showwarning(u.CfgErrorAllChangeControlled,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container)):e.options.pandOAccess&&"Not Granted"==e.options.pandOAccess.AttachModels?(o.showwarning(C.CfgMessageAccessRightsError,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container)):e.addContextToggle()}},{fonticon:"trash",text:u.Detach,handler:function(t,i){x.mask(e.container);var a=null;if(""!=e.caid&&(a={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+e.caid}}),null==a&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length>e.availableChangeControlledObjectsCount)o.showwarning(u.CfgErrorSomeChangeControlled,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container);else if(null==a&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length==e.availableChangeControlledObjectsCount)o.showwarning(u.CfgErrorAllChangeControlled,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container);else if(e.options.pandOAccess&&"Not Granted"==e.options.pandOAccess.DetachModels)o.showwarning(C.CfgMessageAccessRightsError,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container);else if(e.selectedModelsList.length>0)if("Native"==window.enoviaServerFilterWidget.mode)for(i=0;i<e.selectedModelsList.length;){var n=e.selectedModelsList[i];e.selectedModelsList.splice(0,1),e.collection.remove(n),x.unmask(e.container)}else{var r=[];for(i=0;i<e.options.selection.length;i++)r.push(e.options.selection[i].id);e.setConfigurationContext("RemoveContext",a,r,e.selectedModelsList).then(function(t){"SUCCEED"==t.result?(e.ondetach(e,t,"SUCCEED"),x.unmask(e.container),console.log("Detach configuration context succeed.")):"FAILED"==t.result?(e.ondetach(e,t,"FAILED"),x.unmask(e.container),console.log("Detach configuration context failed.")):(o.showwarning(u.DetachFailed,"error"),x.unmask(e.container),console.log("Detach configuration context failed."))},function(t){if(t.errorMessage){var i=t.errorMessage;o.showwarning(i,"error")}else o.showwarning(u.DetachFailed,"error");x.unmask(e.container)})}}},{fonticon:"cog",text:u.EditCriteria,handler:function(t,i){if(e.options.pandOAccess){let t=e.options.pandOAccess;"Not Granted"!=t.AttachModels&&"Not Granted"!=t.GetAttachedModels||e.criteriaView.readOnlyCriteriaView()}e.isCogEnabled=!e.isCogEnabled,e.AutocompleteContainer.isHidden()||(e.toolBar.getItem(0).elements.container.removeClassName("addContextActivePlus"),e.AutocompleteContainer.hide()),e.isCogEnabled?e.toolBar.getItem(2).elements.container.addClassName("criteriaActiveCog"):e.toolBar.getItem(2).elements.container.removeClassName("criteriaActiveCog"),e.editCriteria(e.isCogEnabled)}}]},refreshToolbar:function(){var e=this.toolBar.getItem(1),t=this.toolBar.getItem(2);this.selectedModelsList.length<=0?e.elements.container.hide():e.elements.container.show(),this.criteriaView&&(this.collection&&this.collection.length>0&&this.options.isCriteriaEditable?t.elements.container.show():t.elements.container.hide())},addContextToggle:function(){this.AutocompleteContainer.isHidden()?(this.toolBar.getItem(0).elements.container.addClassName("addContextActivePlus"),this.AutocompleteContainer.show(),this.CfgAutocompleteControlObj.elements.input.focus(),this.isCogEnabled=!1,this.toolBar.getItem(2).elements.container.removeClassName("criteriaActiveCog"),this.editCriteria(!1),this.criteriaContent.hide()):(this.toolBar.getItem(0).elements.container.removeClassName("addContextActivePlus"),this.AutocompleteContainer.hide(),this.editCriteria(!1))},setConfigurationContext:function(e,t,i,a,n){var r=[],l=[],s=[];return null!=i&&null!=i&&(r=i),"PropagateContext"!=e&&"AddContext"!=e||null==a||null==a?"RemoveContext"==e&&null!=a&&null!=a&&(s=a):l=a,new Promise(function(e,i){var a={version:"1.2",pidList:r,content:{attachCfgCtxt:l,detachCfgCtxt:s}};null!=n&&null!=n&&(a.content.enabledCriteria=n);a=JSON.stringify(a);o.makeWSCall("/resources/modeler/configuration/authoringServices/setConfiguredObjectInfo?cfgCtxt=1","POST","enovia","application/json",a,function(t){e(t)},function(e,t){i(t||e)},!0,t)})},createHeader:function(){var e=this.container.getElement(".currCriteria-container");this.criteriaView&&e.setContent(this.criteriaView.getActiveCriteria())},ondetach:function(e,t,i){var a=!1,n=0,r=0,l=0;let s=0,c="";for(var d=[],C=[],g=[],h=0;h<t.details.length;h++)for(var f=0;f<t.details[h].contexts.content.length;f++){var m=t.details[h].contexts.content[f];if("detached"==m.status){var v=m.attributes[0].physicalID,p=e.selectedModelsList.indexOf(v);-1==d.indexOf(v)&&(d.push(v),n++),"SUCCEED"==i&&(-1!==p&&e.selectedModelsList.splice(p,1),a=!0,e.collection.remove(v),e.collection.isCollectionModified=!0)}else if("ERROR"==m.status){-1==C.indexOf(m.attributes[0].physicalID)&&C.push(m.attributes[0].physicalID);for(var b=m.attributes[0].basicData.length,w="",x=0;x<b;x++)"name"==m.attributes[0].basicData[x].name&&null!=m.attributes[0].basicData[x].value&&(w=m.attributes[0].basicData[x].value[0]),m.attributes[0].data[0]&&m.attributes[0].data[0].value[0]&&(w=m.attributes[0].data[0].value[0]);"03"==m.errorCode?(r++,g.push(w)):"02"==m.errorCode?l++:"04"===m.errorCode&&(s++,c=c||m.errorMessage)}}if(null!=d.length&&d.length>=1&&C.forEach(function(e,t){-1!=d.indexOf(C[t])&&d.pop(C[t])}),d.forEach(function(t,i){var n=e.selectedModelsList.indexOf(d[i]);-1!==n&&e.selectedModelsList.splice(n,1),a=!0,e.collection.remove(d[i])}),"FAILED"==t.result&&(n>=1||r>=1||l>=1||s>=1)&&(r>=1&&n>=1?o.showwarning(u.PartialDetachFailed,"error"):r>=1&&0==n?g.forEach(function(e,t){o.showwarning(g[t]+" "+u.HasEffectivityReferences,"error")}):l>=1?o.showwarning(u.HasProductConfigurationsReferences,"error"):s>=1?o.showwarning(c||u.DetachFailedDueToCRDefined,"error"):o.showwarning(u.DetachFailed,"error")),1==a){for(f=0;f<e.selectedModelsList.length;f++)e.collection.get(e.selectedModelsList[f])._attributes.isactive=!1;e.selectedModelsList=[]}e.filpflopDivs()},filpflopDivs:function(){if(this.collection.length<=0){this.activatedView="ModelView",this.GridView.setStyle("display","none"),this.EmptyView.setStyle("display","inline-flex"),this.criteriaContent.setStyle("display","none"),this.container.getElement(".currCriteria-container").setStyle("display","none");var e=0,t=this.headercontainer.getDimensions().height,i=this.AutocompleteContainer.getDimensions().height;this.AutocompleteContainer.isHidden()||(e=i+5),this.container.getElement(".main-Context-container").setStyle("height","calc(100% - "+(t+e+5)+"px)")}else{if(this.container.getElement(".currCriteria-container").setStyle("display","flex"),"ModelView"===this.activatedView){e=0,t=this.headercontainer.getDimensions().height,i=this.AutocompleteContainer.getDimensions().height;this.AutocompleteContainer.isHidden()||(e=i+5);var a=this.criteriaContent.getDimensions().height;this.EmptyView.setStyle("display","none"),this.criteriaContent.setStyle("display","none"),this.container.getElement(".main-Context-container").setStyle("height","calc(100% - "+(t+e+5)+"px)"),this.GridView.setStyle("display","flex")}else if("CriteriaView"===this.activatedView){var n=0;t=this.headercontainer.getDimensions().height,a=this.criteriaContent.getDimensions().height,i=this.AutocompleteContainer.getDimensions().height;n=this.AutocompleteContainer.isHidden()?a+5:i,this.EmptyView.setStyle("display","none"),this.criteriaContent.setStyle("display","block"),this.container.getElement(".main-Context-container").setStyle("height","calc(100% - "+(t+n+5)+"px)")}}},searchcomponentcallback:function(e,t){var i=[];(e=this).iFromSearchPanel=t;for(var a=0;a<t.length;a++)i.push(t[a].get("id"));x.mask(e.container);var n=function(t,n){if(t.length>0){var r=null;""!=e.caid&&(r={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+e.caid}});var l=[],s=n;for(a=0;a<e.options.selection.length;a++)l.push(e.options.selection[a].id);e.setConfigurationContext("AddContext",r,l,i,s).then(function(t){"SUCCEED"==t.result?(e.onattach(e,t),x.unmask(e.container)):(o.showwarning(u.AttachFailed,"error"),x.unmask(e.container))},function(t){t&&t.errorMessage&&t.errorMessage.includes("Attach models failed, possibly because of access issue on objects.")?o.showwarning(C.CfgMessageFrozenReferenceAddContextFailed,"error"):"103"==t.errorID?o.showwarning(u.V5AttachFailed,"error"):t&&t.errorMessage?o.showwarning(u.EditContextFailed+t.errorMessage,"error"):o.showwarning(u.AttachFailed,"error"),x.unmask(e.container)})}};if(e.collection&&0==e.collection.length){var r=[];i.forEach(function(e){r.push({id:"pid:"+e})}),S=null,e.isModelVersionAvailable(r).then(function(t){t;var i=t.criteria,a=[];i.forEach(function(e,t){var n=i[t],o=[];(o=Object.keys(n)).forEach(function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=a.indexOf(o[t])||a.push(o[t])})});var o={feature:a.indexOf("variant")>=0?"true":"false",productState:a.indexOf("products")>=0?"true":"false"};n(e.iFromSearchPanel,o)})}else n(e.iFromSearchPanel)},Textcomponentcallback:function(e){var t=[],i=this;if("Native"==window.enoviaServerFilterWidget.mode){var a=e.value,n=e.sublabel?jsonresponse.sublabel:"",r="",l="",s="",c={};e._attributes.forEach(function(e){if("ds6w:what/ds6w:policy"==e.name&&(c.type=e.value),"preview_url"==e.name&&(c.image=e.value),"ds6w:label"==e.name&&(c.marketingName=e.value),"ds6w:identifier"==e.name&&(c.name=e.value),"ds6w:who/ds6w:responsible/ds6w:originator"==e.name&&(c.owner=e.value),"ds6w:what/ds6w:status"==e.name&&-1!=e.value.indexOf("Model.")&&(c.state=e.value.split("Model.").pop()),"preview_url"==e.name&&(l=e.value),"type_icon_url"==e.name&&(s=e.value),"ds6w:when/ds6w:modified"==e.name){var t=e.value;t&&(r=i.getFormatedDate(t))}});var d=new i.modelDefination({id:a,type:c.type||"",marketingName:c.marketingName||"",name:c.name||"",state:c.state,description:"",owner:c.owner,label:c.marketingName,subLabel:n,thumbnail:"",maturity:c.state,isactive:!1,dateModified:r,preview_url:l,icon:s,isToPropagate:!1});i.collection.add(d)}else{i.ItemFromType=e,t.push(e.value),x.mask(i.container);var g=function(a){if(e.value){var n=null;""!=i.caid&&(n={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+i.caid}});for(var r=[],l=a||"",s=0;s<i.options.selection.length;s++)r.push(i.options.selection[s].id);i.setConfigurationContext("AddContext",n,r,t,l).then(function(e){"SUCCEED"==e.result?(i.onattach(i,e),x.unmask(i.container)):(o.showwarning(u.AttachFailed,"error"),x.unmask(i.container))},function(e){e&&e.errorMessage&&e.errorMessage.includes("Attach models failed, possibly because of access issue on objects.")?o.showwarning(C.CfgMessageFrozenReferenceAddContextFailed,"error"):"103"==e.errorID?o.showwarning(u.V5AttachFailed,"error"):e&&e.errorMessage?o.showwarning(u.EditContextFailed+e.errorMessage,"error"):o.showwarning(u.AttachFailed,"error"),x.unmask(i.container)})}};if(i.collection&&0==i.collection.length){var h=[];t.forEach(function(e){h.push({id:"pid:"+e})}),S=null,i.isModelVersionAvailable(h).then(function(e){e;var t=e.criteria,i=[];t.forEach(function(e,a){var n=t[a],o=[];(o=Object.keys(n)).forEach(function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=i.indexOf(o[t])||i.push(o[t])})});var a={feature:i.indexOf("variant")>=0?"true":"false",productState:i.indexOf("products")>=0?"true":"false"};g(a)})}else g()}},isModelVersionAvailable:function(e){if(null!=S)return S;var t=new Promise(function(t,i){var a={version:"1.0.0",modelIds:e};a=JSON.stringify(a);o.makeWSCall("/resources/modeler/browsing/model/getcriteria","POST","enovia","application/json",a,function(e){var i=e.criteria,a=[];i.forEach(function(e,t){var n=i[t],o=[];(o=Object.keys(n)).forEach(function(e,t){"TRUE"!=n[o[t]]&&"True"!=n[o[t]]||-1!=a.indexOf(o[t])||a.push(o[t])})}),t(e)},function(e){console.log("fail to get last product evolution")},!0)});return S=t,t},onattach:function(e,t){if("Native"==window.enoviaServerFilterWidget.mode){var i;(i=t.contextList).length>0&&i.forEach(function(t){if(t&&t.physicalID){var i="",a="",n="",o="",r="",l="",s="",c="",d=t.isToPropagate,u=t.basicData.length;let f="";for(var C=0;C<u;C++){if("type"==t.basicData[C].name&&null!=t.basicData[C].value&&(i=t.basicData[C].value),"name"==t.basicData[C].name&&null!=t.basicData[C].value&&(r=n=a=l=t.basicData[C].value),"current"==t.basicData[C].name&&null!=t.basicData[C].value&&(o=t.basicData[C].value[1]),"owner"==t.basicData[C].name&&null!=t.basicData[C].value&&(c=t.basicData[C].value),"ds6w:when/ds6w:modified"==t.basicData[C].name&&null!=t.basicData[C].value){var g=t.basicData[C].value;g&&(s=e.getFormatedDate(g))}t.data[0]&&t.data[0].value&&0!=t.data.length&&"Marketing Name"==t.data[0].name&&(a=t.data[0].value[0]),"type_icon_url"==t.basicData[C].name&&null!=t.basicData[C].value&&(f=t.basicData[C].value)}null!=t.propValue&&(d=t.propValue);var h=new e.modelDefination({id:t.physicalID,type:i||"",marketingName:a||"",name:n||"",state:o,description:"",owner:c,label:r,subLabel:l,thumbnail:"",maturity:o,isactive:!1,dateModified:s,preview_url:t.preview_url,icon:""!=f?f:e.defaultIcon,isToPropagate:d});e.collection.add(h)}})}else{let i=enoviaServerFilterWidget.baseURL;for(var a=0;a<t.details.length;a++){for(var n=0;n<t.details[a].contexts.content.length;n++){let f="",m="";null!=(g=t.details[a].contexts.content[n]).attributes[0].type_icon_url&&-1==g.attributes[0].type_icon_url.indexOf(i)&&(m=i+g.attributes[0].type_icon_url),null!=g.attributes[0].type_icon_large_url&&-1==g.attributes[0].type_icon_large_url.indexOf(i)&&(f=i+g.attributes[0].type_icon_large_url),""==g.attributes[0].preview_url&&(g.attributes[0].preview_url=""!=f?f:e.defaultImage);var o=" ";if("attached"==g.status){for(var r="",l="",s="",c="",d="",u=g.attributes[0].basicData.length,C=0;C<u;C++){if("name"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value&&(r=o=g.attributes[0].basicData[C].value[0]),"owner"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value&&(d=g.attributes[0].basicData[C].value[0]),"current"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value&&(l=g.attributes[0].basicData[C].value[0]),"modified"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value)(h=g.attributes[0].basicData[C].value[0])&&(c=e.getFormatedDate(h))}g.attributes[0].data[0]&&g.attributes[0].data[0].value&&(o=g.attributes[0].data[0].value[0]);var g=new e.modelDefination({id:g.attributes[0].physicalID,type:g.attributes[0].type,marketingName:o,name:r,state:l,description:s,owner:d,label:r,subLabel:r,thumbnail:"",maturity:l,isactive:!1,preview_url:g.attributes[0].preview_url,dateModified:c,icon:""!=m?m:e.defaultIcon,isToPropagate:!1});e.collection.add(g),e.collection.isCollectionModified=!0}else if("alreadyAttached"==g.status){for(r="",l="",s="",c="",d="",u=g.attributes[0].basicData.length,C=0;C<u;C++){var h;if("name"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value&&(r=o=g.attributes[0].basicData[C].value[0]),"owner"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value&&(d=g.attributes[0].basicData[C].value[0]),"current"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value&&(l=g.attributes[0].basicData[C].value[0]),"modified"==g.attributes[0].basicData[C].name&&null!=g.attributes[0].basicData[C].value)(h=g.attributes[0].basicData[C].value[0])&&(c=e.getFormatedDate(h))}g.attributes[0].data[0]&&g.attributes[0].data[0].value&&(o=g.attributes[0].data[0].value[0]);g=new e.modelDefination({id:g.attributes[0].physicalID,type:g.attributes[0].type,marketingName:o,name:r,state:l,description:s,owner:d,label:r,subLabel:r,thumbnail:"",maturity:l,isactive:!1,preview_url:g.attributes[0].preview_url,dateModified:c,icon:""!=m?m:e.defaultIcon,isToPropagate:!1});e.collection.add(g),e.collection.isCollectionModified=!0}}e.filpflopDivs()}}},editCriteria:function(e){this.activatedView=1==e?"CriteriaView":"ModelView",this.filpflopDivs(),this.refreshToolbar()},createCollection:function(e){var t,i,a=[],n=this;i=e.contextList,"Native"==window.enoviaServerFilterWidget.mode?null!=i&&i.length>0&&i.forEach(function(e){if(e&&e.physicalID){var i="",o="",r="",l="",s="",c="",d="",u="",C=!0,g="";let v="";for(var h=e.basicData.length,f=0;f<h;f++){if("type"==e.basicData[f].name&&null!=e.basicData[f].value&&(i=e.basicData[f].value[0]),"name"==e.basicData[f].name&&null!=e.basicData[f].value&&(c=r=o=d=e.basicData[f].value),"current"==e.basicData[f].name&&null!=e.basicData[f].value&&(s=e.basicData[f].value[1]),"owner"==e.basicData[f].name&&null!=e.basicData[f].value&&(u=e.basicData[f].value),"ds6w:when/ds6w:modified"==e.basicData[f].name&&null!=e.basicData[f].value){var m=e.basicData[f].value;m&&(l=n.getFormatedDate(m))}"type_icon_url"==e.basicData[f].name&&null!=e.basicData[f].value&&(v=e.basicData[f].value)}e.data[0]&&e.data[0].value[0]&&e.data.length>0&&(o=e.data[0].value[0]),g=null==e.preview_url||null==e.preview_url||""==e.preview_url?n.defaultImage:e.preview_url,null!=e.isToPropagate&&(C=e.isToPropagate),t={id:e.physicalID,type:i||"",marketingName:o||"",name:r||"",state:s,description:"",owner:u,label:c,subLabel:d,thumbnail:"",maturity:s,isactive:!1,preview_url:g,dateModified:l,icon:n.defaultIcon,isToPropagate:C},""!=v&&(t.icon=v),a.push(t)}}):null!=i&&i.length>0&&i.forEach(function(e){if(e&&e.physicalID){var i="",o="",r="",l="",s="",c="",d="",u="",C=!0,g="";let v="";for(var h=e.basicData.length,f=0;f<h;f++)if("type"==e.basicData[f].name&&null!=e.basicData[f].value&&(i=e.basicData[f].value[0]),"name"==e.basicData[f].name&&null!=e.basicData[f].value&&(c=r=d=o=e.basicData[f].value[0]),"current"==e.basicData[f].name&&null!=e.basicData[f].value&&(s=e.basicData[f].value[0]),"owner"==e.basicData[f].name&&null!=e.basicData[f].value&&(u=e.basicData[f].value[0]),"modified"==e.basicData[f].name&&null!=e.basicData[f].value){var m=e.basicData[f].value[0];m&&(l=n.getFormatedDate(m))}e.data[0]&&e.data[0].value&&(o=e.data[0].value[0]),g=null==e.preview_url||null==e.preview_url||""==e.preview_url?n.defaultImage:e.preview_url,null!=e.type_icon_large_url&&(g=e.type_icon_large_url),null!=e.type_icon_url&&(v=e.type_icon_url),null!=e.isToPropagate&&(C=e.isToPropagate),t={id:e.physicalID,type:i||"",marketingName:o||"",name:r||"",state:s,description:"",owner:u,label:c,subLabel:d,thumbnail:"",maturity:s,isactive:!1,preview_url:g,dateModified:l,icon:n.defaultIcon,isToPropagate:C},""!=v&&(t.icon=v),a.push(t)}}),this.collection=new r(a,{model:this.modelDefination}),this.collection.isCollectionModified=!1},getDefaultImage:function(){this.defaultImage=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png",this.defaultIcon=enoviaServerFilterWidget.baseURL+"/common/images/I_Model_Thumbnail.png"},createView:function(){var e=this,t=e.collection,n=[];e.myResponsiveTilesCollectionView=new i,e.myResponsiveTilesCollectionView.modelProvider=new a,t.forEach(function(e){e._attributes.isactive=!1;var t=[],i=[];1==e._attributes.isToPropagate&&(t.push("propagate"),i.push(u.PropagateModelTooltip));var a=u.Tootip_Title+" : "+e.get("marketingName")+"\n"+u.Tootip_Name+" : "+e.get("name")+"\n"+u.Tootip_Owner+" : "+e.get("owner")+"\n"+u.Tootip_Maturity+" : "+e.get("maturity")+"\n"+u.Tootip_Modification_Date+" : "+e.get("dateModified"),o={label:e.get("marketingName"),customTooltip:a,icon:e.get("icon"),picture:e.get("preview_url"),subLabel:e.get("name")+" | "+e.get("owner"),description:e.get("maturity")+" | "+e.get("dateModified"),statusbarIcons:t,statusbarIconsTooltips:i,contextualMenu:[],propertiesList:["propertiesList1"],emptyStatusbarVisibleFlag:!0,modelData:e};n.push(o)}),e.selectedModelsList.length>0&&(e.selectedModelsList=[],e.refreshToolbar()),e.tileCollection=new r,e.tileCollection.push(n),e.myResponsiveTilesCollectionView.loadApplicativeModel(e.tileCollection),e.myResponsiveTilesCollectionView.onStatusbarIconPointerDown=function(t){if(null!=t.clickedIconIndex&&t.clickedIconIndex>=0&&t.clickedIconIndex<t.cellInfos.cellModel._attributes.statusbarIcons.length){for(var i=[],a=[],n=0;n<t.cellInfos.cellModel._attributes.statusbarIcons.length;n++)i.push(t.cellInfos.cellModel._attributes.statusbarIcons[n]),a.push(t.cellInfos.cellModel._attributes.statusbarIconsTooltips[n]);if("propagate"===i[t.clickedIconIndex]){var r=e.container;x.mask(r);var l=null;""!=e.caid&&(l={operationheader:{key:"DS-Change-Authoring-Context",value:"pid:"+e.caid}});var s=[],c=[];e.propagateModelId=[];var d=t.cellInfos.cellModel._attributes.modelData.get("marketingName");if(e.propagateModelId.push(t.cellInfos.cellModel._attributes.modelData.get("id")),c.push(t.cellInfos.cellModel._attributes.modelData.id),"Native"==window.enoviaServerFilterWidget.mode)x.unmask(r),e.postPropagateCollection();else{for(n=0;n<e.options.selection.length;n++)s.push(e.options.selection[n].id);if(null==l&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length>e.availableChangeControlledObjectsCount)o.showwarning(u.CfgErrorSomeChangeControlled,"error"),e.myResponsiveTilesCollectionView.unselectAll(),x.unmask(e.container);else if(null==l&&e.availableChangeControlledObjectsCount>0&&e.options.selection.length==e.availableChangeControlledObjectsCount)o.showwarning(u.CfgErrorAllChangeControlled,"error"),x.unmask(r);else if(e.options.pandOAccess&&"Not Granted"==e.options.pandOAccess.AttachModels)o.showwarning(C.CfgMessageAccessRightsError,"error"),x.unmask(r);else{let t=e.collection._models.find(e=>e.id===c[0]);t&&t._attributes&&"Obsolete"!==t._attributes.maturity?e.setConfigurationContext("PropagateContext",l,s,c).then(function(t){"SUCCEED"==t.result?(x.unmask(r),o.showwarning(`${d.replaceAll("<","&lt;")} ${u.PropagateModelSuccessful}`,"success"),e.postPropagateCollection(),console.log("propagate successful")):(x.unmask(r),o.showwarning(`${d.replaceAll("<","&lt;")} ${u.PropagateModelFailed}`,"error"),console.log("propagate Failed"))},function(e){e&&e.errorMessage&&e.errorMessage.includes("Attach models failed, possibly because of access issue on objects.")?o.showwarning(C.CfgMessageFrozenReferenceAddContextFailed,"error"):"103"==e.errorID?o.showwarning(u.V5AttachFailed,"error"):o.showwarning(u.PropagateModelFailed+","+e.errorMessage,"error"),x.unmask(r)}):(o.showwarning(u.CfgErrorInappropiateStateModelAttach,"error"),c=[],x.unmask(r))}}}}},e.myResponsiveTilesCollectionView.onSelectionAdd(function(t){var i=t._attributes;e.ontileviewclick2(t,i)}),e.myResponsiveTilesCollectionView.onSelectionRemove(function(t){var i=t._attributes;e.ontileviewclick2(t,i)}),e.myResponsiveTilesCollectionView.inject(e.container.getElement(".gridlistview-dialog-container"))},postPropagateCollection:function(){var e=this;e.collection._models.forEach(function(t){t.id==e.propagateModelId[0]&&(t._attributes.isToPropagate=!1,e.propagateModelId.splice(0,1))}),e.collection.isCollectionModified=!0,e.createView()},ontileviewclick2:function(e,t){var i;1==t.modelData._attributes.isactive?(t.modelData._attributes.isactive=!1,-1!==(i=this.selectedModelsList.indexOf(t.modelData.id))&&this.selectedModelsList.splice(i,1)):(t.modelData._attributes.isactive=!0,-1==(i=this.selectedModelsList.indexOf(t.modelData.id))&&this.selectedModelsList.push(t.modelData.id));this.refreshToolbar()},getModelIdsAndEnabledCriteria:function(e){var t=this,i=[];t.collection.forEach(function(e,t){i.push(e.id)});var a=[];t.collection.forEach(function(e,t){e.get("isToPropagate")||a.push(e.id)});var n=[];n=Object.getOwnPropertyNames(t.criteriaView.enabledCriteriasUX);var o=[];n.forEach(function(e){"true"==t.criteriaView.enabledCriteriasUX[e]&&o.push(e)});var r=[];return n.forEach(function(e){"true"!=t.criteriaView.enabledCriteriasUX[e]&&"mixedState"!=t.criteriaView.enabledCriteriasUX[e]||r.push(e)}),{modelIds:i,enabledCriteria:r,modelIdsCommon:a,criteriaCommon:o}},getFormatedDate:function(e){var t="";t="Native"==window.enoviaServerFilterWidget.mode?e.split("T")[0]:e.split("@")[0];var i=Date.parse(t),a=parseInt(i),n=new Date(a);return D.strftime(n,"%Y-%m-%d")}})}),define("DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextDialog",["DS/UIKIT/Alert","DS/CfgBaseUX/scripts/CfgDialog","UWA/Class/Collection","DS/PlatformAPI/PlatformAPI","UWA/Class/Model","DS/UIKIT/Scroller","DS/Handlebars/Handlebars4","text!DS/CfgConfigurationContextUX/CfgEditConfigurationContextDialogTemplate.html","i18n!DS/CfgConfigurationContextUX/assets/nls/CfgConfigurationContextUX","UWA/Class/View","DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext","DS/CfgConfigurationContextUX/CfgEditMultipleConfigurationContextView","text!DS/CfgBaseUX/assets/CfgUXEnvVariables.json","DS/CfgBaseUX/scripts/CfgUtility","DS/CfgBaseUX/scripts/CfgContainerView","DS/UIKIT/Mask","DS/CfgTracker/CfgTracker","DS/CfgTracker/CfgDimension","DS/CfgTracker/CfgValue","css!DS/CfgConfigurationContextUX/CfgConfigurationContextUX.css"],function(e,t,i,a,n,o,r,l,s,c,d,u,C,g,h,f,m,v,p){"use strict";r.compile(l);return c.extend({collection:null,className:"CfgEditConfigurationContextDialog",gridListView:null,CfgFloatingPanel:null,caid:"",selectedModelsList:[],setup:function(){},init:function(t){this._parent(t),this.alertDiv=new e({visible:!1,autoHide:!0,hideDelay:3e3,closeOnClick:!0,maximumVisibleMessages:3,className:"error"});var i=this;this.CfgUXEnvVariables=JSON.parse(C);d.get2(function(e){console.log(e),null!=e.isLicenseValid&&0==e.isLicenseValid||(i.caid=e.change.id)}),this.criteriaEditable=!0},sendEditContextTrackerEvent:function(e){var t="",i="",a=e.CfgEditMultipleConfigurationContextView.collection.length,n=1;"Native"==enoviaServerFilterWidget.mode?(t="Native",i="Web In Win"):(t=widget.data.appId,n=e.CfgEditMultipleConfigurationContextView.options.selection.length,i=null!=widget.options?widget.options.title:"ODT Environment");var o=m.ContextCriteria.FALSE,r=m.ContextCriteria.FALSE,l=m.ContextCriteria.FALSE,s=m.ContextCriteria.FALSE,c=m.ContextCriteria.FALSE;if(null!=e.CfgEditMultipleConfigurationContextView.criteriaView&&null!=e.CfgEditMultipleConfigurationContextView.criteriaView.enabledCriteriasUX){var d=e.CfgEditMultipleConfigurationContextView.criteriaView.enabledCriteriasUX;null!=d.feature&&"true"==d.feature&&(o=m.ContextCriteria.TRUE),null!=d.productState&&"true"==d.productState&&(r=m.ContextCriteria.TRUE),null!=d.manufacturingPlan&&"true"==d.manufacturingPlan&&(l=m.ContextCriteria.TRUE),null!=d.unit&&"true"==d.unit&&(s=m.ContextCriteria.TRUE),null!=d.contextualDate&&"true"==d.contextualDate&&(c=m.ContextCriteria.TRUE)}var u=m.getDeviceUsedForOperation(),C=m.ContextMode.READ;null!=e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&1==e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&(C=m.ContextMode.EDIT),m.createEventBuilder({category:m.Category.USAGE,action:m.Events.CLICK,tenant:enoviaServerFilterWidget.tenant}).setLabel(m.Labels.EDIT_CONFIGURATION_CONTEXT).setAppId(t).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONFIGURATION_CONTEXT_WIDGET,i).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_VARIANT,o).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_MODEL_VERSION,r).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_MANUFACTURING_PLAN,l).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_UNIT,s).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_CRITERIA_DATE,c).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_MEDIA,u).addDimension(v.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_MODE,C).addPersonalValue(p.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_NO_OF_MODEL,a).addPersonalValue(p.EDIT_CONFIGURATION_CONTEXT.EDIT_CONTEXT_REFERENCE_SELECTED,n).send()},sendEvtsToWidgetsOnCfgCtxDialogClose:function(){let e={commandName:"cfgEditConfigurationContext",widgetId:widget.id,response:this.CfgEditMultipleConfigurationContextView.collection,data:{}};a.publish("cfgEditConfigurationContextModification_"+widget.id,e),e.data={...e.data,pids:this.options.selection.map(e=>e.id)},g.publishPostProcessingEventForApplications(e)},render:function(){var e=this;this.selectedModelsList=[];s.NoModelAttached;var i=[{label:"Close",labelValue:s.Cancel,handler:function(){null!=e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&1==e.CfgEditMultipleConfigurationContextView.collection.isCollectionModified&&e.sendEvtsToWidgetsOnCfgCtxDialogClose(),e.CfgFloatingPanel.closeDialog(),e.sendEditContextTrackerEvent(e)},className:"primary"}];f.mask(this.container),f.unmask(this.container);var a={};a.enabledCriteriaArray=this.getActivatedCriteriaStates(e.options.response.enabledCriteria,e.options.selection),a.contextList=this.createCollectionForView(e.options.response),a.selection=e.options.selection,this.isCriteriaEditableCheck(e.options.response.referencesInfo),a.isCriteriaEditable=this.criteriaEditable,a.pandOAccess=e.options.pAndOAccess,this.CfgEditMultipleConfigurationContextView=new u(a);var n="";n=this.options.selection.length>1?s.Header+" - "+this.options.selection.length+" "+s.Header_All_Ref:s.Header+" - "+this.options.selection[0].alias,this.MainContainer=new UWA.Element("div",{id:"CtxView",html:this.CfgEditMultipleConfigurationContextView.render(),styles:{width:"100%",height:"100%"}});var o={className:"CfgEditConfigurationFloatingPanel",title:n,parent:widget.body,body:this.MainContainer,overlay:!0,mode:"DashboardConfigurationContext",closable:!1,animate:!0,resizable:!0,footer:i,persistId:"CfgEditConfigurationContextDialog",appNamePosition:0,width:440,height:490,minHeight:100,minWidth:370,style:{"min-height":"350px"},dialogue:{header:n,buttonArray:i,target:widget.body}};UWA.createElement("div",{class:"no-model-attached"}),UWA.createElement("div",{class:"gridlistview-dialog-container"});this.CfgFloatingPanel=new t(o),o.parent=widget.body,o.parentElement=widget.body,o.dialogue.object=this.CfgFloatingPanel,this.MainContainer.inject(this.CfgFloatingPanel.container),this.CfgFloatingPanel.render(),0==this.CfgUXEnvVariables.isWUXDialogEnabled&&(this.CfgFloatingPanel.resizeDialog=function(){},document.getElementsByClassName("CfgDashboardConfigurationContextDialog")[0].setAttribute("style",document.getElementsByClassName("CfgDashboardConfigurationContextDialog")[0].getAttribute("style")+"min-height:485px !important;min-width:350px !important;")),this.alertDiv.inject(this.container,"top"),widget.addEvent("onResize",function(){})},getActivatedCriteriaStates:function(e,t){for(var i={},a=0;a<e.length;a++)e[a].activatedFor.length==t.length?i[e[a].criteriaName]="true":e[a].activatedFor.length<t.length&&e[a].activatedFor.length>0?i[e[a].criteriaName]="mixedState":0==e[a].activatedFor.length&&(i[e[a].criteriaName]="false");return i},createCollectionForView:function(e){var t,i,a=[];return"1.0"==e.version&&(i=e.contextInfo),i.length>0&&i.forEach(function(e){if(e&&e.modelPID){var i=!0;0==e.notContextOf.length&&null!=e.notContextOf.length&&null!=e.notContextOf.length&&(i=!1),(t=e.content.results[0]).isToPropagate=i,a.push(t)}}),a},isCriteriaEditableCheck:function(e){var t=this;e.forEach(function(e){"NO"==e.isCriteriaEditable&&(t.criteriaEditable=!1)})},onResize:function(){},closeDialog:function(){this.CfgFloatingPanel&&this.CfgFloatingPanel.destroy()},renderNative:function(e){var t=this,i={isHeader:!1,isFooter:!0,firstButtonText:s.Cancel,headerText:"",onButtonClickCB:function(){var e=t.CfgEditMultipleConfigurationContextView.getModelIdsAndEnabledCriteria(),i={eventName:"cfgConfigurationContext",operation:"onClose",operationVersion:"1.0",content:e=JSON.stringify(e)};g.sendNotificationWebInWin(i),t.sendEditContextTrackerEvent(t)}};this.contextViewContainer=new h(i).render(),this.contextViewContainer.inject(e.parent),e.parent=this.contextViewContainer._body,e.isCriteriaEditable=this.criteriaEditable,this.CfgEditMultipleConfigurationContextView=new u(e),this.CfgEditMultipleConfigurationContextView&&e.parent.setHTML(this.CfgEditMultipleConfigurationContextView.render())},onModelSearchOK:function(e){this.CfgEditMultipleConfigurationContextView.onattach(this.CfgEditMultipleConfigurationContextView,e)}})});