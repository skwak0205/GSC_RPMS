define("DS/MIBListOfThingsWidget/MIBListOfThingsDataGridView",["UWA/Core","UWA/Controls/Abstract","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/Windows/ImmersiveFrame","DS/Utilities/UUID","css!DS/MIBListOfThingsWidget/MIBListOfThingsWidget"],function(t,e,i,n,o,s,a,c){"use strict";return e.extend({defaultOptions:{idName:"dgvContainerLOT"},context:{},model:null,dataGridView:null,init:function(t){this._parent(t),this.context=t.context,this.buildSkeleton(t.branches,t.list_of_things,t.selected_branchiter)},buildSkeleton:function(t,e,a){var c=this.options;this.model=new i;var r=this.model,l=[];t.forEach(t=>{var e=t.branch;t.iterations.forEach(t=>{l.push({branch:e,iter:t})})}),r.prepareUpdate(),e.forEach(t=>{var e={};e.id=t.id,e.label=t.Title,e.physicalid=t.physicalid,e.selected_physicalid=t.selected_physicalid,e.type=t.type,e.name=t.name,e.description=t.description,e.contentid=t.contentid,l.forEach(i=>{var n=i.branch,o=i.iter;t[n+"/"+o]&&(e[n+"_"+o]=!0)});var i=new n({label:e.label,grid:e});t.selected_physicalid&&i.updateOptions({color:"blue"}),r.addRoot(i)}),r.pushUpdate();var d=[{text:"Physicalid",dataIndex:"physicalid",sortableFlag:!1,width:"250px"},{text:"Content Id",dataIndex:"contentid",sortableFlag:!0,width:"250px"},{text:"Type",dataIndex:"type",sortableFlag:!0,width:"auto"},{text:"Name",dataIndex:"name",sortableFlag:!1,width:"auto"},{text:"Title",dataIndex:"label",sortableFlag:!1,width:"200px"},{text:"Description",dataIndex:"description",sortableFlag:!1,width:"auto"}];l.forEach(t=>{var e=t.branch,i=t.iter,n=a==e+"/"+i;d.push({text:e+" ("+i+")"+(n?" ***":""),dataIndex:e+"_"+i,sortableFlag:!0,width:"auto",typeRepresentation:"boolean"})}),this.dataGridView=new o({treeDocument:r,columns:d,cellDragEnabledFlag:!0,identifier:this.options.identifier});var h=this.dataGridView;this.myOnCellRequest=function(t,e){h.defaultOnCellRequest(t)},h.rowSelection="none",h.cellSelection="single";var u=new s;u.setContentInBackgroundLayer(h.getContent()),u.reactToPointerEventsFlag=!1;var g=UWA.createElement("div",{id:c.idName});u.inject(g),this.elements.container=g}})}),define("DS/MIBListOfThingsWidget/MIBListOfThingsWidget",["DS/MIBListOfThingsWidget/MIBListOfThingsDataGridView","css!DS/MIBListOfThingsWidget/MIBListOfThingsWidget","i18n!DS/MIBListOfThingsWidget/assets/nls/MIBListOfThingsWidgetNls","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","DS/LifecycleServices/LifecycleCommandManager","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleControls/CommandDialog","DS/WAFData/WAFData","UWA/Controls/Abstract","DS/LifecycleCmd/MessageMediator","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/LineEditor","DS/LifecycleServices/LifecycleAlert"],function(t,e,i,n,o,s,a,c,r,l,d,h,u,g,f){"use strict";return l.extend({init:function(t,e,i){this._parent(i),this.context={},this.securityCtx=null,this.tenant=null,this.id=i.id||"",this.container=UWA.createElement("div",{class:"miblot_container"}),this.content=UWA.createElement("div",{class:"miblot_content"}),this.content.inject(this.container);var n=this,o=new Promise((t,e)=>{a.app_initialization(function(){n.tenant=a.getTenant();var e=a.getOption("platform_services",null);null!=e&&e.length>0&&Array.isArray(e)&&e.forEach(function(e){null!=e&&e.hasOwnProperty("platformId")&&s.getSecurityContextList(e.platformId,function(){n.getSecurityContext=s.getSecurityContextForCollaborativeSharingCommands,t()})})})});Promise.all([o]).then(()=>{console.log("app_initialization done")}).catch(function(t){n._setEndWaitingResponse(),console.log("app_initialization failed:"),n.showError(t),n._onComplete()})},_onComplete:function(){},refresh:function(){this.executeCmd([])},executeCmd:function(t,e,i){null==e&&(e={}),null==i&&(i=function(){});var n=this;if(e.hasOwnProperty("context")&&e.context&&(this.context=e.context),this._onComplete=function(){i&&i()},null==t&&(t=this.previous_selection),null==t&&(t=[]),this.previous_selection=t,this.content.empty(),0!=t.length){if(1!=t.length)return n.showNotification("only one object selection is accepted"),void n._onComplete();if("function"==typeof this.context.getSecurityContext){var o=n.context.getSecurityContext();n.securityCtx=o.SecurityContext}n.selectedobject=null,t.forEach(function(t){t.hasOwnProperty("objectId")&&""!=t.objectId&&(n.selectedobject={objectId:t.objectId})});var c=new Promise(t=>{t()});UWA.Promise.all([c,(()=>new Promise((t,e)=>{var i=a.getCurrentFolderSecurityContext();"function"==typeof this.context.getSecurityContext&&(i=this.context.getSecurityContext().SecurityContext),null!=i?(n.securityCtx=i,t()):s.getSecurityContextPromise(this.tenant).then(function(e){n.securityCtx=e,t()}).catch(function(t){e(t)})}))()]).then(()=>{n._setWaitingResponse(),n._getLotData(function(){n._showLotdata()})}).catch(function(t){n._setEndWaitingResponse(),n.showError(t),n._onComplete()})}else n._onComplete()},_getLotData:function(t){var e=this;console.log("MIBListOfThingsWidget _getLotData");var i=a.get3DSpaceWSUrl(this.tenant,"/resources/lifecycle/mibdebugws/listofthings",null),o=a.getHeaders(encodeURIComponent(e.securityCtx)),c={objectId:e.selectedobject.objectId};r.authenticatedRequest(i,{method:"POST",type:"json",headers:o,timeout:6e5,data:JSON.stringify(c),onComplete:function(i){e._setEndWaitingResponse(),console.log("MIBListOfThingsWidget _getLotData server request: Complete");var n=null;i.hasOwnProperty("status")&&(n=i.status),null!=n&&"success"==n?(e.selected_object=i.selected_object,e.selected_branch=i.selected_branch,e.selected_module=i.module,e.branches=i.branches,e.list_of_things=i.list_of_things,e.selected_branchiter=i.selected_branchiter,t()):(console.log("MIBListOfThingsWidget _getLotData failed"),e.showError("failed"),e._onComplete())},onFailure:function(t,i){e._setEndWaitingResponse(),console.log("MIBListOfThingsWidget _getLotData server request: Failure..."+t),e.showError(s.parseWebServiceError(t,i)),e._onComplete()},ontimeout:function(){e._setEndWaitingResponse(),console.log("MIBListOfThingsWidget _getLotData server request: Timeout"),e.showError(n.timeout),e._onComplete()}})},_showLotdata:function(){var e=this.content;this.dgvContainer=new t({identifier:"dgvContainerLOT"+this.id,idName:"dgvContainerLOT",branches:this.branches,list_of_things:this.list_of_things,selected_branchiter:this.selected_branchiter,context:this.context}),this.dgvContainer.inject(e),this.dispatchEvent("onResultDisplayed")},_setWaitingResponse:function(){void 0!==this.widget&&null!==this.widget?this.widget.body.style.cursor="wait":document.body.style.cursor="wait"},_setEndWaitingResponse:function(){void 0!==this.widget&&null!==this.widget?this.widget.body.style.cursor="default":document.body.style.cursor="default"},showNotification:function(t){if("function"==typeof this.context.displayNotification){var e={eventID:"primary",msg:t};this.context.displayNotification(e)}else{e={eventID:"primary",msg:t};f.displayNotification(e)}console.log(t)},showError:function(t){if("function"==typeof this.context.displayNotification){var e={eventID:"error",msg:t};this.context.displayNotification(e)}else{e={eventID:"error",msg:t};f.displayNotification(e)}console.log(t)},showSuccess:function(t){if("function"==typeof this.context.displayNotification){var e={eventID:"success",msg:t};this.context.displayNotification(e)}else{e={eventID:"success",msg:t};f.displayNotification(e)}console.log(t)}})});