define("DS/VCXWebGUI/VCXUpdateView",["UWA/Class","DS/CoreEvents/Events","DS/Controls/Tab","DS/Windows/Dialog","DS/Controls/Accordeon","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o){"use strict";return e.singleton({initialize:function(e,n){this._experienceBase=n,this.immersiveFrame=e;var i=this;this.event_VCX_END_LOADING_DONE=t.subscribe({event:"VCX_END_LOADING_DONE"},function(e){i.ShowNotification(),i.addDiv()})},getNameForComponentID:function(e){var t="unknown",n=this._experienceBase.ComponentsMap.GetComponentFromID(e);if(n){var i=n.QueryInterface("VCXIModifiable");if(i){var a=i.GetProperty("Actor.Name");a&&(t=a.GetPropertyValue().GetValue())}}return t},unInit:function(){this._experienceBase=null,this.event_VCX_END_LOADING_DONE&&(t.unsubscribe(this.event_VCX_END_LOADING_DONE),delete this.event_VCX_END_LOADING_DONE),this.removeDiv()},removeDiv:function(){this.DSFontIconPanel&&this.DSFontIconPanel.close(),this.DSFontIconPanel=null},addDiv:function(){if(this.immersiveFrame&&!this.DSFontIconPanel){var e=null,t=this._experienceBase.getManager("VCXExperience");if(t&&(e=t.updateLogData),e&&e.showDialog){var s=new n({displayStyle:"strip"}),l=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"}),c=o["UpdateSummary.MissingAssets"],d=new UWA.Element("div",{class:"VCXMissingAssets"});(I=new UWA.Element("span",{text:c})).inject(d),d.inject(l),(C=new UWA.Element("div",{})).inject(l),C.style.paddingLeft="13px";var p=r.getWebappsAssetUrl("VCXWebTreeGUI","icons/32/I_VCX_SWXUiComponentPart3DShape.png");if(e.deletedOverides)for(var u=0;u<e.deletedOverides.length;u++){var h=e.deletedOverides[u],g=new UWA.Element("div",{class:"linePart"});(w=new UWA.Element("div",{})).style.backgroundImage="url('"+p+"')",w.style.width="22px",w.style.height="22px",w.style.backgroundSize="contain",w.inject(g),(I=new UWA.Element("span",{text:h.instanceName})).style.paddingLeft="10px",I.inject(g),g.inject(C)}s.add({isSelected:!0,label:o["UpdateSummary.Products"],content:l,icon:{iconName:"3dproduct",fontIconFamily:WUXManagedFontIcons.Font3DS}});var m=[];if(e.deletedMaterials)for(u=0;u<e.deletedMaterials.length;u++){h=e.deletedMaterials[u];var C=new UWA.Element("div",{}),v=h.id;if(M=e.impactedComponentsInverted[v]){var _=[];for(var f in M)if(M.hasOwnProperty(f)){var b=new UWA.Element("div",{});b.style.paddingLeft="25px";var y=M[f];for(var x in y)if(y.hasOwnProperty(x)){g=new UWA.Element("div",{class:"linePart"});(w=new UWA.Element("div",{})).style.backgroundImage="url('"+p+"')",w.style.width="22px",w.style.height="22px",w.style.backgroundSize="contain",w.inject(g),(I=new UWA.Element("span",{text:this.getNameForComponentID(x)})).style.paddingLeft="10px",I.inject(g),g.inject(b)}_.push({header:this.getNameForComponentID(f),content:b,icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}new a({items:_,style:"simple",exclusive:!1}).inject(C)}m.push({header:h.instanceName,content:C,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}var P=new a({items:m,style:"filled-separate",exclusive:!1}),S=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"});d=new UWA.Element("div",{class:"VCXMissingAssets"}),(I=new UWA.Element("span",{text:c})).inject(d),d.inject(S),P.getContent().inject(S),s.add({isSelected:!1,label:o["UpdateSummary.Materials"],content:S,icon:{iconName:"material",fontIconFamily:WUXManagedFontIcons.Font3DS}});var V=[];if(e.deletedAmbiences)for(u=0;u<e.deletedAmbiences.length;u++){h=e.deletedAmbiences[u];(C=new UWA.Element("div",{})).style.paddingLeft="10px";var M;v=h.id;if(M=e.impactedComponentsInverted[v])for(var f in M)if(M.hasOwnProperty(f)){var w,I;g=new UWA.Element("div",{});(w=new UWA.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-camera"})).inject(g),(I=new UWA.Element("span",{text:this.getNameForComponentID(f)})).style.paddingLeft="10px",I.inject(g),g.inject(C)}V.push({header:h.instanceName,content:C,icon:{iconName:"picture",fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"5x"},expandedFlag:!0})}var T=new a({items:V,style:"filled-separate",exclusive:!1}),D=new UWA.Element("div",{class:"XCTWebUpdateDialogTab"});d=new UWA.Element("div",{class:"VCXMissingAssets"}),(I=new UWA.Element("span",{text:c})).inject(d),d.inject(D),T.getContent().inject(D),s.add({label:o["UpdateSummary.Ambiences"],content:D,icon:{iconName:"picture",fontIconFamily:WUXManagedFontIcons.Font3DS}}),this.DSFontIconPanel=new i({immersiveFrame:this.immersiveFrame,identifier:"updateSolveIssuesDialog",title:o["UpdateSummary.DialogHeader"],content:s,icon:"update",horizontallyStretchableFlag:!0,verticallyStretchableFlag:!0,minWidth:10,minHeight:10,width:400,height:450}),this.DSFontIconPanel.getContent().addClassName("XCTWebUpdateDialogClass");var E=this,G=function(e){E.DSFontIconPanel.removeEventListener("close",G),E.DSFontIconPanel=null};this.DSFontIconPanel.addEventListener("close",G)}}},ShowNotification:function(){if(this._experienceBase){var e=null,t=this._experienceBase.getManager("VCXExperience");if(t&&(e=t.updateLogData),e){var n="";if(e.newOverides){n="======= NEW OCCURRENCES =======\n\n";for(var i=0;i<e.newOverides.length;i++){n+="=> "+(a=e.newOverides[i]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedOverides){n+="\n======= REMOVED OCCURRENCES =======\n\n";for(i=0;i<e.deletedOverides.length;i++){n+="=> "+(a=e.deletedOverides[i]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedAmbiences){n+="\n======= REMOVED AMBIENCES =======\n\n";for(i=0;i<e.deletedAmbiences.length;i++){n+="=> "+(a=e.deletedAmbiences[i]).instanceName+"("+a.referenceName+")\n"}}if(e.deletedMaterials){n+="\n======= REMOVED MATERIALS =======\n\n";for(i=0;i<e.deletedMaterials.length;i++){var a;n+="=> "+(a=e.deletedMaterials[i]).instanceName+"("+a.referenceName+")\n"}}var r=0;if(e.impactedComponents)for(var s in n+="\n======= IMPACTED COMPONENT =======\n\n",e.impactedComponents)if(e.impactedComponents.hasOwnProperty(s)){r++;var l="",c=this._experienceBase.ComponentsMap.GetComponentFromID(s);if(c){var d=c.QueryInterface("VCXIModifiable");if(d){var p=d.GetProperty("Actor.Name");p&&(l=p.GetPropertyValue().GetValue())}}n+="=> "+s+" ("+l+")\n"}if(e.showDialog){var u=this._experienceBase.getManager("VCXNotificationManager");if(u){var h="";e.newOverides.length>0&&(h+=e.newOverides.length+" "+o["UpdateNotification.ItemsAdded"]+"<br>"),e.deletedOverides.length>0&&(h+=e.deletedOverides.length+" "+o["UpdateNotification.ItemsRemoved"]+"<br>"),e.deletedAmbiences.length>0&&(h+=e.deletedAmbiences.length+" "+o["UpdateNotification.AmbiencesRemoved"]+"<br>"),e.deletedMaterials.length>0&&(h+=e.deletedMaterials.length+" "+o["UpdateNotification.MaterialsRemoved"]+"<br>"),r>0&&(h+=r+" "+o["UpdateNotification.ItemsToUpdates"]+"<br>");var g={level:"info",title:o["UpdateNotification.NotifTitle"],message:h,sticky:!0};u.addNotification(g)}}console.log(n)}}}})}),
/*!
#include "VCXUISequence.h"
  Script: VCXUISequence.js

    This file is part of UWA JS Runtime.

  About: License

    Copyright 2006-2012 Netvibes, a Dassault Systemes company.
    All rights reserved.
*/
define("DS/VCXWebGUI/VCXUISequence",["UWA/Core","UWA/Controls/Accordion","DS/Core/PointerEvents","DS/VCXWebKernel/VCXCmdChangeSelection"],function(e,t,n,i){"use strict";return t.extend({className:"VCXUISequence",defaultOptions:{className:"",title:null,multiSelect:!0,constantItemWidth:!1,contentPosition:"bottom"},init:function(e,t,n){this._parent(n),this.elements.container.addClassName(this.className),this._experience=e,this._panel=t,this.sequenceSelectedItems={},this.sequenceOpenedItems={}},unInitialize:function(){var e=this.elements.items;for(var t in e)e[t].titleDiv&&(e[t].titleDiv.removeEvent(n.POINTERUP),e[t].titleDiv.remove(),e[t].titleDiv=null);this._panel=null,this.sequenceSelectedItems=null,this.sequenceOpenedItems=null,this._experience=null},str2DOMElement:function(e){var t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t),t.contentDocument.open(),t.contentDocument.write(e),t.contentDocument.close();var n=t.contentDocument.body.firstChild;return document.body.removeChild(t),n},addItem:function(t,i){var a=this,r=this.elements,o=r.items=r.items||{},s=r.containers=r.containers||{};this._parent(t,i),s[t]=e.createElement("div",{class:this.className+"-content"}).inject(o[t],"top"===this.options.contentPosition?"top":"bottom"),s[t].parentNode.addClassName("VCXUISequence-item"),i.content&&this.setContent(t,i.content);var l=t+"-title",c=r.items[t].getElementsByClassName(l)[0];r.items[t].removeChild(c);var d=i.text,p=e.createElement("div",{class:"VCXUISequence-title"});r.items[t].appendChild(p);var u=t+"-title "+this.className+"-item-arrow",h=e.createElement("div",{class:u,events:{click:function(e){var n=r.items[t];a._panel.activeSequence(n)}}});p.appendChild(h),r.items[t].titleDiv=e.createElement("span",{class:l+" VCXUISequence-item-title",text:d}),r.items[t].titleDiv.addEvent(n.POINTERUP,function(e){a.sequenceOpenedItem(t)}),p.appendChild(r.items[t].titleDiv);for(var g=[],m=0;m<r.items[t].children.length;m++)g[m]=r.items[t].children[m];r.items[t].removeChild(g[0]),r.items[t].removeChild(g[1]),r.items[t].appendChild(g[1])},deleteItem:function(e){var t=this.elements;t.itemContainer.removeChild(t.itemContainer.childNodes[e]),delete t.containers[e],delete t.items[e]},unset:function(e,t,n){var i=t;t={},i[e]=null,delete i[e];var a=0;for(var r in n&&(a=-1),i)void 0!==i[r]&&(n?a++:a=r,t[a]=i[r]);return t},isSequenceOpened:function(e){return this.sequenceOpenedItems[e]},sequenceOpenedItem:function(e,t){this.setSequenceItemOpenedState(e,!this.isSequenceOpened(e),t)},setSequenceItemOpenedState:function(t,n,i){if(this._experience.getManager("VCXSequenceManager").GetListSequences().length>1||n){var a=this.elements.items[t];i=!e.is(i)||i;var r=a.getElementsByClassName("vcx-controls-thumbnail");if(n&&0===r.length){if(n)if(0===(r=a.getElementsByClassName("vcx-controls-thumbnail")).length){a.addClassName("failOpened",n);setTimeout(function(){a.removeClassName("failOpened",n)},500)}}else this.sequenceOpenedItems[t]!==n&&(a&&a.toggleClassName("opened",n),this.sequenceOpenedItems[t]=n)}},getOpenedItems:function(){var e=[];for(var t in this.sequenceOpenedItems){if(this.sequenceOpenedItems.hasOwnProperty(t))this.sequenceOpenedItems[t]&&e.push(t)}return e},getSelectedItems:function(){var e=[];for(var t in this.sequenceSelectedItems){if(this.sequenceSelectedItems.hasOwnProperty(t))this.sequenceSelectedItems[t]&&e.push(t)}return e},isSequenceSelected:function(e){return this.sequenceSelectedItems[e]},sequenceSelectItem:function(e,t){this.setSequenceItemSelectedState(e,!this.isSequenceSelected(e),t)},setSequenceItemSelectedState:function(t,n,a){var r=this.elements.items[t];if(a=!e.is(a)||a,r||this.sequenceSelectedItems[t]!==n){if(!document._ctrlDown)for(var o in this.sequenceSelectedItems){if(this.sequenceSelectedItems.hasOwnProperty(o))if(this.sequenceSelectedItems[o])this.elements.items[o].toggleClassName("selected",!1),this.sequenceSelectedItems[o]=!1}r.toggleClassName("selected",n),this.sequenceSelectedItems[t]=n;var s=this._experience.getManager("VCXSequenceManager").GetListSequences()[t];if(n){var l=new i(this._experience.getManager("VCXSelectionManager"));document._ctrlDown?l.AddToSelection(s):l.SetSelection(s),this._experience.getManager("VCXCommandManager").Do(l)}else{(l=new i(this._experience.getManager("VCXSelectionManager"))).RemoveFromSelection(s),this._experience.getManager("VCXCommandManager").Do(l)}}},addDragOver:function(e){this._dragOverIndex=e,this.elements.items[e].toggleClassName("dragover",!0)},removeDragOver:function(){void 0!==this._dragOverIndex&&this.elements.items[this._dragOverIndex].toggleClassName("dragover",!1)}})}),define("DS/VCXWebGUI/VCXPropertiesPanelViewV2",["UWA/Class","DS/Windows/Panel","DS/Tweakers/TypeRepresentationFactory","DS/Controls/Button","DS/Controls/Accordeon","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/Core/PointerEvents"],function(e,t,n,i,a,r,o,s){"use strict";return e.extend({init:function(e,t){this.factory=new n,this._propertiesPanelModel=t;var i={icon:"attributes",currentDockArea:WUXDockAreaEnum.RightDockArea,title:"Properties",recId:"vcx-property-panel",immersiveFrame:e};this.createBasePanelUI(i),this._displayedInfo={}},unInitialize:function(){this.factory=null,this._displayedInfo=null,this._propertiesPanelModel=null,this._mainPanel.destroy()},createBasePanelUI:function(e){let n=new UWA.Element("div",{html:"",class:"vcxPanelHeaderContainer"});new UWA.Element("div",{html:"Properties",class:"vcxPanelHeaderLabel"}).inject(n),new UWA.Element("div",{html:"",class:"vcxPanelHeaderToolbar"}).inject(n);this._mainPanel=new t({identifier:"VCXPropertyPanel",collapsibleFlag:!0,closeButtonFlag:!1,resizableFlag:!0,header:n,immersiveFrame:e.immersiveFrame,currentDockArea:e.currentDockArea,title:e.title,showTitleFlag:!1,minWidth:e.minWidth?e.minWidth:300,verticallyStretchableFlag:!0,movableFlag:!0,icon:e.icon,recId:e.recId}),this._selectElementMessage=new UWA.Element("div",{html:"",class:"vcxPanelWatermarkContainer"});let i=new UWA.Element("div",{html:"",class:"vcxSelectEltNode vcxSelectEltIcon fonticon fonticon-touch"}),a=new UWA.Element("div",{html:"Select an object",class:"vcxSelectEltNode vcxSelectEltTxt"});i.inject(this._selectElementMessage),a.inject(this._selectElementMessage),this._mainPanel.content=this._selectElementMessage,this._mainPanel.addEventListener("resize",function(){o.publish({event:"VCX_PANEL_RESIZED"})})},rebuildPanelUI:function(e){if(!e)return void console.error("no information is given to the UI property panel");this._displayedInfo={};let t=Object.keys(e);this._groupsAccordeon=new a({items:[],style:"divided",exclusive:!1}),this.fillPanelContent(),t.every(t=>{let n=e[t];return this.createTweakerGroup(n),!0}),this._groupsAccordeon.getContent().style.display="flex",this._groupsAccordeon.getContent().style.flexDirection="column",this._groupsAccordeon.getContent().addEventListener("expand",this._expanderExpandCB),this._groupsAccordeon.getContent().addEventListener("collapse",this._expanderCollapseCB)},createTweakerGroup:function(e){let t;if(!e)return void console.error("an attempt to create group was made but group is undefined");this._displayedInfo[e.groupID]={},"boolean"==typeof e.checkbox&&(t=new UWA.Element("div",{class:"vcxPropertyGroupHeader"}),this.factory.generateView(e.checkbox,{typePath:"independantBoolean",onViewCreated:n=>{void 0!==n?(n.inject(t),n.internalOptions={propName:e.showPropName},n.getContent().addEventListener("click",t=>{this.activateDeactivateGroup(n.value,e.name)}),this._displayedInfo[e.groupID][e.showPropName]={},this._displayedInfo[e.groupID][e.showPropName].tweakers=[],this._displayedInfo[e.groupID][e.showPropName].value=e.checkbox,this._displayedInfo[e.groupID][e.showPropName].tweakers.push(n)):console.error("group switch creation failed")},onFailure:function(e){console.error("failed: ",e)}}));let n=!e.collapsed;void 0!==e.checkbox&&(e.checkbox||(n=!1));let i={header:e.name,customHeader:t,expandedFlag:n},a=new UWA.Element("div",{html:"",class:"vcxPropertiesContainer"});a.style.display="flex",a.style.flexDirection="column",e.arrayProps.every(t=>(this.buildPropertyLine({uiInfo:t},a,this._displayedInfo[e.groupID]),!0)),i.content=a,i.groupID=e.groupID,this._groupsAccordeon.addItem(i);let r=this.getGroupExpander(e.name);r.groupID=e.groupID,r.getContent().style.order=e.order,void 0!==e.checkbox&&(e.checkbox||this.activateDeactivateGroup(!1,e.name))},getPanelDisplayedInfo:function(){return this._displayedInfo},getGroupExpander:function(e){let t=this._groupsAccordeon.getIndexFrom({header:e});return t<0?null:this._groupsAccordeon.getExpanderFromIndex(t)},activateDeactivateGroup:function(e,t){let n=this.getGroupExpander(t);!1===e?(n.expandedFlag=!1,n.getContent().style.pointerEvents="none",n.elements.headerArrow.style.opacity="0"):(n.expandedFlag=!0,n.getContent().style.pointerEvents="",n.elements.headerArrow.style.opacity="")},buildPropertyLine:function(e,t,n){let i=new UWA.Element("div",{class:"vcxPropertyLine",styles:{order:e.uiInfo.order}}).inject(t),a=(new UWA.Element("div",{html:"",class:"vcxPropertyLineNode vcxPropertyStatusBar"}).inject(i),new UWA.Element("div",{html:e.uiInfo.label,class:"vcxPropertyLineNode vcxPropertyLabel"}));a.propertyId=e.uiInfo.propertyId,a.inject(i),a.addEventListener("click",this.onClickLabel),a.addEventListener("dblclick",this.onDoubleClickLabel);let r=new UWA.Element("div",{html:"",class:"vcxPropertyLineNode vcxPropertyTweaker"}).inject(i);e.container=r,this.buildTweaker(e,n)},buildTweaker:function(e,t){let n,i,a,r,o,s,l,c,d,p,u=e.uiInfo,h=e.container,g=u.propertyValue.GetType(),m=g+"",C={propName:u.propertyId,dataType:g};switch(u.bounds&&(s="slider",a=u.bounds.valueMin,r=u.bounds.valueMax,o=u.bounds.step),u.propSettings&&u.propSettings.displayStyle&&(s=u.propSettings.displayStyle),(u.defined&&u.defined.propertyValue&&!u.defined.propertyValue.GetValue()||u.multipleSelectionUndefined)&&(c=!0),g){case"VCXPropertyValueDocId":i=null,u.disabled?(n="string",C.data="",p=u.propertyValue.GetValue(),u.disabled=!0):(n="blob",p=u.propertyValue.GetValue());break;case"VCXPropertyValueDate":break;case"VCXPropertyValueColor":n="color",c||(i="#"+u.propertyValue.GetValue().GetColorHexString());break;case"VCXPropertyValueFloat":o=o||1,n="float";break;case"VCXPropertyValueInt":n="integer";break;case"VCXPropertyValueHyperlinkId":break;case"VCXPropertyValueBoolean":n="independantBoolean";break;case"VCXPropertyValuePoint2D":n="vector2",d=u.disabled,i=Object.values(u.propertyValue.GetValue());break;case"VCXPropertyValuePoint":n="vector3",d=u.disabled,i=Object.values(u.propertyValue.GetValue());break;case"VCXPropertyValueString":n="string";break;case"VCXPropertyValueEnum":u.enum?(i=u.enum[u.enumValue],l=u.enum,n="enumCustom"):console.error("Enum ",u.propertyId," didnt have the necessary enum arguments")}t[u.propertyId]||(t[u.propertyId]={},t[u.propertyId].tweakers=[]),t[u.propertyId].propType=g,t[u.propertyId].enumChoices=l,t[u.propertyId].undefinedDisplayFlag=c,t[u.propertyId].value=p||(void 0!==i?i:u.propertyValue.GetValue());let v=c?void 0:void 0!==i?i:u.propertyValue.GetValue();if(this.factory.generateView(v,{typePath:n,disabled:u.disabled,readOnly:d,minValue:a,maxValue:r,stepValue:o,displayStyle:s,placeholder:u.placeHolder,possibleValues:l,onViewCreated:function(e){void 0!==e?(e.inject(h),e.internalOptions=C,e.getContent().addClassName(m),t[u.propertyId].tweakers.push(e)):console.error("tweaker creation failed")},onFailure:function(e){console.error("failed: ",e)}}),"slider"===s&&this.factory.generateView(v,{typePath:n,disabled:u.disabled,minValue:a,maxValue:r,stepValue:o,onViewCreated:function(e){void 0!==e?(e.getContent().addClassName("vcxPropertySliderSpinbox"),e.inject(h),e.internalOptions=C,t[u.propertyId].tweakers.push(e)):console.error("tweaker creation failed")},onFailure:function(e){console.error("failed: ",e)}}),u.opacity){let e={container:h,uiInfo:{...u.opacity,disabled:u.disabled}};this.buildTweaker(e,t)}if(u.defined){let e={container:h,uiInfo:{...u.defined,disabled:u.disabled}};this.buildTweaker(e,t)}this.createPropSettingsButtons(u.propSettings,h,t)},updateTweakers:function(e,t,n,i){try{let a=Object.keys(this._displayedInfo);for(let r=0;r<a.length;r++){let o=a[r],s=this._displayedInfo[o][e];if(s){let a=s.tweakers;for(let e=0;e<a.length;e++)i?(a[e].value=void 0,s.undefinedDisplayFlag=!0):(a[e].value=t,s.undefinedDisplayFlag=!1);this._displayedInfo[o][e].value=n}}}catch(e){console.error(e)}},getUIGroupsInfo:function(){return this._groupsAccordeon&&[...this._groupsAccordeon._expanderItems]},createPropSettingsButtons:function(e,t,n){if(e&&e.buttons){n[e.propertyName].additionalButtons={};for(let a=0;a<e.buttons.length;a++){let o=e.buttons[a],s=null;if(o.available){if("Restore"===o.type)(s=new i({displayStyle:"lite",disabled:o.buttonDisabled,icon:{iconPath:r.getWebappsAssetUrl("VCXWebGUI","icons/32/VCX_Restore_grey.png")}})).elements.container.title=o.tooltip||"Restore Default Value",o.location=20,s.additionalButtonFunction=this.restoreFunction,s.additionalButtonFunctionArgs={data:o.data},t.addClassName("vcx-prop-restorable");else if("NavigateTo"===o.type){t.getChildren().every(function(e){return e.hasClassName("vcx-propNode-label")||t.removeChild(e),!0}),new UWA.Element("div",{html:"Overruled",class:"vcx-prop-overruled"}).inject(t),s=new i({label:"Go to parent"}),o.location=20,s.additionalButtonFunction=this.goToParentFunction,s.additionalButtonFunctionArgs={data:o.data},s.getContent().addClassName("vcx-goToParent-button")}else s=new i({displayStyle:"lite",icon:{iconName:o.iconName||"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}),o.type||(o.type="defaultType",console.error("A additional setting button was created without button.type -> Only one can be created anonymously without causing issues")),s.additionalButtonFunction=o.functionCB,s.additionalButtonFunctionArgs={name:o.name,propertyName:e.propertyName,data:o.data},s.elements.container.title=o.tooltip||"";o.location?o.location>t.getChildren().length?s.inject(t):t.insertBefore(s.getContent(),t.getChildren()[o.location-1]):console.warn("A button "+o.name+" was attempted to be created without location: button not created"),n[e.propertyName].additionalButtons[o.type]&&console.error("Can't create two buttons of the same type for a single property"),n[e.propertyName].additionalButtons[o.type]=s}}}},updateButtonsStatus:function(e,t,n){let i=this.getPanelDisplayedInfo()[e][t].additionalButtons,a=Object.keys(n);for(let e=0;e<a.length;e++){let t=a[e];i[t].disabled=n[t]}},removeButtons:function(e,t,n){},addButtons:function(e,t,n){},goToParentFunction:function(){console.warn("GoToParent did nothing: GoToParent function was not given to PanelView")},restoreFunction:function(){console.warn("Restore did nothing: restore function was not given to PanelView")},executeHeaderCommand:function(){console.warn("button did nothing: callback was not given to PanelView")},onClickLabel:function(){},onDoubleClickLabel:function(){},uiSelect:function(e,t){let n=Object.keys(this._displayedInfo);for(let i in n){let a=n[i],r=this._displayedInfo[a];if(r[e]){let n,i=r[e].tweakers;i.length>0&&(n=i[0].getContent().closest(".vcxPropertyLine")),n.style.backgroundColor=t?"#4f91cd":""}}},selectAllProps:function(){let e=[],t=document.getElementsByClassName("vcxPropertyLabel");for(let n=0;n<t.length;n++){let i=t[n];e.includes(i.propertyId)||e.push(i.propertyId),this.uiSelect(i.propertyId,!0)}return e},deselectAllProps:function(){let e=document.getElementsByClassName("vcxPropertyLabel");for(let t=0;t<e.length;t++){let n=e[t];this.uiSelect(n.propertyId,!1)}},addHeaderButton:function(e,t,n){var a=this._mainPanel.header.getElementsByClassName("vcxPanelHeaderToolbar")[0],r=new i({displayStyle:"lite",icon:{iconName:e,fontIconFamily:WUXManagedFontIcons.Font3DS}});r.cmdId=t,r.getContent().addClassName(t+" vcxPanelHeaderToolbarButton"),n&&r.getContent().addClassName("vcxHidden"),r.inject(a),r.addEventListener("click",this.executeHeaderCommand)},emptyPanelContent:function(){let e=Object.keys(this._displayedInfo);for(let t in e){let n=e[t],i=Object.keys(n);for(let e in i){let n=i[e];this.destroyTweakerLine(n,t)}}this._mainPanel.getContent().removeEventListener("change",this.changeEvent),this._mainPanel.content=this._selectElementMessage,this._displayedInfo={}},destroyGroup:function(e){var t=this._groupsAccordeon.getIndexFromId(e._expanderId);this._groupsAccordeon.deleteItem(t),delete this._displayedInfo[e.groupID]},destroyTweakerLine:function(e){let t=Object.keys(this._displayedInfo);for(let n in t){let i=t[n],a=this._displayedInfo[i];if(a[e]){let t,n=a[e].tweakers;n.length>0&&(t=n[0].getContent().closest(".vcxPropertyLine"));for(let e of n)try{e.destroy&&e.destroy()}catch(e){console.warn("Type error is thrown by WebUX bug upon destruction of blob tweaker. ",e.message)}t&&t.destroy(),delete this._displayedInfo[i][e]}}},fillPanelContent:function(){this._mainPanel.content=this._groupsAccordeon,this._mainPanel.getContent().addEventListener("change",this.changeEvent)},changeEvent:function(e){},subscribeTweakerEvent:function(e,t){"string"==typeof e&&"function"==typeof t&&this._mainPanel.getContent().addEventListener(e,t)},unsubscribeTweakerEvent:function(e,t){"string"==typeof iEventName&&"function"==typeof iEvtCb&&this._mainPanel.getContent().removeEventListener(e,t)}})}),define("DS/VCXWebGUI/VCXGUIServices",["UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/VCXWebKernel/VCXDRMManager"],function(e,t,n,i){"use strict";return e.singleton({displaySignature:function(e,a,r){a.strSignaturePicturePath,a.ulSignatureCRC;var o=e.getManager("VCXContextManager").getFrameWindow(),s=(o.getUIFrame(),o.getImmersiveFrame());e.getManager("VCXContextManager").loadCssFile("VCXWebGUI/VCXWebSignature.css",1);var l=a.strAgreement.replace(/#@/g,"</p><p>");l="<p>"+l+"</p>";var c=null;if(a.resources){var d=a.strSignaturePicturePath.replace(/^.*[\\\/]/,"").toLowerCase();c=a.resources[d]}var p='<img src="'+c+'" style="max-width:100%"/>',u=new UWA.Element("div",{class:"Signature"});new UWA.Element("div",{class:"Signature_Cell",html:p}).inject(u),new UWA.Element("div",{class:"Signature_Cell",html:l}).inject(u);var h={};a.ulAgreementMode===i.LitSignatureMode.LIT_SIGNATURE_DISPLAY_AND_PASS?h.Ok=new n({onClick:function(e){document.getElementsByClassName("wux-windows-modalDialog")[0].remove();var t=e.dsModel.dialog;t._closeOK=!0,t.remove(),t.close()}}):(h.Ok=new n({label:"I Agree",onClick:function(e){var t=e.dsModel.dialog;t._closeOK=!0,t.remove(),t.close()}}),h.Cancel=new n({label:"I Disagree",onClick:function(e){var t=e.dsModel.dialog;t._closeOK=!1,t.remove(),t.close()}}));var g=new t({title:"Signature",content:u,modalFlag:!0,resizableFlag:!0,usePaddingFlag:!1,width:400,closeButtonFlag:!1,immersiveFrame:s,buttons:h});g.elements.container.parentNode.parentNode.removeChild(g.elements.container.parentNode),widget.body.appendChild(g.elements.container.parentNode);var m=a,C=r;g.addEventListener("close",function(e){g._closeOK?(m.LoadGeometriesBody(C),m._pause=!1,m.launchsmgXMLCB(m,m.smgLoader)):m.launchsmgXMLCB(null,m.smgLoader)})},hideDockingElements:function(e,t){for(var n={freeWindowsInfo:{},visiblePanels:[],panelsToReopen:[]},i=e.getImmersiveFrame(),a=i.windows,r={},o=Object.keys(a),s=0;s<o.length;++s){var l=o[s],c=a[l];if(!c.getDockedFlag())if(r[l]=c,n.freeWindowsInfo[l]={pos:{x:c.position.offsetX,y:c.position.offsetY},dims:[c.width,c.height]},c.allowedDockAreas!==WUXDockAreaEnum.NoneDockArea){var d=[WUXDockAreaEnum.BottomDockArea,WUXDockAreaEnum.TopDockArea,WUXDockAreaEnum.LeftDockArea,WUXDockAreaEnum.RightDockArea];for(s=0;s<d.length;++s){var p=d[s];if(c.allowedDockAreas&p){i.dockWindow(p,c),n.freeWindowsInfo[l].dockedArea=p;break}}}else console.log("Some windows aren't allowed to be docked, preventing a correct immersive mode for the Guided Tour.")}var u=e.getImmersiveFrame().dockingElements;for(s=0;s<u.length;++s)t&&(u[s].collapseDockingZoneFlag||(n.panelsToReopen.push(u[s]),u[s].collapseDockingZoneFlag=!0)),u[s].visibleDockingZoneFlag&&(n.visiblePanels.push(u[s]),u[s].visibleDockingZoneFlag=!1);return n},restoreDockingElements:function(e,t){var n=e&&e.getImmersiveFrame();if(n&&t){if(t.freeWindowsInfo&&Object.keys(t.freeWindowsInfo).length>0){n.windows;for(var i in t.freeWindowsInfo)if(t.freeWindowsInfo.hasOwnProperty(i)){var a=n.windows[i];n.undockWindow(a),a.setAbsolutePosition(t.freeWindowsInfo.pos)}}for(var r=t.visiblePanels,o=t.panelsToReopen,s=0;s<o.length;++s){o[s].collapseDockingZoneFlag=!1}for(var l=0;l<r.length;++l){r[l].visibleDockingZoneFlag=!0}}else console.warn("Immersive frame and config of the panels before they were hiding are needed !")},hideActionBar:function(e,t){var n={actionBarShouldBeOpen:null};if(t){var i=e.getActionBar();(null===i.elements.container.getAttribute("data-open")||"true"===i.elements.container.getAttribute("data-open"))&&(n.actionBarShouldBeOpen=!0,i.close()),i.hide()}return n},restoreActionBar:function(e,t){var n=e.getActionBar();n.show(),t.actionBarShouldBeOpen&&n.open()}})}),define("DS/VCXWebGUI/VCXModifiableGUIManager",["DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,n,i,a){"use strict";return e.extend({init:function(){this._parent()},OnChangeProperty:function(e,t){return console.log("property not found!"),!1},GetProperty:function(e){return null},GetProperties:function(){return new t}})}),define("DS/VCXWebGUI/VCXFontBoxing",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return e.extend({init:function(){},GetPropertiesForGUI:function(e,a){var o={propertyName:null,propertyHeight:null,propertyItalic:null,propertyBold:null},c=new l;c.SetValue(13);var d=new s("Collab.Text.Font_Name",null,!1,a.Geti18n()),p={0:"__DONOTTRANSLATE__Arial",1:"__DONOTTRANSLATE__Arial Black",2:"__DONOTTRANSLATE__Comic Sans MS",3:"__DONOTTRANSLATE__Courier New",4:"__DONOTTRANSLATE__Georgia",5:"__DONOTTRANSLATE__Impact",6:"__DONOTTRANSLATE__Lucida Console",7:"__DONOTTRANSLATE__Lucida Sans Unicode",8:"__DONOTTRANSLATE__Palatino Linotype",9:"__DONOTTRANSLATE__Tahoma",10:"__DONOTTRANSLATE__Times New Roman",11:"__DONOTTRANSLATE__Trebuchet MS",12:"__DONOTTRANSLATE__Verdana"};for(var u in d.SetMapChoiceEnum(p),p)if(p.hasOwnProperty(u)){var h=p[u];if(e.GetFamily().GetValue()===h){c.SetValue(parseInt(u));break}}13===c.GetValue()&&(p[13]=e.GetFamily().GetValue()),o.propertyName=new t(d,c);var g=new n("Collab.Text.Font_Height",null,!1,a.Geti18n()),m=new i;m.SetValue(Number(e.GetHeight().GetValue())),o.propertyHeight=new t(g,m);var C=new n("Collab.Text.Font_Italic",null,!1,a.Geti18n()),v=new r;return v.SetValue(e.GetItalic().GetValue()),o.propertyItalic=new t(C,v),C=new n("Collab.Text.Font_Bold",null,!1,a.Geti18n()),(v=new r).SetValue(700===e.GetWeight().GetValue()),o.propertyBold=new t(C,v),o},UpdateMapForGUI:function(e,t){var n=t.propName,i=t.std;if("Collab.Text.Font_Name"===n){var a=e.propertyName,r=a.GetPropertyInfo().GetMapChoiceEnum();for(var o in a.GetPropertyValue().SetValue(13),r){if(r.hasOwnProperty(o))if(i===r[o].replace("__DONOTTRANSLATE__","")){a.GetPropertyValue().SetValue(parseInt(o));break}}}else if("Collab.Text.Font_Height"===n){e.propertyHeight.GetPropertyValue().SetValue(i)}else if("Collab.Text.Font_Italic"===n){e.propertyItalic.GetPropertyValue().SetValue(i)}else if("Collab.Text.Font_Bold"===n){e.propertyBold.GetPropertyValue().SetValue(i)}return e},BuildNewValueFromGUI:function(e){var t=new o,n=new a,i=e.propertyName.GetPropertyInfo()._mapChoiceEnum[e.propertyName.GetPropertyValue().GetValue()];n.SetValue(i.replace("__DONOTTRANSLATE__",""));var r=e.propertyHeight.GetPropertyValue(),s=e.propertyItalic.GetPropertyValue(),l=e.propertyBold.GetPropertyValue();return t.SetFamily(n),t.SetHeight(r),t.SetItalic(s),t.GetWeight().SetValue(l.GetValue()?700:400),t.ToString()},getPropertiesNamesNLS:function(e){var t={};return t[e+"_Name"]=c.get("FontBoxing_Name"),t[e+"_Height"]=c.get("FontBoxing_Height"),t[e+"_Italic"]=c.get("FontBoxing_Italic"),t[e+"_Bold"]=c.get("FontBoxing_Bold"),t}})}),define("DS/VCXWebGUI/VCXUndoRedoCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid"],function(e,t,n,i){"use strict";return e.singleton({removeDiv:function(){if(!0===this.bInitialized){var e=document.getElementById("VCXUndoRedoCtrlID");e&&(n.unsubscribe(this._tokenUpdate),n.unsubscribe(this._tokenUndoRedo),n.unsubscribe(this._tokenEndTransaction),n.unsubscribe(this._tokenStartedTransaction),this._tokenUpdate=null,this._tokenUndoRedo=null,this._tokenEndTransaction=null,this._tokenStartedTransaction=null,e.parentNode.removeChild(e)),this.bInitialized=!1}},addDiv:function(e){if(this._vcxCommandManager=e,!0!==this.bInitialized){this.bInitialized=!0;var t=this;this._tokenUpdate=n.subscribe({event:"VCX_UNDOREDO_STACK_UPDATE"},function(){t.Redraw()}),this._tokenUndoRedo=n.subscribe({event:"VCX_UNDOREDO_DONE"},function(){t.Redraw()}),this._tokenEndTransaction=n.subscribe({event:"VCX_END_TRANSACTION"},function(){t.Redraw()}),this._tokenStartedTransaction=n.subscribe({event:"VCX_STARTED_TRANSACTION"},function(){t.Redraw()}),this._mainPanel=new UWA.Element("div",{html:"",class:"VCXUndoRedoCtrl",id:"VCXUndoRedoCtrlID",styles:{zIndex:99999,margin:"",height:"400px",width:"400px",top:"50px",left:"100px",position:"absolute",border:"1px solid grey",resize:"both",overflow:"auto",backgroundColor:"rgba(200,200,200,.9)"}}).inject(document.body),this._panelBody=new UWA.Element("div",{html:"",class:"VCXUndoRedoCtrlBody",id:"VCXUndoRedoCtrlIDBody",styles:{userSelect:"none",textAlign:"left",color:"black",fontSize:"x-small",position:"absolute",margin:"",height:"calc( 100% - 20px )",width:"100%",top:"20px",left:"0px",border:"none",backgroundColor:"rgba(200,200,200,.9)"}}).inject(this._mainPanel),this._panelHeader=new UWA.Element("div",{html:"UNDO/REDO STACK",class:"VCXUndoRedoCtrlheader",id:"VCXUndoRedoCtrlIDheader",styles:{userSelect:"none",color:"black",position:"sticky",margin:"",height:"20px",width:"100%",top:"0px",left:"0px",border:"none",backgroundColor:"rgba(150,150,150,1)"}}).inject(this._mainPanel);!function(e){var t=0,n=0,i=0,a=0;document.getElementById(e.id+"header")?(document.getElementById(e.id+"header").onmousedown=o,document.getElementById(e.id+"header").ontouchstart=o):e.onmousedown=o;var r=0;function o(e){(e=e||window.event).preventDefault();var t=(new Date).getTime()-r;if(t<300&&t>0){var n=document.getElementById("VCXUndoRedoCtrlID");"20px"==n.style.height?n.style.height="200px":n.style.height="20px"}else{var o=e.clientX,c=e.clientY;o||(o=e.touches[0].clientX),c||(c=e.touches[0].clientY),i=o,a=c,document.onmouseup=l,document.ontouchend=l,document.onmousemove=s,document.ontouchmove=s}r=(new Date).getTime()}function s(r){(r=r||window.event).preventDefault();var o=r.clientX,s=r.clientY;o||(o=r.touches[0].clientX),s||(s=r.touches[0].clientY),t=i-o,n=a-s,i=o,a=s;var l=e.offsetTop-n;l>0&&(e.style.top=l+"px"),e.style.left=e.offsetLeft-t+"px"}function l(){document.onmouseup=null,document.onmousemove=null,document.ontouchmove=null,document.ontouchend=null}}(document.getElementById("VCXUndoRedoCtrlID"));var a={defaultCellHeight:15,apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:!1,columnHeaders:!0},resize:{columns:!0,rows:!0},isSortable:!1,className:"stack",columns:[{text:"Undo",dataIndex:"undoCmd",width:"auto"},{text:"Redo",dataIndex:"redoCmd",width:"auto"}],selection:{cells:!1}};t.datagrid=new i(a),t.datagrid.inject(this._panelBody)}else this.Redraw()},unInitialize:function(){n.unsubscribe(this._tokenUpdate),delete this._tokenUpdate,n.unsubscribe(this._tokenUndoRedo),delete this._tokenUndoRedo},Redraw:function(){var e=this._vcxCommandManager,t=document.getElementById("VCXUndoRedoCtrlIDheader");e._bTransaction?t.innerHTML="UNDO/REDO STACK (transaction running)":t.innerHTML="UNDO/REDO STACK";for(var n=[],i=0,a=e._stackCmd.length-1;a>=0&&!(i>20);a--){if((l=e._stackCmd[a])&&!l.IsLinkedCmd()){var r="UnknownCommand";void 0!==l.GetTitle&&(r=l.GetTitle()),n.push(r),i++}}var o=[];i=0;for(var s=e._stackCmdUndo.length-1;s>=0&&!(i>20);s--){var l;if((l=e._stackCmdUndo[s])&&!l.IsLinkedCmd()){var c="UnknownCommand";void 0!==l.GetTitle&&(c=l.GetTitle()),o.push(c),i++}}if(0===n.length&&0===o.length){(d=this.datagrid.getManager()).prepareUpdateView();for(a=d.getNumberOfRows()-1;a>=0;a--)d.removeRow(a);d.pushUpdateView()}else{var d;(d=this.datagrid.getManager()).prepareUpdateView(),d.empty();var p=Math.max(n.length,o.length);for(a=0;a<p;a++){var u="";a<n.length&&(u=n[a]);var h="";a<o.length&&(h=o[a]),d.addRow({undoCmd:u,redoCmd:h})}d.pushUpdateView()}}})}),define("DS/VCXWebGUI/VCXDocManagerCtrl",["UWA/Class","UWA/Element","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid"],function(e,t,n,i){"use strict";return e.extend({init:function(e){var t=this;t.bIsDirty=!1,this._vcxGuiManager=e,this._tokenDocAdded=n.subscribe({event:"VCX_DOC_ADDED"},function(){t.onRedraw()}),this._mainPanel=new UWA.Element("div",{html:"",class:"VCXDocManagerCtrl",styles:{display:"none",margin:"",height:"300px",width:"300px",bottom:"100px",left:"100px",position:"absolute",border:"1px dotted black"}}).inject(t._vcxGuiManager._uiLayer);var a={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:!0,columnHeaders:!0},resize:{columns:!0,rows:!0},isSortable:!1,className:"documentManager",columns:[{text:"Id",dataIndex:"id",width:130},{text:"Document",dataIndex:"document",width:130}],selection:{cells:!1}};t.datagrid=new i(a),t.datagrid.inject(this._mainPanel)},unInitialize:function(){n.unsubscribe(this._tokenDocAdded),delete this._tokenDocAdded},onRedraw:function(){if("none"!==this._mainPanel.style.display){console.log("redrawPanel");var e=this._vcxGuiManager._experienceBase.getManager("VCXDocManager");if(e.IsEmpty()){(n=this.datagrid.getManager()).prepareUpdateView();for(var t=n.getNumberOfRows()-1;t>=0;t--)n.removeRow(t);n.pushUpdateView()}else{var n;(n=this.datagrid.getManager()).prepareUpdateView();for(t=n.getNumberOfRows()-1;t>=0;t--)n.removeRow(t);var i=e.NumberOfDoc();for(t=0;t<i;t++){var a=e.GetPropPath(t),r=a.GetPathType().GetValue();if(0===r){var o=a.GetValueURL().GetValue();o.indexOf("blob:")>=0&&(o=a.GetFileName().GetValue()),n.addRow({id:t.toString(),document:o})}else if(1===r){var s=a.GetValueLink().GetValue(),l=this._vcxGuiManager._experienceBase.ComponentsMap.GetComponentFromID(s);if(l){var c=l.GetName();n.addRow({id:t.toString(),document:c})}}else if(2===r){var d=a.GetValueLink().GetValue(),p=this._vcxGuiManager._experienceBase.ComponentsMap.GetComponentFromID(d);if(p){var u=p.GetName();n.addRow({id:t.toString(),document:u})}}}n.pushUpdateView()}}}})}),define("DS/VCXWebGUI/VCXTimelineController",["DS/CoreEvents/Events","DS/WebRBTree/WebRBIterator","DS/VCXWebTimeline/VCXWebTimelineController","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdChangeTimePos","DS/VCXWebKernel/VCXCmdGoToMarker","DS/ApplicationFrame/CommandsManager","DS/VCXWebProperties/VCXPropertyMap","DS/VCXWebProperties/VCXPropertySet"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return n.extend({init:function(t){this._parent(t);var n=this;this._VCX_Timeline_MODEL_STOP_PLAY=e.subscribe({event:"VCX_STOP_PLAY"},function(e){n.options.experienceBase.getManager("VCXContextManager")&&n.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0);for(var t=0;t<n._timelines.length;t++)n._timelines[t].timeline.playGUIMode();n.updateTimelineFromModel()}),this._VCX_Timeline_MODEL_PAUSE_PLAY=e.subscribe({event:"VCX_PAUSE_PLAY"},function(e){n.options.experienceBase.getManager("VCXContextManager")&&n.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0);for(var t=0;t<n._timelines.length;t++)n._timelines[t].timeline.playGUIMode()}),this._VCX_Timeline_MODEL_START_PLAY=e.subscribe({event:"VCX_START_PLAY"},function(e){n.options.experienceBase.getManager("VCXContextManager")&&n.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!1);for(var t=0;t<n._timelines.length;t++)n._timelines[t].timeline.pauseGUIMode()}),this._VCX_SCENARIO_END_REACHED=e.subscribe({event:"VCX_SCENARIO_END_REACHED"},function(){n.onScenarioEnd()}),this._VCX_GOTO_MARKER=e.subscribe({event:"VCX_GOTO_MARKER"},function(e){n.goToMarker(e)}),this._VCX_KEYS_CHANGED=e.subscribe({event:"VCX_KEYS_CHANGED"},function(e){if(null!==n._nodeClass&&null!==e){var t=[];for(var i in e.setModifiablesTrackModified)t.push(i);n._updateListOfMarkers("update",t,e.keysForDo)}}),this._VCX_TIMEPOS_CHANGED=e.subscribe({event:"VCX_TIMEPOS_CHANGED"},function(e){n.updateTimelineFromModel()})},RemoveTimelineEvents:function(){this._parent(),e.unsubscribe(this._VCX_SCENARIO_END_REACHED),e.unsubscribe(this._VCX_GOTO_MARKER),e.unsubscribe(this._VCX_KEYS_CHANGED),e.unsubscribe(this._VCX_TIMEPOS_CHANGED),e.unsubscribe(this._VCX_Timeline_MODEL_START_PLAY),e.unsubscribe(this._VCX_Timeline_MODEL_PAUSE_PLAY),e.unsubscribe(this._VCX_Timeline_MODEL_STOP_PLAY),this._VCX_SCENARIO_END_REACHED=0,this._VCX_GOTO_MARKER=0,this._VCX_KEYS_CHANGED=0,this._VCX_TIMEPOS_CHANGED=0,this._VCX_Timeline_MODEL_START_PLAY=0,this._VCX_Timeline_MODEL_PAUSE_PLAY=0,this._VCX_Timeline_MODEL_STOP_PLAY=0},onScenarioEnd:function(){this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1);for(var e=0;e<this._timelines.length;e++)this._timelines[e].timeline.playGUIMode()},actionOnKey:function(e,t,n,a,r,o,s,l){var c=this.getModifiableFromHashing(n);this._parent(e,t,c,a,r,o,s);var d=!1;void 0===l&&(d=!0,l=new i(this.options.experienceBase.getManager("VCXScenarioManager"))),"move"==e?l.MoveKey(t,c,a,r,o):"copy"==e?l.ChangeKey(t,c,a,o,key.GetValue()):"delete"==e&&l.ChangeKey(t,c,a,r,null),d&&this.options.experienceBase.getManager("VCXCommandManager").Push(l)},ChangeTimePos:function(e,t){this._parent(e,t),"record"===this.options.experienceBase.odt&&this.getFrameFromModel()!==e&&this.options.experienceBase.getManager("VCXODTManager").LogAPI("VCXChangeTimePos",e);var n=new r(this.options.experienceBase.getManager("VCXScenarioManager")),i=void 0,a=void 0;void 0!==e.from?(i=e.from,a=e.to):"number"==typeof e&&(a=e),n.ChangeTimePos(a,i),this.options.experienceBase.getManager("VCXCommandManager").Push(n)},onTimelineGoToMarker:function(e){this._parent(e);this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var t=new o(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),this.getComponentsMap());t.GoToMarker(e.id),this.options.experienceBase.getManager("VCXCommandManager").Push(t)},goToMarker:function(e){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").SetCurrentFrame(e),this.updateTimelineFromModel()},onTimelineNextMarker:function(){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var e=new o(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),this.getComponentsMap());e.GoToNextMarker(),this.options.experienceBase.getManager("VCXCommandManager").Push(e)},OnTimelinePreviousMarker:function(){this._parent();this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1));var e=new o(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),this.getComponentsMap());e.GoToPreviousMarker(),this.options.experienceBase.getManager("VCXCommandManager").Push(e)},onTimelineCamera:function(e){this._parent(e);var t=null,n=this.options.experienceBase.getManager("VCXContextManager");n&&(t=n.getContext());var i=s.getCommandCheckHeader("VCXCameraPlayModeCmd",t);i&&i.setState(e),this.updateTimelineFromModel()},onTimePosChangeStart:function(){this._parent()},onTimePosChangeWhile:function(e){this._startChangeTime&&this.options.experienceBase.getManager("VCXCommandManager").StartTransaction(),this._parent(e),this._startChangeTime=!1},onTimePosChangeEnd:function(e){this._parent(e),this._startChangeTime=!0,this._startChangeTime&&this.options.experienceBase.getManager("VCXCommandManager").EndTransaction()},onStartPlay:function(){if(!this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario())this.options.experienceBase.getManager("VCXAPIManager").PlayAnimation()},onStopPlay:function(){this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.ChangeTimePos(0,!1),this.options.experienceBase.getManager("VCXScenarioManager").SetIsBouncing(!1),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1),e.publish({event:"VCX_STOP_PLAY"}),this.updateTimelineFromModel(),this._parent()},onPausePlay:function(){this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXAPIManager").PauseAnimation()),this._parent()},setPropertyOnScenario:function(e,t){var n=this.options.experienceBase.getManager("VCXScenarioManager"),i=this.getScenarioM(n.GetCurrentScenario()).QueryInterface("VCXIModifiable"),r=new a(n,this.options.experienceBase.getManager("VCXCommandManager")),o=null,s=(o=i.GetProperty(e).Clone()).GetPropertyValue();s.SetValue(t),o.SetPropertyValue(s),r.ChangeProperty(i,o),this.options.experienceBase.getManager("VCXCommandManager").Push(r)},setScenarioAnimationLoop:function(e){this.setPropertyOnScenario("Scenario.bIsLoop",e)},setScenarioAnimationBounce:function(e){this.setPropertyOnScenario("Scenario.bIsBounce",e)},setScenarioAnimationReverse:function(e){this.setPropertyOnScenario("Scenario.bIsReverse",e)},onTimelineStepForward:function(){this._parent();var e=this.getFrameFromModel();if(e>this.options.maxFrame){this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1);for(var t=0;t<this._timelines.length;t++)this._timelines[t].timeline.playGUIMode()}else{this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),e++,this.ChangeTimePos(e,!0),this.updateTimelineFromModel()}},onTimelineStepBackward:function(){this._parent();var e=this.getFrameFromModel();0!=e&&(this.options.experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario()&&(this.options.experienceBase.getManager("VCXContextManager")&&this.options.experienceBase.getManager("VCXContextManager").setAllViewerSensitive(!0),this.options.experienceBase.getManager("VCXScenarioManager").SetIsPlayingCurrentScenario(!1)),e--,this.ChangeTimePos(e,!0),this.updateTimelineFromModel())},getFrameFromModel:function(){return this.options.experienceBase.getManager("VCXScenarioManager").GetCurrentFrame()},getSelection:function(){return this._isFilterOnSelectionMode?this.getCurrentSelection():[]},getCurrentSelection:function(){return this.options.experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().map(function(e){return e.QueryInterface("VCXIModifiable")})},getScenarioM:function(e){return this.options.experienceBase.getManager("VCXScenarioManager")._Scenarios[e]},getComponentsMap:function(){return this.options.experienceBase.ComponentsMap},getModifiableFromHashing:function(e){return this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer.GetModifiableFromHashing(e)},getTrackModelFromTrackNode:function(e){},convertTrackNameToDisplayName:function(e,t){var n="";switch(this.convertTrackToId(e,t)){case 0:n="Position";break;case 4:n="Properties";break;case 2:n="Opacity";break;case 1:n="Materials";break;case 5:n="Links";break;case 8:n="Others";break;case 6:n="Viewport";break;case 3:n="Camera";break;case 7:n="Digger";break;default:n="unknown"}return n},removeTrackFromModel:function(e,t,n){for(var a=new i(this.options.experienceBase.getManager("VCXScenarioManager")),r=this.getScenarioM(this.options.scenarioID),o=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer,s=0;s<e.length;s++)for(var l=e[s].getParent().options._hash,c=o.GetModifiableFromHashing(l),d=e[s].getChildren()||[],p=0;p<d.length;p++){var u=d[p],h=u.options.strPropertyName,g=u.options.key._frame;a.ChangeKey(r,c,h,g,null)}this.options.experienceBase.getManager("VCXCommandManager").Push(a)},removeTrackFromModelFlatten:function(e,n,a){var r=new i(this.options.experienceBase.getManager("VCXScenarioManager")),o=this.getScenarioM(this.options.scenarioID),s=this.options.experienceBase.getManager("VCXScenarioManager").ModifiableServer,l=[];this.modifiables=this.getSelection(),0!==this.modifiables.length&&this.modifiables.forEach(function(e){var t=e.GetObject().GetID();t?l.push(t):console.log("VCXTimelineExtCtrl: hashing is empty !")});var c=[];if(l&&0!==l.length)for(var d=l.length,p=0;p<d;p++){var u=this.getComponentsMap(),h=l[p],g=u.GetComponentFromID(h);if(g){var m=(f=g.QueryInterface("VCXIModifiable")).GetHashing();c.push(m)}else console.log("component not found here !")}else this.getFilterOnSelectionMode()||o.GetListModifiables(c);var C=c.length;this.flattenKeysArray=[];for(var v=0;v<C;v++){var _=c[v],f=s.GetModifiableFromHashing(_),b=o.GetObjectAnimation(_),y=[];b.GetListTrackNames(y);for(var x=0;x<y.length;x++){if(this.convertTrackNameToDisplayName(y[x],f.GetObject().GetType())===e.options.label){var P=b.GetTrack(y[x]);if(P)for(var S=P._treekeys,V=new t(S),M=V.next();null!==M;){var w=M.GetFrame();n&&a&&(w<n||w>a)?M=V.next():(r.ChangeKey(o,f,y[x],w,null),M=V.next())}}}}this.options.experienceBase.getManager("VCXCommandManager").Push(r)},generateListOfMarkers:function(e,n,i,a){void 0===e&&(e="Add");var r=[];void 0===n&&(this.modifiables=this.getSelection()),0!==this.modifiables.length&&this.modifiables.forEach(function(e){var t=e.GetObject().GetID();t?r.push(t):console.log("VCXTimelineExtCtrl: hashing is empty !")}),this.options.scenarioID;var o=this.getScenarioM(this.options.scenarioID);if(o){if(void 0===n)if(n=[],r&&0!==r.length)for(var s=r.length,l=0;l<s;l++){var c=this.getComponentsMap(),d=r[l],p=c.GetComponentFromID(d);if(p){var u=(m=p.QueryInterface("VCXIModifiable")).GetHashing();n.push(u)}else console.log("component not found here !")}else this.getFilterOnSelectionMode()||o.GetListModifiables(n);var h=n.length;this.flattenKeysArray=[];for(var g=0;g<h;g++){var m,C=n[g],v=o.GetObjectAnimation(C),_=null;if((m=this.getModifiableFromHashing(C))&&(_=m.GetObject().GetID()),v&&_){var f=[];v.GetListTrackNames(f);for(var b=null,y=0;y<f.length;y++){b="#cccccc";var x=f[y],P=v.GetTrack(x);if(P){var S="";S=!0===this.options.flattenKeys?this.convertTrackToId(x,m.GetObject().GetType()):g;for(var V=P._treekeys,M=new t(V),w=M.next();null!==w;){var I=w.GetFrame();I,S,1===S&&!0===this.options.flattenKeys&&w&&w.GetValue()&&w.GetValue()&&w.GetValue().Clone()._value.GetColorHexString&&(b="#"+w.GetValue().Clone()._value.GetColorHexString());var T=null;T||(T={length:1,keyColor:b,componentHash:C,strPropertyName:x,data:w},this.options.flattenKeys,this._addKey(I,1,T.keyColor,S,T.componentHash,T.strPropertyName,T.data,a)),w=M.next()}}}}}}return[]},generateClientTreeTracks:function(e){var t=[],n=this.getScenarioM(this.options.scenarioID);n.GetListModifiables(t);for(var i=0,a=t.length,r=0;r<a;r++){var o=t[r],s=n.GetObjectAnimation(o);if(s){var l=this.getModifiableFromHashing(o),c=this.getModifiableName(l),d=this._createTrackNode(this._nodeClass,c,i,e._getTrueRoot());d._options._hash=o,i=1+d.options.id;var p=[];s.GetListTrackNames(p);for(var u=0;u<p.length;u++){var h=this._createTrackNode(this._nodeClass,p[u],i,d);i=1+h.options.id,h._options.preventDisplayChilds=!0}}}},getTrackTreeListView:function(){for(var e=0;e<this._timelines.length;e++){var t=this._timelines[e].timeline.getTrackTreeListView();if(t)return t}return null},getTimelineModel:function(){for(var e=0;e<this._timelines.length;e++){var t=this._timelines[e].timeline.getTimelineModel();if(t)return t}return null},getModifiableName:function(e){var t=e&&e.GetProperty("Actor.Name"),n=t&&t.GetPropertyValue().GetValue();""===n&&(n=e.GetHashing()+" (no name)");return n},onAddTracksKey:function(e){if(3===e.trackId)s.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext())&&s.getCommand("VCXAddCameraKeyCmd",this.options.experienceBase.getManager("VCXContextManager").getContext()).begin();else{if(this.modifiables=this.getCurrentSelection(),6===e.trackId){var t=this.options.experienceBase.getManager("VCXContextManager").getActiveViewport();this.modifiables=[],this.modifiables.push(t.QueryInterface("VCXIModifiable"))}if(0!==this.modifiables.length){for(var n=new l,i=0;i<this.modifiables.length;i++){var r=new c,o=this.modifiables[i],d=o.GetProperties();if(d){for(var p in d._map)this.convertTrackToId(p,o.GetObject().GetType())===e.trackId&&r.AddOrModifyProperty(d.GetProperty(p).Clone());n.AddOrModifyPropertySet(o.GetHashing(),r)}}var u=new a(this.options.experienceBase.getManager("VCXScenarioManager"),this.options.experienceBase.getManager("VCXCommandManager"),!0);u.ChangePropertiesFromMap(n),this.options.experienceBase.getManager("VCXCommandManager").Push(u)}}},onSelectionAreaMoveFlatten:function(e){this.getTimelineModel().lock++;for(var t=Math.round(e.timeInitStart*e.timeToFrame),n=Math.round(e.timeInitEnd*e.timeToFrame),a=Math.round(e.timeFinalStart*e.timeToFrame),r=n-t,o=Math.round(e.timeFinalEnd*e.timeToFrame)-a,s=new i(this.options.experienceBase.getManager("VCXScenarioManager")),l=0;l<e.tracks.length;l++){var c=e.tracks[l]._rowID||e.tracks[l]._localID+5,d=this.flattenKeysArray[c];if(d)for(var p in d)if(!(p<t||p>n)){var u=p,h=Math.round(a+(p-t)*o/r);this.actionsOnKeys(null,"move",null,u,h,e.scenarioID,c,s)}}this.getTimelineModel().lock--,this.options.experienceBase.getManager("VCXCommandManager").Push(s)}})}),define("DS/VCXWebGUI/VCXSidePanelExtendable",["UWA/Core","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Panels/SidePanel"],function(e,t,n,i){"use strict";return i.extend({defaultOptions:{className:"VCXSidePanelExtendable"},mItemList:[],dragWhileFactory:function(e){return function(t){var n=e,i=t.clientX;t.preventDefault(),n.elements.panel.style.transition="","left"===n.options.side?n.elements.panel.style.width=i-n.marginX+"px":n.elements.panel.style.width=n.screenX-i-n.marginX+"px",n.options.usecallback&&n.options.usecallback(n.options.controller,Math.max(parseInt(n.elements.panel.style.minWidth),parseInt(n.elements.panel.style.width))),n.options.controller&&"function"==typeof n.options.controller.updateToolbar&&n.options.controller.updateToolbar()}},dragEndFactory:function(e){return function(){var t=e;document.removeEventListener(n.POINTERMOVE,t._fctWhile,!1),document.removeEventListener(n.POINTERUP,t._fctEnd,!1),t._isDragged=!1,t.elements.panel.style.boxShadow="0px 0px 0px 0px #888888",t.elements.panel.style.transition=t._savedTransition,t._bLockRecord=!1,t.options.controller&&t.options.controller._vcxGuiManager&&t.options.controller._vcxGuiManager.updateUsableArea()}},addPointerEvents:function(){var e=this;e._leftSensor.addEvent(n.POINTERDOWN,function(t){e.screenX=document.body.clientWidth;var i=t.clientX,a=e.elements.panel.getBoundingClientRect().width;"left"===e.options.side?e.marginX=i-a:e.marginX=e.screenX-i-a,e._bLockRecord&&(document.removeEventListener(n.POINTERMOVE,e._fctWhile,!1),document.removeEventListener(n.POINTERUP,e._fctEnd,!1),e._isDragged=!1,e._bLockRecord=!1),document.addEventListener(n.POINTERMOVE,e._fctWhile),document.addEventListener(n.POINTERUP,e._fctEnd),e._bLockRecord=!0,e._isDragged=!0,e.elements.panel.style.transition=""})},getvalueCSS:function(e,t){var n=null,i=e,a=null;return window.getComputedStyle?n=(a=i.ownerDocument.defaultView.opener?i.ownerDocument.defaultView.getComputedStyle(i,null):window.getComputedStyle(i,null)).getPropertyValue(t):document.documentElement.currentStyle&&(n=void 0!==(a=i.currentStyle).getPropertyValue?a.getPropertyValue(t):a[t]),n},init:function(t){var n=this;n._parent(t),n._bLockRecord=!1,n._fctWhile=n.dragWhileFactory(n),n._fctEnd=n.dragEndFactory(n);t.title;n.elements.title.innerHTML="",n.elements.title.addClassName("vcx-panels-panelbase-title"),n.elements.panel.addClassName("vcx-panels-panelbase-panel"),n.elements.panel.addClassName(t.class);var i=n.getvalueCSS(n.elements.panel,"z-index");n._leftSensor=new e.Element("div",{class:"SidePanelExtendableSensor",styles:{height:"100%",left:"-11px",width:"12px",position:"absolute",cursor:"col-resize",zIndex:i+1},events:{mouseover:function(){"left"===n.options.side?n.elements.panel.style.boxShadow="2px -2px 2px 0px #D3D3D3":n.elements.panel.style.boxShadow="-2px -2px 2px 0px #D3D3D3",n.elements.panel.style.transition=""},mouseout:function(){!1===n._isDragged&&(n.elements.panel.style.boxShadow="0px 0px 0px 0px #888888",n.elements.panel.style.transition=n._savedTransition)}}}),"left"===n.options.side&&(n._leftSensor.style.right=n._leftSensor.style.left,n._leftSensor.style.left=""),n._isDragged=!1,n._savedTransition=this.elements.panel.style.transition,n.elements.panel.insertBefore(n._leftSensor,n.elements.panel.firstChild),n.addPointerEvents()},slideIn:function(){this._parent();var e=parseFloat(this.elements.panel.style.transitionDuration);setTimeout(function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_IN"})},1e3*e)},slideOut:function(){this._parent();var e=parseFloat(this.elements.panel.style.transitionDuration);setTimeout(function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_OUT"})},1e3*e)}})}),define("DS/VCXWebGUI/VCXPropertiesPanelView",["UWA/Class","DS/Controls/Accordeon","DS/Controls/LineEditor","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i){"use strict";var a="noSelectionHighlight",r="vcx-propertiesContainer-empty",o="vcx-properties-mainContent";return e.extend({init:function(e){this._propertiesPanelModel=e,this.createPropertiesContainer(),this.createWatermarkMessage(),this.activeTweakersList=[]},unInitialize:function(){this._tabPageFrame&&(this._tabPageFrame.unInitialize(),delete this._tabPageFrame),this._selectElementMessage.remove(),this._selectElementMessage=null,this.removeContainer(),this._container.remove(),this._container=null,this._panelContent&&(this._panelContent.remove(),this._panelContent=null),this._propertiesPanelModel=null},setFrame:function(e){this._tabPageFrame=e},getTabPageFrame:function(){return this._tabPageFrame},setPanelContent:function(e){this._panelContent=e,this._selectElementMessage.inject(this._panelContent)},getPanelContent:function(){return this._panelContent},createWatermarkMessage:function(){this._selectElementMessage=new UWA.Element("div",{html:"",class:"vcx-selectEltMsgContainer"});var e=new UWA.Element("div",{html:"",class:"vcx-selectEltMsgNode vcx-selectEltMsg-icon fonticon fonticon-touch"}),t=new UWA.Element("div",{html:i.VCXSelectElementMessage,class:"vcx-selectEltMsgNode vcx-selectEltMsg-text"});e.inject(this._selectElementMessage),t.inject(this._selectElementMessage)},createPropertiesContainer:function(){this._container=new UWA.Element("div",{html:"",class:o+" "+a,styles:{height:"100%"}}),this._groupsAccordeon=new t({items:[],style:"divided",exclusive:!1}).inject(this._container)},getPropertiesContainer:function(){return this._container},putContainer:function(){this._panelContent&&this._container&&!this._panelContent.contains(this._container)&&(this._panelContent.classList.remove(r),this._container.inject(this._panelContent))},removeContainer:function(){this.activeTweakersList.every(function(e){return e.destroy?e.destroy():console.warn("a tweaker wasnt properly destroyed: ",e),!0}),this.activeTweakersList=[],this._panelContent&&(this._container&&this._panelContent.contains(this._container)&&(this._panelContent.removeChild(this._container),this.emptyContainerContent()),this._panelContent.classList.add(r))},emptyContainerContent:function(){this._groupsAccordeon&&(this._groupsAccordeon.getContent().removeEventListener("expand",this._expanderExpandCB),this._groupsAccordeon.getContent().removeEventListener("collapse",this._expanderCollapseCB),this._expanderExpandCB=null,this._expanderCollapseCB=null)},createToolbarSearchInput:function(e,t){this._searchCB=t,this._searchView=new n({placeholder:e,selectAllOnFocus:!0,autoCommitFlag:!0,recId:"LineEditor"}),this._searchView.getContent().setStyle("display","inline-block"),this._searchView.getContent().addEvent("change",this._searchCB),this._tabPageFrame},getSearchInputValue:function(){return this._searchView.valueToCommit},createToolbarCommands:function(e,t){this._tabPageFrame&&(this._tabPageFrame._toolbar.addMainItemFixed("VCXRestoreNeutralsCmd","","vcxToolbarButton fonticon-reset ","VCXWebAuthoringCommands/VCXWebAuthoringCommands",i),this._tabPageFrame._toolbar.addMainItemFixed("VCXCaptureInNeutralsCmd","","vcxToolbarButton fonticon-floppy ","VCXWebAuthoringCommands/VCXWebAuthoringCommands",i),this._tabPageFrame._toolbar.addMainItemFixed("VCXFormatPainterCmd","vcxHidden",["vcxToolbarButtonChecked","fonticon-broom vcxFormatPainter"],"VCXWebAuthoringCommands/VCXWebAuthoringCommands",i,null,null,"VCX_FORMAT_PAINTER_START","VCX_FORMAT_PAINTER_END",!0),e&&(this._tabPageFrame._toolbar.addMainItemFixed("VCXLinkedPropCopyCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",i),this._tabPageFrame._toolbar.addMainItemFixed("VCXLinkedPropPasteCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",i)),t&&this._tabPageFrame._toolbar.addMainItemFixed("VCXCreateStyleFromSelectedPropertiesCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",i))},subscribeTweakerEvt:function(e,t){"string"==typeof e&&"function"==typeof t&&this._panelContent&&this._panelContent.addEventListener(e,t)},unsubscribeTweakerEvt:function(e,t){"string"==typeof e&&"function"==typeof t&&this._panelContent&&this._panelContent.removeEventListener(e,t)},updateAccordeon:function(e,t){this._emptyAndRefillAccordeon(e);for(var n=[],i=0;i<t.length;++i){var a=t[i],r=a.GetType(),o=a.QueryInterface("VCXIModifiableView");if(n.includes(r)||n.push(r),!this._propertiesPanelModel.isCollapsedGroupsSavedForComponent(r)){var s=o.getCollapsedGroupsNames();this._propertiesPanelModel.setCollapsedGroupsForComponent(r,s)}}for(var l=this._propertiesPanelModel.getCollapsedGroupsForComponents(n),c=0;c<e.length;++c){var d=e[c],p=this._groupsAccordeon.getExpanderFromIndex(c);p.groupID=d.groupID,d.hideArrow?(p.getContent().addClassName("vcx-HeaderArrowHidden"),p.hideArrow=!0):l.includes(d.groupID)||(p.expandedFlag=!0)}var u=this;this._expanderExpandCB=function(e){var t=e.options.expanderTarget.groupID;t&&u._propertiesPanelModel.removeCollapsedGroupForComponents(n,t)},this._expanderCollapseCB=function(e){var t=e.options.expanderTarget.groupID;t&&u._propertiesPanelModel.addCollapsedGroupForComponents(n,t)},this._groupsAccordeon.getContent().addEventListener("expand",this._expanderExpandCB),this._groupsAccordeon.getContent().addEventListener("collapse",this._expanderCollapseCB)},updateAccordeonForODT:function(e){this._emptyAndRefillAccordeon(e),this._groupsAccordeon.getExpanderFromIndex(0).expandedFlag=!0},_emptyAndRefillAccordeon:function(e){this._groupsAccordeon.clear();for(var t=0;t<e.length;++t){var n=e[t];n&&this._groupsAccordeon.addItem(n)}}})}),define("DS/VCXWebGUI/VCXPropertiesCtrlV2",["UWA/Class"],function(e){"use strict";return e.extend({})}),define("DS/VCXWebGUI/VCXMediaChooserServices",["UWA/Class","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXMediaChooser/VCXChoosePicture","DS/VCXMediaChooser/VCXImageGallery"],function(e,t,n,i,a){"use strict";return e.extend({init:function(e){this._experienceBase=e},GetDocIDFromImageLoadQuery:function(){if(this._experienceBase.odt){var e=this._experienceBase.getManager("VCXDocManager").QueryInterface("VCXIModifiable"),n=e&&e.GetDefaultImageIdx();return new t(n)}var a=UWA.Promise.deferred(),r=new i(this._experienceBase);"undefined"!=typeof widget&&r.setWidget(widget),r.open(function(e,t){this._imageUrl=e,this._fileName=t}.bind(this),function(e,t){o(this._imageUrl,this._fileName)}.bind(this));var o=function(e,t){if(e){var n=this._experienceBase.getManager("VCXDocManager"),i=n.BuildPathFromString(e,t),r=n.AddOrModifyDoc(i);a.resolve(r)}else a.resolve(null)}.bind(this);return a.promise}})}),define("DS/VCXWebGUI/VCXPaperPanCmd",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){this._activatePanForPaper(!0),this._viewer=this.getFrameWindow()&&this.getFrameWindow().getViewer(),this._viewer.startPan(this)},endExecute:function(){this._activatePanForPaper(!1),this._viewer.endPan(this),this._viewer=null},_activatePanForPaper:function(e){this._experienceBase=this.getFrameWindow()._experienceBase;var t=this._experienceBase&&this._experienceBase.getManager("VCXPaperManager");t&&t.ActivatePaperPan(e)}})}),define("DS/VCXWebGUI/VCXStatsCtrl",["UWA/Class","DS/CoreEvents/Events","DS/Windows/Panel"],function(e,t,n){"use strict";return e.extend({init:function(e){var i=this;i.dataMaster={},i.dataMaster.fps="",this.options=e,i.statsContent=new UWA.Element("div"),this._panelMaster=new n({immersiveFrame:e.immersiveFrame,currentDockArea:e.currentDockArea||4,title:"Stats",content:i.statsContent}),e.immersiveFrame.addWindow(this._panelMaster);var a=new Stats,r=function(){a.update(),i.dataMaster.fps=a.domElement.childNodes[0].childNodes[0].childNodes[0].data,i.updateUI(),i.fpsReq=requestAnimationFrame(r)};this.fpsReq=requestAnimationFrame(r),this._tokenChanged=t.subscribe({event:"VCX_STATS_UPDATE"},function(e){i.updateStatsFromData(e)}),this._tokenRemove=t.subscribe({event:"VCX_STATS_REMOVE"},function(e){i.removeTrackingData(e)}),this._tokenEmpty=t.subscribe({event:"VCX_STATS_EMPTY"},function(){i.emptyTrackingData()})},destroy:function(){window.cancelAnimationFrame(this.fpsReq),this.options.immersiveFrame.removeWindow(this._panelMaster),t.unsubscribe(this._tokenChanged),this._tokenChanged=null,t.unsubscribe(this._tokenRemove),this._tokenRemove=null,t.unsubscribe(this._tokenEmpty),this._tokenEmpty=null},removeTrackingData:function(e){delete this.dataMaster[e.id]},emptyTrackingData:function(e){this.dataMaster={}},updateStatsFromData:function(e){this.dataMaster[e.id]=e.value,this.updateUI()},updateUI:function(){var e="";for(var t in this.dataMaster)e+=t+": "+this.dataMaster[t]+", ";this.statsContent.innerHTML=e}})}),define("DS/VCXWebGUI/VCXPaperCtrlV2",["UWA/Class","DS/CoreEvents/Events","UWA/Element","DS/Core/PointerEvents","DS/Controls/Timeline","DS/RuntimeView/RSCManager","DS/ApplicationFrame/CommandsManager","DS/Tweakers/GeneratedToolbar","DS/Tweakers/TypeRepresentationFactory","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/WebappsUtils/WebappsUtils","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,p,u,h){"use strict";var g=e.extend({init:function(e,t){if(this._vcxGuiManager=e,this._experienceBase=null,null!=t&&(this._experienceBase=t),this._vcxPaperManager=this._experienceBase.getManager("VCXPaperManager"),this._touchCompliant=this._vcxGuiManager.isTouchActivated(),this._contextManager=this._experienceBase.getManager("VCXContextManager"),this._contextManager){this.listRatios={a4l:{title:h["VCXPaperCtrl.Ratio.A4L"],ratioWidth:297,ratioHeight:210,specificWidth:297,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},a4p:{title:h["VCXPaperCtrl.Ratio.A4P"],ratioWidth:210,ratioHeight:297,specificWidth:210,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_16.png")},square:{title:h["VCXPaperCtrl.Ratio.Square"],ratioWidth:1,ratioHeight:1,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio1_1.png")},default:{title:h["VCXPaperCtrl.Ratio.Wide"],ratioWidth:16,ratioHeight:9,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},_35mm:{title:h["VCXPaperCtrl.Ratio.mm35"],ratioWidth:4,ratioHeight:3,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio4_3.png")},goldenRatio:{title:h["VCXPaperCtrl.Ratio.GoldenRatio"],ratioWidth:16,ratioHeight:10,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio16_9.png")},wsc:{title:h["VCXPaperCtrl.Ratio.WideScreenCinema"],ratioWidth:2.35,ratioHeight:1,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio235_1.png")},iphonexP:{title:h["VCXPaperCtrl.Ratio.iPhoneXP"],ratioWidth:9,ratioHeight:19.5,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio9_195.png")},iphonexL:{title:h["VCXPaperCtrl.Ratio.iPhoneXL"],ratioWidth:19.5,ratioHeight:9,icon:u.getWebappsAssetUrl("VCXWebGUI","css/img/VCXPaperRatio195_9.png")}},this._aspectRatio=this.listRatios.a4l,this._isToolbarReady=!1;var n=this.getPaperCtrlBarModel(),i="scroll";this._touchCompliant&&(i="scroll"),this.paperControlToolbar=new s({overflowManagement:i,direction:"horizontal",items:n}),this.paperControlToolbar.elements.container.addClassName("VCXPaperCtrlV2"),this.paperControlToolbar.inject(this._vcxGuiManager.getUsableArea()),this.updateRatioDisplay(),this.registerToolbarEvents()}else console.error("No ContextManager found, paperCtrl initialization aborted..")},unInitialize:function(){this.unRegisterToolbarEvents(),this.paperControlToolbar&&this.paperControlToolbar.destroy(),this.paperControlToolbar=null,this._experienceBase=null},registerToolbarEvents:function(){var e=this;e.paperControlToolbar.addEventListener("onReady",e._onToolbarReady.bind(e)),this.tokenPaperRatio=t.subscribe({event:"VCX_PAPER_RATIO_CHANGED"},function(){e.updateRatioDisplay()})},unRegisterToolbarEvents:function(){t.unsubscribe(this.tokenPaperRatio),this._zoomChangedToken&&t.unsubscribe(this._zoomChangedToken),this._panChangedToken&&t.unsubscribe(this._panChangedToken)},GetAspectRatio:function(){return this._aspectRatio},SetAspectRatio:function(e){this._aspectRatio=e},updatePaperArea:function(e,t){if(this._isToolbarReady){e&&(e.top+=this.paperControlToolbar.elements.container.offsetHeight,e.height-=this.paperControlToolbar.elements.container.offsetHeight),t&&(t.top+=this.paperControlToolbar.elements.container.offsetHeight,t.height-=this.paperControlToolbar.elements.container.offsetHeight);var n=this.paperControlToolbar.elements.container.offsetWidth,i=this.paperControlToolbar.elements.nearContainer.offsetWidth+this.paperControlToolbar.elements.centerContainer.offsetWidth+this.paperControlToolbar.elements.farContainer.offsetWidth+10;i>=n&&!this._wideDisplayWidth&&(this._wideDisplayWidth=i),this._touchCompliant?this._toolbarDisplayStyle!==g.responsiveStyle.NoLabels&&this._changeBarStyle(g.responsiveStyle.NoLabels):this._wideDisplayWidth&&(n>=this._wideDisplayWidth?this._toolbarDisplayStyle!==g.responsiveStyle.Wide&&(this._changeBarStyle(g.responsiveStyle.Wide),this._wideDisplayWidth=null):n<475?this._toolbarDisplayStyle!==g.responsiveStyle.Compact&&this._changeBarStyle(g.responsiveStyle.Compact):this._toolbarDisplayStyle!==g.responsiveStyle.NoLabels&&this._changeBarStyle(g.responsiveStyle.NoLabels))}},_changeBarStyle:function(e){switch(e){default:break;case 1:var t=this._getLabelElements();Array.prototype.forEach.call(t,function(e){"none"===e.style.display&&(e.style.display="")}),this._toolbarDisplayStyle=g.responsiveStyle.Wide;break;case 2:t=this._getLabelElements();Array.prototype.forEach.call(t,function(e){e.style.display="none"}),this._toolbarDisplayStyle=g.responsiveStyle.NoLabels;break;case 3:t=this._getLabelElements();Array.prototype.forEach.call(t,function(e){e.style.display="none"}),this._toolbarDisplayStyle=g.responsiveStyle.Compact}},_getLabelElements:function(){if(this.paperControlToolbar&&this.paperControlToolbar.elements.container)return this.paperControlToolbar.elements.container.querySelectorAll(".VCXPaperCtrlV2 .wux-controls-toolbar-mask-container .wux-toolbar-items .wux-generated-toolbar-items-label, .VCXPaperCtrlV2 .wux-controls-toolbar-mask-container .wux-tweakers-string-label, .VCXPaperCtrlV2 .wux-controls-button > span")},_onToolbarReady:function(){var e=this;this._isToolbarReady=!0,this._vcxPaperManager.getPaperVisibility()&&this.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[0].addClassName("vcx-state-active"),e._vcxPaperManager.AutoFit&&e.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0]&&e.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0].addClassName("vcx-ui-hidden");var n=this.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0];this._zoomChangedToken=t.subscribe({event:"/VCX/Paper/ZoomChanged"},function(t){t&&n&&(t.autoFit?n.addClassName("vcx-ui-hidden"):n.removeClassName("vcx-ui-hidden")),t&&!t.updatePaper&&(e._lockupdatePaper=!0),e.paperControlToolbar.getNodeModelByID("zoomPercentage").getAttributeValue("data")!==100*e._vcxPaperManager.Zoom&&e.paperControlToolbar.updateNodeModel("zoomPercentage",{grid:{data:100*e._vcxPaperManager.Zoom}}),e._lockupdatePaper=!1,e._checkPaperSpace()}),this._panChangedToken=t.subscribe({event:"/VCX/Paper/PanChanged"},function(t){t&&n&&(t.autoFit?n.addClassName("vcx-ui-hidden"):n.removeClassName("vcx-ui-hidden")),e._checkPaperSpace()}),this._contextManager.isSupported("DisplayPaperCtrlBtns")||this.hide(),this._vcxGuiManager.updateUsableArea(),this.updatePaperArea(),this._checkPaperSpace()},_checkPaperSpace:function(){document.getElementById("divPaperSpace")&&document.getElementById("divPaperSpace").getBoundingClientRect().y<this.paperControlToolbar.elements.container.offsetHeight?this.paperControlToolbar.elements.container.style.background="#FFFFFF91 0% 0% no-repeat padding-box":this.paperControlToolbar.elements.container.style.removeProperty("background")},hide:function(){this.paperControlToolbar.elements.container.hide()},show:function(){this.paperControlToolbar.elements.container.show()},isHidden:function(){return this.paperControlToolbar&&"none"===this.paperControlToolbar.elements.container.style.display},updateRatioDisplay:function(){var e,t=!1,n=this.GetAspectRatio(),i=Math.round(this._vcxPaperManager.GetWidth()/this._vcxPaperManager.GetHeight()*1e4)/1e4;0!==Object.keys(n).length&&(i!==Math.round(n.ratioWidth/n.ratioHeight*1e4)/1e4||n.specificWidth&&n.specificWidth!==this._vcxPaperManager.GetWidth()||(t=!0));if(!t)for(var a in this.listRatios)if(this.listRatios.hasOwnProperty(a)){var r=this.listRatios[a];if(r.calculatedValue===i&&(!r.specificWidth||r.specificWidth===this._vcxPaperManager.GetWidth())){this.SetAspectRatio(r),t=!0;break}}if(t)e=this.GetAspectRatio().title;else{this.SetAspectRatio({}),e=Math.round(this._vcxPaperManager.GetWidth())+" x "+Math.round(this._vcxPaperManager.GetHeight())}this.paperControlToolbar.updateNodeModel("ratioDisplayText",{grid:{data:e}})},getPaperCtrlBarModel:function(){var e={entries:[{id:"ratioIcon",dataElements:{typeRepresentation:"default",icon:{iconName:"aspect-ratio",fontIconFamily:1}},position:"near",category:"1",readOnly:!0},{id:"ratioDisplayText",dataElements:{typeRepresentation:"string",value:""},position:"near",category:"1",readOnly:!0},{id:"PaperRatioChooser",dataElements:{typeRepresentation:"chevronMenuIcon",value:{menu:[{type:"TitleItem",title:h["VCXPaperCtrlV2.CanvasAspectRatio"]}]},position:"near",category:"1"}},{id:"ReframePaperButton",dataElements:{typeRepresentation:"function",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"reframePaper",argument:this},icon:{iconName:"zoom-fit",fontIconFamily:1},label:h["VCXPaperCtrlV2.Reframe"],position:"center",category:"1"}},{id:"ShowHidePaperButton",dataElements:{typeRepresentation:"function",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"showHidePaper",argument:this},icon:{iconName:"eye-windowed",fontIconFamily:1},label:h["VCXPaperCtrlV2.Canvas"],position:"far",category:"1"}},{id:"ZoomMinus",dataElements:{typeRepresentation:"functionIcon",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"incrementZoomTweaker",argument:{this:this,increment:-10}},icon:{iconName:"minus",fontIconFamily:1},position:"far",category:"3"}},{id:"ZoomPlus",dataElements:{typeRepresentation:"functionIcon",action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"incrementZoomTweaker",argument:{this:this,increment:10}},icon:{iconName:"plus",fontIconFamily:1},position:"far",category:"3"}},{id:"zoomPercentage",dataElements:{typeRepresentation:"integer",stepValue:5,minValue:10,maxValue:400,value:100,units:"%",label:h["VCXPaperCtrlV2.Zoom"],position:"far",category:"3"},onNodeUpdate:this._percentageTweakerUpdate.bind(this)}]};for(var t in this.listRatios)if(this.listRatios.hasOwnProperty(t)){var n=this.listRatios[t];n.calculatedValue=Math.round(n.ratioWidth/n.ratioHeight*1e4)/1e4;var i={type:"RadioItem",title:n.title,action:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"changeRatio",argument:{this:this,ratio:n}},icon:n.icon};e.entries[e.entries.findIndex(function(e){return"PaperRatioChooser"===e.id})].dataElements.value.menu.push(i)}var a=s.prototype.createTreeDocument(e);a.prepareUpdate();var r=null,l=this._contextManager.getContext(),c=o.getCommand("VisuPanViewPaper",l);return c&&((r=new d({label:h["VCXPaperCtrlV2.Move"],position:"far",category:"2",icon:{iconName:"arrow-double-combo",fontIconFamily:1},grid:{typeRep:"function",data:{module:"DS/VCXWebGUI/VCXPaperCtrlV2",func:"panPaper",argument:{this:this,panCmd:c}}}}))._ID="PanPaperButton",a.addRoot(r)),a.prepareUpdate(),a},_percentageTweakerUpdate:function(e){if(this._experienceBase&&!this._lockupdatePaper){var t=e.getAttributeValue("data");this._vcxPaperManager.Zoom=t/100}}});return g.showHidePaper=function(e){var t=e,n=!t._vcxPaperManager.getPaperVisibility();t._vcxPaperManager.setPaperVisibility(n);var i=t.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[0];n?i.addClassName("vcx-state-active"):i.removeClassName("vcx-state-active")},g.panPaper=function(e){var t=e.this,n=e.panCmd;if(n){var i,a=t.paperControlToolbar.elements.farContainer.getElementsByClassName("wux-tweaker-function")[1];if(n.isRunning())n.end(),a&&a.removeClassName("vcx-state-active"),t._vcxGuiManager.GetCanvasView()&&(t._vcxGuiManager.GetCanvasView().style.cursor="auto"),(i=document.getElementById("divPaperSpace"))&&i.removeClassName("paper-highlight");else n.begin(),a&&a.addClassName("vcx-state-active"),(i=document.getElementById("divPaperSpace"))&&i.addClassName("paper-highlight");n.onBegin(function(){a&&!a.classList.contains("vcx-state-active")&&a.addClassName("vcx-state-active");var e=document.getElementById("divPaperSpace");e&&!e.classList.contains("paper-highlight")&&e.addClassName("paper-highlight")}),n.onPause(function(e){n.end()}),n.onEnd(function(){a&&a.removeClassName("vcx-state-active"),t._vcxGuiManager.GetCanvasView()&&(t._vcxGuiManager.GetCanvasView().style.cursor="auto");var e=document.getElementById("divPaperSpace");e&&e.removeClassName("paper-highlight")})}},g.reframePaper=function(e){var t=e,n=t._vcxPaperManager.ToggleAutoFit(),i=t.paperControlToolbar.elements.centerContainer.getElementsByClassName("wux-tweaker-function")[0];n?i.addClassName("vcx-ui-hidden"):i.removeClassName("vcx-ui-hidden"),t._vcxGuiManager.updateUsableArea()},g.changeRatio=function(e){var t=e.this,n=e.ratio,i=n.ratioWidth,a=n.ratioHeight,r=n.specificWidth;if(i&&a){var o=t._experienceBase.getManager("VCXContextManager").getActiveViewport();if(o){var s=o.QueryInterface("VCXIModifiable");if(s){var l=t._experienceBase.getManager("VCXCommandManager");t.SetAspectRatio(n),l.StartTransaction();var c=new p(t._experienceBase.getManager("VCXScenarioManager"),l,!1),d=t._vcxPaperManager.GetWidth();if(r){d=r;var u=s.GetProperty("Paper.Width").Clone(),h=u.GetPropertyValue().Clone();if(h.SetValue(d),u.SetPropertyValue(h),m=s.RequestModification(u))for(var g in m._map)c.ChangeProperty(s.QueryInterface("VCXIModifiable"),m._map[g]),l.Push(c)}d*=a/i;var m,C=s.GetProperty("Paper.Height").Clone(),v=C.GetPropertyValue().Clone();if(v.SetValue(d),C.SetPropertyValue(v),m=s.RequestModification(C))for(var g in m._map)c.ChangeProperty(s.QueryInterface("VCXIModifiable"),m._map[g]),l.Push(c);l.EndTransaction()}}}t.updateRatioDisplay()},g.incrementZoomTweaker=function(e){var t=e.this,n=e.increment;if(null!==t._experienceBase){var i=100*t._vcxPaperManager.Zoom+n;t.paperControlToolbar.updateNodeModel("zoomPercentage",{grid:{data:i}})}},g.responsiveStyle={Wide:1,NoLabels:2,Compact:3},g}),define("DS/VCXWebGUI/VCXToolbarCtrl",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/RuntimeView/RSCManager","DS/ApplicationFrame/CommandsManager"],function(e,t,n,i,a,r){"use strict";return t.extend({init:function(t){if(this.options=t,void 0!==t.parent){var n=this;n._listFixedItem={},n._listItem={},n._listMainItem={},n.listCmdCreated=[],n._titleName=new e.Element("div",{html:t.title,class:"vcxToolbarTitle"}).inject(t.parent),n._titleMenu=new e.Element("div",{class:"vcxToolbarMenuExpandableTitleMenu"}).inject(t.parent),n._titleMenuExpandable=new e.Element("div",{class:"vcxToolbarMenuExpandable"}).inject(n._titleMenu),t.controller&&t.controller._vcxGuiManager&&t.controller._vcxGuiManager._experienceBase.getManager("VCXContextManager").isIE11()&&n._titleMenuExpandable.addClassName("IE11"),n._titleToolbar=new e.Element("div",{class:"vcxTitleToolbar"}).inject(t.parent),n._toolBarEdit=new e.Element("div",{class:"vcxToolbarEdit vcxHidden",styles:{float:"right",overflow:"hidden",whiteSpace:"nowrap"}}).inject(t.parent),n._listDisplayMainCmd=[],n._listDisplayExpandedCmd=[],n._toggleDisplayEditToolbar=!1,addEventListener("keydown",this.closeEditBar),n.resizeObs||("function"==typeof ResizeObserver?n.resizeObs=new ResizeObserver(e=>{e.forEach(e=>{n.updateToolbar()})}):n.resizeObs=new MutationObserver(n.updateToolbar.bind(n)))}},unInitialize:function(){for(var e in this.listCmdCreated){var t=this.listCmdCreated[e];t.cmdId&&(t.removeEventListener(i.POINTERUP,t.pointerDownOnCommandButtonStarterCB,!1),t.vcxCallBack&&t.removeEventListener(i.POINTERUP,t.vcxCallBack,!1),t.flagPointerDown&&t.removeEventListener(i.POINTERDOWN,t.flagPointerDown),t.toggleMenu&&t.removeEventListener(i.POINTERUP,t.toggleMenu),t._experienceBase=null,t.cmdId=null,t.checkedButton=null,t.cbPointerDown=null,t.vcxCallBack=null,t.flagPointerDown=null,t.toggleMenu=null),t.cbPointerUp&&(t.removeEventListener(i.POINTERUP,t.cbPointerUp),t.cbPointerUp=null),t.remove&&t.remove()}removeEventListener("keydown",this.closeEditBar),this.listCmdCreated=null,this._titleName.remove(),this._titleName=null,this._titleMenu.remove(),this._titleMenu=null,this._titleMenuExpandable.remove(),this._titleMenuExpandable=null,this._titleToolbar.remove(),this._titleToolbar=null,this._toolBarEdit.remove(),this._toolBarEdit=null,this.resizeObs.disconnect(),this.resizeObs=null,this._listDisplayMainCmd=[],this._listDisplayExpandedCmd=[],this._listFixedItem={},this._listItem={},this._listMainItem={},this.options=null},getTextContainer:function(){return this._titleName},activateEditMode:function(e){var t=this;e&&(t=e),t._toggleDisplayEditToolbar=!0,void 0===t._toolbarTitle&&(t._toolbarTitle=t._titleName.innerHTML);var i=t.options.controller.getNbSelectedItems(),a=t.options.controller.getNbItems();t.options.parent.addClassName("vcxToolbarEdit"),t._titleName.innerHTML=i+" / "+a,t._titleName.addClassName("edit"),t._toolBarEdit.removeClassName("vcxHidden"),t._titleToolbar.addClassName("vcxHidden"),t._titleMenu.addClassName("vcxHidden"),t._TOOLBARSTATE_Token=n.subscribe({event:"VCX_CLOSE_TOOLBAR"},function(){var e=document.getElementsByClassName("vcxToolbarButtonStarterMenuRight vcxToolbarButtonStarterMenuRightEdit")[0].cmdId;if(Array.isArray(e)){var t=e[0],n=e[1],i=e[2];n.call(t,i)}})},getEditToolbar:function(){return this._toolBarEdit},isEditMode:function(){return this._toggleDisplayEditToolbar},exitEditMode:function(e){var t=this;e&&(t=e),t._toggleDisplayEditToolbar=!1,void 0!==t._toolbarTitle?t._titleName.innerHTML=t._toolbarTitle:t._toolbarTitle=t._titleName.innerHTML,t.options.parent.removeClassName("vcxToolbarEdit"),t._titleName.removeClassName("edit"),t._toolBarEdit.addClassName("vcxHidden"),t._titleToolbar.removeClassName("vcxHidden"),t._titleMenu.removeClassName("vcxHidden"),n.unsubscribe(t._TOOLBARSTATE_Token),delete t._TOOLBARSTATE_Token},closeEditBar:function(t){"esc"===e.Event.whichKey(t)&&n.publish({event:"VCX_CLOSE_TOOLBAR"})},updateToolbar:function(){if(this._titleName.style.width="",this._titleToolbar.style.width="",this._titleToolbar.offsetWidth&&this._titleName.offsetWidth){var e,t=this.options.controller.getFrame().getGoToParent(),n=(this.options.panel.elements?this.options.panel.elements.panel.offsetWidth:this.options.panel.offsetWidth)-24-(t?t.offsetWidth:0),i=this._titleName.offsetWidth,a=this._titleToolbar.offsetWidth,r=this._listDisplayMainCmd.length+1,o=this._titleMenu.getElementsByClassName("vcxToolbarButtonStarterMenuRight")[0];e=o?o.offsetWidth:0;if(i>n-this.offsetWidthProcess(r-1)-e){a=this.offsetWidthProcess(r-1),i=n-this.offsetWidthProcess(r-1)-e,this._titleName.style.overflow="hidden",this._titleName.style.width=i+"px",this._titleToolbar.style.width=a+"px";for(var s=r-1;s<this._listDisplayMainCmd.length;s++)this._listDisplayMainCmd[s].style.display="none";for(var l=0;l<this._listDisplayExpandedCmd.length;l++){this._listDisplayExpandedCmd[l].style.display="table-row"}}else{var c=n-i-this.offsetWidthProcess(r-1)-e,d=0;for(l=r-1;l<this._listDisplayMainCmd.length;l++)c-this.offsetWidthProcess(l,!0)>=0&&(d++,c-=this.offsetWidthProcess(l,!0));var p=0===d?a:this.offsetWidthProcess(r-1+d)+1;this._titleToolbar.style.width=p+"px";for(var u=r-1;u<this._listDisplayMainCmd.length;u++)this._listDisplayMainCmd[u].style.display=u<d+r-1?"inline-block":"none";for(var h=0;h<this._listDisplayExpandedCmd.length;h++)this._listDisplayExpandedCmd[h].style.display=h<d?"none":"table-row"}}},offsetWidthProcess:function(e,t){if(t){if(e>this._listDisplayMainCmd.length)return 0;var n,i=!1;return"none"===this._listDisplayMainCmd[e].style.display&&(i=!0,this._listDisplayMainCmd[e].style.display="inline-block"),n=this._listDisplayMainCmd[e].offsetWidth,i&&(this._listDisplayMainCmd[e].style.display="none"),n}for(var a=0,r=0;r<e;r++)if(r>=this._listDisplayMainCmd.length)a+=0;else{i=!1;"none"===this._listDisplayMainCmd[r].style.display&&(i=!0,this._listDisplayMainCmd[r].style.display="inline-block"),a+=this._listDisplayMainCmd[r].offsetWidth,i&&(this._listDisplayMainCmd[r].style.display="none")}return a},addMainItemFixed:function(e,t,n,i,a,r,o,s,l,c){var d=this.onCreateToolbarButton(e,t,n,i,a,o,s,l,c);if(!r){r=this._titleToolbar,this._listDisplayMainCmd.push(d);this.resizeObs.observe(d,{childList:!1,attributes:!0,characterData:!1,subtree:!0,attributeOldValue:!1,attributesFilter:["style"]}),this._listMainItem[n]=d}r&&(d.setAttribute("data-rec-id","id-"+n+"-"+e),r.appendChild(d))},addMainItem:function(e,t,n,i,a,r){this.addMainItemFixed(e,t,n,i,a,null,r);var o=this.addSubItem(e,t,n,i,a,r);this._listItem[n]=o},addSubItemFixed:function(e,t,n,i,a,r,o,s){if(s){var l=this._titleMenuExpandable.childNodes;l.length>0&&l[l.length-1].addClassName("vcxToolbarMenuExpandedRowLast")}var c=this.addSubItem(e,t,n,i,a,r,o,!0);this._listItem[n]=c,this._listFixedItem[n]=c,1===Object.keys(this._listFixedItem).length&&c.addClassName("activated")},activeItem:function(e){this.activeMainItem(e),this.activeSubItem(e)},desactiveItem:function(e){this.desactiveMainItem(e),this.desactiveSubItem(e)},setItem:function(e,t){t?this.activeItem(e):this.desactiveItem(e)},toggleItem:function(e){this.toggleMainItem(e),this.toggleSubItem(e)},activeMainItem:function(e){var t=this._listMainItem[e];t&&t.addClassName("activated")},activeSubItem:function(e){var t=this._listItem[e];t&&t.addClassName("activated")},getActiveItem:function(){this._listItem(function(e){1})},desactiveMainItem:function(e){var t=this._listMainItem[e];t&&t.removeClassName("activated")},desactiveSubItem:function(e){var t=this._listItem[e];t&&t.removeClassName("activated")},toggleMainItem:function(e){var t=this._listMainItem[e];t&&(t.hasClassName("activated")?t.removeClassName("activated"):t.addClassName("activated"))},toggleSubItem:function(e){var t=this._listItem[e];t&&(t.hasClassName("activated")?t.removeClassName("activated"):t.addClassName("activated"))},activeSubItemFixed:function(e){var t=this._listItem[e];if(t){if(t.hasClassName("activated"))return;for(var n in this._listFixedItem){var i=this._listFixedItem[n];i.childNodes[0].childNodes[0].childNodes[0].hasClassName(e)?(i.addClassName("activated"),this._titleMenu.querySelector(".vcxToolbarButtonStarterMenuRight").querySelector(".vcxToolbarButton").className=e):i.removeClassName("activated")}}},addSubItem:function(t,n,a,o,s,l,c,d){var p=this.onCreateToolbarButton(t,n,a,o,l),u=new e.Element("div",{class:"vcxToolbarMenuExpandedRow"}).inject(this._titleMenuExpandable),h=this;if(u.addEventListener(i.POINTERDOWN,function(e){if("function"==typeof t)t("ScenarioViewOptions"===n?c:l);else if(""!==t){var i=null,a=h.options.controller._vcxGuiManager._experienceBase.getManager("VCXContextManager");a&&(i=a.getContext()),r.getCommand(t,i)&&(r.getCommand(t,i).begin(),e.stopImmediatePropagation(),e.stopPropagation())}},!0),d||this._listDisplayExpandedCmd.push(u),new e.Element("div",{class:"vcxToolbarMenuExpandedCellCmd"}).inject(u).appendChild(p),t&&"function"!=typeof t)new e.Element("div",{html:s[t],class:"vcxToolbarMenuExpandedCellTitle"}).inject(u);else new e.Element("div",{html:l,class:"vcxToolbarMenuExpandedCellTitle"}).inject(u);return u},addMenu:function(e,t,n,a,r,o,s){var l=this.onCreateToolbarButton(e,t,n,a,r,o);s||(s=this._titleMenu),s.appendChild(l);var c=this;l.vcxCallBack=function(){c._titleMenuExpandable.removeClassName("expanded"),document.removeEventListener(i.POINTERUP,l.vcxCallBack,!1)},l.flagPointerDown=function(e){l._pointerDown=!0},l.toggleMenu=function(e){l._pointerDown&&(l._pointerDown=!1,e.stopPropagation(),c._titleMenuExpandable.hasClassName("expanded")?document.removeEventListener(i.POINTERUP,l.vcxCallBack,!1):document.addEventListener(i.POINTERUP,l.vcxCallBack,!1),c._titleMenuExpandable.toggleClassName("expanded"))},l.addEventListener(i.POINTERDOWN,l.flagPointerDown),l.addEventListener(i.POINTERUP,l.toggleMenu)},onCreateToolbarButton:function(t,o,s,l,c,d,p,u,h){var g=new e.Element("div",{class:o,styles:{backgroundSize:"cover",display:"inline-block",verticalAlign:"top",float:"right"},html:[]}),m=!1,C=!1,v="";Array.isArray(s)?(C=!0,v=s[0].split("Checked")[0],m=s[0].search("Checked")):(v=s.split("Checked")[0],m=s.search("Checked")),m=m>0;var _=new e.Element("div",{class:v,styles:{},html:[]});if(g.commandButton=_,_.lockedWhile=!1|h,C){var f=new e.Element("span",{class:"wux-ui-fa wux-ui-fa-stack vcx-toolbar-stack"}).inject(_);e.createElement("i",{class:"wux-ui-fa wux-ui-fa-lg "+s[1]}).inject(f),e.createElement("i",{class:"wux-ui-fa wux-ui-fa-lg "+s[2]}).inject(f)}g.appendChild(_),m&&p&&(this._evtStart=n.subscribe({event:p},function(e){_.setAttribute("checked","")})),m&&u&&(this._evtEnd=n.subscribe({event:u},function(e){_.removeAttribute("checked")})),"MENU"===d||"VCXScenarioToolbarDisplayLayout"===d||(g._experienceBase=this.options.controller._vcxGuiManager._experienceBase,g.cmdId=t,g.checkedButton=m,g.pointerDownOnCommandButtonStarterCB=function(e){e.preventDefault();var t=this.commandButton,n=e.currentTarget||e.srcElement,i=!1;if(n.checkedButton)if(null!==t.getAttribute("checked")){if(t.lockedWhile)return;t.removeAttribute("checked"),i=!0}else t.setAttribute("checked","");var a=n.cmdId;if(Array.isArray(a)){var o=a[0],s=a[1],l=a[2];i||s.call(o,l)}else if(""!==a){var c=null,d=n._experienceBase.getManager("VCXContextManager");d&&(c=d.getContext()),r.getCommand(a,c)&&(i?r.getCommand(a,c).end():r.getCommand(a,c).begin())}e.stopImmediatePropagation(),e.stopPropagation()},g.addEventListener(i.POINTERUP,g.pointerDownOnCommandButtonStarterCB,!1),g.cbPointerUp=function(e){e.stopImmediatePropagation(),e.stopPropagation()},g.addEventListener(i.POINTERUP,g.cbPointerUp));var b="string"==typeof t&&""!==t?t:d&&(""===t||Array.isArray(t))?d:"";return a.onResourceLoaded({resourceFile:l},this.onResourceLoadedCBgen(b,_)),c&&(g.title=c[b]),this.listCmdCreated.push(g),g},onResourceLoadedCBgen:function(e,t){return function(){var n=this.getIcon({key:e,size:"Normal"});n&&(t.style.backgroundImage="url("+n+")")}},pointerUpOnCommandButtonStarterCB:function(e){e.preventDefault();var t=(e.currentTarget||e.srcElement).cmdId;"function"==typeof t&&(e.preventDefault(),t(),e.stopImmediatePropagation(),e.stopPropagation())}})}),define("DS/VCXWebGUI/VCXFrameBoxing",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebKernelTools/VCXMathTools","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return e.extend({init:function(){},GetPropertiesForGUI:function(e,t,a){var r,c,d=(t.GetPropertyName()||"Actor.PropertyFrame")+"_",p={hiddenFields:[],propertyPosition:null,propertyOrientation:null,propertyScale:null,propertyPivot:null};e instanceof s?(r=e.GetFrame().GetValue(),c=e.GetPivot().GetValue()):r=e.GetValue();var u=r.decompose(),h=u[0],g=u[1],m=u[2],C=new i(d+"Position",null,!1,t.Geti18n()),v=new o(h);p.propertyPosition=new n(C,v),a&&a.includes("Position")&&p.hiddenFields.push("propertyPosition");var _=new i(d+"Orientation",null,!1,t.Geti18n()),f=new o(l.getEulerFromQuaternion(g).multiplyScalar(180/Math.PI));p.propertyOrientation=new n(_,f),a&&a.includes("Orientation")&&p.hiddenFields.push("propertyOrientation");var b=new i(d+"Scale",null,!1,t.Geti18n()),y=new o(m);if(p.propertyScale=new n(b,y),a&&a.includes("Scale")&&p.hiddenFields.push("propertyScale"),c){var x=c.decompose()[0],P=new i(d+"Pivot",null,!1,t.Geti18n()),S=new o(x);p.propertyPivot=new n(P,S),a&&a.includes("Pivot")&&p.hiddenFields.push("propertyPivot")}return p},UpdateMapForGUI:function(e,n){for(var i=n.propName,a=n.value,r=["Scale","Pivot","ColumnX","ColumnY","ColumnZ","Orientation","Position"],s="",l=0;l<r.length;++l){var c=r[l];if(i.includes(c)){s="property"+c;break}}if(s){var d=e[s];return d&&(d.GetPropertyValue()instanceof o&&Array.isArray(a)&&("propertyScale"===s&&(a=a.map(function(e){return e<.01?.01:e})),a=new t.Vector3(a[0],a[1],a[2])),d.GetPropertyValue().SetValue(a)),e}console.warn("VCXFrameBoxing#UpdateMapForGUI: Couldn't find the property to replace with the new value..")},BuildNewValueFromGUI:function(e){var n=null,i=null,a=new t.Matrix4,o=e.propertyOrientation.GetPropertyValue().GetValue(),c={x:o.x*Math.PI/180,y:o.y*Math.PI/180,z:o.z*Math.PI/180,order:"XYZ"};if(e.propertyPivot){n=new s;var d=e.propertyPivot.GetPropertyValue().GetValue();i=(new t.Matrix4).setPosition(d),n.SetPivot(new r(i))}else n=new r;a=new t.Matrix4;var p=l.getQuaternionFromEuler(c),u=e.propertyPosition.GetPropertyValue().GetValue(),h=e.propertyScale.GetPropertyValue().GetValue();return a.compose(u,p,h),i?n.SetFrame(new r(a)):n.SetValue(a),n.ToString()},getPropertiesNamesNLS:function(e){var t={};return t[e+"_Position"]=c.get("FrameBoxing_Position"),t[e+"_Orientation"]=c.get("FrameBoxing_Orientation"),t[e+"_Scale"]=c.get("FrameBoxing_Scale"),t[e+"_Pivot"]=c.get("FrameBoxing_Pivot"),t}})}),define("DS/VCXWebGUI/VCXGettingStartedUI",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/Core/PointerEvents","DS/CoreEvents/Events","DS/UIKIT/Mask","DS/UIKIT/SuperModal","DS/VCXWebKernelTools/VCXLogServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s){"use strict";return e.singleton({init:function(){this._experienceName=null,this._collabSpace=null},initialize:function(e){this.home=UWA.Element("div",{html:"",class:"vcx-Curtain-Home"}),this.localMode=e.localMode,this.createDropZone()},unInitialize:function(){this.dropZone.remove(),this.dropZone=null,this.dndObjectOverlay.remove(),this.dndObjectOverlay=null,this.dndForbiddenOverlay.remove(),this.dndForbiddenOverlay=null,this.home.remove(),this.home=null},IsTstProvider:function(){return this.tstProvider},setParentNode:function(e){this.parentNode=e},createDropZone:function(){t.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_G_NXGDragAndDrop.png");this.dropZone=UWA.Element("div",{html:"",class:"vcx-DropZone-Main"}),this.dndObjectOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay"}),this.dndObjectOverlay.inject(this.dropZone),new UWA.Element("div",{id:"xphoto-image-dnd-icon",class:"fonticon fonticon-5x fonticon-drag-drop"}).inject(this.dndObjectOverlay),this.dndObjectOverlay.hide(),this.dndForbiddenOverlay=new UWA.Element("div",{id:"xphoto-full-page-dnd-overlay",html:[{tag:"span",class:"wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-wrong xphoto-image-dnd-icon",styles:{color:"#b4b6ba"}}]}),this.dndForbiddenOverlay.inject(this.dropZone),this.dndForbiddenOverlay.hide()},startLoadingPage:function(e){this.initWidget=UWA.Element("div",{html:"Initializing ...",class:"vcx-Curtain-InitWidget"}).inject(this.parentNode),UWA.Element("div",{html:"",class:"vcx-Curtain-InitWidget-BrandImage",styles:{backgroundImage:e}}).inject(this.initWidget)},clearInitWidget:function(){var e=document.getElementsByClassName("vcx-Curtain")[0];e&&e.destroy()},startLoadingExperience:function(){},failLoadingExperience:function(){this.removeCurtainFade()},endLoadingExperience:function(){this.dropZoneOFF(),this.home.hide(),this.removeCurtainFade()},startExperiencePage:function(e,i,a,r,o,l,c){this.backgroundImage=a;this.home.inject(this.parentNode),this.dropZone.inject(this.parentNode),c&&this.home.addClassName("vcx-Curtain-MixedLayer"),this.experiencePage=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-container"}).inject(this.home);var d=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Title-Header"}).inject(this.experiencePage);UWA.Element("div",{html:e,class:"vcx-Curtain-Experience-Title"}).inject(d);var p=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Row"}).inject(this.experiencePage),u=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(o?"":" vcxFreezed")}).inject(p),h=this;o&&u.addEvent(n.POINTERUP,function(e){h._experienceBase.getManager("VCXPlatformServicesManager")&&h._experienceBase.getManager("VCXPlatformServicesManager").onCreateEmptyExperience()});var g=UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(o?"":" vcxFreezed"),src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+i)}).inject(u);l||(g.style.boxShadow="unset");var m=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(u),C=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(m);UWA.Element("span",{html:r,class:"vcx-Curtain-Experience-Text2"}).inject(C);m=UWA.Element("div",{html:"",class:"vcx-Curtain-Footer"+(o?"":" vcxAnimate")}).inject(this.experiencePage);l||m.hide();var v=UWA.Element("div",{html:"",class:"vcx-Curtain-Footer-row"}).inject(m);UWA.Element("img",{html:"",src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_draganddrophp.png"),class:"vcx-Curtain-Footer-Image"}).inject(v),UWA.Element("span",{html:(o?s["VCXGettingStartedUI.OrDropContentMessageBegin"]:s["VCXGettingStartedUI.DropContentMessageBegin"])+s["VCXGettingStartedUI.DropContentMessageEnd"],class:"vcx-Curtain-Footer-Text"}).inject(v)},setExperienceBase:function(e){this._experienceBase=e},getHomeNode:function(){return this.home},dropZoneON:function(){0===document.getElementsByClassName("vcx-DropZone-Main").length&&(this.parentNode?this.dropZone?this.dropZone.inject(this.parentNode):console.error("/! A DOM parent element is assignated to display dropzone but Dropzone element isn't created."):this.dropZone?console.error("/! The dropzone is created but not assigned to a DOM parent."):console.error("/! No visual dropzone element is created.")),this.dropZone.addClassName("vcx-DropZone-Display"),this.dndObjectOverlay.show();for(var e=document.getElementsByClassName("vcx-Curtain-Experience-Tile"),t=0;t<e.length;t++)e[t].style.pointerEvents="none"},dropZoneOFF:function(){for(var e=document.getElementsByClassName("vcx-Curtain-Experience-Tile"),t=0;t<e.length;t++)e[t].style.pointerEvents="";this.dropZone.removeClassName("vcx-DropZone-Display"),this.dndObjectOverlay.hide()},addTile:function(e,i,a,r,o){var s=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Tile"+(r?"":" vcxFreezed")}).inject(e);r&&s.addEvent(n.POINTERUP,function(e){o()}),UWA.Element("img",{html:"",class:"vcx-Curtain-Experience-Image"+(r?"":" vcxFreezed"),src:t.getWebappsAssetUrl("VCXWebGUI","texture/gui/"+a)}).inject(s).style.animation="unset";var l=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Footer"}).inject(s),c=UWA.Element("div",{html:"",class:"vcx-Curtain-Experience-Text"}).inject(l);UWA.Element("span",{html:i,class:"vcx-Curtain-Experience-Text2"}).inject(c)},curtainFade:function(){this.experiencePage&&this.experiencePage.addClassName("vcx-Curtain-Fade")},removeCurtainFade:function(){this.experiencePage&&this.experiencePage.removeClassName("vcx-Curtain-Fade")}})}),define("DS/VCXWebGUI/VCXTreeViewCellAbstract",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/CoreEvents/Events"],function(e,t,n){"use strict";function i(e){var t=e.currentTarget||e.srcElement,n=t.currentStyle||window.getComputedStyle(t,null),i=parseInt(n.borderLeftWidth,10),a=parseInt(n.borderTopWidth,10),r=t.getBoundingClientRect();return{offsetX:e.clientX-i-r.left,offsetY:e.clientY-a-r.top}}return e.extend({init:function(e){this._parent(e),(this._manager.options.resize.rows||this._manager.options.resize.columns)&&this._manageResize()},updateInternalParameters:function(){this._parent();var e=this.getCellInfos();if(e){var t=e.nodeModel,n=t.getNextNode();"collapsed"===t.getState()||n&&"noChildren"!==n.getState()?this.getContent().addClassName("wux-controls-propertylistview-expander"):this.getContent().removeClassName("wux-controls-propertylistview-expander"),t.options.children&&0==t.options.children.length?this.getContent().addClassName("vcx-controls-propertylistview-expander-hide"):this.getContent().removeClassName("vcx-controls-propertylistview-expander-hide")}},destroy:function(){document.removeEventListener(t.POINTERMOVE,this._pointerMoveOnDocumentCB),document.removeEventListener(t.POINTERUP,this._pointerUpOnDocumentCB),this._pointerMoveOnDocumentCB=null,this._pointerUpOnDocumentCB=null,this._isPressed=!1,this.wantToResize=!1,this._pointerMoved=!1,this._deltaMouseInit={},this._parent()},_manageResize:function(){var e=this;e.getGridEngine()._enableInteractiveSort();var n,a,r,o,s=5,l=this.elements.container;this.wantToResize=!1,l.addEvent(t.POINTERMOVE,function(t){if(!e._isPressed){var l=e.getCellInfos();n=l,a=l.manager,o=a.getColumnWidth(n.virtualColumnID),r=a.getRowHeight(n.virtualRowID);var c=i(t);a.options.resize.columns&&(c.offsetX<o+s&&c.offsetX>o-s?(e._setResizeStyle("r"),e.wantToResize=!0):(e._setResizeStyle(),e.wantToResize=!1)),a.options.resize.rows&&(c.offsetY<r+s&&c.offsetY>r-s?(e._setResizeStyle("b"),e.wantToResize=!0):(e._setResizeStyle(),e.wantToResize=!1))}}),this._pointerMoved=!1,this._isPressed=!1,this._deltaMouseInit={},this._newWidth,this._newHeight;UWA.extendElement(document);this.minWidth=0,this.maxWidth=1/0,l.addEvent(t.POINTERDOWN,function(t){t&&t.originalEvent&&"touchstart"===t.originalEvent.type&&(e.wantToResize=!0,s=32,n=e.getCellInfos(),a=e.getGridEngine(),o=a.getColumnWidth(n.virtualColumnID),r=a.getRowHeight(n.virtualRowID));var l=i(t);if(e.wantToResize&&(l.offsetY<r+s&&l.offsetY>r-s||l.offsetX<o+s&&l.offsetX>o-s)){t.preventDefault(),a.getScroller().getContent().addClassName("wux-ui-locked"),a.lockUI(),e._deltaMouseInit={x:t.clientX,y:t.clientY},e._newWidth=o,e._newHeight=r,e._isPressed=!0;var c=e.getGridEngine()._getColumnOptionValue(n.virtualColumnID,"maxWidth");e.maxWidth=void 0!==c?c:1/0,e.minWidth=e.getGridEngine()._getColumnOptionValue(n.virtualColumnID,"minWidth"),e.getGridEngine()._disableInteractiveSort(!0)}}),this._pointerMoveOnDocumentCB=this._pointerMoveOnDocument.bind(this),document.addEventListener(t.POINTERMOVE,this._pointerMoveOnDocumentCB),this._pointerUpOnDocumentCB=this._pointerUpOnDocument.bind(this),document.addEventListener(t.POINTERUP,this._pointerUpOnDocumentCB)},_pointerMoveOnDocument:function(e){if(this._isPressed&&this.wantToResize){var t=this.getGridEngine(),n=this.getCellInfos(),i=t.getColumnWidth(n.virtualColumnID);this._pointerMoved||this.getGridEngine()._disableInteractiveSort(),this._pointerMoved=!0;var a={};a.x=e.clientX-this._deltaMouseInit.x,a.y=e.clientY-this._deltaMouseInit.y,i+a.x>=this.minWidth&&i+a.x<=this.maxWidth&&(this._newWidth=i+a.x,this._manager._updateViewOptions={detachAllViews:!1,updateCells:!1,updateColumnsHeaders:!0},t._instance._showColumnInsertionMark(t.getScroller().getPosition().x+t.getHeadersDimensions().width+t.getColumnPosition(n.virtualColumnID)+this._newWidth))}},_pointerUpOnDocument:function(e){if(this._isPressed){e.preventDefault(),e.stopPropagation(),this._setResizeStyle(),this.elements.container&&this.elements.container.removeClassName("wux-ui-state-active");var t=this;setTimeout(function(){t.getGridEngine()._enableInteractiveSort()},300);var n=this.getGridEngine(),i=this.getCellInfos();-1!==i.virtualRowID&&n.setRowHeight(i.virtualRowID,this._newHeight),-1!==i.virtualColumnID&&(n.prepareUpdateView(),n.setColumnWidth(i.virtualColumnID,this._newWidth),n._requireFullUpdate(),this._manager._updateViewOptions={detachAllViews:!0,updateCells:!0,updateColumnsHeaders:!0},n.pushUpdateView(!0)),n._instance._hideRowInsertionMark(),n._instance._hideColumnInsertionMark(),n.unlockUI(),this._isPressed=!1,this.wantToResize=!1}}})}),define("DS/VCXWebGUI/VCXHyperlinkBoxing",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueHyperlinkId","DS/WebRBTree/WebRBIterator","DS/VCXWebModifiables/VCXEnumTools","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d){"use strict";var p=e.extend({initialize:function(e){this._experienceBase=e},unInitialize:function(e){this._experienceBase=null},HyperlinkPropertyToString:function(e){var t="";if(e){var n=this._experienceBase.getManager("VCXDocManager").GetPropPath(e.GetValue());if(n){var i=n.GetFileName().GetValue();if(i)return i;t=n.GetValueURL().GetValue()}}return t},FillMapChoiceScenarios:function(e,t){var n=null,i=Object.keys(e).length,a=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var r in a)if(a.hasOwnProperty(r)){var o=a[r].GetName();e[i]=o,r===t&&(n=i),i++}return n},FillMapChoiceMarkers:function(e,t){var n=null,i=Object.keys(e).length,a=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var r in a)if(a.hasOwnProperty(r)){var o=a[r].GetTrackMarkers();if(o){i=0;for(var s=o._treekeys,c=new l(s),d=c.next();null!==d;){var p=d.GetValue(),u=this._experienceBase.ComponentsMap.GetComponentFromID(p).GetName();e[i]=u,p===t&&(n=i),i++,d=c.next()}}}return n},GetPropertiesForGUI:function(e,s){var l={propertyAction:null,propertyType:null,propertyHyperlink:null},c=new n("Actor.Hyperlink_Action",null,!1,s.Geti18n()),u=new o;u.SetValue(!1),l.propertyAction=new t(c,u);var h=new a;h.SetValue(1);var g=new i("Actor.Hyperlink_Type",null,!1,s.Geti18n()),m={};m[p.EHyperlinkChoices.None]="__DONOTTRANSLATE__"+d.get("VCXHyperlinkBoxing.ChoiceToSelect.None"),m[p.EHyperlinkChoices.WebAdress]="__DONOTTRANSLATE__"+d.get("VCXHyperlinkBoxing.ChoiceToSelect.WebAdress"),m[p.EHyperlinkChoices.GoToScene]="__DONOTTRANSLATE__"+d.get("VCXHyperlinkBoxing.ChoiceToSelect.GoToScene"),m[p.EHyperlinkChoices.PlayScene]="__DONOTTRANSLATE__"+d.get("VCXHyperlinkBoxing.ChoiceToSelect.PlayScene"),(this._experienceBase.getManager("VCXContextManager").getOpenSMG()||this._experienceBase.getManager("VCXContextManager").getOpenSMGXML())&&(m[p.EHyperlinkChoices.GoToMarker]="__DONOTTRANSLATE__"+d.get("VCXHyperlinkBoxing.ChoiceToSelect.GoToMarker"),m[p.EHyperlinkChoices.PlayMarkerSequence]="__DONOTTRANSLATE__"+d.get("VCXHyperlinkBoxing.ChoiceToSelect.PlayMarkerSequence")),g.SetMapChoiceEnum(m),l.propertyType=new t(g,h);var C=new i("Actor.Hyperlink_Hyperlink",null,!1,s.Geti18n());(_=new r).SetValue("http://www.3ds.com"),l.propertyHyperlink=new t(C,_);var v=null;if(e&&(v=this._experienceBase.getManager("VCXDocManager").GetPropPath(e.GetValue())),!v)return h.SetValue(0),C.SetVisible(!1),l;var _,f="",b=-1,y=v.GetPathType().GetValue();0===y&&((f=this.HyperlinkPropertyToString(e)).indexOf("scenario://")>=0?(y=1,f=f.slice(11)):(f.indexOf("http")>=0||f.indexOf("ftp")>=0?b=p.EHyperlinkChoices.WebAdress:h.SetValue(0),(_=new r).SetValue(f),l.propertyHyperlink.SetPropertyValue(_)));var x=!1,P={},S=new a,V=v.GetValueLink().GetValue();if(1===y){b=p.EHyperlinkChoices.GoToScene;for(var M=["Previous","Next","First","Last"],w=!1,I=0;I<M.length;I++){var T=M[I]+" scenario";P[I.toString()]=T,f===M[I].toLowerCase()&&(S.SetValue(I),w=!0)}var D=this.FillMapChoiceScenarios(P,V);w||null!==D&&S.SetValue(D),x=!0}else if(2===y){b=p.EHyperlinkChoices.PlayScene;var E=this.FillMapChoiceMarkers(P,V),G=this.FillMapChoiceScenarios(P,V);null!==E?S.SetValue(E):null!==G&&S.SetValue(G),x=!0}else if(3===y){b=p.EHyperlinkChoices.GoToMarker,null!==(D=this.FillMapChoiceMarkers(P,V))&&S.SetValue(D),x=!0}else if(4===y){b=p.EHyperlinkChoices.PlayMarkerSequence;E=this.FillMapChoiceMarkers(P,V),G=this.FillMapChoiceScenarios(P,V);null!==E?S.SetValue(E):null!==G&&S.SetValue(G),x=!0}if(x){for(var X in m){var k=parseInt(X);m.hasOwnProperty(k)&&b===k&&h.SetValue(k)}C.SetMapChoiceEnum(P),l.propertyHyperlink.SetPropertyValue(S)}return u.SetValue(!0),l},UpdateMapForGUI:function(e,t){var n=t.propName,i=t.std,o=p.EHyperlinkChoices.None;if("Actor.Hyperlink_Action"===n)e.propertyAction.GetPropertyValue().SetValue(i),e.propertyHyperlink.GetPropertyInfo().SetVisible(i),e.propertyType.GetPropertyInfo().SetVisible(i);else if("Actor.Hyperlink_Type"===n){var s=e.propertyType,l=s.GetPropertyInfo().GetMapChoiceEnum();for(var c in l){var d=parseInt(c);if(l.hasOwnProperty(d))if(i===l[c].replace("__DONOTTRANSLATE__","")){o=d,s.GetPropertyValue().SetValue(o);var u=Boolean(o);e.propertyAction.GetPropertyValue().SetValue(u),e.propertyHyperlink.GetPropertyInfo().SetVisible(u);break}}var h=null;if(o===p.EHyperlinkChoices.WebAdress)h=new r("http://www.3ds.com");else{var g=e.propertyHyperlink.GetPropertyInfo(),m={};switch(o){case p.EHyperlinkChoices.GoToScene:for(var C=["Previous","Next","First","Last"],v=0;v<C.length;v++){var _=C[v]+" scenario";m[v.toString()]=_}this.FillMapChoiceScenarios(m);break;case p.EHyperlinkChoices.PlayScene:this.FillMapChoiceScenarios(m),this.FillMapChoiceMarkers(m);break;case p.EHyperlinkChoices.GoToMarker:this.FillMapChoiceMarkers(m);break;case p.EHyperlinkChoices.PlayMarkerSequence:this.FillMapChoiceMarkers(m),this.FillMapChoiceScenarios(m)}g.SetMapChoiceEnum(m);h=new a(0)}e.propertyHyperlink.SetPropertyValue(h)}else if("Actor.Hyperlink_Hyperlink"===n){var f=e.propertyHyperlink;if("VCXPropertyValueString"===t.internalOptions.dataType)f.GetPropertyValue().SetValue(i);else if("VCXPropertyValueEnum"===t.internalOptions.dataType){var b=f.GetPropertyInfo().GetMapChoiceEnum();for(var c in b){if(b.hasOwnProperty(c))if(i===b[c]){f.GetPropertyValue().SetValue(parseInt(c));break}}}}return e},BuildPropPathFromScenario:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var i in n){if(n.hasOwnProperty(i))if(n[i].QueryInterface("VCXIModifiable").GetProperty("Actor.Name").GetPropertyValue().GetValue()===e)return this._experienceBase.getManager("VCXDocManager").BuildPathFromLink(i,t)}},BuildPropPathFromMarker:function(e,t){var n=this._experienceBase.getManager("VCXScenarioManager").GetScenariosFromType(0);for(var i in n)if(n.hasOwnProperty(i)){var a=n[i].GetTrackMarkers();if(a)for(var r=a._treekeys,o=new l(r),s=o.next();null!==s;){var c=s.GetValue();if(this._experienceBase.ComponentsMap.GetComponentFromID(c).GetName()===e)return this._experienceBase.getManager("VCXDocManager").BuildPathFromLink(c,t);s=o.next()}}},BuildNewValueFromGUI:function(e){var t=new s;if(e.propertyAction.GetPropertyValue().GetValue()){var n=null,i=e.propertyHyperlink,a=e.propertyType.GetPropertyValue().GetValue();if(a===p.EHyperlinkChoices.OpenDocument);else if(a===p.EHyperlinkChoices.WebAdress)n=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(i.GetPropertyValue().GetValue());else{var r=i.GetPropertyInfo().GetMapChoiceEnum()[i.GetPropertyValue().GetValue()];switch(a){case p.EHyperlinkChoices.GoToScene:if(!(n=this.BuildPropPathFromScenario(r))){var o="scenario://"+r.split(" ")[0].toLowerCase();n=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(o)}break;case p.EHyperlinkChoices.PlayScene:var l=2;(n=this.BuildPropPathFromScenario(r,l))||(n=this.BuildPropPathFromMarker(r,l));break;case p.EHyperlinkChoices.GoToMarker:l=3;n=this.BuildPropPathFromMarker(r,l);break;case p.EHyperlinkChoices.PlayMarkerSequence:l=4;(n=this.BuildPropPathFromMarker(r,l))||(n=this.BuildPropPathFromScenario(r,l))}}n&&(t=this._experienceBase.getManager("VCXDocManager").AddOrModifyHyperlink(n))}else t.SetValue(-1);return t},getPropertiesNamesNLS:function(e){var t={};return t[e+"_Action"]=d.get("HyperlinkBoxing_Action"),t[e+"_Type"]=d.get("HyperlinkBoxing_Type"),t[e+"_Hyperlink"]=d.get("HyperlinkBoxing_Hyperlink"),t}});return p.EHyperlinkChoices={None:0,WebAdress:1,GoToScene:2,PlayScene:3,GoToMarker:5,PlayMarkerSequence:6},p}),function(){"use strict";if("function"==typeof window.Event)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.Event=e}(),define("DS/VCXWebGUI/VCXGUIManager",["UWA/Class","DS/CoreEvents/Events","DS/CoreEvents/ModelEvents","DS/Core/PointerEvents","DS/Controls/Tooltip","DS/Controls/TooltipModel","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXScenarioCtrlExt","DS/VCXWebGUI/VCXPaperCtrl","DS/VCXWebGUI/VCXPaperCtrlV2","DS/VCXWebGUI/VCXPropertiesCtrlExt","DS/VCXWebGUI/VCXUndoRedoCtrl","DS/VCXWebGUI/VCXDocManagerCtrl","DS/VCXWebGUI/VCXLinkedPropCtrl","DS/VCXWebGUI/VCXStatsCtrl","DS/VCXWebGUI/VCXTabPageFrame","DS/VCXWebTreeGUI/VCXWebTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebDressupTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebStylesTabFrameCtrl","DS/VCXWebTreeGUI/VCXWebAssemblyTreeCtrl","DS/VCXWebTreeGUI/VCXWebSelectionSetsTreeCtrl","DS/VCXWebTreeGUI/VCXWebHotspotsTreeCtrl","DS/VCXWebTreeGUI/VCXWebDressupTreeCtrl","DS/VCXWebTreeGUI/VCXWebStylesTreeCtrl","DS/Windows/WindowManager","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Loader","DS/Controls/ModalContainer","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXTimelineController","DS/VCXWebGUI/VCXGUIServices","DS/VCXWebGUI/VCXGettingStartedUI","DS/VCXWebKernelTools/VCXLogServices","DS/VCXWebModifiablesServices/VCXModifiablesAccess","DS/VCXWebGUI/VCXLandingPage","DS/VCXWebGUI/VCXUpdateView","DS/VCXWebGUI/VCXMediaChooserServices","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c,d,p,u,h,g,m,C,v,_,f,b,y,x,P,S,V,M,w,I,T,D,E,G,X,k,A,B,N,U,F){"use strict";var W=e.extend({GetSelectedProperties:function(){if(this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.GetSelectedProperties)return this._vcxPropertiesCtrl.GetSelectedProperties()},CopyProperties:function(e,t){this._copyProperties=e,this._copyModifiables=t},GetCopiedProperties:function(){var e={};return e.properties=this._copyProperties,e.arrayMod=this._copyModifiables,e},getUsableArea:function(e){if(!this._experienceBase.getManager("VCXContextManager").isSupported("Paper"))return this.GetCanvasView();var t="wux-windows-docking-element-free-zone wux-docking-element-bottom";return"boolean"==typeof e&&e&&(t="wux-controls-abstract wux-windows-immersive-frame"),document.getElementsByClassName(t)[0]},postUpdate:function(e){this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unstackSelect(),this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unstackSelect(),this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unstackSelect(),this._vcxWebDressupTreeCtrl&&this._vcxWebDressupTreeCtrl.unstackSelect(),this._vcxWebStylesTreeCtrl&&this._vcxWebStylesTreeCtrl.unstackSelect()},_getOptiUsableArea:function(e){var t=document.getElementsByClassName("wux-controls-abstract wux-windows-immersive-frame")[0],n=t&&t.getBoundingClientRect();if(e&&n){var i={},a=e.getBoundingClientRect();i.left=a.left-n.left,i.top=a.top-n.top,i.right=n.right-a.right,i.bottom=a.bottom,i.width=a.width,i.height=a.height;return i.left+=5,i.top+=5,i.right-=5,i.width-=10,i.bottom-=5,i.height-=10,i}},updateUsableArea:function(){this._experienceBase.getManager("VCXContextManager").isSupported("Paper");var e=this._getOptiUsableArea(this.getUsableArea()),n=this._getOptiUsableArea(this.getUsableArea(!0));e&&n&&(this._vcxPaperCtrl&&this._vcxPaperCtrl.updatePaperArea(e),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.updatePaperArea(e,n),this._experienceBase.getManager("VCXContextManager").getUrlVars().optimViewportPaper&&(this.GetCanvasView().style.position="absolute",this.GetCanvasView().style.left=e.left+"px",this.GetCanvasView().style.right=e.right+"px",this.GetCanvasView().style.top=e.top+"px",this.GetCanvasView().style.bottom=e.bottom+"px"),t.publish({event:"VCX_GUI_USABLEAREA_UPDATE",data:{area:e,areaWithoutPanels:n}}))},getUIResponsivenessParameters:function(e){var t=this._getUIResponsivenessParametersArray();if(!t)return null;for(var n=0;n<t.length;++n){var i=t[n];if(e<=i.viewportMax&&e>i.viewportMin)return i}},_getUIResponsivenessParametersArray:function(){return[{viewportMin:0,viewportMax:880,panelMinWidth:250,hidePanels:!0,fitBetweenPanels:!1},{viewportMin:880,viewportMax:1080,panelMinWidth:250,hidePanels:!1,fitBetweenPanels:!1},{viewportMin:1080,viewportMax:1/0,panelMinWidth:300,hidePanels:!1,fitBetweenPanels:!0}]},updateDockingElements:function(){if(this.immersiveFrame){var e=[],t=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea);t&&e.push(t);var n=this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea);n&&e.push(n);for(var i=this._getUIResponsivenessParametersArray(),a=document.body.clientWidth,r=null,o=null,s=!1,l=null,c=null,d=!this._previousViewportWidth,p=!!this._previousViewportWidth,u=0;u<i.length;++u){var h=!1,g=i[u];if(!s&&a<=g.viewportMax&&a>g.viewportMin&&(r=g.panelMinWidth,o=g.hidePanels,s=!0,h=!0),!d&&this._previousViewportWidth&&this._previousViewportWidth<=g.viewportMax&&this._previousViewportWidth>g.viewportMin&&(l=g.panelMinWidth,c=g.hidePanels,d=!0,h||(p=!1)),s&&d)break}if(s&&d){if(!p)for(var m=0;m<e.length;++m){var C=e[m];if(l<r)C.minSize=r,C.dockingZoneSize<C.minSize&&(C.dockingZoneSize=C.minSize);else if(l>r){var v=C.dockingZoneSize===C.minSize;C.minSize=r,v&&(C.dockingZoneSize=C.minSize)}c!==o&&C.collapseDockingZoneFlag!==o&&(C.collapseDockingZoneFlag=o)}var _=this._experienceBase.getManager("VCXContextManager");_.isSupported("PropAndScnPanelExpandOverride")&&(_.isSupported("ScenarioPanelExpand")?e[1].collapseDockingZoneFlag=!1:e[1].collapseDockingZoneFlag=!0,_.isSupported("PropertiesPanelExpand")?e[0].collapseDockingZoneFlag=!1:e[0].collapseDockingZoneFlag=!0),this._previousViewportWidth=a}else console.warn("Something went wrong: we didn't get all infos")}},unInitialize:function(){N.unInit(),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXGUIManager.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUISequence.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXWebSignature.css"),this._experienceBase.getManager("VCXContextManager").unloadCssFile("VCXWebGUI/VCXUIPaper.css",1);var e=this._experienceBase.getManager("VCXContextManager").getActionBar();if(this._ACTIONBAR_OPEN_timeout&&(clearTimeout(this._ACTIONBAR_OPEN_timeout),this._ACTIONBAR_OPEN_timeout=null),this._ACTIONBAR_CLOSE_timeout&&(clearTimeout(this._ACTIONBAR_CLOSE_timeout),this._ACTIONBAR_CLOSE_timeout=null),e&&e._modelEvents.unsubscribe(this._ACTIONBAR_OPEN),e&&e._modelEvents.unsubscribe(this._ACTIONBAR_CLOSE),this._ACTIONBAR_OPEN=0,this._ACTIONBAR_CLOSE=0,this._frmWindow){var n=this._frmWindow._sceneGraphTree.tree._sidePanel;this._VCX_GUI_PANEL_SLIDE_IN&&n&&n._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_IN),this._VCX_GUI_PANEL_SLIDE_OUT&&n&&n._modelEvents.unsubscribe(this._VCX_GUI_PANEL_SLIDE_OUT)}for(var a in this._VCX_GUI_PANEL_SLIDE_IN=0,this._VCX_GUI_PANEL_SLIDE_OUT=0,this._tokens)this._tokens.hasOwnProperty(a)&&t.unsubscribe(this._tokens[a]);if(window.detachEvent?(window.detachEvent("dimensionsChanged",this._onResizeDocking),window.detachEvent("dockIsResizing",this._onResizeDocking),window.detachEvent("dockResize",this._onResizeDocking),window.detachEvent("onresize",this._onResizeWidget)):window.removeEventListener&&(window.removeEventListener("dimensionsChanged",this._onResizeDocking,!0),window.removeEventListener("dockIsResizing",this._onResizeDocking,!0),window.removeEventListener("dockResize",this._onResizeDocking,!0),window.removeEventListener("resize",this._onResizeWidget,!0)),this.immersiveFrame)for(var r=this.immersiveFrame.dockingElements,o=0;o<r.length;o++){r[o].removeEventListener(i.POINTERUP,this._updateDockingAreaCB)}this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._isIE11=null,this._init=0,this._destroyed=0,this._vcxGettingStartedUI&&(this._vcxGettingStartedUI.unInitialize(),this._vcxGettingStartedUI=null),this._vcxScenarioCtrl&&(this._vcxScenarioCtrl.unInitialize(),this._vcxScenarioCtrl=null),this.unInitTreesTabFrames(),this._vcxPaperCtrl&&(this._vcxPaperCtrl.unInitialize(),this._vcxPaperCtrl=null),this._vcxPaperCtrlV2&&(this._vcxPaperCtrlV2.unInitialize(),this._vcxPaperCtrlV2=null),this._vcxPropertiesCtrl&&(this._vcxPropertiesCtrl.unInitialize(),this._vcxPropertiesCtrl=null),this._vcxTimelineCtrl&&(this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null),this._forceDisplayTimeline=null,p.removeDiv(),this._vcxDocManagerCtrl&&this._vcxDocManagerCtrl._mainPanel&&this._vcxDocManagerCtrl._mainPanel.parentNode&&(this._vcxDocManagerCtrl._mainPanel.parentNode.removeChild(this._vcxDocManagerCtrl._mainPanel),this._vcxDocManagerCtrl.unInitialize(),this._vcxDocManagerCtrl=null),this._vcxLinkedPropCtrl&&this._vcxLinkedPropCtrl._mainPanel&&this._vcxLinkedPropCtrl._mainPanel.parentNode&&(this._vcxLinkedPropCtrl._mainPanel.parentNode.removeChild(this._vcxLinkedPropCtrl._mainPanel),this._vcxLinkedPropCtrl.unInitialize(),this._vcxLinkedPropCtrl=null),this._vcxSampleCtrl&&(this._vcxSampleCtrl.unInitialize(),this._vcxSampleCtrl=null),this._usableArea&&this._usableArea.parentNode&&this._usableArea.parentNode.removeChild(this._usableArea),this._usableArea=null,this._modelEvent.publish({event:"unInitialize",data:{}}),removeEventListener("keydown",this._onKeydownEvent);var s=document.querySelectorAll(".wux-controls-abstract.wux-windows-window.wux-windows-windowgroup");for(o=0;o<s.length;o++)s[o].remove();this.landingPage&&(this.landingPage.close(),this.landingPage=null),this._touchMultiSelectionDiv&&(this._touchMultiSelectionDiv.remove(),this._touchMultiSelectionDiv=null)},initialize:function(){var e=this._experienceBase.getManager("VCXContextManager"),t=e.getPlayerMode(),i=!!e.getExperienceIn3DPlay(),a=e.getCityMode(),r=e.getProdHighMode();this._modelEvent=new n,this._forceDisplayTimeline=!1,e.loadCssFile("VCXWebGUI/VCXGUIManager.css",1),e.loadCssFile("VCXWebGUI/VCXUISequence.css",1),e.loadCssFile("VCXWebTreeGUI/VCXWebTreeGUI.css",1),e.loadCssFile("VCXWebGUI/VCXUIPaper.css",1),e.loadCssFile("VCXWebGUI/VCXPropertyPanel.css",1);var s="",l="",c="",d=!a;a&&e.getUrlVars().debug&&(d=!0);var p=!0,u=!1,h=e.IsLocalMode();if(r&&!h){var g=this;this.landingPage=new B({widgetId:widget.id,parent:document.querySelector(".wux-afr-framewindow"),experienceBase:g._experienceBase}),this._vcxGettingStartedUI=this.landingPage._vcxGettingStartedUI}else window.loading3DXML||(this._vcxGettingStartedUI=this.getGettingStartedUI(),this._vcxGettingStartedUI&&(this._vcxGettingStartedUI.initialize({localMode:h}),this._vcxGettingStartedUI.setExperienceBase(this._experienceBase),"undefined"!=typeof widget&&widget.body?this._vcxGettingStartedUI.setParentNode(widget.body):document.body?this._vcxGettingStartedUI.setParentNode(document.body):console.error("The widget and the document bodies are undefined.")));c=F["VCXGettingStartedUI.CreateExperience"],l=F["VCXGettingStartedUI.WelcomeMessageAuthoring"],t&&i?(s="url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_In3DPlay.png")+")",l="",c="",d=!1,p=!1):t?(l=F["VCXGettingStartedUI.WelcomeMessagePlay"],s="url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Player_BackgroundLogo_CATIA.png")+")",d=!1,c="Open an smg",u=!0):r?h&&(u=!0):s=a?"url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_City_BackgroundLogo_GEOVIA.png")+")":"url("+o.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_BackgroundLogo_3DEXCITE_XPC.png")+")",this._firstLoad=!0,this._publishAdvancedDisplay=!1,this._vcxSampleCtrl=null,this._isPlayingGoTo=0,this._isAnimationLoop=!1,this._isCameraPlayMode=!1,this._vcxScenarioCtrl=null,this._vcxWebAssemblyTreeCtrl=null,this._vcxWebDressupTreeCtrl=null,this._vcxWebStylesTreeCtrl=null,this._vcxPublishRasterImageCtrl=null,this._vcxPublishVideoCtrl=null,this._vcxPaperCtrl=null,this._vcxPaperCtrlV2=null,this._vcxPropertiesCtrl=null,this._vcxDocManagerCtrl=null,this._vcxLinkedPropCtrl=null,this._frmWindow=null,this._uiLayer=null,this.immersiveFrame=null,this._backgroundDrop=null,this._backgroundDropText=null,this._dropZone=null,this._usableArea=null,this._touchMultiSelectionDiv=null,this._touchAvailable=!0,this._tokens={},this._vcxDisplayScenarioImmersiveUI=!1,this._tooltipDisplay="true"!==e.getUrlVars().DeactivateTooltipsAtStart,this.isTouchActivated()&&(this._tooltipDisplay=!1),this._init=0,widget&&(widget.setValue("tenantAware",!0),(async()=>{const e=this._experienceBase.getManager("VCXPlatformServicesManager");if(e){var t=await e.GetPreferredSecurityContext();t&&e.setCollabSpaceInCloudIcon(t.role+"."+t.organization+"."+t.collabspace)}})());var m=null;if((m=widget&&widget.getValue("X3DContentId")&&JSON.parse(widget.getValue("X3DContentId")))&&m.data&&m.data.items[0]&&m.data.items[0].objectId&&"HighlightPresentation3DCom"==m.data.items[0].objectType){var C=m.data.items[0].displayName,v=m.data.items[0].objectId;this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_OpenWith"),this._experienceBase.getManager("VCXPlatformServicesManager").onLoadExperienceFromPhysicalID(C,v),m.data=null,widget.setValue("X3DContentId",JSON.stringify(m))}else{if(this.landingPage){g=this;var _=this._vcxGettingStartedUI;return this.landingPage.initializeButtons().then(function(){return g.landingPage.displayHome()}).then(function(){"undefined"!=typeof widget&&_&&_.dropZone.inject(_.parentNode)})}if(this._vcxGettingStartedUI){var f=this.getBrandImage();this._vcxGettingStartedUI.startExperiencePage(l,f,s,c,d,p,u)}}},getBrandImage:function(){var e=this._experienceBase.getManager("VCXContextManager"),t=e.getPlayerMode(),n=!!e.getExperienceIn3DPlay(),i=e.getCityMode(),a=e.getProdHighMode();return t&&n?"I_VCX_Player_BackgroundLogo_In3DPlay.png":i?"I_City_BackgroundLogo_ExperienceCity.jpg":a?"I_VCX_SplashComposer"+Math.floor(5*Math.random()+1)+"_.png":void 0},setPublishAdvancedDisplay:function(e){this._publishAdvancedDisplay=e,this._vcxPublishRasterImageCtrl&&this._vcxPublishRasterImageCtrl.updateAdvancedDisplay(),this._vcxPublishVideoCtrl&&this._vcxPublishVideoCtrl.updateAdvancedDisplay()},getPublishAdvancedDisplay:function(){return this._publishAdvancedDisplay},getAdditionalActionBarSections:function(e){void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&e.push({file:"VCXWebDebug.xml",module:"VCXWebDebug",merge:!0})},onVCXActionBarReady:function(e){const t=this._experienceBase.getManager("VCXAnalyticsTrackerAppManager");if(!this._onCommandStartToken&&t){const e=this._experienceBase.getManager("VCXContextManager"),t=e?e.getContext():"";this._onCommandStartToken=D.onCommandStart(e=>{this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackStartCmdEvent(e.getId())},t)}this._onResizeWidgetCB(),this.recordActionBarEvent()},recordActionBarEvent:function(){var e=this._experienceBase.getManager("VCXContextManager").getActionBar();if(e){this._experienceBase.getManager("VCXContextManager").getPlayerMode()&&e.close();parseFloat(e.elements.container.style.transitionDuration);var t=this;this._ACTIONBAR_OPEN||(this._ACTIONBAR_OPEN=e._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},function(){t._ACTIONBAR_OPEN_timeout=setTimeout(function(){t.updateUsableArea()},1e3*parseFloat(.4))})),this._ACTIONBAR_CLOSE||(this._ACTIONBAR_CLOSE=e._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},function(){t._ACTIONBAR_CLOSE_timeout=setTimeout(function(){t.updateUsableArea()},1e3*parseFloat(.4))}))}},postInitialize:function(){var e=this;void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&(window.onerror=function(t,n,i){var a;a=F["Notification.Unstable"];var r={level:"error",title:F["Notification.Crash"],message:a};e._experienceBase.getManager("VCXNotificationManager").addNotification(r)}),void 0!==this._experienceBase.getManager("VCXContextManager").getUrlVars().DSWebRecord&&(document.experienceBase=this._experienceBase);var n=this._experienceBase.getManager("VCXContextManager");this._frmWindow=n.getFrameWindow(),this._uiLayer=this._frmWindow&&this._frmWindow.getUIFrame(),this.immersiveFrame=this._frmWindow&&this._frmWindow.getImmersiveFrame(),V._activeWindow=null,this.isTouchActivated()&&this._uiLayer.addClassName("vcxTouchMode");var o=this.GetGraphicCard(),s=null===o,l=!s&&o.indexOf("Intel(R) HD Graphics")>=0;if(this._experienceBase.getManager("VCXAnalyticsTrackerAppManager")&&this._experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackGraphicCards(o),s||l)if(this._uiLayer.addClassName("vcxNoGraphiCard"),s){var c="Notification.NoGraphicCardDetected";this.IsFirefox()&&(c="Notification.FirefoxActivateWebGL"),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"error",title:"error",message:F[c]})}else{var d=!!localStorage&&localStorage.getItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED");"true"!==d&&"1"!==d&&(console.log("Card Detected : "+o),this._experienceBase.getManager("VCXNotificationManager").addNotification({level:"warning",title:"warning",message:F["Notification.LowGraphicCardDetected"],action:{label:F["Notification.DontShowMeAgain"],callback:function(){localStorage&&(localStorage.setItem("DS_COMPOSER_GUI_DONT_SHOW_AGAIN_LOW_GRAPHIC_CARD_DETECTED",!0),this.getParent()&&this.getParent().destroy())}}}))}this._frmWindow&&this._frmWindow._sceneGraphTree&&this._frmWindow._sceneGraphTree.tree.slideOut(),this._onResizeDocking=function(t){e.updateUsableArea()},this._onResizeWidget=function(t){t.target===window&&e._onResizeWidgetCB()},window.attachEvent?(window.attachEvent("dimensionsChanged",e._onResizeDocking),window.attachEvent("dockIsResizing",e._onResizeDocking),window.attachEvent("dockResize",e._onResizeDocking),window.attachEvent("onresize",e._onResizeWidget)):window.addEventListener&&(window.addEventListener("dimensionsChanged",this._onResizeDocking,!0),window.addEventListener("dockIsResizing",e._onResizeDocking,!0),window.addEventListener("dockResize",e._onResizeDocking,!0),window.addEventListener("resize",e._onResizeWidget,!0)),e.GetCanvasView().addClassName("vcx-canvas-view");var p=n.getCityMode();p&&(this._uiLayer.addClassName("cid-cityApp"),600);!0===n.getExperienceIn3DPlay()&&("275px","250px","-125px","-120px",""),this.recordActionBarEvent();var u=n.getPlayerMode(),h=this._experienceBase.getManager("VCXContextManager").IsLocalMode(),g="1"===this._experienceBase.getManager("VCXContextManager").getUrlVars().noSample||!h&&!u;if(!1===n.getExperienceIn3DPlay()&&!1===n.getExperienceInGuidedTour()&&!1===p&&!g){require(["DS/VCXWebDebug/VCXSampleCtrl"],function(t){void 0===e._destroyed&&(e._vcxSampleCtrl=new t(e,[]))})}e._updateDockingAreaCB=function(t){setTimeout(function(){e.updateUsableArea()},305)};for(var m=e.immersiveFrame&&e.immersiveFrame.dockingElements,C=0;C<m&&m.length;C++){m[C].addEventListener(i.POINTERUP,e._updateDockingAreaCB)}if(e._frmWindow&&e._frmWindow._sceneGraphTree){var v=e._frmWindow._sceneGraphTree.tree._sidePanel,_=parseFloat(v.elements.panel.style.transitionDuration);this._VCX_GUI_PANEL_SLIDE_IN=v.onSlideIn(function(){setTimeout(function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_IN"})},1e3*_)}),this._VCX_GUI_PANEL_SLIDE_OUT=v.onSlideOut(function(){setTimeout(function(){t.publish({event:"VCX_GUI_PANEL_SLIDE_OUT"})},1e3*_)})}this._tokens.event_VCX_BEGIN_TRANSITION=t.subscribe({event:"VCX_BEGIN_TRANSITION"},function(){e.SetIsPlaying()}),this._tokens.event_VCX_END_TRANSITION=t.subscribe({event:"VCX_END_TRANSITION"},function(){e.UnSetIsPlaying()});var f=new a({target:e.GetCanvasView()});this._tokens._evtPreHLRemoveToken=t.subscribe({event:"VCX_PREHIGHLIGHT_REMOVE"},function(t){f&&(f.hide(),f.tooltipInfos=void 0),e.GetCanvasView().tooltipInfos=void 0}),this._tokens._evtPreHLAddToken=t.subscribe({event:"VCX_PREHIGHLIGHT_ADD"},function(t){if(t[0].event){if(!e._tooltipDisplay)return;var n="";if(t&&Array.isArray(t))for(var i=0;i<t.length;++i){var a=t[i]&&t[i].pathElement,o=A.GetModifiableFromPathElement(a,e._experienceBase);if(o){var s=o.GetProperty("Actor.ToolTip._ComputedText");s&&(n=s.GetPropertyValue().GetValue())}else console.log("no modifiable associated to pathElement.")}e.GetCanvasView().tooltipInfos=new r({shortHelp:n,initialDelay:"1000",reshowDelay:"0"}),f.mousePosition=t[0].event.currentPosition,f.target=e.GetCanvasView(),f.show()}}),this._tokens._previewModeEventToken=t.subscribe({event:"VCX_PREVIEW_MODE_CHANGED"},function(t){if(e._endLoadingDone){var n=e._experienceBase.getManager("VCXContextManager"),i=(n.getActionBar(),n.getFrameWindow()),a=e.getGUIServices();if(t)e.prePreviewImmersiveUIStatus=e.GetDisplayScenarioImmersiveUI(),e.preDocksHidingConfig={},e.preDocksHidingConfig.panels=a.hideDockingElements(i,!0),e.preDocksHidingConfig.actionBar=a.hideActionBar(i,!0),e.updateUsableArea(),e.SetDisplayScenarioImmersiveUI(!0),e.hidePaperCtrl();else e.SetDisplayScenarioImmersiveUI(e.prePreviewImmersiveUIStatus),e.prePreviewImmersiveUIStatus=null,a.restoreDockingElements(i,e.preDocksHidingConfig.panels),a.restoreActionBar(i,e.preDocksHidingConfig.actionBar),e.updateUsableArea(),e.preDocksHidingConfig=null,n.isSupported("DisplayPaperCtrlBtns")&&e.showPaperCtrl()}}),this._endLoadingDone=!1,this._tokens._VCX_END_LOADING_DONE=t.subscribe({event:"VCX_END_LOADING_DONE"},function(t){e._endLoadingDone=!0}),this._tokens._ScenarioChangedToken=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(t){var n=e._experienceBase.getManager("VCXContextManager");if(n){var i=n.getRootComponent(),a=i&&i.QueryInterface("VCXIModifiable"),r=a&&a.GetProperty("GUIManager.DisplayScenarioImmersiveUI");if(r){var o=r.GetPropertyValue().GetValue();(o&&!e.GetDisplayScenarioImmersiveUI()||!o&&e.GetDisplayScenarioImmersiveUI())&&e.SetDisplayScenarioImmersiveUI(o)}}})},_onResizeWidgetCB:function(){this.updateUsableArea(),this.updateDockingElements()},getTooltipDisplay:function(e){return this._tooltipDisplay},setTooltipDisplay:function(e){"boolean"==typeof e&&(this._tooltipDisplay=e)},requestPropertiesPanelRefresh:function(){this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.requestRefresh()},update:function(e){this._firstLoad&&(this._firstLoad=!1),this._vcxTimelineCtrl&&this._vcxTimelineCtrl.updateTimelineFromModel(),this._vcxPropertiesCtrl&&this._vcxPropertiesCtrl.update(e)},InitGUI:function(){if(1!==this._init){this._init=1,k.memoryLog("InitGUI",!0),"undefined"!=typeof widget&&widget.simulatePlay&&(this._experienceBase.getManager("VCXContextManager").setSimulatePlayMode(),this._experienceBase.getManager("VCXContextManager").setPlayerMode(),this._experienceBase.getManager("VCXExperience").SetPreviewMode(!0),widget.simulatePlay=null);var e=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),t=this._experienceBase.getManager("VCXContextManager").getCityMode(),n=this._experienceBase.getManager("VCXContextManager").getProdHighMode(),i=this._experienceBase.getManager("VCXContextManager").getSimulatePlayMode(),a="",r="";n?(r="VCXWebAuthoringApp",a=i?"VCXWebSimulatePlay.xml":this.isMobileDevice()?"VCXWebAuthoringAppMobile.xml":"VCXWebAuthoringApp.xml"):t&&(r="CityIllustrationDesigner",a=i?"CityIllustrationDesignerSimulatePlay.xml":this.isMobileDevice()?"CityIllustrationDesignerMobile.xml":"CityIllustrationDesigner.xml"),a!==(C=this._experienceBase.getManager("VCXContextManager").getActionBar())._currentBarFile&&(C.loadModel({file:a,module:r,merge:!1}),C._additionalActionBarSections=null,C._currentBarFile=a);var o=this._experienceBase.getManager("VCXContextManager").getExperienceIn3DPlay(),p=this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI"),g=this._experienceBase.getManager("VCXDRMManager"),m=this._experienceBase.getManager("VCXContextManager").getMainViewer();if(m.getRobot()&&(m.getRobot().setVisibility(!1),m.setReferenceAxisSystem(!0)),"undefined"!=typeof widget&&i){var C;if(g.GetDisplayScenariosPanel())this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).collapseDockingZoneFlag=!0,(C=this._experienceBase.getManager("VCXContextManager").getActionBar()).close();this._experienceBase.getManager("VCXSelectManager").unableSelectionInPlayMode(),this._experienceBase.getManager("VCXContextManager").setSupported("ImmersiveNavigation",!0),this.SetDisplayScenarioImmersiveUI(!0)}else"undefined"!=typeof widget&&o&&(this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).collapseDockingZoneFlag=!0,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).collapseDockingZoneFlag=!0);if(0===p&&!i)return this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?this._vcxPaperCtrlV2=new c(this,this._experienceBase):this._vcxPaperCtrl=new l(this,this._experienceBase),void k.memoryLog("InitGUI",!1);if(this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")){var v="SequenceFolder.Scenarios",_="Sequence.CADViews",f="Sequence.CADCaptures",b="Sequence.Layers";v=F[v],_=F[_],f=F[f],b=F[b];var y=[v];this._experienceBase.getManager("VCXContextManager").getCityMode()||(y=[v,_+"|"+f,b]),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIScenariosPanel")&&(this._vcxScenarioCtrl=new s(this,y,e),this.SetDisplayScenarioImmersiveUI(this._vcxDisplayScenarioImmersiveUI))}if(this._experienceBase.getManager("VCXContextManager").isSupported("Paper")&&!i&&(this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?this._vcxPaperCtrlV2=new c(this,this._experienceBase):this._vcxPaperCtrl=new l(this,this._experienceBase)),this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUI")){var x=this._experienceBase.getManager("VCXContextManager").getUrlVars().ForcePropertiesWriteMode;!1!==this._experienceBase.getManager("VCXContextManager").isSupported("DisplayUIPropertiesPanel")&&g.GetDisplayPropertiesPanel()&&(this._vcxPropertiesCtrl||(this._vcxPropertiesCtrl=new d(this,!x&&e))),this._vcxDocManagerCtrl=new u(this),this._vcxLinkedPropCtrl=new h(this),this._vcxScenarioCtrl&&this._vcxScenarioCtrl.loadScenariosFromExperience(),this._experienceBase.getManager("VCXContextManager").isSupported("Timeline")&&this.InitTimelineCtrl(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),0),this._vcxScenarioCtrl&&this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),this.initTreesTabFrames(),!t&&this._vcxScenarioCtrl&&this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup&&(this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.multiSelFlag=!1,this._vcxScenarioCtrl._tabPageFrame._panelMaster.windowGroup.currentWindows=[this._vcxScenarioCtrl._tabPageFrame._panelMaster]),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).elements.collapser.setAttribute("data-rec-id","right-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).elements.collapser.setAttribute("data-rec-id","left-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.TopDockArea).elements.collapser.setAttribute("data-rec-id","top-dock"),this.immersiveFrame.getDockingElement(WUXDockAreaEnum.RightDockArea).dockingZoneSize=300,this.immersiveFrame.getDockingElement(WUXDockAreaEnum.LeftDockArea).dockingZoneSize=300,this.updateDockingElements();var P=this;this._onKeydownEvent=function(e){P.onKeydownEvent(e)},addEventListener("keydown",this._onKeydownEvent)}N.initialize(this.immersiveFrame,this._experienceBase),k.memoryLog("InitGUI",!1),(async()=>{const e=this._experienceBase.getManager("VCXPlatformServicesManager");if(e){var t=await this._experienceBase.getManager("VCXCAT3DXModelManager").GetSecurityContext();t&&e.setCollabSpaceInCloudIcon(t.role+"."+t.organization+"."+t.space)}})(),this._modelEvent.publish({event:"initGUIEnd",data:{}})}else console.log("VCXGUIManager::InitGUI has already been done")},subscribe:function(e,t){return this._modelEvent.subscribe({event:e},t)},onInitEnd:function(e){return this.subscribe("initGUIEnd",e)},onUnInitialize:function(e){return this.subscribe("unInitialize",e)},unsubscribe:function(e){this._modelEvent.unsubscribe(e)},initTreesTabFrames:function(){var e=this._experienceBase.getManager("VCXDRMManager"),t=this._experienceBase.getManager("VCXContextManager");(t.isSupported("DisplayUIAssemblyPanel")&&"0"!==t.getUrlVars().tree&&e.GetDisplayTree()||0==t.getPlayerMode())&&(this._vcxWebAssemblyTabFrameCtrl=new v(this._experienceBase),this._vcxWebAssemblyTreeCtrl=new b(this._experienceBase),this._vcxWebSelectionSetsTreeCtrl=new y(this._experienceBase),this._vcxWebHotspotsTreeCtrl=new x(this._experienceBase)),(t.isSupported("DisplayUIDressupsPanel")&&"0"!==t.getUrlVars().dressuptree&&e.GetDisplayTree()||0==t.getPlayerMode())&&(this._vcxWebDressupTabFrameCtrl=new _(this._experienceBase),this._vcxWebDressupTreeCtrl=new P(this._experienceBase)),"1"==t.getUrlVars().stylestree&&(this._vcxWebStylesTabFrameCtrl=new f(this._experienceBase),this._vcxWebStylesTreeCtrl=new S(this._experienceBase));var n=!1;this._vcxWebAssemblyTabFrameCtrl||this._vcxWebDressupTabFrameCtrl||!t.getExperienceIn3DPlay()||(n=!0,this._vcxWebDressupTabFrameCtrl=new _(this._experienceBase),this._vcxWebDressupTreeCtrl=new P(this._experienceBase));var i=[this._vcxWebAssemblyTabFrameCtrl,this._vcxWebDressupTabFrameCtrl,this._vcxScenarioCtrl];t.getProdHighMode()&&(i=[this._vcxScenarioCtrl,this._vcxWebDressupTabFrameCtrl,this._vcxWebAssemblyTabFrameCtrl]);var a=this._vcxScenarioCtrl;a||(a=i[length-1]),this._vcxSampleCtrl&&i.push(this._vcxSampleCtrl),this._vcxWebStylesTabFrameCtrl&&i.push(this._vcxWebStylesTabFrameCtrl);for(var r=null,o=null,s=0;s<i.length;++s)i[s]&&(r=i[s],o&&r.getFrame().tabWith(o.getFrame()),o=r);if(a||(a=o),a&&a.getFrame()._panelMaster.windowGroup)for(var l=0;l<a.getFrame()._panelMaster.windowGroup._tab._tabContent.length;l++)if(a.getFrame()._panelMaster.windowGroup._tab._tabContent[l].content===a.getFrame()._panelMaster.elements.container){a.getFrame()._panelMaster.windowGroup._tab.value=[l];break}n&&this.unInitTreesTabFrames()},unInitTreesTabFrames:function(){this._vcxWebAssemblyTabFrameCtrl&&(this._vcxWebAssemblyTabFrameCtrl.unInitialize(),this._vcxWebAssemblyTreeCtrl&&this._vcxWebAssemblyTreeCtrl.unInitialize(),this._vcxWebSelectionSetsTreeCtrl&&this._vcxWebSelectionSetsTreeCtrl.unInitialize(),this._vcxWebHotspotsTreeCtrl&&this._vcxWebHotspotsTreeCtrl.unInitialize(),this._vcxWebAssemblyTabFrameCtrl=null,this._vcxWebAssemblyTreeCtrl=null,this._vcxWebSelectionSetsTreeCtrl=null,this._vcxWebHotspotsTreeCtrl=null),this._vcxWebDressupTabFrameCtrl&&(this._vcxWebDressupTabFrameCtrl.unInitialize(),this._vcxWebDressupTreeCtrl.unInitialize(),this._vcxWebDressupTabFrameCtrl=null,this._vcxWebDressupTreeCtrl=null),this._vcxWebStylesTabFrameCtrl&&(this._vcxWebStylesTabFrameCtrl.unInitialize(),this._vcxWebStylesTreeCtrl.unInitialize(),this._vcxWebStylesTabFrameCtrl=null,this._vcxWebStylesTreeCtrl=null)},setUpTrees:function(){this._vcxWebAssemblyTabFrameCtrl instanceof C&&(this._setUpTree(this._vcxWebAssemblyTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,1),this._setUpTree(this._vcxWebSelectionSetsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,2),this._setUpTree(this._vcxWebHotspotsTreeCtrl,this._vcxWebAssemblyTabFrameCtrl,3)),this._vcxWebDressupTabFrameCtrl instanceof C&&this._setUpTree(this._vcxWebDressupTreeCtrl,this._vcxWebDressupTabFrameCtrl,1),this._vcxWebStylesTabFrameCtrl instanceof C&&this._setUpTree(this._vcxWebStylesTreeCtrl,this._vcxWebStylesTabFrameCtrl,1)},_setUpTree:function(e,t,n){if(e&&!e.tree){e.setTabFrameCtrl(t),e.setSlidingViewIndex(n);var i=e.createTree();i||console.warn("Creation of "+e._type+" tree UI failed!"),i&&i.inject(t.getFrame()._slidingViews.getView(n))}},onKeydownEvent:function(e){if(83===e.keyCode&&this.immersiveFrame&&"BODY"===document.activeElement.nodeName)if(this._statsCtrl)this._statsCtrl.destroy(),delete this._statsCtrl;else{var t={};t.currentDockArea=WUXDockAreaEnum.BottomDockArea,t.immersiveFrame=this.immersiveFrame,this._statsCtrl=new g(t)}},toggleTouch:function(){this._touchAvailable=!this._touchAvailable,this._vcxPaperCtrl&&(this._vcxPaperCtrl.mainPanel.parentNode.removeChild(this._vcxPaperCtrl.mainPanel),this._vcxPaperCtrl=null),this._vcxPaperCtrlV2&&(this._vcxPaperCtrlV2.paperControlToolbar.destroy(),this._vcxPaperCtrlV2=null),this.isTouchAvailable()?this._uiLayer.addClassName("vcxTouchMode"):this._uiLayer.removeClassName("vcxTouchMode"),this._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")?this._vcxPaperCtrlV2=new c(this,this._experienceBase):this._vcxPaperCtrl=new l(this,this._experienceBase),this.RefreshGUI()},isTouchAvailable:function(){return this._touchAvailable},isTouchActivated:function(){return this.isTouchCompliantDevice()&&this.isTouchAvailable()||this._experienceBase.getManager("VCXContextManager").isSupported("ForceTouch")},isTouchCompliantDevice:function(){return this._experienceBase.getManager("VCXContextManager").isTouchCompliantDevice()},isIOSDevice:function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},isMobileDevice:function(){var e=navigator&&"Win32"===navigator.platform;return this.isTouchCompliantDevice()&&!e},GetGraphicCard:function(){let e=null;var t=document.createElement("canvas").getContext("experimental-webgl",{stencil:!0});if(t){var n=t.getExtension("WEBGL_debug_renderer_info");n&&(e=n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL))}return e},IsFirefox:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},IsChrome:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1},lockLoading:function(){document.body.addClassName("waiting"),document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading="true")},islockLoading:function(){return!!document.querySelector(".moduleContent")&&"true"===document.querySelector(".moduleContent").lockLoading},unlockLoading:function(){document.querySelector(".moduleContent")&&(document.querySelector(".moduleContent").dataset.lockLoading=""),document.body.removeClassName("waiting")},RefreshGUI:function(){if(this._init){if(k.memoryLog("RefreshGUI",!0),this._vcxPaperCtrl&&this._vcxScenarioCtrl&&(this._vcxPaperCtrl._experienceBase=this._experienceBase),this._vcxPaperCtrlV2&&this._vcxScenarioCtrl&&(this._vcxPaperCtrlV2._experienceBase=this._experienceBase),this._vcxScenarioCtrl){var e=this._experienceBase.getManager("VCXContextManager").getPlayerMode(),t=this._experienceBase.getManager("VCXAPIManager").HasAnimation("AnimationSmgID"),n=!1;e?e&&!t&&(n=!0):n=!0,this._vcxScenarioCtrl.onCurrentScenarioChanged(this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()),n&&1===this._experienceBase.getManager("VCXExperience").GetViewMode()&&this._vcxScenarioCtrl.setSequenceState("Animation",!1)}k.memoryLog("RefreshGUI",!1),this.unlockLoading()}},hidePaperCtrl:function(){this._vcxPaperCtrl&&this._vcxPaperCtrl.hide(),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.hide()},showPaperCtrl:function(){this._vcxPaperCtrl&&this._vcxPaperCtrl.show(),this._vcxPaperCtrlV2&&this._vcxPaperCtrlV2.show()},isHiddenPaperCtrl:function(){return this._vcxPaperCtrl?this._vcxPaperCtrl.isHidden():this._vcxPaperCtrlV2?this._vcxPaperCtrlV2.isHidden():null},RefreshPourcent:function(e){},ChangeTimePos:function(e,t){this._vcxTimelineCtrl&&this._vcxTimelineCtrl.ChangeTimePos(e,t)},InitTimelineCtrl:function(e,t){if(null!==this._vcxScenarioCtrl){var n=this._experienceBase.getManager("VCXContextManager").getContext();D.getCommandCheckHeader("VCXAutoKeyCmd",n);this._vcxTimelineCtrl&&(this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null);var i=this._experienceBase.getManager("VCXContextManager");if(!i.getCityMode()){var a={frmWindow:this._frmWindow,experienceBase:this._experienceBase,scenarioID:e,flattenKeys:!0};if(this._vcxTimelineCtrl=new E(a),""!==e){var r=null;i&&(r=i.getContext());var o=D.getCommandCheckHeader("VCXCameraPlayModeCmd",r),s=D.getCommandCheckHeader("VCXAutoKeyCmd",r),l=Math.round(this._experienceBase.getManager("VCXScenarioManager").GetMaxFrame(e));0===l&&(l=500);var c={frmWindow:this._frmWindow,parent:this._vcxScenarioCtrl.getFrame().getFooter(),displayToolbar:!0,displaySlider:!0,displayPlayBack:!1,displayLoop:!0,displayBounce:!0,displayReverse:!0,displayMarkers:!0,displayCamera:!!o,displayCameraMode:this._isCameraPlayMode=!!o&&o.getState(),maxFrame:l,timelineGUI:VCXWebTimelineGUIEnum.Light,title:"Light Timeline"};if(this._vcxTimelineCtrl.createTimeline(c),!this._experienceBase.getManager("VCXContextManager").getPlayerMode()){var d={timelineGUI:VCXWebTimelineGUIEnum.Main,maxFrame:l,numberOfTracks:5,step_time_min:.1,scenario:this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e],propertiesTreeWidth:130},p=c;p.displayAutoKey=!!s,p.displayAutoKeyMode=this._isAutoKeyMode=!!s&&s.getState(),p.displayRemoveTracks=!0,p.parent=null,p.displaySlider=!1,p.displayPlayBack=!1,p.displayFilterOnSelection=!0,p.filterOnSelectionMode=!1;p.customButtons=[],d.toolbar=p,this._vcxTimelineCtrl.createTimeline(d)}for(var u=[],h=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[e].QueryInterface("VCXIModifiable").GetProperty("Actor.Scenario.Markers").GetPropertyValue().GetValue(),g=0;g<h.length;g++){var m={},C=h[g];if("VCXPropertyValueLink"===C.GetType()){var v=C.GetValue(),_=this._experienceBase.ComponentsMap.GetComponentFromID(v);g.toString();if(_&&_.GetName){m.name=_.GetName(),m.id=_.GetID(),m.component=_;var f=_.QueryInterface("VCXIModifiable");m.type=f.GetProperty("Actor.IsMilestone").GetPropertyValue().GetValue()?"milestone":"marker",m.frame=f.GetProperty("Actor.TimePos").GetPropertyValue().GetValue(),u.push(m)}}}this._vcxTimelineCtrl.addMarkers(u),this._vcxTimelineCtrl.setIndexValue(t)}}}},deleteTimeline:function(){if(this._vcxTimelineCtrl){this._vcxTimelineCtrl.unInitialize(),this._vcxTimelineCtrl=null;var e=this._experienceBase.getManager("VCXContextManager").getContext(),t=D.getCommandCheckHeader("VCXAutoKeyCmd",e);if(t)this._experienceBase.getManager("VCXContextManager").getPlayerMode()||t.setState(!0);var n=D.getCommandCheckHeader("VCXCameraPlayModeCmd",e);n&&n.setState(!0)}},GoToScenarioContext:function(){this._experienceBase.getManager("VCXScenarioManager").GetIsPlayingCurrentScenario();return!this._isPlayingGoTo},SetIsPlaying:function(){this._isPlayingGoTo=1},UnSetIsPlaying:function(){this._isPlayingGoTo=0},SetPropertiesPanelVisibility:function(e){this._vcxPropertiesCtrl._mainPanel.style.display=e?"":"none"},SetDocManagerPanelVisibility:function(e){e?(this._vcxDocManagerCtrl._mainPanel.style.display="",this._vcxDocManagerCtrl.onRedraw()):this._vcxDocManagerCtrl._mainPanel.style.display="none"},SetLinkedPropPanelVisibility:function(e){e?(this._vcxLinkedPropCtrl._mainPanel.style.display="",this._vcxLinkedPropCtrl.onRedraw()):this._vcxLinkedPropCtrl._mainPanel.style.display="none"},AddDropZone:function(){this._vcxGettingStartedUI&&this._vcxGettingStartedUI.dropZoneON()},RemoveDropZone:function(){this._vcxGettingStartedUI&&this._vcxGettingStartedUI.dropZoneOFF()},GetCanvasView:function(){return this._experienceBase.getManager("VCXContextManager").getMainViewer().canvas},SetCursor:function(e){var t=this.GetCanvasView();t&&t.setStyle("cursor",e)},GetCursor:function(){var e=this.GetCanvasView();if(e)return e.style.cursor;console.log("viewer.canvas not found !!")},GetActiveSequenceId:function(){return this._vcxScenarioCtrl?this._vcxScenarioCtrl.GetActiveSequenceId():null},getGUIServices:function(){return G},getGettingStartedUI:function(){return this.landingPage?this.landingPage:X},getGettingStartedNode:function(){if(this._vcxGettingStartedUI)return this._vcxGettingStartedUI.getHomeNode()},GetDisplayScenarioImmersiveUI:function(){return this._vcxDisplayScenarioImmersiveUI},SetDisplayScenarioImmersiveUI:function(e){null!=e?(this._experienceBase.getManager("VCXDRMManager").GetImmersiveNavigation()||(e=!1),this._experienceBase.getManager("VCXContextManager").isSupported("ImmersiveNavigation")||(e=!1),this._vcxDisplayScenarioImmersiveUI=e,this._vcxScenarioCtrl&&this._vcxScenarioCtrl.setImmersiveUIState(e)):console.warn("SetDisplayScenarioImmersiveUI : value is missing")},createTabPageFrame:function(e){return new m(e)},addDivUpdateView:function(){N.addDiv()},displaySceneNeedsUpdateModal:function(e){let n="";switch(e){case"close":n=F["SceneUpdate.close"];break;case"publish":n=F["SceneUpdate.publish"];break;case"save":n=F["SceneUpdate.save"]}return new UWA.Promise((e,i)=>{if(!this._sceneNeedsUpdate)return e(!1);var a=new w({label:"Update",onClick:n=>{var i=n.dsModel,a=i.dialog;D.getCommand("VCXAddCameraKeyCmd",this._experienceBase.getManager("VCXContextManager").getContext())&&D.getCommand("VCXAddCameraKeyCmd",this._experienceBase.getManager("VCXContextManager").getContext()).begin();var r=new I;r.on(),T.createModal(i.dialog.elements.container,r.elements.container);let o=t.subscribe({event:"VCX_SCENARIO_REPLACED"},n=>{T.removeModal(i.dialog.elements.container),t.unsubscribe(o),a.close(),e(!0)})}}),r=new w({label:"Don't update",onClick:t=>{t.dsModel.dialog.close(),e(!1)}});new M({immersiveFrame:document.querySelector(this._parentDivName),modalFlag:!0,closeButtonFlag:!1,touchMode:!0,resizableFlag:!1,movableFlag:!1,icon:"camera-refresh",title:F["SceneUpdate.title"],content:UWA.Element("div",{class:"vcx-updateScene-modal",html:n}),buttons:{Open:a,Close:r}})})},GetDocIDFromImageLoadQuery:function(){return new U(this._experienceBase).GetDocIDFromImageLoadQuery()},displayFakePropertiesForODT:function(){if(this._vcxPropertiesCtrl.displayFakePropertiesForODT)return this._vcxPropertiesCtrl.displayFakePropertiesForODT()}});return Object.defineProperty(W.prototype,"componentType",{enumerable:!0,get:function(){return"VCXGUIManager"}}),W}),define("DS/VCXWebGUI/VCXLinkedPropCtrl",["UWA/Class","DS/CoreEvents/Events","DS/Spreadsheet/DataGrid","DS/VCXWebGUI/VCXToolbarCtrl","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a){"use strict";return e.extend({init:function(e){var r=this;this._vcxGuiManager=e,this._tokenLinkAdded=t.subscribe({event:"VCX_LINKS_ADDED"},function(){r.onRedraw()}),this._tokenLinkRemoved=t.subscribe({event:"VCX_LINKS_REMOVED"},function(){r.onRedraw()}),this._mainPanel=new UWA.Element("div",{html:"",class:"VCXLinkedPropCtrl",styles:{display:"none",margin:"",height:"300px",width:"400px",bottom:"100px",left:"300px",position:"absolute",border:"1px dotted black",backgroundColor:"white"}}).inject(r._vcxGuiManager._uiLayer),this._toolbarContainer=new UWA.Element("div",{html:"",class:"wux-panels-panelbase-title vcx-panels-panelbase-title"}).inject(this._mainPanel),this._toolbar=new i({controller:r,title:"Linked Properties panel",parent:this._toolbarContainer,panel:this._mainPanel}),this._toolbar.addMainItemFixed("VCXDeleteLinkedPropCmd","","vcxToolbarButtonIcon","VCXWebDebug/VCXWebDebug",a);var o={apiVersion:2,height:"auto",headersDimensions:{width:15,height:15},show:{rowHeaders:!0,columnHeaders:!0},resize:{columns:!0,rows:!0},isSortable:!1,className:"linkedProperties",columns:[{text:"In",dataIndex:"inValue",width:180},{text:"Out",dataIndex:"outValue",width:180}],selection:{nodes:!0,cells:!1,rowHeaders:!0,columnHeaders:!1,unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,canMultiRowSelect:!0}};r.datagrid=new n(o);var s=r.datagrid.getManager(),l=function(e){if(!event.changedTouches){var t=e.cellModel,n=e.cellView,i=n.getVirtualCoordinates(),a=i.virtualRowID,r=i.virtualColumnID;if(!n._isBeingResized){if(-1===r&&s.options.selection.rowHeaders&&(s.prepareUpdateView(),s.options.selection.canMultiRowSelect?s.isRowSelected(a)?s.unselectRow(a,!1):s.selectRow(a,!1):(s._selectedCells.empty(),s.selectRow(a)),a,s.pushUpdateView()),-1===a){var o=s._getColumnOptionValue(r,"isSortable"),l=["sort:asc","sort:desc"],c=s._getColumnState(r);switch(cyclicIterator(l,l.indexOf(c)).getNext()){case void 0:case"select":s.prepareUpdateView(),s.options.selection.rowHeaders&&(t.removeClass("wux-ui-sort-desc"),t.removeClass("wux-ui-sort-asc"),s.selectColumn(r,!0)),s.pushUpdateView();break;case"sort:desc":o&&(s.prepareUpdateView(),s.sortColumnContent(r,{typeOfCell:"number",sortOrder:"desc"}),s.pushUpdateView());break;case"sort:asc":o&&(s.prepareUpdateView(),s.sortColumnContent(r,{typeOfCell:"number",sortOrder:"asc"}),s.pushUpdateView())}}if(-1!==a&&-1!==r&&s.options.selection.cells){if(s.prepareUpdateView(),s._preventNextUpdateView(),s.unselectAll({cells:!0,updateView:!1}),s._modeIsRange){var d,p,u,h,g,m,C=t,v=s._selectedCells.get()[0];s._selectedCells.empty(),s._selectedCells.add(v);var _=v.getView().getVirtualCoordinates(),f=C.getView().getVirtualCoordinates();for(_.virtualRowID<f.virtualRowID?(u=_.virtualRowID,h=f.virtualRowID):(h=_.virtualRowID,u=f.virtualRowID),d=u;d<=h;d++)for(_.virtualColumnID<f.virtualColumnID?(g=_.virtualColumnID,m=f.virtualColumnID):(m=_.virtualColumnID,g=f.virtualColumnID),p=g;p<=m;p++)if(d!==_.virtualRowID||p!==_.virtualColumnID){var b=s.getCell(d,p);s._selectedCells.add(b)}}else s._modeIsMultiSel?s._selectedCells.add(t):s._selectedCells.unique(t);s.pushUpdateView()}}}};r.datagrid.getManager().onCellClick=function(e){return this._modelEvents.subscribe({event:"click"},l)},r.datagrid.inject(this._mainPanel),r.datagrid.elements.formContainer.childNodes[1].style.top="30px"},GetSelectedLinks:function(){if(this.datagrid){for(var e=[],t=this.datagrid.getManager().getSelectedRows(),n=0;n<t.length;n++){var i=this._mapToFill[n];e.push(i)}return e}},unInitialize:function(){t.unsubscribe(this._tokenLinkAdded),delete this._tokenLinkAdded,t.unsubscribe(this._tokenLinkRemoved),delete this._tokenLinkRemoved,this._toolbar.unInitialize(),this._toolbar=null,this.datagrid.getManager().onCellClick=null,this.datagrid.destroy(),this._mainPanel.remove()},onRedraw:function(){if("none"!==this._mainPanel.style.display){var e=this.datagrid.getManager();e.empty();var t=this._vcxGuiManager._experienceBase.getManager("VCXLinkedPropertyManager");this._mapToFill={};var n=!0,i=0;for(var a in t._links)if(t._links.hasOwnProperty(a)){var r=t._links[a];if(r)for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];if(s)for(var l in s)if(s.hasOwnProperty(l)){var c=s[l];for(var d in c)if(c.hasOwnProperty(d)){var p=a+"#"+o,u=l+"#"+d;n&&(n=!1,e.prepareUpdateView(),e.empty()),e.addRow({inValue:p,outValue:u});var h={inID:a,inProp:o,outID:l,outProp:d};this._mapToFill[i]=h,i++}}}}n||(e.pushUpdateView(),e._endResizeCallback())}}})}),define("DS/VCXWebGUI/VCXLandingPage",["UWA/Core","UWA/Class","DS/CoreEvents/Events","DS/XAppLandingPage/XAppLandingPageCore","DS/Windows/ImmersiveFrame","DS/VCXWebGUI/VCXGettingStartedUI","DS/WebappsUtils/WebappsUtils","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebComposer/VCXExperienceLoader","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l,c){"use strict";return t.extend({init:function(t){if(this.widgetId=t.widgetId,this.parent=t.parent,this.frmWindow=t.frmWindow,this.isRemoved=!1,this.experienceBase=t.experienceBase,this._vcxGettingStartedUI=this.getGettingStartedUI(),this._vcxGettingStartedUI&&this.experienceBase){var n=this.experienceBase.getManager("VCXContextManager").IsLocalMode();this._vcxGettingStartedUI.initialize({localMode:n}),this._vcxGettingStartedUI.setExperienceBase(this.experienceBase),"undefined"!=typeof widget?this._vcxGettingStartedUI.setParentNode(widget.body):this._vcxGettingStartedUI.setParentNode(document.body)}this.container=e.createElement("div",{Class:"landing-page-container"}).inject(this.parent),this.wrapper=e.createElement("div",{Class:"landing-page-wrapper"}).inject(this.container),this.extraElementsContainer=e.createElement("div",{Class:"landing-page-extra-elements-container"}).inject(this.container),this.dialogsImmersiveFrame=new a,this.dialogsImmersiveFrame.inject(this.extraElementsContainer)},initializeButtons:function(){if(!this.experienceBase)return e.Promise.reject("LandingPage : experienceBase is missing.");var t={name:"RecoverExperience",onClick:()=>{this.experienceBase.getManager("VCXPlatformServicesManager")&&this.experienceBase.getManager("VCXPlatformServicesManager").SessionRecover()}},n={name:"NewExperience",onClick:()=>{var e,t;return this.experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackNewPresentationEvent("xH_HomePageButton"),this.experienceBase.getManager("VCXContextManager").isSupported("NoEmptyExperience")?this.experienceBase.getManager("VCXCAT3DXModelManager").SearchInApp("[ds6w:contentStructure]:Root","Insert in xHighlight").then(n=>{if(n)return e=n.id,t=n.label,this.experienceBase.getManager("VCXPlatformServicesManager").onDropProduct(t,e)}):this.experienceBase.getManager("VCXPlatformServicesManager")?this.experienceBase.getManager("VCXPlatformServicesManager").onCreateEmptyExperience():void 0}},a={name:"OpenExperience",onClick:()=>{if(this.experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackOpenPresentationEvent("xH_HomePageButton"),"true"!==this.experienceBase.getManager("VCXContextManager").getUrlVars().tstProvider){var e=this.experienceBase.getManager("VCXCAT3DXModelManager").GetScenarioType(),t=this.experienceBase.getManager("VCXCAT3DXModelManager").GetApplicationName();this.experienceBase.getManager("VCXCAT3DXModelManager").SearchInApp("[ds6w:type]:"+e,"Open in "+t).then(e=>{if(e){var t=e.label,n=e.id;this.experienceBase.getManager("VCXPlatformServicesManager").onLoadExperienceFromPhysicalID(t,n)}})}else{var n=prompt("Please enter your Experience Physical ID","");if(!n)return void console.warn("DEBUG: The experience physical ID is not defined. Cannot open experience.");this.experienceBase.getManager("VCXCAT3DXModelManager").LoadExperienceFromPhysicalID(n).then(()=>{this.experienceBase.getManager("VCXContextManager").getRootComponent()?console.log("Experience Loaded success"):console.log("Experience Loaded FAILED")})}}},r={name:"import3dxml",onClick:()=>{var e=this.experienceBase.getManager("VCXPlatformServicesManager");e&&(async()=>{const t=await e.handle3DXML();for(let e of t.files)this.experienceBase.getManager("VCXAnalyticsTrackerAppManager").trackImport3dxmlEvent("xH_HomePageButton",t.insertProducts,e.size)})()}},o=[],s=[];return this.experienceBase.getManager("VCXCAT3DXModelManager").IsExperienceStarted().then(e=>{e.isExperienceStarted&&o.push(t),o.push(n),o.push(a),this.experienceBase.getManager("VCXContextManager").isSupported("Import3DXML")&&o.push(r),s.push({name:"SwymLink"}),s.push({name:"WhatsNew",mediaType:"EmbeddedWebHelp"});var l=this.experienceBase.getManager("VCXGUIManager").isMobileDevice();this.landingPageCoreOptions={body:this.wrapper,version:"V3",items:o,appInfo:!l,onDrop:e=>{var t=this.experienceBase.getManager("VCXDragDropManager");t&&t.loadDroppedFromCollabSpace(e).then(e=>{console.log(e),this.experienceBase.getManager("VCXPlatformServicesManager").treat3DXMLResults(e)})},appLinks:{UserAssistance:!0,contentAndKnowledge:s,socialNetworks:[{name:"LinkedinLink"},{name:"TwitterLink"}]},nlsJson:["i18n!DS/VCXWebAuthoringGUI/assets/nls/VCXLandingPage"],rscJson:["text!DS/VCXWebAuthoringGUI/assets/rsc/VCXLandingPage.json"],rsc:"VCXWebAuthoringGUI/VCXWebAuthoringGUI",events:{appOverviewClick:()=>{this.launchGuidedTour()}}},this.landingPageCore=new i(this.landingPageCoreOptions),this.wrapper.addClassName("vcx-landing-page-wrapper")})},launchGuidedTour:function(){var t,n,i=this;window.loading3DXML=!0;var a=document.querySelector("div#experiencePath");return i.experienceBase.webApplication.activateGuidedTourMode(),a.hide(),i.experienceBase.webApplication.requestNewExperienceBaseAsync().then(function(r){var d;a.show(),t=r,i.experienceBase=r,d="GuidedTour.Loading",document.querySelector("div.vcx-Notification-Curtain-Container > div.wux-controls-modalContainer").setStyle("background-color","rgba(255,255,255,1)"),n=t.getManager("VCXNotificationManager").addProgressNotification({strAction:c[d],strObjectName:c["GuidedTour.Title"],maskDisplayAdd:18});var p={},u=o.getWebappsAssetUrl("VCXWebGuidedTour","experience/GuidedTour_Headphones.3dxml"),h=e.Promise.deferred();return s.PBlobURLToBlob(u,"").then(function(e){var t=window.URL.createObjectURL(e);p["GuidedTour_Headphones.3dxml"]=t;var n=o.getWebappsAssetUrl("VCXWebGuidedTour","experience/GuidedTour_Headphones.exprd");return s.PBlobURLToBlob(n,"")}).then(function(e){(new l).Load({experienceBase:r,mapAssets:p,jsonFile:e,urb:!0,endCB:function(e){window.loading3DXML=!1,"3dxml"===e&&setTimeout(function(){var e;document.querySelector(".vcx-fluid-content > div.wux-controls-thumbnail:nth-child(1)").click(),e=n,t.getManager("VCXNotificationManager").endProgressNotification(e);require(["DS/VCXWebGuidedTour/VCXWebGuidedTourEngine"],function(e){new e({container:document.querySelector(".module.moduleUwa").getParent(),experienceBase:r,events:{stop:function(e){r.webApplication.deactivateGuidedTourMode(),r.webApplication.requestNewExperienceBaseAsync()}}}).start()})},500)}})}),h})},close:function(){this.landingPageCore&&this.landingPageCore.clean(),this.wrapper&&this.wrapper.destroy(),this.isRemoved=!0,this.container&&(this.container.destroy(),this.container=null)},displayHome:function(){return this.landingPageCore.displayHome()},getGettingStartedUI:function(){return r},endLoadingExperience:function(){this.close()},failLoadingExperience:function(){},curtainFade:function(){},clearInitWidget:function(){this.getGettingStartedUI().clearInitWidget()},removeCurtainFade:function(){}})}),define("DS/VCXWebGUI/VCXPaperCtrl",["UWA/Class","DS/CoreEvents/Events","UWA/Element","DS/Core/PointerEvents","DS/Controls/Timeline","DS/RuntimeView/RSCManager","DS/ApplicationFrame/CommandsManager","DS/VCXWebGUI/VCXPaperCtrlV2","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI"],function(e,t,n,i,a,r,o,s,l){"use strict";return e.extend({init:function(e,n){var s=this;this._vcxGuiManager=e,this._experienceBase=null,null!=n&&(s._experienceBase=n),this._touchCompliant=s._vcxGuiManager.isTouchActivated(),this._buttonsAvailable={showPaper:!1,zoomFit:!1,pan:!1,zoom:!1,zoomSlider:!1},this._zoomFactorButtons=s._touchCompliant?2:1,this._paneHeight=s._touchCompliant?50:42,this._timelineProgress=50,this._timeoutStartHideAnimation=2e3,this._speedDisplayAnimation=200,this._speedHideAnimation=700,this._iconPaperExpander="",this._iconPaperExpanderOver="",this._iconPaperBackgroundOver="rgb(231, 241, 248)",this._animateUI={},this._zoomChangedToken=null,this._panChangedToken=null;var c=this._experienceBase.getManager("VCXContextManager");if(c){var d=c.getActionBar();s._actionBar_sectionChangeToken=d._modelEvents.subscribe({event:"EVT_SECTION_CHANGE"},function(){s.CheckSize(d,s.mainPanel)}),s._actionBar_openToken=d._modelEvents.subscribe({event:"ACTIONBAR_OPEN"},function(){s.CheckSize(d,s.mainPanel)}),s._actionBar_closeToken=d._modelEvents.subscribe({event:"ACTIONBAR_CLOSE"},function(){s.CheckSize(d,s.mainPanel)}),s.mainPanel=new UWA.Element("div",{html:"",class:"VCXPaperCtrl",styles:{height:s._paneHeight},events:{touchstart:function(){s.mainPanel.addClassName("hover")},touchend:function(){s.mainPanel.removeClassName("hover")}}}).inject(this._vcxGuiManager._uiLayer);var p="VCX_UI_Paper_Ctrl_Up",u="VCX_UI_Paper_Ctrl_Bottom";"0px"===document.querySelector('div[data-type="ui-frame-2d"]').style.bottom&&(p+="_3DPlay",u+="_3DPlay"),s.mainPanel._styleUp=p,s.mainPanel._styleBottom=u;var h="";if(h=l["PaperCtrl.DisplayPaperButton"],this.buttonShowPaper=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-discovery-project wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){var e=!s._experienceBase.getManager("VCXPaperManager").getPaperVisibility();s._experienceBase.getManager("VCXPaperManager").setPaperVisibility(e),e?s.buttonShowPaper.addClassName("wux-ui-state-active"):s.buttonShowPaper.removeClassName("wux-ui-state-active")},mouseover:function(){this.style.backgroundColor=s._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(s.mainPanel),s._experienceBase.getManager("VCXPaperManager").getPaperVisibility()&&s.buttonShowPaper.addClassName("wux-ui-state-active"),s.buttonShowPaper.addEvent(i.POINTERDOWN,function(){this.style.backgroundColor=s._iconPaperBackgroundOver}),s.buttonShowPaper.addEvent(i.POINTERUP,function(){this.style.backgroundColor=""}),this._buttonsAvailable.showPaper=!0,s._touchCompliant){var g=c.getContext(),m=(c.getMainViewer(),o.getCommand("VisuPanViewPaper",g));m&&(c.isSupported("DisplayPaperCtrlBtns")&&(h="",h=l["PaperCtrl.PanPaperButton"],s.buttonPan=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-arrow-double-combo wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){m&&(m.isRunning()?(m.end(),s.buttonPan.removeClassName("wux-ui-state-active")):(m.begin(),s.buttonPan.addClassName("wux-ui-state-active")))},mouseover:function(){this.style.backgroundColor=s._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(s.mainPanel),s.buttonPan.addEvent(i.POINTERDOWN,function(){this.style.backgroundColor=s._iconPaperBackgroundOver}),s.buttonPan.addEvent(i.POINTERUP,function(){this.style.backgroundColor=""}),this._buttonsAvailable.pan=!0),m.onBegin(function(){s.buttonPan&&!s.buttonPan.classList.contains("wux-ui-state-active")&&s.buttonPan.addClassName("wux-ui-state-active")}),m.onPause(function(e){m.end()}),m.onEnd(function(){s.buttonPan&&s.buttonPan.removeClassName("wux-ui-state-active")}))}h="",h=l["PaperCtrl.FitPaperButton"],this.buttonZoomFit=new UWA.Element("div",{html:"",class:"vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds wux-ui-3ds-zoom-fit wux-ui-3ds-lg wux-afr-cmdstarter",title:h,events:{click:function(){s._experienceBase.getManager("VCXPaperManager").ToggleAutoFit()?s.buttonZoomFit.addClassName("wux-ui-state-active"):s.buttonZoomFit.removeClassName("wux-ui-state-active"),s._vcxGuiManager.updateUsableArea()},mouseover:function(){this.style.backgroundColor=s._iconPaperBackgroundOver},mouseout:function(){this.style.backgroundColor=""}}}).inject(s.mainPanel),s._experienceBase.getManager("VCXPaperManager")._autoFit&&s.buttonZoomFit.addClassName("wux-ui-state-active"),s.buttonZoomFit.addEvent(i.POINTERDOWN,function(){this.style.backgroundColor=s._iconPaperBackgroundOver}),s.buttonZoomFit.addEvent(i.POINTERUP,function(){this.style.backgroundColor=""}),this._buttonsAvailable.zoomFit=!0,c.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomFit.style.visibility="hidden"),h="",h=l["PaperCtrl.ZoomMinusButton"],s.buttonZoomMinus=s.createButton("wux-ui-3ds wux-ui-3ds-minus","url("+s._iconPaperZoomMinus+")",h),s.buttonZoomMinus.inject(s.mainPanel),s.AddEvents(s.buttonZoomMinus,"Minus",s,-1),h="",h=l["PaperCtrl.ZoomPlusButton"],s.buttonZoomPlus=s.createButton("wux-ui-3ds wux-ui-3ds-plus","url("+s._iconPaperZoomPlus+")",h),s.buttonZoomPlus.inject(s.mainPanel),s.AddEvents(s.buttonZoomPlus,"Plus",s,1),this._buttonsAvailable.zoom=!0,c.isSupported("DisplayPaperCtrlBtns")||(this.buttonZoomPlus.style.visibility="hidden",this.buttonZoomMinus.style.visibility="hidden"),this._vcxGuiManager.isTouchActivated()||(this._timelineDiv=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineDiv",styles:{}}).inject(s.mainPanel),this._timeline=new a({minValue:0,maxValue:100,value:this._timelineProgress,dynamicGraduations:!1,dynamicGaugeColor:!1,graduationsLabel:!1,graduations:0,eventsList:[{label:"100",value:100,onEvent:function(){}}],activeGraduationsColor:"#3CF",inactiveGraduationsColor:"#CCC"}),this._timeline.elements.container.style.margin="initial",this._timeline.inject(s._timelineDiv),this._buttonExpander=new UWA.Element("div",{html:"",class:"VCXPaperCtrlTimelineArrow",styles:{backgroundImage:"url("+s._iconPaperExpander+")"}}),this._buttonExpander.inject(this.mainPanel),document.querySelectorAll(".wux-Gauge-scale",".VCXPaperCtrlTimelineDiv")[0].style.opacity=0,this.UpdatePercentage(this),this._timeline.addEvent("change",function(){s._timelineProgress=s._timeline.getValue(),s.UpdatePercentage(s,0)}),this._buttonsAvailable.zoomSlider=!0,c.isSupported("DisplayPaperCtrlBtns")||(this._timelineDiv.style.visibility="hidden",this._buttonExpander.style.visibility="hidden")),this._checkSizeCB=this.checksizeFct.bind(this),window.attachEvent?(window.attachEvent("expand",this._checkSizeCB),window.attachEvent("collapse",this._checkSizeCB),window.attachEvent("dockIsResizing",this._checkSizeCB),window.attachEvent("dockResize",this._checkSizeCB)):window.addEventListener&&(window.addEventListener("expand",this._checkSizeCB,!0),window.addEventListener("collapse",this._checkSizeCB,!0),window.addEventListener("dockIsResizing",this._checkSizeCB,!0),window.addEventListener("dockResize",this._checkSizeCB,!0)),this._buttonsAvailable.zoomSlider&&r.onResourceLoaded({resourceFile:"VCXWebAuthoringApp/VCXWebAuthoringApp"},function(){s._iconPaperExpander=this.getIcon({key:"VCXPaperExpander",size:"Normal"}),s._buttonExpander.style.backgroundImage="url("+s._iconPaperExpander+")",s._iconPaperExpanderOver=this.getIcon({key:"VCXPaperExpanderOver",size:"Normal"})}),this._zoomChangedToken=t.subscribe({event:"/VCX/Paper/ZoomChanged"},function(e){e&&s.buttonZoomFit&&(e.autoFit?s.buttonZoomFit.addClassName("wux-ui-state-active"):s.buttonZoomFit.removeClassName("wux-ui-state-active")),e&&!e.updatePaper&&(s._lockupdatePaper=!0),s.SetZoomFactor(e),s._lockupdatePaper=!1}),this._panChangedToken=t.subscribe({event:"/VCX/Paper/PanChanged"},function(e){e&&s.buttonZoomFit&&(e.autoFit?s.buttonZoomFit.addClassName("wux-ui-state-active"):s.buttonZoomFit.removeClassName("wux-ui-state-active"))})}else console.log("No ContextManager found, paperCtrl initialization aborted..")},checksizeFct:function(){var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();this.CheckSize(e,this.mainPanel)},unInitialize:function(){this._zoomChangedToken&&(t.unsubscribe(this._zoomChangedToken),this._zoomChangedToken=null),this._panChangedToken&&(t.unsubscribe(this._panChangedToken),this._panChangedToken=null);var e=this._experienceBase&&this._experienceBase.getManager("VCXContextManager").getActionBar();e&&(this._actionBar_sectionChangeToken&&e._modelEvents.unsubscribe(this._actionBar_sectionChangeToken),this._actionBar_openToken&&(e._modelEvents.unsubscribe(this._actionBar_openToken),this._actionBar_openToken=null),this._actionBar_closeToken&&(e._modelEvents.unsubscribe(this._actionBar_closeToken),this._actionBar_closeToken=null),e=null),this.buttonZoomFit.removeEvent(i.POINTERDOWN),this.buttonZoomFit.removeEvent(i.POINTERUP),this.buttonShowPaper.removeEvent(i.POINTERDOWN),this.buttonShowPaper.removeEvent(i.POINTERUP),this.buttonPan&&(this.buttonPan.removeEvent(i.POINTERDOWN),this.buttonPan.removeEvent(i.POINTERUP)),this.RemoveEvents(this.buttonZoomMinus),this.RemoveEvents(this.buttonZoomPlus),this._timeline&&this._timeline.removeEvent("change"),window.attachEvent?(window.detachEvent("expand",this._checkSizeCB),window.detachEvent("collapse",this._checkSizeCB),window.detachEvent("dockIsResizing",this._checkSizeCB),window.detachEvent("dockResize",this._checkSizeCB)):window.addEventListener&&(window.removeEventListener("expand",this._checkSizeCB,!0),window.removeEventListener("collapse",this._checkSizeCB,!0),window.removeEventListener("dockIsResizing",this._checkSizeCB,!0),window.removeEventListener("dockResize",this._checkSizeCB,!0)),this._checkSizeCB=null,this.mainPanel.parentNode&&this.mainPanel.parentNode.removeChild(this.mainPanel),this.mainPanel=null,this._experienceBase=null},createButton:function(e,t,n){return new UWA.Element("div",{html:"",class:e+" vcxPaperCtrlButton wux-button-icon-fi wux-ui-3ds-lg wux-afr-cmdstarter",title:n})},AddEvents:function(e,t,n,i){var a=this;e._useTouch=!1,e.addEvent("touchstart",function(){e.style.backgroundColor=a._iconPaperBackgroundOver,e._useTouch=!0;var t=e;return t.delta=5*i,n.UpdateSlider(n,t.delta,!1),t.delta+=5*i,t.waitPressTimer=window.setTimeout(function(){t.pressTimer=window.setInterval(function(){n.UpdateSlider(n,t.delta,!1),t.delta+=5*i},100)},300),!1}),e.addEvent("mouseover",function(){if(e._useTouch)return!1;e.style.backgroundColor=a._iconPaperBackgroundOver}),e.addEvent("mousemove",function(){}),e.addEvent("mouseup",function(){if(!0===e._useTouch)return!1;window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""}),e.addEvent("mousedown",function(){if(!0===e._useTouch)return!1;var t=e;return t.delta=5*i,e.style.backgroundColor=a._iconPaperBackgroundOver,n.UpdateSlider(n,t.delta,!1),t.waitPressTimer=window.setTimeout(function(){t.pressTimer=window.setInterval(function(){n.UpdateSlider(n,t.delta,!1),t.delta+=5*i},100)},300),!1}),e.addEvent("touchend",function(){window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""}),e.addEvent("mouseout",function(){e._useTouch=!1,window.clearTimeout(e.waitPressTimer),window.clearInterval(e.pressTimer),e.style.backgroundColor=""})},RemoveEvents:function(e){e.removeEvent("touchstart"),e.removeEvent("mouseover"),e.removeEvent("mousemove"),e.removeEvent("mouseup"),e.removeEvent("mousedown"),e.removeEvent("touchend"),e.removeEvent("mouseout")},UpdatePercentage:function(e){if("number"==typeof e._timelineProgress){e._timelineProgress;var t=0;t=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,e.zoomPaper=t/100,null===e._experienceBase||e._lockupdatePaper||(e._experienceBase.getManager("VCXPaperManager").Zoom=e.zoomPaper),e._timeline&&(e._timeline.elements.container.children[2].children[0].children[0].innerHTML=Math.floor(t)+" %")}},UpdateSlider:function(e,t,n){if("number"==typeof e._timelineProgress){var i=0;i=e._timelineProgress<=49?90/49*e._timelineProgress+10:e._timelineProgress>=51?6*e._timelineProgress-200:100,n?i=t:i+=t,e.zoomPaper=i/100,e._timelineProgress=i<=99?(i-10)/(90/49):i>=101?(i+200)/6:50,e._timelineProgress=Math.max(0,Math.min(100,e._timelineProgress)),e._timeline?e._timeline.setValue(e._timelineProgress):e.UpdatePercentage(e)}},CheckSize:function(e,t){if(1!==document.querySelectorAll("div.wux-ui-state-close").length){var n=0;if(e.elements.sectionsBar)n=e.elements.sectionsBar.getDimensions().outerWidth+50;else{var i=e.elements.container.childNodes[0].childNodes[2];i&&(n=i.getBoundingClientRect().left)}var a=t&&t.getBoundingClientRect().width;this._touchCompliant||n-parseInt(a)<0||0==e._isShownWhenLarge&&0==e._isShownWhenSmall?(t.classList.contains(t._styleBottom)&&t.classList.remove(t._styleBottom),!t.classList.contains(t._styleUp)&&t.classList.add(t._styleUp)):(t.classList.contains(t._styleUp)&&t.classList.remove(t._styleUp),!t.classList.contains(t._styleBottom)&&t.classList.add(t._styleBottom))}else t.classList.add(t._styleBottom)},SetZoomFactor:function(e){this.UpdateSlider(this,100*e.value,!0)},updatePaperArea:function(e){this.mainPanel.style.left=e.left+"px"},hide:function(){this.mainPanel.hide()},show:function(){this.mainPanel.show()},isHidden:function(){return this.mainPanel&&"none"===this.mainPanel.style.display}})}),define("DS/VCXWebGUI/VCXTabPageFrame",["UWA/Class","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/Layouts/SlidingViews","DS/VCXWebGUI/VCXSidePanelExtendable","DS/VCXWebGUI/VCXToolbarCtrl","DS/Windows/Panel","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebTreeGUI/assets/nls/VCXWebTreeGUI"],function(e,t,n,i,a,r,o,s,l){"use strict";return e.extend({init:function(e){var l=this;this.options=e,e.slidingViews._vcxuiSequencesMaster[0]={},e.slidingViews._vcxuiSequencesMaster[0].Menu=new UWA.Element("div",{class:"vcxuiSequencesMaster"});var c="Menu";if(this.options._experienceBase&&(c=s["VCXProperties.Menu"]),e.slidingViews.views.unshift({title:c,content:{html:e.slidingViews._vcxuiSequencesMaster[0].Menu,iframe:!1}}),e.immersiveFrame){this._panelMaster=new o({collapsibleFlag:!0,closeButtonFlag:!1,resizableFlag:!0,immersiveFrame:e.immersiveFrame,currentDockArea:e.sidePanel.currentDockArea,title:e.sidePanel.title,showTitleFlag:!1,minWidth:e.sidePanel.minWidth?e.sidePanel.minWidth:300,verticallyStretchableFlag:!0,movableFlag:!0,icon:e.sidePanel.icon,recId:e.recId}),e.immersiveFrame.addWindow(this._panelMaster),this._panel=this._panelMaster.elements._contentDiv,this._panel.style.width="inherit";var d=this._panelMaster.elements.container.parentNode;this.observer=new MutationObserver(function(n){n.forEach(function(n){e.sidePanel.usecallback&&e.sidePanel.usecallback(e.sidePanel.controller,Math.max(parseInt(0),parseInt(l._panelMaster.elements.container.parentNode.offsetWidth))),t.publish({event:"VCX_PANEL_RESIZED"}),e.sidePanel.controller&&"function"==typeof e.sidePanel.controller.updateToolbar&&e.sidePanel.controller.updateToolbar()})});d&&this.observer.observe(d,{attributes:!0,childList:!1,characterData:!0,subtree:!1,attributeOldValue:!0,attributeFilter:["style"]})}else{this._panel=new a(e.sidePanel);var p=e._uiLayer||this.options._experienceBase.getManager("VCXContextManager").getFrameWindow().getUIFrame();this._panel.inject(p)}for(var u in this._header=new UWA.Element("div",{html:"",class:e.classBaseNameCSS+"Header VCXPanelCtrlHeader"}).inject(l._panel),this._headerSeparator=new UWA.Element("div",{html:"",class:e.classBaseNameCSS+"HeaderSeparator VCXPanelCtrlHeaderSeparator"}).inject(this._header),this._wrapper=new UWA.Element("div",{html:"",class:e.classBaseNameCSS+"Wrapper VCXPanelCtrlWrapper",styles:{}}).inject(this._panel),this._footer=new UWA.Element("div",{html:"",class:e.classBaseNameCSS+"Footer VCXScenarioCtrlFooter",styles:{visibility:"visible",height:"0px",bottom:"0px",width:"100%",transition:"height 0.5s, visibility 0.5s",overflow:"hidden"}}).inject(this._panel),e.slidingViews.showPager=!1,e.immersiveFrame?e.slidingViews.prevPage=this._panelMaster.elements._titleP:e.slidingViews.prevPage=this._panel.elements.title,e.slidingViews.kinetic=!1,e.slidingViews._vcxuiSequencesMaster)if(0!==parseInt(u)&&e.slidingViews._vcxuiSequencesMaster.hasOwnProperty(u))for(var h in e.slidingViews._vcxuiSequencesMaster[u])e.slidingViews._vcxuiSequencesMaster[u].hasOwnProperty(h)&&this.addCreateMasterItem(h,parseInt(u));this._slidingViews=new i(e.slidingViews).inject(this._wrapper),this._slidingViews.getContent().setStyles({height:"100%"}),this._divSelectorGoToParent=new UWA.Element("div",{class:"vcxSlidingViewDirection vcxSlidingViewPrevious"}),e.immersiveFrame?this._panel.childNodes[0].insertBefore(this._divSelectorGoToParent,this._panel.childNodes[0].firstChild):this._panel.elements.title.insertBefore(this._divSelectorGoToParent,this._panel.elements.title.firstChild);var g=function(){l._display=0,l._panel.childNodes[0].firstChild.style.display="none",l._slidingViews.goToNthView(l._display),l._toolbar._titleName.innerHTML=l._slidingViews.options.views[0].title,l._toolbar.updateToolbar()};this._divSelectorGoToParent.addEvent(n.POINTERUP,function(e){g()}),this._slidingViews.goToNthView(e.slidingViews.displayTabAtStart),1===e.slidingViews.disableSlindingMenu&&(this.getGoToParent().style.display="none"),this.onResizeCB=function(){if(l.options._experienceBase&&l._panelMaster&&l.options._experienceBase.getManager("VCXGUIManager").getUsableArea()){var e=0;e=l._panelMaster.windowGroup?l._panelMaster.windowGroup.titleBarVisibleFlag?l._panelMaster.windowGroup.getTitleBar().offsetHeight:0:l._panelMaster.titleBarVisibleFlag?l._panelMaster.getTitleBar().offsetHeight:0;var t=l._header.offsetHeight,n=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0];n&&(l._wrapper.style.height=n.clientHeight-(e+t)-3+"px")}},window.attachEvent?(this._tokenScreenResize=window.attachEvent("onresize",this.onResizeCB),this._tokenFreeZoneResize=window.attachEvent("onfreeZoneResize",this.onResizeCB)):window.addEventListener&&(this._tokenScreenResize=window.addEventListener("resize",this.onResizeCB,!0),this._tokenFreeZoneResize=window.addEventListener("freeZoneResize",this.onResizeCB,!0));var m=e.sidePanel.title,C="";if(this.options._experienceBase){let t=s;this.options._i18n&&(t=this.options._i18n),e.appID&&(C=t.get(e.appID+m+".PanelTitle")),""===C&&(C=t.get("VCX"+m+".PanelTitle"))}this._toolbar=new r({controller:e.sidePanel.controller,title:C,parent:e.immersiveFrame?this._header:this._panel.elements.title,panel:this._panel}),1!==e.slidingViews.disableSlindingMenu&&(this._toolbar.getTextContainer().addEvent(n.POINTERUP,function(e){g()}),this._toolbar.getTextContainer().style.cursor="pointer")},unInitialize:function(){for(var e in window.attachEvent?(window.detachEvent(this._tokenScreenResize),window.detachEvent(this._tokenFreeZoneResize),delete this._tokenScreenResize,delete this._tokenFreeZoneResize):window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),window.removeEventListener("freeZoneResize",this.onResizeCB,!0),delete this._tokenScreenResize,delete this._tokenFreeZoneResize),this._divSelectorGoToParent.removeEvent(n.POINTERUP),this._divSelectorGoToParent.remove(),this._divSelectorGoToParent=null,this.observer&&this.observer.disconnect(),this._slidingViews=null,this._toolbar.getTextContainer().removeEvent(n.POINTERUP),this._toolbar.unInitialize(),this._toolbar=null,this._panelMaster?(this.options.immersiveFrame&&this.options.immersiveFrame.removeWindow(this._panelMaster),this._panelMaster=null):(this.getPanel().elements.container.parentNode.removeChild(this.getPanel().elements.container),this._panel.remove(),this._panel=null),this.options.slidingViews._vcxuiSequencesMaster)if(this.options.slidingViews._vcxuiSequencesMaster.hasOwnProperty(e))for(var t in this.options.slidingViews._vcxuiSequencesMaster[e])this.options.slidingViews._vcxuiSequencesMaster[e].row&&(this.options.slidingViews._vcxuiSequencesMaster[e].row.removeEvent(n.POINTERUP),this.options.slidingViews._vcxuiSequencesMaster[e].row.remove(),this.options.slidingViews._vcxuiSequencesMaster[e].row=null),this.options.slidingViews._vcxuiSequencesMaster[e].hasOwnProperty(t)&&this.options.slidingViews._vcxuiSequencesMaster[e][t]&&this.options.slidingViews._vcxuiSequencesMaster[e][t].unInitialize&&this.options.slidingViews._vcxuiSequencesMaster[e][t].unInitialize();this.options.slidingViews=null,this.options=null,this._panel=null,this.observer=null,this._header=null,this._headerSeparator=null,this._wrapper=null,this._footer=null,this.onResizeCB=null},tabWith:function(e){this._panelMaster&&(this._panelMaster.attachToWindow(e._panelMaster,WUXSnapAreaEnum.InsideArea),this._panelMaster.windowGroup)},getPanel:function(){return this._panel},getToolbar:function(){return this._toolbar},getContent:function(){return this._wrapper},getFooter:function(){return this._footer},getGoToParent:function(){return this._divSelectorGoToParent},addCreateMasterItem:function(e,t){var i=new UWA.Element("div",{class:"vcxuiSequencesMasterRow"});i.inject(this.options.slidingViews._vcxuiSequencesMaster[0].Menu),this.options.slidingViews._vcxuiSequencesMaster[t].row=i,new UWA.Element("div",{html:e,class:"vcxuiSequencesMasterCell"}).inject(i),new UWA.Element("div",{class:"vcxSlidingViewNext"}).inject(i);var a=t,r=this;i.addEvent(n.POINTERUP,function(e){var t;t=a,r._display=t,r._panel.childNodes[0].firstChild.style.display="",r._slidingViews.goToNthView(r._display),r._toolbar._titleName.innerHTML=r.options.slidingViews.views[r._display].title,r._toolbar.updateToolbar()})}})});var VCXThumbnailDisplayModeEnum={List:0,Small:1,Large:2,Tile:3};define("DS/VCXWebGUI/VCXScenarioCtrlExt",["UWA/Class","DS/CoreEvents/Events","DS/Core/PointerEvents","DS/VCXWebGUI/VCXUISequence","DS/VCXKeyFramer/VCXScenario","DS/VisuEvents/EventsManager","DS/Controls/ThumbnailView","DS/WebappsUtils/WebappsUtils","DS/VCXWebGUI/VCXTabPageFrame","DS/Layouts/GridEngine","DS/ApplicationFrame/CommandsManager","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdGoToScenarioWithInterpolation","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebVisualization/VCXPublishRasterImage","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/Visualization/ThreeJS_DS","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebProducts/assets/nls/VCXWebProducts","i18n!DS/VCXWebGUICommands/assets/nls/VCXWebGUICommands","i18n!DS/VCXWebProducts/assets/nls/VCXWebProductAuthoringCommands"],function(e,t,n,i,a,r,o,s,l,c,d,p,u,h,g,m,C,v,_,f,b,y){"use strict";return e.extend({onresizePanel:function(e,t){var n,i,a=0,r=0;for(n in e._thumbnailsList){var o=e._thumbnailsList[n];o.length>r&&(r=o.length)}if(r>0){var s=e.getItemDisplaySize()[0]+10;a=(i=Math.floor(t/s))*s}if(r>=i)for(var l in e._sequenceContent){var c=e._sequenceContent[l];c&&(c.style.width=a+"px")}e.updateToolbar()},isIE11:function(){return this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isIE11()},getItemDisplaySize:function(){var e=this.getThumbnailDisplaySize(),t=e[0],n=e[1];switch(this._displayMode){case VCXThumbnailDisplayModeEnum.List:return[t,50];case VCXThumbnailDisplayModeEnum.Small:return[t,n];case VCXThumbnailDisplayModeEnum.Large:return[1.5*t,1.5*n];case VCXThumbnailDisplayModeEnum.Tile:return[1.4*t+10,n]}},getThumbnailDisplaySize:function(){return[165,118]},init:function(e,n,a){var r=this;this.playerMode=Boolean(a),this._displayMode=VCXThumbnailDisplayModeEnum.Small,this._vcxGuiManager=e,this._sequenceContent={},this._thumbnailsList=[],this.options={_experienceBase:this._vcxGuiManager._experienceBase,_uiLayer:this._vcxGuiManager._uiLayer,classBaseNameCSS:"vcx-scenarios-",sidePanel:{title:"Scenarios",icon:{iconName:"camera",fontIconFamily:WUXManagedFontIcons.Font3DS},side:"left",minWidth:300,styles:{height:"100%"},controller:this,usecallback:this.onresizePanel,currentDockArea:4},onResizeCb:this.onResize,slidingViews:{displayTabAtStart:1,activateViewOn:1,_vcxuiSequencesMaster:{},views:[]},recId:"scenarioCtrlRec"},this._vcxGuiManager.immersiveFrame&&(this.options.immersiveFrame=this._vcxGuiManager.immersiveFrame);for(var o=1,s=0;s<n.length;++s)this.options.slidingViews._vcxuiSequencesMaster[o]={},this.options.slidingViews._vcxuiSequencesMaster[o][n[s]]=new i(this._vcxGuiManager._experienceBase,this),++o,this.options.slidingViews.views.push({title:n[s],content:{html:r.options.slidingViews._vcxuiSequencesMaster[s+1][n[s]],iframe:!1}});this.options.recId="scenarioCtrlRec",this._tabPageFrame=new l(this.options),this._tabPageFrame._header.addClassName("vcxNoMenu"),this.onCreateToolBarButtons(this.getFrame().getPanel()),this.updateToolbar(),this._bSelectionMode=!1,this._updateSceneSymbol=new UWA.Element("div",{class:"wux-ui-3ds fonticon-refresh vcx-updateScene-symbol",html:[]}),this.currentViewpoint={angle:-1,eyePos:null,sightDir:null},this._activeSequence=null,this._currentScenarioId=null,this.options.immersiveFrame?(this.getFrame().getPanel().style.minHeight="100%",this.getFrame().getPanel().style.minWidth="300px",this.getFrame().getPanel().style.width="300px"):(this.getFrame().getPanel().elements.content.style.minHeight="100%",this.getFrame().getPanel().elements.panel.style.minWidth="300px",this.getFrame().getPanel().elements.panel.style.width="300px"),this.activateDisplayStyle("Small");var c=r._vcxGuiManager._experienceBase;c.getManager("VCXSequenceManager");this.onResizeCB=function(){var e=c.getManager("VCXScenarioManager").GetScenarios()[r._currentScenarioId];r.ChangeTimelinePosition(e,r._currentScenarioId)},window.attachEvent?this._tokenResize=window.attachEvent("onresize",this.onResizeCB):window.addEventListener&&(this._tokenResize=window.addEventListener("resize",this.onResizeCB,!0)),this._tokenCreateThumb=t.subscribe({event:"VCX_CREATE_THUMBNAIL"},function(e){r.onCreateThumbnail(r,e)}),this._tokenScChanged=t.subscribe({event:"VCX_SCENARIO_CHANGED"},function(e){r.onScenarioChanged(r,e)}),this._tokenScMoved=t.subscribe({event:"VCX_SCENARIO_MOVED"},function(e){r.onScenarioMoved(r,e)}),this._tokenCurrentScenario=t.subscribe({event:"VCX_CURRENT_SCENARIO_CHANGED"},function(e){r.onCurrentScenarioChanged(e.GetID(),e)}),this._tokenBeginTrans=t.subscribe({event:"VCX_BEGIN_TRANSITION"},function(e){document.body.addClassName("waiting"),r.onCurrentScenarioChanged(e.scenario._ID,e.scenario),r.hideNeedForUpdate(),r.stopListeningToViewpointChange(),r.onBeginEndTransition(r,e)}),this._tokenBeginEndTrans=t.subscribe({event:"VCX_END_TRANSITION"},function(e){var t={};t.maxframe="number"==typeof e&&e||0,r.onBeginEndTransition(r,t),document.body.removeClassName("waiting")}),this._tokenSeqNameChanged=t.subscribe({event:"VCX_SEQUENCE_NAME_CHANGED"},function(e){r.onSequenceNameRefresh(r,e)}),this._tokenScenarioNameChanged=t.subscribe({event:"VCX_SCENARIO_NAME_CHANGED"},function(e){r.onScenarioNameRefresh(r,e)}),this._tokenScenarioReplaced=t.subscribe({event:"VCX_SCENARIO_REPLACED"},function(e){r.onScenarioReplaced(e.GetID(),e)}),this._tokenSeqChanged=t.subscribe({event:"VCX_SEQUENCE_CHANGED"},function(e){r.onSequenceChanged(r,e)}),this._tokenRefreshIcon=t.subscribe({event:"VCX_REFRESH_ICON"},function(e){r.RefreshAnimIcon(r,e)}),this.addImmersiveUIArrows()},unInitialize:function(){for(var e in window.focus(),this._sequenceContent){(i=this._sequenceContent[e]).cbonPrimaryPointerUpUnique&&r.removeEventFromToken(i.cbonPrimaryPointerUpUnique),i.removeEvent("dragend"),i.removeEvent("dragover"),i.grid&&i.grid.onCellRequest(null)}for(var e in this._thumbnailsList)for(var i=this._thumbnailsList[e],a=0;a<i.length;a++){var o=i[a];o._pointerDownToken&&(r.removeEventFromToken(o._pointerDownToken),o._pointerDownToken=null),o._pointerUpToken&&(r.removeEventFromToken(o._pointerUpToken),o._pointerUpToken=null),o.cbdragstart&&(o.elements.picture.removeEventListener("dragstart",o.cbdragstart),o.cbdragstart=null),o.cbdragenter&&(o.elements.picture.removeEventListener("dragenter",o.cbdragenter),o.cbdragenter=null),o.cbdragend&&(o.elements.picture.removeEventListener("dragend",o.cbdragend),o.cbdragend=null),o.cbdragover&&(o.elements.picture.removeEventListener("dragover",o.cbdragover),o.cbdragover=null),o.cbCheckBoxChange&&(o.elements.checkbox.removeEventListener("change",o.cbCheckBoxChange),o.cbCheckBoxChange=null),o.cbEditScenario&&(o.elements.container.removeEventListener("keydown",o.cbEditScenario,!0),o.elements.picture.removeEventListener("keydown",o.cbEditScenario,!0),o.cbEditScenario=null),o.cbOnClickScenario&&(o.elements.container.removeEventListener("click",o.cbOnClickScenario),o.elements.title.removeEventListener("click",o.cbOnClickScenario),o.cbOnClickScenario=null)}this._sequenceContent=[],this._thumbnailsList=[],t.unsubscribe(this._tokenCreateThumb),delete this._tokenCreateThumb,t.unsubscribe(this._tokenScChanged),delete this._tokenScChanged,t.unsubscribe(this._tokenScMoved),delete this._tokenScMoved,t.unsubscribe(this._tokenCurrentScenario),delete this._tokenCurrentScenario,t.unsubscribe(this._tokenScenarioReplaced),delete this._tokenScenarioReplaced,t.unsubscribe(this._tokenBeginTrans),delete this._tokenBeginTrans,t.unsubscribe(this._tokenBeginEndTrans),delete this._tokenBeginEndTrans,t.unsubscribe(this._tokenSeqNameChanged),delete this._tokenSeqNameChanged,t.unsubscribe(this._tokenScenarioNameChanged),delete this._tokenScenarioNameChanged,t.unsubscribe(this._tokenSeqChanged),delete this._tokenSeqChanged,t.unsubscribe(this._tokenRefreshIcon),delete this._tokenRefreshIcon,this.stopListeningToViewpointChange(),this._viewpointWatcher=null,this._vcxGuiManager._vcxTimeline&&(this.getFrame().getFooter().removeChild(this._vcxGuiManager._vcxTimeline.getView().getContainer()),this._vcxGuiManager._vcxTimeline.unInitialize(),this._vcxGuiManager.RemoveTimelineEvents(),this._vcxGuiManager._vcxTimeline=null),this._vcxGuiManager._vcxTimelineMain&&(this._vcxGuiManager._vcxTimelineMain.unInitialize(),this._vcxGuiManager._vcxTimelineMain=null),window.attachEvent?(window.detachEvent(this._tokenResize),delete this._tokenResize):window.addEventListener&&(window.removeEventListener("resize",this.onResizeCB,!0),delete this._tokenResize),this.onResizeCB=null,this._UIpreviousScenario.removeEventListener(n.POINTERDOWN,this.pointerDownOnCommandGoToPreviousScenarioCB),this._UInextScenario.removeEventListener(n.POINTERDOWN,this.pointerDownOnCommandGoToNextScenarioCB),this._UI_dot_Container.remove(),this._UIpreviousScenario.remove(),this._UInextScenario.remove(),this.getFrame().unInitialize()},getFrame:function(){return this._tabPageFrame},updateToolbar:function(){this.getFrame().getToolbar().updateToolbar()},onCreateToolBarButtons:function(e){var t=this,n=this.getFrame().getToolbar(),i=(s=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).getProdHighMode(),a=s.getExperienceIn3DPlay();if(this.playerMode&&(a||i)&&n.addMainItemFixed("VCXPlayGuidedTourCmd","","vcxToolbarButtonIconChecked","VCXWebProducts/VCXWebProducts",f,null,null,"VCX_PLAY_GUIDED_TOUR_START","VCX_PLAY_GUIDED_TOUR_END",!0),!this.playerMode){var r=this._vcxGuiManager._experienceBase.getManager("VCXExperience");r.updateLogData&&!0===r.updateLogData.showDialog&&n.addMainItemFixed("VCXShowUpdateViewCmd","","vcxToolbarButton wux-ui-3ds-update","VCXWebAuthoringCommands/VCXWebAuthoringCommands",y);var o=s&&s.getContext();d.getCommand("VCXCreateEmptyScenarioCmd",o);n.addMainItemFixed("VCXCreateEmptyScenarioCmd","","vcxToolbarButton fonticon-doc-add","VCXWebAuthoringCommands/VCXWebAuthoringCommands",y),n.addMainItemFixed("VCXAddCameraKeyCmd","","vcxToolbarButton fonticon-camera-refresh","VCXWebAuthoringCommands/VCXWebAuthoringCommands",y),n.addMainItemFixed("VCXCreateScenarioCmd","","vcxToolbarButton fonticon-plus","VCXWebAuthoringCommands/VCXWebAuthoringCommands",y);var s,l=[];l[0]=this,l[1]=this.setVisibilityAllChexkBox,l[2]=!0,n.addMainItemFixed(l,"","vcxToolbarButton vcxToolbarButtonSelect","VCXWebGUICommands/VCXWebGUICommands",b,null,"VCXSetVisibilityAllChexkBoxCmd"),(s=this._vcxGuiManager._experienceBase.getManager("VCXContextManager")).isSupported("Timeline")&&!s.getPlayerMode()&&n.addMainItem("VCXDisplayTimelineCmd","","vcxToolbarButton vcxToolbarButtonTimeline","VCXWebAuthoringAppGUICommands/VCXWebAuthoringAppGUICommands","i18n!DS/VCXWebAuthoringAppGUICommands/assets/nls/VCXWebAuthoringAppGUICommands"),n.addMainItemFixed("VCXDeleteSceneSelectionCmd","","vcxToolbarButton vcxToolbarButtonDelete","VCXWebAuthoringCommands/VCXWebAuthoringCommands",y,n.getEditToolbar()),n.addMainItemFixed("VCXReplaceScenarioCmd","","vcxToolbarButton vcxToolbarButtonUpdate","VCXWebAuthoringCommands/VCXWebAuthoringCommands",y,n.getEditToolbar())}var c=function(e){t.activateDisplayStyle(e)};n.addSubItemFixed(c,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayList","","",_["VCXScenario.Display.List"],"List"),n.addSubItemFixed(c,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplaySmall","","",_["VCXScenario.Display.Small"],"Small"),n.addSubItemFixed(c,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayLarge","","",_["VCXScenario.Display.Large"],"Large"),n.addSubItemFixed(c,"ScenarioViewOptions","vcxToolbarButton vcxToolbarButtonDisplayTile","","",_["VCXScenario.Display.Tile"],"Tile"),n.addMenu("","vcxToolbarButtonStarterMenuRight","vcxToolbarButton vcxToolbarButtonLayout","VCXWebGUI/VCXWebGUI",_,"VCXScenarioToolbarDisplayLayout");var p=[];p[0]=this,p[1]=this.setVisibilityAllChexkBox,p[2]=!1,n.addMenu(p,"vcxToolbarButtonStarterMenuRight vcxToolbarButtonStarterMenuRightEdit","vcxToolbarButton vcxToolbarButtonExit","VCXWebGUI/VCXWebGUI",_,"VCXScenarioToolbarExit",n.getEditToolbar()),n.activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplaySmall")},activateDisplayStyle:function(e){switch(this.getFrame().getToolbar().activeSubItemFixed("vcxToolbarButton vcxToolbarButtonDisplay"+e),this.getFrame().getPanel().removeClassName("vcx-displaySmall"),this.getFrame().getPanel().removeClassName("vcx-displayTile"),this.getFrame().getPanel().removeClassName("vcx-displayList"),this.getFrame().getPanel().removeClassName("vcx-displayLarge"),this.getFrame().getPanel().addClassName("vcx-display"+e),e){case"Tile":this._displayMode=VCXThumbnailDisplayModeEnum.Tile;break;case"List":this._displayMode=VCXThumbnailDisplayModeEnum.List;break;case"Large":this._displayMode=VCXThumbnailDisplayModeEnum.Large;break;case"Small":this._displayMode=VCXThumbnailDisplayModeEnum.Small}this.onResize()},loadScenariosFromExperience:function(){var e=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListSequences();this.addSequences(this,e)},addSequences:function(e,t){for(var n=0;n<t.length;n++){var i=t[n],a=n-1;e.createSequence(i,a,e)}},getUISequenceTarget:function(e){for(var t in this.options.slidingViews._vcxuiSequencesMaster)for(var n in this.options.slidingViews._vcxuiSequencesMaster[t]){if(e===n)return this.options.slidingViews._vcxuiSequencesMaster[t][n];var i=n.split("|");for(var a in i)if(e===i[a])return this.options.slidingViews._vcxuiSequencesMaster[t][n]}return this.options.slidingViews._vcxuiSequencesMaster[1][Object.keys(this.options.slidingViews._vcxuiSequencesMaster[1])[0]]},getUISequenceIndex:function(e,t){var n=0;for(n in e.elements.items){if(e.elements.items[n].childNodes[0].childNodes[1].innerHTML===t)break}return n},createSequence:function(e,t,n){var i=e.GetID(),a=e.GetName();"CAD Captures"!==a&&"CAD Views"!==a||n._tabPageFrame._header.removeClassName("vcxNoMenu");var o=t+1,s=this.getUISequenceTarget(a);0===o&&(o=s.itemLength),s.addItem(o,{text:a});var l=n._sequenceContent[i]=new UWA.Element("div",{class:"VCX container-fluid hidden-print vcx-fluid-content",html:[]});l.sequenceIndex=o,s.setContent(o,l),l.addEvent("dragover",function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(e.target.hasClassName("VCX container-fluid")){var t="";t=n.amIBefore(n.dragged.elements.container,n.dropTarget)?"afterend":"beforeBegin",n.dropTarget&&n.isThereBrotherAround(e)||(n.dropSequence=n.getSequenceDrop(e),n.dropTarget=n.getLastThumnbailFromSequence(n.dropSequence),t="afterend"),n.dropTarget.elements.container.insertAdjacentElement(t,n.dragged.elements.container),e.preventDefault()}}),l.addEvent("dragend",function(e){var t=n._vcxGuiManager._experienceBase,i=t.getManager("VCXSequenceManager").GetSequenceFromScenarioId(n.dragged.scenarioID),a="";i&&(a=i.GetID());var r=-1;n.dropTarget&&(n.dropSequence=n.dropTarget.elements.container.parentNode.getAttribute("sequenceid"),r=Array.prototype.indexOf.call(n.dropTarget.elements.container.parentNode.children,n.dragged.elements.container)),n.moveScenarioView(n.dragged.scenarioID,a,n.dropSequence,r);var o=new C(t.getManager("VCXSequenceManager"),t.getManager("VCXCommandManager"),t.ComponentsMap);o.MoveScenario(n.dragged.scenarioID,n.dropSequence,r),t.getManager("VCXCommandManager").Push(o)});var d=s.elements.items[o];d.sequenceId=i;var p=d.getElementsByClassName("VCXUISequence-title")[0];d.counterThumbs=new UWA.Element("div",{html:"0",class:"VCXcounterThumbs",styles:{}}),d.counterThumbs.inject(p),1===s.itemLength?(s.elements.container.childNodes[0].childNodes[0].style.opacity="0",s.elements.container.childNodes[0].childNodes[0].style.marginBottom="-15px"):(s.elements.container.childNodes[0].childNodes[0].style.opacity="",s.elements.container.childNodes[0].childNodes[0].style.marginBottom=""),n.activeSequence(d),l.cbonPrimaryPointerUpUnique=r.addEvent(l.parentNode,"onPrimaryPointerUpUnique",function(){n.activeSequence(d)}),l.sequenceID=i,l.setAttribute("SequenceID",i);for(var u=n._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios(),h=e.GetListScenariosId(),g=(n._thumbnailsList[i]=[],0);g<h.length;g++){var m=h[g];n.createScenarioView(u[m],n,e.GetID(),g)}this.setSequenceState(a,!0),l.grid=new c({model:n._thumbnailsList[i],defaultCellWidth:300,defaultCellHeight:200,showRowsHeader:!0,showColumnsHeader:!0,headersDimensions:{width:20,height:20}}),l.grid.onCellRequest(function(e,t){var n=e.virtualColumnID;if(t._thumbnailsList[n]){var i=t._thumbnailsList[n];e.cellView.getContent().setHTML(i)}})},createScenarioView:function(e,t,i,o){var l=t._vcxGuiManager._experienceBase;l.getManager("VCXSequenceManager");if(i);else{var c=l.getManager("VCXSequenceManager").GetListSequences();i=c[0].GetID()}var d=0;-1!==o&&(d=o);var p=this._thumbnailsList[i][d],u=!1;if(!p||p.scenarioID&&p.scenarioID!==e.GetID()){u||(p=t.createThumbnailView(e,t,i,o)),(t=this).playerMode?p.elements.thumbnail.draggable=!1:p.elements.thumbnail.draggable=!0,p.cbdragstart=function(e){if(!this.draggable)return e.preventDefault(),void e.stopPropagation();t.dropTarget=p,e.dataTransfer.setData("scene",e.target.id),e.dataTransfer.effectAllowed="move",t.dragged=p,t.dragged.elements.container.classList.add("vcxDrag")},p.elements.thumbnail.addEventListener("dragstart",p.cbdragstart,!1),p.cbdragenter=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else if(t.dropTarget=p,e.preventDefault(),void 0===t.dragged&&(t.dragged=p),t.dragged.elements.picture!==e.toElement){var n="";n=t.amIBefore(t.dragged.elements.container,p.elements.container)?"afterend":"beforeBegin",p.elements.container.insertAdjacentElement(n,t.dragged.elements.container),t.dropTarget=p}},p.elements.thumbnail.addEventListener("dragenter",p.cbdragenter,!1),p.cbdragover=function(e){if(1!==e.dataTransfer.types.length&&e.dataTransfer.types.includes("text/plain"))e.dataTransfer.dropEffect="none";else{if(!this.draggable)return e.preventDefault(),void e.stopPropagation();e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault()}},p.elements.thumbnail.addEventListener("dragover",p.cbdragover,!1),p.cbdragend=function(e){t.dragged.elements.container.classList.remove("vcxDrag")},p.elements.thumbnail.addEventListener("dragend",p.cbdragend,!1),p.cbdrop=function(e){(e=e||event).preventDefault()},p.elements.thumbnail.addEventListener("drop",p.cbdrop,!1);var h=e.GetName();p.setTitle(h),p.scenarioID=e.GetID(),p.scenarioIndex=d,p.elements.thumbnail._scenarioID=e.GetID(),e.HasAnimation()&&(p.elements.title.style.left="30px !important",p.elements.subtitle.style.left=p.elements.title.style.left,p.elements.icon.addClassName("hasAnimation"));var g=null,m=e.GetDocId(),C=l.getManager("VCXDocManager").GetPropPath(m);if(C)g=C.GetValueURL().GetValue();if("Animation smg"===h)p.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png"));else if(g){var v=new XMLHttpRequest;v.open("GET",g,!0),v.responseType="blob",v.onload=function(e){if(200==this.status){var t=this.response,n=new FileReader;n.onload=function(e){p.setPicture(e.target.result)},n.readAsDataURL(t)}},v.send()}else e.GetScenarioType()===a.EScenarioType.CADView?p.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADViews.png")):e.GetScenarioType()===a.EScenarioType.CADCapture?p.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_CADCaptures.png")):e.GetScenarioType()===a.EScenarioType.Layer?p.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Layer.png")):this.onScenarioReplaced(e.GetID(),e);var _=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(i).GetName(),f=this.getUISequenceTarget(_);if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getShowRoomMode());else{t.targetInteraction=null,p._pointerDownToken=r.addEvent(p.elements.container,"onPrimaryPointerDownUnique",function(e){f.elements.items[t._sequenceContent[i].sequenceIndex];p.elements.checkbox.elements.container.focus()}),p.cbEditScenario=function(n){"F2"===n.key&&(e.GetID()===t._currentScenarioId||p.elements.container.hasClassName("vcxItemSelected"))&&setTimeout(function(){console.log("F2"),p.elements.title.focus()},0)},p.cbOnClickScenario=function(a){var r=function(e){(a.path&&a.path[0]||a.currentTarget).hasClassName("vcx-controls-thumbnail-title")||(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o))},o=function(e){"Enter"===e.key?(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o),p.elements.title.contentEditable=!0):"Escape"===e.key&&(t.endRenameScenario(!0),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o),p.elements.title.contentEditable=!0)};if(!(s=a.path&&a.path[0]||a.currentTarget).hasClassName("vcx-controls-thumbnail-title")||t.playerMode||t.getFrame().getToolbar().isEditMode()){""!==t.startEditScenarioID&&(t.endRenameScenario(),document.removeEventListener(n.POINTERDOWN,r),document.removeEventListener("keydown",o));var s=a.target;if(t.targetInteraction=s,!t.targetInteraction||t.targetInteraction!=s)return void(t.targetInteraction=null);if(a&&a.gesture&&a.gesture.currentEvent[0]&&a.gesture.currentEvent[0].currentPosition.distanceTo(a.gesture.currentEvent[0].startPosition)>8)return void(t.targetInteraction=null);if(s.hasClassName("wux-ui-fa")||s.hasClassName("vcx-controls-checkbox"))return t.targetInteraction=null,!1;t.targetInteraction=null,t.activeSequence(f.elements.items[t._sequenceContent[i].sequenceIndex]);var l=e.GetID();if(t.getFrame().getToolbar().isEditMode())p.elements.checkbox.toggle();else if(t._vcxGuiManager.GoToScenarioContext()){if(t.setVisibilityAllChexkBox(!1),t.onCurrentScenarioChanged(l,e),void 0!==t._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().DSWebRecord){require(["DS/WebRecordEnabler/Adapter"],function(e){e.TraceManager.debug("ADD document.waitConditionScenario"),document.waitConditionScenario=e.WaitManager.addWaitCondition(2e4,"Wait go to scenario"),t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l,function(){e.TraceManager.debug("REMOVE document.waitConditionScenario"),e.WaitManager.removeWaitCondition(document.waitConditionScenario),document.waitConditionScenario=null})})}else t._vcxGuiManager._experienceBase.getManager("VCXAPIManager").GoToScenario(l);if(t._vcxGuiManager._vcxTimelineExtCtrl&&t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel){var c=t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display;t._vcxGuiManager._uiLayer.removeChild(t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel),t._vcxGuiManager.InitTimelineExtCtrl(l),t._vcxGuiManager._vcxTimelineExtCtrl._mainPanel.style.display=c}}}else a.stopPropagation(),document.addEventListener(n.POINTERDOWN,r),document.addEventListener("keydown",o),t.startEditScenarioID=e.GetID()},this._vcxGuiManager.isTouchActivated()?(p.elements.container.addEventListener("touchstart",p.cbOnClickScenario),p.elements.title.addEventListener("touchstart",p.cbOnClickScenario)):(p.elements.container.addEventListener("click",p.cbOnClickScenario),p.elements.title.addEventListener("click",p.cbOnClickScenario)),p.elements.container.addEventListener("keydown",p.cbEditScenario,!0),p.elements.picture.addEventListener("keydown",p.cbEditScenario,!0);var b=f.elements.items[t._sequenceContent[i].sequenceIndex];b.counterThumbs.innerHTML=parseInt(b.counterThumbs.innerHTML)+1}}else u=!0},endRenameScenario:function(e){if(e)for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){if((r=n[i]).scenarioID===this.startEditScenarioID){var a=(s=(o=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().GetValue();return r.elements.title.innerHTML=a,void(this.startEditScenarioID="")}}else for(var t in this._thumbnailsList)for(n=this._thumbnailsList[t],i=0;i<n.length;i++){var r;if((r=n[i]).scenarioID===this.startEditScenarioID){var o,s,l=r.elements.title.innerHTML,c=new h(this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"));return(s=(o=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetScenarios()[r.scenarioID].QueryInterface("VCXIModifiable")).GetProperty("Actor.Name")).GetPropertyValue().SetValue(l),c.ChangeProperty(o,s),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(c),void(this.startEditScenarioID="")}}},isThereBrotherAround:function(e){var t=[{x:20,y:20},{x:20,y:-20},{x:-20,y:-20},{x:-20,y:20}],n=e.clientX,i=e.clientY,a=null;for(var r in t){var o=t[r];if(n+=o.x,i+=o.y,(a=document.elementsFromPoint(n,i)[0])&&(a.hasClassName("vcx-controls-thumbnail-picture")||a.hasClassName("vcx-controls-thumbnail-title")))return this.getThumbnailFromDiv(a)}return null},getSequenceDrop:function(e){for(var t in this._sequenceContent)if(this._sequenceContent[t]===e.target)return t},getLastThumnbailFromSequence:function(e){var t=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(e).GetListScenariosId().slice(-1)[0];for(var n in this._thumbnailsList)for(var i=this._thumbnailsList[n],a=0;a<i.length;a++){var r=i[a];if(r.scenarioID===t)return r}return null},getThumbnailFromDiv:function(e){for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){var a=n[i];if(a.elements.picture===e||a.elements.title===e)return a}return null},amIBefore:function(e,t){for(var n=t.previousElementSibling;n;){if(n===e)return!0;n=n.previousElementSibling}return!1},RefreshAnimIcon:function(e,t){var n=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID()),i=n.GetIndexOfScenario(t.GetID()),a=e._thumbnailsList[n.GetID()][i];t.HasAnimation()&&(a.elements.title.style.left="30px !important",a.elements.subtitle.style.left=a.elements.title.style.left,a.elements.icon.addClassName("hasAnimation"))},RefreshTimeline:function(e,t){if(this.playerMode||this._vcxGuiManager._experienceBase.odt||this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("Timeline")){var n=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(this._vcxGuiManager.deleteTimeline(),e&&e.HasAnimation()){this.getFrame().getContent().style.maxHeight=n-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible";var i=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();if(this._vcxGuiManager.InitTimelineCtrl(t,i),this._vcxGuiManager._vcxTimelineCtrl._timelines&&this._vcxGuiManager._vcxTimelineCtrl._timelines[1]){var a=this._vcxGuiManager._vcxTimelineCtrl._timelines[1].timeline.getView().getParentPanel().currentDockArea;this._vcxGuiManager._vcxTimelineCtrl.options.frmWindow.getImmersiveFrame().getDockingElement(a).collapseDockingZoneFlag=!1}this._vcxGuiManager._forceDisplayTimeline=!0}else this.getFrame().getContent().style.maxHeight=n+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"}},ChangeTimelinePosition:function(e,t){var n=document.getElementsByClassName("wux-windows-docking-element-collapser wux-docking-element-left")[0].clientHeight-54-2;if(e&&e.HasAnimation()){var i=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentFrame();null===this._vcxGuiManager._vcxTimelineCtrl&&this._vcxGuiManager.InitTimelineCtrl(t,i),this.getFrame().getContent().style.maxHeight=n-61+"px",this.getFrame().getFooter().style.height="50px",this.getFrame().getFooter().style.visibility="visible"}else this.getFrame().getContent().style.maxHeight=n+"px",this.getFrame().getFooter().style.height="0px",this.getFrame().getFooter().style.visibility="hidden"},onCreateThumbnail:function(e,t){var n=e._vcxGuiManager._experienceBase,i=t.scenario,a=t.sequenceId,r=parseInt(t.prevIndex),o=e._thumbnailsList[a],l=o[r+1];e.createThumbnailView(i,e,a,r,l),l=o[r+1],i._name&&"Animation smg"===i._name?l.setPicture(s.getWebappsAssetUrl("VCXWebGUI","texture/gui/I_VCX_Thumbnail_Animation.png")):e.capturePixels().then(function(e){var t=m.dataURLToBlob(e),a=window.URL.createObjectURL(t);if(l){l.setPicture(e);var r=a,o=n.getManager("VCXDocManager").BuildPathFromString(r),s=n.getManager("VCXDocManager").AddOrModifyDoc(o),c=i.QueryInterface("VCXIModifiable");i.SetDocId(s._value),n.getManager("VCXScenarioManager").AddNeutrals(c,c.GetProperties())}})},GetActiveSequenceId:function(){return this._activeSequence?this._activeSequence.sequenceId:null},activeSequence:function(e){e!==this._activeSequence&&(this._activeSequence&&this._activeSequence.removeClassName("vcxActiveSequence"),this._activeSequence=e,this._activeSequence.addClassName("vcxActiveSequence"))},setSequenceState:function(e,t){var n=this.getUISequenceTarget(e);if(n){var i=this.getUISequenceIndex(n,e);i&&n.setSequenceItemOpenedState(i,t)}},setDescription:function(e,t){var n=this._vcxGuiManager._experienceBase;let i=n.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID();n.getManager("VCXSequenceManager").GetSequenceFromId(i).GetName();var a=this._thumbnailsList[i];for(var r in a){if(a[r].scenarioID===e){var o=a[r];o.elements.container.removeClassName("vcx-no-description"),o.elements.subtitle.innerHTML=t;break}}},editDescription:function(e){},createThumbnailView:function(e,t,n,i,a){if(t._activeSequence){var r=t._activeSequence;t.activeSequence(r)}var s=a;if(s);else{(s=new o({size:"small"}).inject(t._sequenceContent[n])).elements.transition=new UWA.Element("div",{html:"",class:"vcxTransition"}).inject(s.elements.container),s.elements.transitionBack=new UWA.Element("div",{html:"",class:"vcxTransitionBack"}).inject(s.elements.container),s.elements.container.id=e.GetID(),s.elements.container.setAttribute("data-rec-id",e.GetID()),s.elements.container.addClassName("vcx-controls-thumbnail"),s.elements.container.getCheckpointData=this.getThumbnailDataForRecord,t._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PaperControlV2")&&s.elements.container.addClassName("vcx-ratio-compliant"),s.elements.picture.setAttribute("data-rec-id",e.GetID()+"-picture"),s.elements.picture.addClassName("vcx-controls-thumbnail-picture"),s.elements.cartouche.setAttribute("data-rec-id",e.GetID()+"-cartouche"),s.elements.cartouche.addClassName("vcx-controls-thumbnail-cartouche"),s.elements.cartouche.getChildren()[0].setAttribute("data-rec-id",e.GetID()+"-cartouche-content"),s.elements.title.setAttribute("data-rec-id",e.GetID()+"-title"),s.elements.title.addClassName("vcx-controls-thumbnail-title"),s.elements.subtitle.setAttribute("data-rec-id",e.GetID()+"-subtitle"),s.elements.subtitle.addClassName("vcx-controls-thumbnail-subtitle"),s.elements.subtitle.innerHTML="",s.elements.container.addClassName("vcx-no-description"),s.elements.icon.addClassName("vcx-controls-thumbnail-icon"),s.elements.picture.childNodes[0].addClassName("vcx-controls-checkbox");var l=0;-1!==i&&(l=i,t.insertIndex(s.elements.thumbnail,l)),t._thumbnailsList[n].splice(l,0,s),s.elements.menu.innerHTML="",s.elements.menu.addClassName("vcx-controls-thumbnail-menu");var c=t._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromId(n).GetName(),d=this.getUISequenceTarget(c);t.playerMode&&(s.elements.checkbox.elements.container.style.display="none"),s.cbCheckBoxChange=function(i){if(!t.playerMode){t.activeSequence(d.elements.items[t._sequenceContent[n].sequenceIndex]);var a=i.dsModel.checkFlag;a?(t.setVisibilityAllChexkBox(!0),s.elements.container.addClassName("vcxItemSelected")):(s.elements.container.removeClassName("vcxItemSelected"),t.getFrame().getToolbar().activateEditMode());var r=new p(t._vcxGuiManager._experienceBase.getManager("VCXSelectionManager"));a?r.AddToSelection(e):r.RemoveFromSelection(e),t._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Do(r)}},s.elements.checkbox.addEventListener("change",s.cbCheckBoxChange)}return t.options.immersiveFrame?t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().style.minWidth),parseInt(t.getFrame().getPanel().offsetWidth))):t.onresizePanel(t,Math.max(parseInt(t.getFrame().getPanel().elements.panel.style.minWidth),parseInt(t.getFrame().getPanel().elements.panel.offsetWidth))),s},getThumbnailDataForRecord:function(e){var t={};t.value=this.getAttributeNames(),e(t,!0)},onResize:function(e){var t=e||this;t.onresizePanel(t,Math.max(parseInt(0),parseInt(t.getFrame()._panelMaster.elements.container.parentNode.offsetWidth)))},index:function(e){for(var t=e.parentNode.childNodes,n=0;n<t.length;n++){if(t[n]===e)return n}return 0},insertIndex:function(e,t){var n=e.parentNode.childNodes[t];return this.index(e)>t?e.parentNode.insertBefore(e,n):e.parentNode.insertBefore(e,n.nextSibling),e},checkAllCheckBox:function(){for(var e in this._thumbnailsList)for(var t=this._thumbnailsList[e],n=0;n<t.length;n++){if(t[n].elements.checkbox.checkFlag)return!0}return!1},setVisibilityAllChexkBox:function(e){var t=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();this.setThumbnailCheckBox(e,t)},getNbItems:function(){var e=0;for(var t in this._thumbnailsList){e+=this._thumbnailsList[t].length}return e},getNbSelectedItems:function(){var e=0;for(var t in this._thumbnailsList)for(var n=this._thumbnailsList[t],i=0;i<n.length;i++){n[i].elements.checkbox.checkFlag&&e++}return e},setThumbnailCheckBox:function(e,t){var n,i,a,r=this._activeSequence;for(var o in e?(n="VCXCheckBoxOn",i="VCXCheckBoxOff",a=!1):(n="VCXCheckBoxOff",i="VCXCheckBoxOn",a=!0),this._thumbnailsList)for(var s=this._thumbnailsList[o],l=0;l<s.length;l++){var c=s[l];c.elements.container.hasClassName(n)||(c.elements.container.removeClassName(i),c.elements.container.addClassName(n),c.elements.title.contentEditable=!!a,c===t||e||(c.elements.checkbox.checkFlag=!1,c.elements.container.removeClassName("vcxItemSelected")))}e?this.getFrame().getToolbar().activateEditMode():(this.getFrame().getToolbar().exitEditMode(),this.activeSequence(r))},onScenarioMoved:function(e,t){e.moveScenarioView(t.scenarioToAdd.GetID(),t.sequenceIdForRemove,t.sequenceIdForAdd,t.scenarioAddIdx)},onScenarioChanged:function(e,t){var n=e._vcxGuiManager._experienceBase;if(t.scenarioToAdd){var i=n.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForAdd),a=i.GetIndexOfScenario(t.scenarioToAdd.GetID());e.createScenarioView(t.scenarioToAdd,e,t.sequenceIdForAdd,a);var r=n.getManager("VCXSequenceManager").GetIndexOfSequence(i),o=i.GetName(),s=e.getUISequenceTarget(o);if(!s.isSequenceOpened(r)){var l=e.getUISequenceIndex(s,o);s.sequenceOpenedItem(l)}if(t.bLinked&&e._selectedScenarioIds)for(var c=n.getManager("VCXScenarioManager").GetScenarios(),d=0;d<e._selectedScenarioIds.length;d++){var u=c[e._selectedScenarioIds[d]];if(u){var h=new p(n.getManager("VCXSelectionManager"));h.RemoveFromSelection(u),n.getManager("VCXCommandManager").Do(h)}}}else if(t.scenarioToRemove){e.removeScenarioView(t.scenarioToRemove.GetID(),t.sequenceIdForRemove);var g=n.getManager("VCXSequenceManager").GetSequenceFromId(t.sequenceIdForRemove);if(!n.getManager("VCXCommandManager")._isUnDoRunning&&!t.bLinked){var m=new p(n.getManager("VCXSelectionManager")),C=g.FindScenario(t.scenarioRemovedIdx);C&&m.SetSelection(C),n.getManager("VCXCommandManager").Do(m)}}},removeScenarioView:function(e,t){var n=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager");t||(t=n.GetSequenceFromScenarioId(e).GetID());var i=n.GetSequenceFromId(t).GetName(),a=this.getUISequenceTarget(i),r=this._thumbnailsList[t];for(var o in r){if(r[o].scenarioID===e){var s=r[o];this._sequenceContent[t].removeChild(s.elements.thumbnail),this._thumbnailsList[t].splice(o,1);var l=a.elements.items[this._sequenceContent[t].sequenceIndex];l.counterThumbs.innerHTML=parseInt(l.counterThumbs.innerHTML)-1;break}}},moveScenarioView:function(e,t,n,i){var a=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager");if(t);else{var r=a.GetSequenceFromScenarioId(e);if(null===r)return void console.log("error - Scenario "+e+" unknown in Sequence Manager");t=r.GetID()}var o=a.GetSequenceFromId(t).GetName(),s=this.getUISequenceTarget(o),l=a.GetSequenceFromId(n).GetName(),c=this.getUISequenceTarget(l),d=this._thumbnailsList[t];for(var p in d){if(d[p].scenarioID===e){var u=d[p];if(i<0&&(i=this._thumbnailsList[n].length),this._thumbnailsList[n].splice(i,0,this._thumbnailsList[t].splice(p,1)[0]),t!==n){0===this._sequenceContent[n].childNodes.length?this._sequenceContent[n].insertAdjacentElement("afterBegin",u.elements.container):i>=this._sequenceContent[n].childNodes.length?this._sequenceContent[n].insertAdjacentElement("beforeend",u.elements.container):this._sequenceContent[n].childNodes[i].insertAdjacentElement("beforeBegin",u.elements.container)}else{var h;if(this._sequenceContent[n].childNodes[i]._scenarioID!==e)h=this.amIBefore(u.elements.container,this._sequenceContent[n].childNodes[i])?"afterend":"beforeBegin",this._sequenceContent[n].childNodes[i].insertAdjacentElement(h,u.elements.container)}var g=s.elements.items[this._sequenceContent[t].sequenceIndex];g.counterThumbs.innerHTML=parseInt(g.counterThumbs.innerHTML)-1;var m=c.elements.items[this._sequenceContent[n].sequenceIndex];m.counterThumbs.innerHTML=parseInt(m.counterThumbs.innerHTML)+1;break}}},onCurrentScenarioChanged:function(e,t){if("VCX_Scenario_Transition"!==e){this.addImmersiveUIDotsFromCurrentSequence(),this.hideNeedForUpdate();var n=0,i=0;for(var a in this._thumbnailsList)for(var r=this._thumbnailsList[a],o=0;o<r.length;o++){var s=r[o];s.elements.transition.removeClassName("vcxActiveScenario"),s.elements.transitionBack.removeClassName("vcxActiveScenarioBack"),s.elements.transition.style.webkitTransition="",s.elements.transition.style.transition="",s.elements.transition.style.mozTransition="",s.elements.title.contentEditable=!0,s.scenarioID===e&&(n=s,i=a)}if(n){n.elements.transition.addClassName("vcxActiveScenario"),n.elements.transitionBack.addClassName("vcxActiveScenarioBack"),this.playerMode||this.getFrame().getToolbar().isEditMode()||(n.elements.title.contentEditable=!0),this.scrollToThumbnail(n);var l=this._vcxGuiManager._experienceBase,c=l.getManager("VCXSequenceManager").GetSequenceFromId(i),d=(l.getManager("VCXSequenceManager").GetIndexOfSequence(c),c.GetName()),p=this.getUISequenceTarget(d),u=parseInt(this.getUISequenceIndex(p,d));this.activeSequence(p.elements.items[u])}t&&e!==this._currentScenarioId&&"VCX_Scenario_Transition"!==e&&(this._currentScenarioId=e,this.RefreshTimeline(t,e)),this._currentScenarioId=e}},scrollToThumbnail:function(e){var t=this.getFrame().getContent().getElementsByClassName("wux-layouts-slidingviews-page-content");if(4!==t.length)console.error("Scene panel structure has changed. Automatic scroll will not take place.");else{var n=t[1],i=this.getFrame().getContent().scrollHeight,a=(n.scrollHeight,e.elements.container.scrollHeight),r=e.elements.container.offsetTop,o=n.scrollTop;if(r+a>o+i)n.scrollBy({top:r+a-(o+i),behavior:"smooth"});else{if(!(r<o))return;n.scrollBy({top:r-o-10,behavior:"smooth"})}}},onBeginEndTransition:function(e,t){for(var n=document.getElementsByClassName("VCXScenarioUI_loading"),i=0;i<n.length;i++)n[i].style.animation="mask "+(t.maxframe+.25)+"s steps(1, end) infinite, morepos "+(t.maxframe+.25)+"s steps(1, end) infinite",0===t.maxframe&&n[i].addClassName("hide");if(0!==t.maxframe){n=document.getElementsByClassName("VCXspinner");for(i=0;i<n.length;i++)n[i].style.animation="rota "+(t.maxframe+.25)+"s linear infinite";n=document.getElementsByClassName("VCXfiller");for(i=0;i<n.length;i++)n[i].style.animation="opa "+(t.maxframe+.25)+"s steps(1, end) infinite"}if(e._currentScenarioId)for(var i in e._thumbnailsList){var a=e._thumbnailsList[i];for(var r in a){var o=a[r];if(o.scenarioID===e._currentScenarioId){o.elements.transition.removeClassName("vcxActiveScenario");o.elements.transition.offsetTop;o.elements.transition.removeClassName("vcxNOTransition");var s="height "+t.maxframe+"s linear";if(o.elements.transition.style.webkitTransition=s,o.elements.transition.style.transition=s,o.elements.transition.style.mozTransition=s,o.elements.transition.addClassName("vcxActiveScenario"),0===t.maxframe){o.elements.transition.addClassName("vcxNOTransition");o.elements.transition.offsetTop;o.elements.transition.removeClassName("vcxNOTransition")}}}}},onScenarioNameRefresh:function(e,t){var n=e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(t.GetID());if(n)for(var i=t.GetName(),a=this._thumbnailsList[n.GetID()],r=0;r<a.length;r++){var o=a[r];if(o.scenarioID===t.GetID()){o.setTitle(i);break}}},onScenarioReplaced:function(e,t){this.onScenarioNameRefresh(this,t);var n=this,i=this._vcxGuiManager._experienceBase;this.hideNeedForUpdate();var a=t.GetDocId(),r=i.getManager("VCXDocManager").GetPropPath(a);if(r){var o=r.GetValueURL().GetValue();if(o){var s=new XMLHttpRequest;s.open("GET",o,!0),s.responseType="blob",s.onload=function(t){if(200==this.status){var a=this.response,r=new FileReader;r.onload=function(t){var a=i.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e).GetID(),r=i.getManager("VCXSequenceManager").GetSequenceFromId(a).GetIndexOfScenario(e);n._thumbnailsList[a][r].setPicture(t.target.result)},r.readAsDataURL(a)}},s.send()}}},onSequenceNameRefresh:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetIndexOfSequence(t)},onSequenceChanged:function(e,t){e._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListSequences();if(t&&t.sequenceToRemove){var n=t.sequenceToRemove,i=n.GetName(),a=e._sequenceContent[n.GetID()].sequenceIndex-1,r=e.getUISequenceTarget(i);r.deleteItem(a),e._sequenceContent[n.GetID()]=null,delete e._thumbnailsList[n.GetID()],e.activeSequence(r.elements.items[0])}t&&t.sequenceToAdd&&e.createSequence(t.sequenceToAdd,t.previousSeqIndex,e)},capturePixels:function(){var e=this._vcxGuiManager._experienceBase,t=new g,n=this.getThumbnailDisplaySize(),i=2*n[0],a=2*n[1];return t.doThumbnailToDataUrl(e,i,a)},pointerDownOnCommandGoToPreviousScenarioCB:function(){this._pointerDownOnCommandGoToNearScenarioCB(!1)},pointerDownOnCommandGoToNextScenarioCB:function(){this._pointerDownOnCommandGoToNearScenarioCB(!0)},_pointerDownOnCommandGoToNearScenarioCB:function(e){var t=e?"Next":"Previous",n=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario(),i=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager"),a=i["Get"+t+"ScenarioId"](n);if(""===a){var r=i.GetSequenceFromScenarioId(n),o=i["Get"+t+"Sequence"](r,this.generateSequenceTypeArray(r._sequenceType));if(o){var s=i.GetListScenariosInSequence(o),l=s[t?0:s.length-1];l&&(a=l.GetID())}}""!==a&&(e?this._UInextScenario.getChildren()[0].removeClassName("hide"):this._UIpreviousScenario.getChildren()[0].removeClassName("hide")),this.OpenScenario(a)},generateSequenceTypeArray:function(e){var t=[];return t.push(e),2!==e&&3!==e||(t.push(2),t.push(3)),t},OpenScenario:function(e,t){if(""!==e){var n=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),i=new u(n,this._vcxGuiManager._experienceBase.ComponentsMap,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager")),a=n.GetScenarios()[e];i.BuildTransitionTo(a),i.SetCallback(t),this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").Push(i)}},_createUIArrow:function(e){if("Left"===e||"Right"===e){var t=new UWA.Element("div",{class:"VCXScenariosUIArrow VCX"+e+"Arrow hide",html:[]}),n=new UWA.Element("div",{class:"VCXScenarioUI_loading hide",html:[]}).inject(t);return new UWA.Element("div",{class:"VCXpie VCXspinner",html:[]}).inject(n),new UWA.Element("div",{class:"VCXpie VCXfiller",html:[]}).inject(n),t}},addImmersiveUIArrows:function(){var e=this,t=document.getElementsByClassName("wux-windows-docking-element-free-zone wux-docking-element-bottom")[0];if(t){this._UIpreviousScenario=this._createUIArrow("Left").inject(t),this._UInextScenario=this._createUIArrow("Right").inject(t),this._UIpreviousScenario.addEventListener(n.POINTERDOWN,this.pointerDownOnCommandGoToPreviousScenarioCB.bind(this),!1),this._UInextScenario.addEventListener(n.POINTERDOWN,this.pointerDownOnCommandGoToNextScenarioCB.bind(this),!1),this._UI_dot_Container=new UWA.Element("div",{class:"VCXScenariosUIDots_container hide",html:[]}).inject(t),this._UI_dot_Container_clone=new UWA.Element("div",{class:"VCXScenariosUIDots_clone",html:[]}).inject(this._UI_dot_Container),this._UI_dot_Container_child=new UWA.Element("div",{html:[]}).inject(this._UI_dot_Container),this._UI_dot_Container.addEventListener(n.POINTERUP,function(t){if(!t.currentTarget.hasClassName("forPlayGuidedTourCmd")){t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation();var n=t.target?t.target.dataset.scenarioid:void 0;if(void 0!==n)return e.OpenScenario(n),!0}});var i=null;this._UI_dot_Container.addEventListener("mouseover",function(t){t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation();var n=t.path?t.path[0].dataset.scenarioid:void 0;if(void 0!==n){for(var a=document.getElementsByClassName("vcx-controls-thumbnail"),r=0;r<a.length;r++)if(a[r].id===n){i=a[r].cloneNode(!0),e._UI_dot_Container_clone.innerHTML="",e._UI_dot_Container_clone.appendChild(i);break}return!0}}),this._UI_dot_Container.addEventListener("mouseout",function(t){if(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),void 0!==(t.path?t.path[0].dataset.scenarioid:void 0))return e._UI_dot_Container_clone.innerHTML="",!0}),this.addImmersiveUIDotsFromCurrentSequence()}},addImmersiveUIDotsFromCurrentSequence:function(){if(void 0!==this._UI_dot_Container){this._UI_dot_Container_child.innerHTML="";var e=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario();if(""!==e){var t=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetSequenceFromScenarioId(e),n=this._vcxGuiManager._experienceBase.getManager("VCXSequenceManager").GetListScenariosInSequence(t);if(!(n.length<=1))for(var i=0;i<n.length;i++){var a=n[i],r=new UWA.Element("span",{class:"VCXScenariosUIDots_dot",html:[]}).inject(this._UI_dot_Container_child);r.dataset.scenarioid=a.GetID(),e===r.dataset.scenarioid&&r.addClassName("active")}}}},setImmersiveUIState:function(e){for(var t=document.getElementsByClassName("VCXScenariosUIArrow"),n=0;n<t.length;n++){var i=t[n];e?i.removeClassName("hide"):i.addClassName("hide")}var a=document.getElementsByClassName("VCXScenariosUIDots_container")[0];return e?a.removeClassName("hide"):a.addClassName("hide"),e},displayNeedForUpdate:function(){if(/*!this.getLockSceneUpdateDisplay() &&*/!this.playerMode){let e=document.querySelector(".vcxActiveScenario")&&document.querySelector(".vcxActiveScenario").getParent(),t=document.querySelector('[title="Update Camera Position"]');if(!e||!t)return;e.appendChild(this._updateSceneSymbol),t.addClassName("vcx-update-available"),t.addEventListener("click",this.hideNeedForUpdate.bind(this)),this.stopListeningToViewpointChange(),this._vcxGuiManager._sceneNeedsUpdate=!0}},hideNeedForUpdate:function(){if(this.playerMode)return;this._updateSceneSymbol.remove();let e=document.querySelector('[data-rec-id*="VCXAddCameraKeyCmd"]');e&&(e.removeClassName("vcx-update-available"),e.removeEventListener("click",this.hideNeedForUpdate.bind(this)),this._vcxGuiManager._sceneNeedsUpdate=!1,this.listenToViewpointChange())},listenToViewpointChange:function(){let e=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer().currentViewpoint;this.currentViewpoint.angle=e.getAngle(),this.currentViewpoint.eyePos=e.getEyePosition(),this.currentViewpoint.sightDir=e.getSightDirection(),this._tokenSceneUpdate?console.warn("tried to subscribe to existing event"):this._tokenSceneUpdate=t.subscribe({event:"/VISU/"},e=>{e&&e.viewpoint&&"@onViewpointChange"===e.eventType&&(this.currentViewpoint.angle!==e.viewpoint.getAngle()||e.viewpoint.getEyePosition().distanceTo(this.currentViewpoint.eyePos)>1e-10||e.viewpoint.getSightDirection().distanceTo(this.currentViewpoint.sightDir)>1e-10)&&this.displayNeedForUpdate()})},stopListeningToViewpointChange:function(){this._tokenSceneUpdate&&(t.unsubscribe(this._tokenSceneUpdate),delete this._tokenSceneUpdate)}})}),define("DS/VCXWebGUI/VCXPropertiesPanelModel",["UWA/Class","DS/VCXWebGUI/VCXHyperlinkBoxing","DS/VCXWebGUI/VCXFontBoxing","DS/VCXWebGUI/VCXFrameBoxing"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._experienceBase=e,this._defaultCollapsedGroupsPerObjectType={},this._hyperlinkBoxing=new t,this._hyperlinkBoxing.initialize(this._experienceBase),this._fontBoxing=new n,this._frameBoxing=new i,this._currentPanelInfos=null},unInitialize:function(){this._hyperlinkBoxing&&(this._hyperlinkBoxing.unInitialize(),this._hyperlinkBoxing=null),this._fontBoxing&&(this._fontBoxing=null),this._frameBoxing&&(this._frameBoxing=null),this._experienceBase=null,this._defaultCollapsedGroupsPerObjectType=null,this._currentPanelInfos=null},getMainPropNameFromBoxedPropName:function(e){return e.replace(/(\_\w+$)/,"")},getNewValueFromBoxedProperty:function(e,t,n,i){var a=this["_"+e+"Boxing"];if(a.UpdateMapForGUI&&a.BuildNewValueFromGUI){this.getMainPropNameFromBoxedPropName(i.propName)||console.log("Issue computing mainPropName from boxedProperty name");var r=this.getUnboxedPropertiesForGUI(e,t,n),o=a.UpdateMapForGUI(r,i);return a.BuildNewValueFromGUI(o)}},getUnboxedPropertiesForGUI:function(e,t,n,i){return"hyperlink"===e?this._hyperlinkBoxing.GetPropertiesForGUI(t,n):"font"===e?this._fontBoxing.GetPropertiesForGUI(t,n):"frame"===e?this._frameBoxing.GetPropertiesForGUI(t,n,i):void 0},getUnboxedPropertiesNLS:function(e,t){return"hyperlink"===e?this._hyperlinkBoxing.getPropertiesNamesNLS&&this._hyperlinkBoxing.getPropertiesNamesNLS(t):"font"===e?this._fontBoxing.getPropertiesNamesNLS&&this._fontBoxing.getPropertiesNamesNLS(t):"frame"===e?this._frameBoxing.getPropertiesNamesNLS&&this._frameBoxing.getPropertiesNamesNLS(t):void 0},setPanelState:function(e,t,n){this._currentPanelInfos.propSet=e,t&&(this._currentPanelInfos.arraySelection=t),n&&(this._currentPanelInfos.additionalPropertySettings=n)},getSavedPanelState:function(){return this._currentPanelInfos},resetSavedPanelStateIfNeeded:function(e){var t=!0;if(this._currentPanelInfos&&this._currentPanelInfos.arraySelection&&e.length===this._currentPanelInfos.arraySelection.length){for(var n=0;n<e.length;++n){var i=e[n];if(!this._currentPanelInfos.arraySelection.includes(i))break}n===e.length&&(t=!1)}t&&this.resetSavedPanelState()},resetSavedPanelState:function(){this._currentPanelInfos={propSet:null,arraySelection:null}},isCollapsedGroupsSavedForComponent:function(e){return Boolean(this._defaultCollapsedGroupsPerObjectType[e])},getCollapsedGroupsForComponents:function(e){if(!e)return[];var t=e;if(Array.isArray(t)||(t=[e]),1===t.length)return this._defaultCollapsedGroupsPerObjectType[t[0]]||[];for(var n=[],i=[],a=-1,r=null,o=0;o<e.length;++o){var s=e[o];this._defaultCollapsedGroupsPerObjectType[s]?(i.push(this._defaultCollapsedGroupsPerObjectType[s]),("number"!=typeof r||r>this._defaultCollapsedGroupsPerObjectType[s].length)&&(r=this._defaultCollapsedGroupsPerObjectType[s].length,a=i.length-1)):console.warn("Couldn't find a saved list of collapsed groups for display on property panel for component "+s+".")}if(1===i.length)n=i[0];else if(0!==i.length)for(var l=i.splice(a,1)[0].slice(0);0!==l.length;){var c=l.pop();!l.includes(c)&&i.every(function(e){return e.includes(c)})&&n.push(c)}return n},setCollapsedGroupsForComponent:function(e,t){this._defaultCollapsedGroupsPerObjectType[e]=t},addCollapsedGroupForComponent:function(e,t){this._modifyCollapsedGroupForComponent(e,t,!0)},removeCollapsedGroupForComponent:function(e,t){this._modifyCollapsedGroupForComponent(e,t,!1)},_modifyCollapsedGroupForComponent:function(e,t,n){if(this._defaultCollapsedGroupsPerObjectType[e]){var i=this._defaultCollapsedGroupsPerObjectType[e].indexOf(t);n?-1===i&&this._defaultCollapsedGroupsPerObjectType[e].push(t):-1!==i&&this._defaultCollapsedGroupsPerObjectType[e].splice(i,1)}else{if(!n)return;this._defaultCollapsedGroupsPerObjectType[e]=[t]}},addCollapsedGroupForComponents:function(e,t){this._modifyCollapsedGroupForComponents(e,t,!0)},removeCollapsedGroupForComponents:function(e,t){this._modifyCollapsedGroupForComponents(e,t,!1)},_modifyCollapsedGroupForComponents:function(e,t,n){if(Array.isArray(e))for(var i=0;i<e.length;++i){var a=e[i];n?this.addCollapsedGroupForComponent(a,t):this.removeCollapsedGroupForComponent(a,t)}}})}),define("DS/VCXWebGUI/VCXPropertiesCtrlExt",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/Controls/Accordeon","DS/Controls/Button","DS/Controls/LineEditor","DS/CoreEvents/Events","DS/Tweakers/TweakerBlob","DS/Tweakers/TweakerBoolean","DS/Tweakers/TweakerColor","DS/Tweakers/TweakerDate","DS/Tweakers/TweakerNumber","DS/Tweakers/TweakerString","DS/Tweakers/TweakerVector","DS/Tweakers/TypeRepresentationFactory","DS/Utilities/Array","DS/Utilities/Utils","DS/WebappsUtils/WebappsUtils","DS/VCXWebExperienceLoader/VCXExperienceSaverBase","DS/VCXWebGUI/VCXTabPageFrame","DS/VCXWebGUI/VCXPropertiesPanelModel","DS/VCXWebGUI/VCXPropertiesPanelView","DS/VCXWebGUI/VCXPropertiesPanelViewV2","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebKernel/VCXCmdChangeSelection","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelTools/VCXObjectTools","DS/VCXWebModifiablesServices/VCXModifiablesChangeServices","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXPropertyGroupSet","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueDate","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","i18n!DS/VCXWebGUI/assets/nls/VCXWebGUI","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,n,i,a,r,o,s,l,c,d,p,u,h,g,m,C,v,_,f,b,y,x,P,S,V,M,w,I,T,D,E,G,X,k,A,B,N,U){"use strict";var F={emptyPropertiesContainer:"vcx-propertiesContainer-empty",propertiesContainer:"vcx-properties-group-propsContainer",propertiesGroupNode:"vcx-propNode-group",groupNodeHeader:"vcx-propNode-group-header",propertyNode:"vcx-propNode-prop",nodeLabel:"vcx-propNode-label",propertyNodeTweakers:"vcx-propNode-prop-tweakers",colorAndDefinedTweakers:"vcx-colorDefined-tweakers",colorAndDefinedColorTweaker:"vcx-colorDefined-color",opacityAndDefinedTweakers:"vcx-opacityDefined-tweakers",opacityAndDefinedOpacityTweaker:"vcx-opacityDefined-opacity",colorOpacityTweakers:"vcx-colorOpacity-tweakers",colorOpacityColorTweaker:"vcx-colorOpacity-color",colorOpacityOpacityTweaker:"vcx-colorOpacity-opacity",sliderContainer:"vcx-propNode-prop-tweakers-sliderContainer",sliderContainerSliderTweaker:"vcx-tweaker-sliderContainer-slider",sliderContainerSpinBoxTweaker:"vcx-tweaker-sliderContainer-spinBox",collapsedProperties:"vcx-properties-collapsedProps",collapsedPropertiesToggle:"collapsedPropsAreCollapsed",buttonPropertiesLinked:"vcx-button-propertiesLinked",toggleForDefineProp:"vcx-toggle-defined",linkIcon:"vcxPropertyButtonIconLink wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-link"},W=e.extend({init:function(e,t){if(W.PlayerMode=Boolean(t),this._vcxGuiManager=e,this._propertiesPanelModel=new f(this._vcxGuiManager._experienceBase),this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PropertyPanelV2")){var n=this._vcxGuiManager.immersiveFrame;n||(n=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getFrameWindow().getImmersiveFrame()),this._propertiesPanelViewV2=new y(n,this._propertiesPanelModel),this._selectedPropsArray=[],"1"===this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().debug&&(this._propertiesPanelView=new b(this._propertiesPanelModel))}else this._propertiesPanelView=new b(this._propertiesPanelModel);this._disableLinkedProperties=!1,this._listTweakersWithPtrUpEvt=null,this._listButtonsLockToUnsubscribe=null,this._tokenSelectionAdd=r.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_ADD"},e=>{var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager");e.includes(t.getActiveViewport())&&(this._viewportInSelection=!0),this.requestRefresh(!0)}),this._tokenSelectionRemove=r.subscribe({event:"VCX_SELECTION_COMPONENTSLIST_REMOVE"},e=>{var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager");e.includes(t.getActiveViewport())&&(this._viewportInSelection=!1),this.requestRefresh(!0)}),this._tokenPropertiesChanged=r.subscribe({event:"VCX_PROPERTIES_CHANGED"},this.onPropertiesChanged.bind(this)),this._tokenTimePosChanged=r.subscribe({event:"VCX_TIMEPOS_CHANGED"},this.requestRefresh.bind(this,!0));var i={},a={iconName:"attributes",fontIconFamily:WUXManagedFontIcons.Font3DS};i.sidePanelInfos={classBaseNameCSS:"vcx-properties-",title:"Properties",icon:a,side:"right"},i.slidingViewsTitles=["Properties"],i.slidingViewsContainerIDs=["vcx-propertiesContainer"],this._propertiesPanelView&&this.createTabFrameAndSlidingViews(i);if(this._textureUploadPlaceHolder="",this._imageUploadPlaceHolder="",N.get("VCXProperties.TypeYourSearch"),this._textureUploadPlaceHolder=N.get("VCXProperties.TextureUploadPlaceHolder"),this._imageUploadPlaceHolder=N.get("VCXProperties.ImageUploadPlaceHolder"),!W.PlayerMode){var o="1"==this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().linkedProperties,s="1"==this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().stylestree;this._propertiesPanelView&&this._propertiesPanelView.createToolbarCommands(o,s)}this._onShowTweakerCB=this._onShowTweaker.bind(this),this._onHideTweakerCB=this._onHideTweaker.bind(this),this._onCancelEditCB=this._onCancelEdit.bind(this),this._onPreEditCB=this._onPreEdit.bind(this),this._onPostEditCB=this._onPostEdit.bind(this),this._onLiveChangeCB=this._onLiveChange.bind(this),this._onChangeCB=this._onChange.bind(this),this._onNodeModelUpdateCB=this._onNodeModelUpdate.bind(this),this._onTweakerPointerUpCB=this._onTweakerPointerUp.bind(this),this._onButtonClickCB=this._onButtonClick.bind(this),this._onExpandCB=this._onExpand.bind(this),this._onCollapseCB=this._onCollapse.bind(this),this._propertiesPanelView&&(this._propertiesPanelView.subscribeTweakerEvt("show",this._onShowTweakerCB),this._propertiesPanelView.subscribeTweakerEvt("hide",this._onHideTweakerCB),this._propertiesPanelView.subscribeTweakerEvt("cancelEdit",this._onCancelEditCB),this._propertiesPanelView.subscribeTweakerEvt("preEdit",this._onPreEditCB),this._propertiesPanelView.subscribeTweakerEvt("liveChange",this._onLiveChangeCB),this._propertiesPanelView.subscribeTweakerEvt("change",this._onChangeCB),this._propertiesPanelView.subscribeTweakerEvt("postEdit",this._onPostEditCB),this._propertiesPanelView.subscribeTweakerEvt("buttonclick",this._onButtonClickCB)),this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PropertyPanelV2")&&(this._propertiesPanelViewV2.subscribeTweakerEvent("change",this._onChangeCB),this._propertiesPanelViewV2.subscribeTweakerEvent("liveChange",this._onLiveChangeCB),this._propertiesPanelViewV2.subscribeTweakerEvent("cancelEdit",this._onCancelEditCB),this._propertiesPanelViewV2.subscribeTweakerEvent("preEdit",this._onPreEditCB),this._propertiesPanelViewV2.subscribeTweakerEvent("postEdit",this._onPostEditCB),this._propertiesPanelViewV2.subscribeTweakerEvent("buttonclick",this._onButtonClickCB),this._propertiesPanelViewV2._expanderExpandCB=this._onExpandCB,this._propertiesPanelViewV2._expanderCollapseCB=this._onCollapseCB,this._propertiesPanelViewV2.restoreFunction=this.restoreProperties.bind(this),this._propertiesPanelViewV2.goToParentFunction=this.navigateToParent.bind(this),this._propertiesPanelViewV2.executeHeaderCommand=this.executeHeaderCommand.bind(this),this._propertiesPanelViewV2.addHeaderButton("reset","VCXRestoreNeutralsCmd"),this._propertiesPanelViewV2.addHeaderButton("floppy","VCXCaptureInNeutralsCmd"),this._propertiesPanelViewV2.addHeaderButton("broom","VCXFormatPainterCmd",!0),this._lastSelection=[]),this._changeInLocks=!1,this._preventRefresh=!1},_onTweakerPointerUp:function(e){if(!W.PlayerMode){var t=e.currentTarget,n=t&&t.dsModel,i=n&&n.name;if(i)i.toLowerCase().contains("tweaker")&&!0===n.disabled&&M.RemoveStyleFromCurrentSelection(this._vcxGuiManager._experienceBase,!0)}},requestRefresh:function(e){e&&0===this._refreshMaxinterval?(this.RefreshPanel(),this.requestChangeInPanel(),this._refreshRequested=!1):this._refreshRequested=!0,this._refreshMaxinterval=5},update:function(e){(0===this._refreshMaxinterval?this._refreshRequested&&(this.RefreshPanel(),this.requestChangeInPanel(),this._refreshRequested=!1):this._refreshMaxinterval--,this._viewportInSelection)&&(this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").viewpointHasMoved&&this.requestRefresh(!1))},_onNodeModelUpdate:function(e){if(e&&e.dsModel&&e.dsModel.internalOptions){var t=e.dsModel;t.propName=e.dsModel.internalOptions.propName,(this.modifyWhile||this._currentlyEditing)&&(t.std=t.value||void 0!==t.checkFlag&&t.checkFlag);var n={},i=this._vcxGuiManager._experienceBase;this.getCID4Property(t,n,e);for(var a=n.vcxValue,r=n.propertyName,o=new S(i.getManager("VCXScenarioManager"),i.getManager("VCXCommandManager")),s=0,l=[],c=[],d=i.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().map(e=>e.QueryInterface("VCXIModifiable")),p=0;p<d.length;p++){var u=d[p];if(-1!==r.search("Hyperlink_")){r="Actor.Hyperlink";let e=u.GetProperty(r).GetPropertyValue(),n=u.GetProperty(r).GetPropertyInfo();a=this._propertiesPanelModel.getNewValueFromBoxedProperty("hyperlink",e,n,t).GetValue(),this._propertiesPanelModel.resetSavedPanelState()}else if(-1!==r.search("Text.Font")){r="Collab.Text.Font";let e=u.GetProperty(r).GetPropertyValue(),n=u.GetProperty(r).GetPropertyInfo();a=this._propertiesPanelModel.getNewValueFromBoxedProperty("font",e,n,t)}else if(-1!=r.search("_Position")||-1!=r.search("_Orientation")||-1!=r.search("_Scale")||-1!=r.search("_Pivot")){(r=r.replace(/(\_\w+$)/,""))||console.log("Issue computing mainPropName from boxedProperty name");let e=u.GetProperty(r).GetPropertyValue(),n=u.GetProperty(r).GetPropertyInfo();a=this._propertiesPanelModel.getNewValueFromBoxedProperty("frame",e,n,t)}var h=this._getNewPropFromNewValue(u,r,a);c.push(u),l.push(u.RequestModification(h))}if("VCXPropertyValueColor"===t.dataType){let e=u.GetProperty(r).GetPropertyValue();if(!e)return;var g=e.GetPropertyValue().ToString(),m=a;if(m.substr(0,m.lastIndexOf(","))===g.substr(0,g.lastIndexOf(",")))return}var C=this.modifyWhile;UWA.Promise.all(l).then(e=>{for(var t=0;t<e.length;t++){var n=e[t];if(n)for(var a in n._map)if(n._map.hasOwnProperty(a)){var r=n._map[a];if(o.ChangeProperty(c[t],r),"VCXPropertyValueColor"===r.GetPropertyValue().GetType()){var l=this._propertiesPanelModel.getSavedPanelState();l&&(l.propSet._map[a]=r)}s++}}if(s>0&&(C&&(this._preventRefresh=!0),i.getManager("VCXCommandManager").Push(o)),!C){this._canceledEdit&&("Transaction: Canceled edit Properties via Panel",this._canceledEdit=!1)}})}},_getNewPropFromNewValue:function(e,t,n){var i=!1,a=e.GetProperty(t);!0===a.GetPropertyValue()._bUndefined&&(n===a.GetPropertyValue().ToString()&&(i=!0));var r=null;i||(r=a.Clone()).GetPropertyValue().FromString(n);return r},_search:m.debounce(function(e){this._searchCallback.bind(this)(this._propertiesPanelView.getSearchInputValue().toLowerCase())},500),createTabFrameAndSlidingViews:function(e){if(e&&e.sidePanelInfos&&e.slidingViewsTitles&&e.slidingViewsContainerIDs){var t={};t._experienceBase=this._vcxGuiManager._experienceBase,this._vcxGuiManager.immersiveFrame&&(t.immersiveFrame=this._vcxGuiManager.immersiveFrame),t._uiLayer=this._vcxGuiManager._uiLayer,t.classBaseNameCSS=e.sidePanelInfos.classBaseNameCSS,t.sidePanel={title:e.sidePanelInfos.title,icon:e.sidePanelInfos.icon,side:e.sidePanelInfos.side,controller:this,currentDockArea:WUXDockAreaEnum.RightDockArea},t.slidingViews={displayTabAtStart:1,disableSlindingMenu:1,activateViewOn:1,_vcxuiSequencesMaster:{}},t.slidingViews.views=[];for(var n=0;n<e.slidingViewsTitles.length;++n){var i=new UWA.Element("div",{id:e.slidingViewsContainerIDs[n]});t.slidingViews._vcxuiSequencesMaster[n+1]={},t.slidingViews._vcxuiSequencesMaster[n+1][e.slidingViewsTitles[n]]=i,t.slidingViews.views.push({title:e.slidingViewsTitles[n],content:{html:t.slidingViews._vcxuiSequencesMaster[1][e.slidingViewsTitles[n]]}})}t.recId="propertiesCtrlRec",this._propertiesPanelView.setFrame(new _(t));var a=t.slidingViews._vcxuiSequencesMaster[1][e.sidePanelInfos.title];this._propertiesPanelView.setPanelContent(a),this._propertiesPanelView.removeContainer()}else console.warn("Unable to create tree Panel")},getFrame:function(){return this._propertiesPanelView&&this._propertiesPanelView.getTabPageFrame()},unInitialize:function(){r.unsubscribe(this._tokenSelectionAdd),delete this._tokenSelectionAdd,r.unsubscribe(this._tokenSelectionRemove),delete this._tokenSelectionRemove,r.unsubscribe(this._tokenTimePosChanged),delete this._tokenTimePosChanged,r.unsubscribe(this._tokenPropertiesChanged),delete this._tokenPropertiesChanged,this._onPreEditCB=null,this._onPostEditCB=null,this._onLiveChangeCB=null,this._onChangeCB=null,this._onNodeModelUpdateCB=null,this._onButtonClickCB=null,this._propertiesPanelModel&&(this._propertiesPanelModel.unInitialize&&this._propertiesPanelModel.unInitialize(),this._propertiesPanelModel=null),this._propertiesPanelView&&(this._propertiesPanelView.unInitialize&&(this._propertiesPanelView.unsubscribeTweakerEvt("show",this._onShowTweakerCB),this._propertiesPanelView.unsubscribeTweakerEvt("hide",this._onHideTweakerCB),this._propertiesPanelView.unsubscribeTweakerEvt("cancelEdit",this._onCancelEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("preEdit",this._onPreEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("liveChange",this._onLiveChangeCB),this._propertiesPanelView.unsubscribeTweakerEvt("change",this._onChangeCB),this._propertiesPanelView.unsubscribeTweakerEvt("postEdit",this._onPostEditCB),this._propertiesPanelView.unsubscribeTweakerEvt("buttonclick",this._onButtonClickCB),this._propertiesPanelView.unInitialize()),this._propertiesPanelView=null),this._propertiesPanelViewV2&&(this._selectedPropsArray=null,this._propertiesPanelViewV2.unInitialize&&this._propertiesPanelViewV2.unInitialize(),this._propertiesPanelViewV2=null),delete W.PlayerMode,this.options&&delete this.options,this._vcxGuiManager&&delete this._vcxGuiManager},getCID4Property:function(e,t,n){if(t.propertyName=e.propName,t.vcxValue=e.value+"",e.propName.endsWith(".Availability"))t.vcxValue=e.value?3:4;else if("tweakerEnum"===e.name||"TweakerString"===e.name&&("combo"===e.displayStyle||"buttonGroup"===e.displayStyle)){var i=e.value,a={},r=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection()[0].QueryInterface("VCXIModifiable").GetProperty(t.propertyName);if(r){var o=r.GetPropertyInfo();a=o.GetMapChoiceEnum()}for(var s in a)if(a.hasOwnProperty(s)){var l=a[s],c=l,d=c;if("1"!=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().noNLS){let e=o.Geti18n();if(e&&(d=e[c]),void 0===d)this._vcxGuiManager._experienceBase.getManager("VCXStylesManager")&&(d=U[c]);void 0===d&&(d=c)}if(d===i){t.vcxValue=s;break}if(l===i){t.vcxValue=s;break}}}else if("tweakerBlob"===e.name){var p="";n&&(p=n.target.dsModel._blobName);var u=x.dataURLToBlob(t.vcxValue),h=window.URL.createObjectURL(u),g=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").BuildPathFromString(h),m=new B;m.SetValue(p),g.SetFileName(m);var C=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(g);t.vcxValue=C.GetValue()+""}else if("TweakerColor"===e.name){var v="#"+t.vcxValue,_=new k;_.GetValue().FromHexString(v);var f=_.ToString();t.vcxValue=f}else if("TweakerVector"===e.name)t.vcxValue="["+t.vcxValue+"]";else if("TweakerString"===e.name)if(e.propName.includes("StipplingMotif")&&e.value.length>0)if(e.value===""+parseFloat(e.value))t.vcxValue=e.value;else{var b=e.value.match(/\d+(?:\.\d+)?/g),y=b&&b.map(e=>parseFloat(e));t.vcxValue=y?y.join(" "):"0"}else t.vcxValue=e.value},onPropertiesChanged:function(e){e&&e._map&&0!==Object.keys(e._map).length&&(this._preventRefresh||(this.requestRefresh(!0),this.requestChangeInPanel()),this._preventRefresh=!1)},RefreshPanel:function(){var e=this._propertiesPanelView&&this._propertiesPanelView.getPanelContent();if(this._vcxGuiManager&&e&&!this._vcxGuiManager._experienceBase.getManager("VCXManipulatorManager").checkManipulationInProgress()){var t=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();if(this._propertiesPanelModel.resetSavedPanelStateIfNeeded(t),0===t.length)return this._propertiesPanelView.removeContainer(),void(this.modifyWhile=!1);var n=t[0].QueryInterface("VCXIModifiableView");if(n){for(var i=this.BuildIntersectionPropertyGroups(t),a=i.getOrderedPropertyGroupsArray(),r=a.map(e=>e.groupID),o=this._getPropertiesFromPropertyGroups(t,i),s=Object.values(i._map),l={},c=0;c<s.length;c++){var d=s[c];Object.assign(l,l,d.additionalPropertySettings)}var p,u=this._propertiesPanelModel.getSavedPanelState();if(u.arraySelection&&u.arraySelection.length===t.length)for(var h=!0,g=0;g<t.length&&h;++g)for(var m=t[g],C=0;C<u.arraySelection.length&&h;++C){var v=u.arraySelection[C];v!==m&&(h=!1),v=u.arraySelection[C]}if(p=this._propertiesPanelView.getPropertiesContainer().scrollTop,!(u.propSet&&u.propSet.IsEqualTo(o)&&!1===this._changeInLocks||!0===this.modifyWhile)){if(this._propertiesPanelView.removeContainer(),Array.isArray(this._listTweakersWithPtrUpEvt)){for(var _=0;_<this._listTweakersWithPtrUpEvt.length;++_){this._listTweakersWithPtrUpEvt[_].removeEventListener("pointerup",this._onTweakerPointerUpCB)}this._listTweakersWithPtrUpEvt=null}if(Array.isArray(this._listButtonsLockToUnsubscribe))for(_=0;_<this._listButtonsLockToUnsubscribe.length;++_){var f=this._listButtonsLockToUnsubscribe[_][0],b=this._listButtonsLockToUnsubscribe[_][1];f.removeEventListener("change",b)}if(this._listTweakersWithPtrUpEvt=[],this._listButtonsLockToUnsubscribe=[],this._propertiesPanelModel.setPanelState(o,t,l),this._vcxGuiManager._experienceBase.ModifiablesAdvancedProperties){var y=new A;y.SetValue(t.length),(Me=new I("Selection.Count",1,!1,U)).SetGroupId("Group.Introspection");var x=new w(Me,y);o.AddOrModifyProperty(x)}var P={},S=this._vcxGuiManager._experienceBase.getManager("VCXContextManager"),V=S.getUrlVars();for(var M in o._map){if(this._isPropertyDisplayed(o._map[M],V)){var T=o._map[M].GetPropertyValue(),D=(Me=o._map[M].GetPropertyInfo()).GetGroupId();""!==D&&"Group.Essentials"!==D||(D="Group.Essentials");var E=i.GetPropertyGroup(D);if(E){var G=E.additionalPropertySettings&&E.additionalPropertySettings[M];G&&(G.propertyName=M);var X=!1;if(1===t.length){var k=t[0].QueryInterface("VCXIModifiable"),B=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager");if(G&&G.overridePropertyList){for(c=0;c<G.overridePropertyList.length;c++)if(B.IsCurrentPropertyDifferentFromNeutral(k,G.overridePropertyList[c])){X=!0;break}}else X=B.IsCurrentPropertyDifferentFromNeutral(k,M)}var N=E.isVisible(M);if(!1!==E.availability&&M!==E.PropertyControlingGroupAvailability&&E){var O=this._getPropertyNameNLS(M,Me,E,V,n);if(!(D in P)){var L="";if(E.i18nGroup){var R={group:E};L=n.getTranslatedProperty(R).groupName}var q={name:L,arrayProps:[]};P[D]=q}var H=!1;if(this._disableLinkedProperties)for(_=0;_<t.length;++_){var z=this._vcxGuiManager._experienceBase.getManager("VCXLinkedPropertyManager");if(H=z&&z.IsLinkedAndNotInFollow(t[_].GetID(),M))break}var j=!Me.IsDefined(),Z=E.isLockable(M),K=Z?E.isLocked(M):null;if(!0===K&&(H=!0),E.PropertyControlingGroupVisibility===M){if("boolean"!=typeof E.availability&&"boolean"==typeof E.visibility){var Q=T.GetValue();P[D].checkbox=Q,P[D].showPropName=M,P[D].disabled=H}}else{var Y=!0;if("Actor.Hyperlink"!==M&&"Collab.Text.Font"!==M&&"VCXPropertyValueFrame"!==T.GetType()&&"VCXPropertyValueLocation"!==T.GetType()||!N)if(S.isSupported("OpacityOverride")&&N&&(M.includes(".Defined")||("Actor.Color"===M||"Actor.Opacity"===M)&&o._map[M+".Defined"]&&E.isVisible(M+".Defined")))if(M.includes(".Defined"))Y=!1;else{var J=M,$=o._map[J],ee=$.GetPropertyValue(),te=$.GetPropertyInfo(),ne=J+".Defined",ie=o._map[ne],ae=ie.GetPropertyValue(),re=ie.GetPropertyInfo(),oe="Actor.Color"===M?"colorAndDefinedTweakers":"Actor.Opacity"===M?"opacityAndDefinedTweakers":"",se=(Ee=new UWA.Element("div",{class:F.propertyNodeTweakers+" "+F[oe]}),this.getProperty4CID(ee,te,J,ee.ToString(),W.PlayerMode||H,j||!ae.GetValue(),G,n,E)),le=J.includes("Opacity")?se:se.getContent?se.getContent():se,ce="Actor.Color"===M?"colorAndDefinedColorTweaker":"Actor.Opacity"===M?"opacityAndDefinedOpacityTweaker":"";ce&&!le.classList.contains(F[ce])&&le.classList.add(F[ce]),se.inject(Ee);var de=this.getProperty4CID(ae,re,ne,ae.ToString(),W.PlayerMode||H,j,G,n,E);de.getContent().addClassName(F.toggleForDefineProp),de.inject(Ee),Z&&this._addLockToTweakers(Ee,K,M),Pe={label:O,tweaker:Ee,experienceBase:this._vcxGuiManager._experienceBase,touch:this._vcxGuiManager.isTouchActivated(),isOverriden:X,propSettings:G}}else if(M.includes(".Color"))if(M.includes(".Opacity")&&o._map[M.replace(".Opacity","")])Y=!1;else{var pe=M+".Opacity",ue=o._map[pe];if(ue)if(P[D].arrowBorderTweakerCreated)Y=!1;else{var he=ue.GetPropertyValue(),ge=ue.GetPropertyInfo(),me=(Ee=new UWA.Element("div",{class:F.propertyNodeTweakers+" "+F.colorOpacityTweakers}),this.getProperty4CID(T,Me,M,T.ToString(),W.PlayerMode||H,j,G,n,E)),Ce=me.displayStyle?me.getContent():me;!Ce.classList.contains(F.colorOpacityColorTweaker)&&Ce.classList.add(F.colorOpacityColorTweaker),me.inject(Ee);var ve=this.getProperty4CID(he,ge,pe,he.ToString(),W.PlayerMode||H,j,G,n,E),_e=ve.displayStyle?ve.getContent():ve;!_e.classList.contains(F.colorOpacityOpacityTweaker)&&_e.classList.add(F.colorOpacityOpacityTweaker),ve.inject(Ee),Z&&this._addLockToTweakers(Ee,K,M),Pe={label:O,tweaker:Ee,experienceBase:this._vcxGuiManager._experienceBase,touch:this._vcxGuiManager.isTouchActivated(),isOverriden:X,propSettings:G},M.includes("Collab.Border.Line")&&o._map["Collab.Border.Line.2.Color"]&&(P[D].arrowBorderTweakerCreated=!0)}else{Ee=new UWA.Element("div",{class:F.propertyNodeTweakers});this.getProperty4CID(T,Me,M,T.ToString(),W.PlayerMode||H,j,G,n,E).inject(Ee),Z&&this._addLockToTweakers(Ee,K,M),Pe={label:O,tweaker:Ee,experienceBase:this._vcxGuiManager._experienceBase,touch:this._vcxGuiManager.isTouchActivated(),isOverriden:X,propSettings:G}}}else{Ee=new UWA.Element("div",{class:F.propertyNodeTweakers});this.getProperty4CID(T,Me,M,j?"":T.ToString(),W.PlayerMode||H,j,G,n,E).inject(Ee),Z&&this._addLockToTweakers(Ee,K,M),Pe={label:O,tweaker:Ee,experienceBase:this._vcxGuiManager._experienceBase,touch:this._vcxGuiManager.isTouchActivated(),isOverriden:X,propSettings:G}}else{Y=!1;var fe=E.getProperties()[M]&&E.getProperties()[M].hiddenFields,be="Actor.Hyperlink"===M?"hyperlink":"Collab.Text.Font"===M?"font":"VCXPropertyValueFrame"===T.GetType()||"VCXPropertyValueLocation"===T.GetType()?"frame":null,ye=null,xe=this._propertiesPanelModel.getUnboxedPropertiesNLS(be,M);"Actor.Hyperlink"===M?((ye=this._propertiesPanelModel.getUnboxedPropertiesForGUI(be,T,Me)).propertyAction&&delete ye.propertyAction,P[D].checkbox=Boolean(ye.propertyType.GetPropertyValue().GetValue())):"Collab.Text.Font"===M?ye=this._propertiesPanelModel.getUnboxedPropertiesForGUI(be,T,Me):"VCXPropertyValueFrame"!==T.GetType()&&"VCXPropertyValueLocation"!==T.GetType()||S.isSupported("FrameUnboxing")&&(ye=this._propertiesPanelModel.getUnboxedPropertiesForGUI(be,T,Me,fe));var Pe=null;if(ye)for(var Se in ye)if(ye.hasOwnProperty(Se)){if("hiddenFields"===Se)continue;Pe=null;var Ve=ye[Se];if(!Ve)continue;var Me=Ve.GetPropertyInfo(),we=ye.hiddenFields&&ye.hiddenFields.includes(Se);if(!Me.IsVisible()||we)continue;var Ie=Me.GetPropertyName(),Te=O,De=xe&&xe[Ie];De&&("Actor.Position"===M||"Actor.Hyperlink"===M||O===M?Te=De:Te+=" "+De);var Ee=new UWA.Element("div",{class:F.propertyNodeTweakers}),Ge=Ve.GetPropertyValue();this.getProperty4CID(Ge,Me,Ie,Ge.ToString(),H,j,G,n,E).inject(Ee),Z&&this._addLockToTweakers(Ee,K,M),Pe={label:Te,tweaker:Ee,experienceBase:this._vcxGuiManager._experienceBase,touch:this._vcxGuiManager.isTouchActivated(),isOverriden:X,propSettings:G},P[D].arrayProps.push(Pe)}}Y&&Pe&&(N||"record"===this._vcxGuiManager._experienceBase.odt)&&P[D].arrayProps.push(Pe)}}}else console.log("No PropertyGroup '"+D+"' available for property '"+M+"' for current selection.")}}for(var Xe=[],ke=0;ke<a.length;++ke){var Ae=a[ke].groupID;if(d=P[Ae])if(E=i.GetPropertyGroup(D),"boolean"!=typeof P[Ae].checkbox&&"boolean"!=typeof E.availability&&"boolean"==typeof E.visibility&&(P[Ae].checkbox=d.visibility,P[Ae].showPropName=""),0!==d.arrayProps.length||"checkbox"in P[Ae]){var Be;a&&a.indexOf(Ae)?Be=r.indexOf(Ae):console.log("groupid "+Ae+" not found in propertiesGroupsOrderedArray !");var Ne=null,Ue=null;if("Group.Actions"===Ae||void 0!==d.checkbox){if(Ue={group:!0,toggle:d.checkbox,label:d.name,propName:"Group.Actions"===Ae?"Actor.Hyperlink_Action":d.showPropName,disabled:d.disabled,groupID:Ae},"Group.Actions"!==Ae&&!d.checkbox){(Ne=this._generateExpanderInfosForGroup(Ue))&&(Xe[Be]=Ne);continue}}else Ue={group:!0,label:d.name,propName:d.showPropName,disabled:d.disabled,groupID:Ae};(Ne=this._generateExpanderInfosForGroup(Ue))&&(Xe[Be]=Ne);var Fe=new UWA.Element("div",{class:F.propertiesContainer});Xe[Be].body=Fe;for(c=0;c<P[Ae].arrayProps.length;c++){Pe=P[Ae].arrayProps[c];var We=this._generateDivForProperty(Pe);We&&We.inject(Fe)}}else if(r&&r.includes(Ae)){var Oe=r.indexOf(Ae);r.splice(Oe,1)}}this._propertiesPanelView.putContainer(),this._propertiesPanelView.emptyContainerContent(),Xe=Xe.filter(e=>e),this._propertiesPanelView.updateAccordeon(Xe,t),p&&this._propertiesPanelView.getPropertiesContainer().scrollTo({top:p})}}else console.warn("No modifiable view found for some elements selected")}},getGroupUIInformation:function(e,t){if(!1!==e.availability){var n=e.groupID;""===n&&(n="Group.Essentials");var i={propertyGroup:e,modifiableViewList:this.getSelectedModifiableviews()},a={name:this._getTranslationI18n(i).groupName,arrayProps:[],groupID:n};t[n]=a,t[n].order=e.priority,t[n].collapsed=this.getCollapsedGroupIds().includes(n),"boolean"!=typeof e.availability&&"boolean"==typeof e.visibility&&(t[n].checkbox=e.visibility,t[n].showPropName="");var r=new E;r.AddOrModifyGroup(e.clone());var o=this._getPropertiesFromPropertyGroups(this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),r)._map,s=e.getPropertiesIDsOrderedArray();for(var l in s){var c=s[l],d=o[c];this.getPropertyUIInformation(c,d,e,o,t[n])}0!==t[n].arrayProps.length||"checkbox"in t[n]||delete t[n]}},getPropertyUIInformation:function(e,t,n,i,a){var r={};r.touch=this._vcxGuiManager.isTouchActivated(),r.propertyId=e;var o=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars();if(t&&this._isPropertyDisplayed(t,o)){var s=t.GetPropertyValue();r.propertyValue=s;var l=t.GetPropertyInfo();r.propInfo=l;var c=n.additionalPropertySettings&&n.additionalPropertySettings[e];if(c&&(c.propertyName=e,c.buttons))for(var d=0;d<c.buttons.length;d++){var p=c.buttons[d];if("Restore"===p.type){var u=!1;if(p.data&&p.data.propertiesToRestore&&p.data.object)for(var h=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),g=p.data.object.QueryInterface("VCXIModifiable"),m=0;m<p.data.propertiesToRestore.length;m++){var C=p.data.propertiesToRestore[m];if(h.IsCurrentPropertyDifferentFromNeutral(g,C)){u=!0;break}}p.buttonDisabled=!u}}r.propSettings=c;var v=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),_=!1;if(1===v.length){g=v[0].QueryInterface("VCXIModifiable"),h=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager");if(c&&c.overridePropertyList){for(var f=0;f<c.overridePropertyList.length;f++)if(h.IsCurrentPropertyDifferentFromNeutral(g,c.overridePropertyList[f])){_=!0;break}}else _=h.IsCurrentPropertyDifferentFromNeutral(g,e)}r.isOverriden=_;var b=n.isVisible(e);if(e!==n.PropertyControlingGroupAvailability){var y={strPropId:e,propInfo:l,propertyGroup:n,urlVariables:o,modifiableViewList:this.getSelectedModifiableviews()},x=this._getTranslationI18n(y).propName;r.label=x;var P=!1;if(this._disableLinkedProperties)for(var S=0;S<v.length;++S){var V=this._vcxGuiManager._experienceBase.getManager("VCXLinkedPropertyManager");if(P=V&&V.IsLinkedAndNotInFollow(v[S].GetID(),e))break}!0===(n.isLockable(e)?n.isLocked(e):null)&&(P=!0),r.disabled=P;var M=!l.IsDefined();if(r.multipleSelectionUndefined=M,l.IsBounded()&&(r.bounds=l.GetBounds()),n.PropertyControlingGroupVisibility===e)"boolean"!=typeof n.availability&&"boolean"==typeof n.visibility&&(a.checkbox=s.GetValue(),a.showPropName=e,a.disabled=P);else{var w=!0,I=n.getPropertiesIDsOrderedArray();if(I.indexOf(e)>=0&&(r.order=I.indexOf(e)),b&&this.isPropertyBoxed(e,t))w=!1,this.getBoxedPropertiesUIInfo(n,t,x,_,c,a.arrayProps,a.checkbox);else if(this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("OpacityOverride")&&b&&(e.includes(".Defined")||("Actor.Color"===e||"Actor.Opacity"===e)&&i&&i[e+".Defined"]&&n.isVisible(e+".Defined")))if(e.includes(".Defined"))w=!1;else{var T=e+".Defined",D=i[T],E=D.GetPropertyValue(),G=D.GetPropertyInfo();r.defined={propertyId:T,propertyDefined:D,propertyValue:E,propertyInfo:G}}else if(e.includes(".Color"))if(e.includes(".Opacity")&&i[e.replace(".Opacity","")])w=!1;else{var X=e+".Opacity",k=i[X];if(k){var A=k.GetPropertyValue(),B=k.GetPropertyInfo();r.opacity={propertyId:X,propertyOpacity:k,propertyValue:A,propertyInfo:B},B.IsBounded()&&(r.opacity.bounds=B.GetBounds())}}else if("VCXPropertyValueDocId"===s.GetType()){var N=s.GetValue(),U="Upload texture.",F="";if(N>=0){var W=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").GetPropPath(N);F=W&&W.GetFileName().GetValue()}U=(""===F||"I_VCX_DefaultTexture.png"===F)&&this._imageUploadPlaceHolder&&this._textureUploadPlaceHolder?e.includes("Image")?this._imageUploadPlaceHolder:this._textureUploadPlaceHolder:F,r.placeHolder=U}this.fillEnumInformationInto(e,t,n,r),w&&b&&a.arrayProps.push(r)}}else a.propControlingAvailability={propertyId:e,propertyValue:s}}},getCollapsedGroupIds:function(){var e=[],t=this.getSelectedModifiableviews(),n=this;return t.every(t=>{var i,a=t.GetObject();if(this._propertiesPanelModel.isCollapsedGroupsSavedForComponent(a)){var r=[a];i=n._propertiesPanelModel.getCollapsedGroupsForComponents(r)}else i=t.getCollapsedGroupsNames(),this._propertiesPanelModel.setCollapsedGroupsForComponent(a,i);return i.every(t=>(e.includes(t)||e.push(t),!0)),!0}),e},RebuildPanel:function(e){this._lastSelection=e;var t=this.BuildIntersectionPropertyGroups(e).getOrderedPropertyGroupsArray(),n=(this.getSelectedModifiableviews(),{});for(var i in t){var a=t[i];this.getGroupUIInformation(a,n)}this._propertiesPanelViewV2.rebuildPanelUI(n)},updatePanel:function(e){var t=this.BuildIntersectionPropertyGroups(e).getOrderedPropertyGroupsArray(),n=this._propertiesPanelViewV2.getPanelDisplayedInfo(),i=Object.keys(n),a=this.getSelectedModifiableviews(),r=this._propertiesPanelViewV2.getUIGroupsInfo();if(r){this.controllerIsUpdatingUI=!0;for(var o=0;o<t.length;o++){for(var s=t[o],l={propertyGroup:s,modifiableViewList:a},c=this._getTranslationI18n(l).groupName,d=0;d<r.length;d++){r[d].groupID===s.groupID&&r.splice(d,1)}var p=this._propertiesPanelViewV2.getGroupExpander(c);if(!i.includes(s.groupID)){var u={};this.getGroupUIInformation(s,u),this._propertiesPanelViewV2.createTweakerGroup(u[s.groupID]);continue}let I=new E;I.AddOrModifyGroup(s.clone());let T=this._getPropertiesFromPropertyGroups(e,I)._map,D=Object.keys(T);for(var h=Object.keys(n[s.groupID]),g=0;g<D.length;g++){let t,i,a=D[g],r=T[a];if(h.includes(a)){t=n[s.groupID][a].value,i=n[s.groupID][a].propType;let e=r.GetPropertyValue().GetValue(),o={arrayProps:[]};if(this.getPropertyUIInformation(a,r,s,T,o),o.arrayProps.length>0){let l=o.arrayProps.length>0&&o.arrayProps[0].defined&&!o.arrayProps[0].defined.propertyValue.GetValue();o.arrayProps.length>0&&o.arrayProps[0].multipleSelectionUndefined&&(l=l||o.arrayProps[0].multipleSelectionUndefined);let c=n[s.groupID][a].undefinedDisplayFlag;if(!l||!c){let d=this.compareValues(r,e,i,t),u=o.arrayProps.length>0&&o.arrayProps[0].propSettings&&o.arrayProps[0].propSettings.buttons,h=n[s.groupID][a].additionalButtons,g=this.comparePropSettingsButtons(u,h);g&&(this._propertiesPanelViewV2.updateButtonsStatus(s.groupID,a,g.status),this._propertiesPanelViewV2.removeButtons(s.groupID,a,g.remove),this._propertiesPanelViewV2.addButtons(s.groupID,a,g.add)),V.deepCompare(o.arrayProps[0].enum,n[s.groupID][a].enumChoices,!1,!1)||(d.needToRebuild=!0),r.GetPropertyInfo().IsVisible()?d&&d.needToRebuild?(this._propertiesPanelViewV2.destroyTweakerLine(a),o.arrayProps.length>0&&this._propertiesPanelViewV2.buildPropertyLine({uiInfo:o.arrayProps[0]},p.body,n[s.groupID])):(d&&d.needToUpdate||l!==c)&&this._propertiesPanelViewV2.updateTweakers(a,d.valueForTweaker,e,l):this._propertiesPanelViewV2.destroyTweakerLine(a)}}}else if(a.includes("Availability"));else if(this.isPropertyBoxed(a,r)){var m=[];this.getBoxedPropertiesUIInfo(s,r,null,null,null,m);for(var C=0;C<m.length;C++){var v=m[C].boxedProperty,_=m[C].propertyId,f=(m[C],m[C].propertyValue.GetValue());if(h.includes(_)){t=n[s.groupID][_].value,i=n[s.groupID][_].propType;let e={arrayProps:[]};this.getPropertyUIInformation(a,r,s,T,e);for(var b=this.compareValues(m[C].boxedProperty,f,i,t),y=0;y<e.arrayProps.length;y++)if(e.arrayProps[y].propertyId===_){e.arrayProps=[e.arrayProps[y]];break}V.deepCompare(e.arrayProps[0].enum,n[s.groupID][_].enumChoices,!1,!1)||(b.needToRebuild=!0),v.GetPropertyInfo().IsVisible()?b&&b.needToRebuild?(this._propertiesPanelViewV2.destroyTweakerLine(_),this._propertiesPanelViewV2.buildPropertyLine({uiInfo:m[C]},p.body,n[s.groupID])):b&&b.needToUpdate&&this._propertiesPanelViewV2.updateTweakers(_,b.valueForTweaker,f):this._propertiesPanelViewV2.destroyTweakerLine(a)}else this._propertiesPanelViewV2.buildPropertyLine({uiInfo:m[C]},p.body,n[s.groupID]);var x=h.indexOf(_);x>=0&&h.splice(x,1)}}else if(e[0].QueryInterface("VCXIModifiableView").getPropertyGroups()[s.groupID].isVisible(a)){var P={arrayProps:[]};this.getPropertyUIInformation(a,r,s,T,P),P.arrayProps.length>0&&this._propertiesPanelViewV2.buildPropertyLine({uiInfo:P.arrayProps[0]},p.body,n[s.groupID])}var S=h.indexOf(a);S>=0&&h.splice(S,1)}if(h.length>0)for(var M=0;M<h.length;M++){var w=h[M];this._propertiesPanelViewV2.destroyTweakerLine(w)}}if(r.length>0)for(var I=0;I<r.length;I++)this._propertiesPanelViewV2.destroyGroup(r[I]);this.controllerIsUpdatingUI=!1}},compareValues:function(e,t,n,i){var a=!1,r=!1,o=t,s=e.GetPropertyInfo().GetPropertyName();if("VCXPropertyValueDocId"===n){if(t!==i&&t>=0){var l=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").GetPropPath(t);o=l&&l.GetFileName().GetValue(),a=!0}t<0&&(o=null)}else e.GetPropertyValue().GetType()!==n?r=!0:t.GetColorHexString?"#"+t.GetColorHexString()!==i&&(o=t.GetColorHexString(),a=!0):i.equals?i.equals(t.toArray())||(o=t.toArray(),a=!0):"VCXPropertyValueEnum"===e.GetPropertyValue().GetType()?e.GetPropertyInfo().GetMapChoiceEnum()[t]!==i&&(o=e.GetPropertyInfo().GetMapChoiceEnum()[t],a=!0):i!==t&&(typeof t==typeof t?a=!0:console.log("%c there is an comparison issue with property: "+s,"color: red"));return{needToRebuild:r,needToUpdate:a,valueForTweaker:o}},comparePropSettingsButtons:function(e,t){if(!e||!t)return;let n={status:{},add:[],remove:[]};for(let i=0;i<e.length;i++){let a=e[i],r=t[a.type];r?r.disabled!==a.buttonDisabled&&(n.status[a.type]=a.buttonDisabled):n.add.push(a.type)}return n},getAdditionalSettingsForProp:function(e){var t=this.getSelectedModifiableviews()[0],n=t.getAdditionalPropertySettings&&t.getAdditionalPropertySettings();return n&&n[e]?n[e]:null},isPropertyBoxed:function(e,t){return!(!["Actor.Hyperlink","Collab.Text.Font"].includes(e)&&!["VCXPropertyValueLocation","VCXPropertyValueFrame"].includes(t.GetPropertyValue().GetType()))},getBoxedPropertiesUIInfo:function(e,t,n,i,a,r,o){var s=t.GetPropertyInfo().GetPropertyName(),l=t.GetPropertyValue(),c=t.GetPropertyInfo();if(e.isVisible(s)&&this.isPropertyBoxed(s,t)){var d=e.getProperties()[s]&&e.getProperties()[s].hiddenFields,p="Actor.Hyperlink"===s?"hyperlink":"Collab.Text.Font"===s?"font":"VCXPropertyValueFrame"===l.GetType()||"VCXPropertyValueLocation"===l.GetType()?"frame":null,u=null,h=this._propertiesPanelModel.getUnboxedPropertiesNLS(p,s);"Actor.Hyperlink"===s?((u=this._propertiesPanelModel.getUnboxedPropertiesForGUI(p,l,c)).propertyAction&&delete u.propertyAction,Boolean(u.propertyType.GetPropertyValue().GetValue())):"Collab.Text.Font"===s?u=this._propertiesPanelModel.getUnboxedPropertiesForGUI(p,l,c):["VCXPropertyValueLocation","VCXPropertyValueFrame"].includes(t.GetPropertyValue().GetType())&&this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("FrameUnboxing")&&(u=this._propertiesPanelModel.getUnboxedPropertiesForGUI(p,l,c,d));var g,m=e.getPropertiesIDsOrderedArray();if(m.indexOf(s)>=0&&(g=m.indexOf(s)),u)for(var C in u)if(u.hasOwnProperty(C)){if("hiddenFields"===C)continue;var v=u[C];if(!v)continue;var _=v.GetPropertyInfo(),f=u.hiddenFields&&u.hiddenFields.includes(C);if(!_.IsVisible()||f)continue;var b=_.GetPropertyName(),y=n,x=h&&h[b];x&&("Actor.Position"===s||"Actor.Hyperlink"===s||y===s?y=x:y+=" "+x);var P;P={label:y,propertyId:b,propertyValue:v.GetPropertyValue(),touch:this._vcxGuiManager.isTouchActivated(),isOverriden:i,boxedProperty:v,order:g,propSettings:a},this.fillEnumInformationInto(b,v,e,P),r.push(P)}}},emptyPanel:function(){this._propertiesPanelViewV2&&(this._propertiesPanelViewV2.emptyPanelContent(),this._lastSelection=[],this._selectedPropsArray=[])},requestChangeInPanel:function(){var e=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection(),t=!0;this._vcxGuiManager._experienceBase.getManager("VCXContextManager").isSupported("PropertyPanelV2")||(t=!1),this.modifyWhile&&(t=!1);var n=this._vcxGuiManager._experienceBase.getManager("VCXManipulatorManager").checkManipulationInProgress();for(var i in n&&(t=!1),e)if(!e[i].QueryInterface("VCXIModifiableView")){t=!1,console.warn("No modifiable view found for some elements selected");break}t&&(this._lastSelection.equals(e)?this.updatePanel(e):0===e.length?this.emptyPanel():this.RebuildPanel(e))},executeHeaderCommand:function(e){e.preventDefault();var n=(e.currentTarget||e.srcElement).dsModel.cmdId;if(""!==n){var i=null,a=this._vcxGuiManager._experienceBase.getManager("VCXContextManager");a&&(i=a.getContext()),t.getCommand(n,i)&&t.getCommand(n,i).begin()}e.stopImmediatePropagation(),e.stopPropagation()},activateLabelSelection:function(){this._propertiesPanelViewV2.onClickLabel=this.onClickLabel.bind(this),this._propertiesPanelViewV2.onDoubleClickLabel=this.onDoubleClickLabel.bind(this)},onClickLabel:function(e){if(2===e.detail)return;let t=e.target.propertyId;if(this._selectedPropsArray&&t)if(this._selectedPropsArray.includes(t)){let e=this._selectedPropsArray.indexOf(t);this._selectedPropsArray.splice(e,1),this._propertiesPanelViewV2.uiSelect(t,!1)}else this._selectedPropsArray.push(t),this._propertiesPanelViewV2.uiSelect(t,!0)},onDoubleClickLabel:function(e){if(this._selectedPropsArray.includes(e.target.propertyId)){let e=this._propertiesPanelViewV2.selectAllProps();this._selectedPropsArray=e}else this._propertiesPanelViewV2.deselectAllProps(),this._selectedPropsArray=[]},GetSelectedProperties:function(){if(this._selectedPropsArray)return this._selectedPropsArray},getSelectedModifiableviews:function(){var e=[];return this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().every(function(t){return e.push(t.QueryInterface("VCXIModifiableView")),!0}),e},fillEnumInformationInto:function(e,t,n,i){var a=this.getSelectedModifiableviews(),r=t.GetPropertyValue(),o=t.GetPropertyInfo();if(o.GetMapChoiceEnum&&o.GetMapChoiceEnum()){var s,l=o.GetMapChoiceEnum(),c={propertyGroup:n,strPropId:e,propInfo:o,modifiableViewList:a},d=this._getTranslationI18n(c).choices,p=Object.keys(l),u={};for(var h of p)d[h]?(u[d[h]]=l[h],h===r.GetValue()+""&&(s=d[h])):(u[l[h]]=l[h],h===r.GetValue()+""&&(s=l[h]));i.enum=u,i.enumValue=s}},_generateDivForProperty:function(e){var t=new UWA.Element("div",{class:F.propertyNode});if(new UWA.Element("div",{html:e.label,class:F.nodeLabel}).inject(t),e.tweaker&&e.tweaker.inject(t),e.propSettings&&(e.propSettings.disableLiveChange&&"number"==typeof e.propSettings.disableLiveChange&&t.addEventListener("liveChange",t=>{t.stopPropagation(),this._liveChangeTimeout&&clearTimeout(this._liveChangeTimeout),this._liveChangeTimeout=setTimeout(()=>{this._onLiveChange(t),this._liveChangeTimeout=void 0},e.propSettings.disableLiveChange)}),e.propSettings.buttons))for(var n=0;n<e.propSettings.buttons.length;n++){var a=e.propSettings.buttons[n],r=null;if(a.available){if("Restore"===a.type){var o=!1;if(a.data&&a.data.propertiesToRestore&&a.data.object)for(var s=this._vcxGuiManager._experienceBase.getManager("VCXScenarioManager"),l=a.data.object.QueryInterface("VCXIModifiable"),c=0;c<a.data.propertiesToRestore.length;c++){var d=a.data.propertiesToRestore[c];if(s.IsCurrentPropertyDifferentFromNeutral(l,d)){o=!0;break}}(r=new i({displayStyle:"lite",disabled:!o,icon:{iconPath:C.getWebappsAssetUrl("VCXWebGUI","icons/32/VCX_Restore_grey.png")}})).elements.container.title=a.tooltip||"Restore Default Value",a.location=20,r.additionalButtonFunction=this.restoreProperties.bind(this),r.additionalButtonFunctionArgs={data:a.data},t.addClassName("vcx-prop-restorable")}else if("NavigateTo"===a.type){t.getChildren().every(e=>(e.hasClassName("vcx-propNode-label")||t.removeChild(e),!0)),new UWA.Element("div",{html:"Overruled",class:"vcx-prop-overruled"}).inject(t),r=new i({label:"Go to parent"}),a.location=20,r.additionalButtonFunction=this.navigateToParent.bind(this),r.additionalButtonFunctionArgs={data:a.data},r.getContent().addClassName("vcx-goToParent-button")}else"ChangeProperties"===a.type?(r=new i({displayStyle:"lite",icon:{iconName:"3dproduct",fontIconFamily:WUXManagedFontIcons.Font3DS}}),a.location=20,r.additionalButtonFunction=this.changePropsOfModifiable.bind(this),r.additionalButtonFunctionArgs={data:a.data}):((r=new i({displayStyle:"lite",icon:{iconName:a.iconName||"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}})).additionalButtonFunction=a.functionCB,r.additionalButtonFunctionArgs={name:a.name,propertyName:e.propSettings.propertyName,data:a.data},r.elements.container.title=a.tooltip||"");a.location?a.location>t.getChildren().length?r.inject(t):t.insertBefore(r.getContent(),t.getChildren()[a.location-1]):console.warn("A button "+a.name+" was attempted to be created without location: button not created")}}return t},_generateExpanderInfosForGroup:function(e){var t={header:e.label,body:null,groupID:e.groupID};if(e.group){var n=null;"boolean"==typeof e.toggle&&"Actor.Hyperlink_Action"!==e.propName&&(n=new s({displayStyle:"switch",value:e.toggle,disabled:e.disabled||W.PlayerMode}),e.groupID&&n.elements.container.addClassName("vcx-tweaker-group-"+e.groupID.replaceAll(".","-").replaceAll("_","-")),n.internalOptions={propName:e.propName,touch:this._vcxGuiManager.isTouchActivated()},t.customHeader=n,t.hideArrow=!e.toggle,W.PlayerMode||(n.addEventListener("pointerup",this._onTweakerPointerUpCB),this._listTweakersWithPtrUpEvt.push(n)))}return t},_addPointerupCBToTweaker:function(e){e.addEventListener("pointerup",this._onTweakerPointerUpCB),this._listTweakersWithPtrUpEvt.push(e)},_createSliderTweaker:function(e,t,n,i,a,r){var o=new UWA.Element("div",{class:F.sliderContainer+" "+F.propertyNodeTweakers}),s=new d({displayStyle:"slider",value:this._simplifyNumberDisplay(e),minValue:t,maxValue:n,stepValue:i,disabled:a});if(s.inject(o),this._propertiesPanelView.activeTweakersList.push(s),s.internalOptions=r,!s.getContent().classList.contains(F.sliderContainerSliderTweaker)&&s.getContent().classList.add(F.sliderContainerSliderTweaker),this._addPointerupCBToTweaker(s),!a){var l=new d({value:this._simplifyNumberDisplay(e),minValue:t,maxValue:n,stepValue:i,disabled:a});l.inject(o),this._propertiesPanelView.activeTweakersList.push(l),l.internalOptions=r,!l.getContent().classList.contains(F.sliderContainerSpinBoxTweaker)&&l.getContent().classList.add(F.sliderContainerSpinBoxTweaker),this._addPointerupCBToTweaker(l)}return o},getProperty4CID:function(e,t,n,i,a,r,h,g,m){a=a||W.PlayerMode;var C={};C.propName=n,C.data=i,C.disabled=a,C.touch=this._vcxGuiManager.isTouchActivated();var v=!1,_=null,f=e.GetType();C.dataType=f;var b=r?void 0:h&&h.showUndefined?void 0:e.GetValue();switch(f){case"VCXPropertyValueDocId":if(a)C.data="",_=new p({value:"",disabled:a});else{var y=b,x="Upload texture.",P="";if(y>=0){var S=this._vcxGuiManager._experienceBase.getManager("VCXDocManager").GetPropPath(y),V=S&&S.GetValueURL();C.data=V&&V.GetValue(),P=S&&S.GetFileName().GetValue()}x=(""===P||"I_VCX_DefaultTexture.png"===P)&&this._imageUploadPlaceHolder&&this._textureUploadPlaceHolder?n.includes("Image")?this._imageUploadPlaceHolder:this._textureUploadPlaceHolder:P,_=new o({placeholder:x,disabled:a})}break;case"VCXPropertyValueDate":C.data=b,_=new c({value:b,timePickerFlag:!0,timePickerPrecision:"sec",disabled:a});break;case"VCXPropertyValueColor":var M=b?b.GetColorHexString():void 0;C.data=M?"#"+M:null,C.display=a?"std":"colorBar",_=new l({value:r?null:M,disabled:a});break;case"VCXPropertyValueFloat":-1!==n.search("Opacity")&&(C.data=b,_=this._createSliderTweaker(b,0,1,.01,a,C),v=!0);break;case"VCXPropertyValueHyperlinkId":C.data=b;break;case"VCXPropertyValueBoolean":C.data=b,_=new s({displayStyle:"switch",value:b,disabled:a});break;case"VCXPropertyValuePoint2D":var w=["x","y"],I=b&&b.toArray().map(e=>this._simplifyNumberDisplay(e));_=new u({value:I,definition:w,readOnly:a});break;case"VCXPropertyValuePoint":w=n.includes("Orientation")?["ψ","θ","φ"]:["x","y","z"],I=b&&b.toArray().map(e=>this._simplifyNumberDisplay(e)),_=new u({value:I,definition:w,readOnly:a});break;case"VCXPropertyValueString":default:"Actor.Name"===n||a?_=new p({value:b,disabled:a}):(C.display="editorInline",_=new p({value:b,displayStyle:C.display,disabled:a}))}if(t.GetMapChoiceEnum&&t.GetMapChoiceEnum()){C.dataType="VCXPropertyValueEnum";var T=t.GetMapChoiceEnum();if(0!==Object.keys(T).length){var D=[];if(t){for(var E in T)if(T.hasOwnProperty(E)){var G=T[E];if(G.includes("__DONOTTRANSLATE__"))G=G.replace("__DONOTTRANSLATE__","");else{var X={group:m,propertyName:n},k=g.getTranslatedProperty(X);k&&k.choice&&k.choice[E]&&(G=k.choice[E])}D[E]=G}void 0===b&&D.unshift(""),h&&h.displayStyle?C.display=h.displayStyle:C.display="combo",_=new p({displayStyle:C.display,possibleValues:Object.values(D),value:D[b],disabled:a})}}}if("VCXPropertyValueFloat"===e.GetType()&&-1===n.search("Opacity")||"VCXPropertyValueInt"===e.GetType())if(t.IsBounded&&t.IsBounded()){var A=t.GetBounds().step,B=t.GetBounds().valueMin;A===(N=t.GetBounds().valueMax)&&(A/=10),_=this._createSliderTweaker(b,B,N,A,a,C),v=!0}else{(A=""===t?1:t.GetBounds().step)||(A=.1);B=""===t?null:t.GetBounds().valueMin;var N=""===t?null:t.GetBounds().valueMax;_=new d({value:this._simplifyNumberDisplay(b),minValue:B,maxValue:N,stepValue:A,disabled:a})}return _?_.internalOptions=C:_=new UWA.Element("div"),v||W.PlayerMode||this._addPointerupCBToTweaker(_),_.elements&&_.elements.container&&_.elements.container.addClassName("vcx-tweaker-"+n.replaceAll(".","-").replaceAll("_","-")),_},navigateToParent:function(e){if(e&&e.data&&e.data.objectToNavigateTo){var t=this._vcxGuiManager._experienceBase.getManager("VCXCommandManager"),n=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager"),i=new P(n);i.SetSelection(e.data.objectToNavigateTo),t.Do(i)}},restoreProperties:function(e){if(e&&e.data&&e.data.propertiesToRestore&&e.data.object){var t=this._vcxGuiManager._experienceBase,n=t.getManager("VCXCommandManager"),i=t.getManager("VCXScenarioManager"),a=e.data.object.QueryInterface("VCXIModifiable"),r=a.GetHashing();if(r){var o=i.GetNeutrals(r);if(o){this._preventRefresh=!0;for(var s=0;s<e.data.propertiesToRestore.length;s++){var l=e.data.propertiesToRestore[s];if(o._map.hasOwnProperty(l)){var c=o.GetProperty(l);if(c){var d=new S(i,n);d.ChangeProperty(a,c),n.Push(d)}}}this._preventRefresh=!1}}}},changePropsOfModifiable:function(e){if(e&&e.data&&e.data.propertyMapToApply){var t=this._vcxGuiManager._experienceBase,n=t.getManager("VCXCommandManager"),i=new S(t.getManager("VCXScenarioManager"),n),a=e.data.propertyMapToApply,r=[];if(a&&a.GetListModifiables&&a.GetPropertySet){n.StartTransaction();var o=t.getManager("VCXScenarioManager").ModifiableServer;a.GetListModifiables(r);for(var s=0;s<r.length;s++){var l=r[s],c=a.GetPropertySet(l)._map;for(var d in c)if(c.hasOwnProperty(d)){var p=a.GetPropertySet(l).GetProperty(d);p&&i.ChangeProperty(o.GetModifiableFromHashing(l),p)}}t.getManager("VCXCommandManager").Push(i),n.EndTransaction()}else console.error("argument is not a VCXPropertyMap")}else console.warn("Arguments not suitable to change properties")},BuildIntersection:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i&&i.QueryInterface("VCXIModifiable"),r=a&&a.GetProperties();r&&t.push(r)}var o=new T;return o.Intersection(t),o},_getPropertiesFromPropertyGroups:function(e,t){for(var n=new T,i=t.getListPropertiesNames(),a=0;a<e.length;a++)for(var r=e[a],o=r&&r.QueryInterface("VCXIModifiable"),s=0;s<i.length;++s){var l=i[s],c=o.GetProperty(l);if(c){var d=n.GetProperty(l);d?d.GetPropertyValue().IsEqualTo(c.GetPropertyValue())||(d.GetPropertyInfo().SetDefined(!1),i.splice(s,1),--s):n.AddOrModifyProperty(c.Clone())}else this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getUrlVars().debug,i.splice(s,1),--s}return n},BuildIntersectionPropertyGroups:function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n].QueryInterface("VCXIModifiableView"),a=i&&i.getPropertyGroups&&i.getPropertyGroups();if(a){Object.keys(a).forEach(e=>{var t=i.getAdditionalPropertySettings&&i.getAdditionalPropertySettings()||{};a[e].additionalPropertySettings={},Object.keys(a[e]._propertiesInfos).forEach(n=>{t[n]&&(a[e].additionalPropertySettings[n]=t[n])})});var r=new E;r.SetFromGroupsMap(a),t.push(r)}else e.splice(n,1),--n}var o=new E;return o.Intersection(t),o},_searchCallback:function(e){var t=this.treeList.getDocument();if(t.prepareUpdate(),""!==e){for(i=t.getChildren(),a=0;a<i.length;a++)i[a].hide(),i[a].hideChildNodes();var n=this.treeList.getManager().search({shouldStop:e=>!1,match:t=>{if(e&&(-1!==t.nodeModel.options.label.toLowerCase().indexOf(e)||t.nodeModel.options.grid.data&&(-1!==t.nodeModel.options.grid.data.toString().toLowerCase().indexOf(e)||-1!==t.nodeModel.options.grid.propName.toString().toLowerCase().indexOf(e))))return!0}});g.optimizedForEach(n,(e,t)=>{null!==e._parentNode&&e._parentNode.show(),e.show()}),t.pushUpdate()}else{for(var i=t.getChildren(),a=0;a<i.length;a++)i[a].show(),i[a].showChildNodes();t.pushUpdate()}},_onShowTweaker:function(e){},_onHideTweaker:function(e){},_onCancelEdit:function(e){console.log("_onCancelEdit"),this.modifyWhile=!1,this._canceledEdit=!0,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").EndTransaction();var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer();this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").showDecorations("PanelPropLiveChange",t),this._onNodeModelUpdate(e)},_onPreEdit:function(e){console.log("_onPreEdit"),this.modifyWhile=!0,this._currentlyEditing=!0,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").StartTransaction();var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer();this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").hideDecorations("PanelPropLiveChange",t)},_onPostEdit:function(e){console.log("_onPostEdit"),this.modifyWhile=!1,this._currentlyEditing=!1,this._vcxGuiManager._experienceBase.getManager("VCXCommandManager").EndTransaction();var t=this._vcxGuiManager._experienceBase.getManager("VCXContextManager").getMainViewer();if(this._vcxGuiManager._experienceBase.getManager("VCXVisuManager").showDecorations("PanelPropLiveChange",t),this._onNodeModelUpdate(e),void 0!==this._vcxGuiManager._experienceBase.odt){for(var n=null,i=cmdManager._stackCmd.length-1;i>=0;i--){var a=cmdManager._stackCmd[i];if(a)if(!a.IsLinkedCmd()){n=a;break}}if("VCXCmdChangePropertiesAutokey"===n.GetType()){var r=(new v)._PropMapToJson(this._vcxGuiManager._experienceBase,n._propertyMap);console.log(r),this._vcxGuiManager._experienceBase.getManager("VCXAPIManager").ChangeProperties(r)}}},_onLiveChange:function(e){if(console.log("_onLiveChange"),e&&e.dsModel&&e.dsModel.internalOptions){var t=this._propertiesPanelModel.getMainPropNameFromBoxedPropName(e.dsModel.internalOptions.propName);M.RemoveStyleFromCurrentSelection(this._vcxGuiManager._experienceBase,!0,t)}this._onNodeModelUpdate(e)},_onChange:function(e){if(!this.controllerIsUpdatingUI){if(this.modifyWhile=!0,e&&e.dsModel&&e.dsModel.internalOptions){var t=this._propertiesPanelModel.getMainPropNameFromBoxedPropName(e.dsModel.internalOptions.propName);M.RemoveStyleFromCurrentSelection(this._vcxGuiManager._experienceBase,!0,t)}this._onNodeModelUpdate(e),this.modifyWhile=!1}},_onButtonClick:function(e){e.dsModel&&e.dsModel.additionalButtonFunction&&e.dsModel.additionalButtonFunction(e.dsModel.additionalButtonFunctionArgs)},_onExpand:function(e){var t=e.options.expanderTarget.groupID;if(t){var n=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();this._propertiesPanelModel.removeCollapsedGroupForComponents(n,t)}},_onCollapse:function(e){var t=e.options.expanderTarget.groupID;if(t){var n=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection();this._propertiesPanelModel.addCollapsedGroupForComponents(n,t)}},_getPropertyNameNLS:function(e,t,n,i,a){var r=e,o=t.GetMetaPropertyDef();if(o){var s=o.GetDefaultLabel();s&&(r=s)}else if(!i.noNLS){n.isPropertyIn(e)||console.warn("Property "+e+" isn't in the group "+n.groupID+" !!");var l={propertyName:e,group:n};r=a.getTranslatedProperty(l).propertyName}return r},_getTranslationI18n:function(e){var t=e.strPropId,n=e.propInfo,i=e.propertyGroup,a=e.urlVariables,r=e.modifiableViewList,o={};if(t){if(o.propName=t,o.choices={},n&&n.GetMetaPropertyDef()){var s=n.GetMetaPropertyDef().GetDefaultLabel();s&&(o.propName=s)}else if(!a||!a.noNLS){var l={propertyName:t,group:i};r.every(e=>{var i=e.getTranslatedProperty(l);if(o.propName===t?o.propName=i.propertyName:o.propName===i.propertyName||(console.error("Translation error, differs from one modifiable to the other for property: ",t),o.propName="error"),i.choice&&0!==Object.keys(i.choice).length&&i.choice.constructor===Object)0===Object.keys(o.choices).length?o.choices=i.choice:Object.keys(i.choice).equals(Object.keys(o.choices))&&Object.values(i.choice).equals(Object.values(o.choices))||(console.error("Enumeration error, differs from one modifiable to the other for property: ",t),o.choices={error:"error"});else if(n.GetMapChoiceEnum&&n.GetMapChoiceEnum()){o.choices=n.GetMapChoiceEnum(),Object.keys(o.choices).every(e=>(o.choices[e]=o.choices[e].replace("__DONOTTRANSLATE__",""),!0))}return!0})}}else o.groupName=i.groupID,r.every(e=>{var n={group:i},a=e.getTranslatedProperty(n)&&e.getTranslatedProperty(n).groupName;if(o.groupName===i.groupID)o.groupName=a;else if(o.groupName!==a)return console.error("Translation error, differs from one modifiable to the other for property: ",t),o.groupName="error",!1;return!0});return o},_isPropertyDisplayed:function(e,t){var n=e.GetPropertyValue();if(!n)return!1;if(!t.propertiesNoFilter&&("VCXPropertyValueVector"===n.GetType()||"VCXPropertyValueAnchor"===n.GetType()||"VCXPropertyValueMap"===n.GetType()))return!1;var i=this._vcxGuiManager._experienceBase,a=i&&i.getManager("VCXContextManager");return!!(t.propertiesNoFilter||"VCXPropertyValueFrame"!==n.GetType()&&"VCXPropertyValueLocation"!==n.GetType()||a&&a.isSupported("FrameUnboxing"))},_isPropLocked:function(e){return e.GetLockedStatus()},_addLockToTweakers:function(e,t,n){var a=new i({displayStyle:"lite",icon:{iconName:"lock",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",checkFlag:t});a.getContent().addClassName(F.buttonPropertiesLinked);var r=()=>{this._onClickTweakerLockIcon(n)};a.getContent().addEventListener("change",r),a.inject(e),this._listButtonsLockToUnsubscribe.push([a,r])},_onClickTweakerLockIcon:function(e){this._changeInLocks=!0;for(var t=this._vcxGuiManager._experienceBase.getManager("VCXSelectionManager").GetComponentsFromCurrentSelection().map(e=>e.QueryInterface("VCXIModifiableView")),n=0;n<t.length;n++){var i=t[n],a=i.IsPropertyLocked(e);"boolean"==typeof a&&i.SetPropertyLocked(e,!a)}this.RefreshPanel(),this.requestChangeInPanel()},_simplifyNumberDisplay:function(e,t){if(Number.isInteger(e))return e;if(Math.abs(e)<1e-5)return 0;var n="number"==typeof t?t:2;return"number"!=typeof e?void 0===e?e:(console.warn("TweakerNumber object needs a number as input"),null):Math.abs(e)<1?Number(e.toPrecision(n)):Number(e.toFixed(n))},displayFakePropertiesForODT:function(){this._listTweakersWithPtrUpEvt=[];var e=this._generateAllTweakersTypes(),t=Object.keys(e),n=null,i=null,a=new UWA.Element("div",{class:F.propertiesContainer}),r=this._generateExpanderInfosForGroup({label:"Group ODT",group:!0,toggle:!0,disabled:!1,propName:"groupODT"});r.body=a;for(var o=0;o<t.length;++o){var s=t[o],l=e[s];n=new UWA.Element("div",{class:F.propertyNodeTweakers+" "+s});l.inject(n),i={label:s,tweaker:n,experienceBase:this._vcxGuiManager._experienceBase,touch:!1};var c=this._generateDivForProperty(i);c&&c.inject(a)}return this._propertiesPanelView.putContainer(),this._propertiesPanelView.emptyContainerContent(),this._propertiesPanelView.updateAccordeonForODT([r]),t},_generateAllTweakersTypes:function(){var e={};e.blobEnabled=new o({placeholder:"Upload texture",disabled:!1}),e.blobDisabled=new p({value:"",disabled:!1});var t=(new X).GetValue();e.dateEnabled=new c({value:t,timePickerFlag:!0,timePickerPrecision:"sec",disabled:!1}),e.dateDisabled=new c({value:t,timePickerFlag:!0,timePickerPrecision:"sec",disabled:!0});e.colorEnabled=new l({value:"00FF00",disabled:!1}),e.colorDisabled=new l({value:"00FF00",disabled:!0}),e.colorNullEnabled=new l({value:null,disabled:!1}),e.colorNullDisabled=new l({value:null,disabled:!0});e.floatBoundedEnabled=this._createSliderTweaker(.45,0,1,.01,!1,{}),e.floatBoundedDisabled=this._createSliderTweaker(.45,0,1,.01,!0,{}),e.floatUnboundedEnabled=new d({value:this._simplifyNumberDisplay(.45),stepValue:.1,disabled:!1}),e.floatUnboundedDisabled=new d({value:this._simplifyNumberDisplay(.45),stepValue:.1,disabled:!0});e.booleanEnabled=new s({displayStyle:"switch",value:!0,disabled:!1}),e.booleanDisabled=new s({displayStyle:"switch",value:!0,disabled:!0});var n=[.654327,168532].map(e=>this._simplifyNumberDisplay(e)),i=["x","y"],a=[.654327,168532,245.24986].map(e=>this._simplifyNumberDisplay(e)),r=["x","y","z"];e.point2dEnable=new u({value:n,definition:i,readOnly:!1}),e.point2dDisable=new u({value:n,definition:i,readOnly:!0}),e.point3dEnable=new u({value:a,definition:r,readOnly:!1}),e.point3dDisable=new u({value:a,definition:r,readOnly:!0});var h=["Option 0","Option 1","Option 2","Option 3"];return e.comboEnable=new p({displayStyle:"combo",possibleValues:Object.values(h),value:h[2],disabled:!1}),e.comboDisable=new p({displayStyle:"combo",possibleValues:Object.values(h),value:h[2],disabled:!0}),e},removeFakePropertiesForODT:function(){if(Array.isArray(this._listTweakersWithPtrUpEvt)){for(var e=0;e<this._listTweakersWithPtrUpEvt.length;++e){this._listTweakersWithPtrUpEvt[e].removeEventListener("pointerup",this._onTweakerPointerUpCB)}this._listTweakersWithPtrUpEvt=null}}});return W.setChildrenDataRecID=function(e,t){for(var n=e.getChildren(),i=0;i<n.length;i++){var a=n[i],r=t+"_"+i;a.setAttribute("data-rec-id",r),W.setChildrenDataRecID(a,r)}},W.generateCellView=function(e,t){var n=e.cellView,a={readOnly:!1,touchMode:!1};if(e.nodeModel&&e.nodeModel.options){var r=e.nodeModel.options.grid;if(a.readOnly=0,a.readOnlyReal=r.disabled|=W.PlayerMode,a.touchMode=r.touch,void 0===a.popup){if(void 0===r.data)return;t.generateView(r.data,{context:r.context,typePath:r.typePath,readOnlyReal:a.readOnlyReal,readOnly:a.readOnly,touchMode:a.touchMode,semantics:r.semantics,onViewCreated:(e,t)=>{void 0!==e&&(this.readOnlyReal&&(e.elements.internalView.disabled=!0),n.getContent().setContent(e))}})}else{var o=new i({label:"Edit..."});n.getContent().setContent(o)}}},W});