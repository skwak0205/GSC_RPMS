/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
define("DS/PADUtils/views/PADDropInvit_disabled",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,n){"use strict";return t.extend(n,{name:"pad_invite",active_invite:"",init:function(e){},show:function(e){this.active_invite=e},hide:function(e){this.active_invite=""}})}),define("DS/PADUtils/PADClipboard",["UWA/Class","UWA/Class/Events","DS/Logger/Logger"],function(e,t,n){"use strict";var i=n.getLogger("DS/PADUtils/PADClipboard"),o={OBJECT:null,POSITION:null},s=e.extend(t,{init:function(){this._parent();var e=this;document&&document.addEventListener&&document.addEventListener("keyup",function(t){27===t.keyCode&&(i.log("Clear the Clipboard"),e.clear())})},_checkpageAndThrow:function(e){if(i.debug('Checking if "%s" is a valid page',e),!o.hasOwnProperty(e))throw i.error("Check failed"),new Error('"'+e+'" is not a valid page')},setData:function(e,t){i.info('Setting data in page "%s"',e),i.debug("  Data %o",t),this._checkpageAndThrow(e),this.dispatchEvent("pre_setData",arguments),o[e]=UWA.clone(t),this.dispatchEvent("post_setData",arguments)},getData:function(e){return i.info('Getting data in page "%s"',e),this._checkpageAndThrow(e),UWA.clone(o[e])},consumeData:function(e,t){i.info('Consuming data in page "%s"',e);var n=this.getData(e);return t&&this.clear(e),n},clear:function(e){if(e)i.info('Clearing clipboard page "%s"',e),this._checkpageAndThrow(e),this.dispatchEvent("pre_clear",arguments),o[e]=void 0;else for(var t in i.info("Clearing clipboard"),this.dispatchEvent("pre_clear",arguments),o)o.hasOwnProperty(t)&&(o[t]=void 0);this.dispatchEvent("post_clear",arguments)},isEmpty:function(e){if(e){if(this._checkpageAndThrow(e),o[e])return!1}else for(var t in o)if(o.hasOwnProperty(t)&&o[t])return!1;return!0}}).singleton({init:function(){this._parent()}});for(var a in o)o.hasOwnProperty(a)&&(s[a]=a);return s}),define("DS/PADUtils/Configuration",["text!DS/PADUtils/assets/GlobalConfiguration.json","UWA/Core","UWA/Class"],function(e,t,n){"use strict";var i=JSON.parse(e);return n.singleton({notFlagInit:!0,initialize:function(e){this.notFlagInit&&(this.notFlagInit=!1,window.__karma__&&window.__karma__.config.json&&window.__karma__.config.json.Configuration&&this.mergeConfig(window.__karma__.config.json.Configuration))},getConfig:function(e){return this.initialize(),!!i.settings[e]&&i.settings[e].value},mergeConfig:function(e){i=t.extend(i,e,!0)},getWebAPIOptions:function(e){return i.webapiDefaults[e]?t.clone(i.webapiDefaults[e],!0):{}}})}),define("DS/PADUtils/views/PADColorPicker",["DS/PADServices/views/private/ColorPicker"],function(e){"use strict";return console.warn("DS/PADUtils/views/PADColorPicker is a private component"),e}),define("DS/PADUtils/PADIndexedDb",["UWA/Core","UWA/Class"],function(e,t){return t.singleton({name:"PADIndexedDb",userStore:"user",scStore:"sc",_dbName:"eno_apps_2021x",_db:null,_version:1,_storeNames:["user","sc"],_keyPath:"id",_columns:{user:["id","dashboards","activeDashboard","preferredSC","timestamp"],sc:["id","userId","dashboardId","activeSC","timestamp"]},init:function(t){var n,i;console.log("PADIndexedDb init called"),t=t||{},this._parent(t),that=this,e.is(that._db)||((n=indexedDB.open(that._dbName,that._version)).onupgradeneeded=function(e){that._db=e.target.result,that._storeNames.forEach(function(e){i=that._db.createObjectStore(e,{keyPath:that._keyPath}),that._columns[e].forEach(function(e){i.createIndex(e,e,{unique:"id"===e})})})},n.onsuccess=function(e){that._db=e.target.result},n.onerror=function(e){console.log("no db error",e.target.errorCode)})},get:function(t){var n;e.is(this._db)&&((n=this._db.transaction([t.storeName]).objectStore(t.storeName).get(t.id)).onsuccess=function(n){e.is(n.target.result)?e.is(t.foundCallback)&&t.foundCallback(n.target.result):e.is(t.notFoundCallback)&&t.notFoundCallback({msg:"no data found"})},n.onerror=function(n){console.log("error",n.target.errorCode),e.is(t.notFoundCallback)&&t.notFoundCallback({msg:"no data"})})},put:function(t){var n,i;n={id:t.id,timestamp:Date.now()},t.hasOwnProperty("dashboards")&&(n.dashboards=t.dashboards),t.hasOwnProperty("activeDashboard")&&(n.activeDashboard=t.activeDashboard),t.hasOwnProperty("userId")&&(n.userId=t.userId),t.hasOwnProperty("dashboardId")&&(n.dashboardId=t.dashboardId),t.hasOwnProperty("activeSC")&&(n.activeSC=t.activeSC),t.hasOwnProperty("preferredSC")&&(n.preferredSC=t.preferredSC),e.is(this._db)&&((i=this._db.transaction([t.storeName],"readwrite").objectStore(t.storeName).put(n)).onsuccess=function(n){e.is(t.callback)&&t.callback(n.target.result)},i.onerror=function(n){console.log("put error",n.target.errorCode),e.is(t.callback)&&t.callback(n.target.errorCode)})},where:function(t){consol.count("where");if(e.is(this._db)){var n,i=this._db.transaction([t.storeName]).objectStore(t.storeName).index(t.iIndex1),o=[],s=!1;i.openCursor(IDBKeyRange.only(t.iValue1)).onsuccess=function(i){var a=i.target.result;e.is(a)?(s=!0,o.push(i.target.result.value),a.continue()):s?(t.iIndex2&&t.iValue2&&(o=o.filter(function(e){return e[iIndex2]===iValue2})),e.is(t.foundCallback,"function")&&(n=o.map(function(e){return e}),t.foundCallback(n))):e.is(t.notFoundCallback,"function")&&t.notFoundCallback({msg:"not found"})}}},getStoreName:function(e){var t;return"user"===e.storeName&&(t=this.userStore),"sc"===e.storeName&&(t=this.scStore),t},getData:function(t){var n=this.getStoreName(t);e.is(n)?this.get(t):t.notFoundCallback({msg:"no dataStore found"})},storeData:function(t){var n=this.getStoreName(t);e.is(n)?this.put(t):console.warn("no data store provided")},getUser:function(e){e.storeName||(e.storeName=this.userStore),this.get(e)},addUser:function(e){e.storeName||(e.storeName=this.userStore),this.put(e)},getSC:function(e){e.storeName||(e.storeName=this.scStore),this.get(e)},addSC:function(e){that=this,e.storeName||(e.storeName=that.scStore),that.put(e)},updateUser:function(t){var n=this;if(e.is(n._db)){t.storeName||(t.storeName=n.userStore);var i=n._db.transaction([t.storeName],"readwrite").objectStore(t.storeName),o=i.get(t.id);o.onerror=function(e){console.log("error in get User data to update")},o.onsuccess=function(o){var s=o.target.result;if(s){t.hasOwnProperty("dashboards")&&(s.dashboards=t.dashboards),t.hasOwnProperty("activeDashboard")&&(s.activeDashboard=t.activeDashboard),t.hasOwnProperty("preferedSC")&&(s.preferedSC=t.preferedSC),s.timestamp=Date.now();var a=i.put(s);a.onerror=function(e){console.warn("update user error")},a.onsuccess=function(n){e.is(t.callback,"function")&&t.callback(n.target.result)}}else n.addUser(t)}}},updateSC:function(t){var n=this;if(e.is(n._db)){t.storeName||(t.storeName=n.scStore);var i=n._db.transaction([t.storeName],"readwrite").objectStore(t.storeName),o=i.get(t.id);o.onerror=function(e){console.log("error in get SC data to update",e.target.errorCode)},o.onsuccess=function(o){var s=o.target.result;if(s){t.hasOwnProperty("userId")&&(s.userId=t.userId),t.hasOwnProperty("dashboardId")&&(s.dashboardId=t.dashboardId),t.hasOwnProperty("activeSC")&&(s.activeSC=t.activeSC),s.timestamp=Date.now();var a=i.put(s);a.onerror=function(e){console.warn("updateSC error",e.target.errorCode)},a.onsuccess=function(n){e.is(t.callback,"function")&&t.callback(n.target.result)}}else n.addSC(t)}}}})}),define("DS/PADUtils/views/PADTenantMgt",["css!DS/UIKIT/UIKIT","css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Class/Events","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/Controls/Button","DS/UIKIT/Tooltip"],function(e,t,n,i,o,s,a,r){return o.extend(i,{name:"PadTenantMgt",_command_id:"",init:function(e){var t=this;this._parent(e),e.renderTo||(e.renderTo=document.body);var i=UWA.createElement("div",{class:"padcustomizeview_instruction",content:n.platformChangeMsg}),o=UWA.createElement("div",{class:"footerModal"});changeButton=new a({label:n.change,emphasize:"primary",touchMode:!0,onClick:function(){t.options.currentTenant.isClearView=!0,t.options.callback(t.options.currentTenant),t.modal.hide(),t.modal.destroy()}}),changeButton.inject(o),new a({label:n.cancel,touchMode:!0,onClick:function(){t.options.currentTenant.isMultiTenant=!0,t.options.callback(t.options.currentTenant),t.modal.hide(),t.modal.destroy()}}).inject(o),this.modal=new s({className:"padtenantmgt",closable:!0,visible:!0,header:n.platformChangeTitle,body:i,footer:o}).inject(e.renderTo)}})}),define("DS/PADUtils/views/PADDropInvit",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,n,i,o){"use strict";return i.extend(o,{name:"pad_invite",available_invite:{drop:{fonticon:"down-circled",nls:"drop"},add:{fonticon:"plus-circled",nls:"add"},insert:{fonticon:"plus-circled",nls:"insert"},find:{fonticon:"search",nls:"find"}},active_invite:"drop",init:function(e){for(var n in this._parent(e),this.elements.container=UWA.createElement("div",{class:this.getClassNames("_container")}),this.available_invite)this.available_invite.hasOwnProperty(n)&&(this.elements.container[n]=UWA.createElement("div",{class:this.getClassNames("_display "+n),draggable:!1}),UWA.createElement("span",{class:this.getClassNames("_img fonticon fonticon-3x fonticon-"+this.available_invite[n].fonticon)}).inject(this.elements.container[n]),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+n),text:t["PADDropInvit_"+this.available_invite[n].nls]}).inject(this.elements.container[n]),this.elements.container[n].inject(this.elements.container),this.active_invite!==n&&this.elements.container[n].hide());this.getOption("renderTo")&&this.elements.container.inject(this.getOption("renderTo"))},show:function(e){this.active_invite!=e&&(UWA.is(e,"string")?(this.active_invite!==e&&""!=this.active_invite&&this.elements.container[this.active_invite].hide(),this.active_invite=e):this.active_invite="drop",this.elements.container[this.active_invite].show(),this.elements.container.show())},hide:function(e){UWA.is(e,"string")?""!=this.active_invite&&this.active_invite===e&&(this.elements.container[this.active_invite].hide(),this.elements.container.hide()):""!=this.active_invite&&(this.elements.container[this.active_invite].hide(),this.elements.container.hide()),this.active_invite=""}})}),define("DS/PADUtils/views/PADDropTooltip",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events"],function(e,t,n,i,o,s){"use strict";return i.extend(o,s,{name:"paddrop_tooltip",defaultOptions:{tooltips:{add_in_context:{nls:"add_in_context",icon:"plus"},add_as_object:{nls:"add_as_object",icon:"plus"},insert:{nls:"insert",icon:"plus"},find:{icon:"search",nls:"find"}}},_active_tooltip:null,_isDisplayed:!1,_fonticon:null,_label:null,init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"padutils_dropTooltip wux-afr-contextual-bar"});var t=UWA.createElement("table",{class:"enopad3Dviewer_dropTooltip_table"}).inject(this.elements.container).insertRow(0);this._fonticon=t.insertCell(0),this._label=t.insertCell(1),this._fonticon.appendChild(UWA.createElement("span",{class:"padutils_dropTooltip_ftIcon wux-ui-3ds wux-ui-3ds-plus"})),this._label.appendChild(UWA.createElement("div",{class:"wux-afr-label"}))},show:function(e){var n=this.elements.container.getDimensions(),i=n.width,o=n.height,s=this.getOption("renderTo");if(!this._isDisplayed&&s&&(this.elements.container.inject(s),this._isDisplayed=!0),e.intent!==this._active_tooltip){for(;this._fonticon.firstChild;)this._fonticon.removeChild(this._fonticon.firstChild);this._fonticon.appendChild(UWA.createElement("span",{class:"padutils_dropTooltip_ftIcon wux-ui-3ds wux-ui-3ds-"+this.options.tooltips[e.intent].icon})),this._label.textContent=t["PADDropInvit_"+this.options.tooltips[e.intent].nls],this._active_tooltip=e.intent}s.clientWidth<=i+e.x+15?this.elements.container.setStyles({left:s.clientWidth-i}):this.elements.container.setStyles({left:e.x+15}),s.clientHeight<=o+e.y+25?this.elements.container.setStyles({top:s.clientHeight-o}):this.elements.container.setStyles({top:e.y+25+"px"})},hide:function(){var e=this.getOption("renderTo");this._isDisplayed&&e&&(e.removeChild(this.elements.container),this._isDisplayed=!1)}})}),define("DS/PADUtils/PADPredicatesNls",["UWA/Core","UWA/Class","UWA/Class/Options","DS/PADServices/utils/DictionaryAccess"],function(e,t,n,i){"use strict";return t.singleton(n,{init:function(){this._nlsManager=i},updateColumnsWithNLS:function(e,t){this._nlsManager&&this._nlsManager.updateColumnsWithNLS(e,t)},updateNLS:function(e){this._nlsManager&&this._nlsManager.updateNLS(e)}})}),define("DS/PADUtils/views/PADProgressBar",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","DS/Controls/Loader","DS/Controls/Button"],function(e,t,n,i,o,s,a){"use strict";return i.singleton(o,{name:"pad_progressBar",_UILoader:null,_counter:0,_offTimeout:null,_onTimeout:null,_isCustomTextDisplayed:!1,_defaultText:"",_customText:"",_buttonCB:null,init:function(e){this._parent(e),this._defaultText=t.PADProgressBar_loading,this.elements.container=UWA.createElement("div",{class:"topBarContainer"}),this.render(e),this.elements.viewContainer=UWA.createElement("div",{class:"progressBarContainer"}).inject(this.elements.container),this._UILoader=new s({fadeDuration:0,showButtonFlag:!1}).inject(this.elements.viewContainer),this._button=new a({label:t.PADProgressBar_cancel,emphasize:"primary"}).inject(this._UILoader.elements.container);var n=this;this._button.elements.container.addClassName("PADProgressBar_cancelButton"),this._button.addEventListener("buttonclick",function(e){n._buttonCB&&n._buttonCB()}),n.elements.container.hide()},render:function(e){var t=e&&e.renderTo?e.renderTo:document.body;this.elements.container.inject(t)},destroy:function(){this._UILoader&&(this._UILoader.destroy(),delete this._UILoader),this._counter=0,this._offTimeout=null,this._isCustomTextDisplayed=!1,this._text="",this._customText="",this._2sTimeout&&(clearTimeout(this._2sTimeout),this._2sTimeout=null),this._10sTimeout&&(clearTimeout(this._10sTimeout),this._10sTimeout=null),this._parent()},on:function(e,n,i){var o=this;o.elements.container.show(),n?(this._buttonCB=n,this._button.label=void 0!==i?i:t.PADProgressBar_cancel,this._button.show()):this._button.hide(),this._defaultText=e||t.PADProgressBar_loading,this._customText=this._defaultText,this._isCustomTextDisplayed?this._UILoader.text=this._text:this._UILoader.text=this._defaultText,this._counter++,this._offTimeout&&clearTimeout(this._offTimeout),this._2sTimeout||(this._2sTimeout=setTimeout(function(){o.elements.viewContainer.addClassName("progressBarShown"),o._10sTimeout||(o._10sTimeout=setTimeout(function(){o._isCustomTextDisplayed=!0,o._UILoader.text=o._customText},8e3))},2e3)),o._UILoader.on()},off:function(){var e=this;this._counter--,0===this._counter&&(e._offTimeout=setTimeout(function(){e._2sTimeout&&clearTimeout(e._2sTimeout),e._10sTimeout&&clearTimeout(e._10sTimeout),e.elements.viewContainer.removeClassName("progressBarShown"),e._offTimeout=null,e._isCustomTextDisplayed=!1,e._2sTimeout=null,e._10sTimeout=null,e._customText="",e._buttonCB=null,setTimeout(function(){0===e._counter&&(e.elements.container.hide(),e._UILoader.off())},1e3)}))},update:function(e){this._UILoader&&this._UILoader.update(e)},setText:function(e){this._UILoader&&e&&(this._customText=e,this._isCustomTextDisplayed&&(this._UILoader.text=this._customText))}})}),define("DS/PADUtils/views/parametrization/Iconbar",["UWA/Core","UWA/Event","UWA/Utils","UWA/Controls/Abstract","DS/UIKIT/Menu","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu"],function(e,t,n,i,o,s,a){"use strict";var r=e.Utils.Client.Features.touchEvents;var l,c=(l=/^(divider)$/,function(e){var t,n;if(!e)return!1;for(t=e.split(" "),n=0;n<t.length;n++)if(l.test(t[n]))return!0;return!1}),d=o.extend({name:"iconbar-items",templateClassname:"iconbar-template"}),u=a.extend({show:function(){document.body.style.overflow="hidden",this._parent(),document.body.style.overflow="auto"}});return i.extend({name:"iconbar",menu:null,overflowMenu:null,overflowMenuTrigger:null,init:function(e){var t=this;this._parent(e),this.buildSkeleton(),this.handleEvents(),this.show(),window.MutationObserver&&(this._injectionObserver=new MutationObserver(function(e){e.some(function(e){return t.isInjected()||-1!==Array.prototype.indexOf.call(e.addedNodes,t.elements.container)})&&t.show()}),this._injectionObserver.observe(document.body,{childList:!0,subtree:!0}))},buildSkeleton:function(){var e=this.elements,t=this.options;e.container||(this.menu=new d({multiSelect:t.multiSelect}),this.addItem(t.items),e.container=this.menu.elements.container,e.container.className=this.getClassNames(),t.renderTo&&1===t.renderTo.nodeType&&(e.container.inject(t.renderTo),delete t.renderTo))},buildOverflowMenu:function(){var t,n,i=[];this.overflowMenuTrigger||(this.overflowMenuTrigger=e.createElement("li",{class:this.name+"-overflow-menu-trigger item",html:{tag:"span",class:"fonticon fonticon-menu-dot"}})),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenu=null,this.menu.items.forEach(function(e){e.content&&"dropdown"===e.content.type||(n=!0,t={className:(e.id+" "+(e.className?e.className:"")).trim(),fonticon:e.fonticon,text:e.text,name:e.name,handler:e.handler,selectable:e.selectable,selected:e.selected,disabled:e.disabled},e.content&&e.content.options.items&&"icondropdown"!==e.content.type?t.items=e.content.options.items.map(function(t){return t.className=(e.id+" "+(t.className?t.className:"")).trim(),t.selectable=!0,t}):e.content&&"icondropdown"===e.content.type&&(n=!1,e.content.options.items&&e.content.options.items.forEach(function(t){i.push({className:(e.id+" "+(t.className?t.className:"")).trim(),fonticon:t.fonticon,icon:t.icon,handler:t.handler,text:t.description})})),n&&i.push(t))}),this.overflowMenu=new u({multiSelect:this.options.multiSelect,items:i,target:this.overflowMenuTrigger,events:this.options.events})},getItem:function(e){var t,n,i,o=!1;for(t=0,n=this.menu.items.length;t<n;t++){if(o=this.menu.items[t],e&&e.nodeType){if(i=e.hasClassName("item")?e:e.getParent(),o.id===i.id)break}else if(t===e||o.id===e||o.name===e)break;o=!1}return o},handleEvents:function(){var e,n,i,o;this.events={container:{click:function(e){var n=t.getElement(e),i=this.getItem(n);i.selectable&&this.select(i.name,!i.selected),i&&(i.content&&(window.requestAnimationFrame?window.requestAnimationFrame(this.displayContent.bind(this,i)):this.displayContent(i)),i.tooltip&&i.tooltip.isVisible&&!r&&i.tooltip.hide(),this.dispatchEvent("onClick",[e,i],this),"function"==typeof i.handler&&i.handler.call(this,e,i))}.bind(this)}},this.elements.container.addEvents(this.events.container),this.events.window={resize:(e=this.resize,n=100,function(){var t,s=this,a=arguments;t=i&&!o,clearTimeout(o),o=setTimeout(function(){o=null,i||e.apply(s,a)},n),t&&e.apply(s,a)}).bind(this)},window.addEventListener("resize",this.events.window.resize)},addItem:function(e){return n.splat(e).forEach(function(e){this._addItem(e)},this),this.buildOverflowMenu(),this},_addItem:function(e){var t=this.menu._addItem(e);t.content=t.innerComponent||t.content,!c(e.className)&&t.text&&(t.tooltip=new s({target:t.elements.container,body:t.text,trigger:t.tooltipTrigger||this.options.tooltipsTrigger||"hover focus"}),t.elements.container.getElement(".item-text").remove())},isOverflowing:function(){return this.menu.items.some(function(e){return!e.elements.container.isInViewport(this.elements.container,!0,!0)}.bind(this))},isInjected:function(){if(this.elements&&this.elements.container)return this.elements.container.isInjected()},resize:function(){function e(e){this.overflowMenu.items.forEach(function(t){e.some(function(e){return!!t.className&&(t.className&&-1!==t.className.indexOf(e))})?t.elements.container.removeClassName("hidden"):t.elements.container.addClassName("hidden")})}return function(){var t,n;if(this.overflowMenuTrigger&&this.overflowMenuTrigger.isInjected()&&this.overflowMenuTrigger.remove(),this.overflowMenu.isVisible&&this.overflowMenu.hide(),(!this.elements.container||this.isOverflowing())&&(n=(t=function(){var e=this.elements.container.getBoundingClientRect();return this.menu.items.filter(function(t){var n=t.elements.container.getBoundingClientRect();return n.top+n.height>e.bottom||n.left+n.width>e.right},this)}.call(this)).map(function(e){return e.id}),e.call(this,n),t.length))for(this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,t[0].elements.container);!this.overflowMenuTrigger.isInViewport(this.elements.container,!0,!0)&&this.overflowMenuTrigger.previousSibling;)this.menu.elements.wrapper.insertBefore(this.overflowMenuTrigger,this.overflowMenuTrigger.previousSibling),t.push(this.overflowMenuTrigger.nextSibling),this.overflowMenuTrigger.nextSibling.id&&n.push(this.overflowMenuTrigger.nextSibling.id),e.call(this,n)}}(),displayContent:function(t){var n=e.clone(t.content.options);if(n.target=t.elements.container,t.content.created)t.content.component&&t.content.component.show();else{if("dropdown"===t.content.type)require(["DS/UIKIT/Dropdown"],function(e){t.content.component=new e(n).show()});else if("icondropdown"===t.content.type)require(["DS/UIKIT/IconDropdown"],function(e){t.content.component=new e(n).show()});else{if("dropdownmenu"!==t.content.type)return;t.content.component=new a(n).show()}t.content.created=!0}},select:function(){var e,t,n,i,o=arguments;void 0!==o[0]&&null!==o[0]&&(t=void 0===o[1]||o[1],!0!==this.options.multiSelect&&(t&&this.elements.container.querySelectorAll(".selected").forEach(function(e){e.removeClassName&&e.removeClassName("selected")}),t&&this.overflowMenu.getSelectedItems().forEach(function(e){this.overflowMenu.menus[0].toggleSelection(e),e.elements.container.removeClassName("selectable")},this)),(e=this.getItem(o[0])).selected=t,e&&!e.elements.container.hasClassName("divider")&&(e.elements.container[t?"addClassName":"removeClassName"]("selected"),n=e.elements.container.id,1===(i=this.overflowMenu.items.filter(function(e){return e.elements.container.hasClassName(n)})).length&&(this.overflowMenu.menus[0].toggleSelection(i[0]),i[0].elements.container.addClassName("selectable"),i[0].selected=t)))},enableItem:function(e){this.menu.enableItem(e)},disableItem:function(e){this.menu.disableItem(e)},show:function(){this.isInjected()&&(this._injectionObserver&&this._injectionObserver.disconnect(),this._injectionObserver=null,this._parent(),window.requestAnimationFrame?window.requestAnimationFrame(this.resize.bind(this)):this.resize())},destroy:function(){window.removeEventListener("resize",this.events.window.resize),this.overflowMenu&&this.overflowMenu.destroy(),this.overflowMenuTrigger&&this.overflowMenuTrigger.destroy(),this.elements.container.removeEvents(this.events.container),this.menu.items.forEach(function(e){e.tooltip&&e.tooltip.destroy()}),this._parent()}})}),define("DS/PADUtils/views/parametrization/ComboSelector",["i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/Menu/ContextualMenu","DS/Menu/Menu"],function(e,t,n,i,o,s){"use strict";return n.extend(i,{defaultOptions:{treedocument:null,withMore:!1,disabled:!1,title:null,multisel:!0},init:function(e){this._parent(e);if(this.elements.container=t.createElement("div",{class:"padComboSelector "+(e.className?e.className:"")}),this.elements.inner=t.createElement("div",{class:"padComboSelector-inner"}).inject(this.elements.container),this.elements.text=t.createElement("div",{class:"padComboSelector-text"}).inject(this.elements.inner),this.options.title&&t.createElement("p",{text:this.options.title,title:this.options.title}).inject(this.elements.text),this.elements.expander=t.createElement("span",{class:"padComboSelector-expander wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-down"}).inject(this.elements.inner),this.elements.container.addEventListener("click",this._launchCtxMenu.bind(this)),this.elements.container.addEventListener("contextmenu",this._launchCtxMenu.bind(this)),null===this.options.treedocument)throw new Error("Invalid attribute in constructor. Missing treedocument");this.options.treedocument.getXSO().onPostAdd(this._redrawInnerText.bind(this)),this.options.treedocument.getXSO().onPostRemove(this._redrawInnerText.bind(this)),this.disabled(this.options.disabled),this._redrawInnerText()},disabled:function(e){e?(this.elements.container.setAttribute("disabled",""),this.options.disabled=e):(this.elements.container.removeAttribute("disabled",""),this.options.disabled=e)},_launchCtxMenu:function(t){var n=[],i=this;if(!1===this.options.disabled){for(var o=this.options.treedocument.getRoots(),a=0;a<o.length;a++){var r=o[a].options.icons&&o[a].options.icons.length&&o[a].options.icons[0].iconName?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+o[a].options.icons[0].iconName}:void 0;n.push({title:o[a].getLabel(),type:"CheckItem",state:o[a].isSelected()?"selected":void 0,fonticon:r,action:{this:this,context:o[a],callback:this._typeSelectedInMenu.bind(this)}})}if(this.options.withMore&&(n.push({type:"SeparatorItem"}),n.push({title:e.more,type:"PushItem",action:{this:this,callback:function(e){i.dispatchEvent("onMore")}}})),n.length){var l=this.elements.container.getBoundingClientRect();s.show(n,{position:{x:l.left,y:l.bottom}})}}},_typeSelectedInMenu:function(e){var t=e.context;!0===this.options.multisel?t.isSelected()?(t.unselect(),this.dispatchEvent("onUnselect",t)):(t.select(),this.dispatchEvent("onSelect",t)):(t.select(!0),this.dispatchEvent("onSelect",t)),this.dispatchEvent("onSelectionChange"),this._redrawInnerText()},_redrawInnerText:function(){if(!(t.is(this.options.title,"string")&&this.options.title.length>0)){this.elements.text.empty();for(var e="",n=[],i=this.options.treedocument.getSelectedNodes(),o=0;o<i.length;o++)n.push(i[o].getLabel());if(e=n.length?n.join(", "):this.options.nlsEmptySelection,!1===this.options.multisel&&1===i.length&&i[0].options.icons){t.createElement("div",{class:"iconMenu wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-"+i[0].options.icons[0].iconName}).inject(this.elements.text);i[0].options.subLabel&&(this.elements.text.title=i[0].options.subLabel)}t.createElement("p",{text:e}).inject(this.elements.text)}}})}),define("DS/PADUtils/views/PADThumbnail",["css!DS/PADUtils/PADUtils","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Drivers/Alone","DS/Logger/Logger","DS/UIKIT/Modal"],function(e,t,n,i,o,s,a){"use strict";var r=n.extend(i,{name:"padthumbnail",_logger:null,_modal:null,options:{},init:function(e){this._logger=s.getLogger(r),this._logger.log("init"),this._parent(e),this.setOptions(e),e.renderTo||(e.renderTo=document.body);var t=UWA.createElement("div",{class:this.name+"_main",styles:{"background-image":e.cellModel.options?e.cellModel.options.value:"url('"+e.cellModel+"')"}}),n=this;this._modal=new a({className:this.name+"_modal",closable:!1,body:t,visible:!0}),setTimeout(function(){n._modal.elements.container.addEventListener("click",function(e){n._modal.destroy()}),n._modal.elements.content.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),!1}),document.onkeydown=function(e){27===(e=e||window.event).keyCode&&n._modal.destroy()}},500),this._modal.elements.wrapper.setStyle("width","350px"),this._modal.inject(e.renderTo)}});return r}),define("DS/PADUtils/PADCommandProxy",["DS/PADServices/utils/CommandProxy"],function(e){"use strict";return e}),define("DS/PADUtils/views/PADFilterCancel",["css!DS/UIKIT/UIKIT","css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/Utilities/Utils"],function(e,t,n,i,o,s,a,r,l){return o.extend(s,{name:"filterCancel",defaultOptions:{},init:function(e){this.cancelModal=new a({className:this.name+"_modal",closable:!0,okButtonText:n.addObject,koButtonText:n.cancel,animate:!0,renderTo:document.body});var t={};t.title=n.filterCancel,t.message=n.filterCancelMessage,t.callback=function(t){e.callback(t)},this.cancelModal.fromProxy=!1,this.cancelModal.confirm(t)}})}),define("DS/PADUtils/views/PADAlert",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/PADServices/utils/PADTrackerManager"],function(e,t,n){"use strict";return{_notif_manager:null,displayNotification:function(i){null===this._notif_manager&&(this._notif_manager=e,t.setNotificationManager(this._notif_manager),t.setStackingPolicy(5));var o="info";if(UWA.is(i.eventID)&&"primary"!==i.eventID&&(o=i.eventID),this._notif_manager.addNotif({level:o,title:void 0!==i.title?i.title:void 0,subtitle:void 0!==i.subtitle?i.subtitle:void 0,message:i.msg,sticky:!1,allowUnsafeHTML:!1}),"error"===o||"warning"===o){var s=n.getPADTracker({eventCategory:"usage",eventAction:"notification"});s&&(s.setEventData({eventLabel:i.key?i.key:"no-key",eventValue:"error"===o?1:2}),s.trackPageEvent())}},displayAdvancedNotification:function(i){null===this._notif_manager&&(this._notif_manager=e,t.setNotificationManager(this._notif_manager),t.setStackingPolicy(5));var o="info";if(UWA.is(i.eventID)&&"primary"!==i.eventID&&(o=i.eventID),this._notif_manager.addNotif({level:o,title:i.title,subtitle:i.subtitle,message:i.message,sticky:!1,allowUnsafeHTML:!1}),"error"===o||"warning"===o){var s=n.getPADTracker({eventCategory:"usage",eventAction:"notification"});s&&(s.setEventData({eventLabel:i.key?i.key:"no-key",eventValue:"error"===o?1:2}),s.trackPageEvent())}}}}),define("DS/PADUtils/views/PADInstanceMatrix",["css!DS/PADUtils/PADUtils","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Drivers/Alone","DS/UIKIT/Modal","DS/Handlebars/Handlebars"],function(e,t,n,i,o,s,a){"use strict";console.warn("PADInstanceMatrix is deprecated. Please don't use it.");var r=a.compile('<div class="positionMatrix">                            <table class="matrix rotation">                                <tr>                                  <td title="{{x1}}">{{x1}}</td>                                  <td title="{{x2}}">{{x2}}</td>                                  <td title="{{x3}}">{{x3}}</td>                                </tr>                                <tr>                                  <td title="{{y1}}">{{y1}}</td>                                  <td title="{{y2}}">{{y2}}</td>                                  <td title="{{y3}}">{{y3}}</td>                                </tr>                                <tr>                                  <td title="{{z1}}">{{z1}}</td>                                  <td title="{{z2}}">{{z2}}</td>                                  <td title="{{z3}}">{{z3}}</td>                                </tr>                            </table>                            <table class="matrix translation">                                <tr>                                  <td title="{{t1}}">{{t1}}</td>                                </tr>                                <tr>                                  <td title="{{t2}}">{{t2}}</td>                                </tr>                                <tr>                                  <td title="{{t3}}">{{t3}}</td>                                </tr>                          </table>                    </div>');return n.extend(i,{name:"padinstancematrix",_modal:null,options:{},init:function(e){var t;this._parent(e),this.setOptions(e),e.renderTo||(e.renderTo=document.body),t=e.cellModel&&e.cellModel.options?e.cellModel.options.value.split(","):e.cellModel.split(",");var n={x1:Number(t[0]).toFixed(16),x2:Number(t[1]).toFixed(16),x3:Number(t[2]).toFixed(16),y1:Number(t[3]).toFixed(16),y2:Number(t[4]).toFixed(16),y3:Number(t[5]).toFixed(16),z1:Number(t[6]).toFixed(16),z2:Number(t[7]).toFixed(16),z3:Number(t[8]).toFixed(16),t1:Number(t[9]).toFixed(16),t2:Number(t[10]).toFixed(16),t3:Number(t[11]).toFixed(16)},i=r(n),o=this;if(this._modal=new s({className:this.name+"_modal",closable:!1,body:i,visible:!0}),e.position&&e.position.top&&e.position.right&&e.position.left&&e.position.bottom){var a=document.body.getBoundingClientRect(),l=a.right-e.position.right,c=a.bottom-e.position.bottom;c>=100&&l>=350?(e.position.left=e.position.left+"px",e.position.top=e.position.top+30+"px",this._modal.elements.wrapper.setStyle("top",e.position.top),this._modal.elements.wrapper.setStyle("left",e.position.left)):c>=100&&l<=350?(e.position.right=l+380-a.right+"px",e.position.top=e.position.top+30+"px",this._modal.elements.wrapper.setStyle("top",e.position.top),this._modal.elements.wrapper.setStyle("right",e.position.right)):c<=100&&l<=350?(e.position.right=l+380-a.right+"px",e.position.bottom=c+160-a.bottom+"px",this._modal.elements.wrapper.setStyle("bottom",e.position.bottom),this._modal.elements.wrapper.setStyle("right",e.position.right)):(e.position.left=e.position.left+20+"px",e.position.bottom=c+160-a.bottom+"px",this._modal.elements.wrapper.setStyle("bottom",e.position.bottom),this._modal.elements.wrapper.setStyle("left",e.position.left))}setTimeout(function(){o._modal.elements.container.addEventListener("click",function(e){o._modal.destroy()}),o._modal.elements.content.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),!1}),document.onkeydown=function(e){27===(e=e||window.event).keyCode&&o._modal.destroy()}},500),this._modal.elements.wrapper.setStyle("width","356px"),this._modal.inject(e.renderTo)}})}),define("DS/PADUtils/PADPromise",["UWA/Promise"],function(e){"use strict";var t=[];return{getPromises:function(){for(var e=[],n=0;n<t.length;n++)t[n].isFulfilled&&t[n].isFulfilled()||e.push(t[n]);return t=e},createPromise:function(t,n,i){var o=new e(t),s=this._makeIntrospectablePromise(o,n);return void 0!==i&&!0!==i||this.getPromises().push(s),s},empty:function(){t=[]},_makeIntrospectablePromise:function(e,t){if(e.isResolved)return e;var n=!0,i=!1,o=!1,s=e.then(function(e){return o=!0,n=!1,e},function(e){return i=!0,n=!1,e});return s.isFulfilled=function(){return o},s.isPending=function(){return n},s.isRejected=function(){return i},s.name=t,s}}}),define("DS/PADUtils/views/parametrization/SearchSelector",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Event","DS/Controls/ButtonGroup","DS/Controls/Button"],function(e,t,n,i,o,s,a,r){"use strict";return i.extend(o,{init:function(e){this._parent(e);var n=this;this.elements.container=UWA.createElement("div",{class:"padSearchSelector "+(e.className?e.className:"")}),this.elements.inner=UWA.createElement("div",{class:"padSearchSelector-inner"}).inject(this.elements.container);var i=UWA.createElement("div",{class:"padSearchSelector-divInput"}).inject(this.elements.inner);this.elements.input=UWA.createElement("input",{class:"padSearchSelector-inputSearch",type:"text",placeholder:this.options.placeholder?this.options.placeholder:t.PADSearchView_search}).inject(i);var o=UWA.createElement("div",{class:"padSearchSelector-rightSearch"}).inject(this.elements.inner),s=UWA.createElement("div",{class:"padSearchSelector-btn padSearchSelector-clear"}).inject(o);this.elements.clearBtn=UWA.createElement("div",{class:"padSearchSelector-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clear",title:t.PADSearchView_clear}).inject(s),this.elements.clearBtn.hide();var l=UWA.createElement("div",{class:"padSearchSelector-btn padSearchSelector-search"}).inject(o);if(this.elements.searchBtn=UWA.createElement("div",{class:"padSearchSelector-btnIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",title:t.PADSearchView_search}).inject(l),this.elements.searchBtn.setStyle("opacity","0.1"),!0===this.options.withNavigation){var c=UWA.createElement("div",{class:"padSearchSelector-navigation"}).inject(this.elements.container),d=new a({touchMode:!0});d.inject(c),this.elements.upBtn=new r({icon:{iconName:"open-up",fontIconFamily:WUXManagedFontIcons.Font3DS},value:"previous",disabled:!0,preferredHeight:30,preferredWidth:24,touchMode:!0}),d.addChild(this.elements.upBtn),this.elements.downBtn=new r({icon:{iconName:"open-down",fontIconFamily:WUXManagedFontIcons.Font3DS},value:"next",disabled:!0,preferredHeight:30,preferredWidth:24,touchMode:!0}),d.addChild(this.elements.downBtn),d.addEventListener("buttonclick",function(e){"next"===e.dsModel.value?n.dispatchEvent("onNext",e.dsModel.value):n.dispatchEvent("onPrevious",e.dsModel.value)})}this.elements.searchBtn.addEventListener("click",this._onSearch.bind(this)),this.elements.clearBtn.addEventListener("click",this._onClearSearch.bind(this)),this.elements.input.addEventListener("keyup",this._onSearchInputKeyUp.bind(this)),this.elements.input.addEventListener("paste",this._onSearchInputPaste.bind(this)),this.elements.input.addEventListener("keydown",this._onSearchInputKeyDown.bind(this))},navigationState:function(e,t){this.elements.upBtn.disabled=e,this.elements.downBtn.disabled=t},_onSearch:function(e){this.elements.input.blur(),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onClearSearch:function(e){this.elements.input.value="",this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})},_onSearchInputKeyUp:function(e){this.elements.input.value?(this.elements.searchBtn.setStyle("opacity","1"),this.elements.clearBtn.setStyle("display","inline-block"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value})):(this.elements.clearBtn.hide(),this.elements.searchBtn.setStyle("opacity","0.1"),this.dispatchEvent("onSearch",{searchStr:this.elements.input.value}))},_onSearchInputPaste:function(e){var t=this;setTimeout(function(){t._onSearchInputKeyUp()}.bind(this),200)},_onSearchInputKeyDown:function(e){"return"!==s.whichKey(e)&&"Enter"!==e.keyIdentifier&&"return"!==e.keyIdentifier||this._onSearch(),s.stopPropagation(e)}})}),define("DS/PADUtils/PADContext",["UWA/Class","UWA/Class/Options"],function(e,t){"use strict";return e.singleton(t,{name:"PADContext",init:function(){this._context=null},set:function(e){null===this._context&&(this._context=e)},get:function(e){return null===this._context?void 0===e?null:e:this._context},reset:function(){this._context=null}})}),define("DS/PADUtils/views/PADDropConfirm",["css!DS/UIKIT/UIKIT","css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/Utilities/Utils"],function(e,t,n,i,o,s,a,r,l){return o.extend(s,{name:"dropConfirm",defaultOptions:{},init:function(e){var t={MOVE:n.MOVE_label,COPY:n.COPY_label,Reorder:n.Reorder_label},i={top:n.before_label,bottom:n.after_label},o=t[e.copyMode];e.isOutsideWidget?o=t.COPY:(e.isReordering&&(o=t.Reorder),"COPY"===e.copyMode&&(o=t.COPY));var s=i[e.dropPosition]||"before",r=new a({className:this.name+"_modal",closable:!0,okButtonText:o,koButtonText:n.cancel,animate:!0,renderTo:document.body}),l={};l.title=o,e.isReordering?l.message=n.replace(n.get("confirmation_message_reorder"),{dndMode:o.toLowerCase(),source:e.dropName,position:s,target:e.targetName}):l.message=n.replace(n.get("confirmation_message"),{dndMode:o.toLowerCase(),source:e.dropName,target:e.targetName}),l.callback=function(t){e.callback(t)},r.confirm(l)}})}),define("DS/PADUtils/PADModelEvents",["DS/CoreEvents/ModelEvents"],function(e){console.warn("Deprecated module DS/PADUtils/PADModelEvents use DS/PADServices/utils/GlobalModelEvents");var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,n){return t.subscribe(e,n)},unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}}),define("DS/PADUtils/views/PADLevelSel",["css!DS/PADUtils/PADUtils","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/SpinBox"],function(e,t,n,i,o,s,a,r,l){"use strict";return i.extend({name:"pad_level_sel",defaultOptions:{current_level:1},init:function(e){this._parent(e);var t=this,n=UWA.createElement("div",{class:this.getClassNames()}),i=new l({value:t.options.current_level,minValue:1,stepValue:1,pageStepValue:1}).inject(n);i.getContent().addClassName(this.getClassNames("_spinbox")),this.elements.level_selector=i,i.getContent().addEvent("change",this._updateDownState.bind(this));var s=new a({icon:"check",emphasize:"success"}).inject(n);s.getContent().addClassName(this.getClassNames("_okbtn")),s.getContent().setStyle("width","22px"),i.addEventListener("change",function(e){t.options.current_level=parseInt(e.dsModel.value)}),i.elements.inputField&&i.elements.inputField.addEventListener("keyup",function(e){if(13===e.keyCode){var n=t.options.current_level.toString();t.dispatchEvent("onApply",[n]),d.destroy()}}),s.addEventListener("click",function(){var e=t.options.current_level.toString();t.dispatchEvent("onApply",[e]),d.destroy()});var r,c=UWA.is(e.css_style)?" "+e.css_style:"",d=new o({className:this.getClassNames("_modal")+c,closable:!1,body:n,visible:!0});d.elements.wrapper.setStyle("padding-top","calc("+(r="500px",document.body.scrollHeight>40&&(r=document.body.scrollHeight+"px"),r)+" - 80px)"),d.elements.scrollableContent&&d.elements.scrollableContent.setStyle("width","155px"),d.elements.container.addEventListener("click",function(e){d.destroy()}),d.elements.content.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),!1}),d.inject(document.body),this._updateDownState()},_updateDownState:function(){var e=this.elements.level_selector.value,t=this.elements.level_selector.minValue,n=this.elements.level_selector.elements.down;e<=t?n.addClassName("pad_level_sel_down_arrow_disabled"):n.removeClassName("pad_level_sel_down_arrow_disabled")}})}),define("DS/PADUtils/PADTransactionManager",["UWA/Class","UWA/Class/Events"],function(e,t){"use strict";var n=function(e,t,n){this.getId=function(){return t},this.isNested=function(){return n};var i=this;this.end=function(){e(i)}};return e.extend(t,{_transactionStack:[],startTransaction:function(e){var t=Boolean(this._transactionStack.length>0),i=this;var o=new n(function(e){var t=i._transactionStack.indexOf(e),n=e.getId();if(t<0)throw new Error('This "'+n+'" transaction is not part of the transaction stack, may be it has already been ended');if(t!==i._transactionStack.length-1)throw new Error('Cannot end this "'+n+'" transaction as it is not the innermost transaction');i._transactionStack.pop();var o=e.isNested();i.dispatchEvent("onTransactionEnd",[n,o])},e,t);return this._transactionStack.push(o),t=o.isNested(),this.dispatchEvent("onTransactionStart",[e,t]),o},wrapInTransaction:function(e,t){var n=this.startTransaction(t);try{UWA.is(e,"function")&&e()}finally{n.end()}}})}),define("DS/PADUtils/commands/PADAddRoot_cmd",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({execute:function(e){require(["DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADTypesMgt","DS/PADUtils/views/PADAlert"],function(e,t,n,i,o){for(var s="",a=t.getSetting("authorized_root_types")?t.getSetting("authorized_root_types"):t.getSetting("authorized_types"),r=a.length,l=0;l<r;l++){var c=a[l];s=""===s?s+'type:"'+c+'"':s+' OR type:"'+c+'"'}var d={fts_value:s,callback:function(t){var n=e.get(),i=t.selected_data;n.openDroppedObjects({notifPerObjects:!0,displayNotif:!1,unserializedData:i,broadcast:!0,version:"2.0"})},cancel:function(){}};n.inAppsSearch(d)})}})}),define("DS/PADUtils/commands/PADOpenInCADFromSearch",["text!DS/PADUtils/assets/PADOpenCommandsSettings.json","UWA/Core","UWA/Controls/Abstract","DS/PlatformAPI/PlatformAPI"],function(e,t,n,i){"use strict";return n.extend({name:"PADOpenInCADFromSearch",_compass_socket:null,_role_check_promise:null,_context:null,init:function(e){e&&e.addinmode&&(this._context=e.addinmode)},availableForTypes:function(){var t=[],n=JSON.parse(e);return this._context&&n["openInCAD_"+this._context+"_supported_types"]&&(t=n["openInCAD_"+this._context+"_supported_types"]),t},getActionForObject:function(n,i){if(this._context){var o=this,s=JSON.parse(e);require(["i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e){var a=[],r=null;if(n.taxonomies){var l=null;if(t.is(n.taxonomies,"string"))l=n.taxonomies;else if(t.is(n.taxonomies,"array"))for(var c=0;c<n.taxonomies.length;c++)if(t.is(n.taxonomies[c],"string")&&0===n.taxonomies[c].indexOf("types/")){l=n.taxonomies[c];break}t.is(l)&&(r=l.split("/"))}else r=[n["ds6w:type_value"]];if(t.is(r,"array"))for(var d=!1,u=r.length-1;u>=0;u--){var p=r[u];if(s["openInCAD_"+o._context+"_supported_types"].indexOf(p)>-1&&!d){a.push({icon:"fonticon fonticon-open",id:o.name,multisel:!1,title:e.PAD_CMDOpenInCAD,callback:o.launchCustoAction.bind(o)}),d=!0;break}}i.call(null,a)})}else i.call(null,[])},launchCustoAction:function(e){i.publish("webinwin:web:notification",JSON.stringify({operation:"open/setObject",operationVersion:"1.0",content:[{phid:e.object_ids[e.object_ids.length-1]}]}))}})}),define("DS/PADUtils/PADWebInWinServices",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.singleton({_widget:null,_addinmode:null,initialize:function(e){this._widget=e.widget,this._addinmode=this._widget?this._widget.getValue("addinmode"):"undefined"!=typeof widget?widget.getValue("addinmode"):""},isWebInWinContext:function(){return"solidworks"===this._addinmode||"catiav5"===this._addinmode}})}),define("DS/PADUtils/PADSecurityCtxConverter",["UWA/Class","UWA/Promise","DS/PADUtils/views/PADAlert"],function(e,t,n){"use strict";return e.singleton({init:function(e){this._parent(e)},buildSecurityContext:function(e,t,n){return"ctx::"+n+"."+t+"."+e},buildDisplayString:function(e,t,n,i){return i?e+" ● "+n:e+" ● "+t+" ● "+n},extractCouple:function(e){var t="",n="",i="",o="";for(var s in e){var a=e[s];switch(s){case"organization":t=a.name,n=a.title?a.title:t;break;case"role":i=a.name,o=a.nls?a.nls:i}}return{org:t,orgTitle:n,role:i,roleNls:o}},prepareForStorage:function(e){var t,n,i,o="ctx:",s=e.pid,a=[];for(var r in e.preferredcredentials){var l=e.preferredcredentials[r];switch(r){case"collabspace":t=l.name,l.title?l.title:t;break;case"organization":n=l.name;break;case"role":i=l.name}}o=this.buildSecurityContext(t,n,i);for(var c=!1,d=function(e,t){for(var n=[],i=0;i<e.collabspaces.length;i++)for(var o=e.collabspaces[i],s=0;s<o.couples.length;s++){var a=t.extractCouple(o.couples[s]);-1===n.indexOf(a.org)&&n.push(a.org)}return 1===n.length}(e,this),u=0;u<e.collabspaces.length;u++)for(var p=e.collabspaces[u],h=0;h<p.couples.length;h++){var g=this.extractCouple(p.couples[h]),f=this.buildSecurityContext(p.name,g.org,g.role),m=p.title?p.title:p.name,_={csName:m,label:this.buildDisplayString(m,g.orgTitle,g.roleNls,d),value:f};o===f&&(_.isDefault=!0,c=!0),a.push(_)}if(!c&&a.length){var v=a[0];v.isDefault=!0,o=v.value}return a.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),{userId:s,securityContext:o,cspaces:a}},getSecurityContext:function(e){var i=e.callback,o=e.tenant,s=this;"undefined"!=typeof widget&&widget.lang;require(["DS/PADUtils/PADWSAccess"],function(e){new t(function(t,i){e.getscandcollab({tenant:o,onComplete:function(e){var n=UWA.is(e,"string")?JSON.parse(e):e,i=s.prepareForStorage(n);t({securityContext:i.securityContext,securityContextList:i.cspaces})},onFailure:function(e,t){var o,s;if(UWA.is(t,"string")&&t.length>0){try{o=JSON.parse(t)}catch(e){s=t}o&&o.error&&o.error.message?n.displayNotification({msg:o.error.message,eventID:"error",key:"padUtils-getSecurityContext-server-error"}):n.displayNotification({msg:s,eventID:"error",key:"padUtils-getSecurityContext-server-error"})}i(e,t)}})}).then(function(e){i(e)}).catch(function(e){i(null)})})},setSecurityContext:function(e){e&&require(["DS/PADUtils/PADUtilsServices"],function(t){var n=t.getPlatformId(),i=JSON.parse(sessionStorage.getItem("PADSecurityCtx_"+n)),o=e.replace("ctx::","");i!==o&&sessionStorage.setItem("PADSecurityCtx_"+n,JSON.stringify(o))})}})}),define("DS/PADUtils/PADSettingsMgt",["text!DS/PADUtils/assets/PADSettingsMgt.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Events","DS/PADUtils/views/PADAlert","DS/PADUtils/PADContext","DS/PADUtils/views/PADTenantMgt","DS/PADUtils/Configuration","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/WidgetProxy"],function(e,t,n,i,o,s,a,r,l,c,d,u){"use strict";function p(e,t,n){e.splice(n,0,e.splice(t,1)[0])}function h(e,t){for(var n=0;n<e.length;n++){if(e[n].name===t)return n}return null}const g=1,f=0;var m=function(e){return"true"===e.toLowerCase()},_={widgetDomain:null},v=i.singleton(o,s,{app_context:null,version:"1.0",defaultOptions:{run_options:{},debug_options:{},session_options:{},webapi_options:{},layout_options:{}},with_security_context:!1,init:function(e){this._parent(e),this.setOptions(this.defaultOptions)},destroy:function(){this.app_context=null,this.version="1.0",this.options.run_options={},this.options.debug_options={},this.options.session_options={},this.options.webapi_options={},this.options.layout_options={}},setApp:function(e,t,n){var i=n||!1;this.set_app_context(t,i);var o=e;UWA.is(o.common)&&(this.options.debug_options=UWA.is(o.common.debug_options)?o.common.debug_options:this.options.debug_options,this.options.run_options=UWA.is(o.common.run_options)?o.common.run_options:this.options.run_options,this.options.webapi_options=UWA.is(o.common.webapi_options)?o.common.webapi_options:this.options.webapi_options,this.options.layout_options=UWA.is(o.common.layout_options)?o.common.layout_options:this.options.layout_options),UWA.is(t,"string")&&UWA.is(o[t],"object")&&(this.options=UWA.extend(this.options,o[t],!0));var s=this;require(["DS/PADServices/settings/AppSettings"],function(e){e.initializeSettings({padsettingsInit:UWA.clone(s.options)})})},set_app_context:function(t,n){var i=JSON.parse(e),o=!UWA.is(n,"boolean")||!n;if(!UWA.is(t,"string"))throw new Error("Invalid app context");this.app_context=t,this.version=i.version,this.options=UWA.extend(this.options,i.common,!0),UWA.is(i[t],"object")&&(this.options=UWA.extend(this.options,i[t],!0)),this.with_security_context=o||!1,!0===this.with_security_context&&(this.options=UWA.extend(i.security_ctx,this.options,!0))},build_preferences:function(e){var t=Object.getOwnPropertyNames(e),n=0,i=[];for(n=0;n<t.length;n++){var o=t[n],s=e[o];if(UWA.is(s.preference,"object")&&!0!==s.notAddedByDefault){var a=!0;if(UWA.is(s.activatedBySetting,"string"))!1===v.getSetting(s.activatedBySetting,!0)&&(a=!1);else if(UWA.is(s.activatedBySetting,"object")){v.getSetting(s.activatedBySetting.name,!0)!==s.activatedBySetting.value&&(a=!1)}else UWA.is(s.activatedByWidgetPreference,"object")&&"undefined"!=typeof widget&&widget.getValue(s.activatedByWidgetPreference.name)&&widget.getValue(s.activatedByWidgetPreference.name)!==s.activatedByWidgetPreference.value&&(a=!1,v.setSetting(o,!1));if(!0===a){var r=UWA.merge({name:o,defaultValue:s.value},s.preference);i.push(r)}}}return i},orderWidgetPreferences:function(){widget&&function(e){for(var t,n,i,o,s,a=e.getPreferences(),r=[],l=!1,c=a.length,d=0;d<c;d++){var u=a[d];"pad_security_ctx"===u.name&&d!==g&&r.push({prop:"pad_security_ctx",from:d,to:g}),"x3dPlatformId"===u.name&&c>1&&(l=!0,d!==f&&r.push({prop:"x3dPlatformId",from:d,to:f}))}if(!l&&r.length){let e={prop:"pad_security_ctx",from:r[0].from,to:f};r.pop(),r.push(e)}if(r.sort(function(e,t){return e.from>t.from?-1:e.from<t.from?1:e.from===t.from?0:void 0}),r.length){for(var m=r.length,_=0;_<m;_++){var v=r[_];0!==_&&(v.from=h(a,v.prop)),m-1===_?(t=a,n=v.from,i=v.to,o=void 0,s=void 0,o=t.splice(n,1)[0],s=t.splice(i,1)[0],t.splice(n,0,s),t.splice(i,0,o)):p(a,v.from,v.to)}e.setPreferences(a)}}(widget)},getWidgetPreferences:function(){var e=[];if(null===this.app_context)throw new Error("Set the app context before using the PADSettingsMgt");if(widget&&(e=e.concat(v.build_preferences(this.options.run_options)),"1"===widget.getValue("debug_me"))){var t=v.build_preferences(this.options.debug_options);e=e.concat(t)}return e},getSpecificWidgetPreference:function(e){if(!UWA.is(e,"string")||0===e.length)throw new Error("getSpecificWidgetPreference: Invalid input parameter");var t=null;if(this.options.run_options.hasOwnProperty(e))t=this.options.run_options[e];else{if(!this.options.debug_options.hasOwnProperty(e))throw console.error("getSpecificWidgetPreference: Unknown setting ["+e+"]"),new Error("getSpecificWidgetPreference: Unknown setting ["+e+"]");t=this.options.debug_options[e]}if(!UWA.is(t.preference,"object"))throw new Error("getSpecificWidgetPreference: setting ["+e+"] has no prefence defined");return[UWA.merge({name:e,defaultValue:t.value},t.preference)]},getSecurityPreferences:function(){if(this.options.run_options.x3dPlatformId&&this.options.run_options.pad_security_ctx)return v.build_preferences({x3dPlatformId:this.options.run_options.x3dPlatformId,pad_security_ctx:this.options.run_options.pad_security_ctx});throw new Error("Invalid call - Security Context hasn't been declared")},updateSecuritySettings:function(e,t,n,i,o){o=void 0===o||o;for(var s,a=-1===n.indexOf("ctx::")?"ctx::"+n:n,r=!1,l=0;l<i.length;l++){var c=i[l];0===l&&(s=c.value),c.value===a&&(r=!0)}r||(a=s),o&&u.addPreference({name:"pad_security_ctx",type:"list",label:"pad_security_ctx",defaultValue:a,options:i}),!0===this._dynamicUpdate?u.dispatchEvent("onEdit"):(v.updateTenantSettings(e,t,o),u.setValue("pad_security_ctx",a),u.setValue("xPref_CREDENTIAL",a.replace("ctx::","")),this.setSetting("pad_security_ctx",a,!0))},updateTenantSettings:function(e,t,n){if(void 0!==window.widget){var i,o,s={name:"x3dPlatformId",type:"list",label:"pad_tenant",defaultValue:e,options:t,onchange:"onPlatformIdChange"};if(1===t.length&&(s.disabled=!0),e&&"OnPremise"!==e)i=!0;else{var a=widget.getValue("x3dPlatformId");a&&"OnPremise"!==a&&(i=!0)}widget.getValue("noCompass")&&(o=!0),o||(i&&n&&widget.addPreference(s),this.orderWidgetPreferences()),widget.setValue("x3dPlatformId",e),this.setSetting("x3dPlatformId",e),widget.setValue("pad_tenant",e),this.setSetting("pad_tenant",e)}else this.setSetting("x3dPlatformId",e),this.setSetting("pad_tenant",e)},updateTenantPreference:function(e){if(null===this.app_context)throw new Error("Set the app context before using the PADSettingsMgt");var n=this,i=r.get();if(i&&UWA.is(i.empty,"function")){var o=!1;UWA.is(i.getPADTreeDocument,"function")?o=0!==i.getPADTreeDocument().getRoots().length:UWA.is(i.getRoots,"function")?o=0!==i.getRoots().length:console.warn("Unknown context");var s=n.getSetting("x3dPlatformId");if(o){var c=n.getSetting("pad_security_ctx");if(s!==e.value)new l({id:"PadTenantMgt",currentTenant:{isMultiTenant:!1,isClearView:!1},callback:function(o){let r=!1;if(o.isClearView)r=!0,i.empty(),n.setSetting(e.name,e.value),a.displayNotification({msg:t.PlatformChange,eventID:"success"});else{var l={tenant:s,padsecurityctx:c};require("DS/PADUtils/PADUtilsServices").updateWidgetSecPref(l),n.setSetting(e.name,n.getSetting("x3dPlatformId"))}d.publish({event:"ENXApp/tenantDialog/complete",data:{skipRefresh:r}})}})}else n.setSetting(e.name,e.value),s!==e.value&&a.displayNotification({msg:t.PlatformChange,eventID:"success"})}else n.setSetting(e.name,e.value)},updateTenantSecPreference:function(e,t){this._dynamicUpdate=t;var n={tenant:e,withPreference:!0,dynamicUpdate:t};require("DS/PADUtils/PADUtilsServices").updateWidgetSecPref(n)},updateWidgetPreferences:function(e){if(this._dynamicUpdate=null,!e||!1!==e.submitted){if(null===this.app_context)throw new Error("Set the app context before using the PADSettingsMgt");var t=this;widget&&widget.getPreferences().forEach(function(e){"x3dPlatformId"===e.name?v.updateTenantPreference(e):t.setSetting(e.name,e.value)})}},getSetting:function(e,t){var n;return this.options.run_options.hasOwnProperty(e)?n=this.options.run_options[e].value:this.options.debug_options.hasOwnProperty(e)?(!0===t&&this.options.debug_options[e].activatedByWidgetPreference&&"undefined"!=typeof widget&&widget.getValue(this.options.debug_options[e].activatedByWidgetPreference.name)&&widget.getValue(this.options.debug_options[e].activatedByWidgetPreference.name)!==this.options.debug_options[e].activatedByWidgetPreference.value&&(this.options.debug_options[e].value=!1),n=this.options.debug_options[e].value):n=!!this.options.session_options.hasOwnProperty(e)&&this.options.session_options[e].value,n},setSetting:function(e,t,n){var i;if(this.options.run_options.hasOwnProperty(e)?i=this.options.run_options[e]:this.options.debug_options.hasOwnProperty(e)?i=this.options.debug_options[e]:this.options.session_options[e]={value:t},i){var o=t;i.preference&&"boolean"===i.preference.type&&UWA.is(t,"string")?o=m(t):t&&UWA.is(t.toLowerCase,"function")&&("true"===t.toLowerCase()||"false"===t.toLowerCase())&&(o=m(t)),i.value!==o&&(i.value=o,!0===i.dispatch&&this.dispatchEvent(function(e){return"on"+e.charAt(0).toUpperCase()+e.slice(1)}(e),o)),n&&"undefined"!=typeof widget&&widget.setValue(e,o)}},dispatchEvent:function(e,t){this._parent(e,t),d.publish({event:"ENXApp/SettingsModification/"+e,data:t})},getWebAPI_Options:function(e){var t={};return this.options.webapi_options.hasOwnProperty(e)&&(t=this.options.webapi_options[e]),t},setWebAPI_Options:function(e,t){this.options.webapi_options.hasOwnProperty(e)&&(this.options.webapi_options[e]=t)},getLayout_options:function(e){var t={};return this.options.layout_options.hasOwnProperty(e)&&(t=this.options.layout_options[e]),t},getURLParameter:function(e){return null===_.widgetDomain&&(_.widgetDomain=decodeURIComponent((new RegExp("[?|&]widgetDomain=([^&;]+?)(&|#|;|$)").exec(location.search)||[null,""])[1].replace(/\+/g,"%20"))||null),_.widgetDomain&&decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(_.widgetDomain)||[null,""])[1].replace(/\+/g,"%20"))||null},hasSetting:function(e,t){return!!this.options.run_options.hasOwnProperty(e)||!(!t||!this.options.debug_options.hasOwnProperty(e))}});return v.addEvent("onPad_security_ctx",function(e){require("DS/PADServices/utils/GlobalUtils").setSecurityContext(e),"undefined"!=typeof widget&&widget.setValue("xPref_CREDENTIAL",widget.getValue("pad_security_ctx").replace("ctx::",""))}),v}),define("DS/PADUtils/Utility",["DS/PADUtils/PADSettingsMgt"],function(e){"use strict";var t=/(\d+)\/(\d+)\/(\d+)@\d+:\d+:\d+:\w+/;function n(e,t,n,i){var o=-1;return function(){if(++o<=e.length-1){var s=e[o];n(s,t)}else i()}}function i(e,t){for(var n=[],i=e.length,o=0;o<i;o+=t)n.push(e.slice(o,o+t));return n}return{compareValue:function(e,t){return e||(e=""),t||(t=""),require("DS/WidgetServices/WidgetServices").compareValue(t,e)},convertDateTime:function(n){var i="";if("NULL"===n)i="";else{t.test(n)&&(n=require("DS/WidgetServices/WidgetServices").formatDateObj(n).toUTCString());var o=Date.parse(n);isNaN(o)||(i=new Date(o).toLocaleString(e.getSetting("lang")))}return i},batchBreakup:i,createStepper:n,createBatchStepper:function(e,t,o,s,a){let r,l;return r=e.length>=t?i(e,o):[e],l=n(r,null,function(e){new Promise(function(t,n){s(e,t)}).then(l)},function(){a()})},elementIsOrIsWithin:function(e,t){return e===t||t.contains(e)||e.contains(t)},getBIColor:function(e,t,n){var i="rgba(255, 255, 255, 0.3)";if("date"===e){var o=n.substring(0,n.indexOf("T")).split("-"),s=[];s.push([o[0],o[1],o[2]].join("/")),s.push([o[0],o[1]].join("/")),s.push(o[0]);for(var a=!0,r=0,l=s.length;r<l&&a;r++)void 0!==t.map[s[r]]&&(a=!1,i=t.map[s[r]])}else if("boolean"===e&&"boolean"==typeof n){var c=n?"TRUE":"FALSE";i=t.map[c]}else void 0!==t.map[n]&&(i=t.map[n]);return i}}}),define("DS/PADUtils/PADSession",["UWA/Class","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/views/PADAlert","DS/Core/ModelEvents","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s){"use strict";return e.singleton({_modelEvents:null,_notSilent:!0,_onlyIndex:!1,init:function(){var e=this;function i(t){if("enxscene"!==require("DS/PADUtils/PADSettingsMgt").app_context){if(UWA.is(t.authored,"boolean")){var n=t.authored_reason;!n&&t.authored&&(n=s.PADSession_disabling_index_authoring),e.setAuthoringState(t.authored,n,!1)}if(UWA.is(t.useIndexPreference,"boolean")){var i=t.useIndexPreference_reason;e.setUseIndexPreference(t.useIndexPreference,i,!1)}}}this._modelEvents=new o,n.addEvent("onUseIndexAccleration",function(e){this.setUseIndexPreference(e)}.bind(this)),this._commandProxy=t.create({events:{onAuthored:i,onSessionStateChange:i}}),this._authored=!1,this._useIndexPreference=!0,this._callCounter=0},setUseIndexPreference:function(e,t,n){var i={useIndexPreference:e,useIndexPreference_reason:t};e!==this._useIndexPreference?(this._useIndexPreference=e,!1!==n&&this._commandProxy.sessionStateChange(i),this.publish({event:"useIndexPreferenceModified",data:{useIndexPreference:e}})):!0===n&&this._commandProxy.sessionStateChange(i)},setAuthoringState:function(e,t,n,o){var a=!1;if(UWA.is(e,"boolean")&&e!==this._authored){if(t&&this._notSilent&&!0===this._useIndexPreference){var r=s[t]||t;i.displayNotification({msg:r,eventID:"primary"})}this._authored=e,a=!0,this.publish({event:"authoringStateModified",data:{authored:this._authored}})}(a&&void 0===n||!0===n)&&this._commandProxy.authored({authored:this._authored,authored_reason:t,instanceId:o})},isAuthoring:function(){return this._authored&&!this._onlyIndex},isUsingIndex:function(){return console.warn("The method PADSession.determineAuthoredFlag is clearer than isUsingIndex"),Boolean(this._useIndexPreference&&!(this._authored&&!this._onlyIndex))},determineAuthoredFlag:function(){return!this._useIndexPreference||this._authored&&!this._onlyIndex},softInit:function(e,t){!0===e&&(this._notSilent=!e),!0===t&&(this._onlyIndex=t)},getModelEvents:function(){return this._modelEvents},publish:function(e){this.getModelEvents().publish(e)},subscribe:function(e,t){return this.getModelEvents().subscribe(e,t)},unsubscribe:function(e){this.getModelEvents().unsubscribe(e)},onAuthoringMode:function(e){return this.getModelEvents().subscribe({event:"authoringStateModified"},e)}})}),define("DS/PADUtils/commands/SwitchAuthoringIndex",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/Core/ModelEvents","DS/PADUtils/PADSession","DS/PADUtils/PADSettingsMgt","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a){"use strict";return t.extend({_context:null,_triggerFromCmd:!1,init:function(e){this._parent(e,{}),this._context=n.get(),this._sessionCBTokens=[],o.isAuthoring()?!1===this.getState()&&this.setState(!0,!1):!0===this.getState()&&this.setState(!1,!1),!1===s.getSetting("useIndexAccleration")&&"undefined"!=typeof widget&&void 0!==widget.getPreference("useIndexAccleration")?this.disable():this.enable();var t=this;this._sessionCBTokens.push(o.subscribe({event:"authoringStateModified"},function(e){!0===t._triggerFromCmd?t._triggerFromCmd=!1:o.isAuthoring()?!1===t.getState()&&t.setState(!0,!1):!0===t.getState()&&t.setState(!1,!1)})),this._sessionCBTokens.push(o.subscribe({event:"useIndexPreferenceModified"},function(e){!0===e.useIndexPreference?t.enable():t.disable()})),this.onStateChange(function(){t._triggerFromCmd=!1;var e,n=t.getState();e=n?a.PADSession_enabling_authoring_mode:a.PADSession_disabling_authoring_mode,o.setAuthoringState(n,e)})}})}),define("DS/PADUtils/PADDataTransform",["UWA/Promise","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSession"],function(e,t,n){"use strict";var i={version:"2.1",results:[],structures:[],viewpoint:[]};function o(e,t){if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;return!0}return!1}return!1}function s(e,t){for(var n=!0,i=0;i<e.length;i++){e[i].id===t.id&&(n=!1)}n&&e.push(t)}function a(e){if(e.length>1)return!0;for(var t=0;t<e.length;t++){if(e[t].length>1)return!0}return!1}function r(e,n,i,o,s){var r=UWA.extend({root_path_physicalid:e.slice(0),expand_iter:"-1",intent:"explore_2D"},t.getWebAPI_Options("navigate"),!0);!0!==t.getSetting("globalTypeFiltering")&&(r["q.iterative_filter_query_bo"]&&delete r["q.iterative_filter_query_bo"],!0===t.getSetting("dynamic_authorized_types")?r.no_type_filter_bo=t.getSetting("no_type_filter_bo"):r.type_filter_bo=t.getSetting("type_filter_bo"));var l,c=!1;if(n&&!0===n.isNGFilter&&(n.sequence_filter&&(r.sequence_filter=n.sequence_filter),n.config_filter&&(r.config_filter=n.config_filter),n.CVQuery)){c=!0,delete(l=UWA.clone(n.CVQuery)).max_count_path;var d=t.getWebAPI_Options("navigate");if(l.select_bo=d.select_bo,l.select_rel=d.select_rel,l.compute_select_bo=d.compute_select_bo,l.union)if(l.union.expand)a((u=l.union.expand[0]).root_path_physicalid)||!u.sequence_filter&&!u.config_filter||(l.union.expand[0].root_path_physicalid=r.root_path_physicalid);else if(l.union.expand3d){var u;a((u=l.union.expand3d[0]).root_path_physicalid)||!u.sequence_filter&&!u.config_filter||(l.union.expand3d[0].root_path_physicalid=r.root_path_physicalid)}}require(["DS/PADUtils/PADWSAccess"],function(n){!0===c?n.multiexpand({enopad_webapis:!1,data:l,onComplete:function(t){try{var n="string"==typeof t?JSON.parse(t):t;i(n,s)}catch(t){o(t,e,s)}},onFailure:function(t){o(t,e,s)}}):n.navigate({enopad_webapis:t.getSetting("enopad_webapis"),data:r,onComplete:function(t){try{var n="string"==typeof t?JSON.parse(t):t;i(n,s)}catch(t){o(t,e,s)}},onFailure:function(t){o(t,e,s)}})})}function l(e){var t={};return e.forEach(function(e){"resourceid"===e.name||"physicalid"===e.name?t.resourceid=e.value:"did"===e.name?t.did=e.value:"ds6w:globalType"===e.name?t.globalType=e.value:"ds6w:cadMaster"===e.name&&(t.cadMaster=e.value)}),t}function c(e,t){for(var n={},i=!0,o=0;o<e.length&&i;o++)e[o].structure[0].id===""+t&&(i=!1,n={toCreate:!1,rootStructure:e[o].structure});return!0===i&&(e.push({structure:[]}),n={toCreate:!0,rootStructure:e[e.length-1].structure}),n}function d(e,t){for(var n=void 0,i=!0,o=0;o<e.length&&void 0===n&&i;o++)if(e[o].id===""+t[0])if(t.length>1){var s=t.slice(1);n=d(e[o].children,s)}else i=!1,n=null;return void 0===n&&i&&(n=e),n}return{buildDataForSetTypes:function(a,u,p,h){h=void 0===h||h;var g=UWA.clone(i),f={},m=[],_={},v={},S=!1,y=(n.determineAuthoredFlag(),t.getSetting("ofwCadMaster"));function b(e){-1===m.indexOf(e.getID())&&m.push(e.getID());var t=e.getRelationID();t&&0!==t.length&&-1===m.indexOf(t)&&m.push(t),e.isRoot()&&(e.options.sequence_filter&&(_[e.getID()].filter.sequence_filter=e.options.sequence_filter,_[e.getID()].filter.isNGFilter=!0,S=!0),e.options.config_filter&&(_[e.getID()].filter.config_filter=e.options.config_filter,_[e.getID()].filter.isNGFilter=!0,S=!0)),e.options.CVQuery&&(_[e.getID()].filter.CVQuery=e.options.CVQuery,_[e.getID()].filter.isNGFilter=!0,S=!0),y&&(v[e.getID()]=e.options.padgrid["ds6w:cadMaster"])}for(y&&(g.version="2.2"),T=0;T<a.length;T++){var D=a[T].getRoot();void 0===_[D.getID()]&&(_[D.getID()]={paths:[],filter:{isNGFilter:!1}}),!0!==a[T].isRelationsObjectNode?_[D.getID()].paths.push(a[T].getOccurencePath(b)):(_[D.getID()].paths.push([a[T].getID()]),b(a[T]))}function A(e){for(var t=[],n=0;n<e.length;n++)t.push(f[e[n]]);return t}function P(e){for(var t=null,n=0;n<e.length;n++){var i=e[n],s=e.slice(0,n+1),a=null;if(1===s.length){var r=c(g.structures,i);t=r.rootStructure,!0===r.toCreate&&(a=t)}else a=d(t,s);if(a){var l=A(s),p=!0,h=void 0;if(1===Math.abs(l.length%2)){var f=u.getNodeByOccurencePath(l);if(f)o(f.getOccurencePath(),l)&&(f&&!f.options.isPADHidden!==p&&(p=!f.options.isPADHidden),f&&f.isSelected()&&(h=!0))}a.push({id:""+i,show:p,select:h,children:[]})}}}function x(e,t,n){console.warn("Completion of Open scope failed. Open the data of the view"),e&&console.warn(e);for(var i=0;i<m.length;i++){var o={id:m[i],phid:m[i]};y&&(o.CADOrigin=v[m[i]]),s(g.results,o),f[m[i]]=m[i]}for(var a=0;a<t.length;a++)P(t[a]);n()}function w(e,t){if(e.results){for(var n=0;n<e.results.length;n++){var i=e.results[n];if(i.hasOwnProperty("attributes")){var o=l(i.attributes),s={id:""+o.did,phid:o.resourceid};y&&(s.CADOrigin=o.cadMaster),g.results.push(s),f[""+o.did]=o.resourceid}else i.hasOwnProperty("path")&&P(i.path)}t()}else x(null,t)}if(h){var C=[],U=Object.getOwnPropertyNames(_);if(S)for(var T=0;T<U.length;T++){var I=new e(function(e){r(_[U[T]].paths,_[U[T]].filter,w,x,e)});C.push(I)}else{var E=new e(function(e){for(var t=[],n=0;n<U.length;n++)t=t.concat(_[U[n]].paths);r(t,null,w,x,e)});C.push(E)}console.log("xform: promises.length="+C.length);var W=new e(function(t){e.all(C).then(function(){p(u,g),t()})});C.push(W)}else{U=Object.getOwnPropertyNames(_);for(var O=0;O<U.length;O++)for(var N=_[U[O]].paths,F=0;F<N.length;F++){for(var M=N[F],k=0;k<M.length;k++)void 0===f[M[k]]&&(g.results.push({id:M[k],phid:M[k]}),f[M[k]]=M[k]);P(M)}p(u,g)}}}}),define("DS/PADUtils/PADUtilsServices",["i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Utils/InterCom","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADDataTransform","DS/PADUtils/views/PADAlert","DS/PADUtils/views/PADTenantMgt","DS/PADUtils/PADContext","DS/PADUtils/PADIndexedDb","DS/PADServices/utils/WidgetProxy","DS/PlatformAPI/PlatformAPI","DS/PADServices/utils/PADTrackerManager","DS/ENOXParser/modules/Numbers","require","DS/WAFData/WAFData"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,h,g,f){"use strict";var m,_,v,S,y=null,b=null,D={settypes_params:null},A=!1,P=!1,x=!1,w={registrationOpts:function(){return{title:e.ENOPAD_title,mode:"furtive",default_with_precond:!0,widget_id:widget.id,app_socket_id:"enopad_"+widget.id,idcard_activated:!1,advanced_search:{showByDefault:!1},tenant:C.getPlatformId()}},dropdata_from_node:function(e,t){var n,i=[e.options.type];return t&&t[e.options.type]&&(i=t[e.options.type]),n=!0===e.isRelationsObjectNode?void 0:e.getOccurencePathWithType?e.getOccurencePathWithType():void 0,{envId:C.getPlatformId(),serviceId:"3DSpace",contextId:o.getSetting("pad_security_ctx")?o.getSetting("pad_security_ctx"):void 0,objectId:e.getID(),objectType:e.options.type,objectTaxonomies:i,displayName:e.options.display?e.options.display:e.getLabel(),displayType:e.options.grid["ds6w:type"],path:n}},get_current_tenant_idx:function(e){if(e){var t=e;if(!UWA.is(_)||S[_].platformId!==t)for(var n=0;n<S.length;n++)if(S[n].platformId===t){_=n;break}}else if("undefined"!=typeof widget&&m!==widget.getValue("x3dPlatformId")&&(m=widget.getValue("x3dPlatformId")),UWA.is(m)){t=m;if(!UWA.is(_)||S[_].platformId!==t)for(n=0;n<S.length;n++)if(S[n].platformId===t){_=n;break}}return UWA.is(_)||(_=0),_},set_current_tenant:function(e){m=e},set_current_security_ctx:function(e){v=e;require(["DS/PADUtils/PADSecurityCtxConverter"],function(t){t.setSecurityContext(e)})},_getSecurityContext:function(e){var t=e.user,n=e.callback,i=e.tenant;require(["DS/PADUtils/PADSecurityCtxConverter"],function(e){e.getSecurityContext({user:t,callback:n,tenant:i})})},update_user_history:function(e){Date.now();var t,n,i,o,s,a=!1,r={},l=C.getUser(),d=C.getUserLogin(),u={id:d,foundCallback:function(e){r=e,t=e.preferredSC||""},notFoundCallback:function(e){a=!0}};try{c.getUser(u)}catch(e){console.error("getUser:",e)}if(l&&l.properties&&UWA.is(l.properties.dashboards,"string")&&(n=Object.keys(JSON.parse(l.properties.dashboards)),i=l.properties.lastOpenedDashboardId||""),r?(o=r.dashboards,s=r.activeDashboard,o&&o===n&&s&&s===i||(a=!0)):a=!0,a){var p={id:d,dashboards:n||o,preferredSC:t||e.currentSC,activeDashboard:i||s,callback:e.callback||function(e){}};try{c.updateUser(p)}catch(e){console.error("updateuser error:",e)}}},update_user_sc_history:function(e){Date.now();var t,n,i,o,s=e.currentSC,a=C.getUser(),r=C.getUserLogin();if(a&&a.properties&&(o=a.properties.lastOpenedDashboardId),r&&o&&(i=r+"_"+o),i){var l={id:i,foundCallback:function(e){n=e.activeSC},notFoundCallback:function(e){t=!0}};try{c.getSC(l)}catch(e){console.error("getSC:",e)}if(n?s&&s!==n&&(t=!0):t=!0,s&&t){var d={id:i,userId:r,dashboardId:o,activeSC:s,callback:e.callback||function(e){}};try{c.addSC(d)}catch(e){console.error("updateSC error",e)}}}},getUserActiveSC:function(e){var t,n,i,o=Date.now(),s=e.user||C.getUser(),a=C.getUserLogin();if(s&&s.properties&&(n=s.properties.lastOpenedDashboardId),a&&n&&(i=a+"_"+n),i){var r={id:i,foundCallback:function(n){t=n.activeSC,UWA.is(e.cb)&&e.cb({activeSC:t})},notFoundCallback:function(t){UWA.is(e.cb)&&e.cb({activeSC:""})}};try{c.getSC(r)}catch(e){console.error(o,"getSC:",e)}}else UWA.is(e.cb)&&e.cb({activeSC:""})},fillSecurityPreferences:function(e){var t,n;Date.now();function i(i){if(x=!1,i)if(""!==i.securityContext&&i.securityContextList.length>0){if(e.padsecurityctx&&0!==e.padsecurityctx.length)o.updateSecuritySettings(s,a,e.padsecurityctx,i.securityContextList,e.withPreference);else{var r=o.getSetting("pad_security_ctx")?o.getSetting("pad_security_ctx"):i.securityContext;s&&"OnPremise"===s&&t&&(r=t),n=r,o.updateSecuritySettings(s,a,r,i.securityContextList,e.withPreference)}t||w.update_user_sc_history({currentSC:n}),e.resolve&&e.resolve()}else 0===i.securityContextList.length&&o.setSetting("noSecurityContext",!0);else o.setSetting("noSecurityContext",!0)}if(e.user&&e.user.properties&&e.user.properties.lastOpenedDashboardId&&w.getUserActiveSC({user:e.user,cb:function(e){t=e.activeSC}}),e.user||(e.user=C.getUser()),!1===x&&!0!==e.dynamicUpdate){x=!0;var s,a=C.getTenantsPreference();e.tenant?(s=e.tenant,d.setValue("x3dPlatformId",s),d.setValue("pad_tenant",s)):d.getValue("x3dPlatformId")?s=d.getValue("x3dPlatformId"):(s=a[0].value,d.setValue("x3dPlatformId",s),d.setValue("pad_tenant",s)),this._getSecurityContext({user:e.user,callback:i,tenant:s})}else 1==e.dynamicUpdate&&this._getSecurityContext({user:e.user,callback:i,tenant:e.tenant})}},C={getPCSPrefix:function(){return"undefined"==typeof widget?"ODTFallbackPrefix":widget.id+"_"+widget.title},dropdata_from_selected_nodes:function(e){var t={protocol:"3DXContent",version:"1.1",source:widget&&widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOSTDE_AP",widgetId:C.getWidgetId(),data:{items:[]}};let n=e.filter(function(e){return!0!==e.isGroupingNode});return t.data.items=n.map(function(e){return w.dropdata_from_node(e)}),t},contentOpenWith:function(e,t){var n=[];e.forEach(function(e){-1===n.indexOf(e.options.type)&&n.push(e.options.type)}),require(["DS/PADUtils/PADTypesMgt"],function(i){i.retrieveHierarchy(n,function(n){var i={protocol:"3DXContent",version:"1.1",source:widget&&widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOSTDE_AP",widgetId:C.getWidgetId(),data:{items:[]}};e.forEach(function(e){!0!==e.isGroupingNode&&i.data.items.push(w.dropdata_from_node(e,n))}),t(i)})})},dropdata_from_selected_ids:function(e){var t={protocol:"3DXContent",version:"1.1",source:widget&&widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOPSTR_AP",widgetId:C.getWidgetId(),data:{items:[]}};return e.forEach(function(e){t.data.items.push({envId:C.getPlatformId(),serviceId:"3DSpace",contextId:o.getSetting("pad_security_ctx")?o.getSetting("pad_security_ctx"):void 0,objectId:e.physicalid,objectType:e.type,displayType:e.displayType,displayName:e.label})}),t},retrieveDroppedDataType:function(e){for(var t,n="unknown",i={},o=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",s="",a=["text/searchitems","text/plain","Text"],r=0;r<a.length&&""===s;r++){var l=e.dataTransfer.types[o](a[r]);(UWA.is(l,"number")&&l>=0||UWA.is(l,"boolean")&&!0===l)&&(s=a[r])}if(""!==s){t=e.dataTransfer.getData(s);try{"3DXContent"===(i=JSON.parse(t)).protocol&&(n=i.protocol)}catch(e){console.warn("Unknown data format")}}return n},deserializeDroppedData:function(e){for(var t,n={data:{items:[]}},i=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o="",s=["text/searchitems","text/plain","Text"],a=0;a<s.length&&""===o;a++){var r=e.dataTransfer.types[i](s[a]);(UWA.is(r,"number")&&r>=0||UWA.is(r,"boolean")&&!0===r)&&(o=s[a])}if(""!==o){t=e.dataTransfer.getData(o);try{n=JSON.parse(t)}catch(e){}}return n},retrieveDroppedData:function(t,n,i){function s(t,n){require(["DS/PADUtils/views/PADAlert"],function(i){i.displayNotification({msg:e.replace(e.get("unsupported_type"),{type:t,name:n}),eventID:"warning"})})}n=void 0===n||n;var a={},r=[];if(a=C.deserializeDroppedData(t),!0===o.getSetting("accept_all_types")||!0===i)console.log("Accept all types");else{var l=o.getSetting("authorized_types"),c=0;if(UWA.is(l,"array")){if(UWA.is(a.data)&&UWA.is(a.data.items,"array")&&a.data.items.length>0)do{var d=a.data.items[c].objectType;if(a.data.items[c].path&&a.data.items[c].path.length>0){var u="WITHOUT_CONTEXT";t&&(u=t.shiftKey?"WITHOUT_CONTEXT":"WITH_CONTEXT");var p=1;"WITHOUT_CONTEXT"===u&&(p=a.data.items[c].path.length),a.data.items[c].path[p-1].type&&(d=a.data.items[c].path[p-1].type)}if(-1===l.indexOf(d)){if(console.warn("Unsupported type ["+d+"]"),n)s(a.data.items[c].displayType?a.data.items[c].displayType:a.data.items[c].objectType,a.data.items[c].displayName);r=r.concat(a.data.items.splice(c,1))}else c++}while(c<a.data.items.length)}else console.warn("Unknown property authorized_types")}return{unserializedData:a,unsupportedObjects:r}},retrieveDroppedDataAsync:function(e,t,n,i){n=void 0===n||n;var s=C.deserializeDroppedData(e);!0===o.getSetting("accept_all_types")||!0===i?(console.log("Accept all types"),t({unserializedData:s,unsupportedObjects:[]})):require(["DS/PADUtils/PADTypesMgt"],function(n){n.retrieveAuthorizedObjects({notifPerObjects:!0,displayNotif:!1,dnd_event:e,unserializedData:s,version:"2.0",callback:function(e){t({unserializedData:s,unsupportedObjects:e.unauthorized_objects,authorized_objects:e.authorized_objects,source_data:e.source_data,authorizedWithKind:e.authorizedWithKind})}})})},getTenantsPreference:function(){var e=[];if(!UWA.is(S,"array"))throw new Error("Platform services not initialize yet");return S.forEach(function(t){e.push({label:t.displayName,value:t.platformId})}),e},getTenantId:function(){return console.warn("Deprecated method. Should use getPlatformId()"),C.getPlatformId()},updatePlatformId:function(e){e&&("undefined"!=typeof widget&&(widget.setValue("x3dPlatformId",e),widget.setValue("pad_tenant",e)),w.set_current_tenant(e),o.setSetting("x3dPlatformId",e),o.setSetting("pad_tenant",e))},get3DSearchUrl:function(){if(!UWA.is(S,"array"))throw new Error("Platform services not initialize yet");var e=w.get_current_tenant_idx();return-1===S[e]["3DSearch"].indexOf("/federated",S[e]["3DSearch"].length-"/federated".length)?S[e]["3DSearch"]+"/federated":S[e]["3DSearch"]},get3DSpaceUrl:function(e){if(!UWA.is(S,"array"))throw new Error("Platform services not initialize yet");var t=0;return t=e?w.get_current_tenant_idx(e):w.get_current_tenant_idx(),void 0===S[t]["3DSpace"]&&console.warn("No 3DSpace URL available for this tenant"),S[t]["3DSpace"]},getPlatformURL:function(e,t){if(!UWA.is(S,"array"))throw new Error("Platform services not initialize yet");var n=0;return n=t?w.get_current_tenant_idx(t):w.get_current_tenant_idx(),void 0===S[n][e]?(console.error("No "+e+" URL available for this tenant. Returning 3DSpace URL as failsafe"),C.get3DSpaceUrl(t)):S[n][e]},setOption:function(e,t){console.warn("DEPRECATED: Invalid call: please use DS/PADUtils/PADSettingsMgt.setSetting"),o.setSetting(e,t)},getOption:function(e){console.warn("DEPRECATED: Invalid call: please use DS/PADUtils/PADSettingsMgt.getSetting"),o.getSetting(e)},getGrantedRoles:function(e){n.getGrantedRoles(function(t){e(t)})},getVISnVIOStatus:function(e){if(this.isCloud()){var t=this.getPlatformURL("3dvisucontentjobmgmt")+"/api/v1/activation/license",n={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:3e4,onComplete:function(t){"string"==typeof t&&(t=JSON.parse(t)),e(t)},onFailure:function(t){e({hasLicense:!1})},onTimeout:function(t){e({hasLicense:!1})},onCancel:function(t){e({hasLicense:!1})}};f.authenticatedRequest(t,n)}else e({hasLicense:!1})},app_initialization:function(t,i,s){if(s=void 0===s||s,!UWA.is(t,"function"))throw new Error("Invalid callback for the PAD app initialization");var r=require("DS/PADUtils/PADProbes").createProbe("_getPlatformServices"),l="undefined"==typeof widget||null==widget.data||null==widget.data.addPlatformPref||widget.data.addPlatformPref;if("undefined"!=typeof widget&&widget.addEvent("onPlatformIdChange",function(e,t){"x3dPlatformId"===e&&o.updateTenantSecPreference(t,!0)}),void 0!==i){var c=this.getUser();if(r.end(),r=null,S=i,!0===o.with_security_context)w.fillSecurityPreferences({user:c,withPreference:s});else{var d=C.getTenantsPreference(),u="undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):d[0].value;1==l&&s&&o.updateTenantSettings(u,d)}t.call(null)}else{var p=!1;"undefined"!=typeof widget&&widget.getValue("noCompass")&&(p=!0),n.getPlatformServices({onComplete:function(i){r.end(),r=null,S=[];var c=!1;if(!p&&"undefined"!=typeof widget&&i&&i.length>1){var d=i[0].platformId;d&&-1===["OnTenant1","odt_tenant","OnPremise"].indexOf(d)&&(c=!0)}if(c)n.getAppInfo({appId:C.getAppId(),onComplete:function(n){var r=!!n.tenantAware&&n.tenantAware;if(r){for(var c=0;c<n.platforms.length;c++)for(var d=0;d<i.length;d++)if(!r||i[d].platformId===n.platforms[c].id){S.push(i[d]);break}if(0===n.platforms.length)for(d=0;d<i.length;d++)if(!r||i[d].platformId===n.platformId){S.push(i[d]);break}}else S=i;var u=C.getTenantsPreference();if("undefined"!=typeof widget){let t=C.getPlatformId(),n=!0;for(let e=0;e<S.length&&n;e++)S[e].platformId===t&&(n=!1);n&&(C.updatePlatformId(u[0].value),a.displayNotification({msg:e.replace(e.get("notAccessibleTenant"),{tenant:t,switchedTenant:u[0].label}),eventID:"warning",key:"notAccessibleTenant"}))}if(!0===o.with_security_context)w.fillSecurityPreferences({user:C.getUser(),withPreference:s});else{var p="undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):u[0].value;1==l&&s&&(console.info("tenants",u),console.info("current_tenant",p),o.updateTenantSettings(p,u,!0))}t({success:!0})},onFailure:function(e){console.error("Cannot retrieve the App Info"),t({success:!1})}});else{if(S=i,!0===o.with_security_context)w.fillSecurityPreferences({user:C.getUser(),withPreference:s});else{var u=C.getTenantsPreference(),h="undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):u[0].value;1==l&&s&&h&&o.updateTenantSettings(h,u)}t({success:!0})}},onFailure:function(e){r.end(),r=null,t({success:!1})}})}},in_apps_search:function(e){console.warn("DEPRECATED: Invalid call: please use DS/PADUtils/PADUtilsServices.inAppsSearch()");var n=UWA.extend(w.registrationOpts(),e),i=new t.Socket(n.app_socket_id,{dispacthRetryInterval:0});!0===e.debug_mode&&i.setDebugMode(!0),UWA.is(e.parent_window)?i.subscribeServer("SearchComServer",window):i.subscribeServer("SearchComServer"),i.dispatchEvent("RegisterContext",n),UWA.is(e.context_name)&&(n.context_title=e.context_name);var o=[];n.default_search_criteria=e.fts_value,i.dispatchEvent("InContextSearch",n),i.addListener("Selected_Objects_search",function(e){o=e}),i.addListener("closeTransient",function(t){"in_app_ok"===t.command_id?e.callback.call(null,o):"in_app_apply"===t.command_id?e.apply?e.apply.call(null,o):e.callback.call(null,o):e.cancel&&e.cancel.call(null),i.dispatchEvent("UnregisterContext",{widget_id:n.widget_id})}),i.addListener("onCloseTransient",function(t){e.cancel&&e.cancel.call(null),i.dispatchEvent("UnregisterContext",{widget_id:n.widget_id})})},inAppsSearch:function(e){var n=UWA.extend(w.registrationOpts(),e),i=new t.Socket(n.app_socket_id,{dispacthRetryInterval:0});!0===e.debug_mode&&i.setDebugMode(!0),UWA.is(e.parent_window)?i.subscribeServer("SearchComServer",window):i.subscribeServer("SearchComServer"),i.dispatchEvent("RegisterContext",n),UWA.is(e.context_name)&&(n.context_title=e.context_name),n.default_search_criteria=e.fts_value,i.dispatchEvent("InContextSearch",n),i.addListener("InContextSearch_Response",function(t){switch(t.selected_command){case"in_app_ok":e.callback.call(null,t);break;case"in_app_apply":e.apply?e.apply.call(null,t):e.callback.call(null,t);break;default:e.cancel&&e.cancel.call(null)}i.dispatchEvent("UnregisterContext",{widget_id:n.widget_id})}),i.addListener("onCloseTransient",function(t){e.cancel&&e.cancel.call(null),i.dispatchEvent("UnregisterContext",{widget_id:n.widget_id})})},subscribeCfgModifyEvent(e){var t="cfgEffectivityModifications_"+this.getWidgetId();u.subscribe(t,function(t){UWA.is(t,"string")&&(t=JSON.parse(t)),console.info("cfg==>",t.commandName),e.handler?e.handler(t):console.info("some random event",t)})},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:-1},getAppId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},getSharedId:function(){return"undefined"!=typeof widget?widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId():-1},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):o.getSetting("x3dPlatformId")},getRequestLabel:function(){return C.getUserLogin()+"-"+C.getAppId()+"-"+Date.now()},showTransientWidget:function(e,t,n,i){require(["DS/TransientWidget/TransientWidget"],function(o){o.showWidget(e,t,n,i)})},setObject_on_compass:function(e){var n=UWA.is(widget)&&widget.id?"padcompassSocket_"+widget.id:"padcompassSocket";if(!UWA.is(e.nodes_2_open,"array"))throw new Error("setObject_on_compass: Invalid init parameter nodes_2_open");null===y&&(y=new t.Socket(n)).subscribeServer("com.ds.compass",window.parent);var i=null;if(0===e.nodes_2_open.length)y.dispatchEvent("onResetX3DContent",{},n);else{null===i&&(i=require("DS/PADUtils/PADSettingsMgt"));var o=C.dropdata_from_selected_nodes(e.nodes_2_open);0===o.data.items.length?y.dispatchEvent("onResetX3DContent",{},n):y.dispatchEvent("onSetX3DContent",o,n)}},setStructure_4_open_in_cv5:function(e){var t,n,s=[];if(!UWA.is(e.nodes_2_open,"array")&&!UWA.is(e.completeselection))throw new Error("setStructure_4_open_in_cv5: Invalid init parameter nodes_2_open");if(e.completeselection)s=e.completeselection;else if(o.getSetting("open_in_v5_v2"))s=C.buildOpenJson(e.nodes_2_open,e.selected_paths);else{var a=[];e.nodes_2_open.forEach(function(e){var i=e.getParents(),o=e.getAllDescendants();for(t=0;t<i.length;t++)n=i[t].getID(),-1===a.indexOf(n)&&(s.push({physicalid:n,isroot:i[t].isRoot()}),a.push(n));if("CgrViewable"!==e.options.grid["ds6w:type"]&&"ThumbnailViewable"!==e.options.grid["ds6w:type"])for(n=e.getID(),-1===a.indexOf(n)&&(s.push({physicalid:n,isroot:e.isRoot()}),a.push(n)),t=0;t<o.length;t++)"CgrViewable"!==o[t].options.grid["ds6w:type"]&&"ThumbnailViewable"!==o[t].options.grid["ds6w:type"]&&(n=o[t].getID(),-1===a.indexOf(n)&&(s.push({physicalid:n,isroot:o[t].isRoot()}),a.push(n)))})}var r=JSON.stringify(s);i.publish("setStructure",{structure:r})},buildOpenJson:function(e,t){var n,i,o={version:"1",structures:{references:[],connections:[],trees:{}}},s=[],a="",r=0,l=0,c={},d=[];t&&t.forEach(function(e){d.push(e[e.length-1])});var u=function(e){var t=c[e];UWA.is(n[t.localid])||(n[t.localid]={},t.selected&&(n[t.localid].selected=t.selected)),n=n[t.localid]},p=function(e){var t=e.isSelected();return d.length&&(t=-1!==d.indexOf(e.getID())),t};return e.forEach(function(e){var t=e.getParents(),d=e.getAllDescendants();for(r=0;r<t.length;r++)(a=t[r].getRelationID()).length>0&&-1===s.indexOf(a)&&(o.structures.connections.push({physicalid:a,localid:l+""}),c[a]={localid:l,selected:p(t[r])},l++,s.push(a)),a=t[r].getID(),-1===s.indexOf(a)&&(o.structures.references.push({physicalid:a,type:t[r].options.type,localid:l+""}),c[a]={localid:l},l++,s.push(a));for((a=e.getRelationID()).length>0&&-1===s.indexOf(a)&&(o.structures.connections.push({physicalid:a,localid:l+""}),c[a]={localid:l,selected:p(e)},l++,s.push(a)),a=e.getID(),-1===s.indexOf(a)&&(o.structures.references.push({physicalid:a,type:e.options.type,localid:l+""}),c[a]={localid:l},e.isRoot()&&p(e)&&(c[a].selected=p(e)),l++,s.push(a)),r=0;r<d.length;r++)(a=d[r].getRelationID()).length>0&&-1===s.indexOf(a)&&(o.structures.connections.push({physicalid:a,localid:l+""}),c[a]={localid:l,selected:p(d[r])},l++,s.push(a)),a=d[r].getID(),-1===s.indexOf(a)&&(o.structures.references.push({physicalid:a,type:d[r].options.type,localid:l+""}),c[a]={localid:l},l++,s.push(a));var h=e.getLeaves();if(h.length>0)for(var g=0;g<h.length;g++)n=o.structures.trees,(i=h[g].getOccurencePath()).forEach(u);else i=e.getOccurencePath(),n=o.structures.trees,i.forEach(u)}),o},open_app:function(e,n){var i=UWA.is(widget)&&widget.id?"padcompassSocket_"+widget.id:"padcompassSocket";null===y&&(y=new t.Socket(i)).subscribeServer("com.ds.compass",window.parent),y.addListener("launchApp",function(e){UWA.is(n,"function")&&n(e)}),y.dispatchEvent("onLaunchApp",e,i)},launchApp:function(e,t){var n={appId:e.appId,widgetId:e.widgetId};i.publish("launchApp",n,function(e){UWA.is(t,"function")&&t(data)})},updateWidgetSecPref:function(e){UWA.is(S,"array")&&w.fillSecurityPreferences(e)},multiTenantMgt:function(t,n,i,o){var s=[],c=l.get(),d={isMultiTenant:!1,isClearView:!1};d.tenant=t[0].envId,d.padsecurityctx=t[0].contextId,""!==d.tenant&&void 0!==d.tenant||(d.tenant="OnPremise");var u=C.getTenantsPreference().find(({value:e})=>e.toLowerCase()===d.tenant.toLowerCase());if(u&&C.getTenantsPreference().length>1&&C.getPlatformId()!==d.tenant)if(0===n.length)s.push(new Promise(function(e){var t={tenant:d.tenant,padsecurityctx:d.padsecurityctx,resolve:e,withPreference:o};w.fillSecurityPreferences(t)})),s&&Promise.all(s).then(function(){a.displayNotification({msg:e.PlatformChange,eventID:"success"}),i(d)});else{var p=require("DS/PADServices/utils/GlobalModelEvents");p.publish({event:"ENXApp/possibleTenantChange"});new r({id:"PadTenantMgt",currentTenant:d,callback:function(t){t.isClearView?(c.empty(void 0,!0),s.push(new Promise(function(e){var t={tenant:d.tenant,padsecurityctx:d.padsecurityctx,resolve:e,withPreference:o};w.fillSecurityPreferences(t)})),s&&Promise.all(s).then(function(){a.displayNotification({msg:e.PlatformChange,eventID:"success"}),i(t)})):(p.publish({event:"ENXApp/cancelTenantChange"}),i(t))}})}else u?i(d):(d.isMultiTenant=!0,d.invalidTenant=!0,a.displayNotification({msg:e.replace(e.invalidTenant,{tenant:d.tenant}),eventID:"warning",key:"invalidTenant"}),i(d))},authoringCtxAvailable:function(){P=!0},isAuthoringCtxAvailable:function(){return P},setTypesForOFW:function(e){if(!A){var t=this;i.subscribe("setTypesCallback",function(n){var a=g("DS/PADUtils/PADUtilsServices");if(n.widgetId===a.getWidgetId()){var r=p.getPADTracker({eventCategory:"usage",eventAction:"command-2D"});r?(r.setEventData({eventLabel:"openWith-"+n.appId}),r.trackPageEvent()):console.warn("tracker not defined");var l=e.getSelectedNodesForOFW();if(l.length>0){var c,d;if(P)try{var u=g("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");c=u.get()}catch(e){console.warn("CfgAuthoringContext throw an error")}if("MAP-CATCDVEAP"===n.appId&&1===l.length&&l[0].relatedCADDocs&&(d=l[0].relatedCADDocs.getSelectedNodes()),d&&0!=d.length||"MAP-CATCDVEAP"!==n.appId||1!==l.length||!l[0].isRoot()||UWA.is(l[0].options.config_filter)||UWA.is(l[0].options.sequence_filter)||UWA.is(l[0].options.CVQuery)||UWA.is(c)&&""!==c.change.id||!0!==o.getSetting("directOpenPCS")){let t=Promise.resolve();if("function"==typeof e.isGroupingApplied&&e.isGroupingApplied()){let n=[];for(let e=0;e<l.length;e++)!0===l[e].isGroupingNode&&n.push(l[e]);n.length&&(t=new Promise(t=>{e.focusOnGroups().then(()=>{let n=e.getSelectedNodesForOFW();l=[];for(let e=0;e<n.length;e++)!0!==n[e].isGroupingNode&&l.push(n[e]);t()})}))}t.then(function(){var t="SWXCSWK_AP"!==n.appId;s.buildDataForSetTypes(l,e,function(t,o){t._getLastViewpoint(function(t){var s,a,r;if(null!==t&&o.viewpoint.push(t),c&&(o.workUnder=c),"function"==typeof e.getGroupingForOpen&&(o.grouping=e.getGroupingForOpen()),d)for(a=(new Date).valueOf(),s=0;s<d.length;s++)"XCADNonPSBaseRepReference"!==d[s].options.type&&"Drawing"!==d[s].options.type||(a++,r=""+d[s].options.physicalid,o.results.push({id:""+a,phid:r}),o.structures.push({structure:[]}),o.structures[o.structures.length-1].structure.push({id:""+a,show:!0,select:!1,children:[]}));var l=JSON.stringify(o),u={appId:n.appId,widgetId:n.widgetId,fileName:"-file",fileContent:l};i.publish("launchApp",u)})},t)})}else{var h={objectId:l[0].getID(),envId:C.getPlatformId(),contextId:v,serviceId:"3DSpace"};i.publish("setObject",h),i.subscribe("launchAppCallback",function(e){e.appId===n.appId&&e.widgetId===n.widgetId&&i.publish("setObject",{objectId:"",envId:t.getPlatformId(),contextId:"",serviceId:"3DSpace"})});var f={appId:n.appId,widgetId:n.widgetId};i.publish("launchApp",f,function(e){i.publish("setTypes",D.settypes_params)})}}else{o.getSetting("ofwCadMaster")&&i.publish("resetTypes");var m={appId:n.appId,widgetId:n.widgetId};i.publish("launchApp",m,function(e){i.publish("setTypes",D.settypes_params)})}}}),A=!0}D.settypes_params||(D.settypes_params={widgetId:C.getWidgetId()}),i.publish("setTypes",D.settypes_params)},launchWithSetTypes:function(e,t,n){s.buildDataForSetTypes(e.getSelectedNodes(),e,function(e,o){e._getLastViewpoint(function(e){null!==e&&o.viewpoint.push(e);var s=JSON.stringify(o),a={appId:t,widgetId:C.getWidgetId(),fileName:"-file",fileContent:s};i.publish("launchApp",a,function(e){UWA.is(n,"function")&&n(e)})})})},_setpadsocketToNull:function(){y=null},getUser:function(){return null==b&&(b=u.getUser()),b},getUserLogin:function(){var e=C.getUser(),t="";return e&&(t=e.login),t},getUserName:function(){var e=C.getUser(),t="";return e&&(t=e.firstName+" "+e.lastName),t},printWindow:void 0,printWindowOpen:function(){return void 0!==C.printWindow&&null!==C.printWindow&&!1===C.printWindow.closed},printhtml:function(e){C.printWindowOpen()&&C.printWindow.close();setTimeout(function(){C.printWindow=window.open("","PrintWindow","width=1024, height=768"),void 0!==C.printWindow&&(C.printWindow.document.write(e),C.printWindow.document.close(),C.printWindow.focus(),C.printWindow.print(),C.printWindow.close())},0)},customizationWindowChange:function(e){require(["DS/ApplicationFrame/CommandsManager"],function(t){var n=e.id,i=e.open;if(void 0!==n&&void 0!==i){var o=t.getCommand(n);o&&(i?o.disable():o.enable())}})},downloadfile:function(e,t,n){var i=document,o=i.createElement("a");if(UWA.is(e)&&UWA.is(t)&&UWA.is(n)){if(n=n||"application/octet-stream",navigator.msSaveBlob&&!this.odtMode)return navigator.msSaveBlob(new Blob([e],{type:n}),t);if("download"in o){var s=URL.createObjectURL(new Blob([e],{type:n}));return o.setAttribute("href",s),o.setAttribute("download",t),o.innerHTML="downloading...",i.body.appendChild(o),setTimeout(function(){o.click(),i.body.removeChild(o),URL.revokeObjectURL(s)},66),!0}}},downloadfileURL:function(e,t){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(n.response,t);else{var e=document.createElement("a");e.href=window.URL.createObjectURL(n.response),t&&(e.download=t),e.style.display="none",document.body.appendChild(e),e.click(),e=void 0}},n.send()},getSecurityContext:function(e){var t=C.getTenantsPreference(),n="undefined"!=typeof widget&&widget.getValue("x3dPlatformId")?widget.getValue("x3dPlatformId"):t[0].value,i=this.getUser();w._getSecurityContext({user:i,callback:e,tenant:n})},isTouchDevice:function(){return"ontouchstart"in document.documentElement},isSurface:function(){return navigator.maxTouchPoints>0},isMobileDevice:function(){return navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i)||C.isIOSDesktopMode()},isIPad:function(){return navigator.userAgent.match(/iPad/i)||isIOSDesktopMode()},isIOSDesktopMode:function(){return"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},isCloud:function(){var e;return void 0===e&&(e=!1,"undefined"!=typeof widget&&"OnPremise"!==widget.getValue("x3dPlatformId")&&(e=!0)),e},isCompassAvailable:function(){var e=document.querySelector("#compass_ctn")||document.querySelector(".topbar-compass");return!e&&window.parent&&(e=window.parent.document.querySelector("#compass_ctn")||window.parent.document.querySelector(".topbar-compass")),!e&&window.top&&(e=window.top.document.querySelector("#compass_ctn")||window.top.document.querySelector(".topbar-compass")),!!e},checkNotIdentity:h.checkNotIdentity};return o.addEvent("onX3dPlatformId",function(e){w.set_current_tenant(e)}),o.addEvent("onPad_security_ctx",function(e){Date.now();var t,n={cb:function(e){t=e.activeSC}};w.getUserActiveSC(n),!e&&t&&(e=t),e&&(w.update_user_history({currentSC:e}),w.update_user_sc_history({currentSC:e}),w.set_current_security_ctx(e))}),C}),define("DS/PADUtils/PADSharedSettings",["text!DS/PADUtils/assets/PADSharedSettings.json","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/PADUtils/Configuration","DS/PADUtils/PADUtilsServices"],function(e,t,n,i,o){"use strict";var s={debouncePrefSynchro:{},cbFuncLocal:{},cbFuncShared:{},proxy:null,appWidget:null},a={sharedSettings:JSON.parse(e),usedSharedSettings:[],destroy:function(){s.appWidget=null,s.proxy&&(s.proxy.destroy(),s.proxy=null),s.debouncePrefSynchro={},s.cbFuncLocal={},s.cbFuncShared={},a.usedSharedSettings=[]},listAvailableSharedSettings:function(){return Object.getOwnPropertyNames(a.sharedSettings)},addSharedSettings:function(e,t){if(e){if(s.appWidget||(s.appWidget=e),s.appWidget!==e)throw new Error("Unexpected widget");var i=(UWA.is(t,"array")?t:a.listAvailableSharedSettings()).filter(function(e){return-1===a.usedSharedSettings.indexOf(e)});if(0===i.length)return;if(-1!==i.indexOf("pad_security_ctx")&&(n.with_security_context=!0),-1!==i.indexOf("enopad3dviewer_CGRorTHB")){var r=e.getValue("enopad3dviewer_CGRorTHB");"boolean"==typeof r&&(r?e.setValue("enopad3dviewer_CGRorTHB","HIGH"):e.setValue("enopad3dviewer_CGRorTHB","OPTIMIZED"))}if(-1!==i.indexOf("autoreload")){var l=e.getValue("Cockpit_RootIds");"null"===l&&(l=null),(l||e.getValue("3dmigrated"))&&(a.sharedSettings.autoreload.value=!0,e.setValue("autoreload",!0),e.deleteValue("3dmigrated"))}var c,d={},u=[];for(c=0;c<i.length;c++)if(UWA.is(a.sharedSettings[i[c]],"object")){if(("ENOPSTE_AP"===e.data.appId||"ENOSC2D_AP"===e.data.appId)&&!0===a.sharedSettings[i[c]].only3D){i.splice(c,1);continue}n.options.run_options[i[c]]=a.sharedSettings[i[c]],!0!==i[c].notAddedByDefault&&(d[i[c]]=a.sharedSettings[i[c]]),a.usedSharedSettings.push(i[c]),u.push(i[c])}else console.warn("Unknown shared setting "+i[c]);var p=n.build_preferences(d);if(s.appWidget.mergePreferences(p),-1!==i.indexOf("pad_security_ctx")&&o.updateWidgetSecPref({user:o.getUser()}),!s.proxy){var h=require("DS/PADUtils/PADCommandProxy"),g=function(e){s.debouncePrefSynchro[e.name]=!0,s.appWidget.setValue(e.name,e.value),n.setSetting(e.name,e.value)};s.proxy=h.create({events:{onPreferenceModification:function(e){void 0===s.cbFuncLocal[e.name]&&-1!==a.usedSharedSettings.indexOf(e.name)&&(s.cbFuncLocal[e.name]=g),s.cbFuncLocal[e.name]&&s.cbFuncLocal[e.name](e)}}})}var f=function(e){!0!==s.debouncePrefSynchro[e.name]&&s.proxy?s.proxy.preferenceModification({name:e.name,value:e.value}):s.debouncePrefSynchro[e.name]=!1};for(c=0;c<u.length;c++){!function(e){var t="on"+e.charAt(0).toUpperCase()+e.slice(1);n.addEvent(t,function(t){var n={name:e,value:t};void 0===s.cbFuncShared[n.name]&&(s.cbFuncShared[n.name]=f),s.cbFuncShared[n.name](n)})}(u[c])}}},resetDebounceFlags:function(){s.debouncePrefSynchro={}}};return a}),define("DS/PADUtils/PADRelatedDocuments",["DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices"],function(e,t){"use strict";return{getRelatedCADDocuments:function(n){console.warn("Deprecated method PADRelatedDocuments.getRelatedCADDocuments");var i=require("DS/PADUtils/PADSettingsMgt"),o=n||{},s=t.get3DSpaceUrl()+"/cvservlet/navigate";o.method="POST",o.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":i.getSetting("lang")},o.timeout||(o.timeout=i.getSetting("webapi_timeout"));var a=i.getSetting("pad_security_ctx");UWA.is(a,"string")&&(o.headers.SecurityContext=a,s=s+"?SecurityContext="+a),o.data.primitives=[{navigate_from_rel:{id:1,filter:{rel_type:["VPMInstance"]}}},{navigate_to_sr:{id:2,filter:{role:["6"],semantics:["5"]}}},{navigate_from_sr:{id:3}},{navigate_from_rel:{id:4,filter:{rel_type:["XCADBaseDependency"]}},navigate_to_rel:{id:5,filter:{rel_type:["XCADBaseDependency"]}}}],o.data.patterns={RELATEDCADDOCS_TO:[{id:2}],RELATEDCADDOCS_FROM:[{id:3}],RELATEDXCADDOCS_FROM:[{id:4}],RELATEDXCADDOCS_TO:[{id:5}]},o.data.patternTypeFilters={RELATEDCADDOCS_TO:{typesToNotReturn:["PGPRep","VPMPort"]},RELATEDCADDOCS_FROM:{typesToNotReturn:["PGPRep","VPMPort"]}},o.data.version=3,o.data.attributes=["ds6w:label","ds6w:type","ds6w:responsible","ds6wg:revision","ds6w:identifier"],o.data.label=t.getRequestLabel(),o.data=JSON.stringify(o.data),e.authenticatedRequest(s,o)}}}),define("DS/PADUtils/PADSettings",["DS/PADUtils/PADUtilsServices"],function(e){"use strict";return console.warn("Deprecated module DS/PADUtils/PADSettings use DS/PADUtils/PADUtilsServices instead for the services methods or DS/PADUtils/PADSettingsMgt for settings mgt"),e}),define("DS/PADUtils/commands/RightSidePanel",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","UWA/Promise","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/Utilities/Utils","UWA/Class/Model","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i,o,s,a,r){"use strict";var l,c,d=[],u=!1;return void 0!==i.get&&void 0!==i.get().getEditMode&&!0!==i.get().getEditMode()&&(u=!0),t.extend({_context:null,_propertiesWdg:null,_xso:null,_readOnly:u,_tkAdd:null,_tkRemove:null,_tkEmpty:null,init:function(e){this._parent(e,{}),this._context=i.get();var t=this;e.arguments.length&&e.arguments.forEach(function(e){"PropertiesReadOnly"===e.ID&&"true"===e.Value&&(t._readOnly=!0)});var n=s.debounce(function(){!0===t.getState()&&t._selectionChange()},100);this._tkAdd=this.getXSO().onPostAdd(n),this._tkRemove=this.getXSO().onPostRemove(n),this._tkEmpty=this.getXSO().onEmpty(n),this._buildView(),require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.subscribe({event:"ENXViews/Triptych/onOverlayClick"},function(e){e&&"right"===e&&!0===t.getState()&&(t.toggleState(),t.getTriptych().togglePanel("right"))})})},_selectionChange:function(){var e=this,t=this.getXSO().get(),i=new n(function(i){n.all(d).then(function(){var o=[];let s=[];t.length&&t.forEach(function(t){e.isNodeValid(t)&&("r2vsurvey"===e.getServiceId(t)?s.push(e.__r2vsurveyPropModel(t)):s.push(e.__defaultPropNodeModel(t)))}),n.all(s).then(t=>{o=t,e._propertiesWdg.initDatas(o)}).catch(()=>{console.warn("Cannot retrieve properties model")}),i()})});d.push(i)},__defaultPropNodeModel:function(e){var t=this;return new n(n=>{if(t.__facetToSetVisible&&t.__facetToSetVisible.length){let e=this._propertiesWdg.controller.getUI()._lFacets;for(let n=0;n<e.length;n++)-1!==t.__facetToSetVisible.indexOf(e[n].facet.name)&&(e[n].alwaysVisible=!0);delete this.__facetToSetVisible}"function"!=typeof e.getID&&(e.getID=function(){return t.getID(this)}),"function"!=typeof e.getRelationID&&(e.getRelationID=function(){return t.getRelationID(this)}),void 0===e.type&&(e.options&&e.options.type?e.type=e.options.type:e.type=t.getType(e)),n(t.EditPropUtils.getModelFromSelectedNode(e))})},__r2vsurveyPropModel:function(e){return new n((t,n)=>{require(["DS/PADServices/utils/R2VProperties"],i=>{this.__facetToSetVisible=[];let o=this._propertiesWdg.controller.getUI()._lFacets;for(let e=0;e<o.length;e++)switch(o[e].facet.name){case"properties":break;default:!0===o[e].alwaysVisible&&(this.__facetToSetVisible.push(o[e].facet.name),o[e].alwaysVisible=!1)}i.getPropModel({objectId:this.getID(e),type:this.getType(e),serviceId:this.getServiceId(e)}).then(t).catch(n)})})},_buildView:function(){var t=this;if(t.getTriptych()){var i=t.getTriptych().getRightPanelContainer().querySelector(".rightSidePanel");if(i&&null===i.firstElementChild){var s=new n(function(s){require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/utils/EditPropUtils","DS/EditPropWidget/constants/EditPropConstants"],function(a,d,u){t.EditPropUtils=d,c=t.EditPropUtils;var p=t._context.getPropertiesFacet();l?t._propertiesWdg=l:(t._propertiesWdg=new a({className:"enxpropertiestab",setEditButton:!t._readOnly,readOnly:t._readOnly,typeOfDisplay:u.ALL,selectionType:u.NO_SELECTION,warningOnUnsaved:!1,multiselection:u.MULTISEL_NO,collapseTabs:!1,context:t._context,actions:[{name:"action_close_panel",text:r.closeProperties,icon:"close",handler:function(){t.setState(!1)}}]}),t._propertiesWdg.removeFacets([u.FACET_VIEWS]),t._propertiesWdg.removeFacets([u.FACET_DERIVEDOUTPUT]),t._context.addEvent("onParentResize",t._propertiesWdg.onResize.bind(t._propertiesWdg)),t._context.addEvent("editModeModified",function(e){void 0!==t._propertiesWdg.setReadonlyStatus&&t._propertiesWdg.setReadonlyStatus(!e)})),l=t._propertiesWdg.inject(i),!0===t.getState()&&t._selectionChange();for(var h=[],g=0;g<p.length;g++){var f=p[g],m=new n(function(i){var s=f;n.all(h).then(function(){if(e.is(s,"string")&&"relations"===s){require(["DS/ENORIPE_Relations/RelationsTabSettings"],function(n){var s={getPlatformID:function(){return o.getPlatformId()},getServiceID:function(){return"3DSpace"}};n.isAvailable(s,{isDraggable:!0}).then(function(n){e.is(n,"object")&&e.is(n.facetInfo)?(n.facetInfo.options={defaultProfile:"Designer"},n.facetInfo.position=2,t._propertiesWdg.addFacets([n.facetInfo])):console.log("facets info is NOT in good format"),i()},function(){console.log("this facet is not available for this context = "+n),i()})},function(e){console.warn("Cannot load "+e.requireModules),i()})}else if(s.facet){if(s.facet.text||(s.facet.text=r[s.facet.name+"_cmd_title"]),s.actions&&s.actions.length>0)for(var n=0;n<s.actions.length;n++)s.actions[n].text=r[s.facet.name+s.actions[n].text];t._propertiesWdg.addFacets([s]),i()}else i()})});h.push(m)}t._propertiesWdg.stopSelection(!t.getState()),s()})});d.push(s)}else i&&null!==i.firstElementChild&&i.getElement&&i.getElement(".enxpropertiestab")&&(t._propertiesWdg=l,t._propertiesWdg.options&&t._propertiesWdg.options.actions&&e.is(t._propertiesWdg.options.actions,"array")&&"action_close_panel"===t._propertiesWdg.options.actions[0].name&&(t._propertiesWdg.options.actions[0].handler=function(){t.setState(!1)}),t.EditPropUtils=c);t.onStateChange(function(){t.getTriptych().getRightOpen()&&t.getState()||!t.getTriptych().getRightOpen()&&!t.getState()||(t._propertiesWdg.stopSelection(!t.getState()),!0===t.getState()&&t._selectionChange(),t.getTriptych().togglePanel("right"))}),t.getTriptych().getRightOpen()&&t.setState(!0)}else{console.log("Triptych not ready yet. Wait for it to complete the side panel");var a=new n(function(e){t.onTriptychReady(t._buildView.bind(t)),e()});d.push(a)}},getXSO:function(){throw new Error("This function must be reimplemented")},getID:function(e){throw new Error("This function must be reimplemented")},getRelationID:function(e){throw new Error("This function must be reimplemented")},getType:function(e){throw new Error("This function must be reimplemented")},getTriptych:function(e){throw new Error("This function must be reimplemented")},onTriptychReady:function(){throw new Error("This function must be reimplemented")},isNodeValid:function(e){return!0},getServiceId:function(e){return"3DSpace"},destroy:function(){this.getXSO().unsubscribe(this._tkAdd),this.getXSO().unsubscribe(this._tkRemove),this.getXSO().unsubscribe(this._tkEmpty)}})}),define("DS/PADUtils/views/PADPager",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADCommandProxy","DS/Core/ModelEvents","DS/Controls/Button","DS/Controls/ButtonGroup","DS/UIKIT/Tooltip"],function(e,t,n,i,o,s,a,r,l,c){"use strict";var d=i.extend({renderTo:null,visible:!1,_modelEvents:null,init:function(e){this.renderTo=e.renderTo?e.renderTo:document.body,this.callbacks=e.callbacks?e.callbacks:{},this.injectNow=e.injectNow?e.injectNow:void 0,this._parent(e),this._buildSkeleton(),this._commandProxy=s.create({events:{onPadPagerSync:this.padPagerSync.bind(this)}}),this._modelEvents=new a;require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.subscribe({event:"ENXViews/PADPager/close"},function(e){this.getModelEvents().publish({event:"close"})}.bind(this))}.bind(this))},show:function(){!1===this.visible&&(this.elements.container.inject(this.renderTo),this.visible=!0)},hide:function(e=!1){if(!0===this.visible){this.renderTo.removeChild(this.elements.container),this.visible=!1;let t={operation:"close",sharedID:o.getSharedId()};this._commandProxy.padPagerSync(t),e||this.padPagerSync(t)}this.injectNow&&this.destroy()},padPagerSync:function(e){e&&e.operation&&("next"===e.operation&&this.callbacks.onNext?this.callbacks.onNext():"previous"===e.operation&&this.callbacks.onPrevious?this.callbacks.onPrevious():"selectAll"===e.operation&&this.callbacks.onSelectAll?this.callbacks.onSelectAll():"reframeAll"===e.operation&&this.callbacks.onReframeAll?this.callbacks.onReframeAll():"close"===e.operation&&this.callbacks.onClose&&e.sharedID===o.getSharedId()&&this.callbacks.onClose())},setLabel:function(e){this.elements.textInfo&&(this.elements.textInfo.innerHTML=e)},publish:function(e){this.getModelEvents().publish(e)},subscribe:function(e,t){return this.getModelEvents().subscribe(e,t)},unsubscribe:function(e){this.getModelEvents().unsubscribe(e)},getModelEvents:function(){return this._modelEvents},_buildSkeleton:function(){var e=this;this.elements.container=UWA.createElement("div",{class:"PADPagerContainer"}),this.elements.topBarContainer=UWA.createElement("span",{class:"PADSelectionNavigatiorTopBar"}).inject(this.elements.container),this.elements.textInfo=UWA.createElement("div",{class:"PADPagerLabel wux-afr-label"}).inject(this.elements.topBarContainer),this.elements.navActions=UWA.createElement("span",{class:"PADSelectionNavigateActions"}).inject(this.elements.topBarContainer),this.elements.navBtnGrp=new l({}).inject(this.elements.navActions),this.elements.previousButton=new r({title:t.PADSearchView_previous,type:"standard",icon:{iconName:"chevron-up",fontIconFamily:1}}),this.elements.previousButton.getContent().addClassName("PADPager3DPreviousButton PADPager-controls-button"),this.elements.previousButtonTooltip=new c({target:this.elements.previousButton.elements.button,position:"bottom"}),this.elements.previousButtonTooltip.setBody(t.PADSearchView_previous),this.elements.nextButton=new r({title:t.PADSearchView_next,type:"standard",icon:{iconName:"chevron-down",fontIconFamily:1}}),this.elements.nextButton.getContent().addClassName("PADPager3DNextButton PADPager-controls-button"),this.elements.nextButtonTooltip=new c({target:this.elements.nextButton.elements.button,position:"bottom"}),this.elements.nextButtonTooltip.setBody(t.PADSearchView_next),this.elements.navBtnGrp.addChild(this.elements.previousButton),this.elements.navBtnGrp.addChild(this.elements.nextButton),this.elements.selectButton=new r({title:t.PADSearchView_select,type:"standard",icon:{iconName:"select-on",fontIconFamily:1}}).inject(this.elements.topBarContainer),this.elements.selectButton.getContent().addClassName("PADPager3DSelectButton PADPager-controls-button"),this.elements.selectButtonTooltip=new c({target:this.elements.selectButton.elements.button,position:"bottom"}),this.elements.selectButtonTooltip.setBody(t.PADSearchView_select),this.callbacks.onReframeAll&&(this.elements.reframeButton=new r({title:t.PADSearchView_reframe,type:"standard",icon:{iconName:"zoom-fit",fontIconFamily:1}}).inject(this.elements.topBarContainer),this.elements.reframeButton.getContent().addClassName("PADPager3DReframeButton PADPager-controls-button"),this.elements.reframeButtonTooltip=new c({target:this.elements.reframeButton.elements.button,position:"bottom"}),this.elements.reframeButtonTooltip.setBody(t.PADSearchView_reframe)),o.isMobileDevice()?(this.elements.selectButton.getContent().setStyle("margin-top","0px"),this.elements.reframeButton&&this.elements.reframeButton.getContent().setStyle("margin-top","0px"),this.elements.previousButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"previous"}),e._commandProxy.padPagerSync({operation:"previous"})}),this.elements.nextButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"next"}),e._commandProxy.padPagerSync({operation:"next"})}),this.elements.selectButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"selectAll"}),e._commandProxy.padPagerSync({operation:"selectAll"})}),this.elements.reframeButton&&this.elements.reframeButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"reframeAll"}),e._commandProxy.padPagerSync({operation:"reframeAll"})})):o.isTouchDevice()?(this.elements.previousButton.addEventListener("click",function(t){e.padPagerSync({operation:"previous"}),e._commandProxy.padPagerSync({operation:"previous"})}),this.elements.nextButton.addEventListener("click",function(t){e.padPagerSync({operation:"next"}),e._commandProxy.padPagerSync({operation:"next"})}),this.elements.selectButton.addEventListener("click",function(t){e.padPagerSync({operation:"selectAll"}),e._commandProxy.padPagerSync({operation:"selectAll"})}),this.elements.reframeButton&&this.elements.reframeButton.addEventListener("click",function(t){e.padPagerSync({operation:"reframeAll"}),e._commandProxy.padPagerSync({operation:"reframeAll"})}),this.elements.previousButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"previous"}),e._commandProxy.padPagerSync({operation:"previous"})}),this.elements.nextButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"next"}),e._commandProxy.padPagerSync({operation:"next"})}),this.elements.selectButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"selectAll"}),e._commandProxy.padPagerSync({operation:"selectAll"})}),this.elements.reframeButton&&this.elements.reframeButton.addEventListener("touchend",function(t){e.padPagerSync({operation:"reframeAll"}),e._commandProxy.padPagerSync({operation:"reframeAll"})})):(this.elements.previousButton.addEventListener("click",function(t){e.padPagerSync({operation:"previous"}),e._commandProxy.padPagerSync({operation:"previous"})}),this.elements.nextButton.addEventListener("click",function(t){e.padPagerSync({operation:"next"}),e._commandProxy.padPagerSync({operation:"next"})}),this.elements.reframeButton&&this.elements.reframeButton.addEventListener("click",function(t){e.padPagerSync({operation:"reframeAll"}),e._commandProxy.padPagerSync({operation:"reframeAll"})}),this.elements.selectButton.addEventListener("click",function(t){e.padPagerSync({operation:"selectAll"}),e._commandProxy.padPagerSync({operation:"selectAll"})})),this.elements.closeButton=UWA.createElement("span",{class:"fonticon fonticon-wrong PADPagerCloseButton","data-toggle":"tooltip","data-placement":"top",title:t.PADSearchView_close}).inject(this.elements.topBarContainer),o.isTouchDevice()&&this.elements.closeButton.addClassName("CloseButtonTouch"),this.elements.closeButton.addEventListener("click",function(t){let n={operation:"close",sharedID:o.getSharedId()};e._commandProxy.padPagerSync(n),e.padPagerSync(n)})},destroy:function(){this._commandProxy&&(this._commandProxy.padDestroy(),this._commandProxy.destroy(),delete this._commandProxy)}});return UWA.namespace("DS/PADUtils/commands/PADPager",d)}),define("DS/PADUtils/views/PADDnDInvite",["css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/Core/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Utils/Client","DS/PADUtils/PADContext","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADWebInWinServices","DS/PADUtils/PADUtilsServices"],function(e,t,n,i,o,s,a,r,l,c,d){"use strict";return i.extend(o,s,{name:"paddnd_invite",defaultOptions:{mode:"dynamic",invites:{drop:{nls:"drop",icon:"drag-drop"},add_in_context:{nls:"add_in_context",icon:"plus"},add_as_object:{nls:"add_as_object",icon:"plus"},insert:{icon:"plus",nls:"insert"},find:{icon:"search",nls:"find"}},active_invite:"drop",isTouchActivated:!1},init:function(e){switch(this._parent(e),this.options.isTouchActivated=l.getSetting("touchDropInvite")&&a.Features.touchEvents&&!a.Features.pointerEvents,this.options.isTouchActivated&&(this.options.invites.drop={nls:"add_as_object",icon:"touch"}),this.getMode()){case"none":break;case"drop_here":this._createDropHereInvite();break;case"dynamic":this._createDynamicInvite();break;case"inviteWithFilter":void 0===e.filterActive||!0===e.filterActive?this._createDynamicInvite(!0):this._createDynamicInvite(!1);break;default:console.warn("Unknown mode ["+this.getMode()+"]"),this._createDynamicInvite()}},_createDynamicInvite:function(e){var n=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames("_container")});var i=Object.getOwnPropertyNames(this.options.invites);if(this.elements.container.informationDiv=UWA.createElement("div",{class:this.getClassNames("_informationMain"),draggable:!1}),this.elements.container.informationDiv.inject(this.elements.container),this.options.isTouchActivated){this.elements.container.className+=" touch_look",this.elements.container.informationDiv.style.pointerEvents="auto",this.elements.container.informationDiv.addEventListener("touchend",function(e){require(["DS/ApplicationFrame/CommandsManager"],function(e){e.getCommand("AddRoot","Default").begin()})})}for(var o=0;o<i.length;o++){var s=i[o];this.elements.container[s]=UWA.createElement("div",{class:this.getClassNames("_display "+s),draggable:!1}),UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-"+this.options.invites[s].icon)}).inject(this.elements.container[s]),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+s),text:t["PADDropInvit_"+this.options.invites[s].nls]}).inject(this.elements.container[s]),this.elements.container[s].inject(this.elements.container.informationDiv),this.options.active_invite!==s&&this.elements.container[s].hide()}if(!0===e){this.elements.container.style.pointerEvents="auto",this.elements.container.addEventListener("dragover",function(e){return e.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation(),!1});var a=0;this.elements.container.addEventListener("dragenter",function(e){require("DS/PADUtils/PADSession").determineAuthoredFlag()?(n.elements.container.removeClassName("withFilterOpen"),n.elements.container.filterDiv.style.display="none"):(e.preventDefault(),e.stopPropagation(),a++,n.elements.container.addClassName("withFilterOpen"),n.elements.container.filterDiv.style.display="block")}),this.elements.container.addEventListener("dragleave",function(e){if(!1===require("DS/PADUtils/PADSession").determineAuthoredFlag())return e.preventDefault(),e.stopPropagation(),--a<=0&&(n.elements.container.removeClassName("withFilterOpen"),n.elements.container.filterDiv.style.display="none",a=0),!1}),this.elements.container.addEventListener("drop",function(e){return a=0,!1===require("DS/PADUtils/PADSession").determineAuthoredFlag()&&(n.elements.container.removeClassName("withFilterOpen"),n.elements.container.filterDiv.style.display="none"),UWA.is(n.options.dropOnInvite,"function")&&(l.setSetting("changeControlDlgOpen",!0),n.options.dropOnInvite(e)),!1}),this.elements.container.filterDiv=UWA.createElement("div",{class:this.getClassNames("_filterMain"),draggable:!1}),this.elements.container.filterDiv.style.display="none",this.elements.container.filterDiv.inject(this.elements.container);s="filter";this.elements.container[s]=UWA.createElement("div",{class:this.getClassNames("_display "+s)}),UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-5x wux-ui-3ds-filter")}).inject(this.elements.container[s]),UWA.createElement("h5",{class:this.getClassNames("_txt font-3dsregular "+s),text:t.PADDropInvit_filter}).inject(this.elements.container[s]),this.elements.container[s].inject(this.elements.container.filterDiv);var r=function(e){a=0,this._dropFilterCB(e)}.bind(this);this.elements.container.filterDiv.addEventListener("dragover",function(e){return e.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation(),!1}),this.elements.container.filterDiv.addEventListener("drop",r)}else UWA.is(n.options.dropOnInvite,"function")&&(this.elements.container.addEventListener("dragover",function(e){return e.preventDefault(),e.stopPropagation(),!1}),this.elements.container.addEventListener("drop",function(e){return n.options.dropOnInvite(e),!1}));this.getOption("renderTo")&&this.elements.container.inject(this.getOption("renderTo"))},_dropFilterCB:function(e){e.preventDefault(),e.stopPropagation(),this.elements.container.removeClassName("withFilterOpen"),this.elements.container.filterDiv.style.display="none";var t=r.get();if(e.dataTransfer.files&&e.dataTransfer.files.length>0){var n=t?t.options.model:null;return n&&0===n.getRoots().length?this.show("drop"):this.hide(),!1}let i=!1;t&&t.publish?t.publish({event:"onFilterDropped"}):i=!0;var o=d.deserializeDroppedData(e);return require(["DS/ApplicationFrame/CommandsManager"],function(e){var n=e.getCommand("FilterDropObjects","function"==typeof t.getCommandContext?t.getCommandContext():null);if(n)if(i){let e={isWP:!1,fromProxy:!1,loadWithFilter:!0};n.execute(o,e)}else n.execute(o);else console.error("PADDnDInvite : _dropFilterCB() - The command PAD3DViewerFilterDropObjectsHdr is undefined");this.hide()}.bind(this)),!1},_createDropHereInvite:function(){this.elements.container=UWA.createElement("div",{class:this.getClassNames("_drop_here"),draggable:!1}),UWA.createElement("i",{class:this.getClassNames("_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-drag-drop")}).inject(this.elements.container),UWA.createElement("h5",{class:this.getClassNames("_txt drop_here"),text:t.PADDropInvit_drop_here}).inject(this.elements.container),this.getOption("renderTo")&&this.elements.container.inject(this.getOption("renderTo"))},show:function(e){switch(this.getMode()){case"none":break;case"drop_here":"drop"===e?(this.elements.container.show(),this.dispatchEvent("toggleInvite",!0)):"block"===this.elements.container.getStyle("display")&&(this.elements.container.hide(),this.dispatchEvent("toggleInvite",!0));break;default:this.options.active_invite!==e&&(UWA.is(e,"string")?(this.options.active_invite!==e&&""!==this.options.active_invite&&this.elements.container[this.options.active_invite].hide(),this.options.active_invite=e):this.options.active_invite="drop","drop"===this.options.active_invite?this.elements.container.informationDiv.style.pointerEvents="auto":this.elements.container.informationDiv.style.pointerEvents="none",this.elements.container[this.options.active_invite].show(),this.elements.container.show(),this.dispatchEvent("toggleInvite",!0))}},hide:function(e){switch(this.getMode()){case"none":this.options.active_invite="";break;case"drop_here":"block"===this.elements.container.getStyle("display")&&(this.elements.container.hide(),this.dispatchEvent("toggleInvite",!0));break;default:UWA.is(e,"string")?""!==this.options.active_invite&&this.options.active_invite===e&&(this.elements.container[this.options.active_invite].hide(),this.elements.container.hide()):""!==this.options.active_invite&&(this.elements.container[this.options.active_invite].hide(),this.elements.container.hide()),this.options.active_invite="",this.dispatchEvent("toggleInvite",!1)}},getMode:function(){return c.isWebInWinContext()?"none":this.options.mode},isEventInside:function(e){if("none"===this.getMode())return!1;var t,n,i,o,s,a=(n=0,i=0,(t=e).pageX||t.pageY?(n=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(n=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:n,y:i});if(!this.elements.container.isHidden()){var r=this.elements.container.getBoundingClientRect();if((o=a).y>=(s=r).top&&o.y<=s.bottom&&o.x>=s.left&&o.x<=s.right)return!0}return!1}})}),define("DS/PADUtils/views/PADStatusInfos",["css!DS/PADUtils/PADUtils","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Drivers/Alone","DS/Logger/Logger","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/UIKIT/Tooltip","DS/Controls/Loader","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],function(e,t,n,i,o,s,a,r,l,c,d){"use strict";var u=n.extend(i,{name:"pad_status",_logger:null,_tooltipInfo:null,init:function(e){this._logger=s.getLogger(u),this._logger.log("init"),this._parent(e),e.withProgress?(this.elements.container=UWA.createElement("div",{class:this.getClassNames()+" with_progress"}),this.elements.loaderContainer=UWA.createElement("div",{class:"pad_status_loader_div"}).inject(this.elements.container),this._loader=(new l).inject(this.elements.loaderContainer),this.elements.fonticonInfoContainer=UWA.createElement("div",{class:"pad_status_fonticon_info_div"}).inject(this.elements.container),this.elements.fonticonInfo=UWA.createElement("i",{class:"fonticon fonticon-info pad_status_span"}).inject(this.elements.fonticonInfoContainer),this._tooltipInfo=new r({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top",trigger:"touch",events:e.events}),this.elements.fonticonAttentionContainer=UWA.createElement("div",{class:"pad_status_fonticon_attention_div"}).inject(this.elements.container),this.elements.fonticonAttention=UWA.createElement("i",{class:"fonticon fonticon-attention pad_status_span"}).inject(this.elements.fonticonAttentionContainer),this._tooltipAttention=new r({className:this.getClassNames("_tooltipAttention"),target:this.elements.fonticonAttention,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo")),this.getOption("attention")&&this._tooltipAttention.setBody(this.getOption("attention")),this.showLoader=function(e){if(e){var t=this;this._isloading=!0,t._loadingText=e.nlsTooltip,setTimeout(function(){!0===t._isloading&&t._loader&&(t._loader.on(),t.elements.fonticonInfoContainer.style.display="",t.elements.fonticonAttentionContainer.style.display="none",e.fonticon&&(t._replacedFonticon=e.fonticon,t.elements.fonticonInfo.removeClassName("fonticon-info"),t.elements.fonticonInfo.addClassName(e.fonticon)),t._addLoading(),!1===t._tooltipInfo.isVisible&&t._tooltipInfo.toggle())},e.timeout?e.timeout:0)}else this._loader&&(this._loader.on(),this.elements.fonticonInfoContainer.style.display="",this.elements.fonticonAttentionContainer.style.display="none")},this.hideLoader=function(e){this._isloading=!1,this._loader&&(this._loader.off(),e&&!0===e.memoryFull&&(this.elements.fonticonAttentionContainer.style.display="",this.elements.fonticonInfoContainer.style.display="none")),!0===this._tooltipInfo.isVisible&&this._tooltipInfo.toggle(),this.elements.fonticonInfo.addClassName("fonticon-info"),this.elements.fonticonInfo.removeClassName(this._replacedFonticon),this._removeLoading()},this.elements.fonticonAttentionContainer.style.display="none"):(this.elements.container=UWA.createElement("span",{class:this.getClassNames()+" fonticon fonticon-info"}),this._tooltipInfo=new r({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo")))},setStatus:function(e){this._tooltipInfo.setBody(e),this._isloading&&this._addLoading()},_addLoading:function(){var e=this._tooltipInfo.getBody(),t=UWA.createElement("div",{id:"loadingTooltip",text:this._loadingText});null===e.querySelector("loadingTooltip")&&t.inject(e)},_removeLoading:function(){var e=this._tooltipInfo.getBody().querySelector("loadingTooltip");null!==e&&e.remove(e)}});return u.buildStatus=function(e){var t=UWA.createElement("div",{class:"pad_status_msg"});if(e.tree_content){if(!UWA.is(e.tree_content.nbObjectsSelected))throw new Error("Invalid status. Parameter nbObjectsSelected missing");void 0!==e.tree_content.nbObjectsInTree?e.tree_content.nbObjectsInTree>0?(1===e.tree_content.nbObjectsInTree?UWA.createElement("div",{text:a.PADStatusInfos_oneObjectInTree}).inject(t):UWA.createElement("div",{text:e.tree_content.nbObjectsInTree+a.PADStatusInfos_nbObjectsInTree}).inject(t),UWA.createElement("div",{text:e.tree_content.nbObjectsSelected+a.PADStatusInfos_nbObjectsSelected}).inject(t)):UWA.createElement("div",{text:a.PADStatusInfos_noObjectInTree}).inject(t):null!=e.tree_content.nbObjectsSelected?UWA.createElement("div",{text:e.tree_content.nbObjectsSelected+a.PADStatusInfos_nbObjectsSelected}).inject(t):UWA.createElement("div",{text:a.PADStatusInfos_noObjectInTree}).inject(t);var n=d.isAuthoring()?a.PADStatusInfos_authoringModeEnabled:a.PADStatusInfos_authoringModeDisabled;UWA.createElement("div",{text:n,style:"border-top: 1px;"}).inject(t)}var i=c.getTenantsPreference();return e.Tenant&&i.length>1&&UWA.createElement("div",{text:a.PADStatusInfos_Tenant+e.Tenant}).inject(t),t},u}),define("DS/PADUtils/views/PADStatusBar",["css!DS/PADUtils/PADUtils","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Drivers/Alone","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/UIKIT/Tooltip","DS/Controls/ProgressBar","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADUtilsServices"],function(e,t,n,i,o,s,a,r,l,c,d){"use strict";return n.extend(i,{name:"pad_status",_tooltipInfo:null,_latestNotification:null,_icons:["filter","change","info","warning","error","latestNotification","perfoDebug"],_previousLabel:null,_isPaused:!1,_isFreezed:!1,init:function(e){this._parent(e),this._tooltipCBForTouch=function(){this&&this.toggle()},this._onDragEvent=e.onDragEvent;var t=d.isTouchDevice()?" touch-mode":"";this.elements.container=UWA.createElement("div",{class:"pad_status_footer"+t}),this.elements.container.dataset.open=!0,this.elements.footerLeft=new UWA.Element("div",{class:"pad_status_footer_left"}).inject(this.elements.container),this.elements.selectionTextContainer=UWA.createElement("div",{class:"pad_status_footer_selection_text_container"}).inject(this.elements.footerLeft),this.elements.selectionText=UWA.createElement("span",{class:"selection_text"}).inject(this.elements.selectionTextContainer);this.elements.selectionText.innerHTML='<span class="fonticon fonticon-select-off"></span>',this._selectionTooltip=new r({target:this.elements.selectionText,position:"top left"}),this._selectionTooltip.setBody(s.PADStatusInfos_noSelection),e.withLoader&&(this.elements.loaderContainer=UWA.createElement("div",{class:"pad_status_footer_loader_container"}).inject(this.elements.footerLeft),this.elements.loaderFeedbackIcon=UWA.createElement("span",{}).inject(this.elements.loaderContainer),this.elements.progressbarContainer=UWA.createElement("div",{class:"pad_status_footer_progress_bar hidden"}).inject(this.elements.loaderContainer),this._progressBar=UWA.createElement("div",{class:"pad_status_footer_progress_loader"}).inject(this.elements.progressbarContainer),this._progressBar.classList.add("hidden"),this.elements.progressbarLabel=UWA.createElement("div",{class:"pad_status_footer_progress_label"}).inject(this.elements.loaderContainer),this.elements.progressbarLabel.innerHTML="",d.isTouchDevice()||(this.elements.progressbarLabel.innerHTML=s.PADStatus_readyToLoad),this.elements.playPause3DloadingFonticonContainer=UWA.createElement("div",{class:"pad_status_footer_play_button_container",events:{click:function(){this._isFreezed||("play"===this.elements.playPause3DloadingFonticonContainer.status?(e.onPause(),this.pause()):(e.onPlay(),this.resume()))}.bind(this)}}).inject(this.elements.loaderContainer),this.elements.playPause3DloadingFonticon=UWA.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-pause pad_status_font_icon pad_status_fonticon_playPause3Dloading"}).inject(this.elements.playPause3DloadingFonticonContainer),this.elements.playPause3DloadingFonticonContainer.status="play",this._playPause3DloadingFonticonTooltip=new r({target:this.elements.playPause3DloadingFonticonContainer,position:"top left"}),this._playPause3DloadingFonticonTooltip.setBody(s.PADStatusInfos_lock3DLoadingTooltip),d.isTouchDevice()&&this._playPause3DloadingFonticonTooltip.options.target.addEventListener("touchend",this._tooltipCBForTouch.bind(this._playPause3DloadingFonticonTooltip))),this.elements.infoContainer=UWA.createElement("div",{class:"pad_status_footer_right"}).inject(this.elements.container);for(var n=this._icons.length-1;n>=0;--n)switch(this._icons[n]){case"change":this.elements.changeFonticonContainer=UWA.createElement("div",{class:"hidden"+t}).inject(this.elements.infoContainer),this.elements.changeFonticon=UWA.createElement("span",{class:"fonticon fonticon fonticon-change-action-workunder pad_status_font_icon pad_status_fonticon_change empty"}).inject(this.elements.changeFonticonContainer);break;case"info":this.elements.infoFonticonContainer=UWA.createElement("div",{class:"hidden"+t}).inject(this.elements.infoContainer),this.elements.infoFonticon=UWA.createElement("span",{class:"fonticon fonticon-info pad_status_font_icon pad_status_fonticon_info empty"}).inject(this.elements.infoFonticonContainer);break;case"warning":this.elements.warningFonticonContainer=UWA.createElement("div",{class:"hidden"+t}).inject(this.elements.infoContainer),this.elements.warningFonticon=UWA.createElement("span",{class:"fonticon fonticon-attention pad_status_font_icon pad_status_fonticon_warning empty"}).inject(this.elements.warningFonticonContainer);break;case"error":this.elements.errorFonticonContainer=UWA.createElement("div",{class:"hidden"+t}).inject(this.elements.infoContainer),this.elements.errorFonticon=UWA.createElement("span",{class:"fonticon fonticon-alert pad_status_font_icon pad_status_fonticon_error empty"}).inject(this.elements.errorFonticonContainer);break;case"filter":this.elements.filterFonticonContainer=UWA.createElement("div",{class:"hidden"+t}).inject(this.elements.infoContainer),this.elements.filterFonticon=UWA.createElement("span",{class:"fonticon fonticon-filter pad_status_font_icon pad_status_fonticon_filter empty"}).inject(this.elements.filterFonticonContainer);break;case"latestNotification":var i=this;this.elements.latestNotificationFonticonContainer=UWA.createElement("div",{class:"hidden"+t}).inject(this.elements.infoContainer),this.elements.latestNotificationFonticon=UWA.createElement("span",{class:"fonticon fonticon-bell-alt pad_status_font_icon pad_status_fonticon_latestNotification empty",events:{click:function(){require(["DS/PADUtils/views/PADAlert"],function(e){i._latestNotification&&e.displayNotification(i._latestNotification),d.isTouchDevice()&&(i.elements.latestNotificationFonticon.removeClassName("new"),i._latestNotification?i.elements.latestNotificationFonticon.addClassName("old"):i.elements.latestNotificationFonticon.addClassName("empty"))})}}}).inject(this.elements.latestNotificationFonticonContainer),this._latestNotificationTooltip=new r({target:this.elements.latestNotificationFonticonContainer,position:"top right",events:{onHide:function(){i.elements.latestNotificationFonticon.removeClassName("new"),i._latestNotification?i.elements.latestNotificationFonticon.addClassName("old"):i.elements.latestNotificationFonticon.addClassName("empty")}}}),this._latestNotificationTooltip.setBody(s.PADStatusInfos_showLatestNotification),d.isTouchDevice()&&this._latestNotificationTooltip.options.target.addEventListener("touchend",this._tooltipCBForTouch.bind(this._latestNotificationTooltip));break;case"perfoDebug":if(e.onPerfoClicked&&e.perfoDebug){i=this;this.elements.perfoDebugFonticonContainer=UWA.createElement("div",{class:"pad_status_perfo_icon"+t,styles:"cursor: pointer;"}).inject(this.elements.infoContainer),this.elements.perfoDebugFonticon=UWA.createElement("span",{class:"fonticon fonticon-chart-gauge-angular pad_status_font_icon",events:{click:function(){e.onPerfoClicked()}}}).inject(this.elements.perfoDebugFonticonContainer),this._perfoDebugTooltip=new r({target:this.elements.perfoDebugFonticonContainer,position:"top right"}),this._perfoDebugTooltip.setBody(s.PADStatusInfos_debugPerformance),d.isTouchDevice()&&this._perfoDebugTooltip.options.target.addEventListener("touchend",this._tooltipCBForTouch.bind(this._perfoDebugTooltip))}}this.getOption("renderTo")&&this.inject(this.getOption("renderTo"))},destroy:function(){a.removeEvent("onX3dPlatformId")},setLoader:function(e){e&&"on"===e.status?(this.resetProgressLabel(),this._progressBar&&(this._progressBar.classList.remove("hidden"),this.elements.progressbarContainer&&this.elements.progressbarContainer.classList.contains("hidden")&&this.elements.progressbarContainer.classList.remove("hidden"))):e&&"off"===e.status?(this.resetProgressLabel(),this._progressBar&&(this._progressBar.classList.add("hidden"),this.elements.progressbarContainer&&this.elements.progressbarContainer.classList.add("hidden"))):e&&"show"===e.status?this.elements.progressbarContainer&&!this._progressBar.classList.contains("hidden")&&this.elements.progressbarContainer.classList.remove("hidden"):e&&"hide"===e.status&&this.elements.progressbarContainer&&this.elements.progressbarContainer.classList.add("hidden")},setProgressLabel:function(e){!0===this._isPaused?this._previousLabel=e:this.elements.progressbarLabel.innerHTML=e},setCustomProgressLabel:function(e){if(e&&e.label&&e.tooltip&&e.severity){switch(this.elements.loaderFeedbackIcon.className="pad_status_loader_fedback fonticon",e.severity){case"warning":this.elements.loaderFeedbackIcon.classList.add("fonticon-attention");break;case"error":this.elements.loaderFeedbackIcon.classList.add("fonticon-alert");break;case"info":this.elements.loaderFeedbackIcon.classList.add("fonticon-info");break;case"success":this.elements.loaderFeedbackIcon.classList.add("fonticon-check");break;default:this.elements.loaderFeedbackIcon.classList.add("fonticon-info")}!0===this._isPaused?(this._previousLabel=UWA.createElement("div",{class:"pad_status_footer_progress_label"}),this._previousLabel=e.label):(this.elements.progressbarLabel.innerHTML="",this.elements.progressbarLabel.innerHTML=e.label),this._progressLabelTooltip&&this._progressLabelTooltip.destroy(),this._progressLabelTooltip=new r({target:this.elements.loaderFeedbackIcon,position:"left"}),this._progressLabelTooltip.setBody(e.tooltip),d.isTouchDevice()&&this._progressLabelTooltip.options.target.addEventListener("touchend",this._tooltipCBForTouch.bind(this._progressLabelTooltip))}},pauseProgresslabel:function(){this._previousLabel=this.elements.progressbarLabel.innerHTML,this.elements.progressbarLabel.innerHTML=s.PADStatus_loadingPaused},restorePreviousLabel:function(){this.elements.progressbarLabel.innerHTML=this._previousLabel},resetPreviousLabel:function(){this._previousLabel=s.PADStatus_readyToLoad},resetProgressLabel:function(){this.elements.loaderFeedbackIcon.className="",!1===this._isPaused&&(this.elements.progressbarLabel.innerHTML=s.PADStatus_readyToLoad,this._progressLabelTooltip&&(d.isTouchDevice()&&this._progressLabelTooltip.options.target.removeEventListener("touchend",this._tooltipCBForTouch),this._progressLabelTooltip.destroy(),this._progressLabelTooltip=null))},pause:function(){this._isFreezed||(this._isPaused=!0,this.elements.playPause3DloadingFonticonContainer.status="pause",this.elements.playPause3DloadingFonticon.removeClassName("wux-ui-3ds-pause"),this.elements.playPause3DloadingFonticon.addClassName("wux-ui-3ds-play"),this._playPause3DloadingFonticonTooltip.setBody(s.PADStatusInfos_unlock3DLoadingTooltip),this.setLoader({status:"hide"}))},resume:function(){this._isFreezed||(this._isPaused=!1,this.elements.playPause3DloadingFonticonContainer.locked=!1,this.elements.playPause3DloadingFonticonContainer.status="play",this.elements.playPause3DloadingFonticon.removeClassName("wux-ui-3ds-play"),this.elements.playPause3DloadingFonticon.addClassName("wux-ui-3ds-pause"),this._playPause3DloadingFonticonTooltip.setBody(s.PADStatusInfos_lock3DLoadingTooltip),this.setLoader({status:"show"}))},enableProgress:function(){this._isFreezed=!1,this.resume(),this.elements.progressbarLabel.innerHTML=this._previousLabel,this.elements.playPause3DloadingFonticonContainer.classList.remove("freezed")},disableProgress:function(){this.pause(),this._isFreezed=!0,this._previousLabel=this.elements.progressbarLabel.innerHTML,this.elements.progressbarLabel.innerHTML=s.PADStatus_loadingFreezed,this.elements.playPause3DloadingFonticonContainer.classList.add("freezed")},setError:function(e){if(e&&e.message){this.elements.errorFonticon.addClassName("new"),this._errorTooltip&&(this._errorTooltip.destroy(),this._errorTooltip=null);var t=this;this._errorTooltip=new r({target:this.elements.errorFonticonContainer,position:"top right",events:{onHide:function(){t.elements.errorFonticon.removeClassName("new"),t.elements.errorFonticon.addClassName("old")}}}),this._errorTooltip.setBody(e.message),this.elements.errorFonticonContainer.removeClassName("hidden"),d.isTouchDevice()&&this.elements.errorFonticonContainer.addEventListener("touchend",this._tooltipCBForTouch.bind(this._errorTooltip))}},clearError:function(){this.elements.errorFonticonContainer.addClassName("hidden"),this.elements.errorFonticon.removeClassName("new"),this.elements.errorFonticon.removeClassName("old"),this._errorTooltip&&(this._errorTooltip.destroy(),this._errorTooltip=null,d.isTouchDevice()&&this.elements.errorFonticon.removeEventListener("touchend",this._tooltipCBForTouch))},setWarning:function(e){if(e&&e.message){this.elements.warningFonticon.addClassName("new"),this._warningTooltip&&(this._warningTooltip.destroy(),this._warningTooltip=null);var t=this;this._warningTooltip=new r({target:this.elements.warningFonticonContainer,position:"top right",events:{onHide:function(){t.elements.warningFonticon.removeClassName("new"),t.elements.warningFonticon.addClassName("old")}}}),this._warningTooltip.setBody(e.message),this.elements.warningFonticonContainer.removeClassName("hidden"),d.isTouchDevice()&&this.elements.warningFonticonContainer.addEventListener("touchend",this._tooltipCBForTouch.bind(this._warningTooltip))}},clearWarning:function(){this.elements.warningFonticonContainer.addClassName("hidden"),this.elements.warningFonticon.removeClassName("new"),this.elements.warningFonticon.removeClassName("old"),this._warningTooltip&&(this._warningTooltip.destroy(),this._warningTooltip=null,d.isTouchDevice()&&this.elements.warningFonticon.removeEventListener("touchend",this._tooltipCBForTouch))},setChange:function(e){if(e&&e.message){this.elements.changeFonticon.addClassName("new"),this._changeTooltip&&(this._changeTooltip.destroy(),this._changeTooltip=null);var t=this;this._changeTooltip=new r({target:this.elements.changeFonticonContainer,position:"top right",events:{onHide:function(){t.elements.changeFonticon.removeClassName("new"),t.elements.changeFonticon.addClassName("old")}}}),this._changeTooltip.setBody(e.message),this.elements.changeFonticonContainer.removeClassName("hidden"),d.isTouchDevice()&&this.elements.changeFonticonContainer.addEventListener("touchend",this._tooltipCBForTouch.bind(this._changeTooltip))}},clearChange:function(){this.elements.changeFonticonContainer.addClassName("hidden"),this.elements.changeFonticon.removeClassName("new"),this.elements.changeFonticon.removeClassName("old"),this._changeTooltip&&(this._changeTooltip.destroy(),this._changeTooltip=null,d.isTouchDevice()&&this.elements.changeFonticon.removeEventListener("touchend",this._tooltipCBForTouch))},setSelection:function(e){if(e&&e.length){this.elements.selectionText.innerHTML='<span class="fonticon fonticon-select-on"></span>'+e.length,!0===a.getSetting("padstatusbar_allowSelectionDragging")&&(this.elements.selectionText.classList.add("has-selection"),this.elements.selectionText.parentNode.setAttribute("draggable",!0),this.elements.selectionText.parentNode.addEventListener("dragstart",this._onDragEvent)),this._selectionTooltip&&(this._selectionTooltip.destroy(),this._selectionTooltip=null),this._selectionTooltip=new r({target:this.elements.selectionText,position:"top left"}),this._selectionTooltip.setBody(e.length+s.PADStatusInfos_nbObjectsSelected),d.isTouchDevice()&&this.elements.selectionText.addEventListener("touchend",this._tooltipCBForTouch.bind(this._selectionTooltip))}},clearSelection:function(e){this.elements.selectionText.innerHTML='<span class="fonticon fonticon-select-off"></span>',!0===a.getSetting("padstatusbar_allowSelectionDragging")&&(this.elements.selectionText.classList.remove("has-selection"),this.elements.selectionText.parentNode.removeAttribute("draggable"),this.elements.selectionText.parentNode.removeEventListener("dragstart",this._onDragEvent)),this._selectionTooltip&&(this._selectionTooltip.setBody(s.PADStatusInfos_noSelection),d.isTouchDevice()&&this.elements.selectionText.removeEventListener("touchend",this._tooltipCBForTouch))},setInfo:function(e){if(e&&e.message){this.elements.infoFonticon.addClassName("new"),this._infoTooltip&&(this._infoTooltip.destroy(),this._infoTooltip=null);var t=this;this._infoTooltip=new r({target:this.elements.infoFonticonContainer,position:"top right",events:{onHide:function(){t.elements.infoFonticon.removeClassName("new"),t.elements.infoFonticon.addClassName("old")}}}),this._infoTooltip.setBody(e.message),this.elements.infoFonticonContainer.removeClassName("hidden"),d.isTouchDevice()&&this.elements.infoFonticonContainer.addEventListener("touchend",this._tooltipCBForTouch.bind(this._infoTooltip))}},clearInfo:function(){this.elements.infoFonticonContainer.addClassName("hidden"),this.elements.infoFonticon.removeClassName("old"),this.elements.infoFonticon.removeClassName("new"),this._infoTooltip&&(this._infoTooltip.destroy(),this._infoTooltip=null,d.isTouchDevice()&&this.elements.infoFonticon.removeEventListener("touchend",this._tooltipCBForTouch))},setFilter:function(e){if(e&&e.message){this.elements.filterFonticon.addClassName("new"),this._filterTooltip||(this._filterTooltip=new r({target:this.elements.filterFonticonContainer,position:"top right",events:{onHide:function(){this.elements.filterFonticon.removeClassName("new"),this.elements.filterFonticon.addClassName("old")}.bind(this)}}),this._filterTooltip.elements.body.innerHTML="");for(var t=!1,n=this._filterTooltip.elements.body,i=0;i<n.children.length;++i)n.children[i].id==="statusbar-filter-"+e.id&&(t=!0);if(!1===t){var o=c.getWebappsAssetUrl("ENOPAD3DViewer","icons/32/I_DefineFilter.png"),s='<div id="statusbar-filter-'+e.id+'" class="filter-tooltip"><img src="'+o+'" /><p>'+e.message+"</p></div>";this._filterTooltip.elements.body.innerHTML+=s,this.elements.filterFonticonContainer.removeClassName("hidden"),this.elements.filterFonticonContainer.addEventListener("click",this._tooltipCBForTouch.bind(this._filterTooltip)),d.isTouchDevice()&&this.elements.filterFonticonContainer.addEventListener("touchend",this._tooltipCBForTouch.bind(this._filterTooltip))}}},clearFilter:function(e){var t=function(){this.elements.filterFonticonContainer.addClassName("hidden"),this.elements.filterFonticon.removeClassName("old"),this.elements.filterFonticon.removeClassName("new"),this._filterTooltip&&(this._filterTooltip.destroy(),this._filterTooltip=null,d.isTouchDevice()&&this.elements.filterFonticon.removeEventListener("touchend",this._tooltipCBForTouch))}.bind(this),n=function(e){if(this._filterTooltip){for(var n=this._filterTooltip.elements.body,i=n.children.length-1;i>=0;--i)n.children[i].id==="statusbar-filter-"+e&&n.removeChild(n.children[i]);0===n.children.length&&t()}}.bind(this);if(e&&e.id)n(e.id);else if(e&&e.ids)for(var i=0;i<e.ids.length;++i)n(e.ids[i]);else t()},setLatestNotification:function(e){e&&e.notification&&(this.elements.latestNotificationFonticon.addClassName("new"),this._latestNotification=e.notification),this.elements.latestNotificationFonticonContainer.removeClassName("hidden")},clearLatestNotification:function(){this.elements.latestNotificationFonticonContainer.addClassName("hidden"),this.elements.latestNotificationFonticon.removeClassName("new"),this.elements.latestNotificationFonticon.removeClassName("old"),this._latestNotification=null},toggle:function(){"true"===this.elements.container.dataset.open?this.close():this.open()},open:function(){this.elements.container.classList.remove("closed"),this.elements.container.dataset.open=!0,this.elements.container.style.display="block"},close:function(){this.elements.container.classList.add("closed"),this.elements.container.dataset.open=!1,this.elements.container.style.display="none"},setIsPaused:function(e){this._isPaused=e}})}),define("DS/PADUtils/commands/PADOpenInCADBaseCmd",["DS/ApplicationFrame/Command","DS/PlatformAPI/PlatformAPI","DS/PADUtils/PADWebInWinServices"],function(e,t,n){"use strict";return e.extend({_context:null,init:function(e){this._parent(e),"undefined"!=typeof widget&&(this._context=widget.getValue("addinmode"))},getSelection:function(e){console.error("This method must be overloaded to give your selection back"),console.error("Data given in input of the callback must respect 'setTypes' schema")},execute:function(){this.getSelection(function(e){UWA.is(e.setObject,"object")?t.publish("webinwin:web:notification",JSON.stringify({operation:"open/setObject",operationVersion:"1.0",content:[{phid:e.setObject.objectId}]})):t.publish("webinwin:web:notification",JSON.stringify({operation:"open/setTypes",operationVersion:"1.0",content:e}))})},isAvailable:function(){return n.isWebInWinContext()}})}),define("DS/PADUtils/commands/PADOpenInCAD",["text!DS/PADUtils/assets/PADOpenCommandsSettings.json","DS/ApplicationFrame/Command","DS/PADUtils/commands/PADOpenInCADBaseCmd","DS/PADUtils/PADContext","DS/PADUtils/PADDataTransform","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","require"],function(e,t,n,i,o,s,a,r){"use strict";return n.extend({init:function(e){this._parent(e)},getSelection:function(t){var n,l=i.get().getPADTreeDocument().getSelectedNodesForOFW(),c=JSON.parse(e),d=null==c["openInCAD_"+this._context+"_expand_at_open"]||c["openInCAD_"+this._context+"_expand_at_open"];if(a.isAuthoringCtxAvailable())try{n=r("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").get()}catch(e){console.warn("CfgAuthoringContext throw an error")}if("catiav5"!==this._context||1!==l.length||!l[0].isRoot()||UWA.is(l[0].options.config_filter)||UWA.is(l[0].options.sequence_filter)||UWA.is(n)&&""!==n.change.id||!0!==s.getSetting("directOpenPCS"))o.buildDataForSetTypes(l,i.get().getPADTreeDocument(),function(e,n){t(n)},d);else{l[0].getID(),a.getPlatformId(),s.getSetting("pad_security_ctx");var u={setObject:{objectId:l[0].getID(),envId:a.getPlatformId(),contextId:s.getSetting("pad_security_ctx")}};t(u)}}})}),define("DS/PADUtils/PADTypesMgt",["i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/PADAlert"],function(e,t,n,i){"use strict";var o={},s={authorized_types:[],type_kind:{},type_kind_setting:{},types_hierarchies:{},displayNotification:function(t,n){i.displayNotification({msg:e.replace(e.get("unsupported_type"),{type:t,name:n||""}),eventID:"warning"})},retrieveKind:function(e){var t;for(var n in s.type_kind)if(-1!==s.type_kind[n].indexOf(e)){t=n;break}if(!t){for(var i in s.type_kind_setting)if(-1!==s.type_kind_setting[i].indexOf(e)){t=i,s.type_kind[i]||(s.type_kind[i]=[]),s.type_kind[i].includes(e)||s.type_kind[i].push(e);break}t||(t="Product")}return t}};return o.isTypesAuthorized=function(e,n,i,o,a){var r=[],l=[],c={},d=t.getSetting("authorized_root_types");s.type_kind_setting=t.getSetting("type_kind");var u={},p=!0===o?[]:t.getSetting("unsupported_root_types");p||(p=[]),e.forEach(function(e){if(-1!==s.authorized_types.indexOf(e.type)||-1!==d.indexOf(e.type)){if(r.push(e.type),"2.0"===a){u.supportedTypes||(u.supportedTypes={});var t=s.retrieveKind(e.type);t?(u.supportedTypes[t]||(u.supportedTypes[t]=[]),u.supportedTypes[t].push(e.type),s.type_kind[t]||(s.type_kind[t]=[]),s.type_kind[t].push(e.type)):(u.supportedTypes.Product||(u.supportedTypes.Product=[]),u.supportedTypes.Product.push(e.type),s.type_kind.Product||(s.type_kind.Product=[]),s.type_kind.Product.push(e.type))}}else l.push(e.type),c[e.type]=e.displayType}),console.debug("process unknown_types",l),l.length?require(["DS/PADUtils/PADWSAccess"],function(e){e.getTypesHierarchy({types:l,onComplete:function(e){var t=!1;(UWA.is(e,"string")?JSON.parse(e):e).types_hierarchies.forEach(function(e){let n=e.type;s.types_hierarchies[n]||(s.types_hierarchies[n]=e.hierarchy,s.types_hierarchies[n].push(n));for(var l,h=!1,g=0;g<e.hierarchy.length&&!1===h;g++){let t=e.hierarchy[g];if(-1!==d.indexOf(e.hierarchy[g]))if(-1!==p.indexOf(n))h=!1;else{h=!0,l=t;let e=s.retrieveKind(l);e&&(console.debug(n," add to ",e),s.type_kind[e]||(s.type_kind[e]=[]),s.type_kind[e].includes(n)||s.type_kind[e].push(n))}}if(!0===h){if(!0!==o&&s.authorized_types.push(e.type),r.push(e.type),"2.0"===a){u.supportedTypes||(u.supportedTypes={});var f=s.retrieveKind(l);f?(u.supportedTypes[f]||(u.supportedTypes[f]=[]),u.supportedTypes[f].includes(e.type)||u.supportedTypes[f].push(e.type),s.type_kind[f]||(s.type_kind[f]=[]),s.type_kind[f].includes(e.typ)||s.type_kind[f].push(e.typ)):(u.supportedTypes.Product||(u.supportedTypes.Product=[]),u.supportedTypes.Product.push(e.type),s.type_kind.Product||(s.type_kind.Product=[]),s.type_kind.Product.push(l))}}else i&&(s.displayNotification(c[e.type],""),t=!0)}),t&&(u.unsupportedDropNotified=!0),n(r,u)},onFailure:function(e){n(r,u)}})}):n(r,u)},o.retrieveAuthorizedObjects=function(a){var r;r=a.X3DContentId?a.X3DContentId:a.unserializedData?a.unserializedData:n.deserializeDroppedData(a.dnd_event);var l=[],c={authorized_objects:[],unauthorized_objects:[]},d="WITHOUT_CONTEXT";a.dnd_event?d=a.dnd_event.shiftKey?"WITHOUT_CONTEXT":"WITH_CONTEXT":a.behavior&&(d=a.behavior),c.source_data=UWA.clone(r),delete c.source_data.data;var u=void 0===a.displayNotif||a.displayNotif;UWA.is(r.data)&&UWA.is(r.data.items,"array")&&r.data.items.length>0?!0===t.getSetting("accept_all_types")?(console.log("Accept all types"),c.authorized_objects=r.data.items,a.callback(c)):("2.0"===a.version&&(c.authorizedWithKind={}),r.data.items.forEach(function(e){var t=e.objectType;UWA.is(e.objectType_Internal)&&(t=e.objectType_Internal);var n=e.displayType;"WITH_CONTEXT"===d&&e.path&&e.path.length>1&&e.path[0].type&&l.push({type:e.path[0].type,displayType:e.path[0].type}),t&&0!==t.length?-1===l.indexOf(t)&&l.push({type:t,displayType:n}):(console.warn("No type available ==> Object not supported"),c.unauthorized_objects.push(e))}),o.isTypesAuthorized(l,function(t,n){n&&n.unsupportedDropNotified&&(c.unsupportedDropNotified=!0),r.data.items.forEach(function(n){var o=n.objectType;if(UWA.is(n.objectType_Internal)&&(o=n.objectType_Internal),"WITH_CONTEXT"===d&&n.path&&n.path.length>1&&n.path[0].type&&(-1===t.indexOf(n.path[0].type)?n.path=[{resourceid:n.objectId,type:o}]:o=n.path[0].type),-1!==t.indexOf(o)){if("2.0"===a.version){var r=s.retrieveKind(o);c.authorizedWithKind[r]||(c.authorizedWithKind[r]=[]),c.authorizedWithKind[r].push(n)}c.authorized_objects.push(n)}else c.unauthorized_objects.push(n),!0===a.notifPerObjects&&(i.displayNotification({msg:e.replace(e.get("unsupported_type"),{type:n.displayType,name:n.displayName}),eventID:"warning"}),c.unsupportedDropNotified=!1)}),a.callback(c)},u,a.isFindInCtx,a.version)):(c.unsupportedDropNotified=!0,a.callback(c))},o.retrieveHierarchy=function(e,t){for(var n={},i=[],o=0;o<e.length;o++)s.types_hierarchies[e[o]]?n[e[o]]=UWA.clone(s.types_hierarchies[e[o]]):i.push(e[o]);i.length>0?require(["DS/PADUtils/PADWSAccess"],function(e){e.getTypesHierarchy({types:i,onComplete:function(e){(UWA.is(e,"string")?JSON.parse(e):e).types_hierarchies.forEach(function(e){void 0===s.types_hierarchies[e.type]&&(s.types_hierarchies[e.type]=e.hierarchy,s.types_hierarchies[e.type].push(e.type)),n[e.type]=e.hierarchy,n[e.type].push(e.type),t(n)})},onFailure:function(e){console.warn("Cannot retrieve hierarchy"),i.forEach(function(e){n[e]=[e],t(n)})}})}):t(n)},o}),define("DS/PADUtils/PADDictionaryAccess",["UWA/Promise","DS/Utilities/Utils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices"],function(e,t,n,i,o,s){"use strict";var a={nodes2update:[],idx:0,nlsInProgress:[]},r=t.debounce(function(t){l.idx=0;var i,r,c={},d=new e(function(l){var d=a.nodes2update;a.nodes2update=[],e.all(a.nlsInProgress).then(function(){var e=require("DS/PADServices/utils/AttributesMgt"),a=e.getAvailableColumns();if(a&&d.length){for(i=0;i<t.length;i++){var u=Object.getOwnPropertyNames(t[i].options.grid);for(r=0;r<u.length;r++)"ds6w:reserved"!==u[r]&&UWA.is(t[i].options.grid[u[r]])&&""!==t[i].options.grid[u[r]]&&!0===e.isAttributeColumn(u[r])&&-1!==a.indexOf(u[r])&&(void 0===c[u[r]]&&(c[u[r]]=[]),-1===c[u[r]].indexOf(t[i].options.grid[u[r]])&&c[u[r]].push(t[i].options.grid[u[r]]))}n.getNlsOfPropertiesValues(JSON.stringify(c),{tenantId:s.getPlatformId(),lang:o.getSetting("lang"),apiVersion:"R2019x",onComplete:function(e){var t=UWA.is(e,"string")?JSON.parse(e):e,n=Object.getOwnPropertyNames(t);function o(e){var i=!1,o={grid:e.options.grid};for(r=0;r<n.length;r++)o.grid[n[r]]&&t[n[r]][o.grid[n[r]]]&&t[n[r]][o.grid[n[r]]]!==o.grid[n[r]]&&0!==t[n[r]][o.grid[n[r]]].indexOf("emxFramework")&&(i=!0,o.grid[n[r]]=t[n[r]][o.grid[n[r]]]);return{updated:i,options:o}}var s=d[0].getTreeDocument();if(s)s.withTransactionUpdate(function(){for(i=0;i<d.length;i++){var e=d[i],t=o(e);!0===t.updated&&(delete e._treatingNLS,e.updateOptions(t.options))}d=[]});else{for(i=0;i<d.length;i++){var a=d[i],c=o(a);!0===c.updated&&(delete a._treatingNLS,a.updateOptions(c.options))}d=[]}l()},onFailure:function(e){console.warn("Cannot retrieve NLS"),e&&console.warn("data="+e),d=[],l()}})}})});a.nlsInProgress.push(d)},100),l={updateColumnsWithNLS:function(t,a){var r,l=this,c=[];for(l.completeResponse={},r=0;r<t.length;r++){var d=null;t[r].xnav_options&&t[r].xnav_options.name?d=t[r].xnav_options.name:t[r].ds6w&&(d=t[r].ds6w),d&&(-1!==d.indexOf(":")?c.push(d):t[r].xnav_options&&!0===t[r].xnav_options.hardcoded?l.completeResponse[d]={nlsName:i[d],lang:o.getSetting("lang")}:i[d]?l.completeResponse[d]={nlsName:i[d],lang:o.getSetting("lang")}:console.warn("PADDictionaryAccess##FedDictionaryAccessAPI.getResourcesInfo Unknown attribute type:"+t[r].dataIndex))}new e(function(e){var t={tenantId:s.getPlatformId(),lang:o.getSetting("lang"),apiVersion:"R2019x",onComplete:function(t){if(UWA.is(t,"array"))for(var n=0;n<t.length;n++)l.completeResponse[t[n].curi]={nlsName:t[n].label,lang:o.getSetting("lang")};e()},onFailure:function(t){var n=UWA.clone(c);if(UWA.is(t,"array")){for(var i=0;i<t.length;i++){var s=n.indexOf(t[i].curi);-1!==s&&n.splice(s,1),l.completeResponse[t[i].curi]={nlsName:t[i].label,lang:o.getSetting("lang")}}if(n.length){console.log("PADDictionaryAccess## FedDictionaryAccessAPI.getResourcesInfo can't find NLS for",JSON.stringify(n));for(i=0;i<n.length;i++)l.completeResponse[n[i]]={nlsName:n[i],lang:o.getSetting("lang")}}}e()}};n.getResourcesInfo(c.join(","),t)}).then(function(){for(r=0;r<t.length;r++){var e=null;if(t[r].xnav_options?e=t[r].xnav_options.name:t[r].ds6w&&(e=t[r].ds6w),e&&l.completeResponse[e]&&l.completeResponse[e].nlsName)t[r].text=l.completeResponse[e].nlsName;else if(e&&-1!==e.indexOf("ds6w"))console.warn("PADDictionaryAccess## ds6w attribute ["+e+"] not found by FedDictionaryAccessAPI.getResourcesInfo");else if(e){var n=e.split(":"),i="";!0===require("DS/PADServices/utils/AttributesMgt").isAttributeColumn(e)&&(i=n&&2===n.length?n[1]:e),t[r].text=i}}a({status:"success",columns:t})})},updateNLS:function(e){e._treatingNLS=!0,a.nodes2update.push(e),r(a.nodes2update)},getPropertiesForClass:function(e,t){n.getPropertiesForClass(e,t)},getVocabularyClasses:function(e,t){n.getVocabularyClasses(e,t)},getNlsOfPropertiesValues:function(e,t){n.getNlsOfPropertiesValues(e,t)},getResourcesInfo:function(e,t){n.getResourcesInfo(e,t)},predicates_nls_names:function(e,t){n.getVocabularyProperties(e,t)}};return l}),define("DS/PADUtils/views/PADSearchView",["css!DS/PADUtils/PADUtils","UWA/Core","UWA/Class/View","UWA/Drivers/Alone","DS/Logger/Logger","DS/PADUtils/PADCommandProxy","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/Handlebars/Handlebars","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADContext","UWA/Event"],function(e,t,n,i,o,s,a,r,l,c,d,u){"use strict";var p=n.extend({name:"PADSearchView",_searchTriggered:!1,className:"pad_global_ctn_search",_selected_paths:[],_insertReplaceNode:null,_insertParams:null,domEvents:{"click div.run_ctn_search":"_onSearch","click span.fonticon-check":"_onConfirmSelect","click div.clear_ctn_search":"_onClearSearch","click span.fonticon-up-open":"_onPrevious","click span.fonticon-down-open":"_onNext","keyup input.input_search":"_onSearchInputKeyUp","paste input.input_search":"_onSearchInputPaste","keydown input.input_search":"_onSearchInputKeyDown"},template:null,_logger:null,setup:function(e){var t=this;d.get().getPADTreeDocument()._insertFlag=!0;this._logger=o.getLogger(p),this._logger.log("setup"),!0===e.navigate_onresult?this.template=r.compile('<div class="left_ctn_search ctn_search"></div>    <div class="input_ctn_search ctn_search search_css_temp">        <div class="input_search_div with_nav" id="input_search_div">        <input class="input_search" id="input_search_input" type="text" placeholder="Search" ondrop="event.preventDefault ? event.preventDefault() : event.returnValue = false">        </div>        <div class="pad_count_ctn" id="pad_count_ctn"><div class="pad_count" id="pad_count"></div></div>        <div class="right_search">            <div class="nav_ctn_search ctn_search"><span class="fonticon fonticon-up-open ctn_search pad_nav"  style="display:none;" title="Previous"></span></div>            <div class="nav_ctn_search ctn_search"><span class="fonticon fonticon-down-open ctn_search pad_nav"  style="display:none;" title="Next"></span></div>            <div class="clear_ctn_search ctn_search"><div class="clear_btn_search" style="display:none;"></div></div>            <div class="run_ctn_search ctn_search"><div class="run_btn_search" style="opacity:0.1;"></div></div>            <div class="right_ctn_search ctn_search"></div>        </div>    </div>'):this.template=r.compile('<div class="left_ctn_search ctn_search"></div>    <div class="input_ctn_search ctn_search search_css_temp">        <div class="input_search_div" id="input_search_div">        <input class="input_search" id="input_search_input" type="text" placeholder="Search" ondrop="event.preventDefault ? event.preventDefault() : event.returnValue = false">        </div>        <div class="right_search">            <div class="clear_ctn_search ctn_search"><div class="clear_btn_search" style="display:none;"></div></div>            <div class="nav_ctn_search ctn_search"><span class="fonticon fonticon-check fonticon-1x"  style="opacity:0;"></span></div>            <div class="run_ctn_search ctn_search"><div class="run_btn_search"  style="opacity:0.1;"></div></div>            <div class="right_ctn_search ctn_search"></div>        </div>    </div>'),this._searchTriggered=!1,this._parent(e),this._commandProxy=s.create({events:{onSelect:function(e,n){function i(){t.$clearSearchButton.style.display="inline-block",t.$searchInput.value=t._insertParams["ds6w:label"],t.input_text=t.$searchInput.value,t.$searchButton.style.opacity=1,t.$checkButton.style.opacity=1,d.get().getPADTreeDocument()._insertSelected=!0}if(d.get().getPADTreeDocument()._insertFlag&&!0===d.get().getPADTreeDocument().options.insert_replace&&e.paths[0]){var o=e.paths[0],s=o[o.length-1],r=[];r.push({type:e.attributes[s].type}),c.isTypesAuthorized(r,function(n){n.length>0&&(t._selected_paths=e.paths[0],t._insertReplaceNode=t._selected_paths[t._selected_paths.length-1],t._insertParams={"ds6w:type":e.attributes[t._insertReplaceNode].type,"ds6w:label":e.attributes[t._insertReplaceNode].label},UWA.is(t._insertParams["ds6w:label"])?i():require(["DS/PADUtils/PADWSAccess"],function(e){t._insertParams["ds6w:label"]=a.PADProgressBar_loading,i();var n=l.getWebAPI_Options("fetch");e.fetch({enopad_webapis:l.getSetting("enopad_webapis"),data:n,pids:[t._selected_paths[t._selected_paths.length-1]],onComplete:function(e){var n=UWA.is(e,"string")?JSON.parse(e):e;if(n.results&&1===n.results.length){var o,s=n.results[0],a=null,r=s.attributes.length;for(o=0;o<r&&!a;o++)"ds6w:label"===s.attributes[o].name&&(a=s.attributes[o].value);t._insertParams["ds6w:label"]=a,i()}else t._insertParams["ds6w:label"]=null,i()},onFailure:function(){t._insertParams["ds6w:label"]=null,i()}})}))})}}}})},render:function(){this._logger.log("render");var e=this.template();return this.container.setContent(e),function(e,n,i){var o,s,a;if(!t.is(e,"object"))return e;for(o=0,s=(a=Object.keys(e)).length;o<s;o++)n.call(i,e[a[o]],a[o],e)}({searchInput:"input.input_search",searchButton:"div.run_btn_search",checkButton:"span.fonticon-check",searchOptionButton:".option_ctn_search",clearSearchButton:"div.clear_btn_search",onprevious:"span.fonticon-up-open",onnext:"span.fonticon-down-open",padcount:"div.pad_count"},function(e,t){this["$"+t]=this.getElement(e)},this),this.$onprevious&&(this.$onprevious.title=a.PADSearchView_previous),this.$onnext&&(this.$onnext.title=a.PADSearchView_next),this.$clearSearchButton&&(this.$clearSearchButton.title=a.PADSearchView_clear),this.$searchButton&&(this.$searchButton.title=a.PADSearchView_search),this.$checkButton&&(this.$checkButton.title=a.PADSearchView_check),!0===d.get().getPADTreeDocument().options.insert_replace?(this.$searchInput.placeholder=a.PADSearchView_search_select,this.$searchInput.title=a.PADSearchView_search_select):(this.$searchInput.placeholder=a.PADSearchView_search,this.$searchInput.title=a.PADSearchView_search),setTimeout(function(){this.$searchInput.focus()}.bind(this),500),this},setCount:function(e){this.$padcount.setContent(e.index+"/"+e.total),null!==this.$onprevious&&null!==this.$onnext&&(this.$onprevious.setStyle("display","inline-block"),this.$onnext.setStyle("display","inline-block"))},_onConfirmSelect:function(e){!0===d.get().getPADTreeDocument()._insertSelected&&(UWA.is(this.options.callbacks.onSearch,"function")&&this.options.callbacks.onSearch.call(null,[{search_value:this.$searchInput.value,resourceid:this._insertReplaceNode,"ds6w:type":this._insertParams["ds6w:type"],"ds6w:type_value":this._insertParams["ds6w:type"],"ds6w:label":this._insertParams["ds6w:label"]}]),d.get().getPADTreeDocument()._insertSelected=!1,d.get().getPADTreeDocument()._insertFlag=!1)},_onSearch:function(e){d.get().getPADTreeDocument()._insertSelected=!1,this._logger.log("_onSearch"),this.$searchInput.blur(),UWA.is(this.options.callbacks.onSearch,"function")&&this.options.callbacks.onSearch.call(null,{search_value:this.$searchInput.value}),d.get().getPADTreeDocument()._insertFlag=!1},_onClearSearch:function(e){this._logger.log("_onClearSearch"),this.$searchInput.value="",this.$clearSearchButton.hide(),this.$checkButton&&this.$checkButton.setStyle("opacity","0"),this.$searchButton.setStyle("opacity","0.1"),this._searchTriggered=!1,null!==this.$onprevious&&null!==this.$onnext&&null!==this.$padcount&&(this.$onprevious.hide(),this.$onnext.hide(),this.$padcount.setContent("")),UWA.is(this.options.callbacks.onClear,"function")&&this.options.callbacks.onClear.call(null)},_onSearchInputKeyUp:function(e){this.$searchInput.value?(this.$searchButton.setStyle("opacity","1"),this.$clearSearchButton.setStyle("display","inline-block"),null!==this.$onprevious&&null!==this.$onnext&&!0===this._searchTriggered&&(this.$onprevious.setStyle("display","inline-block"),this.$onnext.setStyle("display","inline-block"))):(this.$clearSearchButton.hide(),null!==this.$onprevious&&null!==this.$onnext&&null!==this.$padcount&&(this.$onprevious.hide(),this.$onnext.hide(),this.$padcount.setContent("")),this.$searchButton.setStyle("opacity","0.1")),this.$checkButton&&this.input_text!==this.$searchInput.value&&(d.get().getPADTreeDocument()._insertSelected=!1,this.$checkButton.setStyle("opacity","0.2"))},_onSearchInputPaste:function(e){var t=this;setTimeout(function(){t._onSearchInputKeyUp()},200)},_onPrevious:function(){UWA.is(this.options.callbacks.onPrevious,"function")&&this.options.callbacks.onPrevious.call(null)},_onNext:function(){UWA.is(this.options.callbacks.onNext,"function")&&this.options.callbacks.onNext.call(null)},_onSearchInputKeyDown:function(e){"return"!==u.whichKey(e)&&"Enter"!==e.keyIdentifier&&"return"!==e.keyIdentifier||(!0===d.get().getPADTreeDocument()._insertSelected?(UWA.is(this.options.callbacks.onSearch,"function")&&this.options.callbacks.onSearch.call(null,[{search_value:this.$searchInput.value,resourceid:this._insertReplaceNode,"ds6w:type":this._insertParams["ds6w:type"],"ds6w:type_value":this._insertParams["ds6w:type"],"ds6w:label":this._insertParams["ds6w:label"]}]),d.get().getPADTreeDocument()._insertSelected=!1,d.get().getPADTreeDocument()._insertFlag=!1):this._onSearch()),u.stopPropagation(e)}});return p}),define("DS/PADUtils/views/PADModalChooser",["css!DS/PADUtils/PADUtils","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Drivers/Alone","DS/Logger/Logger","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/views/PADSearchView","DS/UIKIT/Modal","css!UIKIT/UIKIT.css","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/SearchUtils"],function(e,t,n,i,o,s,a,r,l,c,d,u,p){"use strict";return n.extend(i,{name:"padmodalchooser",_logger:null,_modal:null,options:{},init:function(e){if(this._logger=s.getLogger(r),this._logger.log("init"),this._parent(e),this.setOptions(e),!e.renderTo){var t=document.getElementsByClassName("xnav_component");t&&1===t.length?e.renderTo=t[0]:e.renderTo=document.body}var n=UWA.createElement("div"),i=this,o=new r({callbacks:{onSearch:this._onPADSearch.bind(this)}});if(o.render().inject(n),document.addEventListener("keyup",function(e){27===e.keyCode&&(i._modal.destroy(),d.get().getPADTreeDocument()._insertFlag=!1)}),this._modal=new l({className:this.name+"_modal",closable:!1,body:n,visible:!0,overlay:!UWA.is(this.getOption("overlay"))||this.getOption("overlay")}),e.position)if(e.position.top&&e.position.left)this._modal.elements.content.setStyle("top",e.position.top),this._modal.elements.content.setStyle("left",e.position.left);else switch(e.position){case"above_action_bar":var a=e.renderTo.getBoundingClientRect();this._modal.elements.wrapper.setStyle("padding-top","calc("+a.height+"px - 80px)"),this._modal.elements.wrapper.setStyle("padding-left","calc(50% - 135px)");break;default:this._logger.log("unknown style")}this._modal.elements.container.addEventListener("click",function(e){console.log("view click",e),i._modal.destroy(),d.get().getPADTreeDocument()._insertFlag=!1}),this._modal.elements.content.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),!1}),this._modal.inject(e.renderTo),o.$searchInput.focus()},close:function(){this._modal.destroy()},_onPADSearch:function(e){this._logger.log("_onPADSearch with "+JSON.stringify(e));var t=this;if(!0===d.get().getPADTreeDocument()._insertSelected)t._modal.destroy(),this.getOption("in_apps_search").in_apps_callback.call(null,e);else if(e.search_value.length){var n,i=this.getOption("in_apps_search");if(!0===this.getOption("retrieveSearchValue")){n=e.search_value,t._modal.destroy(),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("settypes")&&u.setTypesForOFW(d.get().getPADTreeDocument());var o=this.getOption("searchValueCallback");UWA.is(o,"function")&&o.call(null,{searchValue:n})}else i&&(n=e.search_value,i.fts_value=n,i.callback=function(e){t._logger.log("In Apps Search callback"),t._modal.destroy(),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("settypes")&&u.setTypesForOFW(d.get().getPADTreeDocument()),UWA.is(i.in_apps_callback,"function")&&i.in_apps_callback.call(null,e)},i.cancel=function(){t._logger.log("In Apps Search Cancel callback"),t._modal.destroy()},p.inAppsSearch(i))}else this._logger.log("No search done since no string inside the input"),this._modal.destroy()}})}),define("DS/PADUtils/PADProbes",["UWA/Core","UWA/Class","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/PADTrackerManager"],function(e,t,n,i,o){"use strict";var s=t.singleton({initialize:function(e){},createProbe:function(e,t){var i={end:function(){},dump:function(){}};return this._initialized||(this._isActivated=n.getSetting("probes_activated"),this._initialized=!0),this._isActivated&&(i=new a(e,t)),i},networkprobe:function(e){var t,n,i=e.request_options,s=function(e){var t=e.split("/");if(t.length>5){var n=t[t.length-1],i=t[t.length-1].indexOf("?");return-1!==i&&(n=n.substring(0,i),t[t.length-1]=n),t.slice(4,t.length).join("/")}return 0===t[t.length-1].length?t[t.length-2]:t[t.length-1]}(e.url),a=function(e){if(e.contains("cvservlet")){var t=e.substring(e.indexOf("cvservlet"));return t.contains("?")&&(t=t.substring(0,t.indexOf("?"))),t}var n=e.split("/");if(n.length>5){var i=n[n.length-1],o=n[n.length-1].indexOf("?");return-1!==o&&(i=i.substring(0,o),n[n.length-1]=i),n.slice(4,n.length).join("/")}}(e.url),r=this.createProbe("query_"+s,a);return i.onComplete=(t=i.onComplete,function(e){if(r.end(),r.eventName){var n=o.getPADTracker({eventCategory:"usage",eventAction:"query"}),i=r.startTime&&r.finishTime?r.finishTime-r.startTime:void 0;n.setEventData({eventLabel:r.eventName,eventValue:i}),n.trackPageEvent()}if(UWA.is(t,"function"))return t.apply(this,Array.prototype.slice.call(arguments))}),i.onFailure=(n=i.onFailure,function(e){if(r.end(),r.eventName){var t=o.getPADTracker({eventCategory:"usage",eventAction:"queryFailed"}),i=r.startTime&&r.finishTime?r.finishTime-r.startTime:void 0;t.setEventData({eventLabel:r.eventName,eventValue:i}),t.trackPageEvent()}if(UWA.is(n,"function"))return n.apply(this,Array.prototype.slice.call(arguments))}),i}});function a(e,t){this.id=i.getPCSPrefix()+"_"+e,this.inprogress=!0,this.stamp=window.top.performance.now(),this.beginMark=this.id+"__begin_"+this.stamp,this.endMark=this.id+"__end_"+this.stamp,window.top.performance.mark(this.beginMark),this.startTime=Date.now(),void 0!==t&&(this.eventName=t)}return a.prototype.end=function(){!0===this.inprogress&&(this.inprogress=!1,window.top.performance.mark(this.endMark),this.finishTime=Date.now(),window.top.performance.measure(this.id,this.beginMark,this.endMark))},a.prototype.dump=function(){console.log(window.top.performance.getEntriesByName(this.id))},s}),define("DS/PADUtils/utilsWS/WSUtils",["DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes","DS/PADUtils/Configuration"],function(e,t,n,i){"use strict";function o(e,t){for(var n=0;n<t.length;n++)-1===e.indexOf(t[n])&&e.push(t[n]);return e}var s={executeRequest:function(i,o,s,a){var r=require("DS/PADUtils/PADSettingsMgt").getSetting("pad_security_ctx");if(UWA.is(r,"string")&&!0!==s&&(o.headers.SecurityContext=r,!0!==a)){var l=t.getUser();l&&l.login&&(o.headers.SecurityToken=l.login+"|"+r+"|preferred")}n.networkprobe({url:i,request_options:o});return e.authenticatedRequest(i,o)},completeWebAPIPayload:function(e,t,n){var s=i.getWebAPIOptions(e);if(t=UWA.extend(s.config,t),!0===n.withThumbnail2D&&t.select_file.push("thumbnail_2D"),s.mandatoryAttr)for(var a=Object.getOwnPropertyNames(s.mandatoryAttr),r=0;r<a.length;r++){var l=a[r];if(void 0===t[l])t[l]=s.mandatoryAttr[l];else if(UWA.is(t[l],"array")&&UWA.is(s.mandatoryAttr[l],"array"))for(var c=0;c<s.mandatoryAttr[l].length;c++)-1===t[l].indexOf(s.mandatoryAttr[l][c])&&t[l].push(s.mandatoryAttr[l][c]);else console.warn("##WSUtils: Unknown kind of property to complete")}var d=require("DS/PADServices/utils/AttributesMgtV2").createOutputsRequest(e);return t.select_bo&&(t.select_bo=o(t.select_bo,d.select_object)),t.select_predicate&&(t.select_predicate=o(t.select_predicate,d.select_object)),t.select_rel&&(t.select_rel=o(t.select_rel,d.select_relation)),!0===require("DS/PADUtils/PADSettingsMgt").getSetting("pgpFromServer")&&(t.select_pgp=["Show"],t.select_bo&&-1===t.select_bo.indexOf("bo.PGPShowExtension.V_PGP_Show")&&t.select_bo.push("bo.PGPShowExtension.V_PGP_Show"),t.select_rel&&-1===t.select_rel.indexOf("ro.PGPShowExtension.V_PGP_Show")&&t.select_rel.push("ro.PGPShowExtension.V_PGP_Show"),t.select_predicate&&-1===t.select_predicate.indexOf("bo.PGPShowExtension.V_PGP_Show")&&t.select_predicate.push("bo.PGPShowExtension.V_PGP_Show"),"explore_2D"!==t.intent&&(t.select_pgp=["Show","Color","Opacity"],t.select_bo&&-1===t.select_bo.indexOf("bo.PGPColorExtension.V_PGP_ColorRGB.Asstring")&&t.select_bo.push("bo.PGPColorExtension.V_PGP_ColorRGB.Asstring"),t.select_rel&&-1===t.select_rel.indexOf("ro.PGPColorExtension.V_PGP_ColorRGB.Asstring")&&t.select_rel.push("ro.PGPColorExtension.V_PGP_ColorRGB.Asstring"),t.select_predicate&&-1===t.select_predicate.indexOf("bo.PGPColorExtension.V_PGP_ColorRGB.Asstring")&&t.select_predicate.push("bo.PGPColorExtension.V_PGP_ColorRGB.Asstring"),t.select_bo&&-1===t.select_bo.indexOf("bo.PGPOpacityExtension.V_PGP_Opacity")&&t.select_bo.push("bo.PGPOpacityExtension.V_PGP_Opacity"),t.select_rel&&-1===t.select_rel.indexOf("ro.PGPOpacityExtension.V_PGP_Opacity")&&t.select_rel.push("ro.PGPOpacityExtension.V_PGP_Opacity"),t.select_predicate&&-1===t.select_predicate.indexOf("bo.PGPOpacityExtension.V_PGP_Opacity")&&t.select_predicate.push("bo.PGPOpacityExtension.V_PGP_Opacity"),t.select_bo&&-1===t.select_bo.indexOf("bo.PGPInheritanceExtension.V_PGP_Inheritance")&&t.select_bo.push("bo.PGPInheritanceExtension.V_PGP_Inheritance"),t.select_rel&&-1===t.select_rel.indexOf("ro.PGPInheritanceExtension.V_PGP_Inheritance")&&t.select_rel.push("ro.PGPInheritanceExtension.V_PGP_Inheritance"),t.select_predicate&&-1===t.select_predicate.indexOf("bo.PGPInheritanceExtension.V_PGP_Inheritance")&&t.select_predicate.push("bo.PGPInheritanceExtension.V_PGP_Inheritance"))),t},executeSplittedRequest:function(e,t,n){({pattern:n,max:void 0===n.max?10:n.max,url:e,options:UWA.clone(t,!1),onComplete:t.onComplete,onFailure:t.onFailure,onTimeout:t.onTimeout||t.onFailure,onCancel:t.onCancel||t.onFailure,execute:function(){void 0!==this.pattern.init&&(this.data=this.options.data,this.data=UWA.is(this.data,"string")?JSON.parse(this.data):this.data,this.options.onComplete=function(e,t){var n=(e=UWA.is(e,"string")?JSON.parse(e):e)[this.pattern.init.response.packets];void 0!==n?this.executePackets(n):void 0!==this.onComplete&&this.onComplete(e,t)}.bind(this),UWA.extend(this.data,this.pattern.init.query,!0),this.options.data=JSON.stringify(this.data),s.executeRequest(this.url,UWA.clone(this.options,!1)))},executePackets:function(e){if(this.packets=e,this.pending=0,this.response={},this.stopped=!1,void 0!==this.pattern.init&&void 0!==this.pattern.init.query)for(var t in this.pattern.init.query)delete this.data[t];if(void 0!==this.pattern.packet.query.remove)for(var n=0;n<this.pattern.packet.query.remove.length;n++)delete this.data[this.pattern.packet.query.remove[n]];this.options.onComplete=this.onPacketComplete.bind(this),this.options.onFailure=this.onPacketFailure.bind(this),this.options.onTimeout=this.onPacketTimeout.bind(this),this.options.onCancel=this.onPacketCancel.bind(this),this.executePacket()},executePacket:function(){for(;this.pending<this.max&&void 0!==this.packets&&this.packets.length>0;)this.data[this.pattern.packet.query.packet]=this.packets.shift(),this.options.data=JSON.stringify(this.data),this.pending++,s.executeRequest(this.url,UWA.clone(this.options,!1))},onPacketCancel:function(e){this.stopped||(this.stopped=!0,void 0!==this.onCancel&&this.onCancel(e))},onPacketTimeout:function(e){this.stopped||(this.stopped=!0,void 0!==this.onTimeout&&this.onTimeout(e))},onPacketFailure:function(e){this.stopped||(this.stopped=!0,void 0!==this.onFailure&&this.onFailure(e))},onPacketComplete:function(e,t){if(this.pending--,!this.stopped){e=UWA.is(e,"string")?JSON.parse(e):e;var n=this.pattern.packet.response.concat;if(void 0!==n)for(var i=0;i<n.length;i++){this.response[n[i]]=this.response[n[i]]||[];var o=this.updateResponsePacket(e[n[i]]);this.response[n[i]]=this.response[n[i]].concat(o)}var s=this.pattern.packet.response.copy;if(void 0!==s)for(var a=0;a<s.length;a++)"full_path"!==s[a]||!1!==this.response[s[a]]&&!1!==e[s[a]]?this.response[s[a]]=e[s[a]]:this.response[s[a]]=!1;0===this.packets.length&&0===this.pending?void 0!==this.onComplete&&this.onComplete(this.response,t):this.executePacket()}},updateResponsePacket:function(e){for(var t=[],n=Date.now(),i=0;i<e.length;i++){var o=e[i],s=0;if(o.attributes){for(s=0;s<o.attributes.length;s++)"did"===o.attributes[s].name&&(o.attributes[s].value=n+"-"+o.attributes[s].value)}else if(o.path)for(s=0;s<o.path.length;s++)o.path[s]=n+"-"+o.path[s];else if(o.pgp_overload){var a=Object.getOwnPropertyNames(o.pgp_overload);for(s=0;s<a.length;s++){for(var r=a[s].split(","),l=0;l<r.length;l++)r[l]=n+"-"+r[l];o.pgp_overload[r.toString()]=o.pgp_overload[a[s]],delete o.pgp_overload[a[s]]}}t.push(o)}return t}}).execute()},MassChunkedRequests:function(e){var t,n,i,o,s=e.chunkSize||30,a=[],r=0,l=0,c=0,d=!1,u=this;this.process=function(){if(r!==o&&"function"==typeof e.cbOnProcess){var t=n.slice(l,l+s);e.cbOnProcess(u,t)}},this.reprocess=function(){if(!d&&"function"==typeof e.cbOnProcess){var t=n.slice(l,l+s);e.cbOnProcess(u,t)}},this.setAnswer=function(n,p){if(!d){if(r++,t?i.push({request:n,answer:p}):i[n]=p,a.push(p),"function"==typeof e.cbOnProgress){var h=r/o;e.cbOnProgress(u,h,n)}r>c&&(l=c+1,(c+=s)>=o&&(c=o-1),this.process()),r>=o&&"function"==typeof e.cbOnComplete&&(e.cbOnComplete(u),d=!0)}},this.getAnswer=function(e){if(void 0!==t){if(!t)return i[e];for(var n=JSON.stringify(e),o=0,s=i.length;o<s;o++){if(n===JSON.stringify(i[o].request))return i[o].answer}}},this.getAnswers=function(){if(void 0!==t)return{results:a}},this.cancel=function(){d=!0,"function"==typeof e.cbOnComplete&&e.cbOnComplete(u),e.cbOnCancel&&"function"==typeof e.cbOnCancel&&e.cbOnCancel(u)},this.start=function(){if(void 0!==e.requests&&Array.isArray(e.requests)&&(o=e.requests.length)>0&&("string"==typeof e.requests[0]?(t=!1,i={},n=e.requests.filter(function(e,t,n){return n.indexOf(e)==t}),o=n.length):"object"==typeof e.requests[0]&&(t=!0,i=[],n=e.requests),void 0!==t))return l=0,(c=s-1)>=o&&(c=o-1),void this.process();"function"==typeof e.cbOnComplete&&e.cbOnComplete(u)},this.start()},MassChunkedRequestsLWC:function(e){var t,n,i,o,s=e.chunkSize||30,a=[],r=[],l=0,c=!1,d=this;this.process=function(){if(r.length!==o&&"function"==typeof e.cbOnProcess){var t=n.slice(l,l+s);e.cbOnProcess(d,t)}},this.reprocess=function(){if(!c&&"function"==typeof e.cbOnProcess){var t=n.slice(l,l+s);e.cbOnProcess(d,t)}},this.setAnswer=function(n,s){if(!c){var l;if(0,t?i.push({request:n,answer:s}):i[n]=s,s.path&&(l=s.path.join("_"),r.push(l)),a.push(s),"function"==typeof e.cbOnProgress){var u=r.length/o;e.cbOnProgress(d,u,n)}r.length===o&&"function"==typeof e.cbOnComplete&&(e.cbOnComplete(d),c=!0)}},this.setAnswers=function(t,n){if(a=n,r=t,"function"==typeof e.cbOnProgress){var i=r.length/o;e.cbOnProgress(d,i,t)}"function"==typeof e.cbOnComplete&&(e.cbOnComplete(d),c=!0)},this.getAnswer=function(e){if(void 0!==t){if(!t)return i[e];for(var n=JSON.stringify(e),o=0,s=i.length;o<s;o++){if(n===JSON.stringify(i[o].request))return i[o].answer}}},this.getAnswers=function(){if(void 0!==t)return{results:a}},this.cancel=function(){c=!0,"function"==typeof e.cbOnComplete&&e.cbOnComplete(d),e.cbOnCancel&&"function"==typeof e.cbOnCancel&&e.cbOnCancel(d)},this.start=function(){if(void 0!==e.requests&&Array.isArray(e.requests)&&(o=e.requests.length)>0&&("string"==typeof e.requests[0]?(t=!1,i={},n=e.requests.filter(function(e,t,n){return n.indexOf(e)==t}),o=n.length):"object"==typeof e.requests[0]&&(t=!0,i=[],n=e.requests),void 0!==t))return l=0,s-1>=o&&o-1,void this.process();"function"==typeof e.cbOnComplete&&e.cbOnComplete(d)},this.start()}};return s}),define("DS/PADUtils/utilsWS/PADLWCAccess",["UWA/Core","DS/PADUtils/PADSession","DS/PADUtils/PADUtilsServices","DS/PADUtils/utilsWS/WSUtils"],function(e,t,n,i){"use strict";var o={url:"/resources/enopad/lwc/fetch",verb:"POST"},s={url:"/resources/enopad/lwc/expand",verb:"POST"},a={url:"/resources/enopad/lwc/refresh",verb:"POST"};return{fetch:function(e){var s,a=e,r=require("DS/PADUtils/PADSettingsMgt");r.getSetting("pad_security_ctx")&&r.getSetting("pad_security_ctx");if(!UWA.is(a,"object"))throw new Error("Invalid inputs for PADLWCAccess.fetch");a.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":r.getSetting("lang")},a.timeout||(a.timeout=r.getSetting("webapi_timeout"));var l=o,c=void 0!==a.data.authored?a.data.authored:t.determineAuthoredFlag();a.method=l.verb,s=n.get3DSpaceUrl()+l.url+"?tenant="+n.getPlatformId();var d=[];a.pids.forEach(function(e){UWA.is(e,"array")&&e.length>1?d.push(e[e.length-1]):d.push(e)});var u={label:n.getRequestLabel(),query:"physicalid:"+d.join(" OR physicalid:"),intent:a.data.intent,nresults:a.pids.length,tenant:n.getPlatformId(),authored:c,select_file:a.data.select_file,fcs_url_mode:void 0!==a.data.fcs_url_mode?a.data.fcs_url_mode:void 0};return void 0===u.include_param_Attributes&&r.getSetting("readsettingsv2")&&(u.include_param_Attributes=!0),!0===r.getSetting("pgpFromServer")&&(u.select_pgp=["Show"],!0===r.getSetting("pgpColorFromServer")&&(u.select_pgp=["Show","Color","Opacity"])),a.data=JSON.stringify(u),a.onTimeout=a.onTimeout||a.onFailure,i.executeRequest(s,a)},expand:function(e){var o,a=e,r=require("DS/PADUtils/PADSettingsMgt");r.getSetting("pad_security_ctx")&&r.getSetting("pad_security_ctx");if(!UWA.is(a,"object"))throw new Error("Invalid inputs for PADLWCAccess.fetch");a.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":r.getSetting("lang")},a.timeout||(a.timeout=r.getSetting("webapi_timeout"));var l=s;void 0!==a.data.authored?a.data.authored:t.determineAuthoredFlag();if(a.method=l.verb,o=n.get3DSpaceUrl()+l.url+"?tenant="+n.getPlatformId(),r.getSetting("readsettingsv2")&&(a.data.include_param_Attributes=!0),!UWA.is(a.data.roots)&&UWA.is(a.data.root_physicalid)?a.data.roots=[{id:a.data.root_physicalid}]:!UWA.is(a.data.paths)&&UWA.is(a.data.root_path_physicalid)&&(a.data.paths=a.data.root_path_physicalid),UWA.is(a.data.level)||(a.data.level=a.data.expand_iter),UWA.is(a.data.intent)||(a.data.intent="explore_2D"),UWA.is(a.data.source)||(a.data.source="cstorage"),UWA.is(a.data.authored)||UWA.is(a.data.find_path_filter)||(a.data.authored=void 0!==a.data.authored?a.data.authored:t.determineAuthoredFlag()),a.data.label=n.getRequestLabel(),!0===r.getSetting("pgpFromServer")&&(a.data.select_pgp=["Show"],!0===r.getSetting("pgpColorFromServer")&&(a.data.select_pgp=["Show","Color","Opacity"])),delete a.data.root_physicalid,delete a.data.expand_iter,delete a.data.enopad_webapis,delete a.data.select_bo,delete a.data.select_rel,delete a.data.select_ds6w_facet,!UWA.is(a.data.roots)&&!UWA.is(a.data.paths))throw new Error("## PADWSv1.navigate: Invalid inputs: no root_physical_id or no root_path_physicalid found");return a.onTimeout=a.onTimeout||a.onFailure,a.data=JSON.stringify(a.data),i.executeRequest(o,a)},refresh:function(e){var o=require("DS/PADUtils/PADSettingsMgt"),s=a,r=n.get3DSpaceUrl()+s.url+"?tenant="+n.getPlatformId();if(!UWA.is(r)||!UWA.is(e,"object"))throw new Error("## PADWSv1.refresh: Invalid inputs");if(!UWA.is(e.data,"object"))throw new Error("## PADWSv1.refresh: Invalid inputs - options.data not found");e.method=s.verb,e.headers={Accept:"application/json","Content-Type":"application/json"},UWA.is(e.data.intent)||(e.data.intent="explore_2D"),UWA.is(e.data.source)||(e.data.source="cstorage"),o.getSetting("readsettingsv2")&&(e.data.include_param_Attributes=!0),e.data.authored=e.data.authored?e.data.authored:!t.isUsingIndex(),e.data.label=n.getRequestLabel(),!0===o.getSetting("pgpFromServer")&&(e.data.select_pgp=["Show"],!0===o.getSetting("pgpColorFromServer")&&(e.data.select_pgp=["Show","Color","Opacity"])),e.onTimeout=e.onTimeout||e.onFailure,e.data=JSON.stringify(e.data),i.executeSplittedRequest(r,e,{max:1,init:{query:{split:!0},response:{packets:"packets"}},packet:{query:{packet:"packet",remove:[]},response:{concat:["results"],copy:["full_path"]}}})}}}),define("DS/PADUtils/utilsWS/CVServletServices",["UWA/Core","DS/PADUtils/utilsWS/WSUtils","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/GlobalUtils"],function(e,t,n,i){"use strict";var o={fetch:{url:"/cvservlet/fetch/v2",verb:"POST"},expand:{url:"/cvservlet/expand",verb:"POST"},multiexpand:{url:"/cvservlet/multiexpand",verb:"POST"},expand3D:{url:"/cvservlet/expand3d",verb:"POST"},expandv2:{url:"/cvservlet/progressiveexpand/v2",verb:"POST"},wrap:{url:"/cvservlet/wrap",verb:"POST"},progressiveExpand:{url:"/cvservlet/progressiveexpand",verb:"POST"},search:{url:"/search",verb:"POST"},searchv2:{url:"/cvservlet/progressiveexpand/v2",verb:"POST"}},s=function(e,t){e.push("show"),e.push("hide"),e.push("color"),e.push("opacity"),t.select_bo.push("bo.PGPShowExtension.V_PGP_Show"),t.select_bo.push("bo.PGPColorExtension.V_PGP_ColorRGB.Asstring"),t.select_bo.push("bo.PGPOpacityExtension.V_PGP_Opacity"),t.select_bo.push("bo.PGPInheritanceExtension.V_PGP_Inheritance"),t.select_rel.push("ro.PGPShowExtension.V_PGP_Show"),t.select_rel.push("ro.PGPColorExtension.V_PGP_ColorRGB.Asstring"),t.select_rel.push("ro.PGPOpacityExtension.V_PGP_Opacity"),t.select_rel.push("ro.PGPInheritanceExtension.V_PGP_Inheritance")};return{_logger:{nbCalls:0,inputDataSize:[],outputDataSize:[],inputDataSizeLog:[],outputDataSizeLog:[]},fetch:function(s){var a=require("DS/PADUtils/PADSettingsMgt"),r=a.getSetting("pad_security_ctx")?a.getSetting("pad_security_ctx"):"preferred";let l="";null!==i.getURLParameter("redirectQueryToSGI")&&(l="&redirectQueryToSGI=true");var c=n.get3DSpaceUrl()+o.fetch.url+"?SecurityContext="+r+"&tenant="+n.getPlatformId()+l,d=s.data;delete s.data;var u=e.extend({method:o.fetch.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":a.getSetting("lang")},timeout:s.timeout?s.timeout:a.getSetting("webapi_timeout")},s),p=e.extend({label:n.getRequestLabel(),physicalid:s.pids,locale:a.getSetting("lang"),tenant:n.getPlatformId()},d);return!0!==s.noCompletion&&(p="fetch_3D"===p.intent?t.completeWebAPIPayload("fetch3d",p,s):t.completeWebAPIPayload("fetch2d",p,s)),delete u.pids,delete u.enopad_webapis,delete p.intent,delete p.authored,p.select_predicate&&(p.select_predicate=p.select_predicate.filter(function(e,t,n){return n.indexOf(e)===t})),u.data=JSON.stringify(p),u.onTimeout=u.onTimeout||u.onFailure,t.executeRequest(c,u)},expand:function(i){var s=require("DS/PADUtils/PADSettingsMgt"),a=s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):"preferred",r=n.get3DSpaceUrl()+o.expand.url+"?SecurityContext="+a+"&tenant="+n.getPlatformId(),l=i.data;delete i.data;var c,d=e.extend({method:o.expand.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},timeout:i.timeout?i.timeout:s.getSetting("webapi_timeout")},i);l.root_path_physicalid?c=l.root_path_physicalid:l.paths?c=l.paths:l.root_physicalid?c=[[l.root_physicalid]]:console.error("## CVServletServices.expand: No roots defined in input");var u=e.extend({label:n.getRequestLabel(),locale:s.getSetting("lang"),tenant:n.getPlatformId(),root_path_physicalid:c},l);u=t.completeWebAPIPayload("expand",u,i),delete d.enopad_webapis,delete u.intent,delete u.root_physicalid,delete u.authored,u.select_bo=u.select_bo.filter(function(e,t,n){return n.indexOf(e)===t});var p=void 0!==l.max_output_paths?l.max_output_paths:s.getSetting("maxPathCount");return p&&(u.max_output_paths=p.toString()),d.data=JSON.stringify(u),d.onTimeout=d.onTimeout||d.onFailure,t.executeRequest(r,d)},refresh:function(e){e.data.expand_iter||(e.data.expand_iter="1"),delete e.data.session;for(var t=[],n=[],i=0;i<e.data.root_path_physicalid.length;i++){var o=e.data.root_path_physicalid[i];o.length>1&&(o=o.slice(0,-2));var s=JSON.stringify(o);-1===n.indexOf(s)&&(t.push(o),n.push(s))}e.data.root_path_physicalid=t,this.expand(e)},expand3d:function(i){var s=require("DS/PADUtils/PADSettingsMgt"),a=s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):"preferred",r=n.get3DSpaceUrl()+o[i.expand3DType].url+"?SecurityContext="+a+"&tenant="+n.getPlatformId();"progressiveExpand"===i.expand3DType&&(r+="&output_format=cvjson");var l=i.data;l.fcs_url_mode=s.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":void 0,delete i.data;var c,d=e.extend({method:o[i.expand3DType].verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},timeout:i.timeout?i.timeout:s.getSetting("webapi_timeout")},i);l.root_path_physicalid?c=l.root_path_physicalid:l.paths?c=l.paths:l.root_physicalid?c=[[l.root_physicalid]]:console.error("## CVServletServices.expand3d: No roots defined in input");var u=e.extend({label:n.getRequestLabel(),locale:s.getSetting("lang"),tenant:n.getPlatformId(),root_path_physicalid:c},l);return u=t.completeWebAPIPayload("expand3d",u,i),delete d.expand3DType,delete d.enopad_webapis,delete u.intent,delete u.root_physicalid,delete u.authored,delete u.debug,u.select_bo=u.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),d.data=JSON.stringify(u),d.onTimeout=d.onTimeout||d.onFailure,t.executeRequest(r,d)},getRootStats:function(e){var a={},r=require("DS/PADUtils/PADSettingsMgt"),l=r.getSetting("pad_security_ctx")?r.getSetting("pad_security_ctx"):"preferred";let c="";null!==i.getURLParameter("redirectQueryToSGI")&&(c="&redirectQueryToSGI=true");var d=n.get3DSpaceUrl()+o.expandv2.url+"?output_format=cvjson&SecurityContext="+l+"&tenant="+n.getPlatformId()+c,u=this._buildPredefinedComputation(e.data.compute_select_bo),p=this._buildPrefixPath(e.data.rootPhID,e.data.root_path_physicalid),h=!1,g=e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{}});void 0===g?g={all:1}:(g=g.filter,h=!0);var f=[{truncate:{max_distance_from_prefix:0,prefix_filter:{prefix_path:p}}}],m=[];h&&m.push({bounding_box:{name:"ProgressiveExpand_FilteredBBox",sampling:r.getSetting("enopad3dviewer_filteredBBoxSampling_progressiveExpand")}}),m.push({synthesis:{name:"ProgressiveExpand_FlatSynthesis",mode:"flat"}}),m.push({synthesis:{name:"ProgressiveExpand_OccSynthesis",mode:"occurence"}}),m.push({synthesis:{name:"ProgressiveExpand_LeafSynthesis",mode:"tree_leaf",synthesis_only:1}});var _,v=void 0;e.data.get_materials&&void 0!==e.data.materialParameters&&(f.push(e.data.materialParameters.aggregationProcessors),v=e.data.materialParameters.materialAttributes),!0===r.getSetting("pgpFromServer")&&s(_=[],e.data),e.data.select_bo=e.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),e.data.select_rel=e.data.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});let S=void 0;r.getSetting("enopad3dviewer_flexibleAssemblySupportActivated")&&(S=1);var y={batch:{expands:[{label:"ProgressiveExpand_Synthesis_"+n.getRequestLabel(),root:{physical_id:e.data.rootPhID},parameters:{limit_max_path:e.maxLeaves,apply_flexible_assembly_matrix:S||void 0},filter:g,graph:r.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:m},{label:"ProgressiveExpand_Expand0_"+n.getRequestLabel(),root:{physical_id:e.data.rootPhID},filter:{prefix_filter:{prefix_path:p}},graph:r.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:f,parameters:S?{apply_flexible_assembly_matrix:1}:void 0}]},outputs:{select_object:e.data.select_bo,select_relation:e.data.select_rel,select_material:v,select_pgp:_,hits:{predefined_computation:u},synthesis:["ProgressiveExpand_FlatSynthesis","ProgressiveExpand_OccSynthesis","ProgressiveExpand_LeafSynthesis"],bounding_box:h?["ProgressiveExpand_FilteredBBox"]:void 0,select_flexible_assembly_matrix:S?1:void 0}};return a.onComplete=e.onComplete,a.onFailure=e.onFailure,a.onTimeout=e.onTimeout||e.onFailure,a.timeout=6e4,a.method=o.expandv2.verb,a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify(y),t.executeRequest(d,a)},getStaticMappingExcludedOccurrences:function(e){var i={},s=require("DS/PADUtils/PADSettingsMgt"),a=s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):"preferred",r=n.get3DSpaceUrl()+o.expandv2.url+"?output_format=cvjson&SecurityContext="+a+"&tenant="+n.getPlatformId()+"&disable_implicit_static_mapping_filter=true",l=this._buildPrefixPath(e.data.rootPhID,e.data.root_path_physicalid);let c=[];e.intent&&"explore_2D"===e.intent&&(c=[{truncate:{compute_matching_subpaths_lengths:1,match_only_refs:1,or:{filters:[{and_not:{left:{and:{filters:[{all:1}]}},right:{and:{filters:[{static_mapping_filter:1}]}}}}]}}}]);var d={batch:{expands:[{label:"ProgressiveExpand_ExpandAll_"+n.getRequestLabel(),root:{physical_id:e.data.rootPhID},parameters:{disable_occurrence_output:1},filter:e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:l,staticMapping:1}}).filter,graph:s.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:[{synthesis:{name:"ProgressiveExpand_FlatSynthesis",mode:"flat"}}]},{label:"ProgressiveExpand_ExpandAll_ExcludedOccurences_"+n.getRequestLabel(),root:{physical_id:e.data.rootPhID},filter:{or:{filters:[{and_not:{left:{and:{filters:[{counted_by_flat_synthesis_filter:{synthesis_name:"ProgressiveExpand_FlatSynthesis"}},{prefix_filter:{prefix_path:[{physical_id_path:[e.data.rootPhID]}]}}]}},right:e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:l,staticMapping:1}}).filter}}]}},graph:s.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:e.intent&&"explore_2D"===e.intent?c:void 0}]},outputs:{format:"occurrence_path",select_object:e.data.select_bo,select_relation:e.data.select_rel,matching_lengths:e.intent&&"explore_2D"===e.intent?1:void 0}};return i.onComplete=e.onComplete,i.onFailure=e.onFailure,i.onTimeout=e.onTimeout||e.onFailure,i.timeout=3e5,i.method=o.expandv2.verb,i.headers={Accept:"application/json","Content-Type":"application/json"},i.data=JSON.stringify(d),t.executeRequest(r,i)},progressiveExpand:function(e){var a={},r=require("DS/PADUtils/PADSettingsMgt"),l=r.getSetting("pad_security_ctx")?r.getSetting("pad_security_ctx"):"preferred";let c="";null!==i.getURLParameter("redirectQueryToSGI")&&(c="&redirectQueryToSGI=true");var d=n.get3DSpaceUrl()+o.expandv2.url+"?output_format=cvjson&SecurityContext="+l+"&tenant="+n.getPlatformId()+c,u=void 0===e.withFrustumFilter||e.withFrustumFilter,p=this._buildPredefinedComputation(e.data.compute_select_bo),h=this._buildPrefixPath(e.data.rootPhID,e.data.root_path_physicalid),g=this._buildMatriceOverloads(e.data.rootPhID,e.overrides),f=e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:h,inFrustumObj:u&&e.data.frustumDefinition&&void 0!==e.data.frustumDefinition.angle?e.data.frustumDefinition:void 0,inParallelFrustumObj:u&&e.data.frustumDefinition&&void 0!==e.data.frustumDefinition.left?e.data.frustumDefinition:void 0}}).filter,m=void 0,_=void 0;e.data.get_materials&&void 0!==e.data.materialParameters&&(m=[e.data.materialParameters.aggregationProcessors],_=e.data.materialParameters.materialAttributes);var v,S=-1;e.data.expand_iter&&(S=parseInt(e.data.expand_iter))>-1&&(void 0===m&&(m=[]),m.push({truncate:{max_distance_from_prefix:S,prefix_filter:{prefix_path:h}}})),!0===r.getSetting("pgpFromServer")&&s(v=[],e.data),e.data.select_bo=e.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),e.data.select_rel=e.data.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});let y=void 0;r.getSetting("enopad3dviewer_flexibleAssemblySupportActivated")&&(y={apply_flexible_assembly_matrix:1});var b={batch:{expands:[{label:u?"ProgressiveExpand_ExpandFullVP_"+n.getRequestLabel():-1!=S?"ProgressiveExpand_Expand"+e.data.expand_iter+"_"+n.getRequestLabel():"ProgressiveExpand_ExpandAll_"+n.getRequestLabel(),root:{physical_id:e.data.rootPhID},matrices_overloads:u&&g.length?g:void 0,filter:f,graph:r.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:m,parameters:void 0!==y?y:void 0}]},outputs:{select_object:e.data.select_bo,select_relation:e.data.select_rel,select_material:_,select_pgp:v,hits:{predefined_computation:p},select_flexible_assembly_matrix:void 0!==y?1:void 0}};return a.onComplete=e.onComplete,a.onFailure=e.onFailure,a.onTimeout=e.onTimeout||e.onFailure,a.timeout=6e5,a.method=o.expandv2.verb,a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify(b),t.executeRequest(d,a)},multiexpand:function(i){var s=n.get3DSpaceUrl(),a=i,r=require("DS/PADUtils/PADSettingsMgt"),l=r.getSetting("pad_security_ctx")?r.getSetting("pad_security_ctx"):"preferred";s=s+o.multiexpand.url+"?SecurityContext="+l+"&tenant="+n.getPlatformId();a=e.extend({method:o.expand.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":r.getSetting("lang")},timeout:i.timeout?i.timeout:r.getSetting("webapi_timeout")},i);if(void 0!==i.expand3DType)a.data=t.completeWebAPIPayload("multiexpand3d",a.data,i),a.data.fcs_url_mode=r.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":void 0;else if(a.data=t.completeWebAPIPayload("multiexpand2d",a.data,i),void 0===a.data.max_output_paths){var c=r.getSetting("maxPathCount");c&&(a.data.max_output_paths=c.toString())}return delete a.enopad_webapis,delete a.expand3DType,delete a.data.intent,delete a.data.authored,a.data.select_bo=a.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),a.onTimeout=a.onTimeout||a.onFailure,a.data.label=n.getRequestLabel(),a.data=JSON.stringify(a.data),t.executeRequest(s,a)},volumeQuery:function(i){if(!e.is(i.data.volume_filter))throw new Error("## CVServletServices.volumeQuery: Invalid inputs: no volume defined");var s=require("DS/PADUtils/PADSettingsMgt"),a=s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):"preferred",r=n.get3DSpaceUrl()+o.expand3D.url+"?SecurityContext="+a+"&tenant="+n.getPlatformId(),l=i.data;l.fcs_url_mode=s.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":void 0,delete i.data;var c,d=e.extend({method:o.expand3D.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},timeout:i.timeout?i.timeout:s.getSetting("webapi_timeout")},i);l.root_path_physicalid?c=l.root_path_physicalid:l.paths?c=l.paths:l.root_physicalid?c=[[l.root_physicalid]]:console.error("## CVServletServices.volumeQuery: No roots defined in input");var u=e.extend({label:n.getRequestLabel(),locale:s.getSetting("lang"),tenant:n.getPlatformId(),root_path_physicalid:c},l);return u=t.completeWebAPIPayload("expand3d",u,i),delete d.expand3DType,delete d.enopad_webapis,delete u.intent,delete u.root_physicalid,delete u.authored,delete u.debug,u.select_bo=u.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),d.data=JSON.stringify(u),d.onTimeout=d.onTimeout||d.onFailure,t.executeRequest(r,d)},volumeQueryV2:function(e){var a={},r=require("DS/PADUtils/PADSettingsMgt"),l=r.getSetting("pad_security_ctx")?r.getSetting("pad_security_ctx"):"preferred";let c="";null!==i.getURLParameter("redirectQueryToSGI")&&(c="&redirectQueryToSGI=true");var d,u,p,h=n.get3DSpaceUrl()+o.expandv2.url+"?output_format=cvjson&SecurityContext="+l+"&tenant="+n.getPlatformId()+c,g=this._buildPredefinedComputation(e.data.compute_select_bo),f=this._buildMatriceOverloads(e.data.rootPhID,e.data.overrides),m=this._buildPrefixPath(e.data.rootPhID,e.data.root_path_physicalid),_=e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:m,volumeObj:[e.data.volume_filter]}}).filter;e.data.get_materials&&void 0!==e.data.materialParameters&&(d=[e.data.materialParameters.aggregationProcessors],u=e.data.materialParameters.materialAttributes),!0===r.getSetting("pgpFromServer")&&s(p=[],e.data),e.data.select_bo=e.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),e.data.select_rel=e.data.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});let v=void 0;r.getSetting("enopad3dviewer_flexibleAssemblySupportActivated")&&(v=1);let S={limit_max_path:e.data.max_output_paths?e.data.max_output_paths:void 0,apply_flexible_assembly_matrix:v||void 0};S.limit_max_path||S.apply_flexible_assembly_matrix||(S=void 0);var y={applicationID:void 0!==e.data.applicationID?e.data.applicationID:void 0,batch:{expands:[{label:"ProgressiveExpand_VolumeQuery_"+n.getRequestLabel(),parameters:S,root:{physical_id:e.data.rootPhID},matrices_overloads:f.length?f:void 0,filter:_,graph:r.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:d}]},outputs:{select_object:e.data.select_bo,select_relation:e.data.select_rel,select_material:u,select_pgp:p,hits:{predefined_computation:g},format:"entity_relation_occurrence",select_flexible_assembly_matrix:void 0!==v?1:void 0}};return a.onComplete=e.onComplete,a.onFailure=e.onFailure,a.onTimeout=e.onTimeout||e.onFailure,a.timeout=6e4,a.method=o.searchv2.verb,a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify(y),t.executeRequest(h,a)},search:function(i){var s=require("DS/PADUtils/PADSettingsMgt"),a=n.getPlatformURL("3DSearch")+o.search.url,r=i.data;delete i.data;var l=e.extend({method:o.fetch.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},timeout:i.timeout?i.timeout:s.getSetting("webapi_timeout")},i),c=e.extend({label:n.getRequestLabel(),locale:s.getSetting("lang"),tenant:n.getPlatformId()},r);return!0!==i.noCompletion&&(c="fetch_3D"===c.intent?t.completeWebAPIPayload("fetch3d",c,i):t.completeWebAPIPayload("fetch2d",c,i)),c.select_predicate&&(c.select_predicate=c.select_predicate.filter(function(e,t,n){return n.indexOf(e)===t})),l.data=JSON.stringify(c),l.onTimeout=l.onTimeout||l.onFailure,t.executeRequest(a,l)},searchV2:function(e){var i={},a=require("DS/PADUtils/PADSettingsMgt"),r=a.getSetting("pad_security_ctx")?a.getSetting("pad_security_ctx"):"preferred",l=n.get3DSpaceUrl()+o.searchv2.url+"?output_format=cvjson&SecurityContext="+r+"&tenant="+n.getPlatformId(),c=this._buildPredefinedComputation(e.data.compute_select_bo),d=this._buildPrefixPath(e.data.rootPhID);e.data.max_count_path&&(e.data.max_count_path=parseInt(e.data.max_count_path),e.data.max_count_path===parseInt(a.getSetting("enopad3dviewer_max_count_in_search"))&&(e.data.max_count_path=e.data.max_count_path+1));var u=null,p=[];if(e.data.subPaths){u=e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:d,find_subpaths:e.data.subPaths}}).filter;const t={truncate:e.FBIProxy.buildSpecFromAppIntent({V2:{find_subpaths:e.data.subPaths}})};t.truncate.max_distance_from_prefix=0,t.truncate.compute_matching_subpaths_lengths=1,t.truncate.match_only_refs=1,p=[t]}else if(e.data.taggerSelect){u=e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:d,tagger_select:e.data.taggerSelect}}).filter;const t={truncate:e.FBIProxy.buildSpecFromAppIntent({V2:{tagger_select:e.data.taggerSelect}})};t.truncate.max_distance_from_prefix=0,t.truncate.compute_matching_subpaths_lengths=1,t.truncate.match_only_refs=1,p=[t]}else if(e.data.searchQuery){u=e.FBIProxy.GetFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:d,find_in_context:e.data.searchQuery}}).filter;const t={truncate:e.FBIProxy.buildSpecFromAppIntent({V2:{find_in_context:e.data.searchQuery}})};t.truncate.max_distance_from_prefix=0,t.truncate.compute_matching_subpaths_lengths=1,t.truncate.match_only_refs=1,p=[t]}var h,g=void 0;e.data.get_materials&&void 0!==e.data.materialParameters&&(p.push(e.data.materialParameters.aggregationProcessors),g=e.data.materialParameters.materialAttributes),!0===a.getSetting("pgpFromServer")&&s(h=[],e.data),e.data.select_bo=e.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),e.data.select_rel=e.data.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});let f=void 0;a.getSetting("enopad3dviewer_flexibleAssemblySupportActivated")&&(f={apply_flexible_assembly_matrix:1});let m={limit_max_path:e.data.max_count_path?e.data.max_count_path:void 0,apply_flexible_assembly_matrix:void 0!==f?f:void 0};m.limit_max_path||m.apply_flexible_assembly_matrix||(m=void 0);var _={batch:{expands:[{label:"ProgressiveExpand_SearchV2_"+n.getRequestLabel(),parameters:m,root:{physical_id:e.data.rootPhID},filter:u,graph:a.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:p}]},outputs:{select_object:e.data.select_bo,select_relation:e.data.select_rel,select_material:g,select_pgp:h,hits:{predefined_computation:c},matching_lengths:1,format:"entity_relation_occurrence",select_flexible_assembly_matrix:void 0!==f?1:void 0}};return i.onComplete=e.onComplete,i.onFailure=e.onFailure,i.onTimeout=e.onTimeout||e.onFailure,i.timeout=6e4,i.method=o.searchv2.verb,i.headers={Accept:"application/json","Content-Type":"application/json"},i.data=JSON.stringify(_),t.executeRequest(l,i)},getMinMaxDistanceCandidates:function(e){var a={},r=require("DS/PADUtils/PADSettingsMgt"),l=r.getSetting("pad_security_ctx")?r.getSetting("pad_security_ctx"):"preferred";let c="";null!==i.getURLParameter("redirectQueryToSGI")&&(c="&redirectQueryToSGI=true");var d=n.get3DSpaceUrl()+o.expandv2.url+"?output_format=cvjson&SecurityContext="+l+"&tenant="+n.getPlatformId()+c,u=this._buildPredefinedComputation(e.data.compute_select_bo),p=this._buildMatriceOverloads(e.data.rootPhID,e.data.overrides),h=e.data.sets[0].paths;h=h.concat(e.data.sets[1].paths);var g,f,m=this._buildPrefixPath(e.data.rootPhID,h),_=e.FBIProxy.getFilterSpec(e.data.rootPhID,{V2:{prefixPathArray:m}}).filter,v=[this._buildMinMaxSets(e.data.mode,e.data.sets)];e.data.get_materials&&void 0!==e.data.materialParameters&&(v.push(e.data.materialParameters.aggregationProcessors),g=e.data.materialParameters.materialAttributes),!0===r.getSetting("pgpFromServer")&&s(f=[],e.data),e.data.select_bo=e.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),e.data.select_rel=e.data.select_rel.filter(function(e,t,n){return n.indexOf(e)===t});let S=void 0;r.getSetting("enopad3dviewer_flexibleAssemblySupportActivated")&&(S={apply_flexible_assembly_matrix:1});var y={batch:{expands:[{label:"ProgressiveExpand_MinMaxDistance_"+n.getRequestLabel(),root:{physical_id:e.data.rootPhID},matrices_overloads:p.length?p:void 0,filter:_,graph:r.getSetting("enopad3dviewer_graphDefinitionForExpand"),aggregation_processors:v,parameters:S||void 0}]},outputs:{select_object:e.data.select_bo,select_relation:e.data.select_rel,select_material:g,select_pgp:f,hits:{predefined_computation:u},format:"entity_relation_occurrence",select_flexible_assembly_matrix:S?1:void 0}};return a.onComplete=e.onComplete,a.onFailure=e.onFailure,a.onTimeout=e.onTimeout||e.onFailure,a.timeout=6e4,a.method=o.searchv2.verb,a.headers={Accept:"application/json","Content-Type":"application/json"},a.data=JSON.stringify(y),t.executeRequest(d,a)},_buildMinMaxSets:function(e,t){var n={},i=0,o={set_a_label:t[0].id,set_a_filter:{prefix_filter:{prefix_path:[]}},set_b_label:t[1].id,set_b_filter:{prefix_filter:{prefix_path:[]}}};for(i=0;i<t[0].paths.length;i++)o.set_a_filter.prefix_filter.prefix_path.push({physical_id_path:t[0].paths[i]});for(i=0;i<t[1].paths.length;i++)o.set_b_filter.prefix_filter.prefix_path.push({physical_id_path:t[1].paths[i]});return"min"===e?n.min_distance=o:"max"===e&&(n.max_distance=o),n},_buildPredefinedComputation:function(e){var t=["boundingbox"];return-1!==e.indexOf("thumbnail_3d")?t.push("thumbnail_3d_fallback_cgr"):-1!==e.indexOf("stepcgr")?t.push("urlstream|cgr|stepcgr"):t=t.concat(e),t},_buildPrefixPath:function(e,t){var n=null,i=0;if(t&&t.length)for(n=[],i=0;i<t.length;i++)n.push({physical_id_path:t[i]});else n=[{physical_id_path:[e]}];return n},_buildMatriceOverloads:function(e,t){var n=[],i=0;if(t)for(i=0;i<t.length;i++){var o=t[i];o.idPath&&o.value&&16===o.value.length&&(o.idPath.splice(0,1),o.idPath[0]===e&&n.push({path:{physical_id_path:o.idPath},matrix:[o.value[0],o.value[1],o.value[2],o.value[4],o.value[5],o.value[6],o.value[8],o.value[9],o.value[10],o.value[12],o.value[13],o.value[14]]}))}return n}}}),define("DS/PADUtils/utilsWS/WSAdmin",["DS/WAFData/WAFData","DS/PADUtils/utilsWS/WSUtils","DS/PADUtils/Configuration","DS/PADUtils/PADUtilsServices"],function(e,t,n,i){"use strict";var o={url:"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",verb:"GET"},s={url:"/resources/6WVocab/access/PredicatesNLSNames",verb:"GET"},a={url:"/resources/AppsMngt/user/preference",verb:"GET"},r={url:"/resources/AppsMngt/user/preference",verb:"PUT"},l={url:"/resources/enopad/admin/readsettings/v2",verb:"GET"},c={url:"/resources/enong/dico/gettypeshierarchy",verb:"POST"},d={url:"/resources/dictionary/getTypeInfo",verb:"POST"},u={url:"/resources/dictionary/class/interfaces",verb:"POST"};return{getscandcollab:function(e){var n=require("DS/PADUtils/PADSettingsMgt"),s=e,a=o,r=s.tenant?s.tenant:i.getPlatformId(),l=i.get3DSpaceUrl(r)+a.url+"&tenant="+r;return s.method=a.verb,s.headers={Accept:"application/json","Accept-Language":n.getSetting("lang"),"Content-Type":"application/json"},s.cache=-1,t.executeRequest(l,s,!0)},predicates_nls_names:function(e){var n=require("DS/PADUtils/PADSettingsMgt");if(!0===n.getSetting("FedDictionnaryAccess"))throw new Error("## WSAdmin.predicates_nls_names: Call new FedDictionaryAccessAPI instead");var o=s,a=i.get3DSpaceUrl()+o.url,r=e;return r.method=o.verb,r.headers={Accept:"application/json","Accept-Language":n.getSetting("lang")},r.data="name="+e.name+"&tenant="+i.getPlatformId(),t.executeRequest(a,r)},getElementsNLSNames:function(t){if(!0===require("DS/PADUtils/PADSettingsMgt").getSetting("FedDictionnaryAccess"))throw new Error("## WSAdmin.getElementsNLSNames: Call new FedDictionaryAccessAPI instead");var n=t||{},o=i.get3DSpaceUrl()+"/resources/6WVocab/access/ElementsNLSNames?tenant="+i.getPlatformId();n.method="POST",n.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.lang},n.data=t.elementsNLSNames,e.authenticatedRequest(o,n)},getPredicates:function(t){var n=require("DS/PADUtils/PADSettingsMgt");if(!0===n.getSetting("FedDictionnaryAccess"))throw new Error("## WSAdmin.getElementsNLSNames: Call new FedDictionaryAccessAPI instead");var o=t||{},s=i.get3DSpaceUrl()+"/resources/6WVocab/access/Predicates?tenant="+i.getPlatformId();o.method="POST",o.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":n.getSetting("lang")},o.data=t.classURIs,e.authenticatedRequest(s,o)},getVocabularyClasses:function(t){var n=require("DS/PADUtils/PADSettingsMgt");if(!0===n.getSetting("FedDictionnaryAccess"))throw new Error("## WSAdmin.getElementsNLSNames: Call new FedDictionaryAccessAPI instead");var o=t||{},s=i.get3DSpaceUrl()+"/resources/6WVocab/access/VocabularyClasses?tenant="+i.getPlatformId();o.method="GET",o.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":n.getSetting("lang")},o.timeout=6e4,o.data="name="+t.vocabularyname,e.authenticatedRequest(s,o)},getTypeInfo:function(e){var n=require("DS/PADUtils/PADSettingsMgt"),o=d,s=i.get3DSpaceUrl()+o.url+"?tenant="+i.getPlatformId(),a=e;if(a.url_parameters){for(var r=Object.getOwnPropertyNames(e.url_parameters),l=0;l<r.length;l++)s=s+"&"+r[l]+"="+e.url_parameters[r[l]];delete a.url_parameters}return a.method=o.verb,a.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":n.getSetting("lang")},a.data=JSON.stringify(a.body),delete a.body,t.executeRequest(s,a)},interfaces:function(e){var n=require("DS/PADUtils/PADSettingsMgt"),o=u,s=i.get3DSpaceUrl()+o.url+"?tenant="+i.getPlatformId(),a=e;return a.method=o.verb,a.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":n.getSetting("lang")},a.data=JSON.stringify(a.data),t.executeRequest(s,a)},getMyAppsTemplate:function(e){require("DS/PADUtils/PADSettingsMgt");var n=a,o=i.getPlatformURL("3DCompass")+n.url,s=e;return s.method=n.verb,s.headers={Accept:"application/json, text/plain"},s.data={name:e.preference_name},t.executeRequest(o,s,!0)},saveMyAppsTemplate:function(e){require("DS/PADUtils/PADSettingsMgt");var n=r,o=i.getPlatformURL("3DCompass")+n.url,s=e;return s.method=n.verb,s.headers={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},s.data={name:e.preference_name,value:e.value},t.executeRequest(o,s,!0)},padtreelistOpts:function(e){require("DS/PADUtils/PADSettingsMgt");var n=l,o=i.get3DSpaceUrl()+n.url+"?tenant="+i.getPlatformId(),s=e;if(s.method=n.verb,s.headers={Accept:"application/json"},void 0===e.data.intent||void 0===e.data.app)throw new Error("Invalid inputs for WSAdmin.padtreelistOpts");return s.data="intent="+e.data.intent+"&app="+e.data.app+"&reset="+(!0===e.data.reset?"true":"false"),t.executeRequest(o,s)},getTypesHierarchy:function(e){require("DS/PADUtils/PADSettingsMgt");var n=c,o=i.get3DSpaceUrl()+n.url+"?tenant="+i.getPlatformId(),s=e;return s.method=n.verb,s.headers={Accept:"application/json","Content-Type":"application/json"},s.data=JSON.stringify({types:e.types}),t.executeRequest(o,s)},getsecuritycontext:function(e){e.onFailure("DEPRECATED METHOD")},availablesecuritycontext:function(e){e.onFailure("DEPRECATED METHOD")},catalogs:function(e){e.onFailure("DEPRECATED METHOD")}}}),define("DS/PADUtils/utilsWS/WSMiscellaneous",["DS/PADUtils/utilsWS/WSUtils","DS/PADUtils/PADUtilsServices","require"],function(e,t,n){"use strict";var i={url:"/resources/enopad/navigate/getstreamurl",verb:"POST"},o={url:"/resources/v1/collabServices/attributes/op/read",verb:"POST"},s={url:"/resources/v1/collabServices/attributes/op/update",verb:"PUT"},a={url:"/resources/enopad/getfcsurls",verb:"POST"},r={url:"/resources/SNAPI/pq_services/pqs",verb:"GET"},l={url:"/resources/FilterBIAPI/Filter/getFiltersFromIds",verb:"POST"};return{getFcsUrls:function(n){var i=require("DS/PADUtils/PADSettingsMgt"),o=i.getSetting("pad_security_ctx")?i.getSetting("pad_security_ctx"):"preferred";o=encodeURIComponent(o);var s=t.get3DSpaceUrl()+a.url+"?SecurityContext="+o+"&tenant="+t.getPlatformId(),r=n;return r.method=a.verb,r.headers={Accept:"application/json","Content-Type":"application/json"},r.data=JSON.stringify(r.data),e.executeRequest(s,r)},getDownloadUrl:function(n){var o=t.get3DSpaceUrl()+i.url+"?tenant="+t.getPlatformId(),s=n;return s.method=i.verb,s.headers={Accept:"application/json","Content-Type":"application/json"},s.data=JSON.stringify(s.data),e.executeRequest(o,s)},read:function(i){var s,a=i,r=t.get3DSpaceUrl()+o.url+"?tenant="+t.getPlatformId();if(a.method=o.verb,t.isAuthoringCtxAvailable())try{s=n("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").get()}catch(e){console.warn("CfgAuthoringContext throw an error")}return a.headers={Accept:"application/json","Content-Type":"application/json"},s&&""!==s.change.id&&(a.headers["DS-Change-Authoring-Context"]="pid:"+s.change.id),s&&null!==s.AuthoringContextHeader&&UWA.extend(a.headers,s.AuthoringContextHeader),a.cache=-1,delete a.ids,a.onTimeout=a.onTimeout||a.onFailure,a.data=JSON.stringify(a.data),e.executeRequest(r,a)},update:function(i){var o,a=i,r=t.get3DSpaceUrl()+s.url+"?tenant="+t.getPlatformId();if(a.method=s.verb,t.isAuthoringCtxAvailable())try{o=n("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").get()}catch(e){console.warn("CfgAuthoringContext throw an error")}return a.headers={Accept:"application/json","Content-Type":"application/json"},o&&""!==o.change.id&&(a.headers["DS-Change-Authoring-Context"]="pid:"+o.change.id),o&&null!==o.AuthoringContextHeader&&UWA.extend(a.headers,o.AuthoringContextHeader),a.cache=-1,a.onTimeout=a.onTimeout||a.onFailure,a.data=JSON.stringify(a.data),e.executeRequest(r,a)},retrievePQ:function(n){var i=require("DS/PADUtils/PADSettingsMgt"),o=n,s=t.get3DSpaceUrl()+r.url+"?tenant="+t.getPlatformId();return o.method=r.verb,o.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":i.getSetting("lang")},o.cache=-1,o.onTimeout=o.onTimeout||o.onFailure,e.executeRequest(s,o,!1,!0)},getFiltersFromIds:function(n){var i=n,o=t.get3DSpaceUrl()+l.url+"?tenant="+t.getPlatformId();return i.method=l.verb,i.headers={Accept:"application/json","Content-Type":"application/json"},i.cache=-1,i.onTimeout=i.onTimeout||i.onFailure,i.data=JSON.stringify(n.data),e.executeRequest(o,i,!0,!0)}}}),define("DS/PADUtils/utilsWS/PADWSv1",["UWA/Core","DS/PADUtils/utilsWS/WSUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession","require"],function(e,t,n,i,o){"use strict";var s={url:"/resources/enopad/navigate/fetch",verb:"POST"},a={url:"/resources/enopad/navigate/expand",verb:"POST"},r={url:"/resources/enopad/navigate/refresh",verb:"POST"};return{fetch:function(a){var r="",l=a,c=require("DS/PADUtils/PADSettingsMgt");if(!0!==c.getSetting("useLWCWebServices")||!0!==a.enopad_webapis||"stream_2D"===a.data.intent){c.getSetting("pad_security_ctx")&&c.getSetting("pad_security_ctx");if(e.is(a.enopad_webapis)||(a.enopad_webapis=!1),l.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":c.getSetting("lang")},l.timeout||(l.timeout=c.getSetting("webapi_timeout")),!a.enopad_webapis)throw new Error("## PADWSv1.fetch: Invalid inputs enopad_webapis should be set to true");var d=s,u=void 0!==l.data.authored?l.data.authored:i.determineAuthoredFlag();l.method=d.verb,r=n.get3DSpaceUrl()+d.url+"?tenant="+n.getPlatformId();var p={query:"physicalid:"+l.pids.join(" OR physicalid:"),intent:l.data.intent,nresults:l.pids.length,tenant:n.getPlatformId(),authored:u};return void 0===p.include_param_Attributes&&c.getSetting("readsettingsv2")&&(p.include_param_Attributes=!0),l.data=JSON.stringify(p),l.onTimeout=l.onTimeout||l.onFailure,t.executeRequest(r,l)}o(["DS/PADUtils/utilsWS/PADLWCAccess"],function(e){e.fetch(a)})},navigate:function(s){var r=n.get3DSpaceUrl(),l=s,c=require("DS/PADUtils/PADSettingsMgt");if(!0!==c.getSetting("useLWCWebServices")||!0!==s.enopad_webapis){var d=a,u=c.getSetting("pad_security_ctx")?c.getSetting("pad_security_ctx"):"preferred";if(e.is(s.enopad_webapis)||(s.enopad_webapis=!1),s.enopad_webapis)r=r+d.url+"?tenant="+n.getPlatformId();else if("explore_2D"===l.data.intent)r=r+"/cvservlet/expand?SecurityContext="+u+"&tenant="+n.getPlatformId();else{switch(s.expand3DType=void 0===s.expand3DType?"expand3D":s.expand3DType,s.expand3DType){case"expand3D":r=r+"/cvservlet/expand3d?SecurityContext="+u+"&tenant="+n.getPlatformId();break;case"wrap":r=r+"/cvservlet/wrap?SecurityContext="+u+"&tenant="+n.getPlatformId();break;case"progressiveExpand":r=r+"/cvservlet/progressiveexpand?SecurityContext="+u+"&tenant="+n.getPlatformId()}delete s.expand3DType,l.data.fcs_url_mode=c.getSetting("enopad3dviewer_useStaticURL")?"REDIRECT":void 0}if(!e.is(r)||!e.is(l,"object"))throw new Error("## PADWSv1.navigate: Invalid inputs");if(!e.is(l.data,"object"))throw new Error("## PADWSv1.navigate: Invalid inputs options.data not found");if(l.method=d.verb,l.headers={Accept:"application/json","Content-Type":"application/json"},l.timeout||(l.timeout=c.getSetting("webapi_timeout")),c.getSetting("readsettingsv2")&&(l.data.include_param_Attributes=!0),s.enopad_webapis){if(c.getSetting("use_gen_expand")&&(l.data.activate="use_gen_expand"),!e.is(l.data.roots)&&e.is(l.data.root_physicalid)?l.data.roots=[{id:l.data.root_physicalid}]:!e.is(l.data.paths)&&e.is(l.data.root_path_physicalid)&&(l.data.paths=l.data.root_path_physicalid),e.is(l.data.level)||(l.data.level=l.data.expand_iter),e.is(l.data.intent)||(l.data.intent="explore_2D"),e.is(l.data.source)||(l.data.source="cstorage"),e.is(l.data.authored)||e.is(l.data.find_path_filter)||(l.data.authored=void 0!==l.data.authored?l.data.authored:i.determineAuthoredFlag()),delete l.data.root_physicalid,delete l.data.expand_iter,delete l.data.enopad_webapis,delete l.data.compute_select_bo,delete l.data.select_bo,delete l.data.select_rel,delete l.data.select_ds6w_facet,!e.is(l.data.roots)&&!e.is(l.data.paths))throw new Error("## PADWSv1.navigate: Invalid inputs: no root_physical_id or no root_path_physicalid found")}else{delete l.data.intent,delete l.data.authored;var p=c.getWebAPI_Options("navigate");if(!e.is(l.data.root_physicalid)&&!e.is(l.data.root_path_physicalid)&&!e.is(l.data.paths))throw new Error("## PADWSv1.navigate: Invalid inputs: no root_physical_id or no root_path_physicalid found");!e.is(l.data.root_path_physicalid)&&e.is(l.data.paths)&&(l.data.root_path_physicalid=l.data.paths),e.is(l.data.expand_iter)||e.is(l.find_in_ctx)||(l.data.expand_iter=c.getSetting("expand_iter")),e.is(l.data.select_bo)||(l.data.select_bo=p.select_bo),e.is(l.data.select_rel)||(l.data.select_rel=p.select_rel)}return l.onTimeout=l.onTimeout||l.onFailure,l.data=JSON.stringify(l.data),t.executeRequest(r,l)}o(["DS/PADUtils/utilsWS/PADLWCAccess"],function(e){e.expand(s)})},refresh:function(s){var a=require("DS/PADUtils/PADSettingsMgt");if(!0===a.getSetting("useLWCWebServices"))o(["DS/PADUtils/utilsWS/PADLWCAccess"],function(e){e.refresh(s)});else{var l=r,c=n.get3DSpaceUrl()+l.url+"?tenant="+n.getPlatformId();if(!e.is(c)||!e.is(s,"object"))throw new Error("## PADWSv1.refresh: Invalid inputs");if(!e.is(s.data,"object"))throw new Error("## PADWSv1.refresh: Invalid inputs - options.data not found");s.method=l.verb,s.headers={Accept:"application/json","Content-Type":"application/json"},a.getSetting("use_gen_expand")&&(s.data.activate="use_gen_expand"),e.is(s.data.intent)||(s.data.intent="explore_2D"),e.is(s.data.source)||(s.data.source="cstorage"),a.getSetting("readsettingsv2")&&(s.data.include_param_Attributes=!0),s.data.authored=s.data.authored?s.data.authored:!i.isUsingIndex(),s.onTimeout=s.onTimeout||s.onFailure,s.data=JSON.stringify(s.data),t.executeSplittedRequest(c,s,{max:1,init:{query:{split:!0},response:{packets:"packets"}},packet:{query:{packet:"packet",remove:["session"]},response:{concat:["results"],copy:["full_path"]}}})}},getDerivedOutputs:function(t){if(!e.is(t)||!e.is(t.pids))throw new Error("## PADWSv1.getDerivedOutputs: Invalid inputs");require("DS/PADUtils/PADSettingsMgt");t.enopad_webapis=!0,e.is(t.data)||(t.data={}),t.data.intent="stream_2D",this.fetch(t)}}}),define("DS/PADUtils/utilsWS/WS4DECModel",["DS/PADUtils/utilsWS/WSUtils","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],function(e,t,n){"use strict";var i={modify:{url:"/resources/enopad/authoring/modify",verb:"POST"},insertexisting:{url:"/resources/enopad/authoring/insertexisting",verb:"POST"},replace:{url:"/resources/enopad/authoring/replace",verb:"POST"},reorder:{url:"/resources/enopad/authoring/reorder",verb:"POST"},reparent:{url:"/resources/enopad/authoring/reparent",verb:"POST"},unparent:{url:"/resources/enopad/authoring/unparent",verb:"POST"},deleteinstance:{url:"/resources/enopad/authoring/deleteinstance",verb:"POST"},composite:{url:"/resources/enopad/authoring/composite",verb:"POST"},editability:{url:"/resources/enopad/navigate/editability",verb:"POST"},navigate:{url:"/resources/enopad/navigate/navigate",verb:"POST"},completeselection:{url:"/resources/enov5ma/productstructure/completeselection",verb:"POST"}},o=function(n,o){var s=require("DS/PADUtils/PADSettingsMgt"),a=i[o],r=UWA.clone(n,!1);r.method=a.verb,r.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},"object"==typeof r.data&&(r.data=JSON.stringify(r.data));var l=t.get3DSpaceUrl()+a.url+"?tenant="+t.getPlatformId();return console.group(),console.error("======================================="),console.error("=== DEPRECATED USAGE OF THIS WEBAPI ==="),console.error("===    ["+o+"]    ==="),console.error("======================================="),console.groupEnd(),e.executeRequest(l,r)};return{modify:function(n){if(!UWA.is(n,"object"))throw new Error("No parameter defined");if(!UWA.is(n.data,"array"))throw new Error("No input data defined");if(!UWA.is(n.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(n.onFailure,"function"))throw new Error("No onFailure callback function defined");var o={nodes:n.data,commit:!0},s=i.modify,a=t.get3DSpaceUrl();a=a+s.url+"?tenant="+t.getPlatformId();var r={};return r.method=s.verb,r.headers={Accept:"application/json","Content-Type":"application/json"},r.data=JSON.stringify(o),r.onComplete=n.onComplete,r.onFailure=n.onFailure,r.onTimeout=n.onTimeout||n.onFailure,console.group(),console.error("======================================="),console.error("=== DEPRECATED USAGE OF THIS WEBAPI ==="),console.error("===           [modify]              ==="),console.error("======================================="),console.groupEnd(),e.executeRequest(a,r)},insertExisting:function(e){o(e,"insertexisting")},replace:function(e){o(e,"replace")},reorder:function(e){o(e,"reorder")},reParent:function(e){o(e,"reparent")},detach:function(e){o(e,"unparent")},deleteInstance:function(e){o(e,"deleteinstance")},composite:function(e){o(e,"composite")},getEditability:function(o){if(!UWA.is(o,"object"))throw new Error("No options defined");if(!UWA.is(o.data,"object"))throw new Error("No data defined");if(!UWA.is(o.data.ids,"array"))throw new Error("No physicalids defined");if(!UWA.is(o.data.intent,"string"))throw new Error("No intent defined");if(!UWA.is(o.data.name,"array"))throw new Error("No criteria defined");if(!UWA.is(o.data.authored,"boolean"))throw new Error("No authored defined");if(!UWA.is(o.data.lang,"string"))throw new Error("No language defined");if(!UWA.is(o.onComplete,"function"))throw new Error("No onComplete defined");if(!UWA.is(o.onFailure,"function"))throw new Error("No onFailure defined");var s=i.editability,a=t.get3DSpaceUrl()+s.url+"?tenant="+t.getPlatformId();return o.method=s.verb,o.headers={Accept:"application/json","Content-Type":"application/json"},"move"===o.data.name[0]&&"explore_3D"===o.data.intent&&(o.data.rel_physicalid=o.data.ids,delete o.data.ids),UWA.is(o.data.source)||(o.data.source="cstorage"),o.data.authored=o.data.authored?o.data.authored:!n.isUsingIndex(),o.onTimeout=o.onTimeout||o.onFailure,o.data=JSON.stringify(o.data),console.group(),console.error("======================================="),console.error("=== DEPRECATED USAGE OF THIS WEBAPI ==="),console.error("===        [getEditability]         ==="),console.error("======================================="),console.groupEnd(),e.executeRequest(a,o)},navigateOnLinks:function(o){if(!UWA.is(o,"object"))throw new Error("No options defined");if(!UWA.is(o.data,"object"))throw new Error("No data defined");if(!UWA.is(o.data.intent,"string"))throw new Error("No intent defined");if(!UWA.is(o.data.authored,"boolean"))throw new Error("No authored defined");if(!UWA.is(o.data.nav_pattern,"array"))throw new Error("No nav_pattern defined");if(!UWA.is(o.data.nav_pattern[0].name,"string"))throw new Error("No criteria defined");if(!UWA.is(o.data.nav_pattern[0].direction,"string"))throw new Error("No direction defined");if(!UWA.is(o.data.nav_pattern[0].physicalid,"array"))throw new Error("No ids defined");if(!UWA.is(o.onComplete,"function"))throw new Error("No onComplete defined");if(!UWA.is(o.onFailure,"function"))throw new Error("No onFailure defined");var s=i.navigate,a=t.get3DSpaceUrl()+s.url+"?tenant="+t.getPlatformId();if(!UWA.is(a))throw new Error("Invalid inputs for PADWSAccess.navigateOnLinks");return o.method=s.verb,o.headers={Accept:"application/json","Content-Type":"application/json"},UWA.is(o.data.source)||(o.data.source="cstorage"),o.data.authored=o.data.authored?o.data.authored:!n.isUsingIndex(),o.onTimeout=o.onTimeout||o.onFailure,o.data=JSON.stringify(o.data),console.group(),console.error("======================================="),console.error("=== DEPRECATED USAGE OF THIS WEBAPI ==="),console.error("===        [navigateOnLinks]        ==="),console.error("======================================="),console.groupEnd(),e.executeRequest(a,o)},completeselection:function(n){var o=i.completeselection,s=t.get3DSpaceUrl()+o.url+"?tenant="+t.getPlatformId();return n.method=o.verb,n.headers={Accept:"application/json","Content-Type":"application/json"},n.onTimeout=n.onTimeout||n.onFailure,n.data=JSON.stringify(n.data),console.group(),console.error("======================================="),console.error("=== DEPRECATED USAGE OF THIS WEBAPI ==="),console.error("===       [completeselection]       ==="),console.error("======================================="),console.groupEnd(),e.executeRequest(s,n)}}}),define("DS/PADUtils/utilsWS/WSAccessV1",["UWA/Core","DS/PADUtils/PADSession","DS/PADUtils/Configuration","DS/PADUtils/utilsWS/WSAdmin","DS/PADUtils/utilsWS/WSMiscellaneous","DS/PADUtils/utilsWS/CVServletServices","DS/PADUtils/utilsWS/PADWSv1"],function(e,t,n,i,o,s,a){"use strict";var r={fetch:function(e){return!0!==n.getConfig("readOnlyApp")&&!0===e.enopad_webapis||!0===e.forceAuthoringCall?a.fetch(e):s.fetch(e)},navigate:function(e){if(!0===n.getConfig("readOnlyApp")||!0!==e.enopad_webapis){var t="explore_2D"===e.data.intent?"expand":void 0===e.expand3DType?"expand3D":e.expand3DType;return"expand"===t?s.expand(e):(e.expand3DType=t,s.expand3d(e))}return a.navigate(e)},progressiveExpand:function(e){return s.progressiveExpand(e)},searchV2:function(e){return s.searchV2(e)},multiexpand:function(e){var i=!1;return!1===n.getConfig("readOnlyApp")&&(i=e.data&&void 0!==e.data.authored?e.data.authored:t.determineAuthoredFlag()),!0===i&&console.warn("No multiexpand in authoring mode. Call on the index instead"),s.multiexpand(e)},volumeQuery:function(e){return s.volumeQuery(e)},refresh:function(e){return e.data.deepRefresh?s.refresh(e):a.refresh(e)},getDerivedOutputs:function(e){require(["DS/PADUtils/utilsWS/PADWSv1"],function(t){t.getDerivedOutputs(e)})}};return r=e.extend(r,i),r=e.extend(r,o)}),define("DS/PADUtils/utilsWS/LWCDirectAccess",["UWA/Core","DS/PADUtils/utilsWS/WSUtils","DS/PADUtils/PADUtilsServices"],function(e,t,n){"use strict";var i={url:"/resources/enoauthoring/fetch/v1",verb:"POST"},o={url:"/resources/enoauthoring/expand/v1",verb:"POST"},s={url:"/resources/enoauthoring/expand/v2",verb:"POST"};return{fetch:function(o){var s=require("DS/PADUtils/PADSettingsMgt"),a=s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):"preferred";a=encodeURIComponent(a);var r=n.get3DSpaceUrl()+i.url+"?SecurityContext="+a+"&tenant="+n.getPlatformId(),l=o.data;delete o.data;var c=e.extend({method:i.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},timeout:o.timeout?o.timeout:s.getSetting("webapi_timeout")},o),d=require("DS/PADServices/utils/AttributesMgtV2"),u=e.extend({label:n.getRequestLabel(),physicalid:o.pids,locale:s.getSetting("lang"),tenant:n.getPlatformId(),types:d.getSelectedTypes(),extensions:d.getSelectedExtensions()},l);return u="fetch_3D"===u.intent?t.completeWebAPIPayload("fetch3d",u,o):t.completeWebAPIPayload("fetch2d",u,o),delete c.pids,delete c.enopad_webapis,delete u.intent,delete u.authored,u.select_predicate=u.select_predicate.filter(function(e,t,n){return n.indexOf(e)===t}),c.data=JSON.stringify(u),c.onTimeout=c.onTimeout||c.onFailure,t.executeRequest(r,c)},expand:function(i){var s=require("DS/PADUtils/PADSettingsMgt"),a=s.getSetting("pad_security_ctx")?s.getSetting("pad_security_ctx"):"preferred";a=encodeURIComponent(a);var r=n.get3DSpaceUrl()+o.url+"?SecurityContext="+a+"&tenant="+n.getPlatformId(),l=i.data;delete i.data;var c=e.extend({method:o.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":s.getSetting("lang")},timeout:i.timeout?i.timeout:s.getSetting("webapi_timeout")},i),d=[];e.is(l.roots)?d=l.roots:e.is(l.root_physicalid)?d=[[l.root_physicalid]]:e.is(l.paths)?d=l.paths:e.is(l.root_path_physicalid)&&(d=l.root_path_physicalid);var u=require("DS/PADServices/utils/AttributesMgtV2"),p=e.extend({label:n.getRequestLabel(),root_path_physicalid:d,locale:s.getSetting("lang"),tenant:n.getPlatformId(),types:u.getSelectedTypes(),extensions:u.getSelectedExtensions()},l);return p="explore_3d"===p.intent.toLowerCase()?t.completeWebAPIPayload("expand3d",p,i):t.completeWebAPIPayload("expand",p,i),delete c.pids,delete c.enopad_webapis,delete p.intent,delete p.authored,delete p.root_physicalid,p.select_bo=p.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),p.select_rel=p.select_rel.filter(function(e,t,n){return n.indexOf(e)===t}),c.data=JSON.stringify(p),c.onTimeout=c.onTimeout||c.onFailure,t.executeRequest(r,c)},expandV2:function(i){var a=require("DS/PADUtils/PADSettingsMgt"),r=a.getSetting("pad_security_ctx")?a.getSetting("pad_security_ctx"):"preferred";r=encodeURIComponent(r);var l=n.get3DSpaceUrl()+s.url+"?SecurityContext="+r+"&tenant="+n.getPlatformId(),c=i.data;delete i.data;var d=e.extend({method:o.verb,headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":a.getSetting("lang")},timeout:i.timeout?i.timeout:a.getSetting("webapi_timeout")},i),u=[];e.is(c.roots)?u=c.roots:e.is(c.root_physicalid)?u=[[c.root_physicalid]]:e.is(c.paths)?u=c.paths:e.is(c.root_path_physicalid)&&(u=c.root_path_physicalid);var p=require("DS/PADServices/utils/AttributesMgtV2"),h=e.extend({label:n.getRequestLabel(),root_path_physicalid:u,locale:a.getSetting("lang"),tenant:n.getPlatformId(),types:p.getSelectedTypes(),extensions:p.getSelectedExtensions()},c);return h="explore_3d"===h.intent.toLowerCase()?t.completeWebAPIPayload("expand3d",h,i):t.completeWebAPIPayload("expand",h,i),delete d.pids,delete d.enopad_webapis,delete h.intent,delete h.authored,delete h.root_physicalid,h.select_bo=h.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),h.select_rel=h.select_rel.filter(function(e,t,n){return n.indexOf(e)===t}),d.data=JSON.stringify(h),d.onTimeout=d.onTimeout||d.onFailure,t.executeRequest(l,d)},refresh:function(t){var n=[],i=[];e.is(t.data.session)&&t.data.session.length>0&&t.data.session.forEach(function(e){e.forEach(function(t){if(t.length>2){var o=t.filter(function(e,t,i){return t%2==0&&t<i.length-2&&!n.includes(e)});n=n.concat(o)}1==e.length&&1==t.length&&(i.push(t[0]),n.push(t[0]))})});var o=[];if(n.forEach(function(e){o.push(new Array(e))}),i.length>0){var s=e.extend({pids:i},t),a=s.onComplete;s.onComplete=function(t){var n=e.is(t,"string")?JSON.parse(t):t;n.full_path=!0,n.results.forEach(function(e){for(var t=0;t<e.attributes.length;t++)if("physicalid"===e.attributes[t].name||"resourceid"===e.attributes[t].name){var i=e.attributes[t].value;e.attributes.push({name:"did",value:i}),n.results.push({path:[i]});break}}),t=JSON.stringify(n),e.is(a,"function")&&a(t)},this.fetch(s)}var r=t;r.data.sessions=r.data.session,delete r.data.session,r.data=e.extend({root_path_physicalid:o,expand_iter:"1"},t.data);a=r.onComplete;r.onComplete=function(t){var n=e.is(t,"string")?JSON.parse(t):t;n.full_path=!1,t=JSON.stringify(n),e.is(a,"function")&&a(t)},this.expand(r)},getDerivedOutputs:function(e){console.group(),console.log("======================================="),console.log("== LWCDirectAccess.getDerivedOutputs =="),console.log("== Fallback on WSAccessV1            =="),console.log("======================================="),console.groupEnd(),require(["DS/PADUtils/utilsWS/WSAccessV1"],function(t){t.getDerivedOutputs(e)})}}}),define("DS/PADUtils/PADWSProxy",["UWA/Core","DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","UWA/Promise","DS/PADUtils/utilsWS/WSUtils","require"],function(e,t,n,i,o,s){function a(e,t,n){return new i(function(i,s){t.onComplete=function(e){var t=function(e){return"string"==typeof e?JSON.parse(e):e}(e),o=t;n&&(o=n(t)),i(o)},t.onFailure=function(e){s(e)},t.data&&(t.data=JSON.stringify(t.data)),o.executeRequest(e,t,!1)})}return{getcainfo:function(e){var t=s("DS/PADUtils/PADSettingsMgt"),i=e||{},o=n.get3DSpaceUrl()+"/resources/modeler/change/changeaction/pid:"+e.id+"?attributes=1&context=1&people=1&applicability=1&proposed=1&realized=1";return i.method="GET",i.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getSetting("lang")},a(o,i)},find_in_ctx:function(t){var i=n.get3DSpaceUrl(),o={},r=s("DS/PADUtils/PADSettingsMgt");i=i+"/cvservlet/expand?SecurityContext=preferred&tenant="+n.getPlatformId(),o.method="POST",o.headers={Accept:"application/json","Content-Type":"application/json"};var l=r.getWebAPI_Options("navigate");l.select_bo||(l={select_bo:["physicalid"],select_rel:["physicalid"]});for(var c=e.extend({label:n.getRequestLabel(),root_physicalid:t.rootId},l,!0),d=[],u=[],p=0;p<t.findids.length;p++)u.push([t.findids[p]]);return d.push({option:["cut"],path_physicalid:u}),c.find_path_filter=d,o.data=c,o.timeout=r.getSetting("webapi_timeout"),a(i,o,function(e){return{params:t,results:e}})}}}),define("DS/PADUtils/PADChangeActionHandler",["DS/PADUtils/PADWSProxy","DS/PADUtils/views/PADAlert","UWA/Promise","i18n!DS/PADUtils/assets/nls/PADUtils.json"],function(e,t,n,i){function o(e,t){for(var n,i=[],o=0;o<e.length;o++){var a=e[o],r=a.id;!0===t&&(r=a.where.id),s(i,(n=r).substr(n.indexOf(":")+1))}return i}function s(e,t){-1===e.indexOf(t)&&e.push(t)}function a(e,t){for(var n=0;n<t.length;n++)s(e,t[n])}return{extractIds:o,extractRealizedAndProposed:function(e){var t=o(e.changeaction.realized,!0);return a(t,o(e.changeaction.proposed,!0)),t},getInfos:function(o,s,a){for(var r=[],l=0;l<o.length;l++){var c=e.getcainfo({id:o[l]});r.push(c)}n.all(r).then(function(e){s(e)}).catch(function(e){t.displayNotification({eventID:"error",msg:i.generic_service_failure,key:"padUtils-getInfos-generic-service-failure"}),console.error(e),a&&a(e)})},determineExecution:function(e,n){if(e.changeaction.context.length>0&&e.changeaction.realized.length>0)n.addAndFind(e);else{var s=(c=(l=(l=[]).concat(o((r=e).changeaction.context))).length,a(l,o(r.changeaction.realized,!0)),l.length>c&&a(l,o(r.changeaction.proposed,!0)),l);s.length>0?n.add(s):(t.displayNotification({eventID:"warning",msg:i.WARN_empty_change_action}),n.wasEmpty())}var r,l,c}}}),define("DS/PADUtils/utilsWS/WSAccessV2",["UWA/Core","DS/PADUtils/PADSession","DS/PADUtils/Configuration","DS/PADUtils/utilsWS/WSAdmin","DS/PADUtils/utilsWS/WSMiscellaneous","DS/PADUtils/utilsWS/LWCDirectAccess","DS/PADUtils/utilsWS/CVServletServices","DS/PADUtils/utilsWS/WS4DECModel"],function(e,t,n,i,o,s,a,r){"use strict";var l={version:2,fetch:function(e){var i=!1;return!1===n.getConfig("readOnlyApp")&&(i=e.data&&void 0!==e.data.authored?e.data.authored:t.determineAuthoredFlag()),!0===i?s.fetch(e):a.fetch(e)},navigate:function(e){var i=!1;if(!1===n.getConfig("readOnlyApp")&&!0===e.enopad_webapis&&(i=e.data&&void 0!==e.data.authored?e.data.authored:t.determineAuthoredFlag()),!0===i)return e.data.timeout&&(e.timeout=e.data.timeout),s.expand(e);var o="explore_2D"===e.data.intent?"expand":void 0===e.expand3DType?"expand3D":e.expand3DType;return"expand"===o?a.expand(e):(e.expand3DType=o,a.expand3d(e))},navigateV2:function(e){return s.expandV2(e)},multiexpand:function(e){var i=!1;return!1===n.getConfig("readOnlyApp")&&(i=e.data&&void 0!==e.data.authored?e.data.authored:t.determineAuthoredFlag()),!0===i&&console.warn("No multiexpand in authoring mode. Call on the index instead"),a.multiexpand(e)},progressiveExpand:function(e){var n=null;if(!e.readOnly&&t.determineAuthoredFlag()){var i={data:{select_rel:e.data.select_rel,select_bo:e.data.select_bo,compute_select_bo:e.data.compute_select_bo,boundingbox:e.data.boundingbox,root_path_physicalid:e.data.root_path_physicalid,fcs_url_mode:e.data.fcs_url_mode,expand_iter:e.data.expand_iter,intent:"explore_3d"},onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout,timeout:6e4};n=this.navigateV2(i)}else n=a.progressiveExpand(e);return n},getRootStats:function(e){var n=null;if(!e.readOnly&&t.determineAuthoredFlag()){var i={data:{select_rel:e.data.select_rel,select_bo:e.data.select_bo,compute_select_bo:e.data.compute_select_bo,boundingbox:!0,root_path_physicalid:e.data.root_path_physicalid?e.data.root_path_physicalid:[[e.data.rootPhID]],fcs_url_mode:e.data.fcs_url_mode,expand_iter:"0",intent:"explore_3d"},onComplete:function(e,t,n){try{var i="string"==typeof n?JSON.parse(n):n;i.results&&i.results.length&&(i.results.push({synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:-1}}),i.results.push({synthesis:{name:"ProgressiveExpand_OccSynthesis",value:-1}}),i.results.push({synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:-1}})),e(JSON.stringify(i))}catch(e){t()}}.bind(this,e.onComplete,e.onFailure),onFailure:e.onFailure,onTimeout:e.onTimeout,timeout:6e4};n=this.navigateV2(i)}else n=a.getRootStats(e);return n},getStaticMappingExcludedOccurrences:function(e){return a.getStaticMappingExcludedOccurrences(e)},getFlexibleAssemblies:function(e){return a.getFlexibleAssemblies(e)},volumeQuery:function(e){return a.volumeQuery(e)},volumeQueryV2:function(e){return a.volumeQueryV2(e)},getMinMaxDistanceCandidates:function(e){return a.getMinMaxDistanceCandidates(e)},search:function(e){return a.search(e)},searchV2:function(e){return a.searchV2(e)},refresh:function(e){if(e.data.deepRefresh)return a.refresh(e);var i=!1;if(!1===n.getConfig("readOnlyApp")&&(i=e.data&&void 0!==e.data.authored?e.data.authored:t.determineAuthoredFlag()),!i&&e.data.session){for(var o=[],r=0;r<e.data.session.length;r++)o=o.concat(e.data.session[r]);return e.data.root_path_physicalid=o,a.refresh(e)}return s.refresh(e)},getDerivedOutputs:function(e){return s.getDerivedOutputs(e)}};return l=UWA.extend(l,i),l=UWA.extend(l,o),l=UWA.extend(l,r)}),define("DS/PADUtils/PADWSAccess",["DS/PADUtils/Configuration","DS/PADUtils/utilsWS/WSAccessV1","DS/PADUtils/utilsWS/WSAccessV2"],function(e,t,n){return!0===e.getConfig("WSAccessV2")?n:t}),define("DS/PADUtils/views/parametrization/TypesSelectionModal",["css!DS/UIKIT/UIKIT","css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/Controls/ComboBox","DS/Controls/Button","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPromise","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/UIKIT/Mask","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/PADUtils/views/parametrization/SearchSelector","DS/Utilities/Utils"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,h,g,f,m,_,v){"use strict";return o.extend(s,{name:"typesSelectionModal",defaultOptions:{typesdocument:null,typestreelist:null,modal:null,alreadySelectedTypes:[],filterInProgress:!1},init:function(e){this._parent(e),this.options.typesdocument=new p;for(var t=0;t<e.selectedTypes.length;t++)this.options.alreadySelectedTypes.push(e.selectedTypes[t].options.grid.cvName);var o=this;if(e.inMainView){o.elements.container=i.createElement("div",{class:o.getClassNames("-immersivePanel")}),(s=this._buildTypesSelectionView(!0)).inject(o.elements.container),o.options.modelEvts.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:o.elements.container}}),o.elements.panel2small=i.createElement("div",{class:o.getClassNames("-panel2small"),text:n.panel2small}).inject(o.elements.container)}else{var s=this._buildTypesSelectionView();this.options.modal=new a({className:this.name+"_modal",closable:!0,okButtonText:n.ok,koButtonText:n.cancel,animate:!0}),this.options.modal.dialog({title:n.selectTypes,body:s,buttons:[{className:"primary",value:n.ok,action:function(e){var t=o.options.typesdocument.search({match:function(e){if(-1!==o.options.alreadySelectedTypes.indexOf(e.nodeModel.options.grid.cvName))return!0}});o.dispatchEvent("onTypesSelected",{selectedTypes:t}),e.hide()}},{value:n.cancel,action:function(e){e.hide()}}]})}},_buildTypesSelectionView:function(e){this.elements.typesBody=i.createElement("div",{class:this.name+"-typesbody"}),this.elements.typesSearch=i.createElement("div",{class:this.name+"-typessearch"}).inject(this.elements.typesBody),(a=this).options.typesdocument.getXSO().onPostAdd(function(){for(var e=a.options.typesdocument.getSelectedNodes(),t=0;t<e.length;t++)-1===a.options.alreadySelectedTypes.indexOf(e[t].options.grid.cvName)&&a.options.alreadySelectedTypes.push(e[t].options.grid.cvName)}),a.options.typesdocument.getXSO().onPostRemove(function(e){if(!1===a.options.filterInProgress)for(var t=e,n=0;n<t.length;n++){var i=a.options.alreadySelectedTypes.indexOf(t[n].options.grid.cvName);-1!==i&&a.options.alreadySelectedTypes.splice(i,i+1)}});var t=v.debounce(function(e){a.options.typesdocument.withTransactionUpdate(function(){var t=e.searchStr,n=!0;a.options.filterInProgress=!0,a.options.typesdocument.search({match:function(e){new RegExp(t,"i").test(e.nodeModel.getLabel())?(e.nodeModel.show(),-1!==a.options.alreadySelectedTypes.indexOf(e.nodeModel.options.grid.cvName)&&e.nodeModel.select(),t.length>0&&n?(e.nodeModel.matchSearch(),n=!1,a.elements.typeSelSearch.navigationState(!0,!1)):e.nodeModel.unmatchSearch()):(e.nodeModel.unmatchSearch(),e.nodeModel.hide()),a.options.typestreelist.getManager().forceMultiSelection(!0)}}),a.options.filterInProgress=!1}),a.options.typesdocument.getXSO().onPostAdd(function(){}),a.options.typesdocument.getXSO().onPostRemove(function(){})},500),o=function(e){var t=a.options.typesdocument.search({match:function(e){return e.nodeModel.isMatchingSearch()}}),n=a.options.typesdocument.search({match:function(e){return e.nodeModel.isVisible()}});a.options.typesdocument.withTransactionUpdate(function(){if(1===t.length){var i=t[0],o=n.indexOf(i),s="next"===e?o+1:o-1;i.unmatchSearch();var r=n[s];if(r){r.matchSearch(),a.options.typestreelist.getManager().scrollToNode(r);var l=0===s,c=s===n.length-1;a.elements.typeSelSearch.navigationState(l,c)}}})};this.elements.typeSelSearch=new _({placeholder:n.enterTypeName,withNavigation:!0,events:{onSearch:t,onNext:o,onPrevious:o}}).inject(this.elements.typesSearch),this.elements.typesList=i.createElement("div",{class:this.name+"-typeslist"}).inject(this.elements.typesBody);var s={height:"auto",selection:{enableListSelection:!0,toggle:!0},defaultCellHeight:30,enableDragAndDrop:!1,enableActiveUI:!0,enableKeyboardNavigation:!0,enableTreeColumnEllipsisOverflow:!0,performances:{preloadPool:!0,useRequestAnimationFrameRendering:!1},resize:{columns:!1},isEditable:!0,columns:[{width:40,minWidth:40,maxWidth:40,dataIndex:"selection",type:"selection",isDraggable:!1,isHidden:!1,isColumnMovable:!1},{width:"auto",dataIndex:"tree",text:n.typeName,isDraggable:!1,isColumnMovable:!1,isEditable:!1,isSortable:!0}]};this.options.typestreelist=new u(s),e||this.options.typestreelist.getContent().setStyles({position:"absolute",top:0,left:0,bottom:0,right:0}),this.options.typestreelist.getContent().addClassName(this.name+"-typestreelist"),this.options.typestreelist.getManager().loadDocument(this.options.typesdocument),this.options.typestreelist.getManager().forceMultiSelection(!0),this.options.typestreelist.getContent().inject(this.elements.typesList);var a=this;return g.mask(this.elements.typesBody),this._retrieveAvailableTypesForVocab(function(){g.unmask(a.elements.typesBody)}),e&&this._buildFooter().inject(a.elements.typesBody),this.elements.typesBody},_retrieveAvailableTypesForVocab:function(e){var t=this;function n(n){var o=i.is(n,"string")?JSON.parse(n):n;t.options.typesdocument.withTransactionUpdate(function(){for(var e=0;e<o.vocabularyClassInfo.length;e++){var n=new h({label:o.vocabularyClassInfo[e].nlsName,children:null,grid:{name:o.vocabularyClassInfo[e].name,cvName:o.vocabularyClassInfo[e].uri}});t.options.typesdocument.addRoot(n),-1!==t.options.alreadySelectedTypes.indexOf(n.options.grid.cvName)&&n.select()}}),e&&e()}var o=localStorage.getItem("VocabularyClasses-"+f.getSetting("lang")+"-"+m.getPlatformId());o?n(o):!0===f.getSetting("FedDictionnaryAccess")?require(["DS/PADUtils/PADDictionaryAccess"],function(n){n.getVocabularyClasses("ds6wg",{tenantId:m.getPlatformId(),lang:f.getSetting("lang"),apiVersion:"R2019x",onComplete:function(n){t.options.typesdocument.withTransactionUpdate(function(){for(var e=0;e<n.classes.length;e++){var i=new h({label:n.classes[e].label,children:null,grid:{name:n.classes[e].curi,cvName:n.classes[e].curi}});t.options.typesdocument.addRoot(i),-1!==t.options.alreadySelectedTypes.indexOf(i.options.grid.cvName)&&i.select()}}),e&&e()}})}):c.getVocabularyClasses({vocabularyname:"ds6wg",onComplete:function(e){n(e),localStorage.setItem("VocabularyClasses-"+f.getSetting("lang")+"-"+m.getPlatformId(),i.is(e,"string")?e:JSON.stringify(e))}})},_buildFooter:function(){var e=this,t=i.createElement("div",{class:this.name+"-footerModal"}),o=new l({label:n.ok,emphasize:"primary",touchMode:!0});o.addEventListener("click",function(){var t=e.options.typesdocument.search({match:function(t){if(-1!==e.options.alreadySelectedTypes.indexOf(t.nodeModel.options.grid.cvName))return!0}});e.dispatchEvent("onTypesSelected",{selectedTypes:t})}),o.inject(t);var s=new l({label:n.cancel,touchMode:!0});return s.inject(t),s.addEventListener("click",function(){e.dispatchEvent("onTypesSelected",{cancel:!0})}),t}})}),define("DS/PADUtils/views/parametrization/SelectionManagement",["css!DS/UIKIT/UIKIT","css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","text!DS/PADUtils/assets/DefaultAttrParametrization.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Promise","DS/Controls/ComboBox","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/PADUtils/PADWSAccess","DS/Controls/Button","DS/UIKIT/Mask","DS/PADUtils/views/parametrization/ComboSelector","DS/PADUtils/views/parametrization/TypesSelectionModal","DS/PADUtils/PADDictionaryAccess","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,h,g,f,m,_,v){"use strict";var S=JSON.parse(i);return s.extend(a,{name:"selectionMgt",defaultOptions:{defaultTypes:["VPMReference","VPMRepReference","3DShape"],typeModel:null,availableAttr:null,selectedAttrModel:null,addTypeOpen:!1},init:function(e){this._parent(e),this.elements.container=o.createElement("div",{class:this.getClassNames(!0===e.inMainView?"-immersive":"")}).inject(e.renderTo);var t=this;this.options.typeModel=new c;var n=new r(function(e){var n=function(n){for(var i=0;i<t.options.defaultTypes.length;i++){var o=t.options.defaultTypes[i];n&&n["ds6w:type"]&&n["ds6w:type"][t.options.defaultTypes[i]]&&(o=n["ds6w:type"][t.options.defaultTypes[i]]);var s=new d({label:o,grid:{name:t.options.defaultTypes[i],cvName:"ds6wg:"+t.options.defaultTypes[i]},children:null});t.options.typeModel.addRoot(s),s.select()}e()};m.getNlsOfPropertiesValues(JSON.stringify({"ds6w:type":t.options.defaultTypes}),{tenantId:_.getPlatformId(),lang:v.getSetting("lang"),onComplete:function(e){n(e)},onFailure:function(e){console.error("PADDictionaryAccess.getNlsOfPropertiesValues API fails for "+JSON.stringify({"ds6w:type":t.options.defaultTypes})),n(null)}})});this._buildTypesSelection(n),this._buildAttributesSelection(n)},addAttribute:function(e){this.options.availableAttr.addRoot(e)},removeSpecificColumn:function(e){var t=this.options.specificAttr.search({match:function(t){if(t.nodeModel.options.grid.name===e)return!0}});1===t.length&&t[0].unselect()},_buildTypesSelection:function(e){var t=this,i=o.createElement("div",{class:this.getClassNames("_typesSelection")}).inject(this.elements.container),s=function(){for(var e=t.options.typeModel.getSelectedNodes(),i=[],o=0;o<e.length;o++)i.push(e[o].options.grid.cvName);i.length?(t.elements.attrSelCombo.disabled=!1,h.mask(t.elements.attrSelCombo.getContent(),n.fetchingAttributes),t.elements.attrTypeCombo.disabled(!0),t._retrieveAvailableAttrForVocab(i,function(){t.elements.attrTypeCombo.disabled(!1),h.unmask(t.elements.attrSelCombo.getContent())})):t.elements.attrSelCombo.disabled=!0};t.elements.attrTypeCombo=new g({className:"typeSelector",treedocument:t.options.typeModel,title:n.typesOfAttributes,withMore:!0,disabled:!0,events:{onSelectionChange:s,onMore:function(){new f({inMainView:t.options.inMainView,modelEvts:t.options.modelEvts,selectedTypes:t.options.typeModel.getSelectedNodes(),events:{onTypesSelected:function(e){if(!0===e.cancel)t.dispatchEvent("onResetParameters");else{t.options.typeModel.empty();for(var n=0;n<e.selectedTypes.length;n++){var i=new d({label:e.selectedTypes[n].getLabel(),grid:{name:e.selectedTypes[n].options.grid.name,cvName:e.selectedTypes[n].options.grid.cvName},children:null});t.options.typeModel.addRoot(i),i.select()}s(),t.dispatchEvent("onResetParameters")}}}})}}}).inject(i)},_buildAttributesSelection:function(e){var t=this;t.options.availableAttr=new c,t.elements.attrSelection=o.createElement("div",{class:this.getClassNames("_attrSelection")}).inject(this.elements.container),t.elements.attrSelCombo=new l({expanderIcon:"expand-down",elementsTree:t.options.availableAttr,placeholder:n.treelistparam_selectAttr,touchMode:!0,enableSearchFlag:!0,reachablePlaceholderFlag:!0}).inject(t.elements.attrSelection);var i=t.elements.attrSelCombo.getContent();this.options.maskTarget&&(i=this.options.maskTarget),h.mask(i,n.fetchingAttributes);var s=o.createElement("div",{class:this.getClassNames("_specificAttrSelection")}).inject(this.elements.container);t.options.specificAttr=new c,t.elements.specificAttrSelCombo=new g({className:"typeSelector",treedocument:t.options.specificAttr,title:n.displayOptions,events:{onSelect:function(e){var i=!1,o=!0;"instanceName"===e.options.grid.name&&(i=!0,o=!1);var s=n[e.options.grid.name]?n[e.options.grid.name]:n["treelistview_customization_"+e.options.grid.name];t.options.selectedAttrModel.addRoot({label:s,grid:{name:e.options.grid.name,cvName:e.options.grid.name,isVisibilityLock:!1,isExportLock:o,exported:i,isHardcodedCol:!0},children:null})},onUnselect:function(e){var n=t.options.selectedAttrModel.search({match:function(t){if(t.nodeModel.options.grid.cvName===e.options.grid.name)return!0}});1===n.length&&t.dispatchEvent("onRemoveSpecificAttr",{removedNode:n[0]})}}}).inject(s);for(var a=0;a<S.hardcodedColumns.length;a++){var u=n[S.hardcodedColumns[a]]?n[S.hardcodedColumns[a]]:n["treelistview_customization_"+S.hardcodedColumns[a]],p=new d({label:u,grid:{name:S.hardcodedColumns[a]},icons:S.hardcodedColumnsIcons[S.hardcodedColumns[a]]?[{iconName:S.hardcodedColumnsIcons[S.hardcodedColumns[a]],fontIconFamily:WUXManagedFontIcons.Font3DS}]:void 0,children:null});t.options.specificAttr.addRoot(p),t.options.selectedAttrModel.search({match:function(e){if(e.nodeModel.options.column.dataIndex===S.hardcodedColumns[a])return!0}}).length&&p.select()}new r(function(n){e.then(function(){for(var e=t.options.typeModel.search({match:function(e){if(!0===e.nodeModel.isSelected())return!0}}),i=[],o=0;o<e.length;o++)i.push(e[o].options.grid.cvName);t._retrieveAvailableAttrForVocab(i,n)})}).then(function(){t.elements.attrSelCombo.addEventListener("change",function(e){var n=t.options.availableAttr.search({match:function(t){if(t.nodeModel.getLabel()===e.dsModel.currentValue)return!0}});if(n&&1===n.length)t.options.availableAttr.removeRoot(n[0]),t.options.selectedAttrModel.addRoot(n[0]);else if(n&&n.length>1){var i=e.dsModel.selectedIndex;n.forEach(function(e){e._unfilteredRowID===i&&(t.options.availableAttr.removeRoot(e),t.options.selectedAttrModel.addRoot(e))})}e.dsModel.selectedIndex=-1}),t.elements.attrTypeCombo.disabled(!1),h.unmask(i)})},_retrieveAvailableAttrForVocab:function(e,t){var i=function(e){var t,n="";return e.range&&e.range.dataTypes&&1===e.range.dataTypes.length&&(n=e.range.dataTypes[0]),-1!==n.indexOf("timestamp")?t="date":-1!==n.indexOf("integer")?t="integer":-1!==n.indexOf("boolean")&&(t="boolean"),t};e.indexOf("ds6wg:VPMReference")>-1&&e.push("ds6wg:EnterpriseExtension");var s=e.join("\n"),a=this;a.options.availableAttr.empty(),0===e.length?t&&t():require(["DS/PADUtils/PADDictionaryAccess"],function(e){e.getPropertiesForClass(s,{tenantId:_.getPlatformId(),lang:v.getSetting("lang"),apiVersion:"R2019x",extensions:!0,onComplete:function(e){for(var n=o.is(e,"string")?JSON.parse(e):e,s=0;s<n.length;s++)for(var r=n[s],l=(r.classInfo,0);l<r.properties.length;l++){var c=r.properties[l],u=a.options.availableAttr.search({match:function(e){if(e.nodeModel.options.grid.cvName===c.curi)return!0}}),p=a.options.selectedAttrModel.search({match:function(e){if(e.nodeModel.options.grid.cvName===c.curi)return!0}});if(0===u.length&&0===p.length){var h=i(c),g=new d({label:c.label,grid:{name:c.label,cvName:c.curi,kind:h,isVisibilityLock:!1,isExportLock:!1,exported:!0},children:null});a.options.availableAttr.addRoot(g)}}t&&t()},onFailure:function(e){require(["DS/PADUtils/views/PADAlert"],function(e){e.displayNotification({msg:n.ERR_getPredicates,eventID:"error",key:"padUtils-retrieveAvailableAttrForVocab-error-getPredicates"}),t&&t()})}})})}})}),define("DS/PADUtils/views/parametrization/TreeListParametrization",["css!DS/UIKIT/UIKIT","css!DS/PADUtils/PADUtils","i18n!DS/PADUtils/assets/nls/PADUtils.json","text!DS/PADUtils/assets/DefaultAttrParametrization.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/PADUtils/PADWSAccess","DS/PADUtils/PADPromise","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/Windows/Panel","DS/Controls/Button","DS/UIKIT/Mask","DS/Utilities/Dom","DS/Controls/Toggle","DS/PADUtils/views/parametrization/Iconbar","DS/PADUtils/views/parametrization/SelectionManagement","DS/PADUtils/views/parametrization/ComboSelector"],function(e,t,n,i,o,s,a,r,l,c,d,u,p,h,g,f,m,_,v,S){"use strict";var y=JSON.parse(i);return s.extend(a,{name:"treelistparam",defaultOptions:{hardcodedColumns:y.hardcodedColumns,hardcodedColumnsDef:y.hardcodedColumnsDef,selectedAttrModel:null,selectedTreeLst:null},init:function(e){this._parent(e);var t=this;e.events&&t.addEvents(e.events),e.inMainView?(t.elements.container=o.createElement("div",{class:t.getClassNames("-immersivePanel")}),t.options.selectedAttrModel=new d,t._buildAvailableAttrList(t.options.columns),t._buildCustoInMainView(t.options),t.options.modelEvts.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:t.elements.container}}),t.elements.panel2small=o.createElement("div",{class:t.getClassNames("-panel2small"),text:n.panel2small}).inject(t.elements.container)):require(["DS/ENOFloatingPanel/ENOFloatingPanel"],function(e){t.elements.container=o.createElement("div",{class:"custoTreelist"}),t.render_div=document.querySelector(t.options.render_div),t.options.selectedAttrModel=new d,t._buildAvailableAttrList(t.options.columns),t._buildCustoView(t.options),t.elements.floatingpanel=new e({className:t.name,body:t.elements.container,footer:t._buildFooter(),title:n.treeListViewOptions,overlay:!0,closable:!0,animate:!0,resizable:!0,visible:!0,events:{onClose:function(){t._closePanel(),t.elements.floatingpanel.destroy()}}}),t.elements.floatingpanel.inject(t.render_div)})},_buildCustoView:function(){var e=this;this.elements.custoView=o.createElement("div",{class:"custoView"}).inject(this.elements.container),e.elements.selectionArea=o.createElement("div",{class:"selectionArea"}).inject(this.elements.custoView),e.elements.attrManagementArea=o.createElement("div",{class:"attrManagement"}).inject(this.elements.custoView),e.options.selectionManagement=new v({selectedAttrModel:this.options.selectedAttrModel,renderTo:e.elements.selectionArea,maskTarget:document.body,events:{onRemoveSpecificAttr:function(t){e._removeFromSelectedAttr([t.removedNode])}}}),e._buildIconBar(),e._buildSelectedTreeList();var t=o.createElement("div",{class:"footerView"}).inject(this.elements.container),i=!1;if(this.options.events.saveAsTemplate){i=!0,t.addClassName("compactModeAvailable"),e.elements.selectionArea.addClassName("compactModeAvailable");var s=new d,a=new u({viewMode:"comfortable",label:n.Comfortable,subLabel:n.ComfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});s.addRoot(a);var r=new u({viewMode:"compact",label:n.Compact,subLabel:n.CompactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});s.addRoot(r),this._hasThumbNail&&(this.options.viewMode,a.select(!0)),"compact"===this.options.viewMode?r.select(!0):a.select(!0),this.comboCompact=new S({className:"compactModeSelector",treedocument:s,withMore:!1,disabled:!1,multisel:!1,events:{onSelectionChange:function(){e.dispatchEvent("compactMode",{viewMode:s.getSelectedNodes()[0].options.viewMode})}}}),this._hasThumbNail&&this.comboCompact.disabled(!0);var l=o.createElement("div",{class:this.name+"_footerArea comboDiv"});o.createElement("div",{class:"comboLabel",text:n.density}).inject(l),this.comboCompact.inject(l),l.inject(t),this.applyToggle=new m({label:n.padcustomizeview_apply_to_this_app});var c=o.createElement("div",{class:this.name+"_instruction applyToggle"});i||new o.createElement("hr",{class:"ruler"}).inject(c),this.applyToggle.inject(c),c.inject(t),this.applyToggle.addEventListener("change",function(t){var n=t.dsModel;e._applyOnlyToThisApp=n.checkFlag})}},_buildCustoInMainView:function(){var e=this;e.elements.selectionArea=o.createElement("div",{class:"selectionArea"}).inject(this.elements.container),e._buildIconBar(!0),e.elements.attrManagementArea=o.createElement("div",{class:"attrManagement"}).inject(this.elements.container),e.options.selectionManagement=new v({selectedAttrModel:this.options.selectedAttrModel,renderTo:e.elements.selectionArea,maskTarget:document.body,inMainView:!0,modelEvts:this.options.modelEvts,events:{onRemoveSpecificAttr:function(t){e._removeFromSelectedAttr([t.removedNode])},onResetParameters:function(){e.options.modelEvts.publish({event:"ENXViews/Views/showInWidgetBody",data:{html:e.elements.container}})}}}),e._buildSelectedTreeList(!0);var t=o.createElement("div",{class:"otherAppOpts"}).inject(this.elements.container);if(this.options.events.saveAsTemplate){t.addClassName("compactModeAvailable"),e.elements.selectionArea.addClassName("compactModeAvailable");var i=new d,s=new u({viewMode:"comfortable",label:n.Comfortable,subLabel:n.ComfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});i.addRoot(s);var a=new u({viewMode:"compact",label:n.Compact,subLabel:n.CompactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});i.addRoot(a),this._hasThumbNail&&(this.options.viewMode,s.select(!0)),"compact"===this.options.viewMode?a.select(!0):s.select(!0),this.comboCompact=new S({className:"compactModeSelector",treedocument:i,withMore:!1,disabled:!1,multisel:!1,events:{onSelectionChange:function(){e.dispatchEvent("compactMode",{viewMode:i.getSelectedNodes()[0].options.viewMode})}}}),this._hasThumbNail&&this.comboCompact.disabled(!0);var r=o.createElement("div",{class:this.name+"_optsCompact comboDiv"});o.createElement("div",{class:"optsCompactLabel",text:n.density}).inject(r),this.comboCompact.inject(r),r.inject(t),this.applyToggle=new m({label:n.padcustomizeview_apply_to_this_app}),this.applyToggle.getContent().addClassName(this.getClassNames("-applyToggle")),this.applyToggle.inject(t),this.applyToggle.addEventListener("change",function(t){var n=t.dsModel;e._applyOnlyToThisApp=n.checkFlag})}e.elements.footer=o.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container),e._buildFooter().inject(e.elements.footer)},_buildFooter:function(){var e=this,t=o.createElement("div",{class:"footerModal"}),i=new h({label:n.padcustomizeview_button_close,emphasize:"primary",touchMode:!0});i.addEventListener("click",function(){e._closePanel(),e.elements.floatingpanel&&e.elements.floatingpanel.destroy()}),i.inject(t);var s=new h({label:n.padcustomizeview_button_reset,touchMode:!0});return s.inject(t),s.addEventListener("click",function(){e.dispatchEvent("reset",!0===e._applyOnlyToThisApp),e._closePanel(),e.elements.floatingpanel&&e.elements.floatingpanel.destroy()}),t},_buildSelectedTreeList:function(e){var t=this,i={height:"auto",selection:{enableListSelection:!0,toggle:!1},defaultCellHeight:30,enableDragAndDrop:!1,enableActiveUI:!0,enableKeyboardNavigation:!0,enableTreeColumnEllipsisOverflow:!0,performances:{preloadPool:!0,useRequestAnimationFrameRendering:!1},resize:{columns:!1},isEditable:!0,columns:[{width:"auto",dataIndex:"tree",text:n.padcustomizeview_column_name_header,isDraggable:!1,isColumnMovable:!1,isEditable:!1,isSortable:!1},{text:n.color,dataIndex:"powerByColor",width:40,minWidth:40,maxWidth:40,isDraggable:!1,isColumnMovable:!1,isEditable:!1,isSortable:!1,onCellRequest:function(e){if(e.isHeader)e.cellView.reuseCellContent("powerByColorHeader");else{e.cellView.reuseCellContent("powerByColor");var t="#ffffff",n="#000000";e.nodeModel.options.grid&&e.nodeModel.options.grid.columnColor&&(t=(t=e.nodeModel.options.grid.columnColor["background-color"]?e.nodeModel.options.grid.columnColor["background-color"]:"#ffffff").replace(/;/g,""),n=(n=e.nodeModel.options.grid.columnColor.color?e.nodeModel.options.grid.columnColor.color:"#0000").replace(/;/g,""));var i=e.cellView.getContent().querySelector(".powerByColorLauncher");i&&(o.is(i.setStyles,"function")?i.setStyles({"background-color":t,color:n}):(i.style.color=n,i.style["background-color"]=t))}}},{text:n.exportNLS,dataIndex:"powerByExport",width:40,minWidth:40,maxWidth:40,isDraggable:!1,isColumnMovable:!1,isEditable:!1,isSortable:!1,onCellRequest:function(e){e.isHeader?e.cellView.reuseCellContent("powerByExportHeader"):(e.nodeModel.options.grid.exported?e.cellView.reuseCellContent("powerByExportOK"):e.cellView.reuseCellContent("powerByNoExport"),e.nodeModel.options.grid.isExportLock&&e.cellView.getContent().setAttribute("lock",""))}},{text:"",dataIndex:"powerByRemove",width:40,minWidth:40,maxWidth:40,isDraggable:!1,isColumnMovable:!1,isEditable:!1,isSortable:!1,onCellRequest:function(e){e.isHeader||(e.cellView.reuseCellContent("powerByRemove"),e.nodeModel.options.grid.isVisibilityLock?e.cellView.getContent().setAttribute("lock",""):e.cellView.getContent().removeAttribute("lock",""))}}]};if(t.options.selectedTreeLst=new c(i),t.options.selectedTreeLst.getManager().loadDocument(t.options.selectedAttrModel),e)t.options.selectedTreeLst.getContent().inject(t.elements.attrManagementArea);else{t.options.selectedTreeLst.getContent().setStyles({position:"absolute",top:0,left:0,bottom:0,right:0});var s=o.createElement("div",{class:"attrSelectedList"}).inject(this.elements.attrManagementArea);t.options.selectedTreeLst.getContent().inject(s)}t.options.selectedAttrModel.getXSO().onPostAdd(t._manageSelection.bind(t)),t.options.selectedAttrModel.getXSO().onPostRemove(t._manageSelection.bind(t)),t.options.selectedAttrModel.getXSO().onEmpty(t._manageSelection.bind(t)),t.options.selectedAttrModel.onNodeModelUpdate(t._onNodeModelUpdate.bind(t)),t.options.selectedTreeLst.onNodeClick(t._onCellClick.bind(t)),t.options.selectedAttrModel.getModelEvents().subscribe({event:"addChild"},function(e){setTimeout(function(){t.options.selectedTreeLst.getManager().scrollToNode(e.data.nodeModel),e.data.nodeModel.select(!0),t.options.selectedTreeLst.giveFocus(),e.data.nodeModel._isMoving?delete e.data.nodeModel._isMoving:t._onAddColumn(e.data.nodeModel)},200)}),t.options.selectedTreeLst.getManager().registerReusableCellContent({id:"powerByColorHeader",buildContent:function(){return f.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-palette powerByCommandHeader",style:"font-size: 18px;"})}}),t.options.selectedTreeLst.getManager().registerReusableCellContent({id:"powerByColor",buildContent:function(){var e=f.createElement("div",{class:"powerByCommand"}),t=f.createElement("div",{class:"powerByColorLauncher",styles:{"background-color":"#ffffff",color:"#000000","font-size":"18px"},title:n.changeColor});return t.innerHTML=n.PADColorView_content,e.appendChild(t),e}}),t.options.selectedTreeLst.getManager().registerReusableCellContent({id:"powerByRemove",buildContent:function(){return f.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-trash powerByCommand",style:"font-size: 18px;",title:n.remove})}}),t.options.selectedTreeLst.getManager().registerReusableCellContent({id:"powerByExportHeader",buildContent:function(){return f.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-export powerByCommandHeader",style:"font-size: 18px;"})}}),t.options.selectedTreeLst.getManager().registerReusableCellContent({id:"powerByExportOK",buildContent:function(){return f.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-check powerByCommand",style:"font-size: 18px;",title:n.changeExport})}}),t.options.selectedTreeLst.getManager().registerReusableCellContent({id:"powerByNoExport",buildContent:function(){return f.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-wrong powerByCommand",style:"font-size: 18px;",title:n.changeExport})}})},_buildAvailableAttrList:function(e){for(var t=0;t<e.length;t++){var i=e[t],o=-1!==this.options.hardcodedColumns.indexOf(i.dataIndex)&&!0!==i.isHidden;if(i.xnav_options&&i.xnav_options.name||o){var s=i.xnav_options&&i.xnav_options.name?i.xnav_options.name:i.dataIndex,a=i.text;i.text&&i.text.length||(a=n["treelistview_customization_"+i.dataIndex]),i.customisation&&void 0===i.xnav_options&&(i.xnav_options=i.customisation),void 0===i.xnav_options&&(i.xnav_options={});var r={label:a,grid:{name:s,cvName:s,isVisibilityLock:void 0!==i.xnav_options.layout&&"boolean"==typeof i.xnav_options.layout.removable&&!i.xnav_options.layout.removable,isExportLock:!!i.xnav_options.exportable&&i.xnav_options.exportable.lock,exported:!i.xnav_options.exportable||i.xnav_options.exportable.value,columnColor:void 0!==i.xnav_options.layout?i.xnav_options.layout.styles:void 0},column:i,children:null};this.options.selectedAttrModel.addRoot(r)}"thumbnail"===i.dataIndex&&(this._hasThumbNail=!0)}},_buildIconBar:function(e){var t=this,i={multiSelect:!0,items:[{fonticon:"up",text:n.moveUp,name:"moveUp",disabled:!0},{fonticon:"down",text:n.moveDown,name:"moveDown",disabled:!0},{fonticon:"move-to-top",text:n.moveFirst,name:"moveFirst",disabled:!0},{fonticon:"move-to-bottom",text:n.moveLast,name:"moveLast",disabled:!0},{className:"divider"},{fonticon:"palette",text:n.changeColor,name:"changeColor",disabled:!0},{fonticon:"trash",text:n.remove,name:"remove",disabled:!0}],events:{onClick:function(e,n){switch(n.name){case"remove":t._removeFromSelectedAttr(t.options.selectedAttrModel.getSelectedNodes());break;case"changeColor":t._changeColor(t.options.selectedAttrModel.getSelectedNodes());break;case"moveFirst":case"moveUp":case"moveDown":case"moveLast":t._moveColumn(n.name,t.options.selectedAttrModel.getSelectedNodes())}}}},s=o.createElement("div",{class:"commands"});e?s.inject(this.elements.container):s.inject(this.elements.attrManagementArea),i.renderTo=s,this.elements.iconbar=new _(i)},_closePanel:function(){this.options.cmd&&this.options.cmd.enable(),!0===this._applyOnlyToThisApp?this.dispatchEvent("custoViewChange"):this.dispatchEvent("saveAsTemplate");var e=document.querySelector("div.wux-controls-combobox-popup.wux-controls-popup");e&&e.parentNode.removeChild(e),this.options.modelEvts&&this.options.modelEvts.publish({event:"ENXViews/Views/showInWidgetBody",data:{restore:!0}})},_onNodeModelUpdate:function(e){var t={dataIndex:e.target.options.column?e.target.options.column.dataIndex:e.target.options.grid.cvName,columnColor:e.target.options.grid.columnColor,exportable:e.target.options.grid.exported};this.dispatchEvent("modifyColumRendering",t)},_onAddColumn:function(e){var t;(e.options.grid.isHardcodedCol?(t=this.options.hardcodedColumnsDef[e.options.grid.name]).text=e.options.label:t={dataIndex:e.options.grid.cvName,text:e.options.label,minWidth:50,xnav_options:{name:e.options.grid.cvName,layout:{removable:!0},exportable:{lock:!1,value:!0},kind:e.options.grid.kind}},"thumbnail"===t.dataIndex)&&(this.comboCompact&&(this.comboCompact.options.treedocument.getRoots().forEach(function(e){"comfortable"===e.options.viewMode?e.select():e.unselect()}),this.comboCompact.dispatchEvent("onSelectionChange"),this.comboCompact.disabled(!0)));this.dispatchEvent("addColumn",t)},_onRemoveColumn:function(e){var t={dataIndex:e.options.grid.cvName};"thumbnail"===t.dataIndex&&this.comboCompact&&this.comboCompact.disabled(!1),this.dispatchEvent("removeColumn",t)},_onCellClick:function(e){if(!(void 0===e||e.cellModel&&e.cellModel.options&&e.cellModel.options.isHeader))switch(e.dataIndex){case"powerByRemove":!0!==e.nodeModel.options.grid.isVisibilityLock&&this._removeFromSelectedAttr([e.nodeModel]);break;case"powerByColor":this._changeColor([e.nodeModel]);break;case"powerByExport":var t=e.nodeModel.options.grid.exported;this._changeExport([e.nodeModel],!t)}},_removeFromSelectedAttr:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(!0!==n.options.grid.isVisibilityLock)this.options.selectedAttrModel.removeRoot(n),this._onRemoveColumn(n),-1!==this.options.hardcodedColumns.indexOf(n.options.grid.name)?this.options.selectionManagement.removeSpecificColumn(n.options.grid.name):this.options.selectionManagement.addAttribute(n)}},_changeColor:function(e){require(["DS/PADUtils/views/PADColorPicker"],function(t){new t({selected_color:{background_color:"#ffffff",color:"#0000"},renderTo:document.body,events:{onColorOK:function(t){for(var n=0;n<e.length;n++){e[n].updateOptions({grid:{columnColor:{"background-color":t.background_color+";",color:t.color+";"}}})}}}})})},_changeExport:function(e,t){this.options.selectedAttrModel.withTransactionUpdate(function(){for(var n=0;n<e.length;n++){e[n].updateOptions({grid:{exported:t}})}})},_manageSelection:function(){var e,t=this.options.selectedAttrModel.getSelectedNodes(),n=["moveFirst","moveUp","moveDown","moveLast","changeColor","remove"],i=["changeColor","remove"];for(e=0;e<n.length;e++)1!==t.length?this.elements.iconbar.disableItem(n[e]):this.elements.iconbar.enableItem(n[e]);for(e=0;e<i.length;e++)0===t.length?this.elements.iconbar.disableItem(i[e]):this.elements.iconbar.enableItem(i[e])},_moveColumn:function(e,t){var n=this;this.options.selectedAttrModel.withTransactionUpdate(function(){var i=t[0],o=i._getLocalID?i._getLocalID():i._localID,s={fromID:o,toID:-1};switch(e){case"moveFirst":s.toID=0;break;case"moveUp":s.toID=o-1;break;case"moveDown":s.toID=o+1;break;case"moveLast":s.toID=n.options.selectedAttrModel.getRoots().length-1}-1!==s.toID&&s.toID<n.options.selectedAttrModel.getRoots().length&&(i._isMoving=!0,n.options.selectedAttrModel.addChild(i,s.toID),n.dispatchEvent("moveColumn",{move2perform:s}))})}})});