define("DS/WebDocumentVisualizationUI/WebDocumentBookmark",["require","exports","DS/VisuEvents/EventsManager","UWA/Core","DS/Utilities/TouchUtils","css!./WebDocumentVisualizationUI.css"],function(e,t,i,n,o){"use strict";return class{constructor(e){let t,s,a,d,r,l=this,u=e.bookmarkData;function c(t){l.setHighlight(!0),e.onClickCB&&e.onClickCB({target:u,data:t,div:l})}function m(){a&&(a.removeEventListener("transitionend",m),a.setStyle("display","none"))}function h(){t&&a&&d&&(t.hasAttribute("expanded")?(a.addEventListener("transitionend",m),t.removeAttribute("expanded"),d.removeClassName("wux-ui-3ds-expand-down"),d.addClassName("wux-ui-3ds-expand-right")):(a.setStyle("display",""),window.requestAnimationFrame(()=>{t&&d&&(t.setAttribute("expanded",""),d.removeClassName("wux-ui-3ds-expand-right"),d.addClassName("wux-ui-3ds-expand-down"))})),e.onExpandCB&&e.onExpandCB())}t=n.createElement("div",{class:"WebDocBookmarkMainDiv"});let p=n.createElement("div",{class:"WebDocBookmarkHeaderDiv"}).inject(t),g=u.items&&u.items.length>0;if(s=n.createElement("div",{class:"WebDocBookmarkExpanderDiv",styles:{visibility:g?"inherit":"hidden"}}).inject(p),o.getTouchMode()&&s&&s.addClassName("touchMode"),g&&i.addEvent(s,"onPrimaryPointerClick",h),a=n.createElement("div",{class:"WebDocBookmarkContentDiv",styles:{display:"none"}}).inject(t),d=n.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-expand-right"}).inject(s),u.iconUrl){let e=n.createElement("img",{class:"WebDocBookmarkIcon",src:u.iconUrl,events:{error:function(){p&&e&&p.removeChild(e)}}}).inject(p)}r=n.createElement("div",{class:"WebDocBookmarkTitleDiv",text:u.title,styles:{"font-size":e.fontSize,"font-weight":u.bold?"bold":"normal","font-style":u.italic?"italic":"normal"}}).inject(p),e.onClickCB&&i.addEvent(r,"onPrimaryPointerClick",c),this.getBookmarkDiv=function(){return t},this.getContentDiv=function(){return a},this.isExpanded=function(){return!!t&&t.hasAttribute("expanded")},this.setExpanded=function(i){g&&t&&a&&d&&(!i&&t.hasAttribute("expanded")?(a.addEventListener("transitionend",m),t.removeAttribute("expanded"),d.removeClassName("wux-ui-3ds-expand-down"),d.addClassName("wux-ui-3ds-expand-right")):i&&!t.hasAttribute("expanded")&&(a.setStyle("display",""),window.requestAnimationFrame(()=>{t&&d&&(t.setAttribute("expanded",""),d.removeClassName("wux-ui-3ds-expand-right"),d.addClassName("wux-ui-3ds-expand-down"))})),e.onExpandCB&&e.onExpandCB())},this.setHighlight=function(e){e&&t&&!t.hasClassName("WebDocBookmarkHighlighted")?t.addClassName("WebDocBookmarkHighlighted"):!e&&t&&t.hasClassName("WebDocBookmarkHighlighted")&&t.removeClassName("WebDocBookmarkHighlighted")},this.remove=function(){e.onClickCB&&i.removeEvent(r,"onPrimaryPointerClick",c),g&&i.removeEvent(r,"onPrimaryPointerClick",h),t&&t.remove(),s=t=a=d=null}}}}),define("DS/WebDocumentVisualizationUI/WebDocumentBookmarksPanel",["require","exports","DS/CATWebUXComponents/CATWebUXSectionHeader","UWA/Controls/ThemedScroller","UWA/Core","DS/CoreEvents/ModelEvents","DS/Utilities/TouchUtils","DS/WebDocumentVisualizationUI/WebDocumentBookmark","i18n!DS/WebDocumentVisualizationUI/assets/nls/WebDocumentVisualizationUI"],function(e,t,i,n,o,s,a,d,r){"use strict";return class{constructor(){let e,t,l,u,c,m,h=this,p=new s;const g=a.getTouchMode()?18:14,v=a.getTouchMode()?16:12;function k(e,t){return p.publish({event:e,data:t})}function f(e){m&&m!==e.div&&m.setHighlight(!1),m=e.div,k("onBookmarkSelected",e)}function b(){k("onBookmarkExpanded",{})}function x(e,t,i){if(!e||!t)return;let n;for(let o=0;o<e.length;o++)if(e[o].pointedPage<t)n=e[o];else{if(e[o].pointedPage!==t)break;if(!e[o].pointedPosition||e[o].pointedPosition.y>i)n=e[o];else{if(e[o].pointedPosition&&Math.abs(e[o].pointedPosition.y-i)<=1e-4)return e[o];if(e[o].pointedPosition&&e[o].pointedPosition.y<i)break}}return n}function C(e){let t=c;for(;t&&t.length;)t.forEach(function(t){t.view.setExpanded(e)}),t=t.reduce(function(e,t){return e.concat(t.items||[])},[]);b()}function D(e,t){return e?e.findIndex(function(e){return e.pointedId===t||(e.items?D(e.items,t):-1)>=0}):-1}this.buildPanel=function(s){h.cleanPanel(),e||(e=o.createElement("div",{id:"WebDocumentBookmarksPanelMainDiv"})),e.setStyles({height:"100%"});let a=o.createElement("div",{class:"WebDocumentBookmarksPanelSectionMainDiv"}).inject(e);a.setStyles({height:"100%"});let m=s.filter(function(e){return e.items.length});return l=new i({draggable:!1,sectionLabel:r.bookmarksPanel.title,quickAccessBtnList:m.length?[{id:"ExpandAllButton",type:"toggle",initialFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all",alternativeFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all",title:r.bookmarksPanel.expandOrCollapseAll,cb:C}]:[]}),a.appendChild(l.getContent()),u=o.createElement("div",{id:"WebDocumentBookmarksPanelMainContainer",styles:{"background-color":"white",padding:"5px"}}),(t=(new n).inject(a)).getInnerElement().setContent(u),t.getContent().setStyle("height","calc(100% - 40px)"),c||(c=[]),function e(t,i,n,o){t&&t.length&&i&&o&&(n=Math.max(n,v),t.forEach(function(t){const s=t.items?[]:void 0;let a=new d({bookmarkData:t,fontSize:n,onClickCB:f,onExpandCB:()=>{if(s&&!s.length){let i=a.getContentDiv();i&&e(t.items,i,n-1,s)}b()}}),r={view:a,pointedPage:t.pointedPage||0,pointedPosition:t.pointedPosition,pointedId:t.pointedId,items:s};o.push(r);let l=a.getBookmarkDiv();l&&i.appendChild(l)}))}(s,u,g,c),1===c.length&&c[0].view.setExpanded(!0),c.sort(function(e,t){return e.pointedPage<t.pointedPage?-1:e.pointedPage>t.pointedPage?1:e.pointedPosition?t.pointedPosition?e.pointedPosition.y>t.pointedPosition.y?-1:e.pointedPosition.y<t.pointedPosition.y?1:0:1:-1}),e},this.highlightBookmark=function(e){var t,i;if(!e||!c)return;let n,o;if(e.pageNumber&&e.yCoordinate)for(o=x(c,e.pageNumber,e.yCoordinate);o&&(n=o,o.view.isExpanded()&&(null===(t=o.items)||void 0===t?void 0:t.length));)o=x(o.items,e.pageNumber,e.yCoordinate);else if(e.elementId){let t=D(c,e.elementId);for(t>=0&&(o=c[t]);o&&t>=0&&(n=o,o.view.isExpanded()&&(null===(i=o.items)||void 0===i?void 0:i.length));)(t=D(o.items,e.elementId))>=0&&(o=o.items[t])}n?(m&&m.setHighlight(!1),n.view.setHighlight(!0),m=n.view):m&&(m.setHighlight(!1),m=null)},this.subscribe=function(e,t){return e&&t?p.subscribe({event:e},t):""},this.unsubscribe=function(e){null!=e&&p.unsubscribe(e)},this.cleanPanel=function(){if(e){for(m&&m.setHighlight(!1),c&&c.forEach(function(e){e.view.remove()});e.firstChild;)e.removeChild(e.firstChild);l&&l.clear(),t&&t.destroy(),c=l=t=e=m=null}}}}});