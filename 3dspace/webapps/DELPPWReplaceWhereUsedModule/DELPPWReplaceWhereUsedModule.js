define("DS/DELPPWReplaceWhereUsedModule/ReplaceWhereUsedModule",["UWA/Core"],function(e){"use strict";return{behaviors:["UXFactoryBehavior","WUXNodeModelBehavior","TreeListViewBehavior","ResourceBehavior","ReplaceBehavior","MfgItemBehavior","ModelBehavior","SearchBehavior"],creator:function(t,n,a,o,i,l,r,s,c){var p,u=t.getPreferenceValue("isAddAndRemoveActivated"),I={Replace_By_Existing:{label:i.getNLSValue("MIL.ReplaceByExisting"),value:1,tooltip:i.getNLSValue("MIL.ToolTip.ReplaceByExisting"),getLabel:function(){return this.tooltip}},Replace_By_NewRev:{label:i.getNLSValue("MIL.ReplaceByNewRevision"),value:2,tooltip:i.getNLSValue("MIL.ToolTip.ReplaceByNewRev"),getLabel:function(){return this.tooltip}},Replace_By_NewBranch:{label:i.getNLSValue("MIL.ReplaceByNewBranch"),value:3,tooltip:i.getNLSValue("MIL.ToolTip.ReplaceByNewBranch"),getLabel:function(){return this.tooltip}},Remove:{label:i.getNLSValue("MIL.Remove"),value:5,tooltip:i.getNLSValue("MIL.Remove"),getLabel:function(){return this.tooltip}},Add:{label:i.getNLSValue("MIL.Add"),value:6,tooltip:i.getNLSValue("MIL.Add"),getLabel:function(){return this.tooltip}},Ignore:{label:i.getNLSValue("MIL.Ignore"),value:4,tooltip:i.getNLSValue("MIL.Ignore"),getLabel:function(){return this.tooltip}}},g=function n(o,c,u,I){var g;if(o.length>c)if(""!==(g=o[c]).instancePID){var R=e.is(a.getNodeModel(g.PID))?a.getNodeModel(g.PID):null;e.is(R,"array")&&R.every(function(a){return a.options.instancePID===g.instancePID&&new Promise(function(n){!function(n,a,o,c){var u,I=function(){d(!0,n),c()},g=function(){d(!1,n),c()};switch(u=[[{id:n.options.instancePID,path:[n.options.instancePID],showReport:!1}]],n.options.grid.RWU_Action.value){case 1:e.is(n.options.grid.RWU_ReplacePID)&&""!==n.options.grid.RWU_ReplacePID?l.replace("replaceByExisting",n.options.grid.RWU_ReplacePID,u,I,g):(t.warn(i.getNLSValue("RWU.ReroutingProposalEmpty")),p.buttons.Ok.disabled=!1,g());break;case 2:e.is(a.get(n.options.referencePID))?l.replace("replaceByExisting",a.get(n.options.referencePID),u,I,g):l.replace("replaceByNewRevision",null,u,function(t){e.is(t.instancesAndReferences[0])?(a.set(n.options.referencePID,t.instancesAndReferences[0].get("PID")),I()):g()},g);break;case 3:var R={};e.is(o.get(n.options.referencePID))?l.replace("replaceByExisting",o.get(n.options.referencePID),u,I,g):(R[n.options.parentReferencePID]={brokenMfgItems:{},engConfigFilter:"",mfgConfigFilter:""},R[n.options.parentReferencePID].brokenMfgItems[n.options.instancePID]={MbomUpdateAction:"ReplaceByNewBranch",V_TreeOrder:n.options.grid.V_TreeOrder,aggregatedByPath:n.options.parentReferencePID,brokenMfgPID:n.options.instancePID,candidatePaths:[n.options.instancePID],candidateProduct:"",id:n.options.instancePID,instanceLID:n.options.instancePID,instancePID:n.options.instancePID,isBroken:!0,isInstanceOf:n.options.referencePID,isLeaf:!0,mfgOccPathPIDs:n.options.instancePID,referecePID:n.options.referencePID,routeMfgItemPID:n.options.parentReferencePID,status:"NotApplicable",type:"MfgItemsUpdateStatus",typeOfScope:"None",fromRWU:!0},r.webservice("rerouteLink",null,R,function(t){e.is(t.succeeded)&&e.is(t.succeeded[n.options.parentReferencePID])?(o.set(n.options.referencePID,t.succeeded[n.options.parentReferencePID][n.options.instancePID].instancesAndReferences[0].PID),I()):g()}));break;case 4:I();break;case 5:s.deleteInstance([s.getInstance(n.options.instancePID)],{forceDBMode:!0,askDeleteConfirmation:!1,onComplete:function(){I()},onFailure:function(){g()}});break;case 6:if(e.is(n.options.grid.RWU_ReplacePID)&&""!==n.options.grid.RWU_ReplacePID){var f=s.getReferenceModel(n.options.grid.RWU_ReplacePID),P=s.getReferenceModel(n.options.parentReferencePID);s.createMultipleInstances([{rootReferencePID:n.options.grid.RWU_ReplacePID,referencePID:n.options.grid.RWU_ReplacePID,targetReferencePID:n.options.parentReferencePID,instancePID:null,targetRootReferencePID:n.options.parentReferencePID,targetInstancePID:null,allowMove:!0,instancePIDsArray:[],targetInstancePIDsArray:[],path:[]}],P.get("V_Name"),f.get("V_Name")).then(function(){I()}).catch(function(){p.buttons.Ok.disabled=!1,g()})}else t.warn(i.getNLSValue("RWU.ReroutingProposalEmpty")),p.buttons.Ok.disabled=!1,g();break;default:g()}}(a,u,I,n)}).then(function(){return n(o,c+1,u,I),!1}),!0})}else n(o,c+1,u,I)},d=function(e,t){e?4===t.options.grid.RWU_Action.value?(t.options.grid.RWU_Status=i.getNLSValue("MfgItemCreateReportUI.Status.Ignored"),t.options.rwuStatus="ignored"):(t.options.grid.RWU_Status=i.getNLSValue("MIL.Status.Success"),t.options.rwuStatus="success"):(t.options.grid.RWU_Status=i.getNLSValue("MIL.Message.Failure",{suggestion:t.options.grid.RWU_Action.label,mfg:t.getLabel(),failureMsg:""}),t.options.rwuStatus="fail"),a.updateNode(t._referencePID)},R=function(l){var r=n.getComponent("Dialog"),s=n.getComponent("Button"),c=n.getComponent("WUXFrameWindowsManager").getFrameWindow(t.getAppContext()).getImmersiveFrame(),d=c.elements.container.getSize(),R=n.create("Element","div",{class:"mil-tree-container",styles:{height:"100%",width:"100%"}}),f=a.getWUXNodeModel(),P=function(){var e=new Map;return e.set(I.Replace_By_Existing.value,{labelItem:I.Replace_By_Existing.label,valueItem:I.Replace_By_Existing.value,tooltipItem:I.Replace_By_Existing.tooltip}),e.set(I.Replace_By_NewRev.value,{labelItem:I.Replace_By_NewRev.label,valueItem:I.Replace_By_NewRev.value,tooltipItem:I.Replace_By_NewRev.tooltip}),e.set(I.Replace_By_NewBranch.value,{labelItem:I.Replace_By_NewBranch.label,valueItem:I.Replace_By_NewBranch.value,tooltipItem:I.Replace_By_NewBranch.tooltip}),u&&(e.set(I.Remove.value,{labelItem:I.Remove.label,valueItem:I.Remove.value,tooltipItem:I.Remove.tooltip}),e.set(I.Add.value,{labelItem:I.Add.label,valueItem:I.Add.value,tooltipItem:I.Add.tooltip})),e.set(I.Ignore.value,{labelItem:I.Ignore.label,valueItem:I.Ignore.value,tooltipItem:I.Ignore.tooltip}),e}(),D=e.is(l.values)?Array.isArray(l.values)?l.values:[l.values]:{};o.loadDocument(f),o.getContent().inject(R),o.getDataGridView().layout.rowsHeader=u,function(e,t){var n,o=new Map,l=[];e.forEach(function(e){var r="",s="",c="",p=!1;if(""!==e.instancePID){switch(e.currentFullName){case"FROZEN":r=t.get(1).valueItem,s=I.Replace_By_Existing;break;case"IN_WORK":"RELEASED"===a.getNodeModel(e.parentReferencePID)[0].options.current?(r=t.get(1).valueItem,s=I.Replace_By_Existing):(r=t.get(2).valueItem,s=I.Replace_By_NewRev);break;case"RELEASED":r=t.get(3).valueItem,s=I.Replace_By_NewBranch;default:r=t.get(4).valueItem,s=I.Ignore}p=!0,c=i.getNLSValue("RWU.ManufItemSelection")}(n={label:e.V_Name,icons:[i.getIconURLFromKey(e.type)],useAsyncPreExpand:!0,referencePID:e.PID,referenceType:e.type,instancePID:e.instancePID,parentReferencePID:e.parentReferencePID,parentInstancePID:e.parentInstancePID,scopedParentPrdRefIDs:"",mfgOccPathArr:[],defaultMILSuggestionValue:r,rwuStatus:"",isLeaf:p,current:e.currentFullName,selectableFlag:!1,grid:{RWU_Action:s,RWU_Status:"","PLM_ExternalID.instance":e.PLM_ExternalInstanceID,RWU_Replace:c,RWU_ReplacePID:"",cellInfo:{mbomId:e.PID,action:r,suggestionToPerformEntries:Array.from(t.values()),PreviousProdIconUrl:"",MfgItemIconUrl:i.getIconURLFromKey(e.type),isLeaf:p,RWU_Replace:c}}}).isLeaf&&-1===l.indexOf(n.instancePID)?(o.set(e.PID,a.addNodeModel(n,o.get(e.parentReferencePID))),l.push(n.instancePID)):n.isLeaf||-1!==l.indexOf(n.referencePID)||(o.set(e.PID,a.addNodeModel(n)),l.push(n.referencePID))}),a.expandAllRoots()}(D,P),(p=new r({domId:"replaceWhereUsed-Dialog",immersiveFrame:c,modalFlag:!0,visibleFlag:!1,resizableFlag:!0,snappableFlag:!1,height:d.height-240,width:d.width-1e3,title:"ReplaceWhereUsed",content:R,closeButtonFlag:!0,buttons:{Ok:new s({domId:"replaceWhereUsed-Dialog-Apply",className:"ok primary",label:"Apply",emphasize:"primary",disabled:!1,onClick:function(){p.buttons.Ok.disabled=!0,g(D,0,new Map,new Map)}}),Cancel:new s({domId:"replaceWhereUsed-Dialog-Close",className:"close",label:"Close",onClick:function(){p.close()}})}})).close=function(){a.emptyNodeModel(),p.hide()},p.show()};return{listenTo:function(){return{replaceWhereUsedModule:R}},onStart:function(){},onStop:function(){a.getTreeDocument().removeRoots()},start:function(){},stop:function(){}}}}});