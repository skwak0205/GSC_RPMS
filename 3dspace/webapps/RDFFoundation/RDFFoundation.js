define("DS/RDFFoundation/FederatedSearchUtil",["UWA/Core","UWA/Class/Events","DS/WAFData/WAFData","DS/E6WCommonUI/PlatformManager"],function(e,t,n,i){"use strict";var r={_buildRequestData:function(t){var n=e.clone(t||{},!1),r=t.sources||[];n.source=r,delete n.sources,n.locale?n.locale=n.locale:n.locale="en";var o=window.enoviaServer&&window.enoviaServer.user||window.dsUserLogin,s=this._isSynthesisTrue(r),a={label:"3dplan-"+o+"-"+Date.now(),with_synthesis:s,with_synthesis_attribute:s,order_field:"relevance",order_by:"desc",select_file:["icon","thumbnail_2d"],nresults:10,start:0,tenant:i.getTenant()};return e.extend(a,n),a},_isSynthesisTrue:function(e){var t=e||[],n=-1!==t.indexOf("swym"),i=-1!==t.indexOf("usersgroup");return Boolean(n||i)},_buildRequest:function(e){var t={method:"POST",type:"json",headers:{"Content-Type":"application/json"}};return t.data=JSON.stringify(this._buildRequestData(e)),t.onComplete=e.onComplete,t.onFailure=e.onFailure,t},escapeTwoByteChars:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/（/g,"\\（")).replace(/）/g,"\\）")).replace(/［/g,"\\［")).replace(/］/g,"\\］")).replace(/｛/g,"\\｛")).replace(/｝/g,"\\｝")).replace(/｟/g,"\\｟")).replace(/｠/g,"\\｠")).replace(/〖/g,"\\〖")).replace(/〗/g,"\\〗")).replace(/【/g,"\\【")).replace(/】/g,"\\】")).replace(/〚/g,"\\〚")).replace(/〛/g,"\\〛")).replace(/ー/g,"\\ー")).replace(/\u3000/g," ")},sendRequestWithDelimiter:function(t){for(var n,i,o=e.clone(t||{},!1),s=o.delimeter||" OR ",a=0,l=t.query,c=0;c<l.length;c++)i=l[c],n&&n.length+(s+i).length>r.QUERY_MAX_LENGTH?(o.query=n,o.nresults=a,t.queueRequest?this._handleQueue(o):this.sendRequest(o),c--,a=-1,n=void 0):n?n+=s+i:n=i,a++;o.searchQueryPrefix&&(n=o.searchQueryPrefix+":("+n+")"),o.query=n,o.nresults=a,t.queueRequest?this._handleQueue(o):this.sendRequest(o)},_handleQueue:function(t){var n=e.clone(t||{},!1),i=this;r._queue=r._queue||[],n.onComplete=function(e){t.onComplete&&t.onComplete(e),i._requestFetch()},n.onFailure=function(e){t.onFailure&&t.onFailure(e),i._requestFetch()},r._queue.push(n),r._requestFetch()},_requestFetch:function(){var e=this;r._timeout||(r._timeout=setTimeout(function(){delete r._timeout;var t=r._queue.shift();t&&e.sendRequest(t)},r.REQUEST_DELAY))},sendRequest:function(e){var t=i.getServiceUrl("3DSearch",!0);if(t)return t+="/search",n.authenticatedRequest(t,this._buildRequest(e))},filterSearchSources:function(e){r._validFederatedSearchSources=r._validFederatedSearchSources||{},e=e||[],Array.isArray(e)||(e=[e]);var t=e.slice(),o=i.getServiceUrl("3DSearch",!0);return o?(o&&(o&&r._validFederatedSearchSources[o]?t=e.filter(function(e){return-1!==r._validFederatedSearchSources[o].indexOf(e)}):r._gettingSources||(r._gettingSources=!0,n.authenticatedRequest(o+"/search/source",{onComplete:function(e){delete r._gettingSources,r._validFederatedSearchSources[o]=e?JSON.parse(e).source:void 0,r.eventDispatcher.dispatchEvent("onFederatedSearchSourcesLoaded")},onFailure:function(){delete r._gettingSources}}))),t):e},hasLoadedFederatedSearchSources:function(){return r._validFederatedSearchSources},getFederatedQueryCriteria:function(t){var n,r=e.clone(t||{},!1),o=r.criteria,s=r.fieldConfig;if(s&&"person"===s.type&&s.searchSource&&-1!==s.searchSource.indexOf("swym")){if(1!==o.length)throw new Error("Invalid search criteria for person field.");n=i.enableUserGroup()&&r.fieldType&&s.searchSource.includes("usersgroup")?'[ds6w:type]:("foaf:Group" OR "pno:Person")':0===o[0].length?"":"personOrGroup:("+o[0]+")"}else n=o.length>1?"("+o.join(" OR ")+")":0===o.length||0===o[0].length?"":s&&s.searchSourceTypes?o[0]+"*":o[0];return n},getFederatedQueryPreCondition:function(e){var t;return e&&"person"===e.type&&e.userRole&&e.searchSource&&-1!==e.searchSource.indexOf("3dspace")&&(t='userrole:"'+e.userRole+'"'),t}};return r.eventDispatcher=new t,r.QUERY_MAX_LENGTH=8192,r.REQUEST_DELAY=100,r}),define("DS/RDFFoundation/ProjectTypeUtils",["DS/E6WCommonUI/PlatformManager"],function(e){"use strict";const t={projectTypeList:[],loadProjectTypes:function(n){n(e.getServiceUrl("3dplan",!0)+"/v1/invoke/dsxplan:getProjectTypes?$mask=dsplan:MVMask.Template.Basic",{method:"POST",type:"json",data:JSON.stringify([]),headers:{"Content-Type":"application/json"},onComplete:t.parseProjectTypes,onFailure:function(e){console.log(e)}})},parseProjectTypes:function(e){if(e&&e.member){let n=e.member.map(function(e){let t;return t="dsplan:Project"===e["@id"]?require.toUrl("E6WCommonApps/assets/img/I_TeamProject_Thumbnail.png"):require.toUrl("E6WCommonApps/assets/img/I_EnterpriseProject_Thumbnail.png"),{actualValue:e["@id"],displayValue:e["dskern:nlsLabel"],icon:t}});t.setProjectTypes(n)}},setProjectTypes:function(e){t.projectTypeList=e},getProjectTypes:function(){return t.projectTypeList},getCreateProjectTypes:function(e){const n=e=>"dsplan:IterationProject"===e.actualValue;if(e&&"dsplan:AgileProject"===e.get("dsplan:projectType"))return[t.projectTypeList.find(n)];let i=t.projectTypeList.filter(e=>!n(e));return window.widget.getValue("agile")||(i=i.filter(e=>"dsplan:AgileProject"!==e.actualValue)),i}};return t}),define("DS/RDFFoundation/Mixins/FetchTrackingMixin",[],function(){"use strict";const e={initFetchTrackingMixinForInstance:function(){this._completeCount=0,this._fetchCount=0},initFetchTrackingMixinForClass:function(t){Object.defineProperty(t.prototype,"fetching",e.fetchingPropertyDefinition),Object.defineProperty(t.prototype,"completing",e.completingPropertyDefinition)},allFetchesUseComplete:function(){return this._completeCount===this._fetchCount},handleBadFetchCounts:function(e){this[e]<0&&(this[e]=0,console.error(`tried to set ${e} to a negative value`))},fetchingPropertyDefinition:{get:function(){return this._fetchCount>0},set:function(e){return!1===e?(this._fetchCount--,this.handleBadFetchCounts("_fetchCount")):this._fetchCount++,this.dispatchEvent("onFetchCountChanged"),this.fetching}},completingPropertyDefinition:{get:function(){return this._completeCount>0},set:function(e){return!1===e?(this._completeCount--,this.handleBadFetchCounts("_completeCount")):this._completeCount++,this.fetching=e,this.completing}}};return e}),define("DS/RDFFoundation/RequestUtils",["UWA/Core"],function(e){"use strict";var t={addNecessaryHeadersAndParams:function(e){e.headers||(e.headers={}),"GET"!==e.method&&"OPTIONS"!==e.METHOD&&(e.headers["X-Requested-With"]="XMLHttpRequest"),"POST"===e.method&&(e.url.match(/\/invoke/)&&(e.headers["Content-Type"]="application/json",e.data||(e.data="[]")),"json"!==e.type&&(e.headers.Accept="multipart/mixed,application/json")),!e.headers["Accept-Language"]&&(e.headers["Accept-Language"]=window.widget&&window.widget.lang||window.dsLang);var n=window.widget&&window.widget.getValue("overrideTenant");n&&(e.url=t.addQueryParam(e.url,"tenant","dstenant:"+n,!0))},addQueryParam:function(t,n,i,r){return e.is(i)?t+(-1===t.indexOf("?")?"?":"&")+n+"="+(r?encodeURIComponent(i):i):t},addQueryParams:function(e,n){return n.forEach(function(n){e=t.addQueryParam(e,n.name,n.value,n.encode)}),e}};return t}),define("DS/RDFFoundation/Models/ObjectProxyUtil",["UWA/Core"],function(e){"use strict";var t={getDate:function(e){var t=new Date(e);return"Invalid Date"===t.toString()&&(t=new Date(1e3*parseInt(e,10))),"Invalid Date"!==t.toString()?t:e},convertServiceResponseToFederatedFormat:function(n){var i=[];n=e.is(n,"array")?n:[n];for(var r,o=0;o<n.length;o++){var s=n[o],a={attributes:[{name:"resourceid",value:s.id},{name:"ds6w:label",value:(r=s,r.title?r.title:r.name)},{name:"ds6w:type",value:s.type},{name:"type_icon_url",value:s.image||s.icon},{name:"files",value:s.hasfiles||""},{name:"modified",value:t.getDate(s.modified)},{name:"ds6w:docextension",value:s.extension}]};i.push(a)}return i},sendRequest:function(n,i){var r=require("DS/DocumentManagement/ObjectInfoService");if(n["3dspace"]&&n["3dspace"].length>0){var o=e.clone(i||{},!1);o.additionalURLParams=o.additionalURLParams?o.additionalURLParams+"&$fields=modified":"$fields=modified",t.sendRequestHelper(r,n["3dspace"],"3dspace",o)}if(n.drive&&n.drive.length>0){var s=require("DS/DocumentManagement/DriveDocumentManagement"),a=e.clone(i||{},!1);a.tenantUrl=window.enoviaServer["3DDrive"],a.tenant=widget.getValue("x3dPlatformId")||widget.getValue("tenant"),t.sendRequestHelper(s,n.drive,"drive",a)}},sendRequestHelper:function(n,i,r,o){var s=e.clone(o||{},!1);n.getObjects(i,{tenantUrl:s.tenantUrl,tenant:s.tenant,additionalURLParams:s.additionalURLParams,onComplete:function(e){e&&e.data&&(e=e.data),s.onComplete&&s.onComplete(t.convertServiceResponseToFederatedFormat(e),r)},onFailure:function(){s.onFailure&&s.onFailure("object_not_found",r,i)}})}};return t}),define("DS/RDFFoundation/MaskUtils",["UWA/Core"],function(e){"use strict";var t,n;require(["text!DS/RDFFoundation/assets/maskDefinition.json"],function(e){e=JSON.parse(e),t=e.masks,n=e.maskBreakdownArray},function(){require(["text!DS/RDFFoundation/assets/maskDefinition_prebuilt.json"],function(e){e=JSON.parse(e),t=e.masks,n=e.maskBreakdownArray})});var i={isSubMask:function(e,t){return t.some(function(t){return e===t||n[t]&&n[t].includes(e)})},addAttributeToMask:function(e,t,n){i.addMask(e)[t]=n},addMask:function(e){var n=t[e];return n||(n=t[e]={}),n},getMask:function(e){return t[e]},getAllMasks:function(){return t},resetMaskContent:function(n){t=e.clone(n||{})},getMinMaskArray:function(r,o){var s=e.clone(o||{},!1),a=s.level||0;let l,c=[],d=0,u=[];return a>3?r:(s.attributes&&s.attributes.length>0&&(r=r.filter(e=>s.attributes.some(n=>t[e].hasOwnProperty(n)))),r.forEach(e=>{let t=n[e]?n[e]:[],i=r.filter(e=>t.includes(e));i.push(e),i.length>d&&(d=i.length,l=e,u=i)}),l&&c.push(l),d!==r.length&&(c=c.concat(i.getMinMaskArray(r.filter(e=>!u.includes(e)),{attributes:[],level:++a}))),c)},ARRAY_ATTR:"array",COLLECTION_ATTR:"collection",MODEL_ATTR:"model",STRING_ATTR:"string"};return i}),define("DS/RDFFoundation/MemberUtils",["UWA/Core","DS/RDFFoundation/FederatedSearchUtil","DS/E6WCommonUI/PlatformManager","DS/WAFData/WAFData"],function(e,t,n,i){"use strict";var r="uuid:",o="iam:",s=/^(uuid:|mailto:|iam:)/g,a={userMap:{},idAttributeForFederatedSearch:"ds6w:resourceUid",addUserUIdToMap:function(e,t){e!==t&&(a.userMap[e]=t)},escapeRegExp:function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},findAndGetSwymPersonResourceUid:function(n){var i=e.clone(n||{},!1),r=i.searchOptions,o=r.id,s=n.dropObj&&n.dropObj.objectType||n.detailedObject&&n.detailedObject["ds6w:type"],l=this._getDefaultSearchAttributes(o,s);e.extend(l,r),t.sendRequest({select_predicate:l.select_predicate,sources:[l.source],query:l.query,nresults:1,onComplete:function(e){var t=!0,n=e.results;if(n&&n.length)for(var r=n[0].attributes,o=r.length,s=0;s<o;s++)if(r[s].name===a.idAttributeForFederatedSearch){var c=r[s].value;l.callback&&l.callback(c,i),t=!1;break}t&&l.onFailure&&l.onFailure()},onFailure:function(){l.onFailure&&l.onFailure()}})},getContextUserUid:function(t){var r=e.clone(t||{});let o=n.getServiceUrl("3DSwym",!0)+"/api/index/tk";i.authenticatedRequest(o,{method:"GET",onComplete:e=>{let t=JSON.parse(e).result.ServerToken;i.authenticatedRequest(n.getServiceUrl("3DSwym",!0)+"/api/user/getcurrent",{method:"POST",type:"json",data:JSON.stringify({params:{detailedView:!1,get_autosaved_content:!0}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":t},onComplete:e=>{let t=e.result;a.addUserUIdToMap(t.login,a.addUUIDToURI(t.uid)),n.setContextUserUid(t.uid),r.onComplete&&r.onComplete(t.uid)},onFailure:()=>{console.error("Unable to retrieve current user information from 3DSwym"),r.onFailure&&r.onFailure()}})},onFailure:()=>{console.error("Unable to retrieve current user information from 3DSwym"),r.onFailure&&r.onFailure()}})},setContextUserUid:function(t){let i=e.clone(t||{});n.getServiceUrl("3DSwym",!0)?this.getContextUserUid(i):n.addEventOnce("serviceDataLoaded",a.getContextUserUid.bind(this,i))},_getDefaultSearchAttributes:function(e,t){var n,i;return t&&"foaf:Group"===t||"Group"===t?(n="usersgroup",i=["[ds6w:resourceUid]",':("',e,'")'].join("")):(n="swym",i=["resourceid",':("',e,'")'].join("")),{source:n,query:i,select_predicate:["resourceid","ds6w:resourceUid"]}},getPersonMask:function(){return"dsplan:MVMask.Person.Complex"},addUUIDToURI:function(t,n){var i=n&&n.detailedObject&&("foaf:Group"===n.detailedObject["ds6w:type"]||"Group"===n.detailedObject["ds6w:type"]),o=n&&n.dropObj&&("foaf:Group"===n.dropObj.objectType||"Group"===n.dropObj.objectType);return i||o||!t||!e.is(t,"string")||t.match(s)?t:[r,t].join("")},removeUUIDFromURI:function(t){return t&&e.is(t,"string")&&t.startsWith(r)&&(t=t.replace(r,"")),t},addIamToURI:function(t){return t&&e.is(t,"string")&&!t.match(s)?[o,t].join(""):t},preProcessPersonObject:function(e,t){return"pno:Person"===t["ds6w:type"]&&(e=a.addUUIDToURI(e)),e},typeAheadCallback:function(e,n,i){return t.sendRequest({select_predicate:["ds6w:label","ds6w:resourceUid","ds6w:type","ds6w:type_value","type_icon_url","preview_url"],sources:t.filterSearchSources(["swym","usersgroup"]),query:'[ds6w:type]:("foaf:Group" OR "pno:Person")',specific_source_parameter:{usersgroup:{additional_query:" AND [ds6w:label]:("+a.escapeRegExp(e)+"*)"},swym:{additional_query:" AND personOrGroup:("+e+")"}},with_synthesis_attribute:!0,onComplete:i.onComplete&&i.onComplete.bind(void 0,n,i)})},isPendingUser:function(e){var t=e.get("resourceid"),n=e.get("dsaccess:state");return!(!t&&!n)&&(t&&t.startsWith("mailto:")||n&&"pending"===n)},getAccountNameForUser:function(e,t){var n=e.startsWith("mailto:")?t:e;return n&&n.split(":")[1]},getLabelForUserGroup:function(e){return e.detailedObject?e.detailedObject.label?e.detailedObject.label:e.detailedObject["ds6w:label"]:e.dropObj?e.dropObj.objectType:void 0}};return a}),define("DS/RDFFoundation/BatchBuilder",["UWA/Core","UWA/Utils","UWA/Class","DS/RDFFoundation/RequestUtils"],function(e,t,n,i){"use strict";var r=n.extend({init:function(e){this.ajax=this.ajax.bind(this),this.requests=[],this._baseUrl=e.baseUrl,this._ajax=e.ajax},ajax:function(t,n){var i=e.clone(n||{},!1);i.url=t,this.requests.push(i)},addRequestsFromBatch:function(e){this.requests.push.apply(this.requests,e.requests)},_sendSingleRequest:function(t,n,i){var r=i,o=n,s=t,a=o.onComplete&&r.onComplete,l=o.onFailure&&r.onFailure,c=i.waitOnInFlightRequests;if(a||l||c){var d=(o=e.clone(o,!1)).onComplete,u=o.onFailure;o.onComplete=a?function(){d&&d.apply(this,arguments),r.onComplete&&r.onComplete.apply(this,arguments)}:d||r.onComplete,o.onFailure=l?function(){u&&u.apply(this,arguments),r.onFailure&&r.onFailure.apply(this,arguments)}:u||r.onFailure,c&&(o.waitOnInFlightRequests=c)}return s(o.url,o)},sendBatch:function(n){var o,s,a,l=n&&n.ajax||this._ajax,c=this.requests;if(0===c.length)return n&&e.is(n.onComplete,"function")&&n.onComplete(),{cancel:function(){}};var d=e.clone(n||{},!1);if(1===c.length)return this._sendSingleRequest(l,c[0],d);var u=t.getUUID(),h="batch_"+u,p="changeset_"+u,g="\r\n--"+h+"\r\nContent-Type: multipart/mixed;boundary="+p+"\r\n\r\n",f=this._baseUrl.length;o=c.length;var m=1;for(a=0;a<o;a++){if((s=c[a]).changeset=p,s.newTransaction&&a&&(g+="--"+p+"--\r\n",g+="--"+h+"\r\n",g+="Content-Type: multipart/mixed;boundary="+(p="changeset_"+(u=t.getUUID()))+"\r\n\r\n"),g+="--"+p+"\r\n",g+="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\nContent-ID: "+(s.id||m++)+"\r\n\r\n",g+=s.method+" "+s.url.substring(f)+"\r\n",i.addNecessaryHeadersAndParams(s),s.headers)for(var v=Object.keys(s.headers),y=v.length,C=0;C<y;C++){var _=v[C];g+=_+": "+s.headers[_]+"\r\n"}g+="\r\n",g+=(s.data||"")+"\r\n"}return g+="--"+p+"--\r\n--"+h+"--",d.method="POST",d.data=g,d.headers={"Content-Type":"multipart/mixed;boundary="+h},d.url=this._baseUrl+"batch",d.responseType="text",d.batchRequest=!0,d.onComplete=function(t){var i=r.parseBatchRequest(t),a=i.length,l=0;o=c.length;for(var d,u=function(t,n){var i=this[n],r=i.data;2===Math.floor(i.status/100)?("json"===t.type&&(r=JSON.parse(r)),e.is(t.onComplete,"function")&&t.onComplete(r,i.headers)):e.is(t.onFailure,"function")&&t.onFailure(i.data,i.headers)},h=function(t){"string"==typeof this.data&&(this.data={msg:this.data}),this.data["@code"]=this.status,e.is(t.onFailure,"function")&&t.onFailure(new Error('NetworkError: URL "'+t.url+'" return ResponseCode with value "'+(this.status||0)+" "+(this.statusText||"")+'".'),this.data,this.headers)},p=0;p<a;p++){d=i[p];for(var g=[];l<o;l++){if((s=c[l]).newTransaction&&l){s.newTransaction=!1;break}g.push(s)}if(e.is(d,"array")){if(d.length!==g.length)throw new Error("expecting "+g.length+" response.  Got "+d.length);g.forEach(u,d)}else g.forEach(h,d)}n&&e.is(n.onComplete,"function")&&n.onComplete(t)},d.onFailure=function(){for(o=c.length,a=0;a<o;a++)s=c[a],e.is(s.onFailure,"function")&&s.onFailure.apply(this,arguments);n&&e.is(n.onFailure,"function")&&n.onFailure.apply(this,arguments)},d.onTimeout=function(){for(o=c.length,a=0;a<o;a++)s=c[a],e.is(s.onTimeout,"function")?s.onTimeout.apply(this,arguments):e.is(s.onFailure,"function")&&s.onFailure.apply(this,arguments);n&&e.is(n.onFailure,"function")&&n.onFailure.apply(this,arguments)},d.ignoreDictionary=!0,l(d.url,d)}});return r.parseBatchRequest=function(e){var t=e,n=t.indexOf("\r\n",1),i=t.substr(0,n),r=t.split(i),o=r.length,s=[];s.boundary=i;for(var a=function(e){if(e.length){var t=e.match(/([^:]*):(.*)/);t&&(this[t[1]]=t[2])}},l=function(e){var t=e.trim().split("\r\n\r\n",2),n=t[0].split("\r\n");if(n.length>1){var i={};n.forEach(a,i);var r=t[1],o=r.split("\r\n"),l=o.shift(),c=l.match(/(POST|GET|PATCH|DELETE|PUT)[ ]+(.*)/),d=l.match(/HTTP\/1\.1[ ]+([0-9]+)[ ]+(.*)/),u={data:e.substr(t[0].length+2*"\r\n\r\n".length+r.length),partHeader:i};return c?(u.url=c[2],u.method=c[1]):d&&(u.status=parseInt(d[1],10),u.statusText=d[2]),i={},o.map(a,i),u.headers=i,u}return s},c=1;c<o-1;c++){var d=r[c],u=d.match(/Content-Type:\s*multipart\/mixed;boundary=(.*)/);if(u){var h=u[1],p=d.split("--"+h);p.pop(),p.shift();var g=p.map(l.bind(this));g.boundary=h,s.push(g)}else s.push(l.call(this,d))}return s},r}),define("DS/RDFFoundation/RDFUtils",["UWA/Core","UWA/Utils","UWA/Utils/Cookie","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PlatformAPI/PlatformAPI","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/BatchBuilder","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/ProjectTypeUtils","DS/E6WCommonUI/PlatformManager","DS/E6WCommonUI/Search","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r,o,s,a,l,c,d,u,h,p){"use strict";var g,f=/(-)?P(?:([0-9]+|NaN)D)?T?(?:([0-9]+|NaN)H)?(?:([0-9]+|NaN)M)?(?:([0-9.]+|NaN)S)?/,m={"3dspace":"3DSpace",drive:"3DDrive",swym:"3DSwym",geovia:"geoservice","3dportfolio":"3dportfolio"},v={dsxplan:"http://www.3ds.com/RDF/Corpus/xPlan/",dsplan:"http://www.3ds.com/RDF/Corpus/Plan/",dskern:"http://www.3ds.com/RDF/Corpus/Kernel/",dspol:"http://www.3ds.com/RDF/Corpus/Policy/",dscom:"http://www.3ds.com/RDF/Corpus/com/",ds6w:"http://www.3ds.com/vocabularies/ds6w/",dsbase:"http://www.3ds.com/RDF/Corpus/dsbase/",iam:"http://iam.3ds.com/",dsaccess:"http://www.3ds.com/RDF/Corpus/Access/",w3:"http://www.w3.org/1999/02/"},y=function(e){for(var t={},n=Object.keys(e),i=n.length,r=0;r<i;r++){var o=n[r];t[e[o]]=o}return t};var C={cancel:function(){var e=this.options.queue||g;if(this.actualRequest)delete this.options.onComplete,this.actualRequest.cancel&&this.actualRequest.cancel();else{var t=g._pendingRequests.indexOf(this);e._pendingRequests.splice(t,1)}},onComplete:function(t){var n=this.options.queue||g;this.removeFromInFlightRequest(),t&&t.httpStatusCode>400?e.is(this._onFailure,"function")&&this._onFailure(t):e.is(this._onComplete,"function")&&this._onComplete.apply(this,arguments),g.sendPendingRequests(n)},onFailure:function(){var t=this.options.queue||g;this.removeFromInFlightRequest(),e.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments),g.sendPendingRequests(t)},onTimeout:function(){var t=this,n=this.options.queue||g;e.is(this._longRunningOperationTimeoutCallback,"function")?this._longRunningOperationTimeoutCallback({onComplete:function(){var n=t.options.queue||g;t.removeFromInFlightRequest(),e.is(t._onTimeout,"function")&&t._onTimeout.apply(t,arguments),g.sendPendingRequests(n)},onFailure:function(){t.onFailure.apply(t,arguments)}}):(this.removeFromInFlightRequest(),e.is(this._onTimeout,"function")?this._onTimeout.apply(this,arguments):e.is(this._onFailure,"function")&&this._onFailure.apply(this,arguments),g.sendPendingRequests(n))},removeFromInFlightRequest:function(){var e=this.options.queue||g,t=e._inFlightRequests.indexOf(this);e._inFlightRequests.splice(t,1),e!==g&&(t=g._inFlightRequests.indexOf(this),g._inFlightRequests.splice(t,1))}};return(g={MAX_CONCURRENT_REQUEST:20,TAGGER_URI_PREFIX:"dsplan:",WEDO_TAGGER_URI_PREFIX:"swym:wedo%3Aeoe%3A",_inFlightRequests:[],_pendingRequests:[],DOWNLOADABLE_TYPES:["MS Word Document","MS Excel Document","MS Powerpoint Document","MS Outlook Document","MS Word Template","MS Excel Template","MS Powerpoint Template","MS Outlook Template","Document","DriveFile"],EDITABLE_TYPES:["MS Word Document","MS Excel Document","MS Powerpoint Document","MS Outlook Document","MS Word Template","MS Excel Template","MS Powerpoint Template","MS Outlook Template","MS Outlook Attachment","Document"],inverseMapping:y,sourceToServiceMap:m,serviceToSourceMap:y(m),serviceFromSource:function(e){return g.sourceToServiceMap[e]||e},sourceFromService:function(e){return g.serviceToSourceMap[e]||e},serviceArrayFromSourceArray:function(e){return e.map(g.serviceFromSource)},_computeTypeAheadEntryBasedOnFedSearchResult:function(e){for(var t=e.attributes,n=t.length,i={},r=0;r<n;r++){var o=t[r],s=o.value;switch(o.name){case"resourceid":i.value=s;break;case"ds6w:resourceUid":s=c.preProcessPersonObject(s,i),i.resourceUid=s;break;case"preview_url":i.image=s;break;case"ds6w:type":case"ds6w:what/ds6w:type":i["ds6w:type"]=s;break;case"ds6w:label":i.label=s;break;case"sourceid":i.sourceId=s}}return i},onTypeAheadComplete:function(t,n,i){var r=(e.is(i,"string")?JSON.parse(i):i).results,o=[];if(r)for(var s=r.length,a=0;a<s;a++){var l=r[a],c=g._computeTypeAheadEntryBasedOnFedSearchResult(l);if(n.fieldConfig&&"dsplan:hasWorkContext"===n.fieldConfig.name){var d=n.model.get(n.fieldConfig.name),u=g.removeBracketLongURI(c.resourceUid)||c.sourceId;if(d||u===n.model.id)(d&&d.id)!==u&&u!==n.model.id&&o.push(c);else o.push(c)}else o.push(c)}t(o,n)},typeAheadCallback:function(t,n,i,r){var o=e.clone(r||{},!1);o.fieldConfig=t,n=s.escapeTwoByteChars(n);var a,l,c=s.filterSearchSources(t.searchSource);return window.widget.getValue("oldSearch")?a="("+n+"* OR "+n+")":(a=(a=n.split(",").map(function(e){return e.trim()})).filter(function(e){return e}),a=s.getFederatedQueryCriteria({criteria:a,fieldType:t.type,fieldConfig:t}),l=s.getFederatedQueryPreCondition(t)),s.sendRequest({select_predicate:["ds6w:label","ds6w:resourceUid","ds6w:type","ds6w:type_value","type_icon_url","preview_url"],sources:c,query:a,precond:l,specific_source_parameter:h.computeSourceParameters(t,n),with_synthesis_attribute:Boolean(c&&-1!==c.indexOf("swym")),onComplete:g.onTypeAheadComplete.bind(void 0,i,o),onFailure:g.onTypeAheadComplete.bind(void 0,i,o)})},complete:function(t,n,i){var r=e.clone(i||{},!1),o=r.batchGenerator,s=r.mask;if(s&&"undefined"!==s){var a=function(t,n,i){var r=e.clone(i||{}),o=[],s=r.mask;delete r.mask;for(var a=0;a<n.length;a++){var l=g.getObjectForAdding(t,n[a],r);!l.id||r.onlyIfNeeded&&s&&l.hasDataForMask(s,{checkFetching:!0})||(l._onRequest&&l._onCompleteRequest&&l._onRequest(),l.fetchingMask(s),l.completing=!0,o.push(l))}return o}(t,n,r);if(0!==a.length)for(var l=function(e){e.forEach(function(e){var t=g.getObjectById(e);t._onCompleteRequest&&t._onCompleteRequest(),t.doneFetchingMask(s),t.completing=!1})},c=r.onComplete,d=r.onFailure,u=function(e,t){!function(e,t,n){(e.member||[]).forEach(function(e){if(404===e.error||401===e.error){var i=g.getObjectById(e["@id"]);i&&n&&n(i)}else{var r=g.getExistingAndMerge(e,{animate:t});r&&r.addMask(e["@mask"])}})}(t,i.animate,d),l(e),0==--v&&c&&c()},h=function(e){if(l(e),d)for(var t=e.length,n=0;n<t;n++)d(e[n]);0==--v&&c&&c()},p=[],f=o?o.ajax:g.request,m=a.map(function(e){return p.push(e.id),g.jsonURIToSparqlURI(e.id)}),v=Math.ceil(m.length/10);m.length;){var y=m.splice(0,10),C=p.splice(0,10),_="classes/rdfs:Resource?$mask="+s;_+="&$where="+encodeURIComponent("?s WHERE { VALUES ?s {"+y.join(" ")+"} }"),f(g.expandUrl(_,"v1"),{method:"GET",type:"json",newTransaction:!0,onComplete:u.bind(void 0,C),onFailure:h.bind(void 0,C)})}else r.onComplete&&r.onComplete()}else console.log("empty mask in complete function")},subscribeToNotification:function(e){return o.subscribe("XApp.Magic.Update",e)},hrefFromId:function(e){var t="/resources/";return t+=e},getObjectById:function(e){e=g.getObjectIDFromUserMap(e);return g.objectMap[e]},getObjectIDFromUserMap:function(e){e=g.removeBracketLongURI(e);return c.userMap[e]||e},resetObjectMap:function(){g.objectMap={},c.userMap={}},addObjectToMap:function(e,t){var n=g.removeBracketLongURI(e);g.objectMap[n]&&console.error("attempting to add object to an existing id"),g.objectMap[n]=t},removeObjectFromMap:function(e){!g.objectMap[e]&&console.log("Removing object from map that wasn't there. Not an issue, just strange"),delete g.objectMap[e]},getObjectForAdding:function(t,n,i){var r=g.removeBracketLongURI(n),o=e.clone(i||{},!1),s=g.getObjectById(r);if(!s&&t){var a=g.getTypeCollection(t,{create:!0}),l=i&&i.attrs&&i.attrs["@type"]||!0;s=g.createPlaceholder(r,void 0,l),o.attrs&&(e.merge(s,o.attrs),o.attrs["dsxplan:jsType"]&&delete s["@type"],delete o.attrs),s=a.add(s,o)}return o.mask&&(o.onlyIfNeeded=!0,s.fetch(o)),s},createPlaceholder:function(e,t,n,i){var r={"@id":g.removeBracketLongURI(e),"@href":g.hrefFromId(e),"@mask":t,"@type":n,_skeletonId:e};return i&&i.forceDslc&&(r.forceDslc=!0),r},splitUri:function(e){var t;return t=e.indexOf(":"),[e.substr(0,t),e.substr(t+1)]},getAssetUrl:function(e){var t;return"webapps"===(t=g.splitUri(e))[0]&&(e=r.getWebappsBaseUrl()+t[1]),e},parseUrl:function(e){var n,i;return i=(n=t.parseUrl(e)).query.length?t.parseQuery(n.query):{},{path:n.path,mask:i.$mask,where:i.$where&&decodeURIComponent(i.$where)}},buildProductAuthorizationRequests:function(e,t){t.forEach(function(t){e.ajax(g.expandUrl("invoke/dsplan:isProductAuthorized","v1"),{method:"POST",type:"json",data:'"'+t+'.prd"',headers:{"Content-Type":"application/json"},onComplete:function(e){"XPP"===t?u.setXPPAuthorized(e["@value"]||e.value):u.setAuthorized(t,e["@value"]||e.value)}})})},reconstructUrl:function(e){var t=e.path+(e.mask?"?$mask="+e.mask:"");return t+=e.mask&&e.where?"&":"",t+=e.where?"$where="+e.where:""},expandUrl:function(e,t,n){return e=e.replace(/^\//,""),t=t||"v1",e=u.getServiceUrl("3dplan",!0)+"/"+t+"/"+e,n&&n.rdfIndex&&(e=e.replace("3DPLAN","3drdfindex")),e},hasLoadedDictionary:function(){return!!g.typeDictionary&&g.typeDictionary.typeHierarchy},request:function(t,r){var o,s=e.clone(r||{},!1),a=Object.create(C);if(!s.ignoreDictionary&&!g.hasLoadedDictionary()){var c=e.clone(s,!1);c.newTransaction=!0;var d=g.getDictionaryBatch();return s.waitForDictionary?d.sendBatch({onComplete:function(){g.request(t,r)}}):(d.ajax(t,c),d.sendBatch()),a}s.url=t,l.addNecessaryHeadersAndParams(s);var u=s.queue||g;o=i.authenticatedRequest,a.options=s;var h,p=u.MAX_CONCURRENT_REQUEST||g.MAX_CONCURRENT_REQUEST;return u._inFlightRequests.length>=p||s.waitOnInFlightRequests&&g._inFlightRequests.length?(u._pendingRequests.push(a),a):(a._onComplete=s.onComplete,a._onFailure=s.onFailure,a._onTimeout=s.onTimeout,a._longRunningOperationTimeoutCallback=s.longRunningOperationTimeoutCallback,s.onComplete=a.onComplete.bind(a),s.onTimeout=a.onTimeout.bind(a),u._inFlightRequests.push(a),u!==g&&g._inFlightRequests.push(a),s.onFailure=function(i,r){var l=h&&h.xhr&&h.xhr.status;l&&e.is(r,"object")&&(r["@code"]=l),r&&e.is(r,"object")&&(r.error=i),503!==l&&503!==this.status||a.alreadySentOnce?a.onFailure.apply(a,arguments):(n.expire("SERVERID"),n.expire("SOLVERID"),a.alreadySentOnce=!0,h=o(t,s))},g.isBlockingRequests()?(g._blockedRequests.push(s),a):h=o(s.url,s))},createRequestQueue:function(e){return{_inFlightRequests:[],_pendingRequests:[],MAX_CONCURRENT_REQUEST:e||3}},getPendingRequests:function(e){return e._pendingRequests},sendPendingRequests:function(e){var t=e||g;if(e&&!e._pendingRequests.length&&(t=g),t._pendingRequests.length){var n,i=t._pendingRequests,r=i.length,o=t.MAX_CONCURRENT_REQUEST||g.MAX_CONCURRENT_REQUEST;for(n=0;n<r&&t._inFlightRequests.length<o;n++){var s=i[n];g.request(s.options.url,s.options)}t._pendingRequests.splice(0,n)}},getBatchGenerator:function(e){return e&&e.ignoreDictionary||g.hasLoadedDictionary()?new a({ajax:g.request,baseUrl:g.expandUrl("","v1")}):g.getDictionaryBatch()},getExistingAndMerge:function(t,n){var i=e.clone(n||{},!1),r=g.getObjectById(t["@id"]);if(i.mergeIfSameETag&&(r&&r.get("@etag")===t["@etag"]||(r=void 0)),r){var o=t;r.isDSLC()&&o&&(o=r._mapDslcAttributes(o)),o=r.parse(o),i.parse=!0,r.set(o,i)}return r},getModelConstructor:function(t){var n;if(g.typeDictionary){if(g.typeDictionary.typeMap){var i=t["@type"]||t["dsxplan:jsType"];if(!i){var r=t["dsxplan:actualType"]||t["dsplan:actualType"];i=r&&r["@id"]}if(i){var o=g.typeDictionary.typeMap[i];return o&&o.type}}if(g.typeDictionary.mapping){var s,a=t["rdf:type"],l=e.is(a,"array")?a:a&&a.member,c={};if(l)l.forEach(function(e){c[e["@id"]]=e});else if(t["@type"]){var d=t["@type"];c[d]=d}g.typeDictionary.mapping.some(function(e){return!!c[e.key]&&(s=e.type,!0)}),n=s}}return n},removeTypeCollection:function(e){var t;if(g.typeDictionary&&g.typeDictionary.modelIndexes){var n=g.typeDictionary.modelIndexes.get(e);g.typeDictionary.modelIndexes.delete(e),t=n}return t},resetTypeCollection:function(e,t){g.typeDictionary&&(g.typeDictionary.modelIndexes||(g.typeDictionary.modelIndexes=new Map),g.typeDictionary.modelIndexes.set(e,t))},getTypeCollection:function(e,t){var n;if(g.typeDictionary){g.typeDictionary.modelIndexes||(g.typeDictionary.modelIndexes=new Map);var i=g.typeDictionary.modelIndexes.get(e);!i&&t&&t.create&&(i=new g.ResultCollection(void 0,{model:e,"@href":"classes/"+e.prototype._uwaClassName,"@id":"typeCollection:"+e.prototype._uwaClassName}),g.typeDictionary.modelIndexes.set(e,i)),n=i}return n},getModelByTypeAndId:function(e,t,n){var i=this.getTypeCollection(e,n);return i&&i.get(t,n)},_maskStrength:function(e){if(!e)return-1;if(g.typeDictionary&&g.typeDictionary.masksStrength){var t=g.typeDictionary.masksStrength[e];if(void 0!==t)return t}return"dskern:Mask.Default"===e?0:e.match(/.*\.Basic$/)?1:e.match(/.*\.Simple$/)?2:e.match(/.*\.Collapsed$/)?6:e.match(/.*\.Expanded$/)?8:e.match(/.*\.Complex$/)?10:1},compareMasks:function(e,t){return g.typeDictionary&&g.typeDictionary.masksStrength,g._maskStrength(e)-g._maskStrength(t)},xsdDayTimeDurationToMilliseconds:function(e){var t,n=0,i=String(e).match(f);return i&&(t="-"===i[1],n=864e5*parseInt(i[2]||0)+36e5*parseInt(i[3]||0)+6e4*parseInt(i[4]||0)+1e3*parseFloat(i[5]||0),t&&(n=-n)),n},millisecondsToXsdDayTimeDuration:function(e){return(e<0?"-":"")+"PT"+Math.abs(e)/1e3+"S"},handleContext:function(t){if(t){var n=t["@context"];n&&e.merge(g.typeDictionary.context,n)}},shortToLongURI:function(e){var t=g.splitUri(e),n=g.typeDictionary.context[t[0]],i=e;return n?i="<"+n+t[1]+">":"uuid"===t[0]&&(i="<"+e+">"),i},conditionalShortToLongURI:function(e){return e.startsWith("uuid")&&(e=g.shortToLongURI(e)),encodeURIComponent(e)},longToShortURI:function(e){var t=e.split("/"),n=t.pop(),i=t.join("/")+"/";return g.inverseTypeDictionary[i]?`${g.inverseTypeDictionary[i]}:${n}`:e},jsonURIToSparqlURI:function(e){var t=e;if(t){var n=g.splitUri(e);g.typeDictionary.context[n[0]]&&n.length>=2&&!n[1].startsWith("//")?t=e:"uuid"===n[0]&&(t="<"+e+">")}return t},removeBracketLongURI:function(t){return t&&e.is(t,"string")&&t.startsWith("<")&&t.endsWith(">")&&(t=t.substr(1,t.length-2)),t},getURIForFiltering:function(t){return t&&e.is(t,"string")&&(t=t.replace(this.TAGGER_URI_PREFIX,"")),t&&e.is(t,"string")&&(t=t.replace(this.WEDO_TAGGER_URI_PREFIX,"")),this.removeBracketLongURI(decodeURIComponent(t))},loadTypeList:function(e){var t=e&&e.member;if(t){for(var n,i,r={},o={},s=t.length,a=function(e){return e.key===n&&(i=e,!0)},l=function(e){var t=e.Name;t&&(i&&(r[t]=i),o[n].push(t))},c=0;c<s;c++){var d=t[c];n=d.Name,i=void 0,o[n]=[],g.typeDictionary.mapping.some(a),g.scanStructure(d,l)}g.typeDictionary.typeMap=r,g.typeDictionary.typeHierarchy=o}for(var u=g.typeDictionary.mapping,h=u.length,p=0;p<h;p++){var f=u[p];g.typeDictionary.typeMap[f.key]||(g.typeDictionary.typeMap[f.key]=f)}},scanStructure:function(t,n,i,r){if(e.is(t,"array"))for(var o=t.length,s=0;s<o;s++){var a=t[s];if("STOP"===g.scanStructure(a,n,t))return"STOP"}else if(e.is(t,"object")){for(var l=Object.keys(t),c=l.length,d=0;d<c;d++){var u=l[d],h=t[u];if("@context"!==u&&"rdf:type"!==u&&((e.is(h,"object")||e.is(h,"array"))&&"STOP"===g.scanStructure(h,n,t,u)))return"STOP"}return n(t,i,r)}},typeDictionary:{context:v},inverseTypeDictionary:y(v),getDictionaryBatch:function(t){var n=e.clone(t||{},!1),i=g.getBatchGenerator({ignoreDictionary:!0});n.ajax=i.ajax;var r=function(e){var n,i=(n="E6WCommonUI.Alert.3DPlanServiceFail",p.get(n));return window.widget&&window.widget.alerter&&!u.isOnPremise()&&(window.widget.alerter.add({message:i,className:"error"}),window.widget.alerter.show()),t&&e&&e.apply(this,arguments)};return i.ajax(g.expandUrl("invoke/dsmf:xplan.xPlanVocabulary.getVocabulary"),{method:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify([]),onComplete:function(e){g.loadTypeList(e)},onFailure:r.bind(this,t&&t.onFailure),onTimeout:r.bind(this,t&&(t.onTimeout||t.onFailure)),type:"json"}),this.buildProductAuthorizationRequests(i,["XPP","RSK","DPM","XWO"]),d.loadProjectTypes(i.ajax),i},serverHasDSLC:function(){return!(!this.typeDictionary||!this.typeDictionary.typeHierarchy)&&this.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"]},removeAllTypeCollections:function(){delete g.typeDictionary.modelIndexes},removeObjectFromIndex:function(e){var t=g.getObjectById(e);t&&(g.getTypeCollection(t.constructor).remove(t),delete g.objectMap[e]);return t},isBlockingRequests:function(){return e.is(g._blockedRequests,"array")},blockRequests:function(){g._blockedRequests=g._blockedRequests||[]},unblockRequests:function(){g.isBlockingRequests()&&(g._blockedRequests.forEach(function(e){i.authenticatedRequest(e.url,e)}),delete g._blockedRequests)},clearBlockedRequests:function(){delete g._blockedRequests},getCurrentUserName:function(){var e=g.getObjectById(u.getContextUserUid());if(!e||!e.fullName){var t=o.getUser();return t.firstName+" "+t.lastName}return e.fullName},downloadFCSFile:function(t,n){let i=e.clone(n||{});i.onFailure=i.onFailure||Function.prototype,g.request(g.expandUrl(`invoke/dspol:checkOut?$this=${t}`),{method:"POST",type:"json",onComplete:function(e){g.request(e.url,{method:"POST",data:{__fcs__jobTicket:e.body},onComplete:function(e){i.onComplete&&i.onComplete(e)},onFailure:i.onFailure})},onFailure:i.onFailure})}}).inverseMapping=y,g.MS_DAY=864e5,g}),define("DS/RDFFoundation/Models/ResultModel",["UWA/Core","UWA/Utils","UWA/Class/Model","UWA/Class/Collection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/MaskUtils","DS/RDFFoundation/Mixins/FetchTrackingMixin","DS/E6WCommonUI/ApolloUtils","DS/E6WCommonUI/UIHelper","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r,o,s,a,l,c,d){"use strict";r.objectMap={};var u,h,p=n,g=Object.prototype.hasOwnProperty;h=e.is;var f=function(){var t=this.get("dsxplan:jsType")||this.get("@type")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");return t&&!e.is(t,"string")&&(t=t.id),t};return u={_mapDslcAttributes:function(e){if(e&&this.dslcMapping)for(var t=Object.keys(e),n=t.length,i=0;i<n;i++){var r=t[i],o=this.dslcMapping[r];if(o){var s=e[r];delete e[r],e[o]=s}}return e},isRDF:!0,serviceHosting:"3dplan",idAttribute:"@id",_uwaClassName:"ResultModel",getIdForFederatedSearch:function(){return this.id},getCombinedAttributes:function(e){let t=this.getChangedAttributesSinceLastSave(),n=e?Object.keys(e):[];return e?n.concat(t.filter(e=>n.indexOf(e)<0)):t},setCollection:function(t,n){var i=this;this._collections[t]=n;var r=this.getPropertyInverse(t);function o(t){var n;return!r.name||t&&t.dontRegisterChange||(n=e.clone(t||{},!1),e.merge(n,r),n.dontRegisterChange=!0),n}this.listenTo(n,{onAdd:function(e,n,i){var r=o(i);r&&e._addToModelOrCollectionProperty(this,r),this._registerChangedCollection(t,e,n,i)},onRemove:function(e,n,r){var s=o(r);s&&e._removeFromModelOrCollectionProperty(i,s),this._registerChangedCollection(t,e,n,r)},onReset:function(e,n){var r=o(n);if(r){var s={};n.previousModels.forEach(function(e){s[e.id]=e}),e.forEach(function(e){s[e.id]?delete s[e.id]:e._addToModelOrCollectionProperty(i,r)});for(var a=Object.keys(s),l=0;l<a.length;l++){s[a[l]]._removeFromModelOrCollectionProperty(i,r)}}this._registerChangedCollection.bind(this,t)}})},hasViewAccess:function(){return!0},MAX_CONCURRENT_REQUEST:1,init:function(e,t){this._inFlightRequests=[],this._pendingRequests=[],e&&e.forceDslc&&(this._isDslc=!0,delete e.forceDslc),this.initFetchTrackingMixinForInstance(),this._models={},this._collections={},this._changedAttributesSinceLastSave={},this.isDSLC(e||{})&&(e=this._mapDslcAttributes(e));var n=t||{};Object.defineProperty(this,"collectionConstructor",{get:this._getCollectionConstructor,set:function(e){return this._collectionConstructor=e,e}}),this._collectionConstructor||(n.collectionConstructor?this.collectionConstructor=n.collectionConstructor:n.collection&&(this.collectionConstructor=n.collection.constructor));var i=e&&e["@id"];if(i){if(r.getObjectById(i))throw new Error("object existing try to get existing from resultmodel first");r.addObjectToMap(r.removeBracketLongURI(i),this),e["@href"]||(e["@href"]=r.hrefFromId(i))}return this._parent.apply(this,arguments)},_getCollectionConstructor:function(){return this._collectionConstructor||this.collection&&this.collection.constructor||r.ResultCollection},_registerChangedCollection:function(e,t,n,r){var o=n,s=r;t instanceof i&&(o=t,s=n),s&&(s.parse||s.dontRegisterChange)||this.isPropertyVolatile(e)||(this._changedAttributesSinceLastSave[e]=o)},getParent:Function.prototype,getParentModels:function(e){if(this.getParent()){var t=this.getParent();e.push(t.id),t.getParentModels(e)}},isParentHierarchyLoaded:function(e,t){return!!e&&(t===e||this.isParentHierarchyLoaded(e.getParent(),t))},_registerChangedAttributes:function(t,n){var i=t||this,r=e.clone(n||{},!1);if(!r.parse&&!r.dontRegisterChange){var o=i.changedAttributes();for(var s in o)g.call(o,s)&&!this.isPropertyVolatile(s)&&this._registerChangedAttribute(s,o[s],n)}},_registerChangedAttribute:function(e,t,n){var i=this._changedAttributesSinceLastSave;void 0!==i[e]&&null!==i[e]||(i[e]=this.previous(e)),t instanceof u&&(this._models[e]=t),this._updateInverseProperty(e,t,n)},_updateInverseProperty:function(t,n,i){var o=this.getPropertyInverse(t);if(o.name){var s=e.clone(i||{},!1);e.merge(s,o),s.dontRegisterChange=!0;var a=this.previous(t);a&&(a["@id"]&&(a=r.getObjectById(a["@id"])),a instanceof u&&a._removeFromModelOrCollectionProperty(this,s)),n&&n instanceof u&&n._addToModelOrCollectionProperty(this,s)}},_removeFromModelOrCollectionProperty:function(e,t){t.isCollection?this.getCollectionAttribute(t.name).remove(e,t):this.unset(t.name,t)},_addToModelOrCollectionProperty:function(e,t){t.isCollection?this.getCollectionAttribute(t.name).add(e,t):this.set(t.name,e,t)},destroy:function(t){this.destroying=!0;var n=e.clone(t||{},!1),i=this;n.apolloShouldIgnore||(n.onComplete=function(){l.onModelDeleted(i),t&&t.onComplete&&t.onComplete.apply(i,arguments)}),n.dontRegisterChange=!0;var o=Array.prototype.slice.call(arguments,0);o[0]=n,this.stopListening(),r.removeObjectFromMap(this.id),r.removeObjectFromMap(this.cid),this._parent.apply(this,o),this.removeEvents()},clone:function(){throw new Error("don't clone resultmodels please")},toJSON:function(t){var n="string"==typeof t?{}:e.clone(t||{},!1),i=void 0===n.level?1:n.level;if(i<0)return{};n.level=i-1;var r=n.ancestors,o=r&&r[this.id];r||(n.ancestors=r={});try{r[this.id]=!0;var s=this._parent.apply(this,arguments),a={},l={};if(n.attributes)for(var c=n.attributes.length,u=0;u<c;u++){var h=n.attributes[u],p=s[h];void 0!==p&&(l[h]=p),a[h]=!0}else l=s;if(n.attributesWhiteList=a,o||(this._jsonChildren(l,this._models,i,n),this._jsonChildren(l,this._collections,i,n),t&&t.noSkeletonId&&delete l._skeletonId),this.isDSLC()&&this.dslcMapping&&(n.level=i,delete n.ancestors,n.isAnAncestor=o,this._jsonDSLC(l,n)),n.attributes){var g=n.attributes.filter(function(e){return!l[e]});this._jsonAddAttributes(l,g,n)}return this.hasViewAccess()||(l.error="No Access",l.noAccessCharacter=d.get("E6WCommonUI.Error.NoAccess")+" "),l}finally{delete r[this.id]}},_jsonChildren:function(e,t,n,i){for(var o=Object.keys(t),s=o.length,a=i.attributesWhiteList,l=0;l<s;l++){var c=o[l];if(0!==n){if(i.attributes&&!a[c])continue;var d=t[c];if(d instanceof r.ResultCollection&&!d.length&&i.noEmptyCollection){delete e[c];continue}e[c]=d.toJSON(i)}else delete e[c]}},_jsonAddAttributes:function(t,n,i){for(var o=i.attributesWhiteList,s=i.isAnAncestor,a=n.length,l=0;l<a;l++){var c=n[l];if(!i.attributes||o[c]){var d=this.get(c),h=!1;if(void 0!==d){if(!s){if(e.is(d,"array")){for(var p=[],g=0;g<d.length;g++)if(d[g]instanceof u||d[g]instanceof r.ResultCollection){if(0===i.level){h=!0;break}p.push(d[g].toJSON(i))}d=p}(d instanceof u||d instanceof r.ResultCollection)&&(0!==i.level?d=d.toJSON(i):h=!0)}h?delete t[c]:t[c]=d}}}},_jsonDSLC:function(e,t){if(t.dataForRendering){var n=Object.keys(this.dslcMapping);this._jsonAddAttributes(e,n,t)}},getCollectionAttribute:function(e,t){var n=e;this.isDSLC()&&this.dslcMapping&&(n=this.dslcMapping[e]||n);var i=this.get(n);return i||(i=this.addNewCollectionData(n,void 0,t)),i},isNew:function(){return!!this.forcedNew||this._parent.apply(this,arguments)},_syncCreateDSLC:function(e,t){var n=t.idToDuplicate?u.CLONE_ITEM_VERSION_URI:u.CREATE_ITEM_VERSION_URI,i=t.mask||this.writeMask||this.getMask(),o=i?"?$mask="+i:"";t.url=r.expandUrl(n+o);var s=this.getParentPath(),a=t.idToDuplicate;t.data=a?JSON.stringify([t.attrs,a,s]):JSON.stringify([t.attrs,s]),t.method="POST"},syncCreate:function(e,t){var r=this,o={},s={};Object.keys(e).forEach(function(t){var a,l;if((a=e[t])instanceof i){if(!a.length)return;o[t]=a,l=a.compactJson()}else l=a instanceof n||Boolean(this._models[t])?a?r.getRelatedModelCompactJson(a,t):void 0:a;s[t]=l},this);var a,l,c=(a=this.getParentPath(),(l=a.split("/"))[l.length-1]),d=this.getPropertyThisIsInverseOf(c);d&&delete s[d],t.attrs=t.attrs=t.noStringify||this.isDSLC()||t.dslc?s:JSON.stringify(s);var u=[],h=Object.keys(this._models),p=Object.keys(this._collections),g=t.onComplete,f=t.onFailure;h.forEach(function(e){var t=this[e];t.isNew()&&u.push(t)},this._models);var m=function(e){e.isNew()&&u.push(e)};p.forEach(function(e){this[e].forEach(m)},this._collections),t.onComplete=function(){var e;e=r._collections,Object.keys(e).forEach(function(e){var t=o[e];t&&t.resetFlags()}),u.forEach(function(e){e.isNew()&&e.destroy()}),g&&g.apply(r,arguments)},t.onFailure=function(){r.destroy({noServer:!0,dontRegisterChange:!0}),f&&f.apply(r,arguments)};var v=t.onTimeout;t.onTimeout=function(){r.destroy({noServer:!0,dontRegisterChange:!0}),v&&v.apply(r,arguments)},this.collection&&this.collection.removeAddedModel(this),(this.isDSLC()||t.dslc)&&this._syncCreateDSLC(e,t)},_syncPatchDSLC:function(e,t){var n=t.mask||this.getMask();t.url=r.expandUrl(u.MODIFY_ITEM_VERSION_URI+(n?"?$mask="+n:""));var i=t.activityIdToSubscribe;t.data=i?JSON.stringify([t.attrs,this.id,i]):JSON.stringify([t.attrs,this.id]),t.method="POST"},_syncPatchHandleCollectionAttribute:function(t,n,i){var r,o=n._replaceOnSave,s=[],a=this;return delete n._replaceOnSave,"rdf:type"===t&&1===n._added.length&&1===n.length&&(n._removed.length>0||o)?s.push({op:"replace",path:"/"+t,value:this.getRelatedModelCompactJson(n._added[0],t)}):(n._added.forEach(function(e){s.push({op:"add",path:"/"+t+"/-",value:a.getRelatedModelCompactJson(e,t)})}),n._removed.forEach(function(n){r=n["@value"],e.is(r)?e.is(r,"string")&&(r='"'+r+'"'):r=n.id,s.push({op:"remove",path:"/"+t+"/{"+r+"}"})})),i[t]={_removed:n._removed,_added:n._added},n.resetFlags(),s},syncPatch:function(t,r){var o=[],s={},a=this._changedAttributesSinceLastSave;this._changedAttributesSinceLastSave={};var l,c={},d=this;if(Object.keys(a).forEach(function(e){var r,l,u,p,g;d.isPropertyVolatile(e)||d.computedProperties&&d.computedProperties[e]||((r=t[e])instanceof i?o.push.apply(o,d._syncPatchHandleCollectionAttribute(e,r,c)):(g=r instanceof n||Boolean(this._models[e]),u=a[e],h(u)&&!h(r)?p="remove":!h(u)&&h(r)?p="add":h(u)&&h(r)&&(g&&u.id!==r.id||!g&&u!==r)&&(p="replace"),g?(s[e]=r,l=r?d.getRelatedModelCompactJson(r,e):void 0):l=r,p&&o.push({op:p,path:"/"+e,value:l})))},this),o.length||(r&&r.onComplete&&r.onComplete(),l={cancel:function(){}}),!l){r.attrs=r.noStringify||this.isDSLC()?o:JSON.stringify(o);var u=e.clone(r||{},!1),p=r.onFailure;r.onFailure=function(e){p&&p(e),this.dispatchEvent("onError",[this,e,u]),this.rollbackChanges(a,c,t)}.bind(this),r.url=this.url({mask:this.writeMask})}return!l&&this.isDSLC()&&(l=this._syncPatchDSLC(t,r)),l},rollbackChanges:function(e,t,n){var i=this,r=e||this._changedAttributesSinceLastSave,o=!1,s={};if(Object.keys(r).forEach(function(e){var t=i.get(e),n=r[e];n!==t&&(s[e]=n,o=!0)}),o){this.set(s,{dontRegisterChange:!0});var a=this._previousAttributes;this._previousAttributes=n;for(var l=Object.keys(s),c=0;c<l.length;c++){var d=l[c];this._updateInverseProperty(d,s[d])}this._previousAttributes=a}Object.keys(t).forEach(function(e){var n=i.get(e),r=t[e],o=!1;r._added&&r._added.forEach(function(t){i.onCollectionRollback(e),n.remove(t,{dontRegisterChange:!0}),o=!0}),r._removed&&r._removed.forEach(function(e){n.add(e,{dontRegisterChange:!0}),o=!0}),o&&i._fireRelationshipChangeEvents(e)}),this._changedAttributesSinceLastSave={}},onCollectionRollback:Function.prototype,_dontRollBackAndRetrySave:function(t,n){var i=this;e.extend(this._changedAttributesSinceLastSave,t),Object.keys(n).forEach(function(e){var t=i.get(e),r=n[e];r._added&&r._added.forEach(function(e){t._registerAddedModel(e)}),r._removed&&r._removed.forEach(function(e){t._registerRemovedModel(e)})}),this.save()},fetchingMask:function(e){this._masksBeingFetched=this._masksBeingFetched||{},this._masksBeingFetched[e]=!0},doneFetchingMask:function(e){this._masksBeingFetched&&delete this._masksBeingFetched[e]},_syncSetQueue:function(t,n){if(this instanceof u&&!n.queue){var i=this;"create"===t&&e.is(this.getParent,"function")&&(i=this.getParent()||this),n.queue=i}},sync:function(t,n,i){if(i&&i.noServer)return i&&i.onComplete&&i.onComplete(),{cancel:function(){}};var o=this,s=e.clone(i||{},!1);s.ajax||(s.ajax=r.request,this._syncSetQueue(t,s));var a=e.extend(this.toJSON({noSkeletonId:!0}),this._collections);a=e.extend(a,this._models);var l=Array.prototype.slice.call(arguments,0);l[2]=s;var d=i.onComplete,h=i.onFailure,p=function(e){c.trackPageEvent({eventCategory:"ResultModel",eventAction:e,eventLabel:n.getObjectType()})};switch(t){case"create":this.syncCreate(a,s);try{p(t)}catch(e){console.log("e")}break;case"update":case"patch":l[0]="patch";var g=this.syncPatch(a,s);if(g)return g;try{p(t)}catch(e){console.log("e")}break;case"read":var f=this.mask;i&&i.mask&&!i.dontUpdateMask&&(this.mask=i.mask,this.fetchingMask(this.mask)),this.fetching=!0,s.onComplete=function(e){!e["dsxplan:jsType"]&&!e["@type"]&&o instanceof u?s.onFailure(e,"no-access"):(i&&i.mask&&!i.dontUpdateMask&&o.doneFetchingMask(i.mask),o.fetching=!1,d&&d.apply(this,arguments))},s.onFailure=function(){i&&i.mask&&!i.dontUpdateMask&&o.doneFetchingMask(i.mask),o.fetching=!1,o.mask=f,h&&h.apply(this,arguments)};break;case"delete":this.syncDelete(s);try{p(t)}catch(e){console.log("e")}}return s.id=this.id||this.cid,this._parent.apply(this,l)},onTypeChange:function(){var e=r.getModelConstructor(this.toJSON())||u;if(!(this instanceof e)){r.removeObjectFromIndex(this.id);var t=new e(this.toJSON(),{parse:!0,collectionConstructor:this.collectionConstructor});this.dispatchEvent("onReplace",[this,t])}},isDSLC:function(e){if(this._isDslc)return this._isDslc;var t,n=e?e["@type"]:u.prototype.get.call(this,"@type",{noDSLCMapping:!0});if(n&&r&&r.typeDictionary&&r.typeDictionary.typeHierarchy){var i=r.typeDictionary.typeHierarchy["dslc:ItemVersioningPolicy"];t=i&&-1!==i.indexOf(n)}else if(!e){var o=this.get("dsxplan:jsType",{noDSLCMapping:!0})||u.prototype.get.call(this,"dsxplan:actualType",{noDSLCMapping:!0});if(!(t=Boolean(o))){var s=u.prototype.get.call(this,u.ACTUAL_TYPE_ATTR,{noDSLCMapping:!0})||n;if((s=s&&(s.id||s))&&!(t="dslc:ItemVersion"===s)&&r&&r.typeDictionary&&r.typeDictionary.typeHierarchy){var a=r.typeDictionary.typeHierarchy["dslc:ItemVersion"];t=a&&-1!==a.indexOf(s)}}}return this._isDslc=t,t},setup:function(t,n){if(n=n||{},this.isDSLC()&&this.inverseDslcMapping){var i=this;Object.keys(this.inverseDslcMapping).forEach(function(e){i.listenTo(i,"onChange:"+e,function(t,n,i){i&&i.silent||t.dispatchEvent("onChange:"+this.inverseDslcMapping[e],arguments)})})}!this.collection&&n.mask&&(this.mask=n.mask),this.isNew()&&this.set("_skeletonId","temp:"+this.cid),this.listenTo(this,"onChange",this._registerChangedAttributes),this.listenTo(this,"onChange:@href",this.onHRefChange),this.listenTo(this,"onChange:@id",this.onAtIdChange),this.listenTo(this,"onChange:rdf:type",this.onTypeChange),this.listenTo(this,"onChange:dsplan:actualType",this.onTypeChange),this.listenTo(this,"onChange:dsxplan:actualType",this.onTypeChange),this.listenTo(this,"onChange:dsxplan:jsType",this.onTypeChange);var o=r.getTypeCollection(this.constructor,{create:!0}),s=e.clone(n,!1);if(s.parse=!1,s.fireTypeCollectionEvent&&delete s.silent,o.get(this))throw new Error("object existing try to get existing from rdfutils first!");o&&o.add(this,s),this.id||r.addObjectToMap(this.cid,this)},url:function(e){var t,n;if(this.isNew()){var i=this.collection.getUri({forNewObject:!0});t=r.expandUrl(i),n="/resource"===i.substr(0,"/resource".length)}else t=r.expandUrl(this.get("@href"),"v1");var s=e&&e.mask;return s||(s=this.getMask(),this.isNew()&&(s=n?this.parentMask||this.collection.getMask():this.writeMask||s)),o.addQueryParam(t,"$mask",s)},_originalGet:function(){return n.prototype.get.apply(this,arguments)},get:function(e,t){var n=Array.prototype.slice.call(arguments,0),i=e;return t&&t.noDSLCMapping||!this.isDSLC()||!this.dslcMapping||(i=this.dslcMapping[i]||i),n[0]=i,"physicalId"===i?this.id&&r.jsonURIToSparqlURI(this.id):this._models[i]||this._collections[i]||this._parent.apply(this,n)},compactJson:function(){if(this.isNew())return this.toJSON({noSkeletonId:!0,noEmptyCollection:!0});var e={};return e[this.idAttribute]=this.id,e},parse:function(n,i){var o;if(!e.is(n,"object"))return{value:n};var a=e.clone(n||{},!1);n&&n["@href"]&&0===n["@href"].indexOf("/invoke/")&&(a=n["@value"]||n.value),o=r.parseUrl(a["@href"]),r.handleContext(a),delete a["@context"],delete a["@code"],this.addMask(a["@mask"]),o.path&&(a["@href"]=o.path),(!this.mask||r.compareMasks(this.getMask(),a["@mask"])<0)&&(this.mask=a["@mask"]);var l=a["@mask"];l&&s.addMask(l),delete a["@mask"];var c=a["@id"];return c&&(c.test(/[/?]/)?a._skeletonId=t.getCheckSum("_"+c):a._skeletonId=c),a.image&&(a.image=r.getAssetUrl(a.image)),a["@id"]&&a["@id"]!==this.id&&this.set("@id",a["@id"],{dontRegisterChange:!0}),this._parseNestedModelsAndCollections(a,l,i),this._parsePruneModelsAndCollections(a,l,i),a},_parseNestedModelsAndCollections:function(t,n){var i=t,r=n;Object.keys(i).forEach(function(n){var o,a;if(o=!e.is(i[n],"string")||"dsxplan:hasPriority"!==n&&"dsxplan:hasMaturity"!==n?i[n]:{"@id":i[n]},h(o,"object")&&o["@id"]||"dsxplan:hasPriority"===n||"dsxplan:hasMaturity"===n)if("Collection"===o["@type"]){var l,c=!0;if(o.member&&o.member.length&&(l=o.member,c=!e.Array.detect(l,function(t){return!e.is(t,"string")})),c&&l){var d=e.clone(l,!1);this.set(n,d,{dontRegisterChange:!0}),i[n]=d,s.addAttributeToMask(r,n,s.ARRAY_ATTR)}else this.addNewCollectionData(n,o,{parse:!0,fromServer:!0}),o.member&&s.addAttributeToMask(r,n,s.COLLECTION_ATTR)}else{if((a=this._models[n])&&a.id===o["@id"]){var p=a.parse(o);a.set(p,{dontRegisterChange:!0,dontAdjustDates:!0})}else a=u.mergeOrCreateObject(o),this._models[n]=a;t[n]=a,r&&s.addAttributeToMask(r,n,s.MODEL_ATTR)}},this)},_parsePruneModelsAndCollections:function(t,n,i){var r=n,o=t;if(r)for(var a,l=s.getMask(r),c=Object.keys(l),d=c.length,u=function(e){return!e.isNew()},h=function(e){e.isNew()&&a.push(e)},p=0;p<d;p++){var g=c[p];if(!o[g])switch(l[g]){case s.COLLECTION_ATTR:var f=this.get(g,{noDSLCMapping:!0}),m=e.clone(i||{},!1);if(delete m.batchFetch,delete m.parse,m.dontRegisterChange=!0,f){a=f._added.filter(u),f.forEach(h);var v=f.length;if(f.reset&&f.reset(a||[],m),v!==f.length){this._fireRelationshipChangeEvents(g,m);try{var y=this._attributes&&this._attributes[g];y&&(y.totalItems=f.length,y.member=f.pluck("@id").map(function(e){return{"@id":e}}))}catch(e){console.log(e)}}}break;case s.MODEL_ATTR:var C=g;this.isDSLC()&&this.inverseDslcMapping&&(C=this.inverseDslcMapping[C]),this.parsePruneModel(g,o[C],i);break;case s.STRING_ATTR:case s.ARRAY_ATTR:default:void 0!==o[g]&&null!==o[g]||void 0!==this.get(g)&&this.unset(g,{dontRegisterChange:!0})}}},parsePruneModel:function(e,t,n){!this._models[e]||this._models[e]===t||n&&n.silent||this._fireRelationshipChangeEvents(e,n),delete this._models[e],delete this._attributes[e]},removeObject:function(t,i,r){var o=t;this.isDSLC()&&this.dslcMapping&&(o=this.dslcMapping[o]||o);var s=this._collections[o];if(s){if(e.is(i,"number"))s.at(i);else{if(!(i instanceof n))throw new Error("invalid object to remove "+i);i}s.remove(i,r),this._fireRelationshipChangeEvents(o,r,r&&r.silentOnChange),r&&r.silent&&(this._registerChangedCollection(o,i,s,r),s._registerRemovedModel(i,s,r))}else this._models[o]===i&&(this.unset(o,r),r&&r.silent&&this._registerChangedAttributes())},getMask:function(){return this.mask||this.collection&&this.collection.getDetailsMask()},dataForRendering:function(t){var n=e.clone(t||{},!1);return n.dataForRendering=!0,this.toJSON(n)},_setDateAttribute:function(t,n,i){if(n instanceof Date)this.set(t,n.toISOString(),i);else{if(!e.is(n,"string"))throw new Error(n+" is not a date object or a string. It was not saved for the model.");this.set(t,n,i)}i&&i.silent&&this._registerChangedAttributes()},isOfType:function(e){var t=r.typeDictionary.typeMap,n=this.get("dsxplan:jsType")||this.get("dsxplan:actualType")||this.get("dsplan:actualType");return n=n.id||n,!(!t||!n)&&t[e].key===n},_fireRelationshipChangeEvents:function(t,n,i,r){if(!(n&&n.silent||(r||(this.dispatchEvent("onChange:"+t,[this,n]),n&&"add"===n.operation?this.dispatchEvent("onAdd:"+t,[this,n]):n&&"remove"===n.operation&&this.dispatchEvent("onRemove:"+t,[this,n])),i))){var o=e.clone(n||{},!1);o.relationshipChanged=t,this.dispatchEvent("onChange",[this,o])}},addObjects:function(e,t,n,i){var r=t;this.isDSLC()&&this.dslcMapping&&(r=this.dslcMapping[t]||r);var o,s=[],a=e.length,l=this._collections[r];l||(l=this._createCollection(r,void 0,i));for(var c=0;c<a;c++){var d=this.getObjectToBeAdded(e[c],i);s.push(l.add(d,i)),i&&i.silent&&l._registerAddedModel(d,l,i)}if(s.length)try{this._changing||(o=this._changed,this._changed={}),this._fireRelationshipChangeEvents(r,i,i&&i.silentOnChange),i&&i.silent&&this._registerChangedCollection(r,l,i)}finally{this._changing||(this._changed=o)}return s},getObjectToBeAdded:function(t,n){var i;if(t instanceof u)i=t;else if(e.is(t,"string"))(i=r.getObjectById(t))||(i=new u(r.createPlaceholder(t))).fetch(n);else if(t["@id"]&&t["@type"]){var o=e.clone(t,!1),s=r.getModelConstructor(t);o.mask=n.mask||s.prototype.mask||"dsplan:MVMask.Task.Basic",i=r.getObjectForAdding(s,t["@id"],o)}return i},addModelToAttributeWithCollection:function(t,n,i){var r,o=this._collections[t],s=e.clone(i||{},!1);if(o)r=o.add(n,i);else{s.parse=!0;var a=this._jsonForCollectionForAttribute(t);n&&(a.member=[n]),o=this.addNewCollectionData(t,a,s),n&&o.dispatchEvent("onAdd",[o.at(0),o]),r=o.first()}return r},_jsonForCollectionForAttribute:function(e,t){return{"@href":this._computeCollectionId(e,t),"@id":this.get("@id")+"/"+e,"@type":"Collection","@mask":t&&t.mask||this.getMask()}},addNewCollectionData:function(t,n,i){var r=this._collections[t];if(r){var o=function(e,t){return e+"|"+t.id},s=r.reduce(o,""),a=r.state.totalRecords;r.update(n,i);var l=r.reduce(o,""),c=r.state.totalRecords;l===s&&c===a||this._fireRelationshipChangeEvents(t,i)}else{var d=e.clone(i||{},!1);d.parentModel=this,r=this._createCollection(t,n,d)}return r},_createCollection:function(t,n,i){var r=n;e.is(n,"array")&&((r=this._createCollection(t)).member=n);var o=this.getCollectionConstructor(t),s=e.clone(i||{},!1);s["@href"]=this._computeCollectionId(t,s);var a=new o(r,s);if(this.getPropertyInverse(t).name)for(var l=0;l<a.length;l++){var c=a.at(l);this._updateInverseProperty(t,c)}return this.setCollection(t,a),this.set(t,r,{dontRegisterChange:!0}),a},getCollectionConstructor:function(e){var t,n=this.collectionConstructor;if(this._relations&&(t=this._relations.detect(function(t){return t.key===e})),t){var i=t.relatedCollection;i&&(n=i)}return n},getChangedAttributesSinceLastSave:function(){return this._changedAttributesSinceLastSave?Object.keys(this._changedAttributesSinceLastSave):[]},_computeCollectionId:function(e){return this.get("@href")+"/"+e},onHRefChange:function(){var e=this;this._collections&&Object.keys(this._collections).forEach(function(t){var n=e._collections[t],i=e._computeCollectionId(t,{mask:n.getMask()});n.setUri(i)})},onAtIdChange:function(){this.id?r.addObjectToMap(this.id,this):r.addObjectToMap(this.cid,this);var e=this.previousAttributes()["@id"];e?r.removeObjectFromMap(e):this.id&&r.removeObjectFromMap(this.cid)},setModel:function(t,n,i){var r=c.setHelper.apply(this,arguments),o=e.clone(r.attrs||{},!1);i=r.options,this.isDSLC()&&o&&(o=this._mapDslcAttributes(o));for(var s=Object.keys(o),a=s.length,l=0;l<a;l++){var d=s[l],u=o[d];this._models[d]!==u?(this._previousAttributes||(this._previousAttributes=e.clone(this._attributes,!1)),this._previousAttributes[d]=this._models[d],this._models[d]=u):delete o[d]}return p.prototype.set.call(this,o,i)},set:function(){var t=c.setHelper.apply(this,arguments),n=e.clone(t.attrs||{},!1),i=t.options;this.isDSLC()&&n&&(n=this._mapDslcAttributes(n)),this._removeModelsForUndefinedValues(n);var r=this._setModelIfNeeded(n,i);return this._parent(n,i)&&r},_removeModelsForUndefinedValues:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var i=t[n];void 0===e[i]&&delete this._models[i]}},_setModelIfNeeded:function(e,t){for(var n=Object.keys(e),i=n.length,r={},o=!1,s=0;s<i;s++){var a=n[s],l=e[a];l instanceof u&&(r[a]=l,o=!0)}var c=!0;return o&&(c=this.setModel(r,t)),c},syncDelete:function(e){if(this.isVersion()&&this.isDSLC()||e.dslc){e.url=r.expandUrl(u.DELETE_ITEM_VERSION_URI),e.data=JSON.stringify([this.id,Boolean(e.isStructureDelete)]),e.method="POST";var t=e.onComplete;e.onComplete=function(e){var n=e.member;if(n)for(var i=0;i<n.length;i++){var o=n[i],s=r.getObjectById(o);s&&s.destroy({noServer:!0})}t.apply(this,arguments)}}this.handleDeleteFailure(e)},handleDeleteFailure:function(e){var t=e.onFailure,n=e.onComplete;this._collectionsRemovedFrom=[];var i=this;e.onFailure=function(){r.addObjectToMap(i.id,i),r.addObjectToMap(i.cid,i),i._collectionsRemovedFrom.forEach(function(e){e.add(i)}),delete i._collectionsRemovedFrom,t&&t.apply(i,arguments)},e.onComplete=function(){delete i._collectionsRemovedFrom,n&&n.apply(i,arguments)}},onRemovedFromCollection:function(e){this._collectionsRemovedFrom&&this._collectionsRemovedFrom.push(e)},fetch:function(t){var n=e.clone(t||{},!1);return n.dontUpdateMask&&(n.url=this.url(t)),n.mask&&n.onlyIfNeeded&&this.hasDataForMask(n.mask,{checkFetching:!0})?(n.onComplete&&n.onComplete(this),{cancel:function(){}}):this._parent(n)},isPropertyVolatile:function(e){return"@etag"===e||this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].volatility},getPropertyInverse:function(e){return{name:this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].inverseProperty,isCollection:this._propertyDictionary&&this._propertyDictionary[e]&&this._propertyDictionary[e].inversePropertyIsCollection}},getPropertyThisIsInverseOf:function(e){var t;if(this._propertyDictionary){var n=this;Object.keys(this._propertyDictionary).some(function(i){return n._propertyDictionary[i].inverseProperty===e&&(t=i),void 0!==t})}return t},getParentPath:function(){return this.collection.getIdForCreateChildDSLC()},addMask:function(e){this._usedMasks=this._usedMasks||[],e&&-1===this._usedMasks.indexOf(e)&&this._usedMasks.push(e)},getMasks:function(){return this._usedMasks||(this._usedMasks=[]),this._usedMasks},hasDataForMask:function(e,t){var n=s.isSubMask(e,this.getMasks());if(!n&&t&&t.checkFetching&&this._masksBeingFetched){var i=Object.keys(this._masksBeingFetched);n=s.isSubMask(e,i)}return n},resetMasks:function(){this._usedMasks=[]},unset:function(e){var t,n=this._models[e],i=this._collections[e];n&&(t=this._previousAttributes[e],this._previousAttributes[e]=n,delete this._models[e]),i&&(t=this._previousAttributes[e],this._previousAttributes[e]=n,delete this._collections[e]);var r=this._parent.apply(this,arguments);return r||(this._models[e]=n,this._collections[e]=i,this._previousAttributes[e]=t),r},getTagPrefix:function(){return r.TAGGER_URI_PREFIX},getObjectType:f,getDragType:f,getTransferObject:function(t){var n=this.getDragType(),i=e.clone(t||{},!1);i&&delete i.parentObject;var r=e.merge(i,{source:window.widget.getValue("appId")||"X3DCSMA_AP",envId:window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),objectId:this.get("physicalId"),objectType:n,objectType_Internal:n,displayType:c.translateType(n),displayName:this.get("title"),serviceId:i.serviceId||"3dplan",image:this.get("image")});return c.getTransferObject(r)},getLaunchOptions:function(){var e={appId:"ENXPLAN_AP"};return e.ids=this.id,e.x3dPlatformId=window.enoviaServer.tenant||window.widget.getValue("x3dPlatformId"),e},isVersion:function(){return!1},hasChanged:function(e){var t=e;return this.isDSLC()&&this.dslcMapping&&(t=this.dslcMapping[e]||t),this._parent(t)},hasFetchedAttribute:function(e){var t=this.isDSLC()&&(this.dslcMapping[e]||e);return this.getMasks().detect(function(e){return s.getMask(e)[t]})},processLiveUpdateCreation:function(e){var t=r.getObjectById(e["@parentId"]),n=t.getCollectionAttributeBasedOnModel(this);if(t.hasFetchedAttribute(n)){t.getCollectionAttribute(n).add(this,{dontRegisterChange:!0});var i=this.liveUpdateCreateMask||"dsplan:MVMask.ScheduleElements.Basic";this.fetch({mask:i})}},getRelatedModelCompactJson:function(e){return e.compactJson()},isDeleted:function(){return!this.get("dsxplan:jsType")||0===this.get("dsxplan:jsType").indexOf("dsplan:Deleted")},getTaggerURI:function(){var e=this.get("physicalId")||this.id;return this.isRDF&&(e=this.getTagPrefix()+r.conditionalShortToLongURI(e)),e}},(u=p.extend(u)).implement(a),a.initFetchTrackingMixinForClass(u),u.shouldCreateOnLiveUpdate=function(e){var t=r.getObjectById(e["@parentId"]);return Boolean(t)},u.RDF_TYPE="rdf:type",u.ACTUAL_TYPE_ATTR="dsplan:actualType",u.getObjectById=r.getObjectById,u.mergeOrCreateObject=function(e){var t=r.getModelConstructor(e);t=t||u;var n=r.getExistingAndMerge(e);return n=n||new t(e,{parse:!0,collectionConstructor:this.collectionConstructor})},Object.defineProperty(u.prototype,"tenant",{get:function(){return window.enoviaServer.tenant}}),Object.defineProperty(u,"fakeEmptyCollection",{get:function(){var e=[];return e.get=function(){},e.first=e.get,e.toArray=function(){return this},e}}),u.resetObjectMap=r.resetObjectMap,Object.defineProperty(u.prototype,"fedSearchIdQuery",{get:function(){if(this.id)return'uri:"'+r.shortToLongURI(this.id)+'" OR resourceid:"'+r.removeBracketLongURI(this.id)+'"'}}),Object.defineProperty(u.prototype,"parentId",{get:function(){return this._parentId},set:function(e){if(this._parentId){var t=r.getObjectById(this._parentId);this.stopListening(t,"onModifyAccessChanged"),this.stopListening(t,"onDeleteAccessChanged")}this._parentId=e,r.getObjectById(e)&&this.listenTo(r.getObjectById(e),{onModifyAccessChanged:this.dispatchEvent.bind(this,"onModifyAccessChanged"),onDeleteAccessChanged:this.dispatchEvent.bind(this,"onDeleteAccessChanged")})}}),u.MODIFY_ITEM_VERSION_URI="/invoke/dsxplan:modifyItemVersion",u.CREATE_ITEM_VERSION_URI="/invoke/dsxplan:createItemVersion",u.CLONE_ITEM_VERSION_URI="/invoke/dsxplan:cloneItemVersion",u.DELETE_ITEM_VERSION_URI="/invoke/dsxplan:deleteItemVersion",u}),define("DS/RDFFoundation/Models/ComponentProxyIndexModel",["UWA/Core","UWA/Class/Model","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/Models/ObjectProxyUtil","DS/RDFFoundation/Models/ResultModel"],function(e,t,n,i,r){"use strict";var o=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","ds6w:resourceUid","modified","ds6w:modified"];const s=new Map;var a={};o.forEach(function(e){a[e]=!0});var l=t.extend({_uwaClassName:"ComponentProxyIndexModel",idAttribute:"resourceid",defaults:{},init:function(e,t){var n=Array.prototype.slice.call(arguments,0);if(e&&(e.results||e.attributes)&&(!t||!t.parse)){var i="";if(e.results){var r=e.results;if(1!==r.length)return this._parent.apply(this,n);i=r[0]}this.collection=t&&t.collection;var o=this.parse(i);n[0]=o}this._parent.apply(this,n),s.set(this.id,this)},sync:function(t,n,i){if("read"!==t)throw new Error("component proxy index model don't support writing");var r=e.clone(i||{},!1);return r.source=this.get("source"),l.requestFetch(n,r)},parse:function(e,t){var n={};if(e&&e.attributes)for(var i=e.attributes,r=i.length,o=t&&t.selectPredicates||a,s=0;s<r;s++){var l=i[s],c=l.name;"ds6w_facet"===l.format&&(c=c.substr(c.lastIndexOf("/")+1)),o[c]&&(n[c]=l.value)}return n},destroy:function(){s.delete(this.id),this._parent.apply(this,arguments)}});l.prototype.dataForRendering=function(){return this.toJSON()},l.toBeFetched={};var c={cancel:function(){this.fetching?(delete this._onComplete,delete this._onFailure):delete this.queue.toBeFetched[this.id]},onComplete:function(){this._onComplete&&this._onComplete.apply(this,arguments)},onFailure:function(){this._onFailure&&this._onFailure.apply(this,arguments)}};return l.TIMEOUT_LENGTH=97,l.idAttributeForFederatedSearch=function(e){var t="physicalid";return"swym"===e?t="[ds6w:resourceUid]":"geovia"!==e&&"3dportfolio"!==e&&"usersgroup"!==e||(t="uri"),t},l.idAttributeForFederatedSearchResult="resourceid",l.select_predicate=o,l.fetchProxies=function(){delete this.fetchTimeout;var t={idAttributeForFederatedSearch:this.idAttributeForFederatedSearch,select_predicate:this.select_predicate,idAttributeForFederatedSearchResult:this.idAttributeForFederatedSearchResult||this.idAttributeForFederatedSearch},n=this.toBeFetched;this.toBeFetched={};var i=Object.keys(n),o=i.length;if(!o)return{cancel:function(){}};for(var s,a,c={},d={"3dspace":[]},u=0;u<o;u++){var h,p=i[u],g=n[p];g.fetching=!0;var f=g.idAttributeForFederatedSearch||t.idAttributeForFederatedSearch;h=e.is(t.idAttributeForFederatedSearch,"function")?t.idAttributeForFederatedSearch(g.source):f,"3dspace"===g.source?d["3dspace"].push(p):(this.optimizeSearchQuery?s='"'+p+'"':(s=h+':"'+p+'"',g.additionalQueryStatement&&(s="("+s+" AND "+g.additionalQueryStatement+")")),c[g.source]||(c[g.source]=[]),c[g.source].push(s))}var m=function(e,t){for(var i=Object.keys(n),o=i.length,s=0;s<o;s++){var l=i[s],c=n[l],d=c.source;"3dspace"===t||"3dspace"===d?"3dspace"===t&&"3dspace"===d&&c.onFailure&&c.onFailure(e):"drive"===d?r.sendRequest({drive:[l]},{onComplete:a,onFailure:function(e,t,i){var r=n[i[0]];r.onFailure.apply(r,arguments)}}):t===d&&c.onFailure&&c.onFailure(e)}};return a=function(e,i){for(var r,o=e.length,s=t.idAttributeForFederatedSearchResult.replace(/\[?([^\]]*)]?/,"$1"),a=0;a<o;a++)for(var l=e[a],c=l.attributes,d=c.length,u=0;u<d;u++){var h=c[u];if(h.name===s){(r=n[h.value])&&r.onComplete(l),delete n[h.value];break}}m("object_not_found",i)},r.sendRequest(d,{onComplete:a,onFailure:m}),l.sendFederatedSearchRequest.apply(this,[c,a,m]),{}},l.sendFederatedSearchRequest=function(t,n,r){var o=Object.keys(t);if(o.length>0)for(var s=function(t,i){var o=(e.is(i,"string")?JSON.parse(i):i).results;o?n(o,t):r("object_not_found",t)},a=0;a<o.length;a++){var c=o[a],d=t[o[a]],u={query:d,nresults:d.length+10,sources:[c],select_predicate:this.select_predicate,searchQueryPrefix:this.optimizeSearchQuery?l.idAttributeForFederatedSearch(c):void 0,delimeter:this.optimizeSearchQuery&&"swym"===c?" BOR ":void 0,onComplete:s.bind(void 0,c),onFailure:r.bind(this,"object_not_found",c)};i.sendRequestWithDelimiter(u)}},l.requestFetch=function(t,n){var i=e.clone(n||{},!1),r=i.queue||this,o=r.toBeFetched[t.id];return o||((o=Object.create(c)).id=t.id,o.source=i.source||"3dspace",o._onComplete=i.onComplete,o._onFailure=i.onFailure,o.queue=r,o.additionalQueryStatement=i.additionalQueryStatement,o.idAttributeForFederatedSearch=i.idAttributeForFederatedSearch,r.toBeFetched[t.id]=o,r.fetchTimeout||(r.fetchTimeout=setTimeout(l.fetchProxies.bind(r),l.TIMEOUT_LENGTH)),o)},l.resetQueue=function(e){(e=e||this).toBeFetched={},clearTimeout(e.fetchTimeout),delete e.fetchTimeout,delete e.optimizeSearchQuery},l.getObjectById=function(e){return s.get(e)},l}),define("DS/RDFFoundation/Models/MemberModel",["UWA/Core","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils","DS/E6WCommonUI/UIHelper","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Models/ComponentProxyIndexModel"],function(e,t,n,i,r,o,s){"use strict";var a=["ds6w:label","ds6w:type","type_icon_url","ds6w:docextension","preview_url","resourceid","ds6w:resourceUid"],l=require.toUrl("DS/XPlanApp/assets/img/defaultProfile.png"),c={};a.forEach(function(e){c[e]=!0});var d=t.extend({_uwaClassName:"MemberModel",parse:function(e){return e&&e.attributes?s.prototype.parse.call(this,e,{selectPredicates:c}):this._parent.apply(this,arguments)},setup:function(){return this.fetch(),this._parent.apply(this,arguments)},memberSync:function(t,n,i){var r=this;if("read"===t){var o=e.clone(i||{},!1);o.queue=d;var a=this.getIdForFederatedSearch(),l=i.onComplete;return o.onComplete=function(){var e=arguments[0];r._processTaggerDataAndStoreOnModel(n,arguments),r.completing=!1,l&&l.apply(this,arguments),r.dispatchEvent("onFetchDone",arguments),"foaf:Group"===r.getObjectType()&&(r.setLabel(e.attributes&&e.attributes.find(e=>"ds6w:label"===e.name).value),r.setViewAccess(Boolean(r.get("ds6w:label"))),r.dispatchEvent("onChange",[r]),r.dispatchEvent("onAccessSetOfGroup",[r]))},o.onFailure=function(){var t=i.onFailure,n=e.clone(o||{},!1);n.onFailure=function(){r.completing=!1,t&&t.apply(this,arguments),r.dispatchEvent("onFetchDone"),"foaf:Group"===r.getObjectType()&&(r.setViewAccess(Boolean(r.get("ds6w:label"))),r.dispatchEvent("onChange",[r]),r.dispatchEvent("onAccessSetOfGroup",[r]))},"foaf:Group"!==r.getObjectType()?r.getPersonFromRDF(n):r.fetchUserGroupName(n)},o.source=this.source,o.additionalQueryStatement=a?void 0:this.additionalQueryStatement,o.idAttributeForFederatedSearch=this.idAttributeForFederatedSearch,d.optimizeSearchQuery=!0,d.toBeFetched[a]||(this.completing=!0),s.requestFetch({id:a},o)}},_processTaggerDataAndStoreOnModel:function(e,t){var n=t&&t[0].attributes;if(n){var i=e.collection.getModelAndProcessedTaggerDataAttributes(n);e.tagsData=i.tags,e.set("explicitTagsData",i.explicitTagsData)}},get:function(e){var t=this.id&&n.splitUri(this.id)[1];switch(e){case"name":return this.getFullName();case"image":return this.get("preview_url")||this.get("type_icon_url")||r.userPictureURL(t,"normal")||l;case"miniImage":return"foaf:Group"===this.get("ds6w:type")&&this.get("ds6w:label")?this.get("preview_url"):this.get("ds6w:label")||"foaf:Group"!==this.get("dsxplan:jsType")?r.userPictureURL(t,"mini")||l:require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png");case"physicalId":return this._getPhysicalId();case"resourceUid":return this._getResourceUid();case"type":return this.get("ds6w:type");case"accountName":return this.get("dsaccess:accountName")}return this._parent.apply(this,arguments)},getFullName:function(){var e=this.get("resourceid");if(e&&e.startsWith("mailto:"))return n.splitUri(e)[1];var t=this.get("dsaccess:state");if(!e&&t&&"pending"===t)return this.get("dsaccess:mbox");var i=this.get("ds6w:label");if(!i){var r=this.getFirstName(),o=this.getLastName();i=r&&o&&r+" "+o}return i},getFirstName:function(){var e=this.get("foaf:givenName");return e&&e[0]},getLastName:function(){var e=this.get("foaf:familyName");return e&&e[0]},_getPhysicalId:function(){return n.jsonURIToSparqlURI(this.id)},_getResourceUid:function(){return n.jsonURIToSparqlURI(this.id)},toJSON:function(e){var t=e||{},n=this._parent.apply(this,arguments);return n.isRDF=!0,n.physicalId=this.get("physicalId"),n.resourceUid=this.get("resourceUid"),n.name=this.get("name"),n.image=this.get("image"),"dskern:Person.Guest"===this.id||"foaf:xPlanInfra"===this.id||"dskern:Person.Creator"===this.id?(n.firstname=this.id.split(":")[1],n.fullName=n.firstname):n.fullName=this.get("name")||n.name||n["ds6w:label"],n.title=n.fullName,t.dataForRendering&&(n.type="pno:Person"),n},getPersonFromRDF:function(e){var t=["resources/",n.removeBracketLongURI(this.id),"?$mask=dsplan:MVMask.Person.Complex"].join(""),i=n.expandUrl(t,"v1");n.request(i,{method:"GET",type:"json",onComplete:e.onComplete,onFailure:e.onFailure})},getDragType:function(){return this.getObjectType()},getTransferObject:function(){return this._parent({objectId:this.get("physicalId"),resourceUid:this.get("resourceUid"),displayName:this.fullName,serviceId:this.serviceHosting})}});return Object.defineProperty(d.prototype,"fullName",{get:function(){return this.get("name")}}),Object.defineProperty(d.prototype,"serviceHosting",{get:function(){return this.serviceId}}),Object.defineProperty(d.prototype,"physicalId",{get:function(){return this.get("physicalId")}}),Object.defineProperty(d.prototype,"fedSearchIdQuery",{get:function(){return this.idAttributeForFederatedSearch+':"'+this.getIdForFederatedSearch()+'"'}}),d.toBeFetched={},d.idAttributeForFederatedSearch=i.idAttributeForFederatedSearch,d.select_predicate=a,d}),define("DS/RDFFoundation/Models/PersonRDFModel",["UWA/Core","UWA/Class/Events","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/Models/MemberModel","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/MemberUtils"],function(e,t,n,i,r,o){"use strict";var s=i.extend({_uwaClassName:"PersonRDFModel",additionalQueryStatement:'[ds6w:type]:"pno:Person"',source:"swym",sourceName:"swym",serviceId:"3DSwym",idAttributeForFederatedSearch:"[ds6w:resourceUid]",getIdForFederatedSearch:function(){return o.removeUUIDFromURI(this.id)},getObjectType:function(){return"pno:Person"},sync:function(){return this.memberSync.apply(this,arguments)},_getPhysicalId:function(){var e=this.get("resourceid");if(e&&e.startsWith("mailto:"))return e;var t=this.get("dsaccess:state");return!e&&t&&"pending"===t?this.get("dsaccess:mbox"):o.addIamToURI(this.get("accountName"))},_getResourceUid:function(){return o.removeUUIDFromURI(this.id)}});return s.Events={CurrentUserModelCreated:"CurrentUserModelCreated"},s.Dispatcher=new t,s.loadAndCreateModelForCurrentUser=function(){function e(e){var t=r.getObjectForAdding(s,e,{attrs:{"dsaccess:accountName":n.getContextUser()}});t.addEvent("onSync",function(){s.Dispatcher.dispatchEvent(s.Events.CurrentUserModelCreated,t)})}o.setContextUserUid({onComplete:e,onFailure:e})},s}),define("DS/RDFFoundation/Models/UsersGroupRDFModel",["UWA/Core","DS/RDFFoundation/Models/MemberModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r){"use strict";return t.extend({_uwaClassName:"UsersGroupRDFModel",additionalQueryStatement:'[ds6w:type]:"foaf:Group"',source:"usersgroup",serviceId:"usersgroup",idAttributeForFederatedSearch:"uri",getIdForFederatedSearch:function(){return n.jsonURIToSparqlURI(this.id)},setup:function(){return this.setViewAccess(Boolean(this.get("ds6w:label"))),this._parent.apply(this,arguments)},setViewAccess:function(e){this._hasViewAccess=e},getObjectType:function(){return"foaf:Group"},setLabel:function(e){e&&this.set("ds6w:label",e)},hasViewAccess:function(){return this._hasViewAccess},sync:function(){return this.memberSync.apply(this,arguments)},get:function(e){switch(e){case"name":if(!this.hasViewAccess())return r.get("E6WCommonUI.Label.PrivateGroup");break;case"image":if(!this.hasViewAccess())return require.toUrl("DS/E6WCommonApps/assets/img/defaultGroupPrivate.png")}return this._parent.apply(this,arguments)},fetchUserGroupName:function(e){let t=i.getServiceUrl("usersgroup",!0)+"/3drdfindex/v1/resources/"+n.removeBracketLongURI(this.id)+"?$mask=dsaccess:Mask.Group.Name";n.request(t,{method:"GET",type:"json",onComplete:e.onComplete,onFailure:e.onFailure})},canShowProperties:function(){return!1},compactJson:function(){var e={};return e[this.idAttribute]=this.id,e.type="group",e}})}),define("DS/RDFFoundation/Collections/CollectionTaggerHelper",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/MemberUtils","DS/TagNavigatorProxy/TagNavigatorProxy","DS/E6WCommonUI/TopBarSearchDispatcher","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r,o,s){"use strict";var a={_proxyCount:0,federatedTaggerServiceRequest:function(e){if(0!==this.length){for(var t,n=e.searchSource||[],i=[],r=0;r<this.length;r++){var o=this.at(r),s=o.get("source");s&&!n.includes(s)&&n.push(s),(t=o.fedSearchIdQuery)&&i.push(t)}this._sendFederatedTaggerRequest(i,n,e)}},_sendFederatedTaggerRequest:function(e,t,i){var r=this;e.length>0&&n.sendRequestWithDelimiter({sources:t,with_synthesis_attribute:!0,locale:window.widget.lang||"en",query:e,onComplete:function(e){var t=e?e.results:[];t?(r.convertTagDataToTnProxyFormat(t),i.onComplete&&i.onComplete()):i.onFailure&&i.onFailure()},onFailure:function(){i.onFailure&&i.onFailure()},queueRequest:!0})},convertTagDataToTnProxyFormat:function(e){if(e&&e.length>0)for(var t=e.length,n=0;n<t;n++){var i=this.getModelAndProcessedTaggerDataAttributes(e[n].attributes),r=i.id,o=i.tags,s=this.getModelsAsArrayToHandleTagger(r);s&&0!==s.length&&s.forEach(function(e){e.tagsData=o,e.set("explicitTagsData",i.explicitTagsData)})}},getModelsAsArrayToHandleTagger:function(e){var t=this.get(e);return t?[t]:this.getModelsAsArrayToHandleTaggerFallback&&this.getModelsAsArrayToHandleTaggerFallback(e)},getModelsAsArrayToHandleTaggerFallback:function(e){for(var t=[],n=0;n<this.length;n++){var i=this.at(n),r=i.get("physicalId");e.includes&&e.includes(r)&&t.push(i)}return t},getModelAndProcessedTaggerDataAttributes:function(e){for(var n,i=[],r={},o={},l=e.length,c=0;c<l;c++){var d=e[c],u=d.value;if(u)if(r=a.getExplicitTagsDataHelper(d,r),"ds6w_facet"===d.format){"date"===d.type&&(u=this.getFormatedTagDate(u)),["ds6w:what/ds6w:status","ds6w:what/ds6w:type"].indexOf(d.name)>-1&&(o[d.name]=d.value,this.translate&&(u=this.translate(u)));let e={object:u,sixw:d.name,field:d.field,type:d.type},t="E6WCommonUI.Tag."+u,n=s.get(t);n!==t&&(e.dispValue=n),i.push(e)}else"resourceid"===d.name?n=t.removeBracketLongURI(u):["preview_url","ds6w:label","dsplan:projectType"].indexOf(d.name)>-1&&(o[d.name]=d.value)}return{id:n,tags:i,explicitTagsData:r,attributesForModelCreation:o}},fetchModelAndAddTaggerData:function(n,i){var r=e.clone(i||{},!1),o=n.results,s=[];if(o&&o.length>0){var a=o.length;r.dontUpdateTaggerSummaryData||(this.tagsSummaryData=this.translateSummaryData?this.translateSummaryData(n.facets):n.facets);for(var l=[],c=0;c<a;c++){var d,u=this.getModelAndProcessedTaggerDataAttributes(o[c].attributes),h=u.id,p=u.tags,g=u.attributesForModelCreation,f=t.getObjectById(h),m=g["dsplan:projectType"],v=g["ds6w:what/ds6w:type"],y=f&&f.get("dsxplan:jsType")!==v,C=f&&!f.get("title"),_=y||C;if(!f||_){switch(g["ds6w:what/ds6w:status"]){case"To Do":d="Open";break;case"In Work":d="InProgress";break;case"Completed":d="Done";break;default:d=g["ds6w:what/ds6w:status"]}var F={"dsxplan:jsType":this.getJSType(v),"dsxplan:label":g["ds6w:label"],"dsplan:hasThumbnail":g.preview_url,"dsxplan:hasMaturity":{"@id":"dsxplan:"+d}};m&&(F["dsplan:projectType"]=m),_?f.set(f.parse(F),{dontRegisterChange:!0}):(F["@id"]=h,f=new r.ModelConstructor(F,{parse:!0}))}s.push(h),l.push(f),f.tagsData=p}r.reset?this.reset(l):this.add(l)}},getJSType:function(e){return"dsplan:xProject"===e&&(e="dsplan:Project"),e},getFormatedTagDate:function(e){var t=new Date(e),n=t.getFullYear(),i=t.getMonth()+1,r=t.getDate(),o=i<10?"0"+i:i,s=r<10?"0"+r:r;return String(n)+"/"+o+"/"+s},refineParametersAndQuery:function(t){var n=this,i=e.clone(t||{},!1);if(i.refineParam){const t=e.clone(i.refineParam,!0);Object.keys(t).forEach(function(e){if("date"===t[e][0].type){var r=t[e][0].object,o=n.getFromAndToDateFromDateTagFilter(r),s=e.split("/"),a=s[s.length-1];i.query="("+i.query+")",o.from&&(o.from.setHours(0),i.query="["+a+']>="'+o.from.toISOString()+'" AND '+i.query),o.to&&(i.query="["+a+']<="'+o.to.toISOString()+'" AND '+i.query),delete t[e]}}),i.refineParam=t}return i},getFromAndToDateFromDateTagFilter:function(e){var t,n;return e.to||e.from?(e.from&&(t=new Date(e.from)),e.to&&(n=new Date(e.to)).setHours(24)):(n=this.parseEndDate(e),7===e.length&&(e+="/01"),t=new Date(e)),{from:t,to:n}},parseEndDate:function(e){var t;if(e.length>7)return(t=new Date(e)).setHours(24),t;7===e.length&&(e+="/01");var n=new Date(e);return 4===e.length?((t=new Date(n.getUTCFullYear()+1,0,0)).setHours(24),t):((t=new Date(n.getUTCFullYear(),n.getMonth()+1,0)).setHours(24),t)},federatedSearchAdvanceQueryRequest:function(t){var i=this,r=e.clone(t||{},!1);r=i.refineParametersAndQuery(r),n.sendRequest({label:"3dplan-"+r.labelPrefix+window.enoviaServer.user+"-"+Date.now(),select_predicate:r.selectPredicateArray,sources:["3dplan"],with_synthesis:!0,with_synthesis_attribute:!0,query:r.query,nresults:r.limit,refine:r.refineParam,order_field:"ds6w:modified",order_by:"desc",iDoNotThrowError:!0,onComplete:function(e){r.onComplete&&r.onComplete(e),i.dispatchEvent("onSync")},onFailure:function(){r.onFailure&&r.onFailure()}})},getTaggerData:function(e){var t={};return(e&&e.isTopBarSearch||o.getSearchString()?this:this.originalCollection||this).forEach(function(e){if(e.id){var n=e.getTaggerURI();t[n]=e.tagsData||[]}}),t},getFilterOnServerTaggerData:function(e){var n={tagsData:{},summaryData:[]};if(e){var i=this.get(t.removeBracketLongURI(e));i?n.tagsData[t.TAGGER_URI_PREFIX+encodeURIComponent(t.shortToLongURI(i.id))]=i.tagsData||[]:n.tagsData={}}else this.forEach(function(e){n.tagsData[t.TAGGER_URI_PREFIX+encodeURIComponent(t.shortToLongURI(e.id))]=e.tagsData||[]});return n.summaryData=this.tagsSummaryData||[],n},getTNProxy:function(t){var n=e.clone(t||{},!1),i=this.tnProxy;if(i)return i;var o={widgetId:window.enoviaServer.widgetId,filteringMode:n.filterOnServer?r.filteringMode.FilteringOnServer:r.filteringMode.WithFilteringServices,tenant:window.enoviaServer.tenant,events:n.events,colorize:!0};return(i=r.createProxy(o))&&i.configurePredicates({"ds6w:modified":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:created":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:plannedStart":{allowFreeInput:!0,freeInputOnly:!0},"ds6w:plannedEnd":{allowFreeInput:!0,freeInputOnly:!0}}),this.tnProxy=i,i},setTNProxy:function(e){this.tnProxy=e},cacheCollection:function(){this.originalCollection=this.clone()},filterCollection:function(t,n){var i=e.clone(n||{},!1),r=t.searchInput||o.getSearchString();if(r||this._isTaggerFilteringOn(t)){this.originalCollection||i.noCache||this.allFetchesUseComplete()&&this.cacheCollection();var s=this._getModelIdsToKeep(t,r),a=this._getModelsBasedOnIds(s);return this._resetCollection(a),!0}return this.originalCollection&&(this._resetCollection(this.originalCollection._models),delete this.originalCollection),!1},_getModelIdsToKeep:function(e,t){var n=e.filteredSubjectList||[];return t&&!this._isTaggerFilteringOn(e)&&(n=[],this.originalCollection.toArray().forEach(e=>{n.push(e.id)}),this._resetCollection(this.originalCollection._models)),n},_getModelsBasedOnIds:function(e){let n=o.getSearchString();n&&(n=i.escapeRegExp(n));var r=new RegExp(n,"i"),s=[];return e.forEach(e=>{var i=(this.originalCollection||this).getModelsAsArrayToHandleTagger(t.getURIForFiltering(e));i&&i.length>0&&(n?r.test(i[0].get("title"))&&(s=s.concat(i)):s=s.concat(i))}),s},_isTaggerFilteringOn:function(e){var t=this.getTNProxy().getCurrentFilter();return e.allfilters&&Object.keys(e.allfilters).length||t.allfilters&&Object.keys(t.allfilters).length},_resetCollection:function(e){this.reset(e,{dontCallTagger:!0,dontRegisterChange:!0})},handleFocusOnSubjects:function(e,n){if(e)if(n){var i={},r=n.get("physicalId")||n.id;if(!r)return;var o=n.serviceId||"3DSpace";if(n.isRDF&&"3dspace"!==n.get("source")){r=t.jsonURIToSparqlURI(r);var s=n.get("dsxplan:jsType");(s&&"swym:WeDo"===s||"swym"!==n.get("source"))&&(r=encodeURIComponent(r)),o="6WTags"}n.getTagPrefix&&(r=n.getTagPrefix()+r),i[r]=o;try{e.focusOnSubjects([r],!0,i)}catch(e){console.log(e.message),console.log(e)}}else try{e.unfocus()}catch(e){console.log(e.message),console.log(e)}},handleTagColoring:function(e,n){var i=n&&n.coloredSubjects;if(e.coloredObjects||(e.coloredObjects=[]),Object.values(e.coloredObjects).forEach(function(e){delete e.tagColor,e.dispatchEvent("onChangeTaggerColoring")}),e.coloredObjects=[],i)for(var r in i){var o=r.startsWith("pid://")?r.substring("pid://".length):r,s=e.getModelsAsArrayToHandleTagger(t.getURIForFiltering(o));s&&s.length>0&&s.forEach(t=>{e.coloredObjects.push(t),t.tagColor=i[r],t.dispatchEvent("onChangeTaggerColoring")})}},addTaggerProxyColoringEvents:function(e,t){var n=function(e){a.handleTagColoring(t,e)};e.addEvent("colorize",n),e.addEvent("unColorize",n)},getExplicitTagsData:function(e){var t={};return e.forEach(e=>{t=a.getExplicitTagsDataHelper(e,t)}),t},getExplicitTagsDataHelper:function(e,t){if(void 0!==e.field&&"implicit"!==e.field){var n=e.dispValue||e.object||e.value,i=(e.sixw||e.name).substring("ds6w:".length);t[i]||(t[i]=[]),t[i].push(n)}return t},setExplicitTagsData:function(t,n){var i=n.sixw.substring("ds6w:".length),r=e.clone(t.get("explicitTagsData")||{},"false");r[i]||(r[i]=[]),r[i].push(n.object),t.set("explicitTagsData",r)},removeExplicitTagsData:function(t,n){var i=n.sixw.substring("ds6w:".length),r=e.clone(t.get("explicitTagsData")||{},"false"),o=r[i].indexOf(n.object);r[i].splice(o,1),t.set("explicitTagsData",r)},updateTagsData:function(e,t,n){var i=!0;e.tagsData||(e.tagsData=[]);for(var r=0;r<e.tagsData.length;r++){var o=e.tagsData[r];if(o.sixw===t){o.object=n,i=!1;break}}i&&e.tagsData.push({field:"implicit",object:n,sixw:t,type:"string"})},getTaggerDataWithSearchFilter:function(e){var t={},n=o.getSearchString()||e.getSearch(),i=new RegExp(n,"i");return(e=n?e:e.originalCollection||e).forEach(function(e){if(e.id){var r=e.getTaggerURI();n?i.test(e.get("title"))&&(t[r]=e.tagsData||[]):t[r]=e.tagsData||[]}}),t}};return a.dispatcher=new e.Class.Events,a.TAGGER_REQUEST_DELAY=100,a.EXPLICIT_TAGS_DATA="explicitTagsData",a}),define("DS/RDFFoundation/Models/LogicalUserModel",["DS/RDFFoundation/Models/ResultModel","DS/E6WCommonUI/E6WCommonUIConstants"],function(e,t){"use strict";var n=e.extend({_uwaClassName:"LogicalUserModel",source:t.SERVICE_3DPLAN,serviceId:t.SERVICE_3DPLAN,getObjectType:function(){return t.LOGICAL_USER_TYPE},canShowProperties:function(){return!1},getDragType:function(){return t.LOGICAL_USER_TYPE},get:function(e){let n=this._parent.apply(this,arguments);switch(e){case"miniImage":case"image":return require.toUrl("DS/E6WCommonApps/assets/img/role-avatar.png");case"fullName":case"name":return this.get("title")||this.get(t.DSLC_TITLE_ATTR);case"responsibility":if(!n)return this.get("dsplan:logicalResponsibility");break;case"@type":return this.get("type")}return n},toJSON:function(){var e=this._parent.apply(this,arguments);return e.name=this.get("name"),e.fullName=e.name,e.image=this.get("image"),e},getTransferObject:function(){return this._parent({objectId:this.get("id"),displayName:this.get("title"),serviceId:t.SERVICE_3DPLAN})}});return Object.defineProperty(n.prototype,"title",{get:function(){return this.get("title")}}),Object.defineProperty(n.prototype,"fullName",{get:function(){return this.get("fullName")}}),n}),define("DS/RDFFoundation/Models/CategoryModel",["UWA/Core","UWA/Utils","UWA/Class/Model","DS/RDFFoundation/RDFUtils"],function(e,t,n,i){"use strict";var r={_uwaClassName:"CategoryModel",defaults:{title:"",subtitle:""},_image:function(){var e;return(e=this.get("thumbnail"))&&(e=i.getAssetUrl(e)),e},"onChange:thumbnail":function(){this.set("image",this._image())},parse:function(e){var t,n=(t=i.parseUrl(e["@href"])).path.match(/(?:\/resources\/|\/classes\/|\/invoke\/)(.*)/);if(e["@id"]=n&&n[1]||e["@id"],!e.mask){var r=e["@mask"]||t.mask;r&&(e.mask=r)}return e.where=t.where&&t.where,e}};return n.extend(r)}),define("DS/RDFFoundation/Collections/ResultCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","UWA/Class/Model","DS/PlatformAPI/PlatformAPI","DS/WebAppsFoundations/Collections/PageableCollection","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/RequestUtils","DS/RDFFoundation/Models/CategoryModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Collections/CollectionTaggerHelper","DS/RDFFoundation/Mixins/FetchTrackingMixin"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";var h={_uwaClassName:"ResultCollection",getId:function(){return this._modelKey.get("@id")},_syncSetQueue:Function.prototype,getTotalRecords:function(){var e=this.length;return this.state&&null!==this.state.totalRecords&&void 0!==this.state.totalRecords&&(e=this.state.totalRecords+this._added.length-this._removed.length,e+=this._unregisteredModelsAdded.length-this._unregisteredModelsRemoved.length),e},hasMoreItems:function(){return this.moreItems||this.length!==this.getTotalRecords()},getModels:function(){return this._models},defaultOptions:{mode:"data",state:{pageSize:20},queryParams:{pageSize:"$top",sortKey:"$orderby",directions:{1:"desc","-1":"asc"}}},dataForRendering:function(e){for(var t=[],n=this.length,i=0;i<n;i++){var r=this.at(i);r&&t.push(r.dataForRendering(e))}return t},name:"rdf-result-collection",sync:function(){return c.prototype.sync.apply(this,arguments)},reset:function(e,t){return t&&t.forceReplaceOnSave&&(this._replaceOnSave=!0),this._parent.apply(this,arguments)},init:function(){this.initFetchTrackingMixinForInstance(),this._parent.apply(this,arguments)},setup:function(t,n){var i;if(n=n||{},this._defaultModel=n.defaultModel,i=n._modelKey,e.is(i))this._modelKey=i;else{var r=t&&t["@mask"]||n["@mask"];this._modelKey=new l({"@href":t&&t["@href"]||n["@href"],"@id":t&&t["@id"]||n["@id"],"@mask":r,mask:r,detailsMask:n.detailsMask},{parse:!0})}this.resetFlags(),this.initialized=Boolean(t&&t.member),this.listenTo(this,{onAdd:this._registerAddedModel,onRemove:this._registerRemovedModel,onReset:this._registerResetModels}),this.listenTo(this,{onReplace:this._replaceModel}),this._unregisteredModelsRemoved=[],this._unregisteredModelsAdded=[]},_replaceModel:function(e,t){var n=this.indexOf(e);-1!==n&&(this.remove(e),this.add(t,{at:n}))},removeAddedModel:function(e){var t,n=this._added.indexOf(e);return-1!==n&&(this._added.splice(n,1),t=e),t},_registerAddedModel:function(e,t,n){if(n&&(n.parse||n.fromServer||n.dontRegisterChange))n&&n.dontRegisterChange&&this.addUnregisteredModel(e);else{var i=this._removed.indexOf(e);if(-1!==i)this._removed.splice(i,1);else-1===this._added.indexOf(e)&&this._added.push(e)}},_registerRemovedModel:function(e,t,n){n&&(n.parse||n.fromServer||n.dontRegisterChange)?n&&n.dontRegisterChange&&this.removeUnregisteredModel(e):this.removeAddedModel(e)||-1===this._removed.indexOf(e)&&this._removed.push(e)},_registerResetModels:function(e,t){if(!t||!(t.parse||t.fromServer||t.dontRegisterChange)){var n=t.previousModels,i=this;n.forEach(function(e){i._registerRemovedModel(e,i,t)}),this.forEach(function(e){i._registerAddedModel(e,i,t)})}},destroy:function(){this.stopListening(),this._parent.apply(this,arguments),this.removeEvents()},set:function(t,n){var i=t;if(n&&(n.parse||n.fromServer)){var r,o=this.filter(function(e){return e.isNew()});n.parse?(s.handleContext(i),r=i.member):e.is(i.member,"array")?r=i.member:e.is(i,"array")?r=i:i=r=[i],r&&r.push.apply(r,o)}return this._parent(i,n)},fetch:function(t){var i,r,o,s,l={cancel:function(){}};if(t&&t.dontFetch)return l;var c=(o=e.clone(t,!1)||{}).idsToOpen,d=!c||o.collectionAndIds,u=d&&c&&c.length>0,h=o.onComplete;return o.onComplete=function(){!u&&h&&h.apply(this,arguments),u=!1},c&&c.length&&(this.fetchModelsById(c,o),o.newTransaction=!0),d?(o.mask&&this.setMask(o.mask),i=this._checkState(this.state),r=this.queryParams,(s=this.getLink(o.to))||(s=this.url(),"first"===o.to&&i.pageSize&&(s=a.addQueryParam(s,r.pageSize,i.pageSize)),i.sortKey&&(s=a.addQueryParam(s,r.sortKey,i.sortKey+" "+r.directions[i.order],!0))),o.url=s,-1!==o.url.indexOf("/invoke/")&&(o.method="POST"),o.remove||(o.remove=!1),n.prototype.fetch.call(this,o)):l},fetchModelsById:function(t,n){var i=this,r=e.clone(n||{},!1);r.mask=r.mask||this.getDetailsMask();var o=t.filter(function(e){return!i.get(e)}).map(function(e){return c.getObjectById(e)||s.createPlaceholder(e,void 0,void 0,{forceDslc:!0})}),a=n&&n.onFailure;this.add(o);r.onFailure=function(t){if(t instanceof e.Class.Model)i.remove(t);else{var n=[];o.forEach(function(t){t instanceof e.Class.Model?n.push(t):n.push(s.getObjectById(t["@id"]))}),i.remove(n)}e.is(a,"function")&&a.apply(void 0,arguments)},s.complete(this.model,t,r)},getPage:function(t,n){var i=e.clone(n||{},!1);return i.to=t,this.fetch(i)},sortBy:function(t,n){if(e.is(t,"function"))return this._parent.apply(this,arguments);if(e.is(n,"string")?"asc"===(n=n.toLowerCase())?n=-1:"desc"===n&&(n=1):n=n||-1,1!==n&&-1!==n)throw new Error("direction should be 1, -1, asc or desc");return this.state.sortKey=t,this.state.order=n,this.links={},this.reset(),this.toArray()},url:function(){var e=s.expandUrl(this.getUri());return a.addQueryParams(e,[{name:"$mask",value:this.getMask()},{name:"$where",value:this.getWhere(),encode:!0}])},getLink:function(e){var t=this.links[e];return t&&(t=s.expandUrl(t,"v1"),this.state.sortKey&&(t=a.addQueryParam(t,this.queryParams.sortKey,this.state.sortKey+" "+this.queryParams.directions[this.state.order],!0))),t},getWhere:function(){return this._modelKey.get("where")},getMask:function(){return this._modelKey.get("mask")},setMask:function(e){return this._modelKey.set("mask",e)},getDetailsMask:function(){return this._modelKey.get("detailsMask")||this.getMask()},setDetailsMask:function(e){return this._modelKey.set("detailsMask",e)},getUri:function(){return this._modelKey.get("@href")},setUri:function(e){this._modelKey.set(l.prototype.parse({"@href":e}))},parseRecords:function(e){e["@href"]&&this.setUri(e["@href"]);var t=e.member||e.value&&[e.value]||e["@value"]&&[e["@value"]];if(t)return t&&t.filter(function(e){return e["dsxplan:jsType"]||e instanceof i})},update:function(t,n){var i=e.clone(n||{},!1);if(t.member||this.setUri(t["@id"]),t.member){for(var r={},o=t.member,s=o.length,a=0;a<s;a++){var l=o[a];r[l["@id"]]=l}var c=this.filter(function(e){return!e.isNew()&&!r[e.id]&&!e.keepWhenUpdating});this.remove(c,i),i.merge=!0,i.parse=!0,this.add(t,i)}else this.parse(t,{})},parseResponseForStateUpdate:function(n,i,r){var o=e.clone(r||{},!1),s=n.view;if(s){var a=this.links;a.first=s.first,a.prev=s.previous,a.next=s.next,a.last=s.last,a.current=s["@href"];var l=parseInt(t.parseQuery(t.parseUrl(s["@href"]).query).$skip);o.currentPage=l/r.pageSize+1}return e.is(n.totalItems)?(o.totalRecords=n.totalItems,delete this.moreItems):this.moreItems=n.moreItems,this._unregisteredModelsRemoved=[],this._unregisteredModelsAdded=[],o},compactJson:function(){return this.reduce(function(e,t){return t._deleted||e.push(t.compactJson()),e},[])},resetFlags:function(){this._added=[],this._removed=[]},model:function(e,t){var n=s.getModelConstructor(e,t)||t&&t._defaultModel||t&&t.collection&&t.collection._defaultModel||c,i=s.getExistingAndMerge(e,t);return i?(i.collection=i.collection||t&&t.collection,i):new n(e,t)},add:function(t,n){var i=e.clone(n||{},!1);if(i.fireTypeCollectionEvent=!i.silent,i.silent=!0,n&&n.merge)return this._parent(t,n);var r=[],o=this,s=function(e){var t;e instanceof c?t=e:t=e[o.model===h.prototype.model?c.prototype.idAttribute:o.model.prototype.idAttribute];t&&!o.get(t)&&r.push(t)};t&&(e.is(t.forEach,"function")?t.forEach(s):s(t));var a=this._parent(t,i);return n&&n.silent||(a&&e.is(a.forEach,"function")?a.forEach(function(e){e.id||r.push(e)}):a&&!a.id&&-1===r.indexOf(a)&&r.push(a),i.forceDispatchEvent&&r.push(a),r.forEach(function(e){var t;t=o.get(e),o.dispatchEvent("onAdd",[t,o,n])})),a},getIdForCreateChildDSLC:function(){return 0===this.getUri().indexOf("/resources")?this.getId():""},_prepareModel:function(e){var t;if(!(e instanceof i)&&(t=s.getExistingAndMerge(e))){var n=Array.prototype.slice.call(arguments,0);return n[0]=t,this._parent.apply(this,n)}return this._parent.apply(this,arguments)},getTenant:function(){return window.enoviaServer.tenant||"OnPremise"},removeUnregisteredModel:function(e){-1===this._unregisteredModelsRemoved.indexOf(e)&&this._unregisteredModelsRemoved.push(e)},addUnregisteredModel:function(e){if(-1===this._unregisteredModelsAdded.indexOf(e)&&this._unregisteredModelsAdded.push(e),-1!==this._unregisteredModelsRemoved.indexOf(e)){var t=this._unregisteredModelsRemoved.indexOf(e);this._unregisteredModelsRemoved.splice(t,1)}},remove:function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var n=e[t];n.destroying&&n.onRemovedFromCollection(this)}return this._parent.apply(this,arguments)},allFetchesUseComplete:c.allFetchesUseComplete,handleBadFetchCounts:c.handleBadFetchCounts,fetchingMask:Function.prototype,doneFetchingMask:Function.prototype};return h.model.prototype.idAttribute=c.prototype.idAttribute,(h=o.extend(h)).implement(d),Object.defineProperty(h.prototype,"totalRecords",{get:h.prototype.getTotalRecords}),h.implement(u),u.initFetchTrackingMixinForClass(h),s.ResultCollection=h,h}),define("DS/RDFFoundation/Collections/PersonCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel"],function(e,t,n,i,r,o,s){"use strict";return o.extend({_uwaClassName:"PersonCollection",model:s})}),define("DS/RDFFoundation/Collections/UserCollection",["UWA/Core","UWA/Class/Events","UWA/Class/Listener","UWA/Class","UWA/Class/Collection","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Collections/ResultCollection","DS/RDFFoundation/Models/PersonRDFModel","DS/RDFFoundation/Models/UsersGroupRDFModel","DS/RDFFoundation/Models/LogicalUserModel"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return s.extend({_uwaClassName:"UserCollection",_prepareModel:function(e){var t,n;return this.model=(t=e[o.JS_TYPE_ATTR],n=a,t===o.LOGICAL_USER_TYPE?n=c:"foaf:Group"===t&&(n=l),n),this._parent.apply(this,arguments)}})}),define("DS/RDFFoundation/Models/NoAccessModel",["UWA/Core","UWA/Class/Model","DS/RDFFoundation/RDFUtils","i18n!DS/RDFFoundation/assets/nls/RDFFoundationNLS"],function(e,t,n,i){"use strict";return t.extend({_uwaClassName:"NoAccessModel",idAttribute:"physicalId",init:function(t,r){var o=e.extend(t||{},{"dsxplan:label":i.get("RDFFoundation.Label.NoAccess"),image:require.toUrl("DS/RDFFoundation/assets/img/NoAccess.png"),physicalId:"noAccessModelId"});this._parent(o,r),this.set("physicalId","noAccessModelId"+this.cid),n.addObjectToMap(this.id,this)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"displayValue":case"title":return this.get("dsxplan:label")}return t},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){},sync:Function.prototype,getObjectType:Function.prototype,hasViewAccess:function(){return!1},dataForRendering:function(){var e=this.toJSON();return e.isNoAccessModel=!0,e}})}),define("DS/RDFFoundation/Models/ComponentProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyIndexModel","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/Models/NoAccessModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/Search","DS/E6WCommonUI/PlatformManager","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r,o,s,a){"use strict";var l=function(e){return function(){var t=Array.prototype.slice.call(arguments,1);return t[0]=this,this.dispatchEvent("onChange"+(e?":"+e:""),t)}},c=n.extend({_uwaClassName:"ComponentProxyModel",writeMask:"dsplan:MVMask.ComponentProxy.Complex",setup:function(n,i){var r=e.clone(i||{},!1);r.mask="dsplan:MVMask.ComponentProxy.Complex";var o=this._getProxyModelId(this.id);this.indexModel=t.getObjectById(o)||new t({resourceid:o,tenant:this.get("dscom:Tenant"),source:this.sourceName}),this.listenTo(this.indexModel,"onChange:ds6w:label",l("title")),this.listenTo(this.indexModel,"onChange:type_icon_url",l("image")),this.listenTo(this.indexModel,"onChange:ds6w:type",l("ds6w:type")),this.listenTo(this.indexModel,"onChange:modified",l("modified")),this.listenTo(this.indexModel,"onChange",l());var s=this;"3DLean"!==this.get("dscom:ServiceHosting")&&this.indexModel.fetch({onComplete:function(){if("3DSpace"===s.get("dscom:ServiceHosting")){let n=s.get("ds6w:label"),i=s.get("modified");if(!n&&!i){var t=e.clone(arguments[2]||{},!1).onFailure;t&&t("object_not_found")}}},onFailure:function(e,t){"object_not_found"===t&&(s.indexModel._noAccess=!0,s.dispatchEvent("onModelAccessChanged"))}}),this._parent(n,r)},canShowProperties:function(){return"3DLean"!==this.sourceName},hasViewAccess:function(){return Boolean(this.forceAccess||this.indexModel&&!this.indexModel._noAccess)},getLaunchOptions:function(e){var t=this._parent.apply(this,arguments);return"swym:Community"===this.getDragType()?(t.appId="X3DMCTY_AP",t.community=this.get("physicalId"),t.communityType="community"):"Project Space"===this.getDragType()?(t.ids=this.get("physicalId"),t.appId="ENOPRPR_AP"):"3dportfolio"===this.serviceHosting&&(t.ids=r.removeBracketLongURI(this.get("physicalId")),t.appId="ENXPORT_AP"),t.x3dPlatformId=this.tenant,t},_getProxyModelId:function(e){if(this.get("dscom:ServiceHosting")){var t=("dscom:"+this.get("dscom:ServiceHosting")+"_").length;return decodeURI(e.substring(t))}return e.split("_")[1]},set:function(e,t){"modified"===e?this.indexModel.set(e,t):"title"===e?this.indexModel.set("ds6w:label",t):this._parent.apply(this,arguments)},get:function(e){var t=this._parent.apply(this,arguments);switch(e){case"title":return this.indexModel.get("ds6w:label")||t;case"physicalId":return this.indexModel.id||this._getProxyModelId(this.id);case"image":return this.indexModel.get("preview_url")||this.indexModel.get("type_icon_url")||t;case"ds6w:type":case"type":return this["@type"]||this.indexModel.get("ds6w:type")||t;case"hasfiles":return r.DOWNLOADABLE_TYPES.includes(this.get("type"));case"fileExtension":return this.indexModel.get("ds6w:docextension")}return t||(t=this.indexModel&&this.indexModel.get(e)),t},toJSON:function(e){var t=this._parent.apply(this,arguments);if(e&&e.dataForRendering){if(t.image=this.get("image"),t.type=this.get("type"),t.hasfiles=this.get("hasfiles"),t.fileExtension=this.get("fileExtension"),t.title=this.get("title"),"No Access"===t.error||!this.hasViewAccess())t=(new i).toJSON();t.physicalId=this.get("physicalId")}else t["ds6w:type"]=this.get("ds6w:type");return t},syncCreate:function(e,t){t.noStringify=!0;var n=this._parent.apply(this,arguments),i="/invoke/dsxplan:createProxyModel",o=this.writeMask||this.getMask(),s=o?"?$mask="+o:"";t.url=r.expandUrl(i+s),t.data=JSON.stringify([t.attrs]),t.method="POST";var a=t.onComplete;return t.onComplete=function(e,t){var n=e;return n["@href"]===i&&(n=n["@value"]||n.value),a.call(this,n,t)},n},getParentPath:function(){return""},getTransferObject:function(){var e={serviceId:this.serviceHosting,envId:this.tenant};try{var t=this.getDragType(),n=this.get("parentTypes")||[];if(0!==n.length)if("Document"===t){var i=n,r=this.indexModel.get("files");if(r&&1===r.length){var o=r[0].dataelements.title.match(/\.[^.]*$/);i.push(o[0])}e.objectTaxonomies=i}else 0!==Object.keys(n).length&&(e.objectTaxonomies=n)}catch(e){console.log(2)}return this._parent(e)},getObjectType:function(){return this.get("type")},getDragType:function(){return this.get("type")}});return Object.defineProperty(c.prototype,"tenant",{get:function(){return this.get("dscom:Tenant")}}),Object.defineProperty(c.prototype,"serviceHosting",{get:function(){return this.get("dscom:ServiceHosting")}}),Object.defineProperty(c.prototype,"sourceName",{get:function(){return r.sourceFromService(this.serviceHosting)||""}}),Object.defineProperty(c.prototype,"fedSearchIdQuery",{get:function(){return o.isM1BasedSource(this.sourceName)?'physicalid:"'+this.get("physicalId")+'"':"geovia"===this.sourceName?'uri:"'+this.get("physicalId")+'"':"3dportfolio"===this.sourceName?'uri:"'+r.shortToLongURI(this.get("physicalId"))+'"':"swym"===this.sourceName?'resourceid:"'+this.get("physicalId")+'"':this.id}}),c.computeURI=function(e){return"dscom:"+e.serviceId+"_"+encodeURI(e.id)},c.getNewProxyModel=function(e){var t="dscom:"+e.serviceId+"_",n=e.id;0!==e.id.indexOf(t)&&(n=c.computeURI(e));var i=r.getObjectForAdding(c,n,{attrs:{title:e.title,image:e.image,"dscom:ServiceHosting":e.serviceId,"dscom:Tenant":e.tenant,type:e.type,"@type":"dscom:ComponentProxy"}});return i.forcedNew=!0,i},c}),define("DS/RDFFoundation/Models/DriveRepositoryProxyModel",["UWA/Core","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/PlatformManager"],function(e,t,n,i){"use strict";var r=t.extend({_uwaClassName:"DriveRepositoryProxyModel",init:function(e){return e&&e["@id"]&&(e["dscom:ServiceHosting"]="3DDrive",e["dscom:Tenant"]=i.getTenant(),e["@type"]="dscom:ComponentProxy"),this._parent.apply(this,arguments)}});return r.ID_PREFIX="dscom:3DDrive_",r}),define("DS/RDFFoundation/Models/RDFCloneModel",["UWA/Core","DS/E6WCommonUI/Models/CloneModel","DS/E6WCommonUI/E6WCommonUIConstants","DS/RDFFoundation/Models/ResultModel","DS/RDFFoundation/RDFUtils","DS/E6WCommonUI/UIHelper","DS/RDFFoundation/Models/ComponentProxyModel","DS/RDFFoundation/Models/PersonRDFModel","DS/E6WCommonUI/Models/DropValidator","DS/RDFFoundation/FederatedSearchUtil","DS/RDFFoundation/MemberUtils","DS/RDFFoundation/Models/UsersGroupRDFModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r,o,s,a,l,c,d,u,h){"use strict";var p=t.extend({getObjectToBeAdded:function(t,i,l){var c;if(!l.dropObj&&!l.detailedObject)return r.getObjectById(i);c=o.getObjectDataFromDropSearchOrTypeAhead(l);var h,p,g,f=r.getObjectById(c.id);if(f)return f;if("3dplan"!==c.serviceId){var m="pno:Person"===c.type,v="foaf:Group"===c.type;if(!m&&!v)return c.id=s.computeURI(c),s.getNewProxyModel(c);var y=c.id;if(!y.startsWith("uuid:")){var C={id:y,callback:this.swymPersonCallback.bind(this),onFailure:this.swymPersonCallbackFailure.bind(this),fieldName:t};return e.extend(l,{searchOptions:C}),this._swymPersonFetchCount++,void d.findAndGetSwymPersonResourceUid(l)}h=l.detailedObject&&"pno:Person"===l.detailedObject["ds6w:type"]?a:u,p=d.getPersonMask(),g={"dsaccess:accountName":c.accountName}}else g={"@type":c.type?c.type:n.LOGICAL_USER_TYPE},h=r.getModelConstructor(g),p="dsplan:MVMask.Task.Basic";return r.getObjectForAdding(h,c.id,{mask:p,attrs:g})},swymPersonCallback:function(e,t){if(e){var n,i=d.addUUIDToURI(e,t),o=t.searchOptions,s=o&&o.fieldName,l=o&&o.id;this.localAttributes.hasOwnProperty(s)&&delete this.localAttributes[s];var c=t.dropObj&&("foaf:Group"===t.dropObj.objectType||"Group"===t.dropObj.objectType),h=t.detailedObject&&("foaf:Group"===t.detailedObject["ds6w:type"]||"Group"===t.detailedObject["ds6w:type"]);n=c||h?this.addIndividualObjectAsModel(s,r.getObjectForAdding(u,i,{mask:d.getPersonMask(),attrs:{"dsaccess:accountName":d.getAccountNameForUser(l,i),"ds6w:label":d.getLabelForUserGroup(t)}})):this.addIndividualObjectAsModel(s,r.getObjectForAdding(a,i,{mask:d.getPersonMask(),attrs:{"dsaccess:accountName":d.getAccountNameForUser(l,i)}})),!d.userMap[l]&&d.addUserUIdToMap(l,i),this.dispatchEvent("onChange:modificationsPending",[this]),t.operation="add",t.added=[n.ret],this._fireRelationshipChangeEvents(s,t)}this._swymPersonFetchCount--},swymPersonCallbackFailure:function(){this._swymPersonFetchCount--},buildBatchWithPreprocessedObjects:function(e){var t=e&&e.batch,n=e&&e.attributesToBeUpdated||{},i=Object.keys(n);if(i.length){var o=this._options.onFailure;t=t||r.getBatchGenerator();for(var a=0;a<i.length;a++)for(var l=i[a],c=0;c<n[l].length;c++){var d=n[l][c];d instanceof s!=!1&&(delete d.collection,d.save(void 0,{ajax:t.ajax,newTransaction:!0,onFailure:o}))}}return t},save:function(t){if(this.model.hasFetchedAccessData&&this.model.hasFetchedAccessData()&&!this.model.canModify())o.displayError(h.get("E6WCommonUI.Error.noAccessOnObject"));else if(this._swymPersonFetchCount)this.listenToOnce(this,"allSwymPersonsFetched",this.save.bind(this,t));else{var n=this._filterProxyObjectsFromLocalAttributesAndLocalRelatedData(),i=e.clone(t||{},!1);i.attributesToBeUpdated=n.proxyAttributes;var r=this;if(Object.keys(this.localRelatedData).find(function(e){return r.localRelatedData[e].find(function(e){return e.input instanceof window.File||e.input.FileName})})){var s=this.get("dsplan:hasBookmark");s&&(i.relInfo={parentDirection:"From",parentId:s.get("physicalId"),parentRelName:"Vaulted Objects"})}var a=this.buildBatchWithPreprocessedObjects(i);a?(i.changed=!0,i.ajax=a.ajax,i.newTransaction=!0,this._saveSingleObjectOnlyFiles(i),delete i.attributesToBeUpdated,this._parent(i),delete i.ajax,delete i.onComplete,a.sendBatch(i)):(this._saveSingleObjectOnlyFiles(i),i&&(i.attributesToBeUpdated=i.attributesToBeUpdated||{}),this._parent(i))}},_saveSingleObjectOnlyFiles:function(t){var n=this,i=e.clone(t||{},!1),r=Object.keys(this.localAttributes);i.singleObjectOnly=!0,r.forEach(function(e){var t=n.localAttributes[e];t&&"single"===t.operation&&(t.input instanceof window.File||t.input.FileName)&&n._addFile(e,t,i)})},_modelSave:function(e){this._shouldWaitForSave()?this.model.set(e):this._parent.apply(this,arguments)},_shouldWaitForSave:function(){return this.model&&this.model.isUploadingFiles&&this.model.isUploadingFiles()},_validateDroppedObject:function(e,t){var n=l.validateDroppedObject(e,t);return n&&o.displayError(n),n},_filterProxyObjectsFromLocalAttributesAndLocalRelatedData:function(){var e=Object.keys(this.localRelatedData),t={},n={},i=this;return e.forEach(function(e){for(var r=i.localRelatedData[e],o=0;o<r.length>0;o++){var a,l=r[o].value;l instanceof s?"add"===r[o].operation&&((a=t[e]||[]).push(l),t[e]=a):((a=n[e]||[]).push(r[o]),n[e]=a)}}),(e=Object.keys(this.localAttributes)).forEach(function(e){var n=i.localAttributes[e];n instanceof s&&(t[e]=[n])}),{proxyAttributes:t,nonProxyAttributes:n}},onFileUploadFailure:function(t,n,i){if(e.merge(t,this._options),this._parent.apply(this,arguments),i&&i.getChangedAttributesSinceLastSave().length&&!p._modelShouldWaitForSave(i)){var r=this.buildBatchWithPreprocessedObjects(t);this.saveModelAfterFileUpload(i,t,r)}},onFileUploadComplete:function(t,n,i,r){e.merge(t,this._options);var o={id:n.id,title:n.title||n.dataelements.title,serviceId:n.serviceId||"3DSpace",tenant:window.enoviaServer.tenant,image:n.image||n.dataelements.image},a=s.getNewProxyModel(o);a.forceAccess=!0,a["@type"]=n.type;var l=t.fieldName,c=this.model||i;if(r){var d=c.get(l);d&&d.length&&c.removeObject(l,d._models[0],t),c.set(l,a)}else c.addObjects([a],l,void 0,{silentOnChange:!0,at:0,values:[a]});var u=e.clone(t||{},!1);u.attributesToBeUpdated=u.attributesToBeUpdated||{};var h=u.attributesToBeUpdated[l]||[];if(h.push(a),u.attributesToBeUpdated[l]=h,!p._modelShouldWaitForSave(c)){var g=this.buildBatchWithPreprocessedObjects(u);this.saveModelAfterFileUpload(c,u,g)}},saveModelAfterFileUpload:function(t,n,i){var r=e.clone(n||{},!1),s=r.onFailure;r.onFailure=function(e,t){t&&401===t["@code"]&&o.displayError(h.get("E6WCommonUI.Error.noAccessOnObject")),s&&s(arguments)},i?(r.changed=!0,r.ajax=i.ajax,r.newTransaction=!0,t.save(null,r),delete(r=e.clone(r||{},!1)).ajax,delete r.onComplete,delete r.onFailure,i.sendBatch(r)):t.save(null,r)},getDetailedObjectToBeAdded:function(t,n,i){if(i&&i.isObject){var r=e.clone(i||{},!1);return r.detailedObject=r.detailedObjects&&r.detailedObjects[0],this.getObjectToBeAdded(t,n,r)}return n},set:function(n,i,r){var o,s=e.clone(r||{},!1),a=s.config&&s.config.singleObjectOnly;return i&&i.actualValue&&(i=i.actualValue),i=this.getDetailedObjectToBeAdded(n,i,r),a&&i instanceof FileList&&(i={operation:"single",input:o=i[0],value:new t.FileValue(o,s),isThumbnail:s&&s.config&&s.config.isThumbnail,dataForRendering:function(){return this.value.toJSON()},get:function(e){return this.value.get(e)}},Object.assign(i,i.dataForRendering())),this._parent(n,i,r)},add:function(t,i,r){var s;if(t===n.ATTACHMENT_ATTR||t===n.ACTUAL_DELIVERABLE_ATTR){var a=this.get(n.BOOKMARK_FOR_FILE_REPOSITORY);if(a&&!a.hasViewAccess())return o.displayError(h.get("E6WCommonUI.Error.noAccessOnBookmark")),s}var l=e.clone(r||{},!1),c=l.singleObjectOnly||l.config&&l.config.singleObjectOnly;return s=this.get(t)instanceof e.Class.Model||c?this.replaceObjectOnAttributeWithSingleModel.apply(this,arguments):this._parent.apply(this,arguments)},remove:function(t,n,i){var r,o=e.clone(i||{},!1),s=o.singleObjectOnly||o.config&&o.config.singleObjectOnly,a=this.get(t);this.model.get(t)&&(a instanceof e.Class.Model||s)&&delete this.localAttributes[t],r=(a=this.get(t))&&this._parent.apply(this,arguments);var l=this.model.get("dsplan:hasBookmark");return l&&"dsxplan:hasContentRepository"===t&&this.model.removeObject("dsplan:hasBookmark",l,i),r},replaceObjectOnAttributeWithSingleModel:function(n,i,r){var o=e.clone(r||{},!1);o.isObject=!(i instanceof e.Class.Model||i instanceof FileList||i instanceof File);var s=o.isCollectionAttribute,a=e.is(i,"string")?void 0:[i];if(this.get(n))this.remove(n,0,r),s||delete this.localRelatedData[n];else if(!s){var l=this.localRelatedData[n];l&&1===l.length&&"remove"===l[0].operation&&delete this.localRelatedData[n]}return s?t.prototype.add.call(this,n,i,o):this.set(n,i,o),a},preprocessPersonObject:function(e){if("pno:Person"===e.objectType){var t=e.objectId;t.startsWith("iam:")||(e.objectId=d.addUUIDToURI(t))}}});p._modelShouldWaitForSave=function(e){return e.isUploadingFiles&&e.isUploadingFiles()};var g=0;return Object.defineProperty(p.prototype,"_swymPersonFetchCount",{get:function(){return g},set:function(e){0===(g=e)&&this.dispatchEvent("allSwymPersonsFetched")}}),p}),define("DS/RDFFoundation/SecurityContextUtils",["UWA/Core","DS/Foundation/WidgetAPIs","DS/Foundation2/FoundationV2Data","DS/E6WCommonUI/PlatformManager","DS/RDFFoundation/Models/DriveRepositoryProxyModel"],function(e,t,n,i,r){"use strict";var o={spaceNames:{}},s=[];return o.getDefaultSecurityContext=function(){var e;if(window.enoviaServer.space)return window.enoviaServer.space;var t=o.getSecurityContexts();return t&&t.length&&(e=t[0].actualValue,t.some(function(t){return!!t.isDefault&&(e=t.actualValue,!0)})),e},o.getDefaultCollabSpace=function(){var e,t=o.getSecurityContexts();return t&&t.length&&(e=t[0].csName,t.some(function(t){return!!t.isDefault&&(e=t.csName,!0)})),e},o.getSecurityContexts=function(){return s},o.processSecurityContextData=function(e){var t=[];e.forEach(function(e){var n,i=e.name,r=e.displayName.split(".");r.length&&(n=r[r.length-1]),t.push({actualValue:i,displayValue:n,csName:e.csName,isDefault:e.isDefault})}),s=t},o.initSecurityContexts=function(){t.getSecurityContexts(o.processSecurityContextData)},o.getContentRepositories=function(t,n){var i=o.getUsersContentRepositories(),s=t.get(n);(s=e.is(s,"array")?s[0]:s,i&&s)&&(s instanceof r||o.hasAccessToContentRepository(s.id)||i.push({actualValue:s.id}));return i},o.getUsersContentRepositories=function(){var e=o.getSecurityContexts(),n=[],i=Object.create(null);if(e){var r=e.slice();if(r.length>0)r[r.length-1].actualValue===t.TSK_PRIVATE_SPACE&&r.pop();r.forEach(function(e){var t=e.csName;t&&!i[t]&&(n.push({actualValue:t,displayValue:e.displayValue}),i[t]=!0)})}return n},o.hasAccessToContentRepository=function(e){return o.getUsersContentRepositories().some(function(t){return t.actualValue===e})},o.getContentRepositoryValuesForDetailDisplay=function(t,n){var i=n.attribute,r=o.getContentRepositories.bind(void 0,t,i);return e.merge(r,e.Class.Events.prototype),e.merge(r,e.Class.Listener.prototype),r.listenTo(t,"onChange:"+i,function(){r.dispatchEvent("onChange")}),r},o.loadSecurityContextsForTenant=function(e){let r=e.tenant||i.getTenant();if(o.spaceNames[r])return void e.callback(o.spaceNames[r]);let s=[],a=i.getTenantServiceData(r),l=a?a["3DSpace"]:void 0;if(o.shouldShowPrivateSecurityContext()&&s.push({name:t.TSK_PRIVATE_SPACE,displayName:"Private ● "+i.getContextUserName(),csName:"TSK_privateSpace"}),l){let t=l;t+="/resources/bps/cspaces?tenant="+r,n.ajaxRequest({url:t,type:"GET",dataType:"json",data:"",noSecurityContext:!0,callback:function(t){o.spaceNames[r]=t.cspaces.concat(s),e.callback(o.spaceNames[r])}},!0)}else o.spaceNames[r]=s,e.callback(s)},o.shouldShowPrivateSecurityContext=function(e){var t="ENOTASK_AP"===widget.getValue("appId")||"ENOTASP_AP"===widget.getValue("appId"),n=i.getTenantServiceData(e),r=n&&Boolean(n["3dplan"]),o=i.isOnPremise();return t&&r&&!o},o.isTSKContext=function(){return"ENOTASK_AP"===widget.getValue("appId")||"ENOTASP_AP"===widget.getValue("appId")},o}),define("DS/RDFFoundation/Models/CollabspaceRepositoryModel",["UWA/Core","DS/RDFFoundation/SecurityContextUtils","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/ResultModel","i18n!DS/E6WCommonUI/assets/nls/E6WCommonUINLS"],function(e,t,n,i,r){"use strict";return i.extend({_uwaClassName:"CollabspaceRepositoryModel",idAttribute:"@id",setup:function(e){if(!e.displayValue){var n=t.getUsersContentRepositories().find(e=>e.actualValue===this.id);this.set(n)}},get:function(e){var n=this._parent.apply(this,arguments);switch(e){case"physicalId":return this.id;case"image":return require.toUrl("E6WCommonApps/assets/Collab_Space_icon.png");case"title":return t.hasAccessToContentRepository(this.id)?this.get("displayValue"):r.get("E6WCommonUI.Error.NoAccess")+(this.get("displayValue")||this.id)}return n},hasViewAccess:function(){return t.hasAccessToContentRepository(this.id)},toJSON:function(){var e=this._parent.apply(this,arguments);return e.title=this.get("title"),e.image=this.get("image"),e},compactJson:function(){return this.id}})}),define("DS/RDFFoundation/Models/CloneModelForRepository",["UWA/Core","DS/RDFFoundation/RDFUtils","DS/RDFFoundation/Models/RDFCloneModel","DS/RDFFoundation/Models/CollabspaceRepositoryModel","DS/RDFFoundation/Models/DriveRepositoryProxyModel","DS/E6WCommonUI/UIHelper"],function(e,t,n,i,r,o){"use strict";return n.extend({_uwaClassName:"CloneModelForRepository",save:function(t){var n=this.getUploadRepositoryIdAsOptionsObject(),i=e.clone(t||{},!1);e.merge(i,n),this._parent(i)},dataForRenderingWhitelistHelper:function(t,n){for(var i,r=this.createWhitelistMap(n),s=0;s<this.attributesOverridden.length;s++)if(i=this.attributesOverridden[s],r&&r[i]){var a=this.get(i);e.is(a,"object")&&(a=o.normalizedToJson(a,n)),t[i]=a}else delete t[i];return t},dataForRendering:function(e){var t=this._parent.apply(this,arguments),n=e&&e.attributes,i=this;function r(e){if(!n||n&&-1!==n.indexOf(e)){var r=i.get(e);r&&(t[e]=r.toJSON({dataForRendering:!0}))}else delete t[e]}return r("dsxplan:hasContentRepository"),r("dsplan:hasCollaborativeSpace"),t},getUploadRepositoryIdAsOptionsObject:function(){var e={},t=this.get("dsxplan:hasContentRepository");if(t){var n=t.id;n.startsWith(r.ID_PREFIX)?e.driveFolderProxyId=n:e.collabspaceId=n}return e}})});