var wafrVersion="WAFR2.0";define("DS/WAfrAppManager/mod_AppManager",["UWA/Class/Promise","DS/WAfrUtils/Logger","i18n!DS/WAfrContainer/assets/nls/Notification"],function(t,e,i){"use strict";var n=Object.create(null),o=function(t){this._options=t};return o.DEFAULT_COMPONENT_NAME="AFR_AppManager",o.prototype.setCurrentConfig=function(t){this._config=t},o.prototype.initialize=function(){this._executionContext=this.getExecutionContext(),this._container=this._executionContext._container;var e=this._executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);if(e){var i=this;["onWillLoadApp","onDidLoadApp","onDidFailToLoadApp"].forEach(function(t){e.subscribeOnce({event:t},i[t].bind(i))})}return t.resolve()},o.prototype.onWillLoadApp=function(t){this._appId=t,this._sourceApp=this._executionContext.getSourceApp()},o.prototype.onDidLoadApp=function(){var t=this._executionContext.getSourceApp();void 0===t.options.brand&&(this._container._view.getValue("brand")?t.options.brand=this._container._view.getValue("brand"):this._container._view.getTitleHeader().brand&&(t.options.brand=this._container._view.getTitleHeader().brand));var e=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager);this._appId=t.getId();var n=this._sourceApp?this._sourceApp.getTitle()||this._container._view.getTitleHeader().appTitle||this._sourceApp.getId():null,o=this._container._view.getValue("afrExecutionContexts");if(!o)throw new Error("The persisted contexts must not be undefined");o[this._container._currentExecutionContext].currentappId=t.getId(),this._container._view.setValue("afrCode",t.getIdCard().afrCode),this._container._view.setValue("afrExecutionContexts",o.slice()),this._container._view.setValue("afrCurrentExecutionContextIdx",this._container._currentExecutionContext),this._container._view.setValue("afrAppId",t.getId()),this._container._view.setValue("appId",t.getId()),this._container._view.setBrand(t.options.brand),this._container._view.setValue("appTitle",t.getTitle()),this._container.updateAppTitle(t.getTitle()),this._container.updateTitle({title:this._container.productTitle},t),this._container._view.setValue("brand",t.getBrand()||this._container._view.getValue("brand")),this._container._view.setValue("afrFamily",t.getIdCard().afrFamily),this._container._view.setValue("afrTransitionsFrom",t.getIdCard().afrTransitionsFrom),this._container._view.setValue("afrTransitionsFromFamily",t.getIdCard().afrTransitionsFromFamily),this._container._view.setValue("afrTransitionsTo",t.getIdCard().afrTransitionsTo),this._container._view.setValue("afrTransitionsToFamily",t.getIdCard().afrTransitionsToFamily);var a=t.getTitle(),r={containerId:this._container.id,contextId:this._executionContext.getId(),targetApp:{options:t.options}};r.targetApp.options.appConfig.appId=t.getId(),this._container.publish("onAppReady."+this._appId,r);var s="",p={};if(n){s="WAfrTransitionSuccessful",p[0]=a,p[1]=n;var c=i.get(s+".message"),d=i.get(s+".title");p&&c&&(c=i.replace(c,p)),e&&e.notifySuccess({title:d,message:c})}this._appId=null,this._sourceApp=null},o.prototype.onDidFailToLoadApp=function(t){var n=this._executionContext.getComponent(WAfrStandardComponentKey.NotificationManager),o=this._executionContext.getTargetApp()&&this._executionContext.getTargetApp().getTitle(),a={containerId:this._container.id,contextId:this._executionContext.getId()},r="WAfrTransitionFailed",s={0:o};if(o){s[1]=t&&t.message||"";var p=i.get(r+".message");p=i.replace(p,s);var c=i.get(r+".title");n&&n.notifyError({title:c,message:p})}t&&(e.severe("Error when loading configuration \n"+t.stack),a.error={name:t?t.name:"Error",message:t?t.message:""}),this._container.publish("onAppFail."+this._appId,a)},o.prototype.createExposedComponent=function(){return{launchApp:this.getExecutionContext()._container.launchApp.bind(this.getExecutionContext()._container)}},n.AppManager=o,n});