define("DS/MPFSheerIdVerificationModel/SheerIdModel",["DS/MPFModel/MPFModel","DS/MPFDataProxy/NoDataProxy","DS/MPFServices/ObjectService","DS/MPFConnector/Connector"],function(e,t,r,i){"use strict";return e.extend({init(e,r){r.dataProxy=t.getInstance(),this._parent(e,r)},setup(e,t){r.requiredOfPrototype(t.connector,i,"options.connector must be a Connector"),this._type="SheerIdModel",this._parent(e,t),this.connector=t.connector},fetch(){return this.connector.fetch(...arguments).then(e=>(this.set(e),this))}})}),define("DS/MPFSheerIdVerificationModel/VerificationSteps",[],function(){const e={COLLECT_STUDENT_INFO:"collectStudentPersonalInfo",SSO:"sso",DOC_UPLOAD:"docUpload",SUCCESS:"success",ERROR:"error",PENDING:"pending"};return e}),define("DS/MPFSheerIdVerificationModel/SheerIdVerificationModel",["DS/MPFDataProxy/NoDataProxy","DS/MPFSheerIdVerificationModel/SheerIdModel","DS/MPFModel/ModelValidator","DS/MPFConstraintModel/ConstraintModel","DS/MPFSheerIdVerificationModel/VerificationSteps","i18n!DS/MPFSheerIdVerificationModel/assets/nls/MPFSheerIdVerificationModel"],function(e,t,r,i,o,n){"use strict";const s={PROGRAM_ID:"programId",TRACKING_ID:"trackingId",VERIFICATION_ID:"verificationId",CURRENT_STEP:"currentStep",AWAITING_STEP:"awaitingStep",SUBMISSION_URL:"submissionUrl",LOGIN_URL:"loginUrl",CANCEL_URL:"cancelUrl",REWARD_CODE:"rewardCode",ERROR_IDS:"errorIds",REJECTION_REASONS:"rejectionReasons",ESTIMATED_REVIEW_TIME:"estimatedReviewTime",MAX_REVIEW_TIME:"maxReviewTime",FIRST_NAME:"firstName",LAST_NAME:"lastName",EMAIL:"email",BIRTH_DATE:"birthDate",ORGANIZATION:"organization",PHONE_NUMBER:"phoneNumber",LOCALE:"locale",METADATA:"metadata"},I={INTERNAL_SERVER:"internalServerError",INVALID_PROGRAM:"invalidProgram",INVALID_API_TOKEN:"invalidApiToken",NO_VERIFICATION:"noVerification",VERIFICATION_LIMIT_EXCEEDED:"verificationLimitExceeded",DOC_REVIEW_LIMIT_EXCEEDED:"docReviewLimitExceeded",EXPIRED_VERIFICATION_TOKEN:"expiredVerificationToken"},a=[I.NO_VERIFICATION],d=t.extend({setup(e,t){this._type="SheerIdVerificationModel",this._parent(e,t),this.validator=this._createValidator()},validate(e){return this.validator.validate(e)},fetchVerification(){const e=this.get(s.PROGRAM_ID),t=this.get(s.VERIFICATION_ID),r=this.get(s.TRACKING_ID);if(t)return this._fetchStatus(t);if(e)return r?this._fetchStatusWithTrackingId(e,r):this._initNewVerification(e);throw new Error("Program ID or verification ID required to start verification")},submitStudentData(){const e=this.get(s.SUBMISSION_URL),t=this.get(s.PROGRAM_ID),r=e||`/verification/program/${t}/step/collectStudentPersonalInfo`;return this.fetch(r,{method:"POST",data:this.pick([s.FIRST_NAME,s.LAST_NAME,s.EMAIL,s.BIRTH_DATE,s.ORGANIZATION])})},uploadDocuments(e){const t=this.get(s.SUBMISSION_URL);var r=new FormData;return e.forEach((e,t)=>{r.append(`file${t}`,e)}),this.fetch(t,{method:"POST",data:r,isJson:!1})},getCurrentStep(){return this.get(s.CURRENT_STEP)},getVerificationId(){return this.get(s.VERIFICATION_ID)},getProgramId(){return this.get(s.PROGRAM_ID)},getSubmissionUrl(){return this.get(s.SUBMISSION_URL)},getErrorIds(){return this.get(s.ERROR_IDS)},getFirstErrorId(){const e=this.get(s.ERROR_IDS);return e.length&&e[0]},isErrorRecoverable(){const e=this.getFirstErrorId();return e&&a.includes(e)},_fetchStatus(e){return this.fetch(`/verification/${e}`)},_fetchStatusWithTrackingId(e,t){return this.fetch(`/verification/program/${e}/trackingId/${t}`).then(()=>{if(this.getCurrentStep()===o.ERROR&&this.isErrorRecoverable())return this._initNewVerification(e,t)})},_initNewVerification(e,t){return this.fetch("/verification",{method:"POST",data:{programId:e,trackingId:t}})},_createValidator(){return new r({model:this,validations:[{[i.Fields.ATTRIBUTE]:s.FIRST_NAME,[i.Fields.REQUIRED]:!0,[i.Fields.REQUIRED_ERROR]:n.get("xIsRequired",{x:n.get("firstName")})},{[i.Fields.ATTRIBUTE]:s.LAST_NAME,[i.Fields.REQUIRED]:!0,[i.Fields.REQUIRED_ERROR]:n.get("xIsRequired",{x:n.get("lastName")})},{[i.Fields.ATTRIBUTE]:s.EMAIL,[i.Fields.PATTERN]:/(^\s*?[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@([A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)+|\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])\s*?$)/,[i.Fields.REQUIRED]:!0,[i.Fields.INVALID_ERROR]:n.get("xIsInvalid",{x:n.get("emailAddress")}),[i.Fields.REQUIRED_ERROR]:n.get("xIsRequired",{x:n.get("emailAddress")})},{[i.Fields.ATTRIBUTE]:s.BIRTH_DATE,[i.Fields.REQUIRED]:!0,[i.Fields.REQUIRED_ERROR]:n.get("xIsRequired",{x:n.get("birthDate")})},{[i.Fields.ATTRIBUTE]:s.ORGANIZATION,[i.Fields.REQUIRED]:!0,[i.Fields.IS_OBJECT]:!0,[i.Fields.REQUIRED_ERROR]:n.get("xIsRequired",{x:n.get("organization")})},{[i.Fields.ATTRIBUTE]:s.PHONE_NUMBER,[i.Fields.PATTERN]:/\+?0*\d{10,}(x[0-9]{0,5})?/,[i.Fields.INVALID_ERROR]:n.get("xIsInvalid",{x:n.get("phoneNumber")})}]})}});return d.Fields=Object.freeze(s),d.Errors=Object.freeze(I),d}),define("DS/MPFSheerIdVerificationModel/SheerIdProgramModel",["DS/MPFServices/ObjectService","DS/MPFConnector/MarketplaceConnector","DS/MPFSheerIdVerificationModel/SheerIdModel"],function(e,t,r){"use strict";const i={PROGRAM_ID:"programId",CONFIG:"config"},o=r.extend({setup(e,t){this._type="SheerIdProgramModel",this._parent(e,t)},fetchProgramId(r){e.requiredOfPrototype(r,t,"First argument must be a MarketplaceConnector");const o=r.url("/generic-bo/sheerIdProgram");return new Promise((e,t)=>{r.request(o,{onComplete:e,onFailure:t})}).then(e=>(this.set(i.PROGRAM_ID,e[0]),this))},fetchProgramTheme(){const e=this.get(i.PROGRAM_ID);return this.fetch(`/program/${e}/theme`)},getProgramId(){return this.get(i.PROGRAM_ID)},getOrgSearchUrl(){const e=this.get(i.CONFIG);return e&&e.orgSearchUrl}});return o.Fields=Object.freeze(i),o});