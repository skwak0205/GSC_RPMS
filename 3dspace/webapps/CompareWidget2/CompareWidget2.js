define("DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,n,i,r){return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i),this._dataSource="PORTFOLIO_SERVICE",this._dbFallback=!1},execute:function(e,r){var o=this;o._parent(e,r),function(e,r){var o=this;return new Promise(function(a,s){o._lastReqStart=o._plugSvcs.nowMS();var l=o._lastReqStart;o._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var c=e.length,u=[];for(let d of e)t.doExpand(d,"PORTFOLIO_SERVICE","-1",o._plugSvcs,r).then(function(t){var p=t,h=n.convert(d,p,o._plugSvcs,r);if(h.setDataSource(p._dataSource),h.sortChildren(),o.dbgout("%% STRUCTURAL DATA EXPANDED by: "+h._dataSource),l==o._lastReqStart){var g={securityContext:d._securityContext,tenant:d._tenant,serviceName:d._serviceName};i.augment(h,g,o._plugSvcs).then(function(t){if(l==o._lastReqStart){var n,i,r,s=t;if(u.push(s),u.length>=c){var d=(n=e,i=[],r={},u.forEach(function(e){var t=e.getObjIDSpec().getUniqueID();r[t]=e}),n.forEach(function(e){var t=e.getUniqueID(),n=r[t];i.push(n)}),i);if(l!=o._lastReqStart)return;a(d)}}},function(e){o._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),s(e)})}},function(e){o._plugSvcs.errout("Failed to expand using service: "+e),s(e)})})}.call(o,e,r).then(function(e){var t=e;o.reportOK(t)},function(e){o.reportKO()})}})}),define("DS/CompareWidget2/plugins/PORTFOLIO/expanders/PortfolioExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","DS/CompareCommon/CompareMetaData","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/ViewDefModules/ViewDefOptions","UWA/Json"],function(e,t,n,i,r,o,a,s){function l(e){var n=e.attributes.revision,i={};if(t.isRevBranchRevPattern(n,i)){for(var r=e.attributes.name,o=i.branches.length-1;o>=0;--o)r+="_"+i.branches[o].branchId,0!==o&&(r+="_"+i.branches[o].revisionId);e.attributes.name=r}e.logicalid="NoDupes"}return{jsName:"PORTFOLIO_EXPAND",doExpand:function(e,s,c,u,d){return new Promise(function(c,d){(function(e,t,n,r){return new Promise(function(t,n){var r="objectIds="+e.getPhysID(),o=e.getTenant(),a=e.getServiceName();i.makeAuthHttpsCall("/3dportfolio/fetchObjs","GET",r,"json",o,a,null,!1).then(function(e){t(e)},function(e){n(e)})})})(e).then(function(i){var p=i[0];for(var h of(p._dataSource=s,p.nodes))void 0!==h.serviceId&&null!==h.serviceId&&"3dportfolio"===h.serviceId.toLowerCase()&&l(h);(function(e,i,s,l){return new Promise(function(l,c){if(null!=i){var u={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext},d={objectIds:[],objectTypes:[],serviceIds:[],tenant:e._tenant,securityContext:e._securityContext};for(var p of i.nodes)p.nodeid!==i.rootoccurrence&&void 0!==p.proxySpec&&null!==p.proxySpec&&(-1!==p.proxySpec.serviceURL.search(/^3DSpace/i)?(u.objectIds.push(p.physicalid),u.objectTypes.push(p.type),u.serviceIds.push(p.proxySpec.serviceURL)):(d.objectIds.push(p.physicalid),d.objectTypes.push(p.type),d.serviceIds.push(p.proxySpec.serviceURL)));var h=0,g=0;function _(){g===h&&l(i)}if(0===d.objectIds.length&&0===u.objectIds.length&&_(),d.objectIds.length>0&&(++h,t.getFederatedAttributesPromise(d).then(function(e){++g;for(let t of i.nodes)for(let i of e.results)if(t.physicalid===i.physicalID){let e=i.data.findIndex(e=>"ds6w:label"===e.name);-1!==e&&(t.Title=i.data[e].value),t.icon=i.type_icon_url,""===t.attributes.name&&(t.attributes.name=t.physicalid),""===t.attributes.derivedFromId&&(t.attributes.derivedFromId=t.physicalid),t.logicalid=t.physicalid,n.typeInfo[t.type]&&n.typeInfo[t.type].icon||(n.typeInfo[t.type]=n.typeInfo[t.type]||{},n.typeInfo[t.type].icon=i.type_icon_url,null==n.typeInfo[t.type].serviceId&&void 0!==i.sourceID&&null!==i.sourceID&&(n.typeInfo[t.type].serviceId=i.sourceID.split(":")[0]))}_()})),u.objectIds.length>0){++h;let e=[];for(let t=0;t<u.objectIds.length;++t){let n=new r(u.objectIds[t],u.objectTypes[t],u.securityContext,u.tenant,u.serviceIds[t]);e.push(n)}let t="CV_SERVICE",n="0",l=a.STRUCT_FETCH_OPTIONS;l.USE_MCS=!1,o.doExpandN(e,t,n,s,l).then(function(e){++g;for(let o of e)if(null!=o){var t=o.rootoccurrence,n=parseInt(o.occurrences[t].nodeid),r=o.nodes[n].physicalid;for(let e of i.nodes)if(e.physicalid===r){let t=o.nodes[n];e.icon=t.icon,e.name=t.attributes.name,e.revision=t.revision,e.attributes=t.attributes,e.logicalid=t.attributes.name;let i=t.attributes["PLMReference.V_DerivedFrom"];e.attributes.derivedFromId=null!=i&&""!==i?i:t.physicalid,"Products"===t.type&&(e.name=t.versionid,e.attributes.derivedFromId=t.attributes.name),"VPMReference"===t.type&&(e.versionid=t.versionid,e.logicalid=t.logicalid)}}_()})}}})})(e,p,u).then(function(e){c(e)},function(e){u.errout(e),d(e)})},function(e){u.errout(e),d(e)})})}}}),define("DS/CompareWidget2/viewComponents/MainToolbar",["UWA/Class","i18n!DS/CompareWidget2/assets/nls/CompareV2","DS/Tweakers/GeneratedToolbar"],function(e,t,n){"use strict";return e.extend({init:function(){},_getToolbarItems:function(e,n,i,r,o,a){var s=this;(this._privateEventMgr=n,this._publicEventMgr=i,this._isToolbarCreated&&this.mainToolbar&&this.destroyToolbar(),this._isToolbarCreated=!1,this.resultFrame=e,this.toolbarContainer=r,this.mainToolbarOptions=a,o)&&require(["text!"+o],function(e){var n=JSON.parse(e);n.entries.forEach(function(e){e.dataElements.tooltip&&(e.dataElements.tooltip=t[e.id]),"object"==typeof e.dataElements.value?(e.dataElements.value.argument={},e.dataElements.value.argument.objects=s):"string"==typeof e.dataElements.value&&"color"!==e.dataElements.typeRepresentation&&(e.dataElements.value=t[e.id]),a.forEach(function(t){var n=t.replace(/\s+/g,"");e.id.toLowerCase().indexOf(n.toLowerCase())>=0&&(e.dataElements.visibleFlag=!1)})}),s.buildToolbar(n),s.resultFrame.setToolbarCreated(),s.updateToolbar()})},buildToolbar:function(e){this._isToolbarCreated=!0,this.toolbarModel=n.prototype.createTreeDocument(e),this.mainToolbar=new n({items:this.toolbarModel}),this.mainToolbar.inject(this.toolbarContainer)},updateToolbar:function(){this.mainToolbar&&this.mainToolbar.updateNodeModel("mainToolbarDisplayViews",{disabled:this.resultFrame._layout.getViews().length<2||null!=this.resultFrame._layout.maximizedPanel})},destroyToolbar:function(){this.mainToolbar.destroy(),this.mainToolbar=null,this._isToolbarCreated=!1}})}),define("DS/CompareWidget2/widget/controls/splitContainer",["UWA/Controls/Abstract"],function(e){return e.extend({init:function(e){this.splitContainerMinWidth=e.splitContainerMinWidth,this._parent({}),this.options=e,this.elements.panels=e.panels,e.panels.length>1?this.panelWidth=e.panels.map(t=>"calc("+100/e.panels.length+"% - 3px)"):this.panelWidth="100%",this.buildUI()},buildUI:function(){if(this.elements.container=UWA.createElement("div"),this.elements.container.setStyles({display:"flex",position:"relative",width:this.splitContainerMinWidth>0?(this.splitContainerMinWidth*this.elements.panels.length).toString()+"px":"100%",height:"100%"}),this.elements.panels.length>1){this.elements.splitters=[];for(var e=0,t=this.elements.panels.length;e<t;e++)if(this.elements.panels[e].setStyles({width:this.panelWidth[e],position:"relative"}),this.elements.panels[e].inject(this.elements.container),e<t-1){var n=UWA.createElement("div",{styles:{width:"6px",cursor:"col-resize",position:"relative"}});this.elements.splitters.push(n),n.inject(this.elements.container)}}else this.elements.panels[0].inject(this.elements.container)}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,n,i,r,o,a,s){return e.extend({init:function(e,r){this._parent({}),this.attrComparePanel=e,this.onClickOkCallback=r,this.content=this._buildContent(),this.immersiveFrame=new t,this.immersiveFrame.inject(widget.body),this.dialog=new n({title:a.selectPropertiesToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,buttons:{Reset:new i({label:a.resetProperties,domId:"compare_attrchooser_Reset",onClick:this._onClickReset.bind(this),disabled:this.attrComparePanel.showDefaultPropsOnly(),emphasize:"secondary"}),Ok:new i({label:s.ok,domId:"compare_attrchooser_OK",onClick:this._onClickOk.bind(this),disabled:!0,emphasize:"primary"}),Cancel:new i({label:s.ko,domId:"compare_attrchooser_Cancel",onClick:this._onClickCancel.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._onDialogClose.bind(this))},_enableOK:function(e){this.dialog.buttons.Ok.disabled=!e},_enableReset:function(e){this.dialog.buttons.Reset.disabled=!e},_onDialogClose:function(){this.dialog.removeEventListener("close",this._onDialogClose.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_onClickOk:function(){this._save(function(){this.onClickOkCallback(),this.dialog.close()}.bind(this))},_onClickCancel:function(){this.dialog.close()},_onClickReset:function(){this._resetToDefaultAttrs()},_resetToDefaultAttrs:function(){var e=this.attrComparePanel.defaultAttrs,t=this.attrComparePanel._isInstance;this.allPropertyCheckboxes.forEach(function(n){var i=-1!=e.indexOf(n.value)||o.isTitleAttr(n,t);n.checkFlag=i}),this._updateAllCheck(),this._enableReset(!1),this._enableOK(!0)},onClickDisplayAll:function(e){let t=this.displayAllCheckbox.checkFlag;var n=this.attrComparePanel._isInstance;for(let e=0;e<this.allPropertyCheckboxes.length;e++)o.isTitleAttr(this.allPropertyCheckboxes[e],n)?this.allPropertyCheckboxes[e].checkFlag=!0:this.allPropertyCheckboxes[e].checkFlag=t;this._enableReset(!0),this._enableOK(!0)},_save:function(e){let t=[];if(this.dialog.buttons.Reset.disabled)t.push("__showDefault__");else if(!this.displayAllCheckbox.checkFlag)for(let e=0;e<this.allPropertyCheckboxes.length;e++){let n=this.allPropertyCheckboxes[e];if(0==n.checkFlag){let e=n.value;t.push(e)}}this.attrComparePanel.savePropsDisplayOptions(t),e()},_buildPropertyCheckboxes:function(e,t,n){var i=this;i.allPropertyCheckboxes=[];for(let s=0;s<t.length;s++){let l=t[s],c=new r({label:l.displayName,value:l.name}),u=-1==n.indexOf(l.name);c.checkFlag=u;var a=i.attrComparePanel._isInstance;o.isTitleAttr(l,a)?(c.disabled=!0,c.checkFlag=!0,c.addEventListener("buttonclick",function(){i._enableOK(!1),i._enableReset(!1),i._updateAllCheck()}.bind(i)),c.inject(e),i.allPropertyCheckboxes.unshift(c)):(c.addEventListener("buttonclick",function(){i._enableOK(!0),i._enableReset(!0),i._updateAllCheck()}.bind(i)),c.inject(e),i.allPropertyCheckboxes.push(c))}},_updateAllCheck:function(){for(var e=!0,t=this.allPropertyCheckboxes.length,n=0;n<t;n++){if(1!=this.allPropertyCheckboxes[n].checkFlag){e=!1;break}}this.displayAllCheckbox.checkFlag=e},_buildDisplayAllCheckbox:function(e){this.displayAllCheckbox=new r({label:a.displayAllProperties,value:"all",checkFlag:this.attrComparePanel.showAllProps()}),this.displayAllCheckbox.getContent().setStyle("border-bottom","1px solid lightgrey"),this.displayAllCheckbox.inject(e),this.displayAllCheckbox.addEventListener("buttonclick",this.onClickDisplayAll.bind(this))},_buildContent:function(){var e=this.attrComparePanel.compareResult,t=this.attrComparePanel._isInstance;for(let i=0;i<e.length;i++)if(o.isTitleAttr(e[i],t)){e.unshift(e[i]);var n=i+1;e.splice(n,1)}var i=e.findIndex(e=>"thumbnailimage"===e.name);if(-1!=i&&0!=i){e.unshift(e[i]);var r=i+1;e.splice(r,1)}let a=UWA.createElement("div",{id:"attr-choose-dialog"});return this._buildDisplayAllCheckbox(a),this._buildPropertyCheckboxes(a,e,this.attrComparePanel.getPropsToHide(e)),a}})}),define("DS/CompareWidget2/widget/resultFrame",["UWA/Controls/Abstract","DS/CustomizableLayout/Layout","DS/CompareWidget2/viewComponents/MainToolbar","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e,t,n){this._parent({}),this._privateEventMgr=e,this._publicEventMgr=t,this._runOptions=n,this._panelSpecSet={},this._swapIsEnabled=!0,this._isToolbarCreated=!1,this.elements.container=UWA.createElement("div",{class:"compare-result-frame",id:"compare-result-frame"}),this._layout=null,this.eventTokens={}},createLayoutPromise:function(e){var n={container:this.elements.container,tabOnlyDocking:"smartphone"===i.getDeviceType(),resultFrame:this};let o=new t(n),a=e+"_"+i.getDeviceType();return r.loadSettingsPromise([a]).then(()=>r.sync(o,a,"layout",null))},createLayout:function(e){var n={name:e,container:this.elements.container};return new t(n)},getLayout:function(){return this._layout},update:function(e,t){this.elements.container.innerHTML="",null!=this._runOptions&&"MERGE"===this._runOptions.app&&(this._useDatabaseSelected=!widget.getBool("useIndexForMerge")),this.MainToolbarModule||(this.MainToolbarModule=new n),this._isToolbarCreated||(this.toolbarContainer=UWA.createElement("div",{class:"compare-main-toolbar-container"}),this.toolbarContainer.inject(this.elements.container),this.MainToolbarModule._getToolbarItems(this,this._privateEventMgr,this._publicEventMgr,this.toolbarContainer,e,t),this._isToolbarCreated=!0),this.buildLayout(),this._isToolbarCreated&&this.MainToolbarModule&&this.MainToolbarModule.updateToolbar()},setToolbarCreated:function(){this._isToolbarCreated=!0},addPanel:function(e,t){(t&&void 0===this._layout||null===this._layout)&&(this._layout=this.createLayout("Layout-"+e.name)),this._panelSpecSet[e.name]=e,this._layout.addRow(e.panel),this.update()},setAllPanels:function(e,t,n,r,o,a){var s=this;s._panelSpecSet=r,this.createLayoutPromise(e+"_"+t).then(e=>{if(this._layout=e,"smartphone"===i.getDeviceType())s._layout.addRow(Object.keys(s._panelSpecSet).map(e=>s._panelSpecSet[e].panel));else if(null!=n)!function e(t,n){var i="ROW"===Object.keys(t)[0].toUpperCase()?"addRow":"addCol";(Object.values(t)[0].constructor!==Array?[Object.values(t)[0]]:Object.values(t)[0]).forEach(t=>{t.constructor===String?n[i](r[t].panel):t.constructor===Array?n[i](t.map(e=>r[e].panel)):t.constructor===Object&&e(t,n[i]())})}(n,s._layout);else{Object.keys(s._panelSpecSet).forEach(function(e){var t=s._panelSpecSet[e].panel;s._layout.addRow(t)})}s.update(o,a)})},updateToolbar:function(){this.mainToolbar.updateNodeModel("mainToolbarSelectViews",{disabled:this._layout.getViews().length<2})},buildLayout:function(){this._layout.buildUI()},applyDefaultLayout:function(){this._layout.applyDefaultLayout()},onPanelMaximized:function(){this.MainToolbarModule.updateToolbar()},onPanelRestoredFromMaximized:function(){this.MainToolbarModule.updateToolbar()},destroy:function(){for(var e in this.eventTokens)this._privateEventMgr.unsubscribe(this.eventTokens[e]),this.eventTokens[e]=null;this._privateEventMgr=null,this._publicEventMgr=null,this._isToolbarCreated=!1,this._panelSpecSet={},this.MainToolbarModule.destroyToolbar(),this._parent()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu",["UWA/Class","WebappsUtils/WebappsUtils","DS/i3DXCompassServices/i3DXCompassPubSub","DS/CompareCommon/launchTree","DS/CompareCommon/CompareStructOpenWith","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n,i,r,o){"use strict";var a=[];function s(e){if(e.widgetId===widget.id){for(var t=[],i=0;i<e.data.items.length;i++)t.push(e.data.items[i].path);var r=null;for(i=0;null==r&&i<a.length;)r=a[i].buildLaunchJSON(t),i++;if(null==r)return void console.error("Cannot find selection in either tree (this should not happen)");var o={appId:e.appId,widgetId:e.widgetId,fileName:"-file",fileContent:r};n.publish("launchApp",o)}}return e.extend({init:function(e){this._structComparePanel=e.structComparePanel,n.subscribe("setTypesCallback",s)},getOpenWithMenuPromise:function(e,t){var n=this;return new Promise(function(r){var o=e.cellInfos.nodeModel.getRoot(),s=!1;for(const e of a)o.options.data.getPath()===e._pathWithStrArray[0]&&(s=!0);if(!s){for(var l=(o=e.cellInfos.nodeModel._getTrueRoot()).getAllDescendants().map(function(e){return e.options.data.getPath()}),c=new i([]),u=0;u<l.length;++u){var d=l[u].split("/");c._pathWithArray.push(d),c._pathWithStrArray.push(d.join(","))}a.push(c)}require(["DS/PADUtils/PADTypesMgt"],function(i){var o=t.map(function(e){return e.options.data._objIDSpecREF.getObjType()});i.retrieveHierarchy(o,function(i){for(var a=[],s=0;s<o.length;++s)a[s]=o[s],null!=i&&void 0!==i[o[s]]&&null!==i[o[s]]&&(a[s]=i[o[s]]);for(var l=t.map(function(e){return e.options.data.getPath()}),c=[],u=0;u<t.length;++u){var d=l[u].split("/").map(function(e){return{resourceid:e}}),p=t[u].options.data._objIDSpecREF;c.push({contextId:p.getSecurityContext(),envId:p.getTenant(),objectId:p.getPhysID(),objectTaxonomies:a[u],objectType:p.getObjType(),path:d,serviceId:p.getServiceName()})}var h={protocol:"3DXContent",version:"1.1",source:"ENOCOMP_AP",widgetId:widget.id,data:{items:c}};n._getOpenWithMenuPromise(e,h).then(function(e){r(e)})})})})},_getOpenWithMenuPromise:function(e,n){return new Promise(function(i){var a=[],s=(e.cellInfos.nodeModel.options.data._objIDSpecREF,function(e){for(var t=e.cellInfos.nodeModel;0!==t._nodeDepth;)t=t._parentNode;return t.options.data._objIDSpecREF}(e)),l="3DShape"===s.getObjType(),c="3dportfolio"===s.getObjType();if(l||c||widget.isWebInWin)i(a);else{var u=new r;u.set3DXContent(n,!0),UWA.is(u.retrieveCompatibleApps,"function")?u.retrieveCompatibleApps(function(e){var n=[];if(e.forEach(function(e){e.text.contains("CATIA V5")&&n.push({type:"PushItem",title:e.text,fonticon:void 0!==e.fonticon&&null!==e.fonticon&&e.fonticon.length>0?{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.fonticon,family:WUXManagedFontIcons.Font3DS}:void 0,icon:void 0!==e.icon&&null!==e.icon&&e.icon.length>0?e.icon:"",action:{callback:function(){e.handler()}}})}),n.length>0)var r={type:"PushItem",icon:"url("+t.getWebappsAssetUrl("ENXNav","icons/32/I_OpenWith.png")+")",title:o.OpenWith,submenu:n};i(r)}):i(a)}})},clearLaunchTreeArray:function(){a=[]}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu",["UWA/Class","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t){"use strict";return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},getExpandCollapseContextMenu:function(e,t){var n=this.getExpandCollapseMenu(t);return function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.nodeModel||null===e.cellInfos.nodeModel||void 0===e.cellInfos.nodeModel._options||null===e.cellInfos.nodeModel._options||void 0===e.cellInfos.nodeModel._options.children||null===e.cellInfos.nodeModel._options.children}(e)?null:UWA.extend({...n.find(e=>e.id===t)},{type:"PushItem",submenu:n})},getExpandCollapseMenu:function(){var e=this;return[{id:"expandAll",icon:"flow-tree-expand-down",title:t.ExpandAll},{id:"expandNLevels",icon:"flow-tree-expand-down-cog",title:t.ExpandNLevels},{id:"collapseAll",icon:"flow-tree-expand-up",title:t.CollapseAll}].map(t=>({type:"CheckItem",id:t.id,icon:t.icon,title:t.title,state:e._structComparePanel.getActiveExpandMenuId()===t.id?"selected":"",action:{callback:()=>e._structComparePanel.handleToolbarCommands({event:t.id,data:{icon:t.icon}})}}))}})}),define("DS/CompareWidget2/plugins/MERGE/MergeConstants",[],function(){"use strict";return{MergeAction:{Revise:"revise",Reuse:"reuse",Exclude:"exclude",InsertNew:"insertnew",ReuseReference:"reuse_reference"}}}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t){var n=function(n,i){var r;this._dbObj_REF=null,this._dbObj_INST=null,this._childArray=[],this._parent=null,this._dbContext={},r=n,ret=!0,null!=r&&r.constructor!=t&&(e.errout("[INVALID] refInst_node receives unexpected type"),ret=!1),ret&&(this._dbObj_REF=n),this._dbObj_INST=i,this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node"};return n.prototype.visit_subtreeAndFN=function(e){var t=e(this);if(null!=this._childArray)for(var n=this._childArray.length,i=0;i<n&&1==t;i++){var r=this._childArray[i];null!=r&&(t=r.visit_subtreeAndFN(e))}return t},n.prototype.set_dbObj_INST=function(e){this._dbObj_INST=e},n.prototype.setDBContext=function(e){this._dbContext=e},n.prototype.getDBContext=function(){return this._dbContext},n.prototype.setParent=function(t){null==t?e.errout("refInst_node's parent cannot be set to null... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's parent can only be another refInst_node... ignored"):null!=this._parent&&this._parent!=t?e.errout("Changing parent node of a refInst_node (unexpectedly)... ignored"):this._parent=t},n.prototype.getParent=function(){return this._parent},n.prototype.addChild=function(t){null==t?e.errout("refInst_node cannot have a null child... ignored"):t.constructor!=this.constructor?e.errout("refInst_node's child must be another refInst_node... ignoring"):this._childArray.push(t)},n.prototype.rmChild=function(e){var t=[];this._childArray.forEach(function(n){n.getAttr("INST.physicalid")!=e&&t.push(n)}),this._childArray=t},n.prototype.getChildArray=function(){return this._childArray},n.prototype.sortChildArray=function(){var e=this._childArray.sort(function(e,t){return e.getAttr("INST.ro.plminstance.v_treeorder")-t.getAttr("INST.ro.plminstance.v_treeorder")});this._childArray=e},n.prototype.findChid=function(e,t){for(var n=null,i=this._childArray.length,r=0;r<i;r++){var o=this._childArray[r];if(e==o.getAttr("INST.physicalid")&&t==o.getAttr("REF.physicalid")){n=o;break}}return n},n.prototype.isRoot=function(){return null==this.getParent()},n.prototype.isLeaf=function(){return 0==this._childArray.length},n.prototype.get_dbObj_REF=function(){return this._dbObj_REF},n.prototype.get_dbObj_INST=function(){return this._dbObj_INST},n.prototype.getAttr=function(t){var n=null,i=t.indexOf("."),r=t.substring(0,i),o=t.substring(i+1);return"REF"==r?n=this._dbObj_REF.getAttr(o):"INST"==r?null!=this._dbObj_INST&&(n=this._dbObj_INST.getAttr(o)):e.errout("unexpected qualifier in name: "+r),n},n.prototype.setAttr=function(t,n){var i=null,r=t.indexOf("."),o=t.substring(0,r),a=t.substring(r+1);return"REF"==o?i=this._dbObj_REF.setAttr(a,n):"INST"==o?null!=this._dbObj_INST&&(i=this._dbObj_INST.getAttr(a,n)):e.errout("unexpected qualifier in name: "+o),i},n}),define("DS/CompareWidget2/viewComponents/ContextMenuBase",["UWA/Class"],function(e){"use strict";return e.extend({createContextMenu:function(){return[]}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand","DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree","DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,n,i,r,o,a,s,l,c){return{doExpand:function(e,u,d,p,h,g){var _=this;return new Promise(function(f,S){var m=null,E=null;if("FILE_EXPAND"==u)m=i,E=a;else if("CV_DIRECT"==u){var C=e.getFilterSpec();null!=C&&null!=C.CVQueryV2&&"DELLmiGeneralSystemReference"!=e.getObjType()?(m=n,E=l):(m=t,E=s)}else if("CV_PROGRESSIVE"==u)m=n,E=l;else if("CV_SERVICE"==u||"DB_SERVICE"==u)m=r,E=a;else if("LC_IDX_SERVICE"==u||"LC_AUTH_SERVICE"==u)m=o,E=s;else{var v="UNEXPECTED DATA SOURCE: "+u;h.errout(v),S(v)}m.doExpand(e,u,p,h,g).then(function(t){var n=t,i=E.convert(e,n,h,g);i.setDataSource(n._dataSource),i.sortChildren(),f(i)},function(t){if("CV_SERVICE"!=u&&"CV_DIRECT"!=u&&"LC_IDX_SERVICE"!=u||1!=d)h.errout("Failed to expand using "+u+":: "+t),S(t);else{h.errout("Initial expand via "+u+" failed; trying again with db service"),h.showAlertBox("DB_FETCH_FALLBACK",c,"warning");var n="DB_SERVICE";"LC_IDX_SERVICE"==u&&(n="LC_AUTH_SERVICE"),_.doExpand(e,n,!1,p,h,g).then(function(e){f(e)},function(e){h.errout("Failed to expand using DB service: "+e),S(e)})}})})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog",["UWA/Class","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/UIKIT/assets/nls/UIKIT","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,n,i,r,o,a,s){return e.extend({init:function(e){this._parent({}),this.OKfn=e.OKfn,this.statusVisibility={},Object.keys(e.statuses).forEach(t=>"IDENTICAL"!==t&&(this.statusVisibility[t]=e.statuses[t].visibleFlag)),this.content=this._buildContent(e.statuses),this.immersiveFrame=new t,this.immersiveFrame.inject(widget.body),this.dialog=new n({title:a.chooseStatusToDisplay,content:this.content,immersiveFrame:this.immersiveFrame,resizableFlag:!0,visibleFlag:!0,modalFlag:!0,width:230,buttons:{Ok:new i({label:s.ok,onClick:this._OKfn.bind(this),disabled:!1,emphasize:"primary"}),Cancel:new i({label:s.ko,onClick:this._close.bind(this),disabled:!1,emphasize:"secondary"})}}),this.dialog.addEventListener("close",this._close.bind(this))},_buildContent:function(e){function t(e){let t=e.checkFlag;e.elements.checkSign.setStyles({"background-color":!0===t?e.color:"","border-color":!0===t?e.color:""})}let n=new o({type:"checkbox"});return Object.keys(this.statusVisibility).forEach(i=>{let o=e[i],a=new r({type:"switch",label:o.label,value:o.name,checkFlag:o.visibleFlag});a.color=o.color,a.id=i,t(a),a.addEventListener("buttonclick",()=>{t(a),this.statusVisibility[a.id]=a.checkFlag}),n.addChild(a)}),n},_close:function(){this.dialog.removeEventListener("close",this._close.bind(this)),this.dialog.destroy(),this.immersiveFrame.destroy()},_OKfn:function(){this._close(),setTimeout(()=>{this.OKfn(this.statusVisibility)},20)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/nodeOccRel2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,i){var r=function(e){this._objIDSpec=e,this._dbObjREFByNodeID={},this._occurByID={},this._occurRelArray=[],this._rootOccurID=0,this._refInstNodeByOccurID={}};return r.prototype.addNodes=function(e,t,n,i){var r=this;e.forEach(function(e){var o=t;void 0!==e.serviceId&&null!==e.serviceId&&""!==e.serviceId&&(o=e.serviceId),void 0!==e.proxySpec&&null!==e.proxySpec&&""!==e.proxySpec&&void 0!==e.proxySpec.serviceURL&&null!==e.proxySpec.serviceURL&&""!==e.proxySpec.serviceURL&&(o=e.proxySpec.serviceURL);var a=r.node2dbObjREF(e,o,n,i);r._dbObjREFByNodeID[e.nodeid]=a})},r.prototype.setRootOccurID=function(e){this._rootOccurID=e},r.prototype.node2dbObjREF=function(e,t,n,r){var o=function(e,i,o){if("icon"==i){var a={smallURL:r.makeServiceURL(t,n,o,null),largeURL:""};e.setAttr("typeIcons",a)}else if("cgrurl"==i&&o){var s=o.indexOf("?"),l=o.substr(0,s),c=o.substr(s+1),u=r.makeServiceURL(t,n,l,c);e.setAttr("thumbnail_3d",u),e.addAttr("ds6w:globaltype","ds6w:Document")}else{var d={"PLMEntity.V_Name":"ds6w:label",revision:"ds6wg:revision",type:"ds6w:type","PLMReference.V_DerivedFrom":"dfr"}[i];null==d&&(d=i),e.setAttr(d,o)}},a=new i;return Object.keys(e).forEach(function(t){if("attributes"==t){Object.keys(e.attributes).forEach(function(t){var n=e.attributes[t];o(a,t,n)})}else{var n=e[t];o(a,t,n)}}),null==a.getAttr("ds6w:globaltype")&&a.addAttr("ds6w:globaltype","ds6w:Part"),a},r.prototype.addOccurs=function(e,t){var n=this;e.forEach(function(e){var t={};Object.keys(e).forEach(function(n){var i=e[n];!function(e,t,n){if("xform"==t){var i=JSON.parse(JSON.stringify(n));i.splice(15,1),i.splice(11,1),i.splice(7,1),i.splice(3,1);for(var r=i.length,o=0;o<r;o++){var a=i[o];Number.isInteger(a)&&(i[o]=a.toFixed(1))}e.matrixtxt=attrVal2use=i.join()}else{var s={"logicalid[connection]":"logicalid"}[t];null==s&&(s=t),e[s]=n}}(t,n,i)}),n._occurByID[e.occurrenceid]=t})},r.prototype.addOccurRels=function(e){this._occurRelArray=e},r.prototype.buildTree=function(){var e=this,r=e._occurByID[e._rootOccurID].nodeid,o=e._dbObjREFByNodeID[r],a=new n(o,null);e._refInstNodeByOccurID[e._rootOccurID]=a,this._occurRelArray.forEach(function(t){t.parent;var r=t.child,o=e._occurByID[r],a=new i,s=t.relationship;a.addAttr("ds6w:type",s),Object.keys(o).forEach(function(e){var t=o[e];a.addAttr(e,t)}),a.addAttr("physicalid",t.physicalid),a.addAttr("ds6w:globaltype","Instance"),a.addAttr("ro.plminstance.v_treeorder",t.treeOrder);var l=o.nodeid,c=e._dbObjREFByNodeID[l],u=new n(c,a);e._refInstNodeByOccurID[r]=u});var s=new t(e._objIDSpec),l=e._refInstNodeByOccurID[e._rootOccurID];return s.setRoot(l),this._occurRelArray.forEach(function(t){var n=t.parent,i=e._refInstNodeByOccurID[n],r=t.child,o=e._refInstNodeByOccurID[r];i.addChild(o),o.setParent(i)}),s},e.singleton({jsClass:"NODE_OCCUR_REL2REFINST_TREE",convert:function(e,t,n,i){var o=new r(e);o.addNodes(t.nodes,e.getServiceName(),e.getTenant(),n),o.addOccurs(t.occurrences,n),o.addOccurRels(t.occurrencerelationships),o.setRootOccurID(t.rootoccurrence);var a=o.buildTree();return o=null,a}})}),define("DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem",["UWA/Class","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,n,i){var r=e.extend({init:function(e){this._parent({}),this.rels=e,this.idObjMap=this.buildIdObjMap(e),this.formated=this.format(e)},addTo:function(e){for(var t=this.newAsm(e),n=Object.keys(this.formated),i=0;i<n.length;i++)this.addSourceToAsm(n[i],t)},addRootSourceToAttributes:function(e){for(var t=this.rels.New.Objects,n=0;n<t.length;n++){var i=t[n],r=e[i.id];null!=r&&(i.rootSource=r.rootSource)}},getLinkedObjectIds:function(){for(var e=[],t=(this.rels.New.Objects,this.rels.New.Links),n=0;n<t.length;n++){var i=t[n].target;-1==e.indexOf(i)&&e.push(i)}return e},format:function(e){for(var t={},n=0;n<e.New.Links.length;n++){var i=e.New.Links[n];null==t[i.source]&&(t[i.source]={});var r=t[i.source],o=i.type+"."+i.name;null==r[o]&&(r[o]=[]),r[o].push(i.target)}return t},buildIdObjMap:function(e){for(var t={},n=e.New.Objects,i=0;i<n.length;i++){var r=n[i];t[r.id]=r}return t},addSourceToAsm:function(e,t){for(var n=t.getOccs(e),i=0;i<n.length;i++)this.addSourceToOcc(e,n[i],t)},addSourceToOcc:function(e,t,n){for(var i=this.formated[e],r=Object.keys(i),o=0;o<r.length;o++){var a=r[o];this.addCategoryToSourceOcc(i,a,t,n)}},addCategoryToSourceOcc:function(e,t,n,i){var o=r.relationLabels[t];if(null!=o)for(var a=this.addToOcc(t,{Title:o.label,icon:o.icon,physicalid:t,attributes:{revision:" "}},n,i),s=e[t],l=0;l<s.length;l++){var c=s[l],u=this.idObjMap[c],d={Title:u["ds6w:label"],icon:u.icon_url,physicalid:u.id,type:u["ds6w:type"],attributes:{revision:u.revision,name:u["ds6w:identifier"],"revision-physicalid":u.id,"PLMReference.V_DerivedFrom":u.rootSource}};this.addToOcc(c,d,a,i)}},addToOcc:function(e,t,n,i){var r=i.addNode(e,t),o=i.addOcc(r.nodeid);return i.addRel(n.occurrenceid,o.occurrenceid),o},newAsm:function(e){return{asm:e,getOccs:function(e){if(this.pidOccsMap=this.pidOccsMap||{},void 0===this.pidOccsMap[e]){this.pidOccsMap[e]=[];for(var t=0;t<this.asm.occurrences.length;t++){var n=this.asm.occurrences[t];e==this.asm.nodes[n.nodeid].physicalid&&this.pidOccsMap[e].push(n)}}return this.pidOccsMap[e]},getChildOcc:function(e,t){for(var n=0;n<this.asm.occurrencerelationships.length;n++){var i=this.asm.occurrencerelationships[n];if(i.parent==e){var r=this.asm.occurrences[i.child];if(this.asm.nodes[r.nodeNdx].physicalid==t)return r}}return null},getNode:function(e){if(this.pidNodeMap=this.pidNodeMap||{},void 0===this.pidNodeMap[e]){for(var t=0;t<this.asm.nodes.length;t++){var n=this.asm.nodes[t];n.physicalid==e&&(this.pidNodeMap[e]=n)}void 0===this.pidNodeMap[e]&&(this.pidNodeMap[e]=null)}return this.pidNodeMap[e]},addNode:function(e,t){var n=this.getNode(e);return null!=n?n:((n=t).nodeid=this.asm.nodes.length,this.asm.nodes.push(n),this.pidNodeMap[e]=n,n)},addOcc:function(e){var t={occurrenceid:this.asm.occurrences.length,nodeid:e,xform:["n/a"]};return this.asm.occurrences.push(t),t},addRel:function(e,t){var n={parent:e,child:t};this.asm.occurrencerelationships.push(n)}}}});function o(e,i,r,o){var a=widget.getValue("x3dPlatformId"),s=t.get3DSpaceWSUrl(a,e);n.authenticatedRequest(s,{method:"POST",type:"json",timeout:12e4,data:JSON.stringify(i),headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:r,onFailure:o})}return r.docRels=["v6_specdoc_to","v6_annexdoc_to"],r.otherRels=["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"],r.relationLabels={"SpaceAssignment_to.472":{label:i.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:i.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:i.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:i.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:i.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:i.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:i.specificationDocuments,icon:""}},r.get=function(e,t,n,i){null!=e&&t.length>0?function(e,t,n,i){var a={relations:t,countmanagement:!1,debug:!1,trueREST:!0,widgetId:widget.id,timeout:"6000",ids:e};"compareWidgetOdtId"==widget.id&&(a=null),o("/resources/enorelnav/navigate/getecosystem",a,function(e){var t=new r(e);n(t)}.bind(this),i)}(e,t,function(e){var t=e.getLinkedObjectIds();t.length>0?function(e,t,n){for(var i=[],r=0;r<e.length;r++)i.push({id:e[r]});o("/resources/compare/index/fetchRootSource",{data:i},t,n)}(t,function(t){e.addRootSourceToAttributes(t),n(e)},i):n(e)},i):n(null)},r}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/ApplicationFrame/CommandsManager"],function(e,t,n){var i=function(e){this._plugSvcs=e,this._onPostAddCSOManagerToken=null,this._onPostRemoveCSOManagerToken=null,this._updateState="NONE",this.hookupCrossSelectionCallbacks()};function r(){const e=n.getCommand("PAD3DViewerNavigateOnSelectionHdr",null);return e&&Array.isArray(e._selection)&&e._selection.length}return i.prototype.destroy=function(){null!=me._onPostAddCSOManagerToken&&(e.unsubscribe(me._onPostAddCSOManagerToken),me._onPostAddCSOManagerToken=null),null!=me._onPostRemoveCSOManagerToken&&(e.unsubscribe(me._onPostRemoveCSOManagerToken),me._onPostRemoveCSOManagerToken=null)},i.prototype.getUpdateState=function(){return this._updateState},i.prototype.setUpdateState=function(e){this._updateState=e},i.prototype.hookupCrossSelectionCallbacks=function(){var t=this;null!=t._onPostAddCSOManagerToken&&e.unsubscribe(t._onPostAddCSOManagerToken),t._onPostAddCSOManagerToken=e.onPostAdd(function(i){if("FOCUSON"!==t.getUpdateState()&&r()&&t.setUpdateState("FOCUSON"),"NONE"===t.getUpdateState()||"FOCUSON"===t.getUpdateState()){"NONE"==t.getUpdateState()&&t.setUpdateState("INTERNAL");let r=e.get();if(r.length>2){const e=n.getCommand("LevelSelectorHdr",null);null!=e&&e.endExecute()}t._onViewerSelection(i,r,t._plugSvcs)}}),null!=t._onPostRemoveCSOManagerToken&&e.unsubscribe(t._onPostRemoveCSOManagerToken),t._onPostRemoveCSOManagerToken=e.onPostRemove(function(n){if("EXTERNAL"!=t.getUpdateState()){let i=e.get().splice();t._onViewerSelection(n,i,t._plugSvcs)}})},i.prototype.notifyClearHighlights=function(){e.empty(),t.empty()},i.prototype.notifyNewHighlights=function(n,i){try{var o=this;if("FOCUSON"!==o.getUpdateState()||r()||o.setUpdateState("INTERNAL"),"NONE"==o.getUpdateState()){o.setUpdateState("EXTERNAL");e.get();e.empty(),t.empty(),n.length>0&&!1!==i&&(e.add(n),t.add(n)),o.setUpdateState("NONE")}else"FOCUSON"==o.getUpdateState()?(t.empty(),n.length>0&&t.add(n)):o.setUpdateState("NONE")}catch(e){o._plugSvcs.errout("EXCEPTION working with CSO/HSO managers: "+e)}},i.prototype._onViewerSelection=function(e,t){var n=t.length;if(n>0){this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection "+n+" selections");var i=function(e){var t=[];return e.forEach(function(e){for(var n="",i=e.pathElement.externalPath,r=1;r<i.length;r++){var o=i[r].modelIdentification;if(null!=o){var a=o.lastIndexOf(".");n+="/"+o.substr(0,a)}}t.push(n)}),t}(t);this._plugSvcs.postEvent("3DVIEW_NODES_SELECTED_EVENT",{nodePathArray:i})}else this._plugSvcs.dbgout("XSELECT","structComparePanel._onViewerSelection 0 selections (clear)"),this._plugSvcs.postEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",{})},i}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList",[],function(){var e=function(e,t){this._nodePair_byIndexArray=[],this._riNodeArray_base=e,this._riNodeArray_comp=t,this.indexMax_base=e.length,this.indexMax_comp=t.length};return e.prototype.destroy=function(){this._nodePairIndexArray=null,this._riNodeArray_base=null,this._riNodeArray_comp=null},e.prototype.add=function(e,t,n,i,r,o){var a=this,s={index_base:e,index_comp:t,relIndex:n,relName:i,adjIndex:r,adjFlagArray:o};null==a._nodePair_byIndexArray[n]&&(a._nodePair_byIndexArray[n]=[]),null==a._nodePair_byIndexArray[n][r]&&(a._nodePair_byIndexArray[n][r]=[]),a._nodePair_byIndexArray[n][r].push(s)},e.prototype.getResult=function(){var e=this,t=new Array(e.indexMax_base),n=new Array(e.indexMax_comp),i=[];e._nodePair_byIndexArray.forEach(function(r,o){r.forEach(function(r,o){r.forEach(function(r){var a=r.index_base,s=r.index_comp;if(null==t[a]&&null==n[s]){t[a]="X",n[s]="X";var l={riNode_base:e._riNodeArray_base[a],riNode_comp:e._riNodeArray_comp[s],relName:r.relName,adjustment:o,adjFlagArray:r.adjFlagArray};i.push(l)}})})});for(var r=[],o=t.length,a=0;a<o;a++)null==t[a]&&r.push(e._riNodeArray_base[a]);for(var s=[],l=n.length,c=0;c<l;c++)null==n[c]&&s.push(e._riNodeArray_comp[c]);return{riMatchedNodePairArray:i,riUnmatchedNodeArray_base:r,riUnmatchedNodeArray_comp:s}},e}),define("DS/CompareWidget2/userSettings/SettingsBase",["i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e){"use strict";return{namespace:"",compareSettings:{},viewSettings:{PROP_VIEW:{showOnlyDifferences:{value:!1},attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option"},default_attributes:{value:["label","owner","current","modified","type","originated","revision"]},attributes_always_shown:{value:["label"]},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown"}},STRUCT_VIEW:{display_mode:{value:"tree"},statuses_to_hide:{value:[],V1Preference:[{openness_revisions:{oldValue:!0,newValue:"REVISION"}},{openness_duplicates:{oldValue:!0,newValue:"DUPE"}}]},statuses_unchecked:{value:[]},multi_statuses_to_hide_and:{value:!1,widgetSetting:{type:"boolean",label:e.uncheckBothPrimaryAndSecondary,defaultValue:!1}}}}}}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor",["DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e){function t(t,n,i,r,o){var a=!1,s=!1,l=null;return null==r?s=!0:null!=(l=function(e,t,n){var i=function(e,t,n){var i=[];return e.visit_riTreeAndFN(function(e){if(e.getAttr("INST.physicalid")==n){var r=e.getParent();(null!=r?r.getAttr("REF.physicalid"):null)==t&&i.push(r)}}),i}(e,t,n);return i.forEach(function(e){e.rmChild(n)}),i}(t,i,r))&&(s=!0),1==s&&(a=null==o||function(t,n,i,r,o){var a=!1;null==o&&(o=function(e,t){var n=[];return e.visit_riTreeAndFN(function(e){e.getAttr("REF.physicalid")==t&&n.push(e)}),n}(t,i));var s=null;return n.forEach(function(e){e.getObjIDSpec().getPhysID()!=r||(s=e)}),null!=s&&(o.forEach(function(t){var n=new e;n.setAttr("did",null),n.setAttr("ds6w:type","VPMInstance"),n.setAttr("logicalid","00000000000000000000000000000001"),n.setAttr("matrixtxt","1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),n.setAttr("physicalid","00000000000000000000000000000001");var i=s.getRoot();i.set_dbObj_INST(n),t.addChild(i),i.setParent(t)}),a=!0),a}(t,n,i,o,l)),a&&s}return{applyCommands:function(e,t,n,i,r){var o=this,a=!1;if(1==e.get_editsHaveBeenApplied())o._plugSvcs.errout("Edit commands already applied to assembly... ignoring...");else{var s=!1;t.forEach(function(t){if(0==o.applyCommand(e,t,n,i)){s=!0;var a="refInstTreeEditor: Command '"+JSON.stringify(t)+"' failed :: ";if(1==r)return void o._plugSvcs.errout(a+" edits to structure aborted at point of failure.");o._plugSvcs.errout(a+" edits to structure continue, skipping this command...")}}),a=!s}return a},applyCommand:function(e,n,i,r){var o=!1,a=null;if(null==n)a="refInstTreeEditor given null command; skipping";else{var s=n.parent,l=null,c=null;switch(n.op){case"INSERT":null==(l=n.inNode)&&(a="Op is INSERT, but inNode is missing");break;case"REMOVE":null==(c=n.rmNode)&&(a="Op is REMOVE, but rmNode is missing");break;case"REPLACE":null==(l=n.inNode)&&(a="Op is REPLACE, but inNode is missing"),null==(c=n.rmNode)&&(a="Op is REPLACE, but rmNode is missing");break;default:a="UNSUPPORTED command in edits list: '"+n.op+"', skipping..."}}return null!=a?me._plugSvcs.errout(a):o=t(e,i,s,c,l),o}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/fileExpand",[],function(){return{jsName:"FILE_EXPAND",doExpand:function(e,t,n,i,r){return new Promise(function(t,n){var r=e._moduleName;i.dbgout("  ... loading file: "+r);try{require([r],function(e){t(e)},function(e){n(e)})}catch(e){i.errout("Exception trying to load data file:: "+modulePath+"::"+e)}})}}}),define("DS/CompareWidget2/plugins/MERGE/MaturityUtils",[],function(){"use strict";return{createCSSClass:function(e,t,n){if(null===document.getElementById(e)){var i=document.createElement("style");i.type="text/css",i.id=e;let r=n||"."+e;i.innerHTML=r+t,document.getElementsByTagName("head")[0].appendChild(i)}},cleanStatusForCSS:function(e){return e.replace(/(\.| )/g,"-")},getMaturityClass:function(e,t){return"lc-status-"+this.cleanStatusForCSS(e)+(t?"-withClass":"")},addCSSMaturityClasses:function(e,t){var n=this;void 0!==e&&e.forEach(function(e){let i=e.policyName;e.states.forEach(function(e){let r=e.activeColor,o="{color:"+("#FFFFFF"===r?"#000000":"#FFFFFF")+" ; background-color:"+r+";}",a=n.cleanStatusForCSS(e.stateSysName),s="lc-status-"+n.cleanStatusForCSS(i)+"-"+a+(t?"-withClass":""),l="."+s+(t?" ."+t:"");n.createCSSClass(s,o,l)})})}}}),define("DS/CompareWidget2/widget/controls/TreesContainer",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({name:"treesContainer",init:function(e){this._panels=[],this._parent(e),this._buildLayout()},addPanel:function(e){e.inject(this.getContent()),this._panels.push(e),e.addEvent("collapseChange",this._updateLayout.bind(this))},setPanelCaption:function(e,t){this._panels.find(t=>t.options.contentId===e).setCaption(t)},_updateLayout:function(){var e=this._panels.length,t=this._panels.reduce(function(e,t){return e+(t.isCollapsed()?0:1)},0);2===e&&t>0&&this._panels.forEach(function(e){e.isCollapseable()&&2===t&&e.setSize50pct()}),3!==t&&4!==t||this._panels.forEach(function(e){e.isCollapseable()&&(3===t?e.setSize50pct():e.setSize33pct())})},_buildLayout:function(){var e={class:this.getClassNames("-root")};this.elements.container=new UWA.Element("div",UWA.merge(this.options,e)),this._render()},_render:function(){}})}),define("DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV",[],function(){var e={encoding:"UTF-8",kind:"InstRef",version:"1.1"};function t(e,t,n,i){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":n,boundingbox:i}}function n(n,i,r){var o,a=null,s=[],l=0,c=0,u=!1;n.visit_riTreeAndFN(function(e){var n=null,o=e.isLeaf();let d=e.isRoot();var p=e.get_dbObj_REF(),h=p.getAttr("physicalid")+"."+i,g=p.getAttr("ds6w:type"),_=p.getAttr("ds6w:globaltype"),f=p.getAttr("boundingbox"),S=p.getAttr("ds6wg:XCADOrientationExt.V_WorldOrientation");if(null!=S&&""!==S||(S=p.getAttr("vWorldOrientation")),null!=S&&""!==S||(S="0"),o){var m=p.getAttr("thumbnail_3d");if(null==m&&(0==u&&(u=!0,r.dbgout("Thumbnail_3d visuals not yet available; using CGRs")),m=p.getAttr("cgr")),null!=m)c++,n=function(e,n,i,r,o){var a=t(e,n,i,r);return a.thumbnail_3d=o,a}(h,g,_,f,m);else{if(!d)return r.dbgout("NO VISUAL // excluded from viewerJSON ID:: "+h+"("+p.getAttr("ds6w:label")+")"),!0;(n=t(h,g,_,f))["ds6wg:XCADOrientationExt.V_WorldOrientation"]=S}}else n=t(h,g,_,f),d&&(n["ds6wg:XCADOrientationExt.V_WorldOrientation"]=S);if(l++,s.push(n),1==d)null!=a?r.errout("ERROR - TREE has more than ONE root"):a=n;else{var E=e.get_dbObj_INST(),C=E.getAttr("physicalid")+"."+i,v=E.getAttr("ds6w:type"),T=(E.getAttr("ds6w:globalType"),function(e,t,n,i,r,o){return{resourceid:e,"ds6w:type":t,"ds6w:globaltype":n,matrixtxt:i,from:r,to:o}}(C,v,"ds6w:Instance",E.getAttr("matrixtxt"),e.getParent().get_dbObj_REF().getAttr("physicalid")+"."+i,h));s.push(T)}return!0}),o=s.length;var d=function(t,n,i,r){var o=JSON.parse(JSON.stringify(t));return{infos:e,results:[o,{synthesis:{name:"ProgressiveExpand_FlatSynthesis",value:n}},{synthesis:{name:"ProgressiveExpand_OccSynthesis",value:i}},{synthesis:{name:"ProgressiveExpand_LeafSynthesis",value:r}}]}}(a,o,l,c);a.resourceid;return{rootStats:d,infos:e,results:s}}return{refInstTree2ViewerJSON:function(e,t){var i=[];return e.forEach(function(e,r){var o=n(e,r,t);if(null==o)throw new Error("Failure creating view3DJSON");var a=e.getRoot().getAttr("REF.physicalid")+"."+r;i.push({rootID:a,structure:o})}),i}}}),define("DS/CompareWidget2/plugins/DATA/attrValObj",["DS/WidgetServices/WidgetServices"],function(e){function t(e){var t=void 0!==e.selectable?e.selectable:e.name;return"timestamp"===e.type||"modified"===t||"originated"===t||-1!==t.indexOf("ds6w:created")||-1!==t.indexOf("ds6w:modified")}function n(t){var n=e.formatDate(t,!0);if(0==n.localeCompare(t)){var i=new Date(t);n=e.formatDate(i,!0)}return n}var i=function(e,t,n,i,r){this.name=e,this.nls=t,this.value=n,this.type=i,this.UIPosition=r,this._reqMod="DS/CompareWidget2/plugins/DATA/attrValObj"};return i.prototype.getFormattedValue=function(){var e=this,i="";if(null!=e.value){if(e.value.constructor==Array)if(e.value.length>1)for(var r=0;r<e.value.length;++r){i+=t(e)?n(e.value[r]):e.value[r],r!==e.value.length-1&&(i+=", ")}else i=t(e)?n(e.value[0]):e.value[0];else i=t(e)?n(e.value):e.value;var o=e.dimension;null!=o&&(i+=" "+o)}return i},i}),define("DS/CompareWidget2/support/cw2Utils",["DS/WAFData/WAFData","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/CompareCommon/assets/nls/CompareInput"],function(e,t,n){var i=!0,r={},o=["     ","    ","   ","  "," ",""];return{jsClass:"CW2UTILS",createRandomString:function(e,t,n){if(null==n&&(n=t),t>n){this.errout("MIN/MAX values reversed... switching");var i=t;t=n,n=i}var r=Math.random()*(n-t)+t;return e+Math.random().toString(36).substring(r)},dupeJson:function(e){var t=null;try{t=JSON.parse(JSON.stringify(e))}catch(t){this.errout("Exception duping JSON: "+this.stringify(e)),this.errout(t)}return t},stringify:function(e){var t=null;if(null!=e){e.constructor==String&&(t=e);try{t=JSON.stringify(e)}catch(n){t=e.toString()}}return t},nowMS:function(){return(new Date).getTime()},reportTime:function(e,t){var n=t.indexOf("[");(-1==n||n>3)&&(t="[FRMWRK]"+t);var i=((this.nowMS()-e)/1e3).toString(),r=i.length,a=i.indexOf(".");-1==a&&(a=1);(a<o.length?o[a]:"").length;var s=i;console.log("[C2.TIME]"+t+"   //  {"+s+" seconds}  \\\\ ")},enableDebugLabel:function(e){r[e]=!0},disableDebugLabel:function(e){r[e]=!1},dbgout:function(e,t){this.dbgout2(!1,e,t)},dbgout2:function(e,t,n){if(0!=i){var o=null!=n?n:t,a=null!=n?t:null;if(null!=a){if(1!=r[a])return;o="["+a+"] "+o}var s="";"["!=o.charAt(0)&&(s=" "),o="[C2.DBG ]"+(o=e?"[PLUGIN]"+s+o:"[FRMWRK]"+s+o),console.log(o)}},warnout:function(e){console.error("[C2.WRN]"+e)},errout:function(e){console.error("[C2.ERR]"+e)},setDebugOn(e){console.log("------ DEBUG NOW "+e+" -------"),i=e},splitSvcType:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),name:e.substring(t+1),asStr:e},ret},splitSvcName:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),name:e.substring(t+1),asStr:e},ret},splitSvcConfig:function(e){var t=e.indexOf(".");return ret={svc:e.substring(0,t),configName:e.substring(t+1),asStr:e},ret},getCurrentTenant:function(){var e=null;try{e=widget.getValue("x3dPlatformId")}catch(e){this.dbgout("attempted to get tenant information from widget and failed... must be running an ODT... using 'OnPremise'")}return null==e&&(e="OnPremise"),e},confirmDialog:function(e,t,i){require(["DS/UIKIT/SuperModal"],function(r){var o=new r({events:{onHide:function(){}},renderTo:document.body}),a=document.createElement("div");a.innerHTML=e;var s=document.createElement("div");s.className="compare_popup_warning";var l=UWA.createElement("span",{class:"compare_warning_icon fonticon fonticon-attention fonticon-2x"});s.appendChild(l);var c=document.createElement("div");c.appendChild(s),c.appendChild(a);var u=[{className:"primary compare-input-Ok",value:null!==t.text&&""!==t.text?t.text:null,action:function(e){e.hide(),null!==t.callback&&void 0!==t.callback&&"function"==typeof t.callback&&t.callback()}}];null!==i&&u.push({className:"default compare-input-Cancel",value:null!==i.text&&""!==i.text?i.text:null,action:function(e){e.hide(),null!==i.callback&&void 0!==i.callback&&"function"==typeof i.callback&&i.callback()}}),o.dialog({title:n.get("CompareDialogHeader"),body:c,buttons:u})})},showAlertBox:function(e,t,n,i){var r="compare-alert-warning";switch(n){case"warning":r="compare-alert-warning";break;case"error":r="compare-alert-error";break;case"success":r="compare-alert-success";break;case"info":r="compare-alert-info";break;default:r="compare-alert-warning"}require(["DS/CompareCommon/CompareAlert"],function(n){null==t?n.doAlert({msg:e,alertStyle:r,clearExistingFirst:i}):require([t],function(){var o=t[e];null==o?o=e+"(no NLS entry)":""==o&&(o=e+"(blank NLS entry)"),n.doAlert({msg:o,alertStyle:r,clearExistingFirst:i})},function(){n.doAlert({msg:e+" (NLS file '"+t+"' cannot be found)",alertStyle:r})})},function(t){e="%%%% CompareWidget:: Failed to show "+n+": '"+e+"', error:"+t,"error"==n?this.errout(e):this.warnout(e)})},getViewDefs:function(e){var t=[];return function e(n){Object.values(n).forEach(n=>{(n.constructor!==Array?[n]:n).forEach(n=>{n.constructor===String?t.push(n):n.constructor===Array?n.forEach(e=>{e.constructor===String&&t.push(e)}):null!=n&&e(n)})})}(e),t},checkViewConfig:function(e){return function e(t,n){var i=1===Object.keys(t).length&&(null==n&&("ROW"===Object.keys(t)[0].toUpperCase()||"COL"===Object.keys(t)[0].toUpperCase())||"ROW"===n&&"COL"===Object.keys(t)[0].toUpperCase()||"COL"===n&&"ROW"===Object.keys(t)[0].toUpperCase());for(var[r,o]of Object.entries(t))i=i&&(o.constructor!==Array?[o]:o).every(t=>t.constructor===String||t.constructor===Array&&t.every(e=>e.constructor===String)||null!=t&&t.constructor!==Array&&t.constructor!==String&&e(t,r));return i}(e)},getDeviceType:function(){let e="desktop",t="ontouchstart"in document.documentElement&&/mobi/i.test(navigator.userAgent),n=window.matchMedia("(max-width: 480px) and (orientation:portrait)"),i=window.matchMedia("(max-height: 480px) and (orientation:landscape)"),r=n.matches||i.matches;return t&&r?e="smartphone":t&&!r&&(e="tablet"),e},csValsEquivalent:function(e,t){var n=!1;if(e==t)n=!0;else if(null!=e&&null!=t){var i=e.split(",");i.forEach(function(e,t){i[t]=e.trim()});var r=t.split(",");r.forEach(function(e,t){r[t]=e.trim()});var o=i.length;if(o==r.length){for(var a=i.sort(),s=r.sort(),l=!1,c=0;c<o;c++)if(a[c]!=s[c]){l=!0;break}n=!l}}return n}}}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug",[],function(){function e(e,t,n){n.dbgout("------------[ A U G M E N T   T R E E   N O D E S    B E G I N ] -----------");var i=function(e,t){var n=[];return e.visit_riTreeAndFN(function(e){var t=e.get_dbObj_REF();if(null==t.getAttr("dfr")){var i=t.getAttr("physicalid"),r=t.getAttr("dfr_bootstrapID");null==r?t.setAttr("dfr",i):(t.setAttr("dfr_in_progress",r),t.rmAttr("dfr_bootstrapID"),n.push(t))}return!0}),n}(e);return function e(t,n,i,r){return new Promise(function(o,a){if(n.length>0){var s=function(e){var t=[];return e.forEach(function(e){t.push(e.getAttr("dfr_in_progress"))}),t}(n);(function(e,t,n){var i=n.createRandomString("Compare2-",8),r={physicalid:e,select_predicate:["bo.plmreference.v_derivedfrom"],with_synthesis:!1,label:i};return n.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",r,"json",t.tenant,t.serviceName,t.securityContext)})(s,i,r).then(function(s){var l=s.results,c=function(e,t){var n=[];if(null==e||0==e.length)t.forEach(function(e){var t=e.getAttr("dfr_in_progress");e.setAttr("dfr",t),e.rmAttr("dfr_in_progress")});else{var i={};t.forEach(function(e){var t=e.getAttr("dfr_in_progress");i[t]=e}),e.forEach(function(e){var t=null,r=null;e.attributes.forEach(function(e){"bo.plmreference.v_derivedfrom"==e.name?r=e.value:"resourceid"==e.name&&(t=e.value)});var o=i[t];if(null==r){var a=o.getAttr("dfr_in_progress");o.setAttr("dfr",a),o.rmAttr("dfr_in_progress")}else o.setAttr("dfr_in_progress",r),n.push(o)})}return n}(l,n);0==c.length?o(t):e(t,c,i,r).then(o,a)},function(e){r.errout("GOT A KO TRYING TO AUG TREE"),a()})}else o(t)})}(e,i,t,n).then(function(t){return n.dbgout("------------[ A U G M E N T   T R E E   N O D E S    E N D  ] -----------"),e},function(e){})}return{jsClass:"REFINST_TREE_AUGMENTER",augment:function(t,n,i){var r=i.nowMS();t.visit_riTreeAndFN(function(e){return e.setDBContext(n),!0});var o=e(t,n,i);return i.reportTime(r,"--\x3e Augment tree with 'derived from root' "),o}}}),define("DS/CompareWidget2/widget/controls/TreePanel",["UWA/Controls/Abstract"],function(e){"use strict";return e.extend({name:"treePanel",defaultOptions:{caption:"-",addClass:"",collapseable:!1,UIcollapseable:!0},init:function(e){this._parent(e),this._isCollapsed=!1,this._isMaximized=!1,e.initSize50pct?this.setSize50pct():this.setSize33pct(),this._buildLayout()},_buildLayout:function(){var e=this,t=" ";this.options.collapseable&&(t+=this.expandClass);var n={class:this.getClassNames("-root")+t+" "+this.options.addClass};this.elements.container=new UWA.Element("div",n);var i=new UWA.Element("div",{class:this.getClassNames("-panelHeader")});i.inject(this.elements.container),this.options.colorIndicator&&(this.elements.colorIndicator=new UWA.Element("div",{class:"fonticon fonticon-stop",styles:{color:this.options.colorIndicator,"margin-left":"10px"}}),this.elements.colorIndicator.inject(i)),this.elements.headerText=new UWA.Element("div",{class:this.getClassNames("-headerText"),html:this.options.caption}),this.elements.headerText.inject(i),this.elements.contentContainer=new UWA.Element("div",{id:this.options.contentId,class:this.getClassNames("-contentContainer"),styles:{"border-top":this.options.contentBorderTop}}),this.elements.contentContainer.inject(this.elements.container);var r="";this.options.collapseable&&(r="treePanel-content-hide-expander"),this.elements.contentHide=new UWA.Element("div",{class:this.getClassNames("-content-hide")+" "+r,events:{click:function(){e.options.UIcollapseable&&e.options.collapseable&&e.toggleCollapsed()}}}),this.elements.contentHide.inject(this.elements.contentContainer),this.elements.captionCollapsed=new UWA.Element("span",{class:this.getClassNames("-caption-collapsed"),html:this.options.caption}),this.elements.captionCollapsed.inject(this.elements.contentHide),this.elements.content=new UWA.Element("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.contentContainer),this.options.collapseable&&(this.elements.headerBtn=new UWA.Element("div",{class:"wux-controls-button wux-controls-abstract wux-ui-state-secondary wux-ui-style-normal "+this.getClassNames("-headerButton"),events:{click:function(){e.toggleCollapsed()}}}),this.elements.headerBtnIcon=new UWA.Element("div",{class:"fonticon fonticon-expand-left treePanel-headerButtonIcon"}),this.elements.headerBtnIcon.inject(this.elements.headerBtn),this.elements.headerBtn.inject(i)),this._render()},_render:function(){},isCollapsed:function(){return this._isCollapsed},isCollapseable:function(){return this.options.collapseable},setUICollapseable:function(e){this.options.UIcollapseable!==e&&((this.options.UIcollapseable=e)?(this.elements.headerBtn.removeClassName("treePanel-hidden"),this.elements.contentHide.addClassName("treePanel-content-hide-expander")):(this.elements.headerBtn.addClassName("treePanel-hidden"),this.elements.contentHide.removeClassName("treePanel-content-hide-expander")))},empty:function(){},hide:function(){this.elements.container.addClassName("treePanel-hidden")},show:function(){this.elements.container.removeClassName("treePanel-hidden")},_setCollapsed:function(e){this._isCollapsed=e,this.dispatchEvent("collapseChange",{isCollapsed:e})},setSize33pct:function(){this._setSizepct("treePanel-expandedPanel33")},setSize50pct:function(){this._setSizepct("treePanel-expandedPanel50")},_setSizepct:function(e){this.expandClass!==e&&(!this.isCollapsed()&&this.elements.container&&this.elements.container.removeClassName(this.expandClass),this.expandClass=e,!this.isCollapsed()&&this.elements.container&&this.elements.container.addClassName(this.expandClass))},setCaption:function(e){this.elements.headerText.setHTML(e),this.elements.captionCollapsed.setHTML(e)},collapse:function(){this.isCollapseable()&&(this.isCollapsed()||(this.elements.container.removeClassName(this.expandClass),this.elements.container.addClassName("treePanel-collapsedPanel"),this.elements.contentHide.show(),this.elements.headerText.hide(),this.elements.headerBtnIcon.removeClassName("fonticon-expand-left"),this.elements.headerBtnIcon.addClassName("fonticon-expand-right"),this._setCollapsed(!0)))},expand:function(){this.isCollapseable()&&this.isCollapsed()&&(this.elements.headerText.show(),this.elements.container.addClassName(this.expandClass),this.elements.container.removeClassName("treePanel-collapsedPanel"),this.elements.contentHide.hide(),this.elements.headerBtnIcon.addClassName("fonticon-expand-left"),this.elements.headerBtnIcon.removeClassName("fonticon-expand-right"),this._setCollapsed(!1))},toggleCollapsed:function(){this.isCollapsed()?this.expand():this.collapse()},maximize:function(){this._isMaximized||(this._isMaximized=!0,this.elements.container.addClassName("treePanel-maximized"))},restore:function(){this._isMaximized&&(this._isMaximized=!1,this.elements.container.removeClassName("treePanel-maximized"))}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/pe2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/support/cw2Utils","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,r,o,a){var s=function(e){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByPhysicalID={},this._pathArrayArray=[],this._typeIconsArrayArray=[]};return s.prototype.build_dbObj=function(e){var t=new a;Object.keys(e).forEach(function(n){var i=e[n];"bo.plmreference.v_derivedfrom"==n&&(n="dfr_bootstrapID"),"Matrixtxt"==n&&(n="matrixtxt"),"matrixtxt"==n&&"1,0,0,0,1,0,0,0,1,0,0,0"==i&&(i="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),"resourceid"==n&&(n="physicalid"),t.addAttr(n,i)});var n={smallURL:e.icon,largeURL:e.thumbnail_2d};return t.addAttr("typeIcons",n),t},s.prototype.add_dbObj=function(e){var n=!0;return null==this._dbObjByPhysicalID[e.getAttr("physicalid")]?(this._dbObjByPhysicalID[e.getAttr("physicalid")]=e,this._dbObjArray.push(e)):(t.errout("new node already in tree (byPhysID)"),n=!1),n},s.prototype.add_path=function(e){null==e||0==e.length?t.errout("Attempt to add null or empty path to tree"):e.length%2!=1?t.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},s.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},s.prototype.buildTree=function(){var e=new r(this._objIDSpec);return this._buildFromPaths(e),e},s.prototype._isTreeNodeRefInstID=function(e,t,n){var i=!1;e.getAttr("REF.physicalid")==t&&(e.getAttr("INST.physicalid")==n&&(i=!0));return i},s.prototype._buildFromPaths=function(e){var n=this,r=!1;try{n._pathArrayArray.forEach(function(t){var r=t.length,a=e.getRoot(),s=0,l=t[0],c=null,u=null;if(null!=a&&n._isTreeNodeRefInstID(a,l,c)){for(u=a,s=1,i=1;i<r;i+=2){c=t[i],l=t[i+1];for(var d=a.getChildArray(),p=d.length,h=!1,g=0;g<p;g++){var _=d[g];if(n._isTreeNodeRefInstID(_,l,c)){h=!0,u=_,a=_;break}}if(0==h)break}lastNode=u,s=i}for(i=s;i<r;){var f=0==i;c=f?null:t[i++],l=t[i++];var S=n._get_dbObjByPhysicalID(l),m=null;0==f&&(m=n._get_dbObjByPhysicalID(c));var E=new o(S,m);f?e.setRoot(E):(lastNode.addChild(E),E.setParent(lastNode)),lastNode=E}}),r=!0}catch(e){t.errout("Failure building riTree (from paths): "+e)}return r},s.prototype._get_dbObjByPhysicalID=function(e){return this._dbObjByPhysicalID[e]},e.singleton({jsClass:"PE2REFINST_TREE",convert:function(e,n,i,r){for(var o=new s(e),a=n.length,l=0;l<a;l++){var c=n[l];if(null!=c.resourceid){var u=o.build_dbObj(c);o.add_dbObj(u)}else null!=c.Path?o.add_path(c.Path):null!=c.icon__default_thumbnail_2d?o.add_typeIcons(c.icon__default_thumbnail_2d):t.errout("Unknown entry in input:"+t.stringify(c)+", skipping...")}return o.buildTree()}})}),define("DS/CompareWidget2/plugins/MERGE/NodeUtils",[],function(){"use strict";return{nodeIs3DShapeWith3DPartUsage:function(e){var t=!1;if("3DShape"===e.getAttr("type")){var n=e.getAttr("attribute[PLMEntity.V_usage]");n&&"3DPart"===n&&(t=!0)}return t},nodeFollowsParent:function(e){var t=e.getAttr("followsParent");if(void 0!==t)return t;t=!1;var n=!1,i=e.getParent();i&&(n=this.nodeFollowsParent(i));var r="TRUE"===e.getAttr("attribute[PLMCoreRepReference.V_isOnceInstantiable]"),o="TRUE"===e.getAttr("attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]"),a="TRUE"===e.getAttr("type.kindof[BundleFastenerAbstract]");return(n||r||this.nodeIs3DShapeWith3DPartUsage(e)||o||a)&&(t=!0),e.addAttr("followsParent",t),t},nodeIsRevisionable:function(e){var t=e.getAttr("last.current.majorrevisionable");return void 0===t&&(t=e.getAttr("last.current.revisionable")),"TRUE"===t},nodeHasReviseAccess:function(e){var t=e.getAttr("majorid.lastmajorid.bestsofar.current.access[majorrevise]");if(t&&"FALSE"===t&&"TRUE"===e.getAttr("last.current.revisionable")&&(t=e.getAttr("majorid.lastmajorid.bestsofar.current.access[revise]")),!t){var n=e.getAttr("title");warnout("No revise access info available when requested for '"+n+"'")}return"TRUE"===t},nodeCanBeRevised:function(e){return this.nodeHasReviseAccess(e)&&this.nodeIsRevisionable(e)}}}),define("DS/CompareWidget2/plugins/MERGE/ViewPanel/Popup",["UWA/Class","DS/UIKIT/DropdownMenu"],function(e,t){return e.extend({init:function(e){this._parent({}),this.target=e.target,this.target.addEventListener("click",this.onClickTarget.bind(this)),this.container=UWA.createElement("div",{styles:{"box-shadow":"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)",padding:"5px",position:"absolute",background:"white",border:"1px solid darkgrey","z-index":"1000"}}),this.container.appendChild(e.content)},onClickTarget:function(e){document.removeEventListener("click",document.onClickDocumentMergeFunc),this.clear(),this.show(),this.container.style.left=e.clientX-this.container.offsetWidth/2+"px",this.container.style.top=e.clientY-this.container.offsetHeight-2+"px",document.onClickDocumentMergeFunc=this.onClickDocument.bind(this),document.addEventListener("click",document.onClickDocumentMergeFunc)},onClickDocument:function(e){e.target!=this.target&&this.onFinish()},onFinish:function(){document.removeEventListener("click",document.onClickDocumentMergeFunc),this.clear()},show:function(){this.container.inject(document.body),document.body.popup=this.container},clear:function(){null!=document.body.popup&&(document.body.removeChild(document.body.popup),document.body.popup=null)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/cv2RefInstTree",["DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter","DS/CompareWidget2/support/cw2Utils","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"],function(e,t,n,r,o,a){var s=function(e){this._objIDSpec=e,this._dbObjArray=[],this._dbObjByDID={},this._dbObjByPhysID={},this._pathArrayArray=[],this._typeIconsArrayArray=[]};return s.prototype.build_dbObj=function(e){for(var t=new a,n=e.length,i=0;i<n;i++){var r=e[i],o=r.name,s=r.value;"bo.plmreference.v_derivedfrom"==o&&(o="dfr_bootstrapID"),"matrixtxt"==o&&"1,0,0,0,1,0,0,0,1,0,0,0"==s&&(s="1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0"),t.addAttr(o,s)}return t},s.prototype.add_dbObj=function(e){var n=!0;return null==this._dbObjByDID[e.getAttr("did")]?this._dbObjByDID[e.getAttr("did")]=e:(t.errout("new node already in tree (byDID)"),n=!1),1==n&&null==this._dbObjByPhysID[e.getAttr("physicalid")]?this._dbObjByPhysID[e.getAttr("physicalid")]=e:(t.errout("new node already in tree (byPhysID)"),n=!1),n&&this._dbObjArray.push(e),n},s.prototype.add_path=function(e){null==e||0==e.length?t.errout("Attempt to add null or empty path to tree"):e.length%2!=1?t.errout("Invalid path; contains even number of entries (count *must* be odd)"):this._pathArrayArray.push(e)},s.prototype.add_typeIcons=function(e){this._typeIconsArrayArray.push(e)},s.prototype.buildTree=function(){var e=new r(this._objIDSpec);return this._buildFromPaths(e),this._attachIcons(e),e},s.prototype._isTreeNodeRefInstID=function(e,t,n){var i=!1;e.getAttr("REF.did")==t&&(e.getAttr("INST.did")==n&&(i=!0));return i},s.prototype._buildFromPaths=function(e){var n=this,r=!1;try{n._pathArrayArray.forEach(function(t){var r=t.length,a=e.getRoot(),s=0,l=t[0],c=null,u=null;if(null!=a&&n._isTreeNodeRefInstID(a,l,c)){for(u=a,s=1,i=1;i<r;i+=2){c=t[i],l=t[i+1];for(var d=a.getChildArray(),p=d.length,h=!1,g=0;g<p;g++){var _=d[g];if(n._isTreeNodeRefInstID(_,l,c)){h=!0,u=_,a=_;break}}if(0==h)break}lastNode=u,s=i}for(i=s;i<r;){var f=0==i;c=f?null:t[i++],l=t[i++];var S=n._get_dbObjByDID(l),m=null;0==f&&(m=n._get_dbObjByDID(c));var E=new o(S,m);f?e.setRoot(E):(lastNode.addChild(E),E.setParent(lastNode)),lastNode=E}}),r=!0}catch(e){t.errout("Failure building riTree (from paths): "+e)}return r},s.prototype._attachIcons=function(e){var n=this;try{this._typeIconsArrayArray.forEach(function(e){e.forEach(function(e){for(var t=e.did,i={smallURL:e.icon,largeURL:e.thumbnail_2d},r=t.length,o=0;o<r;o++){var a=t[o];n._get_dbObjByDID(a).setAttr("typeIcons",i)}})}),!0}catch(e){t.errout("Failure attaching icons to tree: "+e)}},s.prototype._getObjByPhysID=function(e){return this._dbObjByPhysID[e]},s.prototype._get_dbObjByDID=function(e){return this._dbObjByDID[e]},s.prototype._visit_dbObjsAndFN=function(e){for(var t=this._dbObjArray.length,n=!0,i=0;1==n&&i<t;i++){n=e(this._dbObjArray[i])}return n},e.singleton({jsClass:"CV2REFINST_TREE",convert:function(e,n,i,r){for(var o=new s(e),a=n.length,l=0;l<a;l++){var c=n[l];if(null!=c.attributes){var u=o.build_dbObj(c.attributes);null!=c.boundingbox&&u.addAttr("boundingbox",c.boundingbox),o.add_dbObj(u)}else null!=c.path?o.add_path(c.path):null!=c.icon__default_thumbnail_2d?o.add_typeIcons(c.icon__default_thumbnail_2d):t.errout("Unknown entry in input:"+t.stringify(c)+", skipping...")}return o.buildTree()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/expansionAdapters/exAdapter",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],function(e,t){return e.extend({convert:function(e){return t.errout("Abstract base class called; requires implementation"),null}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController",[],function(){var e=function(e,t,n){this._getActiveTreeCB=e,this._isListCB=t,this.dbgout=n};return e.prototype.destroy=function(){this._getActiveTreeCB=null,this._isListCB=null},e.prototype.setSelectedNodes=function(e){return this._selectNodes(e)},e.prototype.clearSelectedNodes=function(){this._clearSelections()},e.prototype._selectNodes=function(e){var t=this,n=t._getActiveTreeCB();n.withUpdateLocked(()=>{var i=[];n.dataGridViews.forEach((n,r)=>{t.dbgout("XSELECT","   structComparePanel._selectNodes dataGrid # "+r),e.forEach(function(e,r){t.dbgout("XSELECT","      structComparePanel._selectNodes selection # "+r);var o=t._find_nodes_from_path(n,e);o.length>0&&(t.dbgout("XSELECT","      structComparePanel._selectNodes _find_nodes_from_path found "+o.length+" nodes"),o.forEach((e,n)=>{i.push(e);var r=e.getAttr("title"),o=e.getAttr("type");t.dbgout("XSELECT","        "+r+" "+o)}))})}),t.dbgout("XSELECT","   structComparePanel._selectNodes calling selectByCrNodes with "+i.length),n.selectByCrNodes(i)})},e.prototype._clearSelections=function(){var e=this._getActiveTreeCB();e.withUpdateLocked(()=>{e.dataGridViews.forEach((t,n)=>{e.clearNTHGridSelection(n)})})},e.prototype._find_nodes_from_path=function(e,t){var n=this,i=[],r=[];"/"==t[0]&&(t=t.substr(1));var o=t.split("/");if(null!=o&&Array.isArray(o)&&o.length>0){var a=o.length,s=Math.floor(a/2)+1,l=o[0];for(const t of e.model){let e=t.options.data;if(null!=e){var c=e.getObjIDSpec_REF(),u=e.getObjIDSpec_INST();if(null!=c)if(n._isListCB())null==u?1===s&&c.getPhysID()===o[0]&&(n.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),i.push(e)):s>1&&u.getPhysID()===o[a-2]&&c.getPhysID()===o[a-1]?(n.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),i.push(e)):s>2&&u.getPhysID()===o[a-4]&&c.getPhysID()===o[a-3]&&(n.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in LIST"),r.push(e));else if(c.getPhysID()===l)if(1===s)n.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (root node)"),i.push(e);else{n.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - searching thru root "+l);n._find_node_from_path(e,2,o,i)}}}return 0===i.length&&r.length>0?r:i}},e.prototype._find_node_from_path=function(e,t,n,i){var r=this;e.getChildArray().forEach((e,o)=>{var a=e.getObjIDSpec_REF(),s=null!=a?a.getPhysID():"null",l=e.getObjIDSpec_INST(),c=null!=l?l.getPhysID():"null",u=n[2*(t-1)-1],d=n[2*(t-1)];if(c===u&&s===d){var p=Math.floor(n.length/2+1);t===p?(i.push(e),r.dbgout("XSELECT","      structComparePanel._find_nodes_from_path - found node in TREE (under root)")):t<p&&(++t,r._find_node_from_path(e,t,n,i),--t)}})},e}),define("DS/CompareWidget2/ViewDefModules/DSColors",[],function(){var e={colorDef:{BLUE1:"#009DDB",ORANGE:"#FF8A2E",VIOLET:"#9B2C98",GREEN1:"#00AA86",PINK:"#F564A3",BLUE2:"#8DDEE4",RED:"#CC092F",GREY1:"#E2D5CC",GREEN2:"#6FBC4B",PURPLE:"#70036B",BLUE3:"#002596",BEIGE:"#C6C68B",GREY2:"#7F7F7F",BLUE4:"#4EA8B7",GREEN3:"#007A4C",GREY3:"#ADADAD",BLUE5:"#127277",RED2:"#6D2815",BLACK:"#000000",BLUE6:"#4D62BA",YELLOW:"#FEE000",WHITE:"#FFFFFF",NONE:"",LIGHT_TAN:"#EEEEEE",V1DIFF_STATUS:"#D2B48C",V1REV_STATUS:"#982C98",V1MOVE_STATUS:"#FFCC00",V1QTY_STATUS:"#1494DE"}};return e.colorSeq=[e.colorDef.BLUE1,e.colorDef.ORANGE,e.colorDef.VIOLET,e.colorDef.GREEN1,e.colorDef.PINK,e.colorDef.BLUE2,e.colorDef.RED,e.colorDef.GREY1,e.colorDef.GREEN2,e.colorDef.PURPLE,e.colorDef.BLUE3,e.colorDef.BEIGE,e.colorDef.GREY2,e.colorDef.BLUE4,e.colorDef.GREEN3,e.colorDef.GREY3,e.colorDef.BLUE5,e.colorDef.RED2,e.colorDef.BLACK,e.colorDef.BLUE6,e.colorDef.YELLOW,e.colorDef.WHITE,e.colorDef.NONE],e}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Legend",["UWA/Controls/Abstract","DS/Controls/Toggle"],function(e,t){return e.extend({init:function(e){this._parent({}),this.onClickCheckbox=e.onClickCheckbox,this.items=[]},update:function(e){this.items=[];var n=e.allFlagDefs;for(var i in n){var r=n[i],o=new t({type:"checkbox",label:r.label,checkFlag:!0});o.data=r,o.elements.checkSign.style.backgroundColor=r.color,o.addEventListener("change",this.onClickLegendCheckbox.bind(this));var a=UWA.createElement("div",{styles:{position:"relative",top:"-4px","padding-left":"4px","padding-right":"4px"}});a.toggle=o,o.inject(a),this.items.push(a)}},onClickLegendCheckbox:function(){var e=this.getCheckedIds();this.onClickCheckbox(e)},getCheckedIds:function(){for(var e=[],t=0;t<this.items.length;t++){var n=this.items[t].toggle,i=n.data;n.checkFlag&&e.push(i.id)}return e}})}),define("DS/CompareWidget2/plugins/MERGE/ViewPanel/mergeDefaultContextMenu",["UWA/Class"],function(e){return e.extend({init:function(e){this._structComparePanel=e.structComparePanel},createContextMenu:function(e){var t=this;return new Promise(function(n){n(t._structComparePanel._getAvailableActionsMenuFromCRNode(e.cellInfos.nodeModel.options.data))})},onComparePanelUpdated:function(){}})}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController",["UWA/Class","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/SceneGraphOverrides/SceneGraphOverrideSet","DS/Visualization/SceneGraphUtils","DS/Visualization/IdPath","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i,r,o){return e.extend({init:function(e){this._hideShowController=e,this._xShowSGOS=null,this._isLightNodeModel=o.getSetting("enopad3dviewer_lightNodeModel")},_getPAD3DViewer:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._context),e},_getSceneGraphOverrideSet:function(){var e=null;return null!=this._hideShowController&&(e=this._hideShowController._sceneGraphOverrideSet),e},_createOverrideSet:function(){null!=this._hideShowController&&(delete this._hideShowController._sceneGraphOverrideSet,this._hideShowController.createOverrideSet())},_publish:function(e){null!=this._hideShowController&&this._hideShowController.publish(e)},subscribe:function(e,t){if(null!=this._hideShowController)return this._hideShowController.subscribe(e,t)},unsubscribe:function(e){null!=this._hideShowController&&this._hideShowController.unsubscribe(e)},_getViewer:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getViewer()),e},_getSceneGraphOverrideSetManager:function(){var e=null,t=this._getViewer();return null!=t&&(e=t.getSceneGraphOverrideSetManager()),e},_getPAD3DController:function(){var e=null,t=this._getPAD3DViewer();return null!=t&&(e=t.getController()),e},_asyncRender:function(){var e=this;setTimeout(function(){e._getViewer().render({updateInfinitePlane:!0})})},hide:function(e){this._hideShowController.hide(e)},show:function(e){this._hideShowController.show(e)},exclusiveShow:function(e){if("object"!=typeof e)throw new Error("No parameter defined");if(!Array.isArray(e.paths))throw new Error("No paths to be shown defined");var n=this;if(n._isLightNodeModel){n._resetExclusiveShow();var o=n._getPAD3DController().getRoots(),a=e.paths.length,s=2==a;if(1==s)for(var l=0;l<a;l++)if(1!=e.paths[0].length){s=!1;break}var c=[];for(l=0;l<o.length;l++){var u=t.getNodeID(o[l]);u&&c.push(new r([n._getPAD3DController().getRootBagId(),u]))}if(c.length){var d=n._xShowSGOS.createIdPathOverride({idPathes:c,propagateUntilRepRefs:!0});d&&d.setVisibility(1==s)}if(0==s){var p=[];for(l=0;l<e.paths.length;l++)p.push(new r([n._getPAD3DController().getRootBagId()].concat(e.paths[l])));if(p.length){var h=n._xShowSGOS.createIdPathOverride({idPathes:p,propagateUntilRepRefs:!0});h&&h.setVisibility(!0);var g=n._xShowSGOS.createIdPathOverride({idPathes:p,propagateToParents:!0});g&&g.setVisibility(!0)}}n._asyncRender(),n._publish({event:"onExclusiveShow",data:e})}else{n._resetExclusiveShow();var _=n._getPAD3DController()._model._nodeIndex,f=Object.getOwnPropertyNames(_),S=n._getPAD3DController()._model.getRootBag();f.forEach(function(e){_[e].is3DLeaf&&_[e].is3DLeaf()&&i.buildPathesLeadingToNode(_[e],S).forEach(function(e){n._getSceneGraphOverrideSet().createOverride(e).setVisibility(!1)})}),e.paths.forEach(function(e){if(t.isAModelPath(e)){var r=e.getLastElement(!0);if(r.is3DLeaf&&r.is3DLeaf()){n._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)}else{var o=[],a={};r.traverse(function(t){t.is3DLeaf&&t.is3DLeaf()&&!a[t.getID()]&&(a[t.getID()]=!0,i.buildPathesLeadingToNode(t,S).forEach(function(t){e.isAParentOf(t)&&o.push(t)}))}),o.forEach(function(e){n._getSceneGraphOverrideSet().createOverride(e).setVisibility(!0)})}}});var m=n._getSceneGraphOverrideSetManager();m&&(m.removeSceneGraphOverrideSet(n._getSceneGraphOverrideSet()),m.pushSceneGraphOverrideSet(n._getSceneGraphOverrideSet())),n._asyncRender(),n._publish({event:"onExclusiveShow",data:e})}},_resetExclusiveShow:function(){var e=this;if(e._isLightNodeModel){(t=e._getSceneGraphOverrideSetManager())&&(null!=e._xShowSGOS&&(t.removeSceneGraphOverrideSet(e._xShowSGOS),delete e._xShowSGOS),e._xShowSGOS=new n(e._getPAD3DController().getRootBag(),e._getPAD3DController().getRootBagId(),!0),t.pushSceneGraphOverrideSet(e._xShowSGOS)),e._asyncRender()}else{var t,i=e._getSceneGraphOverrideSet();if(null!=i)(t=e._getSceneGraphOverrideSetManager())&&t.removeSceneGraphOverrideSet(i),e._createOverrideSet(),e._asyncRender()}}})}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj",["DS/CompareWidget2/support/cw2Utils"],function(e){function t(t){var n=!1;return null!=t&&0!=t.length?n=!0:e.errout("Invalid string (null or zero length)"),n}var n=function(){this._attrList={},this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/dbObj"};return n.prototype.isREF=function(){var e=!1;return null==this._attrList.matrixtxt&&(e=!0),e},n.prototype.isINST=function(){return!isREF},n.prototype.addAttr=function(n,i,r){t(n)&&(null!=r&&1!=r||null==this._attrList[n]||e.warnout("New attr value is overwriting an existing attr value for '"+n+"'"),this._attrList[n]=i)},n.prototype.setAttr=function(e,t){this.addAttr(e,t,!1)},n.prototype.rmAttr=function(e){delete this._attrList[e]},n.prototype.getAttrList=function(){return this._attrList},n.prototype.getAttr=function(e){return ret=null,t(e)&&(ret=this._attrList[e]),ret},n}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu",["UWA/Core","DS/CompareWidget2/viewComponents/ContextMenuBase","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structOpenWithMenu"],function(e,t,n,i){"use strict";return t.extend({init:function(e){this._structComparePanel=e.structComparePanel,this._expandCollapseMenu=new n(e),this._openWithMenu=new i(e)},createContextMenu:function(e){var t=this;return new Promise(function(n){var i=[];if(null!=e&&void 0!==e.collectionView&&null!==e.collectionView)if(function(e){return null==e||void 0===e.cellInfos||null===e.cellInfos||void 0===e.cellInfos.cellModel||null===e.cellInfos.cellModel}(e)||t._structComparePanel.isList())n(i);else{var r=e.cellInfos.nodeModel.getTreeDocument().getSelectedNodes();t._openWithMenu.getOpenWithMenuPromise(e,r).then(function(r){null!=r&&i.push(r);var o=t._expandCollapseMenu.getExpandCollapseContextMenu(e,t._structComparePanel.getActiveExpandMenuId());o&&(i.length>0&&i.push({type:"SeparatorItem"}),i.push(o)),n(i)})}else n(i)})},onComparePanelUpdated:function(){void 0!==this._openWithMenu&&null!==this._openWithMenu&&this._openWithMenu.clearLaunchTreeArray()}})}),define("DS/CompareWidget2/userSettings/Merge",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n){"use strict";return e.extend(t,{namespace:"default",mergeSettings:{dataSource:{useIndex:{value:!1,widgetSetting:{type:"boolean",label:n.useIndex,defaultValue:!1}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}}),STRUCT_VIEW:{display_mode:{value:"tree"},statuses_to_hide:{value:[]},statuses_unchecked:{value:[]}}}},!0)}),define("DS/CompareWidget2/support/DataCenter",["UWA/Class","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/CompareWidget2/support/cw2Utils"],function(e,t,n,i,r){var o=e.singleton({init:function(){this._parent({})},makeAuthHttpsCall:function(e,o,a,s,l,c,u,d){return new Promise(function(p,h){null!=e&&e.constructor==String&&0!=e.length||h("BAD svcPath format:"+e),"GET"!=o&&"POST"!=o&&h("Method type: "+o+" is not supported");var g=c||"3DSpace",_=l||"OnPremise",f=e,S=null;"POST"==o&&null!=a&&(S=UWA.Json.encode(a),a=null),"3dspace"==g.toLowerCase()&&"3DSpace"!=g&&(r.errout("Correcting malforded service '"+g+"' to '3DSpace'"),g="3DSpace");var m=n.getPlatformWSUrl(g,_,f,a),E={Accept:"application/json","Accept-Language":t.getLanguage(),"Content-Type":"application/json"};E.SecurityContext=null!=u?u:void 0;var C=1!=d;i.authenticatedRequest(m,{method:o,type:s,timeout:48e4,data:S,headers:E,proxy:"passport",cache:C,onComplete:function(e){null!=e&&null!=e.STATUS?"OK"==e.STATUS?p(e.RESULT):(r.errout("**** SERVER ERROR calling: "+m),r.errout("**** MSG: "+e.MSG),h(e.MSG)):null==e?(r.errout("**** SERVER ERROR calling: "+m),r.errout("**** RESPONSE IS null"),h("null response")):p(e)},onFailure:function(e){r.errout("**** HTTPS ERROR calling: "+m),r.errout("**** MSG: "+e),null!=u&&""!=u||r.errout("**** Probably related to blank security context in request"),h(e)}})})},loadPrefPromise:function(e,t){return this.makeAuthHttpsCall("/resources/AppsMngt/user/getPreferences","GET","name="+e,"text","__NOTENANT__",null,null,t)},savePrefs:function(e,t){this.makeAuthHttpsCall("/resources/AppsMngt/user/setPreferences","GET","name="+e+"&value="+encodeURI(t),"text","__NOTENANT__",null,null).then(()=>{},()=>{})},fetchFilterDefinition:function(e){return new Promise(function(t,n){var i="filterId="+e.getPhysID();o.makeAuthHttpsCall("/resources/FilterBIAPI/Filter/getFilterFromId","GET",i,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){var n=JSON.parse(e.ENOStrSpecDesc.filterCVQuery);t(n)},function(e){n(e)})})}});return o}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvProgressiveExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],function(e,t){var n={format:"entity_relation_occurrence",hits:{predefined_computation:["boundingbox","cgr","thumbnail_3d","icons"]},select_object:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],select_relation:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},i={format:n.format,hits:n.hits,select_object:[...n.select_object,"relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_relation:[...n.select_relation,"Matrixtxt"]};function r(t,r,o,a){var s=null!=a&&0!=a.length,l=s?n:i,c={batch:{expands:[{label:"TBD_LABEL",root:{physical_id:t},filter:{all:1},aggregation_processors:[]}]},outputs:e.dupeJson(l)};return s&&(c=function(e,t){return Object.keys(t).forEach(function(n){var i=t[n],r=i.indexOf(".");if(-1==r)e.select_bo.push(i);else{var o=i.substr(0,r),a=i.substr(r+1);if("REF"==o)"dfr"==a&&(a="bo.plmreference.v_derivedfrom"),-1==e.outputs.select_object.indexOf(a)&&e.outputs.select_object.push(a);else{if("INST"!=o)throw new Error("UNKNOWN specifier in PROPS definition");"matrixtxt"==a&&(a="Matrixtxt"),-1==e.outputs.select_relation.indexOf(a)&&e.outputs.select_relation.push(a)}}}),e}(c,a)),c}function o(e,n,i,o,a){return new Promise(function(i,s){var l="/cvservlet/progressiveexpand/v2";o.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),o.dbgout("cvExpand on id: "+e.getPhysID()+"\n on service   : "+e.getServiceName()+"\n with expand type: cvProgressiveExpand\n with URL     : "+l);(function(e,t,n,i){return new Promise(function(t,n){var o=r(e.getPhysID(),0,0,i),a=e.getFilterSpec();null!=a&&(o=function(e,t){return e.batch=t.CVQueryV2.batch,e}(o,a)),t(o)})})(e,0,0,a.CV_PROPS).then(function(r){var a=r;t.makeAuthHttpsCall(l,"POST",a,"application/json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){var t=e;"string"==typeof t&&(t=t.replace("{}",""),t=JSON.parse(t)),(t=t.results)._dataSource=n,o.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),i(t)},function(e){s(e)})},function(e){s(e)})})}return{jsClass:"CV_PROGRESSIVE_EXPAND",doExpand:function(e,t,n,i,r){return o(e,t,0,i,r)}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/compareServiceExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","UWA/Json"],function(e,t,n){var i="/resources/compare/index/postFetchModelsFromIndex",r="/resources/compare/fetchModels";function o(e,n,o,a){return new Promise(function(s,l){var c=null,u=null,d=null,p="";null!=a.DB_PROPS&&Object.keys(a.DB_PROPS).forEach(function(e){var t=a.DB_PROPS[e];"REF.dfr"==t&&(t="REF.attribute[PLMReference.V_DerivedFrom]"),p+=t+","});var h=encodeURIComponent(p),g=void 0!==a.USE_MCS&&null!==a.USE_MCS&&!1===a.USE_MCS?"":"USE_MCS";if("CV_SERVICE"==n){c=i,u="POST";let t=[];if(Array.isArray(e))for(let n of e)t.push({type:"IDSPEC",spec:n.getPhysID()});else t.push({type:"IDSPEC",spec:e.getPhysID()});d={objSpecList:t,depth:o,compareOption:g,PROPS:h}}else if("DB_SERVICE"==n){if(c=r,u="GET",Array.isArray(e))for(let t=0;t<e.length;++t)0===t&&(d="objectIds="),d+=e[t].getPhysID(),t<e.length-1&&(d+=",");else d="objectIds="+e.getPhysID();d+="&compareOption="+g,d+="&PROPS="+h}else{var _=plugSvcs.errout("UNEXPECTED data source: "+n);l(_)}var f=Array.isArray(e)?e[0].getTenant():e.getTenant(),S=Array.isArray(e)?e[0].getSecurityContext():e.getSecurityContext(),m=Array.isArray(e)?e[0].getServiceName():e.getServiceName();t.makeAuthHttpsCall(c,u,d,"json",f,m,S,!0).then(function(e){s(e)},function(e){l(e)})})}return{jsName:"COMPARE_SVC_EXPAND",doExpand:function(e,t,n,i,r){return new Promise(function(a,s){o(e,t,n,r).then(function(e){var n=e[0];n._dataSource=t,a(n)},function(e){i.errout(e),s(e)})})},doExpandN:function(e,t,n,i,r){return new Promise(function(a,s){o(e,t,n,r).then(function(n){if(Array.isArray(e)){for(let e of n)e._dataSource=t;a(n)}else{var i=n[0];i._dataSource=t,a(i)}},function(e){i.errout(e),s(e)})})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/lifecycleServicesExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/LifecycleServices/LifecycleServicesSettings","UWA/Json"],function(e,t,n,i){var r="/resources/lifecycle/expand/federated";function o(e,n,i,o){return new Promise(function(i,a){var s=null,l=null,c=null,u=[],d=[];null!=o.CV_PROPS&&Object.keys(o.CV_PROPS).forEach(function(e){var t=o.CV_PROPS[e];"REF.dfr"==t&&(t="REF.bo.plmreference.v_derivedfrom"),-1==t.indexOf(".")&&u.push(t),t.startsWith("REF.")?u.push(t.substring(4)):t.startsWith("INST.")&&d.push(t.substring(5))});d.includes("ro.plminstance.V_treeorder")||d.push("ro.plminstance.V_treeorder");var p=o.COMMAND_CONTEXT?o.COMMAND_CONTEXT:"compare";if("LC_IDX_SERVICE"==n||"LC_AUTH_SERVICE"==n){s=r;var h="LC_AUTH_SERVICE"==n;l="POST",c={ids:[e.getPhysID()],authoring:h,command:p,enableProto:!0,select_bo:u,select_rel:d,filter:""}}else{var g=plugSvcs.errout("UNEXPECTED data source: "+n);a(g)}var _=e.getTenant(),f=e.getSecurityContext(),S=e.getServiceName();t.makeAuthHttpsCall(s,l,c,"json",_,S,f,!0).then(function(e){i(e)},function(e){a(e)})})}return{jsName:"LIFECYCLE_SVC_EXPAND",doExpand:function(e,t,i,r,a){return new Promise(function(i,s){o(e,t,0,a).then(function(e){var o=e.errorCode;if(o){var a=e.errorMessage;return r.errout("Lifecycle federated expand via "+t+" failed; errorCode:"+o+" errorMessage:"+a),void s(e)}var l=e.results;l.forEach(function(e){e.attributes&&(e.attributes=e.attributes.filter(e=>""!==e.value))}),l.forEach(function(e){if(e.icon__default_thumbnail_2d){var t=n.get3DSpaceUrl();e.icon__default_thumbnail_2d.forEach(function(e){e.icon&&e.icon.startsWith("/")&&(e.icon=t+e.icon)})}}),l._dataSource=t,i(l)},function(e){r.errout(e),s(e)})})}}}),define("DS/CompareWidget2/plugins/STRUCTURE/expanders/cvExpand",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter"],function(e,t){var n={select_bo:["physicalid","ds6w:type","ds6w:globaltype","ds6wg:revision","ds6w:label","ds6wg:XCADOrientationExt.V_WorldOrientation"],compute_select_bo:["cgr","thumbnail_3d","icon"],select_rel:["physicalid","ds6w:type","ro.plminstance.v_treeorder","ro.plminstance.plm_externalid"]},i={...n,...{select_bo:["relcount","bo.plmentity.plm_externalid","ds6w:reserved","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6w:policy","ds6w:organizationResponsible","ds6w:project","ds6w:reservedBy","ds6w:identifier","bo.plmreference.v_derivedfrom"],select_rel:["matrixtxt"]}};function r(t,r,o){var l=null!=o&&0!=o.length,c=l?n:i,u=e.dupeJson(c);return r&&(u=a(u)),l&&(u=s(u,o)),u.label="ComparefilterQuery-"+e.nowMS(),null!=t.CVQuery3D?u.union=t.CVQuery3D.union:null!=t.CVQuery?u.union=t.CVQuery.union:u=null,u}function o(t,r,o,l){var c=null!=l&&0!=l.length,u=c?n:i,d=e.dupeJson(u);return d.no_type_filter_bo=["PLMPort","PLMConnection"],o&&(d=a(d)),c&&(d=s(d,l)),d.root_physicalid=t,d.expand_iter=r||"-1",d.label="cw2_unittest_client"===widget.id?"":"Compare2-"+e.nowMS(),d}function a(e){return e.fcs_url_mode="REDIRECT",e.boundingbox=!0,e.with_synthesis=!0,e}function s(e,t){return Object.keys(t).forEach(function(n){var i=t[n],r=i.indexOf(".");if(-1==r)e.select_bo.push(i);else{var o=i.substr(0,r),a=i.substr(r+1);"REF"==o?("dfr"==a&&(a="bo.plmreference.v_derivedfrom"),-1==e.select_bo.indexOf(a)&&e.select_bo.push(a)):"INST"==o?-1==e.select_rel.indexOf(a)&&e.select_rel.push(a):KOfn("UNKNOWN specifier in PROPS definition")}}),e}function l(e,n,i,a,s){return new Promise(function(l,c){a.dbgout("------------[ T R E E   E X P A N S I O N    B E G I N ] -----------"),function(e,n){return new Promise(function(i,r){var o={};if("DELLmiGeneralSystemReference"==e.getObjType())o.name="EXPAND",o.url="/cvservlet/expand",i(o);else if(null!=e.getFilterSpec())n.forEach(function(e){"Filter"!=e.name||(o=e)}),null==o?r("URL for filter missing from viewDef/options"):i(o);else{var a=e.getPhysID(),s=e.getTenant(),l=e.getServiceName(),c=e.getSecurityContext(),u={queryPhysID:a,catSpec:n};t.makeAuthHttpsCall("/resources/compare2/IDCat/","POST",u,"json",s,l,c).then(function(e){i(e)},function(e){r("Failure determining expand type")})}})}(e,s.CVURL_BY_TYPE).then(function(u){var d=u,p=d.url,h=d.name;a.dbgout("cvExpand on id: "+e.getPhysID()+" on service   : "+e.getServiceName()+" with expand type: "+h+" with URL     : "+p);var g=!1;"3D"!=h&&"Filter"!=h||(g=!0),function(e,n,i,a){return new Promise(function(s,l){if("ENOStrRefinementSpecification"==e.getObjType())t.fetchFilterDefinition(e).then(function(e){var t=r(e,i,a);s(t)},function(e){l(e)});else{var c=e.getFilterSpec(),u=null;null!=c?"DELLmiGeneralSystemReference"==e.getObjType()?(u=o(e.getPhysID(),n,i,a)).config_filter=c.CVQuery.union.expand[0].config_filter:u=r(c,i,a):u=o(e.getPhysID(),n,i,a),s(u)}})}(e,i,g,s.CV_PROPS).then(function(i){var r=i;t.makeAuthHttpsCall(p,"POST",r,"json",e.getTenant(),e.getServiceName(),e.getSecurityContext()).then(function(e){null!=e.error&&c(e.error);var t=e.results;t._dataSource=n,a.dbgout("------------[ T R E E   E X P A N S I O N    E N D    ] -----------"),l(t)},function(e){c(e)})},function(e){c(e)})},function(e){c(e)})})}return{jsClass:"CVEXPAND",doExpand:function(e,t,n,i,r){return l(e,t,n,i,r)}}}),define("DS/CompareWidget2/support/objIDSpec",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(t,n,i,r,o,a,s,l){this._physID=t?e.dupeJson(t):null,this._objType=n?e.dupeJson(n):null,this._securityContext=i?e.dupeJson(i):null,this._tenant=r?e.dupeJson(r):e.getCurrentTenant(),this._serviceName=o?e.dupeJson(o):"3DSpace",this._filterSpec=a?e.dupeJson(a):null,this._idType=s?e.dupeJson(s):"modelID",this._commands=l?e.dupeJson(l):null,this._reqMod="DS/CompareWidget2/support/objIDSpec"};return t.prototype.destroy=function(){delete this._physID,delete this._objType,delete this._securityContext,delete this._tenant,delete this._serviceName,delete this._filterSpec,delete this._idType,delete this._commands},t.prototype.makeDupe=function(){return new t(this._physID,this._objType,this._securityContext,this._tenant,this._serviceName,this._filterSpec,this._idType,this._commands)},t.prototype.getUniqueID=function(){var e="NO_FILTER";null!=this._filterSpec&&(e=this._filterSpec.filterTitle);var t="NO_COMMANDS";return null!=this._commands&&(t=this._commands),this.getPhysID()+"-"+this.getObjType()+"-"+this.getSecurityContext()+"-"+this.getTenant()+"-"+this.getServiceName()+"-"+e+"-"+t},t.prototype.isEqual=function(e){return this.getUniqueID()==e.getUniqueID()},t.prototype.getPhysID=function(){return this._physID},t.prototype.getObjType=function(){return this._objType},t.prototype.getSecurityContext=function(){return this._securityContext},t.prototype.getTenant=function(){return this._tenant},t.prototype.getServiceName=function(){return this._serviceName},t.prototype.getFilterSpec=function(){return this._filterSpec},t.prototype.getIDType=function(){return this._idType},t.prototype.getCommands=function(){return this._commands},t.prototype.hasCommands=function(){var e=!1;return null!=this._commands&&this._commands.constructor==Array&&this.commands.length>0&&(e=!0),e},t.prototype.isFiltered=function(){return null!=this._filterSpec||"ENOStrRefinementSpecification"==this._objType},t.prototype.getSvcType=function(){return this._serviceName+"."+this._objType},t.prototype.getTenantSvcType=function(){return this._tenant+"."+this.getSvcType()},t}),define("DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_node"],function(e,t,n){var i=function(e){this._objIDSpec=e,this._rootRefInstNode=null,this._pathArray=[],this._dataSource="UNKNOWN",this._editsApplied=!1,this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInst_tree"};return i.prototype.getEditCommands=function(){var e=null;return null!=this._objIDSpec&&(e=this._objIDSpec.getCommands()),e},i.prototype.get_editsHaveBeenApplied=function(){return this._editsApplied},i.prototype.set_editsHaveBeenApplied=function(){this._editsApplied=!0},i.prototype.getObjIDSpec=function(){return this._objIDSpec},i.prototype.setDataSource=function(e){null!=e&&0!=e.length&&(this._dataSource=e)},i.prototype.setRoot=function(e){this._rootRefInstNode=e},i.prototype.getRoot=function(){return this._rootRefInstNode},i.prototype.setPathArray=function(e){this._pathArray=e},i.prototype.getPathArray=function(){return this._pathArray},i.prototype.sortChildren=function(){this.visit_riTreeAndFN(function(e){e.sortChildArray()})},i.prototype.findNodeByPhysIDPath=function(e){var t=e.split("/");if(this._rootRefInstNode.get_dbObj_REF().getAttr("REF.physicalid")!=t[0]);else for(var n=this._rootRefInstNode,i=t.length,r=1;r<i;r+=2){var o=t[r],a=t[r+1];if(null==(n=n.findChild(o,a)))break}return n},i.prototype.visit_riTreeAndFN=function(t){return null==this._rootRefInstNode&&e.errout("'visit_riTreeAndFN()' called, but tree has no root set"),this._rootRefInstNode.visit_subtreeAndFN(t),!0},i}),define("DS/CompareWidget2/userSettings/UserSettingsManager",["UWA/Core","UWA/Json","DS/CompareWidget2/support/DataCenter","DS/CompareCommon/Utils","DS/CompareCommon/WidgetPreferences","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n,i,r,o){"use strict";function a(e,t,n){var r={callbackList:[]};return((o,a,s)=>{let l=t;Object.defineProperty(r,"value",{enumerable:!0,configurable:!1,get:function(){return l},set:function(t){l!==t&&(l=t,r.callbackList.forEach(e=>e(l)),!0===widget.getValue("saveToWidgetOnly")?widget.setValue(n+"["+e+"]",l):i.saveUserPreferencesPromise(s+"["+o+"]",l).then(()=>{}))}})})(e,0,n),r}function s(e,t){let n=Object.keys(e);!0===widget.getValue("saveToWidgetOnly")?(n.forEach(t=>{this.userSettings[t]=a(t,widget.getValue(this.namespace+"["+t+"]"),this.namespace),e[t].widgetSetting&&r.addWidgetPreference(t,e[t].widgetSetting,this.get(t))}),t()):Promise.allSettled(n.map(e=>i.getUserPreferencesPromise(this.namespace+"["+e+"]"))).then(i=>{for(var o=0,s=i.length;o<s;o++){let t=i[o];"rejected"!==t.status&&null!==t.value&&void 0!==t.value&&""!==t.value?this.userSettings[n[o]]=a(n[o],t.value,this.namespace):(this.userSettings[n[o]]=a(n[o],null,this.namespace),this.set(n[o],e[n[o]].value)),e[n[o]].widgetSetting&&r.addWidgetPreference(n[o],e[n[o]].widgetSetting,this.get(n[o])),widget.setValue(this.namespace+"["+n[o]+"]",this.get(n[o]))}t()})}return e.Class.singleton({init:function(){this.namespace="",this.userSettings={},this.settingsMigrated=!1},get:function(e){return this.userSettings[e].value},set:function(e,t){this.userSettings[e].value=t},hasPref:function(e){return this.userSettings.hasOwnProperty(e)},settingsMigrated:function(){return settingsMigrated},sync:function(e,t,n,i){let r=this;return r.hasPref(t)&&(n=n||t,"function"==typeof i&&r.userSettings[t].callbackList.push(i),Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:function(){return r.get(t)},set:function(e){r.set(t,e)}})),e},unsync:function(e,t,n,i){let r=e[n=n||t];delete e[n],e[n]=r;var o="function"==typeof i?this.userSettings[t].callbackList.indexOf(i):-1;return o>=0&&this.userSettings[t].callbackList.splice(o,1),e},loadSettingsFromConfigPromise:function(e){return r.addWidgetPrefs("V2"),new Promise((t,n)=>{function l(){r.addWidgetPreference("saveToWidgetOnly",{type:"boolean",label:o.saveToWidgetOnly,defaultValue:!1}),t()}require([e.configPath],e=>{this.namespace=e.namespace;var t=function(e,t){var n={};return function e(i,r){for(let a of Object.keys(i))if("namespace"!==a)if(i[a].hasOwnProperty("value")){var o=null!=r&&r.constructor===String?r+t+a:a;n[o]={value:i[a].value},i[a].hasOwnProperty("V1Preference")&&(n[o].V1Preference=i[a].V1Preference),i[a].hasOwnProperty("widgetSetting")&&(n[o].widgetSetting=i[a].widgetSetting)}else e(i[a],null!=r&&r.constructor===String?r+t+a:a)}(e),n}(e,".");r.isV1ToV2PrefMigrationComplete(this.namespace,()=>{this.settingsMigrated=!0,s.bind(this)(t,l)},()=>{r.addWidgetPrefs("V2Migrate"),r.loadDefaults("compare_widget_default_prefs",()=>i.setPreferencesToWidget(["compare_viewer_selectmode","compare_attributes_display_option","compare_attributes_not_shown","compare_attributes_not_shown_INST","compare_attributes_not_shown_EFF"],["viewer_display_mode","attributes_display_option","attributes_not_shown","attributes_not_shown_INST","attributes_not_shown_EFF"],()=>{Object.keys(t).forEach(e=>{if("string"==typeof t[e].V1Preference&&t[e].V1Preference.length){let n=widget.getValue(t[e].V1Preference);this.userSettings[e]=a(e,null,this.namespace),this.set(e,n||t[e].value)}else if(Array.isArray(t[e].V1Preference)&&t[e].V1Preference.length){var n=t[e].V1Preference.reduce((e,t)=>{let n=Object.keys(t)[0];return widget.getValue(n)===t[n].oldValue&&e.push(t[n].newValue),e},[]);this.userSettings[e]=a(e,null,this.namespace),this.set(e,n.length?n:t[e].value)}else if("object"==typeof t[e].V1Preference){let n=t[e].V1Preference,i=Object.keys(n)[0],r=void 0;for(let e=0;e<n[i].length;e++)if(widget.getValue(i)===n[i][e].oldValue){r=n[i][e].newValue;break}this.userSettings[e]=a(e,null,this.namespace),this.set(e,void 0!==r?r:t[e].value)}else this.userSettings[e]=a(e,null,this.namespace),this.set(e,t[e].value);t[e].widgetSetting&&r.addWidgetPreference(e,t[e].widgetSetting,this.get(e)),widget.setValue(this.namespace+"["+e+"]",this.get(e))}),r.setV1ToV2PrefMigrationCompletedFlag(this.namespace).then(l)}))})})})},loadSettingsPromise:function(e){let t=this;return new Promise(n=>{let i={};e.forEach(e=>i[e]={value:null}),s.bind(t)(i,n)})}})}),define("DS/CompareWidget2/viewComponents/MainToolbarEvents",["DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t){"use strict";function n(e,n,i,r,o,a){var s={id:e,type:n,title:t[e]};return"function"==typeof r&&(s.state=!0===r.bind(s)()?"selected":""),null!=i&&(s.icon=i),"function"==typeof o&&(s.action={callback:o.bind(s)}),null!=a&&(s.submenu=a),s}var i=Object.create(null);return i.onClickSwap=function(e){e.objects._privateEventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),e.objects._privateEventMgr.publish({event:"Event_clearView"}),e.objects._privateEventMgr.publish({event:"Event_swapIDs"})},i.onClickRefresh=function(e){e.objects._privateEventMgr.publish({event:"EVENT_FLUSH_DATA_CACHES"}),e.objects._privateEventMgr.publish({event:"Event_clearView"}),e.objects._privateEventMgr.publish({event:"Event_refreshComparison"})},i.onClickX=function(e){e.objects._privateEventMgr.publish({event:"Event_clearComparison"}),e.objects._privateEventMgr.publish({event:"Event_clearView"}),e.objects._privateEventMgr.publish({event:"Event_resetToDropFrame"})},i.onClickExport=function(e){e.objects._privateEventMgr.publish({event:"Event_compareExport"})},i.createViewDropdown=function(e){var t=e.objects.resultFrame._layout;if(!t.maximizedPanel){for(var n=t.getViews(),i=[],r=0;r<n.length;r++){var o=n[r],a={type:"CheckItem",title:o.getLabel(),uid:o.getName(),state:t.isViewOpen(o)?"selected":"",action:{callback:function(){t.onClickShowHideViewCmd(this)},this:o}};i.push(a)}var s=e.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-eye-cog").getBoundingClientRect();require(["DS/Menu/Menu"],e=>e.show(i,{position:{x:s.right,y:s.bottom},layout:"topright"}))}},i.createAdditionalMenu=function(r){var o=[n("compareSettings.includeFacets.externalRelations","PushItem","object-related-cog",null,null,[n("compareSettings.includeFacets.externalRelations.showDocs","CheckItem","doc",function(){return"true"===e.get(this.id)||!0===e.get(this.id)},function(){e.set(this.id,!e.get(this.id)),r.objects._privateEventMgr.publish({event:"Event_refreshComparison"})}),n("compareSettings.includeFacets.externalRelations.showOtherRels","CheckItem","object-related",function(){return"true"===e.get(this.id)||!0===e.get(this.id)},function(){e.set(this.id,!e.get(this.id)),r.objects._privateEventMgr.publish({event:"Event_refreshComparison"})})]),{id:"closeAllObjects",type:"PushItem",title:t.closeAllObjects,icon:"close",action:{callback:function(){i.onClickX(r)}}},{id:"mainToolbarRestoreLayout",type:"PushItem",icon:"reset",title:t.restoreLayout,action:{callback:function(){r.objects.resultFrame.applyDefaultLayout()}}}];r.objects.mainToolbarOptions.forEach(function(e){for(var t=e,n=0;n<o.length;n++)o[n].id.indexOf(t)>=0&&(o.splice(n,1),n--)});var a=r.objects.mainToolbar.elements.container.getElement(".wux-ui-3ds-menu-dot").getBoundingClientRect();require(["DS/Menu/Menu"],e=>e.show(o,{position:{x:a.right,y:a.bottom},layout:"topright"}))},i}),define("DS/CompareWidget2/plugins/plugin",["UWA/Class","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t){return e.extend({_ODTDecycleExcludeKeys:function(){return["___VISITED___"]},setOutputFn:function(e){this._outputFn=e},updateOutput:function(e){null==this._outputFn?this._plugSvcs.warnout("PLUGIN trying to set new output, but no output fn set"):this._outputFn(e)},reportOK:function(e){this.dbgout("------------------------------------------------------------"),0!=this._startMS&&this._plugSvcs.reportTime(this._startMS," Plugin '"+this._plugPath+"' execution "),this.dbgout("->->-> Plugin '"+this._plugPath+"' reports success <<<"),this.dbgout("------------------------------------------------------------"),this.updateOutput(e)},reportKO:function(e){this._plugSvcs.errout("<<< Plugin '"+this._plugPath+"' reports failure:: "+e)},subscribeEvent:function(e,t){if(null==this._subscribeTokens[e]){var n=this._plugSvcs.subscribeTo(e,t);this._subscribeTokens[e]=n}},unsubscribeEvent:function(e){null!=this._subscribeTokens[e]&&(this._plugSvcs.unsubscribe(e),delete this._subscribeTokens[e])},unsubscribeAllEvents:function(){var e=this,t=!0;try{Object.keys(e._subscribeTokens).forEach(function(t){var n=e._subscribeTokens[t];e._plugSvcs.unsubscribe(n)})}catch(n){this._plugSvcs.warnout("problem unsubscribing events in plugin "+e.getName()),t=!1}return e._subscribeTokens={},t},postEvent:function(e,t){this._plugSvcs.postEvent(e,t)},onLoad:function(){return!0},onEnabled:function(){return this._isEnabled=!0,!0},onDisable:function(){this.unsubscribeAllEvents(),this.unsyncAllSettings()},onDisconnect:function(){this.onDisable(),this._pluginOptions={},this._outputFn=null},onDestroy:function(){this.unsubscribeAllEvents(),this._pluginOptions={},this._plugPath=null,this._plugSvcs=null,this._outputFn=null,this._type=null},execute:function(e,t){null!=t&&Object.assign(this._pluginOptions,t,this._pluginOptions),this.dbgout("~~~~ "+this.getPath()+".execute() running... "),this._startMS=this._plugSvcs.nowMS()},enableDebugLabel:function(e){this.dbgout=this._plugSvcs.dbgout,null!=e&&this._plugSvcs.enableDebugLabel(e)},dbgout:function(e){},init:function(e,t,n,i){this._parent(),this._pluginOptions=n||{},this._plugPath=e,this._name=t,this._plugSvcs=i,this._outputFn=null,this._type="PLUGIN",this._subscribeTokens={},this._isEnabled=!1,this.settings={},this._startMS=0},getPath:function(){return this._plugPath},getName:function(){return this._plugPath},getType:function(){return this._type},syncSetting:function(e,n,i,r){t.hasPref(e)&&(n=n||e,this.settings[n]={settingKey:e,callback:i,object:r},t.sync(r||this,e,n,i))},unsyncAllSettings:function(){for([key,value]of Object.entries(this.settings))t.unsync(value.object||this,value.settingKey,key,value.callback)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_TXT_DISPLAY_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){function t(e,t,n){for(var i=e,r=t-e.length,o=0;o<r;o++)i+=" ";return i+=n}function n(e,n){var i=["","    ","        ","            ","                ","                    ","                        ","                            "],r=[];r.push(e.getRoot());var o=[];o.push(0);for(;r.length>0;){var a=r.pop(),s=o.pop(),l=i[s],c=a.get_dbObj_INST();if(null!=c)l=t(l+=null==c?"":c.getAttr("ro.plminstance.plm_externalid"),50,"("+c.getAttr("ds6w:type")+")");var u=a.get_dbObj_REF(),d=u.getAttr("ds6w:label"),p=u.getAttr("ds6wg:revision"),h=u.getAttr("ds6w:type");l=t(l,70,"REF: ["+p+"] "+d),n(l=t(l,115,"("+h+")"));for(var g=a.getChildArray(),_=0;_<g.length;_++){var f=g[_];r.push(f),o.push(s+1)}}}return e.extend({execute:function(e,t){var i=this;i._parent(e,t);for(var r=e,o=r.length,a=0;a<o;a++){var s=r[a];i.dbgout("--------------------------------------- TREE #"+a+" ------------------------------------------"),n(s,i.dbgout),i.dbgout("------------------------------------------------------------------------------------------")}i.reportOK(!0)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_TXT_DISPLAY_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){function t(e,t){t("[---------- ROOT #0----------]"),n("",e.getRoot(0),t),t("[---------- ROOT #1----------]"),n("",e.getRoot(1),t)}function n(e,t,i){i(e+">>>>>>>>>>> NODE >>>>>>>>>>>>>>"),function(e,t,n){n(e+" name : "+t.getAttr("name")),n(e+" title: "+t.getAttr("title")),n(e+" type : "+t.getAttr("type")),n(e+" Rev  : "+t.getAttr("revision"))}(e,t,i),function(e,t,n){var i=t.getMatchInfo();null==i?n(e+" THIS NODE IS UNMATCHED"):(n(e+" ***** MATCH TYPE      : "+i.getRelName()),n(e+" ***** MATCH BASE NODE : '"+i.getBaseNode().getAttr("name")),n(e+" ***** MATCH COMP NODE : '"+i.getCompNode().getAttr("name")))}(e,t,i),i(e+"-------");for(var r=t.getChildArray(),o=0;o<r.length;o++){n(e+"    ",r[o],i)}i(e+"<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<")}return e.extend({execute:function(e,n){var i=this;i._parent(e,n);var r=e.crTreeArray,o=e.ruleNames;i.dbgout(" ruleNames: "+o.join());for(var a=r.length,s=0;s<a;s++){var l=r[s];i.dbgout("--------------------------------------- STRUCT COMPARE RESULT ------------------------------------------"),t(l,i.dbgout),i.dbgout("------------------------------------------------------------------------------------------")}i.reportOK(!0)}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_TXT_DISPLAY_plugin",["DS/CompareWidget2/plugins/plugin"],function(e){function t(e,t,n){for(var i=e,r=t-e.length,o=0;o<r;o++)i+=" ";return i+=n}function n(e,n){e("************************************************************************************************************************"),e("***********************************  A T T R   D U M P  ****************************************************************"),e("*** PHYSICALID:   "+n.getPhysicalID());var i=n.getDBContext();e("***       TYPE:   "+n.getObjType()),e("***  DBCONTEXT:   "+i.tenant+" // "+i.serviceName+" // "+i.securityContext),e("*** iconURL LG:   "+n.getIconURLLarge()),e("***    iconURL:   "+n.getIconURL());var r=n.getAttrCount(),o="   NAME";o=t(o,25,"NLS"),o=t(o,50,"VALUE"),o=t(o,75,"TYPE"),e(o=t(o,100,"UIPosition")),o=t(o="   ----",25,"---"),o=t(o,50,"-----"),o=t(o,75,"----"),e(o=t(o,100,"----------"));for(var a=0;a<r;a++){var s=n.getAttr(a),l="   "+s.name;l=t(l,25,s.nls),l=t(l,50,s.value),l=t(l,75,s.type),e(l=t(l,100,s.UIPosition))}e("************************************************************************************************************************")}return e.extend({execute:function(e,t){this._parent(e,t);for(var i=e,r=i.length,o=0;o<r;o++){i[o];n(this.dbgout,dbgout)}this.reportOK(!0)}})}),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/VIEW3D/view3DJSONEngine_LDV"],function(e,t){return e.extend({execute:function(e,n){this._parent(e,n);var i=e,r=t.refInstTree2ViewerJSON(i,this._plugSvcs);null!=r?this.reportOK(r):this.reportKO()}})}),define("DS/CompareWidget2/support/tenantServiceContext_IDList",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec"],function(e,t){return function(){this._data={},this.addObjIDSpec=function(e){var t=e.getTenant(),n=e.getServiceName(),i=e.getSecurityContext(),r=e.getPhysID();null==this._data[t]&&(this._data[t]={}),null==this._data[t][n]&&(this._data[t][n]={}),null==this._data[t][n][i]&&(this._data[t][n][i]=[]),this._data[t][n][i][r]=e.getObjType()},this.visitEach_doFunc=function(e){var t=this;Object.keys(t._data).forEach(function(n){Object.keys(t._data[n]).forEach(function(i){Object.keys(t._data[n][i]).forEach(function(r){Object.keys(t._data[n][i][r]).forEach(function(o){var a=t._data[n][i][r][o];e(n,i,r,o,a)})})})})},this.getList=function(){var e=[];return this.visitEach_doFunc(function(n,i,r,o,a){var s=new t(o,a,n,i,r);return e.push(s),!0}),e}}}),define("DS/CompareWidget2/plugins/displayPlugin",["DS/CompareWidget2/plugins/plugin","DS/UIKIT/Mask"],function(e,t){return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i),this._type="DISPLAY_PLUGIN",this._frame=null,this._outputPanel=null,this._messagePanel=null},createViewPanelObject:function(e,t){throw new Error("Abstract class called")},showMessage:function(e){null!=this._frame&&(t.isMasked(this._frame)&&this.showNotBusy(),t.mask(this._frame,e),this._frame.getElement(".spinner").destroy(),this._frame.getElement(".mask").setStyle("background-color","rgba(255, 255, 255, 1)"))},removeMessage:function(){this.showNotBusy()},showBusy:function(){null!=this._frame&&t.mask(this._frame)},showNotBusy:function(){null!=this._frame&&t.isMasked(this._frame)&&t.unmask(this._frame)},reportKO:function(e){this.showNotBusy(),this._parent()},isDisplayPlugin:function(){return!0},buildViewPanel:function(e,t){var n=this;this.hideCloseButton=t&&!0===t.hideCloseButton,n._frame=n._plugSvcs.requestFrame(e),n.showBusy(),n._outputPanel=n.createViewPanelObject(n._frame,t),n._plugSvcs.addPanel(e,n._outputPanel,n)},destroyDisplayPanel:function(){var e=this;null!=e._outputPanel&&"function"==typeof e._outputPanel.destroy&&e._outputPanel.destroy(),e._outputPanel=null,e._frame=null},onClearView:function(){null!=this._outputPanel&&this._outputPanel.clearView()},onUpdateInProgress:function(){this.onClearView(),this.showBusy()},onEnabled:function(){return this._frame.show(),this._parent()},onDisable:function(){return null!=this._frame&&this._frame.hide(),this._parent()},onDisconnect:function(){this.destroyDisplayPanel(),this._parent()},onDestroy:function(){return this.destroyDisplayPanel(),this._parent()}})}),define("DS/CompareWidget2/viewComponents/StandardCompareToolbar",["UWA/Core","UWA/Class","DS/Tweakers/GeneratedToolbar","DS/Core/PointerEvents","DS/Menu/Menu","DS/Tweakers/TypeRepresentationFactory","DS/CompareWidget2/support/cw2Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","css!DS/CompareWidget2/assets/css/Controls/Toolbar.css"],function(e,t,n,i,r,o,a,s){"use strict";return t.extend({init:function(e,t,n){this.container=e,this.options=n,this.view=t,this._buildView()},_buildView:function(){var t=this;this.toolbarContainer=e.createElement("div",{class:"compare-view-toolbar-container"}).inject(this.container),!0===this.options.navigateDifferences&&(this.toolbarNavigate=new n({overflowManagement:"dropdown",direction:"horizontal",items:n.prototype.createTreeDocument({entries:[{id:"navigatePrevious",dataElements:{domId:"compare-navigate-previous-button",typeRepresentation:"functionIcon",position:"near",tooltip:s.PreviousDifference,icon:{iconName:"chevron-left",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigatePrevious"}),priority:100}},{id:"numDifferencesCommand",dataElements:{domId:"compare-navigate-differences-button",typeRepresentation:"functionMenuIconCount",label:"Differences",position:"near",tooltip:s.NumberOfDifferences,value:{menu:[{icon:"double-chevron-up",title:s.FirstDifference,domId:"compare-navigate-first-button",event:"navigateFirst"},{icon:"double-chevron-down",title:s.LastDifference,domId:"compare-navigate-last-button",event:"navigateLast"}].map(e=>({type:"PushItem",title:e.title,domId:e.domId,fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-"+e.icon},action:{callback:n=>{t.view.handleToolbarCommands({event:e.event})}}}))},category:1,overflowPriority:"never",priority:100,count:1}},{id:"navigateNext",dataElements:{domId:"compare-navigate-next-button",typeRepresentation:"functionIcon",position:"near",tooltip:s.NextDifference,icon:{iconName:"chevron-right",fontIconFamily:1},category:1,overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"navigateNext"}),priority:100}}]})}),this.toolbarNavigate.inject(this.toolbarContainer),this.toolbarNavigate.elements.container.addClassName("compare-view-toolbar-navigate"),"desktop"!==a.getDeviceType()&&this.toolbarNavigate.elements.container.setAttribute("touch-mode",""),this.onReadyLeftToken||(this.onReadyLeftToken=t.toolbarNavigate.getContent().addEvent("onReady",function(){var e=t.toolbarNavigate.getNodeModelByID("numDifferencesCommand")._associatedView;e&&e.getContent().addClassName("compare-toolbar-differences")})));var i=Array.isArray(this.options.otherMenuItems)&&this.options.otherMenuItems.length?this.options.otherMenuItems:[];if(this.options.showCompareLegend){(new o).registerTypeRepresentations({infoToggle:{stdTemplate:"toggleIcon",semantics:{possibleValues:[{value:"true",icon:"compare-checkbox-check-on"},{value:"false",icon:"compare-checkbox-check-off"}],color:"red"}}});this.toolbar=new n({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:n.prototype.createTreeDocument({entries:[]})}),this.toolbar.elements.container.addClassName("compare-view-toolbar-legend"),this.toolbar.inject(this.toolbarContainer),this.onReadyLegendToken||(this.onReadyLegendToken=t.toolbar.getContent().addEvent("onReady",function(){if(t.legendItems)for(var e in t.legendItems){var n=t.legendItems[e],i=t.toolbar.getNodeModelByID(e);if(i){let a=i._associatedView;if(a){a.getContent().getParent(".wux-generated-toolbar-items").addClassName("compare-toolbar-legend"),a.getContent().id="compare-legend-status-"+n.label;var r=a.getContent().getChildren();r[0].addClassName("compare-toolbar-legend-item"),r[0].setStyles({"text-align":"left",color:"#3d3d3d"});var o=r[0].getChildren();o[0].setStyles({"background-color":"IDENTICAL"===e?"#FFFFFF":n.color,"border-color":"IDENTICAL"===e?"grey":n.color}),"IDENTICAL"===e&&o[0].setStyle("color","grey"),t.toolbar.elements.popupContent.setStyles({"padding-right":"10px","padding-left":"10px","padding-top":"2px","padding-bottom":"2px"})}}}})),i.unshift({id:"chooseStatusToDisplay",dataElements:{domId:"compare-choose-statuses-display-button",typeRepresentation:"functionIcon",tooltip:s.chooseStatusToDisplay,icon:{iconName:"menu-eye",fontIconFamily:1},overflowPriority:"never",value:()=>t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyVisibility"}),position:"far",priority:1}})}Array.isArray(i)&&i.length&&(this.toolbarOtherItems=new n({overflowManagement:"dropdown",direction:"horizontal",popupDisplayStyle:"Basic",items:n.prototype.createTreeDocument({entries:i})}),this.toolbarOtherItems.inject(this.toolbarContainer),this.toolbarOtherItems.elements.container.addClassName(this.options.showCompareLegend?"compare-view-toolbar-right-fixed-width":"compare-view-toolbar-right"))},update:function(e){let t=this,i=["toolbarNavigate","toolbar","toolbarOtherItems"],r=(e,t)=>{i.forEach(n=>{this[n]&&this[n][e].apply(this[n],t)})};r("prepareUpdateView");for(let i in e)switch(i){case"legend":null!=this.legendItems&&Object.keys(this.legendItems).forEach(e=>{this.toolbar.items&&Array.isArray(this.toolbar.items.getRoots())&&this.toolbar.items.getRoots().filter(t=>t._ID.indexOf(e)>=0).forEach(e=>e.remove(!0))}),this.legendItems=e[i];var o={entries:[]};for(let[e,n]of Object.entries(this.legendItems))o.entries.push({id:e,dataElements:{typeRepresentation:"infoToggle",label:n.label,value:n.checked,color:this.legendItems[e].color,visibleFlag:n.visibleFlag},onNodeUpdate:function(e){var i=e.getAttributeValue("data");n.checked=i,t.view.handleToolbarCommands.bind(t.view)({event:"legendApplyFilter"})}});[...n.prototype.createTreeDocument(o).getRoots()].forEach(function(e){t.toolbar.items.addRoot(e)});break;case"numDifferences":null!=t.toolbarNavigate&&(t.toolbarNavigate.getNodeModelByID("numDifferencesCommand").options.count=e[i]);break;case"enableDisableCommands":e[i].forEach(e=>{r("updateNodeModel",[e.id,{disabled:e.disabled}])});break;case"showHideCommands":e[i].forEach(e=>{r("updateNodeModel",[e.id,{visibleFlag:e.visibleFlag}])});break;case"displayIcon":e[i].forEach(e=>{r("updateNodeModel",[e.id,{grid:{semantics:{icon:{iconName:e.icon}}}}])})}r("pushUpdateView")},destroy:function(){}})}),define("DS/CompareWidget2/plugins/MERGE/actionInfos",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/MERGE/MergeConstants","i18n!DS/CompareWidget2/assets/nls/MergePlugin","DS/CompareWidget2/plugins/MERGE/NodeUtils"],function(e,t,n,i){const r=Object.freeze({REVISE:{id:1,name:t.MergeAction.Revise,nls:n.Revise},REUSEREFERENCE:{id:2,name:t.MergeAction.ReuseReference,nls:n.ReuseRef},REUSE:{id:3,name:t.MergeAction.Reuse,nls:n.Reuse},EXCLUDE:{id:4,name:t.MergeAction.Exclude,nls:n.Exclude},INSERTNEW:{id:5,name:t.MergeAction.InsertNew,nls:n.InsertNew}});class o{constructor(e,t,n){this.actionOption=e,this.isSelected=t,this.isEnabled=n}}class a{constructor(){this._actions=[]}addAction(e){this._actions.push(e)}removeActionByOption(e){this._actions=this._actions.filter(t=>t.actionOption!==e)}clearActions(){this._actions=[]}getActions(){return this._actions.sort((e,t)=>e.actionOption.id-t.actionOption.id)}getEnabledActions(){return this._actions.filter(e=>!0===e.isEnabled).sort((e,t)=>e.actionOption.id-t.actionOption.id)}getActionSelected(){for(const e of this._actions)if(e.isSelected)return e}getActionOptionSelected(){return this.getActionSelected().actionOption}getActionByOptionId(e){for(const t of this._actions)if(t.actionOption.id===e)return t;return null}getActionByOptionName(e){for(const t of this._actions)if(t.actionOption.name===e)return t;return null}setEnableActionByOption(e,t){for(const n of this._actions)if(n.actionOption===e){n.isEnabled=t;break}}setSelectedActionByOption(e){for(const t of this._actions)t.isSelected=t.actionOption===e}getEnabledActionCount(){var e=0;for(const t of this._actions)t.isEnabled&&e++;return e}hasActionOptionSelected(e){for(const t of this._actions)if(t.actionOption===e&&t.isSelected)return!0;return!1}hasReuseActionSelected(){return this.hasActionOptionSelected(r.REUSE)}hasOnlyReuseAction(){return 1===this._actions.length&&this._actions[0].actionOption===r.REUSE}hasActionOption(e){for(const t of this._actions)if(t.actionOption===e)return!0;return!1}hasActionOptionEnabled(e){for(const t of this._actions)if(t.actionOption===e&&t.isEnabled)return!0;return!1}}function s(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_INST"),i=t.getCompNode().getAttr("physicalID_INST");return n||i}function l(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_REF"),i=t.getCompNode().getAttr("physicalID_REF");return n||i}return function(e,t){this._actionInfosByRefPid=new Map,this._actionInfosByInstPid=new Map,this._options=t||{reuseReferenceEnabled:!1},this._crNodesByRefPid=new Map,this.getOptions=function(){return this._options},this.addActionInfo=function(e,t,n){this._actionInfosByInstPid.set(t,n),this._actionInfosByRefPid.has(e)?this._actionInfosByRefPid.get(e).set(t,n):this._actionInfosByRefPid.set(e,new Map([[t,n]]))},this.addCrNode=function(e,t){if(this._crNodesByRefPid.has(e))this._crNodesByRefPid.get(e).push(t);else{var n=new Array;n.push(t),this._crNodesByRefPid.set(e,n)}},this.allOtherParentsSetToRevise=function(e){var t=this,n=(s(e),l(e)),i=s(e.getParent());return this._crNodesByRefPid.get(n).every(function(e){var n=s(e.getParent());return n===i||t.getInstActionInfo(n).getActionOptionSelected()===r.REVISE})},this.enableActionOptionForOtherParents=function(e,t,n,i){s(e);var r=l(e),o=s(e.getParent()),a=this._crNodesByRefPid.get(r);for(const e of a){var c=e.getParent(),u=l(c),d=s(c);if(d!==o){var p=this.getInstActionInfo(d);p.setEnableActionByOption(t,n),i.set(u,p.getActionOptionSelected())}}},this.updateActionSelected=function(e,t){var n=new Map,i=(s(e),l(e)),o=r.REVISE.name===t?r.REVISE:r.REUSE.name===t?r.REUSE:r.EXCLUDE.name===t?r.EXCLUDE:r.INSERTNEW.name===t?r.INSERTNEW:r.REUSEREFERENCE.name===t?r.REUSEREFERENCE:null,a=this.getRefActionInfo(i);for(let[e,t]of a.entries())t.hasActionOption(o)&&t.setSelectedActionByOption(o);return n.set(i,o),this.updateChildrenActionSelected(e,o,n),n},this.updateChildrenActionSelected=function(e,t,n){var o=e.getChildArray();for(const S of o){var a=l(S),c=this.getRefActionInfo(a);for(let[o,l]of c.entries())if(i.nodeFollowsParent(S)){var u=s(e),d=this.getInstActionInfo(u),p=Object.assign({},d.getActionSelected());l.clearActions(),l.addAction(p),n.set(a,t)}else{var h=l.getActionSelected().actionOption,g=!0;if(l.hasActionOption(t),h===t&&(g=!1),t===r.REUSE)l.setEnableActionByOption(r.REVISE,!1),l.setEnableActionByOption(r.REUSEREFERENCE,!1),l.setEnableActionByOption(r.INSERTNEW,!1),l.setEnableActionByOption(r.REUSE,!0),l.setSelectedActionByOption(r.REUSE),this.enableActionOptionForOtherParents(S,r.REUSEREFERENCE,!1,n),this.enableActionOptionForOtherParents(S,r.REUSE,!0,n);else if(t===r.REUSEREFERENCE)l.setEnableActionByOption(r.REVISE,!1),l.setEnableActionByOption(r.REUSE,!1),l.setEnableActionByOption(r.INSERTNEW,!1),l.setEnableActionByOption(r.REUSEREFERENCE,!0),l.setSelectedActionByOption(r.REUSEREFERENCE),this.enableActionOptionForOtherParents(S,r.REUSE,!1,n),this.enableActionOptionForOtherParents(S,r.REUSEREFERENCE,!0,n);else if(t===r.REVISE){if(this.allOtherParentsSetToRevise(S)){l.setEnableActionByOption(r.REVISE,!0),l.setEnableActionByOption(r.REUSE,!0),l.setEnableActionByOption(r.INSERTNEW,!0);var _=l.hasActionOption(r.INSERTNEW);l.setEnableActionByOption(r.REUSEREFERENCE,!_),_&&h==r.REUSEREFERENCE&&(t=r.INSERTNEW,h=r.INSERTNEW),l.setSelectedActionByOption(h),this.enableActionOptionForOtherParents(S,r.REUSE,!0,n),this.enableActionOptionForOtherParents(S,r.REUSEREFERENCE,!0,n)}}else if(t===r.INSERTNEW){l.setEnableActionByOption(r.INSERTNEW,!0),l.setEnableActionByOption(r.REUSE,!0),l.setEnableActionByOption(r.REUSEREFERENCE,!1);var f=h===r.REUSEREFERENCE?r.INSERTNEW:r.REUSE;l.setSelectedActionByOption(f)}!g||t!==r.REUSE&&t!==r.REUSEREFERENCE&&t!==r.INSERTNEW||this.updateChildrenActionSelected(S,t,n),n.set(a,t)}}},this.getInstActionInfo=function(e){return this._actionInfosByInstPid.get(e)},this.getRefActionInfo=function(e){return this._actionInfosByRefPid.get(e)},this.hasInstActionInfo=function(e){return this._actionInfosByInstPid.has(e)},this.hasRefActionInfo=function(e){return this._actionInfosByRefPid.has(e)};var n,c=(n=e.getRoot(0)).getAttr("physicalID_REF"),u=n.getAttr("physicalID_INST"),d=new a;d.addAction(new o(r.REVISE,!0,!0)),this.addActionInfo(c,u,d),this.addCrNode(c,n),function e(t,n){var s=t.getAttr("physicalID_REF"),l=t.getAttr("physicalID_INST"),c=t.getMatchInfo();c&&(s=c.getBaseNode().getAttr("physicalID_REF"),l=c.getBaseNode().getAttr("physicalID_INST"),s||(s=c.getCompNode().getAttr("physicalID_REF"),l=c.getCompNode().getAttr("physicalID_INST")));var u=n.getInstActionInfo(l),d=u.hasReuseActionSelected(),p=u.hasOnlyReuseAction(),h=t.getChildArray();for(const t of h){var g=t.getAttr("physicalID_REF"),_=t.getAttr("physicalID_INST");if(g&&n.addCrNode(g,t),!n.hasInstActionInfo(_)){n.hasRefActionInfo(g);var f=new a;if(i.nodeFollowsParent(t)){var S=Object.assign({},u.getActionSelected());f.addAction(S),n.addActionInfo(g,_,f),e(t,n)}else{var m=t.getMatchInfo();if(m){var E=m.getRelName(),C=m.getBaseNode(),v=C.getAttr("physicalID_REF"),T=(C.getAttr("physicalID_INST"),m.getCompNode()),R=T.getAttr("physicalID_REF"),I=T.getAttr("physicalID_INST");p?f.addAction(new o(r.REUSE,!0,!0)):v===R||d?(f.addAction(new o(r.REUSE,!0,!0)),f.addAction(new o(r.REVISE,!1,!d)),n.getOptions().reuseReferenceEnabled&&f.addAction(new o(r.REUSEREFERENCE,!1,!0))):v&&R?i.nodeCanBeRevised(t)?(f.addAction(new o(r.REVISE,!0,!0)),f.addAction(new o(r.REUSE,!1,!0)),n.getOptions().reuseReferenceEnabled&&f.addAction(new o(r.REUSEREFERENCE,!1,!0))):f.addAction(new o(r.REUSE,!0,!0)):v&&!R&&"LEFT_ONLY"==E?f.addAction(new o(r.EXCLUDE,!0,!0)):!v&&R&&"RIGHT_ONLY"==E&&(n.addCrNode(R,T),g=R,_=I,f.addAction(new o(r.REUSE,!1,!0)),f.addAction(new o(r.INSERTNEW,!0,!0)),n.getOptions().reuseReferenceEnabled&&f.addAction(new o(r.REUSEREFERENCE,!1,!1)))}else f.addAction(new o(r.EXCLUDE,!0,!0));n.addActionInfo(g,_,f),e(t,n)}}}}(n,this),function e(t,n){var i=t.getChildArray();for(const t of i){var s=t.getAttr("physicalID_REF"),l=t.getAttr("physicalID_INST");if(!n.hasInstActionInfo(l)){if(n.hasRefActionInfo(s),!t.getMatchInfo()){var c=new a;c.addAction(new o(r.REUSE,!1,!0)),c.addAction(new o(r.INSERTNEW,!0,!0)),n.addActionInfo(s,l,c)}e(t,n)}}}(n=e.getRoot(1),this)}}),define("DS/CompareWidget2/plugins/MERGE/MERGE_COMPUTE_ACTIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/MERGE/actionInfos"],function(e,t){return e.extend({onLoad:function(){return this._parent()},onDestroy:function(){return this._parent()},execute:function(e,n){var i=this;i._parent(e,n);var r=e.crTreeArray[0],o=this._getTreeNodesReviseAccessInfo(r),a=this._getTreeNodesAttributeInfo(r),s=this._getReuseReferenceEnabled(r);UWA.Promise.all([o,a,s]).then(n=>{var o=n[0],a=n[1],s=n[2];i._populateReviseAccessInfo(o,r),i._populateAttributeInfo(a,r);var l=new t(r,{reuseReferenceEnabled:s});if(null!=e.crTreeArray){var c={crTreeArray:e.crTreeArray,ruleNames:e.ruleNames,actionInfos:l,destroy:function(){}};i.reportOK(c)}else i.reportKO()})},_getAttributes:function(){return["attribute[PLMEntity.V_usage]","attribute[PLMCoreRepReference.V_isOnceInstantiable]","attribute[XCADEmbeddedCmp.V_IsEmbeddedComponent]","type.kindof[BundleFastenerAbstract]","firstRevision","majorid.lastmajorid.bestsofar.attribute[PLMEntity.V_Name]","policy","last.current"]},_getReviseAccessAttributes:function(){return["majorid.lastmajorid.bestsofar.current.access[majorrevise]","majorid.lastmajorid.bestsofar.current.access[revise]","last.current.majorrevisionable","last.current.revisionable"]},_getTreeNodesAttributeInfo:function(e){var t=this._getAttributes(),n=new Set;for(let t=0;t<2;t++)e.visitAll_treeAndFN(t,function(e){var t=e.getAttr("physicalID_REF");t&&n.add(t)});return this._getAttributeInfo(e,n,t)},_getTreeNodesReviseAccessInfo:function(e){var t=this._getReviseAccessAttributes(),n=new Set;for(let t=0;t<1;t++)e.visitAll_treeAndFN(t,function(e){var t=e.getAttr("physicalID_REF");t&&n.add(t)});return this._getAttributeInfo(e,n,t)},_getAttributeInfo:function(e,t,n){var i=this;return new UWA.Class.Promise(function(r,o){var a={data:[],attributes:n};t.forEach(function(e){if(-1===a.data.findIndex(t=>t.physicalid===e)){var t={physicalid:e};a.data.push(t)}});var s=e.getRoot(0).getObjIDSpec_REF(),l=s.getTenant(),c=s.getServiceName(),u=s.getSecurityContext(),d=i._plugSvcs.nowMS();i._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/product/attributeList","POST",a,"json",l,c,u).then(function(e){i._plugSvcs.reportTime(d,"attributeList request OK.");var t="string"==typeof e?JSON.parse(e):e;r(t)},function(e){i._plugSvcs.reportTime(d,"attributeList request failed."),i._plugSvcs.showAlertBox("attributeList request unsuccessful.",null,"error"),i._plugSvcs.errout("Failure of attributeList request: "+e)})})},_populateAttributeInfo:function(e,t){e.getAttInfo=function(e){return this.results.find(t=>t.physicalid===e)};var n=this._getAttributes();for(let i=0;i<2;i++)t.visitAll_treeAndFN(i,function(t){var i=t.getAttr("physicalID_REF");if(i){var r=e.getAttInfo(i);r&&n.forEach(function(e){t.addAttr(e,r[e])})}})},_populateReviseAccessInfo:function(e,t){e.getAttInfo=function(e){return this.results.find(t=>t.physicalid===e)};var n=this._getReviseAccessAttributes();for(let i=0;i<1;i++)t.visitAll_treeAndFN(i,function(t){var i=t.getAttr("physicalID_REF");if(i){var r=e.getAttInfo(i);r&&n.forEach(function(e){t.addAttr(e,r[e])})}})},_getReuseReferenceEnabled:function(e){var t=this;return new UWA.Class.Promise(function(n,i){var r=e.getRoot(0).getObjIDSpec_REF(),o=r.getTenant(),a=r.getServiceName(),s=r.getSecurityContext(),l=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/util/getExpression","GET","expression=ReuseReferenceEnabled","json",o,a,s).then(function(e){t._plugSvcs.reportTime(l,"getExpression request OK.");var i=!1;e&&e.result&&(i="true"===e.result),n(i)},function(e){t._plugSvcs.reportTime(l,"getExpression request failed."),t._plugSvcs.showAlertBox("getExpression request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getExpression request: "+e)})})}})}),define("DS/CompareWidget2/support/cw2CacheMgr",["UWA/Class","DS/CompareWidget2/support/cw2Utils"],function(e,t){var n=function(){this.data={},this.putEntry=function(e,t){this.data[e]=t},this.getEntry=function(e){return this.data[e]},this.flush=function(){this.data={}},this.getSize=function(){return Object.keys(this.data).length},this.putArray=function(e){for(var t=e.length,n=0;n<t;n++){var i=e[n],r=i.name;this.putEntry(r,i)}}};return e.singleton({init:function(){this._cacheSet={}},flushAll:function(){this._cacheSet={}},flushCache:function(e){null!=this._cacheSet[e]&&(this._cacheSet[e]={})},getCache:function(e,t){return null==this._cacheSet[e]&&0!=t&&(this._cacheSet[e]=new n),this._cacheSet[e]},putCacheObj:function(e,t,n){this.getCache(e,!0).putEntry(t,n)},putCacheObjArray:function(e,t){for(var n=t.length,i=0;i<n;i++){var r=t[i],o=r.name;this.putCacheObj(e,o,r)}},getCacheObj:function(e,t){var n=this.getCache(e,!1);return ret=null!=n?entry=n.getEntry(t):void 0,ret},getSize:function(e){if(null==e)return Object.keys(this._cacheSet).length;var n=this.getCache(e,!1);return null==n?(t.errout("Cache '"+e+"' not found);"),null):n.getSize()},getTotalCachesSize:function(){return t.sizeof(this._cacheSet)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview",["UWA/Controls/Abstract","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){function n(e,n,r,o,a,s){for(var l=a,c=o-r,u=0,d=[],p=0;p<n.length;p++)1==s[n[p].flagName].visibleFlag&&(u++,d.push(p));for(var h=c/u,g=0;g<u;g++){var _=r+g*h,f=_+h,S=n[d[g]].COLOR;null==s||null==s[n[d[g]].flagName]||s[n[d[g]].flagName].visibleFlag||(S=null!=s.IDENTICAL?s.IDENTICAL.color:""),""!==S&&S!=t.colorDef.WHITE&&i(e,S,_,f,l)}}function i(e,t,n,i,r){e.strokeStyle=t,e.beginPath(),e.moveTo(n,r),e.lineTo(i,r),e.stroke()}return e.extend({init:function(e){var t=this;t._parent(e),t._treeRowHeight=22,t._gap=5,t._lineLength=23,t._selectedIDSet={},t._keyList=[],t.buildSkeleton()},drawLines:function(e){var r=this;if(null==r._keyList);else{var o=r._keyList.length,a=10+r._lineLength-12,s=Math.floor(1+.5*r._gap),l=10+r._lineLength-6,c=document.getElementById("compareV2-OverviewCanvas");if(null==c)return;var u=c.getContext("2d");u.clearRect(0,0,c.width,c.height),u.lineWidth=c.height/3>o?2:1;for(var d=0;d<o;d++){var p=r._keyList[d].flagDefArray;1==r._selectedIDSet[d]?(u.lineWidth++,1!=p.length||""!=p[0].COLOR&&p[0].COLOR!=t.colorDef.WHITE?n(u,p,1,l,s,e):i(u,t.colorDef.BLACK,1,l,s),u.lineWidth--):n(u,p,10,a,s,e),s+=r._gap}}},doResize:function(){var e=jQuery("div#compare-tree-left")[0];if(null!=e){e.clientHeight;var t=jQuery("div#compareV2-overview-container")[0],n=t.clientHeight,i=t.clientWidth,r=(jQuery("div#compareV2-overview"),jQuery("#compareV2-OverviewCanvas")[0]);null!=r&&(r.width=i,r.height=n,0==this._keyList.length||(this._gap=(n-2)/this._keyList.length))}},getNodeIndex:function(e){if(null!=me._keyList&&null!=e)for(var t=0;t<me._keyList.length;t++)if(me._keyList[t].objKey==e)return t;return-1},doInit:function(e){var t=e;"NONE"!=e&&"string"==typeof e&&(t=getNodeIndex(e)),this._setSelectedIDArray([t]),this._syncIt(!0)},buildSkeleton:function(){var e=this;e.targetElement=this.elements.container=UWA.createElement("div",{id:"compareV2-overview-container"}),e.rootElement=UWA.createElement("div",{id:"compareV2-overview-toplevel",html:[{tag:"div",id:"compareV2-overview",html:[{tag:"div",id:"compareV2-canvas-buffer",html:[{tag:"canvas",id:"compareV2-OverviewCanvas"}]}]}]}),e.rootElement.inject(e.targetElement),jQuery(document).ready(function(){var t=null,n=!1,i=300;function r(){new Date-t<i?setTimeout(r,i):(n=!1,"none"!==jQuery("#compareV2-overview-container").css("display")&&e._syncIt(!0))}jQuery(window).resize(function(){t=new Date,!1===n&&(n=!0,setTimeout(r,i))})})},onResize:function(){var e=this;setTimeout(function(){e._syncIt(!0)},0)},update:function(e,t=0){this._keyList=e},destroy:function(e){this.rootElement&&(this.rootElement.destroy(),this.rootElement=null)},_setSelectedIDArray:function(e){var t=this;t._selectedIDSet={},e.forEach(function(e){t._selectedIDSet[e]=!0})},_syncIt:function(e,t){null!=t&&(this._allFlagDefs=t),1==e&&this.doResize(),this.drawLines(this._allFlagDefs)},sync:function(e,t,n){this._setSelectedIDArray(t),this._syncIt(e,n)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees",["UWA/Controls/Abstract","UWA/Core","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/widget/controls/TreesContainer","DS/CompareWidget2/widget/controls/TreePanel"],function(e,t,n,i,r,o,a){"use strict";return e.extend({init:function(e){this.dataGridConfigArray=e.dataGridConfigArray,this._parent({}),this.onSelectRow=e.onSelectRow,this.onUnselectRow=e.onUnselectRow,this.cols=e.cols,this._eachGridColorColumns=[];let t=this;this._currentlySelectedRowIDs=[],this.treeContainers=[],this.onContextMenu=e.onContextMenu,this.rowSelection=e.rowSelection,this.dataGridConfigArray.forEach((e,n)=>{var i=e.cols.find(e=>"tree"===e.dataIndex),r=i.onCellRequest;i.onCellRequest=(e=>{t.onCellRequest(e,t.dataGridViews[n]),"function"==typeof r&&r(e)})}),this.onScroll=e.onScroll,this.onExpand=e.onExpand,this.onCollapse=e.onCollapse,this.treeContainers=[],this.treePanels=[],this.treesContainer=new o,e.dataGridConfigArray.forEach(function(e,n){var i=e.gridViewContainerParams,r=new a({caption:i.panelCaption,addClass:i.panelAddClass,contentId:i.id,contentBorderTop:i.styles["border-top"],collapseable:i.panelCollapseable,initSize50pct:!!i.initSize50pct&&i.initSize50pct,colorIndicator:e.colorIndicator});t.treePanels.push(r),t.treeContainers.push(r.elements.content),t.treesContainer.addPanel(r)}),this.elements.container=this.treesContainer.elements.container},show:function(){this.getContent().style.display="flex"},restorePreviousSelection:function(){var e=this,t=this.getNTHGridSelectedNodes(0);this.clearNTHGridSelection(0);var n=!1;if(t.forEach(t=>{var i=t._rowID,r=e.dataGridViews[0].model.find(e=>e._rowID===i&&e.isVisible());r&&(r.select(),n=!0)}),!n){var i=e.dataGridViews[0].model.find(e=>e.isVisible());i&&i.select()}},onDataGridViewsReady:function(e){let t=this;this.dataGridViews.forEach(e=>{t.syncScrolling(e),t.syncExpandCollapse(e.getTreeDocument()),t.subscribeForTreeSync(e)}),e()},clear:function(){this.treeContainers.forEach(e=>e.empty())},update:function(e,i){this.clear();var o=this;Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[],this.dataGridConfigArray.forEach((e,i)=>{var a=t.createElement("div",{class:"compare_tree_list_view"});a.inject(o.treeContainers[i]);var s=new r({enableListSelection:!0,treeDocument:new n({}),columns:o._eachGridColorColumns[i].concat(e.cols),defaultColumnDef:{minWidth:8.5},layoutOptions:{rowsHeader:0===i},rowSelection:o.rowSelection,selectionBehavior:{unselectAllOnEmptyArea:!1,selectOnContextualEvent:!0},onContextualEvent:function(e){return new Promise(function(t){o.onContextMenu(e).then(function(e){t(e)})})}});o.dataGridViews.push(s),s.inject(a)}),Promise.all(this.dataGridViews.map(e=>new Promise(t=>e.onPostUpdateViewOnce(()=>t())))).then(()=>o.onDataGridViewsReady(i)),this.withUpdateLocked(function(){o.dataGridViews.forEach((t,n)=>{o.buildDataGridView(t,e[n],n),t.getTreeDocument().getRoots()[0].select()}),"function"==typeof o.onSelectRow&&o.onSelectRow(),"cw2_unittest_client"===widget.id&&i()})},buildDataGridView:function(e,t,n){t.constructor!=Array&&(t=[t]),e.getNodesXSO().empty(),e.getTreeDocument().empty();var i=this;this.dbgcnt=0,this.asRoot=0,this.asChild=0;var r=e.getTreeDocument();r.withTransactionUpdate(function(){t.forEach(function(e){i.asRoot++,i.crNode2tNode(e,r,n)})}),e.elements.container.style.top="4px",e.layout.columnsHeader=!1,e.layout.rowsHeader=!1,e.cellSelection="none",e.showCellActivationFlag=!1,e.selected=[]},crNode2tNode:function(e,t,n){this.dbgcnt++;var r=this,o=null;if("function"!=typeof r.dataGridConfigArray[n].createTreeNodeConfig)throw Error("Trees:crNode2tNode - createTreeNodeConfig not defined");if(o=new i(r.dataGridConfigArray[n].createTreeNodeConfig(e)),null==t)throw new Error("crNode2tNode: Parent node is null");t.addChild(o),e.__TREENODE__=o,"function"==typeof r.dataGridConfigArray[n].setTreeNodeExpand_VisibilityState?r.dataGridConfigArray[n].setTreeNodeExpand_VisibilityState(o):o.expand(),e.setExpandCollapseState(o.getState()),e.getChildArray().forEach(function(e){r.asChild++,r.crNode2tNode(e,o,n)})},hasNextNonEmptyBrother:function(e){for(var t=!1,n=e.getNextBrother();null!=n&&!(t=""!=n.getLabel());)n=n.getNextBrother();return t},hideParentLinks:function(e,t,n){},drawDiffFlags:function(e,n){var i=n.cellView.elements.tags;if(null==i){i=t.createElement("div",{styles:{display:"flex",width:5*this._maxFlagsPerDiff+"px"}});var r=n.cellView.elements.container;r.insertBefore(i,r.children[0]),n.cellView.elements.tags=i}i.innerHTML="";for(var o=0;o<e.length;o++){var a=e[o];t.createElement("span",{styles:{width:"5px",background:a.COLOR}}).inject(i)}},drawLinks:function(e,t){var n=this.hasNextNonEmptyBrother(e.nodeModel),i=e.cellView.elements.linksContainer.getChildren()[0];if(null!=i){var r=i.getChildren();if(!n){var o=r[r.length-1];null==e.nodeModel.getLabel()?o.setStyle("visibility","hidden"):o.setStyle("height","50%")}this.hideParentLinks(e.nodeModel,r,1)}null==e.nodeModel.getLabel()?e.cellView.elements.expanderContainer.hide():(e.cellView.elements.expanderContainer.show(),e.cellView.elements.expanderContainer.setStyle("visibility","visible"),e.cellView.elements.linksContainer.setStyle("visibility","visible"))},onCellRequest:function(e,t){t.defaultOnCellRequest(e),this.drawLinks(e,t)},isScrollbarShown:function(){if(null!=this.dataGridViews){var e=this.dataGridViews[0].elements,t=this.dataGridViews[1].elements;return e.poolContainer.clientHeight>e.container.clientHeight&&t.poolContainer.clientHeight>t.container.clientHeight}return!1},syncExpandCollapse:function(e){function t(t,n){var i=this;return r=>{if(null!=r.data.virtualRowID){for(var o=i.dataGridViews.reduce((t,n)=>n.getTreeDocument()!==e?(t.push(n),t):t,[]),a=0;a<o.length;++a){var s=o[a];if(null!=s){if(!0===s._isSyncing)return;s._isSyncing=!0;let e=s.model.find(({_rowID:e})=>e===r.data.virtualRowID);null==e||void 0===e[t]||null===e[t]?console.log("expandOrCollapse failure"):e[t](),s._isSyncing=!1}}"function"==typeof i[n]&&i[n](r.data)}}}e.onPostExpand(t.bind(this)("expand","onExpand")),e.onPostCollapse(t.bind(this)("collapse","onCollapse"))},syncScrolling:function(e){var t=this,n=t.dataGridViews.reduce((t,n)=>n!==e?(t.push(n),t):t,[]),i=e._getScroller();i.onScrollBegin(n=>{t._activeScrollingGrid||(t._activeScrollingGrid=e)}),i.onScroll(i=>{t._activeScrollingGrid===e&&setTimeout(()=>{var i=e.getScrollerPosition();n.forEach(e=>e.setScrollerPosition(i)),"function"==typeof t.onScroll&&t.onScroll(i,e)},0)}),i.onScrollEnd(n=>{t._activeScrollingGrid===e&&(t._activeScrollingGrid=null)})},selectByCrNodes:function(e){var t=this;t.withUpdateLocked(()=>{e.forEach((e,n)=>{for(var i=e.__TREENODE__;null!=i&&!i._isVisible();)i=i.getParent();var r=i._getRowID();t.dataGridViews.forEach((e,t)=>{var i=e.model.find(({_rowID:e})=>e===r);if(null!=i&&!i.isSelected()){0===n&&0===t&&e.ensureNodeModelVisible(i,!0,!1,.5),e.selectNodeModel(i,!0,!1)}})})})},subscribeForTreeSync:function(e){var t=this;e.getTreeDocument().subscribe({event:"select"},function(n){var i=n.data.nodeModel._getRowID();t.dataGridViews.reduce((t,n)=>n!==e?(t.push(n),t):t,[]).forEach(e=>{var t=e.model.find(({_rowID:e})=>e===i);null==t||t.isSelected()||e.selectNodeModel(t,!0,!1)}),-1===t._currentlySelectedRowIDs.indexOf(i)&&(t._currentlySelectedRowIDs.push(i),"function"==typeof t.onSelectRow&&t.onSelectRow())}),e.getTreeDocument().subscribe({event:"unselect"},function(n){var i=n.data.nodeModel._getRowID(),r=t.dataGridViews.reduce((t,n)=>n!==e?(t.push(n),t):t,[]),o=!1;r.forEach(e=>{var t=e.model.find(({_rowID:e})=>e===i);null!=t&&t.isSelected()&&(o=!0,e.unselectNodeModel(t))}),1==o&&-1!==t._currentlySelectedRowIDs.indexOf(i)&&(t._currentlySelectedRowIDs.splice(t._currentlySelectedRowIDs.indexOf(i),1),"function"==typeof t.onUnselectRow&&t.onUnselectRow())})},prepareUpdateView:function(){this.dataGridViews.forEach(e=>e.prepareUpdateView())},pushUpdateView:function(){this.dataGridViews.forEach(e=>e.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0))},withUpdateLocked:function(e){this.prepareUpdateView(),e(),this.pushUpdateView()},setEachGridColorColumns:function(e){this._eachGridColorColumns=e},getNTHGridSelectedNodes:function(e){return this.dataGridViews[e].getNodesXSO().get()},clearNTHGridSelection:function(e){this.dataGridViews[e].getNodesXSO().empty()},setPanelCaption:function(e,t){this.treesContainer.setPanelCaption(e,t)},destroy:function(){Array.isArray(this.dataGridViews)&&this.dataGridViews.length&&(this.dataGridViews.forEach(e=>e.destroy()),this.dataGridViews=[]),this.clear()}})}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel",["DS/CompareCommon/DragAndDrop","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdDataListItem","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Overview","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/Trees","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structExpandCollapseMenu","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/externalController","DS/UIKIT/Mask","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!UIKIT/UIKIT.css","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,n,i,r,o,a,s,l,c,u,d,p,h){"use strict";return i.extend({init:function(e,t,n){this._parent(n),this._plugSvcs=t,this._collapse3DPARTS=1==n.COLLAPSE_3DPARTS,this._prevStatusFilterState=null,this._skeletonBuilt=!1,this._OKfn_forShowResults=null,this.elements.container=e,this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:p.StructureView,expandCollapseEnabled:!0},{id:"list",icon:"view-list",title:p.ListView,expandCollapseEnabled:!1}],this._displayMode="tree",this._multiStatusesToHideAnd=!1,this._statusesHidden=[],this._statusesUnchecked=[],this._structMatchPairArray=[],this._listMatchPairArray=[],this._listIsComputed=!1,this._structIsComputed=!1,this._currentExpandMenuId="expandAll",this._activeColData=null,this._activeDiffFlagInfo=null,this._activeTrees=null,this._activeMatchPairArray=[],this.columnsForColor={tree:[],list:[]},this._suspendExpandUpdates=!1;var i=n.CONTEXT_MENU_PLUGIN||"DS/CompareWidget2/viewComponents/ContextMenuBase",r=this;require([i],function(e){r._contextMenuPlugin=new e({structComparePanel:r}),r.buildSkeleton(n)},function(e){console.error("FAILED TO LOAD "+contextMenuPlugin+": msg:"+e)}),this._externalController=new u(this._getActiveTree.bind(this),this.isList.bind(this),t.dbgout)},getExternalController:function(){return this._externalController},_getActiveTree:function(){return this._activeTrees},buildSkeleton:function(t){var n=this.elements.container;this._expandCollapseMenu=new l({structComparePanel:this}),this.standardToolbar=new s(n,this,{navigateDifferences:!0,showCompareLegend:!0,otherMenuItems:this.applyOtherMenuCommands()});var i=t.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,r=t.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;if(this._structTrees=new o({dataGridConfigArray:this.generateDataGridConfig({baselineColor:i,compareColor:r,displayView:"tree"}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),onCollapse:this.onTreesCollapse.bind(this),onExpand:this.onTreesExpand.bind(this),baselineColor:i,compareColor:r,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"multiple"}),this._structTrees.inject(n),this._listTrees=new o({dataGridConfigArray:this.generateDataGridConfig({baselineColor:i,compareColor:r,displayView:"list"}),onSelectRow:this.onTreesSelectRow.bind(this),onUnselectRow:this.onTreesUnselectRow.bind(this),baselineColor:i,compareColor:r,onContextMenu:this._contextMenuPlugin.createContextMenu.bind(this._contextMenuPlugin),rowSelection:"single"}),this._listTrees.inject(n),this._listTrees.hide(),this._skeletonBuilt=!0,e.attachObject("compare-tree-left",this,this.dragEnterPanel,this.dragLeavePanel,this.dropHandler),e.attachObject("compare-tree-right",this,this.dragEnterPanel,this.dragLeavePanel,this.dropHandler),e.attachObject("compare-list-left",this,this.dragEnterPanel,this.dragLeavePanel,this.dropHandler),e.attachObject("compare-list-right",this,this.dragEnterPanel,this.dragLeavePanel,this.dropHandler),null!=this._OKfn_forShowResults){var a=this._OKfn_forShowResults;this._OKfn_forShowResults=null,this._doShowResults(a)}},dragEnterPanel:function(e){void 0!==e.currentTarget&&null!==e.currentTarget&&e.currentTarget.parentElement.addClassName("ft-drop-cue-on")},dragLeavePanel:function(e){void 0!==e.currentTarget&&null!==e.currentTarget&&e.currentTarget.parentElement.removeClassName("ft-drop-cue-on")},dropHandler:function(i,r,o){if(r.objArray.length>1)this._plugSvcs.showAlertBox("DROP_1_OBJ_REPLACE",h,"error");else{for(var s=t.fetchPersistedIDs(),l=r.objArray,c=l.map(function(e){return e.objectId}),u=l.map(function(e){var t={};for(var n in e)t[n]=e[n];return t}),d=c.length,p=0;p<d;++p){var g=new n(c[p],u[p]);"drop-left"===o?s.items[0]=g:"drop-right"===o&&(s.items[1]=g)}t.persistIDs(s);var _="drop-left"===o?0:1,f=[];r.objArray.forEach(function(e){var t=new a(e.objectId,e.objectType,e.contextId,e.envId,e.serviceId);f.push(t)}),this._plugSvcs.postEvent("Event_replaceCompare",{targetIndex:_,objIDSpecArray:f}),e.reset()}},generateDataGridConfig:function(e){var t="4px solid "+e.baselineColor,n="4px solid "+e.compareColor;return[{cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](),gridViewContainerParams:{id:"tree"===e.displayView?"compare-tree-left":"compare-list-left",styles:{display:"flex","flex-direction":"column","border-top":t,width:"50%"},panelCaption:"Left",panelAddClass:"treePanel-cmpBase",panelCollapseable:!0,initSize50pct:!0,color:e.baselineColor},createTreeNodeConfig:this.createDataForTreeNode.bind(this),colorIndicator:e.baselineColor},{cols:this["tree"===e.displayView?"getTreeCols":"getListCols"](),gridViewContainerParams:{id:"tree"===e.displayView?"compare-tree-right":"compare-list-right",styles:{display:"flex","flex-direction":"column","border-top":n,padding:"0px 3px",width:"50%"},panelCaption:"Right",panelAddClass:"treePanel-cmpCmp",panelCollapseable:!1,initSize50pct:!0},createTreeNodeConfig:this.createDataForTreeNode.bind(this),colorIndicator:e.compareColor}]},getTreeCols:function(){return[{dataIndex:"tree",typeRepresentation:"string",width:"auto"},{dataIndex:"rev",width:35,typeRepresentation:"string"}]},getListCols:function(){return[{dataIndex:"qty",width:30},{dataIndex:"tree",width:"auto"},{dataIndex:"rev",width:50}]},getEachGridColorColumns:function(){for(var e=this,t=[[]],n=[],i=0;i<this.numberOfColumnsForColor;i++){var r={typeRepresentation:"color",dataIndex:"FLAG_"+i.toString(),width:8.5,minWidth:8.5,hasCellValue:function(t){var n=!1;if(0===this.columns[t.columnID].dataIndex.indexOf("FLAG_")){var i=t.nodeModel.options.data.flagArray,r=Number(this.columns[t.columnID].dataIndex.split("_")[1]),o=e._activeDiffFlagInfo;Array.isArray(i)&&r<i.length&&null!=i[r].color&&i[r].color!==c.colorDef.WHITE&&o.allFlagDefs[i[r].flagName].visibleFlag&&(n=!0)}return n},getCellTooltip:function(t){var n,i=t.nodeModel.options.data.flagArray,r=Number(t.columnID),o=e._activeDiffFlagInfo;return Array.isArray(i)&&r<i.length&&i.length>0&&null!=i[r].color&&o.allFlagDefs[i[r].flagName].visibleFlag&&(n=o.allFlagDefs[i[t.columnID].flagName].label),{shortHelp:n||"",updateModel:!1}},onCellRequest:function(e){this.defaultOnCellRequest(e),e.cellView.getContent().addClassName("compare-color-column")}};n.push(r)}return t.push(n),t},createDataForTreeNode:function(e){var t={data:e,label:e.getAttr("title"),icons:[e.getAttr("typeIconSmallURL")],grid:{rev:e.getAttr("revision")}};return"relations"!==e.getAttr("type")&&(t.grid.qty=e.qty),e.isFiltered()&&(t.badges={bottomRight:"filter wux-layouts-treeview-badge compare-badge"}),Array.isArray(e.flagArray)&&e.flagArray.length&&e.flagArray.forEach((e,n)=>t.grid["FLAG_"+n]=e.color),t},applyOtherMenuCommands:function(){var e=this,t=[];return this._allowedDisplayModes.some(e=>e.expandCollapseEnabled)&&t.push({id:"expandCollapse",dataElements:{domId:"compare-struct-expansion-button",typeRepresentation:"functionIcon",label:p.chooseTreeExpansion,position:"far",priority:1,overflowPriority:"never",icon:{iconName:"expandAll"===e._currentExpandMenuId?"flow-tree-expand-down":"flow-tree-expand-up",fontIconFamily:1},value:t=>e._displayMenu(e._expandCollapseMenu.getExpandCollapseMenu(),t.dsModel.elements.container)}}),e._allowedDisplayModes.length>1&&t.push({id:"structPanelViewSelector",dataElements:{domId:"compare-struct-display-style-button",typeRepresentation:"functionIcon",label:p.chooseTreeOrListView,position:"far",icon:{iconName:e._allowedDisplayModes.find(t=>t.id===e._displayMode).icon,fontIconFamily:1},priority:1,overflowPriority:"never",value:t=>{e._displayMenu(e._allowedDisplayModes.map(t=>({type:"RadioItem",title:t.title,id:t.id,icon:t.icon,state:e._displayMode===t.id?"selected":"unselected",action:{callback:()=>e.handleToolbarCommands({event:"displayView",data:{mode:t.id,icon:t.icon}})}})),t.dsModel.elements.container)}}}),t},_displayMenu:function(e,t){var n=this;require(["DS/Menu/Menu"],i=>{var r=t.getBoundingClientRect(),o={position:{x:r.right,y:r.bottom},layout:"topright",input:n.isTouch?"touch":"mouse"};i.show(e,o)})},destroy:function(){this._externalController.destroy(),this._externalController=null,this.elements.container=null,this._activeTrees=null,null!=this._structTrees&&(this._structTrees.destroy(),this._structTrees=null),null!=this._listTrees&&(this._listTrees.destroy(),this._listTrees=null),this.overview=null,this._plugSvcs=null,this._structMatchPairArray=null,this._listMatchPairArray=null,this._activeMatchPairArray=null},handleToolbarCommands:function(e){switch(e.event){case"legendApplyFilter":this.applyStatusFilters(),this._updateToolbarDiffCount(),this._updateUserFilterSettings("legendFilter");break;case"legendApplyVisibility":this._showStatusChooserDialog(e);break;case"navigatePrevious":case"navigateFirst":case"navigateLast":case"navigateNext":this.onNavigate(e.event);break;case"displayView":this._displayMode!==e.data.mode&&(this.showResults(e.data.mode),this.standardToolbar.update({displayIcon:[{id:"structPanelViewSelector",icon:e.data.icon}],enableDisableCommands:[{id:"expandCollapse",disabled:this.isList()}]}));break;case"expandAll":case"collapseAll":case"expandNLevels":this.standardToolbar.update({displayIcon:[{id:"expandCollapse",icon:e.data.icon}]}),this._currentExpandMenuId=e.event,"expandNLevels"===e.event?this._expandNLevels_showPopup():this._expandCollapse("collapseAll"!==e.event,-1)}},_updateUserFilterSettings:function(e){let t=this;function n(e,n,i){let r=t._activeDiffFlagInfo.allFlagDefs;for(let[o,a]of Object.entries(r))o!==i&&(!0===a[e]&&t[n].indexOf(o)>=0?t[n]=t[n].filter(e=>e!==o):!1===a[e]&&-1===t[n].indexOf(o)&&(t[n]=[...t[n],o]))}switch(e){case"legendFilter":n("checked","_statusesUnchecked");break;case"legendVisibility":n("visibleFlag","_statusesHidden","IDENTICAL")}},_expandNLevels_showPopup:function(e){var t=this;require(["DS/PADUtils/views/PADLevelSel"],function(n){new n({current_level:1,events:{onApply:function(e){t._expandCollapse(!0,parseInt(e)||-1)}}});if(null!=e&&void 0!==e.position&&null!==e.position&&e.position.x>0&&e.position.y>0){var i=jQuery(".pad_level_sel_modal > .modal-wrap");null!=i&&i.length>0&&(i[0].setStyle("padding-top","0px"),i[0].setStyle("margin-top",e.position.y+"px"),i[0].setStyle("margin-left",e.position.x+"px"))}})},_expandCollapse:function(e,t){var n=this,i="CompareWidgetSimuliaWebInWin"==widget.appId||this._collapse3DPARTS;function r(e){var t=!1,n=e.getAttr("type");if(null==n||""===n){var i=e.getMatchInfo();if(null!=i){var r=i.getBaseNode(),o="";null!=r&&(o=r.getAttr("type"));var a=i.getCompNode(),s="";null!=a&&(s=a.getAttr("type")),t="3DShape"===o||"3DShape"===s}}else t="3DShape"===n;return t}if("tree"===this._displayMode&&(this._activeTrees.withUpdateLocked(()=>{n.beginSuspendExpandUpdates(),n._activeTrees.dataGridViews.forEach((i,r)=>{n._activeTrees.getNTHGridSelectedNodes(r).forEach(n=>{if(n.hasChildren()){var i={};-1==t?i.expandAll=!0:i.numberOfLevelsToExpand=t;try{e?-1==t?n.expandAll():(n.collapseAll(),n.expandNLevels(i)):n.collapseAll()}finally{}}else n.options.data.setExpandCollapseState("noExpandState")})}),n.endSuspendExpandUpdates()}),e&&i)){n.beginSuspendExpandUpdates(),n._activeTrees.dataGridViews.forEach((e,t)=>{n._activeTrees.getNTHGridSelectedNodes(t).forEach(e=>{var t=[];e.withTransactionUpdate(function(){for(t.push(e);t.length>0;){let e=t.pop(),n=e.getChildren();if(null==n||0==n.length)e.options.data.setExpandCollapseState("noExpandState");else 1==n.length&&r(n[0].options.data)?e.setState({state:"collapsed"}):n.forEach(function(e){t.push(e)})}})})}),n.endSuspendExpandUpdates();var o=this._crTree.getRoot(0);o.__TREENODE__.collapse(),o.__TREENODE__.expand()}},updateFlagColors:function(){var e=this._activeDiffFlagInfo.allFlagDefs,t=e.IDENTICAL?e.IDENTICAL.color:"#ffffff",n=this._activeMatchPairArray.length;this._activeTrees.withUpdateLocked(()=>{for(let i=1;i<n;i++){let n=this._activeMatchPairArray[i].getCompNode();n.__TREENODE__&&n.flagArray.forEach((i,r)=>{let o=i.flagName;n.__TREENODE__.options.grid["FLAG_"+r]=1==e[o].visibleFlag?e[o].color:t})}}),this.onResize(),this._syncOverview()},getStatusFilterInfo:function(){var e=[],t=[],n=this._activeDiffFlagInfo.allFlagDefs,i=n.IDENTICAL.checked;return Object.keys(n).forEach(function(r){var o=n[r];0==o.checked||0==i&&0==o.visibleFlag?e.push(r):t.push(r)}),{offFlags:e,onFlags:t}},applyStatusFilters:function(){var e=this;0==d.isMasked(e.elements.container)&&d.mask(e.elements.container),setTimeout(()=>{var t=e.isList(),n=e.getStatusFilterInfo();this._crTree.updateMatchPairHiddenFlags(t,n.offFlags,e._multiStatusesToHideAnd),t?e.showHideNodes_asList():e.showHideNodes_asTree(),e.doExpandCollapseUpdates(),e.onTreesSelectRow(),d.unmask(e.elements.container)},0)},showHideNodes_asList:function(){this._activeTrees.withUpdateLocked(()=>{for(var e=this._crTree.getCRList().getMatchPairArray(),t=0;t<2;t++){(0==t?e[0].getBaseNode().__TREENODE__:e[0].getCompNode().__TREENODE__).withTransactionUpdate(function(){e.forEach(function(e){var n=null;0==t?n=e.getBaseNode().__TREENODE__:n=e.getCompNode().__TREENODE__;1==e.getIsHidden()?0==n._isHidden&&n.hide():1==n._isHidden&&n.show()})})}})},showHideNodes_asTree:function(){for(var e=this._crTree.getRoot(0),t=this._crTree.getRoot(1),n=[],i=null,r=0;r<2;r++)i=0==r?e:t,n.push(i),i.__TREENODE__.withTransactionUpdate(function(){for(;n.length>0;){var t=n.pop();if(t.isHidden())t!=e&&t.__TREENODE__&&0==t.__TREENODE__._isHidden&&t.__TREENODE__.hide();else t.__TREENODE__&&1==t.__TREENODE__._isHidden&&t.__TREENODE__.show(),t.getChildArray().forEach(function(e){n.push(e)})}})},legendApplyVisibility:function(e){let t=this._activeDiffFlagInfo.allFlagDefs,n=[];var i=!0;for(let[r,o]of Object.entries(e))i=i&&o,t[r].visibleFlag!==o&&(t[r].visibleFlag=o,n.push({id:r,visibleFlag:o}));return n.length&&(t.IDENTICAL.matchedPairs.length||n.push({id:"IDENTICAL",visibleFlag:!i}),this.standardToolbar.update({showHideCommands:n}),this.updateFlagColors(),this.doExpandCollapseUpdates()),{bAtLeastOneHidden:!i,bApplyChanges:n.length>0}},_showStatusChooserDialog:function(){var e=this._activeDiffFlagInfo,t=this;require(["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/statusVisibilityDialog"],n=>{new n({statuses:e.allFlagDefs,OKfn:e=>{let n=this.legendApplyVisibility.bind(this)(e);n.bApplyChanges&&(this._updateUserFilterSettings("legendVisibility"),this._updateToolbarDiffCount()),n.bAtLeastOneHidden&&t._plugSvcs.showAlertBox(h.HIDDEN_STATUSES_IDENTICAL,null,"info")}})})},getDifferenceCount:function(){let e=this._activeDiffFlagInfo.allFlagDefs;return this._activeMatchPairArray.filter(t=>t.getCompNode().flagArray.some(t=>{let n=t.flagName;return"IDENTICAL"!==n&&e[n].checked&&e[n].visibleFlag})&&t.getBaseNode().__TREENODE__.isVisible()).length},clearView:function(){this._activeTrees&&this._activeTrees.clear()},updateResults:function(e,t,n){var i=this;return i._forceRootsTogether=!0,i._pluginConfig=e,i._ruleIDFlagDefTable=t,i._crTree=n,i._structMatchPairArray=n.getMatchPairArray(),i._structDiffFlagInfo=i.buildDiffFlagInfo(i._structMatchPairArray,e,i._forceRootsTogether),i._listIsComputed=!1,i._structIsComputed=!0,i._plugSvcs.postEvent("COMPARE_PANEL_UPDATED_EVENT",{}),i.showResults()},_resetTypeFiltersOn:function(e){var t=e.allFlagDefs;Object.keys(t).forEach(function(e){t[e].checked=!0})},_applyStatusDisplaySettings:function(e){var t=e.allFlagDefs;for(let[e,n]of Object.entries(t))n.visibleFlag="IDENTICAL"===e?n.matchedPairs.length||Array.isArray(this._statusesHidden)&&this._statusesHidden.length&&this._statusesHidden.some(e=>null!=t[e]&&t[e].matchedPairs.length):Array.isArray(this._statusesHidden)&&-1===this._statusesHidden.indexOf(e)},showResults:function(e){var t=this;return t._allowedDisplayModes.findIndex(t=>t.id===e)>=0&&(t._displayMode=e),new Promise(function(e,n){0==t._skeletonBuilt?t._OKfn_forShowResults=e:t._doShowResults(e)})},_doShowResults:function(e){var t=this;0==d.isMasked(t.elements.container)&&d.mask(t.elements.container),"tree"===t._displayMode?t.setup_tree():t.setup_list(),t._applyStatusDisplaySettings(t._activeDiffFlagInfo),t._resetTypeFiltersOn(t._activeDiffFlagInfo),t._activeTrees.setEachGridColorColumns(t.getEachGridColorColumns()),t._activeTrees.update(t._activeColData,function(){t.onTreesReady(t._activeDiffFlagInfo),t.onTreesExpandAll(),t.updateFlagColors(),this._updateToolbarDiffCount(),d.unmask(this.elements.container),e()}.bind(t))},setup_tree:function(){var e=this;e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._activeDiffFlagInfo=e._structDiffFlagInfo,e._activeTrees=e._structTrees},setup_list:function(){var e=this;e._listIsComputed||(e._crList=e._crTree.getCRList(),e._listMatchPairArray=e._crList.getMatchPairArray(),e._listColData=e._crList.generateDisplayLists(),e._listDiffFlagInfo=e.buildDiffFlagInfo(e._listMatchPairArray,e._pluginConfig,e._forceRootsTogether),e._listIsComputed=!0),e._listTrees&&e._listTrees.show(),e._structTrees&&e._structTrees.hide(),e._activeColData=e._listColData,e._activeMatchPairArray=e._listMatchPairArray,e._activeDiffFlagInfo=e._listDiffFlagInfo,e._activeTrees=e._listTrees},buildDiffFlagInfo:function(e,t,n){var i=t.SYSTEM_RULE_ID_FLAGS,r=t.CUSTOM_RULE_ID_FLAGS,o=t.CUSTOM_MATCH_ADJ_FLAGS,a=t.SYSTEM_RULE_ID_FLAGS;this.numberOfColumnsForColor=0;for(var s={},l={},c=e.length,u=0;u<c;u++){let t=e[u],c=t.getRelName();if("UNRELATED"!=c||n){var d=r[c];if(null!=d||null!=(d=i[c])){null==s[c]&&(s[c]=d);var h=!1;t.qtyIsDiffFlag&&(h=!0,s.QUANTITY=i.QUANTITY);var g=h?1:0,_=t.getAdjFlagArray();null!=_&&_.forEach(function(e){null==s[e]&&(s[e]=o[e])});var f=1+g+_.length;f>this.numberOfColumnsForColor&&(this.numberOfColumnsForColor=f);var S=t.getCompNode();if(S.flagArray=[],S.flagArray.push({flagName:c,color:d.COLOR}),h){let e=a.QUANTITY;S.flagArray.push({flagName:e.NLS,color:e.COLOR}),null==l.QUANTITY&&(l.QUANTITY={id:"QUANTITY",label:p[e.NLS],color:e.COLOR,description:"",checked:!0,matchedPairs:[],visibleFlag:!0},l.QUANTITY.matchedPairs.push(t))}if(null==l[c]){var m=p[d.NLS];null!=m&&0!=m.length||(m=d.NLS),l[c]={id:c,label:m,color:d.COLOR,description:"",checked:!0,matchedPairs:[],visibleFlag:!0}}l[c].matchedPairs.push(t);var E=t.getAdjFlagArray();null!=E&&E.forEach(function(e){var n=o[e];if(S.flagArray.push({flagName:e,color:n.COLOR}),null==l[e]){var i=p[n.NLS];null!=i&&0!=i.length||(i=n.NLS),l[e]={id:e,label:i,color:n.COLOR,description:"",checked:!0,matchedPairs:[],visibleFlag:!0}}l[e].matchedPairs.push(t)})}else this._plugSvcs.errout("UNKNOWN diff code in StructComparePanel... skipping")}}if(!l.IDENTICAL){let e=r.IDENTICAL;l.IDENTICAL={id:"IDENTICAL",label:p[e.NLS],color:e.COLOR,description:"",checked:!0,matchedPairs:[],visibleFlag:!1}}return{allFlagDefs:l}},onResize:function(){null!=this.overview&&(this.overview.onResize(),this.updateOverviewVisibility())},updateOverviewVisibility:function(){this._activeTrees.isScrollbarShown()?this.overview.show():this.overview.hide()},determineNodesToShow:function(e,t,n,i){var r="select"===n||null===e?t:e,o=this._activeDiffFlagInfo,a=!0,s=!0;for(var l in o.allFlagDefs)o.allFlagDefs[l].checked||(a=!1),o.allFlagDefs[l].checked&&(s=!1);if(s);else if(a){var c=r.getPath();""!==c&&i.push({IDPath:c})}else this._filterForStatusFlags(r,r===t,i)},_buildHideList:function(){for(var e={},t=this._listMatchPairArray,n=t.length,i=0;i<n;i++){var r=t[i],o="",a=r.getBaseNode();0==a.isDummy()&&(o=a.getAttr("physicalID_REF"));var s="",l=r.getCompNode();0==l.isDummy()&&(s=l.getAttr("physicalID_REF")),t[i].getIsHidden()&&(""!=o&&(e[o]=!0),""!=s&&(e[s]=!0))}return e},_filterForStatusFlags:function(e,t,n){var i=this._buildHideList(),r=this.isList();e.visitVisible_nodesAndFN(function(o){var a=!1;if(o!==e||!t){var s=o.getMatchInfo(),l="",c=s.getBaseNode();0==c.isDummy()&&(l=c.getAttr("physicalID_REF"));var u="",d=s.getCompNode();0==d.isDummy()&&(u=d.getAttr("physicalID_REF")),(""!=l&&1==i[l]||""!=u&&1==i[u])&&(a=!0)}var p=0!=o.getChildArray().length;if(0==a){if(!p){var h=o.getPath();return""!==h&&n.push({IDPath:h}),!1}return!0}return r})},onTreesSelectRow:function(e){var t=this;let n=!0===this._viewerDisplayModeIsolate?"isolate":"select";var i=this._activeTrees.getNTHGridSelectedNodes(0),r=this._activeTrees.getNTHGridSelectedNodes(1);if(!e||0!=i.length&&0!=r.length){var o=[],s=[],l=this.isList();if(l){[i,r].forEach(function(e,i){var r=[],l=[];e.forEach(function(e){var o=e.options.data;if(!o.isDummy()){var s=o.getAttr("physicalID_REF"),c=o.getAttr("physicalID_INST");t._crTree.visitVisible_treeAndFN(i,function(e){if(e.getAttr("physicalID_REF")==s){"isolate"===n&&t.determineNodesToShow(e,t._crTree.getDisplayRoot(i),n,l);var o=e.getDBContext(),u=new a(s,e.getAttr("type"),o.securityContext,o.tenant,o.serviceName),d=null;null!=c&&(d=new a(c,e.getAttr("type"),o.securityContext,o.tenant,o.serviceName));var p={ObjIDSpec:u,IDPath:e.getPath(),instObjIDSpec:d};r.push(p)}return!0})}}),"select"!==n&&0!==e.length||t.determineNodesToShow(null,t._crTree.getDisplayRoot(i),n,l),o.push(r),s.push(l)})}else{var c=[],u=[],d=[],p=[];i.forEach((e,i)=>{var o=e.options.data,a=null,s=null,l=o.getPath();"isolate"===n&&this.determineNodesToShow(o,t._crTree.getDisplayRoot(0),n,d),null==o||o.isDummy()||(a=o.getObjIDSpec_REF(),s=o.getObjIDSpec_INST()),null!=a&&c.push({ObjIDSpec:a,IDPath:l,instObjIDSpec:s});var h=i<r.length?r[i].options.data:null,g=null!==h?h.getPath():null;if("isolate"===n&&this.determineNodesToShow(h,t._crTree.getDisplayRoot(1),n,p),null!=h&&!h.isDummy()){var _=h.getObjIDSpec_REF(),f=null;f=h.getObjIDSpec_INST()}null!=_&&u.push({ObjIDSpec:_,IDPath:g,instObjIDSpec:f})}),"select"!==n&&0!==i.length||(this.determineNodesToShow(null,t._crTree.getDisplayRoot(0),n,d),this.determineNodesToShow(null,t._crTree.getDisplayRoot(1),n,p)),o.push(c),o.push(u),s.push(d),s.push(p)}t._plugSvcs.postEvent("NEW_CURRENT_SELECTION_EVENT",{isAsync:!0,selectedData:o,crTree:t._crTree,structDisplayMode:l?"LIST":"STRUCT"}),this._syncOverview()}},onTreesUnselectRow:function(){this._syncOverview(),this.onTreesSelectRow(!0)},onTreesCollapse:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},onTreesExpand:function(e){e.nodeModel.options.data.setExpandCollapseState(e.nodeModel.getState()),this.doExpandCollapseUpdates()},beginSuspendExpandUpdates:function(){this._suspendExpandUpdates=!0},endSuspendExpandUpdates:function(){this._suspendExpandUpdates=!1,this.doExpandCollapseUpdates()},doExpandCollapseUpdates:function(){0==this._suspendExpandUpdates&&(this.onResize(),this._syncOverview(),setTimeout(()=>{this._updateToolbarDiffCount()},0))},onTreesExpandAll:function(e){this._expandCollapse(!0,-1)},getKeyDiffArray:function(e,t){for(var n=[],i=t.getTreeDocument().getAllDescendants(),r=0;r<i.length;r++){var o=i[r];if(o.isVisible()){var a=null,s=[],l=!1,c=o.options.data._matchInfo;if(c){var u=null;a=c.getRelName(),(u=JSON.parse(JSON.stringify(e[a]))).flagName=a,s.push(u),this.isList()&&(l=o.options.data._matchInfo.qtyIsDiffFlag)&&((u=JSON.parse(JSON.stringify(e.QUANTITY))).flagName="QUANTITY",s.push(u)),c.getAdjFlagArray().forEach(function(t){var n=JSON.parse(JSON.stringify(e[t]));n.flagName=t,s.push(n)})}else{(u=JSON.parse(JSON.stringify(e.IDENTICAL))).flagName="IDENTICAL",s.push(u)}var d={objKey:r,relName:a,flagDefArray:s,qtyDiff:l};n.push(d)}}return n},onTreesReady:function(e){var t=this;this._updateTreePanelCaptions(),null==this.overview&&(this.overview=new r,this.overview.inject(this.elements.container)),this.dispatchEvent("onTreesLoaded"),this._syncOverview(),this.standardToolbar.update({legend:e.allFlagDefs,enableDisableCommands:[{id:"expandCollapse",disabled:!this._allowedDisplayModes.find(e=>t._displayMode===e.id).expandCollapseEnabled},{id:"chooseStatusToDisplay",disabled:1===Object.keys(e.allFlagDefs).length&&null!=e.allFlagDefs.IDENTICAL&&e.allFlagDefs.IDENTICAL.visibleFlag}]})},_updateToolbarDiffCount:function(){let e=this.getDifferenceCount();this.standardToolbar.update({numDifferences:e})},_syncOverview:function(){if(void 0!==this.overview&&null!==this.overview){var e=this.getKeyDiffArray(this._ruleIDFlagDefTable,this._activeTrees.dataGridViews[1]);this.overview.update(e),this.updateOverviewVisibility();var t=this._activeTrees.getNTHGridSelectedNodes(0),n=[];t.forEach(function(e){var t=e._getRowID();n.push(t)});var i=this._activeDiffFlagInfo.allFlagDefs;this.overview.sync(!0,n,i)}},getTreePanelCaptions:function(){var e=[],t=null,n=null,i=this._crTree.getRoot(1).getMatchInfo();if(i){if(i.getBaseNode())t=i.getBaseNode().getAttr("title")+" "+i.getBaseNode().getAttr("revision");if(i.getCompNode())n=i.getCompNode().getAttr("title")+" "+i.getCompNode().getAttr("revision")}return t&&n&&(e.push({panelContentId:this.isList()?"compare-list-left":"compare-tree-left",panelCaption:t}),e.push({panelContentId:this.isList()?"compare-list-right":"compare-tree-right",panelCaption:n})),e},_updateTreePanelCaptions:function(){var e=this;this.getTreePanelCaptions().forEach(function(t){e._activeTrees.setPanelCaption(t.panelContentId,t.panelCaption)})},onNavigate:function(e){var t=this._activeTrees.dataGridViews[0].getNodesXSO().get(),n=this._activeMatchPairArray;if(Array.isArray(t)&&t.length){var i=(t=t[t.length-1]).options.data.getMatchInfo(),r=function(e,t,i){for(var r="navigateNext"===t?1:-1,o=e+r,a=n.length;"navigateNext"===t?o<a:o>=0;o+=r)if(n[o].getBaseNode().__TREENODE__.isVisible())for(let e of n[o].getCompNode().flagArray)if("IDENTICAL"!==e.flagName&&i[e.flagName].visibleFlag)return n[o];return null}("navigateFirst"===e?-1:"navigateLast"===e?n.length:n.findIndex(e=>i===e),e="navigateFirst"===e?"navigateNext":"navigateLast"===e?"navigatePrevious":e,this._activeDiffFlagInfo.allFlagDefs);null!=r&&this._activeTrees.withUpdateLocked(function(){this._activeTrees.clearNTHGridSelection(0),r.getBaseNode().__TREENODE__.select(),this._activeTrees.dataGridViews[0].ensureNodeModelVisible(r.getBaseNode().__TREENODE__,!0,1)}.bind(this))}},getActiveExpandMenuId:function(){return this._currentExpandMenuId},isList:function(){return"list"===this._displayMode},getLabel:function(){return p.CompareStructurePanelTitle},getName:function(){return"structures"},onComparePanelUpdated:function(){void 0!==this._contextMenuPlugin&&null!==this._contextMenuPlugin&&this._contextMenuPlugin.onComparePanelUpdated()},onActivate:function(){setTimeout(()=>{this.onResize(),this._syncOverview()},0)}})}),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"};return{CV_PROPS:n,STRUCT_FETCH_OPTIONS:{CV_PROPS:n,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},STRUCT_COMPARE_OPTIONS:{PROPS:n,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},STRUCT_DISPLAY_OPTIONS:{SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu"}}}),define("DS/CompareWidget2/ViewDefModules/ProductsViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ProductsViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PRODUCTS_PROPS_AND_STRUCT:{COL:["PRODUCTS_STRUCT_VIEW","PRODUCTS_PROP_VIEW"]},PRODUCTS_PROPS_ONLY:{ROW:"PRODUCTS_PROP_VIEW"},PRODUCTS_STRUCT_ONLY:{ROW:"PRODUCTS_STRUCT_VIEW"}},VIEWDEFS:{PRODUCTS_PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],PRODUCTS_STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/expanders/expandMgr","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeAug","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/refInstTreeEditor","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/userSettings/UserSettingsManager","i18n!DS/CompareCommon/assets/nls/CompareCommon","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,n,i,r,o,a,s,l){function c(e,t){var n,i,r,s=this;!1===s._dbFallback&&!1===e?(s._dataSource===s._pluginOptions.DATA_SOURCE&&"CV_DIRECT"===s._dataSource||(s._dataSource=s._pluginOptions.DATA_SOURCE||"CV_DIRECT"),n="INDEX_REQ_ENABLING",i="compare-alert-warning",require(["DS/CompareCommon/CompareAlert"],function(e){var t=null==n?a["MISSING ALERT MESSAGE"]:null!=a[n]?a[n]:n,o=null!=r&&""!==r?t.replace("{msgData}",r):t;e.doAlert({msg:o,alertStyle:i})},function(e){console.log("%%%% CompareWidget:: Failed to show "+i+": '"+n+"', error:"+e)}),t=!0,widget.setValue("compareSettings.dataSource.useIndex",!0),o.set("compareSettings.dataSource.useIndex",!0)):!0===s._dbFallback&&!1===e?s._dataSource="DB_SERVICE":s._dataSource=s._pluginOptions.DATA_SOURCE||"CV_DIRECT",!0===t&&s.postEvent({event:"Event_refreshComparison"})}return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i),void 0!==n.DATA_SOURCE&&null!==n.DATA_SOURCE&&""!==n.DATA_SOURCE?this._dataSource=n.DATA_SOURCE:this._dataSource="CV_DIRECT",void 0!==n.DB_FALLBACK&&null!==n.DB_FALLBACK&&""!==n.DB_FALLBACK?this._dbFallback=n.DB_FALLBACK:this._dbFallback=!0},onEnabled:function(){this.syncSetting("compareSettings.dataSource.useIndex","_useIndex",c.bind(this)),c.bind(this)(this._useIndex,!0)},execute:function(e,o){var a=this;a._parent(e,o);var c=e;(function(e,i,o){var a=this;return new Promise(function(o,s){a._lastReqStart=a._plugSvcs.nowMS();var l=a._lastReqStart;a._plugSvcs.postEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",null);var c=[];e.forEach(function(e){if(null!=e.getCommands){var t=e.getCommands();null!=t&&t.forEach(function(t){var n=t.inNode;if(null!=n){var i=new r(n,"UNKNOWN",e.getSecurityContext(),e.getTenant(),e.getServiceName());c.push(i)}})}});var u=[...e,...c];if(null!=u[0].objAMDName){var d=u[0].objAMDName,p=u[1].objAMDName;u[0]._moduleName=d,u[0]._physID="FILE_"+d,u[1]._moduleName=p,u[1]._physID="FILE_"+p}for(var h=[],g=u.length,_=0;_<g;_++){var f=u[_];dbContext={securityContext:e[0]._securityContext,tenant:e[0]._tenant,serviceName:e[0]._serviceName},null!=f._moduleName?dataSrc="FILE_EXPAND":(void 0!==i.DATA_SOURCE&&null!==i.DATA_SOURCE&&""!==i.DATA_SOURCE&&(a._dataSource=i.DATA_SOURCE),dataSrc=a._dataSource),void 0!==i.DB_FALLBACK&&null!==i.DB_FALLBACK&&""!==i.DB_FALLBACK&&(a._dbFallback=i.DB_FALLBACK),f.isFiltered()&&(a._dbFallback=!1),t.doExpand(f,dataSrc,a._dbFallback,"-1",a._plugSvcs,i).then(function(e){var t=e;a.dbgout("%% STRUCTURAL DATA EXPANDED by: "+t._dataSource),l==a._lastReqStart&&n.augment(t,dbContext,a._plugSvcs).then(function(e){var t=e;l==a._lastReqStart&&(h.push(t),h.length>=g&&o(h))},function(e){a._plugSvcs.errout("FAILURE AUGMENTING TREE:"+e),s(e)})},function(e){a._plugSvcs.errout("FAILURE EXPANDING TREE: "+e),s(e)})}})}).call(a,c,o,a._plugSvcs).then(function(e){var t=function(e,t){var n=[],i=[],r=[],o={};return t.forEach(function(e){var t=e.getObjIDSpec().getUniqueID();null==o[t]&&(o[t]=[]),o[t].push(e)}),e.forEach(function(e){var t=e.getUniqueID(),i=o[t].pop();n.push(i),r.push(t)}),Object.keys(o).forEach(function(e){o[e].forEach(function(e){i.push(e)})}),{orderedTrees:n,extraTrees:i}}(c,e);t.orderedTrees.forEach(function(e){var n=e.getEditCommands();null!=n&&i.applyCommands(e,n,t.extraTrees,a._plugSvcs,!0)}),a.reportOK(t.orderedTrees)},function(e){a._plugSvcs.confirmDialog(l.FETCH_FAIL_DEFAULT,{text:s.Close,callback:function(){a._plugSvcs.postEvent("Event_clearComparison"),a._plugSvcs.postEvent("Event_resetToDropFrame")}},null),a.reportKO(e)})}})}),define("DS/CompareWidget2/plugins/MERGE/MERGE_STRUCT_FETCH_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin","DS/CompareWidget2/userSettings/UserSettingsManager"],function(e,t){function n(e,t){var n=this,i=e,r=this._dataSource;i?"DB_SERVICE"===n._dataSource?r="CV_SERVICE":"LC_AUTH_SERVICE"===n._dataSource&&(r="LC_IDX_SERVICE"):"CV_SERVICE"===n._dataSource?r="DB_SERVICE":"CV_DIRECT"===n._dataSource?r="DB_SERVICE":"LC_IDX_SERVICE"===n._dataSource&&(r="LC_AUTH_SERVICE"),n._dataSource=r,n._pluginOptions.DATA_SOURCE=n._dataSource}return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i)},onEnabled:function(){this.syncSetting("mergeSettings.dataSource.useIndex","_useIndex",n.bind(this)),n.bind(this)(this._useIndex,!0)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel"],function(e,t){"use strict";return e.extend({_ODTDecycleExcludeKeys:function(){return this._parent().concat(["__TREENODE__","_expandCollapseState"])},init:function(e,t,n,i){this._parent(e,t,n,i)},onEnabled:function(){var e=this;return e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("3DVIEW_NODES_SELECTED_EVENT",function(e){var t=e.data.nodePathArray;this._outputPanel._viewerDisplayModeIsolate||this._outputPanel.getExternalController().setSelectedNodes(t)}.bind(this)),e.subscribeEvent("3DVIEW_ALL_NODES_UNSELECTED_EVENT",function(e){this._outputPanel._viewerDisplayModeIsolate||(this._outputPanel.getExternalController().clearSelectedNodes(),this._plugSvcs.postEvent("NO_CURRENT_SELECTION_EVENT",{}))}.bind(this)),e.subscribeEvent("COMPARE_PANEL_UPDATED_EVENT",function(e){this._plugSvcs.dbgout("Struct Plugin handling compare panel updated"),this._outputPanel.onComparePanelUpdated()}.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",e._outputPanel.onTreesSelectRow.bind(e._outputPanel),e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null,e._outputPanel),e.syncSetting("viewSettings.STRUCT_VIEW.multi_statuses_to_hide_and","_multiStatusesToHideAnd",null,e._outputPanel),e._parent()},createViewPanelObject:function(e,n){return new t(e,this._plugSvcs,n)},execute:function(e,t){var n=this;n._parent(e,t);var i,r=e.crTreeArray,o={...(i=t).SYSTEM_RULE_ID_FLAGS,...i.CUSTOM_RULE_ID_FLAGS,...i.CUSTOM_MATCH_ADJ_FLAGS};n._outputPanel.updateResults(t,o,r[0]).then(function(e){n.showNotBusy(),n.reportOK(r)},function(e){n.reportKO(e)})}})}),define("DS/CompareWidget2/plugins/MERGE/ViewPanel/mergeStructResultPanel",["DS/CustomizableLayout/View","DS/Controls/ComboBox","DS/Controls/Popup","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/plugins/MERGE/actionInfos","DS/CompareWidget2/plugins/MERGE/ViewPanel/Popup"],function(e,t,n,i,r,o,a,s,l){return e.extend({init:function(e,t,n){var i=this;this._parent(n),this._plugSvcs=t,this._buttons={},this._contentFromLeftColor=n.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,this._contentFromRightColor=n.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,this.url3DSpace=this.get3DSpaceUrl(),this._customEnum={revise:"Revise",reuse:"Reuse",exclude:"Exclude",insertnew:"Insert New",reusereference:"Reuse Reference"},this._customRep={CustomEnum:{stdTemplate:"enumCombo",semantics:{possibleValues:this._customEnum,valueType:"enumCustom"}}},this.cols=[{text:"ActionYinglai",dataIndex:"ActionYinglai",typeRepresentation:"string",width:"50",onCellRequest:function(e){var t=i.tree.reuseCellContent("Yinglai");t.crNode=e.nodeModel.options.data,t.firstChild.src=i.url3DSpace+i._getActionImagePathFromCRNode(e.nodeModel.options.data),e.cellView._setReusableContent(t)}},{text:"ActionCombo",dataIndex:"ActionCombo",typeRepresentation:"CustomEnum",width:120,editableFlag:!0,sortableFlag:!1,editionPolicy:"EditionInPlace",getCellSemantics:function(e){var t={},n=i._getActionInfoFromCellInfos(e);if(n){var r=n.getEnabledActions();for(const e of r)t[e.actionOption.nls]=e.actionOption.name}return{possibleValues:t}},getCellValue:function(e){var t="",n=i._getActionInfoFromCellInfos(e);return n&&(t=n.getActionOptionSelected().name),t},setCellValue:function(e,t){var n=i._getActionInfoFromCellInfos(e);if(n){var r={grid:{}},o=n.getActionByOptionName(t),a=n.getActionOptionSelected(),s=(i._getInstPidFromCellInfos(e),i._actionInfos.updateActionSelected(e.nodeModel.options.grid.data,t));console.log("Changed from action "+a.nls+" to action "+o.actionOption.nls+".");let l=e.nodeModel.getTreeDocument().search({match:function(e){var t=e.nodeModel.options.grid.data;if(t){var n=t.getAttr("physicalID_REF");if(s.has(n))return!0;var i=t.getMatchInfo();if(i){var r=i.getBaseNode().getAttr("physicalID_REF");if(r&&s.has(r))return!0;var o=i.getCompNode().getAttr("physicalID_REF");if(o&&s.has(o))return!0}}return!1}});e.nodeModel.getTreeDocument().prepareUpdate(),l.forEach(function(e){r.label=i._getLabelFromCRNode(e.options.grid.data),e.updateOptions(r)}),e.nodeModel.getTreeDocument().pushUpdate()}},getCellEditableState:function(e){var t=!0;if(e.nodeModel.options.grid.data){var n=i._getInstPidFromCellInfos(e),r=i._actionInfos.getInstActionInfo(n);r&&(r.getActions().length<2||r.getEnabledActionCount()<2)&&(t=!1)}return t}},{text:"Color",dataIndex:"Color",typeRepresentation:"color",editableFlag:!1,width:"7",minWidth:"7",getCellValue:function(e){return i._getContentColorFromCRNode(e.nodeModel.options.grid.data)}},{dataIndex:"tree",typeRepresentation:"string",hasCellValue:function(e){return!(e.nodeModel&&!e.nodeModel.getAttributeValue("label"))},width:"auto"},{dataIndex:"rev",width:85,typeRepresentation:"string",getCellValue:function(e){var t=e.nodeModel.getAttributeValue("rev"),n=i._getActionInfoFromCellInfos(e);if(n){var r=n.getActionOptionSelected();"insertnew"===r.name?t="A.1":"revise"===r.name?t="B.1":"exclude"===r.name?t="":"reuse"===r.name&&(t="A.1")}return t}}],this.buildSkeleton(e)},buildSkeleton:function(e){this.standardToolbar=new a(e,this,{navigateDifferences:!0,showCompareLegend:!0}),this.elements.container=e,this.treeContainer=UWA.createElement("div",{styles:{display:"flex","flex-direction":"column","border-top":"4px solid #aa9ccb",position:"relative",width:"100%",height:"100%"}}),this.treeContainer.inject(e)},_getInstPidFromCRNode(e){if(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_INST"),i=t.getCompNode().getAttr("physicalID_INST");return n||i}return null},_getInstPidFromCellInfos(e){return e.nodeModel.options.grid.data?this._getInstPidFromCRNode(e.nodeModel.options.grid.data):null},_getActionInfoFromCRNode(e){var t=this._getInstPidFromCRNode(e);return this._actionInfos.getInstActionInfo(t)},_getActionInfoFromCellInfos(e){var t=this._getInstPidFromCellInfos(e);return this._actionInfos.getInstActionInfo(t)},_getContentColorFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var i=null,r=e.getMatchInfo();r&&(i=r.getRelName());var o=n.getActionOptionSelected().name;"revise"===o||"insertnew"===o?t=this._contentFromRightColor:"reuse"===o?t=n.getActionByOptionName("insertnew")||i&&"IDENTICAL"!==i?this._contentFromRightColor:this._contentFromLeftColor:"reusereference"===o&&(t=this._contentFromLeftColor)}return t},_getLabelFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var i=null,r="",o="",a=e.getMatchInfo();a&&(i=a.getRelName(),a.getBaseNode()&&(r=a.getBaseNode().getAttr("title")),a.getCompNode()&&(o=a.getCompNode().getAttr("title")));var s=n.getActionOptionSelected().name;"revise"===s||"reusereference"===s?t=r:"reuse"===s?t=n.getActionByOptionName("insertnew")||i&&"IDENTICAL"!==i?o:r:"insertnew"===s&&(t=o)}return t},_getNodeGrid:function(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_INST"),i=t.getCompNode().getAttr("physicalID_INST"),r=this._actionInfos.getInstActionInfo(n||i),o=0;r&&(o=r.getActionOptionSelected().name);var a=this._getContentColorFromCRNode(e);return{data:e,rev:e.getAttr("revision")?e.getAttr("revision"):"",type:e.getAttr("type")?e.getAttr("type"):"none",Color:a,ActionCombo:o}},createTreeNode:function(e){var t=new r({data:e,label:this._getLabelFromCRNode(e),icons:[e.getAttr("typeIconSmallURL")],grid:this._getNodeGrid(e)}),n=e.getChildArray(),i=this;return n.forEach(function(e){var n=i.createTreeNode(e);t.addChild(n)}),t},buildTree:function(e){var n=this,r=new i({}),a=this.createTreeNode(e);r.addChild(a),r.setFilterModel({type:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:"VPMReference"},operator:"or",condition2:{type:"startsWith",filter:"none"}}}}),r.onNodeModelUpdate(function(e){var t=e.data.nodeModel;if(t){var n=e.data.attributes;console.log("Node "+t.getLabel()+" modified, attributes :"+Object.keys(n).toString()+" .")}});var s=new o({enableListSelection:!0,treeDocument:r,selection:{canMultiSelect:!0},columns:this.cols});s.elements.container.style.top="4px",s.layout.columnsHeader=!1,s.layout.rowsHeader=!1,s.rowSelection="multiple",s.cellSelection="none",s.showCellActivationFlag=!1,s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(this._customRep));var l=[{label:"",icon:"flow-line-add"},{label:"",icon:"recycle"},{label:"",icon:"block"}];return s.registerReusableCellContent({id:"myReusableId",buildContent:function(){return new t({enableSearchFlag:!1,elementsList:l,selectedIndex:0,mainElementContent:"icon"})}}),s.registerReusableCellContent({id:"Yinglai",buildContent:function(){var e=UWA.createElement("td",{class:"merge-action-field"}),t=UWA.createElement("img",{class:"fancytree-icon",styles:{cursor:"pointer"}});return t.src=n.url3DSpace+"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",t.inject(e),n.addActionPopup(0,0,"gurka",t),e}}),s},get3DSpaceUrl:function(){var e=widget.getUrl();return e.substr(0,e.length-"webapps/CompareWidget/CompareWidget.html".length)},getExcludeActionDef:function(){return{id:"exclude",icon:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:"Exclude"}},getReuseActionDef:function(){return{id:"reuse",icon:"webapps/CompareWidget/assets/icons/32/I_Reuse.png",nls:"Reuse"}},getActionDefs:function(){var e=this.getExcludeActionDef();return[{id:"revise",icon:"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",nls:"Revise"},this.getReuseActionDef(),{id:"overwrite",icon:"webapps/ENOPAD_v2/assets/icons/32/I_EditMode.png",nls:"Overwrite"},{id:"branch",icon:"webapps/LifecycleWidget/assets/icons/32/I_NewBranch.png",nls:"Branch"},e]},_getActionImagePathFromCRNode(e){var t="revise";if(e){var n=e.getMatchInfo();if(n){var i=n.getRelName();"LEFT_ONLY"===i?t="exclude":"RIGHT_ONLY"===i?t="branch":"SIMILAR"===i?t="revise":"IDENTICAL"===i&&(t="reuse")}}return this.getActionDefs().find(e=>e.id===t).icon},createPopupContent:function(e,t,n){for(var i=UWA.createElement("div"),r=this.getActionDefs(),o=r.length,a=0;a<o;a++){var s=r[a],l=UWA.createElement("img");l.className="fancytree-icon",l.style.cursor="pointer",l.style.margin="2px",l.src=this.url3DSpace+s.icon,l.title=s.nls,l.inject(i),l.action=s,l.iRow=e,l.iTree=t,l.addEventListener("click",function(e){e.target.action}.bind(this))}return i},addActionPopup:function(e,t,n,i){var r=this.createPopupContent(e,t,n);new l({target:i,content:r})},destroy:function(){this.elements.container=null,this._buttons=null,this._plugSvcs=null},clearView:function(){},showResults:function(e,t){return!this._actionInfos&&e.actionInfos&&(this._actionInfos=e.actionInfos),new Promise(function(t,n){console.log(".............mergeStructResultPanel................"),console.log("OBJ in is: "+JSON.stringify(e)),console.log(".............mergeStructResultPanel................"),t(!0)})},onActionChange:function(e){this.treeContainer.innerHTML="";var t=e.data._crTree.getRoot(1);this.tree=this.buildTree(t),this.tree.onReady(function(){this.tree.getTreeDocument().expandAll()}.bind(this)),this.tree.inject(this.treeContainer)},getLabel:function(){return"Merge Results"},getName:function(){return"merge-results"},onCmdRevise:function(){this._plugSvcs.postEvent("MERGE_CMD","revise")},onCmdReuse:function(){this._plugSvcs.postEvent("MERGE_CMD","reuse")},onCmdBranch:function(){this._plugSvcs.postEvent("MERGE_CMD","branch")},onCmdOverwrite:function(){this._plugSvcs.postEvent("MERGE_CMD","overwrite")},onCmdExclude:function(){this._plugSvcs.postEvent("MERGE_CMD","exclude")},onCmdOK:function(){this._plugSvcs.postEvent("MERGE_CMD","ok")},onCmdCancel:function(){this._plugSvcs.postEvent("MERGE_CMD","cancel")},getToolbarItems:function(e){return[{float:"left",items:[e.createClickButton("Revise","flow-line-add",this.onCmdRevise.bind(this)),e.createClickButton("Reuse","recycle",this.onCmdReuse.bind(this)),e.createClickButton("Branch","flow-branch-add",this.onCmdBranch.bind(this)),e.createClickButton("Overwrite","pencil",this.onCmdOverwrite.bind(this)),e.createClickButton("Exclude","block",this.onCmdExclude.bind(this))],priority:2},{float:"right",items:[e.createClickButton("OK","check",this.onCmdOK.bind(this)),e.createClickButton("Cancel","wrong",this.onCmdCancel.bind(this))],priority:1}]}})}),define("DS/CompareWidget2/plugins/MERGE/MERGE_RESULT_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/MERGE/ViewPanel/mergeStructResultPanel"],function(e,t){return e.extend({onEnabled:function(){return this.subscribeEvent("MERGE_ACTION_CHANGE_EVENT",this._outputPanel.onActionChange.bind(this._outputPanel)),this._parent()},createViewPanelObject:function(e,n){return new t(e,this._plugSvcs,n)},execute:function(e,t){var n=this;n._parent(e,t),n._outputPanel.showResults(e,t).then(function(e){n.showNotBusy(),n.reportOK(e)},function(e){n.reportKO(e)})}})}),define("DS/CompareWidget2/framework/pluginServices",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServicesSettings"],function(e,t,n,i){return function(n,r){this._viewPanelMgr=n,this._publicEventMgr=r,this.makeAuthHttpsCall=function(e,n,i,r,o,a,s){return t.makeAuthHttpsCall(e,n,i,r,o,a,s)},this.loadPref=function(e,n){return t.loadPref(e,n)},this.savePref=function(e,n){return t.savePref(e,n)},this.subscribeTo=function(e,t){return this._publicEventMgr.subscribe({event:e},t)},this.unsubscribe=function(e){return this._publicEventMgr.unsubscribe(e)},this.postEvent=function(e,t){var n=t||{},i=n.isAsync,r=n.catchExceptions;this._publicEventMgr.publish({event:e,data:null==t?null:t,propagate:!0,target:this,isAsync:i,catchExceptions:r})},this.requestFrame=function(e){return this._viewPanelMgr.requestFrame(e)},this.addPanel=function(e,t,n){return this._viewPanelMgr.addPanel(e,t,n)},this.makeServiceURL=function(e,t,n,r){return"https:"===n.substring(0,6)?n:i.getPlatformWSUrl(e,t,n,r)},this.createRandomString=function(t,n,i){return e.createRandomString(t,n,i)},this.dbgout=function(t,n){e.dbgout2(!0,t,n)},this.warnout=function(t){e.warnout("[PLUGIN] "+t)},this.errout=function(t){e.errout("[PLUGIN] "+t)},this.enableDebugLabel=function(t){e.enableDebugLabel(t)},this.disableDebugLabel=function(t){e.disableDebugLabel(t)},this.showAlertBox=function(t,n,i,r){return e.showAlertBox(t,n,i,r)},this.confirmDialog=function(t,n,i){return e.confirmDialog(t,n,i)},this.nowMS=function(){return e.nowMS()},this.reportTime=function(t,n){e.reportTime(t,"[PLUGIN]"+n)},this.csValsEquivalent=function(t,n){return e.csValsEquivalent(t,n)}}}),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"};return{CV_PROPS:n,STRUCT_FETCH_OPTIONS:{CV_PROPS:n,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!1,USE_MCS:!1},STRUCT_COMPARE_OPTIONS:{PROPS:n,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},STRUCT_DISPLAY_OPTIONS:{SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu"}}}),define("DS/CompareWidget2/ViewDefModules/RequirementSpecViewDef",["DS/CompareWidget2/ViewDefModules/RequirementSpecViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/ViewDefModules/ViewDefOptions",["DS/CompareWidget2/ViewDefModules/DSColors","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t){"use strict";var n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid",DFR:"REF.dfr",INST_LOGID:"INST.logicalid",XFORM:"INST.matrixtxt"},i={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"},r={...n,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"},o={DB_PROPS:r,CV_PROPS:n,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"},{name:"3D",url:"/cvservlet/expand3d",typeList:["LPAbstract3DRepReference","LPAbstractReference","MCAD Component","CATIA V4 Model","CATIA CGR","CATShape"]},{name:"Filter",url:"/cvservlet/multiexpand",typeList:["ENOStrRefinementSpecification"]}],DATA_SOURCE:"CV_DIRECT",DB_FALLBACK:!0},a=UWA.clone(o);return UWA.extend(a,{DB_FALLBACK:!1}),{DB_PROPS:r,CV_PROPS:n,REL_PROPS:i,INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0},STRUCT_FETCH_OPTIONS:o,STRUCT_FETCH_OPTIONS_FILTER:a,STRUCT_COMPARE_OPTIONS:{PROPS:n,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE","REPLACED"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","EQ","NEQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ","NEQ"]],COMP_DFR:[["DFR","DFR"],["EQ","EQ","EQ","EQ","NEQ"]],COMP_INST_LOGID:[["INST_LOGID","INST_LOGID"],["N/A","N/A","N/A","N/A","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",MATCH_ADJ:-1}]},GET_RELATIONS_OPTIONS:{PROPS:i,RELATION_LABELS:{"SpaceAssignment_to.472":{label:t.spaceAssignment,icon:" "},"RFL_implementScope_from.52":{label:t.implementedBy,icon:" "},"RFL_implementScope_to.51":{label:t.implementing,icon:""},"ProposedSolution_to.ProposedSolution":{label:t.proposedSolutions,icon:""},"v6_specdoc_to.87":{label:t.attachedDocuments,icon:""},"v6_annexdoc_to.Reference Document":{label:t.attachedDocuments,icon:""},"v6_specdoc_to.SpecificationDocument":{label:t.specificationDocuments,icon:""}},DOCS_RELS:["v6_specdoc_to","v6_annexdoc_to"],OTHER_RELS:["SpaceAssignment_to","RFL_implementScope_from","RFL_implementScope_to","ProposedSolution_to"]},COMPARE_REL_OPTIONS:{PROPS:i,COMPUTE_DIFFERENT:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},STRUCT_DISPLAY_OPTIONS:{SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:e.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:e.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:e.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:e.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:e.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:e.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:e.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:e.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:e.colorDef.RED,NLS:"DUPLICATED"},REPLACED:{COLOR:e.colorDef.PINK,NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:e.colorDef.YELLOW,NLS:"MOVED"}},COLLAPSE_3DPARTS:!0,CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu"}}}),define("DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",["DS/CompareWidget2/ViewDefModules/ViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructFetch_Filter:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS_FILTER},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},GetRelations:{Path:"DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",Options:e.GET_RELATIONS_OPTIONS},CompareRels:{Path:"DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",Options:e.COMPARE_REL_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},STANDARD_FILTER:{ROW:["STRUCT_VIEW_FILTER",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW_FILTER"]}]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},STRUCT_ONLY_FILTER:{ROW:"STRUCT_VIEW_FILTER"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PAD3D_ONLY_FILTER:{ROW:"PAD3D_VIEW_FILTER"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_AND_STRUCT_FILTER:{COL:["STRUCT_VIEW_FILTER","PROP_VIEW"]},PROPS_STRUCT_INSTANCE:{ROW:["STRUCT_VIEW",{COL:["PROP_VIEW","INSTANCE_VIEW"]}]},PROPS_STRUCT_INSTANCE_FILTER:{ROW:["STRUCT_VIEW_FILTER",{COL:["PROP_VIEW","INSTANCE_VIEW"]}]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","GetRelations","CompareRels","StructListViewPrep","StructDisplay","Exporter"],STRUCT_VIEW_FILTER:["StructFetch_Filter","StructCompare","GetRelations","CompareRels","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"],PAD3D_VIEW_FILTER:["StructFetch_Filter","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/ViewDefModules/develViewDef",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){UWA.extend(e.VIEWDEFS,{DEVEL_VIEW:["StructFetch","StructCompare","StructDisplay"]});return UWA.extend(e.VIEWSETS,{DEVEL_VIEWSET:[["DEVEL_VIEW","PROP_VIEW"],["PAD3D_VIEW"]]}),e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.DIFFERENT.COLOR=t.colorDef.GREEN3,e.STRUCT_DISPLAY_OPTIONS.FORCE_ROOTS_TOGETHER=!0,e.STRUCT_COMPARE_OPTIONS.COMPUTE_DIFFERENT=!0,e}),define("DS/CompareWidget2/ViewDefModules/TNR_viewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){var n={PHYSICALID:"REF.physicalid",NAME:"REF.name",TYPE:"REF.ds6w:type",DFR:"REF.dfr",XFORM:"INST.matrixtxt",REVISION:"REF.ds6wg:revision"},i={...n,INST_LOGID:"INST.logicalid[connection]",XFORM:"INST.xform"};e.STRUCT_FETCH_OPTIONS.CV_PROPS=n,e.STRUCT_FETCH_OPTIONS.DB_PROPS=i;var r={PROPS:n,CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","SIMILAR"],CUSTOM_COMPARISONS:{COMP_TYPE:[["TYPE","TYPE"],["EQ","EQ","EQ"]],COMP_DFR:[["DFR","DFR"],["EQ","EQ","EQ"]],COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ"]],COMP_REV:[["REVISION","REVISION"],["EQ","NEQ","N/A"]]}};UWA.extend(e.STRUCT_COMPARE_OPTIONS,r);var o={CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},SIMILAR:{COLOR:t.colorDef.GREEN2,NLS:"SIMILAR"}}};return UWA.extend(e.STRUCT_DISPLAY_OPTIONS,o),e}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel",["UWA/Core","UWA/Json","DS/CustomizableLayout/View","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrChooseDialog","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/CompareWidget2/viewComponents/StandardCompareToolbar","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/CompareV2","i18n!DS/CompareWidget2/assets/nls/DisplayMessages","css!DS/CompareWidget2/assets/css/attrComparePanel/attrComparePanel.css"],function(e,t,n,i,r,o,a,s,l,c,u,d,p){return n.extend({init:function(e,t,n){this._parent(),this.device=c.getDeviceType(),this._isInstance=null!=n&&1==n.isInstance,this._colorLeft=null!=n&&n.colorLeft?n.colorLeft:"#ff8a2e",this._colorRight=null!=n&&n.colorRight?n.colorRight:"#009ddb",this._plugSvcs=t,this.buildSkeleton(e),this.showDiffOnly=!1,this.toClear=[],this.currentDisplayMode=""},generateId:function(e){return"viewSettings."+this.getName()+"."+e},buildSkeleton:function(t){var n=this;this.singleColView=!1,this.elements.container=t;var i=[{id:this.generateId("showOnlyDifferences"),dataElements:{typeRepresentation:"independantBoolean",priority:3,domId:n._isInstance?"compare-instattr-diffs-only":"compare-propattr-diffs-only",label:d.attrShowDiffOnly,position:"near"},onNodeUpdate:function(e){n.showDiffOnlyClicked(e)}},{id:this.generateId("chooseAttributesToDisplay"),dataElements:{typeRepresentation:"functionIcon",priority:10,domId:n._isInstance?"compare-instattr-to-display":"compare-propattr-to-display",tooltip:d.selectPropertiesToDisplay,icon:{iconName:"attributes-cog",fontIconFamily:1},position:"far",value:this.customizeRows.bind(this)}}],r=i.find(e=>e.id.indexOf("showOnlyDifferences")>0);r&&l.sync(r.dataElements,r.id,"value",null),this.standardToolbar=new s(t,this,{navigateDifferences:!1,showCompareLegend:!1,otherMenuItems:i}),this.dataGridViewContainer=e.createElement("div",{styles:{flex:"1",position:"relative","border-top":"1px solid #f4f5f6"},id:"ATTR_DISPLAY_CONTAINER"}).inject(this.elements.container)},showDiffOnlyClicked:function(e){this.showDiffOnly=e.options.grid.data,this.update()},destroy:function(){this.elements.container=null,this.dataGridViewContainer=null},showResults:function(e){var t=this;return new Promise(function(n,i){var r=!1;t.compareResult=e,t.names=[];for(let n=0;n<e.length;n++)t.names.push(e[n].name),e[n].valuesRight.length>0&&(r=!0);var o=!0;this.comparedWithObjects=e[0].valuesRight.length,this.comparedWithObjects>1&&(o=!1),t.standardToolbar.update({showHideCommands:[{id:t.generateId("showOnlyDifferences"),visibleFlag:r},{id:"attrViewSelector",visibleFlag:o}]}),n(!0)})},isDiff:function(e){let t=e.valuesRight;if(!t.length)return!0;if(e.valueLeft||t.some(e=>e))for(let n=0;n<t.length;n++)if(e.valueLeft!=t[n])return!0;return!1},filterOutNoDiff:function(e){let t=[];for(let n=0;n<e.length;n++){let i=e[n];this.isDiff(i)&&t.push(i)}return t},filterOutPropertiesToHide:function(e){var t=[];for(let n=0;n<this.compareResult.length;n++){let i=this.compareResult[n];-1==e.indexOf(i.name)&&(u.isTitleAttr(i,this._isInstance)?t.unshift(i):t.push(i))}var n=t.findIndex(e=>"thumbnailimage"===e.name);if(-1!=n&&0!=n){t.unshift(t[n]);var i=n+1;t.splice(i,1)}return t},getAttributeDisplayOptions:function(){let e=l.get(this.generateId("attributes_not_shown"));this.defaultAttrs=l.get(this.generateId("default_attributes"));try{this.propsToHide=t.decode(e)}catch(t){e.constructor===String&&(this.propsToHide="__showall__"===e?[]:""===e?["__showDefault__"]:e.split(","))}},getPropsToHide:function(e){return null!=this.propsToHide&&this.propsToHide.length?1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]?e.reduce((e,t)=>(-1===this.defaultAttrs.indexOf(t.name)&&!u.isTitleAttr(t,this._isInstance)&&e.push(t.name),e),[]):[...this.propsToHide]:[]},showDefaultPropsOnly:function(){return 1===this.propsToHide.length&&"__showDefault__"===this.propsToHide[0]},showAllProps:function(){return 0===this.propsToHide.length},savePropsDisplayOptions:function(e){this.propsToHide=e,this.saveAttributeSettings()},update:function(){var e=this;if(Array.isArray(e.compareResult))if(this.compareTwo=e.compareResult.length&&1===e.compareResult[0].valuesRight.length,null==this.currentDisplayMode||""===this.currentDisplayMode)e.onResize();else{e.getAttributeDisplayOptions();var t=e.filterOutPropertiesToHide(e.getPropsToHide(e.compareResult));e.showDiffOnly&&(t=e.filterOutNoDiff(t)),e.clearView(),e.buildDataGridView(t,this.currentDisplayMode),e.elements.dataGridView.inject(e.dataGridViewContainer)}return!0},clearView:function(){null!=this.elements.dataGridView&&(this.clear(this.elements.dataGridView),this.dataGridViewContainer.empty())},clear:function(e){var t=this;null!=e&&(t.toClear.push(e),setTimeout(function(){for(var e=t.toClear.length,n=0;n<e;n++)try{null!=t.toClear[n]&&(t.toClear[n].destroy(),t.toClear[n]=null)}catch(e){t._plugSvcs.errout("Exception while clearing panels: '"+e+", continuing...")}t.toClear=[]},0))},createColumnOptions:function(e){var t=this,n={width:"auto",onCellRequest:function(e){t.onCellRequest(e,this)}};for(var i in e)n[i]=e[i];return n},buildViewModel:function(e){let t=this,n=[],i=e.length>0?e[0].valuesRight.length:0;for(let r=0,o=e.length;r<o;r++){let o=e[r],a={title:o.displayName,left:{value:o.valueLeft,COLOR:1===i&&!0===o.highlightRight[0]?t._colorLeft:""},right:o.valuesRight.map((e,n)=>({value:e,COLOR:1===i&&!0===o.highlightRight[0]?t._colorRight:"",highlightRightText:i>1&&!0===o.highlightRight[n]})),data:{isThumbnail:"thumbnailimage"===o.name}};i>0&&0===o.valuesRight.length&&(a.left.COLOR=t._colorLeft,a.right.push({COLOR:t._colorRight})),n.push(a)}return n},buildDataGridView:function(t,n){let i=this,s=t.length>0?t[0].valuesRight.length:0,l=i.buildViewModel(t),c=new r,u=void 0;switch(n){case"threeColumn":for(let t=0,n=l.length;t<n;t++){let n=l[t],i={label:n.title,grid:{left:n.left.value,COLOR_LEFT:n.left.COLOR},data:e.extend(n.data,{family:t,titleColumnID:0})};for(let e=0;e<s;e++)i.grid["right_"+e.toString()]=n.right[e].value,1===s?i.grid.COLOR_RIGHT=n.right[0].COLOR:s>1&&(i.grid["highlightRightText_"+e.toString()]=n.right[e].highlightRightText);c.addChild(new o(i))}u=[this.createColumnOptions({dataIndex:"tree"}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(var h=0;h<s;h++)u.push(this.createColumnOptions({dataIndex:"right_"+h,typeRepresentation:"textBlock",autoRowHeightFlag:!0}));u.forEach(e=>e.getCellClassName=this._getCellClassName);break;case"twoColumn":for(let t=0,n=l.length;t<n;t++){let n=l[t];c.addChild(new o({grid:{left:n.title,COLOR_LEFT:"",COLOR_RIGHT:""},data:{family:t,titleColumnID:1===s?2:0}}));let i={grid:{left:n.left.value,COLOR_LEFT:n.left.COLOR},data:e.extend(n.data,{family:t})};e.extend(i.grid,n.right.reduce((e,t,r)=>(e["right_"+r.toString()]=t.value,1===s?e.COLOR_RIGHT=n.right[0].COLOR:s>1&&(i.grid["highlightRightText_"+r.toString()]=n.right[r].highlightRightText),e),{})),c.addChild(new o(i))}u=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR_LEFT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0}),...this.compareTwo?[this.createColumnOptions({dataIndex:"COLOR_RIGHT",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[]];for(h=0;h<s;h++){var g={dataIndex:"right_"+h,typeRepresentation:"textBlock",autoRowHeightFlag:!0};u.push(this.createColumnOptions(g))}u.forEach(e=>e.getCellClassName=this._getCellClassName);break;case"oneColumn":for(let t=0,n=l.length;t<n;t++){let n=l[t];c.addChild(new o({grid:{left:n.title,COLOR:""},data:{family:t,titleColumnID:1===s?2:0}})),c.addChild(new o({grid:{left:n.left.value,COLOR:n.left.COLOR},data:e.extend(n.data,{family:t})})),s>0&&n.left.COLOR!==n.right[0].COLOR&&c.addChild(new o({grid:{left:n.right[0].value,COLOR:n.right[0].COLOR},data:e.extend(n.data,{family:t})}))}(u=[...this.compareTwo?[this.createColumnOptions({dataIndex:"tree",width:3,minWidth:3}),this.createColumnOptions({dataIndex:"COLOR",width:8.5,minWidth:8.5,typeRepresentation:"color"})]:[],this.createColumnOptions({dataIndex:"left",typeRepresentation:"textBlock",autoRowHeightFlag:!0})]).forEach(e=>e.getCellClassName=this._getCellClassName)}var _=e.createElement("span",{class:"attr-table-no-diffs-found",html:p.NO_DIFFERENCES_FOUND});this.elements.dataGridView=new a({identifier:"ComparePropertyView",treeDocument:c,columns:u,rowSelection:"single",cellSelection:"none",columnSelection:"none",defaultColumnDef:{minWidth:8.5},placeholder:_,getCellTooltip:function(e){var t=e.cellModel;return{shortHelp:("#ff8a2e"===t?d.mainToolbarLeftObjectString:"#009ddb"===t?d.mainToolbarRightObjectString:"")||"",updateModel:!1}}}),this.elements.dataGridView.registerReusableCellContent({id:"renderThumbnail",buildContent:function(){return new e.Element("img").inject(new e.Element("div",{class:"thumbnail-div"}))}}),this.elements.dataGridView.showCellActivationFlag=!1,this.elements.dataGridView.layout.columnsHeader=!1,this.elements.dataGridView.layout.rowsHeader=!1,this.elements.dataGridView.layout.useLastColumnWidthAutoFlag=!0,this.elements.dataGridView.layout.getRowHeightFunction=function(e){let t=i.elements.dataGridView.layout.getRowHeightFromCellContents(e);return!0===c.getNthRoot(e).options.data.isThumbnail?75:t}},_getCellClassName:function(e){var t;t=e.nodeModel.options.data.family%2==0?"compareGreyRow":e.nodeModel.options.grid.family%2==0?"compareGreyRow":"compareWhiteRow";var n=e.nodeModel.options.data.titleColumnID;return null!=n&&e.columnID===n&&(t+=" compare-attr-title-cell"),t},onCellRequest:function(e,t){t.defaultOnCellRequest(e),!0===e.nodeModel.options.data.isThumbnail&&null!=e.cellModel&&(e.cellModel.indexOf("http://")>=0||e.cellModel.indexOf("https://")>=0||e.cellModel.indexOf("data:image")>=0)?this.renderThumbnail(e,t):this.renderCellTextColor(e,this.currentDisplayMode,t)},renderThumbnail:function(e,t){let n=t.reuseCellContent("renderThumbnail");n.setAttribute("src",e.cellModel),e.cellView.setReusableContent(n.getParent())},renderCellTextColor:function(e,t,n){if(!this.compareTwo&&"oneColumn"!==t){let t=n.getColumnOrGroup(e.columnID);t.dataIndex.indexOf("right_")>=0&&!0===e.nodeModel.options.grid["highlightRightText_"+t.dataIndex.split("_")[1]]?e.cellView.elements.container.style.color="red":e.cellView.elements.container.style.color=""}},customizeRows:function(){new i(this,function(){this.update()}.bind(this))},saveAttributeSettings:function(){l.set(this.generateId("attributes_not_shown"),t.encode(this.propsToHide))},getLabel:function(){return this._isInstance?d.CompareInstancePanelTitle:d.ComparePropertiesPanelTitle},getName:function(){return this._isInstance?"INSTANCE_VIEW":"PROP_VIEW"},_displayMenu:function(e,t){var n=this;require(["DS/Menu/Menu"],i=>{var r=t.getBoundingClientRect(),o={position:{x:r.right,y:r.bottom},layout:"topright",input:n.isTouch?"touch":"mouse"};i.show(e,o)})},handleToolbarCommands:function(e){switch(e.event){case"displayView":this._displayMode!==e.data.mode&&("singleColDisplay"===e.data.mode?this.singleColView=!0:this.singleColView=!1,this.update(),this.standardToolbar.update({displayIcon:[{id:"attrViewSelector",icon:e.data.icon}]}),this._displayMode=e.data.mode)}},onResize:function(){setTimeout(()=>{let e=this.elements&&this.elements.container?this.elements.container.getBoundingClientRect().width:0;if(e<100)return;let t="";t=e>640?"threeColumn":e>=320&&e<=640?"twoColumn":"boolean"==typeof this.compareTwo?!0===this.compareTwo?"oneColumn":"twoColumn":"",this.currentDisplayMode!==t&&(this.currentDisplayMode=t,this.update())},0)},onActivate:function(){this.onResize()}})}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/ATTRIBUTE/ViewPanel/attrComparePanel","i18n!DS/CompareWidget2/assets/nls/DisplayMessages"],function(e,t,n){return e.extend({onEnabled:function(){var e=this;return{instProps:[{eventName:"INST_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"INST_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(n.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"INST_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"INST_PROPS_OFF_DURING_LIST_COMPARE",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_DURING_LIST_COMPARE_MSG")}},{eventName:"INST_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("INST_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}],refProps:[{eventName:"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",fn:e.onUpdateInProgress},{eventName:"REF_PROPS_FETCH_FAILED",fn:e.onAttrFetchFailure},{eventName:"NO_CURRENT_SELECTION_EVENT",fn:function(){e.showMessage(n.PROPS_UNAVAILABLE_NO_SELECTION)}},{eventName:"REF_PROPS_OFF_NONE_AVAILABLE",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_NONE_AVAILABLE_MSG")}},{eventName:"REF_PROPS_OFF_TOO_MANY_SELECTED",fn:function(){e.showMessageAndSignalOK("REF_PROPS_OFF_TOO_MANY_SELECTED_MSG")}},{eventName:"GROUP_PLACEHOLDER_SELECTED",fn:function(){e.showMessageAndSignalOK("GROUP_PLACEHOLDER_SELECTED_MSG")}}]}["InstAttrDisplay"===this._name?"instProps":"refProps"].forEach(function(t){e.subscribeEvent(t.eventName,t.fn.bind(e))}),e._parent()},showMessageAndSignalOK:function(e){this.showMessage(n[e]),this.reportOK()},onAttrFetchFailure:function(){this.showNotBusy()},createViewPanelObject:function(e,n){return new t(e,this._plugSvcs,n)},execute:function(e,t){var n=this;n._parent(e,t),n._outputPanel.showResults(e).then(function(e){n.showNotBusy(),n.reportOK(e)},function(e){n.reportKO(e)})}})}),define("DS/CompareWidget2/ViewDefModules/PartViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.ds6wg:revision",NAME:"REF.name",DFR:"REF.dfr",XFORM:"INST.matrixtxt"};return{CV_PROPS:n,INST_ATTR_FETCH_OPTIONS:{isInstance:!0},INST_ATTR_DISPLAY_OPTIONS:{isInstance:!0},STRUCT_FETCH_OPTIONS:{CV_PROPS:n,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1},STRUCT_COMPARE_OPTIONS:{PROPS:n,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[{NAME:"MOVED",PROPS:["XFORM","XFORM"],FLAG_ON:"NEQ",MATCH_ADJ:-1}]},STRUCT_DISPLAY_OPTIONS:{SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CUSTOM_MATCH_ADJ_FLAGS:{MOVED:{COLOR:t.colorDef.YELLOW,NLS:"MOVED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu"}}}),define("DS/CompareWidget2/ViewDefModules/PartViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PartViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},InstAttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",Options:e.INST_ATTR_FETCH_OPTIONS},InstAttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:e.INST_ATTR_DISPLAY_OPTIONS},View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},View3DPrep:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_PREP_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{ROW:["STRUCT_VIEW",{COL:[["PROP_VIEW","INSTANCE_VIEW"],"PAD3D_VIEW"]}]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"},PAD3D_ONLY:{ROW:"PAD3D_VIEW"},PROPS_AND_STRUCT:{COL:["STRUCT_VIEW","PROP_VIEW"]}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],INSTANCE_VIEW:["InstAttrFetch","InstAttrCompare","InstAttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"],PAD3D_VIEW:["StructFetch","View3DPrep","View3DDisplay"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel",["DS/CustomizableLayout/View","DS/ENOPAD3DViewer/PAD3DViewer","DS/DMU3DCompareAPI/DMU3DCompareAPI","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/exclusiveHideShowController","DS/UIKIT/Mask","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n,i,r,o){"use strict";return e.extend({init:function(e,t,n){this._parent(),this._plugSvcs=t,this._viewer3D=null,this._compareAPI3D=null,this._colors={BASELINE:n.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,COMPARE:n.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,COMMON:"#EEEEEE"},this._viewerIsLoaded=!1,this._initialCompareDone=!1,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.buildSkeleton(e)},buildSkeleton:function(e){this.elements.container=e,this._viewer3D=this._buildPAD3DViewer()},destroy:function(){null!=this._viewer3D&&(this._viewer3D.empty(),null!=this._viewer3D.flushModel&&this._viewer3D.flushModel(),this._viewer3D=null),null!=this._compareAPI3D&&(this._compareAPI3D.clean(),this._compareAPI3D=null),this._plugSvcs=null,this._deferred_showResultsArg=null,this._deferred_updateSelectedArg=null,this.elements=null},_buildPAD3DViewer:function(){var e=this,n={widget:widget,css_view_class:"windowed",visuProgressiveTileModel:!0,allowAuthoring:!1,activateProbes:!1,actionbar_corrected:!0,interwidgetComAvailability:!1,supportWorldOrientation:!0,windowOptions:{workbench:"CompareViewerCmd.xml",workbenchModule:"CompareWidget",robotVisibility:!1,automaticReframePolicy:!0,allowDnD:!1,defaultStatusBarVisibility:!1,defaultContextualMenuVisibility:!0,defaultContextualBarVisibility:!0,viewerOptions:{highlight:{activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!0,primitive:!1,trapSelection:!0,trapGPU:!0,trapPrimitive:!1}},contextualMenuContent:{workbenchName:"CompareViewerContextualBar",module:"CompareWidget",fileName:"CompareViewerContextualBar.xml",geometry:{firstLevel:["CompareViewerFocusOnHdr","ReframeOnHdr"],toggleVisu:null}}}},i=new t(n),r=i.subscribe({event:"onReady"},function(){i.unsubscribe(r),e._padReadyCB()});return i},_padReadyCB:function(){var e=this,t=!1,r=widget.getPreferences();r.forEach(e=>{"xPref_3DEXPERIENCE_PLATFORM"!==e.name&&"pad_security_ctx"!==e.name||"hidden"===e.type||(e.type="hidden",t=!0)}),t&&widget.setPreferences(r),e._viewer3D.render().inject(e.elements.container);var o=e._viewer3D.getHideShowController();e._exclusiveHideShowController=new i(o);if(e._compareAPI3D=new n(e._viewer3D._frmWindow,{activateXHighlight:!0,ctxViewer:e._viewer3D}),e._compareAPI3D.setLegendVisibleFlag(!1),e._viewerIsLoaded=!0,null!=e._deferred_showResultsArg){var a=e._deferred_showResultsArg;e._deferred_showResultsArg=null,e._doShowResults(a)}},showResults:function(e){var t=this;return new Promise(function(n,i){t._compareOKFn=n,t._compareKOfn=i,0==t._viewerIsLoaded?t._deferred_showResultsArg=e:(t._initialCompareDone=!1,t._doShowResults(e))})},_doShowResults:function(e){var t=this;t._loadViewerJSONS(e).then(function(n){t._do3DCompare(e),t._initialCompareDone=!0},function(e){t._signalCompareDone(!1)})},_signalCompareDone:function(e){var t=null;t=1==e?this._compareOKFn:this._compareKOFn,this._compareOKFn=null,this._compareKOFn=null,null==t?this._plugSvcs.errout("trying to signal 3DCompare done but no report function available"):t()},_loadViewerJSONS:function(e){var t=this;return new Promise(function(n,i){var r=t._viewer3D.subscribe({event:"onLoadingComplete"},function(){t._viewer3D.unsubscribe(r)}),o=t._viewer3D.subscribe({event:"onEndProgressiveLoad"},function(e){1==e.memoryFull&&t._plugSvcs.showAlertBox("Load Failed / Out of Memory",null,"error"),t._viewer3D.unsubscribe(o),t._viewer3D.reframe(),t._signalCompareDone(!0),n()});t._viewer3D.loadJSON({data:e})})},_do3DCompare:function(e){var t=this;try{var n=t._getViewerPath(e[0].rootID),i=t._getViewerPath(e[1].rootID),r=t._buildDMUOptions(n,i);null!=t._compareAPI3D&&t._compareAPI3D.compare(r)}catch(e){t._plugSvcs.showAlertBox("3DComparison failed",null,"error"),t._plugSvcs.errout("Exception performing 3D Compare: "+e.stack)}},updateSelected:function(e,t){var n=this;n._deferred_CrossHighlight=t,0==n._initialCompareDone?n._deferred_updateSelectedArg=e:setTimeout(function(){n._doUpdateSelected(e)},0)},_doUpdateSelected:function(e){for(var t=this,n=[],i=[],o=e.length,a=0;a<o;a++){var s=e[a];null!=s&&(n[a]=[],s.forEach(function(e){var r=t._getViewerPath(e);if(null!=r){n[a].push(r);var o=e.split("/");i.push(o)}}))}r.mask(t.elements.container),t.elements.container.getElement(".spinner").addClassName("in"),setTimeout(function(){t._updateViewer("update",i).then(function(e){if(null!=t._compareAPI3D){var i=t._buildDMUOptions(n[0],n[1]);t._compareAPI3D.updateCompareModel(i)}null!=t._deferred_CrossHighlight&&t._deferred_CrossHighlight.status&&t._deferred_CrossHighlight.doneCB(t._deferred_CrossHighlight),t._deferred_CrossHighlight=null,r.isMasked(t.elements.container)&&r.unmask(t.elements.container)},function(e){t._plugSvcs.errout("Cannot update View3D:: "+e)})},0)},_updateViewer:function(e,t){var n=this,i=null,r=null;return"hide"==e?(i=n._exclusiveHideShowController.hide,r="onHide"):"show"==e?(i=n._exclusiveHideShowController.show,r="onShow"):"update"==e&&(i=n._exclusiveHideShowController.exclusiveShow,r="onExclusiveShow"),new Promise(function(e,o){if(null==i)o("bad opName in 'doUpdate'");else{var a=n._exclusiveHideShowController.subscribe({event:r},function(){try{n._exclusiveHideShowController.unsubscribe(a),e()}catch(e){n._plugSvcs.errout("Failure performing explusive show"),o()}});i.call(n._exclusiveHideShowController,{paths:t})}})},_getViewerPath:function(e){var t="";try{var n=null!=e?e.split("/"):[];t=this._viewer3D.getController().buildPathFromArray(n)}catch(e){this._plugSvcs.warnout("EXCEPTION trying to get viewer path: "+e)}return t},_makeTreeEntry:function(e,t,n,i){var r={};return null==i||i.constructor==Array&&null==i[0]?r=null:(r={name:e,nls:t,color:n},i.constructor==Array?r.pathElements=i:r.pathElement=i),r},_buildDMUOptions:function(e,t){var n=null==e||e.constructor==Array&&0==e.length,i=null==t||t.constructor==Array&&0==t.length,r=this._colors.BASELINE,o=this._colors.COMPARE,a={panel:"reduce",TitleNls:"NLS_TITLE",Common:{nls:"NLS_Common",color:i?r:n?o:this._colors.COMMON}};return a.Old=this._makeTreeEntry("L","NLS_LEFT",r,n?t:e),a.New=this._makeTreeEntry("R","NLS_RIGHT",o,i?e:t),a},clearView:function(e){null!=this._viewer3D&&this._viewer3D.empty()},getLabel:function(){return o.Compare3DPanelTitle},getName:function(){return"view3d"}})}),define("DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",["DS/CompareWidget2/plugins/displayPlugin","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/view3DComparePanel","DS/CompareWidget2/plugins/VIEW3D/ViewPanel/XSelectManager"],function(e,t,n){"use strict";function i(e,t){for(var n=[],i=t.length,r=0;r<i;r++)for(var o=t[r],a=o.length,s="."+r,l=0;l<a;l++){for(var c=(d=o[l].IDPath.split("/")).length,u=0;u<c;u++){let e=d[u].length;d[u].substring(e-2)!=s&&(d[u]+=s)}o[l].IDPath=d.join("/")}for(const i of t)if(null!=i){var d=[];for(const t of i){var p=t.IDPath;if("IDPATH"==e)d.includes(p)||d.push(p);else{if("VIEWERPATH"!=e)return this._plugSvcs.errout("INVALID RETURN TYPE request: "+e),[];var h=this._outputPanel._getViewerPath(p);null!=h&&n.push({pathElement:h})}}"IDPATH"==e&&n.push(d)}return n}function r(e){for(var t={},n=e.length,i=0;i<n;i++){var r=e[i];if(0==r.getIsHidden()){var o=r.getBaseNode(),a=o.isDummy()?"":o.getAttr("physicalID_REF")+".0",s=r.getCompNode(),l=s.isDummy()?"":s.getAttr("physicalID_REF")+".1";t[a+"_"+l]=!0,1==r.qtyIsDiff()&&(t[a+"_"]=!0,t["_"+l]=!0)}}return t}function o(e,t,n,i){var r={viewableRootSet:[],allVisible:!1},a=!0;if(n){var s=t.getMatchInfo(),l=s.getBaseNode(),c=l.isDummy()?"":l.getAttr("physicalID_REF")+".0",u=s.getCompNode(),d=u.isDummy()?"":u.getAttr("physicalID_REF")+".1";a=1!=i["DIFFERENT"==s.getRelName()?0==e?c+"_":"_"+d:c+"_"+d]}else a=t.isHidden();if(a){if(n)for(var p=(g=t.getChildArray()).length,h=0;h<p;h++){(_=o(e,g[h],n,i)).viewableRootSet.forEach(function(e){r.viewableRootSet.push(e)})}}else{var g;p=(g=t.getChildArray()).length;if(r.allVisible=!0,0==p){f=(f=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(r.viewableRootSet=[f])}else{for(h=0;h<p;h++){var _;0==(_=o(e,g[h],n,i)).allVisible&&(r.allVisible=!1),_.viewableRootSet.forEach(function(e){r.viewableRootSet.push(e)})}var f;if(1==r.allVisible)f=(f=t.getPath()+"."+e).replaceAll("/","."+e+"/"),0==t.isDummy()&&(r.viewableRootSet=[f])}}return r}function a(e){var t=this;let n=this.viewerDisplayMode;if(void 0!==t._outputPanel&&null!==t._outputPanel){t._attrUpdateStartMS=t._plugSvcs.nowMS();var a=e.data.selectedData,s=e.data.crTree,l=[],c=[];if(null!=a){var u="LIST"==e.data.structDisplayMode;if("isolate"===n)l=function(e,t,n){var i=[[],[]],a=null;n&&(a=r(e.getCRList().getMatchPairArray()));for(var s=e.getRootArray().length,l=0;l<s;l++)for(var c=t[l].length,u=t[l].sort(function(e,t){return e.IDPath>t.IDPath}),d="XXX",p=0;p<c;p++){var h=u[p].IDPath;if(h.startsWith(d));else{d=h;var g=e.findNodeByIDPath(l,h);if(g){var _=o(l,g,n,a).viewableRootSet;i[l]=i[l].concat(_)}}}return i}(s,a,u);else{if("select"!==n)return void t._plugSvcs.errout("INVALID - expected 'isolate' or 'select', was given: '"+n+"'");l=function(e,t){var n=[],i=null;t&&(i=r(e.getCRList().getMatchPairArray()));for(var a=e.getRootArray(),s=a.length,l=0;l<s;l++){var c=o(l,a[l].CRNode_root,t,i).viewableRootSet;n.push(c)}return n}(s,u),c=i.call(t,"VIEWERPATH",a)}var d={status:!1};try{"isolate"==n&&"select"==this._lastViewDisplayMode&&t._XSelectManager.notifyClearHighlights();var p="isolate"==n,h="select"==n,g="none"==this._lastViewDisplayMode,_="isolate"==this._lastViewDisplayMode,f=1==l[0].length&&-1==l[0][0].indexOf("/"),S=1==l[1].length&&-1==l[1][0].indexOf("/"),m=f&&S;(p||h&&(g||_||!m||!this._lastWasRootsOnly))&&(d={status:!0,viewerPaths:c,doneCB:function(e){"select"===n&&void 0!==e.viewerPaths&&null!==e.viewerPaths&&e.viewerPaths.length>0&&require(["DS/Selection/CSOManager","DS/Selection/HSOManager"],function(e,n){t._XSelectManager.setUpdateState("INTERNAL");let r=i.call(t,"VIEWERPATH",a);e.add(r),n.add(r),t._XSelectManager.setUpdateState("NONE")},function(e){})}},t._outputPanel.updateSelected(l,d),this._lastIDPAAS=l),this._lastViewDisplayMode=n,this._lastWasRootsOnly=m}catch(e){this._plugSvcs.errout("EXCEPTION updating selected in output panel")}"select"===n&&t._XSelectManager.notifyNewHighlights(c,!d.status)}}}return e.extend({onEnabled:function(){var e=this;return e._lastViewDisplayMode="none",e._lastWasRootsOnly=!1,e._lastIDPAAS=[],e.subscribeEvent("STRUCT_UPDATE_IN_PROGRESS_EVENT",e.onUpdateInProgress.bind(e)),e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",a.bind(this)),e.syncSetting("viewSettings.PAD3D_VIEW.view3D.isolate","_viewerDisplayModeIsolate",()=>this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select"),this.viewerDisplayMode=!0===this._viewerDisplayModeIsolate?"isolate":"select",e._XSelectManager=new n(e._plugSvcs),e._parent()},createViewPanelObject:function(e,n){return new t(e,this._plugSvcs,n)},execute:function(e,t){var n=this;n._parent(e,t);var i=e;n._outputPanel.showResults(i).then(function(e){n.showNotBusy(),n.reportOK(e)},function(e){n.reportKO(e)})}})}),define("DS/CompareWidget2/framework/svcNode",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Cycle"],function(e,t){function n(t){var n=this,i=n.getName();if(e.dbgout("@@@@ SERVICE NODE "+i+" notified of input object update..."),0!=n._enabled){var r=t.obj,o=(null==r||e.stringify(r).substring(0,100),null==r?"null":e.stringify(r).substr(0,100)+" ...");e.dbgout("@@@@ ++++++++++++++++++++  RUNNING  PLUGIN  +++++++++++++++++++++++++"),e.dbgout("@@@@ ++ PLUGIN: "+i),e.dbgout("@@@@ ++    OBJ: "+o),e.dbgout("@@@@ ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++");try{if(widget.recordForODT){let e=this.getName(),t=null==r?"null":JSON.stringify(JSON.decycle(r,null,n._plugin._ODTDecycleExcludeKeys())),i=null==this._pluginOptions?"null":JSON.stringify(JSON.decycle(this._pluginOptions,null,n._plugin._ODTDecycleExcludeKeys()));console.log("COMPARE PLUGIN EXECUTE: "+e),console.log(e+" INSTRING: "+t),console.log(e+" INOPTIONS: "+i)}n._plugin.execute(r,this._pluginOptions)}catch(t){e.errout("EXCEPTION in Plugin '"+n.getName()+"'.execute(): "+t.stack)}}else e.dbgout("XXXX SERVICE NODE "+i+" is disabled... ignoring")}var i=function(t,n,i,r,o,a){e.dbgout("Creating svcNode for plugin: "+n),this._name=t,this._pluginOptions=i,this._plugin=r,this._plugSvcs=o,this._privateEventMgr=a,this._subscribedTokens={},this._plugin.setOutputFn(this.updateOutput.bind(this)),this._outputEventName=this._name+n+".updated",this._outputObj={},"DISPLAY_PLUGIN"==this._plugin._type&&this._subscribe("Event_clearView",this.handler_clearView),this._viewName=null,this._enabled=!1};return i.prototype.destroy=function(){this._enabled=!1,this._name=null,this._pluginOptions=null,null!=this._plugin&&(this._plugin.onDisconnect(),this._plugin=null),this._pluginService=null,this._unsubscribeAll(),this._privateEventMgr=null,this._outputEventName=null,null!=this._outputObj&&("function"==typeof this._outputObj.destroy&&this._outputObj.destroy(),this._outputObj=null),null!=this._viewName&&(this._viewName=null)},i.prototype.setViewName=function(e){this._viewName=e},i.prototype.getViewName=function(){return this._viewName},i.prototype.updateOutput=function(t){if(0!=this._enabled){if(this._outputObj=t,widget.recordForODT){var n=this.getName(),i=null==this._outputObj?"null":JSON.stringify(JSON.decycle(this._outputObj,null,this._plugin._ODTDecycleExcludeKeys()));console.log("COMPARE PLUGIN OUTPUT: "+n),console.log(n+" OUTSTRING: "+i)}this._privateEventMgr.publish({event:this._outputEventName,data:{eventName:this._outputEventName,obj:this._outputObj}})}else e.dbgout("XXXX SERVICE NODE "+svcNodeName+" is disabled... output will not be forwarded")},i.prototype.getOutputEventName=function(){return this._outputEventName},i.prototype.subscribeToInputEvent=function(e){this._subscribe(e,n)},i.prototype._subscribe=function(t,n){if(null==this._subscribedTokens[t]){e.dbgout("SvcNode '"+this._name+"' will now listen to update event '"+t+"'");var i=this._privateEventMgr.subscribe({event:t},n.bind(this));this._subscribedTokens[t]=i}else e.dbgout("SvcNode '"+this._name+"' already listens to event '"+t+"'; ignoring (this is OK)...")},i.prototype._unsubscribeAll=function(){var e=this;Object.keys(e._subscribedTokens).forEach(function(t){var n=e._subscribedTokens[t];e._privateEventMgr.unsubscribe(n)}),this._subscribedTokens={}},i.prototype.handler_clearView=function(){1==this._enabled&&this._plugin.onClearView()},i.prototype.refresh=function(){1==this._enabled&&this.updateOutput(this._outputObj)},i.prototype.enable=function(){if(0==this._enabled)return e.dbgout("--\x3e enabling svcNode "+this.getName()),this._enabled=!0,this._plugin.onEnabled()},i.prototype.disable=function(){if(1==this._enabled)return e.dbgout("Enabling svcNode "+this.getName()),this._enabled=!1,this._plugin.onDisable()},i.prototype.buildViewPanel=function(){null==this._viewName?e.warnout("buildViewPanel called on svcNode with no view"):this._plugin.buildViewPanel(this._viewName,this._pluginOptions)},i.prototype.getName=function(){return this._name},i.prototype._debug_dump=function(){},i}),define("DS/CompareWidget2/plugins/MERGE/ViewPanel/mergeStructComparePanel",["DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structComparePanel","DS/CompareWidget2/ViewDefModules/DSColors","DS/CompareCommon/Utils","i18n!DS/CompareWidget2/assets/nls/MergePlugin","DS/CompareWidget2/plugins/MERGE/MaturityUtils","DS/CompareWidget2/plugins/MERGE/MergeConstants","DS/CompareWidget2/plugins/MERGE/NodeUtils","DS/LifecycleServices/LifecycleServices","DS/UIKIT/SuperModal"],function(e,t,n,i,r,o,a,s,l){return e.extend({init:function(e,t,n){this._plugSvcs=t,this._parent(e,t,n),this._contentFromLeftColor=n.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,this._contentFromRightColor=n.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR,this._actionInfos=null,this._displayMode="tree",this._treesAreReady=!1,this._setupActionDefs(),this.url3DSpace=this.get3DSpaceUrl(),this._hideAggregated3DShapes=!0,this._filterModelActions={},this._filterModelAggVisibility={},this._allowedDisplayModes=[{id:"tree",icon:"tree-view-all",title:i.MergeStructure,expandCollapseEnabled:!0}],this._visibleActions=[o.MergeAction.Revise,o.MergeAction.ReuseReference,o.MergeAction.Reuse,o.MergeAction.Exclude,o.MergeAction.InsertNew]},setActionInfos:function(e){this._actionInfos=e;var t=this._actionInfos.getOptions().reuseReferenceEnabled;if(this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdReuseRef",{visibleFlag:t}),!t){var n=this.standardToolbar.toolbarOtherItems.getNodeModelByID("actionFilter"),i=n.options.grid.data.menu.findIndex(e=>e.id===o.MergeAction.ReuseReference);n.options.grid.data.menu.splice(i,1)}},_setupActionDefs:function(){this._actionDefs=[{aid:0,id:o.MergeAction.Revise,fontIconName:"flow-line-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_MajorVersion.png",nls:i.Revise},{aid:1,id:o.MergeAction.ReuseReference,fontIconName:"recycle-left",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2L.png",nls:i.ReuseRef},{aid:2,id:o.MergeAction.Reuse,fontIconName:"recycle-right",imagePath:"webapps/CompareWidget/assets/icons/32/I_Reuse2R.png",nls:i.Reuse},{aid:3,id:o.MergeAction.Exclude,fontIconName:"remove",imagePath:"webapps/CompareWidget/assets/icons/32/I_Exclude.png",nls:i.Exclude},{aid:4,id:o.MergeAction.InsertNew,fontIconName:"flow-branch-add",imagePath:"webapps/LifecycleWidget/assets/icons/32/I_NewBranch.png",nls:i.InsertNew}]},_getActionDefs:function(){return this._actionDefs},get3DSpaceUrl:function(){var e=widget.getUrl();return e.substr(0,e.length-"webapps/CompareWidget/CompareWidget.html".length)},generateDataGridConfig:function(e){var n=this,r=this._parent(e),o=(e.baselineColor,e.compareColor,"4px solid "+t.colorDef.GREEN1),a="4px solid "+t.colorDef.GREY1;for(let e=0;e<2;e++)r[e].cols.splice(1,0,{text:i.Maturity,dataIndex:"maturityState",typeRepresentation:"tag",width:"80",hasCellValue:function(e){return!!(e.nodeModel&&e.nodeModel.getLabel()&&e.nodeModel.getLabel().length>0)},getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.options.data)return n._getMaturityStateCSSClassFromCRNode(e.nodeModel.options.data)}});return r[0].gridViewContainerParams.styles.width="33%",r[0].gridViewContainerParams.panelCaption=i.TreePanelCaptionReference,r[0].gridViewContainerParams.panelAddClass="treePanel-ref",r[0].gridViewContainerParams.panelCollapseable=!0,r[0].gridViewContainerParams.initSize50pct=!1,r[1].gridViewContainerParams.styles.width="33%",r[1].gridViewContainerParams.panelCaption=i.TreePanelCaptionSource,r[1].gridViewContainerParams.panelAddClass="treePanel-src",r[1].gridViewContainerParams.panelCollapseable=!0,r[1].gridViewContainerParams.initSize50pct=!1,r.splice(1,0,{cols:n.getActionTreeCols(),gridViewContainerParams:{id:"merge-tree-action",panelCaption:"",panelAddClass:"treePanel-act",panelCollapseable:!1,styles:{display:"flex",width:"45px","flex-direction":"column","border-top":a}},createTreeNodeConfig:n.getActionTreeNodeConfig.bind(n)}),r.push({cols:n.getResultTreeCols(),gridViewContainerParams:{id:"merge-tree-result",panelCaption:i.Result,panelAddClass:"treePanel-res",panelCollapseable:!1,styles:{display:"flex","flex-direction":"column",width:"33%","border-top":o}},createTreeNodeConfig:n.getResultTreeNodeConfig.bind(n)}),r},getActionTreeNodeConfig:function(e){var t=this._getResultLabelFromCRNode(e),n=this._getTypeFromCRNode(e),i=this._getSelActionNameFromCRNode(e),r=this._getSelActionIdFromCRNode(e),o={menu:this._getAvailableActionsMenuFromCRNode(e)},s=a.nodeIs3DShapeWith3DPartUsage(e)?"TRUE":"FALSE";return{data:e,label:t,icons:[e.getAttr("typeIconSmallURL")],grid:{type:n,actionSelectedName:i,actionSelectedId:r,aggregated3DShape:s,actionMenu:o}}},getResultTreeNodeConfig:function(e){var t=this._getContentColorFromCRNode(e),n=this._getResultLabelFromCRNode(e),i=this._getRevisionFromCRNode(e),r=this._getTypeFromCRNode(e),o=this._getSelActionNameFromCRNode(e),s=this._getSelActionIdFromCRNode(e),l=a.nodeIs3DShapeWith3DPartUsage(e)?"TRUE":"FALSE";return{data:e,label:n,icons:[e.getAttr("typeIconSmallURL")],grid:{rev:i,Color:t,type:r,actionSelectedName:o,actionSelectedId:s,aggregated3DShape:l}}},createDataForTreeNode:function(e){var t=this._parent(e);return t.grid.type=this._getTypeFromCRNode(e),t.grid.maturityState=this._getMaturityStateUserNameFromCRNode(e),t.grid.actionSelectedName=this._getSelActionNameFromCRNode(e),t.grid.actionSelectedId=this._getSelActionIdFromCRNode(e),t.grid.aggregated3DShape=a.nodeIs3DShapeWith3DPartUsage(e)?"TRUE":"FALSE",t},getActionTreeCols:function(){var e=this;return[{text:i.Action,dataIndex:"actionMenu",width:45,typeRepresentation:"functionMenuIcon",className:"merge-action-menu-column",getCellSemantics:function(t){if(t.nodeModel){var n=!1;if(t.nodeModel.options.data){var i=e._getInstPidFromCRNode(t.nodeModel.options.data),r=e._actionInfos.getInstActionInfo(i);r&&(r.getActions().length<2||r.getEnabledActionCount()<2)&&(n=!0)}return{disabled:n,icon:e._getSelActionIconFromCRNode(t.nodeModel.options.data),label:e._getSelActionNlsNameFromCRNode(t.nodeModel.options.data)}}},getCellTooltip:function(t){return{shortHelp:e._getSelActionNlsNameFromCRNode(t.nodeModel.options.data),updateModel:!1}}},{text:"Title",dataIndex:"tree",visibleFlag:!1,typeRepresentation:"string",getCellValue:function(t){return e._getResultLabelFromCRNode(t.nodeModel.options.data)},width:"auto"}]},getResultTreeCols:function(){var e=this;return[{text:"",dataIndex:"Color",typeRepresentation:"color",editableFlag:!1,width:"8.5",minWidth:"8.5",getCellTooltip:function(t){var n=t.nodeModel.getAttributeValue("Color"),r=i.ContentColorIndicator;return n===e._contentFromLeftColor?r=i.ContentFromLeft:n===e._contentFromRightColor&&(r=i.ContentFromRight),{shortHelp:r,updateModel:!1}},hasCellValue:function(t){return!!e._getContentColorFromCRNode(t.nodeModel.options.data)}},{text:"Title",dataIndex:"tree",typeRepresentation:"string",getCellValue:function(t){return e._getResultLabelFromCRNode(t.nodeModel.options.data)},width:"auto"},{text:"Revision",dataIndex:"rev",width:85,typeRepresentation:"string",getCellValue:function(t){return e._getRevisionFromCRNode(t.nodeModel.options.data)}}]},getEachGridColorColumns:function(){var e=this._parent(),t=[];return e.push(t),e.splice(1,0,t),e},_getTypeFromCRNode(e){var t="none";if(e)if(e.getAttr("type"))t=e.getAttr("type");else{var n=e.getMatchInfo();if(n){var i=n.getBaseNode();if(i.getAttr("type"))t=i.getAttr("type");else{var r=n.getCompNode();r.getAttr("type")&&(t=r.getAttr("type"))}}}return t},_getInstPidFromCRNode(e){if(e){var t=e.getMatchInfo(),n=t.getBaseNode().getAttr("physicalID_INST"),i=t.getCompNode().getAttr("physicalID_INST");return n||i}return null},_getBaseRefPidFromCRNode:e=>e?e.getMatchInfo().getBaseNode().getAttr("physicalID_REF"):null,_getCompRefPidFromCRNode:e=>e?e.getMatchInfo().getCompNode().getAttr("physicalID_REF"):null,_getInstPidFromCellInfos(e){return e.nodeModel.options.data?this._getInstPidFromCRNode(e.nodeModel.options.data):null},_getActionInfoFromCRNode(e){var t=this._getInstPidFromCRNode(e);return this._actionInfos.getInstActionInfo(t)},_getActionInfoFromCellInfos(e){var t=this._getInstPidFromCellInfos(e);return this._actionInfos.getInstActionInfo(t)},_getContentColorFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var i=null,r=e.getMatchInfo();if(r&&(i=r.getRelName()),i&&"LEFT_ONLY"===i)return null;var a=n.getActionOptionSelected()?n.getActionOptionSelected().name:"?";a===o.MergeAction.Revise||a===o.MergeAction.InsertNew?t=this._contentFromRightColor:a===o.MergeAction.Reuse?t=this._contentFromRightColor:a===o.MergeAction.ReuseReference&&(t=this._contentFromLeftColor)}return t},_getResultIconsFromCRNode:function(e){var t=[e.getAttr("typeIconSmallURL")],n=this._getActionInfoFromCRNode(e),i=e.getMatchInfo();if(n&&n.getActionOptionSelected()&&i){var r=n.getActionOptionSelected().name,a=i.getRelName();r===o.MergeAction.ReuseReference&&"RIGHT_ONLY"===a&&(t=[])}return t},_getResultLabelFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var i=null,r="",a="",s=e.getMatchInfo();if(s&&(i=s.getRelName(),s.getBaseNode()&&(r=s.getBaseNode().getAttr("title")),s.getCompNode()&&(a=s.getCompNode().getAttr("title"))),i&&"LEFT_ONLY"===i)return null;if(0===n.getActions().length)return this._plugSvcs.warnout("no actions, left title: "+r+", right title: "+a),"No actions!";if(!n.getActionSelected())return this._plugSvcs.warnout("no action selected, left title: "+r+", right title: "+a),"No action selected!";var l=n.getActionOptionSelected().name;l===o.MergeAction.Revise?t=r:l===o.MergeAction.ReuseReference?t=r:l===o.MergeAction.Reuse?t=n.getActionByOptionName(o.MergeAction.InsertNew)||i&&"IDENTICAL"!==i?a:r:l===o.MergeAction.InsertNew&&(t=a)}return t},_getRevisionFromCRNode:function(e){var t=null,n=this._getActionInfoFromCRNode(e);if(n){var i=null,r="",a="",s=e.getMatchInfo();if(s&&(i=s.getRelName(),s.getBaseNode()&&(r=s.getBaseNode().getAttr("revision")),s.getCompNode()&&(a=s.getCompNode().getAttr("revision"))),i&&"LEFT_ONLY"===i)return null;if(0===n.getActions().length)return"No actions!";if(!n.getActionSelected())return"No action selected!";var l=n.getActionOptionSelected().name;t=l===o.MergeAction.Revise?e.getAttr("nextrevision"):l===o.MergeAction.Reuse?a:l===o.MergeAction.ReuseReference?r:l===o.MergeAction.Exclude?"":l===o.MergeAction.InsertNew?e.getAttr("firstRevision"):e.getAttr("revision")}return t},_getSelActionNameFromCRNode:function(e){var t="",n=this._getActionInfoFromCRNode(e);if(n){var i=null,r=e.getMatchInfo();r&&(i=r.getRelName()),t=i&&"LEFT_ONLY"===i?o.MergeAction.Exclude:n.getActionOptionSelected().name}return t},_getSelActionIdFromCRNode:function(e){var t=0,n=this._getSelActionNameFromCRNode(e);return n&&n.length>0&&(t=this._getActionDefs().find(e=>e.id===n).aid),t},_getSelActionNlsNameFromCRNode:function(e){var t="",n=this._getSelActionNameFromCRNode(e);return n&&n.length>0&&(t=this._getActionDefs().find(e=>e.id===n).nls),t},_getSelActionIconFromCRNode:function(e){var t={},n=this._getSelActionNameFromCRNode(e);return n&&n.length>0&&(t=this._getActionIconFromActionName(n)),t},_getActionIconFromActionName:function(e){var t={iconName:this._getActionDefs().find(t=>t.id===e).fontIconName,fontIconFamily:1};return e===o.MergeAction.ReuseReference||o.MergeAction.Reuse,t},_getAvailableActionsMenuFromCRNode:function(e){var t=this,n=[],i=t._getActionInfoFromCRNode(e);if(i){var r=i.getEnabledActions();for(const i of r)n.push({type:"PushItem",title:i.actionOption.nls,icon:t._getActionIconFromActionName(i.actionOption.name),action:{callback:function(){t._handleActionSelectionChange(i,e),e.__TREENODE__.setAttribute("actionSelectedName",t._getSelActionNameFromCRNode(e)),e.__TREENODE__.setAttribute("actionSelectedId",t._getSelActionIdFromCRNode(e))}}})}return 1===n.length&&(n=[]),n},_getMaturityStateUserNameFromCRNode(e){var t="",n=this._getMaturityStateInfoFromCRNode(e);return n&&(t=n.stateUserName),t},_getMaturityStateActiveColorFromCRNode(e){var t="#FFFFFF",n=this._getMaturityStateInfoFromCRNode(e);return n&&(t=n.activeColor),t},_getMaturityStateCSSClassFromCRNode(e){var t="",n=e.getAttr("policy"),i=this._getMaturityStateInfoFromCRNode(e);if(i){var o=n+"."+i.stateSysName;t=r.getMaturityClass(o,"wux-controls-label")}return t},_getMaturityStateInfoFromCRNode(e){var t=null,n="",i="";if(e)if(e.getAttr("last.current"))i=e.getAttr("policy"),n=e.getAttr("last.current");else{var r=e.getMatchInfo();if(r){var o=r.getBaseNode();if(o.getAttr("last.current"))i=o.getAttr("policy"),n=o.getAttr("last.current");else{var a=r.getCompNode();a.getAttr("last.current")&&(i=a.getAttr("policy"),n=a.getAttr("last.current"))}}}var s=this._maturityStatesInfo.policies.find(e=>e.policyName===i);return s&&(t=s.states.find(e=>e.stateSysName===n)),t},_handleActionSelectionChange(e,t){var n=this,i=this._getActionInfoFromCRNode(t);if(i){var r=i.getActionOptionSelected(),o=n._actionInfos.updateActionSelected(t,e.actionOption.name);n._plugSvcs.dbgout("Changed from action "+r.nls+" to action "+e.actionOption.nls+".");var a={match:function(e){var t=e.nodeModel.options.data;if(t){var n=t.getAttr("physicalID_REF");if(o.has(n))return!0;var i=t.getMatchInfo();if(i){var r=i.getBaseNode().getAttr("physicalID_REF");if(r&&o.has(r))return!0;var a=i.getCompNode().getAttr("physicalID_REF");if(a&&o.has(a))return!0}}return!1}},s=n._activeTrees.dataGridViews[0];let d=s.getTreeDocument().search(a);s.getTreeDocument().prepareUpdate(),d.forEach(function(e){var t={grid:{actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),s.getTreeDocument().pushUpdate();var l=n._activeTrees.dataGridViews[1];let p=l.getTreeDocument().search(a);l.getTreeDocument().prepareUpdate(),p.forEach(function(e){var t={grid:{actionMenu:{menu:n._getAvailableActionsMenuFromCRNode(e.options.data)},actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),l.getTreeDocument().pushUpdate();var c=n._activeTrees.dataGridViews[2];let h=c.getTreeDocument().search(a);c.getTreeDocument().prepareUpdate(),h.forEach(function(e){var t={grid:{actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),c.getTreeDocument().pushUpdate();var u=n._activeTrees.dataGridViews[3];let g=u.getTreeDocument().search(a);u.getTreeDocument().prepareUpdate(),g.forEach(function(e){var t={label:n._getResultLabelFromCRNode(e.options.data),icons:n._getResultIconsFromCRNode(e.options.data),grid:{Color:n._getContentColorFromCRNode(e.options.data),actionSelectedName:n._getSelActionNameFromCRNode(e.options.data),actionSelectedId:n._getSelActionIdFromCRNode(e.options.data)}};e.updateOptions(t)}),u.getTreeDocument().pushUpdate()}},applyOtherMenuCommands:function(){var e=this,t=this._parent(),n=[];n.push({id:"cmdRevise",dataElements:{typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:150,tooltip:i.Revise,icon:e._getActionIconFromActionName(o.MergeAction.Revise),value:t=>e.onRevise()}}),n.push({id:"cmdReuseRef",dataElements:{typeRepresentation:"functionIcon",visibleFlag:!1,category:"mergeActions",position:"far",priority:151,tooltip:i.ReuseRef,icon:e._getActionIconFromActionName(o.MergeAction.ReuseReference),value:t=>e.onReuseRef()}}),n.push({id:"cmdReuse",dataElements:{typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:152,tooltip:i.Reuse,icon:e._getActionIconFromActionName(o.MergeAction.Reuse),value:t=>e.onReuse()}}),n.push({id:"cmdInsertNew",dataElements:{typeRepresentation:"functionIcon",category:"mergeActions",position:"far",priority:153,tooltip:i.InsertNew,icon:e._getActionIconFromActionName(o.MergeAction.InsertNew),value:t=>e.onInsertNew()}});var r=[];for(const t of this._actionDefs)r.push({id:t.id,type:"CheckItem",tooltip:t.nls,icon:e._getActionIconFromActionName(t.id),state:e._visibleActions.includes(t.id)?"selected":"unselected",action:{callback:function(){e.applyActionFilter(t.id)}}});return r.push({type:"SeparatorItem"}),r.push({id:"refresh",type:"PushItem",tooltip:i.ReapplyCurrentFilter,icon:{iconName:"refresh",fontIconFamily:1},action:{callback:function(){e.reapplyFilter()}}}),n.push({id:"actionFilter",dataElements:{typeRepresentation:"functionMenuIcon",category:"actionFilter",position:"far",priority:154,tooltip:i.ActionFilter,icon:{iconName:"filter-select-on",fontIconFamily:1},value:{menu:r}}}),n.push(...t),n.push({id:"cmdMerge",dataElements:{typeRepresentation:"function",emphasize:"primary",category:"mergeAction",position:"far",priority:999,label:i.Merge,tooltip:i.Merge,value:t=>e.onMerge()}}),n},_getMaturityStatesAttributes:function(e){var t=this;return new UWA.Class.Promise(function(n,i){var r=new Set;e.visitAll_treeAndFN(0,function(e){var t=e.getAttr("policy");t&&r.add(t)}),e.visitAll_treeAndFN(1,function(e){var t=e.getAttr("policy");t&&r.add(t)});var o={policies:Array.from(r)},a=e.getRoot(0).getObjIDSpec_REF(),s=a.getTenant(),l=a.getServiceName(),c=a.getSecurityContext(),u=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/maturity/getStatesAttributes","POST",o,"json",s,l,c).then(function(e){t._plugSvcs.reportTime(u,"getStatesAttributes request OK.");var i="string"==typeof e?JSON.parse(e):e;n(i)},function(e){t._plugSvcs.reportTime(u,"getStatesAttributes request failed."),t._plugSvcs.showAlertBox("getStatesAttributes request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getStatesAttributes request: "+e)})})},_getNextRevisionInfo:function(e){var t=this;return new UWA.Class.Promise(function(n,i){var r=new Set;e.visitAll_treeAndFN(0,function(e){var t=e.getMatchInfo();if(t){var n=t.getBaseNode();if(n){var i=n.getAttr("physicalID_REF");i&&r.add(i)}}});var o=[],a=[];r.forEach(function(e){(a=[]).push({semantic:"LAST",id:e}),o.push({copyId:e,ancestors:a})});var s={addRequests:o},l=e.getRoot(0).getObjIDSpec_REF(),c=l.getTenant(),u=l.getServiceName(),d=l.getSecurityContext(),p=t._plugSvcs.nowMS();t._plugSvcs.makeAuthHttpsCall("/resources/v1/dslc/getversionnumberproposal","POST",s,"json",c,u,d).then(function(e){t._plugSvcs.reportTime(p,"getversionnumberproposal request OK.");var i="string"==typeof e?JSON.parse(e):e;n(i)},function(e){t._plugSvcs.reportTime(p,"getversionnumberproposal request failed."),t._plugSvcs.showAlertBox("getversionnumberproposal request unsuccessful.",null,"error"),t._plugSvcs.errout("Failure of getversionnumberproposal request: "+e)})})},_populateNextRevisionInfo:function(e,t){e.getNextRev=function(e){return this.addRequests.find(t=>t.copyId===e).code},t.visitAll_treeAndFN(1,function(t){var n=t.getMatchInfo();if(n){var i=n.getBaseNode();if(i){var r=i.getAttr("physicalID_REF");if(r){var o=e.getNextRev(r);t.addAttr("nextrevision",o)}}}})},_addCSSMaturityClasses:function(){r.addCSSMaturityClasses(this._maturityStatesInfo.policies,"wux-controls-label")},updateResults:function(t,n,i){var r=this,o=this._getNextRevisionInfo(i),a=this._getMaturityStatesAttributes(i);return UWA.Promise.all([o,a]).then(function(o){var a=o[0];return r._maturityStatesInfo=o[1],r._addCSSMaturityClasses(),r._populateNextRevisionInfo(a,i),e.prototype.updateResults.call(r,t,n,i)})},setup_tree:function(){var e=this;e._listTrees&&e._listTrees.hide(),e._structTrees&&e._structTrees.show(),e._activeColData=[e._crTree.getRoot(0),e._crTree.getRoot(1),e._crTree.getRoot(1),e._crTree.getRoot(1)],e._activeMatchPairArray=e._structMatchPairArray,e._activeDiffFlagInfo=e._structDiffFlagInfo,e._activeTrees=e._structTrees},getTreePanelCaptions:function(){var e=this._parent();return e.forEach(function(e){"compare-tree-left"===e.panelContentId?e.panelCaption=i.TreePanelCaptionReference:"compare-tree-right"===e.panelContentId&&(e.panelCaption=i.TreePanelCaptionSource)}),e},onTreesReady:function(e){var t=this;this._parent(e),this._treesAreReady=!0;var n=function(e){var n=t._getInstPidFromCRNode(e.data.nodeModel.options.data),i=e.data.nodeModel.options.data.getExpandCollapseState();if(e.data.virtualRowID){var r={match:function(i){var r=t._getInstPidFromCRNode(i.nodeModel.options.data);return i.nodeModel._rowID===e.data.virtualRowID&&r===n}};t._activeTrees.dataGridViews[1].getTreeDocument().search(r).forEach(function(t){"show"===e.event?(t.show(),t.setState({state:i})):"hide"===e.event&&t.hide()}),t._activeTrees.dataGridViews[2].getTreeDocument().search(r).forEach(function(t){"show"===e.event?(t.show(),t.setState({state:i})):"hide"===e.event&&t.hide()})}},i=this._activeTrees.dataGridViews[0];i.getTreeDocument().addEventListener("show",n),i.getTreeDocument().addEventListener("hide",n),this.applyAggregatedVisibilityFilter(this._hideAggregated3DShapes)},applyCurrentFilterToTrees:function(){const e=Object.assign({},this._filterModelActions,this._filterModelAggVisibility);this.applyFilterModelToTrees(e)},applyFilterModelToTrees:function(e){var t=this._activeTrees.dataGridViews[0],n=this._activeTrees.dataGridViews[1],i=this._activeTrees.dataGridViews[2],r=this._activeTrees.dataGridViews[3];t.getTreeDocument().setFilterModel(e),n.getTreeDocument().setFilterModel(e),i.getTreeDocument().setFilterModel(e),r.getTreeDocument().setFilterModel(e),this._syncOverview()},updateAggregatedVisibilityFilter:function(e){var t={aggregated3DShape:{filterId:"stringRegexp",filterModel:{condition1:{type:"startsWith",filter:"FALSE"}}}};e||(t.aggregated3DShape.filterModel.operator="or",t.aggregated3DShape.filterModel.condition2={type:"startsWith",filter:"TRUE"}),this._filterModelAggVisibility=t},applyAggregatedVisibilityFilter:function(e){this.updateAggregatedVisibilityFilter(e),this.applyCurrentFilterToTrees()},toggleAggregatedVisibilityFilter:function(){this._hideAggregated3DShapes=!this._hideAggregated3DShapes,this.standardToolbar.toolbarOtherItems.getNodeModelByID("mergePanelSettings").options.grid.data.menu.find(e=>"hideAgg3DShapes"===e.id).state=this._hideAggregated3DShapes?"selected":"unselected",this.applyAggregatedVisibilityFilter(this._hideAggregated3DShapes)},updateActionFilter:function(e){var t=this.standardToolbar.toolbarOtherItems.getNodeModelByID("actionFilter").options.grid.data.menu.find(t=>t.id===e),n=this._visibleActions;n.includes(e)?(n.splice(n.indexOf(e),1),t.state="unselected"):(n.push(e),t.state="selected"),this._visibleActions=n;var i=[];for(const e of n){var r=this._getActionDefs().find(t=>t.id===e).aid;i.push(r)}var o={actionSelectedId:{filterId:"set",filterModel:i}};this._filterModelActions=o},applyActionFilter:function(e){this.updateActionFilter(e),this.applyCurrentFilterToTrees()},reapplyFilter:function(){var e=this._activeTrees.dataGridViews[0],t=this._activeTrees.dataGridViews[1],n=this._activeTrees.dataGridViews[2],i=this._activeTrees.dataGridViews[3];e.getTreeDocument().reapplyFilterModel(),t.getTreeDocument().reapplyFilterModel(),n.getTreeDocument().reapplyFilterModel(),i.getTreeDocument().reapplyFilterModel(),this._syncOverview()},onCmd:function(e){var t=e.data;"revise"==t?this.onRevise():"reuse"==t?this.onReuse():"branch"==t?this.onBranch():"overwrite"==t?this.onOverwrite():"exclude"==t&&this.onExclude(),alert("handling "+t+" in mergeStructComparePanel...")},onAction:function(e){var t=this;this._activeTrees.dataGridViews[0].getTreeDocument().getSelectedNodes().forEach(function(n){var i=n.options.data;if(i){var r=t._getActionInfoFromCRNode(i);if(r){var o=r.getActionByOptionName(e);o&&o.isEnabled&&!o.isSelected&&(t._handleActionSelectionChange(o,i),n.setAttribute("actionSelectedName",t._getSelActionNameFromCRNode(i)),n.setAttribute("actionSelectedId",t._getSelActionIdFromCRNode(i)))}}})},onRevise:function(){this.onAction(o.MergeAction.Revise)},onReuse:function(){this.onAction(o.MergeAction.Reuse)},onReuseRef:function(){this.onAction(o.MergeAction.ReuseReference)},onInsertNew:function(){this.onAction(o.MergeAction.InsertNew)},onOverwrite:function(){},onExclude:function(){},_getMergeData:function(){var e=this._crTree.getRoot(1),t=this._getBaseRefPidFromCRNode(e),n=[];this._addMergeNodeData(n,e,[],0);var i={physicalid:t,treeData:n,useSourceTitle:!1},r=[];return r.push(i),r},_addMergeNodeData:function(e,t,n,i){var r=this._getBaseRefPidFromCRNode(t),a=this._getCompRefPidFromCRNode(t),s=r||a;if(-1===n.indexOf(s)){n.push(s);var l=this._getActionInfoFromCRNode(t).getActionOptionSelected().name;if(l!==o.MergeAction.Exclude){l!==o.MergeAction.ReuseReference||a&&a!==r||(l=o.MergeAction.Reuse);var c=l===o.MergeAction.InsertNew,u=l===o.MergeAction.Reuse,d=l===o.MergeAction.ReuseReference,p={physicalid:c?"":r||a,operation:l,physicalid_dup:a,level:i},h=t.getChildArray();if(!u&&!d&&h.length>0){p.children=[];for(const t of h){var g=this._getBaseRefPidFromCRNode(t),_=this._getCompRefPidFromCRNode(t),f=this._getActionInfoFromCRNode(t).getActionOptionSelected().name;if(f!==o.MergeAction.Exclude){f!==o.MergeAction.ReuseReference||_&&_!==g||(f=o.MergeAction.Reuse);var S=f===o.MergeAction.InsertNew,m=f===o.MergeAction.Reuse,E=f===o.MergeAction.ReuseReference,C={physicalid:S?"":g||_,operation:f,physicalid_dup:_};p.children.push(C),m&&E||S||!(t.getChildArray().length>0)||this._addMergeNodeData(e,t,n,i+1)}}}e.push(p)}}},onMerge:function(){var e=this;new l({renderTo:widget.body}).confirm(i.MergeConfirmMsg,i.MergeConfirmTitle,function(t){t&&e.doMerge()})},doMerge:function(){var e=this;this._plugSvcs.postEvent("MERGE_STARTED_EVENT");var t=this._getMergeData(),n={data:t},r=this._crTree.getRoot(1).getObjIDSpec_REF(),o=r.getTenant(),a=r.getServiceName(),s=r.getSecurityContext(),l=e._plugSvcs.nowMS();this._plugSvcs.makeAuthHttpsCall("/resources/lifecycle/revise/from/","POST",n,"json",o,a,s).then(function(n){if(e._plugSvcs.reportTime(l,"Merge request done OK."),null!=n&&n.hasOwnProperty("status")&&n.hasOwnProperty("report")&&"failure"===n.status){for(var r=i.MergeFailureMsg,o=0;o<n.report.length;o++){var a=n.report[o];if(a.error&&a.error!==r){r=a.error;break}}return e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),void e.showErrorMsg(r)}e.doPostMergeRefresh(t,n.results),e._plugSvcs.postEvent("MERGE_ENDED_OK_EVENT"),e._plugSvcs.showAlertBox(i.MergeSuccessMsg,null,"success"),e.doPostMergeOK()},function(t){e._plugSvcs.reportTime(l,"Merge request failed."),e._plugSvcs.postEvent("MERGE_ENDED_KO_EVENT"),e.handleRequestFailure(!0,t),e._plugSvcs.errout("Failure to merge: "+t)})},doPostMergeRefresh:function(e,t){var i={created:[],deleted:[],modified:[],context:null},r=n.fetchContentFromCompass();if(r&&r.source){var o=r.source,a="ENOPRSU_AP"===o||"ENOPSTR_AP"===o;i.context={widget:{data:{x3dAppId:o}}}}var s=e[0].treeData.findIndex(e=>0==e.level),l=e[0].treeData[s],c=t.find(e=>e.derivedfromphysicalid===l.physicalid),u={physicalid:c.physicalid,sourceObjectId:c.derivedfromphysicalid,operation:"Revise",refreshPSD:a};i.created.push(u),t.forEach(function(e){var t={physicalid:e.derivedfromphysicalid,operation:"Revise"};i.modified.push(t)});require(["DS/LifecycleServices/Refresh"],function(e){e._refreshCb(i)})},doPostMergeOK:function(){this.standardToolbar.toolbarOtherItems.updateNodeModel("cmdMerge",{disabled:!0});var e=null,t=window.frameElement.id.replace("frame","wi"),n=window.parent.document.querySelector("."+t);if(n){var r=n.querySelector(".moduleHeader");r&&(e=r.querySelector(".close-icon"))}e&&new l({renderTo:widget.body}).confirm(i.MergeConfirmCloseDialogMsg,i.Merge,function(t){t&&e.click()})},handleRequestFailure:function(e,t,n){var i=this;s.showWebServiceError(t,n,function(e,t,n,r,o){t?i.showNotifMsg(e,{sticky:!0}):i.showErrorMsg(e,{title:n,subtitle:r,submessage:o})},e)},showNotifMsg:function(e,t){this._plugSvcs.showAlertBox(e,null,"warning")},showErrorMsg:function(e,t){this._plugSvcs.showAlertBox(e,null,"error")},loadActions:function(e,t){this._plugSvcs.postEvent("MERGE_ACTION_CHANGE_EVENT",this)},getLabel:function(){return i.MergeStructure},getName:function(){return"merge-struct"}})}),define("DS/CompareWidget2/plugins/MERGE/MERGE_STRUCT_DISPLAY_plugin",["DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin","DS/CompareWidget2/plugins/MERGE/ViewPanel/mergeStructComparePanel","DS/CompareWidget2/plugins/MERGE/actionInfos","i18n!DS/CompareWidget2/assets/nls/MergePlugin"],function(e,t,n,i){return e.extend({onEnabled:function(){var e=this;return e.subscribeEvent("MERGE_STARTED_EVENT",function(){e.showMessage(i.Merging)}.bind(e)),e.subscribeEvent("MERGE_ENDED_OK_EVENT",function(){e.removeMessage()}.bind(e)),e.subscribeEvent("MERGE_ENDED_KO_EVENT",function(){e.removeMessage()}.bind(e)),e._parent()},createViewPanelObject:function(e,n){return this.panel=new t(e,this._plugSvcs,n),this.panel.addEvent("onTreesLoaded",this.onTreesLoaded.bind(this)),this.subscribeEvent("MERGE_CMD",this.panel.onCmd.bind(this.panel)),this.panel},onTreesLoaded:function(){this.panel.loadActions(this.panel._crTree.getRoot(0),this.panel._crTree.getRoot(1))},execute:function(e,t){if(this.panel.setActionInfos(e.actionInfos),this._parent(e,t),null!=e.crTreeArray){var n={crTreeArray:e.crTreeArray,ruleNames:e.ruleNames,actionInfos:e.actionInfos,destroy:function(){}};this.reportOK(n)}else this.reportKO()}})}),define("DS/CompareWidget2/framework/svcNodeNet",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/svcNode"],function(e,t){var n=function(e,t){this._privateEventMgr=t,this._plugSvcs=e,this._inputEventName="DEFAULT_INPUT",this._svcNodeSet={},this._viewSvcNodeArray=[],this._lastObjSent=null,this._subscribeTokens={},this._beginTimeMS=0,this._waitingCount=0};return n.prototype.destroy=function(){var e=this;e._unsubscribeAllEvents(),e._privateEventMgr=null,e._plugSvcs=null,Object.keys(e._svcNodeSet).forEach(function(t){e._svcNodeSet[t].destroy()}),e._svcNodeSet=null,e._viewSvcNodeArray=[]},n.prototype.updateInput=function(t){this._beginTimeMS=this._plugSvcs.nowMS(),this._waitingCount=Object.keys(this._subscribeTokens).length,e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------[ P R O C E S S I N G    I D S   B E G I N  ] -----------"),e.dbgout("---------------------------------------------------------------------"),e.dbgout("svcNodeNet updating input... raising event '"+this._inputEventName+"'"),this._lastObjSent=t,this._privateEventMgr.publish({event:this._inputEventName,data:{eventName:this._inputEventName,obj:t}})},n.prototype.buildViewPanels=function(){e.dbgout("------------[ B U I L D   V I E W S   B E G I N ] -----------");var t=this._plugSvcs.nowMS();this._viewSvcNodeArray.forEach(function(t){e.dbgout("Building view: "+t.getViewName()),t.buildViewPanel()}),this._plugSvcs.reportTime(t," views built"),e.dbgout("------------[ B U I L D   V I E W S   E N D     ] -----------")},n.prototype.build=function(n){var i=this;e.dbgout("------------[ C R E A T E   S v c   N o d e   N E T W O R K   B E G I N ] -----------");var r=i._plugSvcs.nowMS(),o=n.PLUGSLOADED,a=n.PLUGDEFS;Object.keys(a).forEach(function(e){var n=a[e],r=n.Path,s=n.Options,l=o[e],c=new t(e,r,s,l,i._plugSvcs,i._privateEventMgr);i._svcNodeSet[e]=c});n.VIEWSET;var s=n.VIEWDEFS;Object.keys(s).forEach(function(e){var t=s[e],n=t[0],r=i._svcNodeSet[n];r.subscribeToInputEvent(i._inputEventName);for(var o=r.getOutputEventName(),a=t.length,l=1;l<a;l++){var c=t[l],u=i._svcNodeSet[c];u.subscribeToInputEvent(o),o=u.getOutputEventName()}i._addToFinishedEventList(o)}),Object.keys(s).forEach(function(e){for(var t=s[e],n=0;n<t.length;n++){var r=t[n],o=i._svcNodeSet[r];o._plugin.isDisplayPlugin instanceof Function&&1==o._plugin.isDisplayPlugin()&&(o.setViewName(e),i._viewSvcNodeArray.push(o))}}),i._plugSvcs.reportTime(r," svcNodeNet built"),e.dbgout("------------[ C R E A T E   S v c   N o d e   N E T W O R K   E N D ] -----------")},n.prototype.enableAll=function(){var t=this._setNetEnable(!0);return 0==t&&e.errout("There was a problem enabling the service nodes"),t},n.prototype.disableAll=function(){return this._setNetEnable(!1)},n.prototype._setNetEnable=function(e){var t=this,n=!1;return Object.keys(t._svcNodeSet).forEach(function(i){var r=t._svcNodeSet[i];n|=1==e?r.enable():r.disable()}),n},n.prototype._handleFinishedEvent=function(){this._waitingCount>0&&(this._waitingCount--,0==this._waitingCount&&(e.dbgout("---------------------------------------------------------------------"),e.dbgout("------------- [ P R O C E S S I N G    I D S   E N D  ] -------------"),e.dbgout("---------------------------------------------------------------------"),e.reportTime(this._beginTimeMS," svcNodeNetwork completes; async ops may still be processing")))},n.prototype._addToFinishedEventList=function(e){this._subscribeTokens[e]=this._privateEventMgr.subscribe({event:e},this._handleFinishedEvent.bind(this))},n.prototype._unsubscribeAllEvents=function(){var e=this;Object.keys(e._subscribeTokens).forEach(function(t){var n=e._subscribeTokens[t];e._privateEventMgr.unsubscribe(n)}),e._subscribeTokens={}},n}),define("DS/CompareWidget2/ViewDefModules/MergeViewDefs",["DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){const n=e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR,i=e.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR;var r=UWA.clone(e,!0);r.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR=n,r.STRUCT_DISPLAY_OPTIONS.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR=i;var o={colorLeft:n,colorRight:i},a=r.INST_ATTR_DISPLAY_OPTIONS;a.colorLeft=o.colorLeft,a.colorRight=o.colorRight;var s=r.STRUCT_DISPLAY_OPTIONS;s.SYSTEM_RULE_ID_FLAGS.LEFT_ONLY.COLOR=n,s.SYSTEM_RULE_ID_FLAGS.RIGHT_ONLY.COLOR=i,s.CONTEXT_MENU_PLUGIN="DS/CompareWidget2/plugins/MERGE/ViewPanel/mergeDefaultContextMenu",s.COLLAPSE_3DPARTS=!1;var l=UWA.clone(e.STRUCT_FETCH_OPTIONS,!0);l.COMMAND_CONTEXT="merge",UWA.merge(r,{MERGE_DISPLAY_OPTIONS:s}),UWA.merge(r,{MERGE_STRUCT_FETCH_OPTIONS:l});var c={View3DDisplay:{Path:"DS/CompareWidget2/plugins/VIEW3D/VIEW3D_DISPLAY_plugin",Options:s},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:o},InstAttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin",Options:a},MergeStructFetch:{Path:"DS/CompareWidget2/plugins/MERGE/MERGE_STRUCT_FETCH_plugin",Options:l},MergeComputeActions:{Path:"DS/CompareWidget2/plugins/MERGE/MERGE_COMPUTE_ACTIONS_plugin"},MergeStructDisplay:{Path:"DS/CompareWidget2/plugins/MERGE/MERGE_STRUCT_DISPLAY_plugin",Options:s}};UWA.extend(r.PLUGDEFS,c);UWA.extend(r.VIEWDEFS,{MERGE_STRUCT_VIEW:["MergeStructFetch","StructCompare","StructListViewPrep","MergeComputeActions","MergeStructDisplay"]});return UWA.extend(r.VIEWSETS,{MERGE_VIEW:{ROW:["MERGE_STRUCT_VIEW",{COL:["PROP_VIEW","PAD3D_VIEW"]}]},MERGE_AND_PROPS_HORIZ:{COL:["MERGE_STRUCT_VIEW","PROP_VIEW"]},MERGE_AND_PROPS_VERT:{ROW:["MERGE_STRUCT_VIEW","PROP_VIEW"]},MERGE_ONLY:{ROW:["MERGE_STRUCT_VIEW"]},MERGE_COMPARE_PROPS_INST:{ROW:[["MERGE_STRUCT_VIEW","STRUCT_VIEW"],["PROP_VIEW","INSTANCE_VIEW"]]},MERGE_PROPS_INST:{ROW:[["MERGE_STRUCT_VIEW"],["PROP_VIEW","INSTANCE_VIEW"]]}}),r}),define("DS/CompareWidget2/ViewDefModules/MergeRFLViewDefs",["DS/CompareWidget2/ViewDefModules/MergeViewDefs"],function(e){var t=UWA.clone(e,!0);return t.MERGE_STRUCT_FETCH_OPTIONS.DATA_SOURCE="LC_IDX_SERVICE",t.PLUGDEFS.MergeStructFetch.Options=t.MERGE_STRUCT_FETCH_OPTIONS,t}),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var n={PHYSICALID:"REF.physicalid",NAME:"REF.name",REVISION:"REF.ds6wg:revision",DERIVEDFROMID:"REF.derivedFromId",VERSIONID:"REF.versionid",REF_LOGID:"REF.logicalid"};return{CV_PROPS:n,STRUCT_FETCH_OPTIONS:{CV_PROPS:n},STRUCT_COMPARE_OPTIONS:{PROPS:n,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION","BRANCH","DUPE"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ","NEQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ","NEQ","NEQ"]],COMP_REF_LOGID:[["REF_LOGID","REF_LOGID"],["EQ","EQ","EQ","NEQ"]],COMP_DERIVEDFROMID:[["DERIVEDFROMID","DERIVEDFROMID"],["EQ","EQ","EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},STRUCT_DISPLAY_OPTIONS:{SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},BRANCH:{COLOR:t.colorDef.GREEN2,NLS:"BRANCHED"},DUPE:{COLOR:t.colorDef.RED,NLS:"DUPLICATED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu"}}}),define("DS/CompareWidget2/ViewDefModules/PortfolioViewDefs_V2",["DS/CompareWidget2/ViewDefModules/PortfolioViewDefOptions"],function(e){"use strict";var t={AttrFetchPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrComparePort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplayPort:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},StructFetchPort:{Path:"DS/CompareWidget2/plugins/PORTFOLIO/PORTFOLIO_STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructComparePort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplayPort:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{PORTFOLIO_STANDARD:{COL:["PORTFOLIO_STRUCT_VIEW","PORTFOLIO_PROP_VIEW"]}},VIEWDEFS:{PORTFOLIO_PROP_VIEW:["AttrFetchPort","AttrComparePort","AttrDisplayPort"],PORTFOLIO_STRUCT_VIEW:["StructFetchPort","StructComparePort","StructListViewPrep","StructDisplayPort","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/framework/viewSetMgr",["DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,n,i){function r(e,t,i){return n.makeAuthHttpsCall("/resources/compare2/SelectViewSet/","POST",i,"json",t,e,null)}function o(e){return new Promise(function(n,o){var a=e.getSvcTypeArray(),s=t.stringify(e),l=i.getCacheObj("viewSetCache",s);if(null!=l)n(l);else{t.splitSvcType(a[0]).svc,t.splitSvcType(a[1]).svc;(function(e,n,i){return new Promise(function(o,a){var s=t.getCurrentTenant();r(e,s,i).then(function(a){var l=a;t.dbgout("INIT","<><> ---\x3e Eval from service "+e+" is "+JSON.stringify(l)),e==n?o(l):r(n,s,i).then(function(e){var i=e;t.dbgout("INIT","<><> ---\x3e Eval from service "+n+" is "+JSON.stringify(i));var r=null;r=l.eval<i.eval?l:i,t.dbgout("INIT","<><> ---\x3e Best is: "+JSON.stringify(r)),o(r)},function(e){t.dbgout("INIT","<><> ---\x3e using: "+JSON.stringify(l)),o(l)})},function(t){e==n?a("failed to find appropriate viewDef: "+t):fetchViewDefFromService(serviceName2,s,i).then(function(e){o(best2)},function(e){a("failed to find appropriate viewDef on either service... giving up ("+e+")")})})})})("3DSpace","3DSpace",e).then(function(e){i.putCacheObj("viewSetCache",s,e),n(e)},function(e){t.errout("Failure:: "+e),o(e)})}})}function a(e,n,i,r,o){var a=i.VIEWSETS[n],s={};if(!t.checkViewConfig(a))throw Error("The view set is not properly defined. Please check...");!function(e,n,i){t.getViewDefs(n).forEach(t=>{if(null==e.VIEWDEFS[t])throw Error("extractViewDefs: View def for "+t+" not found");i[t]=e.VIEWDEFS[t]})}(i,a,s);var l=s,c=function(e,n){var i={};return Object.keys(n).forEach(function(r){n[r].forEach(function(n){var r=e.PLUGDEFS[n],o={Path:t.dupeJson(r.Path)};null!=r.Options&&(o.Options=t.dupeJson(r.Options)),i[n]=o})}),i}(i,l);return{viewDefModPath:e,viewSetName:n,VIEWSET:a,VIEWDEFS:l,PLUGDEFS:c,mainToolbarConfigPath:r,mainToolbarOptions:o||[]}}var s=function(){};return s.prototype.loadViewConfig=function(e,n,i,r){return new Promise(function(o,s){require([e],function(s){t.dbgout("INIT","Successfully loaded viewSet '"+n+"' from module '"+e+"'");var l=a(e,n,s,i,r);o(l)},function(n){t.errout("FAILED to load viewDefMod '"+e+"'"),s("LOAD FAILURE")})})},s.prototype.getViewConfig=function(e){var n=this;return new Promise(function(i,r){o(e).then(function(e){var o=e.viewSetMod,a=e.viewSetName,s=e.mainToolbarConfig[0].Location,l=e.mainToolbarConfig[0].DoNotInclude;t.dbgout("INIT","<><> BEST viewSet for usecase is: '"+a+"' from viewDefModule '"+o+"'"),n.loadViewConfig(o,a,s,l).then(function(e){i(e)},function(e){t.errout("Cannot return viewConfigFailure loading fetching viewSet:: "+e),r(e)})},function(e){return t.errout("Failure fetching viewSet:: "+e),e})})},s}),define("DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e,t,n){this.visible=e,this.displayName=null==t||""===t?n:t,this.name=n,this.valueLeft="",this.valuesRight=[],this.highlightRight=[],this._reqMod="DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj"};return t.prototype.setLeftVal=function(e){this.valueLeft=e},t.prototype.setRightVal=function(e,t){this.valuesRight[e]=t},t.prototype.setRightValHighlight=function(e,t){this.highlightRight[e]=t},t}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/ATTRIBUTE/attrCompareObj","DS/CompareCommon/Utils"],function(e,t,n){return e.extend({execute:function(e,n){this._parent(e,n);var i=function(e){var n={},i=[],r=[],o=[],a=[],s=[],l=[];if(e.length>0)for(var c=0;c<e.length;c++)l.push(e[c].objType);if(l.every((e,t,n)=>e===n[0])){e.forEach((e,t)=>{e.attrVals.forEach((e,s)=>{var l=e.name,c=e.nls,u=e.getFormattedValue();null!=u&&u.constructor==Array&&1==u.length&&(u=u[0]),null==n[l]&&(n[l]=[]),n[l][t]=u,isNaN(e.UIPosition)?o.includes(l)||(o.push(l),a.push(c)):(i[e.UIPosition]=l,r[e.UIPosition]=c)})}),i.push(...o),r.push(...a);for(var u=[],d=i.length,p=0;p<d;p++){var h=i[p],g=r[p];if(null!=h){var _=new t(!0,g,h);u.push(_);var f=(C=n[h])[0];_.setLeftVal(f);for(var S=C.length,m=1;m<S;m++){var E=C[m];this._plugSvcs.csValsEquivalent(f,E)?(_.setRightVal(m-1,f),_.setRightValHighlight(m-1,!1)):(_.setRightVal(m-1,E),_.setRightValHighlight(m-1,!0))}}}return u}for(e.forEach((e,t)=>{if(null!=e.attrVals&&null!=e.attrVals)for(var i=0;i<e.attrVals.length;++i){var r=e.attrVals[i].nls||e.attrVals[i].name;if(null==n[r]&&(n[r]=[],t>0))for(var o=0;o<t;o++)n[r][o]=null;null!=e.attrVals[i].value?n[r][t]=e.attrVals[i].getFormattedValue():n[r][t]=null,-1===s.findIndex(e=>e.attrKey===r)&&s.push({attrNLS:e.attrVals[i].nls||e.attrVals[i].displayName,attrType:e.attrVals[i].type,attrKey:r,attrName:e.attrVals[i].name})}}),u=[],d=s.length,p=0;p<d;p++)if(h=s[p].attrName,g=s[p].attrNLS,null!=h){_=new t(!0,g,h),u.push(_);var C=n[g];for(c=0;c<e.length;c++)void 0!==C[c]&&""!==C[c]||(C[c]=null);for(f=C[0],_.setLeftVal(f),S=C.length,m=1;m<S;m++)E=C[m],this._plugSvcs.csValsEquivalent(f,E)?(_.setRightVal(m-1,f),_.setRightValHighlight(m-1,!1)):(_.setRightVal(m-1,E),_.setRightValHighlight(m-1,!0))}return u}.call(this,e);null!=i?this.reportOK(i):this.reportKO()}})}),define("DS/CompareWidget2/support/EventManager",["DS/CoreEvents/ModelEvents","DS/CompareWidget2/support/cw2Utils"],function(e,t){return e.extend({init:function(e){var t=e||{};this._parent(t)},publish:function(e){var n=e.isAsync,i=e.catchExceptions,r=this,o=r._parent;try{1==n?setTimeout(function(){o.call(r,e)},0):o.call(r,e)}catch(n){if(t.warnout("EXCEPTION publishing event '"+e.event+"' : "+n.stack),1!=i)throw n}}})}),define("DS/CompareWidget2/widget/inputFrame",["UWA/Controls/Abstract","DS/CompareCommon/CompareInput","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareWidget2/support/objIDSpec"],function(e,t,n,i){return e.extend({init:function(e,n){this._parent({}),this._privateEventMgr=e,this.elements.container=UWA.createElement("div",{id:"initial-drop",styles:{height:"100%"}}),this.compareInput=new t(n);var i=this;setTimeout(function(){i.compareInput.doInput(i.elements.container,n,i.onInputsReady.bind(i))})},onInputsReady:function(e){let t=[];for(let a of e.idDataList.items){var n=a.objectServices,r=null;void 0!==a.filterData&&null!==a.filterData?r=a.filterData:void 0!==a.queryDef&&null!==a.queryDef&&(r=a.queryDef);var o=new i(n.objectId,n.objectType,n.contextId,n.envId,n.serviceId,r,n.idType,n.commands);t.push(o)}this._privateEventMgr.publish({event:"Event_inputUpdate",data:t})},clearPersistedInputs:function(){this.compareInput.clearItem("all")}})}),define("DS/CompareWidget2/userSettings/PLMReference",["UWA/Core","DS/CompareWidget2/userSettings/SettingsBase","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n){"use strict";return e.extend(t,{namespace:"",compareSettings:{dataSource:{useIndex:{value:!0,V1Preference:"useIndex",widgetSetting:{type:"boolean",label:n.useIndex,defaultValue:!0}}},includeFacets:{externalRelations:{showDocs:{value:!1,V1Preference:"showDocs"},showOtherRels:{value:!1,V1Preference:"showOtherRels"}}}},viewSettings:{INSTANCE_VIEW:e.extend(e.clone(t.viewSettings.PROP_VIEW,!0),{attributes_display_option:{value:"",V1Preference:"compare_attributes_display_option_INST"},attributes_not_shown:{value:"",V1Preference:"compare_attributes_not_shown_INST"}})}},!0)}),define("DS/CompareWidget2/userSettings/VPMReference",["UWA/Core","DS/CompareWidget2/userSettings/PLMReference","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n){"use strict";return e.extend(t,{namespace:"",viewSettings:{PAD3D_VIEW:{view3D:{isolate:{value:!0,V1Preference:{viewer_display_mode:[{oldValue:"isolate",newValue:!0},{oldValue:"select",newValue:!1}]},widgetSetting:{type:"boolean",label:n.viewerIsolate,defaultValue:!1}}}}}},!0)}),define("DS/CompareWidget2/widget/mainFrame",["UWA/Controls/Abstract","DS/CompareWidget2/widget/inputFrame","DS/CompareWidget2/widget/resultFrame","DS/UIKIT/Mask","css!DS/CompareWidget2/CompareWidget2.css"],function(e,t,n,i){return e.extend({init:function(e,t,n){this._parent({}),this._privateEventMgr=e,this._publicEventMgr=t,this.elements.container=UWA.createElement("div",{id:"main-frame",styles:{height:"100%"}}),this.buildSkeleton(n)},buildSkeleton:function(e){this.inputFrame=new t(this._privateEventMgr,e),this.inputFrame.inject(this.elements.container),this.inputFrame.show(),this.buildResultFrame(e),this.resultFrame.hide(),this.token_inputUpdate=this._privateEventMgr.subscribe({event:"Event_resetToDropFrame"},this.Handler_resetToInputframe.bind(this))},Handler_resetToInputframe:function(){this.showInputFrame(!0)},buildResultFrame(e){this.resultFrame=new n(this._privateEventMgr,this._publicEventMgr,e),this.resultFrame.inject(this.elements.container)},ResetResultFrame:function(){this.resultFrame.destroy(),this.resultFrame=null,this.buildResultFrame()},getResultFrame:function(){return this.resultFrame},showInputFrame:function(e){this.resultFrame.hide(),e&&this.inputFrame.clearPersistedInputs(),this.inputFrame.show()},hideInputShowBusy:function(){this.inputFrame.hide(),i.mask(this.elements.container)},showResultFrame:function(){i.unmask(this.elements.container),this.inputFrame.hide(),this.resultFrame.show()}})}),define("DS/CompareWidget2/framework/useCase",["DS/CompareWidget2/support/cw2Utils"],function(e){var t=function(e,t,n){this.app=e,this.role=t,this.svcTypeArray=[];var i=this;n.forEach(function(e){i.svcTypeArray.push(e.getSvcType())})};return t.prototype.getApp=function(){return this.app},t.prototype.getRole=function(){return this.role},t.prototype.getSvcTypeArray=function(){return this.svcTypeArray},t.prototype.equals=function(t){return e.stringify(this)==e.stringify(t)},t}),define("DS/CompareWidget2/widget/viewPanelMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/widget/mainFrame"],function(e,t){return function(n,i,r,o){this._panelSpecSet={},this._expectedViewCount=-1,this._mainFrame=new t(i,r,o),this._mainFrame.inject(n),this.addPanel=function(e,t,n){var i=[];"function"==typeof t.getWidgetButtons&&(i=t.getWidgetButtons());var r={name:e,panel:t,plugin:n,buttonSpecArray:i},o=this._mainFrame.getResultFrame();this._panelSpecSet[e]=r,-1==this._expectedViewCount?o.addPanel(r,!0):Object.keys(this._panelSpecSet).length==this._expectedViewCount&&o.setAllPanels(this._viewDefModPath,this._viewSetName,this._defaultViewConfig,this._panelSpecSet,this._mainToolbarConfigPath,this._mainToolbarOptions)},this.setDefaultViewConfig=function(e,t,n,i,r){this._viewSetName=t,this._viewDefModPath=e,this._defaultViewConfig=n.VIEWSET,this._mainToolbarConfigPath=i,this._mainToolbarOptions=r,null!=n&&(this._expectedViewCount=this.countViews(this._defaultViewConfig,n.VIEWDEFS))},this.countViews=function(t,n){return e.getViewDefs(t).reduce((e,t)=>(null!=n[t]&&e++,e),0)},this.showResultFrame=function(){this._mainFrame.showResultFrame()},this.releaseViewPanels=function(){this._mainFrame.ResetResultFrame(),this._panelSpecSet={},this._expectedViewCount=-1},this.showInputFrame=function(){this._mainframe.showInputFrame()},this.hideInputShowBusy=function(){this._mainFrame.hideInputShowBusy()},this.requestFrame=function(e){return UWA.createElement("div",{id:e,styles:{position:"relative",display:"flex","flex-direction":"column",height:"100%"}})}}}),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions",["UWA/Core","DS/CompareWidget2/ViewDefModules/DSColors"],function(e,t){"use strict";var n={PHYSICALID:"REF.physicalid",VERSIONID:"REF.versionid",NAME:"REF.name"};return{CV_PROPS:n,STRUCT_FETCH_OPTIONS:{CV_PROPS:n,CVURL_BY_TYPE:[{name:"DEFAULT",url:"/cvservlet/expand"}],DATA_SOURCE:"CV_SERVICE",DB_FALLBACK:!1,USE_MCS:!1},STRUCT_COMPARE_OPTIONS:{PROPS:n,COMPUTE_DIFFERENT:!0,FORCE_ROOTS_TOGETHER:!0,SYSTEM_RELATIONSHIP_NAMES:["LEFT_ONLY","RIGHT_ONLY","QUANTITY","DIFFERENT","UNRELATED"],CUSTOM_RELATIONSHIP_NAMES:["IDENTICAL","REVISION"],CUSTOM_COMPARISONS:{COMP_PHYSID:[["PHYSICALID","PHYSICALID"],["EQ","NEQ"]],COMP_VERID:[["VERSIONID","VERSIONID"],["EQ","NEQ"]],COMP_NAME:[["NAME","NAME"],["EQ","EQ"]]},CUSTOM_MATCH_ADJUSTMENTS:[]},STRUCT_DISPLAY_OPTIONS:{SYSTEM_RULE_ID_FLAGS:{LEFT_ONLY:{COLOR:t.colorDef.ORANGE,NLS:"LO"},RIGHT_ONLY:{COLOR:t.colorDef.BLUE1,NLS:"RO"},UNRELATED:{COLOR:t.colorDef.BLACK,NLS:"UNRELATED"},DIFFERENT:{COLOR:t.colorDef.BEIGE,NLS:"DIFFERENT"},QUANTITY:{COLOR:t.colorDef.BLUE2,NLS:"QUANTITY"}},CUSTOM_RULE_ID_FLAGS:{IDENTICAL:{COLOR:t.colorDef.NONE,NLS:"SM"},REVISION:{COLOR:t.colorDef.VIOLET,NLS:"REV"},REPLACED:{COLOR:t.colorDef.PINK,NLS:"REPLACED"}},CONTEXT_MENU_PLUGIN:"DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/structDefaultContextMenu"}}}),define("DS/CompareWidget2/ViewDefModules/DocumentViewDefs_V2",["DS/CompareWidget2/ViewDefModules/DocumentViewDefOptions"],function(e){"use strict";var t={AttrFetch:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin"},AttrCompare:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_COMPARE_plugin"},AttrDisplay:{Path:"DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_DISPLAY_plugin"},StructFetch:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_FETCH_plugin",Options:e.STRUCT_FETCH_OPTIONS},StructCompare:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",Options:e.STRUCT_COMPARE_OPTIONS},StructDisplay:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_DISPLAY_plugin",Options:e.STRUCT_DISPLAY_OPTIONS},StructListViewPrep:{Path:"DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN"},Exporter:{Path:"DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",Options:e.STRUCT_DISPLAY_OPTIONS}};return UWA.merge({VIEWSETS:{STANDARD:{COL:["STRUCT_VIEW","PROP_VIEW"]},PROPS_ONLY:{ROW:"PROP_VIEW"},STRUCT_ONLY:{ROW:"STRUCT_VIEW"}},VIEWDEFS:{PROP_VIEW:["AttrFetch","AttrCompare","AttrDisplay"],STRUCT_VIEW:["StructFetch","StructCompare","StructListViewPrep","StructDisplay","Exporter"]},PLUGDEFS:t},e)}),define("DS/CompareWidget2/framework/pluginMgr",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/cw2CacheMgr"],function(e,t,n){function i(t,n,i,r){return new Promise(function(o,a){e.dbgout("  ... loading plugin: "+t);try{require([t],function(a){var s=new a(t,n,i,r);s.onLoad(),e.dbgout("  ... loading plugin OK: "+t),o(s)},function(n){e.warnout("Failed to load plugin "+t+":: "+n.message),a(n.message)})}catch(n){e.warnout("Exception trying to load plugin "+t)}})}return{getPlugins:function(t,r){return new Promise(function(o,a){e.dbgout("------------[ L O A D   P L U G I N S     B E G I N ] -----------");var s={},l=[];Object.keys(t).forEach(function(i){var r=t[i].Path,o=t[i].Options,a=n.getCacheObj("pluginCache",i);null==a?l.push({plugName:i,plugPath:r,pluginOptions:o}):(e.dbgout("Plugin "+r+" found in cache; load not required"),s[i]=a)});var c=l.length;if(e.dbgout("Must load "+c+" plugins..."),0==c)o(s);else{var u=[];for(let e=0;e<c;e++){var d=l[e].plugPath,p=l[e].plugName,h=l[e].pluginOptions;u.push(i(d,p,h,r))}Promise.allSettled(u).then(function(t){let i=0;for(let e=0;e<t.length;e++)if("rejected"!==t[e].status&&null!=t[e].value){var r=t[e].value,c=(r.getPath(),r._name);s[c]=r,n.putCacheObj("pluginCache",c,r),i++}else a("Failed to find plugin '"+l[e]);i===l.length&&(e.dbgout("------------[ L O A D   P L U G I N S     E N D    ] -----------"),o(s))})}})}}}),define("DS/CompareWidget2/plugins/DATA/attrValObjSet",["DS/CompareWidget2/plugins/DATA/attrValObj"],function(e){var t=function(e,t,n,i){this.physicalID=e,this.objType=t,this.iconURLLarge=n,this.iconURL=i,this.dbContext={},this.attrVals=[],this.byName={},this._reqMod="DS/CompareWidget2/plugins/DATA/attrValObjSet"};return t.prototype.add=function(t,n,i,r,o){var a=new e(t,n,i,r,o);this.attrVals.push(a),this.byName[t]=a},t.prototype.setDBContext=function(e,t,n){this.dbContext={securityContext:e,serviceName:t,tenant:n}},t.prototype.getDBContext=function(){return this.dbContext},t.prototype.getPhysicalID=function(){return this.physicalID},t.prototype.getObjType=function(){return this.objType},t.prototype.getIconURLLarge=function(){return this.iconURLLarge},t.prototype.getIconURL=function(){return this.iconURL},t.prototype.getAttrCount=function(){return this.attrVals.length},t.prototype.getAttr=function(e){return this.attrVals[e]},t.prototype.getAttrByName=function(e){return this.byName[e]},t}),define("DS/CompareWidget2/framework/CPF",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/useCase","DS/CompareWidget2/framework/viewSetMgr","DS/CompareWidget2/framework/svcNodeNet","DS/CompareWidget2/framework/pluginMgr","DS/CompareWidget2/userSettings/UserSettingsManager","DS/CompareWidget2/support/DataCenter","DS/CompareWidget2/support/objIDSpec"],function(e,t,n,i,r,o,a,s){var l=function(e,t,i,r){this._viewPanelMgr=e,this._viewSetMgr=new n,this._plugSvcs=i,this._privateEventMgr=t,this._svcNodeNet=null,this._lastUseCase=[],this._lastViewDefModPath=null,this._lastViewSetName=null,null!=r&&1==r.isODT&&(this,this.forODT=c)};l.prototype.fetchFilteredType=function(t){return new Promise(function(n,i){a.fetchFilterDefinition(t).then(function(r){var o={physicalid:[r.CVQuery.union.expand[0].root_path_physicalid[0][0]],label:"CompareFindFilteredObject-"+e.nowMS(),select_predicate:["ds6w:label","physicalid","ds6w:type"]};a.makeAuthHttpsCall("/cvservlet/fetch/v2","POST",o,"json",t.getTenant(),t.getServiceName(),t.getSecurityContext()).then(function(e){null!=e.error&&i(e.error);for(var t=null,r=e.results[0].attributes,o=0;o<r.length;o++){var a=r[o];if("ds6w:type"==a.name){t=a.value;break}}n(t)},function(t){e.errout("failed call in 'fetchFilterType()"),i(t)})},function(t){e.errout("failed call in 'fetchFilterType()"),i(t)})})},l.prototype._createUseCase=function(e,n,i){var r=this;return new Promise(function(o,a){var l=[],c=[];i.forEach(function(e,t){"ENOStrRefinementSpecification"!=e.getObjType()?l[t]=e:c.push(t)});var u=c.length;if(0==u){var d=new t(e,n,l);o(d)}else c.forEach(function(c){let d=c,p=i[c];r.fetchFilteredType(p).then(function(i){let r=i;if(l[d]=new s(p.getPhysID(),r,p.getSecurityContext(),p.getTenant(),p.getServiceName(),p.getFilterSpec(),p.getIDType(),p.getCommands()),0==--u){var a=new t(e,n,l);o(a)}},function(e){a(e)})})})},l.prototype.compareObjs=function(t,n){var i=this;return i._printStartMsg(n),i._viewPanelMgr.hideInputShowBusy(),new Promise(function(r,o){!function(t){for(var n=t.length,i=!1,r=!1,o=0;o<n;o++)null!=(c=(d=t[o]).getSecurityContext())&&""!=c||(i=!0),null!=(u=d.getTenant())&&""!=u||(r=!0);if(i||r){var a=null,s=null;for(o=0;o<n;o++){var l=t[o];if(i&&null!=(c=l.getSecurityContext())&&""!=c&&(i=!1,a=c),r&&null!=(u=l.getTenant())&&""!=u&&(r=!1,s=u),0==i&&0==r)break}for(o=0;o<n;o++){var c,u;null!=(c=(d=t[o]).getSecurityContext())&&""!=c||(null==a?e.errout("Missing security context in request (can not repair)..."):(e.warnout("Missing security context in request (repairing)..."),d._securityContext=a)),null!=(u=d.getTenant())&&""!=u||(null==a?e.errout("Missing tenant in request (can not repair)..."):(e.warnout("Missing tenant in request (repairing)..."),d._tenant=s))}}for(o=0;o<n;o++){var d,p=(d=t[o]).getServiceName();"3dspace"==p.toLowerCase()&&"3DSpace"!=p&&(e.warnout("Correcting malformed service name '"+p+"' to '3DSpace'"),d._serviceName="3DSpace")}}(n),i._createUseCase(t,"*",n).then(function(t){var a=t;i._compareObjsWithUseCase(n,a).then(function(e){r(e)},function(t){e.errout("Failure ccomparing with use case: "+t),o(t)})},function(t){e.errout("Failure creating use case: "+t),o(t)})})},l.prototype.compareObjsWithViewSetName=function(t,n,i,r){var o=this;return new Promise(function(t,a){o._printStartMsg(n),o._viewSetMgr.loadViewConfig(i,r).then(function(i){var r=i;o._compareObjsWithViewConfig(n,r).then(function(n){e.dbgout("INIT","compare with viewSetName is OK!"),t(n)},function(t){e.errout("INIT","compare with viewSetName FAILURE!!!"),a(t)})},function(t){e.errout("Failure to load view config: "+t),a(t)})})},l.prototype._sendUpdatedInputToSvcNodeNet=function(t){this._viewPanelMgr.showResultFrame();var n=e.nowMS();return this._svcNodeNet.updateInput(t),e.reportTime(n," ##### update input"),!0},l.prototype._compareObjsWithUseCase=function(t,n){var i=this;return e.dbgout("INIT","<><><><><><><><><><><><><><><><><><>"),e.dbgout("INIT","<><> USE CASE     APP: "+n.getApp()),e.dbgout("INIT","<><> USE CASE    ROLE: "+n.getRole()),n.getSvcTypeArray().forEach(function(t){e.dbgout("INIT","<><> USE CASE svcType: "+t)}),e.dbgout("INIT","<><><><><><><><><><><><><><><><><><>"),new Promise(function(r,o){if(n.equals(i._lastUseCase))e.dbgout("INIT","<><> useCase same as previous; reusing svcNodeNetwork..."),i._sendUpdatedInputToSvcNodeNet(t),r();else{e.dbgout("INIT","<><> This is a NEW useCase... need to determine correct viewSet"),i._lastUseCase=n;var a=e.nowMS();i._viewSetMgr.getViewConfig(n).then(function(n){e.reportTime(a,"get viewConfig for use case");var s=n;i._compareObjsWithViewConfig(t,s).then(function(t){e.dbgout("INIT","compare with useCase is OK!"),r(t)},function(t){e.errout("compare with useCase FAILURE!!!"),o(t)})},function(t){e.errout("FAILED getting viewConfig for use case"),o(t)})}})},l.prototype._buildSvcNodeNet=function(e){var t=new i(this._plugSvcs,this._privateEventMgr);return t.build(e),t},l.prototype._compareObjsWithViewConfig=function(t,n){var i=this;return new Promise(function(o,a){var s=n.viewDefModPath,l=n.viewSetName,c=n.mainToolbarConfigPath,u=n.mainToolbarOptions;n.userSettingsConfig;if(e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),e.dbgout("INIT","<><> USING viewDefMod: "+s),e.dbgout("INIT","<><> USING    viewSet: "+l),e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><>"),i._lastViewDefModPath==s&&i._lastViewSetName==l)e.dbgout("INIT","<><> --\x3e viewSet still the same... reusing existing viewConfig"),e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),i._sendUpdatedInputToSvcNodeNet(t),o();else{i._lastViewDefModPath=s,i._lastViewSetName=l;var d=e.nowMS();r.getPlugins(n.PLUGDEFS,i._plugSvcs).then(function(r){e.reportTime(d,"--\x3e load all plugins"),n.PLUGSLOADED=r,e.dbgout("INIT","<><> --\x3e viewSet is new... building new svcNodeNet..."),e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=i._svcNodeNet&&(i._svcNodeNet.destroy(),i._viewPanelMgr.releaseViewPanels(),i._svcNodeNet=null),i._svcNodeNet=i._buildSvcNodeNet(n),i._viewPanelMgr.setDefaultViewConfig(s,l,n,c,u),i._svcNodeNet.buildViewPanels(),i._svcNodeNet.enableAll(),i._sendUpdatedInputToSvcNodeNet(t),o()},function(t){e.errout("Error loading plugins:: "+e.stringify(t)),a(t)})}})},l.prototype.refreshSvcNodeNet=function(){this._svcNodeNet.refresh()},l.prototype._printStartMsg=function(t){if(e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),e.dbgout("INIT","<><><><><><><><><><>   BEGIN NEW COMPARE  <><><><><><><><><><><><><><><><><>"),e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>"),null!=t[0].objAMDName)for(var n=0;n<t.length;n++)e.dbgout("INIT","<><> ID ["+n+"]: AMD Module Name : "+t[n].objAMDName);else for(n=0;n<t.length;n++)e.dbgout("INIT","<><> ID ["+n+"]: SERVICE : "+t[n].getServiceName()),e.dbgout("INIT","<><> ID ["+n+"]:      ID : "+t[n].getPhysID()),e.dbgout("INIT","<><> ID ["+n+"]: OBJTYPE : "+t[n].getObjType()),e.dbgout("INIT","<><> ID ["+n+"]:   TENANT: "+t[n].getTenant()),e.dbgout("INIT","<><> ID ["+n+"]: SEC CTXT: "+t[n].getSecurityContext()),e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>");e.dbgout("INIT","<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>")};var c={};return l}),define("DS/CompareWidget2/plugins/DATA/attrCache",["DS/CompareWidget2/plugins/DATA/attrValObjSet","DS/CompareWidget2/support/tenantServiceContext_IDList","DS/CompareCommon/Utils","DS/CompareCommon/CompareMetaData","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,n,i,r){function o(e){for(var t={data:[],tn:e.dbContext.tenant,sc:e.dbContext.securityContext,sn:e.dbContext.serviceName,i1:e.iconURL,i2:e.iconURLLarge,id:e.physicalID,ty:e.objType},n=e.attrVals.length,i=0;i<n;i++){var r=e.attrVals[i],o=[r.name,r.nls,JSON.stringify(r.value),r.type,r.UIPosition];t.data.push(o)}return t}var a=function(e,t){this._cacheType=e?"(INST)":"(REF)",this._isInstance=e,this._plugSvcs=t,this._dbgout=t.dbgout,this._theCache={},this._PRELOAD_ENABLED=!1,this._preloadInProgress=!1,this._cacheIsLoaded=!1};return a.prototype.enablePreload=function(){this._PRELOAD_ENABLED=!0},a.prototype.isFullyLoaded=function(){return this._cacheIsLoaded},a.prototype.flushCache=function(){var e=JSON.stringify(this._theCache).length;e>2&&(this._plugSvcs.dbgout("ATTR_CACHE",this._cacheType+" Property value cache (current size: "+e+" characters) is being flushed ..."),this._theCache={},this._preloadInProgress=!1,this._cacheIsLoaded=!1)},a.prototype.getAttrData=function(e){var n=this,i=[];return new Promise(function(r,o){var a=new t;e.forEach(function(e){a.addObjIDSpec(e)}),n._updateCache(a,!0).then(function(t){0==t?r(null):(e.forEach(function(e){var t=e.getTenant(),r=e.getServiceName(),o=e.getSecurityContext(),a=e.getPhysID(),s=n._getFromCache(t,r,o,a);(void 0===s.objType||null===s.objType&&""===s.objType)&&(s.objType=e.getObjType()),i.push(s)}),r(i))},function(e){var t=n._cacheType+" fetch data failed:: "+e;o(t)})})},a.prototype._getFromCache=function(t,n,i,r){var o=null;if(null!=t&&null!=n&&null!=i&&null!=r&&""!==r){var a=this._theCache[t][n][i][r];null!=a?o=function(t){var n=t.tn,i=t.sc,r=t.sn,o=t.i1,a=t.i2,s=t.id,l=t.ty,c=new e(s,l,a,o);return c.setDBContext(i,r,n),t.data.forEach(function(e){var t=e[0],n=e[1],i=null==e[2]?null:JSON.parse(e[2]),r=e[3],o=e[4];c.add(t,n,i,r,o)}),c}(a):this._dbgout("ATTR_CACHE","_getFromCache() "+r+" not in cache!")}return o},a.prototype.doPreload=function(e){var t=this;try{0==t._PRELOAD_ENABLED?t._dbgout("CACHE",t._cacheType+" doPreload() disabled...  ignoring request"):t._preloadInProgress?t._dbgout("ATTR_CACHE",t._cacheType+" doPreload() is already in progress... ignoring request"):(t._preloadInProgress=!0,t._dbgout("ATTR_CACHE",t._cacheType+" PRELOADING 'diff'"),t._updateCache(e.diff,!1).then(function(n){0==n||0==t._preloadInProgress?(t._dbgout("ATTR_CACHE",t._cacheType+" load aborted / data is no longer relevant."),t._preloadInProgress=!1):(t._dbgout("ATTR_CACHE",t._cacheType+" PRELOADING 'nodiff'"),t._updateCache(e.nodiff,!1).then(function(e){0==e||0==t._preloadInProgress?t._dbgout("ATTR_CACHE",t._cacheType+" load aborted / data is no longer relevant."):(t._dbgout("ATTR_CACHE",t._cacheType+" *CACHE FULLY LOADED* for current model"),t._cacheIsLoaded=!0,t._preloadInProgress=!1,t.onFullyLoadedCache())},function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheType+" LOAD 'nodiffs' FAILED: "+e)}))},function(e){t._preloadInProgress=!1,t._dbgout("ATTR_CACHE",t._cacheType+" LOAD 'diffs' FAILED: "+e)}))}catch(e){t._preloadInProgress=!1,t.me._plugSvcs.errout("FAILURE while loading cache... aborted:: "+e)}},a.prototype.onFullyLoadedCache=function(){var e=this;if(0!=e._cacheIsLoaded){var t={type:e._isInstance?"INSTANCE":"REFERENCE",props:e};e._plugSvcs.postEvent("PROPERTIES_CACHE_LOADED_EVENT",t)}else e.me._plugSvcs.errout("OnFullyLoadedCache called when cache is not fully loaded... aborting")},a.prototype._updateCache=function(e,t){var n=this,i=0,r=0,o=0;return new Promise(function(a,s){n._dbgout("ATTR_CACHE",n._cacheType+" Looking for objects in ATTR_FETCH cache...");var l=[];Object.keys(e._data).forEach(function(a){null==n._theCache[a]&&(n._theCache[a]={}),Object.keys(e._data[a]).forEach(function(s){null==n._theCache[a][s]&&(n._theCache[a][s]={}),Object.keys(e._data[a][s]).forEach(function(c){null==n._theCache[a][s][c]&&(n._theCache[a][s][c]={});var u=Object.keys(e._data[a][s][c]),d=[];if(u.forEach(function(e){if(void 0===n._theCache[a][s][c][e]||null===n._theCache[a][s][c][e]&&1==t){if(r++,d.push(e),n._theCache[a][s][c][e]=null,d.length>=10){var u={reqTenant:a,reqServiceName:s,reqSecurityContext:c,reqIDArray:d};l.push(u),d=[]}}else 0==t&&null==n._theCache[a][s][c][e]?o++:i++}),d.length>0){var p={reqTenant:a,reqServiceName:s,reqSecurityContext:c,reqIDArray:d};l.push(p)}})})});var c=r>0?", must fetch...":"";n._dbgout("ATTR_CACHE",n._cacheType+" HIT: "+i+", MISS: "+r+c),0==l.length?a(0==o):(n._dbgout("ATTR_CACHE",n._cacheType+" *FETCHING PROPS* for "+r+" objects using "+l.length+" request set(s)"),n._doBigFetch(l).then(function(e){a(e)},function(e){s(e)}))})},a.prototype._doBigFetch=function(t){var n=this;return new Promise(function(i,a){var s=0,l=t.length,c=l;function u(d){var p=d;--c>0?n._dbgout("ATTR_CACHE",n._cacheType+" ...processing returned data; still have "+c+" requests to go..."):n._dbgout("ATTR_CACHE",n._cacheType+" processing returned data...");for(var h=function(t){for(var n=[],i=t.length,o=0;o<i;o++)for(var a=t[o],s=a.result.results.length,l=0;l<s;l++){var c=a.result.results[l],u=new e(c.physicalID,c.type,c.type_icon_large_url,c.type_icon_url);if(u.setDBContext(a.securityContext,a.serviceName,a.tenant),u.add("thumbnailimage",r.thumbnailimage,c.thumbnail,"thumbnail",0),void 0!==c.basicData&&null!==c.basicData&&c.basicData.length>0)for(let e of c.basicData){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;u.add(e.name,t,e.value,e.type,e.UIPosition)}if(void 0!==c.data&&null!==c.data&&c.data.length>0)for(let e of c.data){const t=null!==e.nls&&void 0!==e.nls&&""!==e.nls?e.nls:e.displayName;u.add(e.name,t,e.value,e.type,e.UIPosition)}n.push(u)}return n}([p]),g=h.length,_=0;_<g;_++){var f=h[_],S=f.getPhysicalID(),m=f.dbContext.tenant,E=f.dbContext.serviceName,C=f.dbContext.securityContext,v=o(f);n._theCache[m][E][C][S]=v}if(s<l){var T=t[s++];n._dbgout("ATTR_CACHE",n._cacheType+" sending request #"+s+" of "+l+"("+T.reqIDArray.length+" objects)"),n._fetchReqSet(T).then(function(e){null==e?n._dbgout("ATTR_CACHE","Data discarded"):u(e)},function(e){a(e)})}else c<=0&&i(!0)}for(s=0;s<2&&s<l;s++){var d=t[s];n._dbgout("ATTR_CACHE",n._cacheType+" sending request #"+(s+1)+" of "+l+" ("+d.reqIDArray.length+" objects)"),n._fetchReqSet(d).then(function(e){u(e)},function(e){a(e)})}})},a.prototype._fetchReqSet=function(e){var t=this;return new Promise(function(n,i){setTimeout(()=>{var r=t._plugSvcs.nowMS(),o=t._theCache;t._getAttrs(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext,t._isInstance).then(function(a){if(o!==t._theCache)t._dbgout("ATTR_CACHE",t._cacheType+" Cache was flushed; incoming data ignored"),n(null);else{var s=a;if(Array.isArray(s.result.results)&&s.result.results.every(e=>!1!==e.success)){var l=e.reqIDArray.length,c="[ATTR_CACHE]"+t._cacheType+" FETCHED PROPS for "+l+" OBJECTS";if(t._plugSvcs.reportTime(r,c),"3dspace"===s.serviceName.toLowerCase())if(t._isInstance)s.result.results.forEach(e=>e.thumbnail=e.preview_url.length?e.preview_url:e.type_icon_large_url),n(s);else{var u=t._plugSvcs.nowMS();t._getThumbnails(e.reqIDArray,e.reqServiceName,e.reqTenant,e.reqSecurityContext,s.result.results).then(function(i){t._plugSvcs.reportTime(u,"[CACHE]"+t._cacheType+" "+e.reqIDArray.length+" thumbnails loaded");var r=i;t._mergeInThumbInfo(s,r),n(s)},function(e){if(!t._isInstance){var i="attr fetch was OK (but missing thumbnails) :: "+e;t._plugSvcs.errout(i)}n(s)})}else{for(let e of s.result.results)if(e.hasOwnProperty("preview_url")&&""!==e.preview_url)e.thumbnail=e.preview_url;else{var d=e.data.findIndex(function(e){return"preview_url"===e.name});if(d>=0){let t=e.data.splice(d,1);e.thumbnail=t[0].value}}n(s)}}else i("Failure getting Attributes: ")}},function(e){var n="Failure getting Attributes: "+e;t._plugSvcs.errout(n),i(n)})},1)})},a.prototype._getAttrs=function(e,t,r,o,a){var s=this;if("3dportfolio"===t.toLowerCase()||"3dspace"===t.toLowerCase()){let n="",l="",c="";return"3dportfolio"===t.toLowerCase()?(n="/"+t+"/"+i.typeInfo[t].attributes.url,l="GET",c="objectIds="+e.join(",")):"3dspace"===t.toLowerCase()&&(n="/resources/v1/collabServices/attributes/op/read/",l="POST",c=!0===a?{debug_properties:"",plmparameters:"true",relIDs:e,lIds:[]}:{debug_properties:"",readonly:"false",navigateToMain:"true",attributes:"true",plmparameters:"true",busIDs:e,relIDs:[],lIds:[]}),new Promise(function(e,i){s._plugSvcs.makeAuthHttpsCall(n,l,c,"json",r,t,o).then(function(n){e({serviceName:t,tenant:r,securityContext:o,result:n})},function(e){s._plugSvcs.errout("Failure retrieving attributes for object"),i(null)})})}return new Promise(function(i,a){n.getFederatedAttributesPromise({objectIds:e,serviceIds:[t],tenant:r,securityContext:o}).then(function(e){i({serviceName:t,tenant:r,securityContext:o,result:e})})})},a.prototype._getThumbnails=function(e,t,n,i,r){var o=this,a=[],s=e.length,l=0;return new Promise(function(c,u){e.forEach(function(e){let d=r.find(t=>t.physicalID===e),p=void 0!==d?d.preview_url:"";if(null!=p&&""!==p)a[e]=p,++l>=s&&c(a);else{var h="/resources/compare/thumbnailUrl/"+e;o._plugSvcs.makeAuthHttpsCall(h,"GET",null,"text",n,t,i).then(function(i){var r=i;0==r.startsWith("http")&&(r=o._plugSvcs.makeServiceURL(t,n,r,null)),a[e]=r,++l>=s&&c(a)},function(e){u(e)})}})})},a.prototype._mergeInThumbInfo=function(e,t){e.result.results.forEach(function(e){var n=e.physicalID,i=t[n];e.thumbnail=i})},a}),define("DS/CompareWidget2/plugins/ATTRIBUTE/ATTR_FETCH_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/DATA/attrCache"],function(e,t){return e.extend({init:function(e,n,i,r){this._parent(e,n,i,r),this.enableDebugLabel("ATTR_CACHE"),this._isInstance=this._pluginOptions.isInstance,this._DEBUG_isInstTxt=this._isInstance?"(INST)":"REF)",this._attrCache=new t(this._isInstance,r),this._comparisonInProgress=!1},onEnabled:function(){var e=this;if(0==e._isEnabled){e.subscribeEvent("NEW_CURRENT_SELECTION_EVENT",function(e){var t=this,n=e.data.selectedData;t._plugSvcs.dbgout("A new row has been selected..."),t._attrUpdateStartMS=t._plugSvcs.nowMS();var i=[];if(e.data.selectedData){var r=n[0].length>n[1].length?n[0]:n[1];if(0===r.length)return;if(t._isInstance){if("LIST"==e.data.structDisplayMode)return void t.postEvent("INST_PROPS_OFF_DURING_LIST_COMPARE",{id:"attrFetch"});if(1!=r.length)return void t.postEvent("INST_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}else{var o=!0;if("LIST"!=e.data.structDisplayMode)1!=r.length&&(o=!1);else{var a=r[0].ObjIDSpec.getPhysID();r.forEach(function(e){e.ObjIDSpec.getPhysID()!=a&&(o=!1)})}if(!o)return void t.postEvent("REF_PROPS_OFF_TOO_MANY_SELECTED",{id:"attrFetch"})}n.forEach(function(e){if(null!=e&&e.length>0){var n=e[0],r=t._isInstance?n.instObjIDSpec:n.ObjIDSpec;null!=r&&i.push(r)}});let s=0;for(let e of i){let t=e.getPhysID();null!=t&&""!==t&&++s}if(0==s)t._isInstance?t.postEvent("INST_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):t.postEvent("REF_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"});else{if("relations"===i[0].getObjType())return void t.postEvent("GROUP_PLACEHOLDER_SELECTED",{id:"attrFetch"});t._plugSvcs.postEvent(t._isInstance?"INST_PROPS_UPDATE_IN_PROGRESS_EVENT":"REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),t._attrCache.getAttrData(i).then(function(e){null!=e&&t.updateOutput(e)},function(e){var n="getAttrData() failed:: "+e;t._plugSvcs.dbgout("ATTR_CACHE",t._DEBUG_isInstTxt+n)})}}}.bind(this));var t=this._isInstance?"PRELOAD_PROP_INST_HINT_EVENT":"PRELOAD_PROP_REF_HINT_EVENT";e.subscribeEvent(t,function(e){this._hintList=e.data,this._doPreloadIfReady()}.bind(this)),e.subscribeEvent("COMPARE_EXPORT_REQUESTED",function(e){this._comparisonInProgress=!1,this.dbgout("ATTR_CACHE","All displays updated..."),this._doPreloadIfReady()}.bind(e)),e.subscribeEvent("EVENT_FLUSH_DATA_CACHES",function(e){this._attrCache.flushCache()}.bind(e)),e.subscribeEvent("LOAD_ALL_PROPS_REQ",function(e){this._attrCache.isFullyLoaded()?this._attrCache.onFullyLoadedCache():(this._attrCache.enablePreload(),this._doPreloadIfReady())}.bind(e))}return e._parent()},onDisable:function(){this._parent()},_doPreloadIfReady:function(){var e=this;null!=e._hintList?1!=e._comparisonInProgress?e._attrCache.doPreload(e._hintList):e._plugSvcs.dbgout("ATTR_CACHE",e._DEBUG_isInstTxt+" doPreload() waiting on comparison to finish"):e._plugSvcs.dbgout("ATTR_CACHE",e._DEBUG_isInstTxt+" doPreload() waiting on hintList")},execute:function(e,t){var n=this;n._parent(e,t),this._comparisonInProgress=!0;let i=e;n._isInstance?n.postEvent("INST_PROPS_OFF_NONE_AVAILABLE",{id:"attrFetch"}):(n._plugSvcs.postEvent("REF_PROPS_UPDATE_IN_PROGRESS_EVENT",null),n._plugSvcs.dbgout("Performing initial ATTR_FETCH"),n._attrCache.getAttrData(i).then(function(e){null!=e&&n.reportOK(e)},function(e){n._plugSvcs.showAlertBox("Failed to retrieve properties",null,"error"),n._isInstance?n._plugSvcs.postEvent("INST_PROPS_FETCH_FAILED"):n._plugSvcs.postEvent("REF_PROPS_FETCH_FAILED"),n.reportKO(e)}))}})}),define("DS/CompareWidget2/cw2",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/framework/CPF","DS/CompareWidget2/framework/pluginServices","DS/CompareWidget2/widget/viewPanelMgr","DS/CompareWidget2/support/EventManager","DS/CompareWidget2/support/objIDSpec"],function(e,t,n,i,r,o){var a={getAck:function(){return"Ack"}};var s=function(s,l){l=l||{};this._runOptions={app:"COMPARE",viewDefType:"LOOKUP",viewSetName:"STRUCT_ONLY",viewSetMod:"DS/CompareWidget2/ViewDefModules/DefaultViewDefs_V2",isODT:!1},Object.assign(this._runOptions,l,this._runOptions);var c=widget.getValue("X3DContentId");if(null!=c){var u=JSON.parse(c).runOptions||{};Object.assign(this._runOptions,u,this._runOptions)}1==this._runOptions.isODT&&(this,this.forODT=a),this._privateEventMgr=new r,this._publicEventMgr=new r({parent:this._privateEventMgr}),this._viewPanelMgr=new i(s,this._privateEventMgr,this._publicEventMgr,this._runOptions);var d=new n(this._viewPanelMgr,this._publicEventMgr);if(this._CPF=new t(this._viewPanelMgr,this._privateEventMgr,d,this._runOptions),this.token_inputUpdate=this._privateEventMgr.subscribe({event:"Event_inputUpdate"},this.handler_inputUpdate.bind(this)),this.token_refreshComparison=this._privateEventMgr.subscribe({event:"Event_refreshComparison"},this.handler_refreshComparison.bind(this)),this.token_clearComparison=this._privateEventMgr.subscribe({event:"Event_clearComparison"},this.handler_clearComparison.bind(this)),this.token_swapIDs=this._privateEventMgr.subscribe({event:"Event_swapIDs"},this.handler_swapIDs.bind(this)),this.token_compareExport=this._privateEventMgr.subscribe({event:"Event_compareExport"},this.handler_compareExport.bind(this)),this.token_dropRecompare=this._privateEventMgr.subscribe({event:"Event_replaceCompare"},this.handler_replaceCompare.bind(this)),this.rebroadcastDisplayUpdated=this.addRebroadcastEvent("EVENT_FLUSH_DATA_CACHES"),null!=this._runOptions.objAMDNameArray){var p=new o("FILE_0","UNKNOWN",null);p.objAMDName=this._runOptions.objAMDNameArray[0];var h=new o("FILE_1","UNKNOWN",null);h.objAMDName=this._runOptions.objAMDNameArray[1];var g=[p,h];this._CPF.compareObjsWithViewSetName(this._runOptions.app,g,this._runOptions.viewSetMod,this._runOptions.viewSetName).then(function(t){e.dbgout("CW2 reports build/drop IDs successful.")},function(t){e.errout("CW2 reports  build/drop IDs FAILED :"+t.stack)})}};return s.prototype.handleRebroadcastEvent=function(e){this._publicEventMgr.publish({event:e})},s.prototype.addRebroadcastEvent=function(e){return this._privateEventMgr.subscribe({event:e},this.handleRebroadcastEvent.bind(this,e))},s.prototype.getAppName=function(){return this._runOptions.app},s.prototype.handler_inputUpdate=function(e){if(null!=e&&e.length>0){if("AS_GIVEN"==this._runOptions.viewDefType){var t=this._runOptions.viewSetMod,n=this._runOptions.viewSetName;this._compareObjsWithViewSetName(e,t,n)}else this.compareObjs(e);this._currObjIDSpecArray=e}},s.prototype.handler_refreshComparison=function(){this.handler_inputUpdate(this._currObjIDSpecArray)},s.prototype.handler_clearComparison=function(){this._currObjIDSpecArray=null},s.prototype.handler_replaceCompare=function(t){if(null==this._currObjIDSpecArray||this._currObjIDSpecArray.constructor!=Array||this._currObjIDSpecArray.length<2)e.errout("dropCompare called  without prior comparison");else{var n=null==t?null:null==t.data?null:t.data.objIDSpecArray;if(null==n||n.constructor!=Array||n.length<1)e.errout("bad call to dropCompare");else{for(var i=this._currObjIDSpecArray.length,r=t.data.targetIndex,o=[],a=0;a<i;a++)a==r?n.forEach(function(e){o.push(e)}):o.push(this._currObjIDSpecArray[a]);this.handler_inputUpdate(o)}}},s.prototype.handler_swapIDs=function(){var e=this._currObjIDSpecArray.shift();this._currObjIDSpecArray.push(e),this.handler_inputUpdate(this._currObjIDSpecArray)},s.prototype.handler_compareExport=function(){var e={event:"EXECUTE_EXPORT_EVENT",data:null,propagate:!0,target:this,isAsync:!1,catchExceptions:!1};this._publicEventMgr.publish(e)},s.prototype.compareObjs=function(t){var n=this;var i=[];t.forEach(function(e){var t=e.makeDupe();i.push(t)}),this._CPF.compareObjs(this._runOptions.app,i).then(function(t){e.dbgout("CW2 reports build/drop IDs successful."),n._privateEventMgr.publish({event:"Event_disableSwap",data:i.length>2})},function(t){e.errout("CW2 reports  build/drop IDs FAILED :"+t.stack)})},s.prototype._compareObjsWithViewSetName=function(t,n,i){e.dbgout("Comparing with named viewSet '"+i+"' from viewDefModule '"+n+"'");this._CPF.compareObjsWithViewSetName(this._runOptions.app,t,n,i).then(function(t){e.dbgout("CW2 reports build/drop IDs successful.")},function(t){e.errout("CW2 reports  build/drop IDs FAILED :"+t.stack)})},s}),define("DS/CompareWidget2/CompareWidget2",["DS/LifecycleServices/LifecycleServicesSettings","DS/CompareCommon/Utils","DS/CompareWidget2/cw2","DS/CompareWidget2/userSettings/UserSettingsManager","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/WidgetPreferences","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n,i,r,o,a){"use strict";var s=null,l={onLoad:function(){e.app_initialization(function(){widget.body.innerHTML="";var t="cw2_unittest_client"===widget.id?{isODT:!0}:null,i="",o=(s=new n(widget.body,t)).getAppName();"COMPARE"!=o&&(i+=" ("+o+")"),widget.setTitle(i);var a={configPath:"DS/CompareWidget2/userSettings/VPMReference"};"MERGE"===o&&(a.configPath="DS/CompareWidget2/userSettings/Merge"),require(["DS/CompareWidget2/userSettings/UserSettingsManager"],e=>{e.loadSettingsFromConfigPromise(a).then(()=>{},()=>{})}),widget.isWebInWin;var l=e.getOption("platform_services",null);null!=l&&l.length>0&&Array.isArray(l)&&l.forEach(function(e){null!=e&&e.hasOwnProperty("platformId")&&r.getSecurityContextList(e.platformId,function(){r.getSecurityContextForCollaborativeSharingCommands})})}),"cw2_unittest_client"===widget.id&&Object.assign(l,{_getCW2ODTAck:function(){return s.forODT.getAck()},_getCPF:function(){return s._CPF}})},onResize:function(){},onViewChange:function(e){},onRefresh:function(e){null!=s&&s.handler_refreshComparison()},onEdit:function(){},endEdit:function(){widget.getPreferences().forEach(e=>{i.hasPref(e.name)&&i.get(e.name)!==widget.getValue(e.name)&&i.set(e.name,widget.getValue(e.name))})}};return l}),define("DS/CompareWidget2/plugins/STRUCTURE/GET_RELATIONS_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relations/Ecosystem","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"],function(e,t,n){"use strict";const i=50;function r(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t}function o(e){let t=e.getChildArray();var n=[],o=1;let a=e.getObjIDSpec_REF().getPhysID();for(a&&n.push(a);o<=i&&t.length>0;)t.forEach(function(e){let t=e.getObjIDSpec_REF().getPhysID();t&&n.push(t)}),o++,t=r(t);return n}function a(e,t,n){for(var o=1,a=t,c=t[0];o<=i&&a.length>0;)a.forEach(function(t){if(null!=t.getObjIDSpec_REF().getPhysID()){var i=t.getObjIDSpec_REF().getPhysID(),r=[];e.formated[i]&&(r=Object.keys(e.formated[i]));for(var o=0;o<r.length;o++){var a=e.formated[i][r[o]],c=n[r[o]].label,u=s(i,r[o],c);a.forEach(function(n){var i=e.idObjMap[n],a=l(r[o],i);u.addChild(a),a.setDBContext(t._dbContext)}),t.addChild(u)}}}),a=r(a),o++;return c}function s(e,t,i){var r=new n(i,i,"relations","",t,"","","","","");return r.setParent(e),r.addAttr("REF.ds6w:type","relations"),r.addAttr("REF.physicalid",t),r.addAttr("REF.logicalid",t),r.addAttr("REF.versionid",t),r.addAttr("REF.name",i),r.addAttr("REF.dfr",t),r.addAttr("REF.ds6wg:revision",""),r.addAttr("REF.thumbnail_3d",""),r._extRelNLS=!0,r}function l(e,t){var i=new n(t.name,t.name,t.type,"",t.id,t.revision,"",t.icon_url,t.icon_url,t.thumbnail);return i._path=t.id,i.setParent(e),i.addAttr("REF.ds6w:type",t.type),i.addAttr("REF.physicalid",t.id),i.addAttr("REF.logicalid",t.id),i.addAttr("REF.versionid",t.revision),i.addAttr("REF.name",t.name),i.addAttr("REF.dfr",t.id),i.addAttr("REF.ds6wg:revision",t.revision),i.addAttr("REF.thumbnail_3d",t.thumbnail),i}return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i),this.relationLabels=n.RELATION_LABELS},onEnabled:function(){this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels")},execute:function(e,n){var i=this;i._parent(e,n);var r=[];!0!==this.showDocs&&"true"!==this.showDocs&&!0!==n._ODTshowDocs||(r=n.DOCS_RELS);var s=[];!0!==this.showOtherRels&&"true"!==this.showOtherRels||(s=n.OTHER_RELS),i.rels=r.concat(s);var l=e.crTreeArray[0];i._objIn=e,i.rels.length>0?function(e,n){var i=this;return new Promise(function(e,n){var r=i.rels,s=i.relationLabels=i.relationLabels||i._pluginOptions.RELATION_LABELS;i._lastReqStart=i._plugSvcs.nowMS(),i._plugSvcs.postEvent("GET_RELATIONS_IN_PROGRESS_EVENT",null);var l=i._objIn.crTreeArray[0].getRoot(0),c=i._objIn.crTreeArray[0].getRoot(1),u=o(l),d=o(c),p=u.concat(d);t.get(p,r,function(t){if(null!=t){var n=[];n.push(l),a(t,n,s);var r=[];r.push(c),a(t,r,s)}e(i._objIn)})})}.call(i,l,n).then(function(e){var t=e;i.reportOK(t)},function(e){i.reportKO()}):i.reportOK(e)}})}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_LIST_VIEW_PREP_PLUGIN",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,n){return e.extend({onLoad:function(){return this._parent()},onDestroy:function(){return this._parent()},execute:function(e,t){var n=this;n._parent(e,t),n._objIn=e,n._objIn.crTreeArray.forEach(function(e){e.niceUp(!0)});var i=n._objIn;null!=i?n.reportOK(i):n.reportKO()}})}),define("DS/CompareWidget2/plugins/EXPORT/EXPORT_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/EXPORT/exManager"],function(e,t){return e.extend({init:function(e,n,i,r){this._parent(e,n,i,r),this.exManager=new t(r),this._displayMode="unknown"},onEnabled:function(){var e=this;return e.enableDebugLabel("EXPORT"),e.subscribeEvent("PROPERTIES_CACHE_LOADED_EVENT",e.handle_PROPERTIES_CACHE_LOADED_EVENT.bind(e)),e.subscribeEvent("EXECUTE_EXPORT_EVENT",e.handle_EXECUTE_EXPORT_EVENT.bind(e)),e.syncSetting("viewSettings.STRUCT_VIEW.display_mode","_displayMode",null),e.syncSetting("viewSettings.STRUCT_VIEW.statuses_to_hide","_statusesHidden",null,e.exManager),e._parent()},handle_EXECUTE_EXPORT_EVENT:function(e){var t=this;t._plugSvcs.postEvent("COMPARE_EXPORT_REQUESTED"),t._plugSvcs.dbgout("EXPORT","exporting... "+t._displayMode),t.exManager.requestExport(t._displayMode,"csv")},handle_PROPERTIES_CACHE_LOADED_EVENT:function(e){this._plugSvcs.dbgout("EXPORT","Received properties cache loaded notification for "+e.data.type),this.exManager.update_attrCache(e.data.type,e.data.props)},onLoad:function(){},onDestroy:function(){return this._parent()},execute:function(e,t){try{var n=this;n._parent(e,t),n._plugSvcs.postEvent("LOAD_ALL_PROPS_REQ");var i=e;n.exManager.update_crTreeArray(i,t),n.reportOK()}catch(t){n._plugSvcs.dbgout("EXPORT","reports exception:: "+t),n.reportKO(e)}}})}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"],function(e,t){var n=function(e,t,n,i){this._relName=e,this._adjFlagArray=null==t?[]:t,this._baseNode=n,this._compNode=i,this._depth="",this._isHidden=!1,this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"};return n.prototype.getRelName=function(){return this._relName},n.prototype.resetRelName=function(e){this._relName=e},n.prototype.getAdjFlagArray=function(){return this._adjFlagArray},n.prototype.getBaseNode=function(){return this._baseNode},n.prototype.getCompNode=function(){return this._compNode},n.prototype.isBaseDummy=function(){return this._baseNode.isDummy()},n.prototype.isCompDummy=function(){return this._baseNode.isDummy()},n.prototype.qtyIsDiff=function(){return this.qtyIsDiffFlag},n.prototype.setDepth=function(e){this._depth=e},n.prototype.getDepth=function(){return this._depth},n.prototype.setIsHidden=function(e){this._isHidden=e},n.prototype.getIsHidden=function(){return this._isHidden},n.prototype.shallowDupe=function(){var e=this._relName.repeat(1),t=null==this._adjFlags?null:JSON.parse(JSON.stringify(this._adjFlags)),i=this._baseNode.shallowDupe(),r=this._compNode.shallowDupe(),o=new n(e,t,i,r);return i.setMatchInfo(o),r.setMatchInfo(o),o},n}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode",["UWA/Core","DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/support/objIDSpec","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"],function(e,t,n,i){function r(e){var n=!1;return null==e?t.errout("Cannot attach a NULL CRNode... ignored"):e==this?t.errout("Cannot attach an CRNode to itself... ignoring"):n=!0,n}var o=function(e,t,n,i,r,o,a,s,l,c){this._attrList={},this._childArray=[],this._parent=null,this._matchInfo=null,this._dbContext={},this._path=null,this._objIDSpecREF=null,this._objIDSpecINST=null,this._expandCollapseState="expanded",this._isFiltered=!1,this._isVisible=!0,this._attrList={name:e,title:t,type:n,physicalID_REF:r,physicalID_INST:i,revision:o,displayOrder:a,typeIconSmallURL:s,typeIconLargeURL:l,thumbnail_3d:c},this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode"};return o.prototype.sortChildren=function(){var e=this._childArray.sort(function(e,t){return e.getAttr("displayOrder")-t.getAttr("displayOrder")});this._childArray=e},o.prototype.isDummy=function(){return null==this._attrList.physicalID_REF},o.prototype.isFiltered=function(){return this._isFiltered},o.prototype.setDBContext=function(e){this._dbContext=e},o.prototype.setIsFiltered=function(){this._isFiltered=!0},o.prototype.isHidden=function(){return this._matchInfo.getIsHidden()},o.prototype.getObjIDSpec_REF=function(){return null==this._objIDSpecREF&&void 0!==this._attrList.physicalID_REF&&null!==this._attrList.physicalID_REF&&(this._objIDSpecREF=new n(this._attrList.physicalID_REF,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecREF},o.prototype.getObjIDSpec_INST=function(){return null==this._objIDSpecINST&&null!=this._attrList.physicalID_INST&&(this._objIDSpecINST=new n(this._attrList.physicalID_INST,this._attrList.type,this._dbContext.securityContext,this._dbContext.tenant,this._dbContext.serviceName)),this._objIDSpecINST},o.prototype.getDBContext=function(){return this._dbContext},o.prototype.getTitle=function(){return this._attrList.title},o.prototype.getType=function(){return this._attrList.type},o.prototype.addAttr=function(e,t){this._attrList[e]=t},o.prototype.getAttr=function(e){return this._attrList[e]},o.prototype.addChild=function(e){r(e)&&this._childArray.push(e)},o.prototype.getChildArray=function(){return this._childArray},o.prototype.findChildByID=function(e,t){for(var n=this._childArray.length,i=null,r=0;r<n;r++){var o=this._childArray[r],a=o.getAttr("physicalID_INST"),s=o.getAttr("physicalID_REF");if(e==a&&t==s){i=o;break}}return i},o.prototype.getPath=function(){if(null==this._path){for(var e=[],t=this;null!=t&&"object"==typeof t;){var n=t.getAttr("physicalID_INST"),i=t.getAttr("physicalID_REF");if(null==i)break;e.unshift(i),null!=n&&""!==n&&e.unshift(n),t=t.getParent()}this._path=e.join("/")}return this._path},o.prototype.setParent=function(e){r(e)&&(null!=this._parent&&t.errout("CRNode's parent is being reassigned (this is unexpected)."),this._parent=e)},o.prototype.getParent=function(){return this._parent},o.prototype.setMatchInfo=function(e){this._matchInfo=e},o.prototype.isRoot=function(){return null==this._parent},o.prototype.getMatchInfo=function(){return this._matchInfo},o.prototype.destroy=function(){this._parent=null,this._matchInfo="",this._attrList=null;for(var e=0;e<this._childArray.length;e++)null!=this._childArray[e]&&(this._childArray[e].destroy(),this._childArray[e]=null)},o.prototype.shallowDupe=function(){var t=new o(this._attrList.name,this._attrList.title,this._attrList.type,this._attrList.physicalID_INST,this._attrList.physicalID_REF,this._attrList.revision,this._attrList.displayOrder,this._attrList.typeIconSmallURL,this._attrList.typeIconLargeURL,this._attrList.thumbnail_3d);return t.setDBContext(e.clone(this.getDBContext())),this.isFiltered()&&t.setIsFiltered(),t},o.prototype.getExpandCollapseState=function(){return Array.isArray(this._childArray)&&this._childArray.length?this._expandCollapseState||"expanded":"noExpandState"},o.prototype.setExpandCollapseState=function(e){this._expandCollapseState=e},o.prototype.visitVisible_nodesAndFN=function(e){return this.visit_nodesAndFN(!0,e)},o.prototype.visitAll_nodesAndFN=function(e){return this.visit_nodesAndFN(!1,e)},o.prototype.visit_nodesAndFN=function(e,n){var i=!1;if(1==e&&1==this._isVisible||0==e)try{var r=[];for(r.push(this);r.length>0;){var o=r.pop();if(0!=(i=n(o))&&(1==e&&1==this._isVisible||0==e))for(var a=o.getChildArray(),s=a.length-1;s>=0;s--){var l=a[s],c=!(l.getMatchInfo()&&l.getMatchInfo().getIsHidden());(1==e&&1==c||0==e)&&r.push(l)}}}catch(e){i=!1,t.errout("EXCEPTION in 'visit_nodesAndFN':: "+e)}return i},o}),define("DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair"],function(e,t){var n=function(e){this._listMatchPairArray=[],this._lut=[],e&&this.build_listMatchedPairArray(e),this._lut=[],this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"};return n.prototype.build_listMatchedPairArray=function(e){var t=this;e.forEach(function(e){t._addMatchedPair(e)}),t._listMatchPairArray.forEach(function(e){var t=e.getRelName();if("LEFT_ONLY"!=t&&"RIGHT_ONLY"!=t){var n=e.getBaseNode(),i=e.getCompNode();e.qtyIsDiffFlag=n.qty!=i.qty}})},n.prototype.getMatchPairArray=function(){return this._listMatchPairArray},n.prototype.generateDisplayLists=function(){var t=[[],[]];return this._listMatchPairArray.forEach(function(n){var i=n.getBaseNode();null==i&&(i=new e);var r=n.getCompNode();null==r&&(r=new e),t[0].push(i),t[1].push(r)}),t},n.prototype._addMatchedPair=function(n){var i=n.getRelName();if("UNRELATED"==i||"DIFFERENT"==i){var r=n.getBaseNode(),o=n.getCompNode(),a=new e,s=new e,l=new t("LEFT_ONLY",null,r,s),c=new t("RIGHT_ONLY",null,a,o);this._addListMatchedPair(l),this._addListMatchedPair(c)}else{var u=n.shallowDupe();u._adjFlagArray=[],this._addListMatchedPair(u)}},n.prototype._addListMatchedPair=function(e){var t=e.getBaseNode(),n=null==t||t.isDummy(),i=n?"":t.getAttr("physicalID_REF"),r=e.getCompNode(),o=null==r||r.isDummy(),a=o?"":r.getAttr("physicalID_REF"),s=i+"."+a,l=this._lut[s],c=!1;if(null!=l){var u=l.getBaseNode(),d=l.getCompNode();0==n&&(null==u.qty||(u.qty.length=0)?u.qty=1:u.qty++),0==o&&(null==d.qty||(d.qty.length=0)?d.qty=1:d.qty++),c=!0}else if(0==n&&0==o){var p=i+".",h=this._lut[p];if(null!=h&&h.getCompNode().isDummy()){h.getBaseNode().qty++,(E=r.shallowDupe()).qty=1,E._matchInfo=h,h._compNode=E,h._relName=e._relName,this._lut[s]=h,this._lut["."+a]=h,c=!0}else{var g="."+a,_=this._lut[g];if(null!=_&&_.getBaseNode().isDummy())_.getCompNode().qty++,(f=t.shallowDupe()).qty=1,f._matchInfo=_,_._baseNode=f,_._relName=e._relName,this._lut[s]=_,this._lut[i+"."]=_,c=!0;else(T=e.shallowDupe()).getBaseNode().qty=1,T.getCompNode().qty=1,this._listMatchPairArray.push(T),this._lut[s]=T,this._lut[i+"."]=T,this._lut["."+a]=T,c=!0}}else if(o){var f,S="."+i,m=this._lut[S];if(null!=m)(f=t.shallowDupe()).setMatchInfo(m),f.qty=1,m._baseNode=f,m._relName="IDENTICAL",this._lut[i+"."]=m,this._lut[i+"."+i]=m,c=!0}else if(n){var E,C=a+".",v=this._lut[C];if(null!=v)(E=r.shallowDupe()).setMatchInfo(v),E.qty=1,v._compNode=E,v._relName="IDENTICAL",this._lut["."+a]=v,this._lut[a+"."+a]=v,c=!0}if(0==c){var T=e.shallowDupe();this._lut[s]=T,T.getBaseNode().qty=n?"":1,T.getCompNode().qty=o?"":1,this._listMatchPairArray.push(T)}},n}),define("DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/ViewPanel/crList"],function(e,t,n,i){function r(e){var n=new t;return n.setParent(e),n}function o(e,t,i){var a=t.getChildArray(),s=i.getChildArray(),l=a.length,c=s.length,u=[],d=[],p=0;for(p=0;p<c;p++)s[p].touched=!1;for(p=0;p<l;p++){let t=a[p],s=null;if(null==t._matchInfo){s=r(i),i.addChild(s);let e=new n("LEFT_ONLY",null,t,s);t._matchInfo=e,s._matchInfo=e}else s=t._matchInfo.getCompNode();u.push(t),d.push(s),s.touched=!0,o(e,t,s)}for(p=0;p<c;p++){let i=s[p];if(0==i.touched&&null==i._matchInfo){let a=r(t);t.addChild(a);let s=new n("RIGHT_ONLY",null,a,i);i._matchInfo=s,a._matchInfo=s,u.push(a),d.push(i),i.touched=!0,o(e,a,i)}else i.touched=!0}t._childArray=u,i._childArray=d}function a(e){!function e(t,n,i,r){n[i]=r;var o=n.join(".");var a=t.getMatchInfo();a.setDepth(o);var s=t.getChildArray();var l=s.length;for(var c=0;c<l;c++){var u=s[c];e(u,n,i+1,c+1)}n.pop()}(e.getRoot(0),[],0,1)}var s=function(){this._rootSet=[],this._matchPairArray=[],this._crList=null,this._reqMod="DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree"};return s.prototype.niceUp=function(e){!function(e,t){var i=e.getRoot(0),a=e.getRoot(1),s=!1,l=i.getMatchInfo();if("UNRELATED"!=l.getRelName()&&l.getCompNode()==a&&(s=!0),s||t)o(e,i,a);else{var c=r(null),u=new n("LEFT_ONLY",null,i,c);i.setMatchInfo(u),c.setMatchInfo(u),o(e,i,c),c.addChild(a);var d=r(null);u=new n("RIGHT_ONLY",null,d,a),d.setMatchInfo(u),a.setMatchInfo(u),o(e,d,a),i.addChild(d),e.resetDisplayRoot(1,c)}}(this,e),a(this),this._matchPairArray=function(e){var t=[],n=[];for(n.push(e.getRoot(0));n.length>0;){var i=n.pop(),r=i.getMatchInfo();t.push(r);for(var o=i.getChildArray(),a=o.length-1;a>=0;a--){var s=o[a];n.push(s)}}return t}(this),this._crList=new i(this._matchPairArray)},s.prototype.getMatchPairArray=function(){return this._matchPairArray},s.prototype.getCRList=function(){return this._crList},s.prototype.getRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_root),t},s.prototype.getRootArray=function(){return this._rootSet},s.prototype.getDisplayRoot=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].CRNode_displayRoot),t},s.prototype.getRootObjIDSpec=function(e){var t=null;return null!=this._rootSet[e]&&(t=this._rootSet[e].root_objIDSpec),t},s.prototype.resetDisplayRoot=function(e,t){null!=this._rootSet[e]&&(this._rootSet[e].CRNode_displayRoot=t)},s.prototype.setRoot=function(e,t,n){this._rootSet[e]={root_objIDSpec:t,CRNode_displayRoot:n,CRNode_root:n}},s.prototype.destroy=function(){for(var e=0;e<this._rootSet.length;e++){var t=this._rootSet[e];null!=t&&(t.root_objIDSpec.destroy(),delete t.root_objIDSpec,t.CRNode_displayRoot.destroy(),delete t.CRNode_displayRoot,delete t.CRNode_root,delete this._rootSet[e])}},s.prototype.sortTreeNodes=function(){for(var e=this._rootSet.length,t=0;t<e;t++)this.visitAll_treeAndFN(t,function(e){e.sortChildren()})},s.prototype.updateMatchPairHiddenFlags=function(e,t,n){var i=n?"both":"either",r={};t.forEach(function(e){r[e]=!0});for(var o=e?this.getCRList().getMatchPairArray():this.getMatchPairArray(),a=o.length,s=e?0:1;s<a;s++){var l=o[s],c=l.getRelName(),u=1==r[c];"both"==i?u&&e&&l.qtyIsDiffFlag&&(u&=1==r.QUANTITY):u||e&&l.qtyIsDiffFlag&&r.QUANTITY&&(u=!0),"both"==i?u&&l.getAdjFlagArray().forEach(function(e){u&=1==r[e]}):u||l.getAdjFlagArray().forEach(function(e){r[e]&&(u=!0)}),l.setIsHidden(u)}},s.prototype.findNodeByIDPath=function(e,t){var n=t.split("/"),i=this.getRoot(e),r=null,o="",a=i.getAttr("physicalID_REF");if(n[0]==i.getAttr("physicalID_REF")){for(var s=1;null!=i&&s<n.length;s+=2){o=n[s],a=n[s+1];i=i.findChildByID(o,a)}r=i}return r},s.prototype.visitVisible_treeAndFN=function(e,t){this.visit_treeAndFN(!0,e,t)},s.prototype.visitAll_treeAndFN=function(e,t){this.visit_treeAndFN(!1,e,t)},s.prototype.visit_treeAndFN=function(t,n,i){var r=!1,o=this.getRoot(n);return null==o?e.errout("'visit_treeAndFN()' called, but tree has no root set"):r=o.visit_nodesAndFN(t,i),r},s}),define("DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine",["DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList"],function(e,t,n,i){function r(e){var n=e.getAttr("REF.ds6w:identifier");null!=n&&""!==n||(n=e.getAttr("REF.name"));var i=e.getAttr("REF.ds6w:label");null!=i&&""!==i||(i=e.getAttr("REF.Title"));var r=e.getAttr("REF.typeIcons"),o=null!=r?r.smallURL:null,a=null!=r?r.largeURL:null,s=e.getAttr("INST.ro.plminstance.v_treeorder");null!=s&&""!==s||(s=e.getAttr("INST.ro.plminstance.V_treeorder"));var l=new t(n,i,e.getAttr("REF.ds6w:type"),e.getAttr("INST.physicalid"),e.getAttr("REF.physicalid"),e.getAttr("REF.ds6wg:revision"),s,o,a,e.getAttr("REF.thumbnail_3d"));l.setDBContext(UWA.clone(e.getDBContext()));var c=e.getAttr("REF.proxySpec");return null!=c&&""!==c.serviceURL&&(l._dbContext.serviceName=c.serviceURL),l}function o(e,t,i,r){var o=new n(e,t,i,r);return i.setMatchInfo(o),r.setMatchInfo(o),o}var a=function(e){var t=this;t._plugSvcs=e,t._COMPUTE_DIFFERENT=null,t._RELATIONSHIP_NAMES=null,t._RelName2Index={},t._score2CompareIndex={},t._attrNameArray_base=[],t._attrNameArray_comp=[],t._adjArray=[],t._maxAdjScore=0,t._missingAttrVals=!1};function s(e,t){for(var n=t.toString(),i=e-n.length,r="",o=0;o<i;o++)r+=" ";return r+n}return a.prototype._initInternals=function(e){var t=this;t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._RELATIONSHIP_NAMES=[...e.CUSTOM_RELATIONSHIP_NAMES,...e.SYSTEM_RELATIONSHIP_NAMES],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach(function(e,n){t._RelName2Index[e]=n});var n=e.CUSTOM_MATCH_ADJUSTMENTS,i=e.PROPS,r=e.CUSTOM_COMPARISONS;t._score2CompareIndex={};var o=Object.keys(r);e.CUSTOM_RELATIONSHIP_NAMES.forEach(function(e,n){var i=0,a=[];o.forEach(function(e,t){var o=r[e][1][n];"EQ"==o?i+=1<<t:"N/A"==o&&a.push(1<<t)});var s=t._calcScoreSet(i,a);t._score2CompareIndex[i]=n,s.forEach(function(e){t._score2CompareIndex[e]=n})});var a={},s={};Object.keys(r).forEach(function(e){var t=r[e][0],n=t[0],o=t[1],l=i[n],c=i[o];a[l]=!0,s[c]=!0}),t._attrNameArray_base=Object.keys(a),t._attrNameArray_comp=Object.keys(s),t._adjArray=[];for(var l=null==n?0:n.length,c=0;c<l;c++){var u=n[c],d=u.PROPS,p=d[0],h=d[1],g=i[p],_=i[h],f=u.MATCH_ADJ;t._adjArray[c]={adjName:u.NAME,propName0:g,propName1:_,flagOn:u.FLAG_ON,adjScore:f,truthBit:1<<c},f>0&&(t._maxAdjScore+=f)}},a.prototype._calcScoreSet=function(e,t){for(var n=[],i=Math.pow(2,t.length),r=0;r<i;r++){for(var o=e,a=0;a<r;a++)0!=(r&1<<a)&&(o+=t[a]);n.push(o)}return n},a.prototype._buildAttrValLUT=function(e,t){var n=this,i={};return t.forEach(function(t){i[t]={},e.forEach(function(e,r){var o=e.getAttr(t);null!=o?(null==i[t][o]&&(i[t][o]=[]),i[t][o].push(r)):0==e.isRoot()&&1!=n._missingAttrVals&&(n._missingAttrVals=!0,n._plugSvcs.errout("Assembly being tested is MISSING REQUIRED values for the current ruleset"))})}),i},a.prototype._findMatches=function(e,t){var n=this,r=!1,o=n._buildAttrValLUT(e,n._attrNameArray_base),a=new i(e,t);return t.forEach(function(t,i){var s={};n._attrNameArray_comp.forEach(function(e,n){var i=t.getAttr(e),r=o[e][i];if(null!=r){var a=1<<n;r.forEach(function(e){null==s[e]&&(s[e]=0),s[e]+=a})}});var l=Object.keys(s),c=e.length>0&&1==e[0].isRoot();c&&0==l.length&&(r=!0),l.forEach(function(o){var l=s[o],u=n._score2CompareIndex[l];if(null!=u){n._stats.totalMatchedFoundCount++;var d=e[o],p=n._evalAdjustment(d,t);a.add(o,i,u,n._RELATIONSHIP_NAMES[u],p.adjIndex,p.adjFlagArray)}else c&&(r=!0)}),r&&(n._stats.rootWasForced=!0,a.add(0,0,n._RelName2Index.UNRELATED,"UNRELATED",0,[]))}),a.getResult()},a.prototype._evalAdjustment=function(e,t){for(var n=0,i=[],r=0;r<this._adjArray.length;r++){var o=this._adjArray[r],a=o.propName0,s=o.propName1,l=e.getAttr(a),c=t.getAttr(s),u="EQ"==o.flagOn;if(null!=l&&null!=c)l==c==u&&(i.push(o.adjName),n+=o.adjScore)}return 0!=n&&this._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+n+", FLAGS: "+i),{adjIndex:this._maxAdjScore-n,adjFlagArray:i}},a.prototype._processNodeSets=function(e,t){var n=this;n._stats.processedNodeSetCount++,n._plugSvcs.dbgout("EVAL","PROCESSING "+e.length+" x "+t.length+" nodes..."),1==e.length&&e[0].isRoot()||(e.forEach(function(e){var t=r(e);e._crNode=t;var n=e.getParent()._crNode;n.addChild(t),t.setParent(n)}),t.forEach(function(e){var t=r(e);e._crNode=t;var n=e.getParent()._crNode;n.addChild(t),t.setParent(n)}));var i=n._findMatches(e,t);n._stats.unmatchedCount+=i.riUnmatchedNodeArray_base.length+i.riUnmatchedNodeArray_comp.length,n._stats.totalMatchedUsedCount+=i.riMatchedNodePairArray.length;var a=i.riMatchedNodePairArray,s=i.riUnmatchedNodeArray_base,l=i.riUnmatchedNodeArray_comp;a.forEach(function(e){var t=e.riNode_base,i=e.riNode_comp,r=t._crNode,a=i._crNode;o(e.relName,e.adjFlagArray,r,a),n._markParentsDiff(r,a);var s=t.getChildArray(),l=i.getChildArray();(s.length>0||l.length>0)&&n._processNodeSets(s,l)}),1==n._COMPUTE_DIFFERENT&&(s.length>0||l.length>0)&&n._processUnmatched(s,l)},a.prototype._processUnmatched=function(e,t){var n=[],i=[];e.forEach(function(e){e.getChildArray().forEach(function(e){n.push(e)})}),t.forEach(function(e){e.getChildArray().forEach(function(e){i.push(e)})}),this._processNodeSets(n,i)},a.prototype._markParentsDiff=function(e,t){if(null!=e&&null!=t){var n=e.getParent(),i=t.getParent(),r=0;if(r+=null!=n?1:0,0!=(r+=null!=i?1:0))if(1!=r){var a=n.getMatchInfo(),s=n.getMatchInfo(),l=0;if(l+=null!=a?1:0,0==(l+=null!=s?1:0)){o("DIFFERENT",[],n,i),this._stats.diffCount++,this._markParentsDiff(n,i)}else{if(1==l)return void console.error("MarkParentsDiff() failed sanity check - one parent already assigned");if(a==s&&"UNRELATED"==a.getRelName())return a.resetRelName("DIFFERENT"),void this._stats.diffCount++}}else console.error("MarkParentsDiff() failed sanity check - one node is root")}else console.error("markParentsDiff() fails sanity check: one of these nodes is null")},a.prototype._compareTrees=function(t,n){this._missingAttrVals=!1;var i=new e,o=t.getRoot(),a=n.getRoot(),s=r(o);o._crNode=s,i.setRoot(0,t.getObjIDSpec(),s),t.getObjIDSpec().isFiltered()&&s.setIsFiltered();var l=r(a);return a._crNode=l,i.setRoot(1,n.getObjIDSpec(),l),n.getObjIDSpec().isFiltered()&&l.setIsFiltered(),this._processNodeSets([o],[a]),i},a.prototype._cleanup=function(e){var t=this;e.forEach(function(e,n){var i=0;e.visit_riTreeAndFN(function(e){return i++,delete e._crTree,!0}),t._plugSvcs.dbgout(" --\x3e Tree #"+n+" node count      : "+s(7,i))})},a.prototype.doCompare=function(e,t,n){var i=this;i._plugSvcs=n;var r=i._plugSvcs.nowMS();i._initInternals(t);var o=[],a=e[0],l=a.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==l&&(l=a.getRoot().get_dbObj_REF().getAttr("Title"));for(var c=e.length,u=1;u<c;u++){var d=e[u],p=d.getRoot().get_dbObj_REF().getAttr("ds6w:label");null==p&&(p=d.getRoot().get_dbObj_REF().getAttr("Title")),i._stats={processedNodeSetCount:0,totalMatchedFoundCount:0,totalMatchedUsedCount:0,unmatchedCount:0,diffCount:0,rootWasForced:!1,dump:function(e){var t=this;e(" Total node sets processed   : "+s(7,t.processedNodeSetCount)),e(" Total matches found         : "+s(7,t.totalMatchedFoundCount));var n="";t.rootWasForced&&(n=" (+ 1 b/c root was forced)"),e(" Total matches Used          : "+s(7,t.totalMatchedUsedCount)+n),e(" Unmatched Nodes             : "+s(7,t.unmatchedCount)),e(" Unmatched Changed to 'diff' : "+s(7,t.diffCount))}},i._plugSvcs.dbgout("vvvvvvvvvvvvvvvvvvvvv  COMPARING TREES  vvvvvvvvvvvvvvvvvvvvv <<<<"),i._plugSvcs.dbgout(" Roots are                   : '"+l+"' & '"+p+"'");var h=i._compareTrees(a,d);h.sortTreeNodes(),i._stats.dump(i._plugSvcs.dbgout),o[u-1]=h,c>2&&i._plugSvcs.dbgout("------------------------------------------------------------------")}return i._cleanup(e),i._plugSvcs.dbgout("^^^^ ^^^^^^^^^^^^^^^^  COMPARING TREES  ^^^^^^^^^^^^^^^^^^^^^ <<<<"),i._plugSvcs.reportTime(r,"----ALL tree structure comparisons are done----: "),o},a}),define("DS/CompareWidget2/plugins/STRUCTURE/STRUCT_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/structCompareEngine","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,n){return e.extend({init:function(e,t,n,i){this._parent(e,t,n,i)},onLoad:function(){return this._engine=new t(this._plugSvcs),this._parent()},onDestroy:function(){return this._engine=null,this._parent()},sendPreloadPropsHint:function(e){var t=new n,i=new n,r=new n,o=new n;e[0].visitAll_treeAndFN(0,function(e){var n=e.getMatchInfo(),a=null==n||"IDENTICAL"!=n.getRelName(),s=a?t:i,l=a?r:o,c=e.getObjIDSpec_REF(),u=e.getObjIDSpec_INST();if(null!=c&&s.addObjIDSpec(c),null!=u&&l.addObjIDSpec(u),null!=n){var d=n.getCompNode();if(null!=d){var p=d.getObjIDSpec_REF(),h=d.getObjIDSpec_INST();null!=p&&s.addObjIDSpec(p),null!=h&&l.addObjIDSpec(h)}}return!0}),e[0].visitAll_treeAndFN(1,function(e){if(null==e.getMatchInfo()){var n=e.getObjIDSpec_REF(),i=e.getObjIDSpec_INST();null!=n&&t.addObjIDSpec(n),null!=i&&r.addObjIDSpec(i)}return!0});var a={diff:t,nodiff:i},s={diff:r,nodiff:o};this._plugSvcs.postEvent("PRELOAD_PROP_REF_HINT_EVENT",a),this._plugSvcs.postEvent("PRELOAD_PROP_INST_HINT_EVENT",s),t=null,i=null,r=null,o=null,a=null,s=null},execute:function(e,t){var n=this;n._parent(e,t);var i=e,r=n._engine.doCompare(i,t,this._plugSvcs);if(n.sendPreloadPropsHint(r),null!=r){var o={crTreeArray:r,ruleNames:t.CUSTOM_RELATIONSHIP_NAMES,destroy:function(){Array.isArray(this.crTreeArray)&&(this.crTreeArray.forEach(function(e){e.destroy()}),this.crTreeArray=null)}};n.reportOK(o)}else n.reportKO()}})}),define("DS/CompareWidget2/plugins/EXPORT/exFormatter",["DS/CompareWidget2/support/cw2Utils","DS/CompareCommon/Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport","i18n!DS/CompareWidget2/assets/nls/CompareV2"],function(e,t,n,i,r,o,a,s){function l(e,t){var n=!1;if(null==e&&null!=t||null!=e&&null==t)n=!0;else if(e.length!=t.length)n=!0;else if(e.constructor!=t.constructor)n=!0;else if(e.constructor!=Array)e!=t&&(n=!0);else for(var i=0;i<e.length;i++)e[i]!=t[i]&&(n=!0);return n}function c(e,n){let i="",r=Array.isArray(e)?e.length:Array.isArray(n.length)?n.length:0;e=e||[],n=n||[];for(var o=0;o<r;o++){if(e[o]&&"thumbnail"==e[o].type||n[o]&&"thumbnail"==n[o].type)continue;var s=e[o]?e[o].nls:null,c=n[o]?n[o].nls:null,u=e[o]?t.getAttrValueFromAttrData(e[o]):null,d=n[o]?t.getAttrValueFromAttrData(n[o]):null;if(l(u,d))i+=a.replace(a.get("ReferenceAttribute"),{attributeName:s,attributeValue:u})+", "+a.replace(a.get("ComparedAttribute"),{attributeName:c,attributeValue:d})+"\n"}return i}function u(e,n){var i="";let r=t.intersectionDifference(e,n,(e,t)=>e.name===t.name),o=r[0].intersection,a=r[1].intersection,s=r[0].difference,l=r[1].difference;return i+=c(o,a)+c(s,null)+c(null,l)}function d(e,t){if(relName="",null!=t){let n=t[e];if(null!=n&&""!==n){let e=s[n.NLS];null!=e&&""!==e&&(relName=e)}}return relName}return{createOutputTables:function(e,t,n,i,r){var o=[],a="list"==e;return n.forEach(function(e){var n=null;a?n=e.getCRList().getMatchPairArray():n=e.getMatchPairArray();n.forEach(function(e){var n="",s="",l="",c="",p="",h="",g="",_="onPremise",f="",S="",m=[],E=[],C="",v="",T="",R="",I="",D="",A="",y="onPremise",b="",N="",O=[],P=[],w=e.getBaseNode();if(0==w.isDummy()){l=(n=w.getObjIDSpec_REF()).getPhysID(),c=(s=w.getObjIDSpec_INST())?s.getPhysID():null,p=w.getTitle(),h=w.getType(),g=w.qty,_=n.getTenant(),f=n.getServiceName(),S=n.getSecurityContext();let e=t.REFERENCE._getFromCache(_,f,S,l);if(null!==e&&(m=e.attrVals),s&&null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(_,f,S,c);null!==e&&(E=e.attrVals)}}var L=e.getCompNode();if(0==L.isDummy()){T=(C=L.getObjIDSpec_REF()).getPhysID(),R=(v=L.getObjIDSpec_INST())?v.getPhysID():null,I=L.getTitle(),D=L.getType(),A=L.qty,I=L.getTitle(),D=L.getType(),y=C.getTenant(),b=C.getServiceName(),N=C.getSecurityContext();let e=t.REFERENCE._getFromCache(y,b,N,T);if(null!==e&&(O=e.attrVals),v&&null!=t.INSTANCE){let e=t.INSTANCE._getFromCache(y,b,N,R);null!==e&&(P=e.attrVals)}}var M=e.getRelName();Array.isArray(r)&&r.indexOf(M)>=0&&(M="IDENTICAL");var F=function(e,t){var n=d(e,t.CUSTOM_MATCH_ADJ_FLAGS);return""===n&&""===(n=d(e,t.CUSTOM_RULE_ID_FLAGS))&&(n=d(e,t.SYSTEM_RULE_ID_FLAGS)),n}(M,i);""!==F&&(M=F);var U=e.getDepth(),x=h||D,V=L.isDummy()||w.isDummy(),W=V?"":u(m,O),j=V?"":u(E,P),k=null;k=a?[g,p,A,I,x,M,W]:[U,p,I,x,M,W,j],o.push(k)})}),o}}}),define("DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine",["DS/CompareWidget2/support/cw2Utils","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crTree","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/crNode","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/plugins/STRUCTURE/refInstTree/hierResultList"],function(e,t,n,i,r){var o=function(){this._opCount=0,this._descendantEvals=0,this._matchCount=0,this._propCompArray=[],this._adjArray=[],this._masked_lut={},this._RELATIONSHIP_NAMES=null,this._CUSTOM_MATCH_ADJUSTMENTS=null,this._COMPUTE_DIFFERENT=null,this._maxAdjScore=0};function a(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t}return o.prototype._evalAdjustment=function(e,t){for(var n=0,i=[],r=0;r<this._adjArray.length;r++){var o=this._adjArray[r],a=o.propName0,s=o.propName1,l=e.getAttr(a),c=t.getAttr(s),u="EQ"==o.flagOn;if(null!=l&&null!=c)if(l==c==u){o.MATCH_ADJ;i.push(o.adjName),n+=o.adjScore}}return 0!=n&&this._plugSvcs.dbgout("EVAL","----\x3e>> [ADJUSTMENT] : Adj: "+n+", FLAGS: "+i),{adjIndex:this._maxAdjScore-n,adjFlagArray:i}},o.prototype._evalOnDescendants=function(e,t){for(var n=this,i=e.getChildArray(),r=t.getChildArray(),o=null,s=1;null==o&&s<=1e3&&i.length>0&&r.length>0;)this._plugSvcs.dbgout("EVAL"," Looking in child generation "+s),i.forEach(function(e){r.forEach(function(t){var i=n._eval(e,t);if(n._descendantEvals++,null!=i){var r=n._evalAdjustment(e,t);(null==o||i<o.relIndex||i==o.relIndex&&r.adjIndex<o.adj.adjIndex)&&(o={generation:s,relIndex:i,adj:r})}})}),null==o&&(s++,i=a(i),r=a(r));return o},o.prototype._buildRelListArray=function(e,t,n){var i=this;i._plugSvcs.dbgout("EVAL"," >>> buildRelLists() is looking for all matches among ("+e.length+" x "+t.length+") nodes");for(var o=new r(e,t),a=0;a<e.length;a++)for(var s=e[a],l=0;l<t.length;l++){var c=t[l],u=null;if(n){i._plugSvcs.dbgout("EVAL"," evaluating descendants of nodes ("+a+","+l+")");var d=i._evalOnDescendants(s,c);if(null==d)i._plugSvcs.dbgout("EVAL"," Descendants of nodes ("+a+","+l+") have nothing in common");else{u=d.relIndex;var p=d.adj;o.add(a,l,u,i._RELATIONSHIP_NAMES[u],p.adjIndex,p.adjFlagArray)}}else if(null!==(u=i._eval(s,c))){p=i._evalAdjustment(s,c);o.add(a,l,u,i._RELATIONSHIP_NAMES[u],p.adjIndex,p.adjFlagArray)}}return o},o.prototype._eval=function(e,t){for(var n=this,i=null,r=0,o=n._propCompArray.length,a=0;a<o;a++){var s=n._propCompArray[a],l=s.propName0,c=s.propName1,u=e.getAttr(l),d=t.getAttr(c);n._opCount++,null!=u&&u==d&&(r+=s.truthBit)}var p=n._masked_lut.length;for(a=0;a<p;a++){var h=n._masked_lut[a];(r&h.mask)==h.maskedScore&&(i=h.relIndex)}if(null!==i){n._matchCount++;var g=n._RELATIONSHIP_NAMES[i];n._plugSvcs.dbgout("EVAL"," ----\x3e>> rel: "+g+",    SCORE: "+r+":      "+e.getAttr("REF.ds6w:label")+"  <vs>  "+t.getAttr("REF.ds6w:label"))}return i},o.prototype._evalNodeSet=function(e,t,n){var i={};if(0==e.length)this._plugSvcs.dbgout("EVAL"," evalNodeSets() has "+t.length+" nodes that are 'RIGHT-ONLY'"),i={riMatchedNodePairArray:[],riUnmatchedArray_base:[],riUnmatchedArray_comp:t};else if(0==t.length)this._plugSvcs.dbgout("EVAL"," evalNodeSets() has "+e.length+" nodes that are 'LEFT-ONLY'"),i={riMatchedNodePairArray:[],riUnmatchedArray_base:e,riUnmatchedArray_comp:[]};else{var r=" evalNodeSets() is LOOKING for BEST matches among ("+e.length+" x "+t.length+") nodes";n&&(r+=" // evaluating based on child rels..."),this._plugSvcs.dbgout("EVAL",r);var o=this._buildRelListArray(e,t,n),a=o.getResult();i={riMatchedNodePairArray:a.riMatchedNodePairArray,riUnmatchedArray_base:a.riUnmatchedNodeArray_base,riUnmatchedArray_comp:a.riUnmatchedNodeArray_comp},o.destroy(),o=null,a=null}return i},o.prototype._evalChildNodes=function(e,t){var n={},i=this._evalNodeSet(e,t,!1);0==i.riMatchedNodePairArray.length&&this._plugSvcs.dbgout("EVAL"," <<< there were NO MATCHES among the nodes >>>");var r=null;if(1==this._COMPUTE_DIFFERENT){var o=i.riUnmatchedArray_base,a=i.riUnmatchedArray_comp;o.length>0&&a.length>0&&(this._plugSvcs.dbgout("EVAL"," >>> looking for diff..."),r=this._evalNodeSet(o,a,!0))}if(null!=r){for(var s=0;s<r.riMatchedNodePairArray.length;s++){var l=r.riMatchedNodePairArray[s];l.relIndex=this._RelName2Index.DIFFERENT,l.relName="DIFFERENT"}n={riMatchedNodePairArray:[...i.riMatchedNodePairArray,...r.riMatchedNodePairArray],riUnmatchedArray_base:r.riUnmatchedArray_base,riUnmatchedArray_comp:r.riUnmatchedArray_comp}}else n=i;return n},o.prototype._initInternals=function(e){var t=this;t._CUSTOM_MATCH_ADJUSTMENTS=e.CUSTOM_MATCH_ADJUSTMENTS,t._COMPUTE_DIFFERENT=e.COMPUTE_DIFFERENT,t._maxAdjScore=0;var n=e.PROPS,i=e.CUSTOM_COMPARISONS,r=e.CUSTOM_RELATIONSHIP_NAMES,o=e.SYSTEM_RELATIONSHIP_NAMES;t._RELATIONSHIP_NAMES=[...r,...o],t._RelName2Index={},t._RELATIONSHIP_NAMES.forEach(function(e,n){t._RelName2Index[e]=n}),t._adjArray=[];for(var a=null==t._CUSTOM_MATCH_ADJUSTMENTS?0:t._CUSTOM_MATCH_ADJUSTMENTS.length,s=0;s<a;s++){var l=t._CUSTOM_MATCH_ADJUSTMENTS[s],c=l.PROPS,u=c[0],d=c[1],p=n[u],h=n[d],g=l.MATCH_ADJ;t._adjArray[s]={adjName:l.NAME,propName0:p,propName1:h,flagOn:l.FLAG_ON,adjScore:g,truthBit:1<<s},g>0&&(t._maxAdjScore+=g)}var _=[];s=0;Object.keys(i).forEach(function(e){var r=i[e],o=r[1].length;if(0==_.length)for(var a=0;a<o;a++)_[a]={val:0,mask:0};var l=r[0],c=l[0],u=l[1],d=n[c],p=n[u];t._propCompArray[s]={compName:e,propName0:d,propName1:p,truthBit:1<<s};var h=r[1],g=h.length;for(a=0;a<g;a++)"EQ"==h[a]&&(_[a].val+=1<<s),"N/A"==h[a]&&(_[a].mask+=1<<s);s++});var f=[],S=_.length;for(s=0;s<S;s++){_[s].val;var m=-1;0!=_[s].mask&&(m=~_[s].mask),f.push({relIndex:s,maskedScore:_[s].val,mask:m})}t._masked_lut=f},o}),define("DS/CompareWidget2/plugins/STRUCTURE/REL_COMPARE_plugin",["DS/CompareWidget2/plugins/plugin","DS/CompareWidget2/plugins/STRUCTURE/relCompareEngine","DS/CompareWidget2/plugins/STRUCTURE/compareResultTree/matchPair","DS/CompareWidget2/support/tenantServiceContext_IDList"],function(e,t,n,i){return e.extend({onLoad:function(){return this._engine=new t,this._parent()},onEnabled:function(){this.syncSetting("compareSettings.includeFacets.externalRelations.showDocs","showDocs"),this.syncSetting("compareSettings.includeFacets.externalRelations.showOtherRels","showOtherRels")},onDestroy:function(){return this._engine=null,this._parent()},getAllChildren:function(e){var t=[];return e.forEach(function(e){e.getChildArray().forEach(function(e){t.push(e)})}),t},compareChildrenNodes:function(e,t){var i=[],r=[];e.forEach(function(e){null==e._matchInfo&&i.push(e)}),t.forEach(function(e){null==e._matchInfo&&r.push(e)});for(var o=this._engine._evalChildNodes(i,r,!0),a=o.riMatchedNodePairArray.length,s=0;s<a;s++){var l=o.riMatchedNodePairArray[s],c=l.adjFlagArray,u=l.relName,d=l.riNode_base,p=l.riNode_comp,h=new n(u,c,d,p);d.setMatchInfo(h),p.setMatchInfo(h)}},compareAllGenerationChildren:function(e,t){for(var n=1,i=e,r=t;n<=50&&i.length>0;)this.compareChildrenNodes(i,r),i=this.getAllChildren(i),r=this.getAllChildren(r),n++},execute:function(e,t){var n=this;if(n._objIn=e,!0===this.showDocs||"true"===this.showDocs||!0===this.showOtherRels||"true"===this.showOtherRels){n._parent(e,t),n._engine._plugSvcs=n._plugSvcs,n._engine._initInternals(t),n._engine._COMPUTE_DIFFERENT=!0,n._objIn=e;var i=n._objIn.crTreeArray[0].getRoot(0),r=n._objIn.crTreeArray[0].getRoot(1),o=i.getChildArray(),a=r.getChildArray();n.compareAllGenerationChildren(o,a)}var s=n._objIn;null!=s?n.reportOK(s):n.reportKO()}})}),define("DS/CompareWidget2/plugins/EXPORT/exManager",["DS/CompareWidgetUtils/CompareExporter","DS/CompareWidget2/plugins/EXPORT/exFormatter","i18n!DS/CompareWidgetUtils/assets/nls/CompareExport"],function(e,t,n){var i=function(e){this._plugSvcs=e,this.clearExportReq()};return i.prototype.clearExportReq=function(){this._exportReq=null,this._crTreeArray=null,this._attrCache={INSTANCE:null,REFERENCE:null},this._exportInProgress=!1,this._exportInProgressDisplayed=!1},i.prototype.update_attrCache=function(e,t){this._plugSvcs.dbgout("EXPORT","Setting new AttrCache for "+e),this._attrCache[e]=t,this._exportIfReady()},i.prototype.update_crTreeArray=function(e,t){this._plugSvcs.dbgout("EXPORT","Updating structures"),null!=this._exportReq&&this._plugSvcs.showAlertBox(n.ExportAbortedNewCompareInitiated,null,"warning"),this.clearExportReq(),this._pluginOptions=t,this._crTreeArray=e,this._exportIfReady()},i.prototype.requestExport=function(e,t){this._exportReq={displayType:e,outputType:t},this._exportIfReady()},i.prototype._exportIfReady=function(){if(null!=this._exportReq)if(null!=this._attrCache.REFERENCE&&null!=this._crTreeArray&&0==this._exportInProgress){this._exportInProgress=!0;var e=this;setTimeout(function(){null!=e._exportReq&&(e._doExport(e._exportReq.displayType,e._exportReq.outputType),e._plugSvcs.showAlertBox(n.CompareExportComplete,null,"success",!0),e._exportReq=null,e._exportInProgress=!1,e._exportInProgressDisplayed=!1)},0)}else this._exportInProgressDisplayed||(this._exportInProgressDisplayed=!0,this._plugSvcs.showAlertBox(n.CompareExportRunning,null,"warning"))},i.prototype._doExport=function(i,r){var o={columns:[],tables:[{rows:[]}]},a={structDisplayStyle:i,outputAttributeDifferences:!0};if(e.outHeader(a,o.columns),o.tables[0].rows=t.createOutputTables(i,this._attrCache,this._crTreeArray,this._pluginOptions,this._statusesHidden),null==o.tables[0].rows)this._plugSvcs.showAlertBox(n.CompareExportFailure,null,"error");else{var s={csv_base_file_name:n.BaseFilenameExport};switch(r){case"csv":e.generateCsv(o,s);break;case"html":e.printHtml(o,s);break;case"console":e.consoleOutput(o,s)}}},i});