define("DS/ENOXSpecificationsUX/data/Connector3DSpace",["UWA/Core","DS/ENOXAttachmentsUX/data/Constants","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,o,n,r,a){"use strict";return function(){var n={options:{},init:function(t,e){if(n.controller=t,n.options=e||{},!(n.options&&n.options.fetchSecurityContext&&n.options.platformUrls&&n.options.platformUrls["3DSpace"]&&n.options.platformUrls.platformId))throw new Error("Connector Options incomplete");n.ready=!0,n.controller.connectorReady(n.options)},loadAttachments:function(r){if(!this.ready)throw new Error("Connector not ready");if(r)if(r.noParent&&t.is(r.objectIds,"array"))o.getDocuments(r.objectIds,{tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t){var e=n.controller.ctrl.options.parentObject;if(r.objectIds==e.objectIds){if(t.success){if(!Array.isArray(t.data))return;n.controller.addAttachmentsToUI(t.data)}n.controller.finishLoadingAttachments()}},onFailure:function(t){n.controller.finishLoadingAttachments(),t.error&&n.controller.showNotification("error",a.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error)}});else{var i={relInfo:{parentId:r.parentId,parentRelName:r.relationName||e.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t,o){var r=n.controller.ctrl.options.parentObject;if(o.relInfo.parentId==r.parentId&&o.relInfo.parentRelName==(r.relationName||e.SPECIFICATION_DOCUMENT)){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=i.relInfo.parentRelName}),n.controller.addAttachmentsToUI(t.data),n.controller.finishLoadingAttachments()}},onFailure:function(t){console.error(t),t.error&&n.controller.showNotification("error",a.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error),n.controller.finishLoadingAttachments()}};o.getDocumentsFromParent(i);var s={relInfo:{parentId:r.parentId,parentRelName:e.REL_PLMDOCCONNECTION,parentDirection:"from"},tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t,o){var r=n.controller.ctrl.options.parentObject;if(o.relInfo.parentId==r.parentId&&o.relInfo.parentRelName==e.REL_PLMDOCCONNECTION){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=e.REL_PLMDOCCONNECTION});for(var a=[],i=0;i<t.data.length;i++){var s=t.data[i];n.controller.PLMDMTDocumentTypes.includes(s.type)||a.push(t.data[i])}t.data=a,n.controller.addAttachmentsToUI(t.data),n.controller.finishLoadingAttachments()}},onFailure:function(t){console.error(t),t.error&&n.controller.showNotification("error",a.get("FAILED_TO_LOAD_SPECIFICATIONS"),t.error),n.controller.finishLoadingAttachments()}};o.getDocumentsFromParent(s)}},uploadAttachments:function(t,o,r){require(["DS/DocumentCreateNew/CreateNew","DS/Windows/ImmersiveFrame"],function(i,s){var l=new s;l.inject(widget.body),new i({tenantUrl:n.options.platformUrls["3DSpace"],securityContext:n.options.fetchSecurityContext(),tenant:n.options.platformUrls.platformId,immersiveFrame:l,parentObject:o,parentRelName:o.relationName||e.SPECIFICATION_DOCUMENT,connector:n,supportedTypes:r,credentialsPrefName:n.options.credentialsPrefName||e.PAD_CURRENT_SECURITY_CONTEXT,onUploadStart:function(){l.destroy()},onCancel:function(){l.destroy()},onError:function(t){n.controller.showNotification("error",a.get("UPLOAD_FAILED"),t.subtitle,t.message||""),l.destroy()}}).create(t)})},attachAttachments:function(i,s){if(i.length>0){for(var l=n.controller.attachments.getRoots(),c=0;c<l.length;c++){var d=l[c];if(i.includes(d.options.data.id)){n.controller.showNotification("error",a.get("TYPE_ATTACH_FAILED",{type:d.options.data.dataelements.typeNLS}),a.get("X_IS_ALREADY_ATTACHED",{title:d.options.data.dataelements.title||d.options.data.dataelements.secondaryTitle||d.options.data.dataelements.name}));var p=i.indexOf(d.options.data.id);p>-1&&i.splice(p,1)}}o.getDocuments(i,{tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(o){if(o.success)for(var i=0;i<o.data.length;i++){var l=o.data[i];o.data[i].relName=e.SPECIFICATION_DOCUMENT;var c=!0;if(s&&s.parentId&&l.id==s.parentId){n.controller.showNotification("error",a.get("TYPE_ATTACH_FAILED",{type:l.dataelements.typeNLS}),a.get("CANNOT_ATTACH_X_TO_ITSELF",{title:l.dataelements.title||l.dataelements.secondaryTitle||l.dataelements.name})),c=!1;break}if(c)if(!n.controller.options.supportedTypes.includedTypes.includes("*")&&!n.controller.options.supportedTypes.includedTypes.includes(l.type)||n.controller.options.supportedTypes.excludedTypes.includes(l.type))n.controller.showNotification("error",a.get("DOCUMENT_NOT_ALLOWED",{type:l.dataelements.typeNLS}),a.get("X_CANNOT_BE_ATTACHED",{type:l.type}));else if(s.noParent){var d={onFailure:function(e){console.error(e),t.is(e,"string")&&n.controller.showNotification("error",a.get("FAILED_TO_ATTACH_ATTACHMENT"),e)},onSuccess:function(t){n.controller.addAttachmentsToUI([t]),n.controller.showNotification("success",a.get("DOCUMENT_ATTACHED",{type:t.dataelements.typeNLS}),a.get("X_ATTACHED_SUCCESSFULLY",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}))}};n.controller.events.publish({event:"attach-document-requested",data:{document:l,parentObject:s,callback:d}})}else r(l,s)}},onFailure:function(e){if(e.error)if((e.error.match(/\n/g)||[]).length>2){for(var o=e.error.split("\n"),r=[],i=2;i<o.length;i++)r.push(o[i]);r=r.join("<br/>"),n.controller.showNotification("error",o[0],o[1],r,void 0,!0)}else n.controller.showNotification("error",a.get("DOCUMENT_ATTACH_FAILED"),e.error);else t.is(e,"string")?n.controller.showNotification("error",a.get("DOCUMENT_ATTACH_FAILED"),e):n.controller.showNotification("error",a.get("DOCUMENT_ATTACH_FAILED"))}})}},detachAttachments:function(t,e){if(e.noParent){var o={onSuccess:function(e){t.forEach(function(t){e.forEach(function(e){t.options.data.id==e&&(n.controller.attachments.removeRoot(t),n.controller.showNotification("success",a.get("DOCUMENT_DETACHED",{type:t.options.data.dataelements.typeNLS}),a.get("X_DETACHED_SUCCESSFULLY",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})))})})}};n.controller.events.publish({event:"detach-attachments-requested",data:{ids:n.controller.helper.restrict(t,"options.data.id"),parentObject:e,callback:o}})}else for(var r=0;r<t.length;r++){i(t[r],e)}},getUpdatedAttachment:function(r,i){o.getDocuments([r.id],{tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=r.relName||e.SPECIFICATION_DOCUMENT}),i(t.data)}},onFailure:function(e){e.error?n.controller.showNotification("error",a.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?n.controller.showNotification("error",a.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):n.controller.showNotification("error",a.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},getUpdatedAttachments:function(e,r,i){o.getDocuments(e.map(function(t){return t.id}),{tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;r(t.data)}},onFailure:function(e){t.is(i,"function")?i(e):e.error?n.controller.showNotification("error",a.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?n.controller.showNotification("error",a.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):n.controller.showNotification("error",a.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},ready:!1,uploadAttachment:function(e,r,i){if(n.ready){var s={customDocumentObject:e.custom_attributes?{dataelements:e.custom_attributes}:void 0,tenant:n.options.platformUrls.platformId,securityContext:i,tenantUrl:n.options.platformUrls["3DSpace"],additionalHeaders:t.is(n.options.getWorkUnderHeaders,"function")?n.options.getWorkUnderHeaders():{},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var o=t.error.split("\n"),i=[],s=2;s<o.length;s++)i.push(o[s]);i=i.join("<br/>"),n.controller.showNotification("error",o[0],o[1],i,void 0,!0)}else n.controller.showNotification("error",a.get("UPLOAD_FAILED"),t.error);else n.controller.showNotification("error",a.get("UPLOAD_FAILED"),t.error?t.error:a.get("X_UPLOAD_FAILED",{title:e.dataelements.title||e.dataelements.secondaryTitle||e.dataelements.name}));n.controller.events.publish({event:"upload-attachment-failure",data:{document:e,parentObject:r}}),n.controller.jobs.finishJob(l)},onProgress:function(t){n.controller.events.publish({event:"upload-attachment-progress",data:{document:e,parentObject:r}}),l.update(t)},onComplete:function(t){t.data&&(t.data[0].dataelements.isDocumentType="TRUE");var o=t.data;o.forEach(function(t){t.delayLoadThumbnails=!0,e.relInfo&&(t.relName=e.relInfo.parentRelName)});var i=function(t){n.controller.addAttachmentsToUI(t),1==t.length?n.controller.showNotification("success",a.get("DOCUMENT_ATTACHED",{type:t[0].dataelements.typeNLS}),a.get("X_ATTACHED_SUCCESSFULLY",{title:t[0].dataelements.title||t[0].dataelements.secondaryTitle||t[0].dataelements.name})):t.length>1&&n.controller.showNotification("success",a.get("DOCUMENTS_ATTACHED"),a.get("X_DOCUMENTS_ATTACHED_SUCCESSFULLY",{num:t.length}))},s={event:"upload-attachment-complete",data:{documents:o,parentObject:r}};r.noParent&&(s.data.callback=i),n.controller.events.publish(s),n.controller.jobs.finishJob(l),r.noParent||i(o)}},l={title:a.get("UPLOADING_X",{title:e.title}),ui:!0,process:function(){o.createDocument(e,s)}};n.controller.jobs.addJob(l)}}};function r(r,i){if(n.ready){var s={relInfo:{parentId:i.parentId,parentRelName:i.relationName||e.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalHeaders:t.is(n.options.getWorkUnderHeaders,"function")?n.options.getWorkUnderHeaders():{},onFailure:function(t){if(t.error)if((t.error.match(/\n/g)||[]).length>2){for(var e=t.error.split("\n"),o=[],s=2;s<e.length;s++)o.push(e[s]);o=o.join("<br/>"),n.controller.showNotification("error",e[0],e[1],o,void 0,!0)}else n.controller.showNotification("error",a.get("TYPE_ATTACH_FAILED",{type:r.dataelements.typeNLS}),t.error);else n.controller.showNotification("error",a.get("TYPE_ATTACH_FAILED",{type:r.dataelements.typeNLS}),a.get("X_ATTACH_FAILED",{title:r.dataelements.title||r.dataelements.secondaryTitle||r.dataelements.name}));n.controller.events.publish({event:"attach-attachment-failure",data:{document:r,parentObject:i}}),n.controller.jobs.finishJob(l)},onProgress:function(t){n.controller.events.publish({event:"attach-attachment-progress",data:{document:r,parentObject:i}}),l.update(t)},onComplete:function(t){n.controller.events.publish({event:"attach-attachment-complete",data:{document:r,parentObject:i}}),n.controller.jobs.finishJob(l),r.relName=s.relInfo.parentRelName,n.controller.addAttachmentsToUI([r]),n.controller.showNotification("success",a.get("DOCUMENT_ATTACHED",{type:r.dataelements.typeNLS}),a.get("X_ATTACHED_SUCCESSFULLY",{title:r.dataelements.title||r.dataelements.secondaryTitle||r.dataelements.name}))}},l={title:a.get("ATTACHING_X",{title:r.dataelements.title||r.dataelements.secondaryTitle||r.dataelements.name}),ui:!1,process:function(){o.connectDocumentToParent(r.id,s)}};n.controller.jobs.addJob(l)}}function i(r,i){if(n.ready){var s={relInfo:{parentId:i.parentId,parentRelName:r.options.data.relName||e.SPECIFICATION_DOCUMENT,parentDirection:"from"},tenant:n.options.platformUrls.platformId,securityContext:n.options.fetchSecurityContext(),tenantUrl:n.options.platformUrls["3DSpace"],additionalHeaders:t.is(n.options.getWorkUnderHeaders,"function")?n.options.getWorkUnderHeaders():{},onFailure:function(e){if(n.controller.events.publish({event:"detach-attachment-failure",data:{id:n.controller.helper.restrict(r,"options.data.id"),parentObject:i}}),n.controller.jobs.finishJob(l),e.error)if((e.error.match(/\n/g)||[]).length>2){for(var o=e.error.split("\n"),s=[],c=2;c<o.length;c++)s.push(o[c]);s=s.join("<br/>"),n.controller.showNotification("error",o[0],o[1],s,void 0,!0)}else n.controller.showNotification("error",a.get("FAILED_TO_DETACH_ATTACHMENT",{type:r.options.data.dataelements.typeNLS}),e.error);else t.is(e,"string")?n.controller.showNotification("error",a.get("FAILED_TO_DETACH_ATTACHMENT",{type:r.options.data.dataelements.typeNLS}),e):n.controller.showNotification("error",a.get("FAILED_TO_DETACH_ATTACHMENT",{type:r.options.data.dataelements.typeNLS}))},onProgress:function(t){n.controller.events.publish({event:"detach-attachment-progress",data:{id:n.controller.helper.restrict(r,"options.data.id"),parentObject:i}}),l.update(t)},onComplete:function(t){n.controller.jobs.finishJob(l),t.success&&n.controller.attachments.getRoots().forEach(function(e){t.data.forEach(function(t){e.options.data.id==t.id&&(n.controller.events.publish({event:"detach-attachment-complete",data:{id:n.controller.helper.restrict(e,"options.data.id"),parentObject:i}}),n.controller.attachments.removeRoot(e),n.controller.showNotification("success",a.get("DOCUMENT_DETACHED",{type:e.options.data.dataelements.typeNLS}),a.get("X_DETACHED_SUCCESSFULLY",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})))})})}},l={title:a.get("DETACHING_X",{title:r.options.data.dataelements.title||r.options.data.dataelements.secondaryTitle||r.options.data.dataelements.name}),ui:!1,process:function(){o.disconnectDocumentFromParent(r.options.data.id,s)}};n.controller.jobs.addJob(l)}}return n}}),define("DS/ENOXSpecificationsUX/SpecificationsPane",["UWA/Core","DS/ENOXAttachmentsUX/data/Controller","DS/ENOXSpecificationsUX/data/Connector3DSpace","DS/ENOXAttachmentsUX/views/Topbar","DS/ENOXAttachmentsUX/views/UploadPane","DS/ENOXAttachmentsUX/views/GridPane","DS/ENOXAttachmentsUX/views/TilePane","DS/ENOXAttachmentsUX/views/ProgressPane","text!DS/ENOXAttachmentsUX/assets/config.json","DS/ENOXAttachmentsUX/data/DnDManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/ENOXAttachmentsUX/utils/Overlay","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","css!DS/ENOXAttachmentsUX/ENOXAttachmentsUX.css"],function(t,e,o,n,r,a,i,s,l,c,d,p,m,f,h){"use strict";return(l=JSON.parse(l)).actionbar.forEach(function(t){t.text=f.get(t.nls),t.title=f.get(t.nls),t.content&&t.content.options&&t.content.options.items&&t.content.options.items.forEach(function(t){t.text=f.get(t.nls),t.description=f.get(t.nls)})}),l.headers.forEach(function(t){t.text=f.get(t.nls)}),l.contextMenu.forEach(function(t){t.text=f.get(t.nls),t.title=f.get(t.nls)}),t.Controls.Abstract.extend({name:"enox-attachments",options:{className:""},_options:{},modelEvents:void 0,init:function(e){this.modelEvents=e.events||new d,this.config=t.clone(l),this._parent(e),this._options=e,this.buildSkeleton()},buildSkeleton:function(){this.elements.container=t.createElement("div",{class:this.getClassNames()}),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.elements.content=t.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.options.attachmentsType="specifications",new e(this),new n(this),this.buildContentPanes(),new s(this),new c(this),this._options.delayInitialize?console.log("Waiting for initialize to be called"):this.initialize()},buildContentPanes:function(){this.elements.panes=t.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new r(this),new a(this),new i(this)},setParentObject:function(t){this.options.parentObject=t,this.finishLoading(),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.controller.clearAll(),this.controller.loadAttachments()},setConnectorOptions:function(e){t.merge(this.options.connectorOptions,e)},setSupportedTypes:function(e){t.merge(this.options.supportedTypes,e),t.merge(this.options.searchOptions,this.options.supportedTypes)},initialize:function(){this.controller.initialize(this,this._options.connector||new o)},attachSpecifications:function(t){this.controller.attachAttachments(t)},startLoading:function(){p.mask(this.elements.container)},finishLoading:function(){p.unmask(this.elements.container),m.unoverlay(this.elements.container)},showNoParentSelected:function(){m.overlay(this.elements.container,f.get("NOPARENTOBJECT"))},destroy:function(){this.controller.destroy(),this._parent()},onRemoved:function(){this.destroy()},setSelection:function(t){this.controller.attachments.processDescendants({processNode:function(e){t.includes(e.nodeModel.options.data.id)?e.nodeModel.select():e.nodeModel.unselect()},onlyVisibleNodes:!1})},getSelection:function(){return this.controller.helper.restrict(this.controller.attachments.getSelectedNodes(),"options.data.id")}})});