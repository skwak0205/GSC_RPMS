define("DS/ENOFilterBIUX/FBISettings",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Data","DS/WebappsUtils/WebappsUtils","text!DS/ENOFilterBIUX/assets/FBISettings.json"],function(e,t,i,r,n,s,o){"use strict";var a=function(e){return/(http|https):\/\//.test(e)};return t.singleton(i,r,{options:{fbi_settings:{}},loadComplete:!1,settings_loaded:[],onCompleteLoad:void 0,init:function(e){this.options=JSON.parse(o),this.debugMode=this.getDebugMode()},load:function(e){this.log("FBISettings load"),this.settings_loaded.indexOf(e.url)&&(this.onCompleteLoad=e.onComplete,this._loadSettings(e.url),this.settings_loaded.push(e.url))},urlSettings:function(e){for(var t in e.debug_me&&(this.options.FBI_settings.debug_mode=!0),!0===this.options.FBI_settings.debug_mode&&(this.debugMode=!0),this.log("updateSettings from the URL done"),e)if("debug_me"===t)this.log("Debug mode already taken into account");else{var i=e[t];void 0!==i&&"string"==typeof i.valueOf()&&i.length>0&&("false"==i.toLowerCase()?i=!1:"true"==i.toLowerCase()&&(i=!0)),this.options.FBI_settings[t]=i}},initialize:function(e){this.options=UWA.extend(this.options,e,!0),this.debugMode=this.getDebugMode()},setOption:function(e,t){this.options.fbi_settings[e]=t},serialize:function(){return JSON.stringify(this.options)},getDebugMode:function(){return!!(this.options&&this.options.fbi_settings&&this.options.fbi_settings.debug_mode)},getOption:function(e,t){return this.options?this.options.fbi_settings&&void 0!==this.options.fbi_settings[e]?this.options.fbi_settings[e]:this.options.NGF_settings&&void 0!==this.options.NGF_settings[e]?this.options.NGF_settings[e]:void 0!==this.options[e]?this.options[e]:void 0!==t?t:void 0:void 0},_loadSettings:function(t){var i=this,r={timeout:5e4,method:"GET",data:{},type:"json",headers:{Accept:"application/ds-json"},onComplete:function(e){i.log("FBISettings load settings onComplete");var t={};(t="string"==typeof e?JSON.parse(e):e).error?i.log("Bad format for FBISettings"):i.initialize(t),i.loadComplete=!0,"function"==typeof i.onCompleteLoad&&i.onCompleteLoad.call(void 0,null),i.log("Available FBI Settings:\n"+JSON.stringify(i.options))},onFailure:function(t){e.log("No settings found"),"function"==typeof i.onCompleteLoad&&i.onCompleteLoad.call(void 0,null)},onTimeout:function(e){i.log("No settings found timeout reach")}};try{if(!a(t)){var o="";o=s.getWebappsBaseUrl();o=o.replace(/\/$/,""),this.log("Base URL "+o),a(o)||(this.log("The base URL is not a valid one (webapp context?)"),o=""),t=o+t}this.log("Used URL "+t),n.request(t,r)}catch(e){this.log("Failure : "+e)}}})}),define("DS/ENOFilterBIUX/FilterBIProxyController",["UWA/Class","UWA/Core"],function(e,t){"use strict";var i=[],r=e.singleton({WIDGETS_PRIORITIES:[],init:function(e){r.WIDGETS_PRIORITIES.push(0)},add:function(e){i.push(e)},addPriority:function(e){for(var t=r.WIDGETS_PRIORITIES.length,i=0;i<t;i++)if(r.WIDGETS_PRIORITIES[i]!==e){r.WIDGETS_PRIORITIES.push(e);break}},minPriority:function(){return Math.min.apply(null,r.WIDGETS_PRIORITIES)},removePriority:function(e){for(var t=r.WIDGETS_PRIORITIES.length,i=0;i<t;i++)r.WIDGETS_PRIORITIES[i]===e&&delete r.WIDGETS_PRIORITIES[i]},remove:function(e){for(var t=i.length-1;t>=0;t--){var r=i[t];if(r.appId===e.appId&&r.widgetId===e.widgetId){i.splice(t,1);break}}1===i.length&&i[0].setProxyAsMaster()},synchronize:function(e,t,r){i.forEach(function(i){i.appId===e&&t(r)})}});return r}),define("DS/ENOFilterBIUX/ExpandV2FormatServices",["UWA/Core","UWA/Class","UWA/Class/Options"],function(e,t,i){"use strict";var r=t.singleton(i,{emptyFilterFormat:function(e){var t={filter:{}};t.filter.or={},t.filter.or.filters=[];var i={and:{}};return i.and.filters=[],t.filter.or.filters.push(i),t},isEmptyFilter:function(e){var t=this,i=!0,r=function(e){var i=t.getV2CombinationType(e),r=i?e[i].filters:[];return!r||!r.length},n=this.getV2CombinationType(e);if("and_not"===n)i=!1;else{var s=e[n].filters;if(s&&s.length)for(var o=s.length,a=0;a<o&&i;a++)i="and_not"!==(n=this.getV2CombinationType(s[a]))&&r(s[a])}return i},getCombinationType:function(e){var t;return e.union?t="union":e.intersection?t="intersection":e.minus&&(t="minus"),t},updateWithAppParams:function(e,t,i){var r=UWA.clone(t),n=i.staticMapping,s=this.getV2CombinationType(r.filter),o={};o="and_not"===s?r.filter[s].left.and:r.filter[s];for(var a=0;a<o.filters.length;a++){var l=this.getV2CombinationType(o.filters[a]),u=[];if(n&&u.push({static_mapping_filter:1}),i.prefixPathArray&&i.prefixPathArray.length&&u.push(this.prefixPathFormat(e,i.prefixPathArray)),i.inFrustumObj&&Object.keys(i.inFrustumObj).length&&u.push(this.appInFrustumFormat(i.inFrustumObj)),i.inParallelFrustumObj&&Object.keys(i.inParallelFrustumObj).length&&u.push(this.appInParallelFrustumFormat(i.inParallelFrustumObj)),i.appQueryStr&&u.push(this.appSequenceFormat(i.appQueryStr)),i.volumeObj&&Object.keys(i.volumeObj).length)for(var c=0;c<i.volumeObj.length;c++)i.volumeObj[c].box_filter?u.push(this.volumeBoxFilterFormat(i.volumeObj[c].box_filter)):i.volumeObj[c].sphere_filter?u.push(this.volumeSphereFilterFormat(i.volumeObj[c].sphere_filter)):i.volumeObj[c].assembly_shape_filter?u.push(this.volumeAssemblyShapeFilterFormat(i.volumeObj[c].assembly_shape_filter)):i.volumeObj[c].plane_section_filter?u.push(this.planeSectionFilterFormat(i.volumeObj[c].plane_section_filter)):console.log("*** UpdateFilterQueryV2WithAppParams, volumeObj unknown case:"+i.volumeObj[c]);if(i.find_in_context&&u.push(this.appSequenceFormat(i.find_in_context)),i.tagger_select&&u.push(this.taggerSelectFormat(i.tagger_select)),i.find_subpaths&&u.push(this.appSubPathsFormat(i.find_subpaths)),i.appQueryObj){if(console.warn("appQueryObj key usage has been deprecated since R2022xFD04 - cf FilterBIComponentProxy jsdoc"),"and_not"!==l){var d={and_not:{}};d.and_not.left={},d.and_not.left.and={},d.and_not.left.and=o.filters[a][l],d.and_not.right={},d.and_not.right.or={},d.and_not.right.or.filters=[],o.filters[a]=d,l="and_not"}i.appQueryObj.keep&&o.filters[a].and_not.right.or.filters.push(this.appSequenceNOTFormat(i.appQueryObj.keep)),i.appQueryObj.remove&&o.filters[a].and_not.right.or.filters.push(this.appSequenceFormat(i.appQueryObj.remove))}for(var h=0;h<u.length;h++)"and_not"===l?o.filters[a][l].left.and.filters.push(u[h]):o.filters[a].and.filters.push(u[h]);o.filters[a].and_not&&0===o.filters[a].and_not.left.and.filters.length&&o.filters[a].and_not.left.and.filters.push({all:1})}return 0===o.filters.length&&o.filters.push({all:1}),r},explicitPathsFormat:function(e){var t={prefix_filter:{}};t.prefix_filter.prefix_path=[];for(var i=0;i<e.length;i++)t.prefix_filter.prefix_path.push(e[i]);return t},sequenceFilterFormat:function(e){if(e&&e.length){for(var t=[],i=0;i<e.length;i++){var r=e[i],n={sequence_filter:{}};n.sequence_filter.sequence=[];for(var s=0;s<r.length;s++)n.sequence_filter.sequence.push({uql:r[s]});t.push(n)}return t}},configFormat:function(e){if(e){var t={};return t.config_filter=e,t}},volumeBoxFilterFormat:function(e){if(e&&Object.keys(e).length){var t={};return t.box_filter=e,t}},volumeSphereFilterFormat:function(e){if(e&&Object.keys(e).length){var t={};return t.sphere_filter=e,t}},volumeAssemblyShapeFilterFormat:function(e){if(e&&Object.keys(e).length){var t={assembly_shape_filter:{}};return e.assembly_shape_path?t.assembly_shape_filter=UWA.extend(e):(t.assembly_shape_filter.assembly_shape_path={},t.assembly_shape_filter.assembly_shape_path.physical_id_path=[],t.assembly_shape_filter.assembly_shape_path.physical_id_path=e.root_path_physicalid[0],t.assembly_shape_filter.distance=e.distance,t.assembly_shape_filter.intersection_mode=e.intersection_mode),t}},planeSectionFilterFormat:function(e){if(e&&Object.keys(e).length){var t={};return t.plane_section_filter=e,t}},volumeFormat:function(e){if(e&&Object.keys(e).length){var t=Object.keys(e),i={};i[t]={},i[t].filters=[];for(var r=Object.keys(e[t]),n=0;n<r.length;n++)"NGFVolumeBox"===r[n]?i[t].filters.push(this.volumeBoxFilterFormat(e[t][r[n]])):"NGFVolumeSphere"===r[n]?i[t].filters.push(this.volumeSphereFilterFormat(e[t][r[n]])):"NGFVolumeAssemblyShape"===r[n]?i[t].filters.push(this.volumeAssemblyShapeFilterFormat(e[t][r[n]])):console.log("*** volumeFormat, NGFVolumeObj unknown case:"+r[n]);return i}},getFilterCombinationFormat:function(e){var t="or";switch(e.toLowerCase()){case"union":t="or";break;case"intersection":t="and";break;case"minus":t="and_not";break;default:console.log("ExpandV2FormatServices.filterCombinationFormat, non supported format => OR by default",+CVData.combinationStr),t="or"}return t},getV2CombinationType:function(e){var t;return e.or?t="or":e.and?t="and":e.and_not?t="and_not":console.log(" RCIII getV2CombinationTYpe : unknown combination"),t},filterLeftRightFormat:function(e){if(e.needsRemove){var t={and_not:{}};return t.and_not.left={},t.and_not.right={},t}},prefixPathFormat:function(e,t){var i={};return t&&t.length>0?i=this.explicitPathsFormat(t):(i.prefix_filter={},i.prefix_filter.prefix_path=[],i.prefix_filter.prefix_path.push({physical_id_path:[e]})),i},selectionOutputs:function(e){e&&e.outputs?function(e){e.outputs.matching_lengths=1,e.outputs.format="entity_relation_occurrence"}(e):function(e){e.outputs={matching_lengths:1,format:"entity_relation_occurrence"}}(e)},selectionAggrProcessors:function(e,t){var i=r.taggerSelectFormat(selectedIds).and.filters[0];t.aggregation_processors&&t.aggregation_processors[0].truncate?(t.aggregation_processors[0].truncate.compute_matching_subpaths_lengths=1,t.aggregation_processors[0].truncate.sequence_filter=i):t.aggregation_processors.push({truncate:{max_distance_from_prefix:1,sequence_filter:i}})},subPathAggrProcessors:function(e,t){var i=r.appSubPathsFormat(e).or.filters[0];t.aggregation_processors&&t.aggregation_processors[0].truncate?t.aggregation_processors[0].truncate.sequence_filter=i:t.aggregation_processors.push({truncate:{sequence_filter:i}})},groupingAggrProcessorsFormat:function(e,t,i,r,n){var s="Other"===r,o=[],a=function(e){var t={truncate:{}};return t.truncate.max_distance_from_prefix=1,t.truncate.prefix_filter={prefix_path:[{physical_id_path:[e]}]},t},l=function(e,i){var r={synthesis:{}};return s||(r.synthesis.group_by_facet=1),r.synthesis.mode="tree_leaf",r.synthesis.name=t,i&&(r.synthesis.synthesis_only=1),r},u=function(e,t){var i={synthesis:{}};return s||(i.synthesis.group_by_facet=1),i.synthesis.mode="tree_leaf_instance",i.synthesis.name=e,t&&(i.synthesis.synthesis_only=1),i};return"Inst"===r&&(o.push(a(e)),n&&o.push(u(t,!0))),"Ref"===r&&(o.push(a(e)),n&&o.push(l(0,!0))),"Other"===r&&(o.push(a(e)),n&&(o.push(l()),o.push(u(t,!1)))),o},_internalInstSeq:function(e,t){var i={sequence_filter:{}};return i.sequence_filter.sequence=[],i.sequence_filter.sequence.push({uql:"physicalid:"+e}),i.sequence_filter.sequence.push({statement:"NEXT"}),i.sequence_filter.sequence.push({uql:"(mxobjecttype:(RELATIONSHIP) AND "+t+")"}),i},_internalRefSeq:function(e,t){var i={sequence_filter:{}};return i.sequence_filter.sequence=[],i.sequence_filter.sequence.push({uql:"physicalid:"+e}),i.sequence_filter.sequence.push({statement:"NEXT"}),i.sequence_filter.sequence.push({uql:"(mxobjecttype:(RELATIONSHIP) AND NOT( "+t+"))"}),i.sequence_filter.sequence.push({statement:"NEXT"}),i.sequence_filter.sequence.push({uql:"(mxobjecttype:(BUSINESSOBJECT) AND "+t+")"}),i},_internalComputeGroupingTags:function(e,t){for(var i=e.predicate,n=[],s=0;s<e.object.length;s++){var o=e.object[s];if(n.push(r._internalManageSpecialTags(o,t)),e.object[s].merged&&e.object[s].merged.length)for(var a=0;a<e.object[s].merged.length;a++){var l=e.object[s].merged[a].object;n.push(l)}}for(var u="(",c=0;c<n.length;c++)u+="["+i+"]:("+n[c]+")",u+=c<n.length-1?" OR ":"";return u+=")"},_escapeCharIfNeeded:function(e){return["(",")","{","}","?","*","=",":","<",">","\\"].forEach(t=>{0<=e.indexOf(t)&&(e=e.replaceAll(t,"\\"+t))}),e},tagGroupingFormat:function(e,t,i,r){var n={};return"Inst"===r&&(n.filters=[],n.filters.push(this._internalInstSeq(e,t))),"Ref"===r&&(n.filters=[],n.filters.push(this._internalRefSeq(e,t))),"Other"===r&&(n.left={all:1},n.right={},n.right.or={},n.right.or.filters=[],n.right.or.filters.push(this._internalRefSeq(e,t)),n.right.or.filters.push(this._internalInstSeq(e,t))),n},cleanPredicateFromLineage:function(e){var t=e.split("/");return t.length>1?t[t.length-1]:e},_internalManageSpecialTags:function(e,t){var i=[],n=e.object,s=[],o=function(e){return e=e.replaceAll("/","_47_"),r._escapeCharIfNeeded(e)};if(Array.isArray(n)){var a=[];n.forEach(e=>{Array.isArray(e)?e.length>1?console.log("******** _internalManageSpecialTags - invalid hierarchical tag format"):e.forEach(e=>{a.push(o(e))}):a.push(o(e))}),s=function(e){if(Array.isArray(e))return e.join("/")}(a),t||(s+="*")}else s=o(n);return i.push(s),i},taggerSelectFormat:function(e){var t={sequence_filter:{}};t.sequence_filter.sequence=[];var i="";for(var n in e){for(var s=this.cleanPredicateFromLineage(n),o="(",a=0;a<e[n].length;a++){o+="["+s+"]:("+r._internalManageSpecialTags(e[n][a])+")",o+=a<e[n].length-1?" OR ":""}o+=")",i.length&&(i+=" AND "),i+=o}return t.sequence_filter.sequence.push({uql:i}),t},appSequenceFormat:function(e){if(e){var t={sequence_filter:{}};return t.sequence_filter.sequence=[],t.sequence_filter.sequence.push({uql:e,uql_prefix_handler:"starPH"}),t}},appSequenceNOTFormat:function(e){if(e){var t={sequence_filter:{}};return t.sequence_filter.sequence=[],t.sequence_filter.sequence.push({uql:"NOT ("+e+")"}),t}},appSubPathsFormat:function(e){var t={or:{}};return t.or.filters=[],e.forEach(function(e){var i={sequence_filter:{}};i.sequence_filter.sequence=[],e.forEach(function(e){i.sequence_filter.sequence.push({uql:"physicalid:"+e}),i.sequence_filter.sequence.push({statement:"NEXT"})}),i.sequence_filter.sequence.splice(i.sequence_filter.sequence.length-1),t.or.filters.push(i)}),t},appInFrustumFormat:function(e){if(e&&Object.keys(e).length){var t={};return t.in_frustum=e,t}},appInParallelFrustumFormat:function(e){if(e&&Object.keys(e).length){var t={};return t.in_parallel_frustum=e,t}},fromNGFV1ToV2:function(e,t,i){if(t){var r=this._getCombinationTypeFromV1ToV2(t),n=this._getQueryExpandTypeFromV1ToV2(t[r]),s=t[r][n],o=this.getFilterCombinationFormat(r),a={filter:{}},l=0;"and_not"===o?(l=1,a.filter.and_not={},a.filter.and_not.left={},a.filter.and_not.right={}):a.filter[o]={};for(var u=[],c=0;c<s.length;c++){var d=0,h=[],p=[];if(s[c].sequence_filter&&s[c].sequence_filter.length)for(var f=s[c].sequence_filter,g=0;g<f.length;g++){for(var _=f[g].definition,I=[],F=[],y=0;y<_.length;y++)_[y]["q.query"]&&(_[y].type_filter_bo?"seq_remove"===f[g].option[0]?(F.push("([ds6w:type]:"+_[y].type_filter_bo+" AND "+_[y]["q.query"]+")"),d=1):I.push("([ds6w:type]:"+_[y].type_filter_bo+" AND "+_[y]["q.query"]+")"):"seq_remove"===f[g].option[0]?(F.push(_[y]["q.query"]),d=1):I.push(_[y]["q.query"]));I&&I.length&&h.push(I),F&&F.length&&p.push(F)}var m=[];if(s[c].root_path_physicalid&&s[c].root_path_physicalid.length>0)for(var v=0;v<s[c].root_path_physicalid.length;v++)s[c].root_path_physicalid[v].length>1&&m.push({physical_id_path:s[c].root_path_physicalid[v]});var b=[];if(s[c].find_path_filter&&s[c].find_path_filter.length){for(var S=0;S<s[c].find_path_filter.length;S++)for(var x=0;x<s[c].find_path_filter[S].path_physicalid.length;x++)b.push({physical_id_path:s[c].find_path_filter[S].path_physicalid[x]});d=1}var D={};s[c].config_filter&&(D=s[c].config_filter);var C={};s[c].volume_filter&&(C=s[c].volume_filter);var N={};d?(N.and_not={},N.and_not.left={},N.and_not.left.and={},N.and_not.left.and.filters=[],N.and_not.right={},N.and_not.right.or={},N.and_not.right.or.filters=[]):(N.and={},N.and.filters=[]),h&&h.length&&(N.and_not&&N.and_not.left?N.and_not.left.and.filters=this.sequenceFilterFormat(h):N.and.filters=this.sequenceFilterFormat(h)),p&&p.length&&(N.and_not.right.or.filters=this.sequenceFilterFormat(p)),m&&m.length&&(N.and_not&&N.and_not.left?N.and_not.left.and.filters.push(this.explicitPathsFormat(m)):N.and.filters.push(this.explicitPathsFormat(m))),b&&b.length&&N.and_not&&N.and_not.right&&N.and_not.right.or.filters.push(this.explicitPathsFormat(b)),D&&Object.keys(D).length&&(N.and_not&&N.and_not.left?N.and_not.left.and.filters.push(this.configFormat(D)):N.and.filters.push(this.configFormat(D))),C&&Object.keys(C).length&&(N.and_not&&N.and_not.left?N.and_not.left.and.filters.push(this._volumeFormatFromV1ToV2(C)):N.and.filters.push(this._volumeFormatFromV1ToV2(C))),u.push(N)}if(u.length)if(l)a.filter.and_not.left.and={},a.filter.and_not.left.and.filters=[],a.filter.and_not.left.and.filters.push(u[0]),a.filter.and_not.right.or={},a.filter.and_not.right.or.filters=[],a.filter.and_not.right.or.filters.push(u[1]);else{a.filter[o]={},a.filter[o].filters=[];for(v=0;v<u.length;v++)a.filter[o].filters.push(u[v])}return a}console.log("fromNGFV1ToV2: !CVQuery as input")},_getCombinationTypeFromV1ToV2:function(e){var t;return e.union?t="union":e.intersection?t="intersection":e.minus&&(t="minus"),t},_getQueryExpandTypeFromV1ToV2:function(e){var t;return e.expand?t="expand":e.expand3d&&(t="expand3d"),t},_volumeFormatFromV1ToV2:function(e){if(e&&Object.keys(e).length){var t=Object.keys(e),i={};i[t]={},i[t].filters=[];for(var r=e[t],n=r.length,s=0;s<n;s++){var o=r[s];if(o.box)i[t].filters.push(this.volumeBoxFilterFormat(o.box));else if(o.sphere)i[t].filters.push(this.volumeSphereFilterFormat(o.sphere));else if(o.assemblyshape)i[t].filters.push(this.volumeAssemblyShapeFilterFormat(o.assemblyshape));else if(o.and||o.or){var a=this._volumeFormatFromV1ToV2(o);i[t].filters.push(a)}else console.log("*** volumeFormat, NGFVolumeObj unknown case:"+keys[s])}return i}}});return r}),Number.isInteger=Number.isInteger||function(e){"use strict";return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},define("DS/ENOFilterBIUX/FBIServices",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Promise","UWA/Date","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOFilterBIUX/FBISettings","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/UWPClientCode/I18n","DS/PlatformAPI/PlatformAPI"],function(e,t,i,r,n,s,o,a,l,u,c){"use strict";var d=t.singleton(i,{DEFAULT_LANG:"en",_nodes:[],_groupedData:{},_tree:[],_expandSynthesisURL:null,_tenantId:null,init:function(){this.setOption("fromWebInWin",0)},_setTree:function(e){this._tree=e},_setNodes:function(e){this._nodes=e},cleanAll:function(){this._groupedData={},this._tree=[],this._nodes=[]},getPlatformServices:function(e){var t=this;return this.getOption("fromWebInWin")?new r(function(i,r){for(var n=t.getOption("str_platformServices"),s=0;s<n.length;s++)if(e===n[s].platformId){t._tenantId=e;break}t.setMyAppsUrl(),i()}):new r(function(i,r){t._tenantId!==e?o.getPlatformServices({onComplete:function(r){t.setOption("str_platformServices",r);for(var n=0;n<r.length;n++)e===r[n].platformId&&(t._tenantId=e,i())},onFailure:function(e){r(e)}}):i()})},getFetchV2Url:function(e,t){if(Array.isArray(d.getOption("str_platformServices")))return this.getPlatformServiceUrl(e||this._tenantId,t)+"/cvservlet/fetch/v2";throw new Error("Platform services not initialize yet")},getPlatformServiceUrl:function(e,t){var i=this._getPlatformUrlAccordingToTenant(e);return i?i[t||"3DSpace"]:i},_getPlatformUrlAccordingToTenant:function(e){for(var t,i=e||this._tenantId,r=this.getOption("str_platformServices"),n=0;n<r.length;n++)if(i===r[n].platformId){t=r[n];break}return t},getUserID:function(){var e;if(this.getOption("fromWebInWin")){var t=this.getOption("str_platformServices");e=t&&t.length&&t[0].userID?t[0].userID:""}else{var i=c.getUser();e=i&&i.login?i.login:""}return e},getMyAppsUrl:function(){return this.getOption("myappsurl")?this.getOption("myappsurl"):(console.warn("myappsurl value empty"),"")},setMyAppsUrl:function(){var e=this;this.getOption("myappsurl")||window&&window.dscef&&window.dscef.getMyAppsURL&&window.dscef.getMyAppsURL().then(function(t){e.setOption("myappsurl",t)})},getRESTHeaders:function(){return{Accept:"application/json","Content-Type":"application/json","Accept-Language":d.getLanguage().toLowerCase()}},getPlatformId:function(){return this._getPlatformUrlAccordingToTenant().platformId},fetch:function(e,t,i,n){this._setTree(i),this._setNodes(t);var s=this,o=this._buildArrayPid(),a=o.length/1e3,l=Number.isInteger(a)?a:parseInt(a)+1,u=[];return new r(function(e,t){d.getPlatformServices(s._tenantId).then(function(){for(var t=[],i=0;i<l;i++){u.push(s._executeFetch(o,t,[],1e3*i,1e3,n))}return r.all(u).then(function(t){var i=null;if(t.length){for(var r={results:[]},n=0;n<t.length;n++)if(t[n].results)for(var o=0;o<t[n].results.length;o++)r.results.push(t[n].results[o]);i=s._parse(r)}else i=s._parse(t[0]);e(i)})})})},fetchWithSynthesis:function(e,t){var i=this;return new r(function(r,n){i.getPlatformServices(i._tenantId).then(function(){i._executeFetchWithSynthesis(e,0,t).then(function(e){r(e)},function(e){console.log(e),n([])})})})},refineFetchWithoutSynthesis:function(e,t,i){var n=this;return new r(function(r,o){n.getPlatformServices(n._tenantId).then(function(){s.authenticatedRequest(n.getFetchV2Url(n._tenantId,i),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_refineFetchWithoutSynthesis",physicalid:e,tenant:n._tenantId,with_synthesis:!1,refine:t||{},start:0,select_file:[],local:d.getLanguage().toLowerCase(),select_predicate:[]}),onComplete:function(e){r(e)},onFailure:function(e){o(e)}})})})},launchOrRefineFetchWithPredicates:function(e,t,i,n){Array.isArray(i)||(i=[i]);var o=this;return new r(function(r,a){o.getPlatformServices(o._tenantId).then(function(){s.authenticatedRequest(o.getFetchV2Url(o._tenantId,n),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_launchOrRefineFetchWithPredicates",physicalid:t,tenant:o._tenantId,with_synthesis:!1,refine:e||{},start:0,select_file:[],local:d.getLanguage().toLowerCase(),select_predicate:i||[]}),onComplete:function(e){r(e)},onFailure:function(e){console.log(e),a(e)}})})})},_buildArrayPid:function(){for(var e=this._nodes,t=e.length,i=[],r=0;r<t;r++)i[r]=e[r];return i},_parse:function(t){for(var i=t.results,r={},n=[],s=[],o={},a=0;a<i.length;a++)for(var l=i[a].attributes,u=this._getIdPathsForID(l[0].value),c=1;c<l.length;c++)if("internal"!==l[c].format){r[l[c].name]||(r[l[c].name]={}),"attribute"===l[c].format&&(o[l[c].name]||(o[l[c].name]=!0,s.push({sixw:l[c].name,type:l[c].type.toLowerCase()}))),"date"===l[c].type&&(l[c].value=l[c].value.split("-").join("/").substr(0,10)),r[l[c].name][l[c].value]||(r[l[c].name][l[c].value]={},r[l[c].name][l[c].value].format=l[c].format,r[l[c].name][l[c].value].type=l[c].type,r[l[c].name][l[c].value].dispValue=l[c].dispValue||l[c].value,r[l[c].name][l[c].value].value=l[c].value||l[c].dispValue);for(var d=0;d<u.length;d++)r[l[c].name][l[c].value][u[d].id]={pathID:u[d].id,path:u[d].path}}for(var h in r)if(r.hasOwnProperty(h))for(var p in r[h])r[h].hasOwnProperty(p)&&"ds6w_facet"===r[h][p].format&&n.push({object:r[h][p].value,sixw:h,count:this._getObjectSize(r[h][p]),type:r[h][p].type,dispValue:r[h][p].dispValue});return e.extend(this._groupedData,r,!0),{response:t,grouped:r,summary:n,suggested:s,unfilteredStructure:this._groupedData}},_getObjectSize:function(e){var t,i=0;for(t in e)e.hasOwnProperty(t)&&"string"!=typeof e[t]&&-1===t.lastIndexOf("dispValue")&&-1===t.lastIndexOf("value")&&i++;return i},findColoredPaths:function(t,i){var r={},n={};if("date"===i.type)for(var s in n=t[i.predicate])n.hasOwnProperty(s)&&-1!==s.indexOf(i.object)&&e.merge(r,n[s]);else r=Array.isArray(i.object)?t[i.predicate][this._buildValueForHierarchicalTags(i.object)]:t[i.predicate][i.object];return r},_buildValueForHierarchicalTags:function(e){var t=!1,i=e[e.length-1];if(e.length>1&&i.contains("/")){var r;t=!0;for(var n=0;n<e.length-2;n++)r=e[n].concat(","+e[n+1]);r&&(i=r+","+i),i=i.replace(/\//g,",")}return t?i:e},_getIdPathsForID:function(e){var t=this;return this._tree.filter(function(i){var r=i.path;return e===t._nodes[r[r.length-1]]})},_getIdPaths:function(e,t,i){return e.filter(function(e){var r=e.path;return i===t[r[r.length-1]]})},convertFromIndexToPID:function(e,t){for(var i=[],r="",n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)r+=e[t[n][s]],s<t[n].length-1&&(r+="-");var o=!1;if(i.lastIndexOf(r)>-1){for(var a=i.length-1;a>=0;a--)if(i[a].lastIndexOf(r+"_")>-1){r+="_"+(parseInt(i[a].substring(i[a].lastIndexOf("_")+1))+1),o=!0;break}!1===o&&(r+="_1")}i.push(r),r=""}return i},convertFromPIDToIndexAsync:function(e,t,i,r){var n=[],s=[],o=[];!function(e,t,r,s,o){o=o||window,s=s||100;var a=0;!function l(){for(var u=s;u--&&a<e.length;)t.call(o,e[a],a,e),++a;a<e.length?setTimeout(l,1):r.call(i,n)}()}(t,function(t){if(t.lastIndexOf("-")>-1){s=t.split("-");for(var i=0;i<s.length;i++)s[i].lastIndexOf("_")>-1&&(s[i]=s[i].substr(0,s[i].indexOf("_"))),o.push(e.indexOf(s[i]));s=[]}else o.push(e.indexOf(t));n.push(o),o=[]},r,25,this)},convertFromPIDToIndex:function(e,t){for(var i=[],r=[],n=[],s=0;s<t.length;s++){if(t[s].lastIndexOf("-")>-1){r=t[s].split("-");for(var o=0;o<r.length;o++)r[o].lastIndexOf("_")>-1&&(r[o]=r[o].substr(0,r[o].indexOf("_"))),n.push(e.indexOf(r[o]));r=[]}else n.push(e.indexOf(t[s]));i.push(n),n=[]}return i},splitListOfPID:function(e){var t=[];if(e.lastIndexOf("-")>-1){t=e.split("-");for(var i=0;i<t.length;i++)t[i].lastIndexOf("_")>-1&&(t[i]=t[i].substr(0,t[i].indexOf("_")))}else e.lastIndexOf("_")>-1&&(e=e.substr(0,e.indexOf("_"))),t.push(e);return t},getLanguage:function(){return"undefined"!=typeof widget?widget.lang:u.getCurrentLanguage()},getNlsInfosForFacets:function(e){for(var t=this,i=UWA.clone(e),n={},s=0;s<i.length;s++){var o=i[s];if(o.sixw)if(Array.isArray(o.object)&&o.object.length)i[s].dispValue=o.object.join("/");else{var a=o.sixw.split("/"),u=a.length-1;n[a[u]]||(n[a[u]]=[]),n[a[u]].push(o.object)}else if("ds6w_facet"===o.format){if(Array.isArray(o.value)&&o.value.length&&Array.isArray(o.value[0]))i[s].dispValue=o.value[0].join("/");else{var c=o.name.split("/"),h=c.length-1;n[c[h]]||(n[c[h]]=[]),n[c[h]].push(o.value)}}}if(this.getOption("fromWebInWin")){var p={myAppsBaseUrl:d.getMyAppsUrl(),userId:d.getUserID(),lang:d.getLanguage()};l.setConfigForMyApps(p)}return new r(function(e,r){t.getNlsOfPropertiesValues(n).then(function(t){for(var r in t)if(t.hasOwnProperty(r))for(var n=t[r],s=0;s<i.length;s++){var o=i[s].sixw||i[s].name;if(void 0!==o){var a=o.lastIndexOf("/");if(-1!==o.indexOf(r,a)){var l=i[s].object||i[s].value;i[s].dispValue=n[l]||l}}else console.log(" getNlsInfosForFacets **** bad synthesis format")}e(i)},function(t){console.log("getNlsInfosForFacets / Retrieve Nls failed !, error = "+t),i.forEach(function(e){e.dispValue=e.dispValue||e.object||e.value}),e(i)})})},_executeFetch:function(e,t,i,n,o,a){var l=this;return new r(function(r,u){s.authenticatedRequest(l.getFetchV2Url(l._tenantId,a),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetch",physicalid:e,tenant:l._tenantId,with_synthesis_attribute:!0,nresults:o||1e3,start:n||0,select_file:t||[],local:d.getLanguage().toLowerCase(),select_predicate:i||[]}),onComplete:function(e){e.results;if(e.results){for(var t=[],i=0;i<e.results.length;i++)for(var n=0;n<e.results[i].attributes.length;n++)t.push(e.results[i].attributes[n]);d.getNlsInfosForFacets(t).then(function(t){for(var i=0;i<e.results.length;i++)for(var n=0;n<e.results[i].attributes.length;n++)for(var s=0;s<t.length;s++)e.results[i].attributes[n].name===t[s].name&&e.results[i].attributes[n].value===t[s].value&&(e.results[i].attributes[n].dispValue=t[s].dispValue);r(e)})}else r([])},onFailure:function(e){u(e)}})})},arePredicatesExcludedFromSynthesis:function(){return a.getOption("ExcludePredicatesFromSynthesis")?1:0},_executeFetchWithSynthesis:function(e,t,i){var n=this;return new r(function(r,o){d.arePredicatesExcludedFromSynthesis();s.authenticatedRequest(n.getFetchV2Url(n._tenantId,i),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({label:"NGF_ExecuteFetchWithSynthesis",physicalid:e,tenant:n._tenantId,with_synthesis:!0,nresults:1,start:t||0,select_file:[],local:d.getLanguage().toLowerCase(),select_predicate:[]}),onComplete:function(e){var t=e.facets||[];d.getNlsInfosForFacets(t).then(function(e){r(e)})},onFailure:function(e){console.log(e),o(e)}})})},getInfosFromIds:function(e,t){var i=this;return new r(function(r,n){var s=[],o=["ds6w:label","ds6wg:revision"],a={};a[o[0]]="",a[o[1]]="",i.getPredicatesInfosFromIds(e,o,t).then(function(e){for(var t=e.length,i=0;i<t;i++){var n={};n.id=e[i].id,n.thumbnail=e[i].thumbnail,n.icon=e[i].icon;for(var l=0;l<o.length;l++)for(var u=0;u<e[i].predicates.length;u++){var c=e[i].predicates[u];if(c.name.endsWith(o[l])){a[o[l]]=c.value;break}}n.label=a[o[0]],n.revision=a[o[1]],s.push(n)}r(s)})})},getPredicatesInfosFromIds:function(e,t,i){var n=this,s=[],o=[];return"boolean"==typeof i&&!0===i&&(s=["icon","thumbnail_2d"],o=["preview_url","type_icon_url"]),new r(function(i,a){n.getPlatformServices(n._tenantId).then(function(){var l=function(e,t,i,a,l){return new r(function(r,u){n._executeFetch(e,s,t,i,a,l).then(function(e){for(var i=o.concat(t),n=i.length,s=[],a=e.results?e.results.length:0,l=0;l<a;l++){for(var u=e.results[l].attributes,c=u.length,d={},h=[],p=0;p<c;p++){var f=u[p];if("resourceid"===f.name)d.id=f.value;else if("preview_url"===f.name)d.thumbnail=f.value;else if("type_icon_url"===f.name)d.icon=f.value;else for(var g=0;g<n;g++){f.name;if(f.name.endsWith(i[g])){h.push(f);break}}}d.id&&(d.predicates=h,s.push(d))}r(s)},function(e){console.log(e),u([])})})},u={};n.getRootsInfos(e).forEach(e=>{var t=e.serviceId;u[t]||(u[t]=[]),u[t].push(e.rootId)});var c=[];for(var d in u){var h=u[d].length;c.push(l(u[d],t,0,h,d))}return r.all(c).then(function(e){var t=[];e.forEach(e=>{t=t.concat(e)}),i(t)},function(e){console.log(e),a([])})})})},getCVQueryBuildMode:function(){if(void 0===this._cvQueryBuildMode){var e=a.getOption("BuildCVQueryMode");this._cvQueryBuildMode=1===e?1:0}return this._cvQueryBuildMode},getProgressiveExpandItemTemplate:function(e,t,i){var r={label:"",root:{}};r.root.physical_id=e;var n=a.getOption("ProgressiveExpandLimitMaxPath");return n&&-1!==n&&(r.parameters={},r.parameters.limit_max_path=n),r.filter=t||{},r.aggregation_processors=i||[],r},getProgressiveQueryTemplate:function(e,t,i){var r={batch:{}};if(r.batch.expands=[],e&&t){var n=this.getProgressiveExpandItemTemplate(e,t,i);r.batch.expands.push(n)}return r.outputs={},r},getNlsOfPropertiesValues:function(e){return new r(function(t,i){l.getNlsOfPropertiesValues(JSON.stringify(e),{tenantId:d.getPlatformId(),lang:d.getLanguage(),onComplete:function(e){t(e)},onFailure:function(e){console.log("getNlsInfosForFacets / Retrieve Nls failed !, error = "+e),i(e)}})})},getRootsInfos:function(e){var t=[];return(e=Array.isArray(e)?e:[e]).forEach(e=>{t.push({rootId:e.rootId||e,rootAlias:e.rootAlias,serviceId:e.serviceId||"3DSpace"})}),t}});return d}),Number.isInteger=Number.isInteger||function(e){"use strict";return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},define("DS/ENOFilterBIUX/NGFServices",["UWA/Core","UWA/Class","UWA/Date","UWA/Class/Options","UWA/Class/Promise","DS/WAFData/WAFData","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX","text!DS/ENOFilterBIUX/assets/FilterTrackerMetrics.json","DS/PADServices/utils/PADTrackerManager","DS/ENOFilterBIUX/ExpandV2FormatServices"],function(e,t,i,r,n,s,o,a,l,u,c,d,h){"use strict";var p=t.singleton(r,{CVQUERY_VERSIONS:["420.6.1"],EXPAND_SERVICES:{none:0,progressive:1,expand:2,expand3d:4},init:function(){var e;try{e=decodeURIComponent(window.location.href)}catch(t){console.log("==> NGFServices / Decode URL failes, error ="+t.message),e="Unknown"}var t=e.indexOf("NGFDebug=all");this._debug={},this._debug.elapsedTime=-1===e.indexOf("NGFDebugElapsedTime=1")?0:1,this._debug.ngf=-1===e.indexOf("NGFDebug=1")&&-1===t?0:1,this._debug.extendedCmds=-1===e.indexOf("NGFDebugCmds=1")&&-1===t?0:1,this._debug.extension=-1===e.indexOf("NGFDebugExtension=1")&&-1===t?0:1,this._debug.config=-1===e.indexOf("NGFDebugConfig=1")&&-1===t?0:1,this._isActivated={},this._isActivated.timeInDate=-1===e.indexOf("NGFTimeInDate=1")?0:1;var i=1===a.getOption("EasyAttributeOn")?1:0;this._isActivated.easyAttribute=i||(-1===e.indexOf("NGFDebugEasyAttribute=1")&&-1===t?0:1),this._isActivated.newSelectionRead=-1===e.indexOf("NGFSelectionRead=1")?0:1},_getURL:function(e,t,i){if(Array.isArray(o.getOption("str_platformServices"))){var r=e||this.getTenant();return o.getPlatformServiceUrl(r,t)+i}throw new Error("Platform services not initialize yet")},getGetEcoSystemUrl:function(e,t){return this._getURL(e,t,"/resources/enorelnav/navigate/getecosystem?tenant="+(e||this.getTenant()))},getFederateSearchUrl:function(e){return this._getURL(e,"3DSearch","/search")},getProgressiveExpandUrl:function(e,t){return this._getURL(e,t,"/cvservlet/progressiveexpand/v2?output_format=cvjson")},getGetFilterQueryUrl:function(e,t){return this._getURL(e,t,"/resources/FilterBIAPI/Filter/getFilterQuery")},getGetFiltersFromIdsUrl:function(e,t){return this._getURL(e,t,"/resources/FilterBIAPI/Filter/getFiltersFromIds")},getGetFilterFromIdUrl:function(e,t){return this._getURL(e,t,"/resources/FilterBIAPI/Filter/getFilterFromId")},getExpandSynthesisUrl:function(e,t){return this._getURL(e,t,"/cvservlet/multiexpand")},getBasicsInDBFromIdsUrl:function(e,t){return this._getURL(e,t,"/resources/FilterBIAPI/Filter/getBasicsInDBFromIds?tenant="+(e||this.getTenant()))},getAllDataFromFilterIds:function(e,t){var i=this;return e=Array.isArray(e)?e:[e],new n(function(r,n){void 0===e?(console.log(" ***ERROR NGF getAllDataFromFilterIds, invalidFilterId"),n({msg:u.get("invalidFilterId"),eventID:"warning"})):s.authenticatedRequest(i.getGetFiltersFromIdsUrl(t),{headers:o.getRESTHeaders(),method:"POST",data:JSON.stringify(e),type:"json",proxy:"passport",timeout:"60000",onComplete:function(e){var t={},n={},s=[];if(e.success){t.success=[],n.success=[];for(var o=0;o<e.success.length;o++){for(var a=Object.keys(e.success[o]),l=0;l<a.length;l++)t.success[a[l]]||(t.success[a[l]]=[]),e.success[o][a[l]].filterPhysicalId=a[l],t.success[a[l]].push(e.success[o][a[l]]),s[l]=t.success[a[l]][l];n.success.push(s[o])}}else r(i.manageNlsDroppedErrorMessages(e));r(n)},onFailure:function(e){r(i.manageNlsDroppedErrorMessages(e))}})})},getFilterDataFromFilterId:function(e,t){return e=Array.isArray(e)?e:[e],new n(function(i,r){p.getAllDataFromFilterIds(e,t).then(function(e){e.success&&i(e),e.failure&&i(e)},function(e){r(e)})})},manageNlsDroppedErrorMessages:function(e){if(e.failure)for(var t=0;t<e.failure.length;t++)e.failure[t].filterName?e.failure[t].msg=e.failure[t].filterName+" : "+u.get(e.failure[t].msg):e.failure[t].msg=u.get(e.failure[t].msg);return e},filteredExpandWithSynthesis:function(e,t,i,r,n,s){var o=1===a.getOption("ProgressiveSynthesisOn")?1:0;return p.isProgressiveExpandActive()&&o?this._progressiveFilteredExpandWithSynthesis(e,t,r,n,s):this._v1FilteredExpandWithSynthesis(e,t,i,r)},_v1FilteredExpandWithSynthesis:function(t,r,l,u){var c=this,d=[...r.keys()],h={};d.forEach(e=>{if(r.get(e)){var t=r.get(e).serviceId;h[t]||(h[t]=[]),h[t].push(r.get(e).rootId)}});var f=function(t,r,l,u,h){return new n(function(n,f){var g={},_=Date.now(),I="Proxy_Expand_synthesis_duration",F=function(e,i){var r={};r[e]=i,c.setPerformanceTracker(t.widgetId,"NGF-Proxy_Expand_Synthesis","NGFilter_UX",r,1)},y=(l=l||c.EXPAND_SERVICES.expand)&c.EXPAND_SERVICES.expand?"CVQuery":"CVQuery3D";d.length?d.forEach(function(e){if(r.get(e)&&r.get(e).filterInfos){var t=UWA.clone(r.get(e).filterInfos.objQuery[y]),i=p.getCombinationType(t),n=p.getQueryExpandType(i);g.union||(g.union={}),g.union[n]||(g.union[n]=[]);for(var s=t[i][n],o=0;o<s.length;o++)g.union[n].push(s[o])}}):(F(I,Date.now()-_),n([])),0===Object.keys(g).length&&(console.log("NGFServices.filteredExpandWithSynthesis KO : queryForExpandSynthesis undefined"),F(I,Date.now()-_),n([]));var m=e.Date.strftime(new i,"%Y-%m-%d-%H:%M:%S");g.label="FilterBI_FilteredExpandWithSynthesis_"+m,g.max_count_path="1",g.synthesis_mode=u,s.authenticatedRequest(p.getExpandSynthesisUrl(t.tenantId,h),{headers:o.getRESTHeaders(),method:"POST",data:JSON.stringify(g),type:"json",proxy:"passport",timeout:a.getOption("timeoutExpandSynthesis"),onComplete:function(e){var t=e.facets||[];o.getNlsInfosForFacets(t).then(function(e){F(I,Date.now()-_),n(e)})},onFailure:function(e){F(I,-1),f(e)}})})},g=[];for(var _ in h){h[_].length;g.push(f(t,r,l,u,_))}return n.all(g).then(function(e){var t=[];return e.forEach(e=>{t=t.concat(e)}),t},function(e){return console.log(e),[]})},_progressiveFilteredExpandWithSynthesis:function(t,r,l,u,c){var d=this,f={};c.forEach(e=>{if(r.get(e)){var t=r.get(e).serviceId;f[t]||(f[t]=[]),f[t].push(r.get(e).rootId)}});var g=function(t,r,l,u,c,f){var g=[];if(!c||0===c.length)return new n(function(e){e([])});var _=0;if(c.forEach(t=>{if(r.get(t)&&r.get(t).filterInfos){_++;var i=e.clone(r.get(t).filterInfos.objQueryV2).batch.expands[0],n=o.getProgressiveExpandItemTemplate(i.root.physical_id,i.filter,i.aggregation_processors);n.label="Root_"+_;var s={synthesis:{name:"ProgressiveExpand_Synthesis",mode:l,synthesis_only:1,group_by_facet:1}};1===p.isRootExcludedFromSynthesis()&&(s.synthesis.exclude_root_from_count=!0),n.aggregation_processors.push(s);var a=d.buildV2GraphProperty(u);a&&(n.graph=a),h.isEmptyFilter(n.filter)&&(n.filter={all:1}),g.push(n)}}),0===g.length)return console.log(" => ProgressiveFilteredExpandWithSynthesis KO : data for progressiveExpand undefined"),new n(function(e){e([])});var I=o.getProgressiveQueryTemplate();I.batch.expands=g,I.outputs={synthesis:["ProgressiveExpand_Synthesis"]};var F=o.getOption("scc_preferredData"),y=F&&F.length?"include_predicates":"facet_name";if(I.outputs[y]=F&&F.length?F:"ds6w",!F||0===F.length){var m=o.getOption("scc_excludedData"),v=m&&m.length?"exclude_predicates":"facet_name";I.outputs[v]=m&&m.length?m:"ds6w"}return new n(function(e,r){var n=Date.now(),l="Proxy_Expand_synthesis_duration",u=function(e,i){var r={};r[e]=i,d.setPerformanceTracker(t.widgetId,"NGF-Proxy_Progressive_Expand_Synthesis","NGFilter_UX",r,1)},c="ProgressiveExpandSynthesis_"+i.strftime(new i,"%Y-%m-%d-%H:%M:%S"),h=o.getRESTHeaders();h.SecurityContext=t.securityContext,s.authenticatedRequest(p.getProgressiveExpandUrl(p.getTenant(),f),{label:c,headers:h,method:"POST",data:JSON.stringify(I),type:"json",proxy:"passport",timeout:a.getOption("timeoutExpandSynthesis"),onComplete:function(t){if(t.errors)console.log(" ==> Expand synthesis / Error : "+c),t.errors.forEach(function(e){console.log("     . "+e.code+": "+e.reason)}),u(l,-1),r(t.errors);else{var i=t.results;if(i.length&&i[0].synthesis){var s=i[0].synthesis.facets||[];o.getNlsInfosForFacets(s).then(function(t){u(l,Date.now()-n),e(t)})}else u(l,Date.now()-n),e([])}},onFailure:function(e){console.log(" ==> Expand synthesis / Failure : "+c),console.log("   . "+e),u(l,-1),r(e)}})})},_=[];for(var I in f){f[I].length;_.push(g(t,r,l,u,f[I],I))}return n.all(_).then(function(e){var t=[];return e.forEach(e=>{t=t.concat(e)}),t},function(e){return console.log(e),[]})},getPredicatesFacetValue:function(){var e="ds6w";if(1===p.arePredicatesExcludedFromSynthesis()){var t=a.getOption("PredicatesExcludedFromSynthesis",[]);e=JSON.parse('["'+(t.length?t.join('","'):e)+'"]')}return e},getCurrentSpecificationVersion:function(){var e=p.CVQUERY_VERSIONS.length-1;return p.CVQUERY_VERSIONS[e]},isLastSpecificationVersion:function(e){return this.getCurrentSpecificationVersion()===e},getCombinationQuery:function(e){if(e)return e.union||e.intersection||e.minus},getCVQueryType:function(e){var t;return e.CVQuery?t="CVQuery":e.CVQuery3D&&(t="CVQuery3D"),t},getCombinationType:function(e){var t;return e.union?t="union":e.intersection?t="intersection":e.minus&&(t="minus"),t},getQueryExpand:function(e){return e.expand||e.expand3d},getQueryExpandType:function(e){var t;return e.expand?t="expand":e.expand3d&&(t="expand3d"),t},getQueryFormat:function(e){var t=1===a.getOption("ExpandServicesOn")?e:void 0;t=t||Object.keys(this.EXPAND_SERVICES),t=Array.isArray(t)?t:[t];var i=0;return t.forEach(e=>{this.EXPAND_SERVICES[e]&&(i|=this.EXPAND_SERVICES[e])}),i},buildEmptyFilter:function(e){var t='"CVQuery":{"root_physicalid":"'+e+'"}',i=t;i=i.replace('"CVQuery"','"CVQuery3D"');var r=o.getProgressiveExpandItemTemplate(e,{or:{filters:[]}}),n='"CVQueryV2":'+JSON.stringify({filter:r.filter});return"{"+t+","+i+(n.length?","+n:"")+"}"},emptyFilterV1Format:function(e){var t={CVQuery:{}};return t.CVQuery.union={},t.CVQuery.union.expand=[],t.CVQuery.union.expand[0]={},t.CVQuery.union.expand[0].root_path_physicalid=[[e]],1===o.getCVQueryBuildMode()&&(t.CVQuery.specVersion=p.getCurrentSpecificationVersion(),t.CVQuery3D={},t.CVQuery3D.specVersion=p.getCurrentSpecificationVersion(),t.CVQuery3D.union={},t.CVQuery3D.union.expand3d=UWA.clone(t.CVQuery.union.expand)),t},groupingFilterV1Format:function(e,t){for(var i=p.emptyFilterV1Format(e),r=t.groupingPredicate,n=[],s=0;s<t.groupingTags.length;s++){var o=t.groupingTags[s];Array.isArray(o)&&(o=o.join("/")),n.push(o)}for(var a="(",l=0;l<n.length;l++)a+="(["+r+"]:("+n[l]+"))",a+=l<n.length-1?" OR ":"";return a+=")",i.CVQuery.union.expand[0].sequence_filter=[],i.CVQuery.union.expand[0].sequence_filter.push({option:[t.other?"seq_remove":"seq_keep"],definition:[{"q.query":"(physicalid:"+e+")"},{"q.query":a}]}),i},_getFilterSpecification:function(e){return e.filterToApply?e.filterToApply.specification:e.specification?e.specification:void 0},getFilterUIComponents:function(e){return this._getFilterSpecification(e)?this._getFilterSpecification(e).data.filterUIComponents:e.filterUIComponents},computeUXId:function(e,t){return e+(t?"_"+t:"")},isDebugActive:function(e){return this._debug[e]},isActivated:function(e){return this._isActivated[e]},setFilteringContext:function(e){this.updateFilteringContext(e)},updateFilteringContext:function(t){var i=this._filteringContext||{},r=i.tenant;this._filteringContext=e.merge(t,i),r!==this.getTenant()&&o.getPlatformServices(this.getTenant()).then(function(){})},getTenant:function(){return this._filteringContext?this._filteringContext.tenant:"OnPremise"},isProgressiveExpandActive:function(){return 1===a.getOption("ProgressiveExpandOn")?1:0},_getFilterTrackerMetrics:function(){return c},_getTracker:function(e,t,i){var r,n={tenant:this.getTenant(),appID:"ENOREFS_AP",widgetid:i||"AdvFilter",eventCategory:e,eventAction:t};return"performance"===e?r=d.getPADTracker(n,this._getFilterTrackerMetrics()):"usage"===e&&(r=d.getPADTracker(n)),r},setUsageTracker:function(e,t,i){var r="string"==typeof i?{eventLabel:i,eventValue:1}:{eventLabel:i.label,eventValue:i.value},n=this._getTracker("usage",t,e);n&&(n.setEventData(r),n.trackPageEvent())},setPerformanceTracker:function(e,t,i,r,n){var s=this._getTracker("performance",t,e);s&&(s.addMultivaluedEventData(i,r),n&&s.trackPageEvent())},_getPreferredSecurityContextUrl:function(e,t){return this._getURL(e,t,"/resources/pno/person/getsecuritycontext")},getPreferredSecurityContext:function(e,t){var i=this;return new n(function(r,n){o.getPlatformServices(i.getTenant()).then(function(){s.authenticatedRequest(i._getPreferredSecurityContextUrl(e,t),{headers:o.getRESTHeaders(),method:"GET",type:"json",proxy:"passport",onComplete:function(e){r(e?e.SecurityContext:"")},onFailure:function(e){console.log("\n\n ===> getPreferredSecurityContext failed, Error ="+e+"\n\n"),n(e)}})})})},buildV2GraphProperty:function(e){var t=void 0;if(e){if(e.graph)t=e.graph;else{var i=["","types","reltypes"],r=["descending_condition","descending_condition_object","descending_condition_relation"];["","_bo","_rel"].forEach(function(n,s){var o=e["q.iterative_filter_query"+n],a=e["type_filter"+n],l=e["no_type_filter"+n],u="";if(a){var c=" OR ";a.forEach(function(e){u+='(flattenedtaxonomies:"'+i[s]+"/"+e+'")'+c}),u=u.endsWith(c)?u.substring(0,u.length-c.length):u}var d="";if(l){c=" OR ";l.forEach(function(e){d+='(flattenedtaxonomies:"'+i[s]+"/"+e+'")'+c}),d=d.endsWith(c)?d.substring(0,d.length-c.length):d}var h=o||"";u.length&&(u="("+u+")",h+=h.length?" AND  "+u:u),d.length&&(d="NOT("+d+")",h+=h.length?" AND "+d:d),h.length&&((t=t||{})[r[s]]={uql:u.length||d.length?"("+h+")":h})})}p.isDebugActive("ngf")&&console.log("\n ==> buildGraphPorperty\n appQueryParam = "+JSON.stringify(e)+"\n graph = "+JSON.stringify(t))}return t},getDisplaySeparator:function(){var e=a.getOption("displayRoot_Separator")||" - ";return e=-1===e.indexOf("|")?e:e.split("|").join("-")},isRootExcludedFromSynthesis:function(){return a.getOption("ExcludeRootFromSynthesis")?1:0},arePredicatesExcludedFromSynthesis:function(){return o.arePredicatesExcludedFromSynthesis()},getFilterBasics:function(e){var t=this,i=Array.isArray(e)?e:[e];return new n(function(e,r){s.authenticatedRequest(t.getBasicsInDBFromIdsUrl(),{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(i),onComplete:function(t){var i=JSON.parse(t).success;i?e(i):r([])},onFailure:function(e){r({})}})})},getSecurityContext:function(){},upgradeAndCompleteQuery:function(e){var t={},i=e.CVQuery?e.CVQuery:e,r=(i="string"==typeof i?JSON.parse(i):i).specVersion||void 0;if(p.isLastSpecificationVersion(r))t.CVQuery=i,t.CVQuery.specVersion=r;else{for(var n=i,s=p.CVQUERY_VERSIONS,o=s.length,a=s.indexOf(r)+1;a<o;a++)n=this._migrateCVQuery(n,s[a]);t.CVQuery=n,t.CVQuery.specVersion=p.getCurrentSpecificationVersion()}var l=p.getCombinationQuery(t.CVQuery);if(t.CVQuery&&l&&(t.CVQuery3D=UWA.clone(t.CVQuery),!l.expand3d)){var u=p.getCombinationQuery(t.CVQuery3D),c=p.getQueryExpand(u);u.expand3d=c,delete u.expand}for(var d=p.getCombinationQuery(t.CVQuery3D),h=p.getQueryExpand(d),f=0;f<h.length;f++)if(h[f].sequence_filter)for(var g=0;g<h[f].sequence_filter.length;g++)"seq_cut"===h[f].sequence_filter[g].option[0]&&(h[f].sequence_filter[g].option=["seq_keep"]);var _=p.getCombinationType(t.CVQuery3D);return t.CVQuery3D[_].expand3d=h,t},_migrateCVQuery:function(e,t){var i={};switch(t){case p.CVQUERY_VERSIONS[0]:i=e.union?e:p.buildGlobalUnionCVQuery(e)}return i},buildGlobalUnionCVQuery:function(e){var t={union:{}};return t.union.expand=[],t.union.expand[0]=e,e.root_physicalid&&(t.union.expand[0].root_path_physicalid=[[e.root_physicalid]],delete e.root_physicalid),t},_upgradeFilterSpecification:function(e){var t={toFeedUI:{combinationOfSpecification:"union",keepChildren:!0}},i=e.filterUIComponents[0];if("object"==typeof i){var r=i.toFeedUI;r?r.combinationOfSpecification||e.filterUIComponents.unshift(t):e.filterUIComponents=[t,{isActivated:"1",filterSpecificationName:u.get("defaultGroupName"),toFeedUI:e.filterUIComponents}]}else{for(var n=u.get("defaultGroupName"),s=[t],o=0;o<e.filterUIComponents.length;o++)s.push({isActivated:"1",filterSpecificationName:n,toFeedUI:e.filterUIComponents[o]});e.filterUIComponents=s}}});return p}),Number.isInteger=Number.isInteger||function(e){"use strict";return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},define("DS/ENOFilterBIUX/FBIProxyServices",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Promise","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIServices"],function(e,t,i,r,n,s,o){"use strict";return t.singleton(i,{completeCVQueryWithAppSpecs:function(e,t,i){var r=UWA.clone(e),s=n.getCombinationQuery(r);if(t.volume_filter&&Object.keys(t.volume_filter).length)if(s&&s.expand3d)for(var o=0;o<s.expand3d.length;o++)s.expand3d[o].volume_filter?s.expand3d[o].volume_filter.and=UWA.extend(t.volume_filter,s.expand3d[o].volume_filter):s.expand3d[o].volume_filter=UWA.clone(t.volume_filter),i&&t.volume_filter&&t.volume_filter.assemblyshape&&s.expand3d[o].config_filter&&(s.expand3d[o].volume_filter.assemblyshape.config_filter=s.expand3d[o].config_filter);else r.volume_filter=UWA.clone(t.volume_filter),i&&r.config_filter&&r.volume_filter&&r.volume_filter.assemblyshape&&(r.volume_filter.assemblyshape.config_filter=r.config_filter);if(t.find_in_context&&Object.keys(t.find_in_context).length)if(s&&s.expand)for(var a=0;a<s.expand.length;a++)s.expand[a].find_in_context=UWA.clone(t.find_in_context);else if(s&&s.expand3d)for(var l=0;l<s.expand3d.length;l++)s.expand3d[l].find_in_context=UWA.clone(t.find_in_context);else r.find_in_context=UWA.clone(t.find_in_context);if(t.root_path_physicalid&&Object.keys(t.root_path_physicalid).length)if(s&&s.expand)for(var u=0;u<s.expand.length;u++)s.expand[u].root_path_physicalid=UWA.clone(t.root_path_physicalid);else if(s&&s.expand3d)for(var c=0;c<s.expand3d.length;c++)s.expand3d[c].root_path_physicalid=UWA.clone(t.root_path_physicalid);else r.root_path_physicalid=UWA.clone(t.root_path_physicalid);if(t.find_path_filter&&Object.keys(t.find_path_filter).length)if(s&&s.expand)for(var d=0;d<s.expand.length;d++)s.expand[d].find_path_filter=UWA.clone(t.find_path_filter);else if(s&&s.expand3d)for(var h=0;h<s.expand3d.length;h++)s.expand3d[h].find_path_filter=UWA.clone(t.find_path_filter);else r.find_path_filter=UWA.clone(t.find_path_filter);if(t["q.iterative_filter_query_bo"]&&Object.keys(t["q.iterative_filter_query_bo"]).length)if(s&&s.expand)for(d=0;d<s.expand.length;d++)s.expand[d]["q.iterative_filter_query_bo"]=UWA.clone(t["q.iterative_filter_query_bo"]);else if(s&&s.expand3d)for(h=0;h<s.expand3d.length;h++)s.expand3d[h]["q.iterative_filter_query_bo"]=UWA.clone(t["q.iterative_filter_query_bo"]);else r["q.iterative_filter_query_bo"]=UWA.clone(t["q.iterative_filter_query_bo"]);return r},getCompletedQueriesFromFilterIds:function(e,t){return new r(function(i,r){n.getAllDataFromFilterIds(e,t).then(function(e){var t={};e.success&&(t.success=[],e.success.forEach(e=>{var i,r=JSON.parse(e.filterCVQuery);(i=0===o.getCVQueryBuildMode()?n.upgradeAndCompleteQuery(r):r).filterTitle=e.filterTitle,i.filterPhysicalId=e.filterPhysicalId||e.filterId,i.rootPhysicalId=e.rootPhysicalId,t.success.push(i)})),e.failure&&(t.failure=[],e.failure.forEach(e=>{t.failure.push(e)})),i(t)},function(e){r(e)})})},completeCVQueryWithAppParams:function(t,i,r,s){var o=i,a={expand_iter:void 0===r?"-1":r};if(t.CVQuery){t.CVQuery="string"==typeof t.CVQuery?JSON.parse(t.CVQuery):t.CVQuery;var l=n.getCombinationQuery(t.CVQuery);if(l)for(var u=n.getQueryExpand(l),c=0;c<u.length;c++){var d=e.merge(u[c],a);d=e.merge(u[c],o),u[c]=d}else t.CVQuery=e.merge(t.CVQuery,a),t.CVQuery=e.merge(t.CVQuery,o)}if(t.CVQuery3D){t.CVQuery3D="string"==typeof t.CVQuery3D?JSON.parse(t.CVQuery3D):t.CVQuery3D;var h=n.getCombinationQuery(t.CVQuery3D);if(h)for(var p=n.getQueryExpand(h),f=0;f<p.length;f++){var g=e.merge(p[f],a);g=e.merge(p[f],o),p[f]=g}else t.CVQuery3D=e.merge(t.CVQuery3D,a),t.CVQuery3D=e.merge(t.CVQuery3D,o)}if(t.CVQueryV2){var _=t.CVQueryV2.batch?t.CVQueryV2.batch.expands:void 0;if(_&&_.length){var I=n.buildV2GraphProperty(o);I&&(t.CVQueryV2.batch.expands[0].graph=I)}}return t}})}),define("DS/ENOFilterBIUX/ENOFBIWebInWinManager",["UWA/Core","UWA/Class","DS/Core/ModelEvents","DS/PlatformAPI/PlatformAPI","DS/ENOFilterBIUX/FBIServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TagNavigatorProxy/TaggerWebInWinProxy"],function(e,t,i,r,n,s,o){"use strict";var a=0;return o.extend(i,{init:function(e){if(e.proxyId=e.widgetId+"_FBIWebInWin_"+ ++a,e.filteringMode="FilteringOnServer","undefined"!=typeof dscef){sendNotificationWebInWin("event4taggerWebInWin","initTaggerWebinWin")}this._parent.call(this,e)},_dispatchEvent:function(t){if(!e.is(t,"object")||!e.is(t.notif_name)||void 0===t.notif_parameters)throw console.log("E_INVALIDARG in ENOFBIWebInWinManager, expect to have parameters.notif_name arg & parameters.notif_parameters in _dispathTowin !!!"),"No parameters.notif_name arg & parameters.notif_parameters given to _dispatchEvent method !";var i=e.is(t.notif_parameters,"string")?t.notif_parameters:JSON.stringify(t.notif_parameters);"undefined"!=typeof dscef&&sendNotificationWebInWin(t.notif_name,i)}})}),define("DS/ENOFilterBIUX/Abstract_FBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","DS/ENOFilterBIUX/ExpandV2FormatServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX","DS/Utilities/Utils","DS/ENOFilterBIUX/ENOFBIWebInWinManager","DS/SNInfraUX/TaggerConfigAccess"],function(e,t,i,r,n,s,o,a,l,u,c,d,h,p,f){"use strict";return t.extend(i,{init:function(e){var t=this;if(this._defaultServiceId="3DSpace",e.isWebInWin){e.platformServices&&n.setOption("str_platformServices",e.platformServices),n.setOption("fromWebInWin",1);var i=e.widgetId?e.widgetId:"ENOWIWTaggerProxy";this._optionWIWI={tenant:e.tenant||"OnPremise",appId:e.appId,widgetId:i,platformServices:e.platformServices,events:{addFilterChangeListener:t.filterBIFilter.bind(t),addCriteriaChangeListener:t.filterBIFilter.bind(t),colorize:t.filterBIColorize.bind(t)},colorize:e.colorize,exclude:e.exclude},this._taggerWiWiManager&&this._taggerWiWiManager.die(),this._taggerWiWiManager=new p(this._optionWIWI),this._taggerWiWiManager.toggleProxyFocus(!0)}this._enableTagsOnDemand=!1,r.getFeatureStatus(["enableTagsOnDemand"]).then(function(e){t._enableTagsOnDemand=e?e.enableTagsOnDemand:void 0,t._initDataFromSCC(t._enableTagsOnDemand)}),this._initProxyData(e),c.subscribe("NGFilter_Volume",this._onFilterVolume.bind(this)),c.subscribe("Frame3DXInfra.onPanelClose",this._onCloseFilterPanel.bind(this)),c.subscribe("Frame3DXInfra.onPanelOpen",this._onOpenFilterPanel.bind(this)),c.subscribe("Frame3DXInfra.ViewChange",this._onViewChange.bind(this)),c.subscribe("Frame3DXInfra.WidgetRemoved",this._onWidgetRemoved.bind(this)),this._NGFUXIdImpact({type:"subscribeEvents",data:{NGFUXId:this._NGFUXId}}),c.subscribe("NGFilter_saved",this._onSavedFilter.bind(this)),a.isDebugActive("extendedCmds")&&(c.subscribe("NGFilter_Dbg_SetCopyFromAnyFilterOnRoots",this._onDbg_SetCopyFromAnyFilterOnRoots.bind(this)),c.subscribe("NGFilter_Dbg_SetConfigFilter",this._onDbg_SetConfigFilter.bind(this)),c.subscribe("NGFilter_Dbg_UpdateTenant",this._onDbg_UpdateTenant.bind(this)),c.subscribe("NGFilter_Dbg_SetDefaultSecurityContext",this._onDbg_SetDefaultSecurityContext.bind(this)),c.subscribe("NGFilter_Dbg_LinkUnlink",this._onDbg_LinkUnlink.bind(this))),this._shareFilterSpec&&(this._allSharingSpecEvents(),this._allLinkingWgtsEvents())},_initDataFromSCC:function(e){var t=this;this._excludedData=[],this._preferredData=[],n.setOption("scc_excludedData",[]),n.setOption("scc_preferredData",[]),f.get6WTagsConfiguration({appID:this._appId,tenantID:this._tenantId}).then(function(i){for(var r in i)0===i[r].weight?t._excludedData.push(r):e&&t._preferredData.push(r);n.setOption("scc_excludedData",t._excludedData),n.setOption("scc_preferredData",t._preferredData)})},_initProxyData:function(e){var t=this;this.optionsToKeep=e,this._tenantId=e.tenant||"OnPremise",n.getPlatformServices(this._tenantId).then(function(){a.setFilteringContext({tenant:t._tenantId}),t._defaultSC=t._defaultSC||e.securityContext,t.setDefaultSecurityContext(t._defaultSC)}),this._isProxyActive=!0,this.optionsToKeep.NGFUXId&&a.setUsageTracker(this._widgetId,"NGF-Tagger-NGFUXId",{label:"NGFUXId",value:this.optionsToKeep.NGFUXId}),this._NGFUXId=this.optionsToKeep.NGFUXId||this.optionsToKeep.appId,this._appId=this.optionsToKeep.appId||"fakeAppId",this._widgetId=this.optionsToKeep.widgetId,e.appQueryParam&&this.setAppQueryParam(e.appQueryParam),this._queryFormat=a.getQueryFormat(e.expandServices||e.queryFormat),this._directTaggerProxy=!1,this._setPathTagsWithSynthesis=!1,this._fetchWithSynthesis=!1,this._expandIterParam=e.expandIterParam?e.expandIterParam:"-1",this._expandWithSynthesis=!!e.ExpandSynthesisON,this._expandWithSynthesis&&(this._proxySynthesisMode=s.getOption("synthesis_mode")),this._facetsToFeedTagger={},this._mRootsDataInSession=new Map,this._proxyFeedsTagger=!1,this._applyNGFilterCount=0,this._tagData=void 0,this._keepVolatileTags=[],this.volatileTags={};this._NGFUXId,this._widgetId;this._configUsed=1;var i=!0===e.volumeFilterAvailable,r=!1!==e.selectionFilterAvailable,o=!1!==e.attributeFilterAvailable;this.optionsToKeep.volumeFilterAvailable=i,this.optionsToKeep.selectionFilterAvailable=r,this.optionsToKeep.attributeFilterAvailable=o,this._NGFUXIdImpact({type:"criteriaAvaibility",data:{identifier:this._NGFUXId+"-"+this._widgetId,volumeFilterUsed:i,selectionFilterUsed:r,attributeFilterUsed:o,configFilterUsedfigAvaibility:this._configUsed}}),e.shareFilterSpec&&(this._shareFilterSpec=!0),this._predicates=[],this._nodes=[],this._paths=[],this._tree=[],this._unFilteredPathIDs=[],this._unfilteredTree=[],this._filteredData={},this._colorizedData={},this._nodesIN=[],this._odtSummary=[],this._filterBIToKeep={},this._isFetchCustoDone=!1},taggerWebInWinEvent:function(e){var t=JSON.stringify(e.proxyId).indexOf("_FBIWebInWin"),i=JSON.stringify(e.proxyId).substring(1,t);e.event_id;this.optionsToKeep.widgetId===i&&("addFilterChangeListener"===e.event_id?this.filterBIFilter(e.data):"colorize"===e.event_id?this.filterBIColorize(e.data):"unColorize"===e.event_id?this.filterBIUnColorize(e.data):console.log("\n  ===> Abstract taggerWebInWinEvent/ evt non supported = "+e.event_id))},destroy:function(){var e=this._NGFUXId+"-"+this._widgetId;sessionStorage.removeItem("NGFilter_Volume_"+e),sessionStorage.removeItem("NGFilter_Context_"+e),sessionStorage.removeItem("NGFilter_Attribute_"+e),sessionStorage.removeItem("NGFilter_AppQueryParam_"+e),sessionStorage.removeItem("NGFilter_MonoSixw_"+e),this._cleanNGFSessionItems(),this._parent()},_onWidgetRemoved:function(e){for(var t=[],i=sessionStorage.length,r=0;r<i;r++){var n=sessionStorage.key(r);-1!==n.indexOf(e.id)&&t.push(n)}t.forEach(e=>{sessionStorage.removeItem(e)}),c.publish("NGFilter_WidgetRemoved",{NGFUXId:this._NGFUXId,appId:this._NGFUXId,widgetId:this._widgetId,widgetIdRemoved:e.id,volumeAvailable:this.optionsToKeep.volumeFilterAvailable,contextAvailable:this.optionsToKeep.selectionFilterAvailable,attributeAvailable:this.optionsToKeep.attributeFilterAvailable})},_cleanNGFSessionItems:function(){var e=this._NGFUXId+"-"+this._widgetId,t=this._getAllRootsInSession()?this._getAllRootsInSession().length:0;this._mRootsDataInSession.forEach(function(e,t){var i=a.computeUXId(this._NGFUXId,t),r="NGF_isUXBuilt_"+i,n="NGF_tagMgtRunning_"+i;sessionStorage.removeItem(r),sessionStorage.removeItem(n)}),t||sessionStorage.removeItem("NGFilter_AppQueryParam_"+e)},_onToggleProxyFocus:function(e){if(e&&this.myTagProxy&&this.optionsToKeep){var t=e.widgetId;if(this.optionsToKeep.widgetId===t){var i=e.focus||!0;this.myTagProxy.toggleProxyFocus(i)}}},_setTaggerLocalFilter:function(e){this.myTagProxy&&this._needsFiltering(e,this.myTagProxy.getCurrentFilter())&&(Object.keys(e.allfilters).length||Object.keys(e.localfilters).length?(this._keepTagDataInSession(e),this.myTagProxy.clearLocalFilter(!1),this.myTagProxy.setLocalFilter(e.localfilters,!1)):(this._keepTagDataInSession(e),this.myTagProxy.clearLocalFilter(!1)))},updateTenant:function(e){var t=this._getAllRootsInSession()?this._getAllRootsInSession().length:0;e&&this._tenantId!==e&&(t&&this.removeRoots(this._getAllRootsInSession()),this._tenantId=e,a.updateFilteringContext({tenant:e}),this.setDefaultSecurityContext())},setDefaultSecurityContext:function(e){var t=this,i=0,r=function(e){c.publish("NGFilter.SetDefaultSecurityContext",{NGFUXId:t._NGFUXId,securityContext:e});var i=t._NGFUXId+"-"+t._widgetId;sessionStorage.setItem("NGFilter_SecurityContext_"+i,e)};if(e){if(this._defaultSC!==e){this._defaultSC=e,i=1;var n=this._defaultSC.indexOf("ctx::"),s=-1===n?this._defaultSC:this._defaultSC.substring(n+"ctx::".length);r(s)}}else a.getPreferredSecurityContext(this._tenantId,this._defaultServiceId).then(function(e){0===i&&(t._defaultSC=e,r(e))})},odtSetFilters:function(e){this.myTagProxy&&(this.myTagProxy.filters=e)},odtKeepActiveFilters:function(e){e&&(this._filterBIToKeep=e)},_initTaggerProxy:function(e,t,i){var n="FilteringOnServer";null!=t?n="FilteringOnServer":null!=e&&(n="WithFilteringServices");var o=this.optionsToKeep,a={widgetId:o.widgetId,tenant:o.tenant,filteringMode:n,colorize:i||o.colorize,events:o.events,exclude:o.exclude,contextId:o.contextId};this._expandWithSynthesis&&(a.enableTagsOnDemand=this._enableTagsOnDemand),void 0!==o.exclude&&(a.exclude=o.exclude),void 0!==o.enableGrouping&&(a.enableGrouping={maxLevels:1,maxPerLevel:-1,maxHierarchyPerLevel:1}),this.optionsToKeep.appId&&(-1===this.optionsToKeep.appId.indexOf("_")&&console.debug("***CAUTION*** : appId is not a real appId: "+this.optionsToKeep.appId),a.appId=this.optionsToKeep.appId),this.optionsToKeep.selection&&(a.selection=this.optionsToKeep.selection),this.myTagProxy||(this.myTagProxy=r.createProxy(a),s.getOption("TaggerDateRanges")&&this._expandWithSynthesis&&this.myTagProxy.configurePredicates({"ds6w:created":{freeInputOnly:!0},"ds6w:modified":{freeInputOnly:!0}}),this.myTagProxy||console.log("#############  ERREUR init TaggerProxy in FilterBIComponentProxy"),this.myTagProxy.addEvent("colorize",this.filterBIColorize.bind(this)),this.myTagProxy.addEvent("unColorize",this.filterBIUnColorize.bind(this)),this.myTagProxy.addEvent("onFilterChange",this.filterBIFilter.bind(this)),this.myTagProxy.addEvent("onGroupingChange",this.filterBIGrouping.bind(this)),this.myTagProxy.addEvent("onSelection",this.filterBISelection.bind(this)),this.myTagProxy.addEvent("onLoadMoreTags",this.filterBIMoreTags.bind(this)))},_completeAppOptions:function(e){var t={};return t.exclude=!(!this._excludedData||!this._excludedData.length)||s.getOption("exclude"),void 0!==e.enableGrouping?t.enableGrouping=e.enableGrouping:!0===s.getOption("enableGrouping")&&(t.enableGrouping={}),t},_setTags:function(e,t,i){var r=this;if(n.getOption("fromWebInWin"))return this._taggerWiWiManager||(this._taggerWiWiManager=new p(this._optionWIWI)),this._taggerWiWiManager.toggleProxyFocus(!0),void this._setTagsWIWIOr3DD(e,t,i);this.myTagProxy||this._initTaggerProxy(e,t),!t||t.length?(this._tagsToSet&&"object"==typeof this._tagsToSet&&Object.keys(this._tagsToSet).length&&(this._setTaggerLocalFilter(this._tagsToSet),this._tagsToSet=void 0),this._directTaggerProxy?this._setTagsWIWIOr3DD(e,t,i):(this._setVolatilesSummariesAfterProxyCreation&&this.setVolatileTags(this._setVolatilesSummariesAfterProxyCreation),this._setPathTagsWithSynthesis||this._fetchWithSynthesis?this._setTagsWIWIOr3DD(e,t,i):(this._expandWithSynthesis||(this.myTagProxy&&(this.myTagProxy.filters=this.myTagProxy.getCurrentFilter()),Object.keys(this.myTagProxy.filters).length&&Object.keys(this.myTagProxy.filters.allfilters).length&&(0===n._getObjectSize(this._filterBIToKeep)||this._filterBIToKeep&&this._filterBIToKeep.allfilters&&Object.keys(this.myTagProxy.filters.allfilters).length>=Object.keys(this._filterBIToKeep.allfilters).length)&&(!0===this._currentlyDispatchingAVolatileFilterEvent?this._currentlyDispatchingAVolatileFilterEvent=!1:this.filterBIFilter(this.myTagProxy.filters))),null!=t?(this.myTagProxy.filters&&(this._filterBIToKeep=this.myTagProxy.filters),Array.isArray(t)&&t.length?this._expandWithSynthesis&&!t[0].dispValue?n.getNlsInfosForFacets(t).then(function(t){r._setTagsWIWIOr3DD(e,t,i)}):this._setTagsWIWIOr3DD(e,t,i):this._setTagsWIWIOr3DD(null,[])):this._setTagsWIWIOr3DD(null,[])))):this._setTagsWIWIOr3DD(null,[])},_setTagsWIWIOr3DD:function(e,t,i){n.getOption("fromWebInWin")?this._taggerWiWiManager.setTags(e,t,i):this.myTagProxy.setTags(e,t,i)},unsetTags:function(){null!==this.myTagProxy&&void 0!==this.myTagProxy&&this.myTagProxy.unsetTags()},filterBIColorize:function(e){},_needsFiltering:function(e,t,i){if(this._taggerUpdatedFromNGF&&!i)return this._taggerUpdatedFromNGF=!1,!1;var r=function(e,t){if((void 0===e||e&&0===Object.keys(e).length)&&void 0===t||e&&0===Object.keys(e).length&&t&&0===Object.keys(t).length)return!0;if(e&&Object.keys(e).length&&(void 0===t||t&&0===Object.keys(t).length))return!1;if(e&&t&&Object.keys(e).length!==Object.keys(t).length)return!1;for(var i in e){if(void 0===t[i]||!t[i])return!1;if(JSON.stringify(e[i])!==JSON.stringify(t[i]))return!1}return!0};return!r(e.allfilters,t.allfilters)||!r(e.localfilters,t.localfilters)},filterBIUnColorize:function(e){(this._getAllRootsInSession()?this._getAllRootsInSession().length:0)&&(a.setUsageTracker(this._widgetId,"NGF-Tagger-ColorizeEvent","Uncolorize"),this.dispatchEvent("FilterBIUnColorizeEvent",e))},_cleanUnFilteredTree:function(e,t,i){return i?e===t:!!e.includes(t)},_cleanTree:function(e,t,i){return i?e===t:!!e.includes(t)},cleanProxy:function(){(this._fetchWithSynthesis||this._proxyFeedsTagger||this._directTaggerProxy)&&this._setTagsWIWIOr3DD(null,[]),this._initProxyData(this.optionsToKeep),this._taggerWiWiManager&&(this._taggerWiWiManager.die(),this._taggerWiWiManager=null)},filterBIFilter:function(e,t){},filterBIGrouping:function(e){},filterBISelection:function(e){},filterBIMoreTags:function(e){},addSubjects:function(e){null!==this.myTagProxy&&void 0!==this.myTagProxy&&this.myTagProxy.addSubjects(e)},focusOnSubjects:function(e,t){null!==this.myTagProxy&&void 0!==this.myTagProxy&&this.myTagProxy.focusOnSubjects(e,t)},unfocus:function(){null!==this.myTagProxy&&void 0!==this.myTagProxy&&this.myTagProxy.unfocus()},toggleProxyFocus:function(e){null!==this.myTagProxy&&void 0!==this.myTagProxy&&this.myTagProxy.toggleProxyFocus(e)},getCurrentFilter:function(){if(null!==this.myTagProxy&&void 0!==this.myTagProxy)return this.myTagProxy.getCurrentFilter()},die:function(){this.cleanProxy(),null!==this.myTagProxy&&void 0!==this.myTagProxy?(this.myTagProxy.die(),this.resetNGFilterUI()):null!==this._taggerWiWiManager&&void 0!==this._taggerWiWiManager&&this._taggerWiWiManager&&this._taggerWiWiManager.die()},activate:function(){return null!==this.myTagProxy&&void 0!==this.myTagProxy?(this._isProxyActive=!0,this.myTagProxy.activate()):null!==this._taggerWiWiManager&&void 0!==this._taggerWiWiManager?(this._isProxyActive=!0,this._taggerWiWiManager.activate()):void 0},deactivate:function(){return null!==this.myTagProxy&&void 0!==this.myTagProxy?(this._isProxyActive=!1,this.myTagProxy.deactivate()):null!==this._taggerWiWiManager&&void 0!==this._taggerWiWiManager?(this._isProxyActive=!1,this._taggerWiWiManager.deactivate()):void 0},setPredicates:function(e){this._predicates=e},setPathTags:function(e,t){},removeRoot:function(e){var t=this;this._parent(e),this.resetNGFilterUI({appId:this.optionsToKeep.appId,widgetId:this.optionsToKeep.widgetId,rootIds:Array.isArray(e)?e:[e],NGFUXId:this._NGFUXId}),this._removeRootsDataInSession(e),this._getAllFilteredRootsInSession().length||this._removeTagDataInSession(),h.debounce(function(e){t.refreshTagger()},200)()},removeRoots:function(e){this.removeRoot(e)},_setDirectTaggerMode:function(e){this._directTaggerProxy=e},_updateFilteredRootsInSession:function(e,t){var i={},r={},s=!1;if(t){var o,u;if(i={CVQuery:t.CVQuery,CVQuery3D:t.CVQuery3D},t.CVQueryV2)t.CVQueryV2.filter?(o=t.CVQueryV2.filter,u=t.CVQueryV2.aggregation_processors):(o=t.CVQueryV2.batch.expands[0].filter,u=t.CVQueryV2.batch.expands[0].aggregation_processors),r=n.getProgressiveQueryTemplate(e,o,u)}else{i=a.emptyFilterV1Format(e),this._queryFormat&a.EXPAND_SERVICES.expand||delete i.CVQuery,this._queryFormat&a.EXPAND_SERVICES.expand3d||delete i.CVQuery3D;var c=l.emptyFilterFormat().filter;r=n.getProgressiveQueryTemplate(e,c),this._keepFilterIdInSession(e,void 0),s=!0}0===n.getCVQueryBuildMode()&&(i=a.upgradeAndCompleteQuery(i));var d={CVQuery:i.CVQuery,CVQuery3D:i.CVQuery3D,CVQueryV2:r};if(r=(d=this.completeCVQueryWithAppParams(d,this._expandIterParam,this._expandWithSynthesis)).CVQueryV2,i={CVQuery:d.CVQuery,CVQuery3D:d.CVQuery3D},this._mRootsDataInSession.has(e)||this._keepRootsInSession(e),this._mRootsDataInSession.has(e)){var h=this._mRootsDataInSession.get(e),p=h.filterInfos?h.filterInfos.filterId:void 0;h.filterInfos={objQuery:i,objQueryV2:r,fakeFilter:s,filterId:p}}},_keepFilterIdInSession:function(e,t){if(t){var i={};this._mRootsDataInSession.has(e)&&this._mRootsDataInSession.get(e).filterInfos?((i=this._mRootsDataInSession.get(e)).filterInfos.filterId=t,this._mRootsDataInSession.set(e,i)):(this._keepRootsInSession(e),this._mRootsDataInSession.has(e)&&((i=this._mRootsDataInSession.get(e)).filterInfos={},i.filterInfos.filterId=t,this._mRootsDataInSession.set(e,i)))}},_keepTagDataInSession:function(t){this._tagData=e.clone(t)},_removeTagDataInSession:function(){this._tagData=void 0},emptyFilter:function(e){e.rootIds=this._getAllRootsInSession(),this.dispatchEvent("ApplyNGFilter",e),this._cleanNGFSessionItems()},_getAllRootsInSession:function(){return[...this._mRootsDataInSession.keys()]},_getRootsInSession:function(){return n.getRootsInfos(Array.from(this._mRootsDataInSession.values()))},_getAllFilteredRootsInSession:function(){var e=[];return this._mRootsDataInSession.forEach(function(t,i){t.filterInfos&&Object.keys(t.filterInfos).length&&e.push(i)}),e},_keepRootsInSession:function(e){if(void 0!==e){var t=Array.isArray(e)?e:[e];n.getRootsInfos(t).forEach(e=>{var t=e.rootId;this._mRootsDataInSession.has(t)||this._mRootsDataInSession.set(t,{rootId:t,serviceId:e.serviceId})})}},_keepRootsAliasInSession:function(e){var t=this,i=Array.isArray(e)?e:[e];return new u(function(e){n.getInfosFromIds(i,!1).then(function(r){r.forEach(function(e){if(!t._mRootsDataInSession.has(e.id)){var r=i.find(t=>e.id===t.rootId);t._keepRootsInSession({rootId:e.id,serviceId:r?r.serviceId:void 0})}if(t._mRootsDataInSession.has(e.id)){var n=t._mRootsDataInSession.get(e.id);n.rootAlias=e.label,t._mRootsDataInSession.set(e.id,n)}}),e()})})},_getNbRootsWithTags:function(){var e=this._getAllRootsInSession()?this._getAllRootsInSession().length:0;if(this._tagData&&e)return e},_removeRootsDataInSession:function(e){(e=Array.isArray(e)?e:[e]).forEach(e=>{this._mRootsDataInSession.delete(e)})},getQueriesInSession:function(e){if(this._mRootsDataInSession.has(e)&&this._mRootsDataInSession.get(e).filterInfos){var t=this._mRootsDataInSession.get(e).filterInfos;return{objQuery:t.objQuery,objQueryV2:t.objQueryV2?t.objQueryV2:void 0,filterId:t.filterId?t.filterId:void 0,fakeFilter:t.fakeFilter?t.fakeFilter:void 0}}},_onSavedFilter:function(e){this._keepFilterIdInSession(e.rootID,e.filterId),this.dispatchEvent("SaveNGFilterAbstract",{rootId:e.rootID,filterId:e.filterId})},onApplyNGFilter:function(e){},setNGFilterOptions:function(e){this._queryFormat=a.getQueryFormat(e.expandServices),this._NGFUXIdImpact({type:"queryFormat",data:{identifier:this._NGFUXId+"-"+this._widgetId,queryFormat:this._queryFormat}})},resetNGFilterUI:function(e){if(void 0!==e){var t=e.widgetId||"?";t===this.optionsToKeep.widgetId?(e.NGFUXId=this._NGFUXId,e.rootIds&&(e.rootIds=Array.isArray(e.rootIds)?e.rootIds:[e.rootIds],e.rootIds.forEach(e=>{this._mRootsDataInSession.has(e)&&this._updateFilteredRootsInSession(e)})),c.publish("NGFilter.RemoveFilter",e)):console.log(" ERROR : Invalid data for reset filter ( widgetId  = "+t+")")}},retrieveFiltersFromIds:function(e){var t=this;if(this._tenantId===e.droppedEnvId){e.fromDropOnFilter?a.setUsageTracker(this._widgetId,"NGF-Tagger-DropOnFilter",this._getAppId()):a.setUsageTracker(this._widgetId,"NGF-Tagger-Drop",this._getAppId()),(e.filterObjects&&e.filterObjects.length>1||e.filterIds&&e.filterIds.length>1)&&t.droppedData.callback({success:[],failure:[{msg:d.get("multiFiltersDrop"),eventID:"warning"}]});var i=[];if(e.filterObjects)for(var r=0;r<e.filterObjects.length;r++)i.push(e.filterObjects[r].objectId);else i=e.filterIds;this._retrieveFilter_time0=Date.now(),e.fromDropOnFilter?a.setPerformanceTracker(t._widgetId,"NGF-DropFilterOnFilter","NGFilter_Proxy",{Drop_Filter_duration:Date.now()-this._retrieveFilter_time0},1):a.setPerformanceTracker(t._widgetId,"NGF-DropFilter","NGFilter_Proxy",{Drop_Filter_duration:Date.now()-this._retrieveFilter_time0},1),n.getPlatformServices(this._tenantId).then(function(){a.getAllDataFromFilterIds(i,t._tenantId).then(function(i){if(i.success){var r=[],n=[];if(i.success.forEach(e=>{t._mRootsDataInSession.has(e.rootPhysicalId)?r.push(e.rootPhysicalId):n.push({rootId:e.rootPhysicalId,serviceId:e.serviceId})}),r&&r.length&&!t._fromSynchro)e.callback({success:[],failure:[{msg:d.get("dropFilterOnSameRoot"),eventID:"warning"}]});else{var s=t._areRootsCompliantWithSession(n);if(s)console.log("==> retrieveFiltersFromIds / Error: Roots are not compliant with the session"),console.log(s),e.callback({success:[],failure:[s]});else{var o=[].concat(n);t._getRootsInSession().forEach(e=>{e.rootAlias||o.push({rootId:e.rootId,serviceId:e.serviceId})}),t._keepRootsAliasInSession(o).then(function(){for(var r=0;r<i.success.length;r++){var n=i.success[r];t.setFilterSpecification({specification:{type:"NGFilter_RetrieveFilter",data:{addedNodesList_LogicalID:n.addedNodesList_LogicalID,excludedNodesList_LogicalID:n.excludedNodesList_LogicalID,proximityNodesList_LogicalID:n.proximityNodesList_LogicalID,addedNodesList_PhysicalID:n.addedNodesList_PhysicalID,excludedNodesList_PhysicalID:n.excludedNodesList_PhysicalID,proximityNodesList_PhysicalID:n.proximityNodesList_PhysicalID,volumeUsed:t.optionsToKeep.volumeFilterAvailable,contextUsed:t.optionsToKeep.selectionFilterAvailable,attributeUsed:t.optionsToKeep.attributeFilterAvailable,filterId:n.filterPhysicalId,filterName:n.filterName,filterTitle:n.filterTitle,dropOption:e.fromDropOnFilter?"dropOnFilter":"drop",filterMdl:n.filterUIComponents,filterUIComponents:n.filterUIComponents,filterDescription:n.filterDescription,serviceId:n.serviceId}},rootID:n.rootPhysicalId,rootAlias:t._mRootsDataInSession.get(n.rootPhysicalId).rootAlias,applyFilter:e.fromDropOnFilter=1,displayFilter:1});var s=a.computeUXId(t._NGFUXId,n.rootPhysicalId);t._subscribe0&&(t._subscribe0.unsubscribe("NGFilter.ApplyDroppedFilters/"+s),t._subscribe0=void 0),t._callbackOnDrop||(t._callbackOnDrop={}),t._callbackOnDrop[s]=e.callback,t._subscribe0=c.subscribe("NGFilter.ApplyDroppedFilters/"+s,t._applyFilterOnDrop.bind(t))}})}}}else i.success||(i.success=[]),i.failure||(i.failure=[{eventID:"error",msg:d.get("retriveFilterFailed")+(i?"\n"+i.toString():"")}]),t._callbackOnDrop=e.callback,t._callbackOnDrop(i),t._callbackOnDrop=void 0},function(t){e.callback({success:[],failure:[{eventID:"error",msg:t}]})})},function(t){e.callback({success:[],failure:[{eventID:"error",msg:t}]})})}else console.log("**** ERROR FilterBIComponentProxy : tenant has to be updated : newTenant = "+e.droppedEnvId+", previous tenant ="+this._tenantId)},_fromBIFilterToNGFUX:function(e){this._dropOption=e.dropOption,e.rootServiceId=e.serviceId||"3DSpace"},retrieveFilters:function(e){return e.filterObjects[0].objectId?(e.droppedEnvId=e.filterObjects[0].envId,this.retrieveFiltersFromIds(e)):e.filterIds?(e.droppedEnvId||(e.droppedEnvId=e.filterObjects[0].envId),this.retrieveFiltersFromIds(e)):void console.log("*********** FilterBIComponentProxy.retrieveFilters KO : use filterId instead of filterName")},_applyFilterOnDrop:function(t){if(t.success&&t.success.length){var i=a.computeUXId(this._NGFUXId,t.success[0].rootId);if(this._callbackOnDrop&&this._callbackOnDrop[i]){this._setFocusToWidget();for(var r=t.success.length,n=0;n<r;n++){var s,o=a.getCVQueryType(t.success[n].filter);if(t.success[n].hideChildren=this._checkCutInfo(t.success[n].filter[o]),"tbd"===t.success[n].filter&&(s=!0,t.success[n].filter=this.getQueriesInSession(t.success[n].rootId)?this.getQueriesInSession(t.success[n].rootId):void 0,t.success[n].filter)){t.success[n].filter.objQuery&&(t.success[n].filter=e.merge(t.success[n].filter,t.success[n].filter.objQuery),delete t.success[n].filter.objQuery),t.success[n].filter.objQueryV2&&(t.success[n].filter.CVQueryV2=t.success[n].filter.objQueryV2,delete t.success[n].filter.objQueryV2);var l=this._mRootsDataInSession.has(t.success[n].rootId)?this._mRootsDataInSession.get(t.success[n].rootId).rootAlias:void 0;t.success[n].rootAlias=l,t.success[n].fromDropOnFilter="dropOnFilter"===t.success[n].dropOption,t.success[n].filterId=t.success[n].filter.filterId}t.success[n].filter&&!s&&(c.publish("NGFilter.SynchroBIOnFilter/"+this._NGFUXId,{rootId:t.success[n].rootId,filter:t.success[n].filter,filterId:t.success[n].filterId,fromDropOnFilter:t.success[n].fromDropOnFilter,tagsInMdl:t.success[n].fromDropOnFilter?void 0:t.success[n].tagsInMdl}),!0!==t.success[n].fromDropOnFilter?(this._updateFilteredRootsInSession(t.success[n].rootId,t.success[n].filter),this._tagsToSet=t.success[n].tagsInMdl):this._updateFilteredRootsInSession(t.success[n].rootId),t.success[n].filterId&&this._keepFilterIdInSession(t.success[n].rootId,t.success[n].filterId),this._shareFilterSpec&&this._keepShareSpec(t.success[n]),t.success[n].fromDropOnFilter?a.setPerformanceTracker(this._widgetId,"NGF-DropFilterOnFilter","NGFilter_Proxy",{Drop_Filter_duration:Date.now()-this._retrieveFilter_time0},1):a.setPerformanceTracker(this._widgetId,"NGF-DropFilter","NGFilter_Proxy",{Drop_Filter_duration:Date.now()-this._retrieveFilter_time0},1)),sessionStorage.setItem("NGF_tagMgtRunning_"+i,!1),t.success[n].filter&&this.cleanUselessDataForApps(t.success[n].filter),t.success[n].tagsInMdl&&delete t.success[n].tagsInMdl}console.log((t.success,t.success)),this._callbackOnDrop[i](t)}this._callbackOnDrop&&this._callbackOnDrop[i]&&(this._callbackOnDrop[i]=void 0)}else if(t.failure&&t.failure.length){i=a.computeUXId(this._NGFUXId,t.failure[0].rootId);this._callbackOnDrop&&this._callbackOnDrop[i]&&(this._callbackOnDrop[i](t),this._callbackOnDrop[i]=void 0)}},_onSynchroBI:function(e){e.filter&&e.filter.widget!==this._widgetId&&(e.filter&&(e.fromDropOnFilter?this._updateFilteredRootsInSession(e.rootId):this._updateFilteredRootsInSession(e.rootId,e.filter)),e.filterId&&this._keepFilterIdInSession(e.rootId,e.filterId),this._tagsToSet=e.tagsInMdl,this._fromSynchro=!0)},setVolatileTags:function(e){if(this.myTagProxy||this._taggerWiWiManager){if(e.summary){this._setPathTagsWithSynthesis||this._fetchWithSynthesis?(this._volatileTags=e.summary,this._facetsToFeedTagger=this._facetsToFeedTagger.concat(e.summary),this._setTagsWIWIOr3DD(null,this._facetsToFeedTagger)):(this._summary=this._summary.concat(e.summary),this._volatileTags=e.summary,this._setTagsWIWIOr3DD(null,this._summary));for(var t=0;t<e.summary.length;t++){var i=e.summary[t].sixw;-1===this._keepVolatileTags.indexOf(i)&&this._keepVolatileTags.push(i)}}if(e.colorMap){for(var r in e.colorMap)e.colorMap.hasOwnProperty(r)&&-1===this._keepVolatileTags.indexOf(r)&&this._keepVolatileTags.push(r);n.getOption("fromWebInWin")?this._taggerWiWiManager.setColorMap(e.colorMap):this.myTagProxy.setColorMap(e.colorMap)}delete this._setVolatilesSummariesAfterProxyCreation}else this._setVolatilesSummariesAfterProxyCreation=e},checkVolatileTags:function(e){var t,i,r,n={isVolatileTag:!1};if(r=this.volatileTags,!e)return this.volatileTags={},n;for(var s in r)r.hasOwnProperty(s)&&void 0===e[s]&&delete this.volatileTags[s];for(var o in e)if(e.hasOwnProperty(o)&&this._keepVolatileTags.indexOf(o)>-1){if(i=e[t=o],!this.volatileTags[t])return this.volatileTags[t]=i,n.isVolatileTag=!0,n.predicateName=t,n;if(i.length===this.volatileTags[t].length)return this.volatileTags[t]=i,n.isVolatileTag=!0,n.predicateName=t,n}return n},completeCVQueryWithAppSpecs:function(e,t,i){return o.completeCVQueryWithAppSpecs(e,t,i)},completeCVQueryWithAppParams:function(e,t,i){return o.completeCVQueryWithAppParams(e,this.getAppQueryParam(),t,i)},_onCloseFilterPanel:function(e){"dataFilterPanelCtn"===e.tag&&("dropOnFilter"===this._dropOption&&this._expandWithSynthesis&&this.refreshTagger(),this.dispatchEvent("NGFilter_CloseAbstract",e),this._getAllRootsInSession().forEach(e=>{var t=a.computeUXId(this._NGFUXId,e);sessionStorage.setItem("NGF_tagMgtRunning_"+t,!1)}),this._fromSynchro&&(this._fromSynchro=void 0))},_onOpenFilterPanel:function(e){"taggerCtn"===e.tag&&("dropOnFilter"===this._dropOption&&this._expandWithSynthesis&&this.refreshTagger(),this.dispatchEvent("NGFilter_CloseAbstract",e),this._getAllRootsInSession().forEach(e=>{var t=a.computeUXId(this._NGFUXId,e);sessionStorage.setItem("NGF_tagMgtRunning_"+t,!1)}))},_onFilterVolume:function(e){this._NGFUXId===e.NGFUXId&&this.optionsToKeep.volumeFilterAvailable&&this.dispatchEvent("NGFilter_VolumeAbstract",e)},setVolume:function(e){this.setVolumeFilter(e)},setVolumeFilter:function(e){var t,i=e.volume;if(i){e.NGFUXId=this._NGFUXId,e.appId=this._NGFUXId;var r=i.root_path_physicalid;if(r&&r.length){t=r[0][0];var s=e.filteredRoot||t;e.rootId=s,e.rootAlias="",e.UXId=a.computeUXId(this._NGFUXId,s);var o=[];"proximity"===i.type||"space"===i.type?r[0].forEach(function(e){o.push(e)}):o.push(t),o.push(s);var l=this;n.getInfosFromIds(o,!0).then(function(t){for(var i=[],r=o.length-1,n=t.length,a=0;a<r;a++)for(var u=0;u<n;u++)if(o[a]===t[u].id){i.push(t[u].label);break}var c=t.findIndex(function(e){return s===e.id});-1!==c&&(e.rootAlias=t[c].label),l._updateVolumeFilter(e,i)},function(t){l._updateVolumeFilter(e)})}}void 0===t&&c.publish("NGFilter_CancelVolumeDefined",{NGFUXId:this._NGFUXId})},_updateVolumeFilter:function(e,t){if(e.volume.root_path_alias=t,e.id){var i=e.id.split("_");if(2<=i.length){var r=i[1].split("-");2<=r.length&&(e.specId=parseInt(r[0]),e.setId=parseInt(r[1]))}}this.setFilterSpecification({specification:{type:"NGFilter_VolumeDefined",data:e},volumeUsed:!0,UXId:e.UXId,rootID:e.rootId,rootAlias:e.rootAlias,applyFilter:0,displayFilter:1})},_onViewChange:function(e){if(this._widgetId===e.id){var t={type:e.type,NGFUXId:this._NGFUXId,widgetId:this._widgetId};c.publish("NGFilter_ViewChange",t)}},setProxyAsMaster:function(e){this.optionsToKeep.synthesis_priority=1},getExpandSpec:function(t,i,r){t=Array.isArray(t)?t:[t];var n={},s=a.buildV2GraphProperty(this.getAppQueryParam());(n={batch:{}}).batch.expands=[];for(let a=0;a<t.length;a++){const p=t[a];var o=this.getQueriesInSession(p)&&!this.getQueriesInSession(p).fakeFilter?this.getQueriesInSession(p).objQueryV2:void 0;if(i.groupingIntent){var u=l._internalComputeGroupingTags(i.groupingIntent[0],!0);i.groupingIntent[0].other?n.batch.expands.push(this._internalGetGroupingSpec(o,p,u,s,"labelPrefix","Other","Other",!1)):(n.batch.expands.push(this._internalGetGroupingSpec(o,p,u,s,"labelPrefix","KeepInst","Inst",!1)),n.batch.expands.push(this._internalGetGroupingSpec(o,p,u,s,"labelPrefix","KeepRef","Ref",!1)))}if(i.expandIntent){var c={};o?c.filter=o.objQueryV2.batch.expands[0].filter:c=l.emptyFilterFormat(p);var d=e.clone(l.updateWithAppParams(p,c,i.expandIntent)),h=e.clone(this.completeCVQueryWithAppParams(d,this._expandIterParam,this._expandWithSynthesis));h.root=p,h.label=r+"_"+p+"_expand",h.graph=s,h.aggregation_processors=o?o.objQueryV2.batch.expands[0].aggregation_processors:[],this._completeCVQueryForExpand(i.expandIntent,h,n),n.batch.expands.push(h)}}return e.clone(n)},_completeCVQueryForExpand:function(e,t,i){var r=e?e.expandIntent:null;r&&r.tagger_select?(l.selectionAggrProcessors(r.tagger_select,t),l.selectionOutputs(i)):r&&r.find_subpaths&&l.subPathAggrProcessors(r.tagger_select,t)},getSequenceFilterFromAppIntent:function(e){var t=e?e.V2:null;if(t&&t.tagger_select){var i=l.taggerSelectFormat(t.tagger_select);return i?i.sequence_filter:null}if(t&&t.find_subpaths){var r=l.appSubPathsFormat(t.find_subpaths);return r?r.or.filters[0].sequence_filter:null}if(t&&t.find_in_context){var n=l.appSequenceFormat(t.find_in_context);return n?n.sequence_filter:null}console.log("getSequenceFilterFromAppIntent, non supported case "+JSON.stringify(e))},buildSpecFromAppIntent:function(e){var t=e?e.V2:null;return t&&t.tagger_select?l.taggerSelectFormat(t.tagger_select):t&&t.find_subpaths?l.appSubPathsFormat(t.find_subpaths):t&&t.find_in_context?l.appSequenceFormat(t.find_in_context):void console.log("getSequenceFilterFromAppIntent, non supported case "+JSON.stringify(e))},GetFilterSpec:function(e,t){return this.getFilterSpec(e,t)},getFilterSpec:function(e,t){var i=this.getQueriesInSession(e);return this._internGetFilterSpec(e,i,t)},getFilterIdSpec:function(e,t){var i=this;return new u(function(r,s){o.getCompletedQueriesFromFilterIds([e],i._tenantId).then(function(e){if(e.success){var o=e.success[0].rootPhysicalId,a={},l={};if(e.success[0]){var u,c;if(a={CVQuery:e.success[0].CVQuery,CVQuery3D:e.success[0].CVQuery3D},e.success[0].CVQueryV2)e.success[0].CVQueryV2.filter?(u=e.success[0].CVQueryV2.filter,c=e.success[0].CVQueryV2.aggregation_processors):(u=e.success[0].CVQueryV2.batch.expands[0].filter,c=e.success[0].CVQueryV2.batch.expands[0].aggregation_processors),l=n.getProgressiveQueryTemplate(o,u,c),a.objQueryV2=l;else console.log("getFilterIdSpec ERROR : missing CVQueryV2"+e.success),s({msg:d.get("invalidFilterId"),eventID:"warning"});var h=i.completeCVQueryWithAppParams(a,i._expandIterParam);r(i._internGetFilterSpec(o,h,t))}}e.failure&&s({msg:d.get("invalidFilterId"),eventID:"warning"})})})},_internGetFilterSpec:function(t,i,r){if((i||r)&&(!(i&&i.fakeFilter&&r.V1)||Object.keys(r.V1).length)&&(!(i&&i.fakeFilter&&r.V2)||Object.keys(r.V2).length)&&(i||!r.V1||Object.keys(r.V1).length)&&(i||!r.V2||Object.keys(r.V2).length)){if(r.V1&&this._queryFormat){var n={};if(r.V1.groupingFilter){if(i&&!i.fakeFilter)return void console.log("*** ERROR * - getFilterSpec, called on group fake node, with already user filter");var s=a.groupingFilterV1Format(t,r.V1.groupingFilter);i.objQuery=this.completeCVQueryWithAppParams("string"==typeof s?JSON.parse(s):s,"1",this._expandSynthesisON),i.objQuery.CVQuery3D&&delete i.objQuery.CVQuery3D,n=e.clone(i.objQuery)}else{if(!i){i={};var o=a.emptyFilterV1Format(t);i.objQuery=this.completeCVQueryWithAppParams("string"==typeof o?JSON.parse(o):o,this._expandIterParam,this._expandSynthesisON)}Object.keys(r.V1).length?(i.objQuery&&i.objQuery.CVQuery&&(n.CVQuery=UWA.clone(this.completeCVQueryWithAppSpecs(i.objQuery.CVQuery,r.V1))),i.objQuery&&i.objQuery.CVQuery3D&&(n.CVQuery3D=UWA.clone(this.completeCVQueryWithAppSpecs(i.objQuery.CVQuery3D,r.V1)))):n=e.clone(i.objQuery)}return n}if(r.V2){var u={},c=r.V2;if(r.V2.groupingFilter){console.log("***** do not use getFilterSpec on grouping V2, appropriate API is getExpandSpec");let e={};e.predicate=r.V2.groupingFilter.groupingPredicate;var d=[];for(let e=0;e<r.V2.groupingFilter.groupingTags.length;e++){r.V2.groupingFilter.groupingTags[e];d.push({object:r.V2.groupingFilter.groupingTags[e][0]})}return e.object=d,this.getExpandSpec(t,{groupingIntent:e})}if(i){var h={filter:i.objQueryV2.batch.expands[0].filter,aggregation_processors:i.objQueryV2.batch.expands[0].aggregation_processors};u=e.clone(l.updateWithAppParams(t,h,c))}else{var p=l.emptyFilterFormat(t);u=e.clone(l.updateWithAppParams(t,p,c))}return u}}},getGroupingSpec:function(e,t,i){var r=[];if(!(1<t.length)){for(var s=t[0].predicate,o=(e[0][0],n.getProgressiveQueryTemplate()),u=a.buildV2GraphProperty(this.getAppQueryParam()),c=0;c<e.length;c++){var d=e[c].length,h=e[c][d-1],p="GroupingSynthesis_"+c,f="OtherSynthesis_"+c;r.push(p),r.push(f);var g=this.getQueriesInSession(h)&&!this.getQueriesInSession(h).fakeFilter?this.getQueriesInSession(h).objQueryV2:void 0,_=l._internalComputeGroupingTags(t[0]);o.batch.expands.push(this._internalGetGroupingSpec(g,h,_,u,i,p,"Inst",!0)),o.batch.expands.push(this._internalGetGroupingSpec(g,h,_,u,i,p,"Ref",!0)),o.batch.expands.push(this._internalGetGroupingSpec(g,h,_,u,i,f,"Other",!0))}return o.outputs={facet_name:"ds6w",include_predicates:[s],synthesis:r},o}console.log("**** ERROR * getGroupingSpec : Group on SEVERAL predicates not supported")},_internalGetGroupingSpec:function(e,t,i,r,s,o,a,u){var c={},d={},h="Other"===a?"and_not":"and";d[h]={},"and"===h?(d[h].filters=[],d[h].filters=l.tagGroupingFormat(t,i,r,a).filters):d[h]=l.tagGroupingFormat(t,i,r,a),c.aggregation_processors=l.groupingAggrProcessorsFormat(t,o,i,a,u);var p=n.getProgressiveExpandItemTemplate(t,d);c.filter=p.filter,e&&("and_not"===h?(delete c.filter.and_not.left,c.filter.and_not.left={},c.filter.and_not.left.or={},c.filter.and_not.left.or.filters=[],c.filter.and_not.left.or.filters.push(e.batch.expands[0].filter)):c.filter.and.filters.push(e.batch.expands[0].filter)),c.root=p.root;var f="Other"===a?"Other":"Grouping";return c.label=s+"_"+t+"_"+f,r&&(c.graph=r),c},HasFilter:function(e){return this.hasFilter(e)},hasFilter:function(e){var t={hasFilter:!1},i=this.getQueriesInSession(e);return i&&i.objQuery&&(i.fakeFilter?t.hasFilter=!1:(t.hasFilter=!0,t.filterId=i.filterId)),t},shareFilterSpec:function(e){var t=this;e.serviceId=e.serviceId||"3DSpace";var i=this._areRootsCompliantWithSession({rootId:e.fromRootId,serviceId:e.serviceId});if(i)console.log("==> shareFilterSpec / Error: Roots are not compliant with the session"),console.log(i),e.callback({success:[],failure:[i]});else{a.setUsageTracker(this._widgetId,"NGF-Tagger-Share",this._getAppId());var r=a.computeUXId(this._NGFUXId,e.fromRootId);this._callbackOnDrop||(this._callbackOnDrop={}),this._callbackOnDrop[r]=e.callback;var n=this._getAllRootsInSession(),s=[];if((n?n.find(function(t){return t===e.fromRootId}):void 0)?s.push(e.fromRootId):n.push(e.fromRootId),s&&s.length)e.callback({success:[],failure:[{msg:d.get("dropFilterOnSameRoot"),eventID:"warning"}]});else{this._subscribe&&this._subscribe[r]&&(this._subscribe[r].unsubscribe("NGFilter.ApplyDroppedFilters/"+r),this._subscribe[r]=void 0);var o=e.fromSourceCtx.NGFUXId||e.fromSourceCtx.appId;c.subscribe("NGF_sh_filteredMdlsResponse/"+o,function(i){c.unsubscribe("NGF_sh_filteredMdlsResponse/"+o);var n=i.fromSourceCtx.NGFUXId||i.fromSourceCtx.appId;o===n&&(t._subscribe||(t._subscribe={}),t._subscribe[r]=c.subscribe("NGFilter.ApplyDroppedFilters/"+r,t._applyFilterOnDrop.bind(t)),t.setFilterSpecification({specification:{type:"NGFilter_ShareFilterSpec",data:{rootID:i.fromRootId,rootAlias:i.rootAlias,filterId:i.filterId,dropOption:e.fromDropOnFilter?"dropOnFilter":"drop",filterMdl:i.filterMdl,filterUIComponents:i.filterMdl,volumeUsed:i.volumeUsed,contextUsed:i.contextUsed,attributeUsed:i.attributeUsed,configUsed:i.configUsed,queryFormat:i.queryFormat,serviceId:i.serviceId}},rootID:i.fromRootId,rootAlias:i.rootAlias,applyFilter:e.fromDropOnFilter=1,displayFilter:1}))}),c.publish("NGF_sh_filteredMdls/"+o,e)}}},linkWith:function(e){var t=this,i=!1;(!this._mRootsDataInSession||this._mRootsDataInSession&&0===this._mRootsDataInSession.size)&&(i=!0),this._widgetId===e.srcWgtId?i?e.callback({success:"link done",failure:[]}):c.subscribe("NGF_link_done/"+e.srcWgtId,function(t){c.unsubscribe("NGF_link_done/"+e.srcWgtId),e.callback({success:"link done",failure:[]})}):(c.subscribe("NGF_lnkUnlnk_srcDataResponse/"+this._widgetId,function(r){c.unsubscribe("NGF_lnkUnlnk_srcDataResponse/"+t._widgetId);var n=JSON.parse(r);if(n.rootID&&n.rootID.length){var s={rootID:n.rootID,rootAlias:n.rootAlias,specification:{type:"NGFilter_Link",data:{NGFUXId:n.NGFUXId,widgetId:e.srcWgtId,rootID:n.rootID,rootAlias:n.rootAlias,volumeUsed:n.volumeUsed,contextUsed:n.contextUsed,attributeUsed:n.attributeUsed,configUsed:n.configUsed,queryFormat:n.queryFormat,eventName:"NGF_link_done"}},applyFilter:1};t.setFilterSpecification(s)}else i=!0;var o=t._NGFUXId;t._NGFUXId=n.NGFUXId,t._NGFUXIdImpact({type:"subscribeEvents",data:{NGFUXId:n.NGFUXId,toClean:o}}),t._NGFUXIdImpact({type:"criteriaAvaibility",data:{identifier:n.NGFUXId+"-"+t._widgetId,volumeFilterUsed:t.optionsToKeep.volumeFilterAvailable,selectionFilterUsed:t.optionsToKeep.selectionFilterAvailable,attributeFilterUsed:t.optionsToKeep.attributeFilterAvailable,configFilterUsedfigAvaibility:t._configUsed,toClean:o+"-"+t._widgetId}}),t._NGFUXIdImpact({type:"queryFormat",data:{identifier:n.NGFUXId+"-"+t._widgetId,queryFormat:t._queryFormat,toClean:o+"-"+t._widgetId}}),t._mRootsDataInSession=new Map(Object.entries(n.BIData)),t._tagsToSet=n.tags,i?e.callback({success:"link done",failure:[]}):c.subscribe("NGF_link_done/"+e.srcWgtId,function(t){c.unsubscribe("NGF_link_done/"+e.srcWgtId),e.callback({success:"link done",failure:[]})})}),c.publish("NGF_lnkUnlnk_srcData/"+e.srcWgtId,this._widgetId))},unlink:function(e){var t=this;this._widgetId===e.srcWgtId?c.subscribe("NGF_unlink_done/"+e.srcWgtId,function(t){c.unsubscribe("NGF_unlink_done/"+e.srcWgtId),e.callback({success:"unlink done",failure:[]})}):this._widgetId===e.widgetId&&this._NGFUXId!==e.NGFUXId&&(c.subscribe("NGF_lnkUnlnk_srcDataResponse/"+t._widgetId,function(i){c.unsubscribe("NGF_lnkUnlnk_srcDataResponse/"+t._widgetId);var r=JSON.parse(i);if(t._NGFUXId=e.NGFUXId,t._NGFUXIdImpact({type:"subscribeEvents",data:{NGFUXId:e.NGFUXId,toClean:e.srcWgtId}}),t._NGFUXIdImpact({type:"criteriaAvaibility",data:{identifier:e.NGFUXId+"-"+t._widgetId,volumeFilterUsed:t.optionsToKeep.volumeFilterAvailable,selectionFilterUsed:t.optionsToKeep.selectionFilterAvailable,attributeFilterUsed:t.optionsToKeep.attributeFilterAvailable,configFilterUsedfigAvaibility:t._configUsed,toClean:e.srcWgtId+"-"+t._widgetId}}),t._NGFUXIdImpact({type:"queryFormat",data:{identifier:e.NGFUXId+"-"+t._widgetId,queryFormat:t._queryFormat,toClean:e.srcWgtId+"-"+t._widgetId}}),r.rootID&&r.rootID.length){var n={rootID:r.rootID,rootAlias:r.rootAlias,specification:{type:"NGFilter_Unlink",data:{NGFUXId:r.NGFUXId,widgetId:e.srcWgtId,rootID:r.rootID,rootAlias:r.rootAlias,volumeUsed:r.volumeUsed,contextUsed:r.contextUsed,attributeUsed:r.attributeUsed,configUsed:r.configUsed,queryFormat:r.queryFormat,eventName:"NGF_unlink_done"}},applyFilter:1};t.setFilterSpecification(n)}c.subscribe("NGF_unlink_done/"+e.srcWgtId,function(t){c.unsubscribe("NGF_unlink_done/"+e.srcWgtId),e.callback({success:"unlink done",failure:[]})})}),c.publish("NGF_lnkUnlnk_srcData/"+e.srcWgtId,this._widgetId))},refreshTagger:function(){this._fetchWithSynthesis?this.setTagsWithFetchSynthesis(this._getAllRootsInSession()):this._expandWithSynthesis&&this._proxyFeedsTagger&&this._setTagsWithFilteredExpandSynthesis()},RetrievePrdFromFilterId:function(e){return this.retrieveRootFromFilterId(e,!1)},retrieveRootFromFilterId:function(e,t){var i=this;return new u(function(r,s){if(e.length>1)s({msg:d.get("multiFiltersDrop"),eventID:"warning"});else{var o=e[0];n.getPlatformServices(i._tenantId).then(function(){a.getFilterDataFromFilterId(o,i._tenantId).then(function(e){if(e.success){var n=e.success[0];t&&this.setFilterSpecification({specification:{type:"NGFilter_RetrieveRoot",data:{filterId:o,dropOption:"dropOnFilter",serviceId:n.serviceId,configUsed:i._configUsed,volumeUsed:i.optionsToKeep.volumeFilterAvailable,contextUsed:i.optionsToKeep.selectionFilterAvailable,attributeUsed:i.optionsToKeep.attributeFilterAvailable}},rootID:n.rootPhysicalId,rootAlias:i._mRootsDataInSession.get(n.rootPhysicalId).rootAlias,applyFilter:0,displayFilter:1}),r(n.rootPhysicalId)}else s({msg:d.get("invalidFilterId"),eventID:"warning"})})})}})},_checkCutInfo:function(e){var t=!1;if(e&&e.sequence_filter)"seq_cut"===e.sequence_filter.option&&(t=!0);else{var i=a.getCombinationQuery(e);if(i){var r=a.getQueryExpand(i);if(r&&r[0].sequence_filter)-1!==r[0].sequence_filter[0].option.indexOf("seq_cut")&&(t=!0)}}return t},_setFocusToWidget:function(){widget&&widget.dispatchEvent("onViewRequest",{focus:!0})},getCtxForSharing:function(){return this._shareFilterSpec?{appId:this._NGFUXId,widgetId:this._widgetId}:void 0},areRootsSharable:function(e,t){var i=Array.isArray(e)?e:[e];return new Promise(function(e,r){var n=t.NGFUXId||t.appId;c.subscribe("NGF_sh_filteredRootsResponse/"+n,function(t){c.unsubscribe("NGF_sh_filteredRootsResponse/"+n),e(t)}),c.publish("NGF_sh_filteredRoots/"+n,{rootIds:i,widgetId:t.widgetId})})},_allSharingSpecEvents:function(){c.subscribe("NGF_sh_filteredRoots/"+this._NGFUXId,this._onSourceFilteredRootsCB.bind(this)),c.subscribe("NGF_sh_filteredMdls/"+this._NGFUXId,this._onSourceShareFilterSpecCB.bind(this))},_allLinkingWgtsEvents:function(){c.subscribe("NGF_lnkUnlnk_srcData/"+this._widgetId,this._onSourceDataForLnkUnlnk.bind(this))},_NGFUXIdImpact:function(e){var t=e.type,i=e.data;switch(t){case"subscribeEvents":c.subscribe("onApplyNGFilter/"+i.NGFUXId,this.onApplyNGFilter.bind(this)),this._subscribeSynchro=c.subscribe("NGFilter.SynchroBIOnFilter/"+i.NGFUXId,this._onSynchroBI.bind(this)),i.toClean&&(c.unsubscribe("onApplyNGFilter/"+i.toClean),c.unsubscribe("NGFilter.SynchroBIOnFilter/"+i.toClean));break;case"criteriaAvaibility":var r=i.identifier;sessionStorage.setItem("NGFilter_Volume_"+r,i.volumeFilterUsed),sessionStorage.setItem("NGFilter_Context_"+r,i.selectionFilterUsed),sessionStorage.setItem("NGFilter_Attribute_"+r,i.attributeFilterUsed),i.toClean&&(sessionStorage.removeItem("NGFilter_Volume_"+i.toClean),sessionStorage.removeItem("NGFilter_Context_"+i.toClean),sessionStorage.removeItem("NGFilter_Attribute_"+i.toClean));break;case"queryFormat":sessionStorage.setItem("NGFilter_ExpandType_"+i.identifier,i.queryFormat),i.toClean&&sessionStorage.removeItem("NGFilter_ExpandType_"+i.toClean)}},_onSourceDataForLnkUnlnk:function(e){var t=this._getAllFilteredRootsInSession(),i=[];for(let e=0;e<t.length;e++)i.push(this._mRootsDataInSession.get(t[e])?this._mRootsDataInSession.get(t[e]).rootAlias:"");var r={NGFUXId:this._NGFUXId,BIData:Object.fromEntries(this._mRootsDataInSession.entries()),tags:this._tagsToSet,volumeUsed:this.optionsToKeep.volumeFilterAvailable,configUsed:this._configUsed,attributeUsed:this.optionsToKeep.attributeFilterAvailable,contextUsed:this.optionsToKeep.selectionFilterAvailable,queryFormat:this._queryFormat,rootID:t,rootAlias:i};c.publish("NGF_lnkUnlnk_srcDataResponse/"+e,JSON.stringify(r))},_onSourceFilteredRootsCB:function(e){var t=[];if(this._shareFilterSpec&&this.optionsToKeep.widgetId===e.widgetId){for(var i=0;i<e.rootIds.length;i++){var r=!!this.hasFilter&&this.hasFilter(e.rootIds[i]).hasFilter;t.push({rootId:e.rootIds[i],hasFilter:r})}c.publish("NGF_sh_filteredRootsResponse/"+this._NGFUXId,t)}},_onSourceShareFilterSpecCB:function(t){var i=t.fromSourceCtx.NGFUXId||t.fromSourceCtx.appId;if(this._shareFilterSpec&&this._NGFUXId===i){var r=this.hasFilter(t.fromRootId);if(r&&r.hasFilter){t.filterId=r.filterId;var n=e.merge(t,this._shareSpec[t.fromRootId]);c.publish("NGF_sh_filteredMdlsResponse/"+this._NGFUXId,n)}else console.log("_onSourceShareFilterSpecCB’, filter not applied in widget1 ")}},_keepShareSpec:function(e){if(this._shareFilterSpec){this._shareSpec||(this._shareSpec={});var t=e.filterRootIds?e.filterRootIds[0]:e.rootId;this._shareSpec[t]={},this._shareSpec[t].filterMdl=e.filterMdl,this._shareSpec[t].rootAlias=e.filterRootAlias?e.filterRootAlias[0]:e.rootAlias,this._shareSpec[t].filterTitle=e.filterTitle,this._shareSpec[t].filterId=e.filterId}},setFilterSpecification:function(e){var t=this._mRootsDataInSession.get(e.rootID),i=t?t.serviceId:this._defaultServiceId,r=this._NGFUXId,n={NGFUXId:r,widgetTenant:this._tenantId,appId:r,widgetId:this.optionsToKeep.widgetId,rootID:e.rootID,rootAlias:e.rootAlias,configUsed:this._configUsed,volumeUsed:this.optionsToKeep.volumeFilterAvailable,contextUsed:this.optionsToKeep.selectionFilterAvailable,attributeUsed:this.optionsToKeep.attributeFilterAvailable,appQueryParam:this.getAppQueryParam(),UXId:e.UXId||a.computeUXId(r,e.rootID),filterToApply:e,securityContext:this._defaultSC,queryFormat:this._queryFormat,serviceId:e.serviceId||i};c.publish("Frame3DXInfra.Update",{type:"Filter",options:n})},setStatus:function(e){this.myTagProxy?this.myTagProxy.setStatus(e):console.log("*****  ERROR : FilterBIComponentProxy.setStatus, tagger Proxy undefined")},setAppQueryParam:function(e){var t=e?JSON.stringify(e):{};sessionStorage.setItem("NGFilter_AppQueryParam_"+this._NGFUXId+"_"+this._widgetId,t)},getAppQueryParam:function(){var e=sessionStorage.getItem("NGFilter_AppQueryParam_"+this._NGFUXId+"_"+this._widgetId);return e&&Object.keys(e).length?JSON.parse(e):void 0},_copyFromAnyFilterToRoots:function(t,i,r){var s=this;i=[...new Set(i)],n.getInfosFromIds(i,!1).then(function(n){var o=n.length,a=[];i.forEach(function(e){for(var t=0;t<o;t++)if(e===n[t].id){a.push({id:n[t].id,alias:n[t].label,revision:n[t].revision,service:s._defaultServiceId});break}});var l=r?e.clone(r):{};l.resetFilter=void 0===l.resetFilter?0:l.resetFilter,l.displayNotif=0,s.setFilterSpecification({rootID:"-",rootAlias:"-",specification:{type:"NGFilter_CopyFromAnyFilterToRoots",data:{filterId:t,rootInfos:a,options:l}},applyFilter:void 0===l.applyFilter?1:l.applyFilter})})},_getAppId:function(){return"undefined"!=typeof widget&&null!==widget&&widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):this.optionsToKeep.appId?this.optionsToKeep.appId:"unknown"},cleanUselessDataForApps:function(e){e&&(e.tagsInMdl&&delete e.tagsInMdl,e.filterMdl&&delete e.filterMdl,this._queryFormat&a.EXPAND_SERVICES.progressive||delete e.CVQueryV2,this._queryFormat&a.EXPAND_SERVICES.expand||delete e.CVQuery,this._queryFormat&a.EXPAND_SERVICES.expand3d||delete e.CVQuery3D)},_areRootsCompliantWithSession:function(e,t){t=t||"MultiServiceId",e=Array.isArray(e)?e:[e];var i;switch(t){case"MultiServiceId":var r=this._getRootsInSession();if(r.length){var s=r[0].serviceId,o=n.getRootsInfos(e).filter(e=>s!==e.serviceId);o.length&&(i=function(e,t){var i={};switch(e){case"MultiServiceId":var r=t.servicedeId;i.error=e,i.msg=d.get("MultiServiceIdInSessionNotAvailable"),i.serviceId=r,i.data=t.data;break;default:i.error="RootsNotCompliantWithSession"}return i}(t,{servceId:s,data:o}))}}return i},setHighDepthTagsAvailability:function(e){console.log("FilterBIComponentProxy.setHighDepthTagsAvailability - deprecated")},_onDbg_SetCopyFromAnyFilterOnRoots:function(e){if(this._NGFUXId===e.NGFUXId&&this._widgetId===e.widgetId){var t=e.options&&e.options.eventName?e.options.eventName:"";t&&(this._eventFilterOnRoots=t,this._subscribeFilterOnRoots=c.subscribe(t,this._onDbg_CopyFromAnyFilterOnRootsCB.bind(this))),this._copyFromAnyFilterToRoots(e.filterID,e.rootIDs,e.options)}},_onDbg_CopyFromAnyFilterOnRootsCB:function(e){console.log(" Copy From Any Filter to Roots : "+e),this._subscribeFilterOnRoots.unsubscribe(this._eventFilterOnRoots),delete this._eventFilterOnRoots},_onDbg_SetConfigFilter:function(e){this._NGFUXId===e.NGFUXId&&this._widgetId===e.widgetId&&this.setFilterSpecification(e)},_onDbg_UpdateTenant:function(e){this._NGFUXId===e.NGFUXId&&this._widgetId===e.widgetId&&this.updateTenant(e.tenant)},_onDbg_SetDefaultSecurityContext:function(e){this._NGFUXId===e.NGFUXId&&this._widgetId===e.widgetId&&this.setDefaultSecurityContext(e.sc)},_onDbg_LinkUnlink:function(e){var t=this;this._queryFormat&a.EXPAND_SERVICES.expand3d&&n.getInfosFromIds(this._getRootsInSession(),!1).then(function(i){var r=[],n=[];i.forEach(function(e){r.push(e.id),n.push(e.label)}),e.rootID=r,e.rootAlias=n,"NGFilter_Link"===e.specification.type?(t.setFilterSpecification(e),t._saveNGFUXId=t._NGFUXId,t._NGFUXId=e.specification.data.NGFUXId):(t._NGFUXId=t._saveNGFUXId,delete t._saveNGFUXId,t.setFilterSpecification(e))})}})}),define("DS/ENOFilterBIUX/FilterBIComponentProxy",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","DS/TagNavigatorProxy/TagNavigatorProxy","DS/ENOFilterBIUX_ExSy/ExSy_FBIComponentProxy","DS/ENOFilterBIUX_Fetch/Fetch_FBIComponentProxy","DS/ENOFilterBIUX/FBIServices","DS/ENOFilterBIUX/FBISettings","DS/ENOFilterBIUX/FBIProxyServices","DS/ENOFilterBIUX/NGFServices","UWA/Promise","DS/PlatformAPI/PlatformAPI","i18n!DS/ENOFilterBIUX/assets/nls/ENOFilterBIUX"],function(e,t,i,r,n,s,o,a,l,u,c,d,h){"use strict";return t.extend(i,{CONFIG_FILTER:"NGFilter_ConfigDefined",init:function(e){return e.ExpandSynthesisON?this._biFilter=new n(e):this._biFilter=new s(e),this._biFilter.addEvent("FilterBIColorizeEvent",this.filterBIColorize.bind(this)),this._biFilter.addEvent("FilterBIUnColorizeEvent",this.filterBIUnColorize.bind(this)),this._biFilter.addEvent("FilterBIFilteringEvent",this.filterBIFilter.bind(this)),this._biFilter.addEvent("fetchFilterBIFilteringEvent",this.fetchFilterBIFilter.bind(this)),this._biFilter.addEvent("fetchFilterBIColorizeEvent",this.fetchFilterBIColorize.bind(this)),this._biFilter.addEvent("ColorizeVolatileEvent",this.filterBIColorizeVolatile.bind(this)),this._biFilter.addEvent("FilterVolatileEvent",this.filterBIFilterVolatile.bind(this)),this._biFilter.addEvent("ApplyNGFilterAbstract",this.NGFApplyNGFilter.bind(this)),this._biFilter.addEvent("NGFilter_VolumeAbstract",this.filterBIFilterVolume.bind(this)),this._biFilter.addEvent("NGFilter_CloseAbstract",this.filterBICloseFilterPanel.bind(this)),this._biFilter.addEvent("SaveNGFilterAbstract",this.NGFSaveNGFilter.bind(this)),this._biFilter.addEvent("FilterBIGroupingEvent",this.filterBIGrouping.bind(this)),this._biFilter.addEvent("FilterBISelectionAbstract",this.filterBISelection.bind(this)),this},cleanProxy:function(){this._biFilter.cleanProxy()},setPathTags:function(e,t){this._biFilter._setDirectTaggerMode(!1),this._biFilter.setPathTags(e,t)},removeRoot:function(e){this._biFilter.removeRoot(e)},removeRoots:function(e){this._biFilter.removeRoots(e)},setVolume:function(e){this._biFilter.setVolumeFilter(e)},setVolumeFilter:function(e){this._biFilter.setVolumeFilter(e)},updateTenant:function(e){this._biFilter.updateTenant(e)},setAppQueryParam:function(e){this._biFilter.setAppQueryParam(e)},odtSetFilters:function(e){this._biFilter.odtSetFilters(e)},odtKeepActiveFilters:function(e){this._biFilter.odtKeepActiveFilters(e)},addFilterChangeListenerThruBI:function(e){this._biFilter.addFilterChangeListenerThruBI(e)},filterBIColorize:function(e){this.dispatchEvent("FilterBIColorize",e)},filterBIColorizeVolatile:function(e){this.dispatchEvent("ColorizeVolatile",e)},filterBIUnColorize:function(e){this.dispatchEvent("FilterBIUnColorize",e)},filterBIFilter:function(e){this.dispatchEvent("FilterBIFilteringEvent",e)},fetchFilterBIFilter:function(e){this.dispatchEvent("fetchFilterBIFilteringEvent",e)},fetchFilterBIColorize:function(e){this.dispatchEvent("fetchFilterBIColorizeEvent",[e])},filterBIGrouping:function(e){this.dispatchEvent("FilterBIGroupingEvent",e)},filterBISelection:function(e){this.dispatchEvent("FilterBISelectionEvent",e)},filterBIFilterVolatile:function(e){this.dispatchEvent("FilterVolatile",e)},NGFApplyNGFilter:function(e){this.dispatchEvent("ApplyNGFilter",e)},filterBIFilterVolume:function(e){this.dispatchEvent("NGFilter_Volume",e)},filterBICloseFilterPanel:function(e){this.dispatchEvent("NGFilter_Close",e)},NGFSaveNGFilter:function(e){this.dispatchEvent("SaveNGFilter",e)},viewChange:function(){},_cleanUnFilteredTree:function(e,t,i){this._biFilter._cleanUnFilteredTree(e,t,i)},_cleanTree:function(e,t,i){this._biFilter._cleanTree(e,t,i)},setPredicates:function(e){this._predicates=e},addSubjects:function(e){null!==this.myTagProxy&&void 0!==this.myTagProxy&&this.myTagProxy.addSubjects(e)},destroy:function(){this._biFilter.destroy()},setTags:function(e,t,i){this._biFilter._setDirectTaggerMode(!0),this._biFilter._setTags(e,t,i)},unsetTags:function(){this._biFilter.unsetTags()},focusOnSubjects:function(e,t){this._biFilter.focusOnSubjects(e,t)},unfocus:function(){this._biFilter.unfocus()},toggleProxyFocus:function(e){this._biFilter.toggleProxyFocus(e)},getCurrentFilter:function(){this._biFilter.getCurrentFilter()},die:function(){this._biFilter.die()},activate:function(){this._biFilter.activate()},deactivate:function(){this._biFilter.deactivate()},setVolatileTags:function(e){this._biFilter.setVolatileTags(e)},checkVolatileTags:function(e){this._biFilter.checkVolatileTags(e)},emptyFilter:function(e){this._biFilter.emptyFilter(e)},setNGFilterOptions:function(e){this._biFilter.setNGFilterOptions(e)},resetNGFilterUI:function(e){this._biFilter.resetNGFilterUI(e)},retrieveFiltersFromIds:function(e){this._biFilter.retrieveFiltersFromIds(e)},retrieveFilters:function(e){this._biFilter.retrieveFilters(e)},setTagsWithExpandSynthesis:function(e,t){t&&console.warn("Parameter appQueryParam in setTagsWithExpandSynthesis has been deprecated since R2022xFD03"),this._biFilter.setTagsWithExpandSynthesis(e,t)},setTagsWithFetchSynthesis:function(e,t,i){this._biFilter._setDirectTaggerMode(!1),this._biFilter.setTagsWithFetchSynthesis(e,t,i)},setSynthesisMode:function(e){this._biFilter.setSynthesisMode(e)},completeCVQueryWithAppSpecs:function(e,t,i){return this._biFilter.completeCVQueryWithAppSpecs(e,t,i)},getSequenceFilterFromAppIntent:function(e){return this._biFilter.getSequenceFilterFromAppIntent(e)},buildSpecFromAppIntent:function(e){return this._biFilter.buildSpecFromAppIntent(e)},getExpandSpec:function(e,t,i){return t&&t.expandIntent&&t.expandIntent.appQueryObj&&console.warn("appQueryObj key in getExpandSpec has been deprecated since R2022xFD04"),this._biFilter.getExpandSpec(e,t,i)},GetFilterSpec:function(e,t){return this._biFilter.GetFilterSpec(e,t)},getFilterSpec:function(e,t){return t&&t.expandIntent&&t.expandIntent.appQueryObj&&console.warn("appQueryObj key in getFilterSpec has been deprecated since R2022xFD04"),this._biFilter.getFilterSpec(e,t)},getGroupingSpec:function(e,t,i){for(var r=0;r<e.length;r++)if(e[0][0]!==e[r][0])return void console.log("**** ERROR * getGroupingSpec, listOfInputPaths not on same root");if(e&&!(e.length>1))return this._biFilter.getGroupingSpec(e,t,i);console.log("*** ERROR * getGroupingSpec, listOfInputPaths >1 ")},setGroupingStatus:function(e){e?(e.action="grouping",this._biFilter.setStatus(e)):console.log("*****  ERROR : FilterBIComponentProxy.setGroupingStatus, no data provided ")},setSelectStatus:function(e){e?(e.action="selection",this._biFilter.setStatus(e)):console.log("*****  ERROR : FilterBIComponentProxy.setSelectStatus, no data provided ")},refreshTagger:function(){return this._biFilter.refreshTagger()},getFilterIdSpec:function(e,t){return this._biFilter.getFilterIdSpec(e,t)},HasFilter:function(e){return this._biFilter.HasFilter(e)},hasFilter:function(e){return this._biFilter.hasFilter(e)},linkWith:function(e){return this._biFilter.linkWith(e)},unlink:function(e){return this._biFilter.unlink(e)},shareFilterSpec:function(e){return this._biFilter.shareFilterSpec(e)},getCtxForSharing:function(){return this._biFilter.getCtxForSharing()},areRootsSharable:function(e,t){return this._biFilter.areRootsSharable(e,t)},RetrievePrdFromFilterId:function(e){return this._biFilter.RetrievePrdFromFilterId(e)},retrieveRootFromFilterId:function(e,t){return this._biFilter.retrieveRootFromFilterId(e,t)},setProxyAsMaster:function(e){this._biFilter.setProxyAsMaster(e)},setFilterSpecification:function(e){"NGFilter_ConfigDefined"===e.specification.type||"NGFilter_CopyFromAnyFilterToRoots"===e.specification.type?this._biFilter.setFilterSpecification(e):console.log("*** FilterBIComponentProxy.setFilterSpecification - NON SUPPORTED type :"+e.specification.type)},copyFromAnyFilterToRoots:function(e,t,i){this._biFilter._copyFromAnyFilterToRoots(e,t,i)},setDefaultSecurityContext:function(e){this._biFilter.setDefaultSecurityContext(e)},setHighDepthTagsAvailability:function(e){this._biFilter.setHighDepthTagsAvailability(e)},taggerWebInWinEvent:function(e){this._biFilter.taggerWebInWinEvent(e)}})}),define("DS/ENOFilterBIUX/FilterComponent",["UWA/Core","UWA/Class","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/ENOFilterBIUX/FilterBIComponentProxy"],function(e,t,i,r,n){return t.extend({_tree:[],init:function(e){this._nodesPath=e.nodesPath,this._widgetID=e.widgetID,this._fedSearchURL="https://vdevpril862dsy.ux.dsone.3ds.com/federated/search",this._groupedData={};this._filterBIProxy=this._instanciateProxy(),this._filterBIProxy.addEvent("FilterBIColorize",this.onTaggerColorization.bind(this)),this._filterBIProxy.addEvent("FilterBIUnColorize",this.onTaggerUnColorization.bind(this)),this._filterBIProxy.addEvent("FilterBIFilter",this.onTaggerFilter.bind(this)),this._setPredicates(["ds6w:description"]),this._filterBIProxy.setPathTags(this._nodesPath)},_buildQuery:function(){var e=this._nodesPath.nodes.length;this._currentQuery="";for(var t=0;t<e;t++)this._currentQuery+='physicalid:"'+this._nodesPath.nodes[t]+'"',e!==t+1&&(this._currentQuery+=" OR ")},fetch:function(){i.proxifiedRequest(this._fedSearchURL,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",type:"json",proxy:"passport",data:JSON.stringify({query:this._currentQuery,order_by:"asc",order_field:"update",locale:"en",nresults:40,start:0,tenant:"OnPremise",select_predicate:["ds6w:created"],label:"FBIServices"}),onComplete:this._parse.bind(this),onFailure:function(e){console.log(e)}})},_parse:function(e){var t=e.results,i=(e.facets,this);t.forEach(function(e){for(var t=e.attributes,r=[],n=0;n<t.length;n++)if("internal"!==t[n].format)if(i._groupedData[t[n].name]||(i._groupedData[t[n].name]={}),r=i._getIdPathsForID(t[0].value),i._groupedData[t[n].name][t[n].value])for(var s=0;s<r.length;s++)i._groupedData[t[n].name][t[n].value].push(r[s].id);else{i._groupedData[t[n].name][t[n].value]=[];for(var o=0;o<r.length;o++)i._groupedData[t[n].name][t[n].value].push(r[o].id)}})},_getIdPathsForID:function(e){var t=this;return this._tree.filter(function(i){var r=i.path;return e===t._nodesPath.nodes[r[r.length-1]]})},_instanciateProxy:function(){var e={widgetId:this._widgetID,tenant:"OnPremise",processingMode:"appProcessing",colorize:!0};return new n(e)},_setPredicates:function(e){this._filterBIProxy.setPredicates(e)},onTaggerColorization:function(e){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerColorization")},onTaggerUnColorization:function(e){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerUnColorization")},onTaggerFilter:function(e){console.log("RCIIIIIIIIIIIIIIIIIIIIII on FilterComponentjs.onTaggerFilter")},_findLastItems:function(e,t){for(var i,r,n={},s=0;s<t.length;s++)n[i=(r=t[s])[r.length-1]]?n[i].count+=1:n[i]={id:e[i],count:1}}})});