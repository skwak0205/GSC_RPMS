define("DS/MPFStripeComponent/CardInputs",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation","DS/MPFCartPaymentModel/CartPaymentModel","DS/UIKIT/Input/Text","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(e,t,r,n,a,i,s,o,c,d,l,m){"use strict";var p={VALID_FIELD:"validField",INVALID_FIELD:"invalidField"},h=t.extend({className:"mpf-stripe-payment-form",setup:function(e){e||(e={}),n.requiredOfPrototype(e.cart,s,"options.cart must be a CartModel"),n.requiredOfPrototype(e.me,i,"options.me must be a PersonModel"),this.cart=e.cart,this.me=e.me,this.creditCardTokenMultiUse=e.creditCardTokenMultiUse,this.waitForPaymentModel=e.waitForPaymentModel,this.isScaEnabled=!0===e.isScaEnabled,this.stripe=Stripe(e.apiKey),this.elements=this.stripe.elements(),this.cardNameHolderInput=this._createCardNameHolderInput(),this.cardNumberInput=this._createCardNumberInput(),this.cardExpiryDateInput=this._createCardExpiryDateInput(),this.cardVerificationCodeInput=this._createCardVerificationCodeInput(),this.cardParams={}},render:function(){return this.container.setContent([this._createCardNameHolderContainer(),this._createCardInputsContainers()]),this},mount:function(){this.cardNumberInput.mount("#mpf-stripe-card-number-element"),this.cardExpiryDateInput.mount("#mpf-stripe-card-expiration-element"),this.cardVerificationCodeInput.mount("#mpf-stripe-card-cvc-element")},proceedToPayment:function(){return this.isScaEnabled?this._handleCardPayment():this._createPaymentToken()},_handleCardPayment:function(){var e={};return e.billing_details={name:this.cardNameHolderInput.getValue()},this._validateCardNameHolderInput(),this.stripe.handleCardPayment(this.cart.getPaymentIntentSecret(),this.cardNumberInput,{payment_method_data:e}).then(function(e){return e.error?r.reject(e.error):r.resolve()}).then(this._waitForPaymentStateUpdate.bind(this))},_createPaymentToken:function(){var e,t,n=this,a={},i={};return a.name=this.cardNameHolderInput.getValue(),this._validateCardNameHolderInput(),this.stripe.createToken(this.cardNumberInput,a).then(function(a){return a.token?(i[s.Fields.STATE]=s.States.PENDING_PAYMENT,i.payment_token=a.token.id,"1"===n.creditCardTokenMultiUse&&(i.CreditCardTokenMultiUse="1"),e=new c(c.Operations.modify,"/",i),(t=new o).add(e),n.cart.megaPatch(t)):r.reject(a.error)}).then(this._waitForPaymentStateUpdate.bind(this))},_waitForPaymentStateUpdate:function(){var e=this;return this.waitForPaymentModel?this.waitForPaymentModel.fetchPromise().catch(function(){return r.resolve()}).then(function(){if(e.waitForPaymentModel.getState()===d.States.PAYMENT_REFUSED)return r.reject("payment refused")}):r.resolve()},_createCardNameHolderInput:function(){var e=this;return new l({placeholder:m.get("cardHolder"),value:this.me.getFirstName()+" "+this.me.getLastName(),events:{onKeyDown:function(){this.setClassName(""),e.container.getElement("#mpf-stripe-card-holder-errors").setText("")}}})},_createCardNameHolderContainer:function(){return e.createElement("div",{class:"mpf-stripe-payment-card-holder",html:e.createElement("label",{html:[e.createElement("span",{text:m.get("cardHolder")}),this.cardNameHolderInput,e.createElement("div",{id:"mpf-stripe-card-holder-errors"})]})})},_validateCardNameHolderInput:function(){0===this.cardNameHolderInput.getValue().length&&(this.cardNameHolderInput.setClassName("invalid"),this.container.getElement("#mpf-stripe-card-holder-errors").setText(m.get("cardHolderEmpty")))},_createCardNumberInput:function(){var e=this,t=this.elements.create("cardNumber",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",function(t){t.error?e.container.getElement("#mpf-stripe-card-number-errors").setContent(t.error.message):e.container.getElement("#mpf-stripe-card-number-errors").setContent("")}),t},_createCardExpiryDateInput:function(){var e=this,t=this.elements.create("cardExpiry",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",function(t){t.error?e.container.getElement("#mpf-stripe-card-expiration-errors").setContent(t.error.message):e.container.getElement("#mpf-stripe-card-expiration-errors").setContent("")}),t},_createCardVerificationCodeInput:function(){var e=this,t=this.elements.create("cardCvc",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",function(t){t.error?e.container.getElement("#mpf-stripe-card-cvc-errors").setContent(t.error.message):e.container.getElement("#mpf-stripe-card-cvc-errors").setContent("")}),t},_createCardInputsContainers:function(){return[e.createElement("div",{class:"mpf-stripe-card-number-element-container",html:e.createElement("label",{html:[e.createElement("span",{text:m.get("cardNumber")}),e.createElement("div",{id:"mpf-stripe-card-number-element"}),e.createElement("div",{id:"mpf-stripe-card-number-errors"})]})}),e.createElement("div",{class:"mpf-stripe-card-expiration-element-container",html:e.createElement("label",{html:[e.createElement("span",{text:m.get("expiryDate")}),e.createElement("div",{id:"mpf-stripe-card-expiration-element"}),e.createElement("div",{id:"mpf-stripe-card-expiration-errors"})]})}),e.createElement("div",{class:"mpf-stripe-card-cvc-element-container",html:e.createElement("label",{html:[e.createElement("span",{text:"CVC"}),e.createElement("div",{id:"mpf-stripe-card-cvc-element"}),e.createElement("div",{id:"mpf-stripe-card-cvc-errors"})]})})]}});return h.Events=Object.freeze(p),h}),define("DS/MPFStripeComponent/PhaseCreditCardInputs",["UWA/Core","UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFCartPaymentModel/CartPaymentModel","DS/MPFPersonModel/PersonModel","DS/MPFPspModel/PspModel","DS/UIKIT/Input/Text","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(e,t,r,n,a,i,s,o,c){"use strict";var d={INVALID:"invalid",VALID:"valid"},l=t.extend({className:"mpf-stripe-phase-payment-form",setup:function(e){e||(e={}),n.requiredOfPrototype(e.cartPayment,a,"options.cartPayment must be a CartPaymentModel"),n.requiredOfPrototype(e.cartPsp,s,"options.cartPsp must be a PspModel"),n.requiredOfPrototype(e.me,i,"options.me must be a PersonModel"),this.me=e.me,this.cartPsp=e.cartPsp,this.cartPayment=e.cartPayment,this.creditCardTokenMultiUse=e.creditCardTokenMultiUse,this.waitForPaymentModel=e.waitForPaymentModel,this.stripe=Stripe(this.cartPsp.getPublicKey()),this.elements=this.stripe.elements(),this.cardNameHolderInput=this._createCardNameHolderInput(),this.cardNumberInput=this._createCardNumberInput(),this.cardExpiryDateInput=this._createCardExpiryDateInput(),this.cardVerificationCodeInput=this._createCardVerificationCodeInput(),this.cardParams={}},render:function(){return this.container.setContent([this._createCardNameHolderContainer(),this._createCardInputsContainers()]),this},mount(){this.cardNumberInput.mount("#mpf-stripe-card-number-element"),this.cardExpiryDateInput.mount("#mpf-stripe-card-expiration-element"),this.cardVerificationCodeInput.mount("#mpf-stripe-card-cvc-element")},destroy:function(){this.me=null,this.cartPayment=null,this.container=null},proceedToPayment:function(){if(this.cartPsp.isScaEnabled()){return(this.cartPayment.getState()!==a.States.PAYMENT_INITIATED?this._updatePaymentState():Promise.resolve()).then(this._handleCardPayment.bind(this))}return this._createPaymentToken()},_updatePaymentState(){return this.cartPayment.savePromise({[a.Fields.STATE]:a.States.PENDING_PAYMENT},{patch:!0})},_handleCardPayment:function(){var e={};return e.billing_details={name:this.cardNameHolderInput.getValue()},this._validateCardNameHolderInput(),this.stripe.handleCardPayment(this.cartPayment.getPaymentIntentSecret(),this.cardNumberInput,{payment_method_data:e}).then(function(e){return e.error?r.reject(e.error):r.resolve()}).then(this._waitForPaymentStateUpdate.bind(this))},_waitForPaymentStateUpdate:function(){var e=this;return this.waitForPaymentModel?this.waitForPaymentModel.fetchPromise().catch(function(){return r.resolve()}).then(function(){if(e.waitForPaymentModel.getState()===a.States.PAYMENT_REFUSED)return r.reject("payment refused")}):r.resolve()},_createPaymentToken:function(){var e=this,t={},n={};return t.name=this.cardNameHolderInput.getValue(),this._validateCardNameHolderInput(),this.stripe.createToken(this.cardNumberInput,t).then(function(t){return t.token?(n[a.Fields.STATE]=a.States.PENDING_PAYMENT,n.payment_token=t.token.id,"1"===e.creditCardTokenMultiUse&&(n.CreditCardTokenMultiUse="1"),e.cartPayment.savePromise(n,{patch:!0}).then(e._waitForPaymentStateUpdate.bind(e))):r.reject(t.error)})},_createCardNameHolderInput:function(){var e=this;return new o({placeholder:c.get("cardHolder"),value:this.me.getFirstName()+" "+this.me.getLastName(),disabled:!1,events:{onKeyDown:function(){this.setClassName(""),e.container.getElement("#mpf-stripe-card-holder-errors").setText("")}}})},_createCardNameHolderContainer:function(){return e.createElement("div",{class:"mpf-stripe-payment-card-holder",html:e.createElement("label",{html:[e.createElement("span",{text:c.get("cardHolder")}),this.cardNameHolderInput,e.createElement("div",{id:"mpf-stripe-card-holder-errors"})]})})},_validateCardNameHolderInput:function(){0===this.cardNameHolderInput.getValue().length&&(this.cardNameHolderInput.setClassName("invalid"),this.container.getElement("#mpf-stripe-card-holder-errors").setText(c.get("cardHolderEmpty")))},_createCardNumberInput:function(){var e=this,t=this.elements.create("cardNumber",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",function(t){t.error?e.container.getElement("#mpf-stripe-card-number-errors").setContent(t.error.message):e.container.getElement("#mpf-stripe-card-number-errors").setContent("")}),t},_createCardExpiryDateInput:function(){var e=this,t=this.elements.create("cardExpiry",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",function(t){t.error?e.container.getElement("#mpf-stripe-card-expiration-errors").setContent(t.error.message):e.container.getElement("#mpf-stripe-card-expiration-errors").setContent("")}),t},_createCardVerificationCodeInput:function(){var e=this,t=this.elements.create("cardCvc",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",function(t){t.error?e.container.getElement("#mpf-stripe-card-cvc-errors").setContent(t.error.message):e.container.getElement("#mpf-stripe-card-cvc-errors").setContent("")}),t},_createCardInputsContainers:function(){return[e.createElement("div",{class:"mpf-stripe-card-number-element-container",html:e.createElement("label",{html:[e.createElement("span",{text:c.get("cardNumber")}),e.createElement("div",{id:"mpf-stripe-card-number-element"}),e.createElement("div",{id:"mpf-stripe-card-number-errors"})]}),events:{onPostInject:()=>console.log("INJECTED"),onInjected:()=>console.log("INJECTED"),postInject:()=>console.log("INJECTED"),injected:()=>console.log("INJECTED")}}),e.createElement("div",{class:"mpf-stripe-card-expiration-element-container",html:e.createElement("label",{html:[e.createElement("span",{text:c.get("expiryDate")}),e.createElement("div",{id:"mpf-stripe-card-expiration-element"}),e.createElement("div",{id:"mpf-stripe-card-expiration-errors"})]})}),e.createElement("div",{class:"mpf-stripe-card-cvc-element-container",html:e.createElement("label",{html:[e.createElement("span",{text:"CVC"}),e.createElement("div",{id:"mpf-stripe-card-cvc-element"}),e.createElement("div",{id:"mpf-stripe-card-cvc-errors"})]})})]}});return l.Events=Object.freeze(d),l}),define("DS/MPFStripeComponent/CartInfoSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(e,t,r,n,a){"use strict";return t.extend({className:"mpf-stripe-cart-section",setup:function(e){e||(e={}),r.requiredOfPrototype(e.cart,n,"options.cart must be a CartModel"),this.cart=e.cart,this.locale=e.locale||"fr-FR",this.merchantLine=this._createMerchantLine(),this.orderNumberLine=this._createOrderNumberLine(),this.amountLine=this._createOrderAmountLine()},render:function(){return this.container.setContent([this.merchantLine,this.orderNumberLine,this.amountLine]),this},_createMerchantLine:function(){return e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:a.get("merchant")}),e.createElement("span",{class:"mpf-stripe-value",text:"3DMarketplace"})]})},_createOrderNumberLine:function(){return e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:a.get("order")}),e.createElement("span",{class:"mpf-stripe-value",text:this.cart.getName()})]})},_createOrderAmountLine:function(){var t;return t=this.cart.has(n.Fields.COUPON)?parseFloat(this.cart.getCoupon().totalToPay):this.cart.get("GrossAmountTotal"),e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:a.get("amount")}),e.createElement("span",{class:"mpf-stripe-value",text:this.cart.getCurrency()+" "+t.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency(),currencyDisplay:"code"}).replace(this.cart.getCurrency(),"").trim()})]})}})}),define("DS/MPFStripeComponent/PhaseInfoSection",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(e,t,r,n,a,i){"use strict";return t.extend({className:"mpf-stripe-phase-section",setup:function(e={}){r.requiredOfPrototype(e.cart,n,"options.cart must be a CartModel"),r.requiredOfPrototype(e.cartPhase,a,"options.cartPhase must be a CartPhaseModel"),this.cart=e.cart,this.cartPhase=e.cartPhase,this.locale=e.locale||"fr-FR",this.merchantLine=this._createMerchantLine(),this.orderNumberLine=this._createOrderNumberLine(),this.phaseNumberLine=this._createPhaseNumberLine(),this.amountLine=this._createOrderAmountLine()},render:function(){return this.container.setContent([this.merchantLine,this.orderNumberLine,this.phaseNumberLine,this.amountLine]),this},destroy:function(){this.cartPayment=null,this._parent(),this.container=null},_createMerchantLine:function(){return e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:i.get("merchant")}),e.createElement("span",{class:"mpf-stripe-value",text:"3DMarketplace"})]})},_createOrderNumberLine:function(){return e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:i.get("order")}),e.createElement("span",{class:"mpf-stripe-value",text:this.cart.getName()})]})},_createPhaseNumberLine:function(){return e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:i.get("phase")}),e.createElement("span",{class:"mpf-stripe-value",text:this.cartPhase.getPhaseNumber()})]})},_createOrderAmountLine:function(){return e.createElement("div",{html:[e.createElement("span",{class:"mpf-stripe-label",text:i.get("amount")}),e.createElement("span",{class:"mpf-stripe-value",text:parseFloat(this.cartPhase.getTotalGrossAmount()).toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})})]})}})}),define("DS/MPFStripeComponent/StripePhasePaymentPage",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/MPFServices/MarketplaceServices","DS/MPFCartPaymentModel/CartPaymentModel","DS/MPFPersonModel/PersonModel","DS/MPFCartModel/CartModel","DS/MPFCartPhaseModel/CartPhaseModel","DS/MPFPspModel/PspModel","DS/MPFServices/ObjectService","DS/MPFStripeComponent/PhaseCreditCardInputs","DS/MPFStripeComponent/PhaseInfoSection","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent","css!DS/MPFStripeComponent/MPFStripeComponent"],function(e,t,r,n,a,i,s,o,c,d,l,m,p,h,u,C){"use strict";const P=Object.freeze({PAYMENT_SUCCESS:"onPaymentSuccess",PAYMENT_FAILURE:"onPaymentFailure"}),f=Object.freeze({LOADING:"loading",LOADED:"loaded",ERROR:"error"});var E=t.extend({className:"mpf-stripe-phase-payment-page",setup:function(e={}){p.requiredOfPrototype(e.me,c,"options.me must be a PersonModel"),p.requiredOfPrototype(e.cart,d,"options.cart must be a CartModel"),p.requiredOfPrototype(e.cartPhase,l,"options.cartPhase must be a CartPhaseModel"),p.requiredOfPrototype(e.cartPsp,m,"options.cartPsp must be a PspModel"),p.requiredOfPrototype(e.cartPayment,o,"options.cartPayment must be a CartPaymentModel"),this.me=e.me,this.cart=e.cart,this.cartPhase=e.cartPhase,this.cartPsp=e.cartPsp,this.cartPayment=e.cartPayment,this.creditCardTokenMultiUse=e.creditCardTokenMultiUse,this.waitForPaymentModel=e.waitForPaymentModel,this.locale=e.locale||"fr-FR",this.service=e.service||s.ENGINEERING,this.stripeLoadedElsewhere=this._isStripeLoadedInDocument(),this.spinner=new i,this.stripeScriptTag=this._createStripeScriptTag(),this.phaseInfoSection=this._createPhaseInfoSection(),this.paymentButton=this._createPaymentButton(),this.readyToMountDeferred=r.deferred(),this.stripeLoadedElsewhere?(this.creditCardInputs=this._createCreditCardInputs(),this.state=f.LOADED):this.state=f.LOADING},render:function(){return this.state===f.LOADING?(this.container.setContent([this.stripeScriptTag,this.spinner]),this.spinner.show()):this.state===f.ERROR?(this.container.setContent([{tag:"div",class:"fonticon fonticon-status-ko"},{tag:"div",class:"mpf-error-info",text:C.get("failedToLoadPaymentPage")}]),this.readyToMountDeferred.reject()):(this.container.setContent([!this.stripeLoadedElsewhere&&this.stripeScriptTag,e.createElement("div",{class:"mpf-stripe-phase-payment-body",html:[this._createLogoContainer(),this.phaseInfoSection.render(),this.creditCardInputs.render(),this.paymentButton]})]),this.readyToMountDeferred.resolve()),this},whenReadyToMount(){return this.readyToMountDeferred.promise},mountStripeInputs(){this.creditCardInputs.mount()},destroy:function(){this.stopListening(),this.phaseInfoSection&&this.phaseInfoSection.destroy(),this.creditCardInputs&&this.creditCardInputs.destroy(),this.phaseInfoSection=null,this.creditCardInputs=null,this.me=null,this.cart=null,this.cartPhase=null,this.cartPsp=null,this.cartPayment=null,this.creditCardTokenMultiUse=null,this._parent(),this.container=null},_isStripeLoadedInDocument:()=>document.querySelectorAll('script[src^="https://js.stripe.com/v3/"]').length>0,_onStripeLoaded(){this.creditCardInputs=this._createCreditCardInputs(),this.state=f.LOADED,this.render()},_onStripeLoadingError(){this.state=f.ERROR,this.render()},_createStripeScriptTag(){return e.createElement("script",{src:"https://js.stripe.com/v3/",attributes:{async:!0},events:{load:this._onStripeLoaded.bind(this),error:this._onStripeLoadingError.bind(this)}})},_createPhaseInfoSection:function(){return new u({cart:this.cart,cartPhase:this.cartPhase,locale:this.locale})},_createCreditCardInputs:function(){const e=new h({me:this.me,cartPsp:this.cartPsp,cartPayment:this.cartPayment,creditCardTokenMultiUse:this.creditCardTokenMultiUse,waitForPaymentModel:this.waitForPaymentModel});return this.listenTo(e,h.Events.INVALID,this._updatePaymentButton.bind(this,!1)),this.listenTo(e,h.Events.VALID,this._updatePaymentButton.bind(this,!0)),e},_createPaymentButton:function(e){return new n({className:"primary",value:C.get("pay"),disabled:!1,events:{onClick:this._proceedToPayment.bind(this)}})},_updatePaymentButton(e){this.paymentButton.setDisabled(!e)},_proceedToPayment:function(){a.mask(this.container,C.get("paymentInProgress")),this.creditCardInputs.proceedToPayment().then(()=>{a.unmask(this.container),this.dispatchEvent(P.PAYMENT_SUCCESS)}).catch(e=>{a.unmask(this.container),"validation_error"!==e.type&&this.dispatchEvent(P.PAYMENT_FAILURE)})},_createLogoContainer:function(){return e.createElement("div",{class:"mpf-stripe-form-ds-logo"})}});return E.Events=P,E.States=f,E}),define("DS/MPFStripeComponent/StripePaymentPage",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFPersonModel/PersonModel","DS/MPFServices/ObjectService","DS/MPFStripeComponent/CartInfoSection","DS/MPFStripeComponent/CardInputs","DS/MPFTracker/Tracker","DS/MPFTracker/Dimension","i18n!DS/MPFStripeComponent/assets/nls/MPFStripeComponent"],function(e,t,r,n,a,i,s,o,c,d,l,m,p,h){"use strict";const u=Object.freeze({PAY_WITH_CARD:"payWithCard",CARD_VALIDATION_ERROR:"CardValidationError"});return t.extend({className:"mpf-stripe-payment-page",setup:function(e){e||(e={}),c.requiredOfPrototype(e.cart,i,"options.cart must be a CartModel"),c.requiredOfPrototype(e.me,o,"options.me must be a PersonModel"),this.service=e.service,this.cart=e.cart,this.me=e.me,this.apiKey=e.apiKey,this.creditCardTokenMultiUse=e.creditCardTokenMultiUse,this.waitForPaymentModel=e.waitForPaymentModel,this.locale=e.locale||"fr-FR",this.isScaEnabled=!0===e.isScaEnabled,this.isClicknbuyEduOrMakers=!0===e.isClicknbuyEduOrMakers,this.firstNameUser=e.firstNameUser,this.cartInfoSection=this._createCartInfoSection(),this.cardInputs=this._createCardInputs(),this.paymentButton=this._createPaymentButton(),this.listenTo(this.cardInputs,l.Events.INVALID_FIELD,this.paymentButton.disable.bind(this.paymentButton)),this.listenTo(this.cardInputs,l.Events.VALID_FIELD,this.paymentButton.enable.bind(this.paymentButton))},render:function(){const t=e.createElement("div",{class:"mpf-stripe-payment-body",html:[this._createLogoContainer(),this.cartInfoSection.render(),this.cardInputs.render(),this.paymentButton]});return this.container.setContent(t),this},mountCardInputs:function(){this.cardInputs.mount()},_createCartInfoSection:function(){return new d({locale:this.locale,cart:this.cart})},_createCardInputs:function(){return new l({cart:this.cart,me:this.me,waitForPaymentModel:this.waitForPaymentModel,apiKey:this.apiKey,creditCardTokenMultiUse:this.creditCardTokenMultiUse,isScaEnabled:this.isScaEnabled})},_createPaymentButton:function(e){return new r({className:"primary",value:h.get("pay"),events:{onClick:this._proceedToPayment.bind(this)}})},_proceedToPayment(){n.mask(this.container,h.get("paymentInProgress")),this._sendTrackingEvent(u.PAY_WITH_CARD),this.cardInputs.proceedToPayment().then(()=>{n.unmask(this.container);const e=a.getWebappsAssetUrl("MPFModalConfiguratorComponent","")+"resources/static/paymentConfirmation.html?state=completed&service="+this.service+"&isClicknbuyEduOrMakers="+this.isClicknbuyEduOrMakers+"&firstNameUser="+this.firstNameUser;window.location.href=e}).catch(e=>{if(n.unmask(this.container),"validation_error"!==e.type){this._sendTrackingEvent(u.CARD_VALIDATION_ERROR);const e=a.getWebappsAssetUrl("MPFModalConfiguratorComponent","")+"resources/static/paymentConfirmation.html?state=declined&service="+this.service;window.location.href=e}})},_sendTrackingEvent(e){const t=m.createEventBuilder({category:"Checkout",action:e});s.addTrackerInformation(t,this.cart),t.addDimension(p.MARKETPLACE_SERVICE,this.service).send()},_createLogoContainer:function(){return e.createElement("div",{class:"mpf-stripe-form-ds-logo"})}})});