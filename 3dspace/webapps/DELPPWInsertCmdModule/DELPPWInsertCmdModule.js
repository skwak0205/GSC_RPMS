define("DS/DELPPWInsertCmdModule/InsertUI",["UWA/Core"],function(e){"use strict";return function(t,n,i,r){var a,s=1,o=2,l=3,c=1,u=2,g=3,f=n.getComponent("Element"),d=n.getComponent("Button"),I=null,h=null,p=null,y=!1,D=function(t){e.is(t)&&e.is(t.invalidXML)&&(y=t.invalidXML)},v=function(e,t){var n;switch(a){case u:return n="InsertUI.ReplaceByNewDialog.Title",i.getNLSValue(n,{type:i.getNLSValue(e,null,"Type")});case g:return n="InsertUI.ContinuousProvidedMaterial.Title",i.getNLSValue(n,{dimension:i.getNLSValue(t,null,"Dimension")});default:return n="InsertUI.CreateDialog.Title",i.getNLSValue(n,{type:i.getNLSValue(e,null,"Type")})}},C=function(c,g,f,D,C){var R,P,T,m,S,L,U,V,w,M=e.is(C)&&e.is(C.fatherPID,"string")&&C.fatherPID.length>0?C.fatherPID:null,E=e.is(C)&&e.is(C.transactionUUID,"string")&&C.transactionUUID.length>0?C.transactionUUID:null,N={transactionUUID:E,requestedCreation:0},B=t.getPreferenceValue("showDialog")&&(!e.is(f,"boolean")||f);switch(V=function(){!0!==(T=I.validate()).result?(P=i.getNLSValue("ModelBehavior.CreateReference.Failure.ReferenceNotCreated")+T.message,t.warn(P),p.close()):(w=I.getSecurityContextOverride(),R=I.getValues(),p.close(),g(R,{securityContextOverride:w,fatherPID:M,transactionUUID:E}))},S=function(n){var i=function(){return T=I.validate(),w=I.getSecurityContextOverride(),!0!==T.result?(e.is(T.message)&&p.error(T.message),!1):(p.clearMessages(),R=I.getValues(),g(R,{securityContextOverride:w,fatherPID:M,transactionUUID:E}),!0)},r=function(){p.close()};switch(n){case s:return function(){T=null,r(),e.is(E)&&t.notify("objectCreationUIClosed",N)};case l:return function(){e.is(E)&&N.requestedCreation++,i()};case o:return function(){i()&&(r(),e.is(E)&&(N.requestedCreation++,t.notify("objectCreationUIClosed",N)))};default:t.log("wrong option")}},a){case u:m={No:new d({label:i.getNLSValue("InsertUI.Close.Title"),onClick:S(s)}),Yes:new d({label:i.getNLSValue("InsertUI.ReplaceAndClose.Title"),onClick:S(o)})};break;default:m={No:new d({label:i.getNLSValue("InsertUI.Close.Title"),onClick:S(s)}),Apply:new d({label:i.getNLSValue("InsertUI.Create.Title"),onClick:S(l)}),Yes:new d({label:i.getNLSValue("InsertUI.CreateAndClose.Title"),onClick:S(o)})}}e.is(n)?(U={title:v(c.split("/")[1]||"",D),domId:"InsertUI-dialog",content:h,resizableFlag:!0,modalFlag:!0,minWidth:290,buttons:m,visibleFlag:B},e.is(r)&&(L=c.indexOf("/")>-1?c.split("/")[1]:c,U="WORKINSTRUCTION"!==r.getPPRTypeFromType(L)||r.isAKindOf(L,"DELWkiDataCollectPlanReference")||r.isAKindOf(L,"DELWkiDataCollectChecklistReference")?e.merge({width:400},U):e.merge({position:{my:"top",at:"top"},height:500,width:600},U)),(p=n.create("Dialog",U)).close=function(){e.is(I)&&(I.destroy(),I=null),e.is(h)&&h.destroy(),this.destroy(),p=null},B?y&&p.error(i.getNLSValue("ModelBehavior.CreateReference.Failure.InvalidXML")):V()):t.debug("uxFactoryBehavior is not available.")},R=function(e){p.title=v(e),p.clearMessages()};return{createDialog:function(t,i,r,s,o,l){a=c,e.is(s)&&(a=g),h=new f("div",{class:"Insert-Command-Container"}),e.is(p)||(e.is(I)||(I=n.create("DataCollectionUI",{type:t,onTypeChange:R,renderTo:h,dimension:s,createRoot:o,onFailure:D})),C(t,i,r,s,l))},createDialogForReplaceByNew:function(t,i,r,s){a=u,h=new f("div",{class:"Insert-Command-Container"}),e.is(p)||(e.is(I)||(I=n.create("DataCollectionUI",{type:r,baseTypes:t,selectedBaseType:i,onTypeChange:R,renderTo:h,onFailure:D})),C(r,s))},isActive:function(){return!!e.is(p)&&p.visibleFlag},destroyUI:function(){e.is(p)&&p.close()}}}}),define("DS/DELPPWInsertCmdModule/InsertCmdModule",["UWA/Core","DS/DELPPWInsertCmdModule/InsertUI"],function(e,t){"use strict";return{behaviors:["UXFactoryBehavior","ModelBehavior","LinkBehavior","ResourceBehavior","SelectionBehavior","SearchBehavior","ReplaceBehavior","MfgProcessBehavior"],creator:function(n,i,r,a,s,o,l,c,u){var g,f,d,I,h,p,y,D,v,C,R,P={},T=null,m=null;return C=function(){var t,n,i;if(i=o.getSelections(),e.is(i,"array")&&i.length>0)for(n=0;n<i.length;n++)if(t=i[n][0],e.is(t))return t},y=function(t,n){var i,a,s=C();e.is(s)&&(i=r.getReferenceModel(s).get("PID"),a=r.getInstance(s),e.is(a)&&(t.instancePID=a.get("PID"))),e.is(m)&&(t["DELFmiMagnitudeExt.V_DimensionType"]=m),r.createRefOrInst(t,i,n)},v=function(t,n){e.is(n.newRef)&&c.replace("replaceByNew",n.newRef.id)},D=function(e,t){t.onComplete=v,t.silent=!0,r.createRefOrInst(e,null,t)},R=function(t,n,i){var r=[],a=[],s=[];return i.instancesAndReferences.forEach(function(i){var o;if(i.isReference()&&e.is(t.get(i.get("PID"))))-1===a.indexOf(i.get("PID"))&&(o=t.get(i.get("PID")),a.push(i.get("PID")),r.push(o));else if(i.isInstance())if(e.is(n.get(i.get("PID")))&&-1===s.indexOf(i.get("PID")))(o=n.get(i.get("PID"))).PLM_ExternalInstanceID=i.get("PLM_ExternalID"),o.V_TreeOrder=i.get("V_TreeOrder"),o.parentReferencePID=i.get("isAggregatedBy"),o.parentInstancePID=null,s.push(i.get("PID")),r.push(o);else if(-1!==a.indexOf(i.get("isInstanceOf"))){for(var l=0;l<r.length;l++)if(r[l].PID===i.get("isAggregatedBy")){var c=r.splice(l,1);r.unshift(c[0])}(o=t.get(i.get("isInstanceOf"))).instancePID=i.get("PID"),o.PLM_ExternalInstanceID=i.get("PLM_ExternalID"),o.V_TreeOrder=i.get("V_TreeOrder"),o.parentReferencePID=i.get("isAggregatedBy"),o.parentInstancePID=null}}),r},g=function(t){var n,i,r=t.arguments,a="",s=[],o=!0;T.isActive()&&T.destroyUI(),m=null,e.is(r,"array")&&0<r.length&&r.forEach(function(t){if(e.is(t)&&e.is(t.ID,"string")&&e.is(t.Value,"string"))switch(t.ID){case"ReferenceType":a=t.Value;break;case"ShowDialog":n="false"!==t.Value;break;case"DisplayedInTableView":e.is(this._displayedInTableView,"array")||(s=[]),s.push(t.Value);break;case"V_DimensionType":m=t.Value}},this),i=C(),e.is(i)&&(o=!1),T.createDialog(a,y,n,m,o)},f=function(){a.getRelations().then(function(e){e.isRelationsLoaded&&c.replace("replaceByLatest")})},I=function(){a.getRelations().then(function(e){e.isRelationsLoaded&&c.replace("replaceByNewRevision")})},d=function(){var t,n,i,u,g=o.getSelectedInsts();t=function(t){e.is(t,"array")&&t.length>0&&c.replace("replaceByExisting",t[0].id)},a.getRelations().then(function(e){var a,o,c;e.isRelationsLoaded&&1===g.length&&(n=g[0],c=(i=r.getReferenceModelFromInstance(n)).get("PPRTYPE"),u=r.getAggregatingReferenceModelFromInstance(n),a=r.getValidChildTypes(u),"OPERATION"!==c&&"SYSTEM"!==c||((o=r.getTypeHierarchy(i.get("type"))).unshift(i.get("type")),a=a.filter(function(e){return o.indexOf(e)>-1})),l.showSearchDialoguAndActivate(t,{title:s.getNLSValue("Dialog.ReplaceByExisting.Title"),searchTitle:s.getNLSValue("Search.ReplaceByExisting.Title"),types:a}))})},h=function(){var t,n,i,a,s,l,c,u=[],g=[];T.isActive()&&T.destroyUI(),t=o.getSelectedInsts(),e.is(t,"array")&&1===t.length&&(n=r.getReferenceModelFromInstance(t[0]).get("type"),s=n,"OPERATION"===(c=(i=r.getAggregatingReferenceModelFromInstance(t[0])).get("PPRTYPE"))||"SYSTEM"===c?(g=[s],l=[s]):((a=r.getValidChildTypes(i)).forEach(function(e){var t=r.getTypeHierarchy(e);-1!==t.indexOf(s)&&(s=e),t.forEach(function(e){-1===u.indexOf(e)&&u.push(e)})}),l=r.getAcceptedBaseTypesForCreation(),a.forEach(function(e){-1===u.indexOf(e)&&-1!==l.indexOf(e)&&g.push(e)})),g.length>0&&-1!==l.indexOf(s)&&T.createDialogForReplaceByNew(g,s,"Dummy/"+n,D))},p=function(){var t,i=[],l=o.getSelections();e.is(l,"array")&&l.length>0?l.forEach(function(n){e.is(l,"array")&&l.length>0&&n.forEach(function(n){e.is(n)&&(t=r.getReferenceModel(n),i.push(t.get("PID")))})}):0===l.length&&n.warn(s.getNLSValue("ReplaceWhereUsed.NoSelection")),a.webServiceRequest({url:"dsmfg/private/V0/invoke/replaceWhereUsed",method:"POST",onComplete:function(e){var t=[],i=[],a=new Map,o=new Map;e.forEach(function(e){e.from.forEach(function(e){t.push(e.PID),a.set(e.PID,e)}),e.to.forEach(function(e){o.set(e.instancePID,e)})}),r.getDescendantsFromServer(t,function(e){i=R(a,o,e),n.notify("replaceWhereUsedModule",{values:i})},{onFailure:function(){n.warn(s.getNLSValue("Error.ExpandFailed.Title"))},silentMode:!0,forceDBMode:!0,expandLevel:1})},data:e.Json.encode(i)})},{listenTo:function(){return{InsertCmd:g,ReplaceByLatestRevision:f,ReplaceByExisting:d,ReplaceByNewRevision:I,ReplaceByNewReference:h,ReplaceWhereUsed:p}},onStart:function(a,o){P=e.extend(P,a),e.is(P.insertFormAttributeXML)||(n.debug("Insert Module loading failed : insertFormAttributeXML option is undefined"),o()),T=new t(n,i,s,r),o()},onStop:function(){T.isActive()&&T.destroyUI(),T=void 0}}}}});