define("DS/DMUBaseCommands/DMUCutCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&i.copySelectedDMUElements(!0),n.end()}}})}),define("DS/DMUBaseCommands/DMURightSidePanelCmd",[].concat(["DS/ENOPAD3DViewer/commands/PAD3DViewerRightSidePanel","DS/PADUtils/PADContext","DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsContext"]),function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){var r,s,l,c=[],d=[],u=t.get(),m={get:function(){let e=o.getReviewContext({context:u}),t=e&&e.getValidation()&&e.getValidation().getContext()?e.getValidation().getContext().getJsonContextTypes()[0]:null,r=a.getParentType(t)?a.getParentType(t):t;var s,l,d,m=i.get();if((m.length&&m.some(function(e){return n.isAModelPath(e.pathElement)})||"DesignSight"===r||"Requirement Specification"===r||"Requirement"===r||"Document"===r)&&m.length)for(var g=m[0].pathElement.externalPath.length-1;g>=0;--g){if(!(d=m[0].pathElement.externalPath[g])||n.isPLMNode(d))return m;if(d.getDibInfo){let e=g>0?m[0].pathElement.externalPath[g-1]:null;return[{dibInfo:d.getDibInfo(),parentDibInfo:e&&e.getDibInfo?e.getDibInfo():null}]}if(d.getDocInfo)return[{docInfo:d.getDocInfo(),parentDocInfo:null}];if(d.getReqInfo)return[{reqInfo:d.getReqInfo(),parentDocInfo:null}]}if(!c.length)return[];var p=o.getReviewContext({context:u}),h=p?p.getReviewCtxInformation():{};return h&&h.reviewId?s=[{mkpID:h.reviewId}]:u&&u.getApplicativeData().getLoadedItfData&&(l=(l=u.getApplicativeData().getLoadedItfData())&&l.data),s||(l||[])},onPostAdd:function(e){return r=e,1},onPostRemove:function(e){return s=e,2},onEmpty:function(e){return l=e,3},unsubscribe:function(e){1===e?r=null:2===e?s=null:3===e&&(l=null)}},g=o.getEventsController({viewer:u.getViewer()});function p(e){1===e&&r?r():2===e&&s?s():3===e&&l&&l()}c.push(i.onPostAdd(p.bind(this,1))),c.push(i.onPostRemove(p.bind(this,2))),c.push(i.onEmpty(p.bind(this,3))),d.push(g.addEvent("onDMUMarkupCreationSucceeded",p.bind(this,1))),d.push(g.addEvent("onDMUMarkupLoaded",p.bind(this,1))),d.push(g.addEvent("onReviewRemoved",p.bind(this,1))),this.getXSO=function(){return m},this.getID=function(e){return e&&e.mkpID?e.mkpID:e&&e.isrID?e.isrID:e&&e.dibInfo?e.dibInfo.id:e&&e.reqInfo?e.reqInfo.id:e&&e.docInfo?e.docInfo.validatedPaths[0]:Object.getPrototypeOf(this).getID.apply(this,arguments)},this.getRelationID=function(e){return e&&e.mkpID||e&&e.isrID?void 0:e&&e.parentDibInfo?e.parentDibInfo.id:e&&e.reqInfo?null:e&&e.docInfo?null:Object.getPrototypeOf(this).getRelationID.apply(this,arguments)},this.getType=function(e){return e&&e.mkpID?"Markup":e&&e.type?e.type:e&&e.dibInfo?e.dibInfo.type:e&&e.reqInfo?e.reqInfo.type:e&&e.docInfo?e.docInfo.type:Object.getPrototypeOf(this).getType.apply(this,arguments)},this.destroy=function(){p(3),c.forEach(i.unsubscribe,i),c=[],d.forEach(g.removeEvent,g),d=[],r=s=l=null,Object.getPrototypeOf(this).destroy.apply(this,arguments)},this._parent(e),p(1)},isNodeValid:function(e){var t=this._parent(e);return!t&&e&&(e.mkpID||e.isrID||e.dibInfo||e.docInfo||e.reqInfo)&&(t=!0),t},getServiceId:function(e){var t="";return!e||e.mkpID||e.isrID||e.dibInfo||e.docInfo||e.reqInfo||(t=this._parent(e)),t}})}),define("DS/DMUBaseCommands/DMUCopyCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&i.copySelectedDMUElements(),n.end()}}})}),define("DS/DMUBaseCommands/EXPToolsWUX",["DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n,i){"use strict";return{addInCSO:function(t,n){if(t){var o=t.path?t.path:t.getNode&&t.getNode()?i.buildPathElement(t.getNode()):t.getDMUType?i.buildPathElement(t):null;n||e.empty(),o&&e.add({pathElement:o})}},emptyCSO:function(){e.empty()},getCSO:function(){for(var t=e.get(),n=[],i=0;i<t.length;i++)n.push(t[i].pathElement);return n},addInHSO:function(e,n){if(e){var o=e.path?e.path:e.getNode&&e.getNode()?i.buildPathElement(e.getNode()):null;n||t.empty(),t.add({pathElement:o})}},emptyHSO:function(){t.empty()},addInPSO:function(e,t){if(e){var o=e.path?e.path:e.getNode&&e.getNode()?i.buildPathElement(e.getNode()):null;t||n.empty(),n.add({pathElement:o})}},emptyPSO:function(){n.empty()}}}),define("DS/DMUBaseCommands/DMUPasteCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this,i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()});i&&i.refreshCCPCommandsAvailability(),this.beginExecute=async function(){(i=t.getManager({name:"DMUUserExperienceManager",context:n.getFrameWindow()}))&&await i.pasteDMUElements(),n.end()}}})}),define("DS/DMUBaseCommands/DMUPasteSpecialCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/DMUControls/DMUPasteWithOptionsPanel"],function(e,t,n,i){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var o=this,a=n.getManager({name:"DMUUserExperienceManager",context:o.getFrameWindow()});a&&a.refreshCCPCommandsAvailability(),this.beginExecute=function(){if(a=n.getManager({name:"DMUUserExperienceManager",context:o.getFrameWindow()})){var e=a.getCCPTarget();if(!e){var r=t.getReviewContext({viewer:o.getFrameWindow().getViewer()});r&&r.getCurrentSessionMarkup()&&r.getCurrentSessionMarkup().getCurrentSlide&&(e=r.getCurrentSessionMarkup().getCurrentSlide())}if(e){var s=a.areOccurenceOverloadsCopied();new i({frmWindow:o.getFrameWindow(),prefs:{overloadPasteSpecial:s,displayAssociateFormatPref:!s&&"DMUSlide"===e.getType(),displayCreateNewSlidePref:!s&&"DMUSlide"===e.getType(),displayCameraPref:!s},cb:function(e){a&&a.pasteDMUElements(e),null}})}}o.end()}}})}),define("DS/DMUBaseCommands/DMUSwitch3DMarkersResponsiveDisplayCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/DMUBaseUIControllers/DMUMarkupsController"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{});var n=this,i=this.onStateChange(function(){let e=t.giveDMUMarkupsController({context:n.getFrameWindow().getViewer()});e&&e.setResponsiveDisplayFlag(n.getState()),localStorage.setItem("DMU3DMarkersResponsiveDisplay",n.getState()?"true":"false")}),o=this._destroy;this._destroy=function(){n._modelEvents.unsubscribe(i),o.call(n)},this.setState("true"===localStorage.getItem("DMU3DMarkersResponsiveDisplay"))},_destroy:function(){this._parent()}})}),define("DS/DMUBaseCommands/DMUFocusOnRepresentationCmd",["require","exports","DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/PADUtils/views/PADPager"],function(e,t,n,i,o,a,r,s){"use strict";return class extends n{constructor(e){super(e,{mode:"shared",isAsynchronous:!0});let t,n=this,l=null,c=[],d=0,u=!1,m=[],g=!1,p=r.get(this.options.context),h=e=>{27===e.keyCode&&n.end()},f=e=>{let t;if(e&&e.length)if(e.some(e=>e&&e.getLastElement(!0)&&e.getLastElement(!0).getReqInfo)){let t=e.map(e=>e.getLastElement(!0).getReqInfo().id).filter(Boolean);t.length&&window.require(["DS/WebDocumentVisualization/WebDocumentVisualizationController"],e=>{let n=e.giveWebDocumentVisualizationController({context:p});n&&n.reframeOnElements(t)})}else e.forEach(e=>{let n=e.getBoundingSphere(p.getViewer(),"visibleSpace");n&&n.radius&&(t?t.mergeWithSphere(n,t):t=(new i.Sphere).copy(n))}),t&&t.radius&&p.getViewer().currentViewpoint.reframe(void 0,void 0,t)},D=()=>{-1===d&&(d=c.length-1);let e=d%c.length;l&&l.setLabel(e+1+"/"+c.length),u=!0,p.lockSelectionBroadcast(!0),o.empty(),a.empty(),o.add(c[e]),a.add(c[e]),u=!1,p.lockSelectionBroadcast(!1),f([c[e].pathElement])},v=e=>{c&&("previous"===e.operation&&(d--,D()),"next"===e.operation&&(d++,D()))},S=()=>{let e=m.length?m.map(e=>({pathElement:e})):c.slice();p.lockSelectionBroadcast(!0),u=!0,a.empty(),o.empty(),a.add(e),o.add(e),u=!1,p.lockSelectionBroadcast(!1)};this.execute=function(e){(e=>{if(!e||!e.length)return;p.lockSelectionBroadcast(!0),m=e.slice(),o.empty(),a.empty();let t=e.map(e=>({pathElement:e}));o.add(t),a.add(t)})(e),d=0;let i=[];i=o.get().slice(),u=!1;for(let e=0;e<i.length;e++)null!==i[e].pathElement&&c.push(i[e]);c.length?(t=o.onRemove(()=>{u||p.getController()._updateClustersInProgress||n.end()}),c.length>1&&(l||(l=new s({renderTo:p.elements.view_container,context:p,callbacks:{onPrevious:()=>{v({operation:"previous"})},onNext:()=>{v({operation:"next"})},onSelectAll:S,onReframeAll:()=>{f(c.map(e=>e.pathElement))},onClose:n.end}})),document.addEventListener("keyup",h),l.show()),D(),1===c.length&&n.end()):n.end()};let C=n.end;this.end=function(){g||(g=!0,c.length=0,d=0,u=!1,m.length=0,l&&(l.hide(),l.destroy(),document.removeEventListener("keyup",h)),l=null,t&&o.unsubscribe(t),t="",C.call(n),g=!1)}}}}),define("DS/DMUBaseCommands/DMUNavOnImplementationLinksCmd",["require","exports","DS/ApplicationFrame/Command","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Selection/CSOManager","DS/PADUtils/PADUtilsServices","DS/WAFData/WAFData","DS/DMUBaseExperience/DMUContextManager","DS/PADUtils/PADSettingsMgt","DS/DMUControls/EXPNotify","i18n!DS/DMUBaseCommands/assets/nls/DMUBaseCommands"],function(e,t,n,i,o,a,r,s,l,c,d){"use strict";return class extends n{constructor(e){super(e,"shared");let t=this,n=null;function u(e,i){t&&(n&&(n.destroy(),n=null),n=new c({body:t.getFrameWindow().getUIFrame(),type:e,message:i}))}function m(){u("warning",d.issueImplLinks)}this.beginExecute=function(){parent.require(["DS/WidgetLink/WidgetLink"],e=>{let n=e.get(window.widget);if(!n||!n.getLinked().length)return u("info",d.noWidgetLinked),void t.end();let c=o.get(),g=[];if(1===c.length&&c.some(function(e){return i.isAModelPath(e.pathElement)})){let e=c[0].pathElement.clone();if(e.internalPath.length=0,e.getLastElement(!0).getReqInfo)g.push(e.getLastElement(!0).getReqInfo().id);else{for(;e&&!i.isPLMNode(e.getLastElement(!0))&&!e.getLastElement(!0).getDibInfo;)e=e.getParentPath();if(!e)return;let t=e.getLastElement();if(i.isPLMNode(e.getLastElement())){for(g.push(i.getNodeID(t));e&&!i.isReference(t)&&!i.isRepReference(t);)(e=e.getParentPath())&&(t=e.getLastElement(!0));if(t&&i.isRepReference(t)){for(;e&&!i.isReference(t);)(e=e.getParentPath())&&(t=e.getLastElement(!0));t&&g.push(i.getNodeID(t))}}else e.getLastElement().getDibInfo&&(e.getParentPath()&&e.getParentPath().getLastElement(!0).getDibInfo&&e.getParentPath().getLastElement(!0).getDibInfo()&&e.getParentPath().getLastElement(!0).getDibInfo().id?g.push(e.getParentPath().getLastElement(!0).getDibInfo().id):e.getLastElement(!0).getDibInfo&&e.getLastElement(!0).getDibInfo()&&e.getLastElement(!0).getDibInfo().id&&g.push(e.getLastElement(!0).getDibInfo().id))}}if(g&&g.length){let e=[],n=l.getSetting("pad_security_ctx"),i=i=>{let o=i?JSON.parse(i):null;if(o&&o.infos&&"OK"===o.infos.status&&o.result&&o.result.length&&o.result.forEach(t=>{t&&t.outputs&&t.outputs.results&&t.outputs.results.length&&t.outputs.results.forEach(t=>{if(t.elements&&t.elements.length){let n=[];t.elements.forEach(e=>{e.physicalid&&n.push(e.physicalid)}),n.length&&e.push(n)}})}),e.length){let i=[];e.forEach(e=>{e.forEach(e=>{-1===i.indexOf(e)&&i.push(e)})}),function(e){let t={input_physical_ids:e.physicalIDs,label:"DMUNavigateOnImplementationLinks_Ids",primitives:[{navigate_to_rel:{id:1}}],patterns:{ref:[{id:1}]},patternTypeFilters:{ref:{typesToNotReturn:["RFLPLMImplementConnection"]}},attributes:["ds6w:label","ds6w:type"],fileAttributes:[],version:3};r.authenticatedRequest(a.get3DSpaceUrl()+"/cvservlet/navigate?SecurityContext="+e.securityContext,{data:JSON.stringify(t),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:e.securityContext},timeout:parseInt(l.getSetting("webapi_timeout"),10),onComplete:e.onComplete,onFailure:e.onFailure,onTimeout:e.onTimeout})}({securityContext:n,physicalIDs:i,onComplete:function(n){let i,o={},a=JSON.parse(n);if(!a||!a.infos||"OK"!==a.infos.status||!a.result)return void m();a.result.forEach(e=>{i=e.input_object,e.outputs&&e.outputs.ref&&e.outputs.ref.length&&(o[i.physicalid]=e.outputs.ref.map(e=>e.physicalid))});let r=[];if(e.forEach(e=>{let t=[];e.forEach(e=>{o[e]&&o[e].forEach(n=>{t.length&&t.push(e),t.push(n)})}),r.push(t)}),r&&r.length){let e=s.giveEventsController({viewer:t.getFrameWindow().getViewer()});e&&e.fireEvent("onFireCrossWidgetFind",{paths:r})}},onFailure:m,onTimeout:m})}};const o=a.get3DSpaceUrl()+"/cvservlet/navigate?SecurityContext="+n;let c={data:JSON.stringify({input_physical_ids:g,primitives:[{navigate_from_rel:{id:1,mode:"stop_at_rel"}},{navigate_from_sr:{id:2,filter:{role:["51","52"],semantics:["5","7"]},mode:"ends"},navigate_to_sr:{id:3,filter:{role:["51","52"],semantics:["5","7"]},mode:"path"}}],patterns:{results:[{id:1},{id:2},{id:3}]},flags:["returnMatches"],version:3,label:"DMUNavigateOnImplementationLinks_to"}),timeout:parseInt(l.getSetting("webapi_timeout"),10),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:n},onComplete:i,onFailure:m,onTimeout:m};r.authenticatedRequest(o,c)}t.end()})}}}}),define("DS/DMUBaseCommands/DMUGoToPageCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/EXPManagerSet"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this._parentBeginExecute=this.beginExecute,this.beginExecute=function(){this._parentBeginExecute();var e=t.getManager({name:"DMU2DSheetManager",context:n.getFrameWindow()});e&&e.enableCurrentPageEdition(),n.end()}}})}),define("DS/DMUBaseCommands/DMUReframeOnRepresentationCmd",["require","exports","DS/ApplicationFrame/Command","DS/Visualization/ThreeJS_DS","DS/Selection/CSOManager","DS/PADUtils/PADContext"],function(e,t,n,i,o,a){"use strict";return class extends n{constructor(e){super(e,{mode:"shared",isAsynchronous:!0});let t=this;this.execute=function(){let e=a.get(this.options.context),n=o.get();if(e&&n&&n.length){let t;n.forEach(n=>{if(n.pathElement){let o=n.pathElement.getBoundingSphere(e.getViewer(),"visibleSpace");o&&o.radius&&(t?t.mergeWithSphere(o,t):t=(new i.Sphere).copy(o))}}),e&&t&&t.radius&&e.getViewer().currentViewpoint.reframe(void 0,void 0,t)}t.end()}}}}),define("DS/DMUBaseCommands/EXPCommand",["DS/ApplicationFrame/Command","DS/DMUBaseCommands/EXPToolsWUX"],function(e,t){"use strict";return e.extend({init:function(e,t,n){var i=t||"exclusive",o=n||!0;this._parent(e,{mode:i,isAsynchronous:o}),this.getFrameWindow&&this.getFrameWindow()&&(this._frmWindow=this.getFrameWindow(),this._viewer=this.getFrameWindow().getViewer())},_performCallback:function(){},execute:function(){this._performCallback(),this.end()},addInCSO:function(e,n){t.addInCSO(e,n)}})}),define("DS/DMUBaseCommands/EXPStateCommand",["DS/StateCommandEngine/StateCommand","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/VisuEvents/EventsManager","DS/Gestures/ClickGesture","DS/DMUMeasurable/DMUToolsSceneGraph","DS/VisuEvents/ScreenEvent"],function(e,t,n,i,o,a,r,s,l){"use strict";return e.extend({init:function(e,t,n){this._parent(e,{mode:t,isAsynchronous:n});if(this._frmWindow=this.getFrameWindow(),this._viewer=this._frmWindow.getViewer(),this._tokenRemove=null,this._frmWindow&&void 0===this._frmWindow._bDMUClickEvent){var i=new r(l.MouseButton.LEFT);a.addGestureRecognizer(i),this._frmWindow._bDMUClickEvent=!0}},beginExecute:function(){this._parent(),this._keepDefaultController||(this._defaultController=this.getFrameWindow().getViewer().currentViewpoint.getDefaultController(),this.getFrameWindow().getViewer().currentViewpoint.setDefaultController(!0,"CATIA"));var e=i.getContextViewer({viewer:this.getFrameWindow().getViewer()});if(e){var t=this;this._tokenRemove=e.subscribe({event:"onRootRemoved"},function(n){var o=i.getReviewContext({context:e});(o&&o.getReviewCtxInformation()?o.getReviewCtxInformation().contextId:null)===n.id&&t.end()})}},endExecute:function(){if(this._defaultController&&this.getFrameWindow().getViewer().currentViewpoint.setDefaultController(!0,this._defaultController),this._tokenRemove){var e=i.getContextViewer({viewer:this.getFrameWindow().getViewer()});e&&(this._tokenRemove=e.unsubscribe(this._tokenRemove)),this._tokenRemove=null}this.cleanNotify(),this._parent()},addEmptySelectionTransition:function(e,t,n,i){this._checkEmptySelection=function(e){var t=!0,n=e.from[0].event;if(e.from[0]&&e.from[0].getCurrentPosition&&(this._object=o.getSelectedPathElement(this._viewer,e.from[0].getCurrentPosition(this._viewer.canvas))),this._object){if(s.isAPOIPath(this._object))return!0;t=!1}else if(!function(e){if(!e)return!1;for(var t=e;t;){if(t.id&&t.id.includes("WebDocPageLayerPage"))return!0;t=t.parentElement}return!1}(n.target)&&!function(e){if(!e)return!1;for(var t=e;t;){if(t.id&&t.id.includes("WebDocReqElem"))return!0;t=t.parentElement}return!1}(n.target))if("CANVAS"!==n.target.tagName)t=!1;else if(void 0!==n.target)if(void 0!==n.target.className&&"levelSelector-canvas levelSelector-canvas-animation"===n.target.className)t=!1;else for(var i=n.target;i;){if("LevelSelector"===i.id){t=!1;break}i=i.parentElement}return t},this.addTransition({iEvent:"/VISU/onPrimaryPointerClick",iInitialState:e,iFinalState:t,iCondition:function(e){return i?this._checkEmptySelection(e)&&i():this._checkEmptySelection(e)},iAction:n})},computeEmptySelectionInformation:function(e){var t=[];if(e.from[0]&&e.from[0].getCurrentPosition){var n=o.getPickingInfo(this._viewer,e.from[0].getCurrentPosition(this._viewer.canvas));n.position=n.point,t.push(n)}return t},addInCSO:function(e,n){t.addInCSO(e,n)},emptyCSO:function(){t.emptyCSO()},addInHSO:function(e,n){t.addInHSO(e,n)},emptyHSO:function(){t.emptyHSO()},addInPSO:function(e,n){t.addInPSO(e,n)},emptyPSO:function(){t.emptyPSO()},sendNotify:function(e,t,i){return this._notification&&this._notification.destroy(),this._notification=new n({body:this._frmWindow.getUIFrame(),type:e,notificationType:"HelpNotification",message:t,duration:i,autoHide:"number"==typeof i&&i>0}),this._notification},cleanNotify:function(){this._notification&&this._notification.destroy()}})}),define("DS/DMUBaseCommands/EXPGenericCmdOneSelThenOperation",["DS/DMUBaseCommands/EXPStateCommand","DS/DMUBaseExperience/EXPToolsVisualization","DS/StateCommandEngine/PathElementAgent","DS/DMUBaseUIManipulators/DMUCursorsController","DS/VisuEvents/EventsManager","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPManagerSet","i18n!DS/DMUBaseCommands/assets/nls/DMUBaseCommands"],function(e,t,n,i,o,a,r,s,l){"use strict";var c,d,u;return e.extend({init:function(e,t,n,i,o){this._parent(e,"exclusive",!0),this._performOperation=t,this._sKeyHelpMessage=void 0!==n?n:l.defaultSelectLabel,this._agentOptions=void 0!==i?i:{},this._bAllowEmptySel=void 0!==o&&o,this._dragEventCallback=this.options.dragEventCallback,this._selectedPathElement=null},beginExecute:function(){this.emptyHSO(),this.emptyCSO();var e=this;this._viewer.currentViewpoint.setDefaultController(!1,"FLY_WALK");var l=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});if(c=l?l.getPointedElem():e._viewer.canvas,l&&(l.setTextSelectionFlag(!1),l.setTouchPanActive(!1)),this.getPageNumber=function(){return l?l.getPageNumber(d):null},this.getElementId=function(){return l?l.getElementId(d):null},this.getAbsolutePosition=function(t){if(d===e._viewer.canvas||!l)return t;var n=l.getElementMatrix(e.getPageNumber()||e.getElementId());return n?t.clone().applyMatrix4(n):t},this.getRelativePosition=function(t){if(d===e._viewer.canvas||!l)return t;var n=l.getElementMatrix(e.getPageNumber()||e.getElementId());return n?t.clone().applyMatrix4((new r.Matrix4).getInverse(n)):t},this.tapCallback=function(n){if(!e.isPaused()){e._selectedPathElement=null,(d=l?l.getElementToDraw(n.from[0].getView()):e._viewer.canvas)||e.publish({event:"dragEnd"}),e._clickEventData=n;var i,o=e._viewer.getMousePosition(n.from[0].getCurrentPosition(e._viewer.canvas)),a=e._viewer.pick(o,"mesh",!0);if(void 0!==a&&void 0!==a.position&&null!==a.position)if(i=a.position.clone(),e._startpos=e.getRelativePosition(i),0===a.path.length)e._startpos=e._computePositionOnEmptySpace(n);else{var s=a.path[0];void 0!==s&&s.getLastElement().measurable&&void 0!==(a=e._viewer.pick(o,"prim",!0))&&(e._startpos=a.position.clone())}if(e._startpos){const n=t.getViewerPositionFromPoint(e._viewer,e._startpos);n&&(e._selectedPathElement=e._viewer.pick(e._viewer.getMousePosition(new r.Vector2(n.left,n.top)),"mesh",!1).path[0])}}},this._cancelCmd=function(){e.publish({event:"dragEnd"})},this._dragEventCallback){var m=null;this.dragCallback=function(n){if(!e.isPaused()){var i="end"===n.state,o=function(e){if(e&&e===d)return!0;for(var t=e.parentNode;t&&"___view___1"!==t.id;){if(t===d)return!0;t=t.parentElement}return!1}(n.from[0].getView());if(o){"touchmove"!==n.from[0].event.type||n.from[0].event.pageX||n.from[0].event.pageY||(n.from[0].event.pageX=n.from[0].event.touches&&n.from[0].event.touches.length?n.from[0].event.touches[0].pageX:0,n.from[0].event.pageY=n.from[0].event.touches&&n.from[0].event.touches.length?n.from[0].event.touches[0].pageY:0),"begin"===n.state&&(e.dragEnabled=!0,m=void 0!==e._startpos?e._startpos:t.getPickingInfo(e._viewer,n.from[0].getCurrentPosition(e._viewer.canvas)).point);var s=n.from[0].getCurrentPosition(e._viewer.canvas),l=t.getLineFromWindowPosition(e._viewer,s.x,s.y),c=t.getViewpointInfo(e._viewer.currentViewpoint),g=a.computeLinePlaneDistance(l.position.toArray(),l.direction.toArray(),m.toArray(),c.sight.toArray());u=e.getRelativePosition(new r.Vector3(g.aPosition[0],g.aPosition[1],g.aPosition[2]))}e._dragEventCallback({iEventData:n,vStartPosition:m,vCurrentPosition:u,bLastUpdate:i,isCanvasToDraw:o}),!i&&u||(u=null,e.publish({event:"dragEnd"}))}},this._viewer.get2DMode()||this._viewer.currentViewpoint.control.setTouchRotationActive(!1),this._savedTrapSelectionFlag=this._viewer.picking.trapSelection,this._savedTrapSelectionFlag&&this._viewer.setPicking({trapSelection:!1}),o.addEvent(c,"onDrag",this.dragCallback),o.addEvent(c,"onPrimaryPointerDownUnique",this.tapCallback),o.addEvent(c,"onRightClick",this._cancelCmd),c!==this._viewer.canvas&&(o.addEvent(this._viewer.canvas,"onDrag",this.dragCallback),o.addEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this.tapCallback))}this._agentOptions.agentId="_pathElementAgent",this._agentOptions.frameWindow=this._frmWindow,this._pathElementAgent=new n(this._agentOptions),this._parent();var g=i.giveDMUCursorsController({context:e.getFrameWindow()});g&&g.setCursors({pages:c!==this._viewer.canvas?"crosshair":null,canvas:c===this._viewer.canvas?"crosshair":null,preHLMarkers:"crosshair"}),this.sendNotify("info",this._sKeyHelpMessage)},resumeExecute:function(){this._parent();let e=i.giveDMUCursorsController({context:this.getFrameWindow()});e&&e.resetCursors()},endExecute:function(){this._parent(),this._dragEventCallback&&(this._viewer.get2DMode()||this._viewer.currentViewpoint.control.setTouchRotationActive(!0),this._savedTrapSelectionFlag&&this._viewer.setPicking({trapSelection:!0}),o.removeEvent(c,"onDrag",this.dragCallback),o.removeEvent(c,"onPrimaryPointerDownUnique",this.tapCallback),o.removeEvent(c,"onRightClick",this._cancelCmd),c!==this._viewer.canvas&&(o.removeEvent(this._viewer.canvas,"onDrag",this.dragCallback),o.removeEvent(this._viewer.canvas,"onPrimaryPointerDownUnique",this.tapCallback))),this._pathElementAgent=null,this.dragEnabled=null;var e=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()});e&&(e.setTextSelectionFlag(!0),e.setTouchPanActive(!0));var t=i.giveDMUCursorsController({context:this.getFrameWindow()});t&&t.restoreCursors(),this.cleanNotify(),this._viewer.currentViewpoint.setDefaultController(!0,"FLY_WALK")},buildGraph:function(){var e=this.createInitialState("initialState"),t=this.getFinalState(),n={iEvent:this._pathElementAgent,iInitialState:e,iFinalState:t,iCondition:function(){return!this.dragEnabled},iAction:this._performSelectionCallback};this.addTransition(n),this._bAllowEmptySel&&this.addEmptySelectionTransition(e,t,this._performEmptySelectionCallback);var i={iSender:this,iEvent:"dragEnd",iInitialState:e,iFinalState:t,iCondition:null};this.addTransition(i)},_performSelectionCallback:function(e,t){this.isPaused()||(void 0!==this._startpos&&(t[0].position=this._startpos),this._performOperation(t),e())},_performEmptySelectionCallback:function(e,t){if(!this.isPaused()){var n=this.computeEmptySelectionInformation(t);n[0].pathElement=n[0].paths?n[0].paths[0]:void 0,n[0].position=this._computePositionOnEmptySpace(t),this._performOperation(n),e()}},_computePositionOnEmptySpace:function(e){let n,i=e.from[0].getCurrentPosition(this._viewer.canvas),o=s.getManager({name:"DMU2DSheetManager",context:this.getFrameWindow()}),a=!1;o&&(a="Document"===o.getDocumentType()||"Requirement"===o.getDocumentType())&&(n=new r.Vector3(0,0,0));let l=t.getNearPositionFrom2DCoordinates(i,this._viewer,n,a);return this.getRelativePosition(l)}})});