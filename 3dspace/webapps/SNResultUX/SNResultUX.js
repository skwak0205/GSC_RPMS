define("DS/SNResultUX/views/utils/3DSpacePreview",["UWA/Core","DS/SNInfraUX/SearchPreviewContainer","DS/SNResultUX/views/utils/Play3DServices"],function(e,t,i){"use strict";return t.extend({_OpenWith:null,init:function(e){this._OpenWith=null,this._parent(e)},getPrimaryContent:function(t){if(e.is(t)&&e.is(t.searchmodel)&&(e.is(t.onFailure,"function")&&i.is3DPlayAvailable(t.searchmodel,t.skeleton).then(function(){t.onFailure.call()},function(){if(e.is(t.onCusto,"function")){t.onCusto.call(null,{nopreview:"visible"})}}),e.is(t.onCusto,"function"))){t.onCusto.call(null,{layout:"horizontal"})}}})}),
/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNResultUX/utils/datagridPreferences/Abstract",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Events","UWA/Element","DS/Spreadsheet/DataGrid","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/MessageBus/MessageBus","DS/Windows/Dialog","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b){"use strict";return t.extend(s,i,n,{_dialog:null,name:"SearchDataGridPreferences",_divCombo:null,_divGrid:null,_divFooter:null,_divMain:null,_divArrow:null,_arrow:null,_divAvailable:null,defaultOptions:{spreadsheet:null,preferences_grid:null,move_to_do:null},gridInitValues:null,gridFinalValues:null,_columnCustoPreferenceDefinition:null,_custoCombo:null,_unmodifiedCusto:!1,_predicateIntersection:null,_typeToHandle:null,_bFav:null,_bFavTooltip:null,_bDel:null,_bDelTooltip:null,_custoNameEdt:null,_zIndexToUse:0,oSearchCustoServices:null,qForceClose:null,init:function(t){this._dialog&&(this._dialog.destroy(),this._dialog=null),e.is(t.zIndexToUse)&&(this._zIndexToUse=t.zIndexToUse),this._parent(t),this.setOptions(t),this.postInit()},postInit:function(){let e=this;this.qForceClose=v.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"datagrid_preference_force_close",callback:function(){e._dialog&&e._dialog.close()}})},setoDatagridTarget:function(e){this.options.searchDatagridView=e},_isEndUserMode:function(){return void 0===this.options.typeToHandle},_buildView:function(){var t=this;h.log("_buildView");var i=o.create("div",{class:"global-column-custo-div"});this._divCombo=o.create("div",{class:"column-custo-combo-div"+(this._isEndUserMode()?"":" custo-flex")}),this._divCombo.inject(i),this._divMain=o.create("div",{class:"column-custo-grid-div"}),this._isEndUserMode()&&(this._divAvailable=o.create("div",{class:"column-custo-grid-div-content available"}),this._divAvailable.inject(this._divMain),this._divArrow=o.create("div",{class:"column-custo-grid-div-content arrow"}),this._arrow=new l({className:"primary arrow-rights wux-ui-3ds wux-ui-3ds-right",id:"aEndUserCustoAdPredicate",disabled:!0,events:{onClick:function(){t._onAddPredicate()}}}),this._arrow.inject(this._divArrow),this._divArrow.inject(this._divMain)),this._divGrid=o.create("div",{class:"column-custo-grid-div-content grid"+(this._isEndUserMode()?" extend":"")}),this._divGrid.inject(this._divMain),this._divMain.inject(i),this._divFooter=o.create("div",{class:"column-custo-footer-div"}),this._divFooter.inject(i);let n=w.replace(w.get("SearchDataGridPreferences_modal_title"),{typeName:"End User"});e.is(this._typeToHandle)&&(n=!1===this._typeToHandle.isPQ?w.replace(w.get("SearchDataGridPreferences_modal_title"),{typeName:this._typeToHandle.typeName}):w.replace(w.get("SearchDataGridPreferences_modal_title_PQ"),{typeName:this._typeToHandle.typeName.pqNLS})),this._dialog=new S({identifier:"ColumnCustoPanel",title:n,content:i,resizableFlag:!0,position:{at:"100 50",of:this.options.searchDatagridView.container,collision:"fit"},minHeight:440,minWidth:550,autoCloseFlag:!this._isEndUserMode()}),this._dialog.elements.container.setStyle("z-index",4e3),this._dialog.elements.container.addClassName("search-column-custo-dialog"),this._dialog.addEventListener("close",function(){t._isEndUserMode()?t._dialog.hide():(t._dialog=null,t.dispatchEvent("onCloseColumnCustomizationPanel"))}),this._dialog.inject(document.body),e.is(this._dialog.elements)&&e.is(this._dialog.elements._closeButton)&&(this._bCloseTooltip=new u({target:this._dialog.elements._closeButton,body:w.get("custo_close.tooltip")}),this._bCloseTooltip.getContent().style.zIndex=this._zIndexToUse+2),this._createFooter()},_onAddPredicate:function(){return null},_createFooter:function(){return null},enableFooterButtonsVisiblity:function(){return this},_fillView:function(){return null},_getPrefGridData:function(){var t=[],i=this.options.spreadsheet,n=this;return this.options.availableColumns.forEach(function(s){if(s&&!1!==s.isInPreference){var o={colName:""===s.text?w["SearchDataGridPreferences_modal_"+s.dataIndex]?w["SearchDataGridPreferences_modal_"+s.dataIndex]:s.dataIndex:s.text,colClass:s.relatedObjectTypeDispValue,colWidth:s.width,origin_dataIndex:s.dataIndex,colSort:s.defaultSort,colWrap:s.wrap,colPinned:s.pinned,colRemove:s.isRemovable};if(!0!==n.options.isNewDataGrid){var a=i.getManager().getColumnIDFromDataIndex(s.dataIndex);e.is(a)?(o.colVisibility={isHidden:i.getManager().isColumnHidden(a),isRemovable:!(e.is(s.isRemovable)&&!1===s.isRemovable)},o.colWidth=i.getManager().getColumnWidth(s.dataIndex)):o.colVisibility={isHidden:!0,isRemovable:!0}}else!0===n.options.isNewDataGrid&&(void 0!==i.layout.getColumnIndex(s.dataIndex)?(o.colVisibility={isHidden:!s.visibility,isRemovable:!(e.is(s.visibilityEditable)&&!1===s.visibilityEditable)},o.colWidth=s.width):o.colVisibility={isHidden:!e.is(s.visibility,"boolean")||!s.visibility,isRemovable:!e.is(s.isRemovable,"boolean")||s.isRemovable});t.push(o)}}),t},_getcolumnsDefinitions:function(){let e=[];return this._isEndUserMode()&&e.push({text:w.get("SearchDataGridPreferences_modal_header_classpredicate"),dataIndex:"colClass",width:"auto",minWidth:40}),e=e.concat([{dataIndex:"origin_dataIndex",width:0,idHidden:!0},{text:w.get("SearchDataGridPreferences_modal_header_name"),dataIndex:"colName",width:"auto",minWidth:40,isDraggable:!0},{text:w.get("SearchDataGridPreferences_modal_visible_column"),dataIndex:"colVisibility",width:80,minWidth:40},{text:w.get("SearchDataGridPreferences_modal_width"),dataIndex:"colWidth",width:60,minWidth:40}]),p.getOption("enableDataGridView")&&e.push({text:w.get("SearchDataGridPreferences_modal_wrap_column"),dataIndex:"colWrap",width:80,minWidth:40})&&e.push({text:b.ContextualMenuBuilder.PinMenu,dataIndex:"colPinned",width:80,minWidth:40}),p.getOption("enableMultiSort-FUN096610")&&e.push({text:w.get("SearchDataGridPreferences_modal_sort_column"),dataIndex:"colSort",width:80,minWidth:40}),this._isEndUserMode()&&e.push({text:w.get("SearchDataGridPreferences_modal_header_remove"),dataIndex:"colRemove",width:30}),e},_addGridColumnsManager:function(){var t=this;null!==this.options.preferences_grid&&this.options.preferences_grid.destroy(),this.options.preferences_grid=new a({enableScrollOnDrag:!0,columns:this._getcolumnsDefinitions(),data:this._getPrefGridData(),defaultCellHeight:40,headersDimensions:{height:40},selection:{cells:!1},show:{rowHeaders:!0,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!0},isEditable:{switchToWriteView:{event:"dblclick",callback:function(){this.switchToWriteView()},view:function(e){switch(e.dataIndex){case"colClass":return o.create("div",{html:t.gridFinalValues[e.virtualRowID].dataTypeText||""});case"colName":return o.create("div",{html:t.gridFinalValues[e.virtualRowID].text});case"colWidth":var i=t.gridFinalValues[e.virtualRowID].width;return"auto"===t.gridFinalValues[e.virtualRowID].width&&(i=w.get("SearchColumnCusto.AutoSize")),o.create("input",{type:"text",placeholder:i,events:{change:function(i){i.stopPropagation();var n=this.value;!1===isNaN(n)?(n=parseInt(n,10),t.gridFinalValues[e.virtualRowID].width=n):(t.gridFinalValues[e.virtualRowID].width="auto",this.value=w.get("SearchColumnCusto.AutoSize")),t._unmodifiedCusto=!1}}})}}},switchToReadView:{event:"blur",callback:function(){this.switchToReadView()},view:function(i){if(!e.is(t.beingDestroyed)||!0!==t.beingDestroyed)switch(i.dataIndex){case"colClass":return o.create("div",{html:e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&t.gridFinalValues[i.virtualRowID].dataTypeText?t.gridFinalValues[i.virtualRowID].dataTypeText:"",attributes:{"data-type":t.gridFinalValues[i.virtualRowID].dataType},class:"cell-grid"});case"colName":var n="";return e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&(n=t.gridFinalValues[i.virtualRowID].text),o.create("div",{html:n,attributes:{"data-index":t.gridFinalValues[i.virtualRowID].dataIndex},class:"cell-grid"});case"colVisibility":var s=!(e.is(t.gridFinalValues[i.virtualRowID])&&!0===t.gridFinalValues[i.virtualRowID].visibilityEditable);"ds6w:what/ds6w:type"!==t.gridFinalValues[i.virtualRowID].dataIndex&&"ds6w:what/ds6w:identifier"!==t.gridFinalValues[i.virtualRowID].dataIndex||(s=!0);var a=new c({type:"switch",label:"",value:"",disabled:s,events:{onChange:function(e){e.stopPropagation();var n=this.isChecked();i.cellModel.setCellContent({isHidden:!n,isRemovable:!0}),t.gridFinalValues[i.virtualRowID].visibility=n,t._unmodifiedCusto=!1}}});return!1===i.cellModel.getCellContent().isHidden&&a.check(),a;case"colWidth":var l=t.gridFinalValues[i.virtualRowID].width;return!0===isNaN(t.gridFinalValues[i.virtualRowID].width)&&(l=w.get("SearchColumnCusto.AutoSize")),o.create("div",{text:l});case"colSort":{var d="alpha",u="none";e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&(h.log(t.gridFinalValues[i.virtualRowID]),e.is(t.options.oSearchCustoServices.DEFAULT_FIELDS[t.gridFinalValues[i.virtualRowID].dataIndex])&&(d=t.options.oSearchCustoServices.DEFAULT_FIELDS[t.gridFinalValues[i.virtualRowID].dataIndex]),e.is(t.gridFinalValues[i.virtualRowID].defaultSort,"string")&&(u=t.gridFinalValues[i.virtualRowID].defaultSort));let n=o.create("div",{class:"item-text item-icon-group"}),s=null,a=null,l=null;"group"===d?((s=o.create("Group",{title:"Grouping",order:"asc",class:"fonticon fonticon-tag-sorting"+("asc"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")})).inject(n),(l=o.create("span",{title:"None",class:"fonticon fonticon-cancel"+("none"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")})).inject(n)):((s=o.create("span",{title:"Ascending",order:"asc",class:"fonticon fonticon-sort-"+d+"-asc"+("asc"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")})).inject(n),(a=o.create("span",{title:"Descending",order:"desc",class:"fonticon fonticon-sort-"+d+"-desc"+("desc"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")})).inject(n),(l=o.create("span",{title:"None",class:"fonticon fonticon-cancel"+("none"===u?" "+t.options.oSearchCustoServices.SORT_ACTIVATED_CSS:"")})).inject(n));var g=function(e){for(var i=0,n=0;n<t.gridFinalValues.length;n++)n!==e&&t.gridFinalValues[n].defaultSort&&"none"!==t.gridFinalValues[n].defaultSort&&i++;return!(i>=p.getOption("search_datagrid").multisort_standard_fields)||(new r({closable:!0,animate:!0,overlay:!0}).dialog({body:w.replace(w.get("dataGrid.columnCustoPanel.maxDefaultSortSize"),{number:p.getOption("search_datagrid").multisort_standard_fields}),title:w.get("SearchDataGridPreferences_modal_information"),buttons:[{className:"primary",value:w.get("SearchDataGridPreferences_modal_apply"),action:function(e){e.hide()}}]}),!1)};return s.onclick=function(){g(i.virtualRowID)&&(t.gridFinalValues[i.virtualRowID].defaultSort="asc",s.classList.add(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),a&&a.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),l.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),t._unmodifiedCusto=!1)},a&&(a.onclick=function(){g(i.virtualRowID)&&(t.gridFinalValues[i.virtualRowID].defaultSort="desc",s.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),a.classList.add(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),l.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),t._unmodifiedCusto=!1)}),l.onclick=function(){t.gridFinalValues[i.virtualRowID].defaultSort="none",s.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),a&&a.classList.remove(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),l.classList.add(t.options.oSearchCustoServices.SORT_ACTIVATED_CSS),t._unmodifiedCusto=!1},o.create("div",{html:n})}case"colWrap":var _=new c({type:"switch",label:"",value:"",disabled:!1,events:{onChange:function(n){n.stopPropagation();var s=this.isChecked();if(s&&e.is(p.getOption("search_datagrid").wrap_standard_fields)){for(var o=0,a=0;a<t.gridFinalValues.length;a++)!0===t.gridFinalValues[a].wrap&&o++;if(o>=p.getOption("search_datagrid").wrap_standard_fields)return new r({closable:!0,animate:!0,overlay:!0,className:"searchModal"}).dialog({body:w.replace(w.get("dataGrid.columnCustoPanel.maxWrapSize"),{number:p.getOption("search_datagrid").wrap_standard_fields}),title:w.get("SearchDataGridPreferences_modal_information"),buttons:[{className:"primary",value:w.get("SearchDataGridPreferences_modal_apply"),action:function(e){e.hide()}}]}),void this.setCheck(!1)}i.cellModel.setCellContent(s),t.gridFinalValues[i.virtualRowID].wrap=s,t._unmodifiedCusto=!1}}});return!0===i.cellModel.getCellContent()&&_.check(),_;case"colPinned":{var f=null;let n=null,s=null,a=null,r=null;return e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&(h.log(t.gridFinalValues[i.virtualRowID]),e.is(t.gridFinalValues[i.virtualRowID].pinned,"string")&&(f=t.gridFinalValues[i.virtualRowID].pinned)),n=o.create("div",{class:"item-text item-icon-group"}),s=o.create("span",{title:b.ContextualMenuBuilder.PinLeft,order:"asc",class:"fonticon fonticon-picture-wrapping-left"+("left"===f?" "+t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS:"")}),a=o.create("span",{title:b.ContextualMenuBuilder.PinRight,order:"asc",class:"fonticon fonticon-picture-wrapping-right"+("right"===f?" "+t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS:"")}),r=o.create("span",{title:b.ContextualMenuBuilder.NoPin,order:"asc",class:"fonticon fonticon-cancel"+(null===f||"center"===f?" "+t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS:"")}),s.inject(n),a.inject(n),r.inject(n),s.onclick=function(){t.gridFinalValues[i.virtualRowID].pinned="left",s.classList.add(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),r.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),a.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),t._unmodifiedCusto=!1},a.onclick=function(){t.gridFinalValues[i.virtualRowID].pinned="right",s.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),r.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),a.classList.add(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),t._unmodifiedCusto=!1},r.onclick=function(){t.gridFinalValues[i.virtualRowID].pinned="center",s.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),r.classList.add(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),a.classList.remove(t.options.oSearchCustoServices.PINNED_ACTIVATED_CSS),t._unmodifiedCusto=!1},o.create("div",{html:n})}case"colRemove":if(e.is(t.gridFinalValues,"array")&&e.is(i.virtualRowID)&&e.is(t.gridFinalValues[i.virtualRowID].isRemovable)&&!0===t.gridFinalValues[i.virtualRowID].isRemovable){var m=o.create("span",{title:w.get("SearchDataGridPreferences_modal_remove"),class:"fonticon fonticon-bin"});return m.onclick=function(){t.gridFinalValues.splice(i.virtualRowID,1),t.options.preferences_grid.getManager().removeRow(i.virtualRowID)},m}return""}}}},shouldAcceptDrag:function(e){return-1!==e.virtualRowID&&-1===e.virtualColumnID},onDragStart:function(){h.log("DRAG STARTED !")},onDrop:function(){return!0},isSortable:!1}),this.options.preferences_grid.getContent().addClassName(this.name),this.options.preferences_grid.inject(this._divGrid),this.options.preferences_grid.getManager().onRowHeaderRequest(function(e){var t=e.cellView.getContent();t.setStyles({paddingLeft:5,paddingRight:5,opacity:.5,fontSize:"1.5em"}),t.addClassName("wux-ui-hamburger")}),this.options.preferences_grid.getManager().onMoveRow(function(i){if(e.is(i.fromRowID)&&e.is(i.toRowID)){var n=t.gridFinalValues.splice(i.fromRowID,1);t.gridFinalValues.splice(i.toRowID,0,n[0]),t._unmodifiedCusto=!1}})},_computeColToDisplayInCustoPanel:function(t,i,n){if(!e.is(t,"array")||!e.is(i,"array"))return h.error("Bad args in _computeColToDisplayInCustoPanel !"),s;var s=[],o=0,a=0,r={},l=0,c=0,d={"ds6w:what":!0,"ds6w:when":!0,"ds6w:where":!0,"ds6w:who":!0,"ds6w:why":!0,"ds6w:how":!0};for(o=0,a=t.length;o<a;o++)if(!e.is(r[t[o].dataIndex])){if("ds6wg:_displayName_"===(v=t[o].dataIndex))continue;r[v]=!0,r[v.slice(v.lastIndexOf("/")+1,v.length)]=!0;var u=t[o];if(!e.is(u.visibility)){u.visibility=!0,u.visibilityEditable=!0;for(var g=!1,p=0,f=i.length;p<f&&!g;p++)u.text!==i[p].dispValue&&u.uri!==i[p].sixw||(g=!0,u.dataType=i[p].relatedObjectType,u.name=i[p].name,u.text=i[p].dispValue,u.type=i[p].type)}s.push(u)}var m=[];for(o=0,a=i.length;o<a;o++)e.is(i[o].sixw)&&!e.is(r[i[o].sixw])&&(r[i[o].sixw]=!0,m.push({dataIndex:i[o].sixw,dataType:i[o].relatedObjectType,dataTypeText:i[o].relatedObjectTypeDispValue,name:i[o].name,text:e.is(i[o].dispValue,"string")&&i[o].dispValue.length>0?i[o].dispValue:_.getNLSValueForPredicate(i[o].sixw),isSortable:!1,minWidth:40,width:"auto",type:i[o].type,visibility:i[o].visibility||!1,visibilityEditable:!0,isRemovable:i[o].isRemovable||!1}));if(e.is(n))for(o=0,a=n.length;o<a;o++){var v=n[o].sixw.slice(n[o].sixw.lastIndexOf("/")+1,n[o].sixw.length);!e.is(v)||e.is(r[v])||e.is(d[v])||(r[v]=!0,m.push({dataIndex:v,dataType:n[o].relatedObjectType,name:n[o].name,text:e.is(n[o].dispValue,"string")&&n[o].dispValue.length>0?"* "+n[o].dispValue:"* "+_.getNLSValueForPredicate(v),isSortable:!1,minWidth:40,width:"auto",type:n[o].type,visibility:!1,visibilityEditable:!0}))}var S=["ds6w:identifier","ds6w:type"];for(l=0,c=s.length;l<c;l++)for(o=S.length-1;o>=0;o--)s[l].dataIndex!==S[o]&&s[l].dataIndex!=="ds6w:what/"+S[o]||(S.splice(o,1),s[l].visibility=!0,s[l].visibilityEditable=!1);for(l=0,c=m.length;l<c;l++)for(o=S.length;o>=0;o--)m[l].dataIndex===S[o]&&(S.splice(o,1),m[l].visibility=!0,m[l].visibilityEditable=!1);for(o=0;o<S.length;o++)m.push({dataIndex:S[o],dataType:null,name:S[o],text:_.getNLSValueForPredicate(S[o]),isSortable:!1,minWidth:40,width:"auto",visibility:!0,visibilityEditable:!1});return m.sort(function(e,t){var i=0;return e.text.toUpperCase()>t.text.toUpperCase()?i=1:e.text.toUpperCase()<t.text.toUpperCase()&&(i=-1),i}),s=s.concat(m)},_applySetting:function(t,i){let n=[],s=[];if(f.isFUN096612Active()&&e.is(this._typeToHandle)&&e.is(this._typeToHandle.typeName)&&e.is(this._typeToHandle.typeName.pqName)){var o=this.options.oSearchCustoServices.getDisplayNameColumn(this._typeToHandle.typeName.pqName);e.is(o)&&n.push(o)}for(let t=0,i=this.gridFinalValues.length;t<i;t++){let i=this.gridFinalValues[t],o={dataIndex:i.dataIndex,name:e.is(i.name,"string")&&i.name.length>0?i.name:null,dataType:i.dataType,dataTypeText:i.dataTypeText||"",text:i.text,width:i.width,type:i.type,isSortable:!1,minWidth:40,defaultSort:e.is(i.defaultSort,"string")?i.defaultSort:"none",wrap:void 0!==i.wrap&&i.wrap,pinned:e.is(i.pinned,"string")?i.pinned:"center",isRemovable:!!e.is(i.isRemovable,"boolean")&&i.isRemovable};!0===i.visibility?n.push(o):this._isEndUserMode()&&(o.visibility=i.visibility,o.visibilityEditable=i.visibilityEditable,s.push(o))}this.options.searchDatagridView.updateCustoColumnAttribute(t,n),this.options.searchDatagridView._updateColumns(n,t,i,s)},_applyReset:function(t){t=t||this._typeToHandle;e.is(t)&&(t.forcedCusto="The_Default_Columns"),g.setItem("listColumnsWidth",""),g.commit();var i=this.options.oSearchCustoServices.getColumnCustomizationIdToUse(t);this.options.searchDatagridView._updateColumns(this.options.oSearchCustoServices.getColumnCustomizationDefinitionFromCustoId(i),i,!1)},_requestClosePanel:function(){e.is(this._dialog)&&(!this._isEndUserMode()&&e.is(this._dialog.close,"function")?(this._dialog.close(),this._dialog=null):this._isEndUserMode()&&e.is(this._dialog.hide,"function")&&this._dialog.hide())},showDialog:function(){e.is(this._dialog)&&e.is(this._dialog.show,"function")&&this._dialog.show()},_displayCusto:function(t,i){if(h.log("displayCusto"),!e.is(this.options.preferences_grid))return;this.options.preferences_grid.getManager().empty(),t===w.get("SearchDataGridPreferences_modal_unsavedCusto")&&(t="TEMP_CUSTO");let n=[];n=!0!==i?e.is(t)&&t.length>0?this.options.oSearchCustoServices.getColumnCustomizationDefinitionFromCustoId(t):this.options.searchDatagridView._columnsAttributes:this.gridInitValues;let s=this._computeColToDisplayInCustoPanel(n,this._predicateIntersection,this.options.currentTags),o=[],a=!1;for(var r=0;r<s.length;r++)if(e.is(s[r].text)&&-1!=s[r].text.indexOf("ds6w")){1==(s[r].text.match(/ds6w/g)||[]).length&&(o.push(s[r].dataIndex),a=!0)}else e.is(s[r].text)&&-1==s[r].dataIndex.indexOf("ds6w")&&(o.push(s[r].dataIndex),a=!0);let l=this,c=t=>{let i=[];l.gridFinalValues=t;for(var n=0,s=l.gridFinalValues.length;n<s;n++)i.push({colClass:l.gridFinalValues[n].dataTypeText||"",colName:l.gridFinalValues[n].text,colWidth:l.gridFinalValues[n].width,origin_dataIndex:l.gridFinalValues[n].dataIndex,colVisibility:{isHidden:!l.gridFinalValues[n].visibility,sisRemovable:!0},colSort:l.gridFinalValues[n].defaultSort,colWrap:l.gridFinalValues[n].wrap,colPinned:l.gridFinalValues[n].pinned,colRemove:!!e.is(l.gridFinalValues[n].isRemovable,"boolean")&&l.gridFinalValues[n].isRemovable});l.options.preferences_grid.getManager().addRows(i),l.options.preferences_grid.getManager()._setColumnsWidth()};if(a){let t=this,i="";if(e.is(this.options.searchDatagridView.collection)&&e.is(this.options.searchDatagridView.collection.search_ressources)&&e.is(this.options.searchDatagridView.collection.search_ressources.getActiveTenant,"function")&&(i=this.options.searchDatagridView.collection.search_ressources.getActiveTenant()),o.length>0){var d=o.join("\r\n");m.getResourcesInfo(d,{tenantId:i,lang:f.getLanguage(),apiVersion:"R2019x",onComplete:function(i){if(h.log(i),!e.is(i))return h.error("Unexpected response from getResourcesInfo !"),null;for(var n=0,o=s.length;n<o;n++)for(var a=0,r=i.length;a<r;a++){if(!e.is(i[a].curi)||!e.is(i[a].label))return h.error("Unexpected response from getResourcesInfo !"),null;i[a].curi!==s[n].dataIndex||s[n].text===i[a].label||(s[n].text="* "+i[a].label)}c&&c.call(t,s)},onFailure:function(){h.warn("not able to load predicates")}})}}else c.call(this,s)},destroy:function(){this.beingDestroyed=!0,this.defaultOptions=null,this._divCombo=null,this._divGrid=null,this._divGrid=null,this._divFooter=null,this._divMain=null,this._divArrow=null,this._divAvailable=null,e.is(this._arrow)&&this._arrow.destroy()&&(this._arrow=null),e.is(this._dialog)&&this._dialog.destroy()&&(this._dialog=null),e.is(this._bCloseTooltip)&&this._bCloseTooltip.destroy()&&(this._bCloseTooltip=null),e.is(this.options.preferences_grid)&&this.options.preferences_grid.destroy()&&(this.options.preferences_grid=null),this._custoNameEdt=null,null!=this.qForceClose&&v.unsubscribe(this.qForceClose),this._parent()}})}),define("DS/SNResultUX/views/helpers/utils/AbstractMultiView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNResultUX/utils/ResultCategoryUXHelper","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","DS/Utilities/Dom","DS/Utilities/Utils","DS/UIKIT/IconDropdown","DS/MessageBus/MessageBus","UWA/Utils/Client","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m){"use strict";return e.extend({className:"MultiView",attributes:{styles:{width:"100%"},"data-rec-id":"SearchMultiView"},sixw:"ds6w:type",bShowTooltip:!1,views:[],multiViewContainer:null,switcherDropDown:null,collectionUX:null,collections:[],allowedviews:[],poolMultiViewContainerHeight:null,setPoolMultiViewContainerHeight:function(e){this.poolMultiViewContainerHeight=e},getPoolMultiViewContainerHeight:function(){return this.poolMultiViewContainerHeight},currentPoolMultiViewContainer:0,setCurrentPoolMultiViewContainer:function(e){this.currentPoolMultiViewContainer=e},getCurrentPoolMultiViewContainer:function(){return this.currentPoolMultiViewContainer},_reachBottomEventFire:!1,_infiniteScrollTagRunning:!1,_hasToBeRefreshed:!0,_lastselectedSearchId:null,_lastNbSection:0,_WHATmappedViews:[],_totalCount:0,_totalCountSection:0,_onGroupingCompute:!1,_ComputeGroup:!1,_RefineFromDropMenu:!1,_memorylastselectedSearchId:null,_viewAllProvide:!1,_heightInjected:20,_lastlocalFilters:null,events:[],indexCopiedCACHED:null,init:function(e){this._parent(e),this.view=void 0,this._unloadViews(),this.multiViewContainer=null,this.collections=[],this.events=[],this.indexCopiedCACHED=null,this.setPoolMultiViewContainerHeight(0),this.setCurrentPoolMultiViewContainer(0),this._attachEvents(),this._reachBottomEventFire=!1,this.collectionUX=null,this._infiniteScrollTagRunning=!1,this.switcherDropDown=null,this.allowedviews=[],this._hasToBeRefreshed=!0,this._lastselectedSearchId=null,this._lastNbSection=0,this._WHATmappedViews=[],this._memorylastselectedSearchId=null,this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction"),this._totalCount=e&&e.collection.totalCount,this._totalCountSection=0,this._onGroupingCompute=!1,this._ComputeGroup=!1,this._RefineFromDropMenu=!1,this._viewAllProvide=!1,this._heightInjected=20,this._lastlocalFilters=null},initModel:function(e){let t=this;this._model=e||this.collection.getTreeDocument(),this._lastXscreen=0,this.modelEventTokenForOnAdd=this._model.getXSO().onAdd(function(e){t.onItemSelected(e,t.indexCopiedCACHED)}),this.modelEventTokenForOnRemove=this._model.getXSO().onRemove(function(e){t.onItemUnselected(e,t.indexCopiedCACHED)}),this.view&&(this.view.model=this._model)},onSearch:function(e){this._parent(e)},setup:function(e){let i=this;this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){},onSetTags:function(e){},onInitTreeDocumentAsyncCB:function(e){n.log("AbstractMultiView onInitTreeDocumentAsyncCB Event",e),i._lastlocalFilters=i._getLocalFilters(),i._computeDisplay()},OnGroupingChange:function(e){n.log("AbstractMultiView OnGroupingChange Event",e),i._viewAllProvide=!1,i._refreshViewFromOnGrouping(e)},onInitTreeDocument_SelectFirstElt:function(){n.log("AbstractMultiView onInitTreeDocument_SelectFirstElt Event",e);let o=i.getCurrentViewId();if(o===i.getViewId()){let n=i.collection.getTaggerProxy(),a=n.getCurrentFilter();!0===d.IfLastRefineisInTheGoodW(o,n,i._lastlocalFilters)?t.is(a)&&t.is(a.localFilters)&&t.is(a.localfilters.condition,"array")&&a.localfilters.condition.length>0&&(n.clearLocalGrouping(),i.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode"))):i._refreshViewFromOnGrouping(e)}}})},_attachEvents:function(){var e=this;this.events.push(p.subscribe({channel:"3dSearch-global-view",topic:"emptyViews",callback:this._resetViews.bind(this)})),this.events.push(p.subscribe({channel:"3dSearch-global-view",topic:"reloadViews",callback:()=>{e._unselectAllButMe(),e._resetViews(),e._loadViews(0)}}))},_onInitTreeDocumentAsyncCB:function(e){let s=this;if(!0===s._onGroupingCompute)return;s._emptyViews(),s._resetViews(),s._onGroupingCompute=!0,null!==this.collectionUX&&delete this.collectionUX,i.getOption("debug")&&n.log("MultiView tags retrieved",s.getSNResultMgt().getEmbeddedTaggerTags());let a=s._getEmbeddedTaggerTags(e);void 0!==a&&(t.is(e)&&(s._ComputeGroup=a.computeGroup),this.mask(),l.getResultCategoryUXHelper().then(function(){let e=s.collection.service_parameters.originalSearchCriteria;"Favorite Searches"===e&&(e="(owner:"+o.getUserId()+" AND flattenedtaxonomies:types/PLMWspFavoriteSearch) OR flattenedtaxonomies:types/SavedSearch"),s.collectionUX=l.getResultsCollections({search_text:e,categories:a.Tags,refine:s.collection.getTaggerProxy().getCurrentFilter(),facets:s.collection.parsed_response.getTags().summaryData,feature:i.getOption("fedsearch_query_label.feature_id.6WSearch")}),s.collectionUX.getFirstPage({onComplete:function(){let e=s.collectionUX.getCategoryCollectionsList();i.getOption("debug")&&n.log("run",e),s.collections=e,s._loadViews(0,s.collections.length),s._onGroupingCompute=!1,s._totalCount=s.collection.totalCount,s.collection&&s.collection.getSNSkeleton().updateCounterView(s._totalCount),s.collection.getSNSkeleton().switchOnView(s.getViewId()),s.refreshViewAfterComputeList()},onFailure:function(e){console.log("FAIL",e)}})}))},isMultiSelMode:function(){return!1},onItemTitleClick:function(e,i){p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnItemTitle",persDim:{pd1:o.trackerData.search.indexItem+" index"}}});let n=e.nodeModel?e.nodeModel:e,s=this.collection.getSNSkeleton();t.is(s)&&s.onItemTitleClick(n,null,i)},onItemSelected:function(e,i){if(!t.is(e))return;p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"onItemSelected",persDim:{pd1:o.trackerData.search.indexItem+" index"}}});let n=e._options.id;if(this.getCurrentViewId()!==this.getViewId())return;if(this._memorylastselectedSearchId===n)return this._unselectAllButMe(),void(this._memorylastselectedSearchId=null);this._unselectAllButMe(i),this._lastselectedSearchId=n,this._memorylastselectedSearchId=n,this.onItemSelectedTracker(e);let s=this.collection.getSNSkeleton(),a=e.getTreeDocument();t.is(a)&&(this.indexCopiedCACHED=i,t.is(s)&&s.onItemSelected(n,null,this.collections[i],a))},onItemUnselected:function(e,i){if(!t.is(e))return;if("myContent"===this.getViewId())return this._parent(e);this.getCurrentViewId()===this.getViewId()&&(this._lastselectedSearchId=null);let n=this.collection.getSNSkeleton(),s=e.getTreeDocument(),o=this.collections[i];t.is(s)&&(e&&e._options&&e._options.id&&this._memorylastselectedSearchId===e._options.id&&(this._memorylastselectedSearchId=null),this.indexCopiedCACHED=null,t.is(n)&&n.onItemSelected(null,null,o,s))},_unloadViews:function(){for(let e=0;e<this.views.length;e++)t.is(this.views[e])&&(t.is(this.views[e].view)&&this.views[e].view.destroy(),t.is(this.views[e].model)&&this.views[e].model.destroy());this.views=[]},_emptyViews:function(){if(this.views.length>0){for(let e=0;e<this.views.length;e++)null!==this.views[e]&&t.is(this.views[e])&&t.is(this.views[e].model)&&(this.views[e].model.prepareUpdate(),this.views[e].model.removeRoots(),this.views[e].model.pushUpdate());this.views=[]}},_instantiateResponsiveCollection:function(e,i,n){let s=new e(i),o=this;s.selectionBehavior.toggle=!1,s.selectionBehavior.canMultiSelect=!1,s.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=!1,s.selectionBehavior.enableShiftSelection=!1,s.selectionBehavior.enableFeedbackForActiveCell=!1,s.onCellDoubleClick(e=>{o.onItemDblClick(e.cellModel)});let a=t.clone(n);return s.onSelectionAdd(e=>{o.onItemSelected(e,a)}),s.onSelectionRemove(e=>{o.onItemUnselected(e,a)}),t.is(this._simpleSearch)&&!0===this._simpleSearch&&t.is(s.onCellTitleClick,"function")&&s.onCellTitleClick(e=>{o.onItemTitleClick(e.cellModel,o.collections[a])}),s.onContextualEvent=i.onContextualEvent,s.displayTitleTooltip=this.bShowTooltip,!0===this.neverCheckbox&&(s.visibilityFlag=!1),s},_instantiateDataGrid:function(e,i,n,s){let o=this,a=t.clone(n),r=new e({treeDocument:i.model,defaultColumnDef:{width:"auto",typeRepresentation:"string",allowUnsafeHTMLContent:!0},columns:this._retrieveDataGridOptions(i.collection,a).columns,defaultColumnDef:{width:"auto",typeRepresentation:"string",allowUnsafeHTMLContent:!0},collection:this.collection,rowSelection:"single",cellSelection:"none",onDragStartCell:i.onDragStartCell,onDragEndCell:i.onDragEndCellDefault,cellDragEnabledFlag:!0,isLoading:!0,bDisableMenuCustoView:!0,bDisableMenuWrap:!0,enable3dSearchSortMulti:!1,enable3dSearchSort:!1,onContextualEvent:function(e){return e&&e.cellInfos&&-1!==e.cellInfos.rowID?o.getOptionCommon().onContextualEvent.callback(e):e&&e.collectionView?e.collectionView.build3DSearchHeaderColumnContextualMenu(e,o):[]}});return r.onReady(()=>{r.postInit(),r.getNodesXSO().onAdd(e=>{o.onItemSelected(e,a)}),r.getNodesXSO().onRemove(e=>{o.onItemUnselected(e,a)})}),r},_retrieveDataGridOptions:function(e,t){return c.initColumnsDataGrid({columns:[{dataIndex:"ds6w:label",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.label"),width:"auto",canBeInvisible:!1},{dataIndex:"ds6w:type",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.type"),width:"auto"},{dataIndex:"ds6w:description",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.description"),width:"auto"},{dataIndex:"ds6w:identifier",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.identifier"),width:"auto"},{dataIndex:"ds6w:modified",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.modified"),width:"auto"},{dataIndex:"ds6w:created",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.created"),width:"auto"},{dataIndex:"ds6w:responsible",editableFlag:!1,isCustom:!0,sortableFlag:!0,text:m.get("view.multi.datagrid.responsible"),width:"auto"}]},{onClickEvent:this._callBackActionMenu,onContextualEvent:this.getOptionCommon().onContextualEvent.callback,onItemTitleClickCallback:this.onItemTitleClick,onDblClickEvent:this._callBackDblClickActionMenu,onItemTitleDblClickCallback:this.onItemDblClick,referer:this,actionsMenuAccessRights:this._getMenuAndLocalActionsStatus(),tabId:this.collection.getSNSkeleton().getOption("observable").getTabID(),tooltipCB:this._tooltipCB,collection:e,datagridID:t})},_reachBottom:function(e){if(this._reachBottomEventFire)return;i.getOption("debug")&&n.log("reachBottom_event");let t=this;this._reachBottomEventFire=!0,this._onInfiniteScrollMulti(e,()=>{t._reachBottomEventFire=!1})},_unselectAllButMe:function(e){for(let t=0;t<this.views.length;t++)e!=t&&null!=this.views[t]&&void 0!==this.views[t].view&&("list"===this.views[t].type||"table"===this.views[t].type||"datagrid"===this.views[t].type?this.views[t].view.unselectAll(!0):this.views[t].view.unselectAll())},_resetViews:function(){this._infiniteScrollTagRunning=!1,this._reachBottomEventFire=!1,this._unloadViews(),t.is(this.multiViewContainer)&&(this.multiViewContainer.innerHTML=""),this._heightInjected=20},_loadViews:function(e,r){let l=this;require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView","DS/SNResultUX/views/WebUX/DataGrid/DataGridView"],function(c,u,g,_,m){let v=l.getOptionCommon();v.height="inherit",v.useDragAndDrop=!0,v.displayedOptionalCellProperties=["contextualMenu","description"];let S=l.collection.getSNSkeleton()&&l.collection.getSNSkeleton().getSearchWidget(),w=t.is(S)?S.body:t.extendElement(document.body).getElement(".onesearch_results"),b=l.multiViewContainer&&l.multiViewContainer.getDimensions(),C=b&&b.height,y=0,I=r||l.collections.length;for(let r=e;r<I;r++){let e=l.collections[r];try{if(!t.is(e,"object")||0===e.totalCount){l.views[r]=null,y++;continue}let S={...v},D=new a({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});l.collection.generateTreeModelAsync(e._models,D),S.model=D,S.collection=e,e.setTaggerProxy(l.collection.getTaggerProxy()),e._treeDocument=D;let T=d.createSearchMultiViewLabel(e,l.id,{onclick:()=>{p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewSection",persDim:{pd1:"0"}}}),l._onTitleClick(e.headTitle,T,!0)}});T.inject(l.multiViewContainer);let A="tile";try{"what"===l.getCurrentViewId()&&t.is(e.view)&&(A=l._WHATmappedViews[e.view.id][e.view.object].view)}catch(e){i.getOption("debug")&&n.log("[WHAT] : ",e),A="tile"}"where"===l.getCurrentViewId()&&(A="tile"),"when"!==l.getCurrentViewId()&&"who"!==l.getCurrentViewId()||(A="tile"),void 0!==s.getItem("LastSearchViewMode")&&(A=s.getItem("LastSearchViewMode"));let x=t.is(A)?A:"tile",N={model:S.model,type:x,tag:r};if(-1===e.totalCount)continue;switch(A){case"thumbnail":S.displayedOptionalCellProperties=["contextualMenu"],N.view=l._instantiateResponsiveCollection(g,S,r),N.view.onPostCellRequest&&N.view.onPostCellRequest(e=>{let i=e.cellView;t.is(i)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("auto")});break;case"largeTile":case"tilebig":N.view=l._instantiateResponsiveCollection(u,S,r);break;case"textual":case"largeTextual":N.view=l._instantiateResponsiveCollection(c,S,r);break;case"tile":N.view=l._instantiateResponsiveCollection(_,S,r);break;case"list":case"table":case"datagrid":N.view=l._instantiateDataGrid(m,S,r,e);break;default:throw new Error("[MultiView] - incorrect view model given.")}N.view&&N.view.onReady(()=>{l.setPoolMultiViewContainerHeight(l.container.scrollHeight);let n=h.debounce(function(e){N.view.requestDelayedModelData(e);let t=N.view._dimensions;l._heightInjected+=48,l._heightInjected+=t&&t.height,l._heightInjected<=C&&r===I-1&&(l._reachBottomEventFire=!0,l._onInfiniteScrollMulti(null,()=>{l._reachBottomEventFire=!1}))},1);N.view._updateDimensions(),N.view.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),N.view._onEndResizeOrOnReadyModelCompletionRequest("OnEndResize"),n("OnResize"),N.view._modelEvents.publish({event:"ENDRESIZE",context:N.view}),!0===i.getOption("search_compact_mode")&&N.view.onPostCellRequest&&N.view.onPostCellRequest(function(e){var i=null;i=e.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu"),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-ui-3ds-open-down"))&&(i.style.display="none",i=void 0),t.is(i)&&i.setAttribute("has-menu","false")}),l.updateListContentAfterCreation(e,A,b)}),l.views[r]=N,t.is(A)&&"list"!==A?l.views[r].view.getContent().inject(l.multiViewContainer):l.views[r].view.inject(l.multiViewContainer);let O=f.get("search.result.view.more");o.isMobile()&&"ipad"!==o.getDeviceCategory()&&"android"!==o.getDeviceCategory()||(O=S.collection.service_parameters.query.contains("ds6w:responsible")&&0===r&&"ME"===S.collection.headTitle&&void 0===S.collection.icon.classes?f.get("search.result.view.more.myContent"):f.replace(f.get("search.result.view.more.content"),{type:e.headTitle}));let P=t.createElement("div",{class:"search-multi-view-more",content:O,"data-rec-viewmore-uid":""});P.inject(l.multiViewContainer),P.onclick=(t=>{p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewMore",persDim:{pd1:"0"}}}),i.getOption("FUN127551")?l._onViewMoreClick(r,t):l._onTitleClick(e.headTitle,T,!0)}),e.moreView={label:P,viewType:A},!1===d.ifDisplayViewMore(A,e,w.getDimensions(),l.getViewId())&&(o.isMobile()?P.setStyle("display","none"):P.setStyle("visibility","hidden")),y>0&&(l._reachBottomEventFire=!0,l._onInfiniteScrollMulti(null,()=>{l._reachBottomEventFire=!1}))}catch(e){i.getOption("debug")&&n.log(e)}}l.unmask(),l.dispatchEvent("onMultiView",{collections:l.collections})})},_onInfiniteScrollMulti:function(e,t){if(i.getOption("debug")&&n.log(e,this._infiniteScrollTagRunning),!0===this._infiniteScrollTagRunning)return;let s=this;this._infiniteScrollTagRunning=!0,s.collectionUX.hasNextPage()&&(s.collection.getSNSkeleton()._toggleLoader(),s.collectionUX.getNextPage({onComplete:function(){let e=s.collectionUX.getCategoryCollectionsList(),o=s.collections.length;i.getOption("debug")&&n.log("fetch all done..."+s.collectionUX.hasNextPage(),e),s.collections=s.collections.concat(e),s._loadViews(o),t&&t(),s._infiniteScrollTagRunning=!1,s.collection.getSNSkeleton()._toggleLoader(),s.unmask()},onFailure:function(){s.collection.getSNSkeleton()._toggleLoader(),s.unmask()}}))},_onTitleClick:function(e,o,a=!1){let r;p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitleCategory",persDim:{pd1:e}}});let l=this.collection.getTaggerProxy();if(!t.is(l))throw new Exception("No tagger proxy given");try{r=this.getSNResultMgt().getEmbeddedTaggerTags().groups[0].object}catch(e){i.getOption("debug")&&n.log("MultiView title click",e)}this._viewAllProvide=!1,t.is(a)&&!0===a&&(l.clearLocalGrouping(),this._viewAllProvide=!0);for(let i=0;i<r.length;i++){let n=r[i];if(n.dispText===e&&t.is(n.object,"object")&&("date"===n.type||t.is(n.object.predicates,"array")&&t.is(n.object.value,"array")&&n.object.predicates.length==n.object.value.length)){if(!0===this._viewAllProvide){!0===d.IfMustAddRefineOnTitleClick(l,e)&&this._setLocalFilter(l,n,this.id),!0===this._viewAllProvide&&(this._totalCountSection=this.collection.totalCount,this.collection.getSNSkeleton().updateCounterView(this._totalCountSection),this.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode")));break}this._setLocalFilter(l,n,this.id);break}}this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideGlobeView(),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideTimelineView(),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hidePhonebookView(),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideTagcloudView()},_onViewMoreClick:function(e,t){let i=this;require(["DS/CollectionView/CollectionViewPaginationManager","DS/DataGridView/DataGridViewPaginationManager","DS/CollectionView/CollectionViewStatusBar"],function(n,s,o){let a=new n({pageSize:8,nodeDepth:0,currentPage:1});i.views[e].view.paginationManager=a,i.views[e].view.buildStatusBar([{type:o.STATUS.PAGINATION,position:"center"}]),i.views[e].view.onPaginationChanged=function(){console.log("page changed")},i.views[e].view.paginationManager.subscribeToPaginationUpdate(i.views[e].view,i.views[e].view.onPaginationChanged),i.collections[e]&&i.collections[e].hasNextPage()&&i.collections[e].getNextPage({remove:!1,onComplete:function(){i.collections[e].generateTreeModel()},onFailure:function(){console.error("Fail")}}),t&&t.target&&(t.target.style.display="none")})},_setLocalFilter:function(e,t){let i,n=this,s=[{display:t.dispText,object:t.identifier,type:t.type,predicates:t.object.predicates,value:t.object.value,operator:"OR"}],o={};"what"===n.id||"who"===n.id?i="ds6w:"+n.id+"/":"when"===n.id?i="sixw:ds6w:when/":"where"===n.id&&(i="ds6w:where/ds6w:location/"),i+=n.getSNResultMgt().getEmbeddedTaggerTags().groups[0].predicate,"what"===n.id||"who"===n.id||"where"===n.id?o[i]={condition:s,isComplex:!0,operator:"OR"}:"when"===n.id&&(o[i]=[{displayValue:t.dispText,object:t.object,isSimplifiedCriteria:!0,type:t.type}]);let a={condition:[o],operator:"AND",isSimplified:{version:2}};e.setLocalFilter(a,!0)},_renderMulti:function(){let e=this;this.multiViewContainer=t.createElement("div",{class:"search-multi-view","data-rec-id":"search-multi-view"}).inject(this.container);let i=t=>{e.setCurrentPoolMultiViewContainer(parseInt(e.container.scrollTop+e.container.offsetHeight+188)),e.getCurrentPoolMultiViewContainer()>=2*e.getPoolMultiViewContainerHeight()/3&&e._reachBottom(t)};u.addEventOnElement(this,this.container,"wheel",e=>{i(e)}),u.addEventOnElement(this,this.container,"mouseup",e=>{i(e)}),u.addEventOnElement(this,this.container,"touchend",e=>{i(e)})},render:function(){return this._unloadViews(),null===this.multiViewContainer&&this._renderMulti(),this},launchContextMenu:function(e,i){if(!t.is(e))return;let n=this,s=null,a=null,r=e.getTreeDocument();if(t.is(r))if(o.isWebInWin())this._parent.apply(this,arguments);else{let o=r.getXSO().get();if(-1===o.indexOf(e)){for(s=0;s<o.length;s++){let e=r.getRoots().indexOf(o[s]);r.getNthRoot(e).unselect()}-1!==(a=r.getRoots().indexOf(e))&&r.getRoots()[a].select()}o=r.getXSO().get();let l=[],c=n.collections.length;for(let e=0;e<c;e++){let a=n.collections[e];for(s=0;s<o.length;s++){let n=a.get(o[s]._options.id);t.is(n)&&(l.push(n),i.collection=a,e=c)}}let d=n.collection.getSNSkeleton();t.is(d)&&t.is(l,"array")&&l.length>=0&&d.computeCtxActions2(l,i)}},showEmptyView:function(){let e=t.extendElement(this.container.querySelector(".search-multi-view"));t.is(e)&&e.setStyle("display","none"),this._parent.apply(this,arguments)},hideEmptyView:function(){this._parent.apply(this,arguments);let e=t.extendElement(this.container.querySelector(".search-multi-view"));t.is(e)&&e.setStyle("display","block")},_getEmbeddedTaggerTags:function(e){let s,o=this.collection.getTaggerProxy();if(!t.is(o))throw new Exception("No tagger proxy given");try{s=t.is(e,"object")&&t.is(e.groups,"array")?e:this.getSNResultMgt().getEmbeddedTaggerTags()}catch(e){i.getOption("debug")&&n.log("Embedded tags error",e)}if(s=d.getEmbeddedTaggerTags(this.getViewId(),o,s,this.getSNResultMgt(),!1),t.is(s)&&p.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTag",persDim:{pd1:s.W}}}),s&&"what"===s.W){let e=[];for(let t=0;t<s.Tags.groups[0].object.length;t++)s.Tags.groups[0].object[t].identifier&&e.push({nls:s.Tags.groups[0].object[t].dispText,category:s.Tags.groups[0].object[t].identifier});this._WHATmappedViews=l.getViewMapping(e)}return s},_manageSearchBackArrow:function(e){return d.manageSearchBackArrow(this,e)},manageDisplayChannelView:function(e){let s=this,o=s.collections.length;for(let a=0;a<o;a++){let o=s.collections[a],r="tile";try{"what"===s.getCurrentViewId()&&t.is(o.view)&&(r=s._WHATmappedViews[o.headTitle].view)}catch(e){i.getOption("debug")&&n.log("[WHAT] : ",e),r="tile"}"where"===s.getCurrentViewId()&&(r="tile"),"when"!==s.getCurrentViewId()&&"who"!==s.getCurrentViewId()||(r="tile"),d.manageDisplayChannelView(o,r,e);let l=o.moreView;if(t.is(l)){let t=l.viewType,i=l.label;i.setStyle("visibility","visible"),!1===d.ifDisplayViewMore(t,o,e)&&i.setStyle("visibility","hidden")}}},_refreshViewFromOnGrouping:function(e){let t=this,i=t.getCurrentViewId(),n=t.getViewId();n===i&&(t._hasToBeRefreshed=!0,i===n&&(t._onInitTreeDocumentAsyncCB(e),t._hasToBeRefreshed=!1,t._lastNbSection=0))},_refreshViewGrouping:function(){let e=this;e._hasToBeRefreshed=!0;let i=e.getCurrentViewId(),n=e.getViewId(),s=e.getSNResultMgt().getEmbeddedTaggerTags();if(i===n)!0===e._ComputeGroup&&(e._onInitTreeDocumentAsyncCB(s),e._hasToBeRefreshed=!1,e._ComputeGroup=!1),e._lastNbSection=0,e._RefineFromDropMenu=!1;else if(!0===e._RefineFromDropMenu){if("what"!==i&&"who"!==i&&"when"!==i){let i=e._getEmbeddedTaggerTags(s);(i&&i.W)===n&&t.is(i.Tags)&&(e._lastNbSection=0,e.collection.getSNSkeleton().resetMultisel(),!0===e._ComputeGroup&&(e._onInitTreeDocumentAsyncCB(s),e._hasToBeRefreshed=!1,e._ComputeGroup=!1))}e._RefineFromDropMenu=!1}else e._refreshViewFromRefine(e._getEmbeddedTaggerTags(e.getSNResultMgt().getEmbeddedTaggerTags())),e._totalCountSection=this.collection.totalCount},_refreshViewFromRefine:function(e){let i=this;i._hasToBeRefreshed=!0;let n=i.getCurrentViewId(),o=i.getViewId(),a=!1,r=t.is(e)?e:i._getEmbeddedTaggerTags();if(t.is(r)){if(o===r.W)if("where"===o)i._hasToBeRefreshed=!1,i.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode")),a=!0,i._lastselectedSearchId&&d.selectElementInGlobalView(i._lastselectedSearchId,i.collection);else{if("what"===n&&"who"===n&&"when"===n)return;a=!0,i._lastselectedSearchId&&d.selectElementInGlobalView(i._lastselectedSearchId,i.collection)}if(!0===a){let e=r.Tags;if(t.is(e)&&t.is(e.groups,"array")){if(e.groups[0].object.length){let n=e.groups[0].object[0];if(t.is(n)){let e=n.dispText,t=n.iconInfo,s=(t&&t.image,{headTitle:e,hits:i.collection.hits,icon:t});d.createSearchMultiViewLabel(s,i.id);i._lastNbSection=1}}}}}},_computeDisplay:function(){let e=this,i=e.getViewId(),a=e.getCurrentViewId();if(!0===d.checkIfRefine(e.collection.getTaggerProxy(),e._getEmbeddedTaggerTags(),a,i))n.log("->MultiView Compute Display do from Refine"),e._totalCountSection=this.collection.totalCount,e._RefineFromDropMenu=!0,!0===this._viewAllProvide&&!1===e._onGroupingCompute?(e.collection.getSNSkeleton().switchOnView(s.getItem("LastSearchViewMode")),e._refreshViewFromRefine(e._getEmbeddedTaggerTags(e.getSNResultMgt().getEmbeddedTaggerTags())),e._viewAllProvide=!1,e.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideGlobeView(),e.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideTimelineView(),e.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hidePhonebookView(),e.collection.getSNSkeleton().getOption("observable").getRefineHelpers().hideTagcloudView()):(e._ComputeGroup=!0,e._refreshViewGrouping());else{n.log("->MultiView Compute Display all categories view: ",i);let s=e.getSNResultMgt()._getSearchType(),a=this._getLocalFilters();"what"!==i&&"who"!==i&&"when"!==i&&"where"!==i||o.SearchTypeEnum.MY_CONTENT===s||o.SearchTypeEnum.FAVORITE_SEARCH===s||!(!t.is(a)||t.is(a)&&t.is(a.condition)&&0==a.condition.length)?o.SearchTypeEnum.MY_CONTENT!==s&&o.SearchTypeEnum.FAVORITE_SEARCH!==s||e._refreshViewGrouping():(e._ComputeGroup=!0,e._refreshViewGrouping())}},updateListContentAfterCreation:function(e,t,i){d.manageDisplayChannelView(e,t,i)},_getLocalFilters:function(){if(!t.is(this.collection))return;let e=this.collection.getTaggerProxy().getCurrentFilter();return t.is(e)?e.localfilters:{}},refreshViewAfterComputeList:function(){},destroy:function(){this._unloadViews(),this.switcherDropDown.destroy();for(let e=0;e<this.events.length;e++)p.unsubscribe(this.events[e]);this._parent()}})}),define("DS/SNResultUX/views/WebUX/DataGrid/DataGridView",["UWA/Core","DS/DataGridView/DataGridView","DS/MessageBus/MessageBus","DS/Utilities/Dom","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/Menu/ContextualMenu","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/Core/PointerEvents","i18n!DS/DataGridView/assets/nls/translation","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger","DS/SNInfraUX/PredicatesNLS"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";var p=["ds6w:created","ds6w:modified","ds6w:type"],_=!0;return t.inherit({name:"3dSearchDataGridView",publishedProperties:{collection:{defaultValue:null,type:"object"},rowGroupingOptions:{defaultValue:{depth:0,hideGroupedColumns:!1},type:"object"}},storedXSOInitialized:[],treeDocumentStored:null,wrapEventCB:null,dblClickEventCB:null,visibleEventCB:null,pinEventCB:null,onColumnWidthUpdate:null,onUnselectAllCB:null,onSelectAllCB:null,columnsPROPS:null,enable3dSearchSort:!0,enable3dSearchSortMulti:!0,bDisableMenuCustoView:!1,bDisableMenuWrap:!1,resetScrollPosition:function(){this.scrollerPosition={x:0,y:0}},setSortMode3dSearch:function(e){this.enable3dSearchSort=e},_preBuild:function(){this._parent(),u.isODTMode()&&(this._properties.layout.value.addCellCoordinates=!0)},init:function(t){_=!0,t.treeDocument.getXSO()&&(this.storedXSOInitialized=t.treeDocument.getXSO().get()),t.wrapEventCB&&(this.wrapEventCB=t.wrapEventCB),t.dblClickEventCB&&(this.dblClickEventCB=t.dblClickEventCB),t.visibleEventCB&&(this.visibleEventCB=t.visibleEventCB),t.pinEventCB&&(this.pinEventCB=t.pinEventCB),t.onColumnWidthUpdate&&(this.onColumnWidthUpdate=t.onColumnWidthUpdate),t.onUnselectAllCB&&(this.onUnselectAllCB=t.onUnselectAllCB),t.onSelectAllCB&&(this.onSelectAllCB=t.onSelectAllCB),t.columns&&(this.columnsPROPS=t.columns),e.is(t.bDisableMenuCustoView,"boolean")&&(this.bDisableMenuCustoView=t.bDisableMenuCustoView),e.is(t.bDisableMenuWrap,"boolean")&&(this.bDisableMenuWrap=t.bDisableMenuWrap),e.is(t.enable3dSearchSort,"boolean")&&(this.enable3dSearchSort=t.enable3dSearchSort),e.is(t.enable3dSearchSortMulti,"boolean")&&(this.enable3dSearchSortMulti=t.enable3dSearchSortMulti),this._parent(t)},postInit:function(){_=!1},getColumns:function(){return this.columnsPROPS},setColumns:function(e){this.columnsPROPS=e},_emitWrapEventCB:function(t){e.is(this.wrapEventCB,"function")&&this.wrapEventCB(t)},_emitDblClickEventCB:function(t){e.is(this.dblClickEventCB,"function")&&this.dblClickEventCB(t)},_emitVisibilityEventCB:function(t){e.is(this.visibleEventCB,"function")&&this.visibleEventCB(t)},_emitPinEventCB:function(t,i){e.is(this.pinEventCB,"function")&&this.pinEventCB(t,i)},_applySortModel:function(t){if(!1===_&&!0===this.enable3dSearchSortMulti&&!1!==t){if(!e.is(this.sortModel)||this.sortModel.length<1)return;var n=this,s=a.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly"),o=e.is(s)&&s.hasOwnProperty(n.sortModel[0].dataIndex)?s[n.sortModel[0].dataIndex]:n.sortModel[0].dataIndex;setTimeout(function(){i.publish({channel:n.collection.getSNSkeleton().getOption("messagingChannel"),topic:"setOrderInGridView",data:{order_by:n.sortModel[0].sort,order_field:o,bForceNotReload:!1}});var t=n.collection.getSNSkeleton();e.is(t)&&e.is(t.getPreviewPanel())&&!0===t.getPreviewPanel().getvisibleFlag()&&t.getPreviewPanel().setActiveObject(null);var s=n.collection.getSNSkeleton().getOption("observable");e.is(s)&&e.is(s.sortPanelView)&&s.sortPanelView._setOrder(n.sortModel[0].dataIndex,"",n.sortModel[0].sort)},500)}!this.enable3dSearchSort&&this._parent(t)},sizeColumnToFit:function(t,i){var n=this.layout;i=e.extend({isUserInteraction:!1,computeAllRows:!1},i);var s,o=n.getColumnIndex(t);s=i.computeAllRows?{minRowID:0,maxRowID:this.model.length-1}:n.getMinMaxVisibleRowIDs();for(var a=n.getColumnMinWidth(o),r=n.getColumnAutoSizePadding(t),l=!1,c=s.minRowID;c<=s.maxRowID;c++){var d=this.layout.getCellIDFromCoordinates({rowID:c,columnID:o}),u=!1,h=this._getRenderedCellAt(d);if(h||(h=this._renderCell(d,{updateCellContent:!1,updateCellLayout:"ignore",updateCellAttributes:!1}),u=!0),h&&h.component){l=!0;var g=h.component.computeContentSize()+2+r;g>a&&(a=0===t?g+140:g),u&&this._freeUpCell(d,1)}}return document.body.clientWidth/2<a&&(a=document.body.clientWidth/2),void 0!==a&&l&&n.setColumnWidth(t,a,{isUserInteraction:i.isUserInteraction}),a},afterRender:function(t){var i=this;this.onInfiniteScroll(function(e){t.onInfiniteScrollAsync(e,function(){i.infiniteScrollProcessDone()})}),this.onEndResizeOrOnReadyModelRequest&&this.onEndResizeOrOnReadyModelRequest(function(n){!e.is(n.ColumnsMaxNumber)&&(n.ColumnsMaxNumber=13),!e.is(n.RowMaxNumber)&&(n.RowMaxNumber=24),t.onResizeOrFirstLoaded(n,function(){i.EndResizeOrOnReadyModelRequestDone()})}),this.layout.setColumnWidth=function(t,n,s){if(isNaN(n)&&"auto"!==n)h.log("The width given for column "+t+" is not a Number");else{var o=this.getColumnIndex(t),a=this.getLeafColumns(),r=this.getColumnMinWidth(o);if(r&&"number"==typeof n&&(n=Math.max(n,r)),a[o].width!==n){a[o].width=n,"number"==typeof n?this._setColumnComputedWidth(o,n):this._computeColumnsWidth();var l=this.getColumnPinned(o);"left"!==l&&"right"!==l||this.collectionView._updateViewportDimensions(),s&&!s.isUserInteraction&&this.getColumnAutoRowHeightFlag(o)?this.resetRowHeights():this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})}s&&s.isUserInteraction&&this._saveColumnWidthInPreferences(o),e.is(i.onColumnWidthUpdate,"function")&&i.onColumnWidthUpdate(t,n)}},n.addEventOnElement(this,this,c.POINTERHIT,function(e,t){1===e.multipleHitCount&&i.collection.state.totalRecords>a.getOption("max_results_to_enable_sort")&&-1===t.rowID&&-1!==t.columnID&&t.cellView.collectionView._preselectedCellStableID&&!r.isColumnSortableFor1000(t.cellView.collectionView._preselectedCellStableID.columnDataIndex)&&l._displayAlert({message:s.get("sortLimitByLessThen1000Results"),className:"warning"}),2===e.multipleHitCount&&t&&i._emitDblClickEventCB(t)})},reselectXSOElements:function(){this.storedXSOInitialized.length>0&&this.getTreeDocument()&&this.getTreeDocument().getXSO()&&this.getTreeDocument().getXSO().add(this.storedXSOInitialized),this.storedXSOInitialized=[],_=!1},_shouldAcceptDrag:function(){return!1},selectAllVisibleNodes:function(){_||(this.getTreeDocument().getXSO().isEmpty()?this.onSelectAllCB():this.unselectAll())},unselectAll:function(e){_||(!0===e?this._parent():this.onUnselectAllCB&&this.onUnselectAllCB())},getCellAttributesAt:function(t){var i=this._parent(t);return-1===t.rowID&&e.is(t.cellView.collectionView.columns[t.columnID])&&-1!==p.indexOf(t.cellView.collectionView.columns[t.columnID].dataIndex)&&(i["type-representation"]="date"),i},build3DSearchHeaderColumnContextualMenu:function(e,t){var i=[];return(i=i.concat(this._build3DSearchHeaderColumnContextualMenuPin(e))).push({type:"SeparatorItem",title:""}),(i=i.concat(this._contextualMenuBuilder._createSizeColumnToFitContextualMenu(e))).push({type:"SeparatorItem",title:""}),(i=i.concat(this._build3DSearchHeaderColumnContextualMenuVisibilityWrap(e))).push({type:"SeparatorItem",title:""}),this.bDisableMenuCustoView||(i=i.concat(this._build3DSearchHeaderColumnContextualMenuLinkManage(e,t))),i},_build3DSearchHeaderColumnContextualMenuLinkManage:function(e,t){var i=[],o=e.cellInfos&&-1===e.cellInfos.rowID;return!o&&e.infos&&e.infos.target&&(o=n.firstParentWithClass(e.infos.target,"wux-layouts-header")),o&&i.push({type:"PushItem",fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-cog"},title:s.get("custo_chooser_manage_custos"),action:{callback:function(){t._openColumnsCustoPanel()}}}),i},_getCurrentColumn:function(t,i){for(let n=0;n<i.length;++n)if(e.equals(i[n].dataIndex,t.collectionView._activeCellStableID.columnDataIndex))return i[n]},_isAtLeastOneColumnInvisible:function(e){for(let t of e._leafColumns)if(!1===e.getColumnVisibleFlag(t.dataIndex))return!0;return!1},_build3DSearchHeaderColumnContextualMenuVisibilityWrap:function(e){var t=[],i=e.cellInfos&&-1===e.cellInfos.rowID;if(!i&&e.infos&&e.infos.target&&(i=n.firstParentWithClass(e.infos.target,"wux-layouts-header")),i){var o,a=this,r=this.layout,l=r.getLeafColumns();if(!1!==(o=this._getCurrentColumn(r,l)).canBeInvisible){let e={type:"PushItem",title:s.get("SearchDataGridPreferences_modal_visible_column"),fonticon:r.getColumnVisibleFlag(o.dataIndex)?{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye"}:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-eye-off"},action:{callback:function(e){if(e&&e.context&&e.context.id){var t=r.getColumnVisibleFlag(e.context.id);r.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0}),a._emitVisibilityEventCB(e.context.id)}},context:{id:o.dataIndex}}};t.push(e)}if(!this.bDisableMenuWrap){let e={type:"PushItem",title:s.get("SearchDataGridPreferences_modal_wrap_column"),fonticon:!0===o.wrap?{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-text-formatted"}:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-text-formatted-off"},action:{callback:function(e){e&&e.context&&e.context.id&&a._emitWrapEventCB(e.context.id)},context:{id:o.dataIndex}}};t.push(e)}if(this._isAtLeastOneColumnInvisible(r)){let e={type:"PushItem",title:s.get("SearchDataGridPreferences_modal_reset_visibility"),fonticon:{family:"DSFontIcon",content:"wux-ui-3ds-reset"},action:{callback:function(){for(let t of r._leafColumns)if(!1===r.getColumnVisibleFlag(t.dataIndex)){var e=r.getColumnVisibleFlag(t.dataIndex);r.setColumnVisibleFlag(t.dataIndex,!e,{isUserInteraction:!0}),a._emitVisibilityEventCB(t.dataIndex)}}}};t.push(e)}}return t},_build3DSearchHeaderColumnContextualMenuPin:function(e){var t=this,i=[];if(e.cellInfos&&e.cellInfos.rowID<=-1){var n,s;-1===e.cellInfos.rowID?n=this.layout.getColumnPinned(e.cellInfos.columnID):(s=this.layout.getColumnOrGroupFromCoordinates({rowID:e.cellInfos.rowID,columnID:e.cellInfos.columnID}),n=this._collectionView.layout.getColumnOrGroupPinned(s));var o=[];o.push({type:"RadioItem",title:d.ContextualMenuBuilder.PinLeft,state:"left"===n?"selected":"unselected",action:{callback:function(){s?t.layout.setColumnOrGroupPinned(s,"left",{isUserInteraction:!0}):(t.layout.setColumnPinned(e.cellInfos.columnID,"left",{isUserInteraction:!0}),t._emitPinEventCB(e.cellInfos.columnID,"left"))}}}),o.push({type:"RadioItem",title:d.ContextualMenuBuilder.PinRight,state:"right"===n?"selected":"unselected",action:{callback:function(){s?t.layout.setColumnOrGroupPinned(s,"right",{isUserInteraction:!0}):(t.layout.setColumnPinned(e.cellInfos.columnID,"right",{isUserInteraction:!0}),t._emitPinEventCB(e.cellInfos.columnID,"right"))}}}),o.push({type:"RadioItem",title:d.ContextualMenuBuilder.NoPin,state:"left"!==n&&"right"!==n?"selected":"unselected",action:{callback:function(){s?t.layout.setColumnOrGroupPinned(s,"unpinned",{isUserInteraction:!0}):(t.layout.setColumnPinned(e.cellInfos.columnID,"unpinned",{isUserInteraction:!0}),t._emitPinEventCB(e.cellInfos.columnID))}}}),i.push({type:"PushItem",title:d.ContextualMenuBuilder.PinMenu,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-pin"},submenu:o})}return i},initComponentState:function(e){this.sortModel=[{dataIndex:e.dataIndex,sort:e.sort}],this._updateRenderedCellAttributes(this.layout.getCellIDFromCoordinates({rowID:-1,columnID:this.layout.getColumnIndex(e.dataIndex)}))},addEventListener:function(e,t,i){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var i=n.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(i){var o=parseInt(i.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),t(e,a)}}else t(e)}};return s.getContent().addEventListener(e,o,i),o}})}),define("DS/SNResultUX/views/utils/EmptyView",["DS/W3DXComponents/Views/Temp/TempItemView","UWA/Core","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!DS/SNResultUX/SNResultUX.css","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchDebug","DS/WebappsUtils/WebappsUtils"],function(e,t,i,n,s,o,a){"use strict";return e.extend(o,{uwaClassName:"DS/SNResultUX/views/EmptyView",name:"empty-view",tagName:"div",defaultOptions:{icon:void 0,title:"",request_criteria:null},setup:function(){this.container.addClassName(this.getClassNames())},template:function(){var e='<div class="'+this.getClassNames("-infos")+' search-empty-view">',n=this.options.icon,o=i.get("loading"),r=this.options.request_criteria_without_precond?this.options.request_criteria_without_precond.call():null,l=null;t.is(this.options.getCollection,"function")&&(l=this.options.getCollection());var c=!1;if(t.is(l,"object")&&t.is(l.getFailureView,"function")&&!0===l.getFailureView()&&(c=!0),!0===c&&(e='<div style="padding-bottom: 15%" class="'+this.getClassNames("-infos")+' search-empty-view">'),t.is(l,"object")&&t.is(l.getSNSkeleton,"function")&&t.is(l.getSNSkeleton()._searchActions,"object")&&t.is(l.getSNSkeleton()._searchActions.getEmptyViewMessage,"function")&&(o=l.getSNSkeleton()._searchActions.getEmptyViewMessage()),n&&(e+='<span class="'+this.getClassNames("-icon")+" center-block fonticon fonticon-5x fonticon-"+n+'" ></span>'),!0===c){e+="<img src="+(n=[a.getWebappsAssetUrl("SNResultUX","images/Search_Error_Icon.png")])+"></img>",o=i.get("error.msg.display"),e+='<span class="'+this.getClassNames("-title")+' center-block">'+o+"</span>";var d=i.get("error.msg.display.cmd");t.is(l,"object")&&t.is(l._parse_alert,"array")&&1===l._parse_alert.length&&t.is(l._parse_alert[0])&&t.is(l._parse_alert[0].messageObj,"object")&&t.is(l._parse_alert[0].messageObj.message,"string")&&(d=l._parse_alert[0].messageObj.message),e+='<span style="color: #77797c;font-weight: unset" class="'+this.getClassNames("-subtitle")+' center-block">'+d+"</span>"}else{var u="";if(r&&r.service_params&&(u=r.service_params.query),u&&u.length&&u!==s.SearchTypeEnum.ADVANCED_SEARCH||u===s.SearchTypeEnum.MY_RECENT_CONTENT){o&&o!==i.get("loading")&&(e+='<span class="'+this.getClassNames("-title")+' center-block">'+o+"</span>"),r.without_precond&&(u=r.without_precond);var h="";"*"===o&&(h=i.get("warning_star")),""!==h&&(e+='<span class="'+this.getClassNames("-subtitle")+' center-block">'+i.replace(i.get("qryStr_warning"),{warning:h})+"</span>")}else{var g;if(o=i.get("no_criteria"),t.is(s.identifyClientInfo())&&"3DDashboard"===s.identifyClientInfo().identifier)t.is(l)&&t.is(l._snSkeleton)&&t.is(l._snSkeleton.options)&&t.is(l._snSkeleton.options.widgetId)&&(g=s.getSearchWidget(l._snSkeleton.options.widgetId)),t.is(g)&&t.is(g.getView)&&t.is(g.getView().type)&&"maximized"!==g.getView().type&&t.is(g.data)&&t.is(g.data.launch_mode)&&"from_compass_pinned"===g.data.launch_mode&&(o=i.get("maximize_search"));o&&(e+='<span class="'+this.getClassNames("-title")+' center-block">'+o+"</span>")}}return e+="</div>"}})}),define("DS/SNResultUX/utils/FederatedSearch_parse",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/PubSub/PubSub","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c){"use strict";var d={};return t.extend(i,{name:"DS_SNResultUX_utils_FederatedSearch_parse",response_infos:{},results:[],summaryData:[],tagsData:{},ids:[],isReady:!1,_isRecentSearch:!1,_sourceErrorCodeToFilter:["FS_SOURCE_UNREACHABLE__DNS_UNKNOWN_HOST","FS_SOURCE_UNREACHABLE__TIMEOUT","FS_SOURCE_UNREACHABLE__HTTP_NOT_FOUND","FS_AUTHENTICATION_ERROR__FORBIDDEN","FS_AUTHENTICATION_ERROR__LOGOUT"],init:function(t){n.groupCollapsed("FederatedSearch_parse.init"),n.log("options:",t),this.setDebugMode(o.getDebugMode()),this._tenant=t.tenant,this._sourceErrorCodeToFilter.push("FS_AUTHENTICATION_ERROR"),this._isRecentSearch=t.isRecentSearch,this.results=[],this.response_infos=t.federated_response.infos,this.optionMode=t.optionMode,this.summaryData=t.federated_response.facets,e.is(t.federated_response.results)&&this._parse(t.federated_response.results),this.isReady=!0,n.groupEnd()},getUserLevelAlerts:function(t){n.groupCollapsed("FederatedSearch_parse.getUserLevelAlerts"),n.log("options:",t),e.is(t)&&(t._collabSpaceError=!1);var i=[],s={};if(e.is(this.response_infos)&&e.is(this.response_infos.sources)){for(var a=[],r="",d=0;d<this.response_infos.sources.length;d++){var u=this.response_infos.sources[d],h=c.get(u.name+".displayName");(!e.is(h)||0>=h.length)&&(h=u.name);var g={};if(r="",e.is(u.error)&&(a.push(u),e.is(u.error.errorCode)&&(!0===this.debugMode||"3dspace"===u.name||"drive"===u.name||"scientificreferential"===u.name||"dashboard"===u.name)))if("FS_AUTHENTICATION_ERROR"===u.error.errorCode&&u.error.errorMessage.indexOf("User has no preferred Security Context")>-1)g.message=c.get("FS_AUTHENTICATION_ERROR_UserHasNoPreferredSecurityContext"),r+=c.get("FS_AUTHENTICATION_ERROR_UserHasNoPreferredSecurityContext");else{g.errorCode=u.error.errorCode,g.nlsErrorCode=c.get(u.error.errorCode+".code"),g.message=c.get(u.error.errorCode+".message");var p=c.get(u.error.errorCode+".code"),_=c.get(u.error.errorCode+".message");p!==u.error.errorCode+".code"?(r+=c.replace(c.get("error_code"),{errorCode:p}),g.nlsErrorCode=c.replace(c.get("error_code"),{errorCode:p})):(r+=c.replace(c.get("error_code"),{errorCode:u.error.errorCode}),g.nlsErrorCode=c.replace(c.get("error_code"),{errorCode:u.error.errorCode})),_!==u.error.errorCode+".message"?(r+="<br>"+c.replace(c.get("error_msg"),{errorMessage:_}),g.message=c.replace(c.get("error_msg"),{errorMessage:_})):e.is(u.error.errorMessage)&&(r+="<br>"+c.replace(c.get("error_msg"),{errorMessage:u.error.errorMessage}),g.message=c.replace(c.get("error_msg"),{errorMessage:u.error.errorMessage}))}!1===u.status?e.is(u.error)&&(e.is(t)&&e.is(t._securityContext3DSpace)&&t._securityContext3DSpace.length>0&&"FS_AUTHENTICATION_ERROR"===u.error.errorCode&&(t._collabSpaceError=!0),e.is(u.error.errorCode)&&-1!==this._sourceErrorCodeToFilter.indexOf(u.error.errorCode)||(e.is(s[u.error.errorCode])||(s[u.error.errorCode]={},!0===this.debugMode?s[u.error.errorCode].message=r:s[u.error.errorCode].message=g.message,s[u.error.errorCode].messageObj=g),e.is(s[u.error.errorCode].listDataSourcesHavingThisError,"array")||(s[u.error.errorCode].listDataSourcesHavingThisError=[]),s[u.error.errorCode].listDataSourcesHavingThisError.push(h))):!0===o.getOption("alert_on_sucess")&&(r=c.replace(c.get("fetch_succeed"),{displayName:h,message:r}),i.push({className:"info",message:r}))}if(e.is(a)&&this.response_infos.sources.length>a.length&&l.dispatch("errorManager:tooltip",[a]),e.is(s)){var f=Object.getOwnPropertyNames(s);if(e.is(f,"array")&&f.length>0)for(var m=0,v=f.length;m<v;m++){var S=s[f[m]];if(e.is(S,"object")&&e.is(S.listDataSourcesHavingThisError,"array")&&e.is(S.message,"string")){var w=S.listDataSourcesHavingThisError.join(",");r=c.replace(c.get("fetchFailure_partial_answer"),{displayName:w,message:S.message}),i.push({className:"warning",message:r,messageObj:S.messageObj,dataSources:w})}}}}else{var b={message:c.get("No_Source_Found"),className:"error"};i.push(b)}return n.log("Alerts:",i),n.groupEnd(),i},getMatches:function(){return e.is(this.response_infos)&&e.is(this.response_infos.nmatches)?e.is(this.response_infos.estimated)&&!0===this.response_infos.estimated&&e.is(this.response_infos.nhits)?parseInt(this.response_infos.nhits):parseInt(this.response_infos.nmatches):e.is(this.response_infos)&&e.is(this.response_infos.nhits)?parseInt(this.response_infos.nhits):0},getHits:function(){return e.is(this.response_infos)&&e.is(this.response_infos.nhits)?parseInt(this.response_infos.nhits):0},getTags:function(){return{tagsData:this.tagsData,summaryData:this.summaryData}},getResults:function(){return this.results},getAttributesDefinition:function(){return d},getIds:function(){return this.ids},_parse:function(t){var i,s;n.groupCollapsed("FederatedSearch_parse._parse"),n.log("results:"),n.log(t),e.is(o)&&e.is(o._tenantSettings)&&e.is(o._tenantSettings[this._tenant])&&e.is(o._tenantSettings[this._tenant].search_settings)&&(i=o._tenantSettings[this._tenant].search_settings),s=e.is(i,"object")&&e.is(i.defaultDateMode,"object")&&e.is(i.defaultDateMode.id,"string")?i.defaultDateMode:{id:"basedOnLanguagePreference"};var a=[],l=[],c={},u=this,h=r.getRegion(),g=e.is(this.optionMode,"object")&&e.is(this.optionMode.dateDisplayMode,"object")&&e.is(this.optionMode.dateDisplayMode.id,"string")?this.optionMode.dateDisplayMode:s,p=r.getLanguage(),_=o.getOption("dateFormatOption");"basedOnAdminPreference"!==g.id&&"basedOnLanguagePreference"!==g.id?(p=g.value,_=g.options):"basedOnAdminPreference"===g.id&&e.is(s,"object")&&e.is(s.id)&&"basedOnLanguagePreference"!==s.id&&(p=s.value,_=s.options),e.is(h)&&h.length>0&&(h.indexOf("-")>-1?p=h:p+="-"+h);var f=0;o.getOption("timeZoneOffset")&&(f=parseInt(o.getOption("timeZoneOffset")),Number.isInteger(f)?f*=6e4:f=0),t.forEach(function(t){var i={isRecentSearchResult:u._isRecentSearch},s=[],o="",h="",g="",m="",v="",S="";if(u._updateSnippetWithMarker(t),t.attributes.forEach(function(t){if("Warning:Flattening"!==t.value&&"Warning:JPO"!==t.value){var a=t.value,l=e.is(t.dispValue)?t.dispValue:t.value;e.is(t.format)&&"snippet"===t.format&&e.is(t.type)&&"text"===t.type&&e.is(t.text)&&e.is(t.text,"array")&&(a=JSON.stringify(t));var c=e.is(t.type,"string")?t.type.toLowerCase():"unknown_type";if(e.is(t.format)&&"internal"===t.format&&"string"!==t.type||!e.is(t.value,"string")||(l="ds6w:description"===t.name&&l.indexOf("<br />")>-1?r.stripHtml(l):r.escapeHtml(l)),"date"===c||"ds6w:created"===t.name||"ds6w:modified"===t.name){var u=Date.parse(a);if(isNaN(u))l=a;else{var w=new Date(u+f);try{l=r.dateToDisplay(w,p,_)}catch(e){n.warn("Error parsing date !",u,p,_);try{l=w.toLocaleString(r.getLanguage())}catch(e){n.warn("Error parsing date with current language!",u,r.getLanguage()),l=w.toLocaleString()}}l=l.replace(",","")}}"resourceid"===t.name?i.id=a:"ds6w:when/ds6w:modified"===t.name?o=a:"ds6w:modified"===t.name?h=a:"ds6w:when/ds6w:created"===t.name?g=a:"ds6w:created"===t.name?m=a:"ds6w:type"===t.name?v=a:"ds6w:what/ds6w:type"===t.name?S=a:"ds6w:where/ds6w:source/ds6w:dataSource"===t.name&&(t.type="string");var b=t.name.match(/\/([^/]*)$/);if(b=e.is(b,"array")&&b.length>1?b[1]:t.name,d[b]={type:e.is(t.type,"string")?t.type.toLowerCase():null,URI:t.name,format:t.format},"ds6w_facet"===t.format){var C={object:e.clone(a),sixw:t.name,field:t.field,type:t.type};C.dispValue=void 0===l||""===l?e.clone(a):e.clone(l),s.push(C)}if(void 0!==i[t.name]){if(!(i[t.name]instanceof Array)){var y=i[t.name];i[t.name]=[],i[t.name].push(y);var I=i[t.name+"_value"];i[t.name+"_value"]=[],i[t.name+"_value"].push(I)}void 0===l||""===l?i[t.name].push(a):i[t.name].push(l),i[t.name+"_value"].push(a)}else e.is(l,"array")?(i[t.name]=[e.clone(a)],i[t.name+"_value"]=[e.clone(a)]):(i[t.name]=void 0===l||""===l?e.clone(a):e.clone(l),i[t.name+"_value"]=e.clone(a));var D=null;if("ds6w"===t.format?D=t.name.replace("ds6w:",""):"ds6w_facet"===t.format&&void 0!==t.field&&(D=t.field.toLowerCase()),t.name.lastIndexOf("/")>=0&&(b=t.name.slice(t.name.lastIndexOf("/")+1,t.name.length),e.is(b)&&b.length&&(i[b]=i[t.name],i[b+"_value"]=i[t.name+"_value"])),null!==D)if(void 0!==i[D]){if(!(i[D]instanceof Array)){var T=i[D];i[D]=[],i[D].push(T);var A=i[D+"_value"];i[D+"_value"]=[],i[D+"_value"].push(A)}void 0===l||""===l?i[D].push(a):i[D].push(l),i[D+"_value"].push(a)}else i[D]=void 0===l||""===l?a:l,i[D+"_value"]=a}}),o.length>0&&0===h.length&&(i["ds6w:modified"]=i["ds6w:when/ds6w:modified"],i["ds6w:modified_value"]=i["ds6w:when/ds6w:modified_value"]),g.length>0&&0===m.length&&(i["ds6w:created"]=i["ds6w:when/ds6w:created"],i["ds6w:created_value"]=i["ds6w:when/ds6w:created_value"]),v.length>0&&0===S.length&&(i["ds6w:what/ds6w:type"]=i["ds6w:type"],i["ds6w:what/ds6w:type_value"]=i["ds6w:type_value"]),e.is(i.id,"string")&&i.id.length>0){var w=i.sourceid_value;w||(w="3dspace"),c[w]||(c[w]={}),c[w][i.id]=s,a.push(i),l.push(i.id)}else n.log("Invalid result object "+JSON.stringify(t))}),this.tagsData=c,this.results=a,this.ids=l,n.groupEnd()},_encryptSnippetForUX:function(t){var i="";return t.forEach(function(t){e.is(t.highlighted)&&"true"===t.highlighted&&(i+=""),e.is(t.content)&&(i+=t.content),e.is(t.highlighted)&&"true"===t.highlighted&&(i+=""),i+=" "}),i},_updateSnippetWithMarker:function(t){var i,n=this,s=t.attributes;if(s.forEach(function(t){e.is(t.format)&&"snippet"===t.format&&e.is(t.name)&&"snippet"===t.name&&e.is(t.text,"array")&&(i=n._encryptSnippetForUX(t.text))}),e.is(i,"string")&&i.length>0){i=i.split("*").join("");var o=!1;s.forEach(function(t){!1===o&&(e.is(t.name)&&"snippet"===t.name||"snippet_value"===t.name)&&(t.value=i,o=!0)}),o||(t.attributes=t.attributes.concat({format:"attribute",name:"snippet",type:"string",value:i},{format:"attribute",name:"snippet_value",type:"string",value:i}))}return t}})}),define("DS/SNResultUX/views/utils/InformationsView",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u){"use strict";return i.extend(e,{_informationPanel:null,_rightDockingElement:null,_rootView:null,_lastSelectedItem:null,_width:420,_widgetId:null,_InformationContainer:null,_infoHeaderContainer:null,_skeleton:null,_lastwidth:420,_max:!1,_informationViewdiv:null,_bIsOnIphone:!1,_infoContainer:null,_expandcollapseElement:null,_previouselement:null,_nextelement:null,_screenType:"desktop",_oneSearchPreviewAction:null,_informationNoSelection:null,_informationPreviewContainer:null,init:function(e){this._parent(e);if(this._infoContainer=null,this._informationNoSelection=null,this._informationPreviewContainer=null,this._rootView=e.parentContainer,this._lastSelectedItem=e.lastSelectedItem,this._skeleton=e.parent,this._updateSelectionSubscription=s.subscribe({channel:this._skeleton.getMessagingChannel(),topic:"onItemSelection",callback:this.updateSelection.bind(this)}),t.is(e.width)){var i=screen.availWidth;this._width=340;var n=a.getDeviceCategory();"iphone"===n||"android"===n?(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0,this._oneSearchPreviewAction=e.oneSearchPreviewAction):!0===o.getOption("search_compact_mode")&&0===n.length&&i<1279?(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0,this._oneSearchPreviewAction=e.oneSearchPreviewAction):e.width<639&&(this._width=e.width,this._bIsOnIphone=!0),"ipad"!==n&&"android"!==n||t.is(i)&&(i>1023?this._screenType="desktop":(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0,this._oneSearchPreviewAction=e.oneSearchPreviewAction))}t.is(e.widgetId)&&(this._widgetId=e.widgetId)},destroy:function(){this.savePreferences(),s.unsubscribe(this._updateSelectionSubscription),t.is(this._informationPanel)&&t.is(this._informationPanel.destroy,"function")&&this._informationPanel.destroy(),t.is(this._rightDockingElement)&&t.is(this._rightDockingElement.destroy,"function")&&this._rightDockingElement.destroy(),this._rightDockingElement=null,this._informationPanel=null,this._skeleton=null,this._lastSelectedItem=null,this._rootView=null,this._infoContainer=null,this._informationPreviewContainer=null,this._parent()},_initInformationsPanel:function(){var e=this;null!==e._rootView&&(null!==e._rightDockingElement&&null!==e._informationPanel||null===e._informationPanel&&require(["DS/Windows/DockingElement"],function(i){var n,s,a=e._width,r=!0;r=!0,"mobile"===e._screenType&&(r=!1);var l=e.managePreferences();if(t.is(l))n=l.maxSize,s=l.minSize,a=l.zoneSize;else if(n=700,s=200,"where"===e._rootView.currentViewId){let t=e.options.parentContainer.container.clientWidth;a=t<1e3?t:380}else a=380;var c=0;t.is(e._skeleton,"object")&&t.is(e._skeleton._skeleton,"object")&&t.is(e._skeleton._skeleton.container,"element")&&t.is(e._skeleton._skeleton.container.getSize,"function")&&t.is(e._skeleton._skeleton.container.getSize())&&t.is(e._skeleton._skeleton.container.getSize().width)&&0!=(c=e._skeleton._skeleton.container.getSize().width)&&a>1*c/3&&"where"!==e._rootView.currentViewId&&(a=1*c/3),e._rightDockingElement=new i({side:WUXDockAreaEnum.RightDockArea,dockingZoneSize:a,minSize:s,maxSize:n,useBordersFlag:r});var d=null,u=e._rootView.container,h=e._rootView.getElement(".search-content-set-contents");d=e._rootView.container.getParent(),t.is(o.getOption("search_compact_mode"))&&t.is(e._skeleton)&&(d=h,u=e._skeleton.getCurrentView().container),t.is(h)||(h.setStyle("width","calc(100% - 8px)"),h.addClassName("informationPanel_opened")),e._rightDockingElement.visibleCollapserFlag=!1,e._rightDockingElement.collapsibleFlag=!1,e._rightDockingElement.freeZoneContent=u,e._rightDockingElement.inject(d),e._infoContainer=e.createContainers(),e._rightDockingElement.dockingZoneContent=e._infoContainer,e._updateInformationsPanel()}))},_updateInformationsPanel:function(){l.groupCollapsed("InformationsView._updateInformationsPanel");var e=this;this._informationPanel&&(this._informationPanel.destroy(),e._informationPanel=null);var i,s=function(i,n){l.log("InformationsView defaultTreatment");require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/ConstantsMapping","DS/SNResultUX/views/utils/PropertiesServices"],function(s,r,c,d,u,h){h.getOptions({model:e._lastSelectedItem,EditPropConstants:c,useDelegationProtocol:!0,informationContext:"3DSearchContext",onComplete:function(g){if(l.log("InformationsView.getOptions->onComplete",g),g.className="searchInformationProperties",t.is(n)||(g.typeOfDisplay=c.ALL,g.selectionType=c.RESTRICTED_SELECTION,g.warningOnUnsaved=!1,g.multiselection=c.MULTISEL_NO,g.collapseTabs=!1,t.is(g.facets)&&delete g.facets),t.is(g)&&t.is(g.facets,"array"))for(let e=0,i=g.facets.length;e<i;e++)t.is(g.facets[e],"object")&&(g.facets[e].alwaysVisible=!0);e._informationPanel=new s(g);let p=[c.FACET_VIEWS],_=a.identifyClientInfo(),f="";t.is(_)&&(f=_.identifier),t.is(o.getOption("showDerivedOutput"))&&!o.getOption("showDerivedOutput")&&(p.push(c.FACET_CHANGE),p.push(c.FACET_DERIVEDOUTPUT)),t.is(o.getOption("showChangeTab"))&&!o.getOption("showChangeTab")&&p.push(c.FACET_CHANGE),e._informationPanel.removeFacets(p);h.getPropModelFromSearchItem(e._lastSelectedItem,r,d,u,function(n){e._informationPanel.initDatas(n),t.is(i)?(i.empty(),e._informationPanel.getContent().getContent().inject(i)):e._rightDockingElement.dockingZoneContent=e._informationPanel.getContent().getContent()},n)},onAddFacets:function(i){l.log("InformationsView.getOptions->onAddFacets"),t.is(e._informationPanel)&&t.is(i);for(let e=0,t=i.length;e<t;e++)i[e].alwaysVisible=!0;e._informationPanel.addFacets(i)}})})};if(t.is(e._informationViewdiv)&&(i=t.extendElement(e._informationViewdiv),t.is(i)&&(i.removeClassName("information-view-vertical"),i.removeClassName("information-view-vertical-nopreview"))),t.is(e._lastSelectedItem)){this._informationNoSelection.hide(),t.is(this._InformationContainer)&&t.is(this._InformationContainer.show,"function")&&this._InformationContainer.show();var r=e._lastSelectedItem.getServiceID();t.is(r)&&(l.log("Calling ServiceDelegationLoader"),l.log("->serviceID:",r),l.log("->platformID:",e._lastSelectedItem.getPlatformID()),d.load({serviceID:r,platformID:e._lastSelectedItem.getPlatformID()}).then(function(i){if(!t.is(i))throw l.error("ServiceDelegation.load returns an invalid serviceDelegation!"),new Error("ServiceDelegation.load returns an invalid serviceDelegation!");t.is(i.getRenderPreview,"function")?(l.log("Calling serviceDelegation.getRenderPreview"),l.log("->searchmodel:",e._lastSelectedItem),l.log("->widget_id:",e._skeleton.getOption("widgetId")),i.getRenderPreview({searchmodel:e._lastSelectedItem,widget_id:e._skeleton.getOption("widgetId"),onComplete:function(i){if(l.log("onComplete serviceDelegation.getRenderPreview"),!t.is(i))throw l.error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!"),new Error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!");t.is(i.getSecondaryContent,"function")&&t.is(e._InformationContainer)&&(e._InformationContainer.empty(),i.getSecondaryContent({searchmodel:e._lastSelectedItem,parentContainer:e._InformationContainer,widget_id:e._skeleton.getOption("widgetId"),onComplete:function(i){if(l.log("onComplete preview.getSecondaryContent"),t.is(i)){let s=n.extend(i);t.is(s,"element")&&t.is(s.inject,"function")?s.inject(e._InformationContainer):l.error("Invalid content returned by getSecondaryContent")}else null===i&&(l.log("No secondary area to display, using default to not leave empty space"),e._InformationContainer.empty(),e._InformationContainer.setStyle("display","inline-block"),s(e._InformationContainer))},onFailure:function(t){l.log("onFailure preview.getSecondaryContent"),l.log("listValues",t),s(e._InformationContainer,t)}}))}})):(l.log("ServiceDelegation no getRenderPreview found"),e._InformationContainer.empty(),e._InformationContainer.setStyle("display","inline-block"),s(e._InformationContainer))},function(){l.log("ServiceDelegation not found"),e._InformationContainer.empty(),e._InformationContainer.setStyle("display","inline-block"),s(e._InformationContainer)}))}else e._InformationContainer.empty(),t.is(this._informationNoSelection)&&t.is(this._informationNoSelection.show,"function")&&this._informationNoSelection.show();l.groupEnd()},setActiveObject:function(e){e!==this._lastSelectedItem&&(this._lastSelectedItem=e,this._updateInformationsPanel())},switchVisibleFlag:function(){if(null!==this._rightDockingElement){var e=null,i=null;if(!0===this._rightDockingElement.visibleDockingZoneFlag){(e=this._rootView.getElement(".search-content-set-contents")).setStyle("width","100%"),this._rightDockingElement.collapsibleFlag=!0,this._rightDockingElement.collapseDockingZoneFlag=!0,this._rightDockingElement.visibleDockingZoneFlag=!1,t.is(this._oneSearchPreviewAction)&&(this._oneSearchPreviewAction.setStyle("visibility","hidden"),this._oneSearchPreviewAction.back.setStyle("display","none"),i=this._oneSearchPreviewAction.count,t.is(i)&&t.extendElement(i).setStyle("cursor","unset"));var n=this._rightDockingElement.freeZoneContent.getElement(".search-content-set-detail");t.is(n)&&n.removeClassName("informationPanelSearchContent")}else this._rightDockingElement.collapseDockingZoneFlag=!1,this._rightDockingElement.visibleDockingZoneFlag=!0,this._rightDockingElement.collapsibleFlag=!1,(e=this._rootView.getElement(".search-content-set-contents")).addClassName("informationPanel_opened"),e.setStyle("width","calc(100% - 8px)"),this.setActiveObject(this._lastSelectedItem),t.is(this._oneSearchPreviewAction)&&(this._oneSearchPreviewAction.setStyle("visibility","visible"),this._oneSearchPreviewAction.back.setStyle("display","flex"),i=this._oneSearchPreviewAction.count,t.is(i)&&t.extendElement(i).setStyle("cursor","pointer"))}},switchViewMode:function(e){l.groupCollapsed("InformationView.switchViewMode"),l.log("option:",e),t.is(this._rootView)?(t.is(this._rightDockingElement)&&(this._rightDockingElement.freeZoneContent=null,r.getItem("integratedSearch")?t.is(o.getOption("search_compact_mode"))&&t.is(e)?this._rightDockingElement.freeZoneContent=e.container:this._rightDockingElement.freeZoneContent=this._rootView:t.is(o.getOption("search_compact_mode"))&&t.is(e)?this._rightDockingElement.freeZoneContent=e.container:this._rightDockingElement.freeZoneContent=this._rootView.container,this._rightDockingElement._applyFreeZoneContent()),l.groupEnd()):l.warn("InformationView.switchViewMode, no _rootView!")},getVisibleFlag:function(){var e=!1;return t.is(this._rightDockingElement)&&(e=this._rightDockingElement.visibleDockingZoneFlag),e},hideAndclean:function(){this.switchVisibleFlag(),this.setActiveObject(null)},createContainers:function(){var e=!1;t.is(this._oneSearchPreviewAction)&&(e=!0);var i,n=a.identifyClientInfo(),s=document.createElement("div");if(s.innerHTML=['<div class="information-zone">','<div class="information-noselection">','<span class="spannopreview">Select a result to preview</span>',"</div>",'<div class="information-container">',"</div>","</div>"].join(""),this._informationPreviewContainer=t.extendElement(s.querySelector(".information-zone")),i=t.extendElement(s.querySelector(".information-zone")),this._InformationContainer=t.extendElement(s.querySelector(".information-container")),this._infoHeaderContainer=s.querySelector(".information-header"),this._informationViewdiv=s.querySelector(".information-view"),this._informationNoSelection=t.extendElement(s.querySelector(".information-noselection")),!0===e&&"3DDashboard"===n.identifier){var o=t.extendElement(s.querySelector(".information-main"));t.is(o)&&o.addClassName("mobile3dd")}if(this._hidefooter(),!0===e)this._oneSearchPreviewAction.setStyle("visibility","visible");else{var r=s.querySelector(".spannopreview");t.is(r)&&(r.innerText=u.get("InfoPanel.noSelection"))}return i},_updateInformationsPanelContents:function(){},_hidefooter:function(){},_showfooter:function(){},_exitPreview:function(){this.hideAndclean()},_expandcollapse:function(e){if(t.is(this._rightDockingElement)&&t.is(this._skeleton)&&t.is(e)){var i,n,s=!1,o=this._skeleton.getSearchWidget();if(t.is(o)&&t.is(o.body))n=o.body.getDimensions(),t.is(n)&&(i=n.width);else{var a=t.extendElement(document.body).getElement(".onesearch_results");t.is(a)&&(n=a.getDimensions(),t.is(n)&&(i=n.width,s=!0))}if(t.is(i)&&i>639&&"mobile"!==this._screenType)if(!0===this._max){e.removeClassName("informationPanel_expand"),e.addClassName("informationPanel_collapse");var r=i-320;this._rightDockingElement.maxSize=r,this._rightDockingElement.dockingZoneSize=this._lastwidth,this._max=!1,this._expandcollapseElement.setAttribute("title",u.get("InfoPanel.Expand"))}else{e.removeClassName("informationPanel_collapse"),e.addClassName("informationPanel_expand"),this._lastwidth=this._rightDockingElement.dockingZoneSize;var l=i-22;"mobile"===this._screenType&&(l=i),!0===s&&(l=i),this._rightDockingElement.maxSize=l,this._rightDockingElement.dockingZoneSize=l,this._max=!0,this._expandcollapseElement.setAttribute("title",u.get("InfoPanel.Collapsed"))}}},changeModel:function(){},activate_deactivateNoPreview:function(e){"mobile"===this._screenType&&t.is(e)&&!0===e&&this.hideAndclean(),t.is(e)&&null!==this._informationNoSelection&&null!==this._informationPreviewContainer&&(!0===e?(this._informationNoSelection.setStyle("display","inline-block"),this._InformationContainer.setStyle("display","none")):(this._informationNoSelection.setStyle("display","none"),this._InformationContainer.setStyle("display","flex")))},savePreferences:function(){if(t.is(this._rightDockingElement)){var e=this._rightDockingElement.dockingZoneSize,i=this._rightDockingElement.maxSize,n=this._rightDockingElement.minSize,s=this._skeleton.getSearchWidget();t.is(s)&&(s.setValue("informationZoneSize",e),s.setValue("informationMaxSize",i),s.setValue("informationMinSize",n)),r.setItem("informationZoneSize",e),r.setItem("informationMaxSize",i),r.setItem("informationMinSize",n),r.commit()}},managePreferences:function(){var e,i,n,s=null,o=this._skeleton.getSearchWidget();return t.is(o)&&(e=o.getValue("informationZoneSize"),i=o.getValue("informationMaxSize"),n=o.getValue("informationMinSize")),t.is(e)&&t.is(i)&&t.is(n)||(e=r.getItem("informationZoneSize"),i=r.getItem("informationMaxSize"),n=r.getItem("informationMinSize")),t.is(e)&&t.is(i)&&t.is(n)&&(s={zoneSize:e,maxSize:i,minSize:n}),s},updateSelection:function(e){l.log("InformationView->updateSelection!");let i=null;t.is(e)&&t.is(e.lastItemSelected)&&(i=e.lastItemSelected.id);let n=null,s=this._skeleton;if(t.is(s)){let e=s.getCollection();t.is(e)&&(n=this._skeleton.getCollection().get(i))}this.setActiveObject(n)}})}),define("DS/SNResultUX/views/WebUiAssets/UIKIT/Mask",["i18n!DS/SNResultUX/assets/nls/SNResultUX.json","text!DS/SNResultUX/views/WebUiAssets/UIKIT/MaskTemplate.html","DS/WebappsUtils/WebappsUtils"],function(e,t,i){"use strict";return{mask:function(n,s){if(this.isMasked(n))return;n.addClassName("masked");let o=UWA.createElement("div",{class:"mask"}),a=t;a=(a=a.replace("###DS###",i.getWebappsAssetUrl("SNResultUX","images/DS.png"))).replace("###LOADING_MSG###",UWA.is(s,"string")?s:e.get("loading")),s=UWA.createElement("div",{class:"mask-wrapper",html:{tag:"div",class:"mask-content",html:a}}).inject(o),o.inject(n)},unmask:function(e){setTimeout(function(){let t=e.getElement(" > .mask");t&&t.destroy(),e.removeClassName("masked")},500)},isMasked:function(e){return e.hasClassName("masked")}}}),define("DS/SNResultUX/utils/notifications/Notification",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t,i,n,s){"use strict";return t.singleton(i,{notifications:[],init:function(){self.notifications=[],window.notifs=n,s.setNotificationManager(window.notifs)},_checkNotificationStatus:function(t){return!e.is(localStorage.getItem(t),"boolean")||localStorage.getItem(t)},setNotificationStatus:function(e,t){t?localStorage.removeItem(e):localStorage.setItem(e,!1)},exec:function(t,i,n){!e.is(this.notifications[t])&&(this.notifications[t]={options:i}),!0===n&&(this.notifications[t].options=i),!0===this._checkNotificationStatus(t)&&window.notifs.addNotif(this.notifications[t].options)}})}),define("DS/SNResultUX/views/utils/PCSView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/Model","UWA/Class/View","UWA/Class/Collection","UWA/Element","DS/3DXHighcharts/3DXHighcharts","DS/HighChartsModules/HighCharts_drilldown","DS/WebappsUtils/Performance","DS/SNInfraUX/Logger","text!DS/SNResultUX/assets/PCSView.json","i18n!DS/SNResultUX/assets/nls/SNResultUX_PCS.json"],function(e,t,i,n,s,o,a,r,l,c,d,u){"use strict";return n.extend({name:"search_pcs_view",highcharts_options:{},setup:function(e){var n=this;n._parent(e);var r=o.create("div",{class:"pcs_result_action"}).inject(n.container),c=o.create("div",{class:"pcs_result_charts"}).inject(n.container);o.create("span",{class:"pcs_close_btn fonticon-2x fonticon fonticon-back",events:{click:function(){n.dispatchEvent("onClose"),n.destroy()}}}).inject(r),n.highcharts_options=t.extend(function(e){var n=i.extend({setup:function(){try{var e=JSON.parse(this._attributes.name);this._attributes=t.extend(this._attributes,e,!0)}catch(e){}}}),o=JSON.parse(d),a={};switch(e){case"columnrange":var r=l.getEntriesByType("mark"),c=new s(r,{model:n,from_getEntries:!0});(a=t.extend(o[e],a,!0)).title.text=u.get("PCSView.columnrange.chart.title"),a.subtitle.text=u.get("PCSView.columnrange.chart.subtitle"),a.xAxis.title.text=u.get("PCSView.xAxis.title"),a.yAxis.title.text=u.get("PCSView.yAxis.title"),a.xAxis.labels.formatter=function(){return u.get("PCSView.labels."+this.value)},a.tooltip.formatter=function(){return u.replace(u.get("PCSView.tooltip."+this.key),{duration:this.point.high-this.point.low})};var h=[];c.forEach(function(e){var i=c.where({name:e.get("name"),uuid:e.get("uuid")}),n=i[0].clone();if(2===i.length&&"start"===e.get("status")?n.set({endTime:i[1].get("startTime")}):1===i.length&&n.set({endTime:"NaN"}),t.is(n.get("drilldown"))&&n.set({drilldown:n.get("drilldown")+"_"+n.get("uuid")}),t.is(n.get("drilldown_serie_id"))){var s=n.get("endTime"),o=n.get("drilldown_serie_id"),a=c.filter(function(e){return!(e.get("startTime")>s)&&e.get("drilldown")===o});a.length>0&&n.set({drilldown_serie_id:a[0].get("drilldown")+"_"+a[0].get("uuid")})}"end"!==e.get("status")&&h.push(n)}),c.reset(h),c.pluck("drilldown").forEach(function(e){if(void 0!==e){a.drilldown.series.push({id:e,data:[]});var t=a.drilldown.series.length-1;c.where({drilldown_serie_id:e}).forEach(function(i){a.drilldown.series[t].data.push({id:e,name:i.get("name"),low:i.get("startTime"),high:i.get("endTime"),drilldown:i.get("drilldown")})})}}),c.reject(function(e){return t.is(e.get("drilldown_serie_id"))}).forEach(function(e){var t=e.get("drilldown"),i=c.max(function(e){return e.get("drilldown_serie_id")===t?e.get("endTime"):0}).get("endTime"),n={name:e.get("name"),low:e.get("startTime"),high:i,drilldown:e.get("drilldown")};a.series[0].data.push(n)});break;default:throw new Error("Invalid chart type")}return a}("columnrange"),n.highcharts_options,!0),e.width&&e.height?(n.highcharts_options.chart.width=e.width,n.highcharts_options.chart.height=e.height):e.renderTo&&(n.highcharts_options.chart.width=e.renderTo.getSize().width,n.highcharts_options.chart.height=e.renderTo.getSize().height),n.highcharts_options.chart.renderTo=c;new a.Chart(n.highcharts_options);e.renderTo&&this.render().inject(e.renderTo)},render:function(){return this}})}),define("DS/SNResultUX/views/utils/Play3DServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/SearchUtils","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/Logger"],function(e,t,i,n,s,o,a,r,l){"use strict";return t.singleton(n,i,{_skeleton:null,is3DPlayAvailable:function(t,i){return this._skeleton=i,new s(function(n,s){e.is(t)&&e.is(t.get,"function")||e.is(s,"function")&&s();var o=t.getServiceID(),l=t.get("ds6w:type_value");e.is(l)||e.is(s,"function")&&s();var c=t.get("play3d");if(e.is(c))e.is(n,"function")&&e.is(s,"function")&&(c?n():s());else{var d=t.getPlatformID(),u=function(i){require(["DS/3DPlaySupport/AssetSupport"],function(s){if(e.is(s)){const o={provider:"EV6",tenant:d,serverurl:i.serviceURL,physicalid:t.id,dtype:t.get("ds6w:type_value"),requiredAuth:"passport",requestsOptions:{authentication:"passport"}};s.checkSupport(o,{},function(i){!0===i&&(t.set("play3d",!0),e.is(n,"function")&&n())})}})};a.getServiceUrl({serviceName:o,platformId:d,onComplete:function(a){e.is(a,"string")&&r.load({serviceID:o,platformID:d,serviceURL:a}).then(function(o){e.is(o.is3DPlayAvailable,"function")?o.is3DPlayAvailable.call(void 0,{model:t,serviceURL:a,skeleton:i,onComplete:function(i){e.is(i,"object")&&!0===i.availability?(t.set("play3d",!0),n()):(t.set("play3d",!1),s())}}):u({serviceURL:a})},function(){u({serviceURL:a})})}})}})},get3DPlayOptions:function(t,i,n){if(e.is(t)&&e.is(i,"function")){var s=t.getServiceID(),c=t.getPlatformID();if(e.is(s,"string")&&e.is(c,"string")){var d={input:{asset:{snippet:t.get("snippetAsStringArray"),contextId:e.is(n)?n.getSecurityContext():null},usage:"preview"},options:{loading:"autoplay",tenant:c},lang:o.getLanguage()},u=function(i,n,s){i.input.asset.serverurl=n,i.input.asset.provider="EV6",i.input.asset.physicalid=t.id,i.input.asset.contextId=e.is(s)?s.getSecurityContext():null,i.input.asset.dtype=t.get("ds6w:type_value"),i.input.asset.requiredAuth="passport",i.input.asset.requestsOptions={authentication:"passport"},i.input.asset.filename=null,i.input.asset.format=null,i.input.asset.snippet=t.get("snippetAsStringArray")};a.getServiceUrl({serviceName:s,platformId:c,onComplete:function(n){e.is(n,"string")&&r.load({serviceID:s,platformID:c,serviceURL:n}).then(function(o){e.is(o.get3DPlayOptions,"function")?o.get3DPlayOptions({defaultPlayOptions:d,model:t,serviceURL:n,onComplete:function(e){i(e)},onFailure:function(){l.warn("Play3DServices get3DPlayOptions FAILED for ",s,c,n),i(d)}}):e.is(o.get3DPlayProvider,"function")?(u(d,n),d.input.asset.provider=o.get3DPlayProvider(),i(d)):(u(d,n),i(d))},function(){u(d,n),i(d)})}})}}else l.error("Invalid args when calling Play3DServices.get3DPlayOptions",t)}})}),define("DS/SNResultUX/views/utils/PropertiesServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c){"use strict";return t.singleton(n,i,{name:"DS_SNResultUX_utils_PropertiesServices",_internal_attr:["type_icon_url","id","resourceid","resourceid_tagger","preview_url","image","icon","actions","subtitle","icon_source"],init:function(){this.setDebugMode(o.getDebugMode())},displaySearchItemProperties:function(t,i,n,s,o,r,c){e.is(t)&&e.is(i)&&e.is(o)||r(i);let d=!1,u=o.getSupportedServicesArray();if(e.is(u)&&e.is(u.services)&&-1===u.services.indexOf(s)&&(d=!0),e.is(t.isAShowOnlyObject,"function")){!0===t.isAShowOnlyObject()&&(d=!0)}let h=!1;if(e.is(c)){h=!0,i.set("isTransient",!0);let e={},t=c.length;for(let i=0;i<t;i++){let t=new n,s=c[i];t.set("name",s.id),t.set("path",s.id),t.set("label",s.title),t.set("value",a.decodeHtml(s.value)),e[s.id]=t}i.set(e)}if(!1===d)e.is(r,"function")&&r(i);else{i.set("isTransient",!0),e.is(i.get("type_icon_url"))&&""!==i.get("type_icon_url")||!e.is(t.get("type_icon_url"))||i.set("type_icon_url",t.get("type_icon_url")),e.is(t.get("preview_url"))&&(e.is(i.get("previewUrl"))&&""!==i.get("previewUrl")||i.set("previewUrl",t.get("preview_url")),e.is(i.get("preview_url"))&&""!==i.get("preview_url")||i.set("preview_url",t.get("preview_url")));let s=this,o=t.pairs();o.sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0});let c=[],d=[],u=!1;for(let e=0;e<o.length;e++){let t=o[e][0],i=o[e][1];if(i){let e=t.match(/\/([^/]*)$/);e=null===e?t:e[1],-1!==s._internal_attr.indexOf(t)||-1!==t.indexOf(":snippet")||-1!==t.indexOf("_value")||-1===t.indexOf("ds6w:")&&-1===t.indexOf("ds6wg:")||-1!==c.indexOf(e)||(c.push(e),d.push(i))}}let g=function(){let o={},r=c.length;for(let l=0;l<r;l++){let r=c[l],u=null;if(e.is(i.get(r))||h?e.is(i.get(r))&&h&&(u=i.get(r)):u=new n,e.is(u)){e.is(u.get("name"))&&""!==u.get("name")||u.set("name",r),e.is(u.get("path"))&&""!==u.get("path")||u.set("path",r);let n=r;e.is(s.nlsPredicate)&&e.is(s.nlsPredicate[r])&&(n=s.nlsPredicate[r]),e.is(n)&&""!==n||(n=r),e.is(u.get("label"))&&""!==u.get("label")||u.set("label",n);let c=d[l],h="";if(c instanceof Array){if(c.length>0)for(let e=0;e<c.length;e++)h+=a.decodeHtml(c[e])+(e===c.length-1?"":" | ");e.is(u.get("value"))&&""!==u.get("value")||u.set("value",h)}else c.length>0&&(e.is(u.get("value"))&&""!==u.get("value")||u.set("value",c),"ds6w:type"===r?e.is(u.get("urlIcon"))&&""!==u.get("urlIcon")||u.set("urlIcon",t.get("type_icon_url")):"ds6w:label"===r?e.is(u.get("sectionIdentityCard"))&&""!==u.get("sectionIdentityCard")||u.set("sectionIdentityCard","title"):"ds6w:created"===r?e.is(u.get("sectionIdentityCard"))&&""!==u.get("sectionIdentityCard")||u.set("sectionIdentityCard","date"):"ds6w:responsible"===r&&(e.is(u.get("sectionIdentityCard"))&&""!==u.get("sectionIdentityCard")||u.set("sectionIdentityCard","ownerName")));e.is(i.get(r))||(o[r]=u)}}let l=t.get("ds6w:what/ds6w:type_value");e.is(l,"array")&&(l=l.join("|")),o["ds6w:what/ds6w:type_value"]=l,i.set(o),u=!0};l.getResourcesInfo(c.join(","),{tenantId:i.get("tenant"),lang:a.getLanguage(),onComplete:function(t){s.nlsPredicate=function(t){let i={};if(e.is(t,"object")&&e.is(t.vocabularyElementNLSInfo,"array"))for(let e=0,n=t.vocabularyElementNLSInfo.length;e<n;e++)i[t.vocabularyElementNLSInfo[e].uri]=t.vocabularyElementNLSInfo[e].nlsName;return i}(t),!1===u&&g.call(),e.is(r,"function")&&r(i)},onFailure:function(){!1===u&&g.call(),e.is(r,"function")&&r(i)}})}},getPropModelFromSearchItem:function(t,i,n,s,o,a){var r=[];if(!(e.is(t)&&e.is(i)&&e.is(n)&&e.is(s)))return o(r),r;var l,c="businessobject";e.is(t.IsAnInstance,"function")&&!0===t.IsAnInstance()&&(c="relationship");var d=t.getServiceID();l=new i({metatype:c,objectId:t.id,source:d,tenant:t.getPlatformID()}),this.displaySearchItemProperties(t,l,n,d,s,function(){r.push(l);var i=t.getPlatformID();widget.setValue("x3dPlatformId",i),e.is(o)&&o(r)},a)},getOptions:function(t){s.log("PropertiesServices.getOptions",t);var i={typeOfDisplay:t.EditPropConstants.ALL,selectionType:t.EditPropConstants.NO_SELECTION,readOnly:!0,extraNotif:!0,editMode:!0},n=function(){var e=[{text:c.get("section.properties.title"),name:t.EditPropConstants.FACET_PROPERTIES,icon:"attributes",expandedFlag:!0}];i.facets=[t.EditPropConstants.FACET_PROPERTIES,t.EditPropConstants.FACET_SWYM_CONTENT,t.EditPropConstants.FACET_SWYM_USER_PROPERTIES,t.EditPropConstants.FACET_SWYM_COMMUNITY_PROPERTIES,t.EditPropConstants.FACET_SWYMCOMMENTS],t.onComplete.call(void 0,i,e)};e.is(t)&&e.is(t.model)&&!1!==t.useDelegationProtocol?r.load({serviceID:t.model.getServiceID(),platformID:t.model.getPlatformID()}).then(function(s){e.is(s.getFacets,"function")?s.getFacets({model:t.model,constants:t.EditPropConstants,setContext:function(e){i.context=e},setReadOnly:function(e){i.readOnly=e},setFacets:function(n,s){e.is(n,"array")&&(i.facets=n,t.onComplete.call(void 0,i,s))},addFacets:function(i,n){e.is(i,"array")&&t.onAddFacets.call(void 0,i)}}):n()},function(){n()}):n()}})}),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView",["DS/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/CollectionView/layouts/CollectionViewGridLayout","DS/Utilities/Dom","UWA/Core"],function(e,t,i,n){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"},sideGutter:{defaultValue:{small:10,big:10},type:"object"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){n.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,t,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=i.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),t(e,a)}}else t(e)}};return s.getContent().addEventListener(e,o,n),o}})}),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView",["DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Utilities/Dom","UWA/Core"],function(e,t,i){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){i.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,i,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=t.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),i(e,a)}}else i(e)}};return s.getContent().addEventListener(e,o,n),o}})}),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView",["DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/Utilities/Dom","UWA/Core"],function(e,t,i){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){i.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,i,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=t.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),i(e,a)}}else i(e)}};return s.getContent().addEventListener(e,o,n),o}})}),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView",["DS/CollectionView/ResponsiveTilesCollectionView","DS/Utilities/Dom","UWA/Core"],function(e,t,i){"use strict";return e.inherit({publishedProperties:{clickCB:{defaultValue:function(e){console.log(e)},type:"function"}},_postBuildView:function(){this._parent(),this.addEventListener("click",this._onCellClickCB.bind(this),!1)},_onCellClickCB:function(e,t){i.is(this.clickCB)&&this.clickCB.call(this,t)},addEventListener:function(e,i,n){var s=this,o=function(e){if(!s._isRequestingCell){e.dsModel=s;var n=t.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(e.target.className.includes("search_item_hyperlink")||e.target.parentElement.className.includes("search_item_hyperlink"))return;if(n){var o=parseInt(n.getAttribute("cell-id"),10);if(!isNaN(o)){var a=s.getCellInfosAt(o);a.cellView=s._getViewAt(o),i(e,a)}}else i(e)}};return s.getContent().addEventListener(e,o,n),o}})}),define("DS/SNResultUX/views/utils/SearchContentSet",["UWA/Core","DS/W3DXComponents/ContentSet","DS/SNInfraUX/SearchSettings","DS/SNResultUX/views/W3DXComponents/Views/Item/SwitcherView"],function(e,t,i,n){"use strict";return t.extend({name:"search-content-set",test:!1,defaultOptions:{switcher:{view:n}},setup:function(){this.addEvent("onItemRendered",this._onItemRendered,this),this._parent()},buildMultiselOnCheck:function(t){if(this.multiselHeaderView){var i=this.contentsViews[this.currentViewId].nestedView,n=i.getSelectionState();if(n.isActive)if(e.is(t,"array"))for(var s=0;s<t.length;s++)i.isSelected(t[s])||i.addSelection(t[s]);else i.isSelected(t)?i.removeSelection(t):i.addSelection(t);else if(e.is(t,"array"))for(var o=0;o<t.length;o++)e.is(t[o])&&!i.isSelected(t[o])&&i.addSelection(t[o]);else e.is(t)&&!i.isSelected(t)?(i.addSelection(t),i.activateMultisel(!1)):(i.deactivateMultisel(),this.multiselHeaderView.dispatchEvent("onMultiselOff"));this.multiselHeaderView.buildMultisel(n),i.selectionIsEmpty()&&!n.wasExplicitlyActivated&&i.deactivateMultisel()}},_initMultiselHeaderView:function(){if(this.getOption("actions").collection){var t,n,s,o,a,r=this,l=(o="multiselHeader",(s=this)&&(a=s[o],e.is(a,"function")&&(a=a.call(s))),a);return n=this._multiselHeaderViewEvents={onMultiselOn:function(){var t=this.contentsViews[this.currentViewId];"table"!==this.currentViewId&&e.is(this.contentsViews.table)&&this.contentsViews.table.nestedView.activateMultisel();t.nestedView.activateMultisel(!0),this.dispatchEvent("onMultiselOn",arguments)},onMultiselOff:function(){var t=this.contentsViews[this.currentViewId];"table"!==this.currentViewId&&e.is(this.contentsViews.table)&&this.contentsViews.table.nestedView.deactivateMultisel();t.nestedView.deactivateMultisel(),this.dispatchEvent("onMultiselOff",arguments)},onActionClick:function(){Array.prototype.unshift.call(arguments,this.actionsView),this.dispatchEvent("onActionClick",arguments)}},i.getOption("actionsProtocol_FUN065512")&&(n.onActionClickDotted=function(){var t=r.getSelection();if(e.is(t,"array")&&e.is(r.collection)){var i=r.collection.getSNSkeleton();e.is(i)&&i.buildMultiselActions(t)}}),t=this.multiselHeaderView=new l(this.getMultiselHeaderViewOptions()),this.listenTo(t,n),t}},getMultiselHeaderViewOptions:function(){var t=this._parent.apply(this,arguments);return e.is(t)||(t={}),t["data-rec-id"]=!0,t},getActionsViewOptions:function(){var t=this,i=this._parent();return i.filterer=function(i){var n=t.collection._snSkeleton._searchActions.displayMode;if(!e.is(n))return!0;var s=i.get("displayMode");return!e.is(s,"string")||("AllView"===s||s.search(n)>=0)},i},_onItemRendered:function(){var t=this.collection._snSkeleton._searchActions;if(e.is(t)){t.setSearchContentSetDivContainer(this.container);var i=t.displayMode;e.is(i,"string")&&t.setDisplayMode(i)}var n=e.extendElement(this.container).getElement(".search-content-set-header");this.collection._snSkeleton.options.observable.setSearchContentSetHeader(n)},destroy:function(){this.multiselHeaderView&&this.stopListening(this.multiselHeaderView,this._multiselHeaderViewEvents),this.removeEvent("onItemRendered",this._onItemRendered,this),this._parent()}})}),define("DS/SNResultUX/views/utils/SearchCounterView",["UWA/Core","DS/W3DXComponents/Views/Temp/TempItemView","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n){"use strict";return t.extend({name:"set-detail-view",tagName:"div",_totalRecords:0,title:"",template:function(){return'{{#if title}}<span class="'+this.getClassNames("-title")+'">{{title}}</span><span class="'+this.getClassNames("-count")+'" id="search-nb-result">{{itemsLength}}</span>{{/if}}'},init:function(t){t=e.clone(t||{},!1),["container","template","tagName"].forEach(function(e){delete t[e]}),this.title="",this._parent(t),e.is(t)&&e.is(t.collection)&&e.is(t.collection.totalCount)&&t.collection.totalCount>=0||this.hide()},setup:function(){this.container.addClassName(this.getClassNames("-container"))},mixinTemplateHelpers:function(){var e=this._parent.apply(this,arguments),t=this.collection,i=t.totalCount;return!i&&(i=t.size()),i=t.totalCount<t.length?t.length:t.totalCount,e.itemsLength=i,e.title=this._determineCounterTitleFromQuery(t.service_parameters),e},_determineCounterTitleFromQuery:function(t){if(!i.isFUN109031Active())return this.title;if("#advancedSearch"===t.originalSearchCriteria||"#advancedSearch"===t.query)return n.get("adv_search_launchWithResults");if("#favoriteSearches"===t.originalSearchCriteria||"#favoriteSearches"===t.query)return n.get("myContent_searchFavWithResults");if(e.is(t.refine)&&e.is(t.refine.localfilters)&&e.is(t.refine.localfilters.condition,"array")&&1===t.refine.localfilters.condition.length){let i=Object.keys(t.refine.localfilters.condition[0]);if(e.is(t.refine.localfilters.condition,"array")&&1===i.length){if("ds6w:what/type_categorization"===i[0]&&e.is(t.refine.localfilters.condition[0][i[0]].condition)&&1===t.refine.localfilters.condition[0][i[0]].condition.length&&!0!==t.refine.localfilters.condition[0][i[0]].condition[0].excluded)return n.replace(n.get("ResultsOfType"),{type:t.refine.localfilters.condition[0][i[0]].condition[0].display});if("ds6w:who/person"===i[0]&&e.is(t.refine.localfilters.condition[0][i[0]].condition)&&1===t.refine.localfilters.condition[0][i[0]].condition.length&&!0!==t.refine.localfilters.condition[0][i[0]].condition[0].excluded)return n.replace(n.get("ResultsOwnedBy"),{name:t.refine.localfilters.condition[0][i[0]].condition[0].display});if("sixw:ds6w:when/ds6w:modified"===i[0]&&e.is(t.refine.localfilters.condition[0][i[0]][0])&&e.is(t.refine.localfilters.condition[0][i[0]][0].displayValue)&&!0!==t.refine.localfilters.condition[0][i[0]][0].excluded)return n.replace(n.get("ResultsFor"),{type:t.refine.localfilters.condition[0][i[0]][0].displayValue});if(("ds6w:where/ds6w:location/computedCountryInfo"===i[0]||"ds6w:where/ds6w:source/ds6w:dataSource"===i[0])&&e.is(t.refine.localfilters.condition[0][i[0]].condition)&&1===t.refine.localfilters.condition[0][i[0]].condition.length&&!0!==t.refine.localfilters.condition[0][i[0]].condition[0].excluded)return n.replace(n.get("ResultsFor"),{type:t.refine.localfilters.condition[0][i[0]].condition[0].display})}}return this.title},setOptions:function(t){var i=this,n=this.collection;if(this._parent.apply(this,arguments),t.title){var s=this.templateHelpers||(this.templateHelpers={});s.title=t.title||s.title,this.title=s.title,n&&this.listenTo(n,{onAdd:function(){i._totalRecords!==i.collection.totalCount&&(this.render.apply(this,arguments),i.show(),i.container.setStyle("visibility","visible"))},onRemove:function(){i._totalRecords!==i.collection.totalCount&&(this.render.apply(this,arguments),i.show(),i.container.setStyle("visibility","visible"))},onReset:function(){i._totalRecords=0,this.render.apply(this,arguments),e.is(i.collection.totalCount)&&i.collection.totalCount>=0?(i._totalRecords=i.collection.totalCount,i.show(),i.container.setStyle("visibility","visible")):(i.hide(),i.container.setStyle("visibility","hidden"))},onSync:function(){i._totalRecords=0,this.render.apply(this,arguments),e.is(i.collection.totalCount)&&i.collection.totalCount>=0?(i.show(),i.container.setStyle("visibility","visible")):i.container.setStyle("visibility","hidden")}})}else n&&this.stopListening(n);return this}})}),define("DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferences",["DS/SNResultUX/utils/datagridPreferences/Abstract","UWA/Core","UWA/Class","UWA/Element","DS/UIKIT/SuperModal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/FedDictionaryAccess/FedDictionaryAccessAPI","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f){"use strict";return i.extend(e,{init:function(e){c.log(e.availableColumns);var i=this;this._parent(e);let n=e.searchDatagridView&&e.searchDatagridView.collection&&e.searchDatagridView.collection.getSNSkeleton();t.is(n)&&n.maskContainer(),this._launchTypeOrSubtypeCusto(e.searchDatagridView,e.typeToHandle,e.arrayTypeDS6WG,e.currentFilter,()=>{c.log("init"),i._thingsToApply={},i._buildView(),i._fillView(),t.is(n)&&n.unmaskContainer()})},_buildView:function(){return!t.is(this._typeToHandle.typeName)&&c.error("!UWACore.is(me._typeToHandle.typeName)"),this._parent()},_createFooter:function(){c.log("_createFooter"),this._divFooter.innerHTML="";var e=this;new o({value:f.get("SearchDataGridPreferences_modal_apply"),className:"primary apply-button",id:"apply_customization_btn",events:{onClick:function(){c.log("Click on apply Customization"),null!==e.options.move_to_do&&e.options.preferences_grid.getManager().getRows().forEach(function(t){e.options.move_to_do.push(t[0].options.value)}),e._custoCombo&&!0===e._unmodifiedCusto?e._applySetting(e._custoCombo.getValue()[0],!1):e._applySetting("TEMP_CUSTO",!0),e._requestClosePanel()}}}).inject(this._divFooter),new o({value:f.get("SearchDataGridPreferences_modal_reset"),className:"secondary reset-button",id:"reset_customization_btn",events:{onClick:function(){c.log("Click on reset Customization"),e._applyReset(),e._requestClosePanel()}}}).inject(this._divFooter);var t=new o({value:f.get("SearchDataGridPreferences_modal_save"),className:"secondary save-button",id:"save_customization_btn",events:{onClick:function(){c.log("Click on save Customization"),null!==e.options.move_to_do&&e.options.preferences_grid.getManager().getRows().forEach(function(t){e.options.move_to_do.push(t[0].options.value)}),e._saveSetting(t),e._custoNameEdt.setFocus(!0)}}}).inject(this._divFooter);return this._divFooter},_launchTypeOrSubtypeCusto:function(e,i,n,s,o){var a=this;t.is(s)&&t.is(s.allfilters)&&(t.is(s.allfilters["ds6w:what/ds6w:kind"])&&1===s.allfilters["ds6w:what/ds6w:kind"].length&&t.is(s.allfilters["ds6w:what/ds6w:kind"][0].object)&&t.is(s.allfilters["ds6w:what/ds6w:kind"][0].disptext)?(i={typeName:s.allfilters["ds6w:what/ds6w:kind"][0].disptext,isPQ:!1},n.push(["ds6wg:"+s.allfilters["ds6w:what/ds6w:kind"][0].object])):t.is(s.allfilters["ds6w:what/ds6w:type"])&&1===s.allfilters["ds6w:what/ds6w:type"].length&&t.is(s.allfilters["ds6w:what/ds6w:type"][0].object)&&t.is(s.allfilters["ds6w:what/ds6w:type"][0].disptext)?(i={typeName:s.allfilters["ds6w:what/ds6w:type"][0].disptext,isPQ:!1,className:"ds6wg:"+s.allfilters["ds6w:what/ds6w:type"][0].object},n.push(s.allfilters["ds6w:what/ds6w:type"][0].object)):t.is(s.allfilters["sixw:vpmextension"])&&1===s.allfilters["sixw:vpmextension"].length&&t.is(s.allfilters["sixw:vpmextension"][0].object)&&t.is(s.allfilters["sixw:vpmextension"][0].displayValue)?(i={typeName:s.allfilters["sixw:vpmextension"][0].displayValue,isPQ:!1},n.push([s.allfilters["sixw:vpmextension"][0].object])):t.is(s.allfilters["sixw:ds6w:what/ds6w:type"])&&1===s.allfilters["sixw:ds6w:what/ds6w:type"].length&&t.is(s.allfilters["sixw:ds6w:what/ds6w:type"][0].object)&&t.is(s.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue)&&(i={typeName:s.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue,isPQ:!1,className:s.allfilters["sixw:ds6w:what/ds6w:type"][0].object},n.push(s.allfilters["sixw:ds6w:what/ds6w:type"][0].object))),n.filter(function(e,t,i){return t===i.indexOf(e)}),u._asyncCallToPredicatesWS(n).then(function(t){a.renderColumnsWithSuccess(e,t,i,o)},function(t){a.renderColumnsWithFailure(e,i,t,o)})},renderColumnsWithSuccess:function(e,i,n,s){for(var o=[],a={},r={},l=0,d=i.classPredicates.length;l<d;l++){if(!t.is(i.classPredicates[l].className)||!t.is(i.classPredicates[l].vocabularyPredicateInfo))return c.warn("Unexpected response from GetRelevantPredicates !"),this.options.oSearchCustoServices._removeColumnCustoMask(e),null;if(t.is(n.className)&&n.className.length>0)for(let e=0,s=i.classPredicates[l].vocabularyPredicateInfo.length;e<s;e++)t.is(i.classPredicates[l].vocabularyPredicateInfo[e],"object")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].uri,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].name,"string")&&i.classPredicates[l].className===n.className?(t.is(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName]=[]),t.is(a[i.classPredicates[l].vocabularyPredicateInfo[e].uri])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName].push(i.classPredicates[l].vocabularyPredicateInfo[e].uri),o.push({dispValue:i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,sixw:i.classPredicates[l].vocabularyPredicateInfo[e].uri,type:g._getPredicateTypeFromDataType(i.classPredicates[l].vocabularyPredicateInfo[e])||"string",relatedObjectType:i.classPredicates[l].className,name:i.classPredicates[l].vocabularyPredicateInfo[e].name}),a[i.classPredicates[l].vocabularyPredicateInfo[e].uri]=!0)):(c.warn("Invalid data returned by Predicates WS for class "+i.classPredicates[l].className+" for index "+e+" !"),c.warn(i.classPredicates[l].vocabularyPredicateInfo));else if(t.is(n.typeName))for(let e=0,n=i.classPredicates[l].vocabularyPredicateInfo.length;e<n;e++)t.is(i.classPredicates[l].vocabularyPredicateInfo[e],"object")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].uri,"string")&&t.is(i.classPredicates[l].vocabularyPredicateInfo[e].name,"string")?(t.is(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName]=[]),t.is(a[i.classPredicates[l].vocabularyPredicateInfo[e].uri])||(r[i.classPredicates[l].vocabularyPredicateInfo[e].nlsName].push(i.classPredicates[l].vocabularyPredicateInfo[e].uri),o.push({dispValue:i.classPredicates[l].vocabularyPredicateInfo[e].nlsName,sixw:i.classPredicates[l].vocabularyPredicateInfo[e].uri,relatedObjectType:i.classPredicates[l].className,name:i.classPredicates[l].vocabularyPredicateInfo[e].name}),a[i.classPredicates[l].vocabularyPredicateInfo[e].uri]=!0)):(c.warn("Invalid data returned by Predicates WS for class "+i.classPredicates[l].className+" for index "+e+" !"),c.warn(i.classPredicates[l].vocabularyPredicateInfo))}let u=h.getSelectPredicates();if(t.is(u,"array"))for(var p=o.length-1;p>=0;p--)-1===u.indexOf(o[p].sixw)&&o.splice(p,1);for(var _=0,f=o.length;_<f;_++)t.is(r[o[_].dispValue],"array")&&r[o[_].dispValue].length>1&&(o[_].dispValue+=" ("+o[_].relatedObjectType+":"+o[_].sixw+")");this._launchColumnCustoPanel(e,n,o,s)},renderColumnsWithFailure:function(e,i,n,s){c.error("promisePredicate fail !",arguments);var o=f.get("SearchDataGridPreferences_error_UnableToRetrievePredicates");t.is(n)&&(n.message&&(o+="<br>"+n.message),n.url&&(o+="<br>"+n.url)),p._displayAlert({message:o,className:"warning",widgetId:e.getOption("widgetId")}),this._launchColumnCustoPanel(e,i,[],s)},_launchColumnCustoPanel:function(e,i,n,s){let o=t.clone(e._columnsAttributes);if("The_Default_Columns"===e._currentCustoViewId)for(var a in o)o[a].wrap&&delete o[a].wrap,o[a].pinned&&delete o[a].pinned;var r=e.collection.options.tagger_proxy.latest_tagValues,l=[];let d=!1;var u=this._computeColToDisplayInCustoPanel(o,n,r);for(a=0;a<u.length;a++)if(t.is(u[a].text)&&-1!=u[a].text.indexOf("ds6w")){1==(u[a].text.match(/ds6w/g)||[]).length&&(l.push(u[a].dataIndex),d=!0)}if(d){let o=this,a="";if(t.is(e.collection)&&t.is(e.collection.search_ressources)&&t.is(e.collection.search_ressources.getActiveTenant,"function")&&(a=e.collection.search_ressources.getActiveTenant()),l.length>0){var h=l.join("\r\n");_.getResourcesInfo(h,{tenantId:a,lang:g.getLanguage(),apiVersion:"R2019x",onComplete:function(e){if(c.log(e),!t.is(e))return c.error("Unexpected response from getResourcesInfo !"),null;for(var a=0,l=u.length;a<l;a++)for(var d=0,h=e.length;d<h;d++){if(!t.is(e[d].curi)||!t.is(e[d].label))return c.error("Unexpected response from getResourcesInfo !"),null;e[d].curi!==u[a].dataIndex||u[a].text===e[d].label||(u[a].text="* "+e[d].label)}o.options.typeToHandle=i,o._typeToHandle=t.clone(i),o.options.predicateIntersection=n,o._predicateIntersection=t.clone(n),o.options.availableColumns=u,o.gridInitValues=t.clone(u),o.gridFinalValues=t.clone(u),o.options.currentTags=r,s&&s.call(o)},onFailure:function(){c.warn("not able to load predicates")}})}}else this.options.typeToHandle=i,this._typeToHandle=t.clone(i),this.options.predicateIntersection=n,this._predicateIntersection=t.clone(n),this.options.availableColumns=u,this.gridInitValues=t.clone(u),this.gridFinalValues=t.clone(u),this.options.currentTags=r,s&&s.call(this)},_saveSetting:function(){var e,i,a=this;function l(e){var i=!1,n="",o=!1,r=!1,l=!1,c="";(e.endsWith("-ADMIN")||e.endsWith("-HIDDEN"))&&(i=!0,n=".InvalidCustoName",e.endsWith("-ADMIN")?c="-ADMIN":e.endsWith("-HIDDEN")&&(c="-HIDDEN"),l=!0);var d=a.options.oSearchCustoServices.getAvailableColumnCustomization(a._typeToHandle);if(t.is(d,"array")&&d.length>0)for(var u=0,h=d.length;u<h&!i;u++)d[u].value===e&&(i=!0,n=".AlreadyExistingCusto",o=!0,r=!0);if(!0===i){var g=new s({renderTo:document.body,className:"WarningSaveCustoDlg"}),p=[];o&&p.push({classname:"primary",id:"YesReplaceBtn",value:f.get("SearchColumnCusto.Warning.YES"),action:function(t){a._applySetting(e,!0),t.destroy(),a._requestClosePanel()}}),r&&p.push({classname:"primary",id:"NoReplaceBtn",value:f.get("SearchColumnCusto.Warning.NO"),action:function(e){a._custoNameEdt.setFocus(!0),e.destroy()}}),l&&p.push({classname:"primary",id:"OKReplaceBtn",value:f.get("SearchColumnCusto.Warning.OK"),action:function(e){a._custoNameEdt.setFocus(!0),e.destroy()}}),g.dialog({body:f.replace(f.get("SearchColumnCusto"+n+".Msg"),{columnCustoName:e,INVALID_EXT:c}),title:f.get("SearchColumnCusto"+n+".Title"),buttons:p})}else a._applySetting(e,!0),a._requestClosePanel()}var c=n.create("div",{class:"saveDiv"});a._custoNameEdt=new r({className:"SearchDataGridPreferences_txt",id:"CustomizationNameEdt",placeholder:f.get("SearchDataGridPreferences_modal_saveEditor"),attributes:{events:{keydown:function(){e.setDisabled(!1)}}},events:{onKeyDown:function(t){13===t.keyCode&&this.getValue().length>0&&(e.setDisabled(!1),a._custoCombo.getValue()!==this.getValue()&&l(this.getValue()))}}});var d=this._custoCombo.getValue()[0];d&&d.length>0&&(d.endsWith("-ADMIN")||d.startsWith("###")?(a._custoNameEdt.setValue(f.get("SearchColumnCustoDefaultNameForSave")),a._custoNameEdt.setFocus(!0)):a._custoNameEdt.setValue(d));var u=n.create("div",{class:"btnDiv"});e=new o({value:f.get("SearchDataGridPreferences_save_ok"),className:"primary ok-button",id:"ok_save_custo",events:{onClick:function(){var e=a._custoNameEdt.getValue();a._custoCombo.getValue()[0]!==e?l(e):(a._applySetting(e,!0),a._requestClosePanel())}}}),i=new o({value:f.get("SearchDataGridPreferences_save_cancel"),className:"primary cancel-button",id:"cancel_save_custo",events:{onClick:function(){a._createFooter()}}}),a._custoNameEdt.inject(c),u.inject(c),e.inject(u),i.inject(u),this._divFooter.innerHTML="",c.inject(this._divFooter),0===d.length&&e.setDisabled(!0)},_fillView:function(){c.log("SearchDataGridPreferences._fillView"),this._addGridColumnsManager(),this._addCustoCombo(),this._addFavoriteButton(),this._addDelButton(),t.is(this.options.searchDatagridView._forcedCustoView,"string")&&(this._typeToHandle.forcedCusto=this.options.searchDatagridView._forcedCustoView),this._addTooltip(),this._displayCusto(void 0,!0)},_addFavoriteButton:function(){var e=this;t.is(this._typeToHandle.isPQ)&&!0===this._typeToHandle.isPQ&&(this._bFav=new o({icon:"star",id:"associate_to_pq"}),this._bFavTooltip=new l({target:this._bFav.getContent(),body:f.get("custo_favorite.tooltip")}),this._bFavTooltip.getContent().style.zIndex=this._zIndexToUse+2,this._bFav.inject(this._divCombo),this._bFav.addEvent("onClick",function(){e._applySetting({custoName:e._typeToHandle.typeName.pqName,custoId:"###"+e._typeToHandle.typeName.pqName,custoNLS:e._typeToHandle.typeName.pqNLS,favPQ:!0},!0),e._requestClosePanel()}))},_addDelButton:function(){var e=this;this._bDel=new o({icon:"trash",id:"delete_custo_btn"}).inject(this._divCombo),this._columnCustoPreferenceDefinition=d.getItem("DataGridColumnCusto"),this._bDel.inject(this._divCombo),this._bDel.addEvent("onClick",function(){var i=e._custoCombo.getValue()[0];if(t.is(i,"string")&&i.length>0&&t.is(e._columnCustoPreferenceDefinition,"object")){var n=!1;if(e.options.searchDatagridView._currentCustoViewId===i&&(n=!0),t.is(e._columnCustoPreferenceDefinition.views,"array"))for(var s=e._columnCustoPreferenceDefinition.views.length-1;s>=0;s--)t.is(e._columnCustoPreferenceDefinition.views[s],"object")&&t.is(e._columnCustoPreferenceDefinition.views[s].viewId,"string")&&e._columnCustoPreferenceDefinition.views[s].viewId===i&&e._columnCustoPreferenceDefinition.views.splice(s,1);t.is(e._columnCustoPreferenceDefinition.activeView,"string")&&e._columnCustoPreferenceDefinition.activeView===i&&delete e._columnCustoPreferenceDefinition.activeView,d.commit(),e._custoCombo.remove(i),!0===n&&(e._applyReset(),e._requestClosePanel())}});var i=this._custoCombo.getValue(),n="";t.is(i,"array")&&i.length>0&&(n=i[0]),n.length>0&&!n.endsWith("-ADMIN")?this._bDel.show():this._bDel.hide()},_addCustoCombo:function(){var e=this;this._custoCombo=new a({nativeSelect:!0,id:"custo_selection",placeholder:f.get("dataGrid.columnCustoPanel.existingCustoComboPlaceHolder"),events:{onChange:function(){var i=this.getValue(),n="";t.is(i,"array")&&i.length>0&&(n=i[0]),t.is(e._bDel)&&(n.length>0&&!n.endsWith("-ADMIN")?e._bDel.show():e._bDel.hide()),0!==n.length&&(e._displayCusto(n),e._unmodifiedCusto=!0,t.is(e.options.preferences_grid)&&e.options.preferences_grid.getManager().updateView(!0))}}}).inject(this._divCombo),this._custoCombo.add(this.options.oSearchCustoServices.getAvailableColumnCustomization(this._typeToHandle))},_addTooltip:function(){this._bDelTooltip=new l({target:this._bDel.getContent(),body:f.get("custo_delete.tooltip")}),this._bDelTooltip.getContent().style.zIndex=this._zIndexToUse+2},destroy:function(){this._bFavTooltip&&this._bFavTooltip.destroy(),this._bFavTooltip=null,this._bDelTooltip&&this._bDelTooltip.destroy(),this._bDelTooltip=null,this._columnCustoPreferenceDefinition=null,this.gridInitValues=null,this.gridFinalValues=null,this._custoCombo=null,this._predicateIntersection=null,this._typeToHandle=null,this._bFav=null,this._bDel=null,this._parent()}})}),define("DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferencesEndUser",["DS/SNResultUX/utils/datagridPreferences/Abstract","UWA/Core","UWA/Class","DS/Spreadsheet/DataGrid","DS/UIKIT/Input/Button","DS/UIKIT/Autocomplete","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNAdvSearchCusto","DS/SNResultUX/views/WebUX/Spreadsheet/Manager_EndUserCusto","DS/SNResultUX/utils/SearchServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";var f="ENDUSER_CUSTO";return i.extend(e,{name:"SearchDataGridPreferencesEndUser",oSourceAutocomplete:null,oTypeAutocomplete:null,oSubtypeAutocomplete:null,availablePredicates:null,othersDataSources:null,currentObjectLoaded:{source:null,types:[]},buttonOk:null,buttonRestore:null,buttonDelete:null,init:function(e){l.setResources({resources:e.resources}),this._loadOtherSources(e.resources),this.currentObjectLoaded={source:null,types:[]},this._parent(e),this.options.availableColumns=this._computeColToDisplayInCustoPanel(t.clone(this.options.searchDatagridView._columnsAttributes),[],[]).concat(this.options.hiddenData),this.gridInitValues=t.clone(this.options.availableColumns),this.gridFinalValues=t.clone(this.options.availableColumns);let i=e.resources.getActiveTenant();h.getDefaultSelectedSource(i);this._buildView(),this._fillView(),this._loadCusto(!0),1===this.options.sources.length&&(this.oSourceAutocomplete.dispatchEvent("onSelect",[this.options.sources[0]]),this.oSourceAutocomplete.disable()),this.enableFooterButtonsVisiblity()},_loadCusto:function(e){let i=r.getItem("DataGridColumnCusto");if(t.is(i)&&t.is(i.views,"array"))for(let t in i.views)if(f===i.views[t].viewId){this._predicateIntersection=[],this._displayCusto(f,e);break}return this},reloadRightGridWithCurrentColumns:function(){return this.options.availableColumns=this._computeColToDisplayInCustoPanel(t.clone(this.options.searchDatagridView._columnsAttributes),[],[]).concat(this.options.hiddenData),this.gridFinalValues=this.options.availableColumns,this.options.preferences_grid.getManager().empty(),this.options.preferences_grid.getManager().addRows(this._getPrefGridData(this.gridFinalValues)),this.unselectAllLeftPredicates(),this},unselectAllLeftPredicates:function(){return this.availablePredicates&&this.availablePredicates.getManager().unselectAll(),this},_loadOtherSources:function(e){this.othersDataSources=[],d.login({resources:e,onComplete:e=>{let i=u.getValidDatasources({dataSources:e});t.is(i.otherDataSourceServices,"array")&&(this.othersDataSources=i.otherDataSourceServices)},onFailure:e=>{a.log("[3dSearch-DGPrefEndUser] - "+e)}})},_fillView:function(){this._addSourcesAutocomplete(),this._addTypesAutocomplete(),this._addSubtypesAutocomplete(),this._constructAndDislayAvailablePredicatesSpreadsheet([]),this._addGridColumnsManager()},_addSourcesAutocomplete:function(){var e=this;null!==this.oSourceAutocomplete&&this.oSourceAutocomplete.destroy(),this.oSourceAutocomplete=new o({showSuggestsOnFocus:!0,placeholder:_.get("adv_search.dataSource"),events:{onSelect:function(t){e._reinit(),e.currentObjectLoaded.source=t;let i={vocabId:l.getVocabularyName(t.value)};"other"===i.vocabId&&(i.rdfSources=e.othersDataSources),l.loadVocabularyClasses(i,i=>{if(e.oTypeAutocomplete.setDisabled(!0),i.classInfos.length>0){for(let e in i.classInfos)i.classInfos[e].label=i.classInfos[e].nlsName,i.classInfos[e].value=i.classInfos[e].uri;e.oTypeAutocomplete.addDataset({name:t.value,items:i.classInfos}),e.currentObjectLoaded.types=i.classInfos,e.oTypeAutocomplete.setDisabled(!1)}})},onUnselect:function(t){for(let i in e.oTypeAutocomplete.datasets)if(t.value===e.oTypeAutocomplete.datasets[i].name){e.oTypeAutocomplete.removeDataset(e.oTypeAutocomplete.datasets[i].id);break}e.currentObjectLoaded.types=[],e.oTypeAutocomplete.datasets.length<=0&&e.oTypeAutocomplete.setDisabled(!0);for(let t in e.oSubtypeAutocomplete.datasets)e.oSubtypeAutocomplete.removeDataset(e.oSubtypeAutocomplete.datasets[t].id);e.oSubtypeAutocomplete.datasets.length<=0&&e.oSubtypeAutocomplete.setDisabled(!0),e._constructAndDislayAvailablePredicatesSpreadsheet([])}}}),this.oSourceAutocomplete.addDataset({items:this.options.sources}),this.oSourceAutocomplete.getContent().addClassName("sourcesInput"),this.oSourceAutocomplete.inject(this._divCombo)},_addTypesAutocomplete:function(){var e=this;null!==this.oTypeAutocomplete&&this.oTypeAutocomplete.destroy(),this.oTypeAutocomplete=new o({showSuggestsOnFocus:!0,placeholder:_.get("adv_search.type"),multiSelect:!0,disabled:!0,events:{onSelect:function(t){l.loadRelevantInterfaces({className:t.value,currentDataSource:t.service},i=>{for(let e in i.interfaces)i.interfaces[e].label=i.interfaces[e].nlsName,i.interfaces[e].value=i.interfaces[e].name;for(let n in e.currentObjectLoaded.types)t.value===e.currentObjectLoaded.types[n].value&&(e.currentObjectLoaded.types[n].subTypes=i.interfaces);e.oSubtypeAutocomplete.addDataset({name:t.value,items:i.interfaces}),e._reloadAvailablePredicates(),e.oSubtypeAutocomplete.datasets.length<=0?e.oSubtypeAutocomplete.setDisabled(!0):e.oSubtypeAutocomplete.setDisabled(!1)})},onUnselect:function(t){for(let i in e.currentObjectLoaded.types)if(t.value===e.currentObjectLoaded.types[i].value){delete e.currentObjectLoaded.types[i].subTypes;for(let i in e.oSubtypeAutocomplete.datasets)if(t.value===e.oSubtypeAutocomplete.datasets[i].name){e.oSubtypeAutocomplete.selectedItems.filter(t=>t.datasetId===e.oSubtypeAutocomplete.datasets[i].id).forEach(t=>e.oSubtypeAutocomplete.onUnselect(t)),e.oSubtypeAutocomplete.removeDataset(e.oSubtypeAutocomplete.datasets[i].id);break}break}e._reloadAvailablePredicates(),e.oSubtypeAutocomplete.datasets.length<=0&&e.oSubtypeAutocomplete.setDisabled(!0)}}}),this.oTypeAutocomplete.getContent().addClassName("typesInput"),this.oTypeAutocomplete.inject(this._divCombo)},_addSubtypesAutocomplete:function(){var e=this;null!==this.oSubtypeAutocomplete&&this.oSubtypeAutocomplete.destroy(),this.oSubtypeAutocomplete=new o({showSuggestsOnFocus:!0,placeholder:_.get("adv_search.subtype"),multiSelect:!0,disabled:!0,events:{onSelect:function(){e._reloadAvailablePredicates()},onUnselect:function(){e._reloadAvailablePredicates()}}}),this.oSubtypeAutocomplete.getContent().addClassName("extensionsInput"),this.oSubtypeAutocomplete.inject(this._divCombo)},_reinit:function(){this.currentObjectLoaded={source:null,types:[]},this.oTypeAutocomplete.unselectAll()&&delete this.oTypeAutocomplete.datasets&&this.oTypeAutocomplete.getSuggestions(),this.oSubtypeAutocomplete.unselectAll()&&delete this.oSubtypeAutocomplete.datasets&&this.oSubtypeAutocomplete.getSuggestions()},_createFooter:function(){this._divFooter.innerHTML="";var e=this;return this.buttonOk=new s({value:_.get("SearchDataGridPreferences_modal_apply"),className:"primary apply-button",id:"apply_customization_btn",events:{onClick:function(){null!==e.options.move_to_do&&e.options.preferences_grid.getManager().getRows().forEach(function(t){e.options.move_to_do.push(t[0].options.value)}),e._custoCombo&&!0===e._unmodifiedCusto?e._applySetting(e._custoCombo.getValue()[0],!1):e._applySetting(f,!0),e._requestClosePanel()}}}).inject(this._divFooter),this.buttonRestore=new s({value:_.get("SearchDataGridPreferences_modal_reset"),className:"secondary reset-button",id:"reset_customization_btn",disabled:!0,events:{onClick:function(){e._applyReset(new Object),e._requestClosePanel()}}}).inject(this._divFooter),this.buttonDelete=new s({value:_.get("SearchDataGridPreferences_modal_delete"),className:"secondary delete-button",id:"delete_customization_btn",disabled:!0,events:{onClick:function(){e._remove()}}}).inject(this._divFooter),this._divFooter},enableFooterButtonsVisiblity:function(){let e=r.getItem("DataGridColumnCusto");if(!t.is(e)||t.is(e.activeView)&&"The_Default_Columns"===e.activeView?this.buttonRestore.setDisabled(!0):this.buttonRestore.setDisabled(!1),this.buttonDelete.setDisabled(!0),t.is(e)&&t.is(e.views,"array"))for(let t in e.views)if(f===e.views[t].viewId){this.buttonDelete.setDisabled(!1);break}return this._parent()},_reloadAvailablePredicates:function(){let e=[],t=[];var i=this;let n=this.oTypeAutocomplete.getSelection();n.length>0&&(t=t.concat(n));for(let t=0;t<n.length;t++)e.push(n[t].value);let s=this.oSubtypeAutocomplete.getSelection();s.length>0&&(t=t.concat(s));for(let t=0;t<s.length;t++)e.push(s[t].value);0!==e.length?c._asyncCallToPredicatesWS(e).then(function(e){i._constructAndDislayAvailablePredicatesSpreadsheet(i._formatAvailableDataResponse(e.classPredicates,t))},function(e){console.log(e)}):this._constructAndDislayAvailablePredicatesSpreadsheet([])},_formatAvailableDataResponse:function(e,t){let i=[];for(let n=0;n<e.length;n++)for(let s=0;s<e[n].vocabularyPredicateInfo.length;s++){let o=e[n].className;for(let e=0;e<t.length;e++)if(o===t[e].value){o=t[e].nlsName;break}i.push({class:o,name:e[n].vocabularyPredicateInfo[s].nlsName,value:e[n].vocabularyPredicateInfo[s].uri,classValue:e[n].className})}return i},_constructAndDislayAvailablePredicatesSpreadsheet:function(e){if(e=this._filterPredicates(e),null!==this.availablePredicates)this.availablePredicates.getManager().empty(),this.availablePredicates.getManager().addRows(e);else{let t=this;this.availablePredicates=new n({enableScrollOnDrag:!1,columns:[{text:_.get("SearchDataGridPreferences_modal_header_class"),dataIndex:"class",width:"auto",minWidth:40},{text:_.get("SearchDataGridPreferences_modal_header_name"),dataIndex:"name",width:"auto",minWidth:40},{dataIndex:"value",isHidden:!0},{dataIndex:"classValue",isHidden:!0}],data:e,defaultCellHeight:40,headersDimensions:{height:40},show:{rowHeaders:!0,columnHeaders:!0},height:"auto",apiVersion:2,resize:{columns:!0},isSortable:!0,selection:{cells:!1,rowHeaders:!0,columnHeaders:!1,unselectAllOnEmptyArea:!0,canMultiSelect:!0},enableDragAndDrop:!1,managerClass:g}),this.availablePredicates.inject(this._divAvailable),this.availablePredicates.getManager().onRowHeaderRequest(function(e){e.cellView.getContent().setStyles({"text-align":"center",opacity:.5,fontSize:"1.5em",cursor:"pointer"}),t.availablePredicates.getManager().isRowSelected(e.cellView.getVirtualCoordinates().virtualRowID)?e.cellView.getContent().innerHTML="[x]":e.cellView.getContent().innerHTML="[  ]",t.availablePredicates.getManager().getSelectedRows().length<=0?t._arrow.setDisabled(!0):t._arrow.setDisabled(!1)})}},_filterPredicates:function(e){let t=[];for(let i=0;i<e.length;i++){let n=!1;for(let t=0;t<this.gridFinalValues.length;t++)if(e[i].value===this.gridFinalValues[t].dataIndex){n=!0;break}!n&&t.push(e[i])}return t},_onAddPredicate:function(){let e=this.availablePredicates.getManager().options.model,i=this.availablePredicates.getManager().getSelectedRows(),n=[];for(let t in i)void 0!==e[i[t]]&&n.push({dispValue:e[i[t]][1].options.value,relatedObjectType:e[i[t]][3].options.value,relatedObjectTypeDispValue:e[i[t]][0].options.value,sixw:e[i[t]][2].options.value,isRemovable:!0,visibility:!0});this.options.availableColumns=this._computeColToDisplayInCustoPanel(t.clone(this.gridFinalValues),n,[]),this.gridFinalValues=this.options.availableColumns,this.options.preferences_grid.getManager().empty(),this.options.preferences_grid.getManager().addRows(this._getPrefGridData(this.gridFinalValues))},_remove:function(){let e=r.getItem("DataGridColumnCusto");if(t.is(e,"object")){let n=f===this.options.searchDatagridView._currentCustoViewId;if(t.is(e.views,"array"))for(var i=e.views.length-1;i>=0;i--)t.is(e.views[i],"object")&&t.is(e.views[i].viewId,"string")&&f===e.views[i].viewId&&e.views.splice(i,1);t.is(e.activeView,"string")&&f===e.activeView&&delete e.activeView,r.commit(),!0===n&&this._applyReset(new Object),p._displayAlert({message:_.replace(_.get("SearchDataGridPreferences_modal_deleteSuccessful"),{custo_name:f}),className:"success"}),this._requestClosePanel()}},destroy:function(){return null!==this.oSourceAutocomplete&&this.oSourceAutocomplete.destroy(),null!==this.oTypeAutocomplete&&this.oTypeAutocomplete.destroy(),null!==this.oSourcoSubtypeAutocompleteeAutocomplete&&this.oSubtypeAutocomplete.destroy(),null!==this.availablePredicates&&this.availablePredicates.destroy(),null!==this.buttonOk&&this.buttonOk.destroy(),null!==this.buttonRestore&&this.buttonRestore.destroy(),null!==this.buttonDelete&&this.buttonDelete.destroy(),this._parent()}})}),define("DS/SNResultUX/views/helpers/SearchDataGridView",["UWA/Core","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/views/helpers/Abstract","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/UIKIT/SuperModal"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";return d.extend({tagName:"div",className:"DataGridView",attributes:{styles:{width:"100%"},"data-rec-id":"DataGridView"},IDENTIFIER:"3dSearch-datagrid-identifier",_fixTh:["ds6w:label","ds6w:who/ds6w:responsible","ds6w:when/ds6w:created","ds6w:when/ds6w:modified","ds6w:responsible","ds6w:created","ds6w:modified"],_defaultColumnDef:{width:"auto",typeRepresentation:"string"},_columns:[],_columnsForDataGrid:[],_currentCustoViewId:null,_currentTenant:null,_columnsAttributes:[],_subscriptions:[],_forcedCustoView:null,collection:null,nestedView:null,specific_socket:null,_aCustoColumnAttributes:[],init:function(i){var s=this;this._parent(i),this._columns=e.clone(this._columnsAttributes),this._aCustoColumnAttributes=[],e.is(this.collection&&this.collection.getSNSkeleton())&&(this._subscriptions.sortForAllView=t.subscribe({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"sortForAllView",callback:function(t){if(!e.is(s.view)||!s.collection.service_parameters)throw new Error("[SarchDataGridView] : callback sort - datagrid object is undefined.");if(e.is(t.bForceNotReload,"boolean")&&!1===t.bForceNotReload)return;let i,o;s.collection.service_parameters.order_by&&s.collection.service_parameters.order_field?(i=s.collection.service_parameters.order_by,o=s.collection.service_parameters.order_field):(i=t.order_by,o=t.order_field);var a=n.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(e.is(a))for(let e in a)if(e===o){o=a[e];break}s.view.initComponentState({dataIndex:o,sort:i})}}))},setup:function(t){this._parent(t);var i=this;this.listenTo(this.collection,{onSync:function(){i.view&&i._updateAfterCollectionSync()},onInitTreeDocument_SelectFirstElt:function(){e.is(i.view)&&e.is(i.collection)&&e.is(i.collection.service_parameters)&&e.is(i.collection.service_parameters.query)&&s.SearchTypeEnum.MY_RECENT_CONTENT===i.collection.service_parameters.query&&i.view._applySortModel(!1),i.view&&i._updateAfterCollectionSync()}}),o.removeItem("listColumnsWidth"),c.resetDefaultHeaders()},_updateAfterCollectionSync:function(){for(var e=0;e<this.view.columns.length;e++)this.view.columns[e].sortableFlag=this.collection.state.totalRecords<=n.getOption("max_results_to_enable_sort")?r.isColumnSortable(this.view.columns[e].dataIndex):r.isColumnSortableFor1000(this.view.columns[e].dataIndex);this.view._applyColumns()},_resizeColumn:function(t,i){e.is(this.view)&&this.view.layout.setColumnWidth(t,i,{isUserInteraction:!1})},_reinitColums:function(t){this._forcedCustoView=null,this._currentCustoViewId=this._lastSelectedCustoViewId,this._currentTenant=this.collection.search_ressources.getActiveTenant(),this._reinitColumnsWidth();var i=e.is(this.collection.service_parameters)&&e.is(this.collection.service_parameters.isAPQSearch)&&!0===this.collection.service_parameters.isAPQSearch&&e.is(this.collection)&&e.is(this.collection.getPQ())&&e.is(this.collection.getPQ().pqName,"string")&&this.collection.getPQ().pqName.length>0,n={isPQ:i,typeName:this.collection.getPQ()},o=r.getColumnCustomizationIdToUse(n);if(e.is(o,"string")&&o.length>0&&(this._currentCustoViewId=o,this._setColumnAttributes(r.getColumnCustomizationDefinitionFromCustoId(o,this._currentTenant))),e.is(this.collection.service_parameters)&&e.is(this.collection.options.tagger_proxy)&&e.is(this.collection.service_parameters.refine)&&e.is(this.collection.options.tagger_proxy.getCurrentFilter())&&e.is(this.collection.service_parameters.refine.allfilters)&&e.is(this.collection.options.tagger_proxy.getCurrentFilter().allfilters)){let s={},o={};s=e.clone(this.collection.options.tagger_proxy.getCurrentFilter(),!0),o=e.clone(this.collection.service_parameters.refine,!0),e.is(s.allfilters)&&a.isSimplifiedTaggerFilters(s.allfilters)&&(s.allfilters=r.getAllFilters(s.allfilters)),this._reinitColumsGetFilters(t,s,o,i,n)}(!e.is(this._columnsAttributes)||e.is(this._columnsAttributes)&&this._columnsAttributes.length<1)&&this._setColumnAttributes(c.getDataGridViewHeaders()),e.is(this.collection)&&e.is(this.collection.service_parameters)&&e.is(this.collection.service_parameters.query)&&s.SearchTypeEnum.MY_RECENT_CONTENT===this.collection.service_parameters.query&&this._columnsAttributes.forEach(function(e){-1!==e.dataIndex.indexOf("/")&&(e.dataIndex=e.dataIndex.slice(e.dataIndex.indexOf("/")+1,e.dataIndex.length))}),this._reloadColumn(this._columnsAttributes),this.collection.getAttributesToRetrieve(this._columns),this._comptuteNewColumnsNLS()},_reinitColumnsWidth:function(){if(o.getItem("listColumnsWidth")&&this.view)try{let t=JSON.parse(o.getItem("listColumnsWidth")),n=Object.keys(t);for(var e=0;e<this.view.columns.length;e++)-1!==n.indexOf(this.view.columns[e].dataIndex)&&(this.view.columns[e].width=t[this.view.columns[e].dataIndex])}catch(e){i.log(e)}if("The_Default_Columns"===this._currentCustoViewId)if(o.getItem("listColumnsWidth"))try{let e=JSON.parse(o.getItem("listColumnsWidth")),t=Object.keys(e);this._columnsAttributes.forEach(function(i){i.width=-1===t.indexOf(i.dataIndex)?"auto":e[i.dataIndex]})}catch(e){i.log(e)}else this._columnsAttributes.forEach(function(e){e.width="auto"})},_reinitColumsGetFilters:function(t,i,n,o,a){if(this.collection.service_parameters.query===s.SearchTypeEnum.ADVANCED_SEARCH&&e.is(n)&&""===n)this._setColumnAttributes(r.getColumnCustomizationDefinitionFromCustoId("The_Default_Columns",this._currentTenant));else if(e.is(i)&&e.is(i.allfilters)&&e.is(n)&&e.is(n.allfilters))if(this.collection.service_parameters.query!==s.SearchTypeEnum.ADVANCED_SEARCH&&Object.keys(i.allfilters).length>0&&(e.is(i.allfilters["ds6w:what/ds6w:type"])&&i.allfilters["ds6w:what/ds6w:type"].length>0||e.is(i.allfilters["ds6w:what/ds6w:kind"])&&i.allfilters["ds6w:what/ds6w:kind"].length>0)){let i=[];e.is(n.allfilters)&&e.is(n.allfilters.condition,"array")&&e.is(n.allfilters.condition[0]["ds6w:what/type_categorization"])&&e.is(n.allfilters.condition[0]["ds6w:what/type_categorization"].condition,"array")&&(i=n.allfilters.condition[0]["ds6w:what/type_categorization"].condition),e.is(n.allfilters)&&e.is(n.allfilters,"object")&&e.is(n.allfilters["ds6w:what/ds6w:type"],"array")&&(i=n.allfilters["ds6w:what/ds6w:type"]);let s=[];for(let e=0;e<i.length;e++){let t=r.getColumnCustomizationAliasIdToUse(i[e].object,this._currentTenant);s.push(t)}let o=s.filter(function(e,t,i){return i.indexOf(e)===t});1===o.length&&e.is(o[0])&&(this._currentCustoViewId=o[0],this._setColumnAttributes(r.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId)),!this._isCurrentView||e.is(t)&&e.is(t.refresh)||l._displayAlert({message:u.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:this.getOption("widgetId")}))}else if(e.is(i.allfilters)&&(1===Object.keys(i.allfilters).length&&e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])||2===Object.keys(i.allfilters).length&&(e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])||e.is(i.allfilters["sixw:vpmextension"])))||3===Object.keys(i.allfilters).length&&(e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])||e.is(i.allfilters["sixw:vpmextension"]))){let n=[];e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])&&!e.is(i.allfilters["sixw:vpmextension"])?n=i.allfilters["sixw:ds6w:what/ds6w:type"]:e.is(i.allfilters["sixw:vpmextension"])&&!e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])?n=i["sixw:vpmextension"]:e.is(i.allfilters["sixw:vpmextension"])&&e.is(i.allfilters["sixw:ds6w:what/ds6w:type"])&&(n=i.allfilters["sixw:ds6w:what/ds6w:type"].concat(i.allfilters["sixw:vpmextension"]));let s=[];for(let e=0;e<n.length;e++){let t=r.getColumnCustomizationAliasIdToUse(n[e].object.slice(6),this._currentTenant);s.push(t)}let o=s.filter(function(e,t,i){return i.indexOf(e)===t});1===o.length&&e.is(o[0])&&(this._currentCustoViewId=o[0],this._setColumnAttributes(r.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId)),!this._isCurrentView||e.is(t)&&e.is(t.refresh)||l._displayAlert({message:u.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:this.getOption("widgetId")}))}else if(o){var c=r.getColumnCustomizationIdToUse(a);e.is(c,"string")&&c.length>0&&(this._currentCustoViewId=c,this._setColumnAttributes(r.getColumnCustomizationDefinitionFromCustoId(c,this._currentTenant)))}else this._setColumnAttributes(r.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId,this._currentTenant));else this._setColumnAttributes(r.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId,this._currentTenant))},_comptuteNewColumnsNLS:function(){for(var t=this,n=[],o=0,a=this._columnsAttributes.length;o<a;o++)n.push(this._columnsAttributes[o].dataIndex);var r="";if(e.is(t.collection)&&e.is(t.collection.search_ressources)&&e.is(t.collection.search_ressources.getActiveTenant,"function")&&(r=t.collection.search_ressources.getActiveTenant()),n.length>0){var l=n.join("\r\n");h.getResourcesInfo(l,{tenantId:r,lang:s.getLanguage(),apiVersion:"R2019x",onComplete:function(n){if(i.log(n),!e.is(n))return i.error("Unexpected response from getResourcesInfo !"),null;for(var s=!1,o=0,a=t._columnsAttributes.length;o<a;o++)for(var r=0,l=n.length;r<l;r++){if(!e.is(n[r].curi)||!e.is(n[r].label))return i.error("Unexpected response from getResourcesInfo !"),null;n[r].curi===t._columnsAttributes[o].dataIndex&&t._columnsAttributes[o].text!==n[r].label&&("ds6wg:_displayName_"===t._columnsAttributes[o].dataIndex?t._columnsAttributes[o].text=u.get("Display_Name_Column_Title"):t._columnsAttributes[o].text=n[r].label,s=!0)}s&&t._updateColumnsNLS()},onFailure:function(){i.warn("not able to load predicates")}})}},_retrieveNewNLSSuccess:function(t){if(!e.is(t.classPredicates))return i.error("Unexpected response from GetRelevantPredicates !"),null;for(var n=!1,s=0,a=this._columnsAttributes.length;s<a;s++)if(this._columnsAttributes[s].dataIndex.startsWith("ds6wg:"))for(var r=0,l=t.classPredicates.length;r<l;r++){if(!e.is(t.classPredicates[r].className)||!e.is(t.classPredicates[r].vocabularyPredicateInfo))return i.error("Unexpected response from GetRelevantPredicates !"),null;for(var c=0,d=t.classPredicates[r].vocabularyPredicateInfo.length;c<d;c++)t.classPredicates[r].vocabularyPredicateInfo[c].uri===this._columnsAttributes[s].dataIndex&&(this._columnsAttributes[s].text!==t.classPredicates[r].vocabularyPredicateInfo[c].nlsName&&(this._columnsAttributes[s].text=t.classPredicates[r].vocabularyPredicateInfo[c].nlsName,n=!0),c=d,r=l)}var u={};for(let t=0,i=this._columnsAttributes.length;t<i;t++)e.is(u[this._columnsAttributes[t].text])||(u[this._columnsAttributes[t].text]=0),u[this._columnsAttributes[t].text]+=1;for(let t=0,i=this._columnsAttributes.length;t<i;t++)e.is(u[this._columnsAttributes[t].text])&&u[this._columnsAttributes[t].text]>1&&(this._columnsAttributes[t].text+=" ("+(e.is(this._columnsAttributes[t].dataType)?this._columnsAttributes[t].dataType:e.is(this._columnsAttributes[t].dataIndex)?this._columnsAttributes[t].dataIndex:t)+")",n=!0);!0===n&&(o.commit(),this._updateColumnsNLS())},_updateColumnsNLS:function(){if(e.is(this.view)){for(var t=0;t<this._columnsAttributes.length;t++)for(var i=0;i<this.view.columns.length;i++)this._columnsAttributes[t].dataIndex===this.view.columns[i].dataIndex&&(this.view.columns[i].text=this._columnsAttributes[t].text);this.view._applyColumns(),this.view.layout.applyColumns()}},getMinNumberModel:function(e){return e=e||this._rowMaxNumber},onSearch:function(t){e.is(this.view)&&(e.is(this.collection)&&e.is(this.collection.service_parameters)&&e.is(this.collection.service_parameters.query)&&s.SearchTypeEnum.MY_RECENT_CONTENT===this.collection.service_parameters.query?this.view.setSortMode3dSearch(!1):this.view.setSortMode3dSearch(!0)),this._parent(t),this.view&&this.view.resetScrollPosition(),e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&this.colCustoPanel._requestClosePanel(),this.colCustoPanel=null,this._reinitColums(t)},_updateColumns:function(t,i,s,a){if(Array.isArray(t)&&this._searchcom_socket&&(this._searchcom_socket.dispatchEvent("checkNewColomnForSort",t),!e.is(this.view.sortModel)||e.is(this.view.sortModel[0])&&"relevance"===this.view.sortModel[0].dataIndex))if(e.is(o.getItem("searchSort"))){let e=o.getItem("searchSort");this.collection.setGlobalOrder(e.order_field,e.order_by)}else if(n.getOption("default_sort")){var r=n.getOption("default_sort");e.is(r,"object")&&e.is(r.order_by,"string")&&e.is(r.order_field,"string")&&this.collection.setGlobalOrder(r.order_field,r.order_by)}else n.getOption("apply_sort_on_modified_by_default")?this.collection.setGlobalOrder("ds6w:modified","desc"):this.collection.setGlobalOrder("","");var d,h="",g="",p=!1;e.is(i,"string")?(h=i,g=i):e.is(i,"object")&&(h=i.custoName,d=i.custoNLS,g=i.custoId,e.is(i.favPQ)&&!0===i.favPQ&&(p=!0)),this._currentCustoViewId=g;for(var _=[],f=0,m=(t=c.getCustoCellRequest(t)).length;f<m;f++)if(e.is(t[f],"object")){var v=t[f].dataIndex;_.push(v.slice(v.lastIndexOf("/")+1,v.length))}this.collection.setAttributesToRetrieve(_);var S=o.getItem("DataGridColumnCusto"),w=[];e.is(S)&&(e.is(S.activeView)&&!1===p&&(this._lastSelectedCustoViewId=S.activeView),e.is(S.views)&&(w=S.views));var b=this.getOption("widgetId");if("The_Default_Columns"!==g){if(!0===s){for(var C=w.length-1;C>=0;C--)w[C].viewId===g&&w.splice(C,1);let e={viewId:g,viewDefinition:t,version:2};void 0!==a&&(e.viewDefinitionHidden=a),w.push(e)}var y={views:w};if(!1===p?y.activeView=g:e.is(S)&&e.is(S.activeView)&&(y.activeView=S.activeView),o.setItem("DataGridColumnCusto",y),o.commit(),!0===s&&"TEMP_CUSTO"!==g)l._displayAlert({message:u.replace(u.get("SearchDataGridPreferences_modal_saveSuccessful"),{custo_name:e.is(d,"string")?d:h}),className:"success",widgetId:b});else if("TEMP_CUSTO"!==g){var I=h;I.endsWith("-ADMIN")&&(I=I.slice(0,-6)),I.startsWith("###")&&(I=u.replace(u.get("custo_PQ"),{PQ:I.substring(3,I.length)})),I.endsWith("-HIDDEN")?l._displayAlert({message:u.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:b}):l._displayAlert({message:u.replace(u.get("SearchDataGridPreferences_modal_applySuccessful"),{custo_name:I}),className:"success",widgetId:b})}else l._displayAlert({message:u.get("SearchDataGridPreferences_modal_applyTempCustoSuccessful"),className:"success",widgetId:b})}else S=o.getItem("DataGridColumnCusto"),e.is(S)&&(S.activeView="The_Default_Columns"),this._lastSelectedCustoViewId="The_Default_Columns",o.setItem("DataGridColumnCusto",S),o.commit(),l._displayAlert({message:u.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:b});this._forcedCustoView=g,this._reloadColumn(t),this._comptuteNewColumnsNLS(),this.collection._snSkeleton._loadFirstPage()},_setColumnAttributes:function(t){!e.is(this._aCustoColumnAttributes[this._currentCustoViewId])&&(this._aCustoColumnAttributes[this._currentCustoViewId]=this._columnsAttributes);let i=this._aCustoColumnAttributes[this._currentCustoViewId];for(let n in i)for(let s in t)i[n].dataIndex===t[s].dataIndex&&(e.is(i[n].visibleFlag)&&(t[s].visibleFlag=i[n].visibleFlag),e.is(i[n].wrap)&&(t[s].wrap=i[n].wrap));this._aCustoColumnAttributes[this._currentCustoViewId]=t,this._columnsAttributes=t},updateCustoColumnAttribute:function(e,t){this._aCustoColumnAttributes[e]=t},_reloadColumn:function(t){this._setColumnAttributes(t),this._columns=e.clone(this._columnsAttributes),e.is(this.view)?(this.view.columns=this._retrieveOptions().columns,this.view.setColumns(this.view.columns),this.view._applyColumns()):i.error("[DataGridView] - component grid is not present.")},_openColumnsCustoPanel:function(){if(e.is(this.collection._snSkeleton.getSearchActions,"function")){var t=this.collection._snSkeleton.getSearchActions();e.is(t)&&e.is(t.columnCustomizationDefinitionUI,"function")&&t.columnCustomizationDefinitionUI()}},_setSpecificOptionsToCustoColumns:function(t){for(var i=0;i<t.length;i++)!0===t[i].wrap?(t[i].autoRowHeightFlag=!0,t[i].typeRepresentation="textBlock"):(e.is(t[i].autoRowHeightFlag)&&delete t[i].autoRowHeightFlag,e.is(t[i].typeRepresentation)&&delete t[i].typeRepresentation),t[i].sortableFlag=t[i].isSortable,e.is(t[i].isSortable)&&delete t[i].isSortable,t[i].editableFlag=!1;return t},_retrieveOptions:function(){return c.initColumnsDataGrid({columns:this._setSpecificOptionsToCustoColumns(e.clone(this._columnsAttributes))},{onClickEvent:this._callBackActionMenu,onContextualEvent:this.getOptionCommon().onContextualEvent.callback,onItemTitleClickCallback:this.onItemTitleClick,onDblClickEvent:this._callBackDblClickActionMenu,onItemTitleDblClickCallback:this.onItemDblClick,referer:this,actionsMenuAccessRights:this._getMenuAndLocalActionsStatus(),tabId:this.collection.getSNSkeleton().getOption("observable").getTabID(),tooltipCB:this._tooltipCB,widgetId:this.getOption("widgetId")})},updateColumnWidth:function(t,n){var s=this.view.columns[t].dataIndex;if(e.is(s)&&e.is(localStorage)){var a={},r=o.getItem("listColumnsWidth");if(e.is(r,"string")&&r.length>0)try{for(var l=JSON.parse(r),c=0;c<Object.keys(l).length;c++)a[Object.keys(l)[c]]=l[Object.keys(l)[c]]}catch(e){i.log(e)}a[s]=n,o.setItem("listColumnsWidth",JSON.stringify(a)),o.commit()}},render:function(t){this._parent();var i=this;return require(["DS/SNResultUX/views/WebUX/DataGrid/DataGridView"],function(a){let r="";e.is(i.collection)&&e.is(i.collection.search_ressources)&&e.is(i.collection.search_ressources.getActiveTenant,"function")&&(r=i.collection.search_ressources.getActiveTenant()),s.isRoleAvailable(["CSV","InternalDS"],r,function(s){i._reinitColums(i.options),i._defaultColumnDef.allowUnsafeHTMLContent=i.getOptionCommon().allowUnsafeHTMLContent;let r=[];if(e.is(o.getItem("searchSort"))){r=[{dataIndex:o.getItem("searchSort").order_field,sort:o.getItem("searchSort").order_by}];let t=n.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(e.is(t))for(var l in t)if(t[l]==r[0].dataIndex){r[0].dataIndex=l;break}}i.view=new a({treeDocument:i._model,columns:i._retrieveOptions().columns,defaultColumnDef:i._defaultColumnDef,rowSelection:i._canMultiSelect?"multiple":"single",cellSelection:"none",collection:i.collection,pageScrollValueTriggeringInfiniteScroll:i.getOptionCommon().pageScrollValueTriggeringInfiniteScroll,onDragStartCell:i.getOptionCommon().onDragStartCell,onDragEndCell:i.getOptionCommon().onDragEndCellDefault,cellDragEnabledFlag:!0,isLoading:!0,onContextualEvent:function(e){return i.view.scrollerPosition=i.view.getScrollerPosition(),e&&e.cellInfos&&-1!==e.cellInfos.rowID?i.getOptionCommon().onContextualEvent.callback(e):e&&e.collectionView?e.collectionView.build3DSearchHeaderColumnContextualMenu(e,i):[]},wrapEventCB:function(t){var s=i._aCustoColumnAttributes[i._currentCustoViewId]||i._columnsAttributes,o=-1;for(let e=0;e<s.length;e++)t===s[e].dataIndex&&(o=e);if(e.is(n.getOption("search_datagrid").wrap_standard_fields)){var a=0;for(let e=0;e<s.length;e++)e!==o&&!0===s[e].wrap&&a++;if(a>=n.getOption("search_datagrid").wrap_standard_fields)return void new g({closable:!0,animate:!0,overlay:!0,className:"searchModal"}).dialog({body:u.replace(u.get("dataGrid.columnCustoPanel.maxWrapSize"),{number:n.getOption("search_datagrid").wrap_standard_fields}),title:u.get("SearchDataGridPreferences_modal_information"),buttons:[{className:"primary",value:u.get("SearchDataGridPreferences_modal_apply"),action:function(e){e.hide()}}]})}s[o].wrap=!e.is(s[o].wrap,"boolean")||!s[o].wrap,i._reloadColumn(s),i.collection._snSkeleton._loadFirstPage()},visibleEventCB:function(t){for(var n=i._aCustoColumnAttributes[i._currentCustoViewId]||i._columnsAttributes,s=-1,o=0;o<n.length;o++)t===n[o].dataIndex&&(s=o);n[s].visibleFlag=!(-1===s||!e.is(n[s].visibleFlag,"boolean"))&&!n[s].visibleFlag},pinEventCB:function(e,t){-1!==e&&(i._columnsAttributes[e].pinned=void 0===t?"center":t)},onColumnWidthUpdate:function(e,t){i.updateColumnWidth(e,t)},dblClickEventCB:function(e){i.onItemDblClick(e)},onSelectAllCB:function(){i.selectAll()},onUnselectAllCB:function(){i.unSelectAll()},getCellTooltip:function(e){return i._tooltipCB(e,i)},sortModel:r,bDisableMenuCustoView:!s}),i.view.onReady(()=>{i._afterRender(t),i.view.reselectXSOElements()}),i.view.inject(i.container)})}),this},_initializeIdentifier:function(){return e.is(localStorage.getItem(this.IDENTIFIER))||localStorage.setItem(this.IDENTIFIER,(Date.now()/1e3|0)+Math.floor(1e6*Math.random()+1)),localStorage.getItem(this.IDENTIFIER)},_afterRender:function(){if(this.view.showNodeKPIColorFlag=!0,this.view.afterRender&&this.view.afterRender(this),this._model.search_multiselMode?this.toggleMultiSelMode(!0):this.toggleMultiSelMode(!1),this.collection.getRequestCriteria().service_params&&this.collection.getRequestCriteria().service_params.adv_search){var t=e.is(this.getOption("advSearchMgr"),"function")?this.getOption("advSearchMgr").call():null;if(e.is(t)){t.getAndDisplayAdvancedSearch(!1)}}this._updateAfterCollectionSync(),this._parent();var i=[],n=[];for(var s in this._columnsAttributes)e.is(this._columnsAttributes[s].defaultSort)&&"none"!==this._columnsAttributes[s].defaultSort&&(i.push(this._columnsAttributes[s].dataIndex),n.push(this._columnsAttributes[s].defaultSort));if(i.length>0){var o=this.collection._snSkeleton.getOption("observable");e.is(o)&&(this.collection.setGlobalOrder(i,n),o.sortPanelView.setOrderByExtExplicit({order_field:i,order_by:n,id:"multisort-group",className:"fonticon fonticon-list"}))}},_destroyView:function(){return e.is(this.view)&&e.is(this.view.destroy,"function")&&this.view.destroy(),this},destroy:function(){this._destroyView()._parent()}})}),define("DS/SNResultUX/views/utils/SearchGridScrollView",["UWA/Core","UWA/Class/Options","UWA/Class/Listener","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchCom","DS/SNResultUX/utils/SearchServices","DS/W3DXComponents/Views/Layout/GridScrollView","DS/WebappsUtils/Performance"],function(e,t,i,n,s,o,a,r){"use strict";return a.extend(t,i,{name:"search-grid_view",_searchcom_socket:null,init:function(t){this._parent(t),e.is(this._searchcom_socket)||(this._searchcom_socket=s.createSocket({socket_id:"search_skeleton_"+r.now()})),this._searchcom_socket.addListener("onSelectShift",this.onSelectShiftCallback.bind(this))},onSelectShiftCallback:function(e){n.log("DS/SNResultUX/views/utils/SearchGridScrollView onSelectShiftCallback");var t=-1,i=-1,s=this.collection.find(function(t){return t.get("id")===e[0].id});t=this.collection.indexOf(s);var a=this.collection.find(function(t){return t.get("id")===e[1].id}),r=null;(i=this.collection.indexOf(a))<t&&(r=i,i=t,t=r),-1===t||-1===i||o.isEqualPreviousSlice(t,i)||(o.setPreviousSlice(t,i),this.dispatchEvent("onItemViewCheck",[null,this.collection.slice(t+1,i)]),this.collection._snSkeleton&&(this.collection._snSkeleton._shiftTransaction=!1))}})}),define("DS/SNResultUX/views/helpers/SearchMapView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/utils/EmptyView","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o){"use strict";return e.extend({className:"SearchMapView",attributes:{styles:{width:"100%"},"data-rec-id":"SearchMapView",id:"SearchMapView"},bShowTooltip:!1,_searchGlobe:null,_divGlobe:null,_divLargeTile:null,_DockingElement:null,_collapser:null,_icon:null,init:function(e){this._searchGlobe=null,this._DockingElement=null,this._divGlobe=null,this._divLargeTile=null,this._collapser=null,this._icon=null,this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e){return e||this._rowMaxNumber},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),t.is(this._DockingElement)&&t.is(this._DockingElement.destroy,"function")&&(this._DockingElement.removeEventListener("collapse",this._collapse.bind(this)),this._DockingElement.removeEventListener("expand",this._expand.bind(this)),this._DockingElement.destroy()),t.is(this.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&(this.getSNResultMgt().getRefineHelpers().globeViewContainerContent.destroy(),this.getSNResultMgt().getRefineHelpers().globeViewContainerContent=null),this._parent()},_onPostCellRequest:function(e){var i=e.cellView;null!==(t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("contain")},render:function(){this.log("SearchMapView render");var e=this;let s="SearchMapView-Globe",o="SearchMapView-LargeTile";if(0===["iphone"].indexOf(n.getDeviceCategory())){s="SearchMapView-Globe-mobile",o="SearchMapView-LargeTile-mobile",e._divLargeTile=t.createElement("div",{class:o,id:o});let i=document.body.getDimensions();if(t.is(i)){let t=i.width;e._createDockingElement(t)}}else e._divLargeTile=t.createElement("div",{class:o,id:o}).inject(e.container);return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/SNResultUX/views/helpers/utils/GlobeView"],function(n,s){var o=e.getOptionCommon();o.height="inherit",o.useDragAndDrop=!0,o.displayedOptionalCellProperties=["contextualMenu","description"],e.view=new n(o),e.view.layout.gutter=10;var a=e._canMultiSelect;e.view.selectionBehavior.toggle=a,e.view.selectionBehavior.canMultiSelect=a,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=a,e.view.selectionBehavior.enableShiftSelection=a,e.view.selectionBehavior.enableFeedbackForActiveCell=a,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick(function(t){e.onItemDblClick(t.cellModel)}),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick(function(t){e.onItemTitleClick(t.cellModel)}),e.view.onContextualEvent=o.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll(function(t){e.onInfiniteScrollAsync(t,function(){e.view.infiniteScrollProcessDone()})}),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(t){e.onResizeOrFirstLoaded(t,function(){e.view.EndResizeOrOnReadyModelRequestDone()})}),e.view.getContent().inject(e._divLargeTile);var r={parentContainer:e.getSNResultMgt().getRefineHelpers().globeViewContainer,use2D:!1,collection:e.collection,globe:!i.getOption("SearchLeaflet")};e.getSNResultMgt().getRefineHelpers().getRefineHelpers().globeViewContainerContent=new s(r),e.getSNResultMgt().getRefineHelpers().getRefineHelpers().globeViewContainerContent.render(r),e._afterRender(),e.onSearch(),e.getSNResultMgt().getRefineHelpers().showGlobeView()}),this},showEmptyView:function(){if(!t.is(this._emptyView)){var e=this.getOption("itemViewOptions");this._emptyView=new s(e)}var i=t.extendElement(this.container.querySelector(".SearchMapView-LargeTile")),a=this._emptyView.render();if(t.is(a)&&t.is(i)){a.inject(i);let e=t.extendElement(this.container.querySelector(".wux-layout-largetilecollectionView"));if(t.is(e)&&e.setStyle("display","none"),this._emptyView.show(),t.is(a.container)&&t.is(a.container.getText,"function")){var r=a.container.getText();if(t.is(r)&&0===r.indexOf(n.constructEmptyViewMsg(o.get("no_result")))){t.is(this.collection)&&t.is(this.collection._snSkeleton)&&t.is(this.collection._snSkeleton._skeleton)&&t.is(this.collection._snSkeleton._skeleton.container)&&t.is(this.collection._snSkeleton._skeleton.container.getElement,"function")&&this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")}}}},hideEmptyView:function(){this._parent.apply(this,arguments);let e=t.extendElement(this.container.querySelector(".wux-layout-largetilecollectionView"));t.is(e)&&e.setStyle("display","inline-block")},onItemSelected:function(e){let i=this;if(i._parent.apply(this,arguments),t.is(i.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&t.is(i._divGlobe)&&"none"!==i._divGlobe.getStyle("display")){let n=e._options;if(t.is(n)){let e=n._attributes["ds6w:responsible"];t.is(e)&&i.getSNResultMgt().getRefineHelpers().globeViewContainerContent.displayCountryByUser(e)}}},_createDockingElement:function(e){var i=this;null===i._DockingElement?require(["DS/Windows/DockingElement"],function(e){let n=WUXDockAreaEnum.BottomDockArea,s=i._getHeightWidth(i.container,"height")-100,o=s;i._DockingElement=new e({side:n,dockingZoneSize:s,minSize:o,useBordersFlag:!0,collapsibleFlag:!0,visibleDockingZoneFlag:!0,resizableFlag:!1,dockingZoneContent:i._divLargeTile,freeZoneContent:i._divGlobe,collapseDockingZoneFlag:!0}),i._DockingElement.inject(i.container),i._DockingElement.addEventListener("collapse",i._collapse.bind(i)),i._DockingElement.addEventListener("expand",i._expand.bind(i)),i._collapser=i._DockingElement.elements.collapser,i._collapser.setAttribute("bottom","true");let a=t.createElement("div",{class:"globe-collapser-icon"});i._icon=t.createElement("span",{class:"fonticon fonticon-chevron-up"}),i._icon.inject(a),a.inject(i._collapser)}):(i._collapser&&i._collapser.setStyle("display","flex"),i._DockingElement.visibleDockingZoneFlag=!0)},_getHeightWidth:function(e,t){return e.getDimensions()[t]},_expand:function(e){t.is(this.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&this.getSNResultMgt().getRefineHelpers().globeViewContainerContent._updateUI(),this._icon&&(this._icon.removeClassName("fonticon fonticon-chevron-up"),this._icon.addClassName("fonticon fonticon-chevron-down "))},_collapse:function(e){t.is(this.getSNResultMgt().getRefineHelpers().globeViewContainerContent)&&this.getSNResultMgt().getRefineHelpers().globeViewContainerContent._updateUI(),this._icon&&(this._icon.removeClassName("fonticon fonticon-chevron-down"),this._icon.addClassName("fonticon fonticon-chevron-up "))}})}),define("DS/SNResultUX/utils/SearchMultiSort",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Events","UWA/Element","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchCustoServices","DS/Windows/Dialog","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";var f=t.extend(s,i,n,{_select:null,_divCombo:null,_selection:null,_sort:null,_data:[],_props:null,init:function(e){this._props=e,this._data=e.data,this._selection=e.value;for(var t=0;t<this._data.length;t++)this._data[t].selected=this._data[t].value===this._selection;return this._sort=e.order,this._parent(e)},getValue:function(){return this._selection},getOrder:function(){return this._sort},render:function(){this._divCombo=o.create("div",{class:"multisort-div sort"+this._props.index}),this._divCombo.inject(this._props.domReferer),this._renderSelect(this._divCombo)},_renderSelect:function(e){var t=this;this._select=new r({nativeSelect:!0,id:"search-multi-sort-combo-"+this._props.index,placeholder:_.get("searchMultiSel.comboPlaceHolder."+(0===this._props.index?"first":"next")),events:{onChange:function(){""===this.getValue()[0]?(t._selection=null,t._sort=null):t._selection=this.getValue()[0],t._renderSortButtons(t._selection,e),c.log("combo : "+t._selection)}}}),this._select.inject(e),this._select.add(this._props.data)},_renderSortButtons:function(e,t){var i=document.getElementById("SearchMultiSort-buttons"+this._props.index);i&&i.parentNode.removeChild(i);var n=o.create("div",{id:"SearchMultiSort-buttons"+this._props.index,class:"item-text item-icon-group sort"+this._props.index});n.inject(t),g.DEFAULT_FIELDS[e]?this["_renderSpan"+g.DEFAULT_FIELDS[e].toUpperCase()](n):this._renderSpanALPHA(n)},_renderSpanNUM:function(e){this._renderSpanCOMMON("num",e)},_renderSpanALPHA:function(e){this._renderSpanCOMMON("alpha",e)},_renderSpanCOMMON:function(e,t){var i=this;null===this._sort&&(this._sort="asc");var n=o.create("span",{title:"Ascending",order:"asc",class:"fonticon fonticon-sort-"+e+"-asc"+("asc"===this._sort?" "+g.SORT_ACTIVATED_CSS:"")}),s=o.create("span",{title:"Descending",order:"desc",class:"fonticon fonticon-sort-"+e+"-desc"+("desc"===this._sort?" "+g.SORT_ACTIVATED_CSS:"")});n.inject(t),s.inject(t),n.onclick=function(){i._sort="asc",n.classList.add(g.SORT_ACTIVATED_CSS),s.classList.remove(g.SORT_ACTIVATED_CSS)},s.onclick=function(){i._sort="desc",s.classList.add(g.SORT_ACTIVATED_CSS),n.classList.remove(g.SORT_ACTIVATED_CSS)}},_renderSpanGROUP:function(e){this._sort="asc",o.create("span",{title:"Grouping",order:"asc",class:"fonticon fonticon-tag-sorting "+g.SORT_ACTIVATED_CSS}).inject(e)},destroy:function(){e.is(this._select)&&this._select.destroy(),e.is(this._divCombo)&&e.is(this._divCombo.parentNode)&&this._divCombo.parentNode.removeChild(this._divCombo),this._parent()}});return t.extend(s,i,n,{_options:null,_dialog:null,_availableFields:{},_zIndexToUse:0,_divCombo:null,_divComboSelect:[],_divButton:[],_dataIndex:[],_order:[],getMaxMultiSortNb:function(){var t=h.getOption("search_datagrid");return e.is(t.multisort_standard_fields)?t.multisort_standard_fields:3},init:function(e){return c.groupCollapsed("SearchMultiSort"),c.log("options:",e),this._options=e,c.log(e._availableFields),this._availableFields=this._parseAvailableFields(e._availableFields),e._dataIndex&&(this._dataIndex=e._dataIndex),e._order&&(this._order=e._order),this._reinitDialog(),c.groupEnd(),this._parent(e)},_parseAvailableFields:function(e){for(var t=[],i=0;i<e.length;i++)t.push({label:d.getNLSValueForPredicate(e[i].dataIndex),selected:!1,value:e[i].dataIndex});return t},_reinitDialog:function(){this._destroyEmbeddedObjects(),this._buildDialog()},_buildDialog:function(){for(var t=this,i=o.create("div",{class:"global-multisort-div"}),n=this.getMaxMultiSortNb(),s=0;s<n;s++)this._divComboSelect.push(new f({index:s,data:this._availableFields,domReferer:i,value:this._dataIndex[s],order:this._order[s]})),this._divComboSelect[this._divComboSelect.length-1].render();this._dialog=new p({identifier:"search-multi-sort",title:_.get("searchMultiSel.dialog.title"),content:i,resizableFlag:!0,position:{at:"bottom",of:e.is(this._options._parentContainer)?this._options._parentContainer:null,collision:"fit",offsetX:-900,offsetY:200},minHeight:100,minWidth:550});var a=parseInt(e.is(this._options._parentContainer)?u.getZIndex(this._options._parentContainer):0)+1;(this._dialog.elements.container.setStyle("z-index",a),this._dialog.elements.container.addClassName("search-column-custo-dialog"),this._dialog.inject(document.body),e.is(this._dialog.elements)&&e.is(this._dialog.elements._closeButton))&&(new l({target:t._dialog.elements._closeButton,body:_.get("custo_close.tooltip")}).getContent().style.zIndex=this._zIndexToUse+2);this._buildDialogFooter(i),this._dialog.addEventListener("close",function(){t._dialog=null,t.dispatchEvent("onCloseMultisortPanel")})},_buildDialogFooter:function(t){var i=this,n=o.create("div",{class:"multisort-div footer"});n.inject(t),this._divButton[0]=new a({value:_.get("searchMultiSel.dialog.valid"),className:"primary save-button",id:"search_multisort_btn_valid",events:{onClick:function(){c.log("Click on OK multisort");for(var t=[],n=[],s=0;s<i._divComboSelect.length;s++)null!==i._divComboSelect[s].getValue()&&t.push(i._divComboSelect[s].getValue())&&n.push(i._divComboSelect[s].getOrder());c.log("Multisort params",t,n),e.is(i._options.sortCallback,"function")&&i._options.sortCallback(t,n),i.destroy()}}}).inject(n),this._divButton[1]=new a({value:_.get("searchMultiSel.dialog.cancel"),className:"primary apply-button",id:"search_multisort_btn_cancel",events:{onClick:function(){c.log("Click on cancel multisort"),i.destroy()}}}).inject(n)},_destroyEmbeddedObjects:function(){var t=0;for(t=0;t<this._divComboSelect.length;t++)this._divComboSelect[t].destroy();for(this._divComboSelect=[],t=0;t<this._divButton.length;t++)this._divButton[t].destroy();this._divButton=[],e.is(this._dialog)&&e.is(this._dialog.close,"function")&&(this._dialog.close(),this._dialog=null)},destroy:function(){this._destroyEmbeddedObjects(),this._sort=[],this._dataIndex=[],this._order=[],this._parent()}})}),define("DS/SNResultUX/views/helpers/SearchMyContentView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","UWA/Core","DS/SNInfraUX/Logger","DS/TreeModel/TreeDocument","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/ResultCategoryUXHelper","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";return e.extend({_loadViews:function(e){let u=this;require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView","DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView","DS/SNResultUX/views/WebUX/DataGrid/DataGridView"],function(p,_,f,m,v){let S=u.getOptionCommon();S.height="inherit",S.useDragAndDrop=!0,S.displayedOptionalCellProperties=["contextualMenu","description"];let w=u.collection.getSNSkeleton()&&u.collection.getSNSkeleton().getSearchWidget(),b=t.is(w)?w.body:t.extendElement(document.body).getElement(".onesearch_results");for(let w=e;w<u.collections.length;w++){let e=u.collections[w];try{let y={...S},I=new n({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}});u.collection.generateTreeModelAsync(e._models,I),y.model=I,y.collection=e,e.setTaggerProxy(u.collection.getTaggerProxy()),e._treeDocument=I;var C={};e.headTitle===h.get("myRecentContentTitle")&&"myContent"===u.id&&(C.isRecentContent=!0,C.accessRecentContent=function(e){l.dispatch("search:onSearch",{adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myRecentContent",search_mode:"index",tag_filter:""})}),C.onclick=(()=>{e.headTitle===h.get("myContentTitle")&&"myContent"===u.id&&(r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewMore",persDim:{pd1:"0"}}}),l.dispatch("search:onSearch",{adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myContent",search_mode:"index",tag_filter:"",allMyContent:!0}))}),a.createSearchMultiViewLabel(e,u.id,C).inject(u.multiViewContainer);let D="tile";void 0!==d.getItem("LastSearchViewMode")&&(D=d.getItem("LastSearchViewMode"));let T=t.is(D)?D:"tile",A={model:y.model,type:T,tag:w};if(-1!==e.totalCount){if(!t.is(C.isRecentContent)||!0!==C.isRecentContent)switch(D){case"thumbnail":y.displayedOptionalCellProperties=["contextualMenu"],A.view=u._instantiateResponsiveCollection(f,y,w),A.view.onPostCellRequest&&A.view.onPostCellRequest(e=>{let i=e.cellView;t.is(i)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("auto")});break;case"largeTile":case"tilebig":A.view=u._instantiateResponsiveCollection(_,y,w);case"textual":case"largeTextual":A.view=u._instantiateResponsiveCollection(p,y,w);break;case"tile":A.view=u._instantiateResponsiveCollection(m,y,w);break;case"list":case"table":case"datagrid":A.view=u._instantiateDataGrid(v,y,w,e);break;default:throw new Error("[MultiView] - incorrect view model given.")}A.view&&A.view.onReady(()=>{u.setPoolMultiViewContainerHeight(u.container.scrollHeight);let i=s.debounce(function(e){A.view.requestDelayedModelData(e)},1);A.view._updateDimensions(),A.view.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),A.view._onEndResizeOrOnReadyModelCompletionRequest("OnEndResize"),i("OnResize"),A.view._modelEvents.publish({event:"ENDRESIZE",context:A.view}),!0===c.getOption("search_compact_mode")&&A.view.onPostCellRequest&&A.view.onPostCellRequest(function(e){var i=null;i=e.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu"),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")),t.is(i)||(i=e.cellView.elements.container.querySelector(".wux-ui-3ds-open-down"))&&(i.style.display="none",i=void 0),t.is(i)&&i.setAttribute("has-menu","false")}),a.manageDisplayChannelView(e,D,b.getDimensions())}),u.views[w]=A,t.is(D)&&"list"!==D?u.views[w].view.getContent().inject(u.multiViewContainer):u.views[w].view.inject(u.multiViewContainer)}let x=g.get("search.result.view.more");x+=o.isMobile()?"":" "+e.headTitle;let N=t.createElement("div",{class:"search-multi-view-more",content:x});N.inject(u.multiViewContainer),N.onclick=(()=>{r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnViewMore",persDim:{pd1:"0"}}}),l.dispatch("search:onSearch",{adv_search:!1,recent_filter:"*",refresh:!0,search_criteria:"#myContent",search_mode:"index",tag_filter:"",allMyContent:!0})}),e.moreView={label:N,viewType:D},!1===a.ifDisplayViewMore(D,e,b.getDimensions())&&N.setStyle("visibility","hidden")}catch(e){c.getOption("debug")&&i.log(e)}}u.unmask(),u.dispatchEvent("onMultiView",{collections:u.collections})})},_onInitTreeDocumentAsyncCB:function(e){let n=this;if(!0===n._onGroupingCompute)return;n._emptyViews(),n._resetViews(),n._onGroupingCompute=!0,null!==this.collectionUX&&delete this.collectionUX,c.getOption("debug")&&i.log("MultiView tags retrieved",n.getSNResultMgt().getEmbeddedTaggerTags());let s=n._getEmbeddedTaggerTags(e);if(void 0!==s){if(t.is(e)&&(n._ComputeGroup=s.computeGroup,s.SearchBack&&1===s.SearchBack))return n.collection.getSNSkeleton().switchOnView(d.getItem("LastSearchViewMode")),n._refreshViewFromRefine(s),void(n._onGroupingCompute=!1);this.mask(),u.getResultCategoryUXHelper().then(function(){let e=n.collection.service_parameters.originalSearchCriteria;"Favorite Searches"===e&&(e="(owner:"+o.getUserId()+" AND flattenedtaxonomies:types/PLMWspFavoriteSearch) OR flattenedtaxonomies:types/SavedSearch");let a={"My Recent Content":"#myRecentContent","My Content":"#myContent"};"myRecentContentTitle"!=h.get("myRecentContentTitle")&&(a[h.get("myRecentContentTitle")]="#myRecentContent"),"myRealContentTitle"!=h.get("myRealContentTitle")&&(a[h.get("myRealContentTitle")]="#myContent"),"myContentTitle"!=h.get("myContentTitle")&&(a[h.get("myContentTitle")]="#myContent"),n.collectionUX=u.getResultsCollections({search_text:a,categories:s.Tags,refine:n.collection.getTaggerProxy().getCurrentFilter(),facets:n.collection.parsed_response.getTags().summaryData,noFetchWHENCountZero:"when"===n.getCurrentViewId()}),n.collectionUX.getFirstPage({onComplete:function(){let e=n.collectionUX.getCategoryCollectionsList();c.getOption("debug")&&i.log("run",e),n.collections=e,n._loadViews(0),n._onGroupingCompute=!1,n._totalCount=n.collection.totalCount,n.collection&&n.collection.getSNSkeleton().updateCounterView(n._totalCount),t.is(n.collection)&&t.is(n.collection.service_parameters)&&t.is(n.collection.service_parameters.query)&&"#myRecentContent"===n.collection.service_parameters.query&&n._clearTags()},onFailure:function(e){console.log("FAIL",e)}})})}},_clearTags:function(){this.collection.getTaggerProxy().clearLocalFilter(!1),this.collection.getTaggerProxy().unsetTags()},_computeDisplay:function(){let e=this,n=e.getViewId(),s=e.getCurrentViewId();if("myContent"===s&&t.is(this.getSNResultMgt())&&t.is(this.getSNResultMgt()._search_criteria)&&"#myContent"!==this.getSNResultMgt()._search_criteria&&this.getSNResultMgt().skeleton.switchOnView(d.getItem("LastSearchViewMode")),t.is(e.collection)&&t.is(e.collection.service_parameters)&&t.is(e.collection.service_parameters.query)&&"#myRecentContent"===e.collection.service_parameters.query&&e._clearTags(),!0===a.checkIfRefine(e.collection.getTaggerProxy(),e._getEmbeddedTaggerTags(),s,n))i.log("->MultiView Compute Display do from Refine"),e.collection.getSNSkeleton().switchOnView(d.getItem("LastSearchViewMode")),e._refreshViewFromRefine(e._getEmbeddedTaggerTags(e.getSNResultMgt().getEmbeddedTaggerTags())),e._totalCountSection=this.collection.totalCount,e._RefineFromDropMenu=!0;else{i.groupCollapsed("->MultiView Compute Display clear Refine"),i.log("->MultiView Compute Display all categories view: ",n);let t=e.getSNResultMgt()._getSearchType();("what"!==n&&"who"!==n&&"when"!==n&&"where"!==n||o.SearchTypeEnum.MY_CONTENT===t||o.SearchTypeEnum.FAVORITE_SEARCH===t)&&o.SearchTypeEnum.MY_CONTENT!==t&&o.SearchTypeEnum.FAVORITE_SEARCH!==t||e._refreshViewGrouping()}}})}),define("DS/SNResultUX/views/utils/SearchOptionsUI",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","UWA/Promise","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/Windows/ImmersiveFrame","DS/Windows/Dialog","DS/Controls/Tab","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ComboBox","DS/Controls/TooltipModel","DS/UIKIT/SuperModal","DS/SNInfraUX/SearchDataSources","DS/UIKIT/Accordion","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/SessionSecurityContextServices","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!DS/SNResultUX/SNResultUX.css"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b,C,y,I,D){"use strict";const T=function(e){return!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)};function A(e,i){let n=i;const s=function(i){t.is(e.contains,"function")&&!e.contains(i.target)&&i.target.className.indexOf("wux-layouts-treeview")<0&&i.target.className.indexOf("wux-windows-immersive-frame-no-pointerevents")<0&&i.target.className.indexOf("modal-wrap")<0&&i.target.className.indexOf("modal-content")<0&&i.target.className.indexOf("modal-header")<0&&i.target.className.indexOf("modal-body")<0&&i.target.className.indexOf("modal-footer")<0&&i.target.className.indexOf("WarningReloadPage modal modal-root")<0&&i.target.className.indexOf("btn-default btn btn-root")<0&&null!==i.target.parentNode&&i.target.parentNode.className.indexOf("modal-header")<0&&null!==i.target.parentNode&&i.target.parentNode.className.indexOf("modal-body")<0&&T(e)&&(e.style.display="none",document.removeEventListener("click",s),t.is(n)&&t.is(n.destroy,"function")&&(n.destroy(),n=null))};document.addEventListener("click",s)}const x=new Set(["search_tabbed_ui","integratedSearch","BETA-FUN109031"]);return i.extend(e,{name:"DS_SNResultUX_SearchOptionsUI",_informationPanel:null,CSVpromise:s.deferred(),_credentialComboBox:null,_revisionObject:null,_revisionTypeComboBox:null,_csvComboBox:null,_listofCSVModeItemsArray:[],_dateModeComboBox:null,_dateModeObject:null,_toggles:[],_textInputs:[],_optionPanel:null,_cChangeDone:!1,_mustReloaded:!1,_applySettings:null,init:function(e){r.groupCollapsed("SearchOptionsUI.init"),r.log("options:",e),this._parent(e),this.snSkeletonMgt=t.is(e)?e.skeletonMgt:null,t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getCollection,"function")&&(this.current_collection=this.snSkeletonMgt.getCollection()),this.tenant=t.is(e)?e.tenant:"OnPremise";let i=this._listUISettingsToDisplay();this._initPanel({settingsToDisplay:i}),r.groupEnd()},destroy:function(){r.groupCollapsed("SearchOptionsUI.destroy"),a.dispatch("SearchPopover:destroy"),this._deletePanel(),this._informationPanel=null,this._credentialComboBox=null,this._revisionTypeComboBox=null,this._csvComboBox=null,this._dateModeComboBox=null,this._toggles=null,this._textInputs=null,this._parent(),r.groupEnd()},_initPanel:function(e){let i=e.settingsToDisplay,s=this.tenant,o=this;if(!t.is(this.immersiveFrame)){this.immersiveFrame=new u({reactToPointerEventsFlag:!1});let e=document.body;this.immersiveFrame.inject(e)}let a=n.create("div",{class:"search-options-popover-container"});o._applySettings=new p({domId:"applySettings",label:I.get("APPLYButton"),onClick:function(){let e=new v({renderTo:document.body,className:"WarningReloadPage"});o._optionPanel.disabled=!0,e.confirm(I.get("actions.Options.warning"),I.get("actions.Options.warningTitle"),function(e){!0===e?o._validateSettings():o._optionPanel.disabled=!1})}}),this._createPanel(a,o._applySettings),this._tabContainer=new g({reorderFlag:!1,newTabButtonFlag:!1,pinFlag:!1,editableFlag:!1,multiSelFlag:!1,displayStyle:"strip"}),this._tabContainer.inject(a);let h=n.create("div",{class:"search-options-tab search-options-settings"}),f=!1;t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt._onesearch_collection._ctx_options)&&t.is(o.snSkeletonMgt._onesearch_collection._ctx_options.widget_id)&&"widget_id_#saved_search_edit#"===o.snSkeletonMgt._onesearch_collection._ctx_options.widget_id&&(f=!0),t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getOption("in_apps_search"),"object")&&(f=!0),f||this._tabContainer.add({label:I.get("actions.Options.generalTab"),content:h,isSelected:!0});let m={},b=c.getAdminSetting(s),y=",";t.is(b)&&t.is(b.defaultCsvSeparator)&&t.is(b.defaultCsvSeparator.id,"string")&&(y=c.getCSVSeparatorValueFromId(s,b.defaultCsvSeparator.id));let D=function(e){let i=e.dsModel,n=!1,s=0,a=o._toggles.length;for(s=0;s<a&&!1===n;s++)m[o._toggles[s].value]!==o._toggles[s].checkFlag&&(n=!0);if(!0===n||!0===o._cChangeDone?o._applySettings.disabled=!1:o._applySettings.disabled=!0,"search_tabbed_ui"===i.value){let e=o._toggles.filter(function(e){return e&&"nav_history"===e.value}).pop();if(e)return void(!0===i.checkFlag?e.disabled=!1:(e.disabled=!0,e.checkFlag=!1))}if("search_double_click_open"===i.value){let e=i.checkFlag;if(!0===l.getOption("search_web_in_win"))return void(window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("doubleclickopen",e))}!1===o._applySettings.disabled&&(o._mustReloaded=x.has(i.value))},T=l.getOption("deactivate_FUN108944"),N=t.is(l.getOption("addinmode"),"string")&&l.getOption("addinmode").length>0||!0===l.getOption("addinmode"),O=l.getOption("search_web_in_win");if(!0!==T&&!0!==N&&!0!==O){let e=function(e){let i=e.dsModel,n=!1,s=0,a=o._toggles.length;for(s=0;s<a&&!1===n;s++)m[o._toggles[s].value]!==o._toggles[s].checkFlag&&(n=!0);!0===n||!0===o._cChangeDone?o._applySettings.disabled=!1:o._applySettings.disabled=!0;let r=d.getItem("InstantSearch");r=!t.is(r)||r,i.checkFlag!==r&&(o._applySettings.disabled=!1),!1===o._applySettings.disabled&&(o._mustReloaded=x.has(i.value))},i=d.getItem("InstantSearch");i=!t.is(i)||i;let a=new _({type:"checkbox",value:"InstantSearch",domId:"betaMode",label:I.get("instantSearch.button"),checkFlag:!1});a.disabled=!0;let r="";t.is(s,"string")?r=s:t.is(s)&&t.is(s.tenantId)&&(r=s.tenantId),l.getTenantSettings(r).then(function(){!0===l.getOption("activate_instant_search",{tenant:r})&&(a.disabled=!1,a.checkFlag=i)});let c=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-betaMode","search-setting-id":"betaMode"}),u=n.create("div",{class:"search_center_div search-setting-title beta_toggle_setting",id:"betaMode"});a.inject(u),a.options={},u.inject(c),c.inject(h),this._toggles.push(a),a.addEventListener("buttonclick",e)}for(let e=0;e<=i.length;e++)if(t.is(i[e])&&t.is(i[e].optionID)&&t.is(i[e].optionLabel))if(m[i[e].optionID]=d.getItem(i[e].optionID),"boolean"!==i[e].optionType||t.is(i[e].father)){if("string"===i[e].optionType){let t=new Text({placeholder:i[e].optionLabel,class:i[e].optionID,id:i[e].optionID,events:{onKeyDown:function(){o._applySettings.disabled=!1}}}).inject(h);o._textInputs.push(t),t.setValue(m[i[e].optionID])}}else{let s=!0;if("integratedSearch"===i[e].optionID&&(s=!1),"BETA-FUN109031"!==i[e].optionID||!0!==O&&!0!==N&&!0!==this._isPinnedWidget()||(s=!1),"supportSynonyms"===i[e].optionID&&(s=!1),!0===s){let s=new _({type:"checkbox",value:i[e].optionID,domId:i[e].optionID,label:i[e].optionLabel,checkFlag:m[i[e].optionID]});t.is(i[e].disable)&&(s.disabled=i[e].disable);let a=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-"+i[e].optionID,"search-setting-id":i[e].optionID}),r=n.create("div",{class:"search_center_div search-setting-title",id:i[e].optionID});s.inject(r),r.inject(a),a.inject(h),o._toggles.push(s),s.addEventListener("buttonclick",D)}}let P=l.getOption("csvSeparatorArray");if(t.is(P)&&P.length>0){o._listofCSVModeItemsArray=[];for(let e=0;e<P.length;e++){let i=P[e];if(t.is(i,"object")&&t.is(i.id,"string")){let t={valueItem:P[e].value,labelItem:I.get("csvSeparatorUI.values."+i.id)};o._listofCSVModeItemsArray.push(t)}else r.error("Bad definition of csvSeparatorArray !!!",P)}o._listofCSVModeItemsArray.length>0&&(this._csvComboBox=o._buildComboOption(h,"csvSeparatorUI",o._listofCSVModeItemsArray,null))}o._dateModeObject=l.getOption("date_display_mode_array");let E,k=null;if(t.is(o._dateModeObject)&&o._dateModeObject.length>0){let e=[];for(let i=0;i<o._dateModeObject.length;i++){let n=o._dateModeObject[i];t.is(n,"object")&&t.is(n.id,"string")?e.push(I.get(n.id+".title")):r.error("Bad definition of date_display_mode_array !!!",o._dateModeObject)}e.length>0&&(this._dateModeComboBox=o._buildComboOption(h,"Default_Date_Mode",e,null),k=e[0])}c.isRoleAvailable(["CSV"],s,function(e){if(!0===e&&(o._revisionObject=l.getOption("show_search_results_revision_array"),t.is(o._revisionObject)&&o._revisionObject.length>0)){let e=[];for(let i=0;i<o._revisionObject.length;i++){let n=o._revisionObject[i];t.is(n,"object")&&t.is(n.id,"string")?e.push(I.get(n.id+".title")):r.error("Bad definition of show_search_results_revision_array !!!",o._revisionObject)}if(e.length>0){let i=d.getItem("revisionDisplayType"),n=l.getOption("defaultRevision",{tenant:s});t.is(i)||(i=n||e[0]),o._revisionTypeComboBox=o._buildComboOption(h,"Show_Search_Results",e,I.get(i.id+".title"))}}}),t.is(this.snSkeletonMgt)&&(E=this.snSkeletonMgt.getOption("addinMode"));let M=c.identifyClientInfo(E);t.is(this.snSkeletonMgt)&&(M=c.identifyClientInfo(o.snSkeletonMgt.getOption("addinMode")));let R,V,U,L=!1;if(t.is(M)&&t.is(M.identifier)&&("3DDashboard"===M.identifier||"3DSwym"===M.identifier)&&(L=!0),t.is(M)&&t.is(M.addinmode)&&"catiav5"===M.addinmode&&(L=!0),l.getOption("global_action_credentials")&&!0===L&&(this.divOptions=h,C.getSecurityContext3DSpace(c.getActiveTenant()).then(function(e){o._SecurityContextMngt(e)})),t.is(this.current_collection)&&t.is(this.current_collection.getSearchRessources())&&t.is(this.current_collection.getSearchRessources().getActiveTenant())?(U=this.current_collection.getSearchRessources().getActiveTenant(),R=l.getOption("dataSourcesForRoles",{tenant:U}),V=l.getOption("dataSourcesFile",{tenant:U})):(R=l.getOption("dataSourcesForRoles",{tenant:this.tenant}),V=l.getOption("dataSourcesFile",{tenant:this.tenant})),!0===R||!0===V){let e=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-dataSourcesToSearch","search-setting-id":"dataSourcesToSearch"}).inject(h),i=n.create("div",{class:"search_center_div_left search_center_general_display_flex search-setting-title",id:"dataSourcesToSearch"}).inject(e);n.create("div",{class:"search_center_div_right search-setting-value",id:"general-tab-dataSourcesToSearch-combo"}).inject(e);n.create("p",{class:"search_center_text",text:I.get(I.get("dataSourcesToSearch"))}).inject(i);let s=n.create("div",{class:"search_center_div_left search_center_general_display_data_source_toggle search_center_source_toggle",id:"general-tab-resultsdisplay-text-data-source-toggle"}).inject(h),a=n.create("div",{class:"search_center_div_left search_center_general_display_data_source_toggle_others search_center_source_toggle_others",id:"general-tab-resultsdisplay-text-data-source-toggle-others"}).inject(h);document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-others").style.display="none";let r=new w({className:"divided",items:[],exclusive:!1});r.inject(a);let u=n.create("div",{class:"search_center_div_left search_center_general_display_data_source_toggle_plus search_center_source_toggle_plus",id:"general-tab-resultsdisplay-text-data-source-toggle-plus"}).inject(h);document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-plus").style.display="none";let g=[];c.getGrantedRoles(function(e){for(let t=0;t<e.length;t++){let i=S.getOption(e[t].id);i&&(g=g.concat(i))}}),g=g.filter((e,t,i)=>i.indexOf(e)===t);let p=c.getActiveDataSource();g=g.filter(function(e){return-1===p.indexOf(e)});let f=!1,v=c.getActiveDataSource(),b=function(){if(!1===f){f=!0,v=c.getActiveDataSource();let i=[];for(let e=0;e<=v.length-1;e++){let t={optionDefaultValue:!0,optionID:"dataSource-"+v[e],optionLabel:"adv_search.source."+v[e]!==I.get("adv_search.source."+v[e])?I.get("adv_search.source."+v[e]):v[e],optionTooltip:"adv_search.source."+v[e]!==I.get("adv_search.source."+v[e])?I.get("adv_search.source."+v[e]):v[e],optionType:"boolean"};i[e]=t}for(let e=0;e<=g.length-1;e++){let t={optionDefaultValue:!1,optionID:"dataSource-"+g[e],optionLabel:"adv_search.source."+g[e]!==I.get("adv_search.source."+g[e])?I.get("adv_search.source."+g[e]):g[e],optionTooltip:"adv_search.source."+g[e]!==I.get("adv_search.source."+g[e])?I.get("adv_search.source."+g[e]):g[e],optionType:"boolean"};i[e+v.length]=t}let a=[],h=!1,p=!1;for(let e=0;e<=i.length;e++)t.is(i[e])&&t.is(i[e].optionID)&&t.is(i[e].optionLabel)&&(m[i[e].optionID]=d.getItem(i[e].optionID),!0===m[i[e].optionID]&&(h=!0),void 0===m[i[e].optionID]&&(p=!0));r.addItem({title:I.get("otherSources")}),r.addEvent("onOpen",o._OnAccordionOpen.bind(o)),r.addEvent("onClose",o._OnAccordionClose.bind(o));for(let r=0;r<=i.length;r++)if(t.is(i[r])&&t.is(i[r].optionID)&&t.is(i[r].optionLabel))if(m[i[r].optionID]=d.getItem(i[r].optionID),"boolean"!==i[r].optionType||t.is(i[r].father)){if("string"===i[r].optionType){let t=new Text({placeholder:i[r].optionLabel,class:i[r].optionID,id:i[r].optionID,events:{onKeyDown:function(){o._applySettings.disabled=!1}}}).inject(e);o._textInputs.push(t),t.setValue(m[i[r].optionID])}}else{let e=i[r].optionLabel;!0===m[i[r].optionID]?a=a.concat(i[r].optionID.substring("dataSource-".length)):void 0===m[i[r].optionID]&&!0===h&&!0===p&&(e=e.concat(I.get("newSource")));let c=new _({type:"checkbox",value:i[r].optionID,domId:i[r].optionID,label:e,checkFlag:t.is(m[i[r].optionID])?m[i[r].optionID]:i[r].optionDefaultValue});t.is(i[r].disable)&&(c.disabled=i[r].disable),"integratedSearch"===i[r].optionID&&c.hide(),null!==l.getOption("addinmode")&&"search_tabbed_ui"===i[r].optionID&&c.hide();let d=n.create("div",{class:"search_center_div_left"});c.inject(d),["swym","3dspace","drive"].includes(i[r].optionID.substring("dataSource-".length))?d.inject(s):(d.inject(u),document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-others").style.display="block"),o._toggles.push(c),c.addEventListener("buttonclick",D)}c.setChosenDataSource(a)}};v.length>0&&!1===f&&b.call(),c.getActiveDataSourcePromise().then(function(){0!==(v=c.getActiveDataSource()).length&&b.call()})}let F=c.getActiveTenant();d.getItemPromise("optionMode",F).then(function(e){t.is(e)&&(t.is(o._dateModeComboBox)&&(o._dateModeComboBox.currentValue=t.is(e.dateDisplayMode)?I.get(e.dateDisplayMode.id+".title"):k),t.is(o._csvComboBox)&&(o._csvComboBox.currentValue=t.is(e.csvMode)?e.csvMode.valueItem:l.getOption("csvSeparator")))}),A(o._optionPanel.elements.container,this)},_SecurityContextMngt:function(e){let i=this,n=[];if(t.is(e,"array")&&e.forEach(function(e){let i=e.displayName;t.is(e.isDefault)&&!0===e.isDefault?n.unshift(i):n.push(i)}),!0===i._isSecurityContextChosenAfterError&&n.splice(0,0,I.get("select_security_context")),n.length>0){let e,s,o=d.getItem("revisionDisplayType"),a=l.getOption("defaultRevision",{tenant:i.tenant});t.is(o)||(o=a||n[0]),e=t.is(i.snSkeletonMgt)&&t.is(i.snSkeletonMgt.getSearchWidget,"function")&&t.is(i.snSkeletonMgt.getSearchWidget())&&t.is(i.snSkeletonMgt.getSearchWidget().setValue,"function")&&!0===i._isPinnedWidget()?i.snSkeletonMgt.getSearchWidget().getValue("securityContext"):d.getItem("securityContext"+i.tenant),t.is(e)&&(s=JSON.parse(e));let r=t.is(s)&&t.is(s.displayName)?s.displayName:"";i._credentialComboBox=i._buildComboOption(i.divOptions,"Show_3DSpace_Credentials",n,r),i._credentialComboBox.tooltipInfos=new m({shortHelp:r})}},_OnAccordionOpen:function(){document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-plus").style.display="block"},_OnAccordionClose:function(){document.getElementById("general-tab-resultsdisplay-text-data-source-toggle-plus").style.display="none"},_listUISettingsToDisplay:function(){r.groupCollapsed("SearchOptionsUI._listUISettingsToDisplay");let e,i=this,n=[],s=l.getSettingsToDisplayInUI(),o=!1,a=this._isPinnedWidget(),d={};t.is(i.snSkeletonMgt)&&(o=t.is(i.snSkeletonMgt.getOption("in_apps_search"),"object"),t.is(i.snSkeletonMgt.getSearchWidget,"function")&&t.is(i.snSkeletonMgt.getSearchWidget())&&(e=i.snSkeletonMgt.getSearchWidget().getValue("launch_mode")),d={addinMode:i.snSkeletonMgt.getOption("addinMode"),inContextSearch:t.is(i.snSkeletonMgt.getOption("in_apps_search"),"object"),isPinnedWidget:a});let u=l.getOption("integratedSearch"),h=null,g=c.identifyClientInfo(d.addinMode);t.is(g,"object")&&(h=g.identifier);let p=function(i){var n=l.getOption("search_web_in_win");let s=!0;switch(i){case"search_tabbed_ui":switch(h){case"3DSpace":s=!1;break;case"3DDashboard":a&&e!==c.widgetLaunchMode.COMPASS_TRANSIENT&&e!==c.widgetLaunchMode.COMPASS_PINNED&&(s=!1);break;case"3DEXPERIENCE":o&&(s=!1)}"catiav5"===l.getOption("addinmode")&&!0===l.getOption("lockedapp")&&(s=!1);break;case"integratedSearch":switch(t.is(u)&&!1===u?s=!1:e!==c.widgetLaunchMode.COMPASS_TRANSIENT&&e!==c.widgetLaunchMode.COMPASS_PINNED||(s=!1),h){case"3DSpace":s=!1;break;case"3DDashboard":a&&(s=!1);break;case"3DSwym":case"3DEXPERIENCE":s=!1}break;case"search_date_region":s=!1,!0===l.getOption("activate_search_date_region")&&(s=!0);break;case"csvSeparatorUI":s=!0;break;case"search_double_click_open":s=!!n}return s};for(let e=0;e<=s.length;e++)t.is(s[e])&&t.is(s[e].optionID)&&t.is(s[e].optionLabel)&&p(s[e].optionID)&&n.push(s[e]);return r.groupEnd(),n},addTab:function(e){if(r.groupCollapsed("SearchOptionsUI.addTab"),r.log("iOptions:",e),!t.is(this._tabContainer))throw new Error("SearchOptionsUI.addTab called but no tab container!");if(!t.is(e))throw new Error("SearchOptionsUI.addTab called but no argument provided!");this._tabContainer.add(e),r.groupEnd()},value:function(e){if(r.groupCollapsed("SearchOptionsUI.value"),r.log("iValue:",e),!t.is(this._tabContainer))throw new Error("SearchOptionsUI.value called but no tab container!");if(!t.is(e))throw new Error("SearchOptionsUI.value called but no argument provided!");this._tabContainer.value=[e],r.groupEnd()},_refreshResults:function(){if(t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getSearchActions,"function")){let e=this.snSkeletonMgt.getSearchActions();t.is(e)&&t.is(e.dispatchEvent,"function")&&e.dispatchEvent("onRefreshResultRequest")}else this._reloadPage()},_reloadPage:function(){t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getOption,"function")&&o.publish({channel:this.snSkeletonMgt.getOption("widgetId"),topic:"beforeSearchReload",data:{}}),location.reload(!0)},_createPanel:function(e,t){let i=this,n={my:"top right",at:"top right",of:this.immersiveFrame,offsetX:-300,offsetY:150};t.disabled=!0,this._optionPanel=new h({immersiveFrame:this.immersiveFrame,title:I.get("custo_chooser_panel_title"),identifier:"search-options-popover",position:n,content:e,minWidth:260,minHeight:250,resizableFlag:!0,buttons:{Apply:t},autoCloseFlag:!0}),this._optionPanel.elements.container.addClassName("search-options-popover"),"3DDashboard"===c.identifyClientInfo().identifier?this.immersiveFrame.elements.container.setStyle("z-index",100):"3DSpace"===c.identifyClientInfo().identifier&&this.immersiveFrame.elements.container.setStyle("z-index",4e3),this._optionPanel.elements.container.setStyle("z-index",4e3),this._optionPanel.addEventListener("close",function(e){e.stopPropagation(),i.destroy()})},_deletePanel:function(){t.is(this._optionPanel)&&t.is(this._optionPanel.destroy,"function")&&(t.is(this._optionPanel.immersiveFrame)&&t.is(this._optionPanel.immersiveFrame.destroy,"function")&&this._optionPanel.immersiveFrame.destroy(),this._optionPanel.destroy(),this._optionPanel=null)},_isPinnedWidget:function(){let e,i=!1;t.is(this.snSkeletonMgt)&&(e=this.snSkeletonMgt.getOption("addinMode"));let n=c.identifyClientInfo(e);return t.is(this.snSkeletonMgt)&&(n=c.identifyClientInfo(this.snSkeletonMgt.getOption("addinMode"))),t.is(this.snSkeletonMgt)&&t.is(this.snSkeletonMgt.getOption,"function")&&"3DSwym"!==n.identifier&&(i="true"!==this.snSkeletonMgt.getOption("transient_context")&&!0!==this.snSkeletonMgt.getOption("transient_context")),i},_buildComboOption:function(e,t,i,s){let o=this,a=null;if(i.length>0){let r=n.create("div",{class:"search_center_general_tab_div search_center_margin",id:"general-tab-"+t,"search-setting-id":t}).inject(e),l=n.create("div",{class:"search_center_div_left search_center_general_display_flex search-setting-title",id:t}).inject(r),c=n.create("div",{class:"search_center_div_right search-setting-value",id:"general-tab-"+t+"-combo"}).inject(r);n.create("p",{class:"search_center_text",text:I.get(t)}).inject(l),a=new f({elementsList:i,nbDisplayedElements:i.length,currentValue:s,enableSearchFlag:!1}).inject(c),c.setStyle("display","grid"),a.addEventListener("change",function(){o._cChangeDone=!0,o._applySettings.disabled=!1})}return a},_validateSettings:function(){let e=this,i=s.deferred(),n=!0,a=s.deferred();c.resetDataSourceHasChanged();for(let i=0;i<=e._toggles.length;i++){let s=e._toggles[i];t.is(s)&&t.is(s.options)&&d.setItem(s.value,s.checkFlag),t.is(s)&&t.is(s.options)&&t.equals(s.value,"InstantSearch")&&o.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"searchBetaUnique",persDim:{pd1:s.checkFlag?"enabled":"disabled"}}}),t.is(s)&&t.is(s.value)&&s.value.startsWith("dataSource-")&&(r.log("aToggle.value: "+s.value),!0===s.checkFlag?(c.addChosenDataSource(s.value.substr("dataSource-".length)),n=!0):(c.suppressChosenDataSource(s.value.substr("dataSource-".length)),n=!1))}!1===n&&b._displayAlert({message:I.get("No_data_source"),className:"success"}),c.dataSourceChangeCompleted();for(let i=0;i<e._textInputs.length;i++){let n=e._textInputs[i];t.is(n)&&t.is(n.options)&&d.setItem(n.getId(),n.getValue())}if(t.is(e._revisionTypeComboBox)){let i=e._revisionTypeComboBox.currentValue;if(t.is(i))for(let t=0;t<e._revisionObject.length;t++){let n=e._revisionObject[t];if(i===I.get(n.id+".title")){i=n,d.setItem("revisionDisplayType",i);break}}}d.commit();let u,h={},g=null,p=t.is(e._csvComboBox)?e._csvComboBox.currentValue:I.get("COMMA.title");if(t.is(p))for(let t=0;t<e._listofCSVModeItemsArray.length;t++)p===(g=e._listofCSVModeItemsArray[t]).valueItem&&(h.csvMode=g);if(l.getOption("search_web_in_win")&&t.is(e.snSkeletonMgt)&&t.is(e.snSkeletonMgt.getCollection())&&t.is(e.snSkeletonMgt.getCollection().getTaggerProxy())&&(e.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalFilter(),e.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalGrouping&&e.snSkeletonMgt.getCollection().getTaggerProxy().clearLocalGrouping()),t.is(e._dateModeComboBox)){let i=e._dateModeComboBox.currentValue;if(t.is(i)){let t=null;for(let n=0;n<e._dateModeObject.length;n++)t=e._dateModeObject[n],i===I.get(t.id+".title")&&(h.dateDisplayMode=t)}}if(t.is(e._credentialComboBox)){let i=e._credentialComboBox.currentValue;if(t.is(i)){let n=[],s=[];s=c.getSecurityContext3DSpace(),t.is(s,"array")&&s.forEach(function(e){let i=e.displayName;t.is(e.isDefault)&&!0===e.isDefault?n.unshift(i):n.push(i)}),n.sort(),!0===e._isSecurityContextChosenAfterError&&n.splice(0,0,I.get("select_security_context"));let o=null;for(let n=0;n<s.length;n++)if(i===(o=s[n]).displayName){if(c.setSecurityContext(o.name),e._isSecurityContextChosenAfterError=!1,t.is(e.current_collection)&&t.is(e.current_collection.getSearchRessources,"function")){e.current_collection.getSearchRessources().setSecurityContext(o.name),t.is(e.snSkeletonMgt)&&t.is(e.snSkeletonMgt.getSearchWidget,"function")&&t.is(e.snSkeletonMgt.getSearchWidget())&&t.is(e.snSkeletonMgt.getSearchWidget().setValue,"function")&&!0===e._isPinnedWidget()?e.snSkeletonMgt.getSearchWidget().setValue("securityContext",JSON.stringify(o)):d.setItem("securityContext"+this.tenant,JSON.stringify(o));break}d.setItem("securityContext"+this.tenant,JSON.stringify(o));break}}}!0===(u=t.is(this.current_collection)?l.getOption("dataSourcesForRoles",{tenant:this.current_collection.getSearchRessources().getActiveTenant()}):l.getOption("dataSourcesForRoles"))&&d.setItem("dataSource",c.getChosenDataSource()),d.commit(),a.resolve(!0);try{d.setPreference({name:"optionMode",value:JSON.stringify(h),tenantId:c.getActiveTenant(),onComplete:function(){r.log("data is saved successfully"),i.resolve(!0)},onFailure:function(e){r.error("Failure, Unable to save preferences :",e),i.resolve(!1)}})}catch(e){r.error("Error calling SearchPreferences:",e),i.resolve(!1)}Promise.all([i.promise,a.promise]).then(()=>{!0===e._mustReloaded?e._reloadPage():(e._refreshResults(),e.destroy())})}})}),define("DS/SNResultUX/views/helpers/SearchRespLargeTileGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings"],function(e,t,i){"use strict";return e.extend({className:"RespLargeTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespLargeTileGridView"},bShowTooltip:!1,init:function(e){this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e){return e||this._rowMaxNumber},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},render:function(){this.log("RespLargeTileGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTilesCollectionView"],function(i){var n=e.getOptionCommon();n.height="inherit",n.useDragAndDrop=!0,n.displayedOptionalCellProperties=["contextualMenu","description"],e.view=new i(n);var s=e._canMultiSelect;e.view.selectionBehavior.canMultiSelect=s,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=s,e.view.selectionBehavior.enableShiftSelection=s,e.view.selectionBehavior.enableFeedbackForActiveCell=s,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick(function(t){e.onItemDblClick(t.cellModel)}),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick(function(t){e.onItemTitleClick(t.cellModel)}),e.view.onContextualEvent=n.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll(function(t){e.onInfiniteScrollAsync(t,function(){e.view.infiniteScrollProcessDone()})}),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(t){e.onResizeOrFirstLoaded(t,function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()})}),e._afterRender(),e.onSearch()}),this}})}),define("DS/SNResultUX/views/helpers/SearchRespTextualTileGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,n){"use strict";return e.extend({className:"RespTextualTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespTextualTileGridView"},bShowTooltip:!1,init:function(e){this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e){return e||this._rowMaxNumber},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_onPostCellRequest:function(e){var i=e.cellView;null!==(t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("contain")},render:function(){this.log("RespTextualTileGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveLargeTextualTilesCollectionView"],function(i){var s=e.getOptionCommon();s.height="inherit",s.useDragAndDrop=!0,s.displayedOptionalCellProperties=["contextualMenu","description"],e.view=new i(s),e.view.layout.gutter=n.isFUN109031Active()?10:0;var o=e._canMultiSelect;e.view.selectionBehavior.toggle=o,e.view.selectionBehavior.canMultiSelect=o,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=o,e.view.selectionBehavior.enableShiftSelection=o,e.view.selectionBehavior.enableFeedbackForActiveCell=o,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick(function(t){e.onItemDblClick(t.cellModel)}),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick(function(t){e.onItemTitleClick(t.cellModel)}),e.view.onContextualEvent=s.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll(function(t){e.onInfiniteScrollAsync(t,function(){e.view.infiniteScrollProcessDone()})}),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(t){e.onResizeOrFirstLoaded(t,function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()})}),e._afterRender(),e.onSearch()}),this}})}),define("DS/SNResultUX/views/helpers/SearchRespThumbnailGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/ImageHelper"],function(e,t,i,n){"use strict";return e.extend({className:"RespThumbnailGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespThumbnailGridView"},bShowTooltip:!1,_bigPicList:[],_picCheckedList:[],_imageHelpers:null,init:function(e){this._imageHelpers=[],this._bigPicList=[],this._picCheckedList=[],this._parent(e),this.bShowTooltip=!!t.is(i.getOption("showTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e,t){return(e=e||this._rowMaxNumber)*(t=t||this._columnsMaxNumber)},setup:function(e){this._parent(e);var t=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){t._imageHelpers&&t._imageHelpers.forEach(function(e){e.destroy()}),t._imageHelpers=[],t._bigPicList=[],t._picCheckedList=[]},onSync:function(){}})},destroy:function(){this._imageHelpers.forEach(function(e){e.destroy()}),this._imageHelpers=null,t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_updatePictureBackgroundSizeOnCell:function(e,i){t.is(e)&&t.is(e.contentView)&&t.is(e.contentView.setPictureBackgroundSize,"function")&&e.contentView.setPictureBackgroundSize(i)},setAsBigPicture:function(e){this._bigPicList.push(e)},_onPostCellRequest:function(e){var i=e.cellView,s=t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null;if(null!==s)if(-1!==this._bigPicList.indexOf(s)?this._updatePictureBackgroundSizeOnCell(i,"contain"):this._updatePictureBackgroundSizeOnCell(i,"auto"),-1===this._picCheckedList.indexOf(s))this._imageHelpers.push(new n(e,this)),this._picCheckedList.push(s);else{var o=this._imageHelpers[s];t.is(o)&&(o._cellInfos=e)}},render:function(){this.log("RespThumbnailGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveThumbnailsCollectionView"],function(i){var n=e.getOptionCommon();n.height="inherit",n.useDragAndDrop=!0,n.displayedOptionalCellProperties=["contextualMenu"],e.view=new i(n);var s=e._canMultiSelect;e.view.selectionBehavior.toggle=s,e.view.selectionBehavior.canMultiSelect=s,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=s,e.view.selectionBehavior.enableShiftSelection=s,e.view.selectionBehavior.enableFeedbackForActiveCell=s,e.view.onCellDoubleClick(function(t){e.onItemDblClick(t.cellModel)}),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick(function(t){e.onItemTitleClick(t.cellModel)}),e.view.onContextualEvent=n.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll(function(t){e.onInfiniteScrollAsync(t,function(){e.view.infiniteScrollProcessDone()})}),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(t){e.onResizeOrFirstLoaded(t,function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()})}),e._afterRender(),e.onSearch()}),this}})}),define("DS/SNResultUX/views/helpers/SearchRespTileGridView",["DS/SNResultUX/views/helpers/Abstract","UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils"],function(e,t,i,n,s){"use strict";return e.extend({className:"RespTileGridView",attributes:{styles:{width:"100%"},"data-rec-id":"RespTileGridView"},bShowTooltip:!1,init:function(e){this._parent(e),this.bShowTooltip=!!t.is(i.getOption("webUXTooltip"))&&i.getOption("showTooltip"),this.neverCheckbox=!!t.is(i.getOption("neverCheckbox"))&&i.getOption("neverCheckbox"),this.neverAction=!!t.is(i.getOption("neverAction"))&&i.getOption("neverAction")},onSearch:function(e){this._parent(e)},getMinNumberModel:function(e,t){return(e=e||this._rowMaxNumber)*(t=t||this._columnsMaxNumber)},setup:function(e){this._parent(e),this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){},onSync:function(){}})},destroy:function(){t.is(this.view)&&t.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_onPostCellRequest:function(e){var i=e.cellView;null!==(t.is(e.virtualCellID)?e.virtualCellID:t.is(e.cellID)?e.cellID:null)&&t.is(i.contentView)&&t.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("79px")},render:function(){this.log("RespTileGridView render");var e=this;return require(["DS/SNResultUX/views/WebUX/CollectionView/ResponsiveTilesCollectionView"],function(n){var o=e.getOptionCommon();o.height="inherit",o.useDragAndDrop=!0,o.displayedOptionalCellProperties=["contextualMenu","description"],e.view=new n(o);let a=!0===s.isFUN109031Active()||e.getSNResultMgt()._isInAppsSearch()?800:670;e.view.layout.columnMaxWidth=i.getOption("maxTileWidth")?i.getOption("maxTileWidth"):a,e.view.allowLargeItems=!0;var r=e._canMultiSelect;e.view.selectionBehavior.canMultiSelect=r,e.view.selectionBehavior.canInteractiveMultiselectWithCheckboxClick=r,e.view.selectionBehavior.enableShiftSelection=r,e.view.selectionBehavior.enableFeedbackForActiveCell=r,!0===e.neverCheckbox&&(e.view.visibilityFlag=!1),e.view.onCellDoubleClick(function(t){e.onItemDblClick(t.cellModel)}),t.is(e._simpleSearch)&&!0===e._simpleSearch&&t.is(e.view.onCellTitleClick,"function")&&e.view.onCellTitleClick(function(t){e.onItemTitleClick(t.cellModel)}),e.view.onContextualEvent=o.onContextualEvent,e.view.displayTitleTooltip=e.bShowTooltip,e.view.getContent().inject(e.container),e._model.search_multiselMode&&e.toggleMultiSelMode(!0),e.view.onInfiniteScroll(function(t){e.onInfiniteScrollAsync(t,function(){e.view.infiniteScrollProcessDone()})}),e.view.onEndResizeOrOnReadyModelRequest&&e.view.onEndResizeOrOnReadyModelRequest(function(t){e.onResizeOrFirstLoaded(t,function(){e.setViewMargins(),e.view.EndResizeOrOnReadyModelRequestDone()})}),e._afterRender(),e.onSearch()}),this}})}),define("DS/SNResultUX/utils/SearchServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/UIKIT/Alert","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c){"use strict";return t.singleton(n,i,{name:"DS_SNResultUX_utils_SearchServices",attributeToFilterForExport:["id","type_icon_url","preview_url","actions","resourceid","resourceid_tagger","actions"],globalActions:["exportToCmd","print","save_search","refresh_search","kpi_pcs_action","Grid_Custo"],current_collection:null,odtMode:!1,informationPanel:void 0,previewPanel:void 0,no_result:!1,_previousSlice:{start:-1,end:-1},_skeletonAlert:null,init:function(){this.setDebugMode(o.getDebugMode())},setPreviousSlice:function(e,t){this._previousSlice.start=e,this._previousSlice.end=t},resetPreviousSlice:function(){this._previousSlice.start=-1,this._previousSlice.end=-1},isEqualPreviousSlice:function(e,t){return this._previousSlice.start===e&&this._previousSlice.end===t},getinformationPanel:function(){void 0===this.informationPanel&&(this.informationPanel=o.getOption("informationsPanel"),!1===this.informationPanel&&"3DSwym"===a.identifyClientInfo().identifier&&(this.informationPanel=!0));return this.informationPanel},getpreviewPanel:function(t){var i=this;return void 0===i.previewPanel&&(i.previewPanel=o.getOption("previewPanel")),e.is(t)&&e.is(t.widgetId)&&e.is(e.Widgets)&&e.is(e.Widgets.instances)&&(i.previewPanel=!0,e.Widgets.instances.forEach(function(n){if(n.id===t.widgetId){var s=n.getValue("addinmode");e.is(s)&&"catiav5"===s&&(i.previewPanel=!0)}})),i.previewPanel},setODTMode:function(e){this.odtMode=e},_displayAlert:function(t){let i=this;if(!e.is(t)||!e.is(t.message))throw new Error("E_INVALIDARG: bad options given to _displayAlert method !");var n=e.extendElement(document.body).getElement(".onesearch_results");e.is(t.widgetId)&&e.is(e.Widgets)&&e.is(e.Widgets.instances)?e.Widgets.instances.forEach(function(i){i.id===t.widgetId&&(n=e.extendElement(i.elements.body).getElement(".onesearch_results"))}):e.is(n)||(n=e.extendElement(document.body).getElement(".main"));var s=t.message,o="primary";e.is(t.className,"string")&&(o=t.className),e.is(n)||(n=e.extendElement(document.body).getElement(".onesearch_results"));var a={visible:!0,autoHide:!0,hideDelay:t.delay?t.delay:8e3,closable:!0,messages:[{message:s,className:o}],attributes:{id:"search-alert"},events:{onRemoveMessage:()=>{i.skeleton?i.skeleton._alert&&i.skeleton._alert.elements&&i.skeleton._alert.elements.container&&i.skeleton._alert.elements.container.destroy()&&(i.skeleton._alert=null):i.oAlert&&i.oAlert.elements&&i.oAlert.elements.container&&i.oAlert.elements.container.destroy()&&(i.oAlert=null)}}};e.is(t.events)&&(a.events=t.events),e.is(this.skeleton)?(this.skeleton._alert&&(this.skeleton._alert.destroy(),this.skeleton._alert=null),this.skeleton._alert=new r(a).inject(n,"top")):(this.oAlert&&(this.oAlert.destroy(),this.oAlert=null),sessionStorage.getItem("isODTMode-IR-993129")?new r(a).inject(n,"top"):this.oAlert=new r(a).inject(n,"top"))},setDragData:function(t,i){if(e.is(t)&&e.is(i)){var n=i.draggedModels;if(e.is(n,"array")){var r,l=!!e.is(o.getOption("search_web_in_win"))&&o.getOption("search_web_in_win"),c={protocol:"3DXContent",version:"1.1",source:a.SEARCH_APP_ID,widgetId:i.widgetId,data:{items:[]}},d=[],u=[];if(e.is(i.securityContext)&&(r=i.securityContext),n.forEach(function(e){var t={envId:e.getPlatformID(),serviceId:e.getServiceID(),contextId:r,objectId:e.id,objectType:e.get("ds6w:type_value")?e.get("ds6w:type_value"):e.get("ds6w:what/ds6w:type_value"),displayName:e.get("ds6w:label"),displayType:e.get("ds6w:type")?e.get("ds6w:type"):e.get("ds6w:what/ds6w:type")};l&&(t.session_object=e.hasOwnProperty("session_object")),u.push('"'+t.displayName+'"'),d.push(t)}),s.log("number of dragged objects "+d.length),c.data.items=d,t.dataTransfer&&t.dataTransfer.setData){t.dataTransfer.setData("text",JSON.stringify(c));var h=!!document.documentMode,g=!h&&!!window.StyleMedia;h||g||t.dataTransfer.setData("shortData",JSON.stringify(u));try{t.dataTransfer.setData("text/searchitems",JSON.stringify(c))}catch(e){s.log("event.dataTransfer.setData DOES NOT accept text/searchitems")}l&&t.dataTransfer.setData("text/plain",JSON.stringify(c)),t.dataTransfer.effectAllowed="all"}}}},buildCompassSelectionData:function(t){let i={};if(e.is(t)&&e.is(t.selectedModels,"array")&&t.selectedModels.length>0){let n=t.selectedModels,s=[];n.forEach(function(t){if(e.is(t,"object")&&e.is(t.getPlatformID,"function")&&e.is(t.getServiceID,"function")&&e.is(t.get,"function")){let i={envId:t.getPlatformID(),objectId:t.id,serviceId:t.getServiceID(),objectType:t.get("ds6w:type_value"),displayName:t.get("ds6w:label_value"),contextId:"",displayPreview:t.get("preview_url"),displayIcon:t.get("type_icon_url"),displayType:t.get("ds6w:type")},n=t.pairs();for(let t=0;t<n.length;t++){let s=n[t][0],o=n[t][1];if(e.is(s)&&-1!==s.indexOf("_value")&&(-1!==s.indexOf("ds6w:")||-1!==s.indexOf("ds6wg:"))&&(-1!==s.indexOf("status_value")||-1!==s.indexOf("policy_value")||-1!==s.indexOf("revision_value")||-1!==s.indexOf("reserved_value")||-1!==s.indexOf("cadMaster_value")||-1!==s.indexOf("kind_value"))){i[s.replace("_value","")]=o}}i.snippets=t.get("snippetAsStringArray"),s.push(i)}}),i={protocol:"3DXContent",version:"2.0",source:a.SEARCH_APP_ID,widgetId:t.widgetId,data:{items:s}}}return i},handleMyContentTags:function(e){for(var t=0,i=0,n=0,s=0;s<e.length;s++)if("ds6w:what/ds6w:type"===e[s].sixw){t+=e[s].count;var o=e[s].object;"PLMWspFavoriteSearch"===o||"SavedSearch"===o?i+=e[s].count:"PLMWspFavoriteAuthoring"!==o&&"PLMWspFavoriteNavigation"!==o||(n+=e[s].count)}var a=t-i-n;if(a>0){var r={count:a,dispValue:c.get("myContent_otherThanFav"),field:"implicit",object:"#myOtherContent",sixw:"ds6w:what/ds6w:category",type:"string"};e.push(r)}if(i>0){var l={count:i,dispValue:c.get("myContent_searchFav"),field:"implicit",object:"#myFavoriteSearches",sixw:"ds6w:what/ds6w:category",type:"string"};e.push(l)}if(n>0){var d={count:n,dispValue:c.get("myContent_otherFav"),field:"implicit",object:"#myFavoriteContent",sixw:"ds6w:what/ds6w:category",type:"string"};e.push(d)}return e},getRelations:function(t){if(e.is(t,"object")){var i=t.model;e.is(i,"object")&&e.is(t.onComplete,"function")&&e.is(t.onFailure,"function")&&l.load({serviceID:i.getServiceID(),platformID:i.getPlatformID()}).then(function(n){e.is(n.getRelations,"function")?n.getRelations({model:i,onComplete:t.onComplete,onFailure:t.onFailure}):t.onFailure.call(void 0,"service delegation not implemented")},function(){t.onFailure.call(void 0,"service delegation not found")})}},addGetTaggerVisibilityFlagCB:function(t){s.log("SearchServices.addGetTaggerVisibilityFlagCB");let i=!0;e.is(this.listCBForTaggerVisibility)||(this.listCBForTaggerVisibility=[],i=!1),this.listCBForTaggerVisibility.push(t),!i&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("isTaggerVisible",JSON.stringify({}))},isTaggerVisibleFlag:function(t){if(s.log("SearchServices.isTaggerVisibleFlag",t),e.is(this.listCBForTaggerVisibility)){for(let e=0,i=this.listCBForTaggerVisibility;e<i;e++)this.listCBForTaggerVisibility[e](t);this.listCBForTaggerVisibility=null}},filterSourceList:function(e){return e=e.filter(function(e){return c.get("adv_search.source."+e)!=="adv_search.source."+e||(s.warn("Data source : "+e+" has no NLS defined, so filtering it as not validated !!!"),!1)})},_highlightTerms:function(t,i){if(!e.is(t)||!e.is(t.getSnippetInformation,"function"))throw s.warn("Invalid input for SearchServices._highlightTerms:",t),new Error("Invalid input for SearchServices._highlightTerms!");if(!e.is(i))throw s.warn("Invalid input for SearchServices._highlightTerms:",i),new Error("Invalid input for SearchServices._highlightTerms!");let n=t.get("snippetAsStringArray");for(let e=0,t=n.length;e<t;e++)this._applyHTMLHighlight(i,n[e],"highlightedSearchCriteria")},_getStringsToHighlight:function(t){let i=[];if(!e.is(t)||!e.is(t.getSnippetInformation,"function"))throw s.warn("Invalid input for SearchServices._getStringsToHighlight:",t),new Error("Invalid input for SearchServices._getStringsToHighlight!");let n=t.getSnippetInformation();return e.is(n,"object")&&(e.is(n["ds6w:description"])&&(i=i.concat(n["ds6w:description"].text)),e.is(n.ds6w)&&(i=i.concat(n.ds6w.text))),i},_applyHTMLHighlight:function(t,i,n){let o=e.is(n,"string")?n:"highlightedSearchCriteria";if(!e.is(t)||!e.is(t.querySelectorAll,"function"))throw s.warn("Invalid input in SearchServices.highlight, ",t),new Error("Invalid input in SearchServices.highlight !");let a=Array.prototype.slice.call(t.querySelectorAll("*"));a=(a=(a=(a=a.map(function(e){return Array.prototype.slice.call(e.childNodes)})).reduce(function(e,t){return e.concat(t)})).filter(function(e){return e.nodeType===document.TEXT_NODE&&e.textContent.indexOf(i)>-1})).forEach(function(e){var t=e.nextSibling,n=e.parentNode,s=e.textContent,a=[];e.parentNode.removeChild(e),s.split(i).forEach(function(e,t,n){a.push(document.createTextNode(e)),t<n.length-1&&(a.push(document.createElement("mark")),a[a.length-1].innerHTML=i,a[a.length-1].setAttribute("class",o))}),a.forEach(function(e){t?n.insertBefore(e,t):n.appendChild(e)})})},setTaggerDisplayStatus:function(e){this._TaggerdisplayStatus=e},getTaggerDisplayStatus:function(){return!!this._TaggerdisplayStatus}})}),define("DS/SNResultUX/views/helpers/SearchTreeListView",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Debug","DS/UIKIT/Mask","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SNVocabAccess","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchCustoServices","DS/WebappsUtils/Performance","DS/SNResultUX/views/utils/EmptyView","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SWFiltering","DS/Core/PointerEvents","DS/SNResultUX/views/helpers/Abstract","DS/W3DXComponents/Collections/ActionsCollection","DS/Controls/Toggle","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b,C){"use strict";return S.extend({tagName:"div",className:"TreeListView",attributes:{styles:{width:"100%"},"data-rec-id":"TreeListView"},nestedView:null,_columns:null,_columnsAttributes:null,_model:null,multiselMode:!1,checkedRows:0,_currentCustoViewId:"The_Default_Columns",_lastSelectedCustoViewId:"The_Default_Columns",_forcedCustoView:null,_typeAttrCache:[],_vocabularyClassesCache:[],_iShiftDown:!1,_lastItemSelected:null,_shiftTransaction:!1,_previousSlice:{start:-1,end:-1},_viewRoot:null,_cellSpan:null,_beginUnselectAll:!1,_subscriptions:null,_actionsColumnViews:null,_currentViewManagerPostion:null,_currentTimestamp:null,_pendingScroll:!1,_reDefColumns:function(){var e=this.collection,t=this.view.getManager(),i=this._columns,n=i.length;if(e.state.totalRecords<=1e3)for(let e=0;e<n;e++){let n=i[e].dataIndex;t.setColumnOptions(n,{isSortable:!0})}else for(let e=0;e<n;e++){let n=i[e].dataIndex;switch(n){case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":t.setColumnOptions(n,{isSortable:!0});break;default:t.setColumnOptions(n,{isSortable:!1})}}},init:function(t){this._parent(t),this._subscriptions={};var i=this;this._columns=e.clone(this._columnsAttributes),this._actionsColumnViews=[],e.is(this.collection&&this.collection.getSNSkeleton())&&(this._subscriptions.sortForAllView=s.subscribe({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"sortForAllView",callback:function(t){if(i.view&&i.collection.service_parameters){if(e.is(t.isRecent)&&!0===t.isRecent)return i.view.getManager().getOrderedColumnState()&&i.view.getManager().setColumnOrderState(i.view.getManager().getOrderedColumnState().dataIndex,"none"),void i.view.getManager().sortColumnContent(t.order_field,{sortOrder:t.order_by,typeOfCell:"number"});var n,s;i.collection.service_parameters.order_by&&i.collection.service_parameters.order_field?(n=i.collection.service_parameters.order_by,s=i.collection.service_parameters.order_field):(n=t.order_by,s=t.order_field),i.view.getManager().getOrderedColumnState()&&i.view.getManager().setColumnOrderState(i.view.getManager().getOrderedColumnState().dataIndex,"none"),i.view.getManager().setColumnOrderState(s,n);var o=r.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(e.is(o))for(var a in o)if(o[a]===s){i.view.getManager().setColumnOrderState(s,n);break}}}}))},getActionMenu:function(t,i){var n,s,o=this,a=o._model.getXSO().get();if(1===a.length)if(s=(n=o.collection._models[t.virtualRowID]).actions,e.is(s)&&0!==s._models.length)for(let n=0;n<s.length;n++){let a=s._models[n]._attributes;e.is(s._models[n])&&e.is(s._models[n]._attributes)&&i.push({text:a.title,fonticon:a.icon,handler:s._models[n]._attributes.callback.bind(o,{action_id:a.id,object_id:o.collection.at(t.virtualRowID).get("id"),cellInfo:t,collection:o.collection,model:o.collection.at(t.virtualRowID)})})}else i.push({text:f.get("noActionsAvailable")});else{var r=a.length,l=function(e){return r>1?!0===e.get("multisel"):e};n=[];for(let e=0;e<a.length;e++)n.push(o.collection._models[a[e]._localID]);var c=n[0].actions.filter(l);for(let e=1;e<r;e++){var d=n[e].actions.filter(l);c=c.filter(function(e){return d.some(function(t){return e.id===t.id})})}c&&c.length>0?c.forEach(function(t){var s={text:t.get("title"),fonticon:t.get("icon")};e.is(t.get("callback"))&&(s.callback=function(){var e=[];Array.prototype.forEach.call(n,function(i){var n={model:i,action_id:t.get("id"),object_id:i.get("id"),collection:i.collection};e.push(n)}),t.get("callback").call(o,e,arguments)}),i.push(s)}):i.push({text:f.get("noActionsAvailable")})}},onSearch:function(t){this._parent(t),e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&this.colCustoPanel._requestClosePanel(),this.colCustoPanel=null,this._reinitialisationColums(t),this._columns=e.clone(this._columnsAttributes),this.collection.getAttributesToRetrieve(this._columns)},getMinNumberModel:function(e){return e=e||this._rowMaxNumber},_managerInit:function(){var t=this,i=t.view.getManager();i.onColumnWidthUpdate(function(e){t.updateColumnWidth(e)}),i.options.pageScrollValueTriggeringInfiniteScroll=r.getOption("pageScrollValueTriggeringInfiniteScroll"),i.onMoveColumn(function(){if(o.log("column moved"),t.view&&t.view._datagrid.options.columns){var e=JSON.stringify(t.view._datagrid.options.columns);o.log("store new columns: "+e),localStorage.SNSearchGridColumns=e}}),i.onRowHeaderRequest(function(e){e.cellView.getContent().setContent((e.virtualRowID+1).toString())}),i.onSortColumnContent(function(i){var n="sort request received on "+i.columnDataIndex+", order = "+i.sortOrder;o.log(n),t.log(n);var a="",l=r.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");t.view&&t.view.getManager()&&(a=t.view.getManager().getColumnOptions(i.columnDataIndex).text),s.publish({channel:t.collection.getSNSkeleton().getOption("messagingChannel"),topic:"setOrderInGridView",data:{order_by:i.sortOrder,order_field:e.is(l)&&l.hasOwnProperty(i.columnDataIndex)?l[i.columnDataIndex]:i.columnDataIndex,nlsName:a}});var c=t.collection.getSNSkeleton();e.is(c)&&e.is(c.getPreviewPanel())&&!0===c.getPreviewPanel().getVisibleFlag()&&c.getPreviewPanel().setActiveObject(null),t._currentViewManagerPostion=-t.view.getManager().getScroller()._scrollPosition.x,t._currentTimestamp=parseInt(Date.now())}),i.onPostUpdateView(function(){null!==t._currentViewManagerPostion&&e.is(t.view.getManager().getScroller())&&(t.view.getManager().getScroller().elements.container.scrollLeft=t._currentViewManagerPostion,null!==t._currentTimestamp&&parseInt(Date.now())-t._currentTimestamp<1e3||(t._currentViewManagerPostion=null,t._currentTimestamp=null))}),i.onCellClick(function(e){if(r.getOption("search_web_in_win")&&"actions"===e.dataIndex&&(e.cellView._manager._cellSpan=e.cellView.getContent()),e.isHeader&&t.collection.state.totalRecords>1e3)switch(e.dataIndex){case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":break;default:h._displayAlert({message:f.get("sortLimitByLessThen1000Results"),className:"warning"})}}),i.onNodeDblClick(function(e,n){e.nodeModel||e._options?t.onItemDblClick(e,n):i.sizeColumnToFit(e.dataIndex)}),i.onCellPointerDown(function(i){e.is(t._simpleSearch)&&!0===t._simpleSearch&&e.is(i)&&e.is(i.dataIndex)&&"ds6w:label"===i.dataIndex&&e.is(i.isHeader)&&!1===i.isHeader&&e.is(i.columnID)&&3===i.columnID&&t.onItemTitleClick(i)}),i.setActiveNode=function(e){o.log("TreeList::setActiveNode : "+this._modeIsListSel+"|"+this._instance.options.enableActiveUI+"|"+(!this._modeIsListSel&&this._instance.options.enableActiveUI)+"|"+e._rowID),o.log("TreeList::setActiveNode : "+this._activeNode+"|"+this._instance.options.enableActiveUI),!this._modeIsListSel&&this._instance.options.enableActiveUI?e?this._activeNode!==e&&(this._activeNode=e,this._modelEvents.publish({event:"active",context:e,data:e._getNodeInfos()})):this.unsetActiveNode():void 0===this._activeNode&&this._instance.options.enableActiveUI&&(this._activeNode=this.getDocument().getXSO().get().length>0?this.getDocument().getXSO().get()[0]:this.getDocument().getChildren()[0],this._modelEvents.publish({event:"active",context:this._activeNode,data:this._activeNode._getNodeInfos()}))},i.onInfiniteScrollAsync(function(e){o.log("scroll"),t._pendingScroll||(t._pendingScroll=!0,t.onInfiniteScrollAsync(e,function(){i.infiniteScrollAsyncProcessDone(),t._pendingScroll=!1}))}),i.onEndResizeOrOnReadyModelRequestAsync&&i.onEndResizeOrOnReadyModelRequestAsync(function(e){t.onResizeOrFirstLoaded(e,function(){i.EndResizeOrOnReadyModelRequestAsyncDone()})})},_reinitialisationColums:function(t){var i=this;if(i._forcedCustoView=null,this._currentCustoViewId=this._lastSelectedCustoViewId,l.getItem("listColumnsWidth")&&this.view)try{let e=JSON.parse(l.getItem("listColumnsWidth")),t=Object.keys(e),i=this.view._datagrid.options.columns;for(let n=0;n<i.length;n++)-1!==t.indexOf(i[n].dataIndex)&&(i[n].width=e[i[n].dataIndex])}catch(e){o.log(e)}if(e.is(i.collection.service_parameters)&&e.is(i.collection.options.tagger_proxy)){var n={isPQ:!0===i.collection.service_parameters.isAPQSearch,typeName:i.collection.getPQ()},s=!1;if(e.is(i.collection.service_parameters.isAPQSearch)&&!0===i.collection.service_parameters.isAPQSearch){var r=i.collection.getPQ();e.is(r)&&e.is(r.pqName,"string")&&r.pqName.length>0&&(s=!0)}let o=g.getColumnCustomizationIdToUse(n);e.is(o,"string")&&o.length>0&&(this._currentCustoViewId=o,this._columnsAttributes=g.getColumnCustomizationDefinitionFromCustoId(o));var d=i.collection.options.tagger_proxy.getCurrentFilter(),p=i.collection.service_parameters.refine;if(i.collection.service_parameters.query===a.SearchTypeEnum.ADVANCED_SEARCH&&e.is(p)&&""===p)this._columnsAttributes=g.getColumnCustomizationDefinitionFromCustoId("The_Default_Columns");else if(e.is(d)&&e.is(d.allfilters)&&e.is(p)&&e.is(p.allfilters)&&(""===this._currentCustoViewId||"The_Default_Columns"===this._currentCustoViewId))if(i.collection.service_parameters.query!==a.SearchTypeEnum.ADVANCED_SEARCH&&Object.keys(d.allfilters).length>0&&(e.is(d.allfilters["ds6w:what/ds6w:type"])&&d.allfilters["ds6w:what/ds6w:type"].length>0||e.is(d.allfilters["ds6w:what/ds6w:kind"])&&d.allfilters["ds6w:what/ds6w:kind"].length>0)){let n=[];e.is(p.allfilters["ds6w:what/ds6w:type"])&&!e.is(p.allfilters["ds6w:what/ds6w:kind"])?n=p.allfilters["ds6w:what/ds6w:type"]:e.is(p.allfilters["ds6w:what/ds6w:kind"])&&!e.is(p.allfilters["ds6w:what/ds6w:type"])?n=p.allfilters["ds6w:what/ds6w:kind"]:e.is(p.allfilters["ds6w:what/ds6w:kind"])&&e.is(p.allfilters["ds6w:what/ds6w:type"])&&(n=p.allfilters["ds6w:what/ds6w:type"].concat(p.allfilters["ds6w:what/ds6w:kind"]));let s=[];for(let e=0;e<n.length;e++){let t=g.getColumnCustomizationAliasIdToUse(n[e].object);s.push(t)}let o=s.filter(function(e,t,i){return i.indexOf(e)===t});1===o.length&&e.is(o[0])&&(this._currentCustoViewId=o[0],this._columnsAttributes=g.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId),!i._isCurrentView||e.is(t)&&e.is(t.refresh)||h._displayAlert({message:f.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:i.getOption("widgetId")}))}else if(e.is(d.allfilters)&&(1===Object.keys(d.allfilters).length&&e.is(d.allfilters["sixw:ds6w:what/ds6w:type"])||2===Object.keys(d.allfilters).length&&(e.is(d.allfilters["sixw:ds6w:what/ds6w:type"])||e.is(d.allfilters["sixw:vpmextension"])))||3===Object.keys(d.allfilters).length&&(e.is(d.allfilters["sixw:ds6w:what/ds6w:type"])||e.is(d.allfilters["sixw:vpmextension"]))){let n=[];e.is(d.allfilters["sixw:ds6w:what/ds6w:type"])&&!e.is(d.allfilters["sixw:vpmextension"])?n=d.allfilters["sixw:ds6w:what/ds6w:type"]:e.is(d.allfilters["sixw:vpmextension"])&&!e.is(d.allfilters["sixw:ds6w:what/ds6w:type"])?n=d["sixw:vpmextension"]:e.is(d.allfilters["sixw:vpmextension"])&&e.is(d.allfilters["sixw:ds6w:what/ds6w:type"])&&(n=d.allfilters["sixw:ds6w:what/ds6w:type"].concat(d.allfilters["sixw:vpmextension"]));let s=[];for(let e=0;e<n.length;e++){let t=g.getColumnCustomizationAliasIdToUse(n[e].object.slice(6));s.push(t)}let o=s.filter(function(e,t,i){return i.indexOf(e)===t});1===o.length&&e.is(o[0])&&(this._currentCustoViewId=o[0],this._columnsAttributes=g.getColumnCustomizationDefinitionFromAliasCustoId(this._currentCustoViewId),!i._isCurrentView||e.is(t)&&e.is(t.refresh)||h._displayAlert({message:f.get("SearchDataGridPreferences_modal_typeCusto"),className:"success",widgetId:i.getOption("widgetId")}))}else s?(o=g.getColumnCustomizationIdToUse(n),e.is(o,"string")&&o.length>0&&(this._currentCustoViewId=o,this._columnsAttributes=g.getColumnCustomizationDefinitionFromCustoId(o))):this._columnsAttributes=g.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId);else this._columnsAttributes=g.getColumnCustomizationDefinitionFromCustoId(this._currentCustoViewId);u.getCustoCellRequest(this._columnsAttributes)}if((!e.is(this._columnsAttributes)||e.is(this._columnsAttributes)&&this._columnsAttributes.length<1)&&(this._columnsAttributes=u.getDataGridViewHeaders(function(){if(i._columnsAttributes){var e=i._columnsAttributes.length;for(let n=0;n<e;n++){var t=i._columnsAttributes[n].dataIndex;i._columnsAttributes[n].text=c.getNLSValueForPredicate(t)}}i.view&&i.updateColumnsNLS()})),e.is(i.collection)&&e.is(i.collection.service_parameters)&&e.is(i.collection.service_parameters.query)&&a.SearchTypeEnum.MY_RECENT_CONTENT===i.collection.service_parameters.query&&i._columnsAttributes.forEach(function(e){-1!==e.dataIndex.indexOf("/")&&(e.dataIndex=e.dataIndex.slice(e.dataIndex.indexOf("/")+1,e.dataIndex.length))}),this._columns=e.clone(this._columnsAttributes),this.view&&this.view.options&&this.reloadColumn(),this.collection.getAttributesToRetrieve(this._columns),"The_Default_Columns"===this._currentCustoViewId)if(l.getItem("listColumnsWidth"))try{let e=JSON.parse(l.getItem("listColumnsWidth")),t=Object.keys(e);this._columnsAttributes.forEach(function(i){-1===t.indexOf(i.dataIndex)?i.width="auto":i.width=e[i.dataIndex]})}catch(e){o.log(e)}else this._columnsAttributes.forEach(function(e){e.width="auto"});if(this.view){var _=this.view.options;_.columns.length=3;for(var m=0;m<=this._columnsAttributes.length-1;m++)this._columnsAttributes[m]&&_.columns.push(this._columnsAttributes[m])}if(this.comptuteNewColumnsNLS(),i.view&&this.collection.service_parameters&&this.collection.service_parameters.order_by&&this.collection.service_parameters.order_field){var v=i.view.getManager().getOrderedColumnState();v&&i.view.getManager().setColumnOrderState(v.dataIndex,"none"),i.view.getManager().setColumnOrderState(i.collection.service_parameters.order_field,i.collection.service_parameters.order_by)}},updateColumnsNLS:function(){for(var e=this.view.getManager(),t=this._columnsAttributes.length,i=0;i<t;i++){var n=this._columnsAttributes[i].dataIndex;e.setColumnOptions(n,{text:this._columnsAttributes[i].text}),"actions"===n&&e.setColumnOptions(n,{text:"Actions"})}this.view.getManager().updateView(!0)},updateGridViewAfterSync:function(){if(this.view&&this.collection.service_parameters&&this.collection.service_parameters.order_by&&this.collection.service_parameters.order_field){var t=this.view.getManager().getOrderedColumnState();t&&this.view.getManager().setColumnOrderState(t.dataIndex,"none"),this.view.getManager().setColumnOrderState(this.collection.service_parameters.order_field,this.collection.service_parameters.order_by);var i=r.getOption("NLSMapping_3DSearch_Sorting_TACTICALOnly");if(e.is(i))for(var n in i)if(i[n]===this.collection.service_parameters.order_field){this.view.getManager().setColumnOrderState(n,this.collection.service_parameters.order_by);break}}this.isReady||(this.view.getManager()._setColumnsWidth(),this.isReady=!0);var s=this.view.getManager().getNumberOfRows();this._setRowNumberWidth(this.view.getManager(),s,!1),this._reDefColumns(),this.updateColumnsNLS()},_emptyDataGridAndReloadFirstPage:function(t,i,s){var o=this,a=Math.floor(1e5*Math.random()+1);if(o._emptyDataGrid(),o.collection._resetState(),o.collection.reset(),n.mask(o.container),e.is(s)&&(o.collection.service_parameters.order_by=s),e.is(i)){o.collection.service_parameters.order_field=null;var r=i.split("/");e.is(r)&&r.length>0&&(o.collection.service_parameters.order_field=r.pop())}o.collection.getFirstPageOfResults({reset:!0,onComplete:function(){if(n.unmask(o.container),o.collection.getRequestCriteria().service_params.adv_search){var t=e.is(o.getOption("advSearchMgr"),"function")?o.getOption("advSearchMgr").call():null;e.is(t)&&t.getAndDisplayAdvancedSearch(!1)}if(o.view&&o.collection.service_parameters&&o.collection.service_parameters.order_by&&o.collection.service_parameters.order_field){var i=o.view.getManager().getOrderedColumnState();i&&o.view.getManager().setColumnOrderState(i.dataIndex,"none"),o.view.getManager().setColumnOrderState(o.collection.service_parameters.order_field,o.collection.service_parameters.order_by)}p.mark("DS/SNResultUX/views/SearchTreeListView$_emptyDataGridAndReloadFirstPage$"+a+"$end")},onFailure:function(){n.unmask(o.container),p.mark("DS/SNResultUX/views/SearchTreeListView$_emptyDataGridAndReloadFirstPage$"+a+"$end")}})},_setRowNumberWidth:function(e,t,i){var n=i?t.toString():(t+40).toString(),s=t.toString();(n.length>s.length||i)&&(3===n.length?e.options.headersDimensions.width=35:4===n.length?e.options.headersDimensions.width=45:n.length>4&&(e.options.headersDimensions.width=55),e._adjustLayout())},_emptyDataGrid:function(){var t=this;if(t.view&&!e.is(t.view))return o.error("!UWACore.is(that.view)"),null;t.collection&&t.collection._snSkeleton&&t.collection._snSkeleton.resetMultisel&&"table"===t._viewRoot.currentViewId&&t.collection._snSkeleton.resetMultisel();var i,n=t.view.getManager();if(t._model.empty(),n._setColumnsWidth(),!e.is(t._emptyView)){var s=t.getOption("itemViewOptions");this._emptyView=new _(s)}if(e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances))UWA.Widgets.instances.forEach(function(n){n.id===t.getOption("widgetId")&&(i=e.extendElement(n.elements.body).getElement(".wux-datagrid"))});else if(i=e.extendElement(document.body).getElement(".wux-datagrid"),!e.is(i))return;var a=this._emptyView.render();e.is(a)&&e.is(i)&&a.inject(i)},setup:function(e){this._parent(e);var t=this;this.listenTo(this.collection,{onSync:function(){t.view&&t.updateGridViewAfterSync()}})},destroy:function(){this._actionsColumnViews.forEach(function(e){e.destroy()}),this._actionsColumnViews=null,e.is(this._mySpinner)&&(this._mySpinner.destroy(),this._mySpinner=null),e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&this.colCustoPanel._requestClosePanel(),this.colCustoPanel=null,s.unsubscribe(this._subscriptions.sortForAllView),e.is(this.view)&&e.is(this.view.destroy,"function")&&this.view.destroy(),this._parent()},_removeColumnCustoMask:function(){if(e.is(this.collection)&&e.is(this.collection._snSkeleton)&&e.is(this.collection._snSkeleton.getSearchActions,"function")){var t=this.collection._snSkeleton.getSearchActions();e.is(t)&&e.is(t.removeMask,"function")&&t.removeMask()}},defineColumnCusto:function(){var t=this,i=null,n=t.getOption("widgetId");if(e.is(this.zIndexToUse)||(this.zIndexToUse=a.getZIndex(this.container)),t.collection.isEmpty())return h._displayAlert({message:f.get("ColumnCustomization_error_noResult"),className:"warning",widgetId:n}),t._removeColumnCustoMask(),null;if(e.is(t.collection)&&e.is(t.collection.service_parameters)&&e.is(t.collection.service_parameters.query)&&a.SearchTypeEnum.MY_RECENT_CONTENT===t.collection.service_parameters.query)return h._displayAlert({message:f.get("SearchDataGridPreferences_error_RecentModeNotSupported"),className:"warning",widgetId:n}),t._removeColumnCustoMask(),null;var s=!1,o=[],l=null;if(e.is(t.collection.options.tagger_proxy)&&(l=t.collection.options.tagger_proxy.latest_tagValues),e.is(t.collection.service_parameters.isAPQSearch)&&!0===t.collection.service_parameters.isAPQSearch){var d=t.collection.getPQ();e.is(d)&&e.is(d.pqName,"string")&&d.pqName.length>0&&(s=!0,i={typeName:d,isPQ:!0})}var u=!1;if(s&&e.is(l,"array")&&l.length>0){for(var g=0,p=0;p<l.length;p++){var _=l[p];"ds6w:what/ds6w:type"===_.sixw&&(o.push("ds6wg:"+_.object),g++)}1===g&&(u=!0)}o.push("ds6wg:PLMEntity");var m=null;if(e.is(t.collection.options.tagger_proxy)&&(m=t.collection.options.tagger_proxy.getCurrentFilter()),!(e.is(i)||e.is(m)&&e.is(m.allfilters)&&(e.is(m.allfilters["ds6w:what/ds6w:type"])&&1===m.allfilters["ds6w:what/ds6w:type"].length||e.is(m.allfilters["ds6w:what/ds6w:kind"])&&1===m.allfilters["ds6w:what/ds6w:kind"].length||e.is(m.allfilters["sixw:ds6w:what/ds6w:type"])&&1===m.allfilters["sixw:ds6w:what/ds6w:type"].length||e.is(m.allfilters["sixw:ds6w:what/ds6w:kind"])&&1===m.allfilters["sixw:ds6w:what/ds6w:kind"].length)))return h._displayAlert({message:f.get("SearchDataGridPreferences_error_OnlyOneTypeOrSubTypeSupported"),className:"warning",widgetId:n}),t._removeColumnCustoMask(),null;if(e.is(i)){var v=r.getOption("disable_PQ_multi_types_custo");if(e.is(v)&&!0===v&&s&&e.is(u)&&!1===u)return h._displayAlert({message:f.get("SearchDataGridPreferences_error_OnlyOneTypeOrSubTypeSupported_pq"),className:"warning",widgetId:n}),t._removeColumnCustoMask(),null}var S=null;if(e.is(m)&&e.is(m.allfilters))if(e.is(m.allfilters["ds6w:what/ds6w:kind"])&&1===m.allfilters["ds6w:what/ds6w:kind"].length&&e.is(m.allfilters["ds6w:what/ds6w:kind"][0].object)&&e.is(m.allfilters["ds6w:what/ds6w:kind"][0].disptext)){i={typeName:m.allfilters["ds6w:what/ds6w:kind"][0].disptext,isPQ:!1};var w=["ds6wg:"+m.allfilters["ds6w:what/ds6w:kind"][0].object];o.push(w)}else if(e.is(m.allfilters["ds6w:what/ds6w:type"])&&1===m.allfilters["ds6w:what/ds6w:type"].length&&e.is(m.allfilters["ds6w:what/ds6w:type"][0].object)&&e.is(m.allfilters["ds6w:what/ds6w:type"][0].disptext))i={typeName:m.allfilters["ds6w:what/ds6w:type"][0].disptext,isPQ:!1,className:"ds6wg:"+m.allfilters["ds6w:what/ds6w:type"][0].object},S=m.allfilters["ds6w:what/ds6w:type"][0].object,o.push(S);else if(e.is(m.allfilters["sixw:vpmextension"])&&1===m.allfilters["sixw:vpmextension"].length&&e.is(m.allfilters["sixw:vpmextension"][0].object)&&e.is(m.allfilters["sixw:vpmextension"][0].displayValue)){i={typeName:m.allfilters["sixw:vpmextension"][0].displayValue,isPQ:!1};var b=[m.allfilters["sixw:vpmextension"][0].object];o.push(b)}else e.is(m.allfilters["sixw:ds6w:what/ds6w:type"])&&1===m.allfilters["sixw:ds6w:what/ds6w:type"].length&&e.is(m.allfilters["sixw:ds6w:what/ds6w:type"][0].object)&&e.is(m.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue)&&(i={typeName:m.allfilters["sixw:ds6w:what/ds6w:type"][0].displayValue,isPQ:!1,className:m.allfilters["sixw:ds6w:what/ds6w:type"][0].object},S=m.allfilters["sixw:ds6w:what/ds6w:type"][0].object,o.push(S));o.filter(function(e,t,i){return t===i.indexOf(e)}),c._asyncCallToPredicatesWS(o).then(function(e){t.renderColumnsWithSuccess(e,t,i)},function(e){t.renderColumnsWithFailure(t,i,e)})},_launchColumnCustoPanel:function(t,i,n){var s=this,o=e.clone(i),a=g._computeColToDisplayInCustoPanel(o,n);require(["DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferences"],function(i){s.colCustoPanel=new i({spreadsheet:s.nestedView.view,availableColumns:a,searchDatagridView:s,predicateIntersection:n,typeToHandle:t,zIndexToUse:s.zIndexToUse}),s.colCustoPanel.addEvent("onCloseColumnCustomizationPanel",function(){e.is(s.colCustoPanel)&&e.is(s.colCustoPanel.destroy,"function")&&s.colCustoPanel.destroy(),s.colCustoPanel=null})}),s._removeColumnCustoMask()},renderColumnsWithSuccess:function(t,i,n){for(var s=i,r=[],l={},c={},d=0,u=t.classPredicates.length;d<u;d++){if(!e.is(t.classPredicates[d].className)||!e.is(t.classPredicates[d].vocabularyPredicateInfo))return o.warn("Unexpected response from GetRelevantPredicates !"),s._removeColumnCustoMask(),null;if(e.is(n.className)&&n.className.length>0)for(let i=0,s=t.classPredicates[d].vocabularyPredicateInfo.length;i<s;i++)e.is(t.classPredicates[d].vocabularyPredicateInfo[i],"object")&&e.is(t.classPredicates[d].vocabularyPredicateInfo[i].nlsName,"string")&&e.is(t.classPredicates[d].vocabularyPredicateInfo[i].uri,"string")&&e.is(t.classPredicates[d].vocabularyPredicateInfo[i].name,"string")&&t.classPredicates[d].className===n.className?(e.is(c[t.classPredicates[d].vocabularyPredicateInfo[i].nlsName])||(c[t.classPredicates[d].vocabularyPredicateInfo[i].nlsName]=[]),e.is(l[t.classPredicates[d].vocabularyPredicateInfo[i].uri])||(c[t.classPredicates[d].vocabularyPredicateInfo[i].nlsName].push(t.classPredicates[d].vocabularyPredicateInfo[i].uri),r.push({dispValue:t.classPredicates[d].vocabularyPredicateInfo[i].nlsName,sixw:t.classPredicates[d].vocabularyPredicateInfo[i].uri,type:a._getPredicateTypeFromDataType(t.classPredicates[d].vocabularyPredicateInfo[i])||"string",relatedObjectType:t.classPredicates[d].className,name:t.classPredicates[d].vocabularyPredicateInfo[i].name}),l[t.classPredicates[d].vocabularyPredicateInfo[i].uri]=!0)):(o.warn("Invalid data returned by Predicates WS for class "+t.classPredicates[d].className+" for index "+i+" !"),o.warn(t.classPredicates[d].vocabularyPredicateInfo));else if(e.is(n.typeName))for(let i=0,n=t.classPredicates[d].vocabularyPredicateInfo.length;i<n;i++)e.is(t.classPredicates[d].vocabularyPredicateInfo[i],"object")&&e.is(t.classPredicates[d].vocabularyPredicateInfo[i].nlsName,"string")&&e.is(t.classPredicates[d].vocabularyPredicateInfo[i].uri,"string")&&e.is(t.classPredicates[d].vocabularyPredicateInfo[i].name,"string")?(e.is(c[t.classPredicates[d].vocabularyPredicateInfo[i].nlsName])||(c[t.classPredicates[d].vocabularyPredicateInfo[i].nlsName]=[]),e.is(l[t.classPredicates[d].vocabularyPredicateInfo[i].uri])||(c[t.classPredicates[d].vocabularyPredicateInfo[i].nlsName].push(t.classPredicates[d].vocabularyPredicateInfo[i].uri),r.push({dispValue:t.classPredicates[d].vocabularyPredicateInfo[i].nlsName,sixw:t.classPredicates[d].vocabularyPredicateInfo[i].uri,relatedObjectType:t.classPredicates[d].className,name:t.classPredicates[d].vocabularyPredicateInfo[i].name}),l[t.classPredicates[d].vocabularyPredicateInfo[i].uri]=!0)):(o.warn("Invalid data returned by Predicates WS for class "+t.classPredicates[d].className+" for index "+i+" !"),o.warn(t.classPredicates[d].vocabularyPredicateInfo))}var h=m.getSelectPredicates();if(e.is(h,"array"))for(var g=r.length-1;g>=0;g--)-1===h.indexOf(r[g].sixw)&&r.splice(g,1);for(var p=0,_=r.length;p<_;p++)e.is(c[r[p].dispValue],"array")&&c[r[p].dispValue].length>1&&(r[p].dispValue+=" ("+r[p].relatedObjectType+":"+r[p].sixw+")");s._launchColumnCustoPanel(n,s._columnsAttributes,r)},renderColumnsWithFailure:function(t,i,n){var s=t;o.error("promisePredicate fail !",arguments);var a=f.get("SearchDataGridPreferences_error_UnableToRetrievePredicates");e.is(n)&&(n.message&&(a+="<br>"+n.message),n.url&&(a+="<br>"+n.url)),h._displayAlert({message:a,className:"warning",widgetId:t.getOption("widgetId")});s._launchColumnCustoPanel(i,s._columnsAttributes,[])},_deleteCustoPanel:function(){e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&this.colCustoPanel._requestClosePanel()},_updateColumns:function(t,i,n){var s=this.getOption("widgetId");if(Array.isArray(t)&&this._searchcom_socket&&this.view.getManager()){this._searchcom_socket.dispatchEvent("checkNewColomnForSort",t);var o=t.map(function(e){return e.dataIndex}),a=this.view.getManager().getOrderedColumnState();if(a&&-1===o.indexOf(a.dataIndex))if(r.getOption("default_sort")){var c=r.getOption("default_sort");e.is(c,"object")&&e.is(c.order_by,"string")&&e.is(c.order_field,"string")&&(this.collection.service_parameters.order_field=c.order_field,this.collection.service_parameters.order_by=c.order_by)}else r.getOption("apply_sort_on_modified_by_default")?(this.collection.service_parameters.order_field="ds6w:modified",this.collection.service_parameters.order_by="desc"):(this.collection.service_parameters.order_field="",this.collection.service_parameters.order_by="")}var d,g="",p="",_=!1;e.is(i,"string")?(g=i,p=i):e.is(i,"object")&&(g=i.custoName,d=i.custoNLS,p=i.custoId,e.is(i.favPQ)&&!0===i.favPQ&&(_=!0)),this._currentCustoViewId=p;for(var m=[],v=0,S=(t=u.getCustoCellRequest(t)).length;v<S;v++)if(e.is(t[v],"object")){var w=t[v].dataIndex;m.push(w.slice(w.lastIndexOf("/")+1,w.length))}this.collection.setAttributesToRetrieve(m);var b,C=l.getItem("DataGridColumnCusto");if(e.is(C)&&(e.is(C.activeView)&&!1===_&&(this._lastSelectedCustoViewId=C.activeView),e.is(C.views)&&(b=C.views)),e.is(b)||(b=[]),"The_Default_Columns"!==p){if(!0===n){for(var y=b.length-1;y>=0;y--){b[y].viewId===p&&b.splice(y,1)}b.push({viewId:p,viewDefinition:t,version:2})}var I={views:b};if(!1===_?I.activeView=p:e.is(C)&&e.is(C.activeView)&&(I.activeView=C.activeView),l.setItem("DataGridColumnCusto",I),l.commit(),!0===n&&"TEMP_CUSTO"!==p)h._displayAlert({message:f.replace(f.get("SearchDataGridPreferences_modal_saveSuccessful"),{custo_name:e.is(d,"string")?d:g}),className:"success",widgetId:s});else if("TEMP_CUSTO"!==p){var D=g;if(D.endsWith("-ADMIN")&&(D=D.slice(0,-6)),D.startsWith("###")){var T=D.substring(3,D.length);D=f.replace(f.get("custo_PQ"),{PQ:T})}D.endsWith("-HIDDEN")?h._displayAlert({message:f.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:s}):h._displayAlert({message:f.replace(f.get("SearchDataGridPreferences_modal_applySuccessful"),{custo_name:D}),className:"success",widgetId:s})}else h._displayAlert({message:f.get("SearchDataGridPreferences_modal_applyTempCustoSuccessful"),className:"success",widgetId:s})}else C=l.getItem("DataGridColumnCusto"),e.is(C)&&(C.activeView="The_Default_Columns"),this._lastSelectedCustoViewId="The_Default_Columns",l.setItem("DataGridColumnCusto",C),l.commit(),h._displayAlert({message:f.get("SearchDataGridPreferences_modal_resetDone"),className:"success",widgetId:s});this._columnsAttributes=t,this._columns=e.clone(this._columnsAttributes),this.reloadColumn(),this._reDefColumns(),this.comptuteNewColumnsNLS(),this._forcedCustoView=p,this.collection._snSkeleton._loadFirstPage()},updateColumnWidth:function(t){var i=t.width,n=t.dataIndex;if(e.is(n)&&e.is(localStorage)&&this.view&&this.view._datagrid.options.columns){var s={},a=l.getItem("listColumnsWidth");if(e.is(a,"string")&&a.length>0)try{for(var r=JSON.parse(a),c=0;c<Object.keys(r).length;c++)s[Object.keys(r)[c]]=r[Object.keys(r)[c]]}catch(e){o.log(e)}s[n]=i;var d=JSON.stringify(s);l.setItem("listColumnsWidth",d),l.commit()}},reloadColumn:function(){var e=this.view.options;e.columns.length=3;for(var t=this._columns,i=0;i<=t.length-1;i++)t[i]&&e.columns.push(t[i]);this._model.getChildren()&&this._model.getChildren().length>0&&this._model.empty(),this.view.loadColumns(e.columns)},comptuteNewColumnsNLS:function(){for(var t=this,i=[],n=0,s=this._columnsAttributes.length;n<s;n++)i.push(this._columnsAttributes[n].dataIndex);var r="";if(e.is(t.collection)&&e.is(t.collection.search_ressources)&&e.is(t.collection.search_ressources.getActiveTenant,"function")&&(r=t.collection.search_ressources.getActiveTenant()),i.length>0){var l=i.join("\r\n");C.getResourcesInfo(l,{tenantId:r,lang:a.getLanguage(),apiVersion:"R2019x",onComplete:function(i){if(o.log(i),!e.is(i))return o.error("Unexpected response from getResourcesInfo !"),null;for(var n=!1,s=0,a=t._columnsAttributes.length;s<a;s++)for(var r=0,l=i.length;r<l;r++){if(!e.is(i[r].curi)||!e.is(i[r].label))return o.error("Unexpected response from getResourcesInfo !"),null;i[r].curi===t._columnsAttributes[s].dataIndex&&t._columnsAttributes[s].text!==i[r].label&&(t._columnsAttributes[s].text=i[r].label,n=!0)}n&&t.updateColumnsNLS()},onFailure:function(){o.warn("not able to load predicates")}})}},setShadings:function(e){if(this.log("DataGridView setShadings"),this.collection&&this.collection.length&&this.view){var t=0,i=this.view.getManager();i&&(i.prepareUpdateView(),this.collection.forEach(function(n){if(e)for(var s=0;s<e.length;s++)e[s].criteria(n)&&i.styleRow(t,{"background-color":e[s].color});else i.unstyleRow(t);t++}),i.pushUpdateView())}},updateView:function(){this.view&&this.view.getManager()&&this.view.getManager().updateView()},createMultiCheckbox:function(){var t=this;t.view.getManager().registerReusableCellContent({id:"checkbox_search",buildContent:function(){var i=new b;i.getContent().addEventListener(v.POINTERDOWN,function(e){e.stopPropagation()}),i.getContent().addEventListener(v.POINTERUP,function(e){e.stopPropagation()}),i.getContent().addEventListener("touchstart",function(e){e.stopPropagation()}),i.getContent().addEventListener("touchend",function(e){e.stopPropagation()}),i.getContent().addEventListener("focus",function(e){e.preventDefault(),e.stopPropagation()});var n=t.view.getManager();return i.getContent().addEventListener("change",function(){i.ignoreUpdate||null===i.currentNodeModel&&e.is(t.collection&&t.collection.getSNSkeleton())&&(i.checkFlag&&0===n.getNodesXSO().get().length?s.publish({channel:t.collection.getSNSkeleton().getOption("messagingChannel"),topic:"onFetchAndSelectAll",data:{DoSelection:!0}}):s.publish({channel:t.collection.getSNSkeleton().getOption("messagingChannel"),topic:"onResetMultisel",data:{}}))}),i}}),t.initMultiCheckbox()},initMultiCheckbox:function(){var e=this.view.getManager(),t=e.getNodesXSO();t.onEmpty(function(){var t=e.getVirtualViewport();e.updateCellView(-1,"selection_search");for(var i=t.minRowID;i<=t.maxRowID;i++)e.updateCellView(i,"selection_search")}),t.onAdd(function(t){e.updateCellView(-1,"selection_search"),e.updateCellView(t,"selection_search")}),t.onRemove(function(t){e.updateCellView(-1,"selection_search"),e.updateCellView(t,"selection_search")})},render:function(){var t=this;return t._parent(),require(["DS/SNResultUX/views/WebUX/Tree/TreeListView"],function(i){t._reinitialisationColums(t.options);var n=t._canMultiSelect,s={columns:e.clone(t._columnsAttributes),treeDocument:t._model,height:"auto",headersDimensions:{width:45,height:30},defaultCellHeight:30,resize:{columns:!0,rows:!1},apiVersion:2,selection:{rowHeaders:!1,columnHeaders:!1,cells:!1,unselectAllOnEmptyArea:!0,canMultiSelect:n,enableListSelection:!0,toggle:!1},show:{rowHeaders:!0,canMultiSelect:n},performances:{buildLinks:!1,useRequestAnimationFrameRendering:!1,debounceCellInternalUpdateTimer:0},enableActiveUI:!0,enableKeyboardNavigation:!0,infiniteScrolling:!0,rowsAreDraggable:!0,nodesAreDraggable:!1,useTransparentScroller:!1,shouldDisplayTooltip:function(t){var i="";if("selection"===t.dataIndex)return{longHelp:i};if(t.isHeader&&e.is(t.manager.options.columns[t.virtualColumnID]))i=t.manager.options.columns[t.virtualColumnID].text;else if(!0===r.getOption("webUXTooltip")){if(e.is(t.nodeModel)&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.customTooltip))return t.nodeModel._options.customTooltip}else{var n=null;e.is(t.cellModel)&&e.is(t.cellModel.options)&&e.is(t.cellModel.options.value)&&(n=t.cellModel.options.value),e.is(t.nodeModel)&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options._attributes)&&e.is(t.nodeModel._options._attributes[t.dataIndex])&&(n=t.nodeModel._options._attributes[t.dataIndex]),e.is(n)&&(e.is(n,"string")?i=a.decodeHtml(n):e.is(n)&&e.is(n.toString,"function")&&(i=a.decodeHtml(n.toString())))}return{longHelp:i}},onDragStartColumnHeaderDefault:function(e){e&&(e.preventDefault(),e.stopPropagation())}};s=u.initColumnsTreeList(s,t.options),e.is(s,"object")&&e.is(s.columns,"array")&&s.columns.length>1&&"actions"===s.columns[2].dataIndex&&(s.columns[2].onCellRequest=function(i){if(i.nodeModel instanceof Object&&2===i.virtualColumnID&&!i.isHeader){var n=i.nodeModel.options.collection,s=n.at(i.virtualRowID);if(e.is(s)){var o='<span style="font-size:18px; color:gray;" class="fonticon fonticon-2x fonticon-down-open" data-rec-id="dropdown-icon-';e.is(i.virtualRowID)&&e.is(n.at(i.virtualRowID))&&(o+=n.at(i.virtualRowID).get("id")),o+='"></span>',i.cellView.getContent().setHTML(o);var a=i.cellView.getContent().getChildren()[0];t._actionsColumnViews.push(a),a.addEvent("mouseup",function(e){e&&(e.cancelBubble=!0),e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault();var t=i.parent.options.onContextualEvent;t.callback.call(t.this,{treeview:i})}),a.addClassName("column-action").style.display=i.manager.multiselMode?"none":""}}}),s.keymaps={"/":"treelistview:collapse-all-node","*":"treelistview:expand-all-node","+":"treelistview:expand-node","-":"treelistview:collapse-node","ctrl+space":"treelistview:toggle-selection","ctrl+right":"empty","shift+right":"empty",right:"empty","ctrl+left":"empty","shift+left":"empty",left:"empty","ctrl+up":"treelistview:go-to-previous-visible-node","shift+up":"treelistview:go-to-previous-visible-node",up:"treelistview:go-to-previous-visible-node","ctrl+down":"treelistview:go-to-next-visible-node","shift+down":"treelistview:go-to-next-visible-node",down:"treelistview:go-to-next-visible-node",esc:"treelistview:edit-cancel",pageup:"treelistview:go-to-previous-page-node",pagedown:"treelistview:go-to-next-page-node",home:"treelistview:go-to-first-visible-node",end:"treelistview:go-to-last-visible-node"},s.performances.renderingMode="adaptive";var o=t.getOptionCommon();o=Object.assign(o,s),t.view=new i(o),a.isFUNActive("FUN075064")&&t.createMultiCheckbox(),t.updateGridViewAfterSync(),t.view.inject(t.container),t._model.search_multiselMode&&t.toggleMultiSelMode(!0),t._managerInit(),t._afterRender()}),this},_afterRender:function(){this.view.empty=function(){},this._parent()}})}),define("DS/SNResultUX/views/helpers/SearchWhatView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","DS/SNResultUX/views/helpers/utils/TimeLine"],function(e,t){"use strict";return e.extend({createTimeline:function(e){let i=this;i._timeline=new t({data:e,dispayState:!0,container:i.container,setLocalFilter:e=>{i._onTitleClick(e,void 0,!0)},rerenderMultiView:e=>{i._resetViews(),i._loadViews(e[0],e[1]+1),i._timeline=void 0}});let n=i._timeline.render();n&&n.inject(i.container)}})}),define("DS/SNResultUX/views/helpers/SearchWhenView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","DS/SNInfraUX/SearchSettings"],function(e,t){"use strict";return e.extend({_computeDisplay:function(){let e=this;e.getCurrentViewId()===e.getViewId()&&(e._ComputeGroup=!0),e._parent()},_loadViews:function(e,i){if(this._parent(e,i),!0!==t.getOption("FUN127551"))return;this.mask();let n=this,s=[];if(i)this.collections.slice(e,i).forEach(e=>{s.push({label:e.headTitle,count:e.totalCount})});else{for(let t=e;t<this.collections.length;++t)s.push({label:this.collections[t].headTitle,count:this.collections[t].totalCount});let t=this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().getTimelineComponentData();s=t.concat(s)}let o=this.collection.getTaggerProxy();this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().showTimelineView(s,this._retrieveAllDatesFromCollection(),e=>n._setLocalFilter(o,e),()=>{}),this.unmask()}})}),define("DS/SNResultUX/views/helpers/SearchWhereView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","UWA/Core","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/Logger","DS/SNResultUX/views/helpers/utils/SearchGlobeViewUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c){"use strict";return e.extend({_lastGroup:null,_lastRefineCountry:"continent",_lastDataSourceGroup:null,_lastRefineSource:"global",_3DEXPERIENCEActivate:!1,_WhereIsActivate:!1,_MustRebuildTheGroup:!1,_lastSourceTag:null,_MaxDisplay:!1,_updateTitle:!1,_mustUpdateGroup:!1,init:function(e){this._parent(e),this._lastGroup=null,this._lastRefineCountry="continent",this._lastDataSourceGroup=null,this._lastRefineSource="global",this._3DEXPERIENCEActivate=!1,this._WhereIsActivate=!1,this._MustRebuildTheGroup=!1,this._lastSourceTag=null,this._MaxDisplay=!1,this._updateTitle=!1,this._mustUpdateGroup=!1,this.addEvent("onMultiView",this.onMultiView.bind(this))},setup:function(e){let i=this;i.listenTo(i.collection,{onSetTags:function(e){if("where"===i.getCurrentViewId()){t.is(e)&&t.is(e.service_parameters)&&t.is(e.service_parameters.fromTopbar)&&!0===e.service_parameters.fromTopbar&&(i._lastRefineCountry="continent",i._lastRefineSource="global",i._mustUpdateGroup=!0,i._onGroupingCompute=!1)}},onInitTreeDocumentAsyncCB:function(e){a.log("SearchWhereView onInitTreeDocumentAsyncCB Event",e),!0!==i._mustUpdateGroup?i._computeDisplay():a.log("SearchWhereView onInitTreeDocumentAsyncCB _mustUpdateGroup",i._mustUpdateGroup)},OnGroupingChange:function(e){a.log("SearchWhereView OnGroupingChange Event",e),i._refreshViewFromOnGrouping(e)},onInitTreeDocument_SelectFirstElt:function(){},onFilterChange:function(e){if(t.is(e)){i.getCurrentViewId()===i.getViewId()&&i.mask()}}})},switchSearchBackView:function(e,i,n){let s=this.getCurrentViewId();if(s===this.getViewId()&&!t.is(n))return;let o=this.getSNResultMgt(),a=e||o._searchBackViewContainerContent;a&&a.switchOnView(this.getViewId(),i),this._lastNbSection?"what"!==s&&"who"!==s&&"when"!==s&&"where"!==s||o&&o.hideSearchContentSetHeader():"what"!==s&&"who"!==s&&"when"!==s&&"where"!==s&&o&&o.showSearchContentSetHeader()},_refreshViewFromOnGrouping:function(e,i,n=!0){let s=this,o=!1;if(t.is(e)||(o=!0),t.is(e,"object")&&t.is(e.groups,"array")&&0==e.groups.length&&(o=!0),1==o)return s._WhereIsActivate=!1,!0===s._updateTitle&&s.collection&&s.collection.getSNSkeleton().updateCounterView(s.collection.totalCount),void(s._updateTitle=!1);if(!t.is(e,"object")||!t.is(e.groups,"array"))return;let l=s.getViewId(),c=s.getCurrentViewId(),d=r.getPredicateType(s.collection,e),u=!1;if(s._WhereIsActivate=!1,s._updateTitle=!1,t.is(d)&&("computedCountryInfo"!==d&&"ds6w:dataSource"!==d||(u=!0,s._WhereIsActivate=!0,"computedCountryInfo"===d?(t.is(i)||t.is(e)&&t.is(e.forcedUpdate,"boolean")&&!0===e.forcedUpdate)&&!0!==s._mustUpdateGroup||(s._lastGroup=e,!0===s._mustUpdateGroup&&(s._lastGroup.forcedUpdate=!1),s._mustUpdateGroup=!1):"ds6w:dataSource"===d&&((t.is(i)||t.is(e)&&t.is(e.forcedUpdate,"boolean")&&!0===e.forcedUpdate)&&!0!==s._mustUpdateGroup||(s._lastDataSourceGroup=e,!0===s._mustUpdateGroup&&(s._lastDataSourceGroup.forcedUpdate=!1),s._lastRefineSource="global",s._lastSourceTag=void 0,s._mustUpdateGroup=!1)))),!1===u)return s._mustUpdateGroup=!1,s._lastRefineSource="global",s._lastSourceTag=void 0,void(s._onGroupingCompute=!1);let h=s.computeGrouping(e,n);if(t.is(e)&&t.is(e.forcedUpdate,"boolean")&&!0===e.forcedUpdate){!0===s._MustRebuildTheGroup&&(t.is(h)&&t.is(h.country)&&t.is(h.back)&&!0===h.back&&h.country.length>0&&"continent"!==s._lastRefineCountry?s._refineCountryDisplay(h.country):(s._onInitTreeDocumentAsyncCB(e),s._lastRefineCountry="continent",s.collection.getSNSkeleton().switchOnView(l)));let i=r.findCountryByLocalFilters(s.collection);return t.is(i)&&t.is(h.country)&&0!==h.country.length&&s._clearLocalGrouping(),void(s._MustRebuildTheGroup=!1)}if(a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping last Grouping: ",s._lastRefineCountry),s._3DEXPERIENCEActivate=!1,"ds6w:dataSource"===d&&(s._3DEXPERIENCEActivate=!0),t.is(h)&&!t.is(h.data))a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping Refine default View country: ",h.country),s._refreshViewFromRefine(h.country),s._clearLocalGrouping();else if(a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping Grouping",h.data),t.is(h.back)&&!0===h.back){let e=r.findCountryByLocalFilters(s.collection);if(t.is(e)&&t.is(h.country)&&0!==h.country.length)s._refineCountryDisplay(h.country);else if(t.is(e)&&t.is(e.display)){let i=e.display;if(s._lastRefineCountry!==i)s._onInitTreeDocumentAsyncCB(h.data,h.back),s.collection.getSNSkeleton().switchOnView(l);else if(!0===s._3DEXPERIENCEActivate){let e=s.getSNResultMgt(),i=e&&e.getRefineHelpers().globeViewContainerContent,n=r.refineCountry(i),o=n&&n.object,a=n&&n.condition;if(t.is(o,"array")&&t.is(n.source)&&!0===n.source){let e=o.length,t=a&&a.length;(e&&e>1||t&&t>1)&&s._clearLocalGrouping()}else s._onInitTreeDocumentAsyncCB(s._lastDataSourceGroup),s._lastRefineSource="global",s.collection.getSNSkeleton().switchOnView(l)}s._lastRefineCountry=i}else!0===s._3DEXPERIENCEActivate?(s._onInitTreeDocumentAsyncCB(s._lastDataSourceGroup),s._lastRefineSource="global"):s._onInitTreeDocumentAsyncCB(h.data,h.back),s.collection.getSNSkeleton().switchOnView(l)}else a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromOnGrouping Grouping Continent"),s._onInitTreeDocumentAsyncCB(h.data),s._lastRefineCountry="continent",s._lastNbSection=0,"where"===c&&s.collection.getSNSkeleton().switchOnView(l)},_onInitTreeDocumentAsyncCB:function(e){this._parent(e)},_refreshViewFromRefine:function(e){a.log("->SNResultUX/views/helpers/SearchWhereView _refreshViewFromRefine")},_refineCountryDisplay:function(e){let t=this;a.log("->SNResultUX/views/helpers/SearchWhereView _refineCountryDisplay"),t._clearLocalGrouping(),t._lastselectedSearchId&&(a.log("->SNResultUX/views/helpers/SearchWhereView _refineCountryDisplay found selected element: ",t._lastselectedSearchId),l.selectElementInGlobalView(t._lastselectedSearchId,t.collection)),t._lastRefineCountry=e},_computeDisplay:function(){let e=this;e._MustRebuildTheGroup=!1;e.getViewId(),e.getCurrentViewId();let i=r.getPredicateType(e.collection);if(!1===e._WhereIsActivate)return;a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay");let n=e.getSNResultMgt();if(t.is(n)){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay found snResult");let s=n.getRefineHelpers().globeViewContainerContent,o=r.refineCountry(s);if(t.is(o)){if(!0===o.country&&e._lastRefineCountry!==o.countryId)a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay found country: ",o.countryId),e._3DEXPERIENCEActivate=!1,e._refineCountryDisplay(o.countryId);else if(t.is(o.continent)){e._3DEXPERIENCEActivate=!1;let i=o.continent;if(t.is(i)&&i.length&&t.is(e._lastGroup)){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine continent: ",i);let n=t.clone(e._lastGroup),s=n.groups[0].object,o=s.length;for(let e=0;e<o;e++){let a=s[e];t.is(a)&&a.dispText===i&&(n.groups[0].object=[],n.groups[0].object.push(a),e=o)}a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine continent group: ",n),e._refreshViewFromOnGrouping(n,!0)}}else if(t.is(o.source)&&!0===o.source){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine Source group: ",o.display),e._3DEXPERIENCEActivate=!0;let i=o.condition,n=o.object;if(t.is(n,"array")){let s=n.length,a=i&&i.length;if(1===s&&1===a){let i,n=o.display,s=t.clone(e._lastDataSourceGroup),a=s&&s.groups[0].object,r=a&&a.length,l=0;for(;l<r;l++)i=a[l],t.is(i)&&i.dispText===n&&(t.is(i.subGroups)?s.groups[0].object=i.subGroups:s.groups[0].object=[i],l=r);e._onInitTreeDocumentAsyncCB(s,!0),e._lastRefineSource=n,e.collection.getSNSkeleton().switchOnView(e.getViewId())}else e._clearLocalGrouping()}}}else if("ds6w:where/ds6w:location/ds6w:dataSource"===i){r.findCountryByLocalFilters(e.collection);e._clearLocalGrouping()}else if("ds6w:who/person"===i&&!1===e._3DEXPERIENCEActivate){let t=r.getGroupForPredicateWho(e,e._lastGroup,e._lastRefineCountry),i=t.refine;"continent"===e._lastRefineCountry||i!==e._lastRefineCountry?(e._onInitTreeDocumentAsyncCB(t.group),e._lastRefineCountry=i):e._clearLocalGrouping(),a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine ds6w:who/person")}else{if(t.is(i))if(e._MustRebuildTheGroup=!0,e._onGroupingCompute=!1,!0===e._3DEXPERIENCEActivate)e._refreshViewFromOnGrouping(e._lastDataSourceGroup,!1),e._lastRefineSource="global",e._lastSourceTag=void 0;else{let i=t.is(o)&&t.is(o.continent)&&o.continent;if(t.is(i)&&i.length&&t.is(e._lastGroup)){a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine continent: ",i);let n=t.clone(e._lastGroup),s=n.groups[0].object,o=s.length;for(let e=0;e<o;e++){let a=s[e];t.is(a)&&a.dispText===i&&(n.groups[0].object=[],n.groups[0].object.push(a),e=o)}}e._refreshViewFromOnGrouping(e._lastGroup,!1)}else e._clearLocalGrouping();a.log("->SNResultUX/views/helpers/SearchWhereView _computeDisplay refine Global")}}},manageDisplayChannelView:function(e){let i=this,n=i.collections.length;for(let s=0;s<n;s++){let n=i.collections[s],o="tile";l.manageDisplayChannelView(n,o,e,i.getCurrentViewId(),i);let a=n.moreView;if(t.is(a)){let t=a.viewType,i=a.label;i.setStyle("visibility","visible"),!1===l.ifDisplayViewMore(t,n,e)&&i.setStyle("visibility","hidden")}}},updateListContentAfterCreation:function(e,t,i){l.manageDisplayChannelView(e,t,i,this.getCurrentViewId())},computeGrouping:function(e,i){if(!t.is(e))return;let n=this,s={data:e,back:!1};if(a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping"),a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping input group: ",e),t.is(e.groups)&&t.is(e.groups[0])){let i=r.getPredicateType(n.collection,e);if("computedCountryInfo"===i)a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group from predicate: ",i);else if("ds6w:dataSource"===i)return a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group from predicate: ",i),s;let o=e.groups[0].object;if(1===o.length){let e=o[0];if(t.is(e)&&t.is(e.subGroups)){let i=e.subGroups,o=i.length;if(o>1)s.data.groups[0].object=i,s.back=!0,a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group by countries group: ",i);else if(1===o){let e=r.findCountryByLocalFilters(n.collection);t.is(e)&&t.is(e.predicate)&&t.is(e.object,"array")&&"ds6w:where/ds6w:location/computedCountryInfo"===e.predicate?a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping refine country",i):e=t.is(e)&&e.computedCountryInfo,t.is(e)&&t.is(e.object,"array")&&e.object.length>1?(a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping refine country",i),s.data.groups[0].object=i,s.back=!0,s.country=i[0].dispText):(s.data.groups[0].object=i,s.back=!0,a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group by countries group: ",i))}a.log("->SNResultUX/views/helpers/SearchWhereView computeGrouping group: ",i)}}}return s},retrieveIconandTitle:function(e,i){if(!t.is(e))return;let n=this,s=void 0;if(a.log("->SNResultUX/views/helpers/SearchWhereView retrieveIconandTitle"),t.is(e.groups)&&t.is(e.groups[0])){a.log("->SNResultUX/views/helpers/SearchWhereView retrieveIconandTitle group: ",e.groups[0]);let n=e.groups[0].object,o=n.length;if(1===o){let e=n[0];if(t.is(e)&&t.is(e.subGroups)){if(e.subGroups.length){let t=e.dispText,i=e.iconInfo;i&&i.image;s={headTitle:t,icon:i}}}}else{let e=0;for(;e<o;e++){let a=n[e];if(t.is(a)&&a.dispText===i){let t=a.dispText,i=a.iconInfo;i&&i.image;s={headTitle:t,icon:i},e=o}}}}if(t.is(i)&&t.is(n._lastGroup)&&!t.is(s)){a.log("->SNResultUX/views/helpers/SearchWhereView retrieveIconandTitle input Country: ",i);let e=n._lastGroup.groups[0].object;if(t.is(e)){let n=e.length,o=0;for(;o<n;o++){let a=e[o];if(t.is(a)&&a.dispText===i){let e=a.dispText,t=a.iconInfo;t&&t.image;s={headTitle:e,icon:t},o=n}}if(!t.is(s))for(o=0;o<n;o++){let a=e[o];if(t.is(a)&&t.is(a.subGroups)){let e=a.subGroups;if(t.is(e)){let a=e.length,r=0;for(;r<a;r++){let l=e[r];if(t.is(l)&&l.dispText===i){let e=l.dispText,t=l.iconInfo;t&&t.image;s={headTitle:e,icon:t},o=n,r=a}}}}}}}return s},onMultiView:function(e){},On3DExperienceChange:function(e){let i=this;if(a.log("->SNResultUX/views/helpers/SearchWhereView On3DExperienceChange"),!t.is(i._lastDataSourceGroup))return;if(i._lastRefineSource===e)return;let n,s=e,o=t.clone(i._lastDataSourceGroup),r=o&&o.groups[0].object,l=r&&r.length,c=0;for(;c<l;c++)n=r[c],t.is(n)&&n.dispText===s&&(t.is(n.subGroups)?o.groups[0].object=n.subGroups:o.groups[0].object=[n],a.log("->SNResultUX/views/helpers/SearchWhereView On3DExperienceChange source"),c=l);let d=i.retrieveIconandTitle(i._lastDataSourceGroup,s);if(t.is(d)){let e=d.headTitle;if(a.log("->SNResultUX/views/helpers/SearchWhereView On3DExperienceChange Grouping Label: ",e),t.is(e)&&t.is(n)){(o={dispText:s,identifier:n.object,type:"string",object:{}}).object.predicates=[],o.object.predicates.push({type:"string",predicate:"ds6w:where/ds6w:source/ds6w:dataSource"}),o.object.value=[],o.object.value.push(n.object),i._lastRefineSource=s;let e=i.collection.getTaggerProxy();i._setLocalFilter(e,o,!0)}}},back3DExperience:function(e){let i=this;if(a.log("->SNResultUX/views/helpers/SearchWhereView back3DExperience source: ",e),!t.is(i._lastDataSourceGroup))return;let n=e;"global"===n&&(a.log("->SNResultUX/views/helpers/SearchWhereView back3DExperience back to global Group"),i._onInitTreeDocumentAsyncCB(i._lastDataSourceGroup,!1),i._lastRefineSource=n)},_onTitleClick:function(e,i){a.log("->SNResultUX/views/helpers/SearchWhereView _onTitleClick: ",e);let s,o=this;r.getPredicateType(o.collection);if(t.is(s)||(s=t.is(o._lastGroup)&&!1===o._3DEXPERIENCEActivate?o._lastGroup:t.is(o._lastDataSourceGroup)&&!0===o._3DEXPERIENCEActivate?o._lastDataSourceGroup:o.getSNResultMgt().getEmbeddedTaggerTags()),t.is(s)){let i=s.groups[0].object,a=this.collection.getTaggerProxy(),r=i.length,l=!1,c=0;for(c=0;c<r;c++){let s=i[c];if(s.dispText===e&&(t.is(s.object,"object")&&t.is(s.object.predicates,"array")&&t.is(s.object.value,"array")&&s.object.predicates.length==s.object.value.length?(l=!0,n.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnContinentCategory",persDim:{pd1:e,pd2:"Where View"}}})):l=o._manageFilterForDataSources(s),!0===l)){!1===o._3DEXPERIENCEActivate?o._setLocalFilter(a,s):o.On3DExperienceChange(e);break}}if(!1===l)for(c=0;c<r;c++){let s=i[c];if(t.is(s)&&t.is(s.subGroups)){let i=s.subGroups,l=0,d=i.length;for(;l<d;l++){let s=i[l];if(s.dispText===e){let i=!1;if(t.is(s.object,"object")&&t.is(s.object.predicates,"array")&&t.is(s.object.value,"array")&&s.object.predicates.length==s.object.value.length?(i=!0,n.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnCountryCategory",persDim:{pd1:e,pd2:"Where View"}}})):i=o._manageFilterForDataSources(s),!0===i){o._setLocalFilter(a,s),c=r;break}}}}}}},_manageFilterForDataSources:function(e){let i=!1;if(!t.is(e))return i;let n=e.object;if(t.is(n,"array")){let s=n[0];!t.is(s)||"3DSpace"!==s&&-1===s.indexOf("Swym")||(e.identifier=n,e.object.predicates=[],e.object.predicates.push({type:"string",predicate:"ds6w:where/ds6w:source/ds6w:dataSource"}),e.object.value=[],e.object.value.push(n)),i=!0}return i},_setLocalFilter:function(e,i,n){if(!t.is(i)||!t.is(e))return;let s=this,o=i.object.predicates,a=o&&t.is(o,"array")&&t.is(o[0])&&o[0].predicate,r=[{display:i.dispText,object:i.identifier,type:i.type,predicates:o,value:i.object.value,operator:"OR"}],l={},c=a,d=c.indexOf("ds6w:dataSource");-1===d&&(c="ds6w:where/ds6w:location/",c+=s.getSNResultMgt().getEmbeddedTaggerTags().groups[0].predicate),l[c]=-1===d?{condition:r,isComplex:!0,operator:"OR"}:{condition:r,operator:"OR"};let u={condition:[l],operator:"AND",isSimplified:{version:2}};t.is(n)&&(t.is(s._lastSourceTag)&&u.condition.push(s._lastSourceTag),s._lastSourceTag=t.clone(l)),e.setLocalFilter(u,!0)},refreshViewAfterComputeList:function(){let e=this,i=e.getSNResultMgt().getRefineHelpers().globeViewContainerContent;if(i&&i._showMarkersinfo(!0),r.refresh3DExperienceMarkers(i),!1===e._3DEXPERIENCEActivate){let t=0,i=e.collections.length;for(let n=0;n<i;n++){t+=e.collections[n].hits}if(e._totalCount!==t){e._updateTitle=!0;let i=t.toString()+"/"+e._totalCount.toString();e.collection&&e.collection.getSNSkeleton().updateCounterView(i,c.get("SearchGlobe_Location"))}}else t.is(e._lastRefineSource)&&("global"===e._lastRefineSource?e.collection&&e.collection.getSNSkeleton().updateCounterView(c.get("SearchGlobe_Content")):e.collection&&e.collection.getSNSkeleton().updateCounterView(""))},getMaxDisplay:function(){return this._MaxDisplay},_clearLocalGrouping:function(){let e=this;e.collection&&(e.unmask(),e._totalCountSection=e.collection.totalCount,e.collection.getSNSkeleton().updateCounterView(e._totalCountSection),e.collection.getSNSkeleton().switchOnView(o.getItem("LastSearchViewMode")),e.collection.getTaggerProxy().clearLocalGrouping(),e._WhereIsActivate=!1)},CloseSidePanel:function(){this._lastRefineCountry="continent",this._lastRefineSource="global",this._mustUpdateGroup=!0,this._onGroupingCompute=!1,this._WhereIsActivate=!1,this._lastGroup=null,this._lastDataSourceGroup=null,this._3DEXPERIENCEActivate=!1,this._MustRebuildTheGroup=!1,this._lastSourceTag=null,this._MaxDisplay=!1,this._updateTitle=!1},createTimeline:function(e){}})}),define("DS/SNResultUX/views/helpers/SearchWhoView",["DS/SNResultUX/views/helpers/utils/AbstractMultiView","DS/SNInfraUX/SearchSettings"],function(e,t){"use strict";return e.extend({_loadViews:function(e,i){if(this._parent(e,i),!0!==t.getOption("FUN127551"))return;this.mask();let n=this,s=[],o=this.collection.parsed_response.summaryData.filter(e=>{if("ds6w:who/ds6w:responsible"===e.sixw)return e});s=(o=o.filter((e,t)=>{if(o.findIndex(t=>e.object===t.object)===t)return e})).map(e=>({label:e.object,count:e.count})),this.collections.length>2&&this.collections[0].totalCount<this.collections[1].totalCount&&s.unshift({label:"ME",count:this.collections[0].totalCount,myContent:!0}),this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().showPhonebookView(s,e=>n._onTitleClick(e,void 0,!0)),this.unmask()}})}),define("DS/SNResultUX/views/helpers/utils/TimeLine",["UWA/Core","UWA/Class/View","DS/SNInfraUX/SearchDebug","DS/Controls/Slider","DS/Controls/ProgressBar","DS/UIKIT/Popover","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l){"use strict";return t.extend(i,{tagName:"div",className:"search-timeLine",data:[],timeLineApplyIcon:null,data:null,setLocalFilter:null,rerenderMultiView:null,container:null,timeLineScroller:null,init:function(e){return this.timeLineApplyIcon=null,this.data=null,this.setLocalFilter=null,this.rerenderMultiView=null,this.container=null,this.timeLineScroller=null,this._parent(e)},existAlready:function(){return null!==this.container.querySelector(".search-timeLine-content")},_getStatistic:function(e,t){let i=e.map(e=>e.count).reduce((e,t)=>e+t,0);return e.find(e=>e.label===t).count/i*100},_renderTimeLine:function(t,i){let n=this;null!==document.querySelector(".search-timeLine-content")&&document.querySelector(".search-timeLine-content").destroy();let a=e.createElement("div",{class:"search-timeLine-content"});if(e.is(i)){let t=e.createElement("div",{class:"search-timeline-content-header"});if(i.backArrow){e.createElement("span",{class:"fonticon fonticon-chevron-left"}).inject(t).addEventListener("click",e=>{n._backAction()})}i.title&&e.createElement("p",{class:"search-timeline-content-header-title",content:i.title}).inject(t),t.inject(a)}return t.forEach(i=>{let r=e.createElement("div",{class:"search-timeLine-content-index"}),l=e.createElement("p",{class:"search-timeLine-content-index-title",content:i.label}).inject(r),c=n._getStatistic(t,i.label);new o({target:r,trigger:"hover click",body:i.label+" "+c.toPrecision(2)+"%",position:"top right"}),l.addEventListener("click",e=>{let i=t.find(t=>t.label===e.currentTarget.innerText);n._clickOnTitle(i)}),new s({shape:"linear",value:c,gradientAnimationFlag:!1,displayStyle:"lite"}).inject(r).elements.container.classList.add(c),r.inject(a)}),a},_clickOnTitle:function(e){this.setLocalFilter(e.label),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"Timeline",pd2:e.label}}})},_renderScroller:function(e){this.timeLineScroller=new n({minValue:0,maxValue:e.length-1,value:[0,e.length-1],displayStyle:"vertical"}),this.timeLineScroller.getTextFromValue=(()=>this._hoverSlider(e)),this.timeLineScroller.getContent().addEventListener("change",()=>{this._changeValueSlider()})},_hoverSlider:function(e){if(e[this.timeLineScroller.value[0]]&&e[this.timeLineScroller.value[1]])return e[this.timeLineScroller.value[0]].label+" ; "+e[this.timeLineScroller.value[1]].label},_changeValueSlider:function(){let e=this._getTimeLineTitle();if(this.fromDateInput&&this.toDateInput){let t=new Date(this.dateRange[this.timeLineScroller.value[0]]),i=new Date(this.dateRange[this.timeLineScroller.value[1]]);this.fromDateInput.setMinDate(t),this.toDateInput.setMinDate(t),this.fromDateInput.setDate(t),this.toDateInput.setDate(i),document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this._getDataForTimeLine(),e?{title:e}:void 0))}else document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this.data.slice(this.timeLineScroller.value[0],this.timeLineScroller.value[1]+1),e?{title:e,backArrow:!0}:void 0));this.timeLineApplyIcon.disabled=!1},_getTimeLineTitle:function(){},_backAction:function(){},updateScrollerRange:function(e){0!==e.length&&(this.timeLineScroller.maxValue=e.length-1,this.timeLineScroller.value=[0,e.length-1],r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"refinementWithTimeLineScroller"}}))},setVisibility:function(e){const t=this.container.querySelector(".search-timeLine-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},render:function(){if(this.data=this.getOption("data"),this.setLocalFilter=this.getOption("setLocalFilter"),this.rerenderMultiView=this.getOption("rerenderMultiView"),this.existAlready())return;let t=e.createElement("div",{class:"search-timeLine-container"+(this.getOption("dispayState")?"":" hidden")}),i=e.createElement("div",{class:"search-timeLine-container-content"}).inject(t);this._renderScroller(this.data),this.timeLineScroller.inject(i),this._renderTimeLine(this.data).inject(i),this.timeLineApplyIcon=new a({emphasize:"primary",label:l.get("APPLYButton"),disabled:!0}).inject(t),this.timeLineApplyIcon.getContent().addEventListener("buttonclick",()=>{r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"applyRange"}}),this.container.removeChild(this.container.querySelector(".search-timeLine-container")),this.rerenderMultiView(this.timeLineScroller.value)}),t.inject(this.container)},reset:function(){this.timeLineApplyIcon&&this.timeLineApplyIcon.destroy(),this.timeLineScroller&&this.timeLineScroller.destroy(),this.container.empty(!0)},destroy:function(){this.reset(),this._parent()}})}),define("DS/SNResultUX/views/helpers/utils/TimeLines/TimeLineDate",["DS/SNResultUX/views/helpers/utils/TimeLines/Abstract","UWA/Core","DS/SNInfraUX/SearchDebug","DS/UIKIT/Input/Date","DS/Controls/Button","DS/UIKIT/Alert","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l){"use strict";return e.extend(i,{tagName:"div",className:"search-timeLine",dateScale:void 0,dateRange:[],render:function(){this.dateRange=this.getOption("data"),this._defineDateScale(this.dateRange[0],this.dateRange[this.dateRange.length-1]),this.dateRangeScaled=this._filterByDateScale(this.dateRange),this.minDate=new Date(this.dateRangeScaled[0].value),this.maxDate=new Date(this.dateRangeScaled[this.dateRangeScaled.length-1].value),this.setLocalFilter=this.getOption("setLocalFilter");let e=t.createElement("div",{class:"search-timeLineDate-content-object-list"}).inject(this.container);this._renderScroller(this.dateRangeScaled),this.timeLineScroller.inject(e);let i=this._getTimeLineTitle();this._renderTimeLine(this._getDataForTimeLine(),i?{title:i}:void 0).inject(e);let a=t.createElement("div",{class:"fromToInput"}).inject(this.container),c=t.createElement("div",{id:"from-input-container",class:"input-container"}).inject(a);this.fromDateInput=new n({className:"beginDateInput",placeholder:"Select a begining date",showClearIcon:!0,firstDay:1,min:this.minDate,events:{onChange:()=>{}}}).inject(c);let d=t.createElement("div",{id:"to-input-container",class:"input-container"}).inject(a);this.toDateInput=new n({className:"endDateInput",placeholder:"Select an end date",showClearIcon:!0,firstDay:1,min:this.minDate,events:{onChange:()=>{}}}).inject(d),this.fromDateInput.setMaxDate(this.maxDate),this.toDateInput.setMaxDate(this.maxDate),this.fromDateInput.setDate(this.minDate),this.toDateInput.setDate(this.maxDate),this.alert=new o({visible:!1,autoHide:!0,hideDelay:3e3}).inject(this.container),this.timeLineApplyIcon=new s({emphasize:"primary",label:l.get("APPLYButton"),disabled:!0}).inject(this.container),this.timeLineApplyIcon.getContent().addEventListener("buttonclick",()=>{r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"applyRange"}}),null!==this.fromDateInput.getDate()&&null!==this.toDateInput.getDate()?this.fromDateInput.getDate()<=this.toDateInput.getDate()?this._rerender():this.alert.add({className:"error",message:l.get("timeline.error.invalidInput")}).show():this.alert.add({className:"error",message:l.get("timeline.error.undefinedInput")}).show()})},_getTimeLineTitle:function(){if(!t.is(this.dateScale)||0===this.dateRangeScaled.length)return;let e,i=this.dateRangeScaled[0].value;switch(this.dateScale){case"HOURS":e=new Intl.DateTimeFormat(a.getLanguage(),{month:"long",day:"numeric"}).format(i);break;case"DAYS":e=new Intl.DateTimeFormat(a.getLanguage(),{month:"long"}).format(i);break;case"MONTHS":e=new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric"}).format(i)}return e},_defineDateScale:function(e,t){let i=(t-e)/864e5;this.dateScale=i>=0&&i<1?"DAYS":i>=1&&i<=31?"DAYS":i>31&&i<=365?"MONTHS":"YEARS"},_dateFormat:function(e){return"YEARS"===this.dateScale?new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric"}).format(e):"MONTHS"===this.dateScale?new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric",month:"short"}).format(e):"HOURS"===this.dateScale?new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric",month:"numeric",day:"numeric",hour:"numeric"}).format(e):new Intl.DateTimeFormat(a.getLanguage(),{year:"numeric",month:"short",day:"numeric"}).format(e)},_rerender:function(){let e=this.fromDateInput.getDate(),t=this.toDateInput.getDate();t.setHours(23,59,59,59);let i=this.dateScale;this._defineDateScale(e,t),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"applyTimeLineInput",persDim:{pd1:this.dateScale,pd2:i,pd3:i===this.dateScale?"Date scale not changed":"Date scale changed"}}}),this.dateRangeScaled=this.dateRange.filter(i=>e<=i&&i<=t),this.dateRangeScaled=this._filterByDateScale(this.dateRangeScaled),1===this.dateRangeScaled.length&&this.dateRangeScaled.push(this.dateRangeScaled[0]),this.updateScrollerRange(this.dateRangeScaled);let n=new Intl.DateTimeFormat("en-us").format(this.dateRangeScaled[this.timeLineScroller.value[0]].value),s=new Intl.DateTimeFormat("en-us").format(this.dateRangeScaled[this.timeLineScroller.value[1]].value);this.setLocalFilter({dispText:n+" - "+s,object:{from:n,to:s},type:"date"}),document.querySelector(".search-timeLine-container-content").prepend(this._renderTimeLine(this._getDataForTimeLine(),{title:this._getTimeLineTitle()}))},_clickOnTitle:function(e){this._defineTag(e),r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"TimelineDate",pd2:e.label}}})},_defineTag:function(e){let t={dispText:e.label,object:{},type:"date"},i=this.dateRangeScaled.find(t=>t.label===e.label).value;switch(this.dateScale){case"HOURS":case"DAYS":t.object.from=new Intl.DateTimeFormat("en-us").format(i),t.object.to=new Intl.DateTimeFormat("en-us").format(i);break;case"MONTHS":t.object.from=new Intl.DateTimeFormat("en-us").format(i),t.object.to=new Intl.DateTimeFormat("en-us").format(new Date(i.getFullYear(),i.getMonth()+1,0));break;case"YEARS":t.object.from=new Intl.DateTimeFormat("en-us").format(i),t.object.to=new Intl.DateTimeFormat("en-us").format(new Date(i.getFullYear(),12,0))}this.fromDateInput.setDate(new Date(t.object.from)),this.toDateInput.setDate(new Date(t.object.to)),this.setLocalFilter(t)},_filterByDateScale:function(e){let t=[];return e.forEach(e=>{switch(this.dateScale){case"YEARS":void 0===t.find(t=>t.value.getYear()===e.getYear())&&t.push({label:this._dateFormat(e),value:e});break;case"MONTHS":void 0===t.find(t=>t.value.getMonth()===e.getMonth())&&t.push({label:this._dateFormat(e),value:e});break;case"DAYS":void 0===t.find(t=>new Intl.DateTimeFormat(a.getLanguage()).format(t.value)===new Intl.DateTimeFormat(a.getLanguage()).format(e))&&t.push({label:this._dateFormat(e),value:e});break;case"HOURS":void 0===t.find(t=>t.value.getHours()===e.getHours())&&t.push({label:this._dateFormat(e),value:e})}}),t},_getDataForTimeLine:function(){let e=[];return this.dateRange.filter(e=>this.dateRangeScaled[this.timeLineScroller.value[0]].value<=e&&e<=this.dateRangeScaled[this.timeLineScroller.value[1]].value).forEach(t=>{let i=this._dateFormat(t),n=e.find(e=>e.label===i);void 0===n?e.push({label:i,count:1}):++n.count,"DAYS"!==this.dateScale||e.length}),e}})}),define("DS/SNResultUX/views/helpers/utils/TimeLines/TimeLinePhoneBook",["DS/SNResultUX/views/helpers/utils/TimeLines/Abstract","UWA/Core","DS/SNInfraUX/SearchDebug","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o){"use strict";return e.extend(i,{tagName:"div",className:"search-timeLine",data:null,setLocalFilter:null,rerenderMultiView:null,container:null,init:function(e){return this.data=null,this.setLocalFilter=null,this.rerenderMultiView=null,this.container=null,this._parent(e)},_getTimeLineTitle:function(){return this.currentTitle},_clickOnTitle:function(e){if(s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"Phonebook",pd2:e.label}}}),1===e.label.length){this.data=this.resultSet.filter(t=>{if(t.myContent)return;let i=t.label.split(" ");return i[i.length-1][0].toUpperCase()===e.label?t:void 0});let t=document.querySelector(".search-timeLinePhoneBook-content-object-list");this.currentTitle=e.label,this._renderTimeLine(this.data,{title:this._getTimeLineTitle(),backArrow:!0}).inject(t)}else this.setLocalFilter(e.label)},_getDataForTimeLine:function(){let e=[],t=this.resultSet.find(e=>e.myContent);return t&&this.resultSet.splice(this.resultSet.findIndex(e=>e===t),1),this.alphabet.forEach(t=>{e.push({label:t,count:this.resultSet.filter(e=>{if(e&&e.label){let i=e.label.split(" ");if(i[i.length-1][0].toUpperCase()===t)return e}}).map(e=>e.count).reduce((e,t)=>e+t,0)})}),t&&(e.unshift(t),this.resultSet.unshift(t)),e},_backAction:function(){this.data=this._getDataForTimeLine();let e=document.querySelector(".search-timeLinePhoneBook-content-object-list");this._renderTimeLine(this.data).inject(e)},render:function(){if(this.resultSet=this.getOption("data"),this.setLocalFilter=this.getOption("setLocalFilter"),this.existAlready())return;let e=t.createElement("div",{class:"search-timeLinePhoneBook-content-object"});e.inject(this.container);let i=t.createElement("div",{class:"search-timeLinePhoneBook-content-object-list"}).inject(e);const n=Array.from(Array(26)).map((e,t)=>t+65);this.alphabet=n.map(e=>String.fromCharCode(e)),this.data=this._getDataForTimeLine(),i.append(this._renderTimeLine(this._getDataForTimeLine()))}})}),define("DS/SNResultUX/utils/DosThumbnailBatchHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/WAFData/WAFData"],function(e,t,i,n,s,o,a){"use strict";return t.extend(i,{name:"DS_SNResultUX_utils_ThumbnailHelper",_ViewSyncStatus:{SYNC_STARTED:"SYNC_STARTED",SYNC_ENDED:"SYNC_ENDED"},_dosURLPromise:n.deferred(),_dosURL:null,_collection:null,_dosThumbnailBatchFUN126428Enabled:!1,init:function(e){var t=this;this._collection=e,this._dosThumbnailBatchFUN126428Enabled=s.getOption("dosThumbnailBatchFUN126428Enabled"),this._dosThumbnailBatchFUN126428Enabled?o.getSericeURLPromise(e.getActiveTenant(),"dfsobjectstorage").then(function(e){console.log("DOS URL:",e),t._dosURL=e,t._dosURLPromise.resolve()},function(){t._dosThumbnailBatchFUN126428Enabled=!1,t._dosURLPromise.resolve()}):t._dosURLPromise.resolve()},_getDosURLPromise:function(){return this._dosURLPromise.promise},isReady:function(){return this._getDosURLPromise()},batchUpdateDosThumbnailURLs:function(t){var i=this;if(this._dosThumbnailBatchFUN126428Enabled){var n=i._dosURL+"/webservices/file/ldvspace2dt/",o=[],r={},l={},c={};t.forEach(function(t){if(e.is(t.preview_url,"string"))try{var i=new URL(t.preview_url);r[t.id]=t.preview_url_value,i.href.startsWith(n)&&(o.indexOf(t.preview_url_value)<0?(l[t.preview_url_value]=t.id,o.push(t.preview_url_value)):(c[l[t.preview_url_value]]=c[l[t.preview_url_value]]||[],c[l[t.preview_url_value]].push(t.id),console.log("DUPLICATE DOS PREVIEW URL: ",t.preview_url_value)),t.preview_url_value="")}catch(e){console.log(e.message)}});for(var d=s.getOption("dosThumbnailBatchMax");o.length>0;){var u=o.splice(0,d),h={method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"}};h.data=JSON.stringify(u),h.onComplete=function(t){var n=JSON.parse(t);n.forEach(function(e){r[e.id]=e.url}),n.forEach(function(t){e.is(c[t.id],"array")&&c[t.id].forEach((e,i)=>{r[e]=t.url})}),i.updateThumbnails(r)},h.onFailure=function(e){console.log("Failure: "+e),i.updateThumbnails(r)},a.authenticatedRequest(i._dosURL+"/webservices/batch/fileurls",h)}}},copyFromHelper:function(e){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._dosThumbnailBatchHelper=e._dosThumbnailBatchHelper,this._collection._dosThumbnailBatchHelper._collection=this._collection,this.startFetch(),this.updateThumbnails(e._dosThumbnailBatchHelper._helperId2dosThumburl||{}))},updateThumbnails:function(t){if(this._dosThumbnailBatchFUN126428Enabled)if(this._collection._isAHelper)this._helperId2dosThumburl=this._helperId2dosThumburl||{},e.merge(this._helperId2dosThumburl,t);else{t||(t=this._collection._pendingThumbnails),t&&(this._collection.forEach(function(e){var i=e._attributes.id;t[i]&&(e._attributes.preview_url_value=t[i])}),e.merge(this._collection._pendingThumbnails,t),Object.keys(this._collection._pendingThumbnails).length>0&&this._updateViewThumbnails())}},_updateViewThumbnails:function(){var t=this._collection._pendingThumbnails;if(t){var i=this._collection.getTreeDocument(),n=i.getRoots();i.prepareUpdate(),n.forEach(function(i){if(e.is(i)){var n=i.options.grid.id,s=i.options.grid.preview_url_value,o=t[n];if(o&&s!=o){var a={thumbnail:o};i.updateOptions(a)}o&&delete t[n]}}),i.pushUpdate()}},startFetch:function(){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._pendingThumbnails=this._collection._pendingThumbnails||{})},startViewSync:function(){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._view_sync_status=this._ViewSyncStatus.SYNC_STARTED)},endViewSync:function(){this._dosThumbnailBatchFUN126428Enabled&&(this._collection._view_sync_status=this._ViewSyncStatus.SYNC_ENDED,this._updateViewThumbnails())},destroy:function(){}})}),define("DS/SNResultUX/utils/SNResultTypeCustoHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/PredefinedQueries"],function(e,t,i,n,s,o,a){"use strict";return t.singleton(i,n,{init:function(){},getAdvancedSearchCustoTypeList:function(t,i,n){var s=o.getTypeCusto();return e.is(s)?e.is(i)?i.filter(function(e){if(s[e.uri])return!0}):this.buildFromCustoTypeList(s,n):(e.is(n)&&e.is(n.onFailure)&&e.is(n.onFailure,"function")&&n.onFailure.call(this),i)},getAdvancedSearchCustoInterfaceList:function(t,i){var n=o.getTypeCusto();if(e.is(n)){var s=n[t].interfaceURIs;if(s&&s.length>0)return i.filter(function(e){if(s.indexOf(e.name)>=0)return!0})}return i},getGlobalSearchTypeCustoQuery:function(t){if(e.is(t)&&0!==t.trim().length&&t!==s.SearchTypeEnum.ADVANCED_SEARCH&&t!==s.SearchTypeEnum.MY_CONTENT&&t!==s.SearchTypeEnum.MY_RECENT_CONTENT&&t!==s.SearchTypeEnum.FAVORITE_SEARCH&&0!==t.indexOf(s.SearchTypeEnum.SIMILAR_SEARCH)&&!(a.isAPrefixedPQSearch(t)||a.isAPQSearch(t)||t.indexOf("flattenedtaxonomies:")>=0||t.indexOf("type:")>=0)){var i=o.getSearchTypeCustoQuery();if(i.length>0)return" AND ("+i+")"}return null},buildFromCustoTypeList:function(t,i){var n=[];if(!e.is(t))return n;var s={onComplete:function(s){for(var o in t){var a=o.split(":");if(a[0]===i.vocabId){var r=s[a[1]],l={abstract:!1,description:"",name:a[1],nlsName:r.nlsName,type:t[o].typeRef,uri:o};n.push(l)}}e.is(i)&&e.is(i.onComplete)&&e.is(i.onComplete,"function")&&i.onComplete.call(this,n)},onFailure:function(){e.is(i)&&e.is(i.onFailure)&&e.is(i.onFailure,"function")&&i.onFailure.call(this)}};o.getSearchTypeCustoListNLSNames(s)}})}),define("DS/SNResultUX/utils/ResultUX_customization",["DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","UWA/Class/Collection","DS/WebappsUtils/Performance","require"],function(e,t,i,n,s,o,a,r,l,c){"use strict";var d=s.singleton(a,o,{_type_customization:{},_skeleton_facets:[],_actions_customization:null,_addin_mode:null,_other_ux_options:{},init:function(){this.setDebugMode(t.getDebugMode()),this._actions_customization=new r,this._actions_customization_modules=new r,this._check_type_inheritance=!0===t.getOption("add_taxonomies_in_select_clause")},addCustomization:function(t,i){var s=this,o=t.SearchCustomization,a=0,r=l.now().toString();function d(e,t){var i=!1,c=!1,d=!1;function u(){!0===d&&!0===i&&!0===c&&(a++,!1!==n.is(o)&&a!==o.length||(l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization"}'),t()))}l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadTypeCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),s._loadTypeCustomization(e.type_customization,function(){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadTypeCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),d=!0,u()}),l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadActionsCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),s._loadActionsCustomization(e.actions,function(){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadActionsCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),i=!0,u()}),l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadViewsCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),s._loadViewsCustomization(e.views,function(){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization _loadViewsCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),c=!0,u()})}if(l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization","drilldown":"ResultUX_customization::addCustomization-Detail"}'),s.updateOtherUXOptions(t),n.is(o)){l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization loop on custo","uuid":"'+r+'","status":"start","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}');for(var u=0;u<o.length;u++)c([o[u]],function(e){d(JSON.parse(e),i)},function(t){"timeout"!==t.requireType&&(e.warn("Cannot load view "+t.requireModules),++a===o.length&&(l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization loop on custo","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization-Detail"}'),l.mark('{"module":"DS/SNResultUX/utils/ResultUX_customization","name":"ResultUX_customization::addCustomization","uuid":"'+r+'","status":"end","drilldown_serie_id":"ResultUX_customization::addCustomization"}'),i()))})}else d(t,i)},setAddinMode:function(e){n.is(e,"string")&&(this._addin_mode=e)},updateOtherUXOptions:function(e){n.is(e.datagridview_columns)&&(this._other_ux_options.datagridview_columns=e.datagridview_columns)},getUXOption:function(e){return this._other_ux_options[e]},getDataGridViewColumns:function(){return this.getUXOption("datagridview_columns")},getAvailableActions:function(e,t,i){if(!n.is(e)||!n.is(e.attributes))throw new Error("Invalid Arg in ResultUX_customization.getAvailableActions!");if(n.is(i)&&n.is(i.inCtxOptions))t([]);else{var s=e.attributes["ds6w:what/ds6w:type_value"];n.is(s)||(s=e.attributes["ds6w:type_value"]);var o=this._actions_customization.get({id:d._getModelTypeValue(s)});if(!n.is(o)&&n.is(s,"array"))for(var a=0;a<s.length&&!n.is(o);a++)o=this._actions_customization.get({id:s[a]});if(this._check_type_inheritance&&!n.is(o)){var r=e.attributes.taxonomies_value,l=null;if(n.is(r,"string"))l=r;else if(n.is(r,"array"))for(var c=0;c<r.length;c++)if(n.is(r[c],"string")&&0===r[c].indexOf("types/")){l=r[c];break}if(n.is(l)){var u=l.split("/");if(n.is(u,"array"))for(var h=u.length-2;h>0&&!n.is(o);h--)o=this._actions_customization.get({id:u[h]})}}var g=function(e){t(e)},p=[];if(n.is(o))for(var _=o.get("available_impl"),f=0;f<_.length;f++){let t=_[f].getActionForObject(e.attributes,g,i);n.is(t,"array")&&(p=p.concat(t))}var m=this._actions_customization.get({id:"all"});if(n.is(m))for(var v=m.get("available_impl"),S=0;S<v.length;S++){let t=v[S].getActionForObject(e.attributes,g,i);n.is(t,"array")&&(p=p.concat(t))}t(p)}},availablefacets:function(){var e=[],t=null;t=n.is(this.model)?this.model:this;var s=d._getModelTypeValue(t.get("ds6w:what/ds6w:type_value"));if(!0===n.is(d._type_customization[s]))e.push.apply(e,d._type_customization[s].getAvailableFacetsIdAndOrder());else for(var o in d._skeleton_facets)d._skeleton_facets.hasOwnProperty(o)&&n.is(d._skeleton_facets[o])&&!0===d._skeleton_facets[o].is_facet_avalailable(this)&&e.push(i.result(d._skeleton_facets[o],"facet_idcard"));return e},availableviews:function(){var e={};for(var t in d._skeleton_facets)d._skeleton_facets.hasOwnProperty(t)&&(e[i.result(d._skeleton_facets[t],"facet_name")]=i.result(d._skeleton_facets[t],"facet_options"));return e},getMapping:function(){return{image:function(){var e=this.model||this,t=d._getModelTypeValue(e.get("ds6w:what/ds6w:type_value"));return n.is(d._type_customization[t])&&n.is(d._type_customization[t].image)?d._type_customization[t].image.call(e):e.get("preview_url")},icon:function(){var e=this.model||this,t=d._getModelTypeValue(e.get("ds6w:what/ds6w:type_value"));return n.is(d._type_customization[t])&&n.is(d._type_customization[t].icon)?d._type_customization[t].icon.call(e):e.get("type_icon_url")}}},idcardOptions:function(e,t,i){var s,o={};return n.is(e)&&(s=d._getModelTypeValue(e.get("ds6w:what/ds6w:type_value")||e.get("ds6w:what/ds6w:type"))),n.is(s)&&n.is(d._type_customization[s])&&n.is(d._type_customization[s].getIdCardOpts)?(d.log("ResultUX_customization specific IDCard options set"),o=d._type_customization[s].getIdCardOpts(e)):n.is(t)?(o=d._getResultContentsIdCard(t),n.is(i)&&(o.events=i)):o=d._getResultContentsIdCard(),o},_loadTypeCustomization:function(t,i){if(n.is(t,"array")&&t.length>0)for(var s=0,o=0;o<t.length;o++)require([t[o]],function(e){var o=new e;if(n.is(o.name,"string"))d._type_customization[o.name]=o;else{if(!n.is(o.names,"array"))throw new Error("Invalid type defined");for(var a=0;a<o.names.length;a++)d._type_customization[o.names[a]]=o}++s===t.length&&i()},function(n){"timeout"!==n.requireType&&(e.warn("Cannot load type customization "+n.requireModules),++s===t.length&&i())});else this.log("No type customization loaded"),i()},_loadActionsCustomization:function(t,i){if(n.is(t))for(var s=this,o=0,a=0;a<t.length;a++){var r=t[a];n.is(this._actions_customization_modules.get(r))?++o===t.length&&i():(s._actions_customization_modules.add({id:t[a]}),require([r],function(e){for(var a=new e({addinmode:s._addin_mode}),r=a.availableForTypes(),l=0;l<r.length;l++){var c=s._actions_customization.get({id:r[l]});n.is(c)?(s.log("Update action model"),c.get("available_impl").push(a)):s._actions_customization.add({id:r[l],available_impl:[a]})}++o===t.length&&i()},function(n){"timeout"!==n.requireType&&(e.warn("Cannot load view "+n.requireModules),++o===t.length&&i())}))}else this.log("No actions loaded"),i()},_loadViewsCustomization:function(t,i){if(n.is(t))for(var s=this,o=t.skeleton.facets,a=0,r=0;r<o.length;r++)n.is(s._skeleton_facets[o[r].id])?(this.log("View already added with the same id "+o[r].id),this.log("Do not load "+o[r].implementation),++a===o.length&&i()):(s._skeleton_facets[o[r].id]=null,require([o[r].implementation],function(e){s._skeleton_facets[e.facet_name]=e,++a===o.length&&i()},function(t){"timeout"!==t.requireType&&(e.warn("Cannot load view "+t.requireModules),++a===o.length&&i())}));else this.log("No actions loaded"),i()},_getResultContentsIdCard:function(e){var i=n.is(e)?n.extend(e.mapping,d.getMapping(),!0):d.getMapping();return{thumbnailUrl:function(){return d._getValueWithMapping("image",this,i)},bannerUrl:"",attributesMapping:i,facets:d.availablefacets,nativeActionMenu:!0,actions:function(){var e=[],i=this;return this.actions.forEach(function(s,o){if(o<7){var a={text:s.get("title"),icon:s.get("icon"),handler:s.get("callback")};n.is(s.get("callback"))?a.handler=function(e){var t={model:e.model,action_id:s.get("id"),object_id:e.model.get("id"),collection:e.model.collection};s.get("callback")(t,arguments)}:t.getOption("search_web_in_win")&&n.is(s.get("sourcejs"))&&(a.handler=function(){require([s.get("sourcejs")],function(e){var t={action_id:s.get("id"),object_id:i.get("id")};e.executeAction(t)})}),e.push(a)}}),e}}},_getValueWithMapping:function(e,t,i){var s;if(e in i&&n.is(i[e],"function")){var o={model:t};s=i[e].call(o)}else void 0===(s=t.get(e))&&(s="");return s},_getModelTypeValue:function(e){return n.is(e,"array")?Array.prototype.join.call(e,"/"):e}});return d}),define("DS/SNResultUX/utils/WildcardMgr",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchUtils"],function(e,t,i,n,s,o){"use strict";return t.singleton(i,{_specialSearchCriteria:["*","#all",o.SearchTypeEnum.MY_CONTENT,o.SearchTypeEnum.MY_RECENT_CONTENT,o.SearchTypeEnum.ADVANCED_SEARCH,o.SearchTypeEnum.FAVORITE_SEARCH],_operators:[":","(",")"," AND "," OR ","=","==","!=","<",">","<=",">="," NOT "," BUTNOT "," XOR "," OPT "," NEAR "," NEXT "," AFTER "," BEFORE "," INNERJOIN "," SPLIT "],init:function(){this.setDebugMode(!0)},isASpecialCriteria:function(e){for(var t=!1,i=0;i<this._specialSearchCriteria.length;i++)if(this._specialSearchCriteria[i]===e){t=!0;break}return t},isAnAdvancedCriteria:function(t){if(!e.is(t,"string"))throw new Error("Invalid arg in isAnAdvancedCriteria");for(var i=!1,n=0;n<this._operators.length;n++)if(t.indexOf(this._operators[n])>0){i=!0;break}return i},isAnExactCriteria:function(t){var i=!1;return e.is(t)&&'"'===t[0]&&'"'===t[t.length-1]&&(i=!0),i},containsNonLatinChars:function(t){if(!e.is(e.is(t,"string")))throw new Error("Invalid arg in WildcardMgr.containsNonLatinChars");var i=!1,n=0;for(n=0;n<t.length&&!1===i;n++)t.charCodeAt(n)>255&&(i=!0);return i},getInfo:function(t){var i={searchCriteria:t};if(e.is(t)){i.searchCriteria.trim().length>0&&(i.searchCriteria=i.searchCriteria.trim()),i.isAnExactCriteria=this.isAnExactCriteria(i.searchCriteria),i.isASpecialCriteria=this.isASpecialCriteria(i.searchCriteria),i.isAdvancedCriteria=this.isAnAdvancedCriteria(i.searchCriteria),i.indexOfTwoDots=i.searchCriteria.indexOf(":"),i.pqAbbrevation=s.isAPQSearch(i.searchCriteria),i.indexOfwildChar=i.searchCriteria.indexOf("*"),i.containsNonLatinChars=this.containsNonLatinChars(i.searchCriteria);var o=i.searchCriteria.split(" ");if(e.is(o))for(var a=0,r=o.length;a<r;a++)if(e.is(o[a])&&s.isAPQSearch(o[a])){var l=o[a].split(":"),c="";if(e.is(l)&&2===l.length){if(0===(c=l[1]).length&&(c="*"),n.getOption("wildcard_addition")){var d=this.isASpecialCriteria(c),u=this.isAnAdvancedCriteria(c),h=this.isAnExactCriteria(c),g=c.indexOf("*"),p=this.containsNonLatinChars(c);h||d||u||p||-1!==g||(c="*"+c+"*")}l[1]=c,o[a]=l.join(":")}}i.searchCriteria=o.join(" "),e.is(i.pqAbbrevation)&&!1===i.isAdvancedCriteria&&(i.searchCriteria=i.searchCriteria.substring(i.indexOfTwoDots+1,i.searchCriteria.length),i.searchCriteria.trim().length>0&&(i.searchCriteria=i.searchCriteria.trim()),i.isASpecialCriteria=this.isASpecialCriteria(i.searchCriteria),i.isAdvancedCriteria=this.isAnAdvancedCriteria(i.searchCriteria),i.isAnExactCriteria=this.isAnExactCriteria(i.searchCriteria),i.indexOfwildChar=i.searchCriteria.indexOf("*"))}return i},manageWildcardAddtion:function(t,i){var s=function(e,t){for(var i=t,n=1;n>0&&i<e.length;){i++;var s=e.charAt(i);"("===s?n++:")"===s&&n--}return i>=e.length&&(i=-1),i};if(t===o.SearchTypeEnum.ADVANCED_SEARCH||t===o.SearchTypeEnum.MY_CONTENT||t===o.SearchTypeEnum.MY_RECENT_CONTENT||t===o.SearchTypeEnum.FAVORITE_SEARCH)return t;null!=t&&t.trim().length>0&&(t=t.trim());var a=!1,r=t.match(/\(([^()]+)\)/g);for(e.is(r,"array")&&1===r.length&&r[0]===t&&(a=!0,t=t.substring(1,t.length-1));t.startsWith("(")&&s(t,0)===t.length-1;)a=!0,t=t.substring(1,t.length-1);var l=this.getInfo(t),c=l.searchCriteria,d=!1,u=e.is(i)?i.addWildCard_inCtx:void 0;return n.getOption("wildcard_addition")||!0===u?e.is(l.pqAbbrevation)?l.isAnExactCriteria||l.isASpecialCriteria||l.isAdvancedCriteria||l.containsNonLatinChars||(l.indexOfwildChar>-1?l.searchCriteria=l.pqAbbrevation+":"+l.searchCriteria:(c=l.pqAbbrevation+":*"+l.searchCriteria+"*",d=!0)):l.isAnExactCriteria||l.isASpecialCriteria||l.isAdvancedCriteria||l.containsNonLatinChars||l.indexOfwildChar>-1||c.length&&(c="*"+l.searchCriteria+"*",d=!0):!e.is(l.pqAbbrevation)||l.isAnExactCriteria||l.isASpecialCriteria||l.isAdvancedCriteria||l.containsNonLatinChars||-1!==l.indexOfwildChar||0!==l.searchCriteria.length||(c=l.pqAbbrevation+":*",d=!0),!d&&e.is(l.pqAbbrevation)&&!1===l.isAdvancedCriteria&&(c=l.pqAbbrevation+":"+c),(a||l.isAdvancedCriteria)&&(c="("+c+")"),c}})}),define("DS/SNResultUX/savedSearch/SavedSearch_ActionHandler",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchVersioning","DS/SNResultUX/utils/SearchServices","DS/UIKIT/Alert","DS/UIKIT/Popover","DS/UIKIT/Input/Text","DS/UIKIT/Input/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/RefineHelper/RefineHelper"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v){"use strict";var S="socket_id_#saved_search_edit#",w="widget_id_#saved_search_edit#";return t.singleton(s,n,{_run_saved_search:!0,executeAction:function(t,i){if(r.getOption("actionsProtocol_FUN065512")){if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("invalid input to action handler");switch(t.action_id){case"run_saved_search":if(1!==t.object_ids.length||!0!==this._run_saved_search)throw new Error("run_saved_search is called with invalid object_ids information");this._runSearch2(t);break;case"rename_saved_search":if(1!==t.object_ids.length)throw new Error("rename_saved_search is called with invalid object_ids information");this.renameSearchUI2(t);break;case"delete_saved_search":this._deleteSearch2(t);break;case"share_saved_search":this._shareSearch(t);break;case"unshare_saved_search":this._unshareSearch(t);break;case"edit_saved_search":this._editSearch(t)}}else{var n=null;if(!e.is(t)||!e.is(t.collection))return void a.error("Missing collection arg !");n=t.collection;var s=this,o=[];Array.isArray(t)?o=t:o.push(t),Array.prototype.forEach.call(o,function(o){switch(o.action_id||t.action_id){case"run_saved_search":s._runSearch(o.object_id,n);break;case"rename_saved_search":var a=n.getSNSkeleton();if(r.getOption("search_web_in_win")){var l=document.getElementById(o.object_cid);if(e.is(a))if("contracted"===a.getIDCardStatus())if(!0===a._isMultiselOn&&"btnGlobal"===o.event_type)l=i[0].view?i[0].view:a._skeleton.container.getElement(".set-detail-view-title"),s.renameSearchUI(o.object_id,l,!1,n);else if("table"===a._skeleton.getViewAt(0).currentViewId){var c=a._skeleton.getViewAt(0).contentsViews.table.view.getManager();l=i[0].view?i[0].view:c._cellSpan,s.renameSearchUI(o.object_id,l,!1,n)}else l=i[0].view?i[0].view:l,s.renameSearchUI(o.object_id,l,!1,n);else{var d=e.extendElement(a._skeleton.container.parentElement).getElement(".right>.skeleton-panel>.facetviews");s.renameSearchUI(o.object_id,d,!0,n)}}else{if(!e.is(i))throw new Error("invalid ui element data for rename_saved_search !");if(i.length>=2)2===i.length?s.renameSearchUI(o.object_id,i[0].getContent?i[0].getContent():i[0].view,!i[1].data,n):e.is(i[1].getContent())&&s.renameSearchUI(o.object_id,i[1].getContent?i[1].getContent():i[0].view,!1,n);else if("table"!==a._skeleton.getViewAt(0).currentViewId||o.target){if(!o.target)throw new Error("invalid ui element data size for rename_saved_search !");s.renameSearchUI(o.object_id,o.target,!1,n)}else s.renameSearchUI(o.object_id,o.cellInfo.cellView.elements.container,!1,n)}break;case"delete_saved_search":s._deleteSearch(o.object_id?o.object_id:o.id,n)}})}},_displayAlert:function(t,i){if(e.is(i)){var n=i.getSNSkeleton().getOption("widgetId");t.widgetId=n,u._displayAlert(t)}else a.error("Bad collection arg !")},renameSearchUI2:function(e){var t=this;e.actionsHelper.hidePopover();var i=new g({target:e.actionsHelper.getTarget(),className:"fav-search-popover",position:"bottom",title:m.get("rename_fav_search"),events:{onHide:function(){this.destroy()}}});e.actionsHelper.setPopover(i),o.create("span",{id:"close-popover-icon",title:m.get("closeButton"),class:"fonticon fonticon-cancel",events:{click:function(t){t.stopPropagation(),e.actionsHelper.hidePopover()}}}).inject(i.getTitle());var n=o.create("form",{class:"formSaveSearch form-inline"}),s=o.create("div",{class:"divNewSearch form-group"});s.inject(n);var a=o.create("span",{id:"fav-search-clear-icon",class:"fonticon fonticon-cancel-circled",events:{click:function(e){e.stopPropagation(),l.setValue(""),this.hide()}}}).inject(s),r=e.actionsHelper.getValue({id:e.object_ids[0],attribute:"ds6w:label"}),l=new p({placeholder:m.get("save_search_default_text"),value:r,class:"newSaveSearchName",id:"newSaveSearchName",maxlength:256,events:{onKeyDown:function(i){this.getValue()?a.show():a.hide(),13===i.keyCode&&(i.preventDefault(),i.stopPropagation(),t._renameSearch2(e,this.getValue()),e.actionsHelper.hidePopover())},onChange:function(){this.getValue()?a.show():a.hide()}}}).inject(s),c=o.create("div",{class:"divBtn"});c.inject(n),new _({value:m.get("OKButton"),className:"primary xsmall okSaveSearch",id:"okSaveSearch",events:{onClick:function(){t.log("Search name="+l.getValue()),t._renameSearch2(e,l.getValue()),e.actionsHelper.hidePopover()}}}).inject(c),new _({value:m.get("CancelButton"),className:"default xsmall cancelSaveSearch",id:"cancelSaveSearch",events:{onClick:function(){t.log("Save canceled"),e.actionsHelper.hidePopover()}}}).inject(c),i.setBody(n),i.show(),l.focus()},renameSearchUI:function(t,i,n,s){if(e.is(s)){var r=this;s._snSkeleton.popover&&(s._snSkeleton.popover.hide(),s._snSkeleton.popover=null),s._snSkeleton.popover=new g({target:i,className:"fav-search-popover",position:n?"top":"bottom",title:m.get("rename_fav_search"),events:{onHide:function(){this.destroy()}}}),o.create("span",{id:"close-popover-icon",title:m.get("closeButton"),class:"fonticon fonticon-cancel",events:{click:function(e){e.stopPropagation(),s._snSkeleton.popover.hide()}}}).inject(s._snSkeleton.popover.getTitle());var l=o.create("form",{class:"formSaveSearch form-inline"}),c=o.create("div",{class:"divNewSearch form-group"});c.inject(l);var d=o.create("span",{id:"fav-search-clear-icon",class:"fonticon fonticon-cancel-circled",events:{click:function(e){e.stopPropagation(),u.setValue(""),this.hide()}}}).inject(c),u=new p({placeholder:m.get("save_search_default_text"),value:s.get(t).get("ds6w:label"),class:"newSaveSearchName",id:"newSaveSearchName",maxlength:256,events:{onKeyDown:function(e){this.getValue()?d.show():d.hide(),13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),r._renameSearch(t,s.get(t).get("ds6w:label"),this.getValue(),s),s._snSkeleton.popover.hide())},onChange:function(){this.getValue()?d.show():d.hide()}}}).inject(c),h=o.create("div",{class:"divBtn"});h.inject(l),new _({value:m.get("OKButton"),className:"primary xsmall okSaveSearch",id:"okSaveSearch",events:{onClick:function(){r.log("Search name="+u.getValue()),r._renameSearch(t,s.get(t).get("ds6w:label"),u.getValue(),s),s._snSkeleton.popover.hide()}}}).inject(h),new _({value:m.get("CancelButton"),className:"default xsmall cancelSaveSearch",id:"cancelSaveSearch",events:{onClick:function(){r.log("Save canceled"),s._snSkeleton.popover.hide()}}}).inject(h),s._snSkeleton.popover.setBody(l),s._snSkeleton.popover.show(),u.focus()}else a.error("Bad collection arg !")},_renameSearch:function(t,n,s,o){var r=this;if(e.is(o)){var l=o.getSearchRessources().getFetchOptions({service_name:"renameSavedSearch",service_data:{id:t,name:s}}),c=l.url,d={onComplete:function(){r._displayAlert({message:m.replace(m.get("rename_search_successful"),{old_name:n,new_name:s}),className:"success"},o),o.get(t).set("ds6w:label",s)},onFailure:function(){r._displayAlert({message:m.replace(m.get("rename_search_failure"),{old_name:n,new_name:s}),className:"error"},o)}};d=e.extend(l,d,!0),i.authenticatedRequest(c,d)}else a.error("Bad collection arg !")},_renameSearch2:function(t,n){var s=this,o=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});if(!function(e){if(e.indexOf("<")>=0||e.indexOf(">")>=0){e=(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/&lt;/g,'<em style="color:red">&lt;</em>').replace(/&gt;/g,'<em style="color:red">&gt;</em>');var i=m.replace(m.get("rename_search_failure"),{old_name:o,new_name:e});return i+="<br>"+m.get("save_search_invalid_character"),t.actionsHelper.displayAlert({message:i,className:"error saveSearchAlert"}),!1}return!0}(n))return!1;var r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify({id:t.object_ids[0],name:n})};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(c){e.is(c,"string")&&(s._initSecurityContext(t,c),l.getSecurityContextPromise().then(function(){var s=l.getSecurityContext();s&&s.trim().length>0&&(r.headers.SecurityContext=s),r.url=c+"/resources/SNAPI/search_services/updateSearch",r.onComplete=function(){t.actionsHelper.setLabel({id:t.object_ids[0],newLabel:n}),t.actionsHelper.displayAlert({message:m.replace(m.get("rename_search_successful"),{old_name:o,new_name:n}),className:"success saveSearchAlert"})},r.onFailure=function(i,s){var r=m.replace(m.get("rename_search_failure"),{old_name:o,new_name:n});if(e.is(s,"string"))try{var l=JSON.parse(s);e.is(l)&&e.is(l.errorCode)&&(r+="<br>"+m.replace(m.get("save_search_error_"+l.errorCode),{name:n,invalidCharString:l.invalidChar}))}catch(e){a.log("Error parsing errorObject",e)}t.actionsHelper.displayAlert({message:r,className:"error"})},i.authenticatedRequest(r.url,r)}))}})},_runSearch:function(t,n){var s=this;if(e.is(n)){var o=n.get(t).get("ds6w:label"),r=n.getSearchRessources().getFetchOptions({service_name:"runSavedSearch",service_data:{id:t}}),l=r.url,c={onComplete:function(t){var i=e.Json.decode(t);if(e.is(i)){var a={},r={};try{r=e.Json.decode(i.searchstring),a.search_criteria=r.query,a.originalSearchCriteria=r.originalSearchCriteria}catch(e){a.search_criteria=i.searchstring}e.is(i.name)&&(a.search_name=i.name),a.tag_filter=e.Json.decode(i.taggerstring),e.is(i.searchOptions)&&e.is(i.searchOptions.source)&&(a.source=i.searchOptions.source),a.savedSearch=!0,n.getSNSkeleton().getSearchActions().dispatchEvent("onRunSavedSearch",a),s._displayAlert({message:m.replace(m.get("run_search_successful"),{search_name:o}),className:"success"},n)}},onFailure:function(){s._displayAlert({message:m.replace(m.get("run_search_failure"),{search_name:o}),className:"error"},n)}};c=e.extend(r,c,!0),i.authenticatedRequest(l,c)}else a.error("Bad collection arg !")},_runSearch2:function(t){var n=this;n._run_saved_search=!1;var s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},data:"id="+t.object_ids[0]};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(o){e.is(o,"string")&&(n._initSecurityContext(t,o),l.getSecurityContextPromise().then(function(){var r=l.getSecurityContext();r&&r.trim().length>0&&(s.headers.SecurityContext=r),s.url=o+"/resources/SNAPI/search_services/savedSearch";var c=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});s.onComplete=function(i){var s=e.Json.decode(i);if(e.is(s)){var o={},r={};try{r=e.Json.decode(s.searchstring),o.search_criteria=r.originalSearchCriteria,o.originalSearchCriteria=r.originalSearchCriteria,o.search_criteria_to_display=r.search_criteria_to_display}catch(e){o.search_criteria=s.searchstring}if("#advancedSearch"===r.originalSearchCriteria)return void n._startIncontextForFavorite(s,t,c);e.is(s.name)&&(o.search_name=s.name);try{o.tag_filter=e.Json.decode(s.taggerstring)}catch(e){a.log(e)}e.is(s.searchOptions)&&(e.is(s.searchOptions.source)&&(o.source=s.searchOptions.source),e.is(s.searchOptions.order_by)&&e.is(s.searchOptions.order_field)&&(o.order_by=s.searchOptions.order_by,o.order_field=s.searchOptions.order_field)),o.savedSearch=!0;var l=f.getSubscriptions({channel:"3DSearch-TabManager-"+t.widget_id,topic:"addTab"});e.is(l,"array")&&l.length>0&&!0!==t.actionsHelper.isInContextMode()&&t.actionsHelper.canOpenATab()?f.publish({channel:"3DSearch-TabManager-"+t.widget_id,topic:"addTab",data:{search_ux_options:{search_options:o,events:{onReady:function(){alert("Ready")}}}}}):t.actionsHelper.dispatchEvent({event:"onRunSavedSearch",params:o}),t.actionsHelper.displayAlert({message:m.replace(m.get("run_search_successful"),{search_name:c}),className:"success"}),n._run_saved_search=!0}},s.onFailure=function(){t.actionsHelper.displayAlert({message:m.replace(m.get("run_search_failure"),{search_name:c}),className:"error"}),n._run_saved_search=!0},i.authenticatedRequest(s.url,s)}))}})},_editSearch:function(t){var n=this;"3DDashboard"===l.identifyClientInfo().identifier&&f.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"search-maximiseEditingFavoriteSearch"}),"3DSpace"===l.identifyClientInfo().identifier&&f.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"openTagger"});var s={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},data:"id="+t.object_ids[0]};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(o){e.is(o,"string")&&(n._initSecurityContext(t,o),l.getSecurityContextPromise().then(function(){var a=l.getSecurityContext();a&&a.trim().length>0&&(s.headers.SecurityContext=a),s.url=o+"/resources/SNAPI/search_services/savedSearch";var r=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});s.onComplete=function(i){var s=e.Json.decode(i);n._startIncontextForFavorite(s,t,r,!0)},s.onFailure=function(){t.actionsHelper.displayAlert({message:m.replace(m.get("fetch_search_failure"),{search_name:r}),className:"error"})},i.authenticatedRequest(s.url,s)}))}})},_startIncontextForFavorite:function(t,i,n,s){var o=this;if(e.is(t)){var l={},u={};e.is(i)&&e.is(i.collection)&&(l.tenant=i.collection.getActiveTenant());try{u=e.Json.decode(t.searchstring),l.search_criteria=u.query,l.originalSearchCriteria=u.originalSearchCriteria}catch(e){l.search_criteria=t.searchstring}var h=d.isActiveWithCurrentVersion([{R2018x:"FD05"},{R2019x:"FD01"},{R2020x:"GA"}]);if(s&&!1===h&&"#advancedSearch"===u.originalSearchCriteria)return void i.actionsHelper.displayAlert({message:m.get("modify_search_not_supported"),className:"error"});e.is(t.name)&&(l.search_name=t.name);try{l.tag_filter=e.Json.decode(t.taggerstring)}catch(e){a.log(e)}e.is(t.searchOptions)&&(e.is(t.searchOptions.source)&&(l.source=t.searchOptions.source),e.is(t.searchOptions.order_by)&&e.is(t.searchOptions.order_field)&&(l.order_by=t.searchOptions.order_by,l.order_field=t.searchOptions.order_field));var g=f.getSubscriptions({channel:"3DSearch-TabManager-"+i.widget_id,topic:"activateInContextSearch"}),p=!1===i.actionsHelper.isAPinnedWidget()&&e.is(g,"array")&&g.length>0,_={widget_id:w,default_with_precond:!0,default_search_criteria:l.search_criteria,precond:void 0,source:l.source,tenant:l.tenant,tag_filter:l.tag_filter,ORDER_BY:l.order_by,ORDER_FIELD:l.order_field,app_socket_id:S,title:s?m.replace(m.get("title_modify_savedsearch"),{search_name:n}):void 0,search_name:n,mode:s?"furtive":void 0,show_banned_types:!1,searchable_types:!0,furtive_options:{min_select:0},UXOptions:{menuMyFavorites:!s,menuMyContent:!s,dnD:!s,dblClk:!s,localActions:!s,searchRecentContent:!s,globalToolbarActions:{saveAsFavorite:!s,export:!s,print:!s}},forceWidgetUXRecreation:!1,closeTransient:!p,modifysavedsearch:s,savedSearch:!0};if("#advancedSearch"===u.originalSearchCriteria){_.advanced_search={showByDefault:!0,searchOnInit:!0,exclusive:!0,selection:{}};var b=t.taggerstring,C=JSON.parse(b).localfilters;for(var y in v.isSimplifiedTaggerFilters(C)&&(C=v.getAllAdvanceFilters(C)),C){var I=y.split("/"),D=I[I.length-1];1===I.length&&(D=D.substring(5)),_.advanced_search.selection[D]||(_.advanced_search.selection[D]=[]),e.is(C[y],"array")&&C[y].forEach(function(e){_.advanced_search.selection[D].push(e.object)})}_.displayValue=""}if(i.manageTabContainerHideShow=p,e.is(o.socket)||(o.socket=c.createSocket({socket_id:S,widgetId:i.actionsHelper.widget_id}),i.service_id=i.actionsHelper.getServiceID({id:i.object_ids[0]}),i.platform_id=i.actionsHelper.getPlatformID({id:i.object_ids[0]}),i.search_name=i.actionsHelper.getValue({id:i.object_ids[0],attribute:"ds6w:label"}),o.socket.addListener("InContextSearch_Response",o._modifySearch.bind(o,i,u)),o.socket.addListener("onCloseTransient",function(e){e&&e.in_apps_search&&e.in_apps_search.widget_id===w&&(o.socket.dispatchEvent("UnregisterContext",{widget_id:w}),c.deleteSocket(S),o.socket.disconnect(),delete o.socket,o.socket=null)})),!0===r.getOption("search_web_in_win"))_.inContextProtocol_FUN073378=!0,o.socket.addListener("InContextInit",function(){InContextSearch({searchString:l.search_criteria,originalSearchCriteria:l.originalSearchCriteria,tag_filter:l.tag_filter,search_name:n}),o.socket.removeListener("InContextInit")}),i.actionsHelper.isInContextMode()&&deactivateInContextSearch({donotshowlastsearch:void 0,notify_to_cpp:!1}),activateInContextSearch(_),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:"#advancedSearch"===u.originalSearchCriteria?"":l.search_criteria}));else{if(e.is(i)&&e.is(i.collection)&&e.is(i.actionsHelper)&&e.is(i.actionsHelper.getClientInfo())&&"3DSpace"===i.actionsHelper.getClientInfo().identifier){var T=i.collection.getTaggerProxy();e.is(T)&&T.unfocus()}o.socket.dispatchEvent("RegisterContext",_),o.socket.dispatchEvent("InContextSearch",_)}}},_modifySearch:function(t,n,s){var o=this;if(this.log("_modifySearch"),"in_app_ok"===s.selected_command){var d=t.object_ids[0];if(!e.is(d,"string"))return;var u=t.search_name;this.log("searchName="+u);var g=s.search_params,p=g.originalSearchCriteria;"#advancedSearch"===n.originalSearchCriteria&&(p="#advancedSearch");var _={query:g.query,originalSearchCriteria:p};this.log("searchParam.search_criteria="+g.query),this.log("searchParam.tagger_criteria="+g.refine);var f={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"},data:{name:u,id:d,searchSpec:_,taggerSpec:g.refine,searchOptions:{},originalSearchCriteria:p}};f.data.taggerSpec||(f.data.taggerSpec=""),g.source&&(f.data.searchOptions.source=g.source),g.order_by&&g.order_field&&(f.data.searchOptions.order_by=g.order_by,f.data.searchOptions.order_field=g.order_field),f.data=JSON.stringify(f.data),t.actionsHelper.getServiceURL({id:d,service_id:t.service_id,platform_id:t.platform_id,onComplete:function(n){e.is(n,"string")&&(o._initSecurityContext(t,n),l.getSecurityContextPromise().then(function(){var t=l.getSecurityContext();t&&t.trim().length>0&&(f.headers.SecurityContext=t),f.url=n+"/resources/SNAPI/search_services/updateSearch";var s=f.url,o={onComplete:function(t){var i=e.Json.decode(t);if(e.is(i)){var n={visible:!0,autoHide:!0,closable:!0,messages:[{message:m.replace(m.get("modify_search_successful"),{search_name:i.name}),className:"success saveSearchAlert"}]};new h(n).inject(e.extendElement(document.body),"top")}},onFailure:function(t,i){var n=m.replace(m.get("save_search_failure"),{search_name:u});if(e.is(i,"string"))try{var s=JSON.parse(i);e.is(s)&&e.is(s.Error)&&(n+="<br>"+s.Error)}catch(e){a.error("Error parsing errorObject:",e)}new h({visible:!0,autoHide:!1,closable:!0,messages:[{message:n,className:"error saveSearchAlert"}]}).inject(e.extendElement(document.body),"top")}};o=e.extend(f,o,!0),i.authenticatedRequest(s,o)}))}})}!0===r.getOption("search_web_in_win")?deactivateInContextSearch({donotshowlastsearch:void 0,notify_to_cpp:!1,action_id:t.action_id}):o.socket.dispatchEvent("UnregisterContext",{widget_id:w}),c.deleteSocket(S),o.socket.disconnect(),delete o.socket,o.socket=null},_deleteSearch:function(t,n){var s=this;if(e.is(n)){var o=n.get(t).get("ds6w:label"),r=n.getSearchRessources().getFetchOptions({service_name:"deleteSearch",service_data:{id:t}}),l=r.url,c={onComplete:function(){var i=n.size(),a=n.get(t),r=n.indexOf(a),l=n.getSNSkeleton();if(e.is(l)){var c=l.getIDCardStatus();if("expanded"===c||"collapsed"===c){var d=l._skeleton;if(1===i)d.slideBack();else{var u=0;if((u=r===i-1?r-1:r+1)>=0){var h=n.at(u);if(e.is(h)){var g="/onesearch/";g+=h.id+"/?f=0",d.setRoute(g)}}}}n.remove(t)}s._displayAlert({message:m.replace(m.get("delete_search_successful"),{search_name:o}),className:"success"},n)},onFailure:function(){s._displayAlert({message:m.replace(m.get("delete_search_failure"),{search_name:o}),className:"error"},n)}};c=e.extend(r,c,!0),i.authenticatedRequest(l,c)}else a.error("Bad collection arg !")},_deleteSearch2:function(t){var n=this,s={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"},data:JSON.stringify({id:t.object_ids.join()})};t.actionsHelper.getServiceURL({id:t.object_ids[0],onComplete:function(o){e.is(o,"string")&&(n._initSecurityContext(t,o),l.getSecurityContextPromise().then(function(){var e=l.getSecurityContext();e&&e.trim().length>0&&(s.headers.SecurityContext=e),s.url=o+"/resources/SNAPI/search_services/deleteSearch";var n=t.object_ids.length>1,a=t.actionsHelper.getValue({id:t.object_ids[0],attribute:"ds6w:label"});s.onComplete=function(){t.actionsHelper.deleteResults({ids:t.object_ids}),t.actionsHelper.displayAlert({message:n?m.get("delete_search_successful_multi"):m.replace(m.get("delete_search_successful"),{search_name:a}),className:"success"})},s.onFailure=function(){t.actionsHelper.displayAlert({message:n?m.get("delete_search_failure_multi"):m.replace(m.get("delete_search_failure"),{search_name:a}),className:"error"})},i.authenticatedRequest(s.url,s)}))}})},_shareSearch:function(t){var n=this,s=t.object_ids[0],o=t.actionsHelper.getValue({id:s,attribute:"ds6w:label"}),a={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"}};a.data=JSON.stringify({id:s}),t.actionsHelper.getServiceURL({id:s,onComplete:function(s){e.is(s,"string")&&(n._initSecurityContext(t,s),l.getSecurityContextPromise().then(function(){var n=l.getSecurityContext();n&&n.trim().length>0&&(a.headers.SecurityContext=n),a.url=s+"/resources/SNAPI/search_services/savedSearch/lifecycle/share";var r={onComplete:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("share_search_successful"),{search_name:o}),className:"success"})},onFailure:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("share_search_failure"),{search_name:o}),className:"error"})}};r=e.extend(a,r,!0),i.authenticatedRequest(a.url,r)}))}})},_unshareSearch:function(t){var n=this,s=t.object_ids[0],o=t.actionsHelper.getValue({id:s,attribute:"ds6w:label"}),a={method:"POST",headers:{Accept:"application/json, application/xml","Content-Type":"application/json"}};a.data=JSON.stringify({id:s}),t.actionsHelper.getServiceURL({id:s,onComplete:function(s){e.is(s,"string")&&(n._initSecurityContext(t,s),l.getSecurityContextPromise().then(function(){var n=l.getSecurityContext();n&&n.trim().length>0&&(a.headers.SecurityContext=n),a.url=s+"/resources/SNAPI/search_services/savedSearch/lifecycle/unshare";var r={onComplete:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("unshare_search_successful"),{search_name:o}),className:"success"})},onFailure:function(){t.actionsHelper.displayAlert({message:m.replace(m.get("unshare_search_failure"),{search_name:o}),className:"error"})}};r=e.extend(a,r,!0),i.authenticatedRequest(a.url,r)}))}})},_initSecurityContext:function(e,t){l.initSecurityContext({url:t,tenant:e.actionsHelper.getPlatformID({id:e.object_ids[0]})})}})}),define("DS/SNResultUX/utils/ConfigActions",["UWA/Core","UWA/Controls/Abstract","UWA/Utils/InterCom","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences"],function(e,t,i,n,s){"use strict";return t.extend({name:"Config_Explore_Action",_compass_socket:null,_action_info:null,_role_check_promise:null,init:function(){this._action_info=[{title:"Tree View",icon:"network",id:"config_explore",multisel:!1,callback:this.launchCustoAction.bind(this)}]},availableForTypes:function(){var e=[];return s.getItem("nav_history")&&(e=["Product Configuration","Configuration Feature","Configuration Option","VPMCfgConfiguration","VPMReference"]),e},getActionForObject:function(){return this._action_info},launchCustoAction:function(t){if(!e.is(t))throw new Error("INVALID data received while trying to execute the whereUsed action");var s=t.actionsHelper,o=t.object_ids[0],a={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:t.widget_id,data:{items:[{envId:s.getPlatformID({id:o}),serviceId:s.getServiceID({id:o}),contextId:"",objectId:o,objectType:s.getValue({id:o,attribute:"ds6w:type"}),displayName:s.getValue({id:o,attribute:"ds6w:label"}),displayType:s.getValue({id:o,attribute:"ds6w:type"})}]}};null===this._compass_socket&&(this._compass_socket=new i.Socket("ConfigActions"),this._compass_socket.subscribeServer("com.ds.compass",window.parent)),this._compass_socket.dispatchEvent("onSetX3DContent",a,"ConfigActions"),n.setContentVisibility("Explore"),n.instantiateAppInSearch("ExploreList","ENOSC2D_AP",a,t),n.instantiateAppInSearch("Explore3D","ENOSC3D_AP",a,t)}})}),define("DS/SNResultUX/views/utils/LightBoxView",["UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","DS/UIKIT/Spinner","DS/Utilities/Utils","DS/Tree/LightBoxView","DS/Controls/TooltipModel","DS/SNResultUX/views/utils/Play3DServices","DS/SNResultUX/views/utils/PropertiesServices","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g){"use strict";return i.extend(e,{_player3D:null,_LightBoxPanel:null,_model:null,_parentContainer:null,_treeDocument:null,_informationPanel:null,_channelView:null,_treeListView:null,_collection:null,_mySpinner:null,_viewerElement:null,_firstInit:!0,_is3DPlay:!1,_debounced3DPlayerLoad:null,_bottomdocking:!0,_treemodel:null,_okNewModel:!0,_skeleton:null,_modelEventTokenForOnAdd:null,init:function(e){this._parent(e);let i=this;i._skeleton=e.skeleton,i._modelEventTokenForOnAdd=null,t.is(e.parentContainer)&&(i._parentContainer=e.parentContainer),t.is(e.model)&&(i._model=e.model),t.is(e.treeDocument)&&(i._treeDocument=e.treeDocument),t.is(e.treeListView)&&(i._treeListView=e.treeListView),t.is(e.collection)&&(i._collection=e.collection,null===i._treeDocument&&(i._treeDocument=i._collection.getTreeDocument())),t.is(e.bottomdocking)&&(i._bottomdocking=e.bottomdocking),t.is(e.widget_id)&&(i._widget_id=e.widget_id),i._debounced3DPlayerLoad=o.debounce(function(e){t.is(e)&&e._is3DPlay&&e.load3DPlayer(e._model,i._skeleton)},300);let n=i._collection.indexOf(i._model);if(-1===n&&(n=0),n>=0){let e=null,s=i._treeDocument.getRoots();t.is(s,"array")&&n<s.length&&(e=s[n],t.is(e)&&(e.select(),l.is3DPlayAvailable(i._model,i._skeleton).then(function(){u.log("Selected object is 3DPlay available")},function(){u.warn("Selected object is NOT 3DPlay available")})))}},onDestroy:function(){t.is(this._modelEventTokenForOnAdd)&&t.is(this._treeDocument)&&t.is(this._treeDocument.getXSO,"function")&&t.is(this._treeDocument.getXSO())&&t.is(this._treeDocument.getXSO().unsubscribe,"function")&&(this._treeDocument.getXSO().unsubscribe(this._modelEventTokenForOnAdd),delete this._modelEventTokenForOnAdd),t.is(this._informationPanel)&&t.is(this._informationPanel.destroy,"function")&&this._informationPanel.destroy(),t.is(this._player3D)&&t.is(this._player3D.dispose,"function")&&this._player3D.dispose(),this._player3D=null,this._LightBoxPanel=null,this._model=null,this._treemodel=null,this._informationPanel=null,this._parent()},destroy:function(){this.onDestroy()},_initPlayer:function(){let e=this;if(null!==e._player3D&&null!==e._LightBoxPanel)return;let i=[];i.push({type:"check",icon:{iconName:"info",fontIconFamily:WUXManagedFontIcons.font3DS,fontIconSize:"2x"},tooltipInfos:new r({shortHelp:g.get("actions.InfoPanel.toolTip"),mouseRelativePosition:!1}),callback:e.onInfoclick.bind(this)}),e._LightBoxPanel=new a({target:e._parentContainer,treeDocument:e._treeDocument,height:"auto",toolbar:i,bigPicturePath:e.CustoOnbigPicturePath.bind(this),onRightViewRequest:e.onCustoOnRightViewRequest.bind(this),onTitleRequest:e.onCustoTitleRequest.bind(this),onMainViewRequest:e.onCustoMainViewRequest.bind(this)});let n=e._LightBoxPanel.getRightDockingElement();if(t.is(n)&&(n.collapsibleFlag=!1,n.dockingZoneSize=420,n.minSize=250,n.visibleDockingZoneFlag=!1),!1===e._bottomdocking){let i=e._LightBoxPanel.elements.dockingZoneContentForBottom;t.is(i)&&i.setStyle("display","none"),i=e._LightBoxPanel.getBottomDockingElement(),t.is(i)&&(i.visibleDockingZoneFlag=!1)}t.is(e._modelEventTokenForOnAdd)&&t.is(e._treeDocument)&&t.is(e._treeDocument.getXSO,"function")&&t.is(e._treeDocument.getXSO())&&t.is(e._treeDocument.getXSO().unsubscribe,"function")&&(e._treeDocument.getXSO().unsubscribe(e._modelEventTokenForOnAdd),delete e._modelEventTokenForOnAdd),e._modelEventTokenForOnAdd=e._treeDocument.getXSO().onAdd(function(t){e.onSelected(t)}),e._LightBoxPanel.addEventListener("close",function(){e.dispatchEvent("onLightBoxPanelClose")}),e._channelView=e._LightBoxPanel.getGridView(),null!==e._channelView&&(e._channelView.options.selection.canMultiSelect=!1,e._channelView.onCellRequest(function(e){let t=e.nodeModel;e.cellView.elements.container.setAttribute("draggable","false"),e.cellView.setTitle(t.options._attributes["ds6w:label"]),e.cellView.setSubtitle(t.options._attributes["ds6w:responsible"]),e.cellView.setPicture(t.options._attributes.preview_url),e.cellView.setIcon(t.options._attributes.type_icon_url),t.isSelected()&&e.cellView.highlight()}),e._channelView.onInfiniteScrollAsync(function(){null!==e._collection&&!1===e._collection._search_in_progress&&(e._collection.hasNextPage()?e._collection.getNextPage({remove:!1,onComplete:function(){e._channelView.infiniteScrollAsyncProcessDone(),e._collection.generateTreeModel(),e._toggleLoader()},onFailure:function(){e._channelView.infiniteScrollAsyncProcessDone()}}):e._channelView.infiniteScrollAsyncProcessDone())}));let s=e._LightBoxPanel.getBottomDockingElement();null!==s&&(s.addEventListener("collapse",function(){t.is(e._informationPanel)&&e._informationPanel.onResize()}),s.addEventListener("expand",function(){t.is(e._informationPanel)&&e._informationPanel.onResize()}))},onInfoclick:function(){let e=this;if(null!==e._LightBoxPanel){let i=e._LightBoxPanel.getRightDockingElement();if(null!==i){null===e._informationPanel&&e.onCustoOnRightViewRequest();let n=i.visibleDockingZoneFlag;i.visibleDockingZoneFlag=!n,!0===i.visibleDockingZoneFlag&&t.is(e._informationPanel)&&e._informationPanel.onResize();let s=e._widget_id;t.is(s)&&t.is(UWA.Widgets)&&t.is(UWA.Widgets.instances)?UWA.Widgets.instances.forEach(function(e){e.id===s&&(!0==!n?e.setValue("previewPanelState_Info",!0):e.setValue("previewPanelState_Info",!1))}):!0==!n?widget.setValue("previewPanelState_Info",!0):widget.setValue("previewPanelState_Info",!1)}}},onCustoMainViewRequest:function(e){let i=this;if(!1!==i._okNewModel){if(null!==e&&null!==e.nodeModel){let n=e.nodeModel;if(i._model=n.options,i._treemodel=n.options,null!==i._model){let e={id:i._model.id},n=i._model.collection.where(e);t.is(n)&&n.length>0&&(i._model=n[0])}}null===i._viewerElement&&(i._viewerElement=n.create("div").inject(e.nodeView),i._viewerElement.setStyle("display","none")),null!==i._LightBoxPanel&&!1===i._LightBoxPanel.visibleFlag||i.onMainViewDisplay(e)}},onMainViewDisplay:function(e){let i=this;l.is3DPlayAvailable(i._model,i._skeleton).then(function(){i._is3DPlay=!0,t.is(i._viewerElement)&&i._viewerElement.setStyle("display","inline"),t.is(i._player3D)?i._debounced3DPlayerLoad(i):l.get3DPlayOptions(i._model,function(e){require(["DS/3DPlayHelper/3DPlayHelper"],function(n){e.container=i._viewerElement,t.is(e.options)||(e.options={}),e.options.callbacks={experience:{ExperienceReady:function(e){u.log("ExperienceReady:",e)}},model:{LoadingError:function(e){u.error("LoadingError:",e)}},asset:{LoadingFinished:function(e){u.log("LoadingFinished:",e),!0===d.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("LoadingFinished3DPlay")}}},i._player3D=new n(e),!0===i._firstInit&&i.setChannelPosition(),i._firstInit=!1})},i._skeleton)},function(){i._is3DPlay=!1,null!==i._viewerElement&&i._viewerElement.setStyle("display","none");let t=e.view.bigPicturePath(e);e.nodeView.setStyles({backgroundImage:"url("+t+")",backgroundSize:"auto",backgroundRepeat:"no-repeat",backgroundPosition:"50% 50%"}),!0===i._firstInit&&i.setChannelPosition(),i._firstInit=!1})},load3DPlayer:function(e,i){if(!t.is(e))return;let n=this;l.get3DPlayOptions(e,function(e){n._player3D.load(e),!0===d.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&t.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("Load3DPlay")},i)},onCustoTitleRequest:function(e){let t=e.nodeModel;e.nodeView.setContent(t.options._attributes["ds6w:label"])},onSelected:function(e){let i=this;if(i._okNewModel=!0,i._model&&t.is(e)&&t.is(e.options)&&i._model.id===e.options.id)i._okNewModel=!1;else if(i._model=e.options,i._treemodel=e.options,null!==i._model){let e={id:i._model.id},n=i._model.collection.where(e);t.is(n)&&n.length>0&&(i._model=n[0],l.is3DPlayAvailable(i._model,i._skeleton).then(function(){u.log("Selected object is 3DPlay available")},function(){u.log("Selected object is NOT 3DPlay available")}))}},activate_deactivate:function(e){let i=this;if(null!==i._LightBoxPanel)if(!0===i._LightBoxPanel.visibleFlag)i._LightBoxPanel.visibleFlag=!1;else{let n=i._collection.indexOf(i._model);if(n>=0){let e=i._treeDocument.getRoots();if(t.is(e,"array")&&n<e.length){let i=e[n];t.is(i)&&i.unselect()}}if(i._model=null,i._treemodel=null,t.is(e)&&null!==e&&(i._model=e),-1===(n=i._collection.indexOf(i._model))&&(n=0),n>=0){let e=null,s=i._treeDocument.getRoots();t.is(s,"array")&&n<s.length&&(e=s[n],i._treemodel=e,t.is(e)&&e.select()),i.onMainViewDisplay({nodeModel:e,nodeView:i._LightBoxPanel.elements.mainViewContent,view:i._LightBoxPanel}),i._LightBoxPanel.visibleFlag=!0,i.setChannelPosition(e)}}},setChannelPosition:function(e){let i=this,n=e;if(!t.is(n)){let e=i._collection.indexOf(i._model);if(-1===e&&(e=0),e>=0){let s=i._treeDocument.getRoots();t.is(s,"array")&&e<s.length&&(n=s[e])}}if(!t.is(i._channelView))return;let s=i._channelView.getScroller();if(t.is(s)){let e=i._channelView.options.defaultCellWidth*i._channelView.options.model.indexOf(n);s.getContent().scrollLeft=e}},CustoOnbigPicturePath:function(e){let i=e.nodeModel;return t.is(i)?i.options._attributes.preview_url:model._attributes.preview_url},onCustoOnRightViewRequest:function(e){},_toggleLoader:function(){let e=this,i=e._channelView.getContent();if(t.is(e._mySpinner))e._mySpinner.toggle();else{let t=n.create("div",{class:"datagrid-loader"});t.setStyle("text-align","center"),t.setStyle("position","relative"),t.setStyle("top","-12px"),t.inject(i),e._mySpinner=(new s).inject(t).show()}},changeModel:function(e){let i=this;t.is(e)&&i._LightBoxPanel&&!1!==e&&(t.is(i._modelEventTokenForOnAdd)&&t.is(i._treeDocument)&&t.is(i._treeDocument.getXSO,"function")&&t.is(i._treeDocument.getXSO())&&t.is(i._treeDocument.getXSO().unsubscribe,"function")&&(i._treeDocument.getXSO().unsubscribe(i._modelEventTokenForOnAdd),delete i._modelEventTokenForOnAdd),i._treeDocument=e,i._LightBoxPanel.setProperties({treeDocument:i._treeDocument}),i._modelEventTokenForOnAdd=i._treeDocument.getXSO().onAdd(function(e){i.onSelected(e)}))}})}),define("DS/SNResultUX/utils/PowerBySearchLocalActions",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/MessageBus/MessageBus"],function(e,t,i,n,s,o,a){"use strict";return t.singleton(i,{init:function(){this._subscribePowerByIntegration()},getPowerByActions:function(e){var t=this;this.powerByActionsPromise||(this.powerByActionsPromise=new n(function(t,i){e.options.isAddinMode?o.getPowerByInitPromise().then(function(){a.subscribe({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsRes",callback:function(e){t(e)}}),a.publish({channel:"SearchUXPowerByIntegration",topic:"HasPowerByActionsReq",data:{}})}):t("server")})),this.powerByActionsPromise.then(function(i){"server"===i?e.server_actions.call():"local"===i&&(t._queue.push(e.options),a.publish({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsReq",data:e.options.data}))})},_subscribePowerByIntegration:function(){this._queue=[],a.subscribe({channel:"SearchUXPowerByIntegration",topic:"PowerByActionsRes",callback:this._onPowerByActions.bind(this)})},_onPowerByActions:function(e){this._queue.length>0&&this._queue.shift().onComplete(e)}})}),define("DS/SNResultUX/SearchPQListUX",["UWA/Core","UWA/Class","UWA/Element","DS/UIKIT/Modal","DS/UIKIT/Scroller","DS/UIKIT/Autocomplete","UWA/Promise","DS/SNInfraUX/Logger","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchDebug","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d){"use strict";var u=o.extend({getSuggestions:function(e){h.filterPQs(e)},onHideSuggests:function(){""===this.elements.input.value&&h.filterPQs("")},reset:function(e){h.filterPQs(""),this._parent(e)}}),h=t.singleton(c,{abbreviationsList:[],lAbbreviationsList:[],labelList:[],llabelList:[],liList:[],PQs:[],PQUxPC:a.deferred(),init:function(){},showPQSelector:function(t){var s=t.pqSelectionCallback,o=t.pqAccessMap,a=this;this.PQUxBuilding||(this.PQUxBuilding=!0,l.getPQFetchPromise().then(function(){a.pqSelectionHandler=s,a.pqAccessMap=o;var t=l.getPQs(),c=l.getPQNLS();if(e.is(t)&&e.is(c)){a.load(t,c);var h=i.create("div",{styles:{height:"100%"}}),g=i.create("table",{styles:{height:"100%",width:"100%"}}).inject(h),p=i.create("tbody").inject(g),_=i.create("tr").inject(p),f=i.create("tr",{styles:{height:"100%"}}).inject(p),m=i.create("div",{styles:{height:"100%","padding-top":"10px"},class:"pqListDivP"}).inject(f),v=i.create("div").inject(_),S=(new u).inject(v);a.createPQList(a.labelList,a.abbreviationsList,m),a.pqModalDialog=new n({id:"search-pq-help-panel",className:"search-pq-help-panel",closable:!0,header:d.get("title_pq_ux_dialog"),body:h,footer:"",events:{onHide:function(){},onShow:function(){var e=this.elements.body.getDimensions().width;e<450&&(e=578),this.elements.body.setStyle("height",e),S.elements.input.focus()}}}).inject(document.body),a.PQUxPC.resolve()}else r.error("No PQ to display !")})),this.PQUxPC.promise.then(function(){a.pqModalDialog.show()})},load:function(t,i){if(!e.is(t))throw new Error("Invalid value for PQs in SearchPQListUX.load !");if(!e.is(i))throw new Error("Invalid value for PQsNLS in SearchPQListUX.load !");t.PQ.sort(function(e,t){var n=i[e.pqid+".Title"],s=i[t.pqid+".Title"];return e.custom===t.custom?(n>s)-(s>n):!0===e.custom&&void 0===t.custom?-1:void 0===e.custom&&!0===t.custom?1:void 0});for(var n=0,s=t.PQ.length;n<s;n++){var o=t.PQ[n];if(e.is(o)){this.abbreviationsList.push(o.abbreviations),this.lAbbreviationsList.push(o.abbreviations.toLowerCase());var a=i[o.pqid+".Title"];this.labelList.push(a),a?this.llabelList.push(a.toLowerCase()):this.llabelList.push(a),this.PQs.push(o)}}},createPQList:function(t,n,o){var a=this,r=function(e){a.setSelectedPrefix(e.target.getAttribute("prfix")+":")};l.getPQNLS();for(var c=i.create("div",{styles:{height:"100%"},class:"pqListDiv"}).inject(o),d=i.create("table",{styles:{}}).inject(c),u=0;u<n.length;u++){var h=!0;if(!e.is(a.PQs[u].custom)&&e.is(a.pqAccessMap)&&e.is(a.pqAccessMap[a.PQs[u].pqid])&&(h=a.pqAccessMap[a.PQs[u].pqid]),h){var g=n[u].split(","),p=t[u],_={};_.background=u%2==0?"#F0F0F0":"#FfFfFf";var f=i.create("tr",{styles:_}).inject(d),m=i.create("table",{styles:{width:"100%","table-layout":"fixed"}}).inject(f);this.liList[u]=f;var v=i.create("tbody").inject(m),S=i.create("tr").inject(v),w=i.create("td",{styles:{"word-wrap":"break-word"},class:"pq-line",id:p}).inject(S);i.create("span",{html:p,class:"pq-label"}).inject(w);for(var b=i.create("span",{styles:{float:"right","text-align":"right","word-break":"break-all"},class:"pq-abreviation-list"}).inject(w),C=g.length-1;C>=0;C--){var y=g[C],I=i.create("span",{styles:{float:"right"}}).inject(b);i.create("span",{html:"&nbsp;&nbsp;",styles:{float:"right"}}).inject(I),i.create("a",{html:y+":",events:{click:r},styles:{},class:"pq-abreviation",id:y+":"}).inject(I).setAttributes({prfix:y})}}}new s({element:c}).inject(o)},filterPQs:function(t){var i=this,n=0;if(t&&""!==t.replace(/\s+/g,"")){var s=t.toLowerCase();this.liList.forEach(function(t,o){var a=i.lAbbreviationsList[o],r=i.llabelList[o];e.is(r)&&e.is(a)&&(r.indexOf(s)>-1||a.indexOf(s)>-1?(t.show(),n%2==0?t.setStyle("background","#F0F0F0"):t.setStyle("background","#FfFfFf"),n++):t.hide())})}else this.liList.forEach(function(t,s){var o=i.abbreviationsList[s];e.is(o)&&(t.show(),n%2==0?t.setStyle("background","#F0F0F0"):t.setStyle("background","#FfFfFf"),n++)})},setSelectedPrefix:function(e){this.pqModalDialog.hide(),this.pqSelectionHandler.call(void 0,e)}});return h}),define("DS/SNResultUX/views/helpers/utils/TimeLines/Abstract",["UWA/Core","UWA/Class/View","DS/SNInfraUX/SearchDebug","DS/Controls/Slider","DS/Controls/ProgressBar","DS/UIKIT/Popover","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l){"use strict";return t.extend(i,{tagName:"div",className:"search-timeLine",data:[],timeLineApplyIcon:null,data:null,setLocalFilter:null,rerenderMultiView:null,container:null,timeLineScroller:null,collection:null,init:function(e){return this.timeLineApplyIcon=null,this.data=null,this.setLocalFilter=null,this.rerenderMultiView=null,this.container=null,this.timeLineScroller=null,this.collection=null,this._parent(e)},existAlready:function(){return null!==this.container.querySelector(".search-timeLine-content")},_getStatistic:function(e,t){let i=e.map(e=>e.count).reduce((e,t)=>e+t,0);return e.find(e=>e.label===t).count/i*100},_renderTimeLine:function(t,i){let n=this;null!==document.querySelector(".search-timeLine-content")&&document.querySelector(".search-timeLine-content").destroy();let a=e.createElement("div",{class:"search-timeLine-content"});if(e.is(i)){let t=e.createElement("div",{class:"search-timeline-content-header"});if(i.backArrow){e.createElement("span",{class:"fonticon fonticon-chevron-left"}).inject(t).addEventListener("click",e=>{n._backAction()})}i.title&&e.createElement("p",{class:"search-timeline-content-header-title",content:i.title}).inject(t),t.inject(a)}return t.forEach(i=>{let r=e.createElement("div",{class:"search-timeLine-content-index"}),l=e.createElement("p",{class:"search-timeLine-content-index-title",content:i.label}).inject(r),c=n._getStatistic(t,i.label);new o({target:r,trigger:"hover click",body:i.label+" "+c.toPrecision(3)+"%",position:"top right"}),l.addEventListener("click",e=>{let i=t.find(t=>t.label===e.currentTarget.innerText);n._clickOnTitle(i)}),new s({shape:"linear",value:c,gradientAnimationFlag:!1,displayStyle:"lite"}).inject(r).elements.container.classList.add(c),r.inject(a)}),a},_clickOnTitle:function(e){},_renderScroller:function(e){this.timeLineScroller=new n({minValue:0,maxValue:e.length-1,value:[0,e.length-1],displayStyle:"vertical"}),this.timeLineScroller.getTextFromValue=(()=>this._hoverSlider(e)),this.timeLineScroller.getContent().addEventListener("change",()=>{this._changeValueSlider()})},_hoverSlider:function(e){if(e[this.timeLineScroller.value[0]]&&e[this.timeLineScroller.value[1]])return e[this.timeLineScroller.value[0]].label+" ; "+e[this.timeLineScroller.value[1]].label},_changeValueSlider:function(){let e=this._getTimeLineTitle();if(this.fromDateInput&&this.toDateInput){let t=new Date(this.dateRange[this.timeLineScroller.value[0]]),i=new Date(this.dateRange[this.timeLineScroller.value[1]]);this.fromDateInput.setMinDate(t),this.toDateInput.setMinDate(t),this.fromDateInput.setDate(t),this.toDateInput.setDate(i),document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this._getDataForTimeLine(),e?{title:e}:void 0))}else document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this.data.slice(this.timeLineScroller.value[0],this.timeLineScroller.value[1]+1),e?{title:e,backArrow:!0}:void 0));this.timeLineApplyIcon.disabled=!1},_getTimeLineTitle:function(){},_backAction:function(){},updateScrollerRange:function(e){0!==e.length&&(this.timeLineScroller.maxValue=e.length-1,this.timeLineScroller.value=[0,e.length-1],r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"refinementWithTimeLineScroller"}}))},setVisibility:function(e){const t=this.container.querySelector(".search-timeLine-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},render:function(){},reset:function(){this.timeLineApplyIcon&&this.timeLineApplyIcon.destroy(),this.timeLineScroller&&this.timeLineScroller.destroy(),this.container.empty(!0)},destroy:function(){this.reset(),this._parent()}})}),define("DS/SNResultUX/utils/BroadcastchannelManager",["UWA/Class","UWA/Core","UWA/Event","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger","DS/SNResultUX/utils/SearchServices","DS/TagNavigator/TaggerNLS","css!DS/TagNavigator/TagNavigator"],function(e,t,i,n,s,o,a,r){"use strict";return e.extend(i,{init:function(){this._dropDownMenu6W=[],this._dropDownCont6W=null,this._listOfTooltip=[],this.embeddedTaggerContent=null,this.embeddedTaggerContainer=null,this.resultMgt=null,this._BroadcastChannel=null,this._dropDownCrit=null,this._parent()},setup:function(e){this._dropDownMenu6W=[],this._dropDownCont6W=null,this._listOfTooltip=[],this._dropDownCrit=null,this.embeddedTaggerContent=e&&e.embeddedTaggerContent,this.embeddedTaggerContainer=e&&e.embeddedTaggerContainer,this.embeddedTaggerContainer&&this.embeddedTaggerContainer.setStyle("display","none"),this.resultMgt=e&&e.resultMgt,this._BroadcastChannel&&this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=new BroadcastChannel("EmbeddedTaggerViewWebInWinProxy"),this._parent(e)},destroy:function(){this._cleanUpEmbedded(),this._BroadcastChannel.close(),this._BroadcastChannel&&delete this._BroadcastChannel,this._BroadcastChannel=null,this.embeddedTaggerContent=null,this.embeddedTaggerContainer=null,this.resultMgt=null,this._dropDownCrit&&this._dropDownCrit.destroy(),this._parent()},getBroadcastchannel:function(){return this._BroadcastChannel},listenBroadcast:function(){let e=this;t.is(e._BroadcastChannel)&&(e._BroadcastChannel.onmessage=(i=>{if(t.is(i)&&t.is(i.data)){o.log("BroadcastChannel onmessage",i.data);const{type:n="",message:r="",viewid:l="",value:c=""}=i.data;if("refresh_view"===n){e._cleanUpEmbedded(),e.embeddedTaggerContent.insertAdjacentHTML("afterbegin",r);for(const t of e.embeddedTaggerContent.querySelectorAll(".sub-label")){let i=new s({position:"bottom",target:t,body:t.textContent,className:"embedded-subLabel-tooltip"});e._listOfTooltip.push(i)}for(const t of e.embeddedTaggerContent.querySelectorAll(".chevron-div")){let i=new s({position:"bottom",target:t,body:t.getAttribute("nls"),className:"embeddedW-predicate-tooltip"});e._listOfTooltip.push(i)}for(const i of e.embeddedTaggerContent.querySelectorAll(".root-icon-div, .button-text"))i.onclick=function(i){let n=i;if(t.is(n)&&t.is(n.path)){let i=n.path.find(e=>e.id);if(t.is(i)){let t={type:"clickOnW",viewid:i.getAttribute("id")};o.log("BroadcastChannel postMessage clickOnW ",t),e._BroadcastChannel.postMessage(t)}}};let i=e.embeddedTaggerContent.querySelector(".active-predicate-list");if(t.is(i)){const n=i.getElementsByTagName("li");let s=n.length,o=0;for(;o<s;o++){let i=n[o];t.is(i)&&(i.onclick=function(i){let n=i;if(t.is(n)&&t.is(n.path)){let s=n.path.find(e=>e.id);t.is(s)&&e._clickOnTagActions(i,this)}})}}for(const t of e.embeddedTaggerContent.querySelectorAll(".clear-active-tags"))t.onclick=function(t){let i={type:"clearRefine",message:"clearRefine"};o.log("BroadcastChannel postMessage clearRefine ",i),e._BroadcastChannel.postMessage(i)};for(const i of e.embeddedTaggerContent.querySelectorAll(".chevron-cont"))i.onclick=function(n){let s=n;if(t.is(s)&&t.is(s.path)){let n=s.path.find(e=>e.id);if(t.is(n)){let t={type:"dropDownMenu",viewid:n.getAttribute("id")};e._dropDownCont6W=i,o.log("BroadcastChannel postMessage dropDownMenu ",t),e._BroadcastChannel.postMessage(t)}}}}else if("dropDownMenu"===n){let i=e._dropDownMenu6W[l];if(!t.is(i)){let n={view:l,menus:JSON.parse(r),target:e._dropDownCont6W};i=e.createDropdown(n),t.is(i)&&(e._dropDownMenu6W[l]=i,i.show())}}else if("onsearchInputkeyupFilter"===n){let i=JSON.parse(r),n=t.is(e._dropDownMenu6W[l])&&e._dropDownMenu6W[l];t.is(n)&&n.addItem(i),t.is(n)&&n.updateView(),t.is(n)&&n.updatePosition(null)}else if("showEmbeddedTaggerView"===n&&!1===a.getTaggerDisplayStatus()&&t.is(e.embeddedTaggerContainer)){e.embeddedTaggerContainer.setStyle("display","block");let i=t.extendElement(e.embeddedTaggerContainer.querySelector(".embedded-tagger-view"));t.is(i)&&i.setStyle("display","block")}else"hideEmbeddedTaggerView"===n&&e.embeddedTaggerContainer&&e.embeddedTaggerContainer.setStyle("display","none")}}))},_cleanUpEmbedded:function(){let e=this,i=e._listOfTooltip.length-1;for(let t=i;t>=0;t--){let i=e._listOfTooltip[t];i&&i.destroy()}e._listOfTooltip=[];let n=Object.keys(e._dropDownMenu6W);for(let s=i=n.length-1;s>=0;s--){let i=e._dropDownMenu6W[n[s]];t.is(i)&&(t.is(i.hide,"function")&&i.hide(),t.is(i.removeEvents,"function")&&i.removeEvents(),t.is(i.destroy,"function")&&i.destroy())}if(e._dropDownMenu6W=[],e._dropDownCont6W=null,e.embeddedTaggerContent)for(;e.embeddedTaggerContent.firstChild;)e.embeddedTaggerContent.removeChild(e.embeddedTaggerContent.firstChild)},createDropdown:function(e){let i=this,s=void 0;if(!t.is(e))return s;let a=e.target,r=e.menus,l=e.view;(s=new(n.extend({init:function(e){this._parent(e)},_onKeyDown:function(e){[13,27,37,38,39,40].includes(e.which)&&this._parent(e)},resize:function(){let e=document.activeElement;var t=navigator.userAgent.toLowerCase().indexOf("android")>-1;e&&"search-input"==e.id&&t||this._parent()},_onMouseover:function(e){var i,n,s,o=t.is(Event.getElement,"function")?Event.getElement(e):t.extendElement(e.target),a=o.id;if(!o.hasClassName("item")){let e=o.getClosest("li.item");e&&(a=(o=e).id)}if(a=a||o.parentElement.id||o.parentElement.parentElement.id,n=this._getMenuFromParentItem(a),!(o.hasClassName("item-back")||n&&n._position&&n._position.contains("dropdown-menu-responsive-wrap")||(this.timeoutId&&clearTimeout(this.timeoutId),this.usingKeyboard))){if(!(s=this.template.getItem(o)))return;(s=this.getItem(s.id?s.id:s))&&this._handleItemSelection(s.elements.container)}this.options.responsiveMode&&(s=o.parentElement.classList.contains("next-icon")?o.parentElement.parentElement:o.parentElement,s=(n=this._getMenuFromItem(s.id))&&n.getItem(s.id),i=n&&n.getContent().hasClassName("responsive-menu"),s&&i&&(o.classList.contains("next-icon")||o.parentElement.classList.contains("next-icon"))&&!s.elements.container.classList.contains("selected")&&(s.elements.container.addClassName("js-not-selectable"),s.elements.container.removeClassName("js-selected")))}}))({target:a,className:"tn-embedded-menu tn-"+l.replace("ds6w:","")+"-menu",multiSelect:!0,closeOnClick:!1,items:r,position:"bottom right",removeOnHide:!0,viewId:l,zindex:200,events:{onShow:function(){this.options.target.parentElement&&t.extendElement(this.options.target.parentElement).addClassName("shown");let e=this.items;for(let t=0;t<e.length;t++)e[t].elements.container.getElement(".tag-label")&&(e[t].elements.container.getElement(".tag-label").style.width="calc(100% - "+(38+e[t].elements.container.getElement(".tag-count").getDimensions().width)+"px)",e[t].elements.container.getElement(".tag-label").addClassName("add-ellipsis"));this.menus.forEach(function(e){e.elements.container.addClassName("tn-embedded-menu tn-"+l.replace("ds6w:","")+"-menu")})},onHide:function(){this.options.target.parentElement&&t.extendElement(this.options.target.parentElement).removeClassName("shown")},onClick:function(e,n,s){let a=e.target.className;if(a.contains("fonticon-right-open")||a.contains("input-field"))return;let r={type:"onClickdropDownMenu",viewid:this.options.viewId,item:JSON.stringify(n)};o.log("BroadcastChannel postMessage onClickdropDownMenu ",r),i._BroadcastChannel.postMessage(r),this.options.target.parentElement&&t.extendElement(this.options.target.parentElement).removeClassName("shown"),this.hide()}}})).getItem("search-field")&&this._getSearchField(s,l);return s.updateView=function(){let e=this.items;for(let t=0;t<e.length;t++)e[t].elements.container.getElement(".tag-label")&&(e[t].elements.container.getElement(".tag-label").style.width="calc(100% - "+(38+e[t].elements.container.getElement(".tag-count").getDimensions().width)+"px)",e[t].elements.container.getElement(".tag-label").addClassName("add-ellipsis"));this.menus.forEach(function(e){e.elements.container.addClassName("tn-embedded-menu tn-"+l.replace("ds6w:","")+"-menu")})},s},_getSearchField:function(e,i){let n=this,a=t.createElement("div",{id:"search-div"}).inject(e.getItem("search-field").elements.container),l=t.createElement("div",{class:"search-input-cont"}).inject(a),c=t.createElement("input",{id:"search-input",type:"text",placeholder:r.getText("search"),class:"input-field",viewId:i}).inject(l),d=t.createElement("i",{class:"emb-clear-input-field fonticon fonticon-cancel-circled",viewId:i}).inject(l),u=new s({position:"bottom",target:d,body:r.getText("embClearSearch"),className:"embeddedW-embClearSearch-tooltip"});n._listOfTooltip.push(u);let h=t.createElement("div",{class:"icon-cont",html:{tag:"span",class:"fonticon fonticon-search"}}).inject(l),g=new s({position:"bottom",target:h,body:r.getText("embSearchTags"),className:"embeddedW-embSearchTags-tooltip"});n._listOfTooltip.push(g);let p=function(e){e.items.forEach((t,i)=>{let n=t.className,s=t.id;"divider"==n?e.removeItem(t.id):"search-field"!==s&&e.removeItem(t.id)});let t=e.items.length-1;for(;t>=0;t--){let i=e.items[t],n=i.className,s=i.id;"divider"==n?e.removeItem(i.id):"search-field"!==s&&e.removeItem(i.id)}};c.addEvent("keyup",function(i){let s=c.value.toUpperCase(),a=l.getElement(".emb-clear-input-field"),r=l.getElement(".icon-cont");p(e),s?(a.addClassName("add-clear"),r.addClassName("hide-lens")):""==s&&(a.removeClassName("add-clear"),r.removeClassName("hide-lens")),e&&e.getItem("no-result-item")&&e.removeItem("no-result-item");let d={type:"onsearchInputkeyup",value:s,viewid:t.extendElement(this).getAttribute("viewId")};o.log("BroadcastChannel postMessage onsearchInputkeyup ",d),n._BroadcastChannel.postMessage(d),c.focus()}),d.addEventListener("click",function(i){let s=l.getElement(".emb-clear-input-field");c.value="",s&&s.removeClassName("add-clear"),h.removeClassName("hide-lens"),p(e);let a={type:"onsearchInputkeyup",value:"",viewid:t.extendElement(this).getAttribute("viewId")};o.log("BroadcastChannel postMessage onsearchInputkeyup ",a),n._BroadcastChannel.postMessage(a),c.focus()})},_clickOnTagActions:function(e,i){let s=this;if(!t.is(i))return;s._dropDownCrit&&s._dropDownCrit.destroy();let a=i,l=-1!==i.className.indexOf("isExcluded"),c=-1!==i.className.indexOf("canBeExcluded"),d=[{text:r.getText("removeTag"),name:"remove",fonticon:"trash"}];l?d.unshift({text:r.getText("unexludeTag"),name:"unexclude",fonticon:"block"}):c&&d.unshift({text:r.getText("excludeTag"),name:"exclude",fonticon:"block"});let u=n.extend({getDisplayContext:function(){let e={},t=document.documentElement;return e.viewportWidth=t.clientWidth||window.innerWidth,e.viewportHeight=t.clientHeight||window.innerHeight,e.scrollTop=window.pageYOffset||document.body.scrollTop||t.scrollTop,e}});s._dropDownCrit=new u({target:a,items:d,renderTo:document.querySelector(".onesearch_results"),events:{onClick:function(e,t){let i=a.id.split("::")[0],n=a.id.split("::")[1],r={type:"clickOnActivecriteria",message:{id:a.getAttribute("id")}},l={};"remove"===t.name?(l={tagName:i,predicate:n,condition:s.condition},r.message.name="remove"):"exclude"===t.name?(l={tagName:i,predicate:n,toExclude:!0},r.message.name="exclude"):"unexclude"===t.name&&(l={tagName:i,predicate:n,toExclude:!1},r.message.name="unexclude"),r.message.option=l,o.log("BroadcastChannel postMessage clickOnActivecriteria ",r),s._BroadcastChannel.postMessage(r)}}}),this._dropDownCrit.show(),e.preventDefault(),e.stopPropagation()}})}),define("DS/SNResultUX/utils/6WRefineHelpers",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Element","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,n,s,o,a,r){"use strict";return t.extend(i,n,o,{referer:null,globeViewContainer:null,globeViewContainerContent:null,globeViewContainerObject:null,globeViewContainerSwitch:null,timelineViewContainer:null,timelineViewContainerContent:null,timelineViewContainerObject:null,timelineViewContainerSwitch:null,timelineViewContainerDocking:null,phonebookViewContainer:null,phonebookViewContainerContent:null,phonebookViewContainerObject:null,phonebookViewContainerSwitch:null,phonebookViewContainerDocking:null,tagcloudViewContainer:null,tagcloudViewContainerContent:null,tagcloudViewContainerObject:null,tagcloudViewContainerSwitch:null,tagCloudViewContainerDocking:null,init:function(e){return this.globeViewContainer=null,this.globeViewContainerContent=null,this.globeViewContainerObject=null,this.globeViewContainerSwitch=null,this.timelineViewContainer=null,this.timelineViewContainerContent=null,this.timelineViewContainerObject=null,this.timelineViewContainerSwitch=null,this.phonebookViewContainer=null,this.phonebookViewContainerContent=null,this.phonebookViewContainerObject=null,this.phonebookViewContainerSwitch=null,this.tagcloudViewContainer=null,this.tagcloudViewContainerContent=null,this.tagcloudViewContainerObject=null,this.tagcloudViewContainerSwitch=null,e&&e.referer&&(this.referer=e.referer),this._parent()},create6WRefineHelpers:function(t,i,n,s,o,a,l){!r.isFUN109031Active()||t||e.is(this.globeViewContainer)||i&&(!i||!0!==n.modifysavedsearch)||(this._createGlobeDOM(a,l,o,s),this._createTimelineDOM(a,l,o,s),this._createPhoneBookDOM(a,l,o,s))},_createGlobeDOM:function(e,t,i,n){let o=this;this.globeViewContainer=s.create("div",{id:"globe-view-"+e+"-"+t,class:"search-globe-view"}),this.globeViewContainerObject=s.create("div",{class:"search-globe-view-object"}),this.globeViewContainerObject.inject(this.globeViewContainer),this.globeViewContainerSwitch=s.create("div",{class:"search-globe-view-switch"}),this.globeViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.globeViewContainerSwitch.onclick=(()=>{o.globeViewContainer.classList.contains("tiny")?(o.globeViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.globeViewContainer.classList.remove("tiny"),o.globeViewContainerContent&&o.globeViewContainerContent.refresh3DExperienceMarkers()):(o.globeViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.globeViewContainer.classList.add("tiny"))}),this.globeViewContainerSwitch.inject(this.globeViewContainer),this.globeViewContainerContent=null,this.hideGlobeView(),this.globeViewContainer.inject(null!==i?i:n)},_createTimelineDOM:function(e,t,i,n){let o=this;this.timelineViewContainer=s.create("div",{id:"timeline-view-"+e+"-"+t,class:"search-timeline-view"}),this.timelineViewContainerObject=s.create("div",{class:"search-timeline-view-object"}),this.timelineViewContainerObject.inject(this.timelineViewContainer),this.timelineViewContainerSwitch=s.create("div",{class:"search-timeline-view-switch"}),this.timelineViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.timelineViewContainerSwitch.onclick=(()=>{o.timelineViewContainer.classList.contains("tiny")?(o.timelineViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.timelineViewContainer.classList.remove("tiny")):(o.timelineViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.timelineViewContainer.classList.add("tiny"))}),this.timelineViewContainerSwitch.inject(this.timelineViewContainer),this.timelineViewContainerContent=null,this.hideTimelineView(),this.timelineViewContainer.inject(null!==i?i:n)},_createPhoneBookDOM:function(t,i,n,o){let a=this;this.phonebookViewContainer=s.create("div",{id:"phonebook-view-"+t+"-"+i,class:"search-phonebook-view"}),this.phonebookViewContainerObject=s.create("div",{class:"search-phonebook-view-object"}),this.phonebookViewContainerObject.inject(this.phonebookViewContainer),this.phonebookViewContainerSwitch=s.create("div",{class:"search-phonebook-view-switch"}),this.phonebookViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.phonebookViewContainerSwitch.onclick=(()=>{a.phonebookViewContainer.classList.contains("tiny")?(a.phonebookViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-up"></span>',this.phonebookViewContainer.classList.remove("tiny")):(a.phonebookViewContainerSwitch.innerHTML='<span class="fonticon fonticon-chevron-down"></span>',this.phonebookViewContainer.classList.add("tiny"))}),this.phonebookViewContainerSwitch.inject(this.phonebookViewContainer),this.phonebookViewContainerDocking=s.create("div",{class:"Search-docking",title:"Collapse the phonebook"}),e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-users"}).inject(this.phonebookViewContainerDocking),e.Element("span",{class:"fonticon fonticon-chevron-right"}).inject(this.phonebookViewContainerDocking),e.Element("span",{class:"fonticon fonticon-chevron-left"}).inject(this.phonebookViewContainerDocking),this.phonebookViewContainerDocking.onclick=(()=>{a.phonebookViewContainer.className.includes("collapsed")?a.phonebookViewContainer.removeClassName("collapsed"):a.phonebookViewContainer.addClassName("collapsed")}),this.phonebookViewContainerDocking.inject(this.phonebookViewContainer),this.phonebookViewContainerContent=null,this.hidePhonebookView(),this.phonebookViewContainer.inject(null!==n?n:o)},hideGlobeView:function(){this.globeViewContainer&&(this.globeViewContainer.style.display="none")},hideTimelineView:function(){this.timelineViewContainer&&(this.timelineViewContainer.style.display="none")},hidePhonebookView:function(){this.phonebookViewContainer&&(this.phonebookViewContainer.style.display="none")},hideTagcloudView:function(){this.tagcloudViewContainer&&(this.tagcloudViewContainer.style.display="none")},showGlobeView:function(){if(null===this.globeViewContainerContent){let t=this;require(["DS/SNResultUX/views/helpers/utils/GlobeView"],function(i){let n={parentContainer:t.globeViewContainerObject,use2D:!1,collection:t.referer.getCollection(),globe:!a.getOption("SearchLeaflet"),resultMgt:t.referer};t.globeViewContainerContent=new i(n),t.globeViewContainerContent.render(n);let s=t.referer.getSNSkeleton().getCurrentView();e.is(s)&&e.is(s.id)&&"where"===s.id&&s.addEvent("onMultiView",function(e){t.globeViewContainerContent.refreshFromMultiview(e)})})}this.globeViewContainer&&(this.globeViewContainer.style.display="")},showTimelineView:function(e,t,i,n){return!1},showPhonebookView:function(e,t,i){if(void 0===e&&(e=[]),null===this.phonebookViewContainerContent){let n=this;require(["DS/SNResultUX/views/helpers/utils/TimeLines/TimeLinePhoneBook"],function(s){n.phonebookViewContainerContent=new s({data:e,dispayState:!0,container:n.phonebookViewContainerObject,setLocalFilter:e=>{t&&t.call(n,e)},rerenderMultiView:e=>{i&&i.call(n,e)}}),n.phonebookViewContainerContent.render()})}else this.phonebookViewContainerContent.setOption("data",e),this.phonebookViewContainerContent.setOption("setLocalFilter",t),this.phonebookViewContainerContent.setOption("rerenderMultiView",i),this.phonebookViewContainerContent.reset(),this.phonebookViewContainerContent.render();this.phonebookViewContainer&&(this.phonebookViewContainer.style.display="")},showTagcloudView:function(){},getTimelineComponentData:function(){return null!==this.timelineViewContainerContent?this.timelineViewContainerContent.data:[]},reset:function(){this.globeViewContainerContent&&this.globeViewContainerContent.destroy(),this.timelineViewContainerContent&&this.timelineViewContainerContent.destroy(),this.phonebookViewContainerContent&&this.phonebookViewContainerContent.destroy(),this.tagcloudViewContainerContent&&this.tagcloudViewContainerContent.destroy(),this.globeViewContainer=null,this.globeViewContainerContent=null,this.globeViewContainerObject=null,this.globeViewContainerSwitch=null,this.timelineViewContainer=null,this.timelineViewContainerContent=null,this.timelineViewContainerObject=null,this.timelineViewContainerSwitch=null,this.timelineViewContainerDocking=null,this.phonebookViewContainer=null,this.phonebookViewContainerContent=null,this.phonebookViewContainerObject=null,this.phonebookViewContainerSwitch=null,this.phonebookViewContainerDocking=null,this.tagcloudViewContainer=null,this.tagcloudViewContainerContent=null,this.tagcloudViewContainerObject=null,this.tagcloudViewContainerSwitch=null,this.tagCloudViewContainerDocking=null},destroy:function(){this.reset()&&this._parent()}})}),define("DS/SNResultUX/webinwin/WebInWinTaggerProxy",["UWA/Core","UWA/Class/Debug","UWA/Class/Events","DS/TagNavigatorProxy/TaggerWebInWinProxy","DS/SNInfraUX/Logger"],function(e,t,i,n,s){"use strict";return n.extend(i,t,{init:function(t){s.log("WebInWinTaggerProxy init:",t),this._parent.call(this,t),this.tenant=t.tenant,this.is6WInWebInWinActive=!!(t&&t.embeddedTagger&&t.embeddedTagger.is6WInWebInWinActive)&&t.embeddedTagger.is6WInWebInWinActive,this._socket&&this._socket.removeListener("onGroupingChange"),this._socket&&this._socket.addListener("onGroupingChange",function(i){e.is(i)&&e.is(i.groups,"array")||s.warn("Error, expect to have parameters.groups as an array !!!"),t.events.addGroupingChangeListener.call(null,i)})},clearLocalGrouping:function(){if(!this.is6WInWebInWinActive||!1!==this.is6WInWebInWinActive){s.log("TaggerWebInWinProxy.clearLocalGrouping sent");var e={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"clearLocalGrouping",proxyId:this._proxyId,contextId:this._contextId}};this._dispatchEvent(e)}},_requestGroupingChange:function(e){s.log("TaggerWebInWinProxy._requestGroupingChange sent");var t={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"_requestGroupingChange",proxyId:this._proxyId,options:e,contextId:this._contextId}};this._dispatchEvent(t)},setEmbeddedViewProperties:function(e){s.log("Received setEmbeddedViewProperties event: "+e);let t={notif_name:"event4taggerWebInWin",notif_parameters:{event_id:"setEmbeddedViewProperties",proxyId:this._proxyId,options:e,contextId:this._contextId}};this._dispatchEvent(t)}})}),define("DS/SNResultUX/views/WebUX/Tree/TreeNodeView",["DS/Tree/TreeNodeView","DS/Core/PointerEvents","DS/Utilities/Dom"],function(e,t,i){"use strict";return e.extend({_observeEvents:function(){var e,n=this,s=0,o=!1;this.elements.container.addEvent(t.POINTERDOWN,function(e){i._increaseCurrentPositionInStack(n.elements.container),o=!1,e.touchFlag||(o=n._uiNodeUpForTouchOrDownForMouse(e,"down")),i._decreaseCurrentPositionInStack()}),this.elements.container.addEvent("click",function(t){i._pushUserInteractionContext();var a=n.getCellInfos();o||!1!==a.isHeader||"selection"===a.dataIndex||"actions"===a.dataIndex||n._uiNodeUpForTouchOrDownForMouse(t,"up"),o=!1,void 0!==e&&clearTimeout(e),e=setTimeout(function(){s=0},300),s++,1===t.which&&((1===s||t.touchFlag&&0===t.detail)&&(a=n.getCellInfos(),n.getGridEngine()._recordInteractionFromUI({event:"node:click",data:{nodeRecordPath:a.nodeModel&&a.nodeModel.getStructurePath?a.nodeModel.getStructurePath():a.nodeModel,virtualRowID:a.virtualRowID,virtualColumnID:a.virtualColumnID}}),n.getGridEngine()._modelEvents.publish({event:"nodeclick",data:a})),2===s&&n.getGridEngine()._modelEvents.publish({event:"nodeDblClick",data:n.getCellInfos()})),i._popUserInteractionContext()}),this._eventDetailDown=0,this._eventDetailDownTO;var a=function(e){i._pushUserInteractionContext(),"touchend"===e.type&&e.preventDefault(),1!==e.which&&"touchend"!==e.type||n._uiExpandCollapse(),i._popUserInteractionContext()};this.elements.expanderContainer.addEvent("mouseup",a),this.elements.expanderContainer.addEvent("touchend",a);var r=function(e){e.stopPropagation(),e.preventDefault()};this.elements.expanderContainer.addEventListener("contextmenu",r),this.elements.expanderContainer.addEventListener(t.LONGHOLD,r)}})}),define("DS/SNResultUX/utils/SNResultPreferences",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/utils/SNPreferenceUtil"],function(e,t,i,n,s){"use strict";return t.singleton(i,{setUserUnitPreference:function(e){s.setUserUnitPreference(e)},getPreferenceUnitForDimension:function(e){return s.getPreferenceUnitForDimension(e)}})}),define("DS/SNResultUX/views/utils/PropertiesView",["UWA/Element","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchUtils","DS/UIKIT/Alert","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","UWA/Core","UWA/Class/Debug","UWA/Class/Collection","DS/W3DXComponents/Views/Temp/TempItemView","DS/W3DXComponents/Skeleton","UWA/Utils/Client","UWA/Controls/Scroller","css!DS/SNResultUX/SNResultUX.css"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p){"use strict";var _="properties",f=["type_icon_url","id","resourceid","resourceid_tagger","preview_url","image","icon","actions","subtitle","icon_source"],m=d.extend(l,{name:_,tagName:"div",template:function(){return 0!==this.model.id.indexOf("swym:")&&!0!==i.getOption("search_web_in_win")&&r.is(this._newEdit)&&!0===this._newEdit?'<div class="'+this.getClassNames("-sub-container")+' propertiesDiv"><div class="properties-body"></div></div>':'<div class="'+this.getClassNames("-sub-container")+' propertiesDiv"><table class="table properties-body"></table></div>'},setup:function(){this.setDebugMode(i.getDebugMode()),this.container.addClassName(this.getClassNames("-container")),this.useNewEditProp(function(e){t.log("Use new Property tab="+e)})},_HTMLDecode:function(e){return e?e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&gt;/g,">")).replace(/&lt;/g,"<")).replace(/&quot;/g,'"')).replace(/&#039;/g,"'"):e},hasPARRole:function(e){var t=this,n=i.getOption("PARRole");if(r.is(n))return t._hasPARRole=!0===n,void e(t._hasPARRole);if(r.is(t._hasPARRole))e(t._hasPARRole);else{t._hasPARRole=!1;try{s.getGrantedRoles(function(i){for(var n=0;n<i.length;n++)i[n]&&"PAR"===i[n].id&&(t._hasPARRole=!0,t._newPropertyReadOnly=!1);e(t._hasPARRole)})}catch(i){t._hasPARRole=!1,e(t._hasPARRole)}}},useNewEditProp:function(e){var t=this;if(r.is(t._newEdit))e(t._newEdit);else{t._newEdit=!1;var n=i.getOption("NewPropertiesTabUIMode");if(r.is(n))return t._newEdit=!0,t._newPropertyReadOnly=!0,"Edit"===n&&(t._newPropertyReadOnly=!1),void e(t._newEdit);t.hasPARRole(function(i){!0===i&&(t._newEdit=!0),e(t._newEdit)})}},onRender:function(){this.log("onRender the PropertiesView");var s=this;s.useNewEditProp(function(l){var c=null,d=null;if(0!==s.model.id.indexOf("swym:")&&!0!==i.getOption("search_web_in_win")&&!0===l){if(c=s.container.getElement(".properties-sub-container"),d=s.container.getElement(".properties-body"),!0!==i.getOption("search_web_in_win")&&require(["DS/PlatformAPI/PlatformAPI"],function(e){var t={paths:[],attributes:{},version:"1.1"},i=[];i[0]=s.model.id,t.paths[0]=i;e.publish("DS/PADUtils/PADCommandProxy/select",t)}),!r.is(c))throw new Error("Unable to find scrollListContainer");if(!r.is(d))throw new Error("Cannot find element editproperties-tbody in the DOM");s._container=d,require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropModel"],function(e,t,i){var n=new e({typeOfDisplay:t.ONLY_EDIT_PROPERTIES,selectionType:t.NO_SELECTION,readOnly:s._newPropertyReadOnly,extraNotif:!0,editMode:!0,events:{onNotification:function(e){var t=null;"error"===e.eventID&&(t="You are not allowed to do that modification",e.msg.length>0&&(t=e.msg),t.length>0&&(s._alert=new o({className:"search-alert",visible:!0,autoHide:!1,closable:!0,messages:t}).inject(s._container,"top"))),"success"===e.eventID&&(t="You are allowed to do that modification",e.msg.length>0&&(t=e.msg),t.length>0&&(s._alert=new o({className:"search-alert",visible:!0,autoHide:!1,closable:!0,messages:t}).inject(s._container,"top")))}}});n.inject(s._container),s._container.addEvents({resize:function(){n.onResize()}});var a=[],r=new i({metatype:"businessobject",objectId:s.model.id});a.push(r),n.initDatas(a)})}else{t.log("swym data"),c=s.container.getElement(".properties-sub-container"),d=s.container.getElement(".properties-body"),e.create("thead",{html:{tag:"tr",html:[{tag:"th",text:a.get("skeleton.facets.properties.propertyKey")},{tag:"th",text:a.get("skeleton.facets.properties.valueKey")}]}}).inject(d);let i=e.create("tbody").inject(d);if(!r.is(c))throw new Error("Unable to find scrollListContainer");if(c.addClassName("properties-sub-container-std"),!r.is(d))throw new Error("Cannot find element properties-tbody in the DOM");var u=s.model.pairs();u.sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0});for(var p=[],_=[],m=[],v=!1,S=0;S<u.length;S++){var w=u[S][0],b=u[S][1];if(b){var C=w.match(/\/([^/]*)$/);if(C=null===C?w:C[1],-1===f.indexOf(w)&&-1===w.indexOf("_value")&&(-1!==w.indexOf("ds6w:")||-1!==w.indexOf("ds6wg:"))&&-1===p.indexOf(C)){p.push(C),_.push(b);var y=n.getVocabId(C);r.is(y)&&(-1!==y.indexOf("ds6wg")?v=!0:-1===m.indexOf(y)&&(n.isLoaded(y)||m.push(y)))}}}var I=function(){for(var t=0;t<p.length;t++){var o=n.getNLSValueForPredicate(p[t]);r.is(o)&&""!==o||(o=p[t]);var a=e.create("tr",{html:{tag:"td",text:o}}).inject(i),l=_[t],c="";if(l instanceof Array){if(l.length>0){for(var d=0;d<l.length;d++)c+=s._HTMLDecode(l[d])+(d===l.length-1?"":" | ");e.create("td",{title:c,text:c}).inject(a)}}else if(l.length>0){e.create("td",{title:s._HTMLDecode(l),text:s._HTMLDecode(l)}).inject(a)}}};if(v||m.length>0){var D=function(){if(m.length>0)for(var e=0,t=0;t<m.length;t++)n.loadVocabulary(m[t],function(){++e===m.length&&I.call()});else I.call()};if(v){var T=s.model.get("ds6w:what/ds6w:type_value");r.is(T)||(T=s.model.get("ds6w:type_value")),n._asyncCallToPredicatesWS(["ds6wg:"+T]).then(function(){D.call()},function(){D.call()})}else D.call()}else I.call();new g(c,{bounce:!0,momentum:!0,scrollableX:!1,scrollbarH:!1,scrollDrag:!((h.Platform.windows||h.Platform.win32||h.Platform.win64)&&h.Engine.chrome&&!h.Features.touchEvents||h.Engine.ie&&h.Platform.tablet),useNative:h.Engine.ie&&h.Platform.tablet,useTransform:!(h.Platform.macintel||h.Platform.mac||h.Engine.ie)&&g.prototype.defaultOptions.useTransform,scrollbar:{autoHide:!1,opacity:1,padding:5,bgColor:"transparent",barColor:"#E2E4E3"}})}})},_getValueWithMapping:function(e,t,i){var n;if(e in i&&r.is(i[e],"function")){var s={model:t};n=i[e].call(s)}else void 0===(n=t.get(e))&&(n="");return n}});return m.facet_name=_,m.is_facet_avalailable=function(){return!0},m.facet_idcard=function(){return{text:a.get("skeleton.facets.properties"),icon:"doc-text",handler:u.getRendererHandler(_)}},m.facet_options=function(){return{view:m,collection:c,fetchMode:"never"}},m}),define("DS/SNResultUX/utils/ResultsUtils",["UWA/Core","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess"],function(e,t,i){"use strict";return{from_filters_to_uql:function(n,s,o,a){var r,l,c,d,u="",h=0,g=t.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly"),p=null,_=null,f=null,m=null;if(n.isSimplified&&n.condition){var v={};n.condition.forEach(function(e){Object.keys(e).forEach(function(t){0===t.indexOf("sixw:")&&(v[t]=e[t])})}),n=v}var S={},w=null;for(var b in n)w={sixw:!1},0===b.indexOf("sixw:")&&(p=b.replace("sixw:",""),w.sixw=!0),e.is(S[b],"array")||(S[b]=[]),S[b].push(n[b]);for(var C in n)if(0===C.indexOf("sixw:")){if("ds6w:dataSource"===(p=(p=C.replace("sixw:","")).split("/").pop()))continue;e.is(g)&&g.hasOwnProperty(p)&&e.is(g[p])&&e.is(g[p],"string")&&0===g[p].indexOf("ds6wg:")&&(p=g[p]),p="["+p+"]",r=n[C],_="",0<h&&(_=" AND "),h++;var y=!1;for(c=0;c<r.length;c++)if(l=r[c],e.is(l.type)){if(0===c&&1<r.length&&(_+="( ",y=!0),0<c&&y&&(_=" OR "),"string"===l.type){if(!e.is(l.object))continue;var I=l.object,D=p;if("[ds6w:type]"===p&&(0<=I.indexOf(":")&&!0,0===I.indexOf("ds6wg:"))){if(a){var T,A=I.split(":");A.length>2?(T=A.pop(),I=A.join(":"),"Instance"===T?I=I.replace("ds6wg:","reltypes/"):"Class"===T&&(I=I.replace("ds6wg:","types/"))):(I=A.join(":"),I=!0===i.IsClassAnInstance(I)?I.replace("ds6wg:","reltypes/"):I.replace("ds6wg:","types/"))}else I=I.replace("ds6wg:","types/");D="flattenedtaxonomies"}"[vpmextension]"===p&&(e.is(o)&&!0===o?(0<=I.indexOf(":")&&!0,D="[ds6w:typeExtension]"):(0<=I.indexOf(":")&&!0,0===I.indexOf("ds6wg:")&&(I=I.replace("ds6wg:","interfaces/"),D="flattenedtaxonomies"))),0===I.indexOf("enum|")?(!0,I=I.replace("enum|","")):(0<=I.indexOf(":")||0<=I.indexOf("(")||0<=I.indexOf(")"))&&!0,e.is(s,"object")&&s.hasOwnProperty("usePreciseQueryTerms")&&!0===s.usePreciseQueryTerms&&!0,d=D+':"'+I+'"',u+=_+(d=this._checkExclude(l,d))}else if("date"===l.type){if(!e.is(l.object))continue;e.is(l.object.from)&&(f=new Date(l.object.from+" 00:00:00"),d=p+'>="'+new Date(f).toISOString()+'"',d=this._checkExclude(l,d),u=this._checkExcludeRangeStart(l,u),u+=_+d,e.is(l.object.to)&&(_=" AND ")),e.is(l.object.to)&&(m=new Date(l.object.to+" 23:59:59"),d=p+'<="'+new Date(m).toISOString()+'"',d=this._checkExclude(l,d),u=this._checkExcludeRangeEnd(l,u),u+=_+d)}else if("double"===l.type||"integer"===l.type){if(!e.is(l.object))continue;e.is(l.object.from)&&(d=p+">="+l.object.from,d=this._checkExclude(l,d),u=this._checkExcludeRangeStart(l,u),u+=_+d,e.is(l.object.to)&&(_=" AND ")),e.is(l.object.to)&&(d=p+"<="+l.object.to,d=this._checkExclude(l,d),u=this._checkExcludeRangeEnd(l,u),u+=_+d)}else if("boolean"===l.type){if(!e.is(l.object))continue;d=p+":"+l.object,u+=_+(d=this._checkExclude(l,d))}y&&r.length===c+1&&(u+=" )")}}else if(e.is(n[C],"array")&&n[C].length>0&&e.is(n[C][0])&&e.is(n[C][0].type,"string")&&"date"===n[C][0].type){var x=n[C][0].object;if(!e.is(x,"string"))continue;_="",0<h&&(_=" AND "),h++,p="["+(p=C.split("/").pop())+"]";var N=x.split("/"),O=N.length;f=null,m=null,null;var P=null,E=0,k=1;1===O?(P=parseInt(x),isNaN(P)||(f=new Date(P,0),m=new Date(P+1,0))):2===O?(P=parseInt(N[0]),E=parseInt(N[1]),isNaN(P)||isNaN(E)||(f=new Date(P,E-1),m=new Date(P,E))):3===O&&(P=parseInt(N[0]),E=parseInt(N[1]),k=parseInt(N[2]),isNaN(P)||isNaN(E)||isNaN(k)||(f=new Date(P,E-1,k),m=new Date(P,E-1,k+1))),u+=_+(d=p+'>="'+new Date(f).toISOString()+'"'),u+=(_=" AND ")+(d=p+'<="'+(m=new Date(m.getTime()-1)).toISOString()+'"')}return u},openResourceInApplicationWidget:function(e){var t=e.baseUrl+"#app:"+e.appId+"/content:",i="_top";"3DDashboard"!==e.clientId&&(i="_blank");var n={protocol:"3DXContent",data:{items:[{envId:e.platformId,objectId:e.objectId,openLink:!0}]}},s="X3DContentId="+encodeURIComponent(JSON.stringify(n));window.open(t+s,i)},isAdvSearchRun:function(t){return e.is(t)&&"socket_id_#saved_search_edit#"===t.app_socket_id&&"furtive"!=t.mode},_checkExclude:function(t,i){return!0!==t.excluded||e.is(t.object.to)&&e.is(t.object.from)||(i=" NOT ("+i+")"),i},_checkExcludeRangeStart:function(t,i){return!0===t.excluded&&e.is(t.object.to)&&e.is(t.object.from)&&(i+=" NOT ("+i),i},_checkExcludeRangeEnd:function(t,i){return!0===t.excluded&&e.is(t.object.to)&&e.is(t.object.from)&&(i+=")"),i}}}),define("DS/SNResultUX/views/W3DXComponents/Views/Item/SwitcherView",["DS/W3DXComponents/Views/Item/SwitcherView","UWA/Core","UWA/Utils","UWA/Event","DS/W3DXComponents/Views/Temp/TempItemView","DS/UIKIT/Tooltip","DS/UIKIT/IconDropdown","DS/UIKIT/DropdownMenu","DS/MessageBus/MessageBus"],function(e,t,i,n,s,o,a,r,l){"use strict";return e.extend({menuUIKIT:null,init:function(e){this.menuUIKIT=null,this._parent.call(this,e)},switchView:function(e){this.menuUIKIT.toggleSelection(this.menuUIKIT.getItem(e));let t=this.menuUIKIT.getItem(e);t&&(this.menuUIKIT.dispatchEvent("onClick",[null,t],this.menuUIKIT),l.publish({channel:"3dSearch-switcher-view",topic:"forceRefresh"}))},onRender:function(){var e=this;if(this.getOption("tempSingleIconOnMobile")){var i=t.extendElement(e.container).getElement("#switch-view-button"),n=e.options.buttons.filter(function(e){return e.default})[0];n=n||{};var s=[];e.options.buttons.forEach(function(e){s.push({name:e.id,fonticon:function(e){switch(e){case"thumbnail":return"view-small-thb";case"tilebig":return"view-big-tile";case"tile":return"view-small-tile";case"table":return"view-list";case"what":case"who":case"when":case"where":case"myContent":return"view-tag-cloud";default:return""}}(e.id),text:e.title,selectable:!0,selected:n.id===e.id})});var a=new o({position:"bottom",target:i});e.menuUIKIT=new r({target:i,items:s,closeOnClick:!0,className:"search",events:{onClick:function(t,n){l.publish({channel:"3dSearch-switcher-view",topic:"displayContentSetHeader",data:{displayed:"where"!==n.name&&"what"!==n.name&&"who"!==n.name&&"when"!==n.name&&"myContent"!==n.name,view:n.name}}),n.actived||(e.dispatchEvent("onSwitch",[e,n.name]),this.items.forEach(function(e){e.actived=!1}),n.actived=!0,i.children[0].className=n.elements.icon.className,a.setBody(n.text))}}}),e.menuUIKIT.items.forEach(function(e){e.name===n.id&&(i.children[0].className=e.elements.icon.className,a.setBody(e.text))})}else this.options.buttons.forEach(function(i){if(t.is(i.title)&&i.title.trim().length>0){var n=t.extendElement(e.container).getElement("#"+e.cid+"-"+i.id+"-button");new o({position:"bottom",target:n.getParent(),body:i.title})}})}})}),define("DS/SNResultUX/utils/Select_ActionHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events"],function(e,t,i,n){"use strict";return t.singleton(n,i,{executeAction:function(t){if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");var i=t?t.actionsHelper:null;switch(t.action_id){case"select_all":i.selectAll(t);break;case"unselect_all":i.unselectAll(t);break;case"new_preview":i.preview(t);break;case"new_information":i.getInformation(t)}}})}),define("DS/SNResultUX/utils/ImageHelper",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(e,t,i){"use strict";return t.extend(i,{name:"DS_SNResultUX_utils_ImageHelper",_gridView:null,_cellInfos:null,_image:null,_onImageLoad:function(){var t,i=this._cellInfos.cellView,n=this._image.height;this._image.width>198||n>148?(e.is(i.setPictureBackgroundSize,"function")?i.setPictureBackgroundSize("contain"):e.is(i.contentView)&&e.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("contain"),e.is(this._cellInfos.virtualCellID)?t=this._cellInfos.virtualCellID:e.is(this._cellInfos.cellID)&&(t=this._cellInfos.cellID),this._gridView.setAsBigPicture(t)):e.is(i.setPictureBackgroundSize,"function")?i.setPictureBackgroundSize("auto"):e.is(i.contentView)&&e.is(i.contentView.setPictureBackgroundSize,"function")&&i.contentView.setPictureBackgroundSize("auto")},init:function(e,t){this._cellInfos=e,this._gridView=t,this._image=new Image,this._image.addEventListener("load",this._onImageLoad.bind(this),!0),this._image.src=e.nodeModel.options.thumbnail},destroy:function(){this._image&&this._image.removeEventListener("onload",this._onImageLoad.bind(this),!0),this._gridView=null,this._image=null,this._cellInfos=null}})}),define("DS/SNResultUX/views/utils/SearchHistoryTree",["UWA/Core","UWA/Class/View","UWA/Element","UWA/Utils/InterCom","DS/WebappsUtils/WebappsUtils","DS/UIKIT/Tooltip","DS/etree/syncwidget","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/etree/iact","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!egraph/views","css!etree/syncviews","css!etree/basicviews","css!egraph/views_default","css!DS/etree/overviewui.css"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";return t.extend({_treeDocument:null,_graph:null,_lastNode:null,_searchNode:null,_currentSelectNode:null,_lastSelectNode:null,_listOfTreeGraph:null,_stopCreated:!1,_ifHaveExploreOrRelatedNode:!1,_fullsize:!0,_container:null,_compass_socket:null,_AlReadyRender:!1,customNodeView:function(){var t=function(t){var i,n=t.nodeView,s=t.nodeModel;i=n.querySelector(".etree-sync-node-icon"),e.is(i)&&i.classList.remove("hidden"),s.options.icons&&s.options.icons.length>0?i.style.backgroundImage='url("'+s.options.icons[0]+'")':i&&i.classList.add("hidden"),n.querySelector(".etree-sync-node-label").textContent=s.options.label,(r.inPathSet(t.changes,"data","data","_isHighlighted")||r.inPathSet(t.changes,"data","data","_isSelected"))&&(s._isHighlighted||s._isSelected?n.classList.add("highlighted"):n.classList.remove("highlighted")),i=n.querySelector(".fonticon.fonticon-filter"),e.is(i)&&e.is(s.options.filter)&&!0===s.options.filter?i.style.visibility="visible":e.is(i)&&(i.style.visibility="hidden")},i={},n=function(){c.HTMLNodeView.call(this)};l.inherit(n,c.HTMLNodeView),n.prototype.buildNodeElement=function(){var e=document.createElement("div");return e.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template1">','    <div class="etree-sync-node-header">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="fonticon fonticon-filter"></div>',"    </div>",'    <div class="etree-sync-node-content">','       <div class="etree-sync-node-description">desc</div>',"    </div>","  </div>","</div>"].join("\n"),e.querySelector(".etree-sync-node").cloneNode(!0)},n.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),s.querySelector(".etree-sync-node-description").textContent=o.options.description};var s=function(){c.HTMLNodeView.call(this)};l.inherit(s,c.HTMLNodeView),s.prototype.buildNodeElement=function(){var e=document.createElement("div");return e.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template2">','      <div class="fonticon fonticon-filter"></div>','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-content"></div>',"  </div>","</div>"].join("\n"),e.querySelector(".etree-sync-node").cloneNode(!0)},s.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),s.querySelector(".etree-sync-node-content").textContent=o.options.description};var o=function(){c.HTMLNodeView.call(this)};l.inherit(o,c.HTMLNodeView),o.prototype.buildNodeElement=function(t){if(e.is(t)&&e.is(t.data)){var i=document.createElement("div");return i.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template3">','      <div class="etree-sync-node-icon"></div>','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-firstcontent">','        <div class="etree-sync-node-firstcontent-label1">No Children</div>','        <div class="etree-sync-node-firstcontent-label2">No results</div>',"      </div>",'      <div class="etree-sync-node-secondcontent">','       <div class="etree-sync-node-secondcontent-label1">No Parents</div>','       <div class="etree-sync-node-secondcontent-label2">No results</div>',"      </div>","  </div>","</div>"].join("\n"),i.querySelector(".etree-sync-node").cloneNode(!0)}},o.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),o.options.childrenlabel&&o.options.childrenlabel.length>0&&(s.getElement(".etree-sync-node-firstcontent-label1").textContent=o.options.childrenlabel,s.getElement(".etree-sync-node-firstcontent-label2").textContent=o.options.childrenresults),o.options.parentslabel&&o.options.parentslabel.length>0&&(s.getElement(".etree-sync-node-secondcontent-label1").textContent=o.options.parentslabel,s.getElement(".etree-sync-node-secondcontent-label2").textContent=o.options.parentsresults),o.options.rootslabel&&o.options.rootslabel.length>0&&(s.getElement(".etree-sync-node-thirdcontent-label1").textContent=o.options.rootslabel,s.getElement(".etree-sync-node-thirdcontent-label2").textContent=o.options.rootsresults)};var a=function(){c.HTMLNodeView.call(this)};return l.inherit(a,c.HTMLNodeView),a.prototype.buildNodeElement=function(t){if(e.is(t)&&e.is(t.data)){var i=document.createElement("div");return i.innerHTML=['<div class="etree-sync-node" draggable="true">','  <div class="etree-sync-node-widget template4">','      <div class="etree-sync-node-label">noname</div>','      <div class="etree-sync-node-firstcontent">','        <span class="fonticon fonticon-network"></span>','        <span class="item-text-first" style="text-align: center;">Structure</span>',"      </div>",'      <div class="etree-sync-node-secondcontent">','        <span class="fonticon fonticon-component"></span>','        <span class="item-text-second" style="text-align: center;">Related</span>',"      </div>","  </div>","</div>"].join("\n"),i.querySelector(".etree-sync-node").cloneNode(!0)}},a.prototype.onmodifyDisplay=function(i,n){var s,o=i.data.data;c.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments),s=e.extendElement(this.display.elt),t({nodeModel:o,nodeView:s,changes:n}),o.options.childrenlabel&&o.options.childrenlabel.length>0&&(s.getElement(".item-text-first").textContent=o.options.childrenlabel),o.options.parentslabel&&o.options.parentslabel.length>0&&(s.getElement(".item-text-second").textContent=o.options.parentslabel)},i.newNodeView=function(e){var t=e.data;return"type1"===t.options.type?new n:"type2"===t.options.type?new s:"type3"===t.options.type?new o:new a},i},render:function(t){var n=this;if(!e.is(t)||null!==n._container||!0===n._AlReadyRender)return;n._listOfTreeGraph=[],n._AlReadyRender=!0,n._container=t,n._graph=new a.SyncEGraphTree(n._container,{orientation:a.OrientationMode.ROOT_ON_LEFT,nodeView:n.customNodeView(),fittingArea:{paddingLeft:-25,paddingRight:0,paddingTop:-25,paddingBottom:0}}),n._graph.widget.document.nodeHeight=90,n._graph.widget.document.nodeWidth=130,n._graph.setModel(n.getTreeDocument()),n._graph.expandAll(),n._graph.widget.sm.rootState.movePredicate=function(){return!1},n._graph.widget.sm.rootState.onmousedown=function(t,i){if(i.dom.className.contains("item-text-first")||i.dom.className.contains("fonticon fonticon-network")||i.dom.className.contains("item-text-second")||i.dom.className.contains("fonticon fonticon-component")){if(i.inside&&1===i.button&&e.is(i.grElt)&&e.is(i.grElt.data)&&e.is(i.grElt.data.data)){var s=i.grElt.data.data;s&&(i.dom.className.contains("item-text-first")||i.dom.className.contains("fonticon fonticon-network")?e.is(s.options)&&e.is(s.options.onClickchildren,"function")&&s.options.onClickchildren.call(n,s):(i.dom.className.contains("item-text-second")||i.dom.className.contains("fonticon fonticon-component"))&&e.is(s.options)&&e.is(s.options.onClickparents,"function")&&s.options.onClickparents.call(n,s))}return{}}return d.RootState.prototype.onmousedown.apply(this,arguments)};var s=i.create("div",{class:"fonticon fonticon-resize-full"});s.inject(n._container);new o({position:"bottom",target:s,body:_.get("relation.maxminTooltip")});s.onclick=function(){!0===n._fullsize?(n._container.style.height="100%",n._fullsize=!1,this.removeClassName("fonticon fonticon-resize-full"),this.addClassName("fonticon fonticon-resize-small")):(n._container.style.height="100px",n._fullsize=!0,this.removeClassName("fonticon fonticon-resize-small"),this.addClassName("fonticon fonticon-resize-full"))}},getTreeDocument:function(){var e=this;return null===e._treeDocument&&(this._treeDocument=new u({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!1},shouldAcceptDrop:function(){return!1}}),e._treeDocument.getXSO().onAdd(function(t){e.onSelected(t)})),e._treeDocument},addSearchModel:function(t){if(e.is(t)){var i=this._treeDocument;e.is(i)||(i=this.getTreeDocument());var n=!1;if(e.is(t.refine)&&!0===t.refine?(n=!0,e.is(t.searchParam)&&e.is(t.searchParam.adv_search)&&!0===t.searchParam.adv_search&&(null===this._lastNode?n=!1:this._lastNode&&"Search"!==this._lastNode._options.SNtype&&(n=!1))):this._lastNode&&"Search"===this._lastNode._options.SNtype&&(n=!0),!1===n){i.prepareUpdate(),t.type="type1",t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Search.png")],t.useAsyncPreExpand=!1,t.label=_.get("search.box"),t.SNtype="Search";var o=new h(t);i.addRoot(o),i.pushUpdate(),this._lastNode=o,this._searchNode=o;var a={SNtype:"Search",contextid:t.contextid,widgetAppId:t.widgetAppId};g.setContentVisibility(a),this._currentSelectNode=null,this._lastSelectNode=null,this._graph&&this._graph.expandAll()}else if(this._currentSelectNode&&"Children"===this._currentSelectNode._options.SNtype){var r=this._currentSelectNode._options.description;e.is(t.count)&&(r=r.replace(/[0-9]/,t.count)),this._currentSelectNode.updateOptions({searchParam:t.searchParam,description:r,filter:t.filter})}else this._searchNode&&(this._searchNode.updateOptions({description:t.description,searchParam:t.searchParam,filter:t.filter}),this._lastNode=this._searchNode);return this._lastNode}},addSearchSelectModel:function(t){var i=this._treeDocument;e.is(i)||(i=this.getTreeDocument());var n=this._searchNodebyIdInSameBranch(t.id);if(!e.is(n)||null===n){var o=!1,a=!0,r=!1;if(e.is(t)&&!e.is(t,"object")?(o=!0,r=!0,this._lastSelectNode&&(this._lastSelectNode.removeChildren(),this._lastNode=this._lastSelectNode)):this._lastNode&&"Select"===this._lastNode._options.SNtype?null===this._lastNode.getChildren()&&(o=!0):!this._currentSelectNode||"Search"!==this._currentSelectNode._options.SNtype&&"Children"!==this._currentSelectNode._options.SNtype?this._lastNode&&"Children"===this._lastNode._options.SNtype?null!==this._lastNode.getChildren()||e.is(this._lastNode._isSelected)||(o=!0,this._lastSelectNode&&(this._lastSelectNode.removeChildren(),this._lastNode=this._lastSelectNode)):this._lastNode&&""===this._lastNode._options.SNtype&&(o=!0,this._lastSelectNode&&(this._lastSelectNode.removeChildren(),this._lastNode=this._lastSelectNode)):this._lastNode=this._currentSelectNode,!0===o)!0===r?this._lastSelectNode.updateOptions({description:t+_.get("relation.selected"),id:null,model:null}):this._lastSelectNode.updateOptions({description:t.description,id:t.id,model:t.model}),this._lastNode=this._lastSelectNode,a=!1;else{if(!1===p.getOption("nav_history_parallel")&&(a=!0,this._currentSelectNode&&"Search"===this._currentSelectNode._options.SNtype&&this._currentSelectNode.hasChildren())){var l=this._currentSelectNode.getChildren()[0];this._removeAllNodeWithWidget(l),l.updateOptions({description:t.description,id:t.id,model:t.model}),this._lastNode=l,a=!1}if(!0===a){t.SNtype="Select",t.type="type1",t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Select.png")],t.useAsyncPreExpand=!1,t.label=_.get("select.box"),i.prepareUpdate();var c=new h(t);this._lastNode.addChild(c),this._lastNode=c,this._lastSelectNode=this._lastNode,this._currentSelectNode=null,i.pushUpdate(),this._graph&&this._graph.expandAll()}}return this._lastNode}},removeLastSelectNode:function(){if(this._lastNode){var t=!0;if("Select"===this._lastNode._options.SNtype){var i=this._lastNode.getChildren();if(i){for(var n=i.length,s=null,o=0;o<n;o++)s=i[o];s&&(t=!1)}!0===t&&(this._lastNode=this._lastNode.getParent(),this._lastNode.removeChildren())}else"Children"===this._lastNode._options.SNtype&&(this._currentSelectNode&&"Children"===this._currentSelectNode._options.SNtype?t=!1:this._currentSelectNode&&"Select"===this._currentSelectNode._options.SNtype?t=!1:e.is(this._lastNode._isSelected)||(t=!0),!0===t&&this._lastSelectNode&&(this._lastNode=this._lastSelectNode.getParent(),this._lastNode.removeChildren()))}},addRelationsModel:function(t){var i=this,o=function(t){if(e.is(t)){var n=t.getParent();n&&(n.removeChild(t),i._lastNode=n)}},a=null,r=p.getOption("nav_history_related"),l=null,c=null,d=null,u=null,f=null,m=null,v=null,S=0;if(!1===r){if(e.is(t)&&e.is(t.model)&&e.is(t.model.fromApp)&&!0===t.model.fromApp){var w=t.model;l=null,(c={type:"type4",SNtype:"Children",useAsyncPreExpand:!1,contextid:t.contextid,widgetAppId:t.widgetAppId}).label=w.displayName,c.childrenlabel=_.get("tree.box"),c.parentslabel=_.get("graph.box"),c.model=w,c.id=w.id;var b=function(e){var s=e.id,o={protocol:"3DXContent",version:"1.1",source:"X3DSEAR_AP",widgetId:t.widgetAppId,data:{items:[{envId:e.getPlatformID(),serviceId:e.getServiceID,contextId:"",objectId:s,objectType:e.get("ds6w:type_value"),displayName:e.displayName,displayType:e.get("ds6w:type")}]}};return null===i._compass_socket&&(i._compass_socket=new n.Socket("HistoryActions"),i._compass_socket.subscribeServer("com.ds.compass",window.parent)),i._compass_socket.dispatchEvent("onSetX3DContent",o,"HistoryActions"),o},C={description:w.displayName,widgetAppId:t.widgetAppId,contextid:t.contextid};if(c.onClickparents=function(t){if(e.is(t)){o(t);var n=i.addRelationalModel(C),s=b(t.options.model),a={historyNode:n,nav_history:!0};g.setContentVisibility("Relational"),g.instantiateAppInSearch("Relational","ENORIPE_AP",s,a)}},c.onClickchildren=function(t){if(e.is(t)){o(t);var n=i.addExploreModel(C),s=b(t.options.model),a={historyNode:n,nav_history:!0};g.setContentVisibility("Explore"),g.instantiateAppInSearch("ExploreList","ENOSC2D_AP",s,a),g.instantiateAppInSearch("Explore3D","ENOSC3D_AP",s,a)}},u=null,d=i._lastNode,e.is(i._lastNode._options.id)&&(u=i._lastNode._options.id),null!==i._currentSelectNode&&e.is(i._currentSelectNode._options.id)&&(u=i._currentSelectNode._options.id,d=i._currentSelectNode),!e.is(d))return;if(!e.is(u))return;if(u===t.model.id&&!0===i._lastNode.hasChildren()&&(f=i._lastNode.getChildren()))for(m=f.length,v=null,S=0;S<m;S++)if((v=f[S])&&e.is(v._options)&&("Relational"!==v._options.SNtype||"Explore"!==v._options.SNtype))return;if(a=i.getTreeDocument(),!e.is(a))return;return a.prepareUpdate(),i._removeAllNodeWithWidget(d),l=new h(c),d.addChild(l),null!==l&&(i._lastNode=l),a.pushUpdate(),i._currentSelectNode=null,i._graph&&i._graph.expandAll(),l}}else if(!0===r){var y=!1;if(i._currentSelectNode&&"Select"===i._currentSelectNode._options.SNtype?y=!1:i._lastNode&&"Select"!==i._lastNode._options.SNtype&&(y=!0),!0===y)return;if(!e.is(t)&&!e.is(t.model))return;if(u=null,d=i._lastNode,e.is(i._lastNode._options.id)&&(u=i._lastNode._options.id),null===u&&null!==i._currentSelectNode&&e.is(i._currentSelectNode._options.id)&&(u=i._currentSelectNode._options.id,d=i._currentSelectNode),!e.is(d))return;if(!e.is(u))return;if(u!==t.model.id)return;if(a=i.getTreeDocument(),!e.is(a))return;if(!e.is(t,"object"))return;var I=function(){var t=[];if(f=d.getChildren())for(m=f.length,v=null,S=0;S<m;S++)(v=f[S])&&e.is(v._options)&&e.is(v._options.relation)&&t.push(v._options.relation);return t}();if(e.is(I)){if(2===I.length)return;if(1===I.length&&""===I[0])return}var D=function(t,n){var a=_.get("relation.result");switch(t.info.length>1&&(a=_.get("relation.results")),t.id){case"parents":n.parentslabel=_.get("relation.parents.label"),n.parentsresults=t.info.length+a,n.parentsdescription=_.get("relation.parents.description"),n.onClickparents=function(t){e.is(t)&&(o(t),t.options.relation="parents",t.options.ids=t.options.relations[t.options.relation],i.onSelected(i.addRelationModel(t)))};break;case"children":n.childrenlabel=_.get("relation.children.label"),n.childrenresults=t.info.length+a,n.childrendescription=_.get("relation.children.description"),n.onClickchildren=function(t){e.is(t)&&(o(t),t.options.relation="children",t.options.ids=t.options.relations[t.options.relation],i.onSelected(i.addRelationModel(t)))};break;case"simulations":n.label=_.get("relation.simulations.label"),n.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Simulations.png")],n.description=_.get("relation.simulations.description");break;case"configurations":n.label=_.get("relation.configurations.label"),n.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Configurations.png")],n.description=_.get("relation.configurations.description")}};l=null;var T=null;(c={type:"type2",SNtype:"",ids:null,relation:"",relations:t,useAsyncPreExpand:!1,contextid:t.contextid,widgetAppId:t.widgetAppId,description:_.get("relation.norelated")}).label=t.model.get("ds6w:type"),c.icons=[t.model.get("preview_url")];var A=!1;for(var x in t)if(-1===I.indexOf(x)){var N=t[x];if(e.is(N,"array")&&N.length>0){var O=N.length;"drawings"===x?(T={SNtype:"Children",ids:N,type:"type2",relation:"drawings",useAsyncPreExpand:!1,contextid:t.contextid,widgetAppId:t.widgetAppId,label:_.get("relation.drawings.label"),icons:[s.getWebappsAssetUrl("SNResultUX","images/Box_Drawings.png")],description:O+(O>1?_.get("relation.results"):_.get("relation.result"))},A=!0):(A=!0,c.type="type3",c.SNtype="Children",D({id:x,info:N},c))}}if(!1===A&&I.length>0)return i._lastNode;a.prepareUpdate(),l=new h(c),d.addChild(l),null!==l&&(i._lastNode=l),null!==T&&(l=new h(T),d.addChild(l),i._lastNode=l),a.pushUpdate(),i._currentSelectNode=null,i._graph&&i._graph.expandAll()}return l},addRelationModel:function(t){if(e.is(t)&&e.is(t.options)&&e.is(t.options.relations)){var i=this.getTreeDocument();if(e.is(i)){i.prepareUpdate();var n=this._lastNode,o=null,a=t.options.relations,r=t.options.relation,l=a[r];if(e.is(l,"array")&&l.length>0){var c={SNtype:"Children",ids:l,type:"type2",relation:r,useAsyncPreExpand:!1,contextid:a.contextid,widgetAppId:a.widgetAppId};!function(e,t){var i=_.get("relation.result");switch(e.info.length>1&&(i=_.get("relation.results")),e.id){case"parents":t.label=_.get("relation.parents.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Parents.png")],t.description=e.info.length+i;break;case"children":t.label=_.get("relation.children.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Children.png")],t.description=e.info.length+i;break;case"drawings":t.label=_.get("relation.drawings.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Drawings.png")],t.description=e.info.length+i;break;case"simulations":t.label=_.get("relation.simulations.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Simulations.png")],t.description=e.info.length+i;break;case"configurations":t.label=_.get("relation.configurations.label"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/Box_Configurations.png")],t.description=e.info.length+i}}({id:r,info:l},c),o=new h(c),n.addChild(o)}return null!==o&&(this._lastNode=o),i.pushUpdate(),this._currentSelectNode=null,this._graph&&this._graph.expandAll(),o}}},addExploreModel:function(t){var i=this._treeDocument;this.HideContainers(),e.is(i)||(i=this.getTreeDocument()),t.SNtype="Explore",t.type="type1",t.label=_.get("tree.box"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/I_TreeListView.png")],t.useAsyncPreExpand=!1;var n=new h(t);return e.is(this._lastNode)&&(this._removeChildrenNode(),i.prepareUpdate(),this._lastNode.addChild(n),i.pushUpdate(),this._lastNode=n,null===this._listOfTreeGraph&&(this._listOfTreeGraph=[]),this._listOfTreeGraph.push(n),this._ifHaveExploreOrRelatedNode=!0,this._currentSelectNode=null,this._graph&&this._graph.expandAll()),n},addRelationalModel:function(t){var i=this._treeDocument;e.is(i)||(i=this.getTreeDocument()),this.HideContainers(),t.SNtype="Relational",t.type="type1",t.label=_.get("graph.box"),t.icons=[s.getWebappsAssetUrl("SNResultUX","images/I_GraphView.png")],t.useAsyncPreExpand=!1;var n=new h(t);return e.is(this._lastNode)&&(i.prepareUpdate(),this._removeChildrenNode(),this._lastNode.addChild(n),i.pushUpdate(),this._lastNode=n,null===this._listOfTreeGraph&&(this._listOfTreeGraph=[]),this._listOfTreeGraph.push(n),this._ifHaveExploreOrRelatedNode=!0,this._currentSelectNode=null,this._graph&&this._graph.expandAll()),n},onSelected:function(t){if(e.is(t)){var i=t.options;if(e.is(i)){this._currentSelectNode=t;for(var n=t;n&&n._options&&"Search"!==n._options.SNtype;)"Explore"!==(n=n.getParent())._options.SNtype&&"Relational"!==n._options.SNtype||(this._ifHaveExploreOrRelatedNode=!0);for(n&&(this._searchNode=n),n=t;n&&n.getChildren();)"Explore"!==(n=n.getChildren()[0])._options.SNtype&&"Relational"!==n._options.SNtype||(this._ifHaveExploreOrRelatedNode=!0);n&&(this._lastNode=n),this.dispatchEvent("onSelected",i)}}},HideContainers:function(){e.is(this._listOfTreeGraph)&&this._listOfTreeGraph.forEach(function(t){e.is(t._options)&&e.is(t._options.containers)&&t._options.containers.forEach(function(e){e.setStyle("display","none")})})},ShowContainers:function(t){e.is(t)&&(this.HideContainers(),e.is(t.containers)&&t.containers.forEach(function(e){e.setStyle("display","block")}))},stopCreation:function(e){this._stopCreated=e},ifcanCreated:function(){return!this._stopCreated},_removeChildrenNode:function(){if(e.is(this._lastNode)&&("Children"===this._lastNode._options.SNtype||""===this._lastNode._options.SNtype)&&this._lastSelectNode){for(var t=this._lastSelectNode;t&&t.getChildren();)"Children"===(t=t.getChildren()[0])._options.SNtype&&e.is(t._isSelected)&&(t=null);t&&(this._lastSelectNode.removeChildren(),this._lastNode=this._lastSelectNode)}},_searchNodebyIdInSameBranch:function(t){if(e.is(t)){if(e.is(this._lastNode))for(var i=t,n=this._lastNode;n;){if(i&&e.is(n._options.id)&&-1!==n._options.id.indexOf(i))return n;n=n.getParent()}}},_removeAllNodeWithWidget:function(t){var i=0,n=0,s=t.getChildren();if(s){var o=s.length,a=null,r=null;for(i=0;i<o;i++)if((a=s[i])&&e.is(a._options)){if(this._removeAllNodeWithWidget(a),e.is(a._options.widgets,"array"))for(n=a._options.widgets.length-1;n>=0;n--)r=a._options.widgets[n],e.is(r)&&r.destroy();if(e.is(a._options.containers,"array"))for(n=a._options.containers.length-1;n>=0;n--)r=a._options.containers[n],e.is(r)&&r.remove();t.removeChild(a)}}},cleanAll:function(){var t=this._treeDocument;if(t){var i=t.getRoots();if(i){var n=i[0];if(e.is(n)){var s={SNtype:"Search",contextid:n.options.contextid,widgetAppId:n.options.widgetAppId};g.setContentVisibility(s),this._removeAllNodeWithWidget(n)}}t.removeRoots(),t.empty()}this._lastNode=null,this._searchNode=null,this._currentSelectNode=null,this._lastSelectNode=null,this._lastSelectNode=null,this._listOfTreeGraph=[]},navhistorycontextifcreateaNewTab:function(){var t=!1;return e.is(this._listOfTreeGraph)&&this._listOfTreeGraph.length>0&&(t=!0),t}})}),define("DS/SNResultUX/SearchWidget",["UWA/Class","UWA/Class/Debug","UWA/Core","DS/PubSub/PubSub","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/RefineHelper/RefineHelper","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u){"use strict";var h="DS/TopFrame/TopFrame";return e.extend(t,{widget:null,resources:null,searchcom_socket:null,pcs_uuid:null,_searchCom:null,events:{},css_view_class:"windowed",optionsInitDone:null,eventsRegistered:null,snTabManager:void 0,_widget_launch_mode:null,bAddinmode:!1,init:function(e){o.group("SearchWidget.init"),o.log("init 3DSearch widget, widget id="+(e&&e.widget?e.widget.id:"undefined")),o.log("JS code level for search: ",s.getCurrentVersion());let t=this;this._widget_launch_mode="",this.eventsRegistered=!1,this.optionsInitDone=!1,t.pcs_uuid=Math.floor(1e5*Math.random()+1).toString(),t.widget=e&&e.widget?e.widget:null,this.addBETACSSState(),this.bAddinmode=i.is(t.widget.data.addinmode,"string")&&-1!==["solidworks","catiav5"].indexOf(t.widget.data.addinmode),t.widget.data.reSearch&&this.widget.setValue("tag_filter",t.widget.data.reSearch),t.widget.setValue("tenantAware",!0),e.events&&e.events.onSNResultWdg_Ready&&(t.events.onSNResultWdg_Ready=e.events.onSNResultWdg_Ready),e.events&&e.events.onClose&&n.add("search:closeRequested",function(){e.events.onClose()}),t.widget.addEvent("onLoad",t.onLoad,t),t.widget.addEvent("onResize",t.onResize,t),t.widget.addEvent("onDestroy",t.onDestroy,t),t.widget.addEvent("onViewChange",t.onViewChange,t),t.widget.addEvent("onHide",t.onHide,t),t.widget.body&&t.widget.body.setStyle("transform","translateZ(0)"),t.widget.setMetas({helpPath:"SNResultUX/assets/help"}),this.snTabManager=null,o.groupEnd()},onDestroy:function(){o.log("onDestroy, widget id="+(this.widget?this.widget.id:"undefined"));this.widget.removeEvent("onLoad",this.onLoad,this),this.widget.removeEvent("onResize",this.onResize,this),this.widget.removeEvent("onDestroy",this.onDestroy,this),this.widget.removeEvent("onViewChange",this.onViewChange,this),this.widget.removeEvent("onRefresh",this.onRefresh,this),this.widget.removeEvent("onSearch",this.onSearchIn,this),this.widget.removeEvent("on3DSearch",this.onSearch,this),this.widget.removeEvent("onResetSearch",this.onResetSearch,this),i.is(this.snTabManager)&&(this.widget.removeEvent("onSearchWithOpts",this.snTabManager.onSearch,this.snTabManager),this.widget.removeEvent("onViewChangeResults",this.snTabManager._onViewChange,this.snTabManager)),this.widget.removeEvent("endEdit",this.onEndEdit,this),null!==this.searchcom_socket&&(this.searchcom_socket.removeListener("onSearchFromCompassInit"),this.searchcom_socket.removeListener("setSelectedSource"),this.searchcom_socket.removeListener("onSearchWdgUpd"),this.searchcom_socket.removeListener("showAdvancedSearch"),this.searchcom_socket.removeListener("hideAdvancedSearch"),this.searchcom_socket.dispatchEvent("onResetMyRecent"),this.searchcom_socket.dispatchEvent("onDestroyWidget",{widget_id:this.widget.id},["searchtopbar_socket_id"]),"from_compass_transient"===this._widget_launch_mode&&i.is(this.searchcom_socket)&&this.searchcom_socket.dispatchEvent("closeTagger"),this.searchcom_socket.disconnect(),i.is(this._searchCom)&&this._searchCom.deleteSocket(this.searchcom_socket.id),this.searchcom_socket=null),this.snTabManager&&(this.snTabManager.destroy(),this.snTabManager=null),this.resources=null,this.widget.setValue("tag_filter",""),this.widget=null,this.deleted=!0},addBETACSSState:function(){this.widget&&this.widget.getValue("customization_options");a.isFUN109031Active()&&(this.widget.body&&this.widget.body.addClassName("BETA-FUN109031"),this.widget.elements&&this.widget.elements.header&&this.widget.elements.header.addClassName("BETA-FUN109031"))},removeBETACSSState:function(){this.widget&&this.widget.getValue("customization_options");a.isFUN109031Active()&&(this.widget.body&&this.widget.body.removeClassName("BETA-FUN109031"),this.widget.elements&&this.widget.elements.header&&this.widget.elements.header.removeClassName("BETA-FUN109031"))},onResize:function(){var e=this;clearTimeout(e.resizeEventId),e.resizeEventId=setTimeout(function(){e.searchcom_socket&&e.searchcom_socket.dispatchEvent("widgetResize")},100)},onHide:function(){n.dispatch("search:closeTransient",{})},endEdit:function(e){var t=this.widget.data.search_criteria,n="";i.is(t)&&(n=t);var s=this.widget.data.customization_options;this.searchcom_socket.dispatchEvent("onWdgEndEdit",{}),e&&this._onSearch({searchInCurrentTab:!0,newActiveTenant:this.widget.data.activeTenant,customization_options:s,searchStringToDisplayInSearchField:n,addNewTab:!0})},onLoad:function(){let e,t=this;o.log("Tenant options : ",c.getItem("tenantInfo"));var n=a.getPlatformServices();i.is(n)&&n.getPlatformServices({onComplete:function(n){if(i.is(n)){var s=[];n.forEach(e=>{s.push({label:e.displayName,value:e.platformId})}),i.is(t.widget)&&i.is(t.widget.data)&&!0!==t.bAddinmode&&(e="",i.is(t.widget.data.activeTenant)&&(e=t.widget.data.activeTenant),t.widget.addPreference({name:"activeTenant",type:"list",disabled:!(s.length>1),options:s,label:"Selected Tenant",defaultValue:e}))}}}),t.widget.addPreference({name:"x3dTitleShowAppName",type:"boolean",label:u.get("search.widget.display.name"),defaultValue:!1}),this.resources=this.widget.getValue("search_ressources");let s=!1;i.is(this.resources,"object")&&i.is(this.resources.active_tenant,"string")?(e=this.resources.active_tenant,this.widget.setValue("x3dPlatformId",e)):i.is(this.resources,"string")&&this.resources.length<1&&!i.is(this.widget.getValue("search_wdg_id"))&&(s=!0),this.widget.setValue("search_ressources",null),this.resources=null,t.widget.setValue("search_wdg_id",t.widget.id),t.widget.setValue("tenantAware",!0),!i.is(e,"string")&&i.is(this.widget.getValue("activeTenant"),"string")&&(e=this.widget.getValue("activeTenant")),e&&t.widget.setValue("x3dPlatformId",e),t.widget.addEvent("onUpdateValue",function(e,i){"activeTenant"===e&&t.widget.getValue("x3dPlatformId")!==i?t.widget.setValue("x3dPlatformId",i):"x3dPlatformId"===e&&t.widget.getValue("activeTenant")!==i&&t.widget.setValue("activeTenant",i)}),i.is(t.widget)&&i.is(t.widget.getView,"function")&&t.widget.getView();let r=this.widget.getValue("search_criteria"),d=!i.is(r),h=i.is(r,"string")&&!0!==this.widget.getValue("isODT")&&!0===s||i.is(t.widget.data)&&i.is(t.widget.data.launch_mode)&&"from_compass_transient"===t.widget.data.launch_mode&&i.is(t.widget.data.transient_context)&&"false"===t.widget.data.transient_context;if(d||h){var g;if(!0===d?(t.widget.setValue("transient_context","true"),t._widget_launch_mode=a.widgetLaunchMode.COMPASS_TRANSIENT):!0===h&&(t._widget_launch_mode=a.widgetLaunchMode.COMPASS_PINNED),t._searchCom=l,t.searchcom_socket=l.createSocket({socket_id:"widget_socket_"+t.widget.id,widgetId:t.widget.id}),t.searchcom_socket.addListener("onSearchFromCompassInit",function(e){!1===t.optionsInitDone?(o.log("init to do for 3DSearch from compass..."),t.widget.setValue("activeTenant",e.ressources.active_tenant),t.widget.setValue("x3dPlatformId",e.ressources.active_tenant),t.optionsInitDone=!0,t.afterResourcesInit()):o.log("init DONE for 3DSearch from compass...")}),i.is(t.widget)&&i.is(t.widget.getValue("source"))){var p=t.widget.getValue("source");i.is(p)&&p.length&&"swym"===p[0]&&t.widget.context&&(g=t.widget.context)}a.autocompleteRendered().then(function(){t.searchcom_socket.dispatchEvent("onWdgCreation",{widget_id:t.widget.id,tabid:g,transient_widget:!1},["searchtopbar_socket_id"]),t.searchcom_socket.dispatchEvent("onSearchFromCompass",{widget_id:t.widget.id,x3dPlatformId:t.widget.data.x3dPlatformId,mode:d?"maximized":"windowed"},["searchtopbar_socket_id"])})}else{if(t._widget_launch_mode=a.widgetLaunchMode.TOPBAR_SEARCH,i.is(t.widget)){var _=t.widget.getValue("customization_options");"3DSwym"===a.identifyClientInfo().identifier?t._widget_launch_mode=a.widgetLaunchMode.TOPBAR_SEARCH:i.is(_,"object")&&(i.is(_.app_socket_id,"string")||i.is(_.precond,"string"))?t._widget_launch_mode=a.widgetLaunchMode.INCONTEXT_TRANSIENT:i.is(t.widget.context)&&"transient"!==t.widget.context&&(t._widget_launch_mode=a.widgetLaunchMode.PINNED)}t.optionsInitDone=!0,t.afterResourcesInit()}},afterResourcesInit:function(){var e=this,t=this.widget.getValue("settings_topbar"),s=!1;if("string"==typeof t&&t.length)try{t=JSON.parse(t)}catch(e){o.log("Cannot parse Topbar Settings from the preferences: "+e.toString())}else s=!0;require(["DS/UIKIT/SuperModal","DS/SNInfraUX/SearchRessources","DS/SNResultUX/SNTabbedResultMgt"],function(c,d,h){if(i.is(t)&&i.is(t.search_settings)&&(i.is(t.search_settings.topframe_search_delegation)&&delete t.search_settings.topframe_search_delegation,e._widget_launch_mode===a.widgetLaunchMode.PINNED&&(i.is(t.search_settings)&&delete t.search_settings,i.is(t.url_search_settings)&&delete t.url_search_settings,i.is(t["3dSearch_datagrid"])&&delete t["3dSearch_datagrid"],i.is(t.NLSMapping_3DSearch_Sorting_TACTICALOnly)&&delete t.NLSMapping_3DSearch_Sorting_TACTICALOnly,i.is(t.NLSMapping_3DSearch_Suggest_TACTICALOnly)&&delete t.NLSMapping_3DSearch_Suggest_TACTICALOnly,i.is(t.date_display_mode_array)&&delete t.date_display_mode_array,i.is(t.relevant_tags)&&delete t.relevant_tags,i.is(t.show_search_results_revision_array)&&delete t.show_search_results_revision_array,i.is(t.snippet_unsupported_sources)&&delete t.snippet_unsupported_sources,i.is(t.type_custo)&&delete t.type_custo,i.is(t.vocabToExtend_swym)&&delete t.vocabToExtend_swym)),r.initialize(t),e._widget_launch_mode===a.widgetLaunchMode.PINNED&&(!0===a.isInTheSimpleSearch()?r.changeSettingForBETA():r.changeSettingForFD01(),e._isAmMaximized())){var g=e.widget.getValue("originalSearchCriteria");n.dispatch("search:refreshSearchField",{searchStringToDisplayInSearchField:e.widget.getValue("search_criteria_to_display"),internalSearchCriteria:e.widget.getValue("search_criteria"),originalSearchCriteria:g}),g===a.SearchTypeEnum.ADVANCED_SEARCH&&n.dispatch("search:advancedSearchEdit",{tag_filter:e.widget.getValue("tag_filter")})}var p=!0;if(i.is(e.widget)&&i.is(e.widget.getValue,"function")?p=e.widget.getValue("transient_context"):o.warn("Unable to get widget and so using transient_context = true by default..."),!0!==e.deleted){var _;if(e._searchCom=l,i.is(e.searchcom_socket)||(e.searchcom_socket=l.createSocket({socket_id:"widget_socket_"+e.widget.id,widgetId:e.widget.id})),e.searchcom_socket.addListener("setSelectedSource",function(t){(!0===p||i.is(e.widget._view)&&i.is(e.widget._view)&&i.is(e.widget._view.type)&&("maximized"===e.widget._view.type||"sidepanel"===e.widget._view.type))&&i.is(t)&&i.is(t.value)&&"3DDashboard"!==t.value&&(e.widget.setValue("activeTenant",t.value),e.widget.setValue("x3dPlatformId",t.value),t.update_tab=!1,i.is(e.snTabManager)&&e.snTabManager.setActiveTenant(t))}),e.searchcom_socket.addListener("onSearchWdgUpd",function(t){if(i.is(t,"object")&&i.is(t.refine)&&(t.tag_filter=t.refine,t.refresh=!1),"true"===p||e._isAmMaximized(t.active_tab)||"fullscreen"===e._getWidgetState()){t.value===a.SearchTypeEnum.FAVORITE_SEARCH&&(t.savedSearch=!0,t.searchStringToDisplayInSearchField=u.get("my_fav_searches"),t.resetLocalFilter=!0,t.queryType=a.SearchTypeEnum.FAVORITE_SEARCH);var n=!0;if(i.is(e.snTabManager)&&i.is(t.searchType)&&"#advancedSearch"===t.searchType&&i.is(t.adv_search_field)&&0!==t.adv_search_field.length){var s=e.snTabManager.getActiveAdvSearchMgr();i.is(s)&&!1===r.options.search_settings.taggerClosed&&(n=!1)}if(!0===n){var o="SearchComServer_"+e.widget.id;if(i.is(arguments))if(arguments.length>0&&i.is(arguments[1])&&i.is(arguments[1].origin)&&i.is(arguments[1].origin.server))-1===e.widget.id.indexOf("preview")&&-1===e.widget.id.indexOf("odt")||(o="SearchComServer"),"3DSwym"===a.identifyClientInfo().identifier&&(o="SearchComServer"),n=!1,o===arguments[1].origin.server&&(n=!0)}if(!0===n)if(i.is(e.snTabManager)&&!0===e.snTabManager.navhistorycontextifcreateaNewTab()){if(t.removeHistory=!0,i.is(t.searchType)&&"#advancedSearch"===t.searchType)e.widget.dispatchEvent("on3DSearch",t),e.bAddinmode&&require(["DS/TransientWidget/TransientWidget"],function(e){e.showWidget(a.SEARCH_APP_ID,"",{})});else new c({renderTo:document.body,className:"WarningNewSearch"}).confirm(u.get("relation.NewSearch.warning"),u.get("relation.NewSearch.warningTitle"),function(i){!0===i&&(e.widget.dispatchEvent("on3DSearch",t),e.bAddinmode&&require(["DS/TransientWidget/TransientWidget"],function(e){e.showWidget(a.SEARCH_APP_ID,"",{})}))})}else{var l=function(){e.widget.dispatchEvent("on3DSearch",t),e.bAddinmode&&require(["DS/TransientWidget/TransientWidget"],function(e){e.showWidget(a.SEARCH_APP_ID,"",{})})};e.snTabManager.getActiveTab()&&t.active_tenant===e.snTabManager.getActiveTab().getActiveTenant()?l():(!e.snTabManager.isTabBarVisible()&&e.snTabManager.getActiveTab()&&e.snTabManager.removeTab(e.snTabManager.getActiveTab().getTabID()),e.snTabManager.addTab({search_ux_options:{events:{onReady:l}}}))}}}),e.searchcom_socket.addListener("showAdvancedSearch",function(t){if(i.is(e.snTabManager)){var n=e.snTabManager.getActiveTab();i.is(n)&&n.showAdvancedSearch(t)}}),e.searchcom_socket.addListener("hideAdvancedSearch",function(){if(i.is(e.snTabManager)){var t=e.snTabManager.getActiveTab();i.is(t)&&t.hideAdvancedSearch()}}),i.is(e.widget)&&i.is(e.widget.getValue("source"))){var f=e.widget.getValue("source");i.is(f,"array")&&f.length&&"swym"===f[0]&&e.widget.context&&(_=e.widget.context)}if(e.searchcom_socket.dispatchEvent("onWdgCreation",{widget_id:e.widget.id,tabid:_,transient_widget:p},["searchtopbar_socket_id"]),!s&&e.widget){var m=e.widget.getValue("customization_options");i.is(m,"object")&&!1===m.default_with_precond&&e.searchcom_socket.dispatchEvent("onSetFocusInSearchField",{},["searchtopbar_socket_id"])}if(i.is(e.widget)&&i.is(e.widget.setValue,"function")){e.widget.setValue("appId",a.SEARCH_APP_ID),e.widget.setValue("stayOnSearch","true"),e.widget.setValue("transient_context","false"),e.widget.setValue("search_wdg_id",e.widget.id),("true"===p||!0===p)&&(e.css_view_class="maximized");try{let t=e.resources;i.is(t,"object")||(t={active_tenant:e.widget.getValue("x3dPlatformId")}),!i.is(e.searchResources)&&(e.searchResources=new d(t))}catch(e){o.log("SearchRessources not initialized!")}var v=e.widget.getValue("customization_options");if(i.is(v)&&i.is(v.mode)){var S=i.clone(v);delete S.mode,e.widget.setValue("customization_options",S)}var w=e._getOriginalSearchOpts(),b="false"!==p&&!1!==p||!i.is(w)?e._getSearchOpts():w;e.widget.setValue("launch_mode",e._widget_launch_mode),b.fromTopbar=!0;var C={search_options:b,result_ux_customization:e.widget.getValue("result_ux_customization"),viewData:e.widget.getValue("viewData"),in_apps_search:v,search_widget:e,events:{onReady:function(){e._tabOnReady()},onPreviewModeRequest:function(){e._tabOnPreviewModeRequest()},onExitPreviewMode:function(){e._tabOnExitPreviewMode()}}};if(!i.is(e.snTabManager)){let t=e.resources;i.is(t,"object")||(t={active_tenant:e.widget.getValue("x3dPlatformId")});var y={widget_id:e.widget.id,launch_mode:e._widget_launch_mode,resources:t,itemViewClickHandler:e.widget.getValue("itemViewClickHandler"),source:e.widget.getValue("source"),addinMode:e.widget.data.addinmode,updateTitle:function(t){i.is(e.widget)&&e.widget.setTitle(t)},transient_context:p,use_preexisting_call:e.widget.getValue("use_preexisting_call"),update_preference:function(t,i){e.updateWidgetPreferences(t,i)},resetOriginalOptions:function(t){e._resetOriginalSearchOpts(t)},css_view_class:e.css_view_class,search_widget:this};i.is(e.widget)&&i.is(e.widget.metas)&&i.is(e.widget.metas.description,"string")&&e.widget.metas.description.contains("3DSwym")&&(y.swymContext=!0),i.is(e.widget.getValue("tagger_context_id"))&&(y.tagger_context_id=e.widget.getValue("tagger_context_id")),i.is(e.widget.getValue("pinToDashboard"))&&(y.pinToDashboard=e.widget.getValue("pinToDashboard")),e.snTabManager=new h(y),e.widget.setBody(e.snTabManager)}e.snTabManager.addTab({search_ux_options:C})}else o.warn("No widget, exiting from method")}else o.log("deleted widget -> exit")})},initWidgetVisiblePreferences:function(e,t){if(i.is(e)){var n=[];e.forEach(e=>{n.push({name:e.displayName,id:e.platformId})}),i.is(this.widget)&&i.is(this.widget.data)&&(activeTenant="",i.is(this.widget.data.activeTenant)&&(activeTenant=this.widget.data.activeTenant),this.widget.addPreference({name:"activeTenant",type:"list",options:n,label:"Selected Tenant",defaultValue:activeTenant}))}},_tabOnReady:function(){var e=this;if(i.is(e.widget)&&i.is(e.widget._view)&&"maximized"===e.widget._view.type&&!1===r.options.search_settings.taggerClosed){var t=r.getOption("search_compact_mode");i.is(t)||(t=!1),i.is(window)&&i.is(window.innerWidth)&&!(window.innerWidth>958)||!0===e.bAddinmode||-1!==["iphone","ipad","android"].indexOf(a.getDeviceCategory())||!1!==t||!0===r.options.search_settings.taggerClosed||!0!==r.getOption("no_TopFrame_ODT")&&require([h],function(t){var n=!1;if(i.is(t))try{i.is(t.isTaggerVisible,"function")&&!0===t.isTaggerVisible()&&(n=!0)}catch(e){i.is(t._isTaggerVisible)&&!0===t._isTaggerVisible&&(n=!0),o.log(e)}!1===n&&(e.searchcom_socket.dispatchEvent("openTagger"),a.setTaggerOpenedByCode(!0))})}!1===e.eventsRegistered&&(e.eventsRegistered=!0,e.widget.addEvent("onRefresh",e.onRefresh,e),e.widget.addEvent("onSearch",e.onSearchIn,e),e.widget.addEvent("on3DSearch",e.onSearch,e),e.widget.addEvent("onResetSearch",e.onResetSearch,e),e.widget.addEvent("onSearchWithOpts",e.snTabManager.onSearch,e.snTabManager),e.widget.addEvent("onViewChangeResults",e.snTabManager._onViewChange,e.snTabManager),e.widget.addEvent("endEdit",e.endEdit,e),i.is(e.events.onSNResultWdg_Ready,"function")&&e.events.onSNResultWdg_Ready.call(null))},_tabOnPreviewModeRequest:function(){var e=this;e.widget.setValue("previewMode",!0),e._previewMode=!0,e._bWidgetMaximizedForPreview=!1;var t=0===e.widget.id.indexOf("preview");e._previousWidgetViewType=i.is(e.widget.getView,"function")&&i.is(e.widget.getView(),"object")?e.widget.getView().type:"none",t||"3DSwym"===a.identifyClientInfo().identifier?"sidepanel"===e._previousWidgetViewType&&require([h],function(t){if(!t._frame.isPanelFitted("right")){e._bWidgetMaximizedForPreview=!0;var i={fit:!0,appId:a.SEARCH_APP_ID};t.openPanel("right",i).then(function(){t._onRightPanelStateChange("fitted")})}}):"fullscreen"!==e._previousWidgetViewType&&e.widget.dispatchEvent("onViewRequest",{type:"fullscreen"})},_tabOnExitPreviewMode:function(){this.widget.setValue("previewMode",!1),this._previewMode=!1,this.widget.requestView({type:this._previousWidgetViewType}),"sidepanel"===this._previousWidgetViewType&&this._bWidgetMaximizedForPreview&&require([h],function(e){i.is(e)&&i.is(e._frame)&&i.is(e._frame.openPanel,"function")&&e._frame.openPanel("right").then(function(){})})},onSearchIn:function(e){this.onSearch({value:e,searchInCriteria:e,search_criteria_to_display:e,searchInCurrentTab:!0,searchType:"#searchIn"})},onSearch:function(e){if(!i.is(e))throw new Error("Invalid arg in SNResultUX.onSearch!)");if(!i.is(this.snTabManager)||!i.is(this.snTabManager.getOption,"function")||"false"!==this.snTabManager.getOption("transient_context")&&!1!==this.snTabManager.getOption("transient_context")||this._getOriginalSearchOpts()||this._setOriginalSearchOpts(this._getSearchOpts()),i.is(e,"object"))this._onSearch(e);else{var t=this;require(["DS/SNInfraUX/PredefinedQueries","DS/SNResultUX/utils/WildcardMgr"],function(i,n){a.getsearchType()!==a.SearchTypeEnum.SEARCH_IN&&a.getsearchType()!==a.SearchTypeEnum.SEARCH||a.executeWithPQ({wait:function(){if(e&&e.indexOf(":")>0)return i.fetchPQsFromServer(t.searchResources),!0},run:function(){var i=n.manageWildcardAddtion(e);i=a.replacePQsWithCVPrefixes(i),t._onSearch({value:i,searchStringToDisplayInSearchField:e,searchInCriteria:i,searchInCurrentTab:!0})}})})}},updateWidgetPreferences:function(e,t){let n=null;const s=(this._widget_launch_mode===a.widgetLaunchMode.PINNED||this._widget_launch_mode===a.widgetLaunchMode.COMPASS_PINNED)&&this._isAmMaximized();if(s&&(n=this._getOriginalSearchOpts()),i.is(e,"object"))for(var o in e)this.widget.setValue(o,e[o]),n&&i.is(n[o])&&(n[o]=e[o]);else i.is(e,"string")&&(this.widget.setValue(e,t),n&&i.is(n[e])&&(n[e]=t));s&&!i.is(e.searchInCurrentTab)&&this._setOriginalSearchOpts(n)},_resetOriginalSearchOpts:function(e){let t=this._getOriginalSearchOpts(),n=this;e.map(e=>i.is(t[e])&&n.widget.setValue(e,t[e]))},_onSearch:function(e){if(!i.is(e,"object"))throw new Error("Invalid arg, expects an object!");let t;t=i.is(e.searchInCurrentTab,"boolean")&&!0===e.searchInCurrentTab?{searchInCurrentTab:!0,search_criteria_to_display:e.searchStringToDisplayInSearchField}:{search_criteria:e.value,search_criteria_to_display:e.searchStringToDisplayInSearchField,adv_search:e.adv_search,searchInCurrentTab:e.searchInCurrentTab,advanced_criteria:e.advanced_criteria,adv_search_field:e.adv_search_field,tag_filter:e.tag_filter?e.tag_filter:"",recent_filter:i.is(e.sFilter)?e.sFilter:"*",queryType:i.is(e.queryType)?e.queryType:null,originalSearchCriteria:null},i.is(e.source)&&(t.source=e.source),this.updateWidgetPreferences(t);var n=!1;if(i.is(this.snTabManager)){var s=this.snTabManager.getActiveTaggerProxy(),o=null;i.is(s)&&(o=s.getCurrentFilter());var a=null;i.is(o)&&(a=o.allfilters),i.is(o)&&i.is(a)&&(d.isSimplifiedTaggerFilters(a)?n=!d.isEmpty(a):0!==Object.keys(a).length&&(n=!0))}if(!e.adv_search||!n){var r={};i.is(e)&&(r=i.clone(e)),r.refresh=!i.is(e.refresh)||e.refresh;var l=this._getSearchOpts(r);i.is(e.newActiveTenant)&&(l.newActiveTenant=e.newActiveTenant),e.customization_options&&(l.in_apps_search=e.customization_options),e.savedSearch&&(l.savedSearch=e.savedSearch),this.widget.dispatchEvent("onSearchWithOpts",l)}this.widget.setValue("viewData",e.viewData)},onResetSearch:function(){var e=this._getOriginalSearchOpts();i.is(e)&&this.widget.dispatchEvent("onSearchWithOpts",e)},onRefresh:function(){this.snTabManager&&this.snTabManager.onRefresh()},onEndEdit:function(){i.is(this.snTabManager)&&this.snTabManager.hideTabBar(),this.onLoad()},onViewChange:function(e){if("fullscreen"===e.type||"maximized"===e.type){var t=this.widget.getValue("originalSearchCriteria");if("maximized"===e.type&&this._widget_launch_mode===a.widgetLaunchMode.PINNED&&n.dispatch("search:refreshSearchField",{searchStringToDisplayInSearchField:this.widget.getValue("search_criteria_to_display"),internalSearchCriteria:this.widget.getValue("search_criteria"),originalSearchCriteria:t}),e.height&&!0!==this._previewMode&&this._setBodyHeight(e.height),i.is(this.snTabManager)){var s=this.snTabManager.getActiveTaggerProxy();i.is(s)&&i.is(s.getDisplayStatus,"function")&&!1===s.getDisplayStatus()&&!0!==this._previewMode&&(i.is(a)&&a.setTaggerOpenedByCode(!0),!0!==this._previewMode&&!0!==r.getOption("search_compact_mode")&&this.searchcom_socket.dispatchEvent("openTagger"))}}else this._setBodyHeight("100%"),i.is(a)&&i.is(a.isTaggerOpenedByCode,"function")&&!0===a.isTaggerOpenedByCode()&&(this.searchcom_socket.dispatchEvent("closeTagger"),a.setTaggerOpenedByCode(!1));null!==this.searchcom_socket&&this.searchcom_socket.dispatchEvent("onViewChange",{widget_id:this.widget.id},["searchtopbar_socket_id"]),this.css_view_class=e.type,this.widget.dispatchEvent("onViewChangeResults",e)},_getSearchOpts:function(e){var t=!1,n=!1;i.is(this.widget.getValue("advanced_criteria"))&&this.widget.getValue("advanced_criteria").length>0&&(t=!0),i.is(this.widget.getValue("search_criteria"))&&"#advancedSearch"===this.widget.getValue("search_criteria")&&(n=!0);var s=this.widget.getValue("tag_filter");"string"==typeof s&&s.length>0&&(s=JSON.parse(s));var o=this._getOriginalSearchOpts();i.is(e)&&"#search"===e.searchType&&i.is(o)&&(o.search_criteria=null);var r=null;return(!n||n&&!t)&&(r={search_criteria:this.widget.getValue("search_criteria"),adv_search:this.widget.getValue("adv_search"),search_criteria_to_display:this.widget.getValue("search_criteria_to_display"),advanced_criteria:n?void 0:this.widget.getValue("advanced_criteria"),recent_filter:this.widget.getValue("recent_filter"),source:n?this.widget.getValue("source"):i.is(e)&&i.is(e.source,"array")?e.source:[],search_mode:"index",tag_filter:s,refresh:!!i.is(e)&&e.refresh,reSearch:i.is(e)?e.reSearch:null,widget_search_criteria:o&&!n?o.search_criteria:void 0,order_by:this.widget.getValue("order_by"),order_field:this.widget.getValue("order_field"),searchInCriteria:i.is(e)?e.searchInCriteria:null,resetLocalFilter:i.is(e)?e.resetLocalFilter:null,queryType:i.is(e)?e.queryType:null,removeHistory:!!i.is(e)&&e.removeHistory,addNewTab:!!i.is(e)&&e.addNewTab}),!0===this.widget.getValue("adv_search")&&i.is(r)&&(r.originalSearchCriteria=a.SearchTypeEnum.ADVANCED_SEARCH),r&&""===r.search_criteria&&""!==r.recent_filter&&!1===r.adv_search&&"index"===r.search_mode&&(r.search_criteria="("+r.recent_filter+")"),r},_getOriginalSearchOpts:function(){let e=this.widget.getValue("original_search_options"),t=null;return i.is(e)&&(t={search_criteria:e.search_criteria,adv_search:e.adv_search,search_criteria_to_display:e.search_criteria_to_display,advanced_criteria:e.advanced_criteria,search_mode:e.search_mode,tag_filter:e.tag_filter}),t},_setOriginalSearchOpts:function(e){this.widget.setValue("original_search_options",e)},_setBodyHeight:function(e){i.is(e)&&(isNaN(e)||(e+="px"),this.widget.body.setStyle("height",e))},_isAmMaximized:function(e){if(i.is(this.widget)){var t=!1;return"maximized"===this.widget.getView().type&&(t=!0),i.is(e)&&i.is(this.widget.context)&&"transient"!==this.widget.context&&(t=!1,e===this.widget.context&&(t=!0)),t}},_getWidgetState:function(){if(!i.is(this.widget))return;let e=this.widget.getView();return i.is(e.type)?e.type:void 0}})}),define("DS/SNResultUX/utils/PowerByActionsHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/PlatformAPI/PlatformAPI"],function(e,t,i,n,s){"use strict";return t.singleton(i,{executeAction:function(t,i){if(!e.is(t,"object")||!e.is(t.object_ids,"array")||!e.is(t.action_id,"string"))throw new Error("invalid input to action handler");console.log(t),s.publish("webinwin:web:notification",JSON.stringify({event:"search_contextualaction_launch",content:{action_id:t.action_id,object_ids:t.object_ids}}))}})}),define("DS/SNResultUX/views/WebUX/Spreadsheet/Manager_EndUserCusto",["DS/Spreadsheet/Manager","DS/Utilities/Dom"],function(e,t){"use strict";return e.extend({_listenEvents:function(){var e=this;this.onMoveRow(function(t){e.processCellsOfRow(t.toRowID,function(e){e.options.rowID===t.fromRowID&&(e.options.rowID=t.toRowID)})}),this._selectedCells.onPostAdd(function(e){e.forEach(function(e){e.highlight(),e._view&&parseInt(e._view.elements.container.getAttribute("virtual-row-id"),10)===e.options.rowID&&parseInt(e._view.elements.container.getAttribute("virtual-column-id"),10)===e.options.columnID&&e._view.highlight()})}),this._selectedCells.onPostRemove(function(e){e.forEach(function(e){e.unhighlight(),e._view&&parseInt(e._view.elements.container.getAttribute("virtual-row-id"),10)===e.options.rowID&&parseInt(e._view.elements.container.getAttribute("virtual-column-id"),10)===e.options.columnID&&e._view.unhighlight()})}),t.addEventOnElement(this,document,"keydown",function(t){var i=UWA.Event.whichKey(t);"ctrl"!==i||e._modeIsMultiSel||!e._allowSettingMultiSelMode||e._multiSelModeHasBeenForced||(e._modeIsMultiSel=!0),"shift"!==i||e._modeIsRange||(e._modeIsRange=!0)}),t.addEventOnElement(this,document,"keyup",function(t){var i=UWA.Event.whichKey(t);"ctrl"!==i||e._multiSelModeHasBeenForced||(e._modeIsMultiSel=!1),"shift"===i&&e._modeIsRange&&(e._modeIsRange=!1)}),this.onCellPointerDown(function(t){var i=t.cellView.getVirtualCoordinates().virtualRowID,n=t.cellView.getVirtualCoordinates().virtualColumnID;e.__disableInteractiveSort||(e.prepareUpdateView(),e.isRowSelected(i)?e.unselectRow(i):e.selectRow(i,-1!==n),e.pushUpdateView())}),t.addEventOnElement(e,e.getContent(),"click",function(){e._hasBeenClicked=!0,setTimeout(function(){e._hasBeenClicked=!1},200)}),this.onCellClick(function(t){var i=t.cellModel,n=t.cellView.getVirtualCoordinates(),s=n.virtualRowID,o=n.virtualColumnID;if(!e.__disableInteractiveSort){if(-1===s){var a=e._getColumnOptionValue(o,"isSortable"),r=["sort:asc","sort:desc"],l=e._getColumnState(o),c=function(e,t){void 0===t&&(t=0);var i=e.slice(0);return{getCurrent:function(){return i[t]},getNext:function(){return t=++t%i.length,this.getCurrent()},getPrevious:function(){return--t<0&&(t+=i.length),this.getCurrent()}}}(r,r.indexOf(l)).getNext();switch(e.unselectAll(),c){case"sort:desc":a&&(e.prepareUpdateView(),e.sortColumnContent(o,{typeOfCell:"number",sortOrder:"desc"}),e.pushUpdateView());break;case"sort:asc":a&&(e.prepareUpdateView(),e.sortColumnContent(o,{typeOfCell:"number",sortOrder:"asc"}),e.pushUpdateView())}}if(-1!==s&&-1!==o&&e.options.selection.cells){if(e.prepareUpdateView(),e._preventNextUpdateView(),e.unselectAll({cells:!0,updateView:!1}),e._modeIsRange){var d,u,h,g,p,_,f=i,m=e._selectedCells.get()[0];e._selectedCells.empty(),e._selectedCells.add(m);var v=m.getView().getVirtualCoordinates(),S=f.getView().getVirtualCoordinates();for(v.virtualRowID<S.virtualRowID?(h=v.virtualRowID,g=S.virtualRowID):(g=v.virtualRowID,h=S.virtualRowID),d=h;d<=g;d++)for(v.virtualColumnID<S.virtualColumnID?(p=v.virtualColumnID,_=S.virtualColumnID):(_=v.virtualColumnID,p=S.virtualColumnID),u=p;u<=_;u++)if(d!==v.virtualRowID||u!==v.virtualColumnID){var w=e.getCell(d,u);e._selectedCells.add(w)}}else e._modeIsMultiSel?e._selectedCells.add(i):e._selectedCells.unique(i);e.pushUpdateView()}}})}})}),define("DS/SNResultUX/utils/AddTag_ActionHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/TagNavigator/userTags/UserTagsModel","DS/TagNavigator/userTags/UserTagsView","DS/TagNavigator/userTags/utils/UserTagsUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/SearchSettings","DS/Controls/Tab","DS/Controls/Editor"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_){"use strict";return t.singleton(n,i,{modal:null,okBtn:null,isCollectiveTagging:!1,_userTagsView:null,_currentTab:"add",executeAction:function(t){if(!0===g.getOption("isCollectiveTagging")){if(this.isCollectiveTagging=!0,!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");t&&t.actionsHelper;this._buildModalTag(t)}else{if(!(e.is(t,"object")&&e.is(t.object_ids,"array")&&e.is(t.action_id,"string")&&t.actionsHelper))throw new Error("Invalid input to action handler");t&&t.actionsHelper;this.addTag(t)}},addTag:function(t){if(!e.is(t))return;let i=this;i.okBtn=new o({className:"primary addTagBtn",value:d.get("add_tag.addButton"),disabled:!0,events:{onClick:function(){i._userTagsView.commit({hasPlatformData:!0}),i.modal.destroy()}}}),this.modal=new a({header:d.get("add_tag.add_tag_title"),className:"add_tag",closable:!0,body:"",events:{onHide:function(){i.modal.destroy()}},footer:[this.okBtn,new o({value:d.get("CancelButton"),className:"cancelTagBtn default",events:{onClick:function(){i.modal.destroy()}}})]}).inject(document.body),this.modal.setBody(this._buildaddTagForm(t)),this.modal.show()},actionOnCommit:function(){h._displayAlert({message:d.get("add_tag.add_tag_successful"),className:"success addTagAlert"})},actionOnFailure:function(){h._displayAlert({message:d.get("add_tag.add_tag_failure"),className:"failure addTagAlert"})},onSelectionChangeInView:function(e){this.okBtn&&(e>0?this.okBtn.enable():this.okBtn.disable())},getContainerId:function(t){let i;for(let n of t)if(i=n.get("ds6w:containerUid"),e.is(i))break;return i},getSubjectUriCount:function(e){return e.filter(e=>e.uri).length},_buildaddTagForm:function(e){var t=s.create("form",{class:"formAddTag"}),i=s.create("div",{class:"divAddTag"});i.inject(t);let n=e.actionsHelper.getPlatformID({id:e.object_ids[0]}),o=[],a=e.object_ids,h=[];for(let t of a)h.push(e.collection.get(t));o=u.getTaggerSubjectURIForMultipleSources(h,n);var g=new r({subjects:o,applicativeSuggestions:[],platformId:n,readOnly:!1});let p=e.collection.search_ressources.getActiveTenant(),_=this.getContainerId(h);if(1==this.getSubjectUriCount(o)&&_){let e={appName:"3DSearch",currentUser:u.getUserId(),platformId:p,vocabSuggestions:!1,communityTags:!0,communityId:_};c.getSuggestionsFor3DSwymContent(e).then(function(e){UWA.is(e,"object")&&UWA.is(e.suggestions,"array")&&g.set("applicativeSuggestions",e.suggestions)})}return this._userTagsView=new l({model:g,suggestsInfo:{placeHolder:d.get("add_tag.add_tag_default_text"),filterMessage:"customFilterMessage...",allowFreeText:!0,vocabSuggestions:!0},manageDirtyState:!0,onCommit:this.actionOnCommit.bind(this),onFailure:this.actionOnFailure.bind(this),onSuggestDisplayed:function(){},touchMode:!1,onSelectionChange:this.onSelectionChangeInView.bind(this)}).render().inject(i),t},_buildModalTag:function(t){if(!e.is(t))return;let i=this;i.okBtn=new o({className:"primary addTagBtn",value:d.get("add_tag.addButton"),disabled:!0,events:{onClick:function(){if("remove"===i._currentTab){require(["DS/CollectiveTagging/CollectiveTaggingHelpers"],function(e){t._userTagsView=i._userTagsView,t._description=i._description,e.requestRemoveTag(t)})}else i._userTagsView.commit({hasPlatformData:!0});i.modal.destroy()}}}),i.modal=new a({header:d.get("add_tag.add_tag_title"),className:"add_tag",closable:!0,body:"",events:{onHide:function(){i.modal.destroy()}},footer:[i.okBtn,new o({value:d.get("CancelButton"),className:"cancelTagBtn default",events:{onClick:function(){i.modal.destroy()}}})]}).inject(document.body),i._tabContainer=new p({displayStyle:["strip"],centeredFlag:!1,newTabButtonFlag:!1,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1,touchMode:!0,closeButtonFlag:!1,showComboBoxFlag:!0,allowUnsafeHTMLOnTabButton:!1}),i._tabContainer.addEventListener("change",function(t){if(e.is(t)&&e.is(t.dsModel)){t.stopPropagation();let n=t.dsModel;if(n&&n===i._tabContainer){let t=n.value;e.is(t,"array")&&(i._currentTab=t[0],"remove"===i._currentTab?i.okBtn.setValue(d.get("collectiveTagging.sendButton")):i.okBtn.setValue(d.get("add_tag.addButton")))}}}),i._addtab=i._tabContainer.add({label:d.get("collectiveTagging.addTags"),isSelected:!0,value:"add",content:i._buildaddTagTab(t)}),i._removetab=i._tabContainer.add({label:d.get("collectiveTagging.removeTag"),value:"remove",content:i._buildremoveTagTab(t)}),i.modal.setBody(this._tabContainer),i.modal.show()},_buildaddTagTab:function(t){if(!e.is(t))return;let i=this,n=s.create("div",{class:"collectiveAddTag"});i._buildaddTagForm(t).inject(n);let o=s.create("div",{class:"collectiveAddTagRequest"});o.inject(n);let a=s.create("span",{class:"collectiveAddTagRequest-text"});return a.setText(d.get("collectiveTagging.addrequestPanel")),a.inject(o),s.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tag-add ",events:{touchstart:function(){this.isTouchable=!0},click:function(){i.modal.destroy();require(["DS/CollectiveTagging/CollectiveTaggingHelpers"],function(e){e.displayModalAddTag(t)})}}}).inject(o),n},_buildremoveTagTab:function(t){if(!e.is(t))return;let i=s.create("div",{class:"collectiveAddTag"}),n=s.create("div",{class:"collectiveAddTagText"});n.inject(i),this._buildaddTagForm(t).inject(n);let o=s.create("div",{class:"collectiveAddTagDescription"});o.inject(i);let a=s.create("span",{class:"collectiveAddTagText-text"});return a.setText(d.get("collectiveTagging.removeTagsDesc")),a.inject(o),this._description=new _({placeholder:d.get("collectiveTagging.removePlace"),requiredFlag:!1,nbRows:4,newLineMode:"enter"}),this._description.inject(o),i}})}),define("DS/SNResultUX/views/utils/SearchHeaderCmd",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/UIKIT/Tooltip","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a){"use strict";return t.extend(n,i,{render:function(t){if(!e.is(t))return;var i=this;i.headerscontent=s.create("div",{class:"searchHeaderCmd_content"}),i.headerscontent.inject(t,"before"),i.headerhistory=s.create("div",{class:"searchHeaderCmd_content_Header"}),i.headerhistory.inject(i.headerscontent);var n=s.create("span",{id:"History",class:"fonticon fonticon-navigation-history"}).inject(i.headerhistory);let r=new o({position:"bottom",target:n,body:a.get("actions.History.toolTip")});n.addEvent("click",function(e){i.dispatchEvent("onHistoryAction"),e.stopPropagation()}),i.headerinformationpanel=s.create("div",{class:"searchHeaderCmd_content_Header"}),i.headerinformationpanel.inject(i.headerscontent);var l=s.create("span",{id:"InfoPanel",class:"fonticon fonticon-info"}).inject(i.headerinformationpanel);r=new o({position:"bottom",target:l,body:a.get("actions.InfoPanel.toolTip")}),l.addEvent("click",function(e){i.dispatchEvent("onInformationPanelAction"),e.stopPropagation()})}})}),define("DS/SNResultUX/utils/ResultColorizationHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings"],function(e,t,i,n,s){"use strict";return t.extend(i,{_currentPredicate:null,_colorMap:null,_hierarchyMap:null,_maxHierarchy:0,init:function(){let e=s.getOption("default_deep_hierarchy_tag_depth");this._colorMap=new Map,this._hierarchyMap=new Map;for(let t=0;t<e;t++)this._hierarchyMap.set(t,new Set)},getColor:function(t){let i=t.get(this._currentPredicate);return e.is(i,"array")&&(i=this._getEffectiveTag(i)),e.is(this._colorMap)&&this._colorMap.has(i)?this._colorMap.get(i):null},setColorMap:function(t){e.is(t,"array")&&(t.length>0&&(this._currentPredicate=t[0].predicate.split("/").pop().concat("_value")),this._colorMap.clear(),t.forEach((e,t)=>{this._colorMap.set(e.object.toString(),e.color)}))},unsetColorMap:function(){this._currentPredicate=null,this._colorMap.clear()},_getEffectiveTag:function(t){for(let i=0;i<t.length;i++)e.is(t[i],"string")?(this._hierarchyMap.get(0).add(t[i].toString()),this._maxHierarchy++):(this._hierarchyMap.get(t[i].length-1).add(t[i].toString()),this._maxHierarchy<=t[i].length&&this._maxHierarchy++);let i=void 0,n=!1;for(let t=this._maxHierarchy-1;t>=0;t--){const s=this._hierarchyMap.get(t);if(s.size>0&&this._colorMap.has(s.values().next().value)){if(s.size>1){n=!0;break}e.is(i)||(i=s.values().next().value)}}if(this._cleanUp(),!1===n)return i},_cleanUp:function(){for(const e of this._hierarchyMap.values())e.clear();this._maxHierarchy=0}})}),define("DS/SNResultUX/views/WebUX/CollectionView/ResponsiveMultiCollectionView",["UWA/Drivers/Alone","UWA/Core","UWA/Element","DS/Core/Core","DS/Controls/Scroller","DS/Utilities/Dom","DS/Utilities/Utils","UWA/Utils/Client","UWA/Utils","DS/Utilities/RAFDispatcher","DS/Utilities/ReusableContentsManager","DS/CollectionView/ResponsiveCollectionView","DS/CollectionView/layouts/CollectionViewGridLayout","DS/Controls/ResponsiveTileView","DS/Controls/ResponsiveTextualTileView","DS/CollectionView/CollectionViewCell","DS/Core/PointerEvents"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f){"use strict";var m=h.inherit({name:"ResponsiveMultiCollectionViewLayout"});return u.inherit({name:"ResponsiveMultiCollectionView",publishedProperties:{allowLargeItems:{defaultValue:!1,type:"boolean"}},_applyProperties:function(e){this._parent(e),this.isDirty("allowLargeItems")&&this._applyAllowLargeItems(e.allowLargeItems)},_applyAllowLargeItems:function(e){this.allowLargeItems?(this.cellStyleOverload="wux-cell-responsivetile-large-allow",this.elements.container.addClassName("wux-layout-largetilecollectionView")):(this.cellStyleOverload="wux-cell-responsivetile",this.elements.container.removeClassName("wux-layout-largetilecollectionView")),this.invalidateLayout()},_preBuild:function(){this._properties.layout.value=new m({columnMaxWidth:400,gutter:10}),this._parent()},_postBuildView:function(){this.cellClassForView=g,this._parent();var e=this,t=this;e.registerReusableCellContent({id:"Tile",buildContent:function(){var i=new e.cellClassForView;return i.layoutingCollection=t,t._onEndResize(function(){this._processPoolCells(function(e){e.cellView.component.collectionView;var t=e.cellView.component.contentView;t&&t._onTileResize()})}),i}}),e.onCellRequest(function(t){var i=e.reuseCellContent("Tile");t.cellView.collectionView=e,t.cellView.contentView=i,i.cellInfos=t,i.unPrehighlight(),!0===e.useDragAndDrop?t.cellView.elements.container.setAttribute("draggable","true"):t.cellView.elements.container.setAttribute("draggable","false"),t.cellView.elements.container.dsView=t.cellView,t.cellView.getContent().addClassName(e.cellStyleOverload),i.getContent().setStyles({width:"100%",height:"100%"});var n=t.cellModel,s=[],o=e.getBadges(n);if(o&&(o.topRight&&s.push(o.topRight),o.bottomRight&&s.push(o.bottomRight)),e.displayedOptionalCellProperties[0]==["All"])i.setProperties({title:e.getLabel(n),customTooltip:e.getCustomTooltip(n),clickableTitle:e.getClickableTitle(n),multipleTitleLineNumber:e.getMultipleTitleLineNumber(n),subtitle:e.getSubLabel(n),description:e.getDescription(n),propertiesList:e.getPropertiesList(n),picture:e.getThumbnail(n),icon:e.getIcon(n),emptyStatusbarVisibleFlag:e.getEmptyStatusbarVisibleFlag(n),statusbarIconsTooltips:e.getStatusbarIconsTooltips(n),activeFlag:e.getActiveFlag(n),statusbarIcons:e.getStatusbarIcons(n),badges:s,contextualMenu:e.getContextualMenu(n),color:e.getColor(n),disabled:e.getDisabled(n)});else if(e.displayedOptionalCellProperties[0]==["None"])i.setProperties({title:e.getLabel(n),customTooltip:e.getCustomTooltip(n),clickableTitle:e.getClickableTitle(n),multipleTitleLineNumber:e.getMultipleTitleLineNumber(n),subtitle:e.getSubLabel(n),picture:e.getThumbnail(n),icon:e.getIcon(n),emptyStatusbarVisibleFlag:!1,statusbarIconsTooltips:e.getStatusbarIconsTooltips(n),color:e.getColor(n),disabled:e.getDisabled(n)});else{var a=-1!==e._displayedOptionalCellProperties.indexOf("statusbarIcons"),r={title:e.getLabel(n),customTooltip:e.getCustomTooltip(n),clickableTitle:e.getClickableTitle(n),multipleTitleLineNumber:e.getMultipleTitleLineNumber(n),subtitle:e.getSubLabel(n),picture:e.getThumbnail(n),icon:e.getIcon(n),emptyStatusbarVisibleFlag:!!a&&e.getEmptyStatusbarVisibleFlag(n),statusbarIconsTooltips:e.getStatusbarIconsTooltips(n),color:e.getColor(n),disabled:e.getDisabled(n)};-1!==this._displayedOptionalCellProperties.indexOf("description")&&(r.description=e.getDescription(n)),-1!==this._displayedOptionalCellProperties.indexOf("propertiesList")&&(r.propertiesList=e.getPropertiesList(n)),-1!==this._displayedOptionalCellProperties.indexOf("activeFlag")&&(r.activeFlag=e.getActiveFlag(n)),-1!==this._displayedOptionalCellProperties.indexOf("statusbarIcons")&&(r.statusbarIcons=e.getStatusbarIcons(n),r.badges=s),-1!==this._displayedOptionalCellProperties.indexOf("contextualMenu")&&(r.contextualMenu=e.getContextualMenu(n)),-1!==this._displayedOptionalCellProperties.indexOf("disabled")&&(r.disabled=e.getDisabled(n)),i.setProperties(r)}t.cellView._setReusableContent(i),this.selectionBehavior.enableFeedbackForActiveCell&&(n===this.activeNode?i.activate():i.deactivate()),this.modelProvider.isNodeSelected(n)?i.highlight():i.unhighlight(),e._onPostRequestCellCB&&e._onPostRequestCellCB.call(e,t)})},activateInteractiveCumulativeSelection:function(){this._interactiveCumulativeSelection=!0,this._enableInteractiveMultiSelMode(),this._modelEvents.publish({event:"interactiveCumulativeSelectionChanged",data:{responsiveCollectionView:this,cumulativeSelection:!0}})},isInInteractiveCumulativeSelectionFlag:function(){return this._interactiveCumulativeSelection},deactivateInteractiveCumulativeSelection:function(){this._interactiveCumulativeSelection=!1,this._disableInteractiveMultiSelMode(),this._modelEvents.publish({event:"interactiveCumulativeSelectionChanged",data:{responsiveCollectionView:this,cumulativeSelection:!1}})},_enableInteractiveMultiSelMode:function(){!this.selectionBehavior.canInteractiveMultiselectWithCheckboxClick&&!0!==this._interactiveCumulativeSelection||-1!==this.elements.container.className.indexOf("wux-multiselmode-responsivetilecollectionView")||!1===this._isInteractiveMultiSelMode&&(this._isInteractiveMultiSelMode=!0,this.elements.container.addClassName("wux-multiselmode-responsivetilecollectionView"))},_disableInteractiveMultiSelMode:function(){!1===this._interactiveCumulativeSelection&&this.elements.container.className.indexOf("wux-multiselmode-responsivetilecollectionView")&&!0===this._isInteractiveMultiSelMode&&(this._isInteractiveMultiSelMode=!1,this.elements.container.removeClassName("wux-multiselmode-responsivetilecollectionView"))}})}),define("DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils",["UWA/Core","UWA/Element","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger"],function(e,t,i,n){"use strict";function s(t){if(!e.is(t))return;let i;switch(t){case"what":i="ds6w:what/type_categorization";break;case"where":i="ds6w:where/ds6w:location/computedCountryInfo";break;case"who":i="ds6w:who/person";break;case"when":i="sixw:ds6w:when/ds6w:modified"}return i}function o(t,i,n,o,a){if(!e.is(i)||!e.is(n))return;if("where"===t)return function(t,i,n,o,a){if(!e.is(i)||!e.is(n)||!e.is(o))return;let r,l=0,c=s(t),d=[];if(!1===a){let t=i.getCurrentFilter();if(e.is(t)){let i=t.localfilters;e.is(i)&&e.is(i.condition)&&i.condition.forEach(function(t){let i=Object.keys(t);if(i[0]===c){let n=t[i];if(e.is(n)&&e.is(n.condition))n.condition.forEach(function(e){d.push(e.display)});else{let t=n[0];e.is(t)&&d.push(t.displayValue)}}})}}if(d.length){let t=e.is(o.getRefineHelpers().globeViewContainerContent)&&o.getRefineHelpers().globeViewContainerContent._continents,i=e.is(t)&&Object.keys(t),s=e.is(i)&&i.length;for(let n=0;n<s;n++){let a=t[i[n]];if(e.is(a)&&a===d[0]){let t=o.getRefineHelpers().globeViewContainerContent._continentsList,a=t[i[n]],r=e.is(a)&&a.countries,l=e.is(r)&&Object.keys(r);d=[];let c=l.length,u=0;for(u=0;u<c;u++)d.push(l[u]);n=s}}r=e.clone(n);let a=[],c=r.groups[0].object;d.forEach(function(t){let i=c.findIndex(function(e){if(e.dispText===t)return!0});-1!==i&&a.push(e.clone(c[i]))}),a.length&&(r.groups[0].object=a,l=a.length+1)}else r=n;let u,h=r.groups[0];switch(h?h.predicate:""){case"type_categorization":u="what";break;case"computedCountryInfo":u="where";break;case"person":u="who";break;case"ds6w:modified":u="when"}return{Tags:r,SearchBack:l,W:u}}(t,i,n,o,a);let r,l=0,c=!1,d=s(t),u=[];if(!1===a){let t=i.getCurrentFilter();if(e.is(t)){let i=t.localfilters;e.is(i)&&e.is(i.condition)&&i.condition.forEach(function(t){let i=Object.keys(t);if(i[0]===d){let n=t[i];if(e.is(n)&&e.is(n.condition))n.condition.forEach(function(e){u.push(e.object)});else{let t=n[0];e.is(t)&&u.push(t.object)}}})}}if(u.length){r=e.clone(n);let t=[];if(e.is(r)&&e.is(r.groups)&&e.is(r.groups[0])){let i=r.groups[0].object,n=i=>{u.forEach(function(n){let s=i.findIndex(function(e){return e.type&&"date"===e.type?e.object.from===n.from&&e.object.to===n.to:e.identifier===n});-1!==s&&t.push(e.clone(i[s]))})},s=e=>{for(let t=0;t<e.length;t++)e[t].subGroups&&e[t].subGroups.length>0&&s(e[t].subGroups);n(e)};s(i),t.length&&(r.groups[0].object=t,l=t.length,c=!0)}}else r=n;let h,g=r.groups[0];switch(g?g.predicate:""){case"type_categorization":h="what";break;case"computedCountryInfo":h="where";break;case"person":h="who";break;case"ds6w:modified":h="when"}return{Tags:r,SearchBack:l,W:h,computeGroup:c}}return{getEmbeddedTaggerTags:function(e,t,i,n,s){return o(e,t,i,n,s)},selectElementInGlobalView:function(t,i){return function(t,i){if(!e.is(t)||!e.is(i))return;let n=i.getTreeDocument(),s=e.is(n)&&n.getRoots();if(e.is(s,"array")){let i=s.length,n=0;for(;n<i;n++){let o=s[n];e.is(o)&&e.is(o._options)&&o._options.id===t&&(o.select(),n=i)}}}(t,i)},manageSearchBackArrow:function(t,i){return function(t,i){if(!e.is(t)||!e.is(i))return;let n=t.getSNResultMgt(),s=t.getViewId();i?n&&n.hideSearchContentSetHeader():"what"!==s&&"who"!==s&&"when"!==s&&"where"!==s&&n&&n.showSearchContentSetHeader()}(t,i)},manageDisplayChannelView:function(t,n,s,o,a){return function(t,n,s,o,a){if(!e.is(t)||!e.is(n))return;let r=t.getTreeDocument();if(!e.is(r._trueRoot))return;let l=r&&r.getRoots(),c=l&&l.length,d=!1,u=0;for(r.prepareUpdate();u<c;u++){let t=l[u];e.is(t)&&t.show()}if(e.is(s,"object")){let e=s.width;e<=620?"textual"===n||"largeTextual"===n?(u=1,d=!0):"thumbnail"===n&&(u=1,d=!0):e>=621&&e<=1145?"textual"===n||"largeTextual"===n?(u=3,d=!0):"thumbnail"===n&&(u=2,d=!0):e>=1150&&e<=1450?"textual"===n||"largeTextual"===n?(u=3,d=!0):"thumbnail"===n&&(u=3,d=!0):e>=1455&&e<=1850?"textual"===n||"largeTextual"===n?(u=3,d=!0):"thumbnail"===n&&(u=4,d=!0):"textual"===n||"largeTextual"===n?(u=3,d=!0):"thumbnail"===n&&(u=5,d=!0)}else-1!==["iphone","android"].indexOf(i.getDeviceCategory())?"textual"!==n&&"largeTextual"!==n&&"thumbnail"!==n||(u=1,d=!0):"textual"===n||"largeTextual"===n?(u="normal"===s?1:3,d=!0):"thumbnail"===n&&(u="normal"===s?1:5,d=!0);if(e.is(o)&&"where"===o&&(u=4,d=!0,e.is(a)&&!0===a.getMaxDisplay()&&(u=8)),!0===d)for(;u<c;u++){let t=l[u];e.is(t)&&t.hide(!1)}r.pushUpdate()}(t,n,s,o,a)},checkIfRefine:function(t,i,n,o){return function(t,i,n,o){let a=!1;if(!e.is(t)||!e.is(i))return a;let r=n;if("where"===o&&"where"===r)return a;if(r===o){i.W;let n=t.getCurrentFilter();if(e.is(n)){let t=n.localfilters;if(e.is(t)&&e.is(t.condition,"array")){let e=s(r);t.condition.forEach(function(t){Object.keys(t)[0]===e&&(a=!0)})}}}return a}(t,i,n,o)},createSearchMultiViewLabel:function(i,n,s){let o;if(o=e.is(s)&&e.is(s.isRecentContent)&&!0===s.isRecentContent&&e.is(s.accessRecentContent)?t.create("div",{class:"search-multi-view-label",events:{click:s.accessRecentContent}}):t.create("div",{class:"search-multi-view-label"}),e.is(i.icon)){let n=e.is(i.icon.classes)&&e.is(i.icon.classes.split("fonticon-"))&&e.is(i.icon.classes.split("fonticon-")[1])?"tn-"+i.icon.classes.split("fonticon-")[1].split(" ")[0]:void 0,s=t.create("div",{class:"search-multi-view-icon fonticon "+i.icon.classes+" "+n});e.is(i.icon)&&e.is(i.icon.image)&&t.create("img",{src:i.icon.image}).inject(s),s.inject(o)}var a=t.create("div",{class:"search-multi-view-encart"});return e.is(i.headTitle)&&t.create("p",{text:i.headTitle}).inject(a),e.is(s)&&e.is(s.isRecentContent)&&!0===s.isRecentContent&&e.is(s.accessRecentContent)?t.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-right search-multi-view-recent-content"}).inject(a):(t.create("p",{text:"who"===n?"-":"|"}).inject(a),t.create("p",{text:-1===i.totalCount?i.getComputedResultCount():i.hits}).inject(a)),a.inject(o),e.is(s)&&e.is(s.onclick,"function")&&(o.onclick=s.onclick),o},removeFilter:function(t,i){return function(t,i){if(!e.is(t)||!e.is(i))return;s(i);let n=t.getCurrentFilter(),o=n&&n.localfilters;if(e.is(o)&&e.is(o.condition,"array")){let t=s(i),n=o.condition.length-1;for(;n>=0;n--){let i=o.condition[n];e.is(i)&&Object.keys(i)[0]!==t&&o.condition.splice(n,1)}}return o}(t,i)},ifDisplayViewMore:function(t,n,s,o){if(!e.is(t)||!e.is(n)||!e.is(s))return;let a=!1,r=-1===n.totalCount?n.getComputedResultCount():n.hits,l=8;if(e.is(o)&&"where"===o&&(l=4),-1!==["iphone","android"].indexOf(i.getDeviceCategory()))a="textual"===t||"largeTextual"===t||"thumbnail"===t?r>1:r>l;else if("textual"===t||"largeTextual"===t||"thumbnail"===t){let e=s.width;e<=620?a=r>1:e>=621&&e<=1145?"textual"===t||"largeTextual"===t?a=r>3:"thumbnail"===t&&(a=r>2):e>=1150&&e<=1450?a=r>3:e>=1455&&e<=1850?"textual"===t||"largeTextual"===t?a=r>3:"thumbnail"===t&&(a=r>4):"textual"===t||"largeTextual"===t?a=r>3:"thumbnail"===t&&(a=r>5)}else a=r>l;return a},compareObjects:function t(i,s,o){if(i===s)return n.info("compareObjects x === y:"+i===s),!0;if(!(i instanceof Object&&s instanceof Object))return n.info("compareObjects !(x instanceof Object) || !(y instanceof Object)"),!1;if(i.constructor!==s.constructor)return n.info("compareObjects x.constructor !== y.constructor"),!1;for(var a in i)if(i.hasOwnProperty(a)){if(!s.hasOwnProperty(a))return n.info("compareObjects !y.hasOwnProperty(p)"),!1;if(i[a]===s[a])continue;if("object"!=typeof i[a])return n.info("compareObjects typeof (x[p]) !== object"),!1;if(!t(i[a],s[a],o))return n.info("compareObjects !equals(x[p], y[p]) y[p]:"+JSON.stringify(s[a])),e.is(o,"array")&&o.push(s[a]),!1}for(a in s)if(s.hasOwnProperty(a)&&!i.hasOwnProperty(a))return n.info("compareObjects y.hasOwnProperty(p) && !x.hasOwnProperty(p):"+JSON.stringify(s)),e.is(o,"array")&&o.push(s),!1;return!0},IfLastRefineisInTheGoodW:function(t,i,n){if(!e.is(i)||!e.is(i))return!0;let o=!0,a=s(t),r=i.getCurrentFilter();if(e.is(r)){let t=r.localfilters;if(null!==n&&e.is(n)&&0!==n.condition.length){let i=[];this.compareObjects(n.condition,t.condition,i);if(e.is(i,"array")&&i.length>0){let t=i[i.length-1];if(e.is(t)){let e=Object.keys(t);e&&e.length&&e[0]!==a&&(o=!1)}}}else e.is(t)&&e.is(t.condition)&&t.condition.forEach(function(e){Object.keys(e)[0]!==a&&(o=!1)})}return o},IfMustAddRefineOnTitleClick:function(t,i){if(!e.is(t)||!e.is(i))return!0;let n=!0,s=!1,o=t.getCurrentFilter();if(e.is(o)){let a=o.localfilters;if(e.is(a)&&e.is(a.condition)){let o=a.condition;for(let t=o.length-1;t>=0;t--){let a=!0,r=o[t];if(e.is(r)){let l=Object.keys(r),c=l&&l.length;for(let t=0;t<c;t++){let o=r[l[t]];if(e.is(o)&&e.is(o.condition)){let t,r=o.condition,l=r.length;for(let s=0;s<l;s++){let o=r[s];if(e.is(o)){o.display===i&&(n=!1,t=s,s=l)}}l>1&&e.is(t)&&(r.splice(t,1),s=!0,a=!1)}}!0===a&&o.splice(t,1)}}!0===s&&t.setLocalFilter(a,!0)}}return n}}}),define("DS/SNResultUX/views/helpers/utils/SearchBackArrowView",["UWA/Core","UWA/Class/View","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/MessageBus/MessageBus"],function(e,t,i,n,s,o,a){"use strict";return t.extend(i,{uwaClassName:"SearchBackArrowView",name:"search_back_arrow",_centerdiv:null,_info:null,_skeleton:null,_resultMgt:null,_lastViewMode:null,domEvents:{"click .back-header-button":"_onClickBack","click .back-information .title":"_onClickBack","click .information-header-button":"_onClickInfo"},init:function(e){let t=this;return t._centerdiv=null,t._info=null,t._skeleton=null,t._resultMgt=null,t._lastViewMode=null,a.subscribe({channel:"3dSearch-back-arrow-view",topic:"update",callback:e=>{e.number&&t.updateCenterDivElementNumber(e.number)}}),this._parent(e)},destroy:function(){this._parent()},render:function(t){if(!e.is(t)||!e.is(t.parentContainer))return;let i=t.parentContainer;return this._resultMgt=t.resultMgt,this._skeleton=t.skeleton,this.container.setContent(this._createContent(t)),this.container.addClassName(this.uwaClassName),this.inject(i),this},_createContent:function(t){let i=this;i._skeleton;i._manageInfo();let n=e.createElement("div",{class:"fonticon fonticon-2x fonticon-left-open back-header-button"});if(i._centerdiv=e.createElement("div",{class:"search-back-center-wrapper"}),e.is(t)&&e.is(t.element)){let n=e.extendElement(e.clone(t.element));e.is(n)&&n.inject(i._centerdiv)}return[{class:"search-back-header-wrapper",html:[n,{class:"back-information",html:[{class:"title",html:o.SearchResultClassified_Back}]}]},i._centerdiv,i._info]},_onClickBack:function(t){let i=this,n=i._skeleton;if(e.is(n)&&i._resultMgt){n.switchOnView(i._lastViewMode),i._resultMgt.hideSearchBackView();let t=i._resultMgt.backToMultiView(i._lastViewMode);if(!e.is(t)){let t=i._resultMgt._taggerProxy,n=s.removeFilter(t,i._lastViewMode);e.is(n)&&t.setLocalFilter(n,!1)}}t.stopPropagation(),t.preventDefault()},_onClickInfo:function(e){this._skeleton;e.stopPropagation(),e.preventDefault()},switchOnView:function(t,i){let n=this;for(n._lastViewMode=t||"",n._manageInfo();n._centerdiv.firstChild;)n._centerdiv.removeChild(n._centerdiv.firstChild);if(e.is(i)&&e.is(i.domElement)){let t=e.extendElement(e.clone(i.domElement));e.is(t)&&t.inject(n._centerdiv),n._resultMgt.clickOnTitleMultiView(n._lastViewMode,i)}},_manageInfo:function(){let t=this;if(!e.is(t._skeleton)||!e.is(t._resultMgt))return;let i=t._skeleton;if("where"===i.getCurrentView().id){let s=i&&i.getPreference("informationPanelState");e.is(s,"boolean")&&!0===s&&(i.ActivateDeactivateInformationsPanel(),t._resultMgt.manageInformationPanel(!1)),-1!==["iphone","ipad","android"].indexOf(n.getDeviceCategory())&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions")&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions").setStyle("display","none")}else-1!==["iphone","ipad","android"].indexOf(n.getDeviceCategory())&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions")&&t._resultMgt._contentSetHeader.getElement(".search-content-set-actions.content-set-actions.set-actions.with-actions").setStyle("display","block")},updateCenterDivElementNumber:function(e){this._centerdiv&&this._centerdiv.firstChild&&this._centerdiv.firstChild.childNodes[3]&&(this._centerdiv.firstChild.childNodes[3].innerHTML=e)}})}),define("DS/SNResultUX/views/WebUX/Tree/TreeListView",["DS/Tree/TreeListView","DS/SNResultUX/views/WebUX/Tree/TreeNodeView"],function(e,t){"use strict";return e.extend({defaultOptions:{cellClass:t}})}),define("DS/SNResultUX/views/helpers/utils/TimeLines/TimeLinePresenter",["UWA/Core","DS/SNResultUX/views/helpers/utils/TimeLines/Abstract","DS/SNResultUX/views/helpers/utils/TimeLines/TimeLineDate","DS/SNInfraUX/SearchDebug","DS/Controls/Slider","DS/Controls/ProgressBar","DS/UIKIT/Popover","DS/Controls/Button","DS/MessageBus/MessageBus","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c){"use strict";return t.extend(n,{_timeLineDate:null,_aDates:null,_timeLinePresenterContainer:null,_timeLineDateContainer:null,init:function(e){return this.reset(),this._parent(e)},existAlready:function(){return null!==this.container.querySelector(".search-timeLine-content")},_getStatistic:function(e,t){let i=e.map(e=>e.count).reduce((e,t)=>e+t,0);return e.find(e=>e.label===t).count/i*100},_renderTimeLine:function(t,i){let n=this;null!==document.querySelector(".search-timeLine-content")&&document.querySelector(".search-timeLine-content").destroy();let s=e.createElement("div",{class:"search-timeLine-content"});if(e.is(i)){let t=e.createElement("div",{class:"search-timeline-content-header"});if(i.backArrow){e.createElement("span",{class:"fonticon fonticon-chevron-left"}).inject(t).addEventListener("click",e=>{n._backAction()})}i.title&&e.createElement("p",{class:"search-timeline-content-header-title",content:i.title}).inject(t),t.inject(s)}return t.forEach(i=>{let r=e.createElement("div",{class:"search-timeLine-content-index"}),l=e.createElement("p",{class:"search-timeLine-content-index-title",content:i.label}).inject(r),c=n._getStatistic(t,i.label);new a({target:r,trigger:"hover click",body:i.label+" "+c.toPrecision(2)+"%",position:"top right"}),l.addEventListener("click",e=>{let i=t.find(t=>t.label===e.currentTarget.innerText);n._clickOnTitle(i)}),new o({shape:"linear",value:c,gradientAnimationFlag:!1,displayStyle:"lite"}).inject(r).elements.container.classList.add(c),r.inject(s)}),s},_clickOnTitle:function(e){let t=this;null===this._timeLineDate?(this._timeLineDate=new i({data:this._aDates,dispayState:this._timelineDisplay,container:this._timeLineDateContainer,setLocalFilter:e=>{t.setLocalFilter(e)}}),this._timeLineDate.render()):this._timeLineDate.render(),this._timeLinePresenterContainer.style.display="none",this._timeLineDateContainer.style.display="",l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnTitle",persDim:{pd1:"Timeline",pd2:e.label}}})},_renderScroller:function(e){this.timeLineScroller=new s({minValue:0,maxValue:e.length-1,value:[0,e.length-1],displayStyle:"vertical"}),this.timeLineScroller.getTextFromValue=(()=>this._hoverSlider(e)),this.timeLineScroller.getContent().addEventListener("change",()=>{this._changeValueSlider()})},_hoverSlider:function(e){if(e[this.timeLineScroller.value[0]]&&e[this.timeLineScroller.value[1]])return e[this.timeLineScroller.value[0]].label+" ; "+e[this.timeLineScroller.value[1]].label},_changeValueSlider:function(){let e=this._getTimeLineTitle();if(this.fromDateInput&&this.toDateInput){let t=new Date(this.dateRange[this.timeLineScroller.value[0]]),i=new Date(this.dateRange[this.timeLineScroller.value[1]]);this.fromDateInput.setMinDate(t),this.toDateInput.setMinDate(t),this.fromDateInput.setDate(t),this.toDateInput.setDate(i),document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this._getDataForTimeLine(),e?{title:e}:void 0))}else document.querySelector(".search-timeLine-container-content").append(this._renderTimeLine(this.data.slice(this.timeLineScroller.value[0],this.timeLineScroller.value[1]+1),e?{title:e,backArrow:!0}:void 0));this.timeLineApplyIcon.disabled=!1},_getTimeLineTitle:function(){},_backAction:function(){},updateScrollerRange:function(e){0!==e.length&&(this.timeLineScroller.maxValue=e.length-1,this.timeLineScroller.value=[0,e.length-1],l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"refinementWithTimeLineScroller"}}))},setVisibility:function(e){const t=this.container.querySelector(".search-timeLine-container");e?t.classList.remove("hidden"):t.classList.add("hidden")},render:function(){if(this.data=this.getOption("data"),this.setLocalFilter=this.getOption("setLocalFilter"),this.rerenderMultiView=this.getOption("rerenderMultiView"),this._aDates=this.getOption("aDates"),this.existAlready())return;this._timeLinePresenterContainer=e.createElement("div",{class:"search-timeLinePresenter-content-object"}),this._timeLinePresenterContainer.inject(this.container),this._timeLineDateContainer=e.createElement("div",{class:"search-timeLinePresenter-timeLineDate-content-object"}),this._timeLineDateContainer.style.display="none",this._timeLineDateContainer.inject(this.container);let t=e.createElement("div",{class:"search-timeLinePresenter-content-object-list"}).inject(this._timeLinePresenterContainer);this._renderScroller(this.data),this.timeLineScroller.inject(t),this._renderTimeLine(this.data).inject(t),this.timeLineApplyIcon=new r({emphasize:"primary",label:c.get("APPLYButton"),disabled:!0}).inject(this._timeLinePresenterContainer),this.timeLineApplyIcon.getContent().addEventListener("buttonclick",()=>{l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"applyRange"}}),this._timeLinePresenterContainer.removeChild(this._timeLinePresenterContainer.querySelector(".search-timeLine-container")),this.rerenderMultiView(this.timeLineScroller.value)})},reset:function(){this.timeLineApplyIcon&&this.timeLineApplyIcon.destroy(),this.timeLineScroller&&this.timeLineScroller.destroy(),null!==this._timeLineDate&&this._timeLineDate.destroy(),this.container&&this.container.empty(!0)},destroy:function(){this.reset()&&this._parent()}})}),define("DS/SNResultUX/utils/SearchViewOptions",["UWA/Core","UWA/Class/Debug","UWA/Class","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ResultUX_customization","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchPreferences","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/utils/ResultsUtils"],function(e,t,i,n,s,o,a,r,l,c,d){"use strict";var u=null,h=null;return i.singleton(t,{tmp_idx:0,_viewData:null,_domAttachedEvent:[],init:function(){this._adminCusto=o.getAdminCustoDefinition(),this._domAttachedEvent=[],this.setDebugMode(s.options.search_settings.debug_mode),this.resetDefaultHeaders()},resetDefaultHeaders:function(){u=[{dataIndex:"ds6w:label",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:what/ds6w:label"),minWidth:40},{dataIndex:"ds6w:type",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:type"),minWidth:40},{dataIndex:"ds6w:description",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:what/ds6w:description"),minWidth:40},{dataIndex:"ds6w:identifier",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:what/ds6w:identifier"),minWidth:40},{dataIndex:"ds6w:modified",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:modified"),minWidth:40},{dataIndex:"ds6w:created",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:created"),minWidth:40}],o.isRoleAvailable(["CSV"],this._activeTenant,function(e){!0===e&&(u.push({dataIndex:"ds6wg:revision",isSortable:!0,text:r.getNLSValueForPredicate("ds6wg:revision"),minWidth:40}),u.push({dataIndex:"ds6w:status",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:status"),minWidth:40}))}),u.push({dataIndex:"ds6w:responsible",isSortable:!0,text:r.getNLSValueForPredicate("ds6w:responsible"),minWidth:40});let t=s.getOption("search_datagrid");if(null!==t)for(let i in u)e.is(u[i])&&e.is(u[i].dataIndex)&&(e.is(t.default_columns_size[u[i].dataIndex])?u[i].width=t.default_columns_size[u[i].dataIndex]:u[i].width=t.default_columns_size.default)},setContextOptions:function(t){h=e.clone(t)},getContextOptions:function(){return h},getItemViewOptions:function(e){return{mapping:this._getMapping(),resources:e}},getDataGridViewHeaders:function(t,i){if(this._specificLoadPredicateNLS(i),this.resetDefaultHeaders(),!(e.is(this._adminCusto)&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")&&this._adminCusto.SearchColumnCustoAdminDefinition.length>0)){let i=s.getOption("column_custo",{tenant:t});e.is(i)&&e.is(i.searchColumnCustoInputs,"object")&&(this._adminCusto=i.searchColumnCustoInputs)}var l=[],c=null,d=null,g=null,p=null,_=null;if(e.is(h)){if(d=h.columns,!e.is(d))return u;if(d.length<=0||1===d.length&&""===d[0])return u;for(g=0;g<d.length;g++)p=d[g],l.push({dataIndex:p,isSortable:!0,minWidth:40,text:r.getNLSValueForPredicate(p)})}else if(!a.getDataGridViewColumns()||e.is(this._adminCusto,"object")&&e.is(this._adminCusto.CustoAliasDefinitions,"array"))if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.CustoAliasDefinitions,"array")){d=[];var f=this._adminCusto.CustoAliasDefinitions;for(g=0;g<f.length;g++)if(e.is(f[g].aliasId,"string")&&"The_Default_Columns"===f[g].aliasId){d=f[g].viewDefinition;break}if(d.length>0){for(g=0;g<d.length;g++)p=d[g],_=r.getNLSValueForPredicate(p.uri),l.push({dataIndex:p.uri,isSortable:!0,minWidth:40,text:_,width:p.width});var m=[];if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.CustoAliasDefinitions,"array"))for(g=0;g<f.length;g++)if(e.is(f[g].aliasId,"string")){let t=f[g].viewDefinition;for(let i=0;i<t.length;i++)e.is(t[i].dataType)&&-1===m.indexOf(t[i].dataType)&&m.push(t[i].dataType)}m.length>0&&r._asyncCallToPredicatesWS(m).then(function(t){for(let i=0;i<d.length;i++){if(p=d[i],_=r.getNLSValueForPredicate(p.uri),e.is(p.dataType)&&(_.startsWith("ds6wg")||_.startsWith("ds6w"))&&e.is(t.classPredicates))for(let e=0;e<t.classPredicates.length;e++)for(let i=0;i<t.classPredicates[e].vocabularyPredicateInfo.length;i++)if(t.classPredicates[e].vocabularyPredicateInfo[i].uri===p.uri){_=t.classPredicates[e].vocabularyPredicateInfo[i].nlsName;break}l.push({dataIndex:p.uri,isSortable:!0,minWidth:40,text:_,width:p.width})}},function(){n.log("promisePredicate fail !")})}else c=u}else c=u;else for(d=a.getDataGridViewColumns(),g=0;g<d.length;g++)p=d[g],_=r.getNLSValueForPredicate(p),l.push({dataIndex:o.getURIToUse(p),isSortable:!0,minWidth:40,text:_});return e.is(c)||(c=s.getOption("enableDataGridView")?this.initColumnsDataGrid({columns:l},{}).columns:this.getCustoCellRequest(l),!e.is(c)&&c.length<1&&(c=u)),e.is(i,"function")&&i(c),c},getDataGridViewHeadersForInApps:function(t){this._specificLoadPredicateNLS(t);r.isLoaded("ds6w")||e.is(t,"function")&&r.loadVocabulary("ds6w",t);var i=[],n=null;if(e.is(h)){var s=h.columns;if(!e.is(s))return u;if(s.length<=0||1===s.length&&""===s[0])return u;for(var o=0;o<s.length;o++){var a=s[o];i.push({dataIndex:a,isSortable:!0,minWidth:40,text:r.getNLSValueForPredicate(a)})}}else n=null;return e.is(n)||(n=this.getCustoCellRequest(i)),e.is(t,"function")&&t(n),n},_specificLoadPredicateNLS:function(t){!r.isLoaded("ds6w")&&e.is(t,"function")&&r.loadVocabulary("ds6w",t)},getCustoCellRequest:function(t){if(s.getOption("enableDataGridView"))return t;if(!e.is(t,"array"))throw new Error("E_INVALIDARG: bad columns given to getCustoCellRequest method !");for(var i=-1,n=0;n<t.length&&-1===i;n++)"ds6w:label"===t[n].dataIndex&&(i=n);return-1!==i&&(t[i].onCellRequest=function(e){if(e.nodeModel instanceof Object){var t=void 0!==e.nodeModel.options.grid.type_icon_url?e.nodeModel.options.grid.type_icon_url:void 0!==e.nodeModel.options.grid.type_icon_url_value?e.nodeModel.options.grid.type_icon_url_value:null,i=void 0!==e.nodeModel.options.grid["ds6w:label"]?e.nodeModel.options.grid["ds6w:label"]:void 0!==e.nodeModel.options.grid["ds6w:label_value"]?e.nodeModel.options.grid["ds6w:label_value"]:void 0!==e.nodeModel.options.grid["ds6w:identifier"]?e.nodeModel.options.grid["ds6w:identifier"]:void 0!==e.nodeModel.options.grid["ds6w:identifier_value"]?e.nodeModel.options.grid["ds6w:identifier_value"]:null;e.cellView.getContent().innerHTML=(null!==t?'<img class="type-icon-datagrid" src="'+t+'" draggable="false"/>':"")+(null!==i?i:"...")}}),t},initColumnsTreeList:function(t,i){if(!e.is(t,"object"))throw new Error("E_INVALIDARG: bad gridOptions given to initColumnsTreeList method !");if(!e.is(t.columns,"array"))throw new Error("E_INVALIDARG: bad gridOptions.columns given to initColumnsTreeList method !");if(!e.is(i,"object"))throw new Error("E_INVALIDARG: bad options given to initColumnsTreeList method !");return t.columns.splice(0,0,{text:"",dataIndex:"tree",isHidden:!0}),o.isFUNActive("FUN075064")?t.columns.splice(0,0,{dataIndex:"selection_search",width:24,isResizable:!1,isSortable:!1,isHidden:"oneToOne"===i.selectionMode_techno,setValue:function(e){e.nodeModel.selectionChangeIsFromUI(),e.value?e.manager.getNodesXSO().add(e.nodeModel):e.manager.getNodesXSO().remove(e.nodeModel),e.manager.updateRowViewWithException(e.nodeModel,e.dataIndex)},getValue:function(e){return e.nodeModel.isSelected()},onCellChange:function(e){return e.event.target.dsModel.checkFlag},onCellRequest:function(e){var t=e.cellView.reuseCellContent("checkbox_search");e.isHeader?(t.currentNodeModel=null,t.ignoreUpdate=!0,t.visibleFlag=!1,t.visibleFlag=!0,t.mixedState=e.manager.getNodesXSO().get().length>0&&!e.manager.isEveryVisibleNodeSelected(),t.checkFlag=e.manager.isEveryVisibleNodeSelected()||e.manager.getNodesXSO().get().length>0&&!e.manager.isEveryVisibleNodeSelected(),t.ignoreUpdate=!1):(t.currentNodeModel=e.nodeModel,t.checkFlag=e.manager.getNodesXSO().isIn(e.nodeModel),t.mixedState=!1)}}):t.columns.splice(0,0,{text:"",dataIndex:"selection",type:"selection",width:24,isHidden:"oneToOne"===i.selectionMode_techno}),t.columns.splice(2,0,{dataIndex:"actions",isSortable:!1,isDraggable:!1,text:c.get("actions.title"),actions:!0,width:60}),t},initColumnsDataGrid:function(t,i){if(!e.is(t,"object"))throw new Error("E_INVALIDARG: bad gridOptions given to initColumnsDataGrid method !");if(!e.is(t.columns,"array"))throw new Error("E_INVALIDARG: bad gridOptions.columns given to initColumnsDataGrid method !");var n=l.getItem("DataGridColumnCusto"),a=null;l.getItem("listColumnsWidth")&&(a=JSON.parse(l.getItem("listColumnsWidth")));for(var r=0;r<t.columns.length;r++)if(null!==a&&e.is(a[t.columns[r].dataIndex])&&(t.columns[r].width=a[t.columns[r].dataIndex]),0!==r&&o.isODTMode()){let i=e.clone(t.columns[r].dataIndex);t.columns[r].onCellRequest=function(t){t.cellModel='<span odtmodereferer="datagrid" row-id='+t.rowID+" column-id="+t.columnID+' dataIndex="'+i+'">'+(e.is(t.cellModel)?t.cellModel:"")+"</span>",t.cellView.getContent().removeAttribute("no-tweaker"),!0!==s.getOption("detach_webUX")&&this._setTweakerForCell(t)}}if(0===t.length)return t;var c=this,u=t.columns[0];e.is(u.pinned,"string")||e.is(s.getOption("addinmode"),"string")||void 0!==n&&"The_Default_Columns"!==n.activeView?e.is(n,"array")&&(u.pinned="center"):u.pinned="left",u.canBeInvisible=!1;let h=e.clone(u.dataIndex);return u.onCellRequest=function(t){var n=t.nodeModel instanceof Object&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.icons)&&e.is(t.nodeModel._options.icons[0])?t.nodeModel._options.icons[0]:null,a=i.widgetId+"-"+i.tabId+"-3dsearch-datagrid-"+t.cellID;i.datagridID&&(a+="-dg-index-"+i.datagridID);var r=!0!==i.actionsMenuAccessRights.disableLocalActions&&!0!==i.actionsMenuAccessRights.addmenu?'<span style="font-size:18px;color:gray;cursor:pointer;" class="fonticon fonticon-2x fonticon-down-open" data-rec-id="'+a+'-dropdown-icon"></span>':"";let l=" search_item_hyperlink",u=this.collection._ctx_options,g=e.is(u),p=d.isAdvSearchRun(u);var _=this.collection._snSkeleton.getOption("addinMode"),f=e.is(_,"string")&&_.length>0;!g||p||f||(l=" search_item_in_apps"),t.cellModel=r+(t.nodeModel instanceof Object&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.icons)&&e.is(t.nodeModel._options.icons[0])?'<img class="type-icon-datagrid" src="'+n+'" draggable="false"/>':"")+"<span"+(o.isODTMode()?' odtmodereferer="datagrid" row-id='+t.rowID+" column-id="+t.columnID+' dataIndex="'+h+'"':"")+' data-rec-id="'+a+'-label"class ="'+l+'">'+t.cellModel+"</span>",!0!==s.getOption("detach_webUX")&&this._setTweakerForCell(t),void 0!==t.cellView.getContent().getChildren()[0]&&(t.cellView.getContent().getChildren()[0].removeEvent("click",i.onClickEvent,!1),t.cellView.getContent().getChildren()[0].addEvent("click",i.onClickEvent,!1),t.cellView.getContent().getChildren()[0].removeEvent("dblclick",i.onDblClickEvent,!1),t.cellView.getContent().getChildren()[0].addEvent("dblclick",i.onDblClickEvent,!1),t.cellView.getContent().getChildren()[0].setAttribute("data-rec-id",a+"-cell"),!0!==i.actionsMenuAccessRights.disableLocalActions&&!0!==i.actionsMenuAccessRights.addmenu&&(c._domAttachedEvent[a+"-dropdown-icon"]={target:t,callback:i.onContextualEvent,referer:i.referer,collection:i.collection}),c._domAttachedEvent[a+"-label"]={target:t,callback:i.onItemTitleClickCallback,referer:i.referer,collection:i.collection},c._domAttachedEvent[a+"-cell"]={target:t,callback:i.onItemTitleDblClickCallback,referer:i.referer,collection:i.collection}),t.cellView.getContent().removeAttribute("no-tweaker"),t.cellView._updateTooltip(i.tooltipCB.call(this,t,i.referer))},u.isCustom=!0,t},getTableViewHeaders:function(){return this.getDataGridViewHeaders()},getXMLViewOptions:function(){return{default_mapping:function(e){var t=e;return-1!==e.indexOf("/")&&(t=e.substring(e.lastIndexOf("/")+1)),t}}},_getMapping:function(){var t=this,i=a.getMapping();return i.title=function(){return(this.model||this).get("ds6w:label")},i.subtitle=function(){var i=this.model||this,n="",s=i.get("ds6w:who/ds6w:responsible");e.is(s,"string")&&s.length>0&&(n+=s);var o=i.get("ds6w:modified");e.is(o,"string")&&o.length>0&&(n.length>0&&(n+=" - "),n+=o);var a=t._retrieveSource(i);return e.is(a,"string")&&a.length>0&&(n.length>0&&(n+=" - "),n+=a),n},i.content=function(){var t=this.model||this,i="",n=t.get("ds6w:identifier"),s=t.get("ds6w:description");return e.is(n,"string")&&n.length>0&&(i+=n),e.is(s,"string")&&s.length>0&&(i.length>0&&(i+="<br/>"),i+=s),i},i.date=function(){return(this.model||this).get("ds6w:modified")},i.source=function(){var e=this.model||this;return t._retrieveSource(e)},i.ownerName=function(){return(this.model||this).get("owner")},i.icon_source=function(){var t=this.model||this,i=e.is(t)?t.get("source_icon_url"):"";return e.is(i,"string")||(i=""),i},i},_retrieveSource:function(t){if(!e.is(t,"object"))throw new Error("E_INVALIDARG: bad model given to _retrieveSource method !");var i=t.get("ds6w:where/ds6w:context/ds6w:project");return void 0!==i&&e.is(i,"string")&&0!==i.length||(i=t.get("ds6w:where/ds6w:context/ds6w:community"),e.is(i,"string")&&0!==i.length||(i="")),i},setViewData:function(e){this._viewData=e},getViewData:function(){return this._viewData},getNlsOfDataSources:function(t){if(!e.is(t))return null;var i=[];if(e.is(t.dataSourceLists,"array"))for(var n=t.dataSourceLists,s=0;s<n.length;s++)i.push(c.get("adv_search.source."+n[s]));return i},getAvailableViews:function(t){if(!e.is(t))return null;var i=[];if(!0===(e.is(t.simple_search_experience)?t.simple_search_experience:!!e.is(t.activeTenant)&&o.isInTheSimpleSearch({tenant:t.activeTenant}))){var n=s.getOption("search_compact_mode");e.is(n)||(n=!1),i=!1===n?[{id:"thumbnail",title:c.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title"},{id:"tilebig",title:c.get("view.Textual.title"),icon:"view-big-tile",nlsKeys:"view.Textual.title",default:!0},{id:"tile",title:c.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:c.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]:[{id:"thumbnail",nlsKeys:"view.thumbnail.title",icon:"view-small-thb",title:c.get("view.thumbnail.title")},{id:"tilebig",nlsKeys:"view.Textual.title",icon:"view-big-tile",title:c.get("view.Textual.title"),default:!0},{id:"tile",nlsKeys:"view.tile.title",icon:"view-small-tile",title:c.get("view.tile.title")}]}else i=!0!==s.getOption("enableNewSearchViews")?[{id:"thumbnail",title:c.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title",default:!0},{id:"tile",title:c.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:c.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}]:[{id:"thumbnail",title:c.get("view.thumbnail.title"),icon:"view-small-thb",nlsKeys:"view.thumbnail.title"},{id:"tilebig",title:c.get("view.Textual.title"),icon:"view-big-tile",nlsKeys:"view.Textual.title",default:!0},{id:"tile",title:c.get("view.tile.title"),icon:"view-small-tile",nlsKeys:"view.tile.title"},{id:"table",title:c.get("view.table.title"),icon:"view-list",nlsKeys:"view.table.title"}];return i}})}),define("DS/SNResultUX/views/helpers/Abstract",["UWA/Core","UWA/Class/Options","UWA/Class/Listener","UWA/Class/View","DS/MessageBus/MessageBus","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/views/utils/EmptyView","DS/SNResultUX/utils/SearchViewOptions","DS/WebappsUtils/Performance","DS/W3DXComponents/Views/Plugins/Multisel","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/views/helpers/utils/TimeLines/TimeLineDate"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m){"use strict";return n.extend(t,o,_,{_viewId:null,setViewId:function(e){this._viewId=e},getViewId:function(){return this._viewId},tagName:"div",className:"GridView",attributes:{styles:{width:"100%"},"data-rec-id":"GridView"},nestedView:null,_model:null,_viewRoot:null,_emptyView:null,_canMultiSelect:!0,_columnsMaxNumber:0,_rowMaxNumber:0,_checkingMoreDate:!1,_inAppsOptions:null,_lastselectedSearchId:null,_simpleSearch:!1,_timelineDisplay:!1,_bOnDragStartState:!1,_queueSkeletonMultiSel:null,_refreshMargins:null,_lastXscreen:0,margins:{left:0,right:0},extendDisplayMargin:function(e,t){return 251/780*e-3209/13-t},init:function(t){this.setDebugMode(l.getDebugMode());var i=this;this.nestedView=this,this._lastXscreen=0,this.collection=t.collection,this.initModel(),i._canMultiSelect="oneToOne"!==t.selectionMode_techno,i._neverAction=t.neverAction,this.margins={left:0,right:0},t.id&&this.setViewId(t.id);var n="";e.is(i.collection)&&e.is(i.collection.search_ressources)&&e.is(i.collection.search_ressources.getActiveTenant,"function")&&(n=i.collection.search_ressources.getActiveTenant()),!0===c.isInTheSimpleSearch({tenant:n})&&(i._simpleSearch=!0),this._parent(t),this._searchcom_socket=r.createSocket({socket_id:"search_grid_view_"+p.now(),widgetId:this.getOption("widgetId")}),this._searchcom_socket.addListener("toggleMultiSelMode",this.toggleMultiSelMode.bind(this)),this._queueSkeletonMultiSel=s.subscribe({channel:"Qchannel-searchgriview-"+this.className,topic:"Qtopic-searchgriview-disableMultiSelMode",callback:this._disableMultiSelMode.bind(this)}),this._refreshMargins=s.subscribe({channel:"Qchannel-searchgriview-all",topic:"Qtopic-searchgriview-refreshMargins",callback:()=>{i.setViewMargins(),i.updateView()}})},initModel:function(e){var t=this;if(this._model=e||this.collection.getTreeDocument(),this._lastXscreen=0,this.modelEventTokenForOnAdd=this._model.getXSO().onAdd(function(e){t.onItemSelected(e)}),this.modelEventTokenForOnRemove=this._model.getXSO().onRemove(function(e){t.onItemUnselected(e)}),this.view&&"GRIDENGINE"===this.view._name?this.view.loadGridViewModel&&this.view.loadGridViewModel(this._model):this.view&&(this.view.model=this._model),this.view&&this.view.getManager){if(this.view.getManager().loadDocument(this._model),0===this._model._numberOfNodesInDocument){var i={x:0,y:0};this.view.getManager().__cachedScrollPos=i,this.view.getManager().__cachedScrollDistance=0,this.view.getManager().setScrollerPosition(i),this.view.getManager().getScroller()&&(this.view.getManager().getScroller()._scrollPosition=i),this.view.getManager()._syncScrollPositionToHeaders()}c.isFUNActive("FUN075064")&&this.initMultiCheckbox()}this.view&&"DataGridView"===this.className&&(this.view.treeDocument=this._model),this.view&&this.view.getManager&&c.isFUNActive("FUN075064")&&this.initMultiCheckbox()},getSNResultMgt:function(){if(this.collection.getSNSkeleton())return this.collection.getSNSkeleton().getOption("observable")},setGlobeObject:function(e){this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().globeViewContainerContent=e},getGlobeObject:function(){return this.collection.getSNSkeleton().getOption("observable").getRefineHelpers().globeViewContainerContent},onSearch:function(){this._viewRoot=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0):{currentViewId:""}},onSwitch:function(){this.checkToLoadMoreData()},onItemDblClick:function(t,i){if(!e.is(t.rowID)||-1!==t.rowID){var n=t.nodeModel?t.nodeModel._options.id:t._options.id,s=this.collection.getSNSkeleton();e.is(s)&&s.onItemDblClick(n,t.nodeModel,i)}},onItemSelected:function(t){let i=this;i.onItemSelectedTracker(t);var n=t._options.id;if(e.is(this.collection.getSNSkeleton())&&(!0===this._simpleSearch&&e.is(this._lastselectedSearchId)&&this._lastselectedSearchId===t._options.id?this._searchcom_socket.dispatchEvent("onItemUnselected",n,this.collection.getSNSkeleton().getSocketID()):this._searchcom_socket.dispatchEvent("onItemSelected",n,this.collection.getSNSkeleton().getSocketID()),l.getOption("search_web_in_win"))){let e=i,n=parseInt(t._rowID,10);if(!isNaN(n)){let t=e.view._getViewAt(n);t&&(i.collection.getSNSkeleton()._selectedcellView=t)}}this._lastselectedSearchId=n},onItemSelectedTracker:function(e){c.trackerData.search.selectItem=!0,c.trackerData.search.indexItem=e._rowID+1,c.trackerData.search.scenario="Selection",s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:c.trackerData.search.scenario,persVal:{pv13:c.trackerData.search.indexItem}}}),c.trackerData.search.previewItem&&(c.trackerData.search.scenario="Preview",s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:c.trackerData.search.scenario,persVal:{pv13:c.trackerData.search.indexItem}}}))},onItemUnselected:function(t){var i=t._options.id;this._lastselectedSearchId=null,e.is(this.collection.getSNSkeleton())&&this._searchcom_socket.dispatchEvent("onItemUnselected",i,this.collection.getSNSkeleton().getSocketID())},onInfiniteScrollAsync:function(e,t){e.reachBottom&&this.collection.length<this.collection.totalCount?this.collection._snSkeleton.loadMoreData(t,t):t&&t()},onResizeOrFirstLoaded:function(e,t){e?(this._columnsMaxNumber=e.ColumnsMaxNumber,this._rowMaxNumber=e.RowMaxNumber,this.checkToLoadMoreData(t)):t&&t()},onItemTitleClick:function(t,i){let n=t.nodeModel?t.nodeModel:t,s=this.collection.getSNSkeleton();e.is(s)&&s.onItemTitleClick(n,{realTitleClick:!0},i)},_onPostCellRequest:function(t,i,n){e.is(t)&&e.is(i)&&e.is(n)},checkToLoadMoreData:function(t){e.is(this.collection)||t&&t();var i=this,n=this.getMinNumberModel(),s=this.collection.length,o=this.collection.state.pageSize,r=this.collection.state.totalRecords,l=null,c=null,d=null;if(this.isCurrentView()&&!0===this._checkingMoreDate&&(i._model&&e.is(i._model.getRoots())&&i._model.getRoots().length&&(s=i._model.getRoots().length),l=r-s,c=Math.min(l,n-s),d=Math.ceil(c/o),l>=1&&(this._checkingMoreDate=!1)),this.isCurrentView()&&!this._checkingMoreDate)if(l=r-s,c=Math.min(l,n-s),d=Math.ceil(c/o),l>=1){i._checkingMoreDate=!0;var u=function(){--d>=0&&!i.collection.interruptRequested()?setTimeout(function(){i.collection._snSkeleton.loadMoreData(u,()=>{a.warn("Failure load more Data!!")})},0):(i._checkingMoreDate=!1,t&&t())};u()}else t&&t();else t&&t()},setShadings:function(t){var i=this;this.collection&&this.collection.length&&this.view&&(this.collection.forEach(function(n,s){if(t){for(var o=0;o<t.length;o++)if(t[o].criteria(n)&&e.is(i._model.getNthRoot,"function")){var a=i._model.getNthRoot(s);e.is(a)&&(a.options.color=t[o].color)}}else i._model.getNthRoot(s).options.color=""}),i.updateView())},updateView:function(){this.view&&(this.view.updateView&&this.view.updateView(),this.view.invalidateLayout&&this.view.invalidateLayout({updateCellContent:!0}))},isCurrentView:function(){return this._viewRoot&&this._viewRoot.contentsViews?this._viewRoot.contentsViews[this._viewRoot.currentViewId]===this:(this._viewRoot=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0):{currentViewId:""},!0)},getCurrentViewId:function(){return this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0).currentViewId:null},isMultiSelMode:function(){if(void 0!==this.view._modeIsMultiSel){var t;return t=e.is(this.view._isInMultiSelection,"function")?this.view._isInMultiSelection():this.view.isInMultiSelection(),this.view.isInMultiSelection?t:this.view._interactiveCumulativeSelection}if(this.view.getManager)return this.view.getManager().isInMultiSelection()},toggleMultiSelMode:function(t){var i=null!=t?t:!this.isMultiSelMode();if(this._model.search_multiselMode=i,this.view&&void 0!==this.view._modeIsMultiSel&&(this.view.activateInteractiveCumulativeSelection?(i&&this.view.activateInteractiveCumulativeSelection(),!i&&this.view.deactivateInteractiveCumulativeSelection()):this.view._modeIsMultiSel=i),this.view&&this.view.getManager&&(this.view.getManager().forceMultiSelection(i),this.view.getManager()._multiSelModeHasBeenForced=!1),this.isCurrentView()){!i&&this._model.getXSO().empty();var n=this._model.getXSO().get();e.is(this.collection.getSNSkeleton())&&s.publish({channel:this.collection.getSNSkeleton().getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:n.length,isMultiSelMode:i}})}},unSelectAll:function(t){if(void 0===t||!0!==t.silent)if(e.is(this.collection._snSkeleton)){this.collection._snSkeleton._handleAction(0,void 0,[{id:"unselect_all",sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}])}else a.error("[unSelectAll] skeleton not found")},selectAll:function(){if(e.is(this.collection._snSkeleton)){this.collection._snSkeleton._handleAction(0,void 0,[{id:"select_all",sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}])}else a.error("[selectAll] skeleton not found")},getOptionCommon:function(){var t=this,i=this._canMultiSelect;return{model:this._model,pageScrollValueTriggeringInfiniteScroll:l.getOption("pageScrollValueTriggeringInfiniteScroll"),selection:{canMultiSelect:i,enableListSelection:i},enableActiveUI:!0,enableKeyboardNavigation:!0,infiniteScrolling:!0,useSwipableMenu:!1,onContextualEvent:{this:t,callback:function(i){let n=l.getOption("search_compact_mode");if(!(!0!==t.options.neverAction||i.fromPreview||e.is(n)&&!1===n))return;if(!0===t._simpleSearch&&e.is(n)&&!0===n){let t=!0;if(e.is(i)&&e.is(i.forcemenu)&&!0===i.forcemenu&&(t=!1),!0===t)return}let s=null;if(i&&(s=i.cellInfos||i.treeview),e.is(t._inAppsOptions)){if(t._inAppsOptions.UXOptions&&!t._inAppsOptions.UXOptions.localActions)return}if(i&&s&&s.cellView){t.collection._snSkeleton&&s.cellView&&(t.collection._snSkeleton._ctxMenuTarget=s.cellView.getContent());let n=[];if(t.collection._snSkeleton){var o=t.collection._snSkeleton.ctxMenu;o&&o.isVisible&&(c.isWebInWin()?t.collection._snSkeleton.ctxMenu.destroy():t.collection._snSkeleton.ctxMenu.hide(),t.collection._snSkeleton.ctxMenu=null)}let l={},d="event"in window?event:window.event;if(d)d.clientX?l.altPosition={x:d.clientX,y:d.clientY}:d.pageX&&d.pageY?l.altPosition={x:d.pageX,y:d.pageY}:d.target?l.target=d.target:i.data&&i.data.windowPosition&&i.data.windowPosition.x&&i.data.windowPosition.y?l.altPosition={x:i.data.windowPosition.x,y:i.data.windowPosition.y}:i.data&&i.data.target&&(l.target=i.data.target);else if(i&&i.data&&i.data.windowPosition&&i.data.windowPosition.x&&i.data.windowPosition.y){var r=i.data.windowPosition;l.altPosition={x:r.x,y:r.y}}else i&&i.data&&i.data.target?l.altPosition={x:d.pageX,y:d.pageY}:l.target=s.cellView.elements.container;l.events={onHide:function(){this.destroy()},onClickOutside:function(){this.destroy()}},e.is(i)&&e.is(i.fromPreview)&&!0===i.fromPreview&&(l.fromPreview=!0,e.is(l)&&e.is(l.altPosition)&&(l.altPosition.y=l.altPosition.y+20));let u=s.nodeModel||s.cellModel;if(c.isWebInWin()&&e.is(d)){let i=!0,n=0;e.is(d.screenX)&&(i=!1,t._lastXscreen!==d.screenX&&(i=!0,t._lastXscreen=d.screenX,n=150)),!0===i&&(a.log("************ getOptionCommon callback event_mouse X: ******* ",t._lastXscreen),t.launchContextMenu(u,l,n))}else t.launchContextMenu(u,l);return n}}},shouldAcceptDrag:function(){return(!l.getOption("targetLocation")||"popup"!==l.getOption("targetLocation"))&&(!e.is(t._inAppsOptions)||!(t._inAppsOptions.UXOptions&&!t._inAppsOptions.UXOptions.dnD))},onDragStartCell:function(i,n){if(!e.is(n)||!0===n.isHeader)return i.preventDefault(),void i.stopPropagation();if(e.is(t._inAppsOptions)&&(t._inAppsOptions.UXOptions&&!t._inAppsOptions.UXOptions.dnD))return i.preventDefault(),void i.stopPropagation();if(l.getOption("targetLocation")&&"popup"===l.getOption("targetLocation"))return i.preventDefault(),void i.stopPropagation();var s=[],o=t._model.getXSO().get();if(e.is(o,"array")&&o.forEach(function(e){if(t._model.getRoots().indexOf(e)>=0){let i=t.collection.get(e._options.id);i&&s.push(i)}}),0===s.length)if(e.is(n.cellModel)&&e.is(n.cellModel._options)&&e.is(n.cellModel._options.id)){let e=t.collection.get(n.cellModel._options.id);e&&s.push(e)}else if(e.is(n.nodeModel)&&e.is(n.nodeModel._options)&&e.is(n.nodeModel._options.id)){let e=t.collection.get(n.nodeModel._options.id);e&&s.push(e)}u.setDragData(i,{widgetId:t.getOption("widgetId"),draggedModels:s,securityContext:t.collection.getSNSkeleton().getSecurityContext()}),c.isWebInWin()||t._searchcom_socket.dispatchEvent("onDragStart")},onDragEndCellDefault:function(){c.isWebInWin()||t._searchcom_socket.dispatchEvent("onReshow")},onDragEndCell:function(){c.isWebInWin()||t._searchcom_socket.dispatchEvent("onReshow")},clickCB:function(i){l.getOption("debug")&&a.log("[DEVONLY - clickCB]",i);let n=l.getOption("search_compact_mode");if(e.is(n)&&!0===n&&e.is(i)&&e.is(t.collection)&&e.is(t.collection.getSNSkeleton,"function")){let n=i.nodeModel?i.nodeModel:i,s=t.collection.getSNSkeleton();e.is(s)&&e.is(s.onItemTitleClick,"function")&&s.onItemTitleClick(n,null,t.collection)}},height:"auto",allowUnsafeHTMLContent:!0}},checkToDisplayEmptyView:function(){var t=!1;if(this.collection&&this.collection._ctx_options&&this.collection._ctx_options.advanced_search&&this.collection._ctx_options.advanced_search.searchOnInit&&(t=!0),!t&&this.collection&&this.collection.service_parameters&&this.collection.service_parameters.adv_search&&!this.collection.service_parameters.advanced_criteria)this.showEmptyView();else{var i=this.collection.totalCount;i<=0&&e.is(this.collection)&&(i=this.collection.length),i<=0?this.showEmptyView():e.is(this._emptyView)&&this.hideEmptyView()}},hideEmptyView:function(){this._emptyView&&this._emptyView.hide();var t=null;e.is(this.collection)&&e.is(this.collection._snSkeleton)&&(e.is(this.collection._snSkeleton.options)&&e.is(this.collection._snSkeleton.options.observable)&&e.is(this.collection._snSkeleton.options.observable.getSearchContentSetHeader,"function")&&(t=this.collection._snSkeleton.options.observable.getSearchContentSetHeader()),!e.is(t)&&e.is(this.collection._snSkeleton._skeleton)&&e.is(this.collection._snSkeleton._skeleton.container)&&e.is(this.collection._snSkeleton._skeleton.container.getElement,"function")&&(t=this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")))},showEmptyView:function(){if(!e.is(this._emptyView)){var t=this.getOption("itemViewOptions");this._emptyView=new h(t)}var i=this.container,n=this._emptyView.render();if(e.is(n)&&e.is(i)&&(n.inject(i),this._emptyView.show(),e.is(n.container)&&e.is(n.container.getText,"function"))){var s=n.container.getText();if(e.is(s)&&0===s.indexOf(c.constructEmptyViewMsg(f.get("no_result")))){e.is(this.collection)&&e.is(this.collection._snSkeleton)&&e.is(this.collection._snSkeleton._skeleton)&&e.is(this.collection._snSkeleton._skeleton.container)&&e.is(this.collection._snSkeleton._skeleton.container.getElement,"function")&&this.collection._snSkeleton._skeleton.container.getElement(".search-content-set-header")}}},_forcetoDisplayPreview:function(){e.is(this.collection._snSkeleton)&&e.is(this.collection._snSkeleton.getPreviewStatus())&&e.is(this.collection._snSkeleton.getPreviewPanel())&&!1===this.collection._snSkeleton.getPreviewPanel().getVisibleFlag()&&!0===this.collection._snSkeleton.getPreviewStatus()&&(e.is(this.collection._snSkeleton.getPreviewPanel().activate_deactivateNoPreview,"function")&&this.collection._snSkeleton.getPreviewPanel().activate_deactivateNoPreview(!0),this.collection._snSkeleton.getPreviewPanel().switchVisibleFlag())},launchContextMenu:function(t,i,n){var s=this,o=null,r=null,d=s._model.getXSO().get();if(c.isWebInWin()){var u={};let i=t.getTreeDocument();if(!e.is(i))return;d=i.getXSO().get();let l=s.collection;if(e.is(s.collections)){let t=s.collections.length;for(let i=0;i<t;i++){let n=s.collections[i];for(o=0;o<d.length;o++){let s=n.get(d[o]._options.id);e.is(s)&&(l=n,i=t)}}}if(-1===d.indexOf(t))if(s.log('there might be an existing selection, but the "context" object is not there in it, clear the selection and use only the "context" object'),s.collection._snSkeleton.resetMultisel(),e.is(t)&&e.is(t._options)&&e.is(t._options.id)){var h=t._options.id;u.objets_name=[{id:h,session_object:l&&l.get(h).hasOwnProperty("session_object")}],i.getRoots()[t._localID]&&s._model.getRoots()[t._localID].select()}else u.objets_name=[{id:"V_LocationWithoutSelectedObject",session_object:!1}];else{s.log('there is a selection, and "context" object is one of them, use all the selected objects'),l.custoAction&&l.custoAction.popover&&l.custoAction.popover.hide();var g=[];for(o=0;o<d.length;o++)r=d[o]._options.id,g.push({id:r,session_object:l&&l.get(r).hasOwnProperty("session_object")});u.objets_name=g}setTimeout(function(){let t=s.collection.getSNSkeleton();e.is(t)&&(a.log("************ launchContextMenu on: ",u),u.tabID=t.getOption("observable").getTabID(),t.onDispatchToWin(u,"onActionClickDotted"))},e.is(n)?n:0)}else{if(-1===d.indexOf(t)){for(o=0;o<d.length;o++){var p=s._model.getRoots().indexOf(d[o]);s._model.getNthRoot(p).unselect()}-1!==(r=s._model.getRoots().indexOf(t))&&s._model.getRoots()[r].select()}if(l.getOption("actionsProtocol_FUN065512")){d=s._model.getXSO().get();var _=[];for(o=0;o<d.length;o++)_.push(s.collection.get(d[o]._options.id));var f=s.collection.getSNSkeleton();e.is(f)&&e.is(_,"array")&&_.length>=0&&f.computeCtxActions2(_,i)}}},_disableMultiSelMode:function(){e.is(this.view)&&e.is(this.view.deactivateInteractiveCumulativeSelection,"function")&&this.view.deactivateInteractiveCumulativeSelection()},setup:function(){var t=this;this.listenTo(this.collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){t.checkToDisplayEmptyView(),t.toggleMultiSelMode(!1)},onSync:function(){t.checkToDisplayEmptyView(),t._viewRoot=t.collection._snSkeleton&&t.collection.getSNSkeleton()._skeleton.getViewAt(0)?t.collection.getSNSkeleton()._skeleton.getViewAt(0):{currentViewId:""},t.checkToLoadMoreData()},onInitTreeDocument:function(i,n){!0===n&&e.is(t.view)&&e.is(t.view.options)&&e.is(t.view.options.TreedocModel)&&(t.view.options.TreedocModel=null),t.initModel(i)},onInitTreeDocument_SelectFirstElt:function(){e.is(t.view)&&e.is(t.view.model)&&(e.is(t.view.getManager)||"DataGridView"===t.className||t.view.model.length>0&&(t.view.lastSelectedNode=t.view.model[0]))},onError:function(){a.log("onError event received"),t.checkToDisplayEmptyView()}}),t.checkToDisplayEmptyView()},render:function(){return this._viewRoot=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)||{currentViewId:""},this.collection&&this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._modeIsMultiSel&&this.toggleMultiSelMode(!0),this},_getMenuAndLocalActionsStatus:function(){var t=!1,i=!1,n=!1,s=l.getOption("search_compact_mode");return!0===this._simpleSearch&&(n=!1,e.is(s)&&!0===s&&(n=!0)),this._inAppsOptions=this.collection.getSNSkeleton()&&this.collection.getSNSkeleton().getOption("in_apps_search"),e.is(this._inAppsOptions)&&(i=this._inAppsOptions.UXOptions&&!this._inAppsOptions.UXOptions.dnD,t=this._inAppsOptions.UXOptions&&!this._inAppsOptions.UXOptions.localActions),{addmenu:n,disableDnD:i,disableLocalActions:t}},_afterRender:function(){var t=this,i=this._getMenuAndLocalActionsStatus();if(this.view.onPostCellRequest&&this.view.onPostCellRequest(this._onPostCellRequest.bind(this)),this.view.onPostCellRequest&&this.view.onPostCellRequest(function(n){var s=null;!0!==i.disableLocalActions&&!0!==i.addmenu||(s=n.cellView.elements.container.querySelector(".wux-controls-responsivethumbnailview-menu"),e.is(s)||(s=n.cellView.elements.container.querySelector(".wux-controls-responsivetileview-menu")),e.is(s)||(s=n.cellView.elements.container.querySelector(".wux-controls-responsivetextualtileview-menu")),e.is(s)||(s=n.cellView.elements.container.querySelector(".wux-ui-3ds-open-down"))&&(s.style.display="none",s=void 0),e.is(s)&&s.setAttribute("has-menu","false")),t._onPostCellRequest(n),i.disableDnD&&n.cellView.elements.container.setAttribute("draggable","false")}),!0===i.disableLocalActions){var n=this.view.displayedOptionalCellProperties;if(e.is(n,"array")){var s=n.indexOf("contextualMenu");-1<s&&n.splice(s,1),0===n.length&&n.push("None")}this.view.displayedOptionalCellProperties=n,this.view.getManager&&(this.view.options.columns[2].isHidden=!0)}var o=this.collection.getSNSkeleton();o&&o.refreshUIAfterRender(),this.checkToDisplayEmptyView()},getMinNumberModel:function(){return 0},setLocalFilter:function(e,t){void 0===t&&(t="when");let i=this.collection.getTaggerProxy();i.clearLocalFilter(!1),this._setLocalFilter(i,e,t)},_setLocalFilter:function(e,t,i){let n,s=[{display:t.dispText,object:t.identifier,type:t.type,predicates:t.object.predicates,value:t.object.value,operator:"OR"}],o={};"what"===i||"who"===i?n="ds6w:"+i+"/":"when"===i?n="sixw:ds6w:when/ds6w:modified":"where"===i&&(n="ds6w:where/ds6w:location/"),"what"===i||"who"===i||"where"===i?o[n]={condition:s,isComplex:!0,operator:"OR"}:"when"===i&&(o[n]=[{displayValue:t.dispText,object:t.object,isSimplifiedCriteria:!0,type:t.type}]);let a={condition:[o],operator:"AND",isSimplified:{version:2}};e.setLocalFilter(a,!0)},_retrieveAllDatesFromCollection:function(){if(!this.collection.parsed_response)return[];let e=[],t=[];return this.collection&&this.collection.parsed_response&&this.collection.parsed_response.summaryData&&(t=(t=this.collection.parsed_response.summaryData.filter(e=>{if(e.sixw.contains("ds6w:when/ds6w:modified"))return e})).map(e=>e.object)).forEach(t=>{t.contains("/")&&e.push(new Date(t))}),e.sort((e,t)=>t-e),e.reverse(),e},destroy:function(){this.stopListening(this.collection),e.is(this.modelEventTokenForOnAdd)&&e.is(this._model)&&e.is(this._model.getXSO,"function")&&e.is(this._model.getXSO())&&e.is(this._model.getXSO().unsubscribe,"function")&&(this._model.getXSO().unsubscribe(this.modelEventTokenForOnAdd),delete this.modelEventTokenForOnAdd),e.is(this.modelEventTokenForOnRemove)&&e.is(this._model)&&e.is(this._model.getXSO,"function")&&e.is(this._model.getXSO())&&e.is(this._model.getXSO().unsubscribe,"function")&&(this._model.getXSO().unsubscribe(this.modelEventTokenForOnRemove),delete this.modelEventTokenForOnRemove),this._model=null,this._searchcom_socket.removeListener("toggleMultiSelMode"),this._searchcom_socket.disconnect(),r.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null,this.collection=null,this._viewRoot=null,this._emptyView&&(this._emptyView.destroy(),this._emptyView=null),s.unsubscribe(this._queueSkeletonMultiSel),s.unsubscribe(this._refreshMargins),this._parent()},mask:function(){let t=this.collection.getSNSkeleton();e.is(t)&&t.maskContainer()},unmask:function(){let t=this.collection.getSNSkeleton();e.is(t)&&t.unmaskContainer()},setViewMargins:function(){if(!e.is(this.view))return;let t=!1;e.is(this.collection._snSkeleton)&&(t=this.collection._snSkeleton.options.observable.getOption("pinToDashboard"));let i=10,n=10,s="BETA-FUN109031-resizefullmode-"+this.getOption("widgetId")+"-"+(this.collection&&this.collection.getSNSkeleton()?this.collection.getSNSkeleton().getOption("observable").getTabID():null),o=!(!this.collection||!this.collection.getSNSkeleton())&&(this.collection&&e.is(this.collection.getSNSkeleton().getPreference("informationPanelState"),"boolean")&&this.collection.getSNSkeleton().getPreference("informationPanelState"));if(c.isFUN109031Active()&&this.getSNResultMgt()&&!this.getSNResultMgt()._isInAppsSearch()&&!1!==t&&(void 0===d.getItem(s)||!1===d.getItem(s))&&!1===o){let t=this.container.offsetWidth;l.getOption("debug")&&a.log("[DEVONLY - 6w margin vp]",t);let s=localStorage.getItem("3dSearch-sidePanelPositionBack");(l.options.search_settings.taggerClosed&&(!e.is(s)||"maximized"===s)||l.options.search_settings.taggerClosed&&e.is(s)&&"fitted"===s||l.options.search_settings.taggerClosed&&e.is(s)&&"normal"===s)&&(t>=800&&t<=1139&&(i=10,n=14),t>1140&&(i=this.extendDisplayMargin(t,90),n=this.extendDisplayMargin(t,50)))}this.margins.left!==i&&this.margins.right!==n&&(this.view.layout.layoutMargins={marginTop:0,marginBottom:0,marginLeft:i,marginRight:n},this.margins={left:i,right:n},l.getOption("debug")&&a.log("[DEVONLY - 6w margin left/right]",i,n))},_callBackActionMenu:function(t){t&&(t.cancelBubble=!0),t&&t.stopPropagation&&t.stopPropagation(),t&&t.preventDefault&&t.preventDefault();var i=t.target;if(e.is(i.attributes.class)&&"highlightedSearchCriteria"===i.attributes.class.value&&(i=i.getParent()),e.is(i.attributes["data-rec-id"])&&e.is(i.attributes["data-rec-id"].nodeValue)&&e.is(g._domAttachedEvent[i.attributes["data-rec-id"].nodeValue])){var n=i.attributes["data-rec-id"].nodeValue;a.log(n);var s=g._domAttachedEvent[n];n.endsWith("-label")?s.collection?s.callback.call(s.referer,s.target,s.collection):s.callback.call(s.referer,s.target):n.endsWith("-dropdown-icon")&&s.callback.call(s.target.cellView.collectionView.onContextualEvent,{treeview:s.target,data:{target:i}})}},_callBackDblClickActionMenu:function(t){if(t&&(t.cancelBubble=!0),t&&t.stopPropagation&&t.stopPropagation(),t&&t.preventDefault&&t.preventDefault(),e.is(t.target.attributes["data-rec-id"])&&e.is(t.target.attributes["data-rec-id"].nodeValue)&&e.is(g._domAttachedEvent[t.target.attributes["data-rec-id"].nodeValue])){var i=t.target.attributes["data-rec-id"].nodeValue;a.log(i);var n=g._domAttachedEvent[i];i.endsWith("-cell")&&(n.collection?n.callback.call(n.referer,n.target,n.collection):n.callback.call(n.referer,n.target))}},_tooltipCB:function(t,i){return{getAllInformationCB:function(){var n="";if(t.isHeader&&e.is(t.manager.options.columns[t.virtualColumnID]))n=t.manager.options.columns[t.virtualColumnID].text;else if(!0===l.getOption("webUXTooltip")){if(e.is(t.nodeModel)&&e.is(t.nodeModel._options)&&e.is(t.nodeModel._options.customTooltip))return t.nodeModel._options.customTooltip}else e.is(t.cellModel)&&(n=t.cellModel),e.is(i.view)&&e.is(t.nodeModel)&&i.view.getColumns()[t.columnID]&&(n=t.nodeModel._options._attributes[i.view.getColumns()[t.columnID].dataIndex]);return{model:{shortHelp:c.htmlDecode(n)},updateModel:!1}}}}})}),define("DS/SNResultUX/utils/ContentLocationServices",["UWA/Core","UWA/Class","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNResultUX/utils/ResultsUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l){"use strict";var c,d={R2019x:"BETA3"},u="ds6w:where/ds6w:source/ds6w:dataSource",h=[],g=[];return t.singleton({init:function(){a.log("Initilization Content Location Services"),c=this.getInternalSourceToPredicateMapping()},transformToDataSourceFacets:function(t,i){var n=t[i];if(t.length>i){var s,o=n.object;n.sixw===u&&(n.dispValue=[],e.is(o,"array")?n.object=o:n.object=[o]),c.forEach(function(e){e.uri===n.sixw&&(s=e)}),e.is(s)&&((e.is(n.object,"array"),n.object.indexOf("_drv"))>0?t.splice(i,1):(n.object=[s.service,n.object],n.sixw=u,n.dispValue=[]))}},transformTagsValuesToDataSourceFacets:function(t,i,n,s){var o=t[i[n]][s];if(t[i[n]].length>s){var a,r=o.object;o.sixw===u&&"GoogleDrive"!==r&&"DropBox"!==r&&(o.dispValue=[]),c.forEach(function(e){e.uri===o.sixw&&(a=e)}),e.is(a)&&((e.is(o.object,"array"),o.object.indexOf("_drv"))>0?t[i[n]].splice(s,1):(o.object=[a.service,o.object],o.sixw=u,o.dispValue=[]))}},transformAddSubjectsToDataSourceFacets:function(t){for(var i in t)for(var n=t[i].length,s=0;s<n;s++){var o=t[i][s];if(n>s){var a=o.object;o.sixw===u&&"GoogleDrive"!==a&&"DropBox"!==a&&(o.dispValue=[]);var r={},l=!1;c.forEach(function(e){e.uri===o.sixw&&(r=e,l=!0)}),l&&((e.is(o.object,"array"),o.object.indexOf("_drv"))>0?t[i].splice(s,1):(o.object=[r.service,o.object],o.sixw=u,o.dispValue=[]))}}},transformFilterSourceToProject:function(t){if(!0===t.allfilters.hasOwnProperty(u)){var i=0,n="";if(e.is(t.allfilters[u],"array")&&t.allfilters[u].length>0){for(var s=0,o=0,a=t.allfilters[u].length,r=0;r<a;r++){var l;if(e.is(t.allfilters[u][r].object,"array")?(n=[t.allfilters[u][r].object[0]],o=t.allfilters[u][r].object.length):(n=[t.allfilters[u][r].object],o=1),2===o)n=[t.allfilters[u][r].object[0]],c.forEach(function(e){e.service===n[0]&&(l=e)}),e.is(l)&&!1===t.allfilters.hasOwnProperty(l.uri)&&(t.allfilters[l.uri]=[]),"3DSpace"===n[0]&&(t.allfilters[l.uri].push(t.allfilters[u][r]),s=t.allfilters[l.uri][i].object.length,t.allfilters[l.uri][i].object=t.allfilters[l.uri][i].object[s-1],i+=1,t.localfilters[u].splice(r,1),t.allfilters[u].splice(r,1),a-=1,r-=1)}!0===t.allfilters.hasOwnProperty(u)&&0===t.allfilters[u].length&&(delete t.localfilters[u],delete t.allfilters[u])}return!0}return!1},updateFilter:function(){},caseInsensitiveMatch:function(t){var i;if("3DDrive"===t.toString())return t=["drive"];for(var n=new RegExp(t,"gi"),s=0;s<h.length;s++){if(i=g[s].match(n),e.is(i))return i=h[s];if(i=h[s].match(n),e.is(i))return i=h[s]}return""},getAvblSource:function(t){var i=o.getAvailableSources(t);e.is(i)&&i.forEach(function(t){e.is(t.name)&&e.is(t.service)&&(h.push(t.name),g.push(t.service))})},getInternalSourceToPredicateMapping:function(){return[{source:"3dspace",predicate:"ds6w:project",uri:"ds6w:where/ds6w:context/ds6w:project",position:"I",service:"3DSpace"}]},getListOfExternalDataSources:function(){},isContentLocationActive:function(){return!!(s.isInTheSimpleSearch()&&i.getOption("contentsLocation_FUN072059")&&n.isActiveWithCurrentVersion(d))},addSourceSpecificParameterToFilterDataCreationUri:function(t){var i=Object.keys(t.refine.allfilters);e.is(t.source)||(t.source=[]);let n=!1;return i.forEach(function(i){var o;if(c.forEach(function(e){e.uri===i&&(o=e)}),e.is(o)){n=!0;var a={};a["sixw:"+i]=t.refine.allfilters[i];var l=r.from_filters_to_uql(a,{usePreciseQueryTerms:!0});s.addSourceSpecificParameter(t,{sourceIds:[o.source],param:{id:"additional_query",value:"AND  ("+l+")"}}),t.source.push(o.source),delete t.refine.allfilters[i]}}),n},addSourceSpecificParameterToFilterDataDriverForDataSrcUri:function(t){var i="",n=[],s=!1,o=0;if(!0===t.refine.allfilters.hasOwnProperty(u)){if(e.is(t.source)||(t.source=[]),1===t.refine.allfilters[u].length)i=t.refine.allfilters[u][0].object;else for(o=0;o<t.refine.allfilters[u].length;o++)n.push(t.refine.allfilters[u][o].object);if(e.is(n,"array")&&t.refine.allfilters[u].length>1){for(o=0;o<n.length;o++){var a=this.caseInsensitiveMatch(n[o]).toString();n[o]=a}s=!0}else i=this.caseInsensitiveMatch(i).toString(),s=!1;!0===s?n.forEach(function(e){e.length>0&&t.source.push(e)}):t.source.length>0?i.length>0&&t.source.push(i):0===i.length?t.source=[]:t.source=[i],t.source.filter(function(e,t,i){return t===i.indexOf(e)}),t.source.length>0&&t.source.indexOf("3dspace")>-1&&(delete t.refine.allfilters[u],delete t.refine.localfilters[u])}},addSourceSpecificParameterToFilterData:function(t){let i=!1;return e.is(t.refine)&&e.is(t.refine.allfilters)&&(i=this.addSourceSpecificParameterToFilterDataCreationUri(t),this.addSourceSpecificParameterToFilterDataDriverForDataSrcUri(t)),i},displaySourceInSearchView:function(t,i){var n="",s=u.split("/"),a=0;for(a=0;a<s.length&&"ds6w:dataSource"!==s[a];a++);if(e.is(i.grid)&&e.is(i.grid.sourceid_value)){if(i.grid.sourceid_value.indexOf(":")>0)n=i.grid.sourceid_value.split(":")[0];else e.is(i.collection)&&e.is(i.collection.search_ressources)&&"OnPremise"===i.collection.search_ressources.active_tenant&&(n=i.grid.sourceid_value);var r=o.getServiceFromSource(n),c="";!e.is(this.NLSNAMEDETAILS)||!0!==this.NLSNAMEDETAILS.hasOwnProperty(s[a])||"3dspace"!==n&&"swym"!==n?(e.is(i.grid[s[a]])||(i.grid[s[a]]=l.get(n+".displayName")),e.is(i.withoutHtmlTag[s[a]])||(i.withoutHtmlTag[s[a]]=l.get(n+".displayName")),e.is(i.grid[s[a]+"_value"])||(i.grid[s[a]+"_value"]=r),e.is(i.withoutHtmlTag[s[a]+"_value"])||(i.withoutHtmlTag[s[a]+"_value"]=r)):(c=this.NLSNAMEDETAILS[s[a]][r],e.is(i.grid[s[a]])||(i.grid[s[a]]=c),e.is(i.withoutHtmlTag[s[a]])||(i.withoutHtmlTag[s[a]]=c),e.is(i.grid[s[a]+"_value"])||(i.grid[s[a]+"_value"]=c),e.is(i.withoutHtmlTag[s[a]+"_value"])||(i.withoutHtmlTag[s[a]+"_value"]=c))}},setNlsNameDetails:function(e){this.NLSNAMEDETAILS=e},addSource:function(e,t){var i=o.getAvailableSources(t),n=u.split("/"),s=0;for(s=0;s<n.length&&"ds6w:dataSource"!==n[s];s++);if(!0===e.hasOwnProperty(n[s]))for(var a=e[n[s]].length,r=0;r<i.length;r++)!0===i[r].status&&e[n[s]].indexOf(i[r].service)<0&&(e[n[s]][a]={value:i[r].service,source:[i[r].service]},a+=1)}})}),define("DS/SNResultUX/utils/SearchCustoServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferences","DS/SNResultUX/utils/datagridPreferences/SearchDataGridPreferencesEndUser","DS/FedDictionaryAccess/FedDictionaryAccessAPI","text!DS/SNInfraUX/assets/SearchColumnCustoDS.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S){"use strict";var w=function(e,t){var i=0;return e.label>t.label?i=1:e.label<t.label&&(i=-1),i};return t.singleton(n,i,{name:"DS_SNResultUX_utils_SearchCustoServices",_adminCusto:null,_dsCusto:null,_displayNameCusto:null,_displayNameCustoObject:null,fixColumnUnsortable:["ds6wg:_displayName_"],fixColumnSortableFor1000:["ds6w:modified","ds6w:label","ds6w:created","ds6w:responsible"],DEFAULT_FIELDS:{"ds6w:modified":"num","ds6w:label":"alpha","ds6w:created":"num","ds6w:responsible":"alpha","ds6w:type":"group"},SORT_ACTIVATED_CSS:"sortActived",PINNED_ACTIVATED_CSS:"sortActived",colCustoPanel:null,colCustoPanelEndUser:null,init:function(){this._dictionnary=[],this.colCustoPanel=null,this.colCustoPanelEndUser=null,this.f=null,this.setDebugMode(o.getDebugMode());try{this._dsCusto=JSON.parse(v),this._addMissingPredicates(this._dsCusto),s.log("DS custo:",this._dsCusto),this._adminCusto=r.getAdminCustoDefinition(),this._addMissingPredicates(this._adminCusto)}catch(e){s.error("Error parsing SearchColumnCustoAdmin.json:",e)}},_addMissingPredicates:function(t){if(e.is(t.SearchColumnCustoDSDefinition,"array"))for(var i=0;i<t.SearchColumnCustoDSDefinition.length;i++){var n=t.SearchColumnCustoDSDefinition[i].viewDefinition;this.addMandatoryPredicates(n)}},addMandatoryPredicates:function(t){if(e.is(t,"array")&&!(0>=t.length)){var i,n=["ds6w:identifier","ds6w:type"];for(i=n.length-1;i>=0;i--)for(var s=0,o=t.length;s<o;s++)if(t[s].uri.endsWith(n[i])){n.splice(i,1);break}for(i=n.length-1;i>=0;i--)t.push({uri:n[i],width:"auto"})}},getAvailableColumnCustomization:function(t,i){if(!e.is(t,"object")||!e.is(t.isPQ))throw new Error("E_INVALIDARG: bad iContext given to getAvailableColumnCustomization method !");var n=[],s=a.getItem("DataGridColumnCusto"),r=0,l=0,d=null,u=0,h=0,g=null,_=[];if(e.is(s,"object")&&e.is(s.views,"array")){var f=s.views;for(r=0,l=f.length;r<l;r++){if(d={label:f[r].viewId,value:f[r].viewId},0===f[r].viewId.indexOf("###")){var m;if(g=f[r].viewId.substring(3,f[r].viewId.length),e.is(g,"string")&&g.length>0){m=g;var v=c.getPQObjFromPQPrefix(g),b=c.getPQNLS();e.is(b,"object")&&e.is(v,"object")&&e.is(v.pqid,"string")&&v.pqid.length>0&&e.is(b[v.pqid+".Title"],"string")&&b[v.pqid+".Title"].length>0&&(m=b[v.pqid+".Title"])}d.label=S.replace(S.get("custo_PQ"),{PQ:m})}n.push(d)}n.sort(w)}var C=[];if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){if(this._adminCusto.SearchColumnCustoAdminDefinition.length>0)_=this._adminCusto.SearchColumnCustoAdminDefinition;else{let t=o.getOption("column_custo",{tenant:i});e.is(t)&&e.is(t.searchColumnCustoInputs,"object")&&e.is(t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,"array")&&t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition.length>0&&(_=t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,this._adminCusto=t.searchColumnCustoInputs),e.is(t)&&e.is(t.searchDisplayCustoInputs,"object")&&(this._displayNameCusto=t.searchDisplayCustoInputs)}for(r=0;r<_.length;r++)if(e.is(_[r].viewId,"string")&&"The_Default_Columns"!==_[r].viewId){if(d={label:_[r].viewId,value:_[r].viewId+"-ADMIN"},0===_[r].viewId.indexOf("###"))if(e.is(_[r].viewDefinition,"array"))g=_[r].viewId.substring(3,_[r].viewId.length),d.label=S.replace(S.get("custo_PQ"),{PQ:g});else if(e.is(_[r].custoAliasToUse,"string")){var y=_[r].viewId.substring(3,_[r].viewId.length);d.label=S.replace(S.get("custo_type"),{type:y})}C.push(d)}C.sort(w)}if(n.length>0&&C.length>0){var I=S.get("SearchColumnCustoUserGroup"),D=S.get("SearchColumnCustoAdminGroup");for(u=0,h=n.length;u<h;u++)n[u].group=I;for(u=0,h=C.length;u<h;u++)C[u].group=D}var T=n.concat(C),A=!1,x=!1,N=null;if(e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0&&(N=t.forcedCusto),!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var O="###"+t.typeName.pqName;if(e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(_=this._dsCusto.SearchColumnCustoDSDefinition,r=0;r<_.length&&!x;r++)e.is(_[r].viewId,"string")&&_[r].viewId===O&&N===O&&(x=!0,N=O);for(r=0,l=T.length;r<l&&!A;r++)O!==T[r].value&&O+"-ADMIN"!==T[r].value||(T[r].selected=!0,A=!0,N=O)}if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){var P="###"+t.typeName.pqName;if((!e.is(N)||!N.startsWith(P))&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(_=this._dsCusto.SearchColumnCustoDSDefinition,r=0;r<_.length;r++)if(e.is(_[r].viewId,"string")&&_[r].viewId===P){N=P+"-HIDDEN",d={label:"Customized PQ: "+t.typeName.pqName,value:N},T.push(d);break}if(!e.is(N)||!N.startsWith(P)){var E=p.getViewData();if(e.is(E)&&e.is(E.SearchColumnCustoDefinition)){var k=E.SearchColumnCustoDefinition;e.is(k)&&e.is(k.viewId,"string")&&k.viewId===P&&(N=P+"-HIDDEN",d={label:"Customized PQ: "+t.typeName.pqName,value:N},T.push(d))}}}}if(!A&&!x&&e.is(s,"object")&&e.is(s.activeView,"string"))for(t.isPQ&&(!e.is(t.forcedCusto,"string")||t.forcedCusto.length<=0)?e.is(N)||(N=s.activeView):N=t.isPQ&&e.is(t.forcedCusto,"string")&&t.forcedCusto.length>0?t.forcedCusto:s.activeView,r=0,l=T.length;r<l&&!A;r++)N===T[r].value&&(T[r].selected=!0,A=!0);return T},getColumnCustomizationAliasIdToUse:function(t,i){var n=null,s="###"+t;if(e.is(this._adminCusto,"object")&&e.is(this._adminCusto.SearchColumnCustoAdminDefinition,"array")){var a=[];if(this._adminCusto.SearchColumnCustoAdminDefinition.length>0)a=this._adminCusto.SearchColumnCustoAdminDefinition;else{let t=o.getOption("column_custo",{tenant:i});e.is(t)&&e.is(t.searchColumnCustoInputs,"object")&&e.is(t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,"array")&&t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition.length>0&&(a=t.searchColumnCustoInputs.SearchColumnCustoAdminDefinition,this._adminCusto=t.searchColumnCustoInputs)}for(var r=0;r<a.length&&(!e.is(a[r].viewId,"string")||a[r].viewId!==s||(n=a[r].custoAliasToUse,!e.is(n)));r++);}return n},getColumnCustomizationIdToUse:function(t,i){if(this._activeTenant=i,e.is(t.forcedCusto))return t.forcedCusto;var n=this.getAvailableColumnCustomization(t,i),s="The_Default_Columns";if(e.is(n,"array")&&n.length)for(var o=0,a=n.length;o<a;o++)if(e.is(n[o].selected)&&!0===n[o].selected){s=n[o].value;break}if(!0===t.isPQ){if(e.is(t.typeName)&&e.is(t.typeName.pqName,"string")&&t.typeName.pqName.length>0){this._pqName=t.typeName.pqName;var r="###"+this._pqName;if(!s.startsWith(r)&&e.is(this._dsCusto,"object")&&e.is(this._dsCusto.SearchColumnCustoDSDefinition,"array"))for(var l=this._dsCusto.SearchColumnCustoDSDefinition,c=0;c<l.length;c++)if(e.is(l[c].viewId,"string")&&l[c].viewId===r){s=r+"-HIDDEN";break}if(!s.startsWith(r)){var d=p.getViewData();if(e.is(d)&&e.is(d.SearchColumnCustoDefinition)){var u=d.SearchColumnCustoDefinition;e.is(u)&&e.is(u.viewId,"string")&&u.viewId===r&&(s=r+"-HIDDEN")}}}}else this._pqName=null;return s},getColumnCustomizationDefinitionFromCustoId:function(t,i){var n=[],s=this._getDefaultColumnsForInApps(i),o=[],c=0,d=0,u=null,h=0,g=-1,_=-1,f=null,m=0;for(c=0,d=s.length;c<d;c++)o.push(s[c].dataIndex);if("The_Default_Columns"===t)s=this._getDefaultColumns(i);else{var v=e.clone(a.getItem("DataGridColumnCusto"));if(e.is(v,"object")&&e.is(v.views,"array"))for(c=0,d=(u=v.views).length;c<d;c++)if(t===u[c].viewId&&e.is(u[c].viewDefinition,"array")&&0<u[c].viewDefinition.length){s=u[c].viewDefinition;break}if(!e.is(n,"array")||0===n.length){u=this._adminCusto.SearchColumnCustoAdminDefinition;var S=this._adminCusto.CustoAliasDefinitions;for(c=0,d=u.length;c<d;c++)if(t===u[c].viewId+"-ADMIN"){if(e.is(u[c].viewDefinition,"array"))n=e.clone(u[c].viewDefinition);else if(e.is(S,"array")&&0<S.length)for(var w=0,b=S.length;w<b;w++)S[w].aliasId===u[c].custoAliasToUse&&(n=e.clone(this._adminCusto.CustoAliasDefinitions[w].viewDefinition));if(e.is(n,"array")){for(h=0;h<n.length;h++)n[h].dataIndex=n[h].uri,g=n[h].uri.indexOf(":"),_=n[h].uri.indexOf("."),f=null,g>0&&_>0&&_>g&&(f=n[h].uri.substring(0,_)),n[h].dataType=f,n[h].isSortable=!0,n[h].minWidth=40,n[h].text=l.getNLSValueForPredicate(n[h].uri),n[h].visibility=!0,n[h].visibilityEditable=!1,n[h].defaultSort="none",n[h].wrap=!1,n[h].pinned="center",m=parseInt(n[h].width,10),n[h].width=isNaN(m)?"auto":m;s=n}break}}if(!e.is(n,"array")||0===n.length)for(c=0,d=(u=this._dsCusto.SearchColumnCustoDSDefinition).length;c<d;c++)if(t===u[c].viewId+"-HIDDEN"){if(n=e.clone(u[c].viewDefinition),e.is(n,"array"))for(h=0;h<n.length;h++)n[h].dataIndex=n[h].uri,g=n[h].uri.indexOf(":"),_=n[h].uri.indexOf("."),f=null,g>0&&_>0&&_>g&&(f=n[h].uri.substring(0,_)),n[h].dataType=f,n[h].isSortable=!0,n[h].minWidth=40,n[h].text=l.getNLSValueForPredicate(n[h].uri),n[h].visibility=!0,n[h].visibilityEditable=!1,n[h].defaultSort="none",n[h].wrap=!1,n[h].pinned="center",m=parseInt(n[h].width,10),n[h].width=isNaN(m)?"auto":m,-1===o.indexOf(n[h].dataIndex)&&s.push(n[h]);break}if(!e.is(n,"array")||0===n.length){var C=null,y=p.getViewData();if(e.is(y)&&e.is(y.SearchColumnCustoDefinition)&&(C=p.getViewData().SearchColumnCustoDefinition),C&&t===C.viewId+"-HIDDEN"&&(n=e.clone(C.viewDefinition),e.is(n,"array")))for(h=0;h<n.length;h++)n[h].dataIndex=n[h].uri,g=n[h].uri.indexOf(":"),_=n[h].uri.indexOf("."),f=null,g>0&&_>0&&_>g&&(f=n[h].uri.substring(0,_)),n[h].dataType=f,n[h].isSortable=!0,n[h].minWidth=40,n[h].text=l.getNLSValueForPredicate(n[h].uri),n[h].visibility=!0,n[h].visibilityEditable=!1,n[h].defaultSort="none",n[h].wrap=!1,n[h].pinned="center",m=parseInt(n[h].width,10),n[h].width=isNaN(m)?"auto":m,-1===o.indexOf(n[h].dataIndex)&&s.push(n[h])}}if(r.isFUN096612Active()){var I=[],D=s.length;if(D>0)for(var T=0;T<D;T++)if(e.is(s[T])&&e.is(s[T].dataIndex,"string")&&"ds6wg:_displayName_"===s[T].dataIndex){s.splice(T,1);break}var A=this.getDisplayNameColumn(this._pqName);e.is(A)&&(I.push(A),s=I.concat(s))}if(e.is(s))for(c=0,d=s.length;c<d;c++)e.is(s[c])&&e.is(s[c].dataIndex,"string")&&(s[c].dataIndex=r.getURIToUse(s[c].dataIndex));return s},getColumnCustomizationDefinitionFromAliasCustoId:function(t){var i=[],n=[],s=0,o=0;if(!e.is(t,"string")||0===t.length)throw new Error("Invalid Arg in SearchCustoServices.getColumnCustomizationDefinitionFromAliasCustoId!");var a=[];for(s=0,o=(i=this._getDefaultColumnsForInApps()).length;s<o;s++)a.push(i[s].dataIndex);if(e.is(this._adminCusto)){var r=this._adminCusto.CustoAliasDefinitions;if(e.is(r))for(s=0,o=r.length;s<o;s++)if(t===r[s].aliasId){var c=e.clone(r[s]);if(e.is(c.viewDefinition,"array")){n=c.viewDefinition;for(var d=0;d<n.length;d++){n[d].dataIndex=n[d].uri;var u=n[d].uri.indexOf(":"),h=n[d].uri.indexOf("."),g=null;u>0&&h>0&&h>u&&(g=n[d].uri.substring(0,h)),n[d].dataType=g,n[d].isSortable=!0,n[d].minWidth=40,n[d].text=l.getNLSValueForPredicate(n[d].uri),n[d].visibility=!0,n[d].visibilityEditable=!1,n[d].defaultSort="none",n[d].wrap=!1,n[d].pinned="center";var p=parseInt(n[d].width,10);n[d].width=isNaN(p)?"auto":p,-1===a.indexOf(n[d].dataIndex)&&i.push(n[d])}}break}}return i},getColumnCustomizationDefinitionFromCustoIdWithNLSUpdated:function(t,i){var n=this.getColumnCustomizationDefinitionFromCustoId(t),o=null,a=null;if(e.is(i,"function")){for(var r={},c=["ds6wg:PLMEntity"],d={vocabIds:[]},u=0,h=n.length;u<h;u++)if(n[u].dataIndex.startsWith("ds6wg"))if(e.is(n[u].dataType)&&!e.is(r[n[u].dataType]))r[n[u].dataType]=!0,c.push(n[u].dataType);else{var g=n[u].dataIndex,p=g.indexOf(".");p>0&&(g=n[u].dataIndex.slice(0,p),e.is(r[n[u].dataType])||(r[g]=!0,c.push(g)))}else{var _=n[u].dataIndex;o=l.getVocabId(_),e.is(o)&&(l.isLoaded(o)||(-1===d.vocabIds.indexOf(o)&&(d.vocabIds.push(o),d[o]=[]),d[o].push(_))),n[u].text=l.getNLSValueForPredicate(n[u].dataIndex)}var f=d.vocabIds.length;if(f>0)for(var m=0;m<f;m++)o=d.vocabIds[m],l.loadVocabulary(o,function(t){if(e.is(t)&&"success"===t.status){var i=d[t.id];if(e.is(i)){for(var o=0;o<i.length;o++)a=i[o];for(var r=n.length,c=0;c<r;c++)a=n[c].dataIndex,-1!==i.indexOf(a)&&(n[c].text=l.getNLSValueForPredicate(a))}}else s.warn("Error in PredicatesNLS.loadVocabulary !")});c.length>0?l._asyncCallToPredicatesWS(c).then(function(t){if(!e.is(t.classPredicates))return s.error("Unexpected response from GetRelevantPredicates !"),null;for(var o=0,a=n.length;o<a;o++)if(n[o].dataIndex.startsWith("ds6wg:"))for(var r=0,l=t.classPredicates.length;r<l;r++){if(!e.is(t.classPredicates[r].className)||!e.is(t.classPredicates[r].vocabularyPredicateInfo))return s.error("Unexpected response from GetRelevantPredicates !"),null;for(var c=0,d=t.classPredicates[r].vocabularyPredicateInfo.length;c<d;c++)t.classPredicates[r].vocabularyPredicateInfo[c].uri===n[o].dataIndex&&(n[o].text!==t.classPredicates[r].vocabularyPredicateInfo[c].nlsName&&(n[o].text=t.classPredicates[r].vocabularyPredicateInfo[c].nlsName),c=d,r=l)}var u={},h=0,g=0;for(h=0,g=n.length;h<g;h++)e.is(u[n[h].text])||(u[n[h].text]=0),u[n[h].text]+=1;for(h=0,g=n.length;h<g;h++)e.is(u[n[h].text])&&u[n[h].text]>1&&(n[h].text+=" ("+n[h].dataType+")");i(n)},function(){s.log("promisePredicate fail !"),i(n)}):i(n)}},_getDefaultColumns:function(e){var t=p.getDataGridViewHeaders(e);return this._completeColumnDefinition(t),t},_getDefaultColumnsForInApps:function(){var e=p.getDataGridViewHeadersForInApps();return this._completeColumnDefinition(e),e},getDisplayNameColumn:function(t){var i=null;if(e.is(this._displayNameCusto,"object")&&e.is(this._displayNameCusto.CustoDisplayName,"array")){var n=this._displayNameCusto.CustoDisplayName.length;if(n>0)for(var s=0;s<n;s++)this._displayNameCusto.CustoDisplayName[s].viewId+"-ADMIN"!==t&&this._displayNameCusto.CustoDisplayName[s].viewId!=="###"+t||(i={uri:"ds6wg:_displayName_",width:"auto",dataIndex:"ds6wg:_displayName_",dataType:null,isSortable:!1,minWidth:40,text:"ds6wg:_displayName_",visibility:!0,visibilityEditable:!1,defaultSort:"none",wrap:!1,pinned:"left"})}return i},getDisplayNameObject:function(t){var i={},n=[];if(e.is(this._displayNameCusto,"object")&&e.is(this._displayNameCusto.CustoDisplayName,"array")){var s=this._displayNameCusto.CustoDisplayName.length;if(s>0)for(var o=0;o<s;o++)if(this._displayNameCusto.CustoDisplayName[o].viewId+"-ADMIN"===t||this._displayNameCusto.CustoDisplayName[o].viewId==="###"+t){if(e.is(this._displayNameCusto.DisplayNameAliasDefinitions,"array"))for(var a=this._displayNameCusto.DisplayNameAliasDefinitions.length,r=0;r<a;r++)if(this._displayNameCusto.CustoDisplayName[o].aliasIdToUse===this._displayNameCusto.DisplayNameAliasDefinitions[r].aliasId){if(e.is(this._displayNameCusto.DisplayNameAliasDefinitions[r].separator)&&(i.separator=this._displayNameCusto.DisplayNameAliasDefinitions[r].separator),e.is(this._displayNameCusto.DisplayNameAliasDefinitions[r].aliasDefinition,"array")){var l,c=this._displayNameCusto.DisplayNameAliasDefinitions[r].aliasDefinition,d=0;for(d=0,l=c.length;d<l;d++)n.push(c[d].uri)}break}break}}return i.displayNamePredicates=n,this._displayNameCustoObject=i,i},getDisplayNameCustoObject:function(){return this._displayNameCustoObject},_completeColumnDefinition:function(e){var t=this,i=a.getItem("listColumnsWidth");if(i)try{var n=JSON.parse(i),o=Object.keys(n);e.forEach(function(e){e.width=-1===o.indexOf(e.dataIndex)?"auto":n[e.dataIndex],e.isSortable=t.isColumnSortable(e.dataIndex)})}catch(e){s.log(e)}else e.forEach(function(e){e.isSortable=t.isColumnSortable(e.dataIndex)})},isColumnSortable:function(e){return!(-1!==this.fixColumnUnsortable.indexOf(e))},isColumnSortableFor1000:function(e){return-1!==this.fixColumnSortableFor1000.indexOf(e)},closeColCustoPanelObj:function(){e.is(this.colCustoPanel)&&e.is(this.colCustoPanel._requestClosePanel,"function")&&(this.colCustoPanel._requestClosePanel(),this.colCustoPanel.destroy()),this.colCustoPanel=null},getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){0==i.indexOf("sixw:")?(t[i]=t[i]||[],(e[i]||[]).forEach(function(e){t[i].push(e)})):(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],n=e.value||[],s=e.field;i.forEach(function(i,o){t[i.predicate]||(t[i.predicate]=[]);var a={disptext:e.display,object:n[o],type:i.type,field:s?[s[o]]:["implicit"]};t[i.predicate].push(a)})})})}),t},_removeColumnCustoMask:function(t){if(e.is(t.collection)&&e.is(t.collection._snSkeleton)&&e.is(t.collection._snSkeleton.getSearchActions,"function")){var i=t.collection._snSkeleton.getSearchActions();e.is(i)&&e.is(i.removeMask,"function")&&i.removeMask()}},defineColumnCusto:function(t){var i=null,n=t.getOption("widgetId");if(e.is(t.zIndexToUse)||(t.zIndexToUse=r.getZIndex(t.container)),t.collection.isEmpty())return g._displayAlert({message:S.get("ColumnCustomization_error_noResult"),className:"warning",widgetId:n}),this._removeColumnCustoMask(t),null;if(e.is(t.collection)&&e.is(t.collection.service_parameters)&&e.is(t.collection.service_parameters.query)&&r.SearchTypeEnum.MY_RECENT_CONTENT===t.collection.service_parameters.query)return g._displayAlert({message:S.get("SearchDataGridPreferences_error_RecentModeNotSupported"),className:"warning",widgetId:n}),this._removeColumnCustoMask(t),null;var s=!1,o=["ds6wg:PLMEntity"],a=null;if(e.is(t.collection.options.tagger_proxy)&&(a=t.collection.options.tagger_proxy.latest_tagValues),e.is(t.collection.service_parameters.isAPQSearch)&&!0===t.collection.service_parameters.isAPQSearch){var l=t.collection.getPQ();if(e.is(l)&&e.is(l.pqName,"string")&&l.pqName.length>0&&(s=!0,i={typeName:l,isPQ:!0},e.is(a,"array")&&a.length>0))for(var c=0;c<a.length;c++){var u=a[c];"ds6w:what/ds6w:type"===u.sixw&&o.push("ds6wg:"+u.object)}}var h={};if(e.is(t.collection.options.tagger_proxy)&&e.is(t.collection.options.tagger_proxy.getCurrentFilter())){h=t.collection.options.tagger_proxy.getCurrentFilter(),e.is(h.allfilters)&&d.isSimplifiedTaggerFilters(h.allfilters)&&(h.allfilters=this.getAllFilters(t.collection.options.tagger_proxy.getCurrentFilter().allfilters))}!e.is(t.collection.options.tagger_proxy)||e.is(i)||e.is(h)&&e.is(h.allfilters)&&(e.is(h.allfilters["ds6w:what/ds6w:type"])&&1===h.allfilters["ds6w:what/ds6w:type"].length||e.is(h.allfilters["ds6w:what/ds6w:kind"])&&1===h.allfilters["ds6w:what/ds6w:kind"].length||e.is(h.allfilters["sixw:ds6w:what/ds6w:type"])&&1===h.allfilters["sixw:ds6w:what/ds6w:type"].length||e.is(h.allfilters["sixw:ds6w:what/ds6w:kind"])&&1===h.allfilters["sixw:ds6w:what/ds6w:kind"].length)||s?this._launchColumnCustoPanelCB(t,i,o,h):this._launchFreeTypeCusto(t,o)},updateDatagridTargetObj:function(e){this.colCustoPanelEndUser&&this.colCustoPanelEndUser.setoDatagridTarget(e)},_launchColumnCustoPanelCB:function(t,i,n,s){var o=this;this.colCustoPanel=new _({spreadsheet:t.nestedView.view,searchDatagridView:t,typeToHandle:i,zIndexToUse:t.zIndexToUse,isNewDataGrid:!0,arrayTypeDS6WG:n,currentFilter:s,oSearchCustoServices:this}),this.colCustoPanel.addEvent("onCloseColumnCustomizationPanel",function(){e.is(o.colCustoPanel)&&e.is(o.colCustoPanel.destroy,"function")&&o.colCustoPanel.destroy(),o.colCustoPanel=null}),this._removeColumnCustoMask(t)},_launchFreeTypeCusto:function(e){if(this.colCustoPanelEndUser)this.colCustoPanelEndUser.reloadRightGridWithCurrentColumns().enableFooterButtonsVisiblity().unselectAllLeftPredicates().showDialog(),this._removeColumnCustoMask(e);else{let t=e.collection._snSkeleton.getOption("resources");h.login({resources:t,onComplete:t=>{this._loadDataAndLaunchPanel(e,t)},onFailure:t=>{this._loadDataAndLaunchPanel(e,t)}})}},_loadDataAndLaunchPanel:function(t,i){let n=this._freeTypeCustoComputeSources(i),s=e.clone(a.getItem("DataGridColumnCusto")),o=[];if(s&&e.is(s.views,"array"))for(let e=0;e<s.views.length;e++)if("ENDUSER_CUSTO"===s.views[e].viewId){o=s.views[e].viewDefinitionHidden;break}this.colCustoPanelEndUser=new f({spreadsheet:t.nestedView.view,searchDatagridView:t,isNewDataGrid:!0,oSearchCustoServices:this,sources:n,hiddenData:o,resources:t.collection._snSkeleton.getOption("resources")}),this._removeColumnCustoMask(t)},_freeTypeCustoComputeSources:function(e){let t=r.getValidDatasources({dataSources:e});var i=[];for(let e=0;e<t.dataSourceNames.length;e++)i.push({value:t.dataSourceNames[e],label:S.get("adv_search.source."+t.dataSourceNames[e])});return i}})}),define("DS/SNResultUX/utils/SearchTagsTransformation",["UWA/Core","DS/SNResultUX/utils/ContentLocationServices","DS/SNInfraUX/SearchSettings","i18n!DS/SNInfraUX/assets/nls/SN6WOntology.json"],function(e,t,i,n){"use strict";function s(i){return this.prepareNlsPropertiesValueForServer=function(e,n){return!0===t.isContentLocationActive()&&i.isTransientWidget,s.prepareTransformedFacetValuesToTranslate(e,n),n},this.displaySourceInSearchView=function(e,n,s){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.displaySourceInSearchView(e,n,s)},this.addSource=function(e,n){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.addSource(e,n)},this.isTransientWidget=function(){return i.isTransientWidget},this.setNlsNameDetails=function(e){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.setNlsNameDetails(e)},this.transformFacets=function(n,o){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformToDataSourceFacets(n,o);var a=s.getPredicateMappingObject(),r=null;e.is(n,"array")&&e.is(n[o])&&e.is(n[o].sixw,"string")&&(r=n[o].sixw.split("/").pop()),a&&a.hasOwnProperty(r)&&(e.is(n[o].object,"array")||(n[o].dispValue=[],n[o].object=[n[o].object]))},this.transformTagsValuesToDataSourceFacets=function(e,n,s,o){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformTagsValuesToDataSourceFacets(e,n,s,o)},this.transformAddSubjectsToDataSourceFacets=function(e){!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformAddSubjectsToDataSourceFacets(e)},this.transformFilterSourceToProject=function(e){if(!0===t.isContentLocationActive()&&i.isTransientWidget&&t.transformFilterSourceToProject(e),"1"===s.getMappingVersion()){var n=e.localfilters,o=e.allfilters;s.transformFilterOnMappedPredicates(o),s.transformFilterOnMappedPredicates(n)}},this.getAvblSource=function(e,n){!0===t.isContentLocationActive()&&(i.isTransientWidget||n)&&t.getAvblSource(e)},this.updateFilter=function(e,n){if(!0===t.isContentLocationActive()&&i.isTransientWidget)return t.updateFilter(e,n)},this}return s.getMappingVersion=function(){return i.getOption("searchTypeOntology")},s.getPredicateMappingObject=function(){var t=null;if("1"===s.getMappingVersion()){var n=i.getOption("predicate_Mapping");e.is(n)&&!0===n.isActive&&(t=n)}return t},s.transformPredicateValuesWithMapping=function(t){var i=s.getPredicateMappingObject();"1"===s.getMappingVersion()&&e.is(i)&&e.is(t)&&t.forEach(function(t){var n=t.sixw.split("/").pop();if(e.is(n)&&(n=n.split("/").pop()),e.is(n)&&!0===i.hasOwnProperty(n)&&e.is(i[n],"object")){var s=t.object;if(i[n].hasOwnProperty(s)){var o=i[n][s];if(e.is(o,"array"))for(var a=0;a<o.length;a++)"$"===o[a]&&(o[a]=s);t.object=o}}})},s.prepareTransformedFacetValuesToTranslate=function(t,i){var n=s.getPredicateMappingObject();return"1"===s.getMappingVersion()&&e.is(n)&&n.hasOwnProperty(t)&&(i=e.is(i,"array")?i[0]:i.split("/").pop()),i},s.transformNlsForMappedPredicates=function(t){var i=s.getPredicateMappingObject();if("1"===s.getMappingVersion()&&e.is(i))for(var o in t)if(i.hasOwnProperty(o)){var a=null;for(var r in t[o])if(0<r.indexOf("/"))a=r.split("/").pop(),e.is(t[o][a])&&(t[o][r]=t[o][a]);else if(0<r.indexOf(":"))a=r.split(":").pop(),e.is(t[o][a])&&(t[o][r]=t[o][a]);else{var l=n.get(r);e.is(l)&&n.hasOwnProperty(r)&&(t[o][r]=l)}}},s._getAggregatedFacets=function(t,i){var n=[],o=s.getPredicateMappingObject();if("1"===s.getMappingVersion()&&e.is(o)&&o.hasOwnProperty(t)){var a=o[t];for(var r in a){var l=a[r],c=!1;e.is(l,"array")&&l.forEach(function(e){e===i&&(c=!0)}),!0===c&&n.push(r)}}return n},s._buildAdditionalFacetsFromCategory=function(t,i){var n=t.split("/").pop(),o=[];return i.forEach(function(t){var i=[];i.push(t);var a=t.object,r=[];e.is(a)&&s._getAggregatedFacets(n,a).forEach(function(i){var n=e.clone(t);n.object=i,n.disptext=i,r.push(n)});r.length&&(i=r),o=o.concat(i)}),o},s.transformFilterOnMappedPredicates=function(t){if(e.is(t,"object"))for(var i in t)t[i].forEach(function(t){e.is(t.object,"array")&&(t.object=t.object[t.object.length-1])}),t[i]=s._buildAdditionalFacetsFromCategory(i,t[i])},s}),define("DS/SNResultUX/utils/SearchDoubleClickHandler",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassServices/i3DXCompassPubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/utils/ResultsUtils"],function(e,t,i,n,s,o,a,r,l,c){"use strict";return t.singleton(i,{handle:function(t){let i=null;if(e.is(t)&&e.is(t.compassData)&&(i=t.compassData),e.is(t.skeleton)&&e.is(t.id)){var s=t.skeleton;a.log("double click event received for "+t.id);var l=s.getOption("in_apps_search");if(l&&l.UXOptions&&!1===l.UXOptions.dblClk)return;var d=t.collection?t.collection:s.getCollection();if(e.is(d)){var u=this,h=d.get(t.id);if(e.is(h)){var g=function(){u.onDoubleClick({appID:r.SEARCH_APP_ID,model:h,skeleton:s,onComplete:function(n){e.is(n)&&e.is(n.id,"string")&&e.is(n.sourceJS,"string")?n.sourceJS.length>0&&require([n.sourceJS],function(a){e.is(i)&&o.publish("setX3DContent",i),a.executeAction({action_id:n.id,actionsHelper:s._getActionsHelper(),object_ids:[t.id],widget_id:s.getOption("widgetId")})}):u._logNoActionOrError({type:"bad JS impl",error:"BAD action information to handle double click",callbackOnFailedToOpen:t.callbackOnFailedToOpen})},onFailure:function(i){e.is(i,"object")&&(i.callbackOnFailedToOpen=t.callbackOnFailedToOpen),u._logNoActionOrError(i)}})},p=s.getOption("in_apps_search"),_=e.is(p),f=c.isAdvSearchRun(p);!0===_&&e.is(t.force)&&!0===t.force&&(_=!1);var m=s.getOption("addinMode"),v=e.is(m,"string")&&m.length>0,S=n.getOption("search_web_in_win"),w="SavedSearch"===h.get("ds6w:type_value")&&"3DSpace"===h.getServiceID(),b=!1,C=h.getSourceID();if(!0!==S||!e.is(C)||"swym"!==C&&"dashboard"!==C&&"drive"!==C||(b=!0),w||b)g();else if(S){var y={objectId:h.get("id")};s._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onDoubleClick",notif_parameters:JSON.stringify(y)},"search_web_in_win")}else if(!_||f||v){if(_&&!f&&v)(I=s.getOption("observable")).dispatchPowerByInContextSelection(!0);g()}else{var I=s.getOption("observable");e.is(I)&&1===I.getSelectedItemsCount()?I.dispatchInContextSelection(l.app_socket_id,"in_app_ok"):u._logNoActionOrError({message:"no action on double click during in-context mode as the multi-selection is possible",callbackOnFailedToOpen:t.callbackOnFailedToOpen})}}}}},onDoubleClick:function(t){if(e.is(t,"object")){let i=t.model;if(e.is(i)&&e.is(i.getServiceID,"function")&&e.is(i.getPlatformID,"function")){let n=i.getServiceID(),o=i.getPlatformID();s.getServiceUrl({serviceName:n,platformId:o,onComplete:function(s){l.load({serviceID:n,platformID:o,serviceURL:s}).then(function(n){if(e.is(n.getDoubleClickAction,"function")){let o={model:i,appID:t.appID?t.appID:r.SEARCH_APP_ID,skeleton:t.skeleton,serviceURL:s,onComplete:function(i){e.is(t.onComplete,"function")&&t.onComplete.call(void 0,i)},onFailure:function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"double_click_action_delegation_failure",error:i})}};n.getDoubleClickAction.call(void 0,o)}},function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"require_failure",error:i})})}})}}},_logNoActionOrError:function(t){e.is(t.error)?(a.log(t.type),a.log(t.error)):a.log(t.message),e.is(t.callbackOnFailedToOpen,"function")&&t.callbackOnFailedToOpen()}})}),window.dsDefaultWebappsBaseUrl&&require.config({paths:{vuejs:window.dsDefaultWebappsBaseUrl+"vuejs/2.6.10/vue.min","vu-kit":window.dsDefaultWebappsBaseUrl+"vuekit/vu-kit.umd","vuekit-css":window.dsDefaultWebappsBaseUrl+"vuekit/vu-kit"}}),define("DS/SNResultUX/views/utils/SearchLightboxPreview",["vuejs","vu-kit","text!DS/SNResultUX/views/utils/SearchLightboxVue.html","UWA/Class/Debug","UWA/Core","UWA/Controls/Abstract","UWA/Element","UWA/Promise","DS/PubSub/PubSub","DS/i3DXCompassServices/i3DXCompassPubSub","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchVersioning","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchDoubleClickHandler","DS/SNInfraUX/ServiceDelegationLoader","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","css!vuekit-css"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m){"use strict";e.use(t);return o.extend(n,{_informationPanel:null,_rootView:null,_rootContainer:null,_lastSelectedItem:null,_selectedItems:null,_width:420,_widgetId:null,_previewZone:null,_lightboxInformationPanel:null,_informationZone:null,_searchSignatureZone:null,_objectTypeIcon:null,_lightboxTitle:null,_skeleton:null,_lightBoxView:null,_searchPreviewDelegationRenderer:null,_bIsOnIphone:!1,_infoContainer:null,_menuAction:null,_listOfDSEditPropWidget:[],_screenType:"desktop",_informationNopreview:null,_previewContainer:null,_inAppsContext:!1,_collection:null,_lightboxComponent:null,init:function(e){d.groupCollapsed("SearchPreview.init"),d.log("options:",e);let t=this;if(s.is(e)&&s.is(e.parent)&&s.is(e.parent.options)&&s.is(e.parent.options.in_apps_search)&&(this._inAppsContext=!0),this._parent(e),s.is(e.parentContainer)||d.error("No parentContainer given as argument!"),!s.is(e.rootContainer))return d.error("No rootContainer given as argument!"),void d.groupEnd();let i=g.identifyClientInfo(),n="";if(s.is(i)&&(n=i.identifier),"3DDashboard"===n){let e=require("DS/TransientWidget/Tool/Mapping");require("DS/TransientWidget/Tool/TransientMessaging").getInstance().on(e.TransientMessaging.ShowWidget,function(){d.log("Widget added, need to hide lightbox preview!"),t._exitPreview()}),l.add("dashboard:change",function(){d.log("Dashboard change, need to hide lightbox preview!"),t._exitPreview()})}if(l.add("search:addTab",function(){d.log("Search add tab, need to hide lightbox preview!"),t._exitPreview()}),this._lightBoxView=null,this._searchPreviewDelegationRenderer=null,this._infoContainer=null,this._listOfDSEditPropWidget=[],this._informationNopreview=null,this._previewContainer=null,this._rootView=e.parentContainer,this._rootContainer=e.rootContainer,this._lastSelectedItem=e.lastSelectedItem,s.is(this._lastSelectedItem)||d.warn("No search item given as input in options.lastSelectedItem!"),this._selectedItems=e.selectedItems,this._skeleton=e.parent,s.is(this._skeleton)||d.warn("No parent given as input in options.parent!"),s.is(e.width)){let t=screen.availWidth;this._width=2*e.width/3;let i=g.getDeviceCategory();"iphone"===i||"android"===i?(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0):!0===h.getOption("search_compact_mode")&&0===i.length&&t<1279&&(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0),"ipad"!==i&&"android"!==i||s.is(t)&&(t>1023?this._screenType="desktop":(this._screenType="mobile",this._width=e.width,this._bIsOnIphone=!0))}s.is(e.collection)&&(this._collection=e.collection),s.is(e.widgetId)&&(this._widgetId=e.widgetId),this._infoContainer=this.createContainers(),this._updateInformationsPanel(),this.dispatchEvent("onLightBoxPanelCreated"),d.groupEnd()},destroy:function(){if(d.groupCollapsed("SearchPreview.destroy"),this._lightboxComponent.show=!1,s.is(this._informationPanel)&&s.is(this._informationPanel.destroy,"function")&&this._informationPanel.destroy(),s.is(this._listOfDSEditPropWidget)){for(let e=this._listOfDSEditPropWidget.length-1;e>=0;e--){let t=this._listOfDSEditPropWidget[e];s.is(t)&&(t.destroyComponent(),this._listOfDSEditPropWidget[e]=0)}}this._listOfDSEditPropWidget=[],s.is(this._lightBoxView)&&s.is(this._lightBoxView.destroy,"function")&&this._lightBoxView.destroy(),this._lightBoxView=null,s.is(this._searchPreviewDelegationRenderer)&&s.is(this._searchPreviewDelegationRenderer.dispose,"function")&&this._searchPreviewDelegationRenderer.dispose(),this._informationPanel=null,this._searchPreviewDelegationRenderer=null,this._skeleton=null,this._lastSelectedItem=null,this._rootView=null,this.rootContainer=null,this._infoContainer=null,this._previewContainer=null,this._collection=null;let e=document.getElementById("search-lightbox");s.is(e)&&e.remove(),this._parent(),d.groupEnd()},_initInformationsPanel:function(){},_updateInformationsPanel:function(){d.groupCollapsed("SearchPreview._updateInformationsPanel"),performance.mark("3DSearch:UpdatePreviewBegin");let e=this;this._informationPanel&&(this._informationPanel.destroy(),this._informationPanel=null),e._lightboxComponent.bLoadingPreview=!0,s.is(this._lightBoxView)&&s.is(this._lightBoxView._LightBoxPanel)&&(this._lightBoxView._LightBoxPanel.visibleFlag=!1);for(let t=e._listOfDSEditPropWidget.length-1;t>=0;t--){let i=e._listOfDSEditPropWidget[t];s.is(i)&&i.destroyComponent()}this._listOfDSEditPropWidget=[];let t=e._lastSelectedItem,i=s.is(t)&&s.is(t.getServiceID,"function")?t.getServiceID():null,n=e._widgetId;s.is(e._skeleton)&&(n=e._skeleton.getOption("widgetId"));let o=e._getCollection();performance.mark("3DSearch:UpdatePreviewEndCleanUp"),performance.measure("3DSearch:UpdatePreviewCleanUp","3DSearch:UpdatePreviewBegin","3DSearch:UpdatePreviewEndCleanUp");let l=r.deferred(),c=r.deferred();Promise.all([l.promise,c.promise]).then(t=>{e._lightboxComponent.bLoadingPreview=!1,this._updateInformationsPanelContents(),s.is(t,"array")&&2===t.length&&(this._bPrimaryZone=t[0],this._bSecondaryZone=t[1],e._lightboxComponent.bPreviewPanelAvailable=t[0],e._lightboxComponent.bInformationPanelAvailable=t[1],e._bIsOnIphone),performance.mark("3DSearch:UpdatePreviewEnd"),performance.measure("3DSearch:UpdatePreview","3DSearch:UpdatePreviewBegin","3DSearch:UpdatePreviewEnd")});let u=function(i,n){d.log("SearchPreview defaultTreatment");require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/models/EditPropModel","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/models/EditPropAttributeModel","DS/EditPropWidget/constants/ConstantsMapping","DS/SNResultUX/views/utils/PropertiesServices"],function(o,a,r,l,u,g){g.getOptions({model:t,EditPropConstants:r,informationContext:"3DSearchPreview",onComplete:function(p){if(d.log("PropertiesServices.getOptions->onComplete",p),p.className="searchPreviewProperties",s.is(n)||(p.typeOfDisplay=r.ALL,p.selectionType=r.NO_SELECTION,p.warningOnUnsaved=!1,p.multiselection=r.MULTISEL_NO,p.collapseTabs=!1,s.is(p.facets)&&delete p.facets),s.is(p)&&s.is(p.facets,"array"))for(let e=0,t=p.facets.length;e<t;e++)s.is(p.facets[e],"object")&&(p.facets[e].alwaysVisible=!0);e._informationPanel=new o(p);let _=[r.FACET_VIEWS];s.is(h.getOption("showDerivedOutput"))&&h.getOption("showDerivedOutput")||(_.push(r.FACET_CHANGE),_.push(r.FACET_DERIVEDOUTPUT)),h.getOption("showChangeTab")||_.push(r.FACET_CHANGE),e._informationPanel.removeFacets(_);g.getPropModelFromSearchItem(t,a,l,u,function(t){s.is(i)&&(i.empty(),e._informationPanel.getContent().getContent().inject(i)),e._informationPanel.initDatas(t)},n),c.resolve(!0)},onAddFacets:function(t){if(d.log("PropertiesServices.getOptions->onAddFacets"),s.is(e._informationPanel)&&s.is(t,"array")){for(let e=0,i=t.length;e<i;e++)t[e].alwaysVisible=!0;e._informationPanel.addFacets(t)}}})})},g=function(){d.log("createLightBox");require(["DS/SNResultUX/views/utils/LightBoxView"],function(i){if(s.is(e._lightBoxView)){if(d.log("lightbox already exists"),null!==e._lightBoxView._LightBoxPanel){let t=e._lightBoxView._LightBoxPanel.elements.wrapper;s.is(t)&&null===t.getParent()&&t.inject(e._previewZone),l.resolve(!0),s.is(e._lightBoxView)&&s.is(e._lightBoxView._LightBoxPanel)&&!1===e._lightBoxView._LightBoxPanel.visibleFlag&&e._lightBoxView.activate_deactivate(e._lastSelectedItem)}}else{d.log("lightbox does not exists yet");let s={parentContainer:e._previewZone,model:t,widget_id:n,collection:o,skeleton:e._skeleton,bottomdocking:!1};e._lightBoxView=new i(s),e._lightBoxView._initPlayer(),l.resolve(!0)}})};s.is(this._lightboxComponent)&&this._lightboxComponent.updateCurrentItem(),null!==e._previewZone&&(null!==t&&s.is(i)&&(d.log("Calling ServiceDelegationLoader"),d.log("->serviceID:",i),d.log("->platformID:",t.getPlatformID()),f.load({serviceID:i,platformID:t.getPlatformID()}).then(function(i){if(!s.is(i))throw d.error("ServiceDelegation.load returns an invalid serviceDelegation!"),new Error("ServiceDelegation.load returns an invalid serviceDelegation!");if(e._previewZone.empty(),e._bPrimaryZone=!1,s.is(e._informationZone)&&s.is(e._informationZone.empty,"function")&&e._informationZone.empty(),e._bSecondaryZone=!1,s.is(i.getRenderPreview,"function"))d.log("Calling serviceDelegation.getRenderPreview"),d.log("->searchmodel:",t),d.log("->widget_id:",n),i.getRenderPreview({searchmodel:t,widget_id:n,onComplete:function(i){if(d.log("onComplete serviceDelegation.getRenderPreview"),!s.is(i))throw d.error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!"),new Error("ServiceDelegation.getRenderPreview returns an invalid previewRenderer!");e._searchPreviewDelegationRenderer=i,s.is(i.getPrimaryContent,"function")&&s.is(e._previewZone)&&(e._lightboxComponent.restoreInformationState(),i.getPrimaryContent({searchmodel:t,parentContainer:e._previewZone,widget_id:n,skeleton:e._skeleton,onComplete:function(i){if(d.log("onComplete preview.getPrimaryContent => custom primary content provided by datasource",i),s.is(i)){let n=i;s.is(i.content)&&(n=i.content),e._previewZone.empty();let o=n;s.is(o.inject,"function")||(o=a.extend(n)),o.inject(e._previewZone);let r=e._previewZone;if(s.is(i.onRenderingEnd)){i.onRenderingEnd.then(function(e){s.is(e)&&s.is(e.rootEltForHighlight)&&(r=e.rootEltForHighlight);try{p._highlightTerms(t,r)}catch(e){d.warn("highlighting failed!",e)}})}else try{p._highlightTerms(t,r)}catch(e){d.warn("highlighting failed!",e)}e._bPrimaryZone=!0}else d.warn("No content returned by getPrimaryContent");l.resolve(!0)},onFailure:function(){d.log("onFailure preview.getPrimaryContent");let t={widgetId:n};!0===p.getpreviewPanel(t)?(e._bPrimaryZone=!0,d.log(" => no custom primary content, using default one"),g()):l.resolve(!1)},onCusto:function(t){d.log("onCusto preview.getPrimaryContent"),d.log("->settings:",t),s.is(t)&&(s.is(t.informationUser)&&"hide"===t.informationUser&&(e._lightboxComponent.hideInformationPanel(!0),e._lightboxComponent.informationButtonHidden(!0)),s.is(t.nopreview)&&"visible"===t.nopreview&&l.resolve(!1))}})),s.is(i.getSecondaryContent,"function")&&s.is(e._informationZone)&&i.getSecondaryContent({searchmodel:t,parentContainer:e._informationZone,widget_id:n,onComplete:function(t){if(d.log("onComplete preview.getSecondaryContent"),s.is(t)){e._informationZone.empty();let i=a.extend(t);if(!s.is(i,"element")||!s.is(i.inject,"function"))return void d.error("Invalid content returned by getSecondaryContent");i.inject(e._informationZone),c.resolve(!0)}else null===t&&(d.log("No secondary area to display:"),c.resolve(!1))},onFailure:function(t){d.log("onFailure preview.getSecondaryContent"),d.log("listValues",t),e._informationZone.empty(),e._bSecondaryZone=!0,u(e._informationZone,t)}})}});else{let t={widgetId:n};!0===p.getpreviewPanel(t)?(g(),l.resolve(!0)):l.resolve(!1),u(e._informationZone)}},function(){d.log("ServiceDelegation not found"),u(e._informationZone),l.resolve(!1)})),d.groupEnd())},setActiveObject:function(e,t){d.groupCollapsed("SearchPreview.setActiveObject"),null===this._lastSelectedItem&&null===e||this._lastSelectedItem===e?d.groupEnd():(this._lastSelectedItem=e,s.is(this._lightboxComponent)&&this._lightboxComponent.updateCurrentItem(e),this._updateInformationsPanel(t),d.groupEnd())},switchVisibleFlag:function(){d.groupCollapsed("SearchPreview.switchVisibleFlag"),this.dispatchEvent("onPreviewModeRequest"),this._lightboxComponent.toggleVisibility(),d.groupEnd()},switchViewMode:function(){},getVisibleFlag:function(){d.groupCollapsed("SearchPreview.getVisibleFlag");let e=this._lightboxComponent.show;return d.groupEnd(),e},hideAndclean:function(){d.groupCollapsed("SearchPreview.hideAndclean");let e=this._rootContainer.querySelector(".onesearch_skeleton");s.is(e,"object")&&s.is(e.show,"function")&&e.show(),this._lightboxComponent.show&&(this._lightboxComponent.show=!1,this.dispatchEvent("onExitPreviewMode"),this.setActiveObject(null),s.is(this._lightBoxView)&&s.is(this._lightBoxView._LightBoxPanel)&&(this._lightBoxView._LightBoxPanel.visibleFlag=!1)),d.groupEnd()},createContainers:function(){let t=this;const n="vue-lightbox";let o;return document.getElementById(n)||((o=document.createElement("div")).id=n,document.body.prepend(o)),this._lightboxComponent=new e({el:"#"+n,template:i,data:function(){return{show:!0,isWidget:h.getOption("search_web_in_win"),//!widget.getValue('isStandalone'),
objectType:"https://vdevpril118dsy.dsone.3ds.com:443/3DSpace/snresources/images/icons/small/I_VPMNavProduct.png",availableActions:[],panels:[{name:"information",title:t._bIsOnIphone?m.get("actions.InfoPanel.title"):null,show:!t._bIsOnIphone,showClose:t._bIsOnIphone}],bOpenButtonHidden:!0,bInformationButtonHidden:!1,bInformationButtonActive:!t._bIsOnIphone,bPreviewPanelAvailable:!1,bInformationPanelAvailable:!1,bLoadingPreview:!0,bPreviousEnable:!0,bNextEnable:!0,noPreviewTitle:m.get("previewNotAvailable"),noPreviewDescription:m.get("extensionNotSupported"),typeIcon:null,zIndex:1302,closeLabel:m.get("InfoPanel.Close")}},computed:{sideActions(){return[{name:"previous",label:m.get("InfoPanel.Previous"),fonticon:"chevron-left",disabled:!this.bPreviousEnable,hidden:!1},{name:"next",label:m.get("InfoPanel.Next"),fonticon:"chevron-right",disabled:!this.bNextEnable,hidden:!1}]},primaryActions(){return[{name:"open",fonticon:"open",label:m.get("InfoPanel.Open"),selected:!1,hidden:this.bOpenButtonHidden},{name:"actions",fonticon:"down-open",label:m.get("InfoPanel.ActionsDropDown"),selected:!1,hidden:!1},{name:"information",fonticon:"info",label:m.get("infoPanel.toggle"),selected:this.bInformationButtonActive,hidden:this.bInformationButtonHidden}]},menuActions:()=>[],isLightboxVisible(){return this.show},isInformationPanelVisible(){return this.panels.find(e=>"information"===e.name).show},stylePreviewImg(){let e={"background-image":"url("+this.typeIcon+")"};return(this.bLoadingPreview||this.bPreviewPanelAvailable)&&(e.display="none"),e},stylePreviewArea(){let e={height:"100%"};return!this.bLoadingPreview&&this.bPreviewPanelAvailable||(e.display="none"),e},styleLoadingPreviewArea(){let e={};return this.bLoadingPreview||(e.display="none"),e},styleInformationArea(){let e={display:"unset"};if(t._bIsOnIphone)this.bInformationButtonActive?e.display="unset":e.display="none";else if(s.is(this.bInformationButtonActive)&&!t._bIsOnIphone){const e=this.panels.find(e=>"information"===e.name);s.is(e)&&(e.show=this.bInformationButtonActive)}return e},styleLightboxContent(){let e={display:"unset"};return t._bIsOnIphone&&(this.bInformationButtonActive?e.display="none":e.display="unset"),e}},methods:{updateCurrentItem(e){if(this.bPreviewPanelAvailable=!1,this.bInformationPanelAvailable=!1,void 0!==e&&(t._lastSelectedItem=e),s.is(t._lastSelectedItem)){if(s.is(t._lightboxTitle)){let e=t._getTreeModel();t._lightboxTitle.setHTML(e._options.label)}let e=t._lastSelectedItem.get("type_icon_url")||"",i=t._lastSelectedItem.get("preview_url")||"";if(-1<i.indexOf("snresources/images/icons/large")?e=i:-1<e.indexOf("snresources/images/icons/small")&&(e=(e=e.replace("snresources/images/icons/small","snresources/images/icons/large")).replace(".png","108x144.png")),this.typeIcon=e,s.is(t._getCollection())){let e=t._getCollection().getTreeDocument();if(s.is(e)){let i=e.getXSO();if(s.is(i)){let e=i.get();if(s.is(e)&&e.length>1){let i=e.find(function(e){return e.options.id===t._lastSelectedItem.get("id")});s.is(i)&&i.select(!0)}}}}}},open(){d.log("open requested"),t._open()},contextualMenu(e){e&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault());let i=document.querySelector("#search-lightbox .vu-icon.fonticon.fonticon-down-open"),n=t._skeleton.getCurrentView();if(s.is(n)){let e;"table"===n.id&&s.is(n.getOptionCommon,"function")&&s.is(n.getOptionCommon())||["myContent","what","who","when","where"].includes(n.id)&&g.isFUN109031Active()?e=n.getOptionCommon().onContextualEvent:s.is(n.view)&&(e=n.view.onContextualEvent),s.is(e)&&s.is(e.callback)&&e.callback.call(n,{forcemenu:!0,fromPreview:!0,data:{target:i},cellInfos:{nodeModel:t._getTreeModel(),cellView:{getContent:function(){return i}}}})}},toggleVisibility(e){this.show=void 0!==e?e:!this.show},refreshContent(e){let i,n=t._getCollection();if(s.is(n)){let e=n.getTreeDocument();if(s.is(e)){let t=e.getXSO();s.is(t)&&0===(i=t.get()).length&&e.getRoots()[0].select()}}if(s.is(i)&&i.length>0){let o=i[i.length-1],a=e>0?o.getNextVisibleNode():o.getPreviousVisibleNode();if(s.is(a)&&s.is(a.options)){let e=n.get(a.options.id);t.setActiveObject(e,!0),a.select(!0)}}},refreshActions(){},toggleInformationPanel(e){const t=this.panels.find(e=>"information"===e.name);if("boolean"==typeof e)t.show=e,this.bInformationButtonActive=e;else{let e=!t.show;t.show=e,this.bInformationButtonActive=e}},restoreInformationState(){this.informationButtonHidden(!1);const e=this.panels.find(e=>"information"===e.name);s.is(e)&&s.is(this.bInformationButtonActive)&&!t._bIsOnIphone&&(e.show=this.bInformationButtonActive)},hideInformationPanel(e){const t=this.panels.find(e=>"information"===e.name);s.is(t)&&(t.show=!e)},informationButtonHidden(e){this.bInformationButtonHidden=e},closeLightbox(){t.hideAndclean()}},mounted(){d.log("mounted"),this.$nextTick(()=>{t._lightboxContent=s.extendElement(this.$refs.lightboxContent),t._previewZone=s.extendElement(this.$refs.lightboxPreviewArea),t._lightboxInformationPanel=s.extendElement(this.$refs.lightboxInformationPanel),t._informationZone=s.extendElement(this.$refs.informationZone),t._searchSignatureZone=s.extendElement(this.$refs.searchSignatureZone),t._objectTypeIcon=s.extendElement(this.$refs.lightboxTypeIcon),t._lightboxTitle=s.extendElement(this.$refs.lightboxTitle),t._updateInformationsPanel()})},created(){},beforeCreate(){},beforeMount(){},beforeUpdate(){},updated(){},activated(){},deactivated(){},beforeDestroy(){},destroyed(){},errorCaptured(){}}),o},_updateInformationsPanelContents:function(){d.groupCollapsed("SearchPreview._updateInformationsPanelContents");let e=this,t=e._getTreeModel();if(!s.is(t)||!s.is(e._lastSelectedItem))return void d.groupEnd();if(s.is(this._lightboxComponent)&&this._lightboxComponent.updateCurrentItem(),s.is(e._titleObj)){let i=s.extendElement(e._titleObj);i.empty(),i.setHTML(t._options.label)}let i=e._getCollection();if(s.is(e._searchSignatureZone)){if(s.is(e._skeleton)){let t=i.getSearchRessources();if(s.is(t)){let i=e._lastSelectedItem.get("ds6w:responsibleUid");s.is(i)||(i=e._lastSelectedItem.get("owner"));let n=t.getUserPicture({login:i,format:"mini"});e._searchSignatureZone.querySelector(".e-nopicture").src=n}}let n=e._searchSignatureZone.querySelector(".user-subtitle"),o=s.extendElement(n);o.empty(),o.setHTML(t._options.subLabel)}if(s.is(e._menuAction)&&(e._menuAction.addClassName("menu-access-hidden"),"3dspace"!==e._lastSelectedItem.getSourceID()||this._inAppsContext||e._menuAction.removeClassName("menu-access-hidden")),null!==e._lastSelectedItem&&!0!==h.getOption("search_web_in_win")&&!this._inAppsContext){let t=e._lastSelectedItem.getServiceID();if(s.is(t))if(e._searchPreviewDelegationRenderer&&s.is(e._searchPreviewDelegationRenderer.getAppIdForOpen,"function")){let t={searchmodel:e._lastSelectedItem,widget_id:e._skeleton.getOption("widgetId"),onComplete:function(){e._lightboxComponent.bOpenButtonHidden=!1},onFailure:function(){e._lightboxComponent.bOpenButtonHidden=!0}};e._searchPreviewDelegationRenderer.getAppIdForOpen(t)}else _.onDoubleClick({model:e._lastSelectedItem,skeleton:e._skeleton,onFailure:function(){e._lightboxComponent.bOpenButtonHidden=!0},onComplete:function(){e._lightboxComponent.bOpenButtonHidden=!1}})}d.groupEnd()},_exitPreview:function(){this.hideAndclean()},_getCollection:function(){let e=this,t=e._collection;return s.is(e._skeleton)&&(t=e._skeleton.getCollection()),t},_getTreeModel:function(){let e=this._getCollection();if(!s.is(e))return;this._lightboxComponent.bPreviousEnable=!0,this._lightboxComponent.bNextEnable=!0;let t=e.indexOf(this._lastSelectedItem);if(-1!==t&&(0===t?(this._lightboxComponent.bPreviousEnable=!1,t===e.length-1?this._lightboxComponent.bNextEnable=!1:this._lightboxComponent.bNextEnable=!0):t===e.length-1?(this._lightboxComponent.bPreviousEnable=!0,this._lightboxComponent.bNextEnable=!1):(this._lightboxComponent.bPreviousEnable=!0,this._lightboxComponent.bNextEnable=!0),t>=0)){let i=null,n=e.getTreeDocument().getRoots();if(s.is(n,"array")&&t<n.length)return i=n[t]}},changeModel:function(e){d.groupCollapsed("SearchPreview.changeModel"),s.is(this._lightBoxView)&&this._lightBoxView.changeModel(e),d.groupEnd()},_open:function(){let e=this,t=e._lastSelectedItem.getServiceID(),i=e._lastSelectedItem.id,n=e._widgetId;if(s.is(e._searchPreviewDelegationRenderer))if(s.is(e._searchPreviewDelegationRenderer.getAppIdForOpen,"function")){let t={searchmodel:e._lastSelectedItem,widget_id:n,cb:function(t){e._exitPreview()}};e._searchPreviewDelegationRenderer.Open(t)}else if(s.is(t)){let o;s.is(e._skeleton)&&(o=e._skeleton._getActionsHelper()),f.load({serviceID:t,platformID:e._lastSelectedItem.getPlatformID()}).then(function(t){s.is(t.executeAction,"function")?t.executeAction({actionsHelper:o,action_id:"view",object_ids:[i],widget_id:n}):_.handle({skeleton:e._skeleton,id:i,force:!0})},function(){_.handle({skeleton:e._skeleton,id:i,force:!0})}),e._exitPreview()}}})}),define("DS/SNResultUX/utils/AdvSearchMgr",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SWFiltering","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SNPLMDictionary","DS/SNResultUX/utils/SNResultTypeCustoHelper","DS/SNInfraUX/SearchLogin","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SNAdvSearchCusto","DS/SNInfraUX/Logger","DS/SNInfraUX/utils/SNPreferenceUtil"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v){"use strict";return t.extend(n,i,{name:"DS_SNResultUX_utils_AdvSearchMgr",_status:!1,_dynamicPredicateSetType:[],_dynamicPredicateSetKind:[],_dynamicExtPredicateSetType:[],_otherDataSources:[],_dataSetsForSource:{},_dataSetsForType:null,_dataSetsForExtension:null,_adv_search_field:null,_criteriaData:null,_currentDataSource:null,CORE_BASIC_SOURCE:"ds6w:where/ds6w:source/ds6w:dataSource",CORE_BASIC_TYPE:"ds6w:what/ds6w:type",CORE_BASIC_SUBTYPE:"vpmextension",CORE_BASIC_LABEL:"ds6w:what/ds6w:label",CORE_BASIC_IDENTIFIER:"ds6w:what/ds6w:identifier",CORE_BASIC_MODIFIED:"ds6w:when/ds6w:modified",EXT_BASIC_DESCRIPTION:"ds6w:what/ds6w:description",EXT_BASIC_RESPONSIBLE:"ds6w:who/ds6w:responsible",EXT_BASIC_CREATED:"ds6w:when/ds6w:created",BASIC_PREDICATES:null,BASIC_PREDICATES_leaf:null,_resources:null,_service:null,_uniqueDataSource:null,_fieldsToSet:null,_TypesListToSet:null,_incontextFixedPredicates:[],_suggestDisabledPredicates:[],init:function(t){e.is(s.options.search_settings.service,"string")&&(this._service=s.options.search_settings.service),this.setDebugMode(s.getDebugMode()),this.setOptions(t),this._resources=t.resources,o.setResources({resources:this._resources}),l.setResources({resources:t.resources}),this.BASIC_PREDICATES=[this.CORE_BASIC_SOURCE,this.CORE_BASIC_TYPE,this.CORE_BASIC_SUBTYPE,this.CORE_BASIC_LABEL,this.CORE_BASIC_IDENTIFIER,this.CORE_BASIC_MODIFIED,this.EXT_BASIC_DESCRIPTION,this.EXT_BASIC_RESPONSIBLE,this.EXT_BASIC_CREATED],this.BASIC_PREDICATES_leaf=["ds6w:dataSource","ds6w:type","vpmextension","ds6w:label","ds6w:identifier","ds6w:modified","ds6w:description","ds6w:responsible","ds6w:created"],e.is(s.options.search_settings.adv_search_field,"string")&&s.options.search_settings.adv_search_field.length>0&&(this._adv_search_field=s.options.search_settings.adv_search_field),this._getSuggestDisabledPredicates()},destroy:function(){this._dynamicPredicateSetType=null,this._dynamicPredicateSetKind=null,this._dynamicExtPredicateSetType=null,this._otherDataSources=null,this._dataSetsForSource=null,this._dataSetsForType=null,this._dataSetsForExtension=null,this._adv_search_field=null,this._criteriaData=null,this._currentDataSource=null,this.BASIC_PREDICATES=null,this.BASIC_PREDICATES_leaf=null,this._resources=null,this._service=null,this._uniqueDataSource=null,this._fieldsToSet=null,this._TypesListToSet=null,this._incontextFixedPredicates=null,this._suggestDisabledPredicates=null},setStatus:function(e){this._status=e},getStatus:function(){return this._status},addFilter:function(){},clearFilters:function(t){e.is(t)||(t="type+kind",this._dynamicPredicateSetType=[],this._dynamicPredicateSetKind=[],this._dynamicExtPredicateSetType=[]),-1<=t.indexOf("kind")&&(this._dynamicPredicateSetKind=[])},showSourceField:function(){var e=!0,t=this._InContextAdvancedSearch();return t&&!1===t.showSource&&(e=!1),e},getAndDisplayAdvancedSearch:function(){var e=arguments;if(this._isInContextSearch())this.getAndDisplayAdvancedSearchCusto.apply(this,arguments);else{var t=this;f.getCusto(t._resources.getActiveTenant()).then(function(){f.isCustoEnabled()&&(t._adv_search_field=s.options.search_settings.adv_search_field),t.getAndDisplayAdvancedSearchCusto.apply(t,e)})}},getAndDisplayAdvancedSearchCusto:function(t,i){var n=this,s=null,o=null,a=this.getOption("tagger_proxy"),r=[];this._incontextFixedPredicates=[];var c,u,g=this._resources.getActiveTenant(),p=function(i){var r;if(e.is(i,"array")){var l,c=[],d={dataSources:i},u=h.getValidDatasourcesWithConfiguration(d);e.is(u)&&(e.is(u.dataSourceNames,"array")&&(c=u.dataSourceNames),e.is(u.otherDataSourceServices,"array")&&(n._otherDataSources=u.otherDataSourceServices));for(var p=0;p<i.length;p++){var _=i[p];if(!0===_.status){var m=_.name;m!==f.getDefaultSelectedSource(g)||e.is(n._adv_search_field,"string")&&n._adv_search_field.length>0?e.is(n._adv_search_field,"string")&&n._adv_search_field.length>0&&(r="3dspace"):r=m}}c=n._filterIncontextSources(c),n._isInContextSearch()||(c=n._filterCustoExcludedSources(c,g)),e.is(n._adv_search_field,"string")&&n._adv_search_field.length>0&&f.getSelectedTypeSource(n._adv_search_field)&&(r=f.getSelectedTypeSource(n._adv_search_field),l=[n._adv_search_field]),o=n._prepareSourcePredicate(c,void 0,{selectedByDefault:r}),n._dataSetsForSource[g]=o,e.is(n)&&e.is(n._service)&&e.is(n._service,"string")&&(n._service=o),n.showSourceField()&&a.updateCriteria([o]),t&&a.displayCriteria(),1===o.options.datasets.items.length&&(r=o.options.datasets.items[0].value),r&&((s={internal:!0,value:[],typeSelectedByDefault:l}).sixw=n.CORE_BASIC_SOURCE,s.value[0]=r,setTimeout(function(){n.handleCriteriaChange(s),t&&a.displayCriteria()},500))}};(o=n._dataSetsForSource[g],e.is(o))?(n.showSourceField()&&r.push(o),f.isCustoEnabled()&&(this._adv_search_field?f.getSelectedTypeSource(this._adv_search_field)&&(c=f.getSelectedTypeSource(this._adv_search_field),u=[this._adv_search_field]):(c=f.getDefaultSelectedSource(g),u=f.getTypesSelectedByDefault(c)),c||e.is(this._dataSetsForSource)&&e.is(this._dataSetsForSource.options)&&e.is(this._dataSetsForSource.options.datasets)&&e.is(this._dataSetsForSource.options.datasets.items,"array")&&1===o.options.datasets.items.length&&(c=o.options.datasets.items[0].value),c&&(this._currentDataSource!==c&&(e.is(this._dataSetsForSource)&&e.is(this._dataSetsForSource.options)&&e.is(this._dataSetsForSource.options.datasets)&&e.is(this._dataSetsForSource.options.datasets.items)&&this._dataSetsForSource.options.datasets.items.length>1&&this._dataSetsForSource.options.datasets.items.forEach(function(e){e.value===c?e.predefined=!0:e.predefined=!1}),this.showSourceField()&&a.updateCriteria([this._dataSetsForSource])),(s={internal:!0,value:[],typeSelectedByDefault:u}).sixw=n.CORE_BASIC_SOURCE,s.value[0]=c,setTimeout(function(){n.handleCriteriaChange(s),t&&a.displayCriteria()},500)))):(o=this._prepareSourcePredicate([]),this._dataSetsForSource[g]=o,n.showSourceField()&&r.push(o),d.login({resources:n._resources,onComplete:p,onFailure:p}));r.push(t?this._prepareTypePredicates({typesList:[],options:i}):n._dataSetsForType),this._isExtensionAvailable()&&r.push(t?this._prepareSubTypePredicates({subTypesList:[]}):n._dataSetsForExtension),r=(r=(r=(r=(r=r.concat(this._getCoreBasicPredicates())).concat(this._getExtendedBasics())).concat(this._dynamicPredicateSetType)).concat(this._dynamicPredicateSetKind)).concat(this._dynamicExtPredicateSetType),this._fieldsToSet=r,a.setCriteria(r),!0===t&&a.displayCriteria();var _=this;!f.isCustoEnabled()&&e.is(i)&&e.is(i.adv_search_field)&&e.is(i.adv_search_field,"string")?((s={internal:!0,value:["3dspace"]}).sixw=this.CORE_BASIC_SOURCE,e.is(this._uniqueDataSource)&&(s.value=this._uniqueDataSource),setTimeout(function(){_.handleCriteriaChange(s),s.value=this._uniqueDataSource,t&&a.displayCriteria(),(s={internal:!0,value:[]}).sixw=_.CORE_BASIC_TYPE,s.value[0]="ds6wg:",s.value[0]=s.value[0].concat(_._adv_search_field),setTimeout(function(){_.handleCriteriaChange(s),t&&a.displayCriteria()},2e3)},1e3)):e.is(this._adv_search_field,"string")&&this._adv_search_field.length>0&&!f.isCustoEnabled()?((s={internal:!0,value:[]}).sixw=_.CORE_BASIC_TYPE,s.value[0]="ds6wg:",s.value[0]=s.value[0].concat(_._adv_search_field),setTimeout(function(){_.handleCriteriaChange(s),a.displayCriteria()},2e3)):t&&(!n._isInContextSearch()&&f.isCustoEnabled()||((s={internal:!0,value:["3dspace"]}).sixw=this.CORE_BASIC_SOURCE,e.is(_._dataSetsForSource)&&e.is(_._dataSetsForSource.options)&&e.is(_._dataSetsForSource.options.datasets)&&e.is(_._dataSetsForSource.options.datasets.items)&&_._dataSetsForSource.options.datasets.items.length<=1?((s={internal:!0,value:["3dspace"]}).sixw=this.CORE_BASIC_SOURCE,e.is(_._dataSetsForSource.options.datasets.items[0])&&e.is(_._dataSetsForSource.options.datasets.items[0].value)&&_._dataSetsForSource.options.datasets.items[0].value.length>0&&"3dspace"!==_._dataSetsForSource.options.datasets.items[0].value&&(s={value:[_._dataSetsForSource.options.datasets.items[0].value]}),s.sixw=this.CORE_BASIC_SOURCE,setTimeout(function(){(e.is(_._dataSetsForSource)&&e.is(_._dataSetsForSource.options)&&e.is(_._dataSetsForSource.options.datasets)&&e.is(_._dataSetsForSource.options.datasets.items)&&_._dataSetsForSource.options.datasets.items.length<=1||"3dspace"===_._dataSetsForSource.options.datasets.items[0].value)&&_.handleCriteriaChange(s),a.displayCriteria()},1e3)):setTimeout(function(){_.handleCriteriaChange(s),a.displayCriteria()},2e3))),t&&a.displayCriteria(),l.loadDictionary(),this._InContextAdvancedSearch()&&this._getIncontextCommonPredicates(function(e){_._incontextFixedPredicates=[],e.forEach(function(e){_._incontextFixedPredicates.push(e.sixw)}),a.updateCriteria(e)})},_isExtensionAvailable:function(){return a.isAVisiblePredicate("ds6w:kind")&&this.showInContextExtension()},getAndDisplayAdvancedSearchWithProxyFilterSettings:function(){var e=this;setTimeout(function(){e.getOption("tagger_proxy").displayCriteria()},100)},hideAdvancedSearchTab:function(){var e=this.getOption("tagger_proxy"),t=[];t.push(this._prepareSourcePredicate([],!0)),t.push(this._prepareTypePredicates({typesList:[],toAllowEdit:!0})),this._isExtensionAvailable()&&t.push(this._prepareSubTypePredicates({subTypesList:[],toAllowEdit:!0})),e.setCriteria(t),e.setCriteria([]),!0===e.getDisplayStatus()&&e.displayCriteria(!1)},_internalTypeSelection:function(t){var i=null,n=this._getAdvancedSearchSelection();if(n){var s=n.selection;if(s){var o=s["ds6w:type"];if(i={internal:!0,sixw:"ds6w:what/ds6w:type",value:[]},e.is(o,"array")&&o.length>0){i.value.push(o[0]),s.vpmextension&&(i.subTypesListSelected=s.vpmextension),this.handleCriteriaChange(i);for(let e=1;e<o.length;e++)i.value.push(o[e])}i.value.length>1&&this.handleCriteriaChange(i);var a=this.getOption("tagger_proxy");a.toggleDisplayAllCriteria&&!0===n.inContext&&a.toggleDisplayAllCriteria(!0)}}else if(!this._isInContextSearch()){var r=f.getTypesSelectedByDefault(t?t.source:null);if(t&&t.typeSelectedByDefault&&(r=t.typeSelectedByDefault),i={internal:!0,sixw:"ds6w:what/ds6w:type",value:[]},e.is(r,"array")&&r.length>0){i.value.push(r[0]);var l=f.getInterfacesSelectedByDefault(r[0]);i.subTypesListSelected=l,this.handleCriteriaChange(i);for(let e=1;e<r.length;e++)i.value.push(r[e])}i.value.length>1&&this.handleCriteriaChange(i)}},_internalSubtypeSelection:function(t){if(e.is(t,"array")&&1===t.length){var i={internal:!0,sixw:"void/vpmextension",value:t};this.handleCriteriaChange(i)}},handleCriteriaChange:function(t){this._criteriaData=t;var i=this,n=this.getOption("tagger_proxy"),s=i._resources.getActiveTenant();if(e.is(t)){var a=t.sixw.split("/").pop();if("ds6w:dataSource"===a){var r=t.value;if(UWA.is(r)&&UWA.is(r.length)&&r.length>0){var l;"other"!==r[0]&&(l=o.getVocabularyName(r[0])),this._currentDataSource=r[0];var g,p,v=[],S=this,w=i._InContextAdvancedSearch(),b=i._getAdvancedSearchSelection();if(!b||b.inContext&&!0===b.inContext||(w=b),w&&(g=w["ds6w:type"]),w&&w.selection&&t.internal&&(p=w.selection["ds6w:type"]),e.is(g,"array")){var C=o.getVocabularyClasses(l);if(C){var y=i.getIncontextTypeList(C);v=v.concat(i._prepareTypePredicates({typesList:y,typesListSelected:p})),n.updateCriteria(v)}else{var I=[];g.forEach(function(e){var t={value:e.uri.split(":")[1],source:[d.getServiceFromSource(r[0])]};I.push(t)}),u.getNlsOfPropertiesValuesBySource({"ds6w:type":I},{tenantId:s,lang:h.getLanguage(),TagURL6WId:u._6WTagURL,onComplete:function(e){var t=e["ds6w:type"],s=[];g.forEach(function(e){var i=e.uri.split(":")[1];s.push({uri:e.uri,nlsName:t[i]})}),s=i._sortByKey(s,"nlsName"),v=v.concat(i._prepareTypePredicates({typesList:s,typesListSelected:p})),n.updateCriteria(v)}})}}else if("other"===r[0])o.loadVocabularyClasses({vocabId:"other",rdfSources:i._otherDataSources},function(e){v=v.concat(i._prepareTypePredicates({typesList:e.classInfos,vocabId:l,typesListSelected:p})),i._TypesListToSet=v,n.updateCriteria(v)});else{var D={vocabId:l,source:r[0],tenantId:s};t.typeSelectedByDefault?D.typeSelectedByDefault=t.typeSelectedByDefault:t.internal||(D.typeSelectedByDefault=[]),D.onComplete=function(e){v=v.concat(e),i._TypesListToSet=v,n.updateCriteria(v),S._internalTypeSelection(D)},D.onFailure=function(){o.loadVocabularyClasses({vocabId:l},function(e){v=v.concat(i._prepareTypePredicates({typesList:e.classInfos,vocabId:l,typesListSelected:p})),i._TypesListToSet=v,n.updateCriteria(v),p&&S._internalTypeSelection(D)})},S._prepareTypePredicatesFromCusto(D)}}else{var T=[];if(e.is(i)&&e.is(i._service)&&null!==i._service){if(T=i._service,n.updateCriteria([T]),e.is(i._service.options)&&e.is(i._service.options.datasets)&&e.is(i._service.options.datasets.items)&&1===i._service.options.datasets.items.length){let e={value:[]};e.sixw=i.CORE_BASIC_SOURCE,e.value[0]=i._service.options.datasets.items[0].value,setTimeout(function(){i.handleCriteriaChange(e)},500)}}else T.push(this._prepareTypePredicates({typesList:[]})),n.updateCriteria(T);if(i._isExtensionAvailable()){var A=[];A.push(i._prepareSubTypePredicates({subTypesList:[]})),n.updateCriteria(A)}}var x=i._dynamicPredicateSetType;x=x.concat(i._dynamicPredicateSetKind).concat(i._dynamicExtPredicateSetType),n.removeCriteria(x),i.clearFilters("type+kind")}else if("ds6w:type"===a){let a=t.value;if(1===a.length){i._dynamicExtPredicateSetType=[];let r=i._getServiceName(i._currentDataSource);if(o.loadRelevantPredicates({className:a[0],serviceName:r},function(o){i._loadPLMDictionaryAndRun(function(){var r,l,c=i.getOption("collection");if(l=e.is(c)&&e.is(c._ctx_options)&&e.is(c._ctx_options.app_socket_id)&&"socket_id_#saved_search_edit#"===c._ctx_options.app_socket_id&&e.is(c._ctx_options.advanced_search),i._isInContextSearch()&&!l||(r=f.getPredicatePreferredPosition(a[0],s)),!i._isInContextSearch()||l){var d=f.getExcludedPredicatesForType(a[0],s);e.is(d)&&d.length&&(o.vocabularyPredicateInfo=o.vocabularyPredicateInfo.filter(function(e){return-1===d.indexOf(e.uri)}))}let u=i._prepareRelevantPredicates({dataPredicates:o.vocabularyPredicateInfo,pswitch:!1,type:a[0],internal:t.internal,preferredPosition:r,exclusiveTaxonomies:f.isExclusiveTaxonomies(s)});if(e.is(u,"array"))i._dynamicPredicateSetType=u,u=i._sortByKey(u,"dispValue");else{var h=u.preferredPredicates;u=u.relevantPredicates,u=i._sortByKey(u,"dispValue"),n.removeCriteria(i._getExtendedBasics()),i._dynamicPredicateSetType=h.concat(u),u=(h=h.concat(i._getExtendedBasics())).concat(u)}n.updateCriteria(u)})}),i._isExtensionAvailable()){a=t.value;var N={};N.tenantId=s,r=i._getServiceName(i._currentDataSource),N.currentDataSource=r,N.className=a[0],o.loadRelevantInterfaces(N,function(o){for(var a=[],r="",l=[],d=0;d<o.interfaces.length;d++)e.is(o.interfaces[d].automatic)&&"Yes"===o.interfaces[d].automatic||e.is(o.interfaces[d].Automatic)&&"Yes"===o.interfaces[d].Automatic?r=r.concat("ds6wg:",o.interfaces[d].name,","):l.push(o.interfaces[d]);var u,h=t.subTypesListSelected,g=l;i._InContextAdvancedSearch()?g=i.getIncontextSubtypeList(N.className,g):f.isCustoEnabled()||(g=c.getAdvancedSearchCustoInterfaceList(N.className,g)),i._isInContextSearch()||(t.internal&&(h=f.getInterfacesSelectedByDefault(N.className,s)),u=f.getInterfacePreferredPosition(N.className,s)),a.push(i._prepareSubTypePredicates({subTypesList:g,subTypesListSelected:h,preferredPosition:u,exclusiveTaxonomies:f.isExclusiveTaxonomies(s)})),n.updateCriteria(a),t.subTypesListSelected&&i._internalSubtypeSelection(t.subTypesListSelected)})}}else if(a.length>1)_._asyncCallToPredicatesWS(a).then(function(e){n.removeCriteria(i._dynamicPredicatesPreferred),n.removeCriteria(i._dynamicExtPredicateSetType),n.removeCriteria(i._dynamicPredicateSetType),i._clearExtensionList(),i._dynamicPredicateSetKind=[],i._dynamicPredicateSetType=[],i._loadPLMDictionaryAndRun(function(){e.classPredicates.forEach(function(e){var t;i._isInContextSearch()||(t=f.getExcludedPredicatesForType(e.className));let n=i._prepareRelevantPredicates({dataPredicates:e.vocabularyPredicateInfo,pswitch:!1,excludedPredicates:t,type:e.className});-1===e.className.indexOf("ds6wg:XP_")&&(i._dynamicPredicateSetType.length>0?i._dynamicPredicateSetType=i.intersect_safe(i._dynamicPredicateSetType,n):i._dynamicPredicateSetType=n)}),i._dynamicPredicateSetType=i._sortByKey(i._dynamicPredicateSetType,"dispValue"),n.updateCriteria(i._dynamicPredicateSetType)})},function(){m.log("promisePredicate fail !")});else if(0===a.length){var O=[];if(O=O.concat(i._dynamicPredicateSetType),i._isExtensionAvailable()){var P=[];P.push(this._prepareSubTypePredicates({subTypesList:[]})),n.updateCriteria(P),O=O.concat(i._dynamicPredicateSetKind)}n.removeCriteria(O.concat(i._dynamicExtPredicateSetType)),i._dynamicPredicateSetType=[],i._dynamicExtPredicateSetType=[],i.clearFilters("type+kind"),i._adv_search_field=null}}else if(a===i.CORE_BASIC_SUBTYPE){var E=t.value;let e=i._getServiceName(i._currentDataSource);1===E.length?o.loadRelevantPredicates({className:E[0],serviceName:e},function(e){i._loadPLMDictionaryAndRun(function(){for(var s=i._prepareRelevantPredicates({dataPredicates:e.vocabularyPredicateInfo,pswitch:!1,internal:t.internal}),o=s,a=0;a<o.length;a++)for(var r=0;r<i._dynamicPredicateSetType.length;r++)i._dynamicPredicateSetType[r].dispValue===o[a].dispValue&&o.splice(a>0?a--:0,1);i._dynamicPredicateSetKind=o,n.updateCriteria(s)})}):(n.removeCriteria(i._dynamicPredicateSetKind),i.clearFilters("kind"))}}},_clearExtensionList:function(){var e=this.getOption("tagger_proxy");if(this._isExtensionAvailable()){var t=[];t.push(this._prepareSubTypePredicates({subTypesList:[]})),e.updateCriteria(t),e.removeCriteria(this._dynamicPredicateSetKind)}},_sortByKey:function(e,t){return e.sort(function(e,i){var n=e[t],s=i[t];return n<s?-1:n>s?1:0})},_sortByKeyDesc:function(e,t){return e.sort(function(e,i){var n=e[t],s=i[t];return n>s?-1:n<s?1:0})},intersect_safe:function(t,i){for(var n=[],s=0,o=t.length;s<o;s++)for(var a=0,r=i.length;a<r;a++)if(e.is(t[s].sixw)&&t[s].sixw===i[a].sixw){n.push(t[s]);break}return n},handlePLMCriteriaChange:function(t){if(!e.is(t)||!e.is(t.PLMTitle))throw new Error("Invalid Arg in AdvSearchMgr.handlePLMCriteriaChange!");var i=this,n=this.getOption("tagger_proxy");o.loadPLMSuggestList(t.PLMTitle,function(e){var t=i._preparePLMParamData(e);n.updatePLMSuggestions(t)})},handleTypeSuggestListChange:function(t){var i=this.getOption("tagger_proxy");if(i){var n=s.getOption("SUGGEST_ON_ADVANCEDSEARCH"),a=this,r=s.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly"),l=t.suggestField;if((!e.is(r)||e.is(r)&&"None"!==r[l])&&n&&e.is(t)&&e.is(t.suggestField)&&e.is(t.suggestTitle)&&t.suggestTitle.length>2){if(!e.is(t))throw new Error("Invalid Arg in AdvSearchMgr.handlePLMCriteriaChange!");var c="";if(e.is(a._criteriaData)){var d=a._criteriaData.sixw.split("/").pop();if("ds6w:type"===d||"[vpmextension]"===d)if(e.is(a._criteriaData)&&e.is(a._criteriaData.value)&&1===a._criteriaData.value.length){if(0===a._criteriaData.value[0].indexOf("ds6wg:")||0===a._criteriaData.value[0].indexOf(a._currentDataSource)){let e=a._criteriaData.value[0].split(":").pop();if("3dspace"!==a._currentDataSource){var u="";u=u.concat(a._currentDataSource,":",e),c=c.concat("[ds6w:type]:",'"',u,'"')}else c="[ds6w:type]:("+e+")"}}else if(a._criteriaData.value.length>1){for(var p=0;p<a._criteriaData.value.length;p++)if(0===a._criteriaData.value[p].indexOf("ds6wg:")||0===a._criteriaData.value[0].indexOf(a._currentDataSource)){let e=a._criteriaData.value[p].split(":").pop();e="("+e+")",p!==a._criteriaData.value.length-1?c+="[ds6w:type]:"+e+" OR ":c+="[ds6w:type]:"+e}c="("+c+")"}}e.is(r)&&r.hasOwnProperty(l)?e.is(r[l],"string")&&0===r[l].indexOf("ds6wg:")?(l=r[l],c=c.length>0?c.concat(" AND [",l,"]:(*",t.suggestTitle,"*)"):c.concat("[",l,"]:(*",t.suggestTitle,"*)"),a._InContextAdvancedSearch()&&e.is(a._InContextPrecondition())&&a._InContextPrecondition().trim().length>0&&(c=c.concat(" AND ").concat(a._InContextPrecondition().trim()))):e.is(r[l])&&e.is(r[l].PQToUse,"string")&&e.is(r[l].attributeToRead,"string")&&(c="3dexp"+r[l].PQToUse+":(*"+t.suggestTitle+"*)",l=r[l].attributeToRead):(c=(a._currentDataSource,c.length>0?c.concat(" AND [",l,"]:(*",t.suggestTitle,"*)"):c.concat("[",l,"]:(*",t.suggestTitle,"*)")),a._InContextAdvancedSearch()&&e.is(a._InContextPrecondition())&&a._InContextPrecondition().trim().length>0&&(c=c.concat(" AND ").concat(a._InContextPrecondition().trim()))),c="("+c+")",c=g.manageWildcardAddtion(c);var _,f=new Date;_="3DSearch-"+h.getUserId()+"-"+s.getOption("fedsearch_query_label.feature_id.AdvancedSearchSuggestion")+"-"+f.getTime();var m=s.getOption("topbar_search_banned_list"),v=e.is(m)?m.types:[],S={additional_query:e.is(a._createBannedTypeQuery(v))?a._createBannedTypeQuery(v):""},w={},b=e.is(a._currentDataSource)?a._currentDataSource:"3dspace";let n=[];n="other"===a._currentDataSource?this._getOtherRDFDataSources():e.is(a._currentDataSource)?[a._currentDataSource]:a._getAvailableDataSources(),w[b]=S;var C={with_indexing_date:!0,with_nls:!1,query:c,refine:{},order_field:"relevance",order_by:"desc",specific_source_parameter:w,select_predicate:[l],label:_,source:n};"3dspace"!==a._currentDataSource?(C.with_indexing_date=!0,C.with_nls=!1):C.select_synthesis=[l],o.loadSearchSuggestList(C,function(e){var n=a._prepareSearchSuggestData(t,e);i.updateSuggestions(n)},function(){i.updateSuggestions({datasets:{items:[]},suggestField:t.suggestField})})}else i.updateSuggestions({datasets:{items:[]},suggestField:t.suggestField})}},_createBannedTypeQuery:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND NOT (flattenedtaxonomies:(";for(var n=0;n<t.length;n++)i+='"types/'+t[n]+'"',n<t.length-1&&(i+=" OR ");i+="))"}return i},_getAvailableDataSources:function(){var t=this._resources.getActiveTenant(),i=[];if(e.is(this._dataSetsForSource)){var n=this._dataSetsForSource[t];e.is(n)&&e.is(n.options)&&e.is(n.options.datasets)&&e.is(n.options.datasets.items)&&n.options.datasets.items.length>1&&n.options.datasets.items.forEach(function(t){e.is(t.value)&&i.push(t.value)})}return 0===i.length?["3dspace"]:i},_getOtherRDFDataSources:function(){var t=[],i=d.getAvailableSources(this._resources.getActiveTenant());if(e.is(s.getOption("RDFDataSources"))){var n=Object.keys(s.getOption("RDFDataSources"));e.is(n,"array")&&n.length>0&&(i=i.filter(function(e){return-1<n.indexOf(e.name)&&!0===e.status})).forEach(function(e){t.push(e.name)})}return t},_prepareSearchSuggestData:function(t,i){var n=[],o={suggestField:t.suggestField,datasets:{name:t.suggestField,items:n}},a=s.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly"),r=t.suggestField;if(e.is(i)&&e.is(i.facets)&&i.facets.length>0){for(var l=i.facets,c=[],d=0;d<l.length;d++){var u=l[d];e.is(u.sixw)&&u.sixw.indexOf(t.suggestField)>=0&&c.push(u)}var h=this._sortByKeyDesc(c,"count");let s=[],o=h.length>9?10:h.length;for(let e=0;e<o;e++){let t=h[e],i=t.dispValue||t.object;if(-1===s.indexOf(i)){s.push(i);let e={value:t.object||t.dispValue,label:i,type:t.type};n.push(e)}}}if(e.is(i)&&e.is(i.results)&&i.results.length>0){let s=i.results.length>9?10:i.results.length,o=[];for(let l=0;l<s;l++){let s=i.results[l],c="",d="";for(var g=0;g<s.attributes.length;g++){var p=s.attributes[g];if("internal"!==p.format&&("attribute"===p.format&&(e.is(a)&&a.hasOwnProperty(t.suggestField)&&(e.is(a[r],"string")&&0===a[r].indexOf("ds6wg:")?r=a[r]:e.is(a[r])&&e.is(a[r].PQToUse,"string")&&e.is(a[r].attributeToRead,"string")&&(r=a[r].attributeToRead)),r===p.name&&(d=p.value,c=p.dispValue,-1===o.indexOf(d)&&-1===o.indexOf(c))))){e.is(d)?o.push(d):o.push(c);let t={value:p.value||p.dispValue,label:p.dispValue||p.value,type:p.type};n.push(t)}}}}return o},_preparePLMParamData:function(t){var i=[],n=!1,o={name:t.plmtitle,items:i,hasMore:n},a=h.getLanguage(),r=s.getOption("PLMParamNLS");if(e.is(t)&&e.is(t.info)&&t.info.length>0){var l=t.info.length;l>100&&(n=!0);for(var c=0;c<l;c++){for(var d,u,g,p,_=t.info[c],f=null,m=0;m<_.attributes.length;m++){var v=_.attributes[m];if("internal"!==v.format)if("attribute"===v.format&&"plmparam.title"===v.name)f=v.value;else if(e.is(r,"object")&&e.is(r[a],"string")&&"attribute"===v.format&&v.name===r[a])d=v.value;else if("attribute"===v.format&&"plmparam.itf"===v.name){var S=v.value.substring(0,v.value.length-9);g=v.value,e.is(S)&&(u="String"===S?"string":"Real"===S?"double":"Integer"===S?"integer":"Boolean"===S?"boolean":"double")}else"attribute"===v.format&&"plmparam.displayunit"===v.name&&(p=v.value)}var w={};w=null==p?{value:d||f,subLabel:g,type:u,title:f}:{value:d||f,subLabel:g,type:u,unit:p,title:f},i.push(w)}}return o},_getSuggestDisabledPredicates:function(){var t=s.getOption("NLSMapping_3DSearch_Suggest_TACTICALOnly");for(var i in t)e.is(t[i],"string")&&"none"===t[i].toLowerCase()&&this._suggestDisabledPredicates.push(i)},convertPLMParamUnits:function(t,i){if(e.is(t)&&e.is(t.plmparam)&&e.is(t.plmparam.double)){var n=t.plmparam.double,s={Data:[]},o=[];for(var a in n){var r=a,c=n[a].interface,d=c.substring(0,c.length-9),u=n[a].unit,h=l.getMKSNLSNameForDimension(d),g=n[a];if(delete g.unit,e.is(u)&&u!==l.getMKSNLSLableNameForDimension(d))for(var p in g)if("interface"!==p){var _=g[p],f=r.concat(".").concat(p);for(var m in _){var v={address:null,value:null},S={UnitFrom:u,UnitTo:h,Dimension:d,Values:_[m]};s.Data.push(S),v.address=f.concat(".").concat(m),v.value=_[m],o.push(v)}}}l.loadConvertedMKSValues(s,function(e){for(var n=t.plmparam.double,s=0;s<e.length;s++){var a=o[s].address,r=a.split("."),l=r[r.length-2],c=r[r.length-1];n[a.substring(0,a.length-c.length-l.length-2)][l][c]=parseFloat(e[s].ConvertedValues)}i&&i(t)})}},_prepareFTSFieldPredicate:function(){return{dispValue:r.get("adv_search.ftsfield"),sixw:"fts_value",type:"string",options:{showByDefault:!0}}},_prepareSourcePredicate:function(t,i,n){var s=[];if(e.is(t)){t=p.filterSourceList(t);for(var o=0;o<t.length;o++){var a={value:t[o],label:r.get("adv_search.source."+t[o])};!f.isCustoEnabled()&&(e.is(n)&&e.is(n.adv_search_field)&&e.is(n.adv_search_field,"string")||e.is(this._adv_search_field)&&e.is(this._adv_search_field,"string"))&&(a.predefined=!0),1===t.length?a.predefined=!0:n&&n.selectedByDefault===a.value&&(a.predefined=!0),s.push(a)}}var l={dispValue:r.get("adv_search.dataSource"),sixw:this.CORE_BASIC_SOURCE,type:i?"string":"enum",options:{multiSelect:!1,disabled:!(s.length>1)&&!i,placeholder:s.length?r.get("adv_search.dataSource.message"):r.get("adv_search.dataSource.noSourceMessage"),noResultsMessage:r.get("adv_search.dataSource.noSourceMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"Sources",items:s},showByDefault:!0}};return this._dataSetsForSource=l,l},_prepareTypePredicates:function(t){var i=t.typesList,n=t.toAllowEdit,s=t.typesListSelected||[],o=t.preferredPosition||{},a=t.excludedTypes||[],l=0,c=[],d=Object.keys(o).length,u=new Array(d);if(e.is(i)){var h={},g=!1;for(l=0;l<i.length;l++){var p=i[l].nlsName,_=i[l].name,f=i[l].uri;if(!(a.indexOf(f)>=0)){e.is(p)||(p=r.get("adv_search.rdfclass."+i[l].uri));var v={value:i[l].uri,label:p};(e.is(t)&&e.is(t.options)&&e.is(t.options.adv_search_field)&&e.is(t.options.adv_search_field,"string")||e.is(this._adv_search_field)&&e.is(this._adv_search_field,"string"))&&(!e.is(_)||this._adv_search_field!==_&&t.adv_search_field!==_||(v.predefined=!0)),s.indexOf(f)>=0&&(v.predefined=!0),e.is(o[f])?u.splice(o[f],1,v):t.exclusiveTaxonomies||c.push(v),e.is(h[p])?(h[p]=!0,g=!0):h[p]=!1}}if(!0===g)for(l=0;l<c.length;l++)!0===h[c[l].label]&&(m.warn("Duplicate NLS value (="+c[l].label+") for type "+c[l].value),c[l].label+=" ("+c[l].value+")")}c=u.concat(c);var S={dispValue:r.get("adv_search.type"),sixw:this.CORE_BASIC_TYPE,type:n?"string":"enum",multiSelect:!0,options:{multiSelect:!0,disabled:!c.length&&!n,placeholder:c.length?r.get("adv_search.type.message"):r.get("adv_search.type.noTypeMessage"),noResultsMessage:r.get("adv_search.type.noTypeMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"Types",items:c},showByDefault:!0}};return this._dataSetsForType=S,S},_prepareSubTypePredicates:function(t){var i=t.subTypesList,n=t.toAllowEdit,s=t.subTypesListSelected||[],o=t.preferredPosition||{},a=[],l=Object.keys(o).length,c=new Array(l);if(e.is(i))for(var d=0;d<i.length;d++){var u={value:i[d].name,label:i[d].nlsName};s.indexOf(u.value)>=0?u.predefined=!0:s.indexOf(i[d].name)>=0&&(u.predefined=!0),e.is(o[i[d].name])?c.splice(o[i[d].name],1,u):t.exclusiveTaxonomies||a.push(u)}a=c.concat(a);var h={dispValue:r.get("adv_search.subtype"),sixw:this.CORE_BASIC_SUBTYPE,type:n?"string":"enum",multiSelect:!0,options:{multiSelect:!0,disabled:!a.length&&!n,placeholder:a.length?r.get("adv_search.subtype.message"):r.get("adv_search.subtype.noSubTypeMessage"),noResultsMessage:r.get("adv_search.subtype.noSubTypeMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"SubTypes",items:a},showByDefault:!0}};return this._dataSetsForExtension=h,h},_prepareRelevantPredicates:function(t){var i=t.dataPredicates,n=t.pswitch,s=t.type,o=t.internal,r=t.skip_basics,c=t.preferredPosition?t.preferredPosition:{},d=h.isFUN072117Active(),u=function(t){var i="";if(t.dimension&&0!==t.dimension.trim().length){var n=v.getPreferenceUnitForDimension(t.dimension.trim());i=d&&e.is(n)?n.unitSymbol:d&&t.manipulationUnit&&t.manipulationUnit.trim().length>0?l.getUnitNLSForDimension(t.dimension,t.manipulationUnit.trim()):l.getMKSNLSForDimension(t.dimension)}return i},g=[],p=Object.keys(c).length,_=new Array(p);if(e.is(i)){i=this.getIncontextPredicateList(s,i);for(var f=0;f<i.length;f++)if(e.is(i[f].uri)&&a.isAVisiblePredicate(i[f].uri)){var m=e.is(i[f].uri)?i[f].uri:i[f].lineage;if(!1===r||-1===this._incontextFixedPredicates.indexOf(m)&&-1===this.BASIC_PREDICATES.indexOf(m)&&-1===this.BASIC_PREDICATES_leaf.indexOf(m)){var S;if(i[f].rangeValues&&(e.is(i[f].range)&&e.is(i[f].range.dataTypes)||e.is(i[f].type))&&("string"===h._getPredicateTypeFromDataType(i[f])||"boolean"===h._getPredicateTypeFromDataType(i[f])))S=this._prepareRangePredicate(i[f],!1!==i[f].showByDefault&&n,o);else{S={dispValue:i[f].nlsName,sixw:e.is(i[f].uri)?i[f].uri:i[f].lineage,type:h._getPredicateTypeFromDataType(i[f]),options:{showByDefault:!1!==i[f].showByDefault&&n},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf(i[f].uri)};let t=u(i[f]);if(e.is(t,"string")&&t.length>0&&(S.unit=t),o){var w=this._getIncontextSelectedPredicateValue(S.sixw);w&&("string"===S.type?S.options.defaultValue=w:S.options.defaultValue=w[0])}}e.is(c[S.sixw])?(S.options.showByDefault=!0,_.splice(c[S.sixw],1,S)):g.push(S)}}}for(var b=_.length-1;b>=0;b--)_[b]||_.splice(b,1);return _.length>0&&(g={preferredPredicates:_,relevantPredicates:g}),g},_prepareRangePredicate:function(t,i,n){var s=[],o=this._getIncontextSelectedPredicateValue(t.uri);return t&&t.rangeValues&&t.rangeValues.literalInfo&&t.rangeValues.literalInfo.forEach(function(t){if("0"===t.value&&"0"===t.nlsValue||e.is(t.value)&&t.value.trim().length<1);else{var i={value:"enum|"+t.value,label:t.nlsValue};n&&o&&o.indexOf(i.value)>=0&&(i.predefined=!0),s.push(i)}}),{dispValue:t.nlsName,sixw:e.is(t.uri)?t.uri:t.lineage,type:"string",options:{disabled:!1,multiSelect:!0,datasets:{name:"ranges",items:s},onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,showByDefault:i}}},_getCoreBasicPredicates:function(){var t,i,n=[];if(a.isAVisiblePredicate("ds6w:label")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:label",showByDefault:!0})).available){var s={dispValue:r.get("adv_search.label"),sixw:this.CORE_BASIC_LABEL,type:"string",options:{showByDefault:i.showByDefault},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:label")};t=this._getIncontextSelectedPredicateValue("ds6w:label"),e.is(t,"array")&&t.length>0&&(s.options.defaultValue=t),n.push(s)}if(a.isAVisiblePredicate("ds6w:identifier")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:identifier",showByDefault:!0})).available){var o={dispValue:r.get("adv_search.identifier"),sixw:this.CORE_BASIC_IDENTIFIER,type:"string",options:{showByDefault:i.showByDefault},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:identifier")};t=this._getIncontextSelectedPredicateValue("ds6w:identifier"),e.is(t,"array")&&t.length>0&&(o.options.defaultValue=t),n.push(o)}if(a.isAVisiblePredicate("ds6w:modified")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:modified",showByDefault:!0})).available){var l={dispValue:r.get("adv_search.modified"),sixw:this.CORE_BASIC_MODIFIED,type:"date",options:{showByDefault:i.showByDefault}};t=this._getIncontextSelectedPredicateValue("ds6w:modified"),e.is(t,"array")&&t.length>0&&(l.options.defaultValue=t[0]),n.push(l)}return n},_getExtendedBasics:function(){var t,i,n=[];if(a.isAVisiblePredicate("ds6w:description")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:description",showByDefault:!1})).available){var s={dispValue:r.get("adv_search.description"),sixw:this.EXT_BASIC_DESCRIPTION,type:"string",options:{showByDefault:i.showByDefault},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:description")};t=this._getIncontextSelectedPredicateValue("ds6w:description"),e.is(t,"array")&&t.length>0&&(s.options.defaultValue=t),n.push(s)}if(a.isAVisiblePredicate("ds6w:responsible")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:responsible",showByDefault:!1})).available){var o={dispValue:r.get("adv_search.responsible"),sixw:this.EXT_BASIC_RESPONSIBLE,type:"string",options:{showByDefault:i.showByDefault},allowSuggestions:-1===this._suggestDisabledPredicates.indexOf("ds6w:responsible")};t=this._getIncontextSelectedPredicateValue("ds6w:responsible"),e.is(t,"array")&&t.length>0&&(o.options.defaultValue=t),n.push(o)}if(a.isAVisiblePredicate("ds6w:created")&&(i=this._isIncontextBasicAvailable({uri:"ds6w:created",showByDefault:!1})).available){var l={dispValue:r.get("adv_search.created"),sixw:this.EXT_BASIC_CREATED,type:"date",options:{showByDefault:i.showByDefault}};t=this._getIncontextSelectedPredicateValue("ds6w:created"),e.is(t,"array")&&t.length>0&&(l.options.defaultValue=t[0]),n.push(l)}return n},_getIncontextCommonPredicates:function(t){var i,n,s=this,a=this._InContextAdvancedSearch();if(a&&(i=a.common_predicates,n=a["ds6w:type"]),e.is(i,"array")&&i.length>0)if(i[0].type){let e=s._prepareRelevantPredicates({dataPredicates:i,pswitch:!0,skip_basics:!1});t(e)}else if(e.is(n,"array")&&n.length>0){var r={};i.forEach(function(e){r[e.uri]=e});var l=n[0].uri;o.loadRelevantPredicates({className:l},function(e){s._loadPLMDictionaryAndRun(function(){var n={};e.vocabularyPredicateInfo.forEach(function(e){r[e.uri]&&(n[e.uri]=e,n[e.uri].showByDefault=r[e.uri].showByDefault)});var o=[];i.forEach(function(e){n[e.uri]&&o.push(n[e.uri])});let a=s._prepareRelevantPredicates({dataPredicates:o,pswitch:!0,skip_basics:!1});t(a)})})}},_loadPLMDictionaryAndRun:function(e){l.loadDictionary().then(function(){e.call()})},_filterIncontextSources:function(e){var t=this.getOption("collection");if(t){var i=t._ctx_options;if(i){var n=i.source;n&&(e=e.filter(function(e){return n.indexOf(e)>=0}))}}return e},_isInContextSearch:function(){var e=this.getOption("collection");if(e&&e._ctx_options)return!0},_isInContextSearchEdit:function(){var t=this.getOption("collection");if(e.is(t)&&e.is(t._ctx_options)&&e.is(t._ctx_options.title))return!0},_InContextAdvancedSearch:function(){var e=this.getOption("collection");if(e&&e._ctx_options)return e._ctx_options.advanced_search},_InContextPrecondition:function(){var e=this.getOption("collection");if(e&&e._ctx_options)return e._ctx_options.precond},showInContextExtension:function(){var e=this._InContextAdvancedSearch();return!e||!1!==e.showExtension},getIncontextTypeList:function(e){var t=this._InContextAdvancedSearch();if(t){var i=t["ds6w:type"];if(i)return e.filter(function(e){for(var t=0;t<i.length;t++)if(i[t].uri===e.uri)return!0})}return e},getIncontextSubtypeList:function(e,t){var i=this._InContextAdvancedSearch();if(i){var n,s=i["ds6w:type"];if(s&&e){for(var o=0;o<s.length;o++)if(s[o].uri===e){n=s[o].interfaces;break}if(n){var a={};return n.forEach(function(e){a[e.name]=e}),t.filter(function(e){if(a[e.name])return!0})}}}return t},getIncontextPredicateList:function(t,i){var n=this._InContextAdvancedSearch();if(n){var s,o=n["ds6w:type"];if(o&&t){for(let e=0;e<o.length;e++)o[e].uri===t&&(s=o[e].predicates);if(!s)return i;if(e.is(s,"array")){var a=[];return s.forEach(function(e){for(let t=0;t<i.length;t++)if(i[t].uri===e.uri){a.push(i[t]);break}}),a}}}return i},_isIncontextBasicAvailable:function(t){var i={available:!0,showByDefault:t.showByDefault},n=this._InContextAdvancedSearch();if(n){var s=n.basic_predicates;s&&(i.available=s.some(function(n){if(n.uri===t.uri)return e.is(n.showByDefault)&&(i.showByDefault=n.showByDefault),!0}))}return i},_getIncontextSelectedPredicateValue:function(e){var t=this._InContextAdvancedSearch();if(t&&t.selection)return t.selection[e]},_filterCustoExcludedSources:function(e,t){var i=f.getExcludedDataSources(t);return i&&(e=e.filter(function(e){return i.indexOf(e)<0})),e},_getAdvancedSearchSelection:function(){var t=null,i=this.getOption("collection");if(i)if(i._ctx_options&&i._ctx_options.advanced_search)(t={}).selection=i._ctx_options.advanced_search.selection,t.inContext=!0;else if(i.service_parameters&&i.service_parameters.localFilter){(t={}).selection={};var n=i.service_parameters.localFilter;for(var s in n){var o=s.split("/"),a=o[o.length-1];1===o.length&&(a=a.substring(5)),t.selection[a]||(t.selection[a]=[]),e.is(n[s],"array")&&n[s].forEach(function(e){t.selection[a].push(e.object)})}}return t},_getServiceName:function(t){return e.is(t,"string")?o.getVocabularyName(t):"3DSpace"},_prepareTypePredicatesFromCusto:function(t){var i=t.toAllowEdit,n=t.vocabId,a=t.source,l=t.typeSelectedByDefault,d=this,u=t.tenantId,h=0;if(e.is(n)){var g={vocabId:n};if(f.isCustoEnabled()&&!d._isInContextSearch())if(f.isExclusiveTaxonomies())f.getCustoTypeListNLSNames({onComplete:function(i){var s=[],o=f.getTypePreferredPosition(u,a),r=Object.keys(o),c=r.length;for(h=0;h<c;h++)s.push(void 0);for(h=0;h<c;h++){var g=r[h],p=o[g],_=i[g],m=g.split(":"),v="";e.is(_)&&e.is(_.nlsName)&&(v=_.nlsName);var S={abstract:!1,description:"",name:m.length>1?m[1]:m[0],nlsName:v,type:"Class",uri:g};s.splice(p,1,S)}let w=d._prepareTypePredicates({typesList:s,vocabId:n,typesListSelected:l||f.getTypesSelectedByDefault(a),preferredPosition:f.getTypePreferredPosition(u,a),exclusiveTaxonomies:f.isExclusiveTaxonomies()});e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(d,w)}});else{var p=d._getServiceName(t.source);o.loadVocabularyClasses({vocabId:p},function(i){let s=d._prepareTypePredicates({typesList:"3DDrive"===d._getServiceName(t.source)?[]:i.classInfos,vocabId:n,typesListSelected:l||f.getTypesSelectedByDefault(a),preferredPosition:f.getTypePreferredPosition(u,a),exclusiveTaxonomies:f.isExclusiveTaxonomies(),excludedTypes:f.getExcludedTypes(u,a)});e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(d,s)})}else g.onComplete=function(n){var o=[];if(e.is(n)){for(var a=s.getOption("SEARCH_INSTANCES"),l=0;l<n.length;l++){var c=n[l].nlsName,u=n[l].name,h=n[l].uri;e.is(a)&&!0===a&&(h=n[l].uri+":"+n[l].type),e.is(c)||(c=r.get("adv_search.rdfclass."+n[l].uri));var g={value:h,label:c};(e.is(t)&&e.is(t.options)&&e.is(t.options.adv_search_field)&&e.is(t.options.adv_search_field,"string")||e.is(d._adv_search_field)&&e.is(d._adv_search_field,"string"))&&(d._adv_search_field!==u&&t.adv_search_field!==u||(g.predefined=!0)),o.push(g)}var p={dispValue:r.get("adv_search.type"),sixw:d.CORE_BASIC_TYPE,type:i?"string":"enum",multiSelect:!0,options:{multiSelect:!0,disabled:!o.length&&!i,placeholder:o.length?r.get("adv_search.type.message"):r.get("adv_search.type.noTypeMessage"),noResultsMessage:r.get("adv_search.type.noTypeMessage"),onCriterionSelectEvent:!0,allowFreeInput:!1,showSuggestsOnFocus:!0,datasets:{name:"Types",items:o},showByDefault:!0}};e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(d,p),d._dataSetsForType=p}},g.onFailure=function(){e.is(t)&&e.is(t.onFailure)&&e.is(t.onFailure,"function")&&t.onFailure.call(d)},c.getAdvancedSearchCustoTypeList(n,void 0,g)}return null}})}),define("DS/SNResultUX/models/SearchItemModel",["UWA/Core","UWA/Class/Model","DS/W3DXComponents/Collections/ActionsCollection","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ResultUX_customization","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/Logger"],function(e,t,i,n,s,o,a,r,l){"use strict";return t.extend({_isRecentSearch:!1,setup:function(t,n){let o=this;this.actions=new i([],{parent:this}),this.action_ids=[],e.is(t)&&(t.hasOwnProperty("session_object")&&(this.session_object=!0,delete t.session_object),t.hasOwnProperty("isRecentSearchResult")&&(this._isRecentSearch=t.isRecentSearchResult,delete t.isRecentSearchResult));let a=!0,r=null;e.is(this.collection)&&(!0===this.collection._isAHelper&&(a=!1),r=this.collection._ctx_options),!0===this.isAShowOnlyObject()&&(a=!1),a&&s.getAvailableActions({attributes:t},function(e){e.forEach(function(e){-1===o.action_ids.indexOf(e.id)&&(o.action_ids.push(e.id),o.actions.push(e))}),o._attributes.actions&&0!==o._attributes.actions.length||(o._attributes.actions=o.actions.pluck("title"))},{inCtxOptions:r}),this._computeSnippetInformation(),this._parent(t,n)},getFederatedSource:function(){return e.is(this.collection)?this.collection.search_ressources:null},get:function(e){return this._parent(n.getURIToUse(e))},set:function(t,i,s){let o;if(e.is(t,"object")){let e=Object.keys(t);o={};for(let i=0,s=e.length;i<s;i++)o[n.getURIToUse(e[i])]=t[e[i]];s=i||{}}else(o={})[n.getURIToUse(t)]=i,s=s||{};return this._parent(o,s)},getSourceID:function(){let t=this.get("sourceid_value");return e.is(t,"string")&&t.length>0?t=t.split(":")[0]:l.error("sourceid not found OR not in the expected format:",t),t},getServiceID:function(){return o.getServiceFromSource(this.getSourceID())},getPlatformID:function(){let t="OnPremise",i=this.get("sourceid_value");if(e.is(i,"string")&&i.length>0){let e=i.split(":");e.length>1&&(t=e[1])}else l.error("sourceid not found OR not in the expected format:",i);return t},getDisplayType:function(){return this.get("ds6w:type")},getDisplayName:function(){return this.get("ds6w:label_value")},getType:function(){return this.get("ds6w:type_value")},getColor:function(){return this.collection.getColor(this)},getContextId:function(){return e.is(this.collection)&&e.is(this.collection.getSNSkeleton())?this.collection.getSNSkeleton().getSecurityContext():null},isARecentSearchResult:function(){return this._isRecentSearch},isAShowOnlyObject:function(){let t=this.get("showonly");return!0===a.getOption("showOnlySupport")&&!(!e.is(t,"string")||"true"!==t)},IsAnInstance:function(){if(!0===a.getOption("SEARCH_INSTANCES",{tenant:this.getPlatformID()})){if("Instance"===this.get("ds6wg:isAnInstance_value"))return!0;if("3DSpace"===this.getServiceID()){var e="ds6wg:"+this.getType();return r.IsClassAnInstance(e)}}return!1},getSnippetInformation:function(){let t={classForHighlight:"highlightedSearchCriteria"},i=Object.keys(this._attributes);if(e.is(i,"array")){let n,s;for(let o=0,a=i.length;o<a;o++)if((n=i[o]).indexOf(":snippet_value")>-1){try{s="array"===UWA.typeOf(this._attributes[n])?JSON.stringify(s):JSON.parse(this._attributes[n])}catch(e){l.error("Snippet parsing error!",e,this._attributes[n]),s=null}e.is(s)&&(t[n.substring(0,n.indexOf(":snippet_value"))]=s)}}return t},_computeSnippetInformation:function(){let t,i=[],n=this.getSnippetInformation(),s=[];e.is(n,"object")&&(e.is(n["ds6w:description"])&&(s=s.concat(n["ds6w:description"].text)),e.is(n.ds6w)&&(s=s.concat(n.ds6w.text)));for(let n=0,o=s.length;n<o;n++)if(!0===s[n].highlighted||"true"===s[n].highlighted){if(t=s[n].content,e.is(t,"string")){let n=t.split(", ");if(e.is(n,"array")&&1<n.length)for(let e=0,t=n.length;e<t;e++)-1===i.indexOf(n[e])&&i.push(n[e])}-1===i.indexOf(t)&&i.push(t)}this.set("snippetAsStringArray",i)}})}),define("DS/SNResultUX/collections/SearchCollection",["UWA/Core","UWA/Class/Options","UWA/Class/Events","UWA/Event","UWA/Promise","DS/Utilities/Utils","DS/WebappsUtils/Performance","DS/WebAppsFoundations/Collections/PageableCollection","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/SNResultUX/models/SearchItemModel","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/FederatedSearch_parse","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/ServiceDelegationLoader","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchUtils","DS/WAFData/WAFData","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SNUnitConversion","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/utils/SearchServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchLogin","DS/SNResultUX/utils/ContentLocationServices","DS/Controls/TooltipModel","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNInfraUX/Logger","DS/SNInfraUX/RefineHelper/RefineHelper","DS/MessageBus/MessageBus","DS/PubSub/PubSub","DS/SNInfraUX/SNVocabAccess","text!DS/SNInfraUX/assets/SearchCollectionMappingPredicate.json","text!DS/SNInfraUX/assets/SearchView.json","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/DosThumbnailBatchHelper","DS/TagNavigator/simplified/utils/CriteriaUtils","DS/SNInfraUX/utils/SNUnitConversionHelper","DS/SNResultUX/utils/ResultColorizationHelper"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b,C,y,I,D,T,A,x,N,O,P,E,k,M,R,V,U,L,F,j,W,X,B){"use strict";var H=function(e){var t=e.lastIndexOf("/");return e=t>-1?e.slice(0,e.lastIndexOf("/")+1)+e.slice(e.lastIndexOf(".")+1):e.slice(e.lastIndexOf(".")+1)},G=r.extend(t,i,p,{uwaClassName:"DS/SNResultUX/collections/SearchCollection",name:"DS_SNResultUX_collections_SearchCollection",model:d,totalCount:-1,hits:0,snservices:"",search_ressources:null,service_parameters:null,_searchcom_socket:null,_search_in_progress:!1,_fedSearchLabel:"",_pcs_uuid:0,_ctx_options:null,_attrToRetrieve:[],_attrDefinition:null,_recentCollectionArray:null,_recentCollectionArrayFiltered:null,jetty_server_activated:!1,sessionResponse:null,sessionResponse_received:!1,_fedsearchResp:null,_fedsearchOptions:null,_predicateIntersection:null,_indexingDate:null,_snSkeleton:null,_treeDocument:null,_NLS_ds6wg:{},_policyNLS:{},_isResponsive:!0,_helperSubjectsTags:null,_helpertagValues:null,_CBOnComplete:null,_CBOnFailure:null,_failureView:!1,_modelsTab:[],_tagsTransformer:null,_isFirstProxySetTagsDone:!1,_update_security_contextTodo:!1,_searchViewSpec:null,featureId:null,defaultOptions:{mode:"data",state:{firstPage:0,lastPage:null,currentPage:0,pageSize:40,totalPages:null,totalRecords:null,sortKey:null,order:-1,tagsSet:0},queryParams:{currentPage:null,totalPages:null,totalRecords:null,pageSize:"nresults"}},_source:"",_required_predicates:["ds6w:modified","ds6w:created","ds6w:label","ds6w:identifier","ds6w:responsible","ds6w:type","ds6w:description","owner","ds6w:responsibleUid","ds6wg:filesize"],_setTagsPromise:null,_setTagsDone:!1,_interruptRequested:!1,_securityContext3DSpace:[],setup:function(t,i){E.groupCollapsed("SearchCollection.setup"),E.log("attributes:",t),E.log("options:",i),t&&t.feature&&(this.featureId=t.feature);if(this.setOptions(i),e.is(i.service)&&(this.log("Setup done from the skeleton => set service parameters"),this.setRequestCriteria(i.service,i.service_parameters),this.setSearchRessources(i.federated_source)),this._searchcom_socket=g.createSocket({socket_id:"search_collection_"+Math.floor(1e5*Math.random()+1)}),this._searchcom_socket.addListener("onSetSessionResponse",this.setSessionResponse.bind(this)),i.event&&i.event.onSetup&&i.event.onSetup.call(null,this),this.service_parameters&&!this.service_parameters.order_by||!e.is(this.service_parameters))if(!e.is(this.service_parameters)&&(this.service_parameters={}),e.is(f.getItem("searchSort"))){let e=f.getItem("searchSort");this.setGlobalOrder(e.order_field,e.order_by)}else if(u.getOption("default_sort")){var n=u.getOption("default_sort");e.is(n,"object")&&e.is(n.order_by,"string")&&e.is(n.order_field,"string")&&this.setGlobalOrder(n.order_field,n.order_by)}else u.getOption("apply_sort_on_modified_by_default")&&this.setGlobalOrder("ds6w:modified","desc");else if("3DSwym"===m.identifyClientInfo().identifier&&e.is(f.getItem("searchSort"))){this.service_parameters={};let e=f.getItem("searchSort");this.setGlobalOrder(e.order_field,e.order_by)}return this._searchViewSpec=JSON.parse(L),this._dosThumbnailBatchHelper=new j(this),this._colorizationHelper=new B,E.groupEnd(),this._parent(t,i)},onHelperCopy:function(e){this._dosThumbnailBatchHelper.copyFromHelper(e)},destroy:function(){E.groupCollapsed("SearchCollection.destroy"),this.isDestroyed=!0,e.is(this.timeoutId)&&clearTimeout(this.timeoutId),this._searchcom_socket&&(this._searchcom_socket.removeListener("onSetSessionResponse"),this._searchcom_socket.disconnect(),g.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null),this._snSkeleton=null,this._recentCollectionArray=null,this._recentCollectionArrayFiltered=null,this.search_ressources=null,this.service_parameters=null,this._ctx_options=null,this._attrToRetrieve=null,this._attrDefinition=null,this.sessionResponse=null,this._fedsearchResp=null,this._fedsearchOptions=null,this._predicateIntersection=null,this._snSkeleton=null,e.is(this._treeDocument)&&e.is(this._treeDocument.destroy,"function")&&(this._treeDocument.destroy(),this._treeDocument=null),this._NLS_ds6wg=null,this._helperSubjectsTags=null,this._helpertagValues=null,this._indexingDate=null,this._CBOnComplete=null,this._CBOnFailure=null,this.reset(),this._parent(),E.groupEnd()},_getRequiredPredicates:function(){return this._required_predicates},setTagsTransformer:function(e){this._tagsTransformer=e},_setTags:function(t,i){if(E.groupCollapsed("SearchCollection._setTags"),!0===this._isCategoryHelperCollection)return E.log("isCategoryHelperCollection: true"),void E.groupEnd();var n=this,s=0,o=0;if(V.setResources({resources:n.search_ressources}),e.is(this.options.tagger_proxy))if(n._setTagsDone=!0,E.log("Set the Tags on the tagger proxy"),this.options.tagger_proxy.latest_subjectsTags=t,this.options.tagger_proxy.latest_tagValues=i,u.getOption("activate_dictionary_NLS_computation"))if(e.is(i)){var a=e.clone(t),r=e.clone(i),l={},c=/\w+:\w+\.\w+/,d="",h=null,g=null,p=null,_=null,f=null,m=null;if(P.transformPredicateValuesWithMapping(r),e.is(r,"array")&&e.is(this._tagsTransformer))for(s=0,o=r.length;s<o;s++)if(this._tagsTransformer.transformFacets(r,s),e.is(r[s])&&e.is(r[s].sixw)&&e.is(r[s].object)&&(h=r[s].sixw.slice(r[s].sixw.lastIndexOf("/")+1,r[s].sixw.length),!e.is(r[s].dispValue,"string")||0===r[s].dispValue.length)){if(e.is(l[h])||(l[h]=[]),g=r[s].object,e.is(g,"array")){if(g.length>0)for(d=g[0],p=g.length,_=0;_<p;_++)m=g[_],e.is(g,"array")||"ds6w:hidden"===(f=m.split("&"))[0]&&f.length>1&&(g.splice(_,1),e.is(g,"array")&&1===g.length&&(r[s].object=d),p-=1),c.test(d)&&(e.is(d,"array")?d.forEach(function(e,t,i){i[t]=H(e)}):d=H(d)),d=this._tagsTransformer.prepareNlsPropertiesValueForServer(h,d),_<p-1&&(d+="/"+g[_+1])}else d=r[s].object,c.test(d)&&(d=d.slice(d.lastIndexOf(".")+1));var v={value:d},S=[];UWA.is(r[s].sources)&&(S.push(A.getServiceFromSource(r[s].sources[0])),v.source=S,UWA.is(l[h])||(l[h]=[]),l[h].push(v))}n.getNlsOfPropertiesValuesSearchTag(a,r,l)}else V.updateRootInPredicateLineage(i).then(function(){n.options.tagger_proxy.setTags(t,i,{count:n.totalCount})});else V.updateRootInPredicateLineage(i).then(function(){n.options.tagger_proxy.setTags(t,i,{count:n.totalCount})});else E.warn("Tagger proxy not defined");E.groupEnd()},setAllMyContent:function(e){this.allMyContent=e},_addSubjects:function(t){var i=this;e.is(this.options.tagger_proxy)?(E.log("addSubjects on the tagger proxy"),e.is(this._setTagsPromise)&&e.is(this._setTagsPromise.promise)&&e.is(i._tagsTransformer)?this._setTagsPromise.promise.then(function(){E.log("_setTagsPromise resolved. Calling addSubjects on the tagger proxy"),i._tagsTransformer.transformAddSubjectsToDataSourceFacets(t),i.options.tagger_proxy.addSubjects(t)}):E.warn("_setTagsPromise is null..")):E.log("Tagger proxy not defined")},_mergeOldAndNewTagValues:function(t,i,n){var s=[];if(e.is(n)&&e.is(n.allfilters)){var o=n.allfilters;for(var a in k.isSimplifiedTaggerFilters(o)&&(o=k.getAllFilters(o)),o)for(var r=0;r<t.length;r++){var l=t[r];l.sixw===a&&s.push(l)}}if(s=k.preMergeSimplifiedTagger(t,i,n.allfilters,s,W.getCategorizedPredicates()),e.is(i)||(i=[]),s.length>0){var c,d,u=!1;s.length>i.length?(d=s,c=i):(d=i,c=s,u=!0);for(var h=0;h<c.length;h++){var g=!1,p=c[h],_=p.count;p.count=0,p.pertinencyScore=0;var f=JSON.stringify(p);p.count=_;var m=!1,v=0;for(v=0;v<d.length;v++){var S=d[v],w=S.count;S.count=0,S.pertinencyScore=0;var b=JSON.stringify(S);if(S.count=w,b===f){g=!0,w===_&&(m=!0);break}}!1===g?d.push(c[h]):u||!g||m||(d[v]=c[h])}return d=k.postMergeSimplifiedTagger(n.allfilters,d)}return i=k.postMergeSimplifiedTagger(n.allfilters,i)},setIsAPQSearch:function(t){for(var i=/[\s\b]*3dexp(\w+):/g;;){var n=i.exec(t);if(!n)break;var s=n[1];if(S.isAPQAbbrevation(s)&&e.is(this.service_parameters)){this.service_parameters.isAPQSearch=!0;break}}},getPQSortOrder:function(t){var i,n="",s=/[\s\b]*3dexp(\w+):/g.exec(t);if(s){var o=s[1];S.isAPQAbbrevation(o)&&(n=S.getSortOrder(o));var a=null,r=null;if(e.is(n,"array")){if(1<n.length){for(var l in a=[],r=[],n){var c=n[l];for(var d in c){var u=d,h=c[d];a.push(h),r.push(u)}}i={sort_order_by:a,sort_order_field:r}}}else e.is(n,"object")&&(i={sort_order_by:a=String(Object.values(n)),sort_order_field:r=String(Object.keys(n))});return i}},fetch:function(t){e.is(m.trackerData)&&(m.trackerData.timeData.fetchTime=(new Date).getTime()),E.log("SearchCollection fetch"),t=t||{};var i;if(e.is(t.no_fetch)&&!0===t.no_fetch)return E.log("no_fetch options = true ==> No fetch done"),e.is(t.onComplete,"function")&&t.onComplete.call(this),[];if(t.fetchWithOptions)return void this._parent(t.fetchWithOptions);if(!e.is(this.snservices,"string")||""===this.snservices)return E.log("Service name not defined ==> No fetch done"),e.is(t.onComplete,"function")&&t.onComplete.call(this),[];if(this.pcs_uuid=a.now().toString(),a.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"OneSearch Query","uuid":"'+this.pcs_uuid+'","drilldown":"OneSearch Query '+this.pcs_uuid+'"}'),a.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fetch preparation","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),i='{"module":"DS/SNResultUX/collections/SearchCollection","name":"fetch preparation","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}',!e.is(this.search_ressources))return E.log("No search source defined. No fetch done."),a.mark(i),void(e.is(t.onComplete,"function")&&t.onComplete.call(this));var n=this.service_parameters,s=!1;if(n.refine&&k.isSimplifiedTaggerFilters(n.refine.allfilters)){n=e.clone(n);var o=k.convertToRefineAndUQL(n.refine.allfilters);n.refine.allfilters=o.refine||{},o.uql&&(n.query="("+n.query+") AND ("+o.uql+")",s=!0),o=k.convertToRefineAndUQL(n.refine.localfilters),n.refine.localfilters=o.refine||{}}let r=!1;var l=[];x.isContentLocationActive()&&(!this._tagsTransformer&&this._isAHelper||this._tagsTransformer&&!0===this._tagsTransformer.isTransientWidget()||this._isPinnedWidget())?r=x.addSourceSpecificParameterToFilterData(n):l.push("ds6w:dataSource"),!this._tagsTransformer||!0!==this._tagsTransformer.isTransientWidget()||e.is(this._snSkeleton)&&e.is(this._snSkeleton.getOption("addinMode"))||(n.searchInCriteria=null),!1===this._is3DSpaceSecurityContextDone&&(this._is3DSpaceSecurityContextDone=!0,this.init3DSpaceSecurityContext()),t=this.search_ressources.getFetchOptions({service_name:this.snservices,service_data:n,featureId:this.featureId,original_options:t,uqlAvailable:s,state:this.state,context_options:this._ctx_options,attributesToRetrieve:this.getAttributesToRetrieve(),source:this._getSearchSource(),select_exclude_synthesis:l,displayNamePredicates:this._getDisplayNamePredicates(),hasfilterToSourceQueryTransformed:r}),this._lastFetchOptions=t,e.is(this._searchcom_socket)&&e.is(this._searchcom_socket.dispatchEvent,"function")&&e.is(this.service_parameters,"object")&&this.service_parameters.originalSearchCriteria!==m.SearchTypeEnum.ADVANCED_SEARCH&&this.service_parameters.queryType!==m.SearchTypeEnum.FAVORITE_SEARCH&&!this._isCategoryHelperCollection&&this._searchcom_socket.dispatchEvent("Last_Tag_Filter",this.service_parameters.refine),this._fedSearchLabel=this.search_ressources.getFedSearchLabel(),this._search_in_progress=!0;var c=this;this.timeoutId=setTimeout(function(){c._search_in_progress=!1,c.timeoutId=null},15e3),a.mark(i),a.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fedsearch","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}');var d=t.onComplete,h=t.onFailure,g=function(e){e._dosThumbnailBatchHelper.updateThumbnails(),e.dispatchEvent("on_sync",e),d.apply(this,arguments)};if(m.isFUN072117Active()){var p=g;g=c.updateModelsWithPreferredUnits(p)}t.onComplete=function(t){var i=arguments;if(e.is(t)&&e.is(t.parsed_response)&&e.is(t.parsed_response.response_infos)){R.dispatch("errorManager:maximumResults",t.parsed_response.response_infos);var n=t.parsed_response.response_infos;e.is(n.estimated)&&!0===n.estimated&&e.is(n.nhits)?f.setItem("errorManager:limit",t.parsed_response.response_infos.nhits):f.setItem("errorManager:limit",void 0)}if(e.is(c.service_parameters)&&e.is(c.service_parameters.query)&&m.SearchTypeEnum.MY_RECENT_CONTENT===c.service_parameters.query)return c._recentCollectionArray=c.toArray(),c._recentCollectionArrayFiltered=null,c.state.lastPage=0,c.state.totalPage=1,c.state.pageSize=c.totalCount,1e3===c.totalCount&&c._snSkeleton._searchActions._displayAlert({message:I.replace(I.get("recent_too_many_results")),className:"warning"}),e.is(c._snSkeleton)&&e.is(c._snSkeleton.options)&&e.is(c._snSkeleton.options.observable,"object")&&e.is(c._snSkeleton.options.observable._originalSearchCriteria,"string")&&c.filterSearch({recent_filter:c._snSkeleton.options.observable.options.search_options.recent_filter}),g.apply(this,arguments);if(!u.getOption("activate_dictionary_NLS_computation"))return g.apply(this,arguments);var s=0;if(e.is(c._attrDefinition)||(E.error("Undefined _attrDefinition !"),s=500),!1===c.sessionResponse_received&&!0===u.getOption("search_web_in_win"))return g.apply(this,arguments);setTimeout(function(){c.getModelNLS(t,g,i)},s)},t.onFailure=function(){return h.apply(this,arguments)},this._addPrepareTaggerDataCallback(t),this._dosThumbnailBatchHelper.startFetch(),this._parent(t)},_ensureTaggerDataAndSetTags:function(){var e,t=this;e=function(){t._setTagsDone||t._setTags(t._helperSubjectsTags,t._helpertagValues)},t._taggerDataPromise&&t._taggerDataPromise.then(function(){e()})},_addPrepareTaggerDataCallback:function(t){var i=t.onComplete,n=this;"undefined"==typeof dscef&&n._isPinnedWidget()&&e.is(t.data)&&e.is(t.data.specific_source_parameter)&&e.is(t.data.specific_source_parameter["3dspace"])&&e.is(t.data.specific_source_parameter["3dspace"].option)&&delete t.data.specific_source_parameter["3dspace"].option.with_synthesis_ranged,t.onComplete=function(e,t,s){var o=arguments;n._ensureTaggerDataAndSetTags(),i.apply(n,o)}.bind(this)},fetchAndSetTags:function(){if(!0===this.options.fetchSynthesisSeparately){this._taggerDataPromise=this._prepareTaggerData(),this._ensureTaggerDataAndSetTags()}},_prepareTaggerData:function(t,i){var n=this;if(!(!0===this._synthesisFetchingCollection||this._isAHelper&&!0===this.options.fetchSynthesisSeparately))return new s(function(s,o){!function(t){if(!0===n.options.fetchSynthesisSeparately&&!1===n.service_parameters.with_synthesis){n.service_parameters.with_synthesis=!0;var i=e.clone(n._lastFetchOptions),s=JSON.parse(i.data);if("0"==s.start){var o=n.getTaggerProxy();o&&n._isFirstProxySetTagsDone&&o.unsetTags()}var a=new G(null,{event:{onSetup:function(t){t._synthesisFetchingCollection=!0,t.setSearchRessources(n.getSearchRessources());var i=e.clone(n.getRequestCriteria(),!0);i.service_params.with_synthesis=!0,t.setRequestCriteria(i.service_name,i.service_params),t.setSearchSource(n._getSearchSource())}}});s.label=s.label+"-synthesis",s.with_synthesis=!0,i.data=JSON.stringify(s),i.onComplete=function(e){n.results=e.results,n.parsed_response=e.parsed_response,n.parsed_session_response=e.parsed_session_response,t()},a.fetch({fetchWithOptions:i})}else t()}(function(){var o=n.results,a=n.parsed_response,r=n.parsed_session_response;if(o.length>0){var l=a.getTags(),c=l.tagsData,d={},h={},g=[],p=null;Object.keys(c).forEach(function(e){var t=e.split(":"),i=t[0];p=t.length>1?t[1]:void 0,g.push(i),d[i]||(d[i]=[]),Object.keys(c[e]).forEach(function(t){d[i].push({id:t,source:i,platform:p||"OnPremise"}),h[t]=c[e][t]})});var f=g.map(function(e){return A.getServiceFromSource(e)}),v={};_.loadServiceDelegations({services:f,platform:p||"OnPremise"}).then(function(){g.forEach(function(e,t,i){var n=d[e],s=m.getTaggerSubjectURI({subjects:n,source:e,service:f[t]});n.forEach(function(e){var t=s[e.id];t&&(v[t]=h[e.id])})});var t=l.summaryData;if(e.is(t)||e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&this.service_parameters.query===m.SearchTypeEnum.MY_RECENT_CONTENT||E.error('No "facets" property found in Federated Search Response !!!'),e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&this.service_parameters.query===m.SearchTypeEnum.MY_CONTENT&&e.is(t)&&(t=C.handleMyContentTags(t)),t=this._correctCountForHierarchicalTags(t),e.is(r)){var o=r.getTags().summaryData;if(e.is(t)&&0!==t.length){if(e.is(o)){var a=[];o.forEach(function(e){for(var i=!1,n=0;n<t.length;n++)if(t[n].sixw===e.sixw&&t[n].field===e.field&&t[n].object===e.object){t[n].count+=e.count,i=!0;break}i||a.push(e)}),a.forEach(function(e){t.push(e)})}}else t=o}let c=n.getTaggerProxy();if(e.is(n._isAHelper))n._helperSubjectsTags=v,n._helpertagValues=t;else if(e.is(c))if(u.getOption("search_web_in_win")||(n._isFirstProxySetTagsDone=!0),e.is(i)&&e.is(i.merge)&&!0===i.merge&&!0===n._isFirstProxySetTagsDone)n._addSubjects(v),n._helperSubjectsTags=v,n._helpertagValues=t;else{if(e.is(c.latest_subjectsTags)&&e.is(c.latest_tagValues)&&(v=e.extend(c.latest_subjectsTags,v),e.is(this.service_parameters)&&e.is(this.service_parameters.refineSearch)&&!0===this.service_parameters.refineSearch)){var p=c.latest_tagValues,_=c.getCurrentFilter();t=this._mergeOldAndNewTagValues(p,t,_)}n._helperSubjectsTags=v,n._helpertagValues=t}e.is(this.latest_tagValues)?n.options.tagValues=this.latest_tagValues:n.options.tagValues=l.summaryData,s()}.bind(n))}else{if(e.is(i.merge)&&!0===i.merge)E.log("No result found with merge");else if(E.log("No result found"),e.is(n.options.tagger_proxy)){var S=t.subjectsTags,w=t.tagValues;n._helperSubjectsTags=S,n._helpertagValues=w,n._setTags(n._helperSubjectsTags,n._helpertagValues)}s(),n._setTagsPromise.resolve()}})})},getModelNLS:function(t,i,n){for(var s=/\w+:\w+\.\w+/,o=t._models,a={},r="",l=0,c=o.length;l<c;l++)for(var d=o[l],u=d.pairs(),h=d.getServiceID(),g=0,p=u.length;g<p;g++)if(e.is(a[u[g][0]])||(a[u[g][0]]={}),r=u[g][1],e.is(r,"array")&&r.length>0)for(var _=0,f=r.length;_<f;_++){var m=r[_];if(e.is(m,"array")&&m.length>0)for(var v=0,S=m.length;v<S;v++){0===v&&(a[u[g][0]]=[]);var w={value:m[v],source:[h]};a[u[g][0]].push(w)}else s.test(u[g][1][_])&&(u[g][1][_]=u[g][1][_].slice(u[g][1][_].lastIndexOf(".")+1)),a[u[g][0]][u[g][1][_]]={value:"",source:[h]}}else e.is(r,"string")&&(s.test(u[g][1])&&(u[g][1]=u[g][1].slice(u[g][1].lastIndexOf(".")+1)),a[u[g][0]][u[g][1]]={value:"",source:[h]});for(var b={},C=Object.getOwnPropertyNames(a),y={"ds6w:label":!0,"ds6w:identifier":!0,"ds6w:description":!0,preview_url:!0,resourceid:!0,sourceid:!0,type_icon_url:!0,resourceid_tagger:!0,taxonomies:!0},I=0,D=C.length;I<D;I++){var T=C[I];if(e.is(a[C[I]+"_value"])&&!e.is(y[T])&&e.is(this._attrDefinition[C[I]])&&"date"!==this._attrDefinition[C[I]].type){var A=[],x=a[C[I]+"_value"];Array.isArray(x)?(x=x.filter(e=>null!=e),A.push(...x)):Object.getOwnPropertyNames(x).forEach(function(e,t){var i,n;n=x[i=e].source,UWA.is(n)&&A.push({value:i,source:n})}),b[T]=A}}this.getNlsOfPropertiesValuesSearch(t,i,n,b)},getFirstPageOfResults:function(e){var t=this;let i=this.getActiveTenant();t._isFirstProxySetTagsDone=!1,f.getItemPromise("optionMode",i).then(function(i){t._optionMode=i,A.login({resources:t.getSearchRessources(),onComplete:function(){t._dosThumbnailBatchHelper.isReady().then(function(){t.getFirstPage(e)})},onFailure:function(){t.getFirstPage(e)}})})},getFirstPage:function(t){if(e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&m.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query&&e.is(this._recentCollectionArray)&&(this._recentCollectionArray=null,this._recentCollectionArrayFiltered=null),this.initTreeDocument(),e.is(t)&&e.is(t.fetchAll)){var i={fetchAll:t.fetchAll};this._resetState(i)}else this._resetState();if(u.getOption("search_web_in_win")){this.sessionResponse=null,this.sessionResponse_received=!1;var n=e.is(u.getOption("tabbed_ui_support_level"));this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"sessionSearch",notif_parameters:n?JSON.stringify({tabID:this._snSkeleton.getOption("observable").getTabID(),searchParams:this.service_parameters}):this.service_parameters},"search_web_in_win")}return this._setTagsPromise=s.deferred(),this._parent(t)},parseResponseForStateUpdate:function(t,i,n){var s={};return"fed_search"===this.snservices?(e.is(t.infos)&&e.is(t.infos.nhits)&&(s.totalRecords=parseInt(t.infos.nhits)),s.totalPages=Math.ceil(s.totalRecords/n.pageSize),s.lastPage=s.totalPages-1):"getSavedSearches"===this.snservices&&(s.totalRecords=parseInt(t.searches.length),s.totalPages=1,s.lastPage=0),this._search_in_progress=!1,s},parseRecords:function(t,i){E.groupCollapsed("SearchCollection.parseRecords"),E.log("resp:",t),E.log("options:",i),(u.getOption("ODTLogs")||u.getOption("ODTLogs-FederatedSearchAnswer"))&&E.warn("ODTLogs-FederatedSearchAnswer:"+JSON.stringify(t));var n=null,s=this.getActiveTenant();e.is(s)&&e.is(t)&&e.is(t.infos)&&e.is(t.infos.sources)&&(A.updateServiceToSourceMapping(s,t.infos.sources),t.infos.sources.forEach(function(t){M.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"IndexTime",action:"Search",persDim:{pd1:t.name,pd2:e.is(t.error)?t.error.errorCode:""},persVal:{pv1:parseFloat(t.time)}}})})),u.getOption("search_web_in_win")?this.sessionResponse_received?(E.log("session_response is received, so parse the results together"),n=this.parseRecords2(t,i),this._fedsearchResp=null,this.sessionResponse=null):!0===this._isCategoryHelperCollection?n=this.parseRecords2(t,i):(E.log("session_response is not yet received, so we will wait for session to respond and then parse the results together"),this._fedsearchResp=t):n=this.parseRecords2(t,i),this._fedsearchOptions=i;var o="";if(e.is(this._parse_alert,"array")&&this._parse_alert.length>0)for(var a=0;a<this._parse_alert.length;a++)e.is(this._parse_alert[a].messageObj)&&e.is(this._parse_alert[a].messageObj.nlsErrorCode)&&(o+="<li>"+this._parse_alert[a].messageObj.nlsErrorCode+"</li>");var r="";return 0===(e.is(n)?n.length:-1)&&(r=I.replace(m.constructEmptyViewMsg(I.get("no_result")),{errorMessage:o})),e.is(this._snSkeleton)&&e.is(this._snSkeleton._searchActions)&&e.is(this._snSkeleton._searchActions.setEmptyViewMessage,"function")&&this._snSkeleton._searchActions.setEmptyViewMessage(r),E.groupEnd(),n},parseRecords2:function(t,i){if(E.groupCollapsed("SearchCollection.parseRecords2"),E.log("resp:",t),E.log("options:",i),e.is(i)&&e.is(i.from)&&E.log("Parsing records for Page Number :"+(i.from+1)),a.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"fedsearch","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),a.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"parseRecords","uuid":"'+this.pcs_uuid+'","status":"start","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),e.is(t.results))for(var s=0;s<t.results.length;s++)"undefined"==typeof dscef&&this._isPinnedWidget()?t.results[s].attributes.forEach(function(e,t,i){"real"===e.type&&i.splice(t,1)}):t.results[s].attributes.forEach(function(e,t,i){"real"===e.type&&e.value&&delete i[t]});this.setFailureView(!1);var o=null;if(this._parse_alert=[],"fed_search"===this.snservices||"fed_search_odt"===this.snservices){var r=!1;e.is(i.url,"string")&&i.url.indexOf("/recent")>0&&(r=!0);var l=this.getActiveTenant(),c=null,d={federated_response:t,isRecentSearch:r,tenant:l,optionMode:this._optionMode};if(c=new h(d),this._parse_alert=c.getUserLevelAlerts(this),this.state.next_start=c.response_infos?c.response_infos.next_start:null,this.totalCount=c.getMatches(),this.hits=c.getHits(),this._attrDefinition=c.getAttributesDefinition(),this._parse_alert.length>0&&(0===this.totalCount&&this.setFailureView(!0),!this._isAHelper)){var g={service:this.snservices,messages:this._parse_alert};this.dispatchEvent("failure_on_parse",g)}o=c.getResults(),this._dosThumbnailBatchHelper.batchUpdateDosThumbnailURLs(o),this._retrieveLastIndexingDate(c);var p=null;if(u.getOption("search_web_in_win")&&e.is(this.sessionResponse)){var _={federated_response:this.sessionResponse,tenant:l,optionMode:this._optionMode};p=new h(_);var f=0,v=p.getResults();!0===m.isODTMode()?v.forEach(function(e){++f,e.session_object=!0,o.unshift(e)}):e.is(v)&&e.is(o)&&(E.log("Parsing search_web_in_win sessionResults :",v),Array.prototype.pushUniqueSession=function(e){for(let t=0;t<e.length;t++){let i=e[t],n=i.resourceid,s=this.length,o=!0;for(let e=0;e<s;e++)if(n===this[e].resourceid){o=!1;break}!0===o&&(++f,i.session_object=!0,this.unshift(i),E.log("Parsing search_web_in_win session_result !====",f))}},o.pushUniqueSession(v)),this.totalCount+=f}this.parsed_response=c,this.parsed_session_response=p,this.results=o,this._taggerDataPromise=this._prepareTaggerData(t,i),o.length>0||n.dispatchEvent(document,"no_result_found")}else"getSavedSearches"===this.snservices&&(this.totalCount=t.searches.length,o=t.searches);return e.is(this.service_parameters)&&e.is(this.service_parameters.query)&&m.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query&&this.dispatchEvent("response_treated",{data:o,rawData:!0}),a.mark('{"module":"DS/SNResultUX/collections/SearchCollection","name":"parseRecords","uuid":"'+this.pcs_uuid+'","status":"end","drilldown_serie_id":"OneSearch Query '+this.pcs_uuid+'"}'),E.groupEnd(),o},_resetState:function(t){this.totalCount=-1,this.hits=0;var i=0;if(e.is(t)&&e.is(t.fetchAll)&&!0===e.is(t.fetchAll))i=u.getOption("max_selection_for_selectall",{tenant:this.getActiveTenant()});else{let e=u.getOption("results_perpage");i=e<40?40:e}e.is(i)&&"number"!==e.typeOf(i)&&(i=parseInt(i)),this.state={firstPage:0,lastPage:null,currentPage:0,pageSize:i,totalPages:null,totalRecords:null,sortKey:null,order:-1,tagsSet:0},this._attrDefinition=null,this._setTagsPromise=null,this._setTagsDone=!1,this._interruptRequested=!1},getFailureView:function(){return this._failureView},setFailureView:function(e){this._failureView=e},setSearchRessources:function(e){E.log("SearchCollection.setSearchRessources",e),this.search_ressources=e},getSearchRessources:function(){return this.search_ressources},getActiveTenant:function(){var t=null;return e.is(this.getSearchRessources())?e.is(this.getSearchRessources().getActiveTenant,"function")?t=this.getSearchRessources().getActiveTenant():E.error("SearchCollection.getActiveTenant getActiveTenant function on SearchRessources!"):E.error("SearchCollection.getActiveTenant No SearchRessources!"),e.is(t)||E.error("No active tenant!"),t},cleanScriptSyntax:function(e){return-1!==e.replace(/ /g,"").indexOf("<script")?e.replace(/</g,"&lt;").replace(/>/g,"&gt;"):e},setRequestCriteria:function(t,i,n){if(this.snservices=t,e.is(i)&&e.is(i.query,"string")){i.query===m.SearchTypeEnum.FAVORITE_SEARCH&&(i.originalSearchCriteria=I.get("my_fav_searches"),i.savedSearch=!0,i.search_name=I.get("my_fav_searches"),i.queryType=m.SearchTypeEnum.FAVORITE_SEARCH),this.service_parameters=i,!0===this.options.fetchSynthesisSeparately&&(this.service_parameters.with_synthesis=!1);var s=this.getPQSortOrder(this.service_parameters.query);e.is(s,"object")&&this.setGlobalOrder(s.sort_order_field,s.sort_order_by),e.is(n)&&!1!==n?this._isInContextMode=!0:this._isInContextMode=!1,this.setIsAPQSearch(this.service_parameters.query),this.service_parameters.query=this.cleanScriptSyntax(this.service_parameters.query)}this._attrToRetrieve=[]},getRequestCriteria:function(){return{service_name:this.snservices,service_params:this.service_parameters}},setTaggerProxy:function(e){this.options.tagger_proxy=e},getTaggerProxy:function(){return this.options.tagger_proxy},setGlobalOrder:function(e,t){this.service_parameters.order_by=t,this.service_parameters.order_field=e},setSessionResponse:function(t){if(E.log("SearchCollection setSessionResponse"),this.sessionResponse=t,this.sessionResponse_received=!0,this._search_in_progress)E.log("Fed search has NOT yet answered, so we will parse the session response when fed search response is received");else{E.log("Fed search has already answered, so we will parse the fed search response now together with session response");var i=null;if(this._fedsearchResp&&(i=this.parseRecords2(this._fedsearchResp,this._fedsearchOptions)),e.is(i)){E.log("consolidatedParseRecords = "+i.length);var n=this;i.forEach(function(e){n.unshift(e)}),this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions)}this._fedsearchResp=null,this.sessionResponse=null}},hasNextPage:function(){return(!e.is(this.service_parameters)||m.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query)&&this._parent()},setPageSize:function(e){this.state.pageSize=e},setAttributesToRetrieve:function(e){this._attrToRetrieve=e},getAttributesToRetrieve:function(t){var i=0,n=0;if(e.is(this._attrToRetrieve)&&0===this._attrToRetrieve.length||e.is(t)&&t.length>0){this._attrToRetrieve=[];var s=[];if(e.is(t)&&t.length>0)s=t;else if(e.is(this.service_parameters)){var o={isPQ:!!this.service_parameters.isAPQSearch,typeName:this.getPQ()},a=this.getActiveTenant(),r=b.getColumnCustomizationIdToUse(o,a);r.length>0&&(s=b.getColumnCustomizationDefinitionFromCustoId(r,a))}for(i=0,n=s.length;i<n;i++)if(e.is(s[i],"object")){var l=s[i].dataIndex;this._attrToRetrieve.push(l.slice(l.lastIndexOf("/")+1,l.length))}}var c=[];if(!e.is(t)){var d,u=f.getItem("DataGridColumnCusto"),h=[];if(e.is(u)&&e.is(u.activeView)){var g=u.activeView;e.is(u.views)&&(h=u.views);for(var p=h.length-1;p>=0;p--){var _=h[p];_.viewId===g&&(d=_.viewDefinition)}if(e.is(d))for(i=0,n=d.length;i<n;i++){var m=d[i];c.push(m.dataIndex)}}}var v=[];e.is(this._attrToRetrieve,"array")&&(v=v.concat(this._attrToRetrieve));var S=this._getRequiredPredicates();return e.is(S,"array")&&(v=v.concat(S)),e.is(c,"array")&&(v=v.concat(c)),v.filter(function(e,t,i){return t===i.indexOf(e)})},setSearchSource:function(e){this._source=e},_getSearchSource:function(){return this._source},setSNSkeleton:function(e){this._snSkeleton=e},getSNSkeleton:function(){return this._snSkeleton},getPQ:function(){if(!e.is(this.service_parameters)||!e.is(this.service_parameters.isAPQSearch)||!1===this.service_parameters.isAPQSearch)return null;var t,i,n,s=this.service_parameters.query,o=/3dexp((\w+):[^ $)]+)/g,a=o.exec(s);if(a){var r=a[1];for(t=S.getPQPrefix(S.isAPQSearch(r)),i=S.getPQName(t);a=o.exec(s);){r=a[1];var l=S.getPQPrefix(S.isAPQSearch(r));if(S.getPQName(l)!==i)return null}}if(e.is(i,"string")&&i.length>0){n=i;var c=S.getPQObjFromPQPrefix(t),d=S.getPQNLS();e.is(d,"object")&&e.is(c,"object")&&e.is(c.pqid,"string")&&c.pqid.length>0&&e.is(d[c.pqid+".Title"],"string")&&d[c.pqid+".Title"].length>0&&(n=d[c.pqid+".Title"])}return{pqName:i,pqUsed:t,pqNLS:n}},getIndexingDate:function(){return this._indexingDate},checkPQExpressionsForWildCardChars:function(){for(var e,t=this.service_parameters.query,i=/[\s\b]*\w+[\s]*:/g;null!==(e=i.exec(t));){var n=e[0].match(/\w+/g);if(null!==n){var s=n[0];if(0===s.indexOf("3dexp"))if(s=s.substring(5,s.length),S.isAPQAbbrevation([s]))if(t.substring(i.lastIndex).trim().match(/^(#all|(\*)+)($|\s)/))return!0}}return!1},filterSearch:function(t){if(!e.is(t))throw new Error("Bad options given to SearchCollection.filterSearch !");if(e.is(this._recentCollectionArray)){var i=this._recentCollectionArray.length,n=t.recent_filter;if(e.is(n)&&n!==m.SearchTypeEnum.MY_CONTENT&&n!==m.SearchTypeEnum.ADVANCED_SEARCH||(n=""),this.service_parameters.recent_filter=n,this.dispatchEvent("update_title",{originalSearchCriteria:n}),0>=this._recentCollectionArray.length)this.dispatchEvent("showAllMyRecent",{isVisible:!1});else{(n=(n=n.replace(/\*/g,"")).toLowerCase()).indexOf("flattenedtaxonomies:types/catmatreference")>=0&&(n="_matref_");if(this._recentCollectionArrayFiltered=null,n.length>0){var s=this._recentCollectionArray.filter(function(t){for(var i=t.values(),s=!1,o=0,a=i.length;o<a&&!s;o++)e.is(i[o],"string")&&i[o].toLowerCase().indexOf(n)>=0&&(s=!0);return s});if(i=s.length,0===s.length&&this._recentCollectionArray.length>0){var o=I.replace(I.get("recent_no_filtered_result"),{nbResult:""+this._recentCollectionArray.length,filterCriteria:t.recent_filter});e.is(this._snSkeleton)&&e.is(this._snSkeleton._searchActions)&&e.is(this._snSkeleton._searchActions.setEmptyViewMessage,"function")&&this._snSkeleton._searchActions.setEmptyViewMessage(o)}this.reset(s),this._recentCollectionArrayFiltered=s}else this.initTreeDocument(),this.reset(this._recentCollectionArray),n="*";this.state.totalRecords=i,this.state.pageSize=i,this.totalCount=i,i!==this._recentCollectionArray.length?this.dispatchEvent("showAllMyRecent",{isVisible:!0}):this.dispatchEvent("showAllMyRecent",{isVisible:!1}),this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("response_treated",{data:this._recentCollectionArray,rawData:!1}),this.service_parameters.query===m.SearchTypeEnum.MY_RECENT_CONTENT&&e.is(this._ctx_options)&&i>0&&C._displayAlert({message:I.get("IncontextRecentWarning"),className:"warning"})}}},sortCollection:function(t){if(m.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query)throw new Error("SearchCollection.sortCollection must not be called if not in my recent content context !");if(!e.is(t.order_field)||!e.is(t.order_by))throw new Error("Bad options given to SearchCollection.sortCollection !");if(!e.is(this._recentCollectionArray))throw new Error("No _recentCollectionArray in SearchCollection.sortCollection !");var i=t.order_field,n="asc"===t.order_by?1:-1,s=this._recentCollectionArray.comparator;let o=null===this._recentCollectionArrayFiltered?this._recentCollectionArray:this._recentCollectionArrayFiltered;o.comparator=function(e,t){var s=0;return e.get(i)<t.get(i)?s=-1*n:e.get(i)>t.get(i)&&(s=n),s},o.sort(),this.reset(o),this.dispatchEvent("onSync",this,this._fedsearchResp,this._fedsearchOptions),this.dispatchEvent("on_sync",this,this._fedsearchResp,this._fedsearchOptions),this._recentCollectionArray.comparator=s},getFedSearchLabel:function(){return this._fedSearchLabel},initTreeDocument:function(){return e.is(this._treeDocument)&&e.is(this._treeDocument.destroy,"function")&&(this._treeDocument.destroy(),this._treeDocument=null),this._treeDocument=new l({useAsyncPreExpand:!0,shouldAcceptDrag:function(){return!0},shouldAcceptDrop:function(){return!1}}),this.setFailureView(!1),e.is(this.service_parameters)&&m.SearchTypeEnum.MY_RECENT_CONTENT!==this.service_parameters.query&&(this._treeDocument._getTrueRoot().sortChildren=function(){}),this.dispatchEvent("onInitTreeDocument",this._treeDocument),this._treeDocument},getTreeDocument:function(){return this._treeDocument||this.initTreeDocument()},generateTreeModel:function(e){let t=this;setTimeout(function(){var i=D.getAllSelectClause(!0),n=function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t}(t._required_predicates.concat(i)),s=t.getNotLoadedPredicate(n);s.length>0&&O.getResourcesInfo(s.join(","),{tenantId:t.search_ressources.active_tenant,lang:m.getLanguage(),apiVersion:"R2019x",onComplete:function(e){e&&t.saveNLS_ds6wg(e),t.asyncUpdateModels_predicate()},onFailure:function(e){e&&t.saveNLS_ds6wg(e),t.asyncUpdateModels_predicate()}});t._asyncUpdateModels(),t.generateTreeModelAsync().then(function(){t.dispatchEvent("onInitTreeDocument_SelectFirstElt",t._treeDocument),!0===e&&t.dispatchEvent("onInitTreeDocumentAsyncCB")})},50)},getNotLoadedPredicate:function(t){let i=this,n=[],s=i.getSearchRessources();return e.is(s)&&e.is(i._NLS_ds6wg)?t.forEach(function(e){i._NLS_ds6wg[s.active_tenant+"/"+e]||n.push(e)}):(E.warn("SearchCollection.getNotLoadedPredicate, no SearchRessources"),n=t),n},saveNLS_ds6wg:function(e){var t=this,i=t.getSearchRessources();e.forEach(function(e){t._NLS_ds6wg[i.active_tenant+"/"+e.curi]=e})},asyncUpdateModels_predicate:function(){var t=this.getTreeDocument(),i=t.getRoots(),n=this,s={},o=0,a=u.getOption("snippet_unsupported_sources");t.prepareUpdate(),i.forEach(function(t){if(e.is(t)&&!e.is(t.nlsAlreadyComputed)){var i=n.getCollectiveViewOptions(t.options,s,n._isResponsive,o,a);t.updateOptions(i),t.nlsAlreadyComputed=!0}o++}),t.pushUpdate()},_treatCommunityTags:function(e){if("string"==typeof e)return(u.getOption("tagSeparatorsToTreat")||[]).forEach((t,i)=>{var n=new RegExp(t.re,"gi");e=e.replace(n,t.replacement)}),e=e.split("ds6wclassifier:")[0]},getCollectiveViewOptions:function(t,i,n,s,o){let a=null;!0===m.isODTMode()&&(a={}),n=n||this._isResponsive;var r=t.getServiceID&&t.getServiceID()||t.serviceID||"",l=t.getSourceID?t.getSourceID():t.sourceID,c=t.getType?t.getType():t.type,d=this.getSearchRessources(),h=(new Date).getTime();var g=this;i[r]||(i[r]=D.getViewSpecs(r,["label","subLabel","description","specific"]));var p=e.clone(i[r]);if(e.is(this._searchViewSpec.SearchView[r])&&e.is(this._searchViewSpec.SearchView[r].type)&&e.is(this._searchViewSpec.SearchView[r].type[c])&&(p.subLabel=this._searchViewSpec.SearchView[r].type[c]),!0===m.isSnippetAvailable(this.getActiveTenant())&&(e.is(o,"array")&&-1===o.indexOf(l)||!e.is(o))){var _="";e.is(t.grid["swym:message_text:snippet"])?_="swym:message_text:snippet":e.is(t.grid["ds6w:snippet"])&&(_="ds6w:snippet"),_.length>0&&t.grid[_].trim().length>0&&(p.description=[_])}var f=t.grid.toolTip;f="";var v=[];for(var S in p)v=v.concat(p[S]);var w=u.getOption("webUXTooltip");if(v.forEach(function(i){let n=i;if("ds6w:snippet"!==n&&"swym:message_text:snippet"!==n)T.getNLSValueForPredicate(i)===i?g._NLS_ds6wg[d.active_tenant+"/"+i]&&(n=g._NLS_ds6wg[d.active_tenant+"/"+i].label):n=T.getNLSValueForPredicate(i);else{let t=I.get("search_hit");e.is(t,"string")&&(n=t)}let s=e.is(t.withoutHtmlTag[i])?t.withoutHtmlTag[i]:"";if(s){e.is(a,"object")&&(a[i]=e.is(t.withoutHtmlTag[i+"_value"])?t.withoutHtmlTag[i+"_value"]:"",a[i+"-nls"]=s),f.length>0&&(f+=w?"<br>":"&#10;");let o=e.is(t.withoutHtmlTag[i])?t.withoutHtmlTag[i]:"";if("ds6w:snippet"==i&&(o=g._treatCommunityTags(o)),o.length>200&&(o=o.substring(0,200),o+="..."),"swym:message_text:snippet"===i){let e=o;if(e.length>2&&"["===e.charAt(0)){let t=e.indexOf("]");if(t>0){let i=e.slice(0,t+1);o=e=e.replace(i,"")}}}f=(f=(f+=n+": "+o).replace(//g,"")).replace(//g,"")}}),t.grid.toolTip=f,e.is(a)&&t.grid["ds6w:type"]){let e=g._generateAttributesFromODTSelector(a);t.grid["ds6w:type"]=t.grid["ds6w:type"].replace("ODTSELECTOR",e)}var b=function(i){var o=p[i],r="",l="",c="";if("subLabel"===i&&null!==g._tagsTransformer&&g._tagsTransformer.displaySourceInSearchView(o,t,g._NLS_ds6wg),o.forEach(function(o){if(l="",c="",void 0!==t.grid[o]&&t.withoutHtmlTag[o]){var u=o;if(T.getNLSValueForPredicate(o)===o?g._NLS_ds6wg[d.active_tenant+"/"+o]&&(u=g._NLS_ds6wg[d.active_tenant+"/"+o].label):u=T.getNLSValueForPredicate(o),"label"===i){let i="search_item_hyperlink",r=g._ctx_options,c=e.is(r),d=F.isAdvSearchRun(r);var p=g._snSkeleton?g._snSkeleton.getOption("addinMode"):void 0,_=e.is(p,"string")&&p.length>0;!c||d||_||(i="search_item_in_apps"),n?l="ds6w:label"===o||"dcterms:title"===o?g._templateSearchItemSpan(s,o,t.withoutHtmlTag[o],t.grid[o],i,a):g._templateSearchItemSpan(s,o,t.withoutHtmlTag[o],t.grid[o],"onlyDisplayInLargeTileView",a):"ds6w:label"===o&&(l=g._templateSearchItemSpan(s,o,t.withoutHtmlTag[o],t.grid[o],void 0,a))}else if("ds6wg:revision"!==o&&"ds6w:status"!==o&&"ds6w:community"!==o||(c='<span class="labelOnAttributeString">'+u+":</span>"),"ds6w:modified"===o){var f=t.withoutHtmlTag[o].replace(",","").split(" ");let i=o+"_value";var m=t.withoutHtmlTag[i],v=new Date(m).getTime();e.is(f,"array")&&0<f.length&&h-v<=864e5?(m=f.join(" "),f.length>3?m=f[f.length-1]:(f.splice(0,1),m=f.join(" "))):f.length>3?(f.pop(),m=f.join(" ")):m=f[0],l=g._templateSearchItemSpan(s,o,t.withoutHtmlTag[o],m,void 0,a)}else l=g._templateSearchItemSpan(s,o,t.withoutHtmlTag[o],t.grid[o],void 0,a);r.length>0&&(r+=r.length>0?" | ":""),l.length>0&&(r+=c+l)}}),o.indexOf("ds6w:identifier")<0&&"label"===i&&(r+=g._templateSearchItemSpan(s,"ds6w:identifier",t.withoutHtmlTag["ds6w:identifier"],void 0,"onlyDisplayInLargeTileView",a)),0===r.length&&o.length>0){var _=I.get("no_access");e.is(t)&&(e.is(t.isAShowOnlyObject,"function")&&t.isAShowOnlyObject()?r=_:void 0!==t.grid.showonly&&"true"===t.grid.showonly&&(r=_))}return u.getOption("webUXTooltip")?"<span>"+r+"</span>":'<span title="'+f+'">'+r+"</span>"},C={label:b("label"),subLabel:b("subLabel"),icons:[t.grid.type_icon_url],description:b("description"),contextualMenu:"active ctx menu",serviceID:r,sourceID:l,type:c,useAsyncPreExpand:!0};t.grid.preview_url_value&&(C.thumbnail=t.grid.preview_url_value);let y=e.is(t.getColor,"function")?t.getColor():void 0;return y&&(C.color=y),u.getOption("webUXTooltip")&&(C.customTooltip=t.grid.toolTip,C.customTooltip=new N({shortHelp:t.grid.toolTip,shortHelpImage:t.grid.preview_url,shortHelpImageDimension:{x:144,y:108}})),!0===n&&(C.multipleTitleLineNumber=!0),C},_generateAttributesFromODTSelector:function(t){let i="";if(e.is(t,"object")){let e=Object.getOwnPropertyNames(t);for(let n=0,s=e.length;n<s;n++)i+="data-"+e[n].replace(/:/g,"")+'="'+t[e[n]]+'" '}return i},_templateSearchItemSpan:function(t,i,n,s,o,a){let r='<span class="searchItemSpan'+(e.is(o,"string")?" "+o:"")+'" search-item-number="'+t+'" search-item-predicate="'+i+'" search-item-predicate-value="'+n+'" ';return"ds6w:type"===i&&e.is(a,"object")&&(r+=this._generateAttributesFromODTSelector(a)),r+=">"+(void 0!==s?s:"")+"</span>"},_checkAndBuildTooltipWithSearchHit:function(t){var i=[],n={IsHighlightExist:!1,SearchHitArray:i};if(!e.is(t)||!e.is(t.searchItemModel)||!e.is(t.snippetAttribute))return n;var s=t.searchItemModel,o=t.snippetAttribute,a=o+"_value",r=void 0;if(e.is(s)&&e.is(s.get,"function")?r=s.get(o+"_value"):e.is(s._attributes[a])&&(r=s._attributes[a]),e.is(r,"string")){var l=JSON.parse(r);if(e.is(l,"object")&&e.is(l.text,"array")&&l.text.length>0)for(var c=0,d=0;d<l.text.length;d++)e.is(l.text[d].highlighted)&&"true"===l.text[d].highlighted&&(n.IsHighlightExist=!0,void 0!==n&&e.is(l.text[d].content,"string")&&(c++,i.push(l.text[d].content),1===c?(n.SearchHit="",n.SearchHit+=l.text[d].content):n.SearchHit+=","+l.text[d].content))}return n},_getTooltipWithSearchHit:function(t){var i=this,n="",s={globalToolTipWithSearchHit:n},o=void 0;if(e.is(t)&&e.is(t.searchItemModel)&&(o=t.searchItemModel),e.is(o)){var a=u.getOption("select_snippets");if(e.is(a)&&e.is(a,"object")){var r=Object.keys(a).map(function(e){return a[e]});if(e.is(r)&&e.is(r,"array")&&r.length>0){var l=!1,c=!1;r.forEach(function(t){var s={searchItemModel:o,snippetAttribute:t},a=i._checkAndBuildTooltipWithSearchHit(s);if(e.is(a)&&e.is(a.IsHighlightExist)&&!0===a.IsHighlightExist&&(n=o.grid.toolTip,e.is(n,"string")&&(n.length>0&&!1===l&&(u.getOption("webUXTooltip")?n+="<br>":n+="&#10;"),e.is(a.SearchHit,"string")))){var r="";!1===l&&(r=I.get("search_hit"),n+=r+": ",l=!0),!0===c&&(n+=","),n+=a.SearchHit,c=!0,o.grid.toolTip=n}}),s.globalToolTipWithSearchHit=n}}}return s},generateTreeModelAsync:function(t,i){let n;if(n=void 0!==i?i:this._treeDocument||this.initTreeDocument(),!e.is(n))return void E.warn("!UWACore.is(Treedocument)");let o=this,a=t||this._models,r=n.getRoots().length,l=!0,d=m.isInTheSimpleSearch({tenant:this.getActiveTenant()}),h=0,g=0,p=0,_=0;if(!0!==d&&!1!==d||(l=!1),l=!0,a.length>r){this._dosThumbnailBatchHelper.startViewSync(),n.prepareUpdate();var f={},v=[];m.SearchTypeEnum.MY_RECENT_CONTENT===o.service_parameters.query&&o.service_parameters.recent_filter?"*"!==o.service_parameters.recent_filter&&v.push(o.service_parameters.recent_filter):!0===o.service_parameters.isAPQSearch?v.push(o.service_parameters.query.replace(/3dexp.*:/g,"")):e.is(o.service_parameters.search_criteria_to_display,"string")&&o.service_parameters.search_criteria_to_display.length>0?v.push(o.service_parameters.search_criteria_to_display):e.is(o.service_parameters.originalSearchCriteria,"string")&&o.service_parameters.originalSearchCriteria.length>0&&o.service_parameters.originalSearchCriteria.length<2e3?v.push(o.service_parameters.originalSearchCriteria):e.is(o.service_parameters.query,"string")&&o.service_parameters.query.length>0&&o.service_parameters.query.length<2e3&&v.push(o.service_parameters.query),e.is(o.service_parameters.searchInCriteria,"string")&&0<o.service_parameters.searchInCriteria.length&&(v.push(o.service_parameters.searchInCriteria),e.is(o.service_parameters.query,"string")&&0<o.service_parameters.query.length&&v.push(o.service_parameters.query));var S=[];v.forEach(function(e){S=S.concat(e.split(" "))}),this.updateSwymTypeIcon(a),this.extractAllMatchesFromSnippetInfos(a).forEach(function(e){S=S.concat(e.split(" "))}),!1===u.getOption("HighlightWithUserQuery")&&!0===m.isSnippetAvailable(this.getActiveTenant())&&(S=[]);var w=null;for(p=(v=S.filter(function(e){return"OR"!==e&&"AND"!==e})).length-1;p>=0;p--){var b=v[p],C=b.split(" OR ");if(b=C.join(""),C=b.split(" AND "),b=C.join(""),C=b.split("flattenedtaxonomies:"),b=C.join(""),(C=b.split('"')).length>1&&C.length%2==1){for(var y=0,D=C.length;y<D;y++)w=C[y],e.is(w,"string")&&(w=w.trim()),w.length>0&&"("!==w&&")"!==w&&v.push(w);v.splice(p,1)}}if(v.length>1){var T={};for(g=v.length,h=0;h<g;h++)w=v[h],e.is(w)&&0<(w=w.trim()).length&&(T[w=(w=w.toUpperCase()).replace(/\*/g,"")]=0);(v=Object.keys(T)).length>1&&v.sort(function(e,t){return t.length-e.length})}var A=[];for(p=0,_=v.length;p<_;p++){var x=v[p].replace(/\*/g,"");x=(x=m.escapeHtml(x)).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),A.push(new RegExp(x,"ig"))}!0===u.getOption("noHighlight")&&(A=[]);var N=new RegExp("","ig"),O=new RegExp("","ig"),P=u.getOption("select_snippets"),k=u.getOption("snippet_unsupported_sources");for(h=0;h<a.length-r;h++){var M=a[r+h],R=null;if(e.is(M)&&((R=M.clone()).collection=M.collection),e.is(R)){if(m.isFUN096612Active()&&this._addDisplayNameColumn(R),R.grid=e.clone(R._attributes),e.is(R.grid)){var V=Object.keys(R.grid);if(e.is(V,"array")){var U=0,L=0;for(U=0,L=V.length;U<L;U++)if(e.is(R.grid[V[U]],"array")&&R.grid[V[U]].length){let t=!1;if(e.is(R.grid[V[U].trim()+"_value"],"array")){let i=[];for(var F=R.grid[V[U].trim()+"_value"],j=0;j<F.length;j++)if(e.is(F[j],"array")){var W=F[j];let e="";var X,B=0;for(B=0,X=W.length;B<X;B++)0===B?e=W[B]:e+=">"+W[B];i.push(e)}else i.length<1?i=F[j]?[F[j].trim()]:[void 0]:i.push(F[j]?F[j].trim():void 0);R.grid[V[U]]=i.join(I.get("default_predicate_value_concat_link")),t=!0}t||(R.grid[V[U]]=R.grid[V[U]].join(I.get("default_predicate_value_concat_link")))}R.withoutHtmlTag=e.clone(R.grid);var H=null,G=null,z=null;for(U=0,L=V.length;U<L;U++){var q={predicateName:V[U],select_snippets:P},Q=o._getSnippetAttributeCorrespondingToPredicate(q);if(e.is(Q,"object")&&!0===Q.gotSnippetAttribute&&e.is(Q.snippetAttrName,"string")){var Z={searchItemModel:R,SnippetAttr:Q.snippetAttrName},J=o._getValueWithHighlightByConcatenationOfSnippet(Z);e.is(J)&&e.is(J.valueWithHighlight,"string")&&J.valueWithHighlight.length>0&&(R.grid[V[U]]=J.valueWithHighlight)}else if(!0===u.getOption("HighlightWithUserQuery")&&!0===m.isSnippetAvailable(this.getActiveTenant()))for(G=0,z=A.length;G<z;G++)H=R.grid[V[U]],e.is(H,"string")&&(H=o.highlightRegexInStringJustOnce(H,A[G])),R.grid[V[U]]=H;else if(V[U].lastIndexOf("_value")!==V[U].length-6&&V[U].indexOf(":")>-1||"snippet"===V[U]||"snippet_value"===V[U]){if(H=R.grid[V[U]],"snippet"===V[U]||"snippet_value"===V[U])H=(H=H.replace(//g,'<span class="highlightedSearchCriteria">')).replace(//g,"</span>");else if(e.is(H)){for(G=0,z=A.length;G<z;G++)H=H.replace(A[G],"$&");let e="";m.isODTMode()&&"ds6w:type"===V[U]&&(e="ODTSELECTOR"),H=(H=H.replace(N,'<span class="highlightedSearchCriteria" '+e+">")).replace(O,"</span>"),m.isODTMode()&&"ds6w:type"===V[U]&&H.indexOf("span")<0&&(H="<span "+e+">"+H+"</span>")}R.grid[V[U]]=H}}}}R.clickableTitle=l}if(e.is(R)&&e.is(R.isAShowOnlyObject,"function")&&R.isAShowOnlyObject()){var Y=this.getAttributesToRetrieve();if(Array.isArray(Y)&&Y.length>0)for(var K=0;K<Y.length;K++){var $=Y[K];if(!R.grid.hasOwnProperty($)){var ee=I.get("no_access");R.grid[$]='<span class="NoAccessSearchCriteria">'+ee+"</span>"}}}var te=o.getCollectiveViewOptions(R,f,!0,h,k);Object.assign(R,te);var ie=new c(R);n.addRoot(ie)}n.pushUpdate(),this._dosThumbnailBatchHelper.endViewSync(this)}return new s(function(e){e()})},_getDisplayNamePredicates:function(){var t=[];if(m.isFUN096612Active()&&e.is(this.service_parameters)){this.service_parameters.isAPQSearch,this.getPQ();var i=this.getPQ();if(e.is(i)){var n=b.getDisplayNameObject(i.pqName);e.is(n,"object")&&e.is(n.displayNamePredicates,"array")&&(t=n.displayNamePredicates)}}return t},_addDisplayNameColumn:function(t){var i=b.getDisplayNameCustoObject();if(e.is(i,"object")&&e.is(i.displayNamePredicates,"array")){var n,s=null,o=null,a=0,r=t._attributes;for(o=e.is(i.separator)?i.separator:",",a=0,n=i.displayNamePredicates.length;a<n;a++){var l=r[i.displayNamePredicates[a]];e.is(l)&&(e.is(s)&&e.is(o)&&(s+=o),e.is(s)?s+=l:s=l)}t.set("ds6wg:_displayName_",s)}},_getSnippetAttributeCorrespondingToPredicate:function(t){var i={snippetAttrName:"",gotSnippetAttribute:!1};if(!0===m.isSnippetAvailable(this.getActiveTenant())&&e.is(t,"object")){var n=t.predicateName,s=t.select_snippets;e.is(n,"string")&&(e.is(s,"object")||(s=u.getOption("select_snippets")),e.is(s,"object")&&s.hasOwnProperty(n)&&(i.snippetAttrName=s[n],i.gotSnippetAttribute=!0))}return i},highlightRegexInStringJustOnce:function(t,i){var n=t;if(e.is(t,"string")){var s=t.split(" ");s.forEach(function(e,t){e.indexOf("highlightedSearchCriteria")<0&&(s[t]=e.replace(i,'<span class="highlightedSearchCriteria">$&</span>'))}),n=s.join(" ")}return n},extractAllMatchesFromSnippetInfos:function(t){var i=[];return t.forEach(function(t){var n=t.get("snippet");e.is(n)&&n.split("").forEach(function(e){var t=e.split("");t.length>1&&i.push(t[0])})}),i},_getValueWithHighlightByConcatenationOfSnippet:function(t){var i=this,n={valueWithHighlight:""},s="";if(e.is(t)&&e.is(t.searchItemModel)&&e.is(t.SnippetAttr)){var o=t.SnippetAttr,a=t.searchItemModel;if(e.is(a)){var r=void 0;e.is(a)&&e.is(a.get,"function")?r=a.get(o+"_value"):e.is(a.grid[o])&&(r=a.grid[o]);let t="ds6w:snippet"==o;var l=function(n){if(e.is(n,"string")){var a=JSON.parse(n);if(e.is(a,"object")&&e.is(a.text,"array")&&a.text.length>0)for(var r=0;r<a.text.length;r++)if(e.is(a.text[r].content,"string")){var l=a.text[r].content;if(l.length>2&&0===r&&"swym:message_text:snippet"===o&&"["===l.charAt(0)){var c=l.indexOf("]");if(c>0){var d=l.slice(0,c+1);l=l.replace(d,"")}}if(t&&null!=a.text.find(e=>"true"===e.highlighted)&&"false"===a.text[r].highlighted){let e=!1;r<a.text.length-1&&!e&&"true"===a.text[r+1].highlighted&&l.length>=50?(l="..."+l.slice(-30),e=!0):!e&&l.length>=50&&(l="")}var u=m.escapeHtml(l);t&&(u=i._treatCommunityTags(u)),e.is(a.text[r].highlighted)&&"true"===a.text[r].highlighted?s+='<span class="highlightedSearchCriteria">'+u+"</span>":s+=u}else"cut"===a.text[r].type&&(s+=m.escapeHtml("..."))}};if(e.is(r))if(e.is(r,"string"))l(r);else if(e.is(r,"array"))for(var c=0;c<r.length;c++)l(r[c])}}return n.valueWithHighlight=s,n},_sanitizePredicates:function(t){var i=[];if(!0===m.isSnippetAvailable(this.getActiveTenant())){var n=u.getOption("select_snippets");e.is(n)&&e.is(n,"object")&&(i=Object.keys(n).map(function(e){return n[e]}))}var s={};if(e.is(t)){var o=Object.keys(t);if(o.length>0&&e.is(o,"array"))for(var a=0;a<o.length;a++)e.is(i,"array")&&-1===i.indexOf(o[a])&&(s[o[a]]=t[o[a]])}return s},getNlsOfPropertiesValuesSearchTag:function(t,i,n){E.groupCollapsed("SearchCollection.getNlsOfPropertiesValuesSearchTag"),E.log("->subjectsTagsCloned:",t),E.log("->tagValuesCloned:",i),E.log("->dataToComputeNlsAUWFormat:",n);var s=this;if(n=s._sanitizePredicates(n),!e.is(this.search_ressources))return void E.error("SearchCollection.getNlsOfPropertiesValuesSearchTag No search_ressources!");e.is(this._tagsTransformer)&&this._tagsTransformer.addSource(n,this.getActiveTenant()),E.log("Calling SearchDictionaryAccess.getNlsOfPropertiesValues"),E.log("->dataToComputeNlsAUWFormat:",n);let o=this.getActiveTenant();var a={tenantId:o,lang:m.getLanguage(),onComplete:function(n){E.log("<-onComplete response from SearchDictionaryAccess.getNlsOfPropertiesValues:"),E.log(n),e.is(s._policyNLS[o],"object")||(s._policyNLS[o]={});let a=n["ds6w:policy"];if(e.is(a,"object"))for(let t in a)e.is(t,"string")&&(s._policyNLS[o][t]=a[t]);var r=0,l=0,c=null,d=null,u=null,h=null,g=0,p=0;e.is(s._tagsTransformer)&&s._tagsTransformer.setNlsNameDetails(n);var _=/\w+:\w+\.\w+/;if(e.is(t)&&e.is(s._tagsTransformer)){var f=Object.getOwnPropertyNames(t);if(e.is(f,"array"))for(r=0,l=f.length;r<l;r++)for(var m=0,v=t[f[r]].length;m<v;m++)if(e.is(t[f[r]][m])&&e.is(t[f[r]][m].sixw)&&e.is(t[f[r]][m].object))if(c=t[f[r]][m].sixw.slice(t[f[r]][m].sixw.lastIndexOf("/")+1,t[f[r]][m].sixw.length),e.is(n)&&e.is(n[c])&&e.is(t[f[r]][m].object)){if(d=t[f[r]][m].object,e.is(d,"array")){if(d.length>0)for(u=d[0],h="",g=0,p=d.length;g<p;g++)u=s._tagsTransformer.prepareNlsPropertiesValueForServer(c,u),(h=n[c][u])!==u&&h||(h=d[g]),t[f[r]][m].dispValue[g]=h,g<p-1&&(u+="/"+d[g+1])}else if(t[f[r]][m].dispValue=n[c][t[f[r]][m].object],"ds6w:status"===c&&e.is(t[f[r]][m].dispValue)){let i=null;if(e.is(d,"string")&&(i=d.split(".")[0]),e.is(s._policyNLS[o][i])){let e=s._policyNLS[o][i];t[f[r]][m].dispValue+=" ("+e+")"}}}else E.log("Pb with "+c);if(e.is(i,"array")){var S={};for(r=0,l=i.length;r<l;r++)if(e.is(i[r]))if(c=i[r].sixw.slice(i[r].sixw.lastIndexOf("/")+1,i[r].sixw.length),e.is(n)&&e.is(n[c])&&e.is(i[r].object)){if(d=i[r].object,e.is(d,"array")){if(d.length>0){u=d[0],h="",i[r].dispValue=[];var w="";for(g=0,p=d.length;g<p;g++){if(_.test(u)){var b=u.lastIndexOf("/");u=b>-1?u.slice(0,u.lastIndexOf("/")+1)+u.slice(u.lastIndexOf(".")+1):u.slice(u.lastIndexOf(".")+1)}u=s._tagsTransformer.prepareNlsPropertiesValueForServer(c,u),h=n[c][u],e.is(h,"string")&&w&&h.startsWith(w)&&(h=h.substring(w.length)),h!==u&&h||(h=d[g]),i[r].dispValue[g]=h,g<p-1&&(w=u+"/",u+="/"+d[g+1])}}}else i[r].dispValue=n[c][i[r].object];"ds6w:status"===c&&e.is(i[r].dispValue)&&(e.is(S[i[r].dispValue])?S[i[r].dispValue].push({index:r,object:i[r].object}):S[i[r].dispValue]=[{index:r,object:i[r].object}])}else E.warn("Pb with "+c);for(var C=Object.getOwnPropertyNames(S),y=0,I=C.length;y<I;y++)for(var D=0,T=S[C[y]].length;D<T;D++){var A=S[C[y]][D].object,x=null;e.is(A,"string")?x=A.split("."):E.warn("ds6wStatus is not a string :",A),e.is(x,"array")&&x.length>1&&e.is(x[0],"string")&&e.is(s._policyNLS[o][x[0]])&&(A=s._policyNLS[o][x[0]]),i[S[C[y]][D].index].dispValue!==A&&(i[S[C[y]][D].index].dispValue+=" ("+A+")")}}s._setTagsPredicates(i),V.updateRootInPredicateLineage(i).then(function(){s.options.tagger_proxy.setTags(t,i,{count:s.totalCount}),s.dispatchEvent("onSetTags",s)}),e.is(s._setTagsPromise)&&(s._setTagsPromise.resolve(),s._isFirstProxySetTagsDone=!0,E.log("_setTagsPromise resolved. Nls computation for tags is completed.."))}E.groupEnd()},onFailure:function(){E.error("Failure calling DS/i3DXSNDictionaryAPI/3DXSearchDictionaryAccess.getNlsOfPropertiesValues !",arguments),s._setTagsPredicates(i),V.updateRootInPredicateLineage(i).then(function(){s.options.tagger_proxy.setTags(t,i,{count:s.totalCount})}),s._isFirstProxySetTagsDone=!0,e.is(s._setTagsPromise)&&(s._setTagsPromise.resolve(),E.log("_setTagsPromise resolved. Nls computation for tags is failed..")),E.groupEnd()}};E.log("->searchDictionaryAccessOptions:",a),O.getNlsOfPropertiesValuesBySource(n,a)},getNlsOfPropertiesValuesSearch:function(t,i,n,s){E.groupCollapsed("SearchCollection.getNlsOfPropertiesValuesSearch"),E.log("->resp:",t),E.log("->onCompleteOrig:",i),E.log("->goodArgsToReturn:",n),E.log("->dataToComputeNlsAUWFormat:",s);var o=this;let a=!0;s=o._sanitizePredicates(s);var r={tenantId:o.getActiveTenant(),lang:m.getLanguage(),onComplete:function(s){E.log("<-onComplete response from SearchDictionaryAccess.getNlsOfPropertiesValues:"),E.log(s);var o=t._models,r=Object.getOwnPropertyNames(s),l=/\w+:\w+\.\w+/,c="",d=null;let u=Object.keys(JSON.parse(U));for(var h=0,g=o.length;h<g;h++){for(var p=0,_=r.length;p<_;p++){var f=o[h]._attributes[r[p]],v=null;if(e.is(f,"array"))for(var S=0,w=f.length;S<w;S++){if(v=o[h]._attributes[r[p]+"_value"][S],c="",e.is(v,"array")){var b=[],C=0,y=0;for(C=0,y=(d=v).length;C<y;C++)0===C?v=d[C]:v+="/"+d[C],b.push(v);for(C=0,y=b.length;C<y;C++)C>0&&(c+="/"),c+=s[r[p]][b[C]]}else l.test(v)&&(v=v.slice(v.lastIndexOf(".")+1)),s[r[p]]&&(c=s[r[p]][v]);e.is(c,"string")?0!==c.indexOf("emxFramework.Range.")&&(o[h]._attributes[r[p]][S]=m.escapeHtml(c)):E.warn("Error, bad response from getNlsOfPropertiesValuesSearch ! (attr=",r[p],", value=",d,")")}else e.is(f,"string")&&(v=o[h]._attributes[r[p]+"_value"],l.test(v)&&(v=v.slice(v.lastIndexOf(".")+1)),s[r[p]]&&(c=s[r[p]][v]),e.is(c,"string")?0!==c.indexOf("emxFramework.Range.")&&(o[h].set(r[p],m.escapeHtml(c)),l.test(r[p])&&o[h].set(r[p]+"_value",m.escapeHtml(c))):E.warn("Error, bad response from getNlsOfPropertiesValuesSearch ! (attr=",r[p],", value=",v,")"))}if(o[h]._attributes&&o[h]._attributes.sourceid){let e=!1,t=0;for(;!e&&t<u.length;)o[h]._attributes.sourceid.startsWith(u[t])&&(e=!0),t++;if(e)for(let e in o[h]._attributes)"actions"!==e&&"implicit"!==e&&"implicit_value"!==e&&Array.isArray(o[h]._attributes[e])&&(o[h]._attributes[e]=o[h]._attributes[e].join(I.get("default_predicate_value_concat_link")))}}e.is(i,"function")&&e.is(n)&&i.apply(this,n),a=!1,E.groupEnd()},onFailure:function(){E.error("Failure when calling 3DXSearchDictionaryAccess.getNlsOfPropertiesValuesSearch => Unable to retrieve NLS !"),e.is(i,"function")&&e.is(n)&&i.apply(this,n),a=!1,E.groupEnd()}};u.getOption("search_web_in_win")&&setTimeout(function(){!0===a&&(e.is(o._snSkeleton)&&e.is(o._snSkeleton.getOption,"function")&&M.publish({channel:o._snSkeleton.getOption("widgetId"),topic:"beforeSearchReload",data:{}}),location.reload(!0))},16e3),E.log("Calling SearchDictionaryAccess.getNlsOfPropertiesValues"),E.log("->dataToComputeNlsAUWFormat:",s),E.log("->searchDictionaryAccessOptions:",r),O.getNlsOfPropertiesValuesBySource(s,r)},_setTagsPredicates:function(t){if(e.is(t,"array")&&e.is(this.options.tagger_proxy.setPredicates,"function")){var i;if(e.is(this._ctx_options)&&e.is(this._ctx_options.relevant_tags))i=e.clone(this._ctx_options.relevant_tags);else{var n=u.getOption("relevant_tags",{tenant:this.getActiveTenant()});i=e.clone(n),Object.keys(i).forEach(function(t){e.is(i[t],"object")&&i[t].weight<0&&(i[t].weight=0)})}for(var s=u.getOption("datesAsFreeInputOnly"),o="",a=u.getOption("alwaysEnableFreeInputInTagger"),r=0,l=t.length;r<l;r++)e.is(t[r])&&e.is(t[r].sixw)&&(o=m.getURIToUse(t[r].sixw),e.is(o)&&o.length>0&&(e.is(i[o])||(i[o]={}),s&&(i[o].type=t[r].type),e.is(i[o].allowFreeInput)||(i[o].allowFreeInput=!0),!0!==a&&!0===i[o].allowFreeInput&&t[r].dispValue!==t[r].object&&(i[o].allowFreeInput=!1),"real"===t[r].type&&(i[o].freeInputOnly=u.getOption("rangeValuesClassification"),delete i[o].allowFreeInput)));if(s&&this._tagsTransformer&&!0===this._tagsTransformer.isTransientWidget())for(var c in i){var d=i[c];d&&("date"===d.type&&(d.freeInputOnly=!0),delete d.type)}this.options.tagger_proxy.setPredicates(i)}},_retrieveLastIndexingDate:function(t){if(this._indexingDate=null,e.is(t)&&e.is(t.response_infos)&&e.is(t.response_infos.sources,"array")){for(var i={},n=0,s=t.response_infos.sources.length;n<s;n++){var o=t.response_infos.sources[n];e.is(o,"object")&&e.is(o.indexingDate,"object")&&(i[o.name]=o.indexingDate)}if(e.is(i["3dspace"]))this._indexingDate=i["3dspace"];else if(e.is(i.drive))this._indexingDate=i.drive;else{var a=Object.keys(i);a.length>0?(E.log("no indexingDate info found for 3dspace or drive source, taking the info available for "+a[0]),this._indexingDate=i[a[0]]):E.log("no indexingDate info found in the FedSearch response")}}},updateModelsWithPreferredUnits:function(e){var t=this,i=function(i){var n,s,o,a,r=this,l=arguments,c=(n=i._models,s={},o={},a={},n.forEach(function(e){var t=e.getSourceID();if(t&&"3dspace"===t){var i=e.getType();i&&(i.indexOf(":")<1&&(i="ds6wg:"+i),e.keys().forEach(function(t){if(e.get(t+"_value")){var n=o[t];n||(o[t]=[],n=o[t]),n.push(e.get(t)),a[t]=X.getTypeForPredicateFromLocalCache(t)||i}}))}}),s.data=o,s.predicate2Type=a,s);w.setResources(t.search_ressources),w.convertValues({toPreferredUnit:!0,data:c.data,predicate2Type:c.predicate2Type,callback:function(t){var n,s;if(n=i._models,s=t,n.forEach(function(e){e.keys().forEach(function(t){if(e.get(t+"_value")){var i=s[t];if(i){var n=i[e.get(t)];n&&e.set(t,n)}}})}),e)return e.apply(r,l)}})};if(e)return i;i.call(this,{_models:this.toArray()})},getSocketID:function(){var t=null;return e.is(this._searchcom_socket)&&(t=this._searchcom_socket.id),t},updateSwymTypeIcon:function(t){t.forEach(function(t){var i=t._attributes.sourceid_value;if(e.is(i)&&-1!==i.indexOf("swym")){var n=t.get("type_icon_url");if(e.is(n)&&-1===n.lastIndexOf("/large-icons")){var s=n.lastIndexOf("/"),o=n.substring(0,s)+"/large-icons"+n.substring(s);t._attributes.type_icon_url=o}}})},interruptRequested:function(){return E.log("SearchCollection.interruptRequested"),this._interruptRequested},interrupt:function(e){E.log("SearchCollection.interrupt"),this._filterChangeInterruptSpecification=e,this._interruptRequested=!0},isDestroyed:function(){return E.log("SearchCollection.isDestroyed",!0===this.isDestroyed),!0===this.isDestroyed},updateSecurityContext:function(){this._update_security_contextTodo=!0,this.dispatchEvent("update_security_context",{})},_correctCountForHierarchicalTags:function(t){var i={},n={},s={};if(e.is(t,"array")&&!0===u.getOption("synthesis_hierarchical")){t.forEach(function(t){if(e.is(t.object,"array")){i[t.object[0]]||(i[t.object[0]]={});var o=t.object.slice(0,t.object.length-1).join("/"),a=t.object.join("/");n[o]||(n[o]=[]),n[o].push(a),s[a]=t}else s[t.object]=t}),Object.keys(i).forEach(function(e){!function e(t){s[t]&&n[t]&&n[t].forEach(function(i){s[i]&&(s[t].count=s[t].count-s[i].count),e(i)})}(e)});var o=[];return t.forEach(function(e){e.count>0&&o.push(e)}),o}return t},_asyncUpdateModels:function(){let e=JSON.parse(U),t={};for(let i in e)t=Object.assign(t,e[i]);for(let e in this.results)for(let i in t)if(this.results[e][i])if(Array.isArray(t[i]))for(let n in t[i])this.results[e][t[i][n]]=this.results[e][i];else this.results[e][t[i]]=this.results[e][i];for(let e in this._models)for(let i in t)if(this._models[e]._attributes&&this._models[e]._attributes[i])if(Array.isArray(t[i]))for(let n in t[i])this._models[e]._attributes[t[i][n]]=this._models[e]._attributes[i];else this._models[e]._attributes[t[i]]=this._models[e]._attributes[i]},_isPinnedWidget:function(){let t,i=!1;e.is(this._snSkeleton)&&(t=this._snSkeleton.getOption("addinMode"));let n=m.identifyClientInfo(t);return e.is(this._snSkeleton)&&(n=m.identifyClientInfo(this._snSkeleton.getOption("addinMode"))),e.is(this._snSkeleton)&&e.is(this._snSkeleton.getOption,"function")&&"3DSwym"!==n.identifier&&(i="true"!==this._snSkeleton.getOption("transient_context")&&!0!==this._snSkeleton.getOption("transient_context")),i},_addSynonymCheckCallback:function(e){var t=this.getRequestCriteria();"client"!==u.getOption("Synonyms_impl_type")?"server"!==u.getOption("Synonyms_impl_type")||(t.service_params.with_synonyms=!0):t.service_params.query=SynonymsUtils.getQueryWithSynonyms(t.service_params.query)},setComputedResultCount:function(e){this._computedResultCount=e},getComputedResultCount:function(){return this._computedResultCount},setColorMap:function(e){this._colorizationHelper.setColorMap(e)},unsetColorMap:function(){this._colorizationHelper.unsetColorMap()},getColor:function(e){return this._colorizationHelper.getColor(e)}});return G}),define("DS/SNResultUX/utils/SearchSortView",["UWA/Core","UWA/Class/Debug","UWA/Class","UWA/Controls/Abstract","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchPreferences","DS/WebappsUtils/Performance","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchMultiSort","DS/SNResultUX/utils/SearchCustoServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Iconbar","DS/FedDictionaryAccess/FedDictionaryAccessAPI","UWA/Element"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v){"use strict";return n.extend(t,{_searchcom_socket:null,_view:null,_viewTitleBox:null,_container:null,_body:null,_defaultItem:[{dataIndex:"ds6w:modified",type:"num"},{dataIndex:"ds6w:label",type:"alpha"},{dataIndex:"ds6w:created",type:"num"},{dataIndex:"ds6w:responsible",type:"alpha"},{dataIndex:"ds6w:type",type:"type"}],_listItemExtend:[],_activedItem:"",_activedItemId:"",_activedItemOrder:"",_menuIcon:"",_subscriptions:null,_nlsPromises:{},_multisortPanel:null,init:function(t){l.getOption("enableMultiSort-FUN096610")&&this._defaultItem.push({dataIndex:"multisort",type:"object",class:g}),this._parent(t),this._subscriptions={};if(this._viewTitleBox=null,this._searchcom_socket||(this._searchcom_socket=c.createSocket({socket_id:"sortView_socket_"+u.now(),widgetId:t.widgetId}),this._subscriptions.setOrderInGridView=o.subscribe({channel:this.getOption("messagingChannel"),topic:"setOrderInGridView",callback:this.setOrderByExt.bind(this)}),this._subscriptions.addSortItem=o.subscribe({channel:this.getOption("messagingChannel"),topic:"addSortItem",callback:this.updateRenderByExt.bind(this)}),this._searchcom_socket&&this._searchcom_socket.addListener("checkNewColomnForSort",this.checkNewColumnForSort.bind(this))),t&&t.container){if(this._container=t.container,this._collection=t.collection,this.options=t,!t.defaultSort)if(e.is(d.getItem("searchSort"))){let e=d.getItem("searchSort");this.options.defaultSort={dataIndex:e.order_field,order:e.order_by,type:e.order_type}}else if(l.getOption("default_sort")){var i=l.getOption("default_sort");e.is(i,"object")&&e.is(i.order_by,"string")&&e.is(i.order_field,"string")&&e.is(i.order_type,"string")&&(this.options.defaultSort={dataIndex:i.order_field,order:i.order_by,type:i.order_type})}else l.getOption("apply_sort_on_modified_by_default")?this.options.defaultSort={dataIndex:"ds6w:modified",order:"desc",type:"num"}:(this.options.defaultSort={dataIndex:"relevance",order:"group",type:"pertinency"},this._activedItem="relevance");this._setByDefaultSort(),this.render()}},render:function(){var t=this;this._view=new f({renderTo:t._container,events:{onClick:function(){t._promiseVocabNLS("ds6w"),s.all(t._getNLSPromises()).then(function(){return t.getDropdown()?(t.getDropdown().elements.container.setHTML(""),t.getDropdown().setBody(t._getBody())):setTimeout(function(){t.getDropdown().elements.container.setHTML(""),t.getDropdown().setBody(t._getBody()),t.updateStateInPanel()},50),t.updateStateInPanel(),t._view},function(){return t._view})}},items:[{fonticon:t._menuIcon?t._menuIcon:t._getIconByTypeAndOrder("alpha","asc"),text:_.get("sortMenuLabel"),content:{type:"dropdown",tag:"ul",options:{className:"dropdown-menu dropdown-menu-root dropdown dropdown-root",events:{onClick:function(i){var n=i.target||i.srcElement,s=this;if(n.id&&t._allowSort(n.getAttribute("dataIndex")))if("multisort"===n.getAttribute("dataIndex"))t._multisortPanel=new g({_parentContainer:t._container,_availableFields:p.getColumnCustomizationDefinitionFromCustoId("The_Default_Columns"),_order:e.is(t._activedItemOrder,"array")?t._activedItemOrder:[],_dataIndex:e.is(t._activedItem,"array")?t._activedItem:[],sortCallback:function(e,i){t._activedItem=e,t._activedItemOrder=i,t._activedItemId=n.id,t._menuIcon=n.className,t._setTitleBoxContent(n.getAttribute("textContent"),i),s.options.target.children[0].className=n.className;var r=t._collection.service_parameters.query===a.SearchTypeEnum.MY_RECENT_CONTENT;o.publish({channel:t.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:e,order_by:i,isRecent:r}})}}),t._multisortPanel.addEvent("onCloseMultisortPanel",function(){e.is(t._multisortPanel)&&e.is(t._multisortPanel.destroy,"function")&&t._multisortPanel.destroy()&&(t._multisortPanel=null)});else{t._activedItem=n.getAttribute("dataIndex"),t._activedItemOrder=n.getAttribute("order"),t._activedItemId=n.id,t._menuIcon=n.className,t._setTitleBoxContent(n.getAttribute("textContent"),t._activedItemOrder),this.options.target.children[0].className=n.className;var r=t._collection.service_parameters.query===a.SearchTypeEnum.MY_RECENT_CONTENT;o.publish({channel:t.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:n.getAttribute("dataIndex"),order_by:n.getAttribute("order"),isRecent:r}})}}},body:this._getBody()}}}]})},_setTitleBoxContent:function(t,i){this._viewTitleBox&&this._viewTitleBox.setContent(t);let n=this.getOption("collection").getTaggerProxy();n&&e.is(n.setEmbeddedViewProperties,"function")&&n.setEmbeddedViewProperties({rootw:{allw:{subLabel:_.replace(_.get("sortBy"),{criteria:t.toLowerCase(),sortType:"desc"===i?_.get("tooltip_SortDesc").toLowerCase():_.get("tooltip_SortAsc").toLowerCase()})}}})},_promiseVocabNLS:function(t){this._nlsPromises[t]||(this._nlsPromises[t]=new s(function(i,n){r.loadVocabulary(t,function(t){e.is(t)&&"success"===t.status?i():n()})}))},_promisePredicateNLS:function(t){var i=this;"ds6w"!==r.getVocabId(t)&&(this._nlsPromises[t]=new s(function(n){var s="",o=i.getOption("collection");e.is(o)&&e.is(o.search_ressources)&&e.is(o.search_ressources.getActiveTenant,"function")&&(s=o.search_ressources.getActiveTenant()),m.getResourcesInfo(t,{tenantId:s,lang:a.getLanguage(),apiVersion:"R2019x",onComplete:function(s){if(e.is(s,"array")&&s.length>0)for(var o=0;o<i._listItemExtend.length;o++)i._listItemExtend[o].dataIndex===t&&(i._listItemExtend[o].nlsName=s[0].label);n()},onFailure:n})}))},_getNLSPromises:function(){var e=this;return Object.keys(e._nlsPromises).map(function(t){return e._nlsPromises[t]})},updateStateInPanel:function(){if(this.getDropdown())for(var e=this.getDropdown().elements.container.children[0].children,t=0;t<e.length;t++)for(var i=e[t].children[1].children,n=0;n<i.length;n++)i[n].removeClassName("sortActived"),i[n].id===this._activedItemId&&i[n].addClassName("sortActived")},updateMenu:function(){this._hide(),this._i=this._i?this._i+1:1;var e=this;setTimeout(function(){0!==e._i&&(e._i=0,e.getDropdown()&&e.getDropdown().setBody(e._getBody()))},1e3)},reinitMenu:function(){this._hide(),this.emptyItemExtend(),l.getOption("search_web_in_win")||this._setByDefaultSort(),this.getDropdown()&&this.getDropdown().setBody(this._getBody())},getDropdown:function(){return this._view?this._view.menu.getItem(0).content.component:void 0},_hide:function(){this.getDropdown()&&this.getDropdown().hide()},_getBody:function(){return this._body={html:[]},this._initDefaultItems(),this._addFromListExtend(),this._body},addItemExtend:function(e){var t=this,i=this._listItemExtend.map(function(e){return e.dataIndex});(Array.isArray(e)?e:[e]).forEach(function(e){-1===i.indexOf(e.dataIndex)&&(t._listItemExtend.push(e),t._promisePredicateNLS(e.dataIndex))})},removeItemExtend:function(e){var t=this._listItemExtend.map(function(e){return e.dataIndex}),i=[];(Array.isArray(e)?e:[e]).forEach(function(e){-1!==t.indexOf(e.dataIndex)&&i.push(e.dataIndex)}),this._listItemExtend=this._listItemExtend.filter(function(e){return-1===i.indexOf(e.dataIndex)})},emptyItemExtend:function(){this._listItemExtend=[]},_allowSort:function(e){if(this._collection.state.totalRecords<=1e3)return!0;switch(e){case"relevance":case"ds6w:label":case"ds6w:who/ds6w:responsible":case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:responsible":case"ds6w:created":case"ds6w:modified":return!0;default:return h._displayAlert({message:_.get("sortLimitByLessThen1000Results"),className:"warning"}),!1}},_setByDefaultSort:function(){if(!(this.options.defaultSort&&this.options.defaultSort.dataIndex&&this.options.defaultSort.order))return;this._activedItemId=this.options.defaultSort.dataIndex+"-"+this.options.defaultSort.order,this._activedItem=this.options.defaultSort.dataIndex,this._activedItemOrder=this.options.defaultSort.order,this._menuIcon=this._getIconByTypeAndOrder(this.options.defaultSort.type,this.options.defaultSort.order);let e="relevance"===this.options.defaultSort.dataIndex&&a.isInTheSimpleSearch()?_.get("relevancySort"):r.getNLSValueForPredicate(this.options.defaultSort.dataIndex);this._setTitleBoxContent(e,this.options.defaultSort.order)},_setOrder:function(t,i,n){let s=n;e.is(t,"array")||e.is(n,"array")||("num"===i&&(s="asc"===n?"1-31":"31-1"),this._activedItemId=this._getIdByTypeIndexAndOrder(i,t,n),this._activedItem=t,this._activedItemOrder=this.options.defaultSort.order,this._menuIcon=this._getIconByTypeAndOrder(i,s),this._setMenuIcon(this._menuIcon),this._hide())},_setMenuIcon:function(e){this._view&&this._view.elements.container&&this._view.elements.container.children[0]&&(this._view.elements.container.children[0].children[0]&&this._view.elements.container.children[0].children[0].children[0]&&(this._view.elements.container.children[0].children[0].children[0].className=e),this._view.elements.container.children[0].children[1]&&this._view.elements.container.children[0].children[1].children[0]&&(this._view.elements.container.children[0].children[1].children[0].className=e))},setOrderByExt:function(t){this.updateRenderByExt(t),t.bNoSortRefresh&&!0===t.bNoSortRefresh||o.publish({channel:this.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:t.order_field,order_by:t.order_by,bForceNotReload:!e.is(t.bForceNotReload,"boolean")||t.bForceNotReload}})},setOrderByExtExplicit:function(e){this._activedItem=e.order_field,this._activedItemOrder=e.order_by,this._activedItemId=e.id,this._menuIcon=e.className,this.updateMenu(),this._setMenuIcon(this._menuIcon),o.publish({channel:this.getOption("messagingChannel"),topic:"sortForAllView",data:{order_field:e.order_field,order_by:e.order_by}})},updateRenderByExt:function(t){var i;(this._hide(),t.order_field&&t.order_by)&&((i="relevance"===t.order_field?{dataIndex:"relevance",type:"pertinency",order_by:t.order_by}:(i=this._defaultItem.filter(function(e){return-1!==e.dataIndex.indexOf("/")?e.dataIndex.split("/")[1]===t.order_field:e.dataIndex===t.order_field}))?i[0]:"")?this._setOrder(i.dataIndex,i.type,t.order_by):(e.is(t.order_field,"array")||e.is(t.order_by,"array")||(t.nlsName?this.addItemExtend({dataIndex:t.order_field,nlsName:t.nlsName}):this.addItemExtend({dataIndex:t.order_field})),this._setOrder(t.order_field,"",t.order_by),this.updateMenu()))},checkNewColumnForSort:function(e){if(Array.isArray(e)){if(e.length>0){var t=e.map(function(e){return e.dataIndex}),i=this._defaultItem.concat(this._listItemExtend),n=[];i.forEach(function(e){-1===t.indexOf(e.dataIndex)&&n.push(e.dataIndex)}),this._defaultItem=this._defaultItem.filter(function(e){return-1===n.indexOf(e.dataIndex)}),this._listItemExtend=this._listItemExtend.filter(function(e){return-1===n.indexOf(e.dataIndex)}),-1!==n.indexOf(this._activedItem)&&this._setByDefaultSort()}else this._listItemExtend=[];this.updateMenu()}},_addFromListExtend:function(){var e=this,t=this._defaultItem.map(function(e){return e.dataIndex});this._listItemExtend.forEach(function(i){-1===t.indexOf(i.dataIndex)&&e._addItem(i.dataIndex,i.type,i.nlsName)})},_addItem:function(e,t,i){let n=i||r.getNLSValueForPredicate(e),s={tag:"li",class:"item item-template sortPanelRow",html:[{tag:"span",class:"item-text",text:"multisort"===e?_.get("multiSort"):n},{tag:"div",class:"item-text item-icon-group",html:[]}]};switch(t){case"alpha":s.html[1].html=[{tag:"span",title:_.get("tooltip_alpha_SortAsc"),id:e+"-asc",order:"asc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"asc"),textContent:n},{tag:"span",title:_.get("tooltip_alpha_SortDesc"),id:e+"-desc",order:"desc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"desc"),textContent:n}];break;case"num":s.html[1].html=[{tag:"span",title:_.get("tooltip_num_SortAsc"),id:e+"-asc",order:"asc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"1-31"),textContent:n},{tag:"span",title:_.get("tooltip_num_SortDesc"),id:e+"-desc",order:"desc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"31-1"),textContent:n}];break;case"group":s.html[1].html=[{tag:"span",title:_.get("tooltip_SortGroup"),id:e+"-group",order:"asc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"asc"),textContent:n}];break;case"pertinency":s.html[1].html=[{tag:"span",title:_.get("tooltip_relevancy"),id:e+"-group",order:"desc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"asc"),textContent:n}];break;case"type":s.html[1].html=[{tag:"span",title:_.get("tooltip_type"),id:e+"-group",order:"asc",dataIndex:e,class:this._getIconByTypeAndOrder(t),textContent:n}];break;case"object":s.html[1].html=[{tag:"span",title:_.get("tooltip_SortGroup"),id:e+"-group",order:"asc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"asc"),textContent:n}];break;default:s.html[1].html=[{tag:"span",title:_.get("tooltip_SortAsc"),id:e+"-asc",order:"asc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"asc"),textContent:n},{tag:"span",title:_.get("tooltip_SortDesc"),id:e+"-desc",order:"desc",dataIndex:e,class:this._getIconByTypeAndOrder(t,"desc"),textContent:n}]}this._body&&this._body.html&&this._body.html.push(s)},_getIconByTypeAndOrder:function(e,t){switch(e){case"alpha":return"fonticon fonticon-sort-alpha-"+t;case"num":return"fonticon fonticon-date-sorting-"+t;case"group":case"type":return"fonticon fonticon-tag-sorting";case"object":return"fonticon fonticon-list";case"pertinency":return"fonticon fonticon-sorting";default:return t?"fonticon fonticon-sort-alpha-"+t:"fonticon fonticon-sort-alpha-asc"}},_getIdByTypeIndexAndOrder:function(e,t,i){switch(e){case"group":case"type":return t+"-group";case"pertinency":return"relevance"===t?t+"-group":t+"-"+i;default:return t+"-"+i}},_initDefaultItems:function(){var t=this,i=[];e.is(this._collection)&&e.is(this._collection.service_parameters,"object")&&this._collection.service_parameters.query!==a.SearchTypeEnum.MY_RECENT_CONTENT&&i.push({dataIndex:"relevance",type:"pertinency",nls:a.isInTheSimpleSearch()?_.get("relevancySort"):_.get("defaultSort")}),i.concat(this._defaultItem).forEach(function(e){t._addItem(e.dataIndex,e.type,e.nls)})},destroy:function(){this._searchcom_socket.removeListener("checkNewColomnForSort"),this._searchcom_socket.disconnect(),c.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null,e.is(this._view)&&e.is(this._view.destroy,"function")&&(this._view.destroy(),delete this._view),this._viewTitleBox=null,this._parent()}})}),define("DS/SNResultUX/views/utils/SwitcherView6wGrouping",["UWA/Core","UWA/Class/Debug","UWA/Class","UWA/Controls/Abstract","UWA/Promise","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PredicatesNLS","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchPreferences","DS/WebappsUtils/Performance","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchMultiSort","DS/SNResultUX/utils/SearchCustoServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/Iconbar","DS/FedDictionaryAccess/FedDictionaryAccessAPI","UWA/Element","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/SNInfraUX/Logger"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b){"use strict";return n.extend(t,{_menuUIKIT:null,_container:null,_collection:null,_widgetID:null,_icon:null,_tooltip:null,_events:[],init:function(e){this._menuUIKIT=null,this._container=e.container?e.container:null,this._collection=e.collection?e.collection:null,this._widgetID=e.widgetID?e.widgetID:null,this._icon=null,this._tooltip=null,this._events=[],this._initEvents(),this.render()},_initEvents:function(){let e=this;this._events.push(o.subscribe({channel:"3dSearch-switcher-view",topic:"displayContentSetHeader",callback:(t,i)=>{let n=JSON.parse(i.data),s=null,o=null;"tile"===n.view&&(s="view-small-tile")&&(o=_.get("view.tile.title")),"thumbnail"===n.view&&(s="view-small-thb")&&(o=_.get("view.thumbnail.title")),"tilebig"===n.view&&(s="view-big-tile")&&(o=_.get("view.Textual.title")),"table"===n.view&&(s="view-list")&&(o=_.get("view.table.title")),null!==s&&(e._icon.className="fonticon fonticon-"+s)&&e._menuUIKIT.toggleSelection(e._menuUIKIT.getItem(s)),null!==o&&e._tooltip.setBody(o)}}))},render:function(){if(null===this._container)return void b.log("[SwitcherView6wGrouping - render] : no container given.");var e=this;let t=void 0===d.getItem("LastSearchViewMode")?"tile":d.getItem("LastSearchViewMode"),i="view-small-tile",n=_.get("view.tile.title");"thumbnail"===t&&(i="view-small-thb")&&(n=_.get("view.thumbnail.title")),"tilebig"===t&&(i="view-big-tile")&&(n=_.get("view.Textual.title")),"table"===t&&(i="view-list")&&(n=_.get("view.table.title")),this._icon=v.create("span",{class:"fonticon fonticon-"+i,"data-rec-id":"switcher6wGrouping",events:{click:function(){null!==e._widgetID&&e._widgetID._menuUIKIT.show()}}}).inject(this._container);let s=[{name:"thumbnail",text:_.get("view.thumbnail.title"),fonticon:"view-small-thb",selectable:!0,selected:"thumbnail"===t},{name:"tilebig",text:_.get("view.Textual.title"),fonticon:"view-big-tile",selectable:!0,selected:"tilebig"===t},{name:"tile",text:_.get("view.tile.title"),fonticon:"view-small-tile",selectable:!0,selected:"tile"===t}];!1===l.getOption("search_compact_mode")&&s.push({name:"table",text:_.get("view.table.title"),fonticon:"view-list",selectable:!0,selected:"table"===t}),this._menuUIKIT=new S({target:this._container,items:s,closeOnClick:!0,className:"search",events:{onClick:function(t,i){d.setItem("LastSearchViewMode",i.name),o.publish({channel:"3dSearch-global-view",topic:"reloadViews"});let n="view-small-tile",s=_.get("view.tile.title");"thumbnail"===i.name&&(n="view-small-thb")&&(s=_.get("view.thumbnail.title")),"tilebig"===i.name&&(n="view-big-tile")&&(s=_.get("view.Textual.title")),"table"===i.name&&(n="view-list")&&(s=_.get("view.table.title")),e._icon.className="fonticon fonticon-"+n,e._tooltip.setBody(s),d.commit()}}}),this._tooltip=new w({position:"bottom",target:this._icon,className:"switcher6wGrouping",body:n})},destroy:function(){null!==this._icon&&this._icon.destroy(),null!==this._menuUIKIT&&this._menuUIKIT.destroy(),null!==this._tooltip&&this._tooltip.destroy();for(let e=0;e<this._events;e++)this._events[e].destroy();this._parent()},updateMenu:function(){},updateStateInPanel:function(){},reinitMenu:function(){},getDropdown:function(){},addItemExtend:function(){},removeItemExtend:function(){},emptyItemExtend:function(){},setOrderByExt:function(){},setOrderByExtExplicit:function(){},updateRenderByExt:function(){},checkNewColumnForSort:function(){},_setOrder:function(e,t,i){}})}),define("DS/SNResultUX/utils/ResultCategoryUXHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Api/SearchApi","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/WildcardMgr","DS/WebAppsFoundations/Collections/PageableCollection","DS/SNResultUX/collections/SearchCollection","DS/SNInfraUX/SearchResultCategories","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchTagsTransformation","DS/SNResultUX/utils/ContentLocationServices","DS/TagNavigator/simplified/utils/CriteriaUtils","text!DS/SNInfraUX/assets/ResultCategoryDefaults.json","text!DS/SNResultUX/assets/CategoryViewMapping.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w){"use strict";let b=t.singleton(i,{init:function(){this._CategoryViewMapping=JSON.parse(w),this._setTagsTransformer()},_setTagsTransformer:function(e){if(!e){e=new f({isTransientWidget:!0})}this._tagsTransformer=e},_getResultPromise:function(t,i){return new n(function(n,o){var a=e.extend(t,{onComplete:function(t){n(e.extend(t,i))},onFailure:function(e){o(e)}});s.search(a)})},_getResultCollectionPromise:function(e,t){var i=b._getResultCollection(e,t);return new n(function(e,t){i.collection.fetch({onComplete:function(t,n){e(i)},onFailure:function(e){t(e)}})})},buildSearchParams:function(e){var t,i=this,n=e.search_text;e.search_text&&p.getActiveCategories(this._getTenant(),e.group).forEach(function(s){if(s.id==e.category_id){n=i._buildSearchQuery(s,e);var o=i._getCategoryQuery(s);o&&(n="("+n+")"+o),t=[s.source]}});return{query:n,source:t}},_buildSearchQuery:function(t,i){let n="";var s=n=e.is(i.search_text,"object")?i.search_text[t.nls]:i.search_text,o=u.getInfo(s);if(o.isAnExactCriteria||o.isASpecialCriteria||o.isAdvancedCriteria||o.containsNonLatinChars||o.indexOfwildChar>=0||o.pqAbbrevation);else if("3dspace"===t.source)(s=t.add_wildcard?u.manageWildcardAddtion(n,{addWildCard_inCtx:!0}):n).indexOf(" ")>0&&(s=s.split(" ").join("*"));else if(s.indexOf(" ")>0){for(var a=s.split(" "),r=a.pop();r.length<3;)r=a.pop();a.length>0&&(r+="*"),a.push(r),s="("+(s=a.join(" "))+")"}else s+="*";return t.match_on&&(s=t.match_on.indexOf(":")>0?"["+t.match_on+"]:"+s:t.match_on+":"+s),t.query&&(s=this._mergeQueries(s,t.query,"AND")),s},_buildSearchQueryForResult:function(t,i){let n="";e.is(i.search_text,"object")?n=i.search_text[t.nls]:e.is(i.search_text)&&(n=i.search_text);var s=u.manageWildcardAddtion(n);s===l.SearchTypeEnum.ADVANCED_SEARCH&&(s="");var o="";return e.is(t.query,"string")&&t.query.length>0?o=t.query:t.query&&t.query.query&&(o=t.query.query),s=this._mergeQueries(s,o,"AND")},_createQueryFromTypes:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND ([ds6w:type]:(";for(var n=0;n<t.length;n++){i+='"'+t[n]+'"',n<t.length-1&&(i+=" OR ")}i+="))"}return i},_createQueryFrom3DSpaceTypes:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND (flattenedtaxonomies:(";for(var n=0;n<t.length;n++){var s=t[n];s.startsWith("ds6wg:")&&(s=s.substring(6)),i+='"types/'+s+'"',n<t.length-1&&(i+=" OR ")}i+="))"}return i},_getCategoryQuery:function(t){var i=t.criteria;return e.is(t.types,"array")&&(i="3dspace"==t.source?this._createQueryFrom3DSpaceTypes(t.types):this._createQueryFromTypes(t.types)),i},_getQueryFromRefine:function(e,t){return l._getQueryFromRefine(e,t)},_search:function(t){var i={},n=this,s=this._getAvailableSources();if(e.is(t)&&e.is(t.list)){var a={},r=void 0;if(t.refine&&o.isSimplifiedTaggerFilters(t.refine.allfilters)){a=o.convertToRefineAndUQL(t.refine.allfilters);var u=d.from_filters_to_uql(t.refine.allfilters);r=n._mergeQueries(u,a.uql,"AND")}t.list.forEach(function(o,d){if(s[o.source]||t.all_src){if(s[o.source]){var u=n._getCategoryQuery(o);u&&l.addSourceSpecificParameter(o,{sourceIds:e.is(o.source,"array")?o.source:[o.source],param:{id:"additional_query",value:u}})}var h;h=t.build_query_method?t.build_query_method.call(n,o,t):n._buildSearchQuery(o,t),h=n._mergeQueries(h,r,"AND");var g={},p=[];if(o.refine&&o.refine.allfilters&&a.refine){var f=Object.keys(o.refine.allfilters).concat(Object.keys(a.refine)).sort().reduce((e,t,i,n)=>(i&&n[i]===n[i-1]&&e.push(t),e),[]);if(f.length){f.forEach((e,t)=>{var i=n._getQueryFromRefine(e,o.refine.allfilters[e]),s=n._getQueryFromRefine(e,a.refine[e]);i.length<s.length?(delete o.refine.allfilters[e],p.push(i)):(delete a.refine[e],p.push(s))});var v=p.reduce((e,t)=>e+" AND "+t);h=n._mergeQueries(h,v,"AND")}g.allfilters=e.extend(o.refine.allfilters,e.clone(a.refine,!0))}else o.refine&&o.refine.allfilters?g=o.refine:a.refine&&(g.allfilters=e.clone(a.refine,!0));var S={};if(g.allfilters&&(g.localfilters||(g.localfilters=g.allfilters),n._preprocessDatasourceUriForTransformation(g),n._tagsTransformer.transformFilterSourceToProject(g),S={refine:g},m.addSourceSpecificParameterToFilterData(S)),e.is(S.source,"array")&&S.source.length>0&&(o.source=S.source),S.specific_source_parameter&&Object.keys(S.specific_source_parameter).forEach(function(e){var t=S.specific_source_parameter[e];t.additional_query&&l.addSourceSpecificParameter(o,{sourceIds:[e],param:{id:"additional_query",value:t.additional_query}})}),-1!==h.indexOf("#myContent")||-1!==h.indexOf("#myRecentContent"))g&&g.localfilters&&g.localfilters.myContent&&delete g.localfilters.myContent,g&&g.allfilters&&g.allfilters.myContent&&delete g.allfilters.myContent,g&&g.localfilters&&g.localfilters.myRecentContent&&delete g.localfilters.myRecentContent,g&&g.allfilters&&g.allfilters.myRecentContent&&delete g.allfilters.myRecentContent,o.with_synthesis=!0;else{S.source&&S.source.length>0&&(o.source=S.source);var w=l.getQueryFromRefines(g.allfilters);if(w){var b=n._mergeQueries(h,w,"AND");b.length<_.getOption("ResultCategoryMaxQueryLength")?(h=b,g={}):o.with_synthesis=!0}}i[o.id]=t.method.call(n,{query:h,refine:g,specific_source_parameter:o.specific_source_parameter,with_synthesis_hierarchical:!1,select_file:o.select_file,nresults:o.nresults,order_by:o.order_by,order_field:o.order_field,source:o.source?e.is(o.source,"array")?o.source:[o.source]:[],select_predicate:o.select_predicate,select_snippets:o.select_snippets,tenant:t.tenant||n._getTenant(),with_synthesis:o.with_synthesis,with_info:!0,feature:t.feature},{id:o.id,nls:o.nls})}else c.log(o.source," source is not available in current active tenant")})}return i},_getSearchResources:function(){var e=s.getSearchResources();return e&&new a(e)},_getAvailableSources:function(){var e=this._getSearchResources();return(e&&e.getActiveTenant()&&r.getAvailableSources(e.getActiveTenant())||[]).reduce(function(e,t){return e[t.name]=t,e},{})},_getTenant:function(){var e=this._getSearchResources();return e&&e.getActiveTenant()},getResultCategoryUXHelper:function(){var e=this;return this._resultCategoryUxHelperPromise||(this._resultCategoryUxHelperPromise=new n(function(t,i){s.getSearchApiPromise().then(function(){var i=e._getTenant();p.getResultCategories(i).then(function(){r.login({tenantID:i,onComplete:function(){t()},onFailure:function(){t()}})})})})),this._resultCategoryUxHelperPromise},getCategoryResultsCollectionPromise:function(t,i){return this._search(e.extend(i,{list:p.getActiveCategories(this._getTenant(),t),method:b._getResultCollectionPromise}))},getCategoryResultsPromise:function(t){return this._search(e.extend(t,{list:p.getActiveCategories(this._getTenant(),"result"),method:b._getResultPromise}))},_isGroupRefinable:function(t){var i={},n=t.object.predicates||[],s=t.object.operator||"OR",o=t.object.value;if("date"===t.type)return!1;for(var a=0;a<n.length;a++){if(e.is(o[a],"object"))return!1;var r=n[a];if(i[r.predicate]){if("AND"===s)return!1}else if(i[r.predicate]=[],Object.keys(i).length>1&&"OR"===s)return!1}return!0},_getGroupRefine:function(t,i){let n={};return!0===t.isComplex?e.is(t.object.predicates,"array")&&e.is(t.object.value,"array")&&t.object.predicates.length==t.object.value.length&&t.object.predicates.forEach(function(i,s){!n[i.predicate]&&(n[i.predicate]=[]),e.is(t.object.value[s],"array")?t.object.value[s].forEach(function(e){n[i.predicate].push({disptext:i.dispValue,field:["implicit"],object:e,type:i.type})}):n[i.predicate].push({disptext:i.dispValue?i.dispValue:t.dispText,field:["implicit"],object:t.object.value[s],type:i.type})}):e.is(t.object,"object")||(!n[i.predicate]&&(n[i.predicate]=[]),n[i.predicate].push({disptext:t.dispText,field:["implicit"],object:t.object,type:t.type})),{allfilters:n,localfilters:n}},_getQueryForDateRefine:function(t,i){var n="";if(e.is(i.from)){var s=new Date(i.from+" 00:00:00");n="["+t+']>="'+(s=new Date(s).toISOString())+'"'}if(e.is(i.to)){var o=new Date(i.to+" 23:59:59");n&&(n+=" AND "),n+="["+t+']<="'+(o=new Date(o).toISOString())+'"'}return n="("+n+")"},_getGroupQuery:function(t,i,n){let s,o=this,a="",r={};if("date"===t.type)if(e.is(t.predicate,"array"))t.predicate.forEach(function(e,i){var r=e.split("/").pop(),l=t.object[i];s=o._buildCountAndLengthFromDs6wModifiedFacets(l,n),a=o._getQueryForDateRefine(r,l)});else{var l=i.predicate,c=t.object;s=o._buildCountAndLengthFromDs6wModifiedFacets(c,n),a=o._getQueryForDateRefine(l,c)}else{let i=t.object.predicates,n=t.object.value;e.is(i,"array")&&e.is(n,"array")&&i.length==n.length&&i.forEach(function(i,n){var s=i.predicate.split("/").pop(),o=t.object.value[n];r[s]||(r[s]=[]),e.is(o,"array")?o.forEach(e=>r[s].push(e)):r[s].push(o),a&&(a+=" "+t.object.operator+" "),a+=""})}return Object.keys(r).forEach(function(i){var n=r[i],s="";n.forEach((t,i)=>{s&&(s+=" OR "),s+='"'+(e.is(t,"array")?t.join("/"):t)+'"'}),n.length>1&&(s="("+s+")"),a&&(a+=" "+t.object.operator+" "),a+="["+i+"]:"+s}),s?(s.query=a,s):a},_getCategoriesFromGroups:function(t){var i=t.categories,n=t.ds6wModifiedFacets,s=this,o=[];return e.is(i.groups,"array")&&i.groups.forEach(function(t){e.is(t.object,"array")&&t.object.forEach(function(i){var a=e.extend({nls:i.dispText,icon:i.iconInfo?i.iconInfo:null,id:(new Date).getTime()+"-"+i.dispText},JSON.parse(S)),r=s._getGroupRefine(i,t);if(s._isGroupRefinable(i))a.refine=r,s._preprocessDatasourceUriForTransformation(r),s._tagsTransformer.transformFilterSourceToProject(r),m.addSourceSpecificParameterToFilterData(a);else{var l=s._getGroupQuery(i,t,n);a.query=l,a.falseRefine=r}o.push(a)})}),o},_preprocessDatasourceUriForTransformation:function(e){e.allfilters&&e.allfilters["ds6w:dataSource"]&&(e.allfilters["ds6w:where/ds6w:source/ds6w:dataSource"]=e.allfilters["ds6w:dataSource"],delete e.allfilters["ds6w:dataSource"])},_buildSourceMapForWHAT:function(t){var i={};return e.is(t,"array")&&t.forEach(function(e){var t=e.sixw;i[t]=i[t]||{},i[t][e.object]=e.sources}),i},_buildCountAndLengthFromDs6wModifiedFacets:function(e,t){var i={};if(e.from&&e.to){var n=new Date(e.from),s=new Date(e.to);i.count=t.reduce((e,t)=>{var i=new Date(t.object);return i>=n&&i<=s?e+t.count:e},0),i.length=(s-n)/864e5+1,i.length>100&&(new Date).getFullYear()==s.getFullYear()&&(i.length-=100)}else if(e.from){n=new Date(e.from);i.count=t.reduce((e,t)=>{return new Date(t.object)>=n?e+t.count:e},0),i.length=Number.MAX_VALUE}else if(e.to){s=new Date(e.to);i.count=t.reduce((e,t)=>{return new Date(t.object)<=s?e+t.count:e},0),i.length=Number.MAX_VALUE}return i},getResultsCollections:function(t){var i=p.getActiveCategories(this._getTenant(),"result"),s=e.is(t.facets,"array")?t.facets.filter(e=>"ds6w:when/ds6w:modified"==e.sixw&&3==e.object.split("/").length):void 0;if(t.categories){var o=this._getCategoriesFromGroups({categories:t.categories,ds6wModifiedFacets:s});o&&(i=o)}if(t.facets){var a=this._buildSourceMapForWHAT(t.facets);i.forEach(function(e){if(!(e.source&&e.source.length>0)){var t=[],i=e.refine;if(i||(i=e.falseRefine),i){var n=i.allfilters,s=!0;n&&(Object.keys(n).forEach(function(e){n[e].forEach(function(i){var n=i.object;a[e]&&a[e][n]?t=t.concat(a[e][n]):s=!1})}),s&&(e.source=t.filter(function(e,t,i){return i.indexOf(e)==t})))}}})}var r=t;return new(h.extend({_catCollections:{},_catCollectionsList:[],_catCollectionsPromiseList:[]},{setup:function(){this.state=this.state||{},this.state.firstPage=0,this.state.currentPage=-1,this.state.pageSize=t.pageSize||5,this.state.totalRecords=i.length,this.state.totalPages=Math.ceil(i.length/this.state.pageSize),this.state.lastPage=this.state.totalPages-1},getFirstPage:function(e){return this._parent(e)},fetch:function(t){var s=this,o=(t.to||this.state.currentPage)*this.state.pageSize,a=o+this.state.pageSize;a=a<i.length?a:i.length;for(var l,d=i.slice(o,a),u=b._search(e.extend(r,{list:d,method:b._getResultCollection,build_query_method:b._buildSearchQueryForResult,all_src:!0})),h=[],g=d.reduce((e,t)=>(e[t.id]=t,e),{}),p=0;p<d.length;p++)d[p].query&&d[p].query.query&&d[p].query.count&&(l&&l.query.length>d[p].query.length?l=d[p]:l||(l=d[p]));Object.keys(u).forEach(function(t,i){var a=u[t].collection;let d=u[t].nls;h.push(new n(function(n,u){r.noFetchWHENCountZero&&e.is(g[t].query)&&g[t].query.query&&l&&g[t]!=l?(a.setComputedResultCount(g[t].query.count),s.addCollection(t,a,o+i,d),n(a)):a.fetch({onComplete:function(e,a){s.add(e.toArray()),s.addCollection(t,e,o+i,d),n(e)},onFailure:function(e){c.log(e),s.addCollection(t,a,o+i,d),n(a)}})}))}),t.noWaitForCategoryCollections?(s._catCollectionsPromiseList=s._catCollectionsPromiseList.concat(h),t.onComplete.call(s,s)):n.all(h).then(function(){t.onComplete.call(s,s)})},addCollection:function(t,n,s,o){if(n.headTitle=o,n.id=t,e.is(s)&&e.is(i[s])&&e.is(i[s].icon)&&(n.icon=i[s].icon),i[s].refine&&i[s].refine.allfilters)for(let t in i[s].refine.allfilters)e.is(i[s].refine.allfilters[t],"array")&&i[s].refine.allfilters[t].length>0&&(n.view={id:t,object:i[s].refine.allfilters[t][0].object});this._catCollections[t]=n,this._catCollectionsList[s]=n},getCategoryCollections:function(){return this._catCollections},getCategoryCollectionsList:function(){var e=this.state.currentPage*this.state.pageSize,t=e+this.state.pageSize;return t=t<i.length?t:i.length,this._catCollectionsList.slice(e,t)},getCategoryCollectionsPromiseList:function(){var e=this.state.currentPage*this.state.pageSize,t=e+this.state.pageSize;return t=t<i.length?t:i.length,this._catCollectionsPromiseList.slice(e,t)}}))},_getResultCollection:function(t,i){var n=this,s=new g({feature:t.feature},{event:{onSetup:function(i){i.setOption("deactivateModelNLS",!0),i.setSearchRessources(n._getSearchResources()),t.nresults&&i.setPageSize(t.nresults);var s={query:t.query,refine:t.refine,with_synthesis:t.with_synthesis,with_synthesis_hierarchical:t.with_synthesis_hierarchical,select_predicate:t.select_predicate,select_snippets:t.select_snippets,select_file:t.select_file,source:t.source,ignoreRestrictedSources:!0};t.order_by&&t.order_field&&(s.order_by=t.order_by,s.order_field=t.order_field),e.is(t.source,"array")&&t.source.length>0&&t.specific_source_parameter&&t.specific_source_parameter[t.source[0]]&&l.addSourceSpecificParameter(s,{sourceIds:t.source,param:{id:"additional_query",value:t.specific_source_parameter[t.source[0]].additional_query}}),i.setRequestCriteria("fed_search",s),i._isCategoryHelperCollection=!0}}});return e.extend({collection:s},i)},_getViewAndCount:function(e){let t="tile";return this._CategoryViewMapping.view_mapping.category[e.category]&&(t=this._CategoryViewMapping.view_mapping.category[e.category]),{view:t,item_count:this._CategoryViewMapping.item_count[t]}},getViewMapping:function(t){var i={},n=t;e.is(n,"array")||(n=[t]);var s=this;return n.forEach(function(e){let t=s._getViewAndCount(e);!i[e.nls]&&(i[e.nls]={}),i[e.nls]=t}),i},_mergeQueries:function(e,t,i){var n="";return e&&t?n="("+e+") "+i+" ("+t+")":e?n=e:t&&(n=t),n}});return b}),define("DS/SNResultUX/collections/UXCollection",["UWA/Core","DS/SNResultUX/collections/SearchCollection","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/Logger","DS/SNResultUX/utils/ResultCategoryUXHelper","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,i,n,s,o,a,r,l,c,d){"use strict";return t.extend({_catCollections:{},generateTreeModel:function(){let e=this;setTimeout(function(){var t=a.getAllSelectClause(!0),i=function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var n=i+1;n<t.length;++n)t[i]===t[n]&&t.splice(n--,1);return t}(e._required_predicates.concat(t)),n=e.getNotLoadedPredicate(i);n.length>0&&d.getResourcesInfo(n.join(","),{tenantId:e.search_ressources.active_tenant,lang:r.getLanguage(),apiVersion:"R2019x",onComplete:function(t){t&&e.saveNLS_ds6wg(t),e.asyncUpdateModels_predicate()},onFailure:function(t){t&&e.saveNLS_ds6wg(t),e.asyncUpdateModels_predicate()}});e._asyncUpdateModels(),e.generateTreeModelAsync().then(function(){e.dispatchEvent("onInitTreeDocument_SelectFirstElt",e._treeDocument),e.dispatchEvent("onInitTreeDocumentAsyncCB")})},50)},_getPreviewDefinition:function(i){let n=null;
//!UWACore.is(ResultCategoryUXHelper.ResultPreviewDefinition) &&
c.SearchCollection=t;try{n=c._search(e.extend(i,{list:c.ResultPreviewDefinition.result.list,method:c._getResultCollection}))}catch(e){l.log("[UXCollection 01] - "+e.message)}return n},fetch:function(e){let t=this,i=[];e.search_text=this.service_parameters.query;let n=this._getPreviewDefinition(e);this.resetCollection(),this._fedsearchOptions={},Object.keys(n).forEach(function(e){var o=n[e].collection;i.push(new s(function(i){o.fetch({onComplete:function(n){t.add(n.toArray()),t.addCollection(e,n),i()},onFailure:function(n){l.log(n),t.addCollection(e,o),i()}})}))}),s.all(i).then(function(){e.onComplete.call(t,t)})},resetCollection:function(){this._catCollections={}},addCollection:function(e,t){this._catCollections[e]=t},getCategoryCollections:function(){return this._catCollections}})}),define("DS/SNResultUX/utils/OneSearchActions",["UWA/Core","UWA/Class/Debug","UWA/Controls/Abstract","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/UIKIT/DropdownMenu","DS/SNResultUX/utils/SearchViewOptions","DS/SNInfraUX/SearchUtils"],function(e,t,i,n,s,o,a){"use strict";return i.extend(t,{_view:null,_container:null,_searchActions:null,_defaultItem:[],init:function(e){this._parent(e),this._defaultItem=[],e&&e.container&&(this._container=e.container,this._collection=e.collection,this._searchActions=e.searchActions,this.options=e,e.mode&&"ipad"===e.mode?this.defaultItemsIpad():this.defaultItems(),this.render())},render:function(){let t=this;e.is(t._searchActions)&&e.is(t._container)&&(this._view=new s({className:"one_search_actions",target:t._container,events:{onClick:function(i,n){if(i.stopPropagation(),!e.is(n))return;let s=n.id,r=t._searchActions.snSkeletonMgt;if("select_all"===s||"unselect_all"===s||"preview"===s){if(e.is(r)){let e=[{id:s,sourcejs:"DS/SNResultUX/utils/Select_ActionHandler"}];r._handleAction(0,void 0,e)}}else if("help_search"===s)window.open("http://help.3ds.com/HelpDS.aspx?P=11&V=2022x&L="+a.getLanguage()+"&F=EXP3DBasicsUserMap/exp3dbasics-c-Search.htm&contextscope=onpremise","_blank","popup");else{let e={actionItem:{model:{get:function(){return s}},getContent:function(){return t._container}},itemViewOptions:o.getItemViewOptions(r.getOption("resources"))};t._searchActions.onActionClick(e)}},onShow:function(){let i=t._searchActions.snSkeletonMgt;if(e.is(i)){let t=i._skeleton.getViewAt(0).currentViewId;e.is(t)&&this.items.forEach(function(n){if(e.is(n)&&e.is(n.id))if("exportToCmd"===n.id)"table"===t?n.elements.container.setStyle("display","inline-block"):n.elements.container.setStyle("display","none");else if("Grid_Custo"===n.id)(void 0!==i.getOption("addinMode")||e.is(i.getOption("in_apps_search"),"object"))&&("table"===t?n.elements.container.setStyle("display","inline-block"):n.elements.container.setStyle("display","none"));else if("select_all"===n.id||"unselect_all"===n.id){let t=i._model.getXSO().get();if(e.is(t)){let s=t.length,o=e.is(i._onesearch_collection)&&e.is(i._onesearch_collection.totalCount)?i._onesearch_collection.totalCount:0;"select_all"===n.id&&(s!==o?n.elements.container.setStyle("display","inline-block"):n.elements.container.setStyle("display","none")),"unselect_all"===n.id&&(0===s?n.elements.container.setStyle("display","none"):n.elements.container.setStyle("display","inline-block"))}}else if("Pin"===n.id){let t=i.getSearchWidget();e.is(t)&&0!==t.id.indexOf("preview")?n.elements.container.setStyle("display","none"):n.elements.container.setStyle("display","inline-block")}})}}},items:t._defaultItem}))},defaultItems:function(){let t=this;if(!e.is(t._searchActions)||!e.is(t._container))return;let i=t._searchActions.actionOneSearch;if(e.is(i)){let s=i._byId;if(e.is(s)){let i=s.refresh_search;if(e.is(i)&&t._defaultItem.push({text:n.get("actions.refresh_search.title"),id:"refresh_search",fonticon:"fonticon fonticon-cw"}),i=s.Grid_Custo,e.is(i)&&t._defaultItem.push({text:n.get("actions.Grid_Custo.title"),id:"Grid_Custo",fonticon:"fonticon fonticon-cog"}),i=s.save_search,e.is(i)){let s=i.get("visible");e.is(s)?!0===s&&t._defaultItem.push({text:n.get("actions.save_search.title"),id:"save_search",fonticon:"fonticon fonticon-star"}):t._defaultItem.push({text:n.get("actions.save_search.title"),id:"save_search",fonticon:"fonticon fonticon-star"})}i=s.exportToCmd,e.is(i)&&t._defaultItem.push({text:n.get("actions.exportToCmd.title"),id:"exportToCmd",fonticon:"fonticon fonticon-export"}),i=s.BI_Activated,e.is(i)&&t._defaultItem.push({text:n.get("actions.BI_Activated.title"),id:"BI_Activated",fonticon:"fonticon fonticon-chart-pie"}),i=s.kpi_pcs_action,e.is(i)&&t._defaultItem.push({text:"PCS",id:"kpi_pcs_action",fonticon:"fonticon fonticon-chart-line"}),i=s.Pin,e.is(i)&&t._defaultItem.push({text:n.get("actions.Pin.title"),id:"Pin",fonticon:"fonticon fonticon-pin"})}}t._defaultItem.push({text:n.get("selectAllTitle"),id:"select_all",fonticon:"fonticon fonticon-select-on"}),t._defaultItem.push({text:n.get("unselectAllTitle"),id:"unselect_all",fonticon:"fonticon fonticon-select-off"}),t._defaultItem.push({text:n.get("help"),id:"help_search",fonticon:"fonticon fonticon-help"})},defaultItemsIpad:function(){this._defaultItem.push({text:n.get("actions.Pin.title"),id:"Pin",fonticon:"fonticon fonticon-pin"})},destroy:function(){e.is(this._view)&&e.is(this._view.destroy,"function")&&(this._view.destroy(),delete this._view),this._parent()}})}),define("DS/SNResultUX/views/helpers/utils/SearchGlobeViewUtils",["UWA/Core","DS/MessageBus/MessageBus","WebappsUtils/WebappsUtils","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/ContentLocationServices","DS/SNResultUX/views/helpers/utils/SearchMultiViewUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c){"use strict";function d(t,i,n,s,o,a){if(!e.is(n)||!e.is(s)||!e.is(t))return;if("Emptycountry"===o)return;let r=t;s.clearCountries();let l,c=g(n);var d=n.getTaggerProxy();e.is(d)&&p(i,{onComplete:function(t){e.is(c)&&e.is(c.filters)?(e.is(c.index)&&-1!==c.index&&(c.filters.condition[c.index]=t),l=c.filters):l={condition:[t],operator:"AND",isSimplified:{version:2}},r.mask(),d.setLocalFilter(l,!0),o="Emptycountry"}},a);return o}function u(t,i,n,s,o,a){if(!(e.is(i)&&e.is(n)&&e.is(s)&&e.is(a)&&e.is(t)))return;let r=t,l=g(n),c=n.getTaggerProxy();if(e.is(c)&&e.is(l)&&e.is(l.filters)){let t=l.filters;p(i,{onComplete:function(n){e.is(n)&&(t.condition&&t.condition.push(n),r.mask(),c.setLocalFilter(t,!0),i)}},a)}}function h(t,i,n,s,o,a){if(!(e.is(i)&&e.is(n)&&e.is(o)&&e.is(t)))return;if(s===i)return!0;let r=t,l=n.getTaggerProxy();if(e.is(l)){let t="DS/TagNavigator/simplified/utils/LocationUtils",s=o[i];require([t],function(t){let o={displayValue:s,type:"string",uri:s,predicate:"ds6w:where/ds6w:location/computedCountryInfo"},c=t.buildCondition(o);if(c.condition=[c.condition],e.is(c)&&e.is(c.condition)){let t=c.condition[0];if(e.is(t)){t.display=s,t.object=[i];let o=a[i];if(e.is(o)){let i=o.countries;if(e.is(i)){let s=Object.keys(i),o=s.length;for(var d=0;d<o;d++){let n=i[s[d]];if(e.is(n)){var u=n.person;e.is(u,"array")&&u.forEach(function(e){t.value.push(e.get("title"))})}}t.value.forEach(function(){t.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})});let a={condition:[{"ds6w:where/ds6w:location/computedCountryInfo":c}],operator:"AND",isSimplified:{version:2}},h=g(n);e.is(h)&&e.is(h.filters)&&(e.is(h.index)&&-1!==h.index&&h.filters.condition.splice(h.index,1),h.filters.condition.push({"ds6w:where/ds6w:location/computedCountryInfo":c}),a=h.filters),r.mask(),l.setLocalFilter(a,!0)}}}}})}return!1}function g(t){if(e.is(t)){var i=t.getTaggerProxy();if(e.is(i)){let t=i.getCurrentFilter();if(e.is(t)){let i=t.localfilters;if(e.is(i)){for(let t=i.condition.length-1;t>=0;t--){let n=i.condition[t];if(e.is(n)){let e=Object.keys(n);e&&e.length&&"ds6w:where/ds6w:location/computedCountryInfo"!==e[0]&&i.condition.splice(t,1)}}return{filters:i}}}}}}function p(t,i,n){if(!e.is(t))return;require(["DS/TagNavigator/simplified/utils/LocationUtils"],function(s){let o={displayValue:t,type:"string",uri:t,predicate:"ds6w:where/ds6w:location/computedCountryInfo"},a=s.buildCondition(o);if(a.condition=[a.condition],e.is(a)&&e.is(a.condition)){let o=a.condition[0];if(e.is(o)){let r=n[t];if(e.is(r)){let t=r.person;e.is(t,"array")&&t.forEach(function(e){o.value.push(e.get("title"))})}else o.value.push(t);if(e.is(r)){let n=s.getCountryInfo(r.countryCode),l=n&&n.continent,c="ds6w:country."+r.countryCode;o.display=t,o.object=[l,c],o.type="string",o.value.forEach(function(){o.predicates.push({type:"string",predicate:"ds6w:who/ds6w:responsible"})}),i&&e.is(i.onComplete,"function")&&i.onComplete.call(this,{"ds6w:where/ds6w:location/computedCountryInfo":a})}}}})}function _(t,i,n,s,o,a,r,l){if(!e.is(i))return;i.clearMarkers(),i.clearCountries(),S(r);let d=[],u=t;e.is(u)||(u=n);let h=Object.keys(u),g=h.length;for(let t=0;t<g;t++){let n=h[t],g=u[n];if(e.is(g)){let t=s.find(e=>e.countryCode===g.countryCode);if(e.is(t)&&e.is(t.pos)){let s=parseFloat(t.pos.latitude),u=parseFloat(t.pos.longitude);var p={uuid:n,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"};let h=g.count,_=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:h});1===h&&(_=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:h})),_=n+": "+_;let m=i.addMarker(s,u,0,"darkblue",h,_,p);e.is(m)&&f(m,d,o,a,i,r,!(!e.is(l)||l.countryCode!==g.countryCode))}}}return d}function f(n,s,o,a,r,l,c){if(e.is(s)&&e.is(n)){var d=new a(o);d.markerPanel.addClassName("Search-MarkerInfo"),d.markerPanel.addEventListener("click",function(i){!function(i,n){if(!e.is(i)||!e.is(n))return;let s=n,o=(i.lon,i.lat,i.uuid),a=s._globe,r=(s._listOfMarkerInfo,s._collection),l=s._latRefine,c=s._continents,d=s._continentsList,g=(s._continentsPos,s._ClusterSetFromTopbar);s._ClusterSet,s._countries,s._container,s._MarkerInfo;if(!0===s._3DExperienceSelected)return;E(n),e.is(o)&&o.length&&(2===o.length?(h(s,o,r,l,c,d),s._latRefine=o,t.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnContinentCategory",persDim:{pd1:e.is(c,"object")?c[o]:o,pd2:"Globe View"}}})):(u(s,o,r,a,0,g),s._latRefine=o,t.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnCountryCategory",persDim:{pd1:o,pd2:"Globe View"}}})))}(n,l)}),d.show=function(t,n,s){let a=P(l),r=k(l),d=o.getDimensions().width+20;if(this.markerPanelDisplayed=t,this.markerPanel.empty(),t&&n&&n.isValidContent()&&s[1]>10&&s[0]<d&&s[0]>0){let t=this.markerPanel.getChildren();t&&0===t.length&&((t=new e.Element("div",{class:"SearchMarkerInfo-count"})).setText(n.title),this.markerPanel.title=n.description,this.markerPanel.addContent(t));let o=i.getWebappsAssetUrl("SNResultUX","images/results_cluster.png"),l=n.uuid;e.is(l)&&2===l.length&&(o=i.getWebappsAssetUrl("SNResultUX","images/cluster_clusters.png")),e.is(c)&&!0===c&&(o=i.getWebappsAssetUrl("SNResultUX","images/results_cluster_selected.png")),this.markerPanel.setStyle("backgroundImage","url("+o+")"),this.markerPanel.style.left=r+s[0]-10+"px",this.markerPanel.style.top=s[1]+a+"px",this.markerPanel.style.display="block",this.markerPanel.setStyle("z-index","150")}else this.markerPanel.style.display="none",this.markerPanel.setStyle("resize","none"),this.markerPanel.setStyle("overflow","hidden")},s.push({marker:n,markerinfo:d})}}function m(t,i,n,s){if(!e.is(i))return;for(let o=i.length-1;o>=0;o--){let a=i[o];e.is(a)&&(n.globe.markerBag.renderer.computeMarkerPositionOnScreen(a.marker),e.is(a.marker.screenPosition)||s&&!0===s?a.markerinfo.show(t,a.marker,[e.is(a.marker.screenPosition)?a.marker.screenPosition.x:0,e.is(a.marker.screenPosition)?a.marker.screenPosition.y:0],!0,!1):a.markerinfo.show(!1,a.marker,[e.is(a.marker.screenPosition)?a.marker.screenPosition.x:0,e.is(a.marker.screenPosition)?a.marker.screenPosition.y:0],!0,!1))}}function v(t,i,n,s,o,a,r,l,d){if(!e.is(t)||!e.is(n))return;n.clearMarkers(),n.clearCountries(),S(r);let u=r,h=[],g=Object.keys(t),p=g.length,_=0,v=0,w=0;for(var b=0;b<p;b++){let r=g[b],l=s.find(e=>e.name===r);if(e.is(l)&&e.is(l.pos)){let s=parseFloat(l.pos.latitude),d=parseFloat(l.pos.longitude),g={uuid:r,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},p=t[r].count;if(p>0){var C=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:p});1===p&&(C=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:p})),C=i[r]+": "+C;let t=n.addMarker(s,d,0,"darkblue",p,C,g);e.is(t)&&f(t,h,o,a,0,u,!1),_<p&&(_=p,v=s,w=d)}}}return!0===d&&n.turnGlobeToLatLon(v,w,l),setTimeout(function(){m(!u._3DExperienceSelected,h,n)},u._delay),h}function S(t,i){if(!e.is(t))return;let n=e.is(i)?i:t._listOfMarkerInfo;if(e.is(n)){for(let t=n.length-1;t>=0;t--){let i=n[t];e.is(i)&&(delete i.marker,e.is(i.markerinfo)&&e.is(i.markerinfo.markerPanel)&&i.markerinfo.markerPanel.remove(),delete i.markerinfo)}}t._listOfMarkerInfo=[],i=[]}function w(t){if(!e.is(t))return;let i,n=t.getTaggerProxy();if(e.is(n)){let t=n.getCurrentFilter();if(e.is(t)){let n=t.localfilters;if(e.is(n)&&e.is(n.condition)){let t;n.condition.findIndex(function(n){let s=Object.keys(n);if(s&&1===s.length){let o=s[0],a=n[s[0]];if(e.is(a)){let n=a.condition;e.is(n,"array")||(n=a);let s=e.is(n,"array")&&n.length;s>0&&(i={predicate:o,display:e.is(n[s-1].display)?n[s-1].display:n[s-1].displayValue,object:n[s-1].object,value:e.is(n[s-1].value,"array")?n[s-1].value[0]:void 0,condition:n,computedCountryInfo:t},"ds6w:where/ds6w:location/computedCountryInfo"===o&&(t=e.clone(i)))}}})}}}return i}function b(t,i,s,o,a){if(!e.is(t))return;let l=o,c=i,d=function(t){if(!e.is(t))return 0;let i=0,s=t._resultMgt&&t._resultMgt.getCollection().getTaggerProxy();if(e.is(s)&&e.is(r)&&e.is(r.NLSNAMEDETAILS)){let a=s.latest_tagValues;if(e.is(a)){let s=a.length;if(s){let l={},c=0;for(c=0;c<s;c++){var o=a[c];if("sixw:ds6w:where/ds6w:source/ds6w:dataSource"===o.sixw||"ds6w:where/ds6w:source/ds6w:dataSource"===o.sixw||"ds6w:where/ds6w:context/ds6w:project"===o.sixw){let t=o.sources;if(e.is(t)&&t.length){let i=t[0],s=l[i];if(!e.is(s)){s=[];let t=r.NLSNAMEDETAILS["ds6w:dataSource"];e.is(t)&&(s.Nls=t[n.getServiceFromSource(i)]),l[i]=s}let a=s.count;e.is(a)?s.count=o.count+a:s.count=o.count}i+=o.count}}t._listOfSources&&delete t._listOfSources,t._listOfSources=l}}}return i}(o),u=c.getDimensions().width-100;if(0===(o._listOfMarker3Dexp&&o._listOfMarker3Dexp.length)&&0!==d&&(C(o,"3DExperience",o._listOfMarker3Dexp,"3DExperience",void 0,u,50,"fonticon-3ds",!1),!0===a)){let t=l._resultMgt&&l._resultMgt.embeddedTaggerTags;if(e.is(t)){let e=[];for(let i=0;i<t.groups.length;i++)e.push(t.groups[i].predicate);e.length&&"ds6w:dataSource"===e[0]&&O(o,"3DExperience")}}}function C(t,n,s,o,a,r,l,d,u){if(!e.is(t))return;let h=t,g=h._globe,p=h._container,_=h._MarkerInfo,f={uuid:n,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},m=o,v=g.addMarker(0,0,"","darkblue","",m,f);if(e.is(v)){let n=new _(p);n.markerPanel.addClassName("Search-Marker-3DExp"),n.markerPanel.addEventListener("click",function(e){D(v,t,n)}),n.markerPanel.addEventListener("mouseover",function(e){let t=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg_hover.png");this.setStyle("backgroundImage","url("+t+")")}),n.markerPanel.addEventListener("mouseout",function(t){let n=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg.png");e.is(this.activate)&&!0===this.activate&&(n=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg_Active.png")),this.setStyle("backgroundImage","url("+n+")")}),n.show=function(n,s,o,a){if(this.markerPanelDisplayed=n,n){let n=this.markerPanel.getChildren();n&&0===n.length&&(n=new e.Element("div",{class:"fonticon "+d}),this.markerPanel.title=s.description,this.markerPanel.addContent(n),e.is(u)&&!0===u&&((n=new e.Element("div",{class:"Search-Source-Title"})).setText(s.description),this.markerPanel.addContent(n)));let r=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg.png");e.is(this.markerPanel.activate)&&!0===this.markerPanel.activate&&(r=i.getWebappsAssetUrl("SNResultUX","images/3DEXP_Obj_White_Bg_Active.png")),this.markerPanel.setStyle("backgroundImage","url("+r+")");let l=P(t),c=k(t);this.markerPanel.style.left=c+o+"px",this.markerPanel.style.top=a+l+"px",this.markerPanel.style.display="block",this.markerPanel.setStyle("z-index","152")}else this.markerPanel.style.display="none",this.markerPanel.setStyle("resize","none"),this.markerPanel.setStyle("overflow","hidden")},n.show(!0,v,r,l),s&&s.push({marker:v,markerinfo:n})}let S=a;if(!e.is(S))return;f={uuid:n+"_Count",descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},m=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:S}),1===S&&(m=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:S})),m=o+": "+m;let w=g.addMarker(0,0,0,"darkblue",S,m,f);if(e.is(w)){let n=new _(p);n.markerPanel.addClassName("Search-MarkerInfo"),n.show=function(n,s,o,a){if(this.markerPanelDisplayed=n,n){let n=this.markerPanel.getChildren();n&&0===n.length&&(n=new e.Element("div",{class:"SearchMarkerInfo-count"}),this.markerPanel.title=s.description,n.setText(s.title),this.markerPanel.addContent(n));let r=i.getWebappsAssetUrl("SNResultUX","images/cluster_clusters.png");this.markerPanel.setStyle("backgroundImage","url("+r+")");let l=P(t),c=k(t);this.markerPanel.style.left=c+o+50+"px",this.markerPanel.style.top=a+l+40+"px",this.markerPanel.style.display="block",this.markerPanel.setStyle("z-index","153")}else this.markerPanel.style.display="none",this.markerPanel.setStyle("resize","none"),this.markerPanel.setStyle("overflow","hidden")},n.show(!0,w,r,l),s&&s.push({marker:w,markerinfo:n})}}function y(t){if(!e.is(t))return;let i=t,n=(i._container,i._container.getParent()),s=n&&n.getDimensions();window.devicePixelRatio,s.width,s.height;if(!e.is(i._listOfSources))return;I(t,!0);let o=x(t),a=Object.keys(i._listOfSources),r=a.length,l=0;for(l=0;l<r;l++){let n=a[l],s=i._listOfSources[n];if(e.is(s)){let e=s.Nls,a=s.count;if("3dspace"===n){let s=o["3dspace"].left,r=o["3dspace"].top;C(t,n,i._listOfMarkersSources,e,a,s,r,"fonticon-3dspace",!0)}else if("swym"===n){let s=o.swym.left,r=o.swym.top;C(t,n,i._listOfMarkersSources,e,a,s,r,"fonticon-logo-3dswym",!0)}else if("drive"===n){let s=o.drive.left,r=o.drive.top;C(t,n,i._listOfMarkersSources,e,a,s,r,"fonticon-component",!0)}}}}function I(t,n){let s=t;if(null===s._3DExperienceLogo){s._3DExperienceLogo=new e.Element("div",{class:"Search-Marker-Logo"}).inject(s._container);let t=i.getWebappsAssetUrl("SNResultUX","images/3DEXPERIENCE_bg.png");s._3DExperienceLogo.setStyle("backgroundImage","url("+t+")"),s._3DExperienceLogo.setStyle("z-index","151")}if(n){let e=s._container.getParent(),i=e&&e.getDimensions(),n=P(t),o=k(t),r=(window.devicePixelRatio,574);i.height<r?r=350:i.width>=400&&i.width<540?r=350:i.width<=399&&(r=250);let l=o+.5*i.width-.5*r,c=.5*(i.height+n)-.5*r+30;0===["iphone"].indexOf(a.getDeviceCategory())&&(c<249?(r=150,l=o+.5*i.width-.5*r,c=.5*(i.height+n)-.5*r+30):(r=250,l=o+.5*i.width-.5*r,c=.5*(i.height+n)-.5*r));let d=r.toString()+"px";s._3DExperienceLogo.setStyle("min-width",d),s._3DExperienceLogo.setStyle("min-height",d),s._3DExperienceLogo.style.left=l+"px",s._3DExperienceLogo.style.top=c+"px",s._3DExperienceLogo.style.display="block"}else s._3DExperienceLogo.style.display="none",s._3DExperienceLogo.setStyle("resize","none"),s._3DExperienceLogo.setStyle("overflow","hidden")}function D(t,i,n,s,o){if(!e.is(t)||!e.is(i))return;let a=i,r=a._globe,l=a._container,c=t.description,d=l.getParent(),u=d&&d.getDimensions(),h=(u.width,u.height,u.width-100);if("3DExperience"===c){let i=n.markerPanel.activate;if(!e.is(i)||!1===i||e.is(o)){if(n.markerPanel.activate=!0,0===a._listOfMarkersSources.length?y(a):A(a,!0),!e.is(s)){let t=a._collection.getTaggerProxy();if(e.is(t)&&e.is(t._requestGroupingChange,"function")){var g={rootW:"ds6w:where",predicate:"ds6w:dataSource"};t._requestGroupingChange(g)}}a._globe.turnGlobeToLatLon(a._globe.globe.camera.lat,a._globe.globe.camera.lon,6.2),m(!1,a._listOfMarkerInfo,r,!0),m(!1,a._listOfMarker3Dexp,r,!0),l.addClassName("mini"),a._3DExperienceSelected=!0,a._globe.allowZoom(!1),a._globe.globe.overlayDisplayed=!0}else{if(n.markerPanel.activate=!1,!e.is(s)){let t=a._collection.getTaggerProxy();if(e.is(t)&&e.is(t._requestGroupingChange,"function")){g={rootW:"ds6w:where",predicate:"computedCountryInfo"};t._requestGroupingChange(g)}}a._globe.turnGlobeToLatLon(a._globe.globe.camera.lat,a._globe.globe.camera.lon,a._lastZoom),m(!1,a._listOfMarkerInfo,r),A(a,!1),l.removeClassName("mini"),setTimeout(function(){m(!0,a._listOfMarkerInfo,r)},650),a._3DExperienceSelected=!1,a._globe.allowZoom(!0),a._globe.globe.overlayDisplayed=!1,n.show(!0,t,h,50)}}else N(a,c,!0)}function T(t){if(!e.is(t))return;let i=t,n=(i._globe,i._container,i._container.getParent()),s=n&&n.getDimensions(),o=s.width-100;for(let t=i._listOfMarker3Dexp.length-1;t>=0;t--){let n=i._listOfMarker3Dexp[t];e.is(n)&&e.is(n.markerinfo)&&n.markerinfo.show(!i._3DExperienceSelected,n.marker,o,50)}A(t,i._3DExperienceSelected),setTimeout(function(){if(e.is(i._DockingElement)&&e.is(i._DockingElement.ExCol)){let e=i._DockingElement.ExCol,n=(P(t),k(t)),o=s.width-20;i._DockingElement.style.left="expanded"===e?n+o+"px":n-20+"px"}},100)}function A(t,i){if(!e.is(t))return;let n=t,s=(n._globe,n._container,n._container.getParent()),o=s&&s.getDimensions(),a=(window.devicePixelRatio,o.width,o.height,x(t));for(let t=n._listOfMarkersSources.length-1;t>=0;t--){let s=n._listOfMarkersSources[t];if(e.is(s)&&e.is(s.markerinfo)){let e=s.marker.uuid,t=0,n=0;-1!==e.indexOf("3dspace")?(t=a["3dspace"].left,n=a["3dspace"].top):-1!==e.indexOf("swym")?(t=a.swym.left,n=a.swym.top):-1!==e.indexOf("drive")&&(t=a.drive.left,n=a.drive.top),s.markerinfo.show(i,s.marker,t,n)}}I(t,i)}function x(t){if(!e.is(t))return;let i=t,n=(i._globe,i._container,i._container.getParent()),s=n&&n.getDimensions(),o=.5*s.width,r=.5*s.height,l=P(t),c=574;s.height<c?c=350:s.width>=400&&s.width<540?c=350:s.width<=399&&(c=250),0===["iphone"].indexOf(a.getDeviceCategory())&&(c=r<249?150:250);let d=o-40,u=o-.5*c+60,h=o+.5*c-120,g=.5*(s.height+l),p=r-.5*c+25;return 250===c?(u=.5*o-30,g=.5*s.height,h=.5*o+150,p=r-170):150===c&&(u=.5*o,g=.5*s.height,h=.5*o+130,p=r-120),{"3dspace":{left:u,top:g},swym:{left:d,top:p},drive:{left:h,top:g}}}function N(i,n,s){if(!e.is(i))return;let o=i,a=o._globe,r=o._container,l=o._listOfMarkersSources.length-1,c=l;for(-1===l&&e.is(n)&&0!==n.length&&b(o._globe,o._container,o._MarkerInfo,o,!0),c=l=o._listOfMarkersSources.length-1;c>=0;c--){let t=o._listOfMarkersSources[c];e.is(t)&&e.is(t.markerinfo)&&(t.markerinfo.markerPanel.activate=!1)}for(c=l;c>=0;c--){let i=o._listOfMarkersSources[c];if(e.is(i)&&e.is(i.markerinfo)){let a=i.marker.description;a===n&&(i.markerinfo.markerPanel.activate=!0,c=-1,e.is(s)&&!0===s&&o.dispatchEvent("On3DExperienceChange",a),t.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"clickOnSourceCategory",persDim:{pd1:n}}}))}}o._3DExperienceSelected=!0,e.is(s)||(A(o,!0),o._globe.turnGlobeToLatLon(o._globe.globe.camera.lat,o._globe.globe.camera.lon,6.2),m(!1,o._listOfMarkerInfo,a),m(!1,o._listOfMarker3Dexp,a),r.addClassName("mini"),o._globe.allowZoom(!1),o._globe.globe.overlayDisplayed=!0)}function O(t,i){if(!e.is(t))return;let n=t;for(let s=n._listOfMarker3Dexp.length-1;s>=0;s--){let o=n._listOfMarker3Dexp[s];if(e.is(o)){let n=o.marker;e.is(n)&&n.uuid===i&&e.is(o.markerinfo)&&(D(n,t,o.markerinfo,!1,!0),s=-1)}}}function P(t){if(!e.is(t))return 0;let i=10,n=t&&t._resultMgt&&e.extendElement(t._resultMgt.getContent().querySelector(".embedded-tagger-view"));if(e.is(n)&&"none"!==n.getStyle("display")){let t=n.getDimensions();e.is(t)&&(i+=t.height)}return i}function E(t){if(!e.is(t))return;let i=t;if(e.is(i._globe)){i._globe.clearMarkers(),S(t),S(t,i._listOfMarker3Dexp),S(t,i._listOfMarkersSources),i._listOfMarker3Dexp=[],i._listOfMarkersSources=[],i._3DExperienceSelected=!1,i._globe.allowZoom(!1),i._globe.globe.overlayDisplayed=!0;let n=i._container;e.is(n)&&n.removeClassName("mini"),i._3DExperienceLogo&&(e.is(n)&&n.removeChild(i._3DExperienceLogo),i._3DExperienceLogo=null)}}function k(t){let i=0,n=document.getElementsByClassName("search-globe-view")[0];return e.is(n)&&(i=n.getStyle("margin-left"),e.is(i)&&i.length&&(i=i.replace("px",""),i=parseFloat(i))),i}return{refineEmptyCountry:function(e,t,i,n,s,o){return d(e,t,i,n,s,o)},cleanCountryFilter:function(e){return g(e)},refineCountry:function(e,t,i,n,s,o){return u(e,t,i,n,0,o)},refineCountryList:function(t,i,n,s,o,a){return function(t,i,n,s,o,a){if(!(e.is(i)&&e.is(n)&&e.is(s)&&e.is(a)&&e.is(t)))return;let r=t,l=o,u=Object.keys(i),h=u.length;if(1===h&&u[0]===o)return l;l="countries";let _=n.getTaggerProxy();if(e.is(_)){let t={condition:[],operator:"AND",isSimplified:{version:2}},i=g(n);e.is(i)&&e.is(i.filters)&&(e.is(i.index)&&-1!==i.index&&i.filters.condition.splice(i.index,1),t=i.filters);let m=function(){r.mask(),_.setLocalFilter(t,!0)},v=0;for(var f=0;f<h;f++)p(u[f],{onComplete:function(i){e.is(i)&&(t.condition.push(i),++v===h&&m.call(this))}},a);0===h&&(l=d(r,c.get("SearchGlobe_nocountry"),n,s,o,a))}return l}(t,i,n,s,o,a)},refineContinent:function(e,t,i,n,s,o){return h(e,t,i,n,s,o)},buildContinentsCountriesMarkers:function(t,i,n,s,o,a,r,l,c,d){return function(t,i,n,s,o,a,r,l,c,d){if(!e.is(n)||!e.is(i))return;let u=d,h=[],g=n[t];e.is(g)&&g.countries&&(h=_(g.countries,i,o,a,r,l,d));let p=s.find(e=>e.name===t);if(e.is(p)&&e.is(p.pos)){let e=parseFloat(p.pos.latitude),t=parseFloat(p.pos.longitude);d._lastZoom=d._zoomContinent,i.turnGlobeToLatLon(e,t,d._lastZoom),setTimeout(function(){m(!u._3DExperienceSelected,h,i)},d._delay)}return h}(t,i,n,s,o,a,r,l,0,d)},addMarkersCountries:function(e,t,i,n,s,o,a,r){return _(e,t,i,n,s,o,a,r)},showMarkersinfo:function(e,t,i){return m(e,t,i)},addMarkersCountry:function(t,i,n,s,o,a){return function(t,i,n,s,o,a){if(!e.is(i)||!e.is(t))return;let r=[],l=t.title,d=parseFloat(t.pos.latitude),u=parseFloat(t.pos.longitude),h=n[l];if(e.is(h)){let t={uuid:l,descriptionType:"txt",image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAz5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+DQo8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA2LjAtYzAwMiA3OS4xNjQ0NjAsIDIwMjAvMDUvMTItMTY6MDQ6MTcgICAgICAgICI+DQogIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+DQogICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIxLjIgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUIwN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUIxN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIj4NCiAgICAgIDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjExRDgzOUFFN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjExRDgzOUFGN0MzNzExRUJCQ0VDQTNDMjE3QjdBQjUwIiAvPg0KICAgIDwvcmRmOkRlc2NyaXB0aW9uPg0KICA8L3JkZjpSREY+DQo8L3g6eG1wbWV0YT4NCjw/eHBhY2tldCBlbmQ9InIiPz5CqkeQAAAAJElEQVQ4T2NgJBKMKsQLRhXiBaMK8YJRhXjBqEK8YPArZGQEAAyUBkHVJODYAAAAAElFTkSuQmCC"},n=h.count,g=c.replace(c.get("SearchGlobe_continent_results"),{nbResult:n});1===n&&(g=c.replace(c.get("SearchGlobe_continent_result"),{nbResult:n})),g=l+": "+g;let p=i.addMarker(d,u,0,"darkblue",n,g,t);e.is(p)&&f(p,r,s,o,0,a,!1)}return r}(t,i,n,s,o,a)},buildContinents:function(t,i,n,s,o,a,r,l,c,d,u,h){return function(t,i,n,s,o,a,r,l,c,d,u,h){if(!e.is(n)||!e.is(s))return;let g=u,p={},f=[],S=Object.keys(n),b=S.length;for(var C=0;C<b;C++){let t=S[C],i=n[t];if(e.is(i)){let n=i.countryCode;if(n){i.iso3=a[n];let o=s.find(e=>e.countryCode===n);if(o){o.iso3=i.iso3,o.title=t;let n=o.continent,s=p[n];if(e.is(s)||(s={title:r[n],count:0,countries:{}},p[n]=s),e.is(s)){let n=s.count;e.is(n)?s.count=i.count+n:s.count=i.count,s.countries[t]=i}}}}}let y=!0;if(1===(b=(S=Object.keys(p)).length)){let n=w(g._collection);if(e.is(n)&&e.is(n.predicate)&&e.is(n.object,"array")&&"ds6w:where/ds6w:location/computedCountryInfo"===n.predicate){if(1===n.object.length){let a=p[S[0]];if(e.is(a)){let r=a.countries;f=_(r,t,i,s,c,d,u);let l=o.find(e=>e.name===S[0]);if(e.is(l)&&e.is(l.pos)){let e=parseFloat(l.pos.latitude),i=parseFloat(l.pos.longitude);u._lastZoom=u._zoomContinent,u._latRefine=n.object[0],t.turnGlobeToLatLon(e,i,u._lastZoom),setTimeout(function(){m(!g._3DExperienceSelected,f,t)},u._delay)}}}y=!1}}return!0===y&&(f=v(p,r,t,o,c,d,u,l,h)),{continentsList:p,listOfMarkerInfo:f,lastZoom:l}}(t,i,n,s,o,a,r,l,c,d,u,h)},turnGlobeToLatLonCountry:function(t,i,n,s){return function(t,i,n,s){if(!e.is(t))return;let o=i.find(e=>e.countryCode===t.countryCode);if(e.is(o)&&e.is(o.pos)){let e=parseFloat(o.pos.latitude),t=parseFloat(o.pos.longitude);s=1.5,n.turnGlobeToLatLon(e,t,s)}return s}(t,i,n,s)},buildContinentsMarkers:function(e,t,i,n,s,o,a,r,l){return v(e,t,i,n,s,o,a,r,l)},removeMarkersinfo:function(e,t){return S(e,t)},refreshFromMultiview:function(t,i,n,s,o,a){return function(t,i,n,s,o,a){if(!e.is(t)||!e.is(t.collections)||!e.is(i))return t;let r=a,l=t.collections,c=l.length,d=0,u=0;d=e.is(n)&&n.length,u=e.is(o)&&o.length;let h=0;for(;h<c;h++){let t=l[h];if(e.is(t)){let i=t.headTitle,s=t.hits;if(e.is(i)){let t=0;for(;t<d;t++){let o=n[t];if(e.is(o)){let n=o.marker;if(e.is(n)){let a=n.description;-1!==a.indexOf(i)&&(n.description=a.replace(n.title,s),n.title=s,e.is(o.markerinfo.markerPanel)&&e.is(o.markerinfo.markerPanel.getChildren())&&e.is(o.markerinfo.markerPanel.getChildren()[0])&&o.markerinfo.markerPanel.getChildren()[0].setText(n.title),t=d)}}}for(t=0;t<u;t++){let n=o[t];if(e.is(n)){let o=n.marker;if(e.is(o)){let a=o.description;-1!==a.indexOf(i+":")&&(o.description=a.replace(o.title,s),o.title=s,e.is(n.markerinfo.markerPanel)&&e.is(n.markerinfo.markerPanel.getChildren())&&e.is(n.markerinfo.markerPanel.getChildren()[0])&&n.markerinfo.markerPanel.getChildren()[0].setText(o.title),t=u)}}}}}}m(!r._3DExperienceSelected,n,s),e.is(o)&&A(r,r._3DExperienceSelected)}(t,i,n,s,o,a)},findCountryByLocalFilters:function(e){return w(e)},zoomOnVIPCountry:function(t,i,n,s){return function(t,i,n,s){if(!e.is(i)||!e.is(t)||!e.is(n))return;let o,a=Object.keys(i),r=a.length,l=0,c=0;for(let t=0;t<r;t++){let n=a[t],s=i[n];e.is(s)&&(l=s.count)>c&&(c=l,o=n)}if(e.is(o)){let a=i[o],r=n.find(e=>e.countryCode===a.countryCode);if(e.is(r)&&e.is(r.pos)){let e=parseFloat(r.pos.latitude),i=parseFloat(r.pos.longitude);t.turnGlobeToLatLon(e,i,s)}}}(t,i,n,s)},addMarker3DExp:(e,t,i,n,s)=>b(e,t,0,n,s),refresh3DExperienceMarkers:e=>T(e),createMain3DExperienceMarker:e=>y(e),back:function(t,i){if(!e.is(t)||!e.is(i))return;let n=i;if(e.is(t.groups)&&e.is(t.groups[0])){let s,o=[];for(let e=0;e<t.groups.length;e++)o.push(t.groups[e].predicate);if("computedCountryInfo"===(s=o&&o.length&&o[0])){m(!1,n._listOfMarkerInfo,n._globe),S(i);let s=t.groups[0].object;if(1===s.length){let t=s[0].dispText,i=Object.keys(n._continentsList);if(e.is(i)){let e,s=i.length;for(let o=0;o<s;o++)n._continentsList[i[o]].title===t&&(e=i[o],o=s);h(n,e,n._collection,n._latRefine,n._continents,n._continentsList),n._latRefine=e}}else{let t=n._cleanCountryFilter();if(e.is(t)&&e.is(t.filters)){e.is(t.index)&&-1!==t.index&&t.filters.condition.splice(t.index,1);let i=t.filters,s=n._collection.getTaggerProxy();e.is(s)&&(n.mask(),s.setLocalFilter(i,!0))}n._latRefine="continent"}}else"ds6w:dataSource"===s&&function(t){let i=t,n=i._resultMgt&&i._resultMgt.skeleton.getCurrentView();if(e.is(n)&&e.is(n.On3DExperienceChange,"function")){let t=n._lastRefineSource;if(e.is(t)&&t.length){let s;if("refine"===t)s="lastSource";else{s="global";let t=i._listOfMarkersSources.length-1;for(;t>=0;t--){let n=i._listOfMarkersSources[t];e.is(n)&&e.is(n.markerinfo)&&(n.markerinfo.markerPanel.activate=!1)}A(i,!0)}n.back3DExperience(s)}}}(n)}return!0},hideAndLock:function(t,i){if(!e.is(t))return;let n=t;e.is(n._globe)&&(n._globe.allowZoom(i),n._globe.globe.overlayDisplayed=!i),!1===i&&E(t)},refineCountry:function(t){return function(t){if(!e.is(t))return;let i,n=t,s=w(n._collection);if(e.is(s))if(e.is(s.predicate)&&"ds6w:where/ds6w:location/computedCountryInfo"===s.predicate){let t=n._ClusterSet[s.display];i=e.is(t)?{country:!0,countryId:s.display}:{country:!1,continent:s.display}}else if(e.is(s.predicate)&&"ds6w:where/ds6w:source/ds6w:dataSource"===s.predicate)i={source:!0,display:s.display,object:s.object,condition:s.condition};else{let t=s.computedCountryInfo;if(e.is(t)){let s=n._ClusterSet[t.display];i=e.is(s)?{country:!0,countryId:t.display}:{country:!1,continent:t.display}}}return i}(t)},activate3DExperience:function(e,t){return O(e,t)},manageActivationSourcesMarkers:function(e,t){return N(e,t)},removeallMarkers:function(e){return E(e)},retrieveOwnerFromGroup:function(t){return function(t){if(!e.is(t))return;let i=[],n=t.groups[0].object;if(e.is(n)){let t=n.length;for(let s=0;s<t;s++){let t=n[s];e.is(t.object,"object")&&e.is(t.object.predicates,"array")&&e.is(t.object.value,"array")&&t.object.predicates.length===t.object.value.length&&(i=i.concat(t.object.value))}}return i}(t)},createdockingView:function(t){return function(t){let i=t,n=i._globe,s=i._container.getParent(),o=s&&s.getDimensions(),a=o.width-20,r=.5*o.height-20,l=P(t),d=k();if(null===i._DockingElement){i._DockingElement=new e.Element("div",{class:"Search-docking"}).inject(s),e.Element("span",{class:"fonticon fonticon-chevron-left left"}).inject(i._DockingElement),i._DockingElement.title=c.get("SearchGlobe_collapsed"),i._DockingElement.style.left=d+a+"px",i._DockingElement.style.top=l+r+"px",i._DockingElement.style.display="block",i._DockingElement.ExCol="expanded",i._DockingElement.onclick=(()=>{if(i._DockingElement.classList.contains("collapsed"))s.classList.add("expanded"),i._DockingElement.classList.remove("collapsed"),s.classList.remove("collapsed"),i._DockingElement.ExCol="expanded",setTimeout(function(){o=s&&s.getDimensions(),a=o.width-20,d=k(),i._DockingElement.innerHTML='<span class="fonticon fonticon-chevron-left left"></span>',i._DockingElement.style.left=d+a+"px",i._DockingElement.title=c.get("SearchGlobe_collapsed");let e=i._resultMgt&&i._resultMgt.skeleton.getWhereView();e._MaxDisplay=!1,e.manageDisplayChannelView("normal"),(e&&e.nestedView&&e.nestedView.container).getChildren()[0].classList.remove("expanded"),m(!i._3DExperienceSelected,i._listOfMarkerInfo,n),T(i)},1e3);else{i._DockingElement.ExCol="collapsed",s.classList.remove("expanded"),m(!1,i._listOfMarkerInfo,n),m(!1,i._listOfMarker3Dexp,n),setTimeout(function(){i._DockingElement.classList.add("collapsed"),s.classList.add("collapsed"),i._DockingElement.innerHTML='<span class="fonticon fonticon-globe globe"></span> <span class="fonticon fonticon-chevron-right chevron"></span>',d=k(),i._DockingElement.title=c.get("SearchGlobe_expanded"),i._DockingElement.style.left=d-20+"px"},900);let e=i._resultMgt&&i._resultMgt.skeleton.getWhereView();e._MaxDisplay=!0;let t=e&&e.nestedView&&e.nestedView.container;e.manageDisplayChannelView("normal"),t.getChildren()[0].classList.add("expanded")}});let u=i._container.querySelector("canvas");e.is(u)&&u.addEventListener("click",function(){if(!0===i._3DExperienceSelected)for(let n=i._listOfMarker3Dexp.length-1;n>=0;n--){let s=i._listOfMarker3Dexp[n];if(e.is(s)){let i=s.marker;e.is(i)&&"3DExperience"===i.uuid&&e.is(s.markerinfo)&&(D(i,t,s.markerinfo),n=-1)}}},!1)}}(t)},getGroupForPredicateWho:function(t,i,n){return function(t,i,n){if(!e.is(t)||!e.is(i))return;let s={group:void 0,refine:n},o=w(t.collection);if(e.is(o)&&e.is(o.predicate)&&"ds6w:who/person"===o.predicate){let t=e.is(o.value)?o.value:o.object;if(e.is(t)){let o,a=e.clone(i),r=a.groups[0].object,l=r.length,c=!1;for(let i=0;i<l;i++)if(o=r[i],e.is(o)&&e.is(o.object)){let n=o.object;if(e.is(n)){let s=n.value,r=n.predicates;if(e.is(s)){let e=s.length;for(let d=0;d<e;d++)if(s[d]===t){let s=r[d];n.predicates=[],n.value=[],n.predicates.push(s),n.value.push(t),a.groups[0].object=[],a.groups[0].object.push(o),d=e,i=l,c=!0}}}}if(1==c&&e.is(o)){let i=o.subGroups;if(e.is(i)){l=i.length;for(let n=0;n<l;n++)if(o=i[n],e.is(o)&&e.is(o.object)){let i=o.object;if(e.is(i)){let s=i.value,r=i.predicates;if(e.is(s)){let e=s.length;for(let d=0;d<e;d++)if(s[d]===t){let s=r[d];i.predicates=[],i.value=[],i.predicates.push(s),i.value.push(t),a.groups[0].object[0].subGroups=[],a.groups[0].object[0].subGroups.push(o),d=e,n=l,c=!0}}}}}}e.is(n)&&"continent"!==n&&(a.groups[0].object=[],a.groups[0].object.push(o),s.refine=o.dispText),s.group=a}}return s}(t,i,n)},getPredicateType:function(t,i){let n;if(!e.is(i)){let i=w(t);return e.is(i)&&e.is(i.predicate)&&("ds6w:where/ds6w:location/computedCountryInfo"===(n=i.predicate)?n="computedCountryInfo":"ds6w:where/ds6w:source/ds6w:dataSource"===n&&(n="ds6w:dataSource")),n}let s=[];if(i.groups)for(let e=0;e<i.groups.length;e++)s.push(i.groups[e].predicate);return n=s&&s.length&&s[0]}}}),define("DS/SNResultUX/views/helpers/utils/GlobeView",["UWA/Core","UWA/Class/View","WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Mask","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","DS/SNResultUX/views/helpers/utils/SearchGlobeViewUtils","text!DS/SNResultUX/assets/SearchGlobe/countries.json","text!DS/SNResultUX/assets/SearchGlobe/CountriesISO3.json","text!DS/SNResultUX/assets/SearchGlobe/continentsPos.json","text!DS/SNResultUX/assets/nls/continents.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f){"use strict";return t.extend(a,{uwaClassName:"SearchGlobeView",name:"search_globe",_globe:null,_collection:null,_ClusterSet:null,_countries:null,_countriesISO3:null,_continents:null,_continentsList:null,_continentsPos:null,_indexSelectedCountry:-1,_latRefine:"",_listOfpersons:null,_container:null,_MarkerInfo:null,_lastZoom:6.72,_ClusterSetFromTopbar:null,_iphone:-1,_resultMgt:null,_lastSelectedCountry:null,_subjectsTagsCloned:null,_tagValuesCloned:null,_listOfMarkerInfo:[],_listOfMarker3Dexp:[],_listOfMarkersSources:[],_zoomContinent:3.05,_zoomCountry:1.5,_zoomContinentGlobe:6.72,_tagDatas:null,_listOfSources:null,_3DExperienceSelected:!1,_3DExperienceLogo:null,_delay:0,_MapView:null,_markersMapView:null,_geolocationHierarchy:!0,_3DEXPERIENCEAsContinent:!0,_geoActivate:!0,_3DEXPERIENCEActivate:!1,_WhereIsActivate:!0,_DockingElement:null,_mustUpdateGroup:!1,init:function(e){return this._ClusterSet=null,this._continentsList=[],this._collection=e.collection,this._countries=JSON.parse(h),this._countriesISO3=JSON.parse(g),this._continents=JSON.parse(_),this._continentsPos=JSON.parse(p),this._listOfpersons=[],this._listOfMarkerInfo=[],this._latRefine="continent",this._resultMgt=null,this._lastSelectedCountry=null,this._subjectsTagsCloned=null,this._tagValuesCloned=null,this._listOfMarker3Dexp=[],this._tagDatas=null,this._listOfSources=null,this._listOfMarkersSources=[],this._3DExperienceSelected=!1,this._3DExperienceLogo=null,this._delay=500,this._geoActivate=!0,this._3DEXPERIENCEActivate=!1,this._WhereIsActivate=!0,this._DockingElement=null,this._mustUpdateGroup=!1,this._iphone=["iphone"].indexOf(r.getDeviceCategory()),0===this._iphone&&(this._delay=250,this._zoomContinentGlobe=8.79,this._lastZoom=this._zoomContinentGlobe),this._geolocationHierarchy=!0,!1===this._geolocationHierarchy&&(this._lastZoom=3,this._zoomContinent=this._lastZoom,this._zoomCountry=this._lastZoom,this._zoomContinentGlobe=this._lastZoom),this._3DEXPERIENCEAsContinent=!0,this._parent(e)},setup:function(t){var i=this;this.listenTo(i._collection,{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(e){},onSync:function(e){},onSetTags:function(t){if("where"===i.getCurrentViewId()){e.is(t)&&e.is(t.service_parameters)&&e.is(t.service_parameters.fromTopbar)&&!0===t.service_parameters.fromTopbar&&(i._subjectsTagsCloned&&delete i._subjectsTagsCloned,i._tagValuesCloned&&delete i._tagValuesCloned,i._subjectsTagsCloned=null,i._tagValuesCloned=null,i._subjectsTagsCloned=e.clone(i.collection.getTaggerProxy().latest_subjectsTags),i._tagValuesCloned=e.clone(i.collection.getTaggerProxy().latest_tagValues),i._lastZoom=i._zoomContinentGlobe,i._mustUpdateGroup=!0)}},onInitTreeDocumentAsyncCB:function(e){!0!==i._mustUpdateGroup&&i._computeRefineDisplay()},OnGroupingChange:function(t){e.is(t)&&e.is(t.forcedUpdate,"boolean")&&!0===t.forcedUpdate&&!1===i._mustUpdateGroup||(i._refreshViewFromOnGrouping(t),i._mustUpdateGroup=!1)}}),i.addEvent("On3DExperienceChange",i.On3DExperienceChange.bind(i)),s.subscribe("sideOnPanelOpen",i._updateUI.bind(i))},destroy:function(){this._globe&&this._globe.globe&&(this._globe.clearMarkers(),this._globe.globe.removeEvent("zoomEvent"),this._globe.globe.camera.removeEvent("cameraMoveEnd")),e.is(this._listOfpersons)&&(this._listOfpersons=[]),this._deleteMarkers(),this.stopListening(this._collection),this._globe.destroy(),this._parent()},render:function(t){var i=this;if(i._container=t.parentContainer,i._resultMgt=t.resultMgt,!0===t.globe){require(["DS/SocialGlobe/GlobeItf","DS/SocialGlobe/MarkerInfoManager","DS/SocialGlobe/MarkerInfo"],function(s,o,a){i._globe=s.create(i._container,t.use2D,!0),i._MarkerInfo=a,i._globe.allowZoom(!0),i._globe.autoTurn(0),i._globe.setCountrySelection(!1),i._globe.setInertia(50),i._globe.setHalo("#40a5de",.3),-1!==["iphone","ipad","android"].indexOf(r.getDeviceCategory())?i._globe.setBackgroundColor("#00163c",1):i._globe.setBackgroundColor("#005686",1),i._globe.setEditMode(!0),i._globe.changeSkin("natural",!0);i._globe.setMouseOverMarkersManager({onMouseMove:function(e,t,i){},onMouseClick:function(e,t,i){},onMouseOut:function(){},onClearMarkers:function(){}});i._globe.setMouseOverCountryManager({onMouseMove:function(e,t,i){},onMouseOut:function(){},onMouseClick:function(e,t,i){},onClearCountries:function(){}});let l=300;0===i._iphone&&(l=150),i._globe.globe.addEvent("zoomEvent",n.debounce(i._onZoom.bind(i),l)),i._globe.globe.camera.addEvent("cameraMoveEnd",i._onZoom.bind(i)),i._globe.globe.camera.addEvent("cameraMoveStart",i._onMoveStart.bind(i)),e.is(i._ClusterSet)||(i._subjectsTagsCloned&&delete i._subjectsTagsCloned,i._tagValuesCloned&&delete i._tagValuesCloned,i._subjectsTagsCloned=null,i._tagValuesCloned=null,i._subjectsTagsCloned=e.clone(i.collection.getTaggerProxy().latest_subjectsTags),i._tagValuesCloned=e.clone(i.collection.getTaggerProxy().latest_tagValues),i._setupCluster(!0)),i._globe.globe.displayHelp=function(){},i._globe.go(),!1===i._geolocationHierarchy&&i._displayAtStart(),i._createDockingElement(),i._resultMgt&&i._resultMgt.addEvent("onToggle6WResizeFullMode",function(e){u.showMarkersinfo(!1,i._listOfMarkerInfo,i._globe),u.showMarkersinfo(!1,i._listOfMarker3Dexp,i._globe),setTimeout(function(){u.showMarkersinfo(!i._3DExperienceSelected,i._listOfMarkerInfo,i._globe),u.refresh3DExperienceMarkers(i)},850)})})}return i._container.onresize=function(){i._removeMarkersinfo(!1)},this},displayCountryByUser:function(t){let i=this;if(!e.is(i._listOfpersons))return;let n=i._listOfpersons.find(e=>e.get("title")===t);if(e.is(n)){n.getCountry();let t=n.getCountryCode();if(e.is(t,"array")&&1===t.length){let e=t[0].split(".");t=e[1]}let s=i._countries.find(e=>e.countryCode===t);if(e.is(s)){i._globe.clearMarkers(),i._removeMarkersinfo();s.title;i._addMarkersCountry(s);let e=parseFloat(s.pos.latitude),t=parseFloat(s.pos.longitude);i._globe.turnGlobeToLatLon(e,t,1.35),i._lastZoom=1.35,setTimeout(function(){i._showMarkersinfo(!0)},i._delay)}}},_onZoom:function(t){var i=this;if(!e.is(i._ClusterSet))return;if(i._onMoveStart(),!1===i._geolocationHierarchy)return i._globe.clearMarkers(),i._removeMarkersinfo(),i._addMarkersCountries(i._ClusterSet,i._lastSelectedCountry),void setTimeout(function(){i._showMarkersinfo(!0)},500);let n=i._globe.globe.getBBox(),s=n.point.lat,o=n.point.lon,a=n.distance,r=(i._globe.globe.camera.level,i._globe.globe.camera.dist);if(r<=i._zoomContinent){let t={},n=s+.45*a,l=s-.45*a,c=o+.7*a,d=o-.7*a;0===i._iphone&&(n=s+1.5*a,l=s-1.5*a),r<=i._zoomCountry&&(n=s+.9*a,l=s-.9*a,c=o+a,d=o-a);let u=Object.keys(i._ClusterSetFromTopbar),h=u.length;for(let s=0;s<h;s++){let o=u[s],a=i._ClusterSetFromTopbar[o];if(e.is(a)){let s=i._countries.find(e=>e.countryCode===a.countryCode);if(e.is(s)&&e.is(s.pos)){let e=parseFloat(s.pos.latitude),i=parseFloat(s.pos.longitude);e<=n&&e>=l&&i<=c&&i>=d&&(t[o]=a)}}}if(i._lastZoom=r,i._zoomContinent>=r){if(Object.keys(t).length)i._buildContinentFromZoom(t);else{let n=i.findContinentFromPos(o,s);if(e.is(n)){let s=e.is(i._continentsList)&&i._continentsList[n];e.is(s)&&i._buildContinentFromZoom(t,n)}}}else i._showMarkersinfo(!0)}else if("continent"!==i._latRefine){u.hideAndLock(i,!1);let t=i._cleanCountryFilter();if(e.is(t)&&e.is(t.filters)){e.is(t.index)&&-1!==t.index&&t.filters.condition.splice(t.index,1),i.mask();let n=t.filters,s=i._collection.getTaggerProxy();e.is(s)&&s.setLocalFilter(n,!0)}i._latRefine="continent"}else i._showMarkersinfo(!0);i._lastZoom=r},_onMoveStart:function(){!1!==this._geolocationHierarchy?this._showMarkersinfo(!1):this._removeMarkersinfo(!1)},_setupCluster:function(t,i){let n=this;if(!e.is(n._collection))return;u.removeallMarkers(n),n._deleteMarkers(),e.is(n._ClusterSet)&&(delete n._ClusterSet,n._ClusterSet=null),e.is(n._listOfSources)&&(delete n._listOfSources,n._listOfSources=null),n._lastSelectedCountry=null,n._ClusterSet={},n._listOfpersons=[];let s=t;require(["DS/TagNavigator/simplified/utils/PersonUtils"],function(t){let i=[],o="OnPremise",a=n._collection.getTaggerProxy();if(e.is(a)){let t=e.is(a.get,"function")?a.get("tenant"):a.tenant;e.is(t)&&t.length&&(o=t)}if(e.is(a)){let t=a.latest_tagValues;if(e.is(t)){let s=[],o=a.getCurrentFilter();if(e.is(o)){let t=o.localfilters;if(e.is(t)&&e.is(t.condition)){t.condition.findIndex(function(t){let i=Object.keys(t);if(i&&i.length&&"ds6w:who/person"===i[0]){let i=t["ds6w:who/person"].condition;if(e.is(i)&&i.length>0){let e=i.length;for(var o=0;o<e;o++)s.push(i[o].object)}}else if(i&&i.length&&"ds6w:where/ds6w:location/computedCountryInfo"===i[0]){let i=t["ds6w:where/ds6w:location/computedCountryInfo"].condition;if(e.is(i)&&i.length>0){let t=i.length;if(1===t)s=i[t-1].value;else{let o=i[0],a=!1;if(e.is(o)){let t=o.object,i=Object.keys(n._continents),s=i.length;for(let o=0;o<s;o++){let r=n._continents[i[o]];e.is(r)&&r===t&&(a=!0,o=s)}}let r=0;!0===a&&(r=1);for(let n=r;n<t;n++)o=i[n],e.is(o)&&(s=s.concat(i[n].value))}}}})}}if(s.length)for(var l=0;l<t.length;l++){if("ds6w:who/ds6w:responsible"===(c=t[l]).sixw){let e=c.object;-1!==s.indexOf(e)&&i.push(c)}}else for(l=0;l<t.length;l++){var c;"ds6w:who/ds6w:responsible"===(c=t[l]).sixw&&i.push(c)}}}let h={userId:r.getUserId(),platformID:o};t.getUsersInfoFromSummary(i,h,function(t){var i={},o={};if(e.is(t,"array")&&(n._listOfpersons=t,t.forEach(function(t){var n,s,a=t.getCountry(),r=t.get("count");e.is(a,"array")&&1===a.length?((a=a.filter(function(e){return!!e})).forEach(function(s){if(!(n=i[s])){let o=t.get("personInfo").get("countryCode");if(e.is(o,"array")&&o.length){let e=o[0].split(".");o=e[1]}(n=[]).person=[],n.city=[],n.countryCode=o,i[s]=n}let o=n.count;e.is(o)?n.count=r+o:n.count=r,n.person.push(t)}),(s=t.getCity())&&(s=s.filter(function(e){return!!e})).forEach(function(e){var i=o[e];i||(i=[],o[e]=i),i.push(t),n.city[e]=o[e]})):(d.groupCollapsed("->SNResultUX/views/helpers/utils/GlobeView user have multiple countries or no country"),d.log("Title: ",t._attributes.title),d.log("Countries count: ",t._attributes.personInfo._attributes.country.length),d.groupEnd())}),!0===s&&(n._ClusterSetFromTopbar&&delete n._ClusterSetFromTopbar,n._ClusterSetFromTopbar=i),n._ClusterSet=i,n._tagDatas=e.clone(n._resultMgt.getEmbeddedTaggerTags()),n._globe)){if(n.unmask(),n._lastZoom<=n._zoomContinent)n._addMarkersCountries(n._ClusterSet,n._lastSelectedCountry),u.zoomOnVIPCountry(n._globe,n._ClusterSet,n._countries,n._lastZoom),setTimeout(function(){n._showMarkersinfo(!0)},n._delay);else{let t=u.findCountryByLocalFilters(n._collection);e.is(t)&&e.is(t.predicate)&&"ds6w:where/ds6w:location/computedCountryInfo"===t.predicate&&e.is(t.object,"array")&&t.object.length>1?n._computeRefineDisplay():n._buildContinents()}!0===n._3DEXPERIENCEAsContinent&&u.addMarker3DExp(n._globe,n._container,n._MarkerInfo,n,!0),!0===n._3DExperienceSelected?(n._globe.turnGlobeToLatLon(n._globe.globe.camera.lat,n._globe.globe.camera.lon,6.2),n._showMarkersinfo(!1),n._globe.allowZoom(!1),n._globe.globe.overlayDisplayed=!0):(n._globe.allowZoom(!0),n._globe.globe.overlayDisplayed=!1),n.refreshFromMultiview(n._resultMgt.skeleton.getWhereView())}})})},_addMarkersCountry:function(e){this._listOfMarkerInfo=u.addMarkersCountry(e,this._globe,this._ClusterSetFromTopbar,this._container,this._MarkerInfo,this)},_addMarkersCountries:function(e,t){this._listOfMarkerInfo=u.addMarkersCountries(e,this._globe,this._ClusterSetFromTopbar,this._countries,this._container,this._MarkerInfo,this,t)},_refineCountry:function(t){e.is(list)&&e.is(this._collection)&&(this._latRefine=u.refineCountryList(this,t,this._collection,this._globe,this._latRefine,this._ClusterSetFromTopbar))},_refineEmptyCountry:function(e){this._latRefine=u.refineEmptyCountry(this,e,this._collection,this._globe,this._latRefine,this._ClusterSetFromTopbar)},_refineCountryList:function(t){let i=this;if(!e.is(t)||!e.is(i._collection))return;let n=Object.keys(t);1===n.length&&i._latRefine===n[0]||(i._latRefine=u.refineCountryList(i,t,i._collection,i._globe,i._latRefine,i._ClusterSetFromTopbar))},_refineContinent:function(t){if(e.is(t)&&e.is(this._collection))return this._latRefine=t,u.refineContinent(this,t,this._collection,this._latRefine,this._continents,this._continentsList)},_cleanCountryFilter:function(){if(e.is(this._collection))return u.cleanCountryFilter(this._collection)},_buildContinents:function(){let t=this;if(!e.is(t._ClusterSet)||!e.is(t._countries))return;let i=u.buildContinents(t._globe,t._ClusterSetFromTopbar,t._ClusterSet,t._countries,t._continentsPos,t._countriesISO3,t._continents,t._lastZoom,t._container,t._MarkerInfo,t,!0);e.is(i)&&(t._continentsList=i.continentsList,t._listOfMarkerInfo=i.listOfMarkerInfo,t._lastZoom=i.lastZoom)},_turnGlobeToLatLonCountry:function(t){e.is(this._ClusterSet)&&e.is(this._countries)&&u.turnGlobeToLatLonCountry(t,this._countries,this._globe,this._lastZoom)},_buildContinentsMarkers:function(t){e.is(this._continentsList)&&e.is(this._globe)&&(this._listOfMarkerInfo=u.buildContinentsMarkers(this._continentsList,this._continents,this._globe,this._continentsPos,this._container,this._MarkerInfo,this,this._zoomContinentGlobe,t),this._lastZoom=this._zoomContinentGlobe)},_showMarkersinfo:function(t){if(!e.is(this._listOfMarkerInfo))return;let i=this._listOfMarkerInfo;!0===this._3DExperienceSelected&&(i=[]),u.showMarkersinfo(t,i,this._globe)},_removeMarkersinfo:function(){e.is(this._listOfMarkerInfo)&&u.removeMarkersinfo(this)},_deleteMarkers:function(){let t=this;t._globe&&t._globe.globe&&t._globe.clearMarkers(),e.is(t._listOfMarkerInfo)&&(u.removeMarkersinfo(t,t._listOfMarkerInfo),t._listOfMarkerInfo=[]),e.is(t._listOfMarker3Dexp)&&(u.removeMarkersinfo(t,t._listOfMarker3Dexp),t._listOfMarker3Dexp=[]),e.is(t._listOfMarkersSources)&&(u.removeMarkersinfo(t,t._listOfMarkersSources),t._listOfMarkersSources=[]),t._3DExperienceSelected=!1},_updateUI:function(t){let i=this;e.is(t)&&e.is(t.position)&&"maximized"===t.position&&(i._showMarkersinfo(!0),u.refresh3DExperienceMarkers(i))},_buildContinentFromZoom:function(t,i){if(!e.is(this._ClusterSetFromTopbar))return;let n=e.is(i)?i:void 0;if(!e.is(n)){let i=e.is(t)&&Object.keys(t);if(i.length){let t=i[0],s=this._ClusterSetFromTopbar[t];if(e.is(s)){let e=s.countryCode,t=this._countries.find(t=>t.countryCode===e);t&&(n=t.continent)}}}if(e.is(n)&&0!==n.length){let e=u.refineContinent(this,n,this._collection,this._latRefine,this._continents,this._continentsList);this._latRefine=n,!1===e?u.hideAndLock(this,!1):this._showMarkersinfo(!0)}},back:function(){let t=this;if(e.is(t._globe)){if(!1===this._geolocationHierarchy){let i=t._collection.getTaggerProxy();return e.is(i)&&i.setTags(t._subjectsTagsCloned,t._tagValuesCloned),void t._displayAtStart()}return u.back(t._resultMgt.getEmbeddedTaggerTags(),t)}},clickOnTitleMultiView:function(t){let i=this;if(e.is(i._globe)&&e.is(t)&&e.is(t.element)&&!1===i._geolocationHierarchy){let n=i._countries.find(e=>e.title===t.element);if(e.is(n)){i._globe.clearMarkers(),i._removeMarkersinfo(),i._addMarkersCountry(n);let e=parseFloat(n.pos.latitude),t=parseFloat(n.pos.longitude);i._lastZoom=1.35,i._globe.turnGlobeToLatLon(e,t,i._lastZoom),setTimeout(function(){i._showMarkersinfo(!0)},500)}}},refreshFromMultiview:function(e){u.refreshFromMultiview(e,this._ClusterSetFromTopbar,this._listOfMarkerInfo,this._globe,this._listOfMarkersSources,this)},_refreshViewFromOnGrouping:function(t){if(!e.is(t))return;let i=this,n=!1;if(i._WhereIsActivate=!1,e.is(t)||(n=!0),e.is(t,"object")&&e.is(t.groups,"array")&&0==t.groups.length&&(n=!0),1==n)return;let s,o=[];for(let e=0;e<t.groups.length;e++)o.push(t.groups[e].predicate);s=o&&o.length&&o[0],i._geoActivate=!1,i._3DEXPERIENCEActivate=!1,d.log("->SNResultUX/views/helpers/utils/GlobeView _refreshViewFromOnGrouping"),"computedCountryInfo"===s?(i._WhereIsActivate=!0,!0===i._3DExperienceSelected&&u.activate3DExperience(i,"3DExperience"),i._lastZoom=i._zoomContinentGlobe,i._setupCluster(!0,t),d.log("->SNResultUX/views/helpers/utils/GlobeView _refreshViewFromOnGrouping predicate: ",s),i._globe.allowZoom(!0),i._globe.globe.overlayDisplayed=!1,i._geoActivate=!0):"ds6w:dataSource"===s&&(i._WhereIsActivate=!0,!1===i._3DExperienceSelected&&(u.activate3DExperience(i,"3DExperience"),i._3DEXPERIENCEActivate=!0),d.log("->SNResultUX/views/helpers/utils/GlobeView _refreshViewFromOnGrouping predicate: ",s))},_computeRefineDisplay:function(){let t=this;if(!1===t._WhereIsActivate)return;t.getCurrentViewId();t._lastSelectedCountry=null,t._3DEXPERIENCEActivate=!1,d.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay");let i=u.getPredicateType(t._collection),n=u.refineCountry(t);if(e.is(n)){if(!0===n.country){let e=n.countryId;d.log("->SNResultUX/views/helpers/utils/GlobeView _computeDisplay found country: ",e),u.removeallMarkers(t),u.addMarker3DExp(t._globe,t._container,t._MarkerInfo,t,!1),t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._3DEXPERIENCEActivate=!1;let i=t._ClusterSet[e];d.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Country Selected found: ",i),t._lastSelectedCountry=i,t._globe.clearMarkers(),t._removeMarkersinfo(),t._turnGlobeToLatLonCountry(i),t.unmask(),t._addMarkersCountries(t._ClusterSet,i),setTimeout(function(){t._showMarkersinfo(!0)},t._delay),t._latRefine=e}else if(e.is(n.continent)){u.removeallMarkers(t),t._3DEXPERIENCEActivate=!1,t.unmask(),u.addMarker3DExp(t._globe,t._container,t._MarkerInfo,t,!1),t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1;let i,s=n.continent,o=Object.keys(t._continentsList);if(e.is(o)){let e=o.length;for(let n=0;n<e;n++)t._continentsList[o[n]].title===s&&(i=o[n],n=e)}if(e.is(i)){t._listOfMarkerInfo=u.buildContinentsCountriesMarkers(i,t._globe,t._continentsList,t._continentsPos,t._ClusterSetFromTopbar,t._countries,t._container,t._MarkerInfo,t._lastZoom,t);let n=t._continentsList[i];e.is(n)&&(t._ClusterSet=n.countries),t._latRefine=i,d.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Continent found and explode: ",i)}else t._latRefine="continent",t._buildContinentsMarkers(!0),d.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Global View")}else if(e.is(n.source)&&!0===n.source)if(!1===t._3DEXPERIENCEActivate)t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._setupCluster(!0);else{let e=n.display;d.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Data source: ",e),t._latRefine="continent",t._lastZoom=t._zoomContinentGlobe,t._setupCluster(!0),u.manageActivationSourcesMarkers(t,e)}}else if("ds6w:who/person"===i&&!1===t._3DEXPERIENCEActivate){if("continent"===t._latRefine){"where"!==t.getCurrentViewId()&&e.is(n)||(t._latRefine="continent",t._lastZoom=t._zoomContinentGlobe)}t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._setupCluster(!0)}else{let i=t.getCurrentViewId();"where"!==i&&e.is(n)?e.is(countryName):(t._globe.allowZoom(!0),t._globe.globe.overlayDisplayed=!1,t._latRefine="continent",t._lastZoom=t._zoomContinentGlobe,t._setupCluster(!0),d.log("->SNResultUX/views/helpers/utils/GlobeView _computeRefineDisplay Global View continent"))}},_displayAtStart:function(){let e=this;e._lastSelectedCountry=null,e._lastZoom=3,e._globe.clearMarkers(),e._removeMarkersinfo(),e._globe&&e._globe.turnGlobeToLatLon(42,18,e._lastZoom),e._addMarkersCountries(e._ClusterSet,e._lastSelectedCountry),setTimeout(function(){e._showMarkersinfo(!0)},e._delay)},On3DExperienceChange:function(t){let i=this._resultMgt&&this._resultMgt.skeleton.getWhereView();e.is(i)&&e.is(i.On3DExperienceChange,"function")&&i.On3DExperienceChange(t)},getCurrentViewId:function(){return this.collection.getSNSkeleton()&&this.collection.getSNSkeleton()._skeleton.getViewAt(0)?this.collection.getSNSkeleton()._skeleton.getViewAt(0).currentViewId:null},_getHeightWidth:function(e,t){return e.getDimensions()[t]},_createDockingElement:function(){u.createdockingView(this)},refresh3DExperienceMarkers:function(){var e=this;setTimeout(function(){!0===e._3DExperienceSelected?0===e._listOfMarkersSources.length?u.createMain3DExperienceMarker(e):u.refresh3DExperienceMarkers(e):u.showMarkersinfo(!e._3DExperienceSelected,e._listOfMarkerInfo,e._globe)},1100)},mask:function(){let e=this;0===e._iphone&&o.mask(e._container)},unmask:function(){let e=this;0===e._iphone&&o.unmask(e._container)},findContinentFromPos:function(t,i){let n,s=this,o=s._continentsPos.length;for(let a=0;a<o;a++){let r=s._continentsPos[a];if(e.is(r)){let s=r.limit;if(e.is(s)){let e=s.Nord,l=s.Sud;if(i<=e&&i>=l){let e=s.Ouest,i=s.Est;e<=t&&t<=i&&(n=r.name,a=o)}}}}return n}})}),define("DS/SNResultUX/utils/SearchActions",["UWA/Core","UWA/Promise","UWA/Class","UWA/Utils/Client","UWA/Class/Debug","UWA/Class/Events","UWA/Element","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/WAFData/WAFData","require","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchCustoServices","DS/SNResultUX/views/utils/SearchOptionsUI","DS/UIKIT/Alert","DS/UIKIT/Autocomplete","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip","DS/UIKIT/Input/Select","DS/Controls/Toggle","DS/Controls/ComboBox","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/Controls/Button","DS/Windows/Dialog","DS/Controls/Tab","DS/W3DXComponents/Collections/ActionsCollection","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","DS/SNResultUX/utils/SearchViewOptions","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/SNInfraUX/Logger","DS/Windows/ImmersiveFrame"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b,C,y,I,D,T,A,x,N,O,P,E,k,M,R){"use strict";var V=O.get("loading"),U=function(e){if(isNaN(e))return!1;var t=parseFloat(e);return(0|t)===t};const L=function(e){return!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)};function F(t){const i=function(n){e.is(t.contains,"function")&&!t.contains(n.target)&&n.target.className.indexOf("wux-layouts-treeview")<0&&n.target.className.indexOf("wux-windows-immersive-frame-no-pointerevents")<0&&n.target.className.indexOf("modal-wrap")<0&&n.target.className.indexOf("modal-content")<0&&n.target.className.indexOf("modal-header")<0&&n.target.className.indexOf("modal-body")<0&&n.target.className.indexOf("modal-footer")<0&&n.target.className.indexOf("WarningReloadPage modal modal-root")<0&&n.target.className.indexOf("btn-default btn btn-root")<0&&null!==n.target.parentNode&&n.target.parentNode.className.indexOf("modal-header")<0&&null!==n.target.parentNode&&n.target.parentNode.className.indexOf("modal-body")<0&&L(t)&&(t.style.display="none",document.removeEventListener("click",i))};document.addEventListener("click",i)}return i.extend(o,s,{name:"DS_SNResultUX_utils_SearchActions",CSVpromise:t.deferred(),attributeToFilterForExport:["id","type_icon_url","preview_url","actions","resourceid","resourceid_tagger","actions"],globalActions:["exportToCmd","print","save_search","refresh_search","kpi_pcs_action","Grid_Custo","Preview","InfoPanel","Pin"],current_collection:null,current_selected:null,displayMode:null,skeleton:null,snSkeletonMgt:null,initOptionMode:null,searchContentSetDivContainer:null,maskedElement:null,actionCollectionUsedBySkeleton:null,actionCollectionOriginal:null,actionInitDone:!1,_actionTooltips:null,actionOneSearch:null,_isSecurityContextChosenAfterError:!1,init:function(t){let i=this;r.add("SearchPopover:destroy",function(){i.popover=null}),this.setDebugMode(u.getDebugMode()),e.is(t)&&e.is(t.SNSkeleton)&&(this.snSkeletonMgt=t.SNSkeleton),this._actionTooltips=[]},destroy:function(){this._cleanPopOver(),this.current_collection=null,this.current_selected=null,this.displayMode=null,this.skeleton=null,this.snSkeletonMgt=null,this.searchContentSetDivContainer=null,this.actionCollectionUsedBySkeleton=null,this.actionCollectionOriginal=null,this.actionOneSearch=null,this._actionTooltips.forEach(function(e){e.destroy()}),this._actionTooltips=null},getActiveTenant:function(){var t="";return e.is(this.current_collection)&&e.is(this.current_collection.search_ressources)&&e.is(this.current_collection.search_ressources.getActiveTenant,"function")&&(t=this.current_collection.search_ressources.getActiveTenant()),t},setCollection:function(e){this.current_collection=e},setSelected:function(e){this.current_selected=e},setSkeleton:function(e){this.skeleton=e},setSearchContentSetDivContainer:function(e){this.searchContentSetDivContainer=e},setEmptyViewMessage:function(e){V=e},getEmptyViewMessage:function(){return V},setDisplayMode:function(t){var i=this;if(this.displayMode=t,e.is(this.searchContentSetDivContainer)&&e.is(this.actionCollectionOriginal)){var n=this.getActiveTenant();h.getGrantedRoles(function(s){var o;i.log("Roles:"+s);var a=!1,r=u.getOption("search_compact_mode");e.is(r)?(a=!0,o=i.actionOneSearch):(i.actionCollectionUsedBySkeleton.reset(i.actionCollectionOriginal.toArray()),o=i.actionCollectionUsedBySkeleton);var l=e.extendElement(i.searchContentSetDivContainer).getElements(".content-set-actions");if(e.is(l)&&l.length>0){var c=null;let r=function(t){if(t&&t.id===c){if(e.is(t.platforms))return t.platforms.some(function(e){return e===n})}else if(t&&"InternalDS"===t.id)return!0;return!1};for(var d=o.size()-1;0<=d;d--){var h=o.at(d),g=h.get("icon"),p=h.get("displayMode"),_=h.get("id"),f=h.get("role"),m=!0;if((m=!e.is(p,"string")||("AllView"===p||p.search(t)>=0))&&e.is(s,"array")&&s.length>0)if(e.is(f,"array")&&0<f.length){m=!1;var v=0,S=f.length;for(v=0;v<S;v++)c=f[v],s.some(r)&&(m=!0)}else e.is(f,"string")&&f.length>0&&(c=f,m=s.some(r));m||(!0===a?h.set({visible:m}):o.remove(h));var b=e.extendElement(l[0]).getElements(".fonticon-"+g);if(e.is(b)&&b.length>0){var C=b[0];if(e.is(C)&&e.is(C.getParent())&&e.is(C.getParent().getParent())){var y=C.getParent().getParent();if(!i.actionInitDone){var I;I=O.get("actions."+_+".toolTip"),i._actionTooltips.push(new w({position:"bottom",target:y,body:I}))}}}}i.actionInitDone=!0}})}},_shouldBeAvailableIfInContextMode:function(t,i){var n=!0;if(e.is(t)){var s=t.in_apps_search;if(e.is(s))if("saveAsFavorite"===i&&(n=!1),e.is(s.UXOptions,"object")){if(e.is(s.UXOptions.globalToolbarActions,"object")){var o=s.UXOptions.globalToolbarActions[i];e.is(o,"boolean")&&(n=o)}}else"columnCusto"===i&&e.is(s.columnCustoAvailable)&&(n=s.columnCustoAvailable)}return n},getGlobalActions:function(t){var i=this,n=null,s=!1,o=h.identifyClientInfo();function a(e){return i._shouldBeAvailableIfInContextMode(t,e)}this.actionOneSearch=new N,this.actionCollectionUsedBySkeleton=new N,this.actionCollectionUsedBySkeleton["data-rec-id"]=!0;var r=h.isInTheSimpleSearch({tenant:t.tenant}),l=!1;if(e.is(r)){var c=u.getOption("search_compact_mode");e.is(c)&&(l=!0,!1===c&&(r=!1))}if(!0===g.getItem("integratedSearch")){var d=!0;window&&window.clntlang?d=!1:!0===u.getOption("search_web_in_win")?d=!1:e.is(t)&&e.is(t.pinToDashboard)&&!1===t.pinToDashboard&&(d=!1),!0===d&&a("pinToDashboard")&&(n={id:"Pin",title:O.get("actions.Pin.title"),icon:"publish",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"Pin"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n))}var p=function(){let t=!1;return!1===r&&!0!==u.getOption("enableNewSearchViews")&&e.is(o)&&"3DSwym"!==o.identifier&&(t=!0),t}();a("informations")&&!0===p&&(n={id:"InfoPanel",title:O.get("actions.InfoPanel.title"),icon:"info",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"InfoPanel"}},this.actionCollectionUsedBySkeleton.add(n));var _=!0;if(!0===r&&(_=!1,!0===g.getItem("integratedSearch")&&(_=!0)),!0===_){var f="AllView";if(e.is(i.snSkeletonMgt)&&e.is(i.snSkeletonMgt.getSearchWidget,"function")&&e.is(i.snSkeletonMgt.getSearchWidget())&&e.is(i.snSkeletonMgt.getSearchWidget().getValue,"function")){var m=i.snSkeletonMgt.getSearchWidget().getValue("addinmode");if(e.is(m)&&m.length>0){var v=this._listUISettingsToDisplay();e.is(v)&&v.length>0&&(f="table")}}n={id:"Grid_Custo",title:O.get("actions.Grid_Custo.title"),icon:"cog",overflow:!1,displayMode:f,attributes:{"data-rec-id":"Grid_Custo"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)}u.getOption("global_action_save_search")&&a("saveAsFavorite")&&"3DSwym"!==o.identifier&&(s=!0,!0===r&&!0===g.getItem("NofavoritesOnBar")&&(s=!1),!0===s&&(n={id:"save_search",title:O.get("actions.save_search.title"),icon:"star",overflow:!1,displayMode:"AllView",role:["CSV","InternalDS"],attributes:{"data-rec-id":"save_search"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)));var S=!1;if((u.getOption("global_action_refresh_search")&&u.getOption("search_web_in_win")||g.getItem("integratedSearch")||e.is(u.getOption("search_compact_mode"))&&u.getOption("search_web_in_win")||e.is(i.snSkeletonMgt)&&"3DSpace"===h.identifyClientInfo(i.snSkeletonMgt.getOption("addinMode")).identifier||e.is(i.snSkeletonMgt)&&"3DSwym"===h.identifyClientInfo(i.snSkeletonMgt.getOption("addinMode")).identifier)&&(S=!0),e.is(this.snSkeletonMgt)&&e.is(this.snSkeletonMgt.getSearchWidget,"function")){let t=this.snSkeletonMgt.getSearchWidget();e.is(t)&&e.is(t.data)&&e.is(t.data.launch_mode)&&t.data.launch_mode.contains("from_compass")&&(S=!1)}!0===S&&(n={id:"refresh_search",title:O.get("actions.refresh_search.title"),icon:"cw",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"refresh_search"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)),(u.getOption("global_action_export_csv")||u.getOption("global_action_export_xml"))&&a("export")&&(s=!0,!0===r&&!0===g.getItem("NoexportOnBar")&&(s=!1),!0===s&&(n={id:"exportToCmd",title:O.get("actions.exportToCmd.title"),icon:"export",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"exportToCmd"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n))),(u.getOption("global_action_default_print")||u.getOption("global_action_print_xsl"))&&a("print")&&(s=!0,!0===r&&!0===g.getItem("NoprintOnBar")&&(s=!1),!0===s&&(n={id:"print",title:O.get("actions.print.title"),icon:"print",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"print"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n))),u.getOption("search_web_in_win")&&(n={id:"BI_Activated",title:O.get("actions.BI_Activated.title"),icon:"chart-pie",overflow:!1,displayMode:"AllView",attributes:{"data-rec-id":"BI_Activated"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n)),u.getOption("no_kpi_pcs")?this.log("PCS view deactivated"):(n={id:"kpi_pcs_action",title:"PCS",icon:"chart-line",overflow:!1,callback:function(){require(["DS/SNResultUX/views/utils/PCSView"],function(t){var i=e.extendElement(document.body).getElement(".onesearch_results"),n=e.extendElement(i).getElement(".onesearch_skeleton");n.setStyle("display","none"),new t({renderTo:i,events:{onClose:function(){n.setStyle("display","block")}}})})},attributes:{"data-rec-id":"kpi_pcs_action"}},!1===l?this.actionCollectionUsedBySkeleton.add(n):this.actionOneSearch.add(n));var w={collection:this.actionCollectionUsedBySkeleton,events:{onActionClick:function(n,s,o){e.is(o)&&e.is(o.stopPropagation,"function")&&o.stopPropagation(),this.dropDown&&this.dropDown.hide(),t.actionItem=s,i.onActionClick(t)},onActionClickDotted:function(){i._cleanPopOver()}}};return this.actionCollectionOriginal=this.actionCollectionUsedBySkeleton.clone(),this.actionCollectionDefault=new N(this.actionCollectionUsedBySkeleton.toJSON()),w},isGlobalActions:function(e){var t=this.globalActions.length,i=0;for(i=0;i<t;i++)if(e===this.globalActions[i])return!0;return this.isNonDefaultGlobalAction(e)},updateGlobalActions:function(){if(e.is(this.actionCollectionOriginal)){var t=new N(this.actionCollectionDefault.toJSON(),{comparator:"index"});this._addNonDefaultGlobalActions(t),this.actionCollectionUsedBySkeleton.reset(),this.actionCollectionUsedBySkeleton.add(t.toArray()),this.actionCollectionOriginal=this.actionCollectionUsedBySkeleton.clone(),t=null,e.is(this.displayMode)&&this.setDisplayMode(this.displayMode)}},_addNonDefaultGlobalActions:function(t){var i=this._getNonDefaultGlobalActions();e.is(i)&&i.forEach(function(i){var n={id:i.id,title:i.title,icon:i.icon,overflow:i.overflow,displayMode:"AllView",index:i.index};e.is(i.displayMode)&&(n.displayMode=i.displayMode),t.add(n)})},isNonDefaultGlobalAction:function(t){var i=this._getNonDefaultGlobalActions();return!!e.is(i)&&i.some(function(e){if(t===e.id)return!0})},_runNonDefaultGlobalAction:function(t,i){var n=this;if(!e.is(t))throw new Error("E_INVALIDARG: bad option given to _runNonDefaultGlobalAction method !");var s=this._getNonDefaultGlobalActions();return!!e.is(s)&&s.some(function(e){if(i===e.id){var t=e.command_data;return n.dispatchEvent("onNonDefaultGlobalAction",{id:i,command_data:t}),!0}})},_getNonDefaultGlobalActions:function(){var t=null,i=E.getViewData();return e.is(i)&&e.is(i.global_actions)&&(t=i.global_actions.actions),t},onActionClick:function(t){if(this._cleanPopOver(),!e.is(t)||!e.is(t.actionItem))throw new Error("E_INVALIDARG: bad options given to onActionClick method !");var i=t.actionItem,n=this.current_collection,s=i.model.get("id");switch(s){case"exportToCmd":this.log("exportToCmd in actionbar"),this.exportToCmd(t);break;case"print":this.log("print in actionbar"),this.print(t);break;case"save_search":this.log("save search in actionbar"),this.saveSearchUI(i,n.service_parameters);break;case"refresh_search":this.log("refresh search pressed in global actionbar"),this.dispatchEvent("onRefreshResultRequest");break;case"kpi_pcs_action":i.model.get("callback")();break;case"BI_Activated":this.log("BI is Activated"),this.current_collection._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"BI_Activated",notif_parameters:""},"search_web_in_win");break;case"Grid_Custo":this.log("Grid_Custo"),this.searchSettingsUI(i);break;case"InfoPanel":this.log("InfoPanel"),this.informationPanel(i);break;case"Preview":this.log("Preview"),this.PreviewPanel(i);break;case"Pin":this.log("Pin"),this.PinToDashboard(i);break;default:this._runNonDefaultGlobalAction(t,s)||(this.log("multisel pressed in global actionbar"),this.multisel(t))}},downloadFile:function(t,i,s){if(e.is(t)&&e.is(s)){var o,a=document,r=a.createElement("a"),l=s;if(s=s||"application/octet-stream",s+=";charset=UTF-8,",!i){var c=new Date;i="CSV Export - "+c.getFullYear()+(c.getMonth()+1)+c.getDate()+c.getHours()+c.getMinutes()+c.getSeconds()+".csv"}var d;if(navigator.msSaveBlob&&!p.odtMode)return navigator.msSaveBlob(new Blob(["\ufeff"+t],{type:s}),i);"download"in r?(d=new Blob(["\ufeff"+t],{type:s}),o=URL.createObjectURL(d),r.setAttribute("download",i)):(n.Engine.safari&&n.Platform.ios?(d=new Blob(["\ufeff"+t],{type:l}),o=(window.URL?URL:window.webkitURL).createObjectURL(d)):o="data:"+s+"\ufeff"+encodeURIComponent(t),r.setAttribute("target","_blank"),r.setAttribute("download",i)),r.href=o,r.setAttribute("style","display:none;"),a.body.appendChild(r),setTimeout(function(){if(r.click)r.click();else if(document.createEvent){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),r.dispatchEvent(e)}a.body.removeChild(r)},100)}},exportToCmd:function(t,i){if(l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Export"}}}),!e.is(t)||!e.is(t.actionItem))throw new Error("E_INVALIDARG: bad options given to exportToCmd method !");var n={DoSelection:!1,callback:this.exportToCmdCallback,exportToCmdCallback_options:t,exportToCmdCallback_cb:i,type:"action",subType:"export",context:this};u.getOption("select_all_export_print")&&(!e.is(this.current_selected)||e.is(this.current_selected)&&0===this.current_selected.length)?this.snSkeletonMgt.fetchAll(n):this.exportToCmdCallback(n)},exportToCmdCallback:function(e){u.options.search_settings.global_action_export_csv&&!u.options.search_settings.global_action_export_xml?this.exportToCSV(e.exportToCmdCallback_options,e.exportToCmdCallback_cb):!u.options.search_settings.global_action_export_csv&&u.options.search_settings.global_action_export_xml?this.exportToXML(e.exportToCmdCallback_options):M.warn("Not allowed to activate both export to CSV and export to XML options !!!")},_formatLocalDate:function(){var e=new Date,t=-e.getTimezoneOffset(),i=t>=0?"+":"-",n=function(e){var t=Math.abs(Math.floor(e));return(t<10?"0":"")+t};return e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())+i+n(t/60)+":"+n(t%60)},exportToCSV:function(t,i){if(!e.is(t))throw new Error("E_INVALIDARG: bad options given to exportToCSV method !");var s=this;function o(o){let r=this.getActiveTenant();var l,c=s.current_collection;e.is(s.current_selected)&&s.current_selected.length>0&&(l=c._models.slice(),c._models=s.current_selected);var d=u.getOption("exportFilename")?u.getOption("exportFilename"):"search_"+s._formatLocalDate().slice(0,19);g.getItemPromise("optionMode",r).then(function(r){s.downloadFile(function(i,o,r){var l,c,d=s.getActiveTenant();e.is(u)&&e.is(u._tenantSettings)&&e.is(u._tenantSettings[d])&&e.is(u._tenantSettings[d].search_settings)&&(l=u._tenantSettings[d].search_settings);c=e.is(l,"object")&&e.is(l.defaultCsvSeparator,"object")&&e.is(l.defaultCsvSeparator.id,"string")?h.getCSVSeparatorValueFromId(d,l.defaultCsvSeparator.id):u.getOption("defaultCsvSeparator");for(var g=e.is(r)&&e.is(r.csvMode)&&""!==r.csvMode.valueItem?r.csvMode.valueItem:c,p="",_=0,f=i.length;_<f;_++)-1===s.attributeToFilterForExport.indexOf(i[_].dataIndex)&&(p=n.Platform.ios?p+'"'+i[_].text+'";':p+'"'+i[_].text+'"'+g);return p+="\r\n",o.forEach(function(o){for(var r=0,l=i.length;r<l;r++)if(-1===s.attributeToFilterForExport.indexOf(i[r].dataIndex)){var c=s._getValueWithMapping(i[r].dataIndex,o,t.itemViewOptions.mapping);if(e.is(c,"array"))for(var d=0,u=c.length;d<u;d++)c[d]=a(c[d]);else c=a(c);c=h.decodeHtml(c),p=n.Platform.ios?p+'"'+c+'";':p+'"'+c+'"'+g}p+="\r\n"}),p}(o,c,r),d+".csv","text/csv"),e.is(i)&&i.call(this),e.is(s.current_selected)&&s.current_selected.length>0&&(c._models=l)},function(){e.is(i)&&i.call(this),e.is(s.current_selected)&&s.current_selected.length>0&&(c._models=l)})}function a(t){return e.is(t,"string")&&t.length>0?t.split("&quot;").join('""'):t}var r=[],l=E.getDataGridViewHeaders();if(e.is(s.snSkeletonMgt)&&e.is(s.snSkeletonMgt.getDataGridView,"function")){var c=s.snSkeletonMgt.getDataGridView();e.is(c)&&e.is(c._columns)&&Object.keys(c._columns).length>0&&(l=c.view.layout.getVisibleOrderedLeafColumns())}for(let e=0,t=(l=this._filterDisplayName(l)).length;e<t;e++)r.push(l[e].dataIndex);var d=this.getActiveTenant();k.getResourcesInfo(r.join(","),{tenantId:d,lang:h.getLanguage(),apiVersion:"R2019x",onComplete:function(t){if(e.is(t,"array")){var i={};let n,s;for(n=0,s=t.length;n<s;n++)e.is(t[n],"object")&&e.is(t[n].curi,"string")&&(i[t[n].curi]=t[n].label);for(n=0,s=l.length;n<s;n++)e.is(l[n],"object")&&e.is(l[n].dataIndex,"string")&&(l[n].text=i[t[n].curi])}t&&o.call(s,l)},onFailure:function(e){M.info(e),e&&o.call(s,l)}})},_filterDisplayName:function(e){var t=[];if(e.length>0)for(let i=0,n=e.length;i<n;i++)"ds6wg:_displayName_"!==e[i].dataIndex&&t.push(e[i]);return t},exportToXML:function(){},print:function(t,i){l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Print"}}}),this.log("print");if(!e.is(t)||!e.is(t.actionItem))throw new Error("E_INVALIDARG: bad options given to print method !");var n,s=this.current_collection;if(!e.is(s)||!e.is(s.totalCount)||isNaN(s.totalCount))throw new Error("Pb with searchCollection found for print method !");e.is(this.current_selected)&&this.current_selected.length>0&&(n=s._models.slice(),s._models=this.current_selected);var o=s.totalCount;if(!e.is(s._models)||!e.is(s._models.length)||isNaN(s._models.length))throw new Error("No searchCollection._models found for print method !");o!==s._models.length&&M.warn("Not all results are displayed, must refresh the search result, TO DO !!!");var a={DoSelection:!1,callback:this.printCallback,exportToCmdCallback_options:t,exportToCmdCallback_cb:i,type:"action",subType:"print",context:this};u.getOption("select_all_export_print")&&(!e.is(this.current_selected)||e.is(this.current_selected)&&0===this.current_selected.length)?this.snSkeletonMgt.fetchAll(a):this.printCallback(a),e.is(this.current_selected)&&this.current_selected.length>0&&(s._models=n)},printCallback:function(e){u.options.search_settings.global_action_default_print&&!u.options.search_settings.global_action_print_xsl?this._defaultPrint(e.exportToCmdCallback_options,e.exportToCmdCallback_cb):!u.options.search_settings.global_action_default_print&&u.options.search_settings.global_action_print_xsl?this.exportToXML(e.exportToCmdCallback_options,"SearchPrint.xsl"):M.warn("Not allowed to activate both print options !!!")},_printWindowOpen:function(){return void 0!==this.printWindow&&null!==this.printWindow&&!1===this.printWindow.closed},_defaultPrint:function(t,i){if(!e.is(t))throw new Error("E_INVALIDARG: bad options given to _defaultPrint method !");var n=this;function s(){var s=E.getDataGridViewHeaders();e.is(n.snSkeletonMgt)&&e.is(n.snSkeletonMgt._myDatagridView)&&e.is(n.snSkeletonMgt._myDatagridView._columns)&&Object.keys(n.snSkeletonMgt._myDatagridView._columns).length>0&&(s=n.snSkeletonMgt._myDatagridView._columns),function(s){var o,a=n.current_collection,r="";e.is(n.current_selected)&&n.current_selected.length>0&&(o=a._models.slice(),a._models=n.current_selected),e.is(n.snSkeletonMgt)&&(r=n.snSkeletonMgt.getTitle()),!0===t.ODT&&e.is(t.PrintWindow,"object")&&(n.myPrintWindow=t.PrintWindow);var l="";n._printWindowOpen()&&n.myPrintWindow.close(),setTimeout(function(){if(!0===t.ODT&&e.is(t.PrintWindow,"object")||(n.myPrintWindow=window.open("","PrintWindow","width=1024, height=768, scrollbars=yes")),void 0!==n.myPrintWindow){n.snSkeletonMgt.setPrintWindow(n.myPrintWindow),l+="<html><head><title>Print Me</title></head><body>",l+="<h1>"+r+"</h1>",l+='<table style="border:1px solid black; border-collapse:collapse; table-layout:fixed; width: -webkit-fill-available; word-break: break-all; font-size: xx-small; white-space: pre-wrap;"><thead><tr>';for(var i=0,o=s.length;i<o;i++)-1===n.attributeToFilterForExport.indexOf(s[i].dataIndex)&&(l+='<th  style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:1.1em; padding-top:5px; paddingbottom:4px;"><div style="',e.is(s[i].width)&&U(s[i].width)&&(l+=" width:"+s[i].width+"px; overflow-wrap: break-word"),l+='">'+s[i].text+"</div></th>");l+="</tr></thead><tbody>",a.forEach(function(i){l+="<tr>";for(var o=0,a=s.length;o<a;o++)if(-1===n.attributeToFilterForExport.indexOf(s[o].dataIndex)){var r=n._getValueWithMapping(s[o].dataIndex,i,t.itemViewOptions.mapping);l+='<td style="border:1px solid black;"><div style="',e.is(s[o].width)&&U(s[o].width)&&(l+=" width:"+s[o].width+"px; overflow: hidden"),l+='">'+r+"</div></td>"}l+="</tr>"}),l+="</tbody></table></body></html>",e.is(n.myPrintWindow)?(n.myPrintWindow.document.write(l),n.myPrintWindow.document.close(),n.myPrintWindow.focus(),p.odtMode||n.myPrintWindow.print()):n._displayAlert({message:O.get("actions.print.window.popup.error"),className:"primary"})}else this.log("Unable to open window !")},0),e.is(i)&&i.call(this),e.is(n.current_selected)&&n.current_selected.length>0&&(a._models=o)}(s)}var o=[],a=E.getDataGridViewHeaders();for(let e=0,t=a.length;e<t;e++)o.push(a[e].dataIndex);var r=this.getActiveTenant();k.getResourcesInfo(o.join(","),{tenantId:r,lang:h.getLanguage(),apiVersion:"R2019x",onComplete:function(t){if(e.is(t,"array")){var i={};let n,s;for(n=0,s=t.length;n<s;n++)e.is(t[n],"object")&&e.is(t[n].curi,"string")&&(i[t[n].curi]=t[n].label);for(n=0,s=a.length;n<s;n++)e.is(a[n],"object")&&e.is(a[n].dataIndex,"string")&&(a[n].text=i[a[n].dataIndex])}t&&s.call(n)},onFailure:function(e){M.info(e),e&&s.call(n)}})},informationPanel:function(){l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Information Panel"}}}),this.dispatchEvent("onInformationPanelAction")},PreviewPanel:function(){this.dispatchEvent("onPreviewPanelAction")},PinToDashboard:function(){l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"PinToDashboard"}}});this.dispatchEvent("onPinToDashboardAction")},_listUISettingsToDisplay:function(){var t=[];if(!e.is(this.snSkeletonMgt))return t;var i,n=u.getSettingsToDisplayInUI(),s=e.is(this.snSkeletonMgt.getOption("in_apps_search"),"object"),o="true"!==this.snSkeletonMgt.getOption("transient_context")&&!0!==this.snSkeletonMgt.getOption("transient_context"),a=u.getOption("nav_history"),r=u.getOption("integratedSearch");e.is(this.snSkeletonMgt.getSearchWidget,"function")&&e.is(this.snSkeletonMgt.getSearchWidget())&&(i=this.snSkeletonMgt.getSearchWidget().getValue("launch_mode"));var l={addinMode:this.snSkeletonMgt.getOption("addinMode"),inContextSearch:e.is(this.snSkeletonMgt.getOption("in_apps_search"),"object"),isPinnedWidget:"true"!==this.snSkeletonMgt.getOption("transient_context")&&!0!==this.snSkeletonMgt.getOption("transient_context")},c=null,d=h.identifyClientInfo(l.addinMode);e.is(d,"object")&&(c=d.identifier);for(var g=function(t){var n=!0;switch(t){case"search_tabbed_ui":switch(c){case"3DSpace":n=!1;break;case"3DDashboard":o&&(n=!1);break;case"3DEXPERIENCE":s&&(n=!1)}break;case"nav_history":if(!1===a){n=!1;break}switch(c){case"3DSpace":n=!1;break;case"3DDashboard":(s||o)&&(n=!1);break;case"3DSwym":case"3DEXPERIENCE":n=!1}break;case"integratedSearch":switch(e.is(r)&&!1===r?n=!1:i!==h.widgetLaunchMode.COMPASS_TRANSIENT&&i!==h.widgetLaunchMode.COMPASS_PINNED||(n=!1),c){case"3DSpace":n=!1;break;case"3DDashboard":o&&(n=!1);break;case"3DSwym":case"3DEXPERIENCE":n=!1}break;case"search_date_region":n=!1,!0===u.getOption("activate_search_date_region")&&(n=!0);break;case"csvSeparatorUI":n=!0}return n},p=0;p<=n.length;p++)e.is(n[p])&&e.is(n[p].optionID)&&e.is(n[p].optionLabel)&&g(n[p].optionID)&&t.push(n[p]);return t},searchSettingsUI:function(t){if(!e.is(this.immersiveFrame)){this.immersiveFrame=new R({reactToPointerEventsFlag:!1});var i=document.body;this.immersiveFrame.inject(i)}this._fillOptionsPanel(t)},_fillOptionsPanel:function(t){let i=this;if(l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Setting"}}}),!e.is(t))throw new Error("E_INVALIDARG: bad custoActionItem given to searchSettingsUI method !");if(e.is(t.isError)&&!0===t.isError)return void(this._isSecurityContextChosenAfterError=!0);let n=this.getActiveTenant();this._cleanPopOver();let s=new f({tenant:n,skeletonMgt:this.snSkeletonMgt});this.popover=s;let o="table"!==this.displayMode;var r=null;u.getOption("global_action_column_custo")&&i._shouldBeAvailableIfInContextMode({in_apps_search:i.snSkeletonMgt.getOption("in_apps_search")},"columnCusto")&&!1===o?h.isRoleAvailable(["CSV","InternalDS"],n,function(t){if(!0===t){let t={isPQ:!1,typeName:""};if(e.is(i.current_collection)){let n=i.current_collection.getPQ();e.is(n)&&(t={isPQ:!0,typeName:n})}let l=i.snSkeletonMgt.getDataGridView();e.is(l)&&e.is(l._forcedCustoView,"string")&&(t.forcedCusto=l._forcedCustoView);var o=_.getAvailableColumnCustomization(t,n);e.is(o)&&o.length>0&&o.splice(0,0,{label:O.get("RESTORE_DEFAULT"),value:"The_Default_Columns"}),r=a.create("div",{class:"search-options-tab",id:"search-options-tab-custo"}),new b({className:"search-options-custo-select",nativeSelect:!0,placeholder:O.get("dataGrid.columnCustoPanel.existingCustoComboPlaceHolder"),options:o,events:{onChange:function(){let s=i._getDataGridView(),o=this.getValue(),a=null;if(e.is(o,"array")&&o.length>0&&(a=o[0]),0===a.length)return;"DEFAULT"===a&&(e.is(t)&&(t.forcedCusto="DEFAULT"),a=_.getColumnCustomizationIdToUse(t)),g.removeItem("listColumnsWidth");let r={custoName:a,custoId:a};if(r.custoName.endsWith("-ADMIN")&&(r.custoName=r.custoName.slice(0,-6)),a.startsWith("###")){let e=r.custoName.substring(3,r.custoName.length);r.custoName=O.replace(O.get("custo_PQ"),{PQ:e})}if(e.is(s)&&e.is(_.defineColumnCusto,"function")){let e=_.getColumnCustomizationDefinitionFromCustoId(a,n);s._updateColumns(e,r,!1)}i._cleanPopOver()}}}).inject(r),a.create("a",{id:"show-custo-manager",title:O.get("custo_chooser_manage_custos_tooltip"),href:"#",html:O.get("custo_chooser_manage_custos")}).inject(r).addEvent("click",function(e){e.preventDefault(),e.stopPropagation(),i._cleanPopOver(),i.columnCustomizationDefinitionUI()}),!0!==i._isSecurityContextChosenAfterError?s.addTab({label:O.get("actions.Options.custoTab"),content:r,index:0,isSelected:!0}):s.addTab({label:O.get("actions.Options.custoTab"),content:r,index:0})}else s.value(0)}):s.value(0)},_getDataGridView:function(){var t=null;if(e.is(this.skeleton)&&e.is(this.skeleton.getViewAt,"function")){var i=this.skeleton.getViewAt(0);if(e.is(i)){var n=i.currentViewId;"table"===n&&e.is(i.contentsViews,"object")&&e.is(i.contentsViews[n])&&(t=i.contentsViews[n].nestedView)}}return t},columnCustomizationDefinitionUI:function(){var t=this._getDataGridView();e.is(t)&&e.is(_.defineColumnCusto,"function")&&(this.maskedElement=this.snSkeletonMgt.options.renderTo,D.mask(this.maskedElement,O.get("SearchDataGridPreferences_modal_loading_attribute")),_.defineColumnCusto(t))},updateDatagridObjInCusto:function(){let t=this._getDataGridView();e.is(t)&&_.updateDatagridTargetObj(t)},removeMask:function(){e.is(this.maskedElement)&&D.unmask(this.maskedElement),this.maskedElement=null},logOut:function(){if(this.log("logOut"),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources())){var t=this.current_collection.getSearchRessources().getFetchOptions({service_name:"logOut"}),i=t.url,n={onComplete:function(){M.log("SearchAction: logout success")},onFailure:function(){M.warn("SearchAction: logout failure")}};n=e.extend(t,n,!0),c.authenticatedRequest(i,n)}},saveSearchUI:function(t,i){if(l.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Favorite Search"}}}),!e.is(t))throw new Error("E_INVALIDARG: bad saveActionItem given to saveSearchUI method !");var n,s,o,r,c=this,d=!1;e.is(c.current_collection.service_parameters.query)&&h.SearchTypeEnum.MY_RECENT_CONTENT===c.current_collection.service_parameters.query&&(d=!0),d?(s=a.create("div",{class:"divNewSearch form-group",html:{for:"newSaveSearchName",html:O.get("save_search_not_supported")}}),o=a.create("form",{class:"formSaveSearch form-inline",styles:{width:"180px"}}),s.inject(o),a.create("hr").inject(o)):(s=a.create("div",{class:"divNewSearch form-group",html:{tag:"label",for:"newSaveSearchName",class:"saveSearchEdt",html:O.get("save_search_name")},styles:{width:"100%"}}),o=a.create("form",{class:"formSaveSearch form-inline",styles:{width:"180px"}}),s.inject(o),e.is(i)&&((r=new v({placeholder:O.get("save_search_default_text"),class:"newSaveSearchName",events:{onKeyUp:function(t){let s=this.elements.input.value.trim().length;if(e.is(n)&&e.is(n.buttons))if(s<1)n.buttons.Ok.disabled=!0;else{if(13===t.keyCode)t.preventDefault(),t.stopPropagation(),!1!==c.saveSearch(this.elements.input.value,i)&&c._cleanPopOver();n.buttons.Ok.disabled=!1}}}})).setId("newSaveSearchName").inject(s),r.getSuggestions=function(){})),a.create("a",{id:"show-favorites-searches",title:O.get("my_fav_searches_tooltip"),class:"saveSearchHyperlink",href:"#",html:O.get("my_fav_searches"),styles:{display:"block"}}).inject(o).addEvent("click",function(e){e.preventDefault(),e.stopPropagation(),c._cleanPopOver(),c.dispatchEvent("onClickFavSearchTopBar"),u.getOption("search_web_in_win")&&c.dispatchEvent("onRefreshResultRequest",{criteria:{search_crit:h.SearchTypeEnum.FAVORITE_SEARCH,originalSearchCriteria:O.get("my_fav_searches"),search_name:O.get("my_fav_searches"),queryType:h.SearchTypeEnum.FAVORITE_SEARCH}})});var g=t.getContent();if(!1===t.model.get("visible")){var p=e.extendElement(this.searchContentSetDivContainer);if(e.is(p)){var _=p.getElements(".fonticon-dot-3");e.is(_,"array")&&1===_.length&&(g=_[0])}}this.popover=new A({title:O.get("save_search_panel_title"),identifier:"fav-search-popover",position:{at:"bottom",of:g,collision:"fit",offsetX:-200},content:s.getParent(),buttons:{Ok:new T({domId:"okSaveSearch",label:O.get("OKButton"),disabled:!0,onClick:function(){!1!==c.saveSearch(r.elements.input.value,i)&&c._cleanPopOver()}}),Cancel:new T({domId:"cancelSaveSearch",label:O.get("CancelButton"),onClick:function(){c._cleanPopOver()}})}}),n=this.popover,t.savePanel=n,n.elements.container.addClassName("fav-search-popover"),n.elements.container.setStyle("z-index",4e3),n.inject(document.body),n.addEventListener("close",function(e){e.stopPropagation(),c._cleanPopOver()}),F(this.popover.elements.container),n.show(),e.is(r)&&r.elements.input.focus()},saveSearch:function(t,i){var n=this;if(this.log("saveSearch"),e.is(t,"string")){if(t.indexOf("<")>=0||t.indexOf(">")>=0)return t=(t=t.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/&lt;/g,'<em style="color:red">&lt;</em>').replace(/&gt;/g,'<em style="color:red">&gt;</em>'),o(0,'{"Error": "'+O.get("save_search_invalid_character")+'"}'),!1;if(!n._isValidInput(t))return o(0,'{"Error": "'+O.get("save_search_error_invalid_chars")+'"}'),!1;if(t.length>128)return o(0,'{"Error": "'+O.get("save_search_error_exeeds_maximum_char_limit")+'"}'),!1;var s={query:i.query,originalSearchCriteria:i.originalSearchCriteria,search_criteria_to_display:i.search_criteria_to_display};this.log("searchName="+t),this.log("searchParam.search_criteria="+i.query),this.log("searchParam.tagger_criteria="+i.refine),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources())&&(h.initSecurityContext(n.current_collection.getSearchRessources()),h.getSecurityContextPromise().then(function(){var a={service_name:"saveSearch",service_data:{name:t,searchSpec:s,taggerSpec:i.refine,searchOptions:{source:i.source},originalSearchCriteria:i.originalSearchCriteria}};i.order_by&&i.order_field&&(a.service_data.searchOptions.order_by=i.order_by,a.service_data.searchOptions.order_field=i.order_field);var r=n.current_collection.getSearchRessources().getFetchOptions(a),l=r.url,d={onComplete:function(t){var i=e.Json.decode(t);e.is(i)&&n._displayAlert({message:O.replace(O.get("save_search_successful"),{searchId:i.name}),className:"success saveSearchAlert"})},onFailure:o};d=e.extend(r,d,!0),c.authenticatedRequest(l,d)}))}function o(i,s){var o=O.replace(O.get("save_search_failure"),{searchId:t});if(e.is(s,"string"))try{var a=JSON.parse(s);e.is(a)&&e.is(a.Error)?o+="<br>"+a.Error:e.is(a)&&e.is(a.errorCode)&&(o+="<br>"+O.replace(O.get("save_search_error_"+a.errorCode),{name:t,invalidCharString:a.invalidChar}))}catch(e){M.error("Error parsing errorObject:",e)}n._displayAlert({message:o,className:"error saveSearchAlert"})}},getSavedSearches:function(t,i){var n=this;if(this.log("getSavedSearches"),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources())){var s=this.current_collection.getSearchRessources().getFetchOptions({service_name:"getSavedSearches"}),o=s.url,a={type:"json",authentication:{passport_target:"enovia"},onComplete:function(t,s){e.is(t)&&n.log(t),e.is(s)&&n.log(s);var o=[];if(e.is(t.searches)){for(var a=0,r=t.searches.length;a<r;a++){var l=t.searches[a],c={save_object:{}};e.is(l.name)&&(c.save_object.name=l.name),e.is(l.id)&&(c.save_object.id=l.id),e.is(l.searchstring)&&(c.save_object.search_criteria=l.searchstring),e.is(l.taggerstring)&&(c.save_object.tagger_criteria=decodeURIComponent(l.taggerstring)),o.push(c)}e.is(i,"function")&&i(o)}},onFailure:function(e){n._displayAlert({message:O.replace(O.get("save_search_retrieval_failure"),{response:e}),className:"error"})}};e.extend(a,s,!0),(u.getOption("search_web_in_win")||this.jetty_server_activated)&&this.log("Jetty server activated or Search Web in Win context"),c.authenticatedRequest(o,a)}},deleteSearch:function(t,i){var n=this;if(n.log("deleteSearch"),e.is(this.current_collection)&&e.is(this.current_collection.getSearchRessources)){var s=this.current_collection.getSearchRessources().getFetchOptions({service_name:"deleteSearch",service_data:{id:t}}),o={onComplete:function(){i()},onFailure:function(e){n.log("Failed to delete search "+t+" !",e)},onCancel:function(){n.log("Search deletion canceled !")},onTimeout:function(e){n.log("Search deletion timeout !",e)}};o=e.extend(s,o,!0),c.authenticatedRequest(o.url,o)}},_getValueWithMapping:function(t,i,n){var s=null;if(!e.is(t))return s;if(t in n&&e.is(n[t],"function")){var o={model:i};s=n[t].call(o)}else{try{s=i.get(t)}catch(e){M.warn("Exception raised",e)}if(void 0===s){try{s=i.get(t.slice(t.lastIndexOf("/")+1,t.length))}catch(e){M.warn("Exception raised",e)}if(void 0===s)if(s="",e.is(i)&&e.is(i.isAShowOnlyObject,"function")&&i.isAShowOnlyObject())s=O.get("no_access")}}return s},updatePopoverPosition:function(){var t;e.is(this.popover)&&(e.is(this.popover.options)&&e.is(this.popover.options.target)&&e.is(this.popover.options.target.getPosition,"function")?0!==(t=this.popover.options.target.getPosition(document.body)).x||0!==t.y?this.popover.updatePosition():this.popover.hide():e.is(this.popover._properties)&&e.is(this.popover._properties.position)&&e.is(this.popover._properties.position.value)&&e.is(this.popover._properties.position.value.of)&&e.is(this.popover._properties.position.value.of.container)&&e.is(this.popover._properties.position.value.of.container.getPosition,"function")&&(0===(t=this.popover._properties.position.value.of.container.getPosition(document.body)).x&&0===t.y||(this.popover.updatePosition?this.popover.updatePosition():this.popover.setAbsolutePosition(t))))},_displayAlert:function(e){e.delay=4e3,p._displayAlert(e)},_checkCSVAvailability:function(t){var i=this;return u.getOption("search_web_in_win")?(i.CSVpromise.resolve([]),i.CSVpromise.promise):(h.getGrantedRoles(function(n){for(var s=!1,o=0;o<n.length;o++){var a=n[o];if(e.is(a)&&e.is(a.platforms,"array")&&(0===a.platforms.length||a.platforms.indexOf(t)>=0&&"CSV"===a.id)){s=!0;break}}s?i.CSVpromise.resolve(n):i.CSVpromise.reject(n)}),this.CSVpromise.promise)},_cleanPopOver:function(){e.is(this.popover)&&(e.is(this.popover.destroy,"function")?(this.popover.destroy(),this.popover=null):e.is(this.popover.hide,"function")&&(this.popover.hide(),this.popover=null))},_isValidInput:function(e){let t=u.getOption("favorites_name_not_allowed_chars");return this._match(e,t.join(""))},_match:function(e,t){for(let i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return!1;return!0}})}),define("DS/SNResultUX/utils/SearchLocalActions",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Model","DS/SNInfraUX/SearchSettings","DS/SNResultUX/utils/SearchServices","UWA/Promise","UWA/Class/Collection","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils","DS/WAFData/WAFData","DS/SNResultUX/utils/PowerBySearchLocalActions","DS/SNInfraUX/ServiceDelegationLoader"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p){"use strict";var _=n.extend({idAttribute:"id"});return t.singleton(i,{_action_Unselect_All:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"select-none",multisel:!0,id:"unselect_all",title:c.get("unselectAllTitle")},_action_Select_All:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"select-all",multisel:!0,id:"select_all",title:c.get("selectAllTitle")},_action_Preview:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"eye",multisel:!0,id:s.getOption("command_id.new_preview"),title:c.get("previewTitle")},_action_AddTag:{sourcejs:"DS/SNResultUX/utils/AddTag_ActionHandler",icon:"tag",multisel:!0,id:s.getOption("command_id.add_tag"),title:c.get("add_tag.add_tag_header")},_action_Information:{sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",icon:"info",multisel:!0,id:s.getOption("command_id.new_information"),title:c.get("infoPanel.toggle")},_isGoodInput:function(t,i){return!(!e.is(t,"array")||t.length<0)&&!(!e.is(i,"object")||!e.is(i.skeleton))},_isSelectionFromSameSource:function(t){var i=new r([],{model:_});return new a(function(n,s){for(var o="",a="",r=!0,l={appName:u.SEARCH_APP_ID,objects:[]},c=function(e){var t=e.get("ds6w:type_value"),n={id:e.id,type:t,source:e.getSourceID()};l.objects.push(n),i.add(n)},d=t.length,h=0;h<d&&r;h++){var g=t[h];e.is(g)&&(c(g),0===h?(a=g.getSourceID(),o=g.getServiceID(),l.platformId=g.getPlatformID()):o!==g.getServiceID()&&(r=!1))}r?n({data:l,sourceID:a,serviceID:o,objectsToTreat:i,models:t}):s({data:l,sourceID:a,serviceID:o,objectsToTreat:i,models:t})})},_buildEmptyAction:function(e){return{actions:[],id:e}},_buildEmptyActionsOnFailure:function(e){for(var t={actions:[],status:"failure"},i=0;i<e.data.objects.length;i++)t.actions.push(this._buildEmptyAction(e.data.objects[i].id));return t},_addEmptyActions:function(t,i){if(e.is(t)&&e.is(t.actions,"array")&&i.objectsToTreat.size()!==t.actions.length){for(var n=0;n<t.actions.length;n++){var s=t.actions[n];i.objectsToTreat.remove(i.objectsToTreat.get(s.id))}var o=i.objectsToTreat.toArray();if(e.is(o,"array"))for(var a=0;a<o.length;a++)t.actions.push(this._buildEmptyAction(o[a].get("id")))}},_addSelectUnselect:function(t,i){if(u.isFUNActive("FUN075064")&&e.is(t)&&e.is(t.actions,"array"))for(var n=0;n<t.actions.length;n++){var s=t.actions[n].actions;i.add_unselectAll&&s.unshift(this._action_Unselect_All),i.add_selectAll&&s.unshift(this._action_Select_All)}},_addPreview:function(t,i){if(e.is(i)&&e.is(i.skeleton)&&e.is(t)&&e.is(t.actions,"array"))for(var n=0;n<t.actions.length;n++){var s=t.actions[n].actions;!0===i.add_preview&&s.push(this._action_Preview)}},_addTag:function(t){if(e.is(t)&&e.is(t.actions,"array"))for(var i=0;i<t.actions.length;i++){t.actions[i].actions.push(this._action_AddTag)}},_addInformation:function(t){if(e.is(t)&&e.is(t.actions,"array"))for(var i=0;i<t.actions.length;i++){t.actions[i].actions.push(this._action_Information)}},_getLanguage:function(){return u.getLanguage()},_treatActionImages:function(t,i){t&&e.is(t.actions,"array")&&t.actions.forEach(function(t){if(e.is(t.actions,"array"))for(var n=t.actions,s=0;s<n.length;s++)n[s].iconImage&&(n[s].iconImage.indexOf("://")>0?n[s].image=n[s].iconImage:n[s].image=i+n[s].iconImage)})},executeWSAction:function(t){if(e.is(t)){var i=t.url,n=t.method;if(e.is(i,"string")&&e.is(n,"string")){var s=this,o={};o.method=n,o.headers=t.headers||{},o.headers["Accept-Language"]=this._getLanguage(),o.url=t.url+"/?oid="+t.selected_obj,e.is(t.data,"object")||e.is(t.data,"array")?o.data=JSON.stringify(t.data):e.is(t.data,"string")&&(o.data=t.data);var a=function(i){var n=null,s=null;try{var o=JSON.parse(i);n=o.message,e.is(n,"string")||(n="INVALID response",s="error"),s=o.status,e.is(s)||(s="success")}catch(e){n="INVALID response",s="error"}t.displayAlert({message:n,className:s})};o.onComplete=function(e){s.log("WS execution done, inide onComplete"),a(e)},o.onFailure=function(e){s.log("WS execution done, inide onFailure"),a(e)},h.authenticatedRequest(o.url,o)}else this.log("invalid execute options, url = "+i+", method="+n)}},getActions:function(t){var i=this;if(e.is(t))if(e.is(t.data)&&e.is(t.data.objects)&&0!==t.data.objects.length){var n=function(n){var s={method:"POST"};s.headers=n.headers||{},s.headers.Accept="application/json",s.headers["Accept-Language"]=i._getLanguage(),s.headers["Content-Type"]="application/json",s.url=n.url,s.data=JSON.stringify(t.data),s.onComplete=function(i){var n=e.is(i,"string")?i.length>0?JSON.parse(i):{}:i;e.is(t.onComplete,"function")&&t.onComplete.call(void 0,n)},s.onFailure=function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"web_service_failure",error:i})},h.authenticatedRequest(s.url,s)};g.getPowerByActions({options:t,server_actions:function(){e.is(t.serviceID,"string")&&t.serviceID.length>0?l.getServiceUrl({serviceName:t.serviceID,platformId:t.data.platformId,onComplete:function(s){p.load({serviceID:t.serviceID,platformID:t.data.platformId,serviceURL:s}).then(function(o){if(e.is(o.getActions,"function")){var a={models:t.models,widget_id:t.widget_id,data:t.data,serviceURL:s,headers:{Accept:"application/json","Accept-Language":i._getLanguage()},onComplete:function(n){e.is(t.onComplete,"function")&&(i._treatActionImages(n,s),t.onComplete.call(void 0,n))},onFailure:function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"action_delegation_failure",error:i})}};o.getActions(a)}else e.is(o.getActionsPath,"function")?n({url:s+o.getActionsPath({sourceID:t.sourceID,platformID:t.data.platformId})}):e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"action_delegation_not_impl",error:"service delegation for actions not implemented"})},function(i){p.discover({platformID:t.data.platformId,sourceID:t.sourceID}).then(function(t){if(e.is(t,"object")&&e.is(t.APIs,"object")){var i=t.APIs.getActionsPath;e.is(i,"object")&&e.is(i.url,"string")&&n({url:i.url,headers:i.headers})}},function(){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"require_failure",error:i})})})}}):p.discover({platformID:t.data.platformId,sourceID:t.sourceID}).then(function(t){if(e.is(t,"object")&&e.is(t.APIs,"object")){var i=t.APIs.getActionsPath;e.is(i,"object")&&e.is(i.url,"string")&&n({url:i.url,headers:i.headers})}},function(i){e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"require_failure",error:i})})}})}else e.is(t.onFailure,"function")&&t.onFailure.call(void 0,{type:"invalid_inputs",error:"invalid inputs"})},computeCtxActions:function(t,i){if(!this._isGoodInput(t,i))throw new Error("input is not in expected format");var n,a=this,r=i.skeleton,l=e.is(t,"array")?t.length:0,h=e.is(r)&&e.is(r._onesearch_collection)&&e.is(r._onesearch_collection.totalCount)?r._onesearch_collection.totalCount:0,g=void 0;s.getOption("search_web_in_win")||!e.is(r)||"oneToOne"===r._selectionMode_techno||e.is(s.getOption("search_compact_mode"))||(g={add_selectAll:l!==h,add_unselectAll:!0});var p=!0;e.is(i)&&e.is(i.fromPreview)&&!0===i.fromPreview&&(p=!1);let _=!1,f=!u.isMobile();n={add_preview:p,skeleton:r};let m=t[0].getPlatformID();_=u.hasTaggerSubjectURI(t,m),this._isSelectionFromSameSource(t).then(function(t){var o=i.skeleton.getOption("in_apps_search"),l=e.is(o),c=i.skeleton.getOption("addinMode"),h=e.is(c,"string")&&c.length>0,p=l&&"socket_id_#saved_search_edit#"===o.app_socket_id&&"furtive"!=o.mode;if(l&&!p){var m=a._buildEmptyActionsOnFailure(t);return e.is(g)&&a._addSelectUnselect(m,g),e.is(n)&&a._addPreview(m,n),f&&a._addInformation(m),void i.skeleton.setCtxMenuForItemViewOptions({actions_data:m,dropdownOptions:i})}t.isAddinMode=h,t.data.applicativeInfo={incontextMode:l&&!p,clientAppInfo:u.identifyClientInfo(c)},e.is(r)&&(t.widget_id=r.getOption("widgetId")),t.onComplete=function(o){if("success"===o.status){let c=!1;if(e.is(o)&&e.is(o.actions,"array"))for(var r=0;r<o.actions.length;r++){var l=o.actions[r].actions;let t=-1;for(let e=0;e<l.length;e++)if(l[e].id==s.getOption("command_id.relations")){if(0!=(t=e)){let e=l.splice(t,1);o.actions[r].actions.splice(0,0,e[0]),t=0}break}e.is(n)&&n.add_preview&&_?o.actions[r].actions.splice(t+1,0,a._action_AddTag,a._action_Preview,a._action_Information):e.is(n)&&n.add_preview&&!_?o.actions[r].actions.splice(t+1,0,a._action_Previewthat,a._action_Information):o.actions[r].actions.splice(t+1,0,a._action_AddTag,a._action_Information),c=!0}a._addEmptyActions(o,t),e.is(g)&&a._addSelectUnselect(o,g),c||(_&&a._addTag(o),f&&a._addInformation(o),e.is(n)&&a._addPreview(o,n)),i.skeleton.setCtxMenuForItemViewOptions({actions_data:o,dropdownOptions:i})}else{var c=a._buildEmptyActionsOnFailure(t);e.is(g)&&a._addSelectUnselect(c,g),_&&a._addTag(c),f&&a._addInformation(o),e.is(n)&&a._addPreview(c,n),i.skeleton.setCtxMenuForItemViewOptions({actions_data:c,dropdownOptions:i})}},t.onFailure=function(o){if(e.is(o)&&e.is(o.error)){var r=null;d.warn("Error during action computation: "+o.error),s.getOption("search_web_in_win")||("invalid_inputs"===o.type?(r={actions:[{actions:[]}]},a._addSelectUnselect(r,{add_selectAll:!0})):(r=a._buildEmptyActionsOnFailure(t),e.is(g)&&a._addSelectUnselect(r,g),_&&a._addTag(r),f&&a._addInformation(r),e.is(n)&&a._addPreview(r,n))),i.skeleton.setCtxMenuForItemViewOptions({actions_data:r,dropdownOptions:i})}},a.getActions(t)},function(t){var s=a._buildEmptyActionsOnFailure(t);e.is(g)&&a._addSelectUnselect(s,g),a._addTag(s),e.is(n)&&a._addPreview(s,n),f&&a._addInformation(s),i.skeleton.setCtxMenuForItemViewOptions({actions_data:s,dropdownOptions:i}),o._displayAlert({message:c.replace(c.get("localActions_multiSource")),className:"error"})})}})}),define("DS/SNResultUX/layouts/SNSkeletonMgt_v2",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Listener","UWA/Element","DS/WAFData/WAFData","DS/PubSub/PubSub","DS/PlatformAPI/PlatformAPI","UWA/Utils/InterCom","DS/WebappsUtils/Performance","DS/MessageBus/MessageBus","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/UIKIT/Alert","DS/UIKIT/Mask","DS/UIKIT/Native/Dropdown","DS/UIKIT/DropdownMenu","DS/UIKIT/Spinner","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchCom","DS/Utilities/Utils","DS/SNInfraUX/SearchUtils","DS/SNResultUX/utils/WildcardMgr","DS/SNInfraUX/ServiceDelegationLoader","DS/SNResultUX/utils/SearchActions","DS/SNResultUX/utils/SearchLocalActions","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","DS/SNResultUX/utils/ResultUX_customization","DS/SNResultUX/utils/AdvSearchMgr","DS/SNResultUX/utils/SearchTagsTransformation","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNResultUX/views/W3DXComponents/Views/Item/SwitcherView","DS/SNResultUX/views/helpers/SearchTreeListView","DS/SNResultUX/views/helpers/SearchDataGridView","DS/SNResultUX/views/helpers/SearchRespTileGridView","DS/SNResultUX/views/helpers/SearchRespTextualTileGridView","DS/SNResultUX/views/helpers/SearchRespThumbnailGridView","DS/SNResultUX/views/helpers/SearchWhatView","DS/SNResultUX/views/helpers/SearchWhereView","DS/SNResultUX/views/helpers/SearchWhenView","DS/SNResultUX/views/helpers/SearchWhoView","DS/SNResultUX/views/helpers/SearchMyContentView","DS/SNResultUX/SearchPQListUX","DS/SNResultUX/views/utils/SearchCounterView","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassPlatformServices/OpenWith","DS/SNResultUX/utils/SearchDoubleClickHandler","DS/WebRecordEnabler/Adapter","DS/SNInfraUX/Logger","css!DS/UIKIT/UIKIT.css","DS/SNResultUX/utils/ResultsUtils"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b,C,y,I,D,T,A,x,N,O,P,E,k,M,R,V,U,L,F,j,W,X,B,H,G,z,q,Q,Z,J,Y,K,$,ee,te,ie){"use strict";return t.extend(w,i,n,s,{uwaClassName:"DS/SNResultUX/SNSkeletonMgt_v2",name:"DS_SNResultUX_SNSkeletonMgt_v2",_skeleton:null,getSkeleton:function(){return this._skeleton},_onesearch_collection:null,_panelTitle:null,_searchcom_socket:null,_compass_socket:null,_WebInWinCtxActionSocket:null,_currentItemView:null,_myDatagridView:null,_isStartWithTableView:!1,_isFirstTimeTableViewSwitch:!0,_WidgetTitleObj:null,_advSearchMgr:null,_searchActions:null,_model:null,ctxMenu:null,_currentItemViewCid:null,_BI_Shades:null,_selectionMode_techno:"nullToMany",_neverAction:!1,_informationPanel:null,_informationZone:null,_informationState:!1,_lastSelectedItem:null,_ctxMenuTarget:null,_IsFirstTimeDone:!1,_IsFirstPageOfResultsDone:!1,_lastSearchOptions:null,_firstPage:0,_default_results_perpage:0,_in_app_multiSel:null,_printWindow:null,_subscriptions:null,_previewState:!0,_viewsId:[],_order_field:"",_order_by:"",_diplaySecurityContextInfoOnce:!0,_searchWidget:null,_selectionOccurred:!1,init:function(t){ee.groupCollapsed("SNSkeletonMgt_v2.init"),ee.log("options:"),t&&ee.log(t);var i=this;if(this._previewState=!1,this.closePrintWindow=function(){e.is(i._printWindow)&&i._printWindow.close()},window.addEventListener("beforeunload",this.closePrintWindow),this._subscriptions={},this._WidgetTitleObj={},e.is(t)&&!e.is(t._selectionMode_techno)&&e.is(t.in_apps_search)&&e.is(t.in_apps_search.multiSel)&&(t._selectionMode_techno=!0===t.in_apps_search.multiSel?"nullToMany":"oneToOne"),e.is(C)&&e.is(C.options.search_settings)&&e.is(C.options.search_settings.multiSel)&&!1===C.options.search_settings.multiSel&&(t._selectionMode_techno="oneToOne"),t._neverAction=!1,e.is(C)&&e.is(C.options.search_settings)&&e.is(C.options.search_settings.neverAction)&&!0===C.options.search_settings.neverAction&&(t._neverAction=!0),!0===T.isInTheSimpleSearch({tenant:t.resources.active_tenant})&&!0===y.getItem("NomultiSelection")){t._selectionMode_techno="oneToOne";let i=C.getOption("search_compact_mode");e.is(i)&&!1===i&&(t._selectionMode_techno="nullToMany")}this._parent(t);var n=this.getOption("in_apps_search");if(n?(E.setContextOptions(n),e.is(n.title,"string")&&(this._WidgetTitleObj.searchTitlePrefix=n.title)):E.setContextOptions(null),this._selectionMode_techno=t._selectionMode_techno||"nullToMany",this._neverAction=t._neverAction,this._skeleton=new h(this._buildSkeletonRenderers()),e.is(this.getOption("renderTo"))){this.render().inject(this.getOption("renderTo"));var s="100%";if(!0===this.getOption("furtive")){var o=document.documentElement.clientWidth/window.innerWidth,a=48;o>1&&(a*=2*o),"ipad"===T.getDeviceCategory()&&(a=85),s="calc(100% - "+a.toString()+"px)",!T.isMobile()||"android"!==T.getDeviceCategory()&&"iphone"!==T.getDeviceCategory()||(s="90%")}this._skeleton.setHeight(s),this._skeleton.container.addClassName("onesearch_skeleton")}e.is(this.getOption("observable"),"object")&&this.listenTo(this.getOption("observable"),{onSearchSkeletonPQ:function(){if(!e.is(i._skeleton))return ee.error("No skeleton !"),null;Q.showPQSelector({pqSelectionCallback:function(t){!0===C.getOption("search_web_in_win")&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("PQSelector",t)}})},onSearchSkeleton:function(t){if(i._IsFirstTimeDone=!1,i._IsFirstPageOfResultsDone=!1,!e.is(i._skeleton))return ee.error("No skeleton !"),null;i._skeleton._alert&&(i._skeleton._alert.destroy(),i._skeleton._alert=null),e.is(i._searchActions)&&e.is(i._searchActions._cleanPopOver,"function")&&i._searchActions._cleanPopOver(),i.getCollection().custoAction&&i.getCollection().custoAction.popover&&i.getCollection().custoAction.popover.hide(),"/onesearch/"!==i._skeleton.getRoute()&&i._skeleton.slideBack(),i._order_by=t.order_by?t.order_by:i._onesearch_collection&&i._onesearch_collection.service_parameters?i._onesearch_collection.service_parameters.order_by:"",i._order_field=t.order_field?t.order_field:i._onesearch_collection&&i._onesearch_collection.service_parameters?i._onesearch_collection.service_parameters.order_field:"";var n={query:t.search_criteria,mode:t.search_mode,refine:t.tag_filter,adv_search:t.adv_search,advanced_criteria:t.advanced_criteria,source:t.source,originalSearchCriteria:t.originalSearchCriteria,specific_source_parameter:t.specific_source_parameter,order_field:i._order_field,order_by:i._order_by,recent_search:t.recent_search,context:t.context,searchInCriteria:t.searchInCriteria,idWaitLoading:t.idWaitLoading,refineSearch:t.refineSearch};C.getOption("search_web_in_win")&&e.is(i.order_field)&&e.is(i.order_by)&&(n.order_field=i._order_field,n.order_by=i._order_by),T.isFUN109031Active()&&(i.resetMultisel(),i._lastSelectedItem=null);var s=i.getCollection(),o=!0;n.query!==T.SearchTypeEnum.ADVANCED_SEARCH||e.is(t.advanced_criteria)||s._ctx_options&&s._ctx_options.advanced_search&&(s._ctx_options.advanced_search.searchOnInit&&e.is(s._ctx_options.precond,"string")&&s._ctx_options.precond.trim().length>0&&(t.advanced_criteria=s._ctx_options.precond),!1===s._ctx_options.advanced_search.showByDefault&&(o=!1));var a=!1;e.is(t.advanced_criteria)&&t.advanced_criteria.length&&n.query!==T.SearchTypeEnum.MY_RECENT_CONTENT?(n.query===T.SearchTypeEnum.ADVANCED_SEARCH?(n.query="",a=!0):e.is(s._ctx_options)&&e.is(s._ctx_options.advanced_search)&&(e.is(s._ctx_options.precond)&&s._ctx_options.precond.length>0?n.query.trim()!==s._ctx_options.precond.trim()&&(n.query.length&&(n.query+=" AND "),n.query+=s._ctx_options.precond):n.query=""),n.query.length&&(n.query+=" AND "),n.query+=t.advanced_criteria):e.is(t.advanced_criteria)&&e.is(t.adv_search)&&!0===t.adv_search&&""===t.advanced_criteria&&(a=!0),e.is(t.localFilter,"object")&&(n.localFilter=t.localFilter),e.is(t.fromTopbar)&&(n.fromTopbar=t.fromTopbar);var r=null,l=null,c=i.getCollection().getTaggerProxy(),d=c.getCurrentFilter();e.is(d)&&(r=d.localfilters),e.is(t.tag_filter,"object")&&(l=t.tag_filter.localfilters),UWA.equals(r,l)||(!e.is(r)||S.isEmpty(r)||e.is(r,"object")&&!Object.keys(r).length)&&e.is(l)&&!0!==t.refresh&&e.is(c)&&e.is(c.setLocalFilter,"function")&&c.setLocalFilter(l,!1),e.is(t.search_criteria_to_display,"string")&&t.search_criteria_to_display.length>0&&(n.search_criteria_to_display=t.search_criteria_to_display),e.is(l,"object")&&l.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&1===Object.keys(l).length&&(e.is(c)&&e.is(c.clearLocalFilter,"function")&&c.clearLocalFilter(),e.is(c)&&e.is(c.clearLocalGrouping,"function")&&c.clearLocalGrouping());var u=function(){n.update_incontext_options=t.update_incontext_options;var r=s.getRequestCriteria().service_params;s.setRequestCriteria("fed_search",n),s.setSearchSource(t.source);var l=i._skeleton.getViewAt(0);if(l&&l.contentsViews)for(var d in l.contentsViews)l.contentsViews[d].onSearch&&l.contentsViews[d].onSearch(t);var u=!1,h=s.getRequestCriteria().service_params,g=!0;e.is(c.filters)&&e.is(c.filters.allfilters)&&0!==Object.keys(c.filters.allfilters).length&&(g=!1),e.is(h)&&(h.query===T.SearchTypeEnum.ADVANCED_SEARCH||a)&&h.query!==T.SearchTypeEnum.MY_RECENT_CONTENT&&g&&((!e.is(h.refine,"object")||e.is(h.refine.allfilters,"object")&&Object.keys(h.refine.allfilters).length>0||e.is(h.refine.localfilters,"object")&&Object.keys(h.refine.localfilters).length>0||e.is(h.refine.PLMParameters)&&e.is(h.refine.PLMParameters.plmparam)&&Object.keys(h.refine.PLMParameters.plmparam).length>0)&&e.is(h.refine,"object")||(u=!0));var p=s._ctx_options;if(o&&u)s.getTaggerProxy().clearLocalFilter(),s.getTaggerProxy().clearLocalGrouping&&s.getTaggerProxy().clearLocalGrouping(),e.is(i._advSearchMgr)&&(i._advSearchMgr.clearFilters(),i._advSearchMgr.getAndDisplayAdvancedSearch(!0),s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage());else if(e.is(s._ctx_options)&&e.is(s._ctx_options.app_socket_id)&&"socket_id_#saved_search_edit#"===s._ctx_options.app_socket_id&&e.is(s._ctx_options.advanced_search))e.is(i._advSearchMgr)&&(i._advSearchMgr.getAndDisplayAdvancedSearch(!0,t),s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage());else if(!p||!r||h.query!==T.SearchTypeEnum.ADVANCED_SEARCH)if(C.getOption("search_web_in_win")){let e=0;i._skeleton.getViewAt(0)&&"table"===i._skeleton.getViewAt(0).currentViewId&&(e=650),setTimeout(function(){s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage()},e)}else s._resetState(),s.reset(),i._updateWidgetTitleWithNbResult(t),i._defineViews(),i._loadFirstPage()},h=T.identifyClientInfo();if(!0!==this.getOption("transient_context")&&"3DDashboard"===h.identifier){require(["DS/Dashboard/PublicAPI"],function(t){var i=t.getActiveTab();if(e.is(i)&&e.is(i.shouldPropagateSearch)&&!0===i.shouldPropagateSearch&&e.is(i.shouldPropagateSearchArg,"string")&&0<i.shouldPropagateSearchArg.length){let e=A.manageWildcardAddtion(i.shouldPropagateSearchArg);e=T.replacePQsWithCVPrefixes(e),n.searchInCriteria=e}u()})}else"3DSwym"===h.identifier?(n.query=T.replacePQsWithCVPrefixes(n.query),u()):u()}});var l="com.ds."+this.getOption("widgetId");this._compass_socket=new c.Socket(l),this._compass_socket.subscribeServer("com.ds.compass",window.parent),this._searchcom_socket=I.createSocket({socket_id:"search_skeleton_"+d.now(),widgetId:this.options.widgetId}),e.is(this._WebInWinCtxActionSocket)||(this._WebInWinCtxActionSocket=I.createSocket({socket_id:"_searchcom_socket_CtxAction"+Math.floor(1e5*Math.random()+1)}));var g=this.getOption("messagingChannel");if(this._WebInWinCtxActionSocket.addListener("onSetCtxMenuForItemViewOptions",this.setCtxMenuForItemViewOptions.bind(this)),this._subscriptions.onResetMultisel=u.subscribe({channel:g,topic:"onResetMultisel",callback:this.resetMultisel.bind(this)}),this._subscriptions.onclearWebInWinCSO=u.subscribe({channel:g,topic:"onclearWebInWinCSO",callback:this.resetMultiselWebInWinWithoutFire.bind(this)}),this._WebInWinCtxActionSocket.addListener("onLogout",this.logout.bind(this)),this._searchcom_socket.addListener("onItemSelected",D.debounce(this.onItemSelected.bind(this),100)),this._searchcom_socket.addListener("onItemUnselected",this.onItemUnselected.bind(this)),this._searchcom_socket.addListener("onItemDblClick",this.onItemDblClick.bind(this)),this._subscriptions.onFetchAndSelectAll=u.subscribe({channel:g,topic:"onFetchAndSelectAll",callback:this.onFetchAndSelectAllCallback.bind(this)}),this._searchcom_socket.addListener("widgetResize",function(){this._searchActions&&this._searchActions.updatePopoverPosition()}.bind(this)),this._subscriptions.sortForAllView=u.subscribe({channel:g,topic:"sortForAllView",callback:this.sortForAllView.bind(this)}),this._searchActions=new N({SNSkeleton:this}),this._diplaySecurityContextInfoOnce=!0,r.add("search:advancedSearchEdit",function(t){e.is(i._advSearchMgr)&&i._advSearchMgr.getAndDisplayAdvancedSearch(!0,t)}),ee.groupEnd(),r.add("search:updateWidgetTitle",function(e){i.setTitle({applicativeTitle:e,updatePinnedWidgetTitle:!0})}),this._subscriptions.showEmbeddedView=u.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"showEmbeddedView",callback:()=>{i.getCollection().getTaggerProxy().showEmbeddedView()}}),this._subscriptions.hideEmbeddedView=u.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"hideEmbeddedView",callback:()=>{i.getCollection().getTaggerProxy().hideEmbeddedView()}}),T.isFUN109031Active()&&!this.inContextSearch()){let t=e.extendElement(document.body).getElement("div#divSearchHead");e.is(t)&&t.addClassName("BETA-FUN109031")}},destroy:function(){ee.log("destroy"),!0===this._selectionOccurred&&this.resetCompassSelection(),y.commit(),this.stopListening(),window.removeEventListener("beforeunload",this.closePrintWindow),this.closePrintWindow=null,this._currentItemView=null,this._myDatagridView=null,e.is(this.indexedtimeMenu)&&(this.indexedtimeMenu=null),null!==this._informationPanel&&this._informationPanel.destroy(),this._informationPanel=null,e.is(this._informationZone)&&e.is(this._informationZone.destroy,"function")&&this._informationZone.destroy(),this._informationZone=null,this._lastSelectedItem=null,e.is(this._mySpinner)&&(this._mySpinner.destroy(),this._mySpinner=null),e.is(this._advSearchMgr)&&e.is(this._advSearchMgr.destroy,"function")&&(this._advSearchMgr.destroy(),this._advSearchMgr=null),e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("clearSearch",{destroy:!0}),this._onesearch_collection&&this._onesearch_collection.service_parameters&&this._onesearch_collection.setGlobalOrder("","");var t=this.getHelperCollectionId();if(T.getHelperCollection(t)&&T.deleteHelperCollection(t),u.unsubscribe(this._subscriptions.sortForAllView),u.unsubscribe(this._subscriptions.onFetchAndSelectAll),u.unsubscribe(this._subscriptions.onResetMultisel),u.unsubscribe(this._subscriptions.onclearWebInWinCSO),u.unsubscribe(this._subscriptions.showEmbeddedView),u.unsubscribe(this._subscriptions.hideEmbeddedView),e.is(this._skeleton)&&e.is(this._skeleton.getViewAt,"function")&&e.is(this._skeleton.getViewAt(0))&&e.is(this._skeleton.getViewAt(0).contentsViews)&&(this._skeleton.getViewAt(0).contentsViews.tile||this._skeleton.getViewAt(0).contentsViews.thumbnail)){var i=this._skeleton.getViewAt(0).contentsViews.tile?this._skeleton.getViewAt(0).contentsViews.tile:this._skeleton.getViewAt(0).contentsViews.thumbnail;e.is(i)&&(i._searchcom_socket.removeListener("onSelectAll"),i._searchcom_socket.removeListener("onSelectShift"));var n=this._skeleton.getViewAt(0).contentsViews.thumbnail?this._skeleton.getViewAt(0).contentsViews.thumbnail:this._skeleton.getViewAt(0).contentsViews.tile;e.is(n)&&(n._searchcom_socket.removeListener("onSelectAll"),n._searchcom_socket.removeListener("onSelectShift"))}e.is(this._skeleton)&&e.is(this._skeleton.destroy,"function")&&(this._skeleton.destroy(),this._skeleton=null),e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.setSNSkeleton)&&this._onesearch_collection.setSNSkeleton(null),e.is(this._onesearch_collection)&&(this._onesearch_collection.removeEvent("failure_on_parse"),this._onesearch_collection.removeEvent("response_treated"),this._onesearch_collection.removeEvent("update_title"),this._onesearch_collection.removeEvent("update_secutity_context"),this._onesearch_collection.removeEvent("onReset"),this._onesearch_collection.destroy(),this._onesearch_collection=null),e.is(this._searchcom_socket)&&(this._searchcom_socket.removeListener("onItemSelected"),this._searchcom_socket.removeListener("onItemUnselected"),this._searchcom_socket.removeListener("widgetResize"),this._searchcom_socket.removeListener("onItemDblClick"),this._searchcom_socket.disconnect(),I.deleteSocket(this._searchcom_socket.id),this._searchcom_socket=null),e.is(this._compass_socket)&&(this._compass_socket.unsubscribeServer("com.ds.compass"),this._compass_socket.disconnect(),this._compass_socket=null),e.is(this._WebInWinCtxActionSocket)&&(this._WebInWinCtxActionSocket.removeListener("onSetCtxMenuForItemViewOptions"),this._WebInWinCtxActionSocket.removeListener("onLogout"),this._WebInWinCtxActionSocket.disconnect(),I.deleteSocket(this._WebInWinCtxActionSocket.id),this._WebInWinCtxActionSocket=null),this._myDatagridView=null,this._WidgetTitleObj=null,this._dynamicPredicateSetType=null,this._dynamicPredicateSetKind=null,e.is(this._searchActions)&&(this._searchActions.removeEvent(),this._searchActions.destroy(),this._searchActions=null),e.is(this._printWindow)&&(this._printWindow.close(),this._printWindow=null),e.is(this.ctxMenu)&&(this.ctxMenu.destroy(),this.ctxMenu=null),this.options=null,this._parent()},render:function(){return this._skeleton.render()},getCollection:function(){if(null===this._onesearch_collection)throw new Error("Collection is not defined yet");return e.is(this._lastSelectedItem)&&e.is(this._lastSelectedItem.collection)?this._lastSelectedItem.collection:this._onesearch_collection},getContainer:function(){var t,i=this;return this._skeleton&&this._skeleton.container?t=this._skeleton.container:e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances)?UWA.Widgets.instances.forEach(function(n){n.id===i.getOption("widgetId")&&(t=e.extendElement(n.elements.body).getElement(".search-content-set-contents"))}):t=e.extendElement(document.body).getElement(".search-content-set-contents"),t},onSkeletonReady:function(){},onItemDblClick:function(t,i,n){let s=this;T.trackerData.search.previewItem?(T.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:T.trackerData.search.scenario,persVal:{pv13:T.trackerData.search.indexItem}}})):T.trackerData.search.selectItem&&(T.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:T.trackerData.search.scenario,persVal:{pv13:T.trackerData.search.indexItem}}}));let o=e.is(n)?n:this._onesearch_collection,a=P.buildCompassSelectionData({widgetId:e.is(this.getOption("widgetId"))?this.getOption("widgetId"):"",selectedModels:[o.get(t)]});e.is(n)?this.doubleClickHandler(t,a,n,function(){ee.log("[dbl click] - failed to open, should try preview!"),s._onItemTitleClick(i,null,n)}):this.doubleClickHandler(t,a,void 0,function(){ee.log("[dblClick] - no open possible for object :"+t)})},doubleClickHandler:function(t,i,n,s){K.handle({skeleton:this,id:t,collection:n,compassData:i,callbackOnFailedToOpen:function(){ee.log("Open not possible!"),e.is(s,"function")&&s()}})},getCurrentScrollView:function(){let t=null;if(e.is(this._skeleton)){var i=this._skeleton.getViewAt(0);e.is(i)&&e.is(i.contentsViews)&&e.is(i.currentViewId)&&"table"!==i.currentViewId&&i.contentsViews[i.currentViewId]&&e.is(i.contentsViews[i.currentViewId].nestedView.view)&&(e.is(i.contentsViews[i.currentViewId].nestedView.view.getScroller,"function")?t=i.contentsViews[i.currentViewId].nestedView.view.getScroller():e.is(i.contentsViews[i.currentViewId].nestedView.view._getScroller,"function")&&(t=i.contentsViews[i.currentViewId].nestedView.view._getScroller()))}return t},getCurrentView:function(){return this._skeleton.getViewAt(0)?this._skeleton.getViewAt(0).contentsViews[this._skeleton.getViewAt(0).currentViewId]:null},scrollToCellAt:function(){var t=this._skeleton.getViewAt(0);if(e.is(t)&&e.is(t.contentsViews)&&e.is(t.currentViewId)&&("tilebig"===t.currentViewId||"thumbnail"===t.currentViewId||"tile"===t.currentViewId)&&t.contentsViews[t.currentViewId]&&e.is(t.contentsViews[t.currentViewId].nestedView.view)&&e.is(this._lastSelectedItem)){var i=this.getCollection().indexOf(this._lastSelectedItem);if(-1===i&&(i=0),i>=0){var n=null,s=this.getCollection().getTreeDocument().getRoots();e.is(s,"array")&&i<s.length&&(n=s[i],e.is(t.contentsViews[t.currentViewId].nestedView.view.scrollToCellAt,"function")?t.contentsViews[t.currentViewId].nestedView.view.scrollToCellAt({cellID:n._getRowID(!0)}):e.is(t.contentsViews[t.currentViewId].nestedView.view._scrollToNode,"function")&&t.contentsViews[t.currentViewId].nestedView.view._scrollToNode(n,n._getRowID(!0)))}}},getHelperCollectionId:function(){var t=null,i=this.getOption("transient_context");if(e.is(i)&&("true"!==i&&!0!==i||(t=T.TRANSIENT_WIDGET_HELPER_ID)),!e.is(t)){var n=this.getOption("use_preexisting_call");!0!==n&&"true"!==n||(t=T.TRANSIENT_WIDGET_HELPER_ID)}return e.is(t)||(t=this.getOption("widgetId")),t},copyDataFromHelperCollection:function(t,i){if(e.is(t)&&e.is(i)){if(t.totalCount=UWA.clone(i.totalCount),0===t.totalCount&&e.is(i.length)&&(t.totalCount=i.length),t.setFailureView(i.getFailureView()),e.is(i._parse_alert)&&(t._parse_alert=UWA.clone(i._parse_alert)),0===t.totalCount){var n=T.constructEmptyViewMsg(V.get("no_result"));e.is(n)&&this._searchActions.setEmptyViewMessage(n)}t._indexingDate=UWA.clone(i._indexingDate),t._fedSearchLabel=UWA.clone(i._fedSearchLabel),t.state=UWA.clone(i.state),t._setTagsPromise=i._setTagsPromise,t._securityContext3DSpace=i._securityContext3DSpace,t._is3DSpaceSecurityContextDone=i._is3DSpaceSecurityContextDone,t._update_security_contextTodo=i._update_security_contextTodo;var s=t._ctx_options;i.forEach(function(i){i.collection=t;var n=!1;e.is(i.isAShowOnlyObject,"function")&&(n=i.isAShowOnlyObject()),!1===n&&k.getAvailableActions({attributes:i._attributes},function(e){e.forEach(function(e){-1===i.action_ids.indexOf(e.id)&&(i.action_ids.push(e.id),i.actions.push(e))}),i._attributes.actions&&0!==i._attributes.actions.length||(i._attributes.actions=i.actions.pluck("title"))},{inCtxOptions:s})}),i._fedsearchOptions.parse=!1,i._fedsearchOptions.silent=!1;var o=i.toArray();t.reset(o,i._fedsearchOptions),t.onHelperCopy(i),!0!==i.options.fetchSynthesisSeparately&&i._taggerDataPromise&&i._taggerDataPromise.then(function(){t._setTags(UWA.clone(i._helperSubjectsTags),UWA.clone(i._helpertagValues))}),i._catCollections&&(t._catCollections=i._catCollections),C.getOption("actionsProtocol_FUN065512")||this.computeCtxActions({data:o,rawData:!1}),e.is(i.service_parameters)&&e.is(i.service_parameters.order_by)&&e.is(i.service_parameters.order_field)&&t.setGlobalOrder(i.service_parameters.order_field,i.service_parameters.order_by),e.is(i.parsed_response)&&(t.parsed_response=i.parsed_response)}},_isOpenWithMenuAsked:function(t){var i=null;if(e.is(t,"array")&&!C.getOption("search_web_in_win"))for(var n=0;n<t.length&&!e.is(i);n++){var s=t[n];if(e.is(s)&&"3DCompass_#OpenWith"===s.id&&e.is(s.internalHelper,"object")){var o=s.internalHelper.getCmdInfo();e.is(o,"object")&&(e.is(o.type,"string")&&o.type.length>0||e.is(o.type,"array")&&o.type.length>0)&&(i={data:{items:[{objectId:s.internalHelper.getObjectID(),objectType:s.internalHelper.getType(),envId:s.internalHelper.getPlatformID(),serviceId:s.internalHelper.getServiceID(),displayName:s.internalHelper.getDisplayName(),displayType:s.internalHelper.getDisplayType(),contextId:s.internalHelper.getContextId()}]}},e.is(o.type,"string")?i.data.items[0].objectTaxonomies=[o.type]:i.data.items[0].objectTaxonomies=o.type,t.splice(n,1))}}return i},_initDropDown:D.debounce(function(t,i){var n=this,s=t;e.is(s)||(s=[]),0===s.length&&s.push({text:V.get("noActionsAvailable"),id:"noActionsAvailable"});var o=this._isOpenWithMenuAsked(t),a={items:s};e.is(i,"object")&&(a.target=i.target),e.is(a.target)||(a.target=this._ctxMenuTarget),e.is(a.target)||!0!==C.getOption("search_web_in_win")&&ee.error("_initDropDown : ERROR, target div is not available for dropdown !");var r=void 0;if(e.is(i)&&e.is(i.altPosition)&&(r={pageX:i.altPosition.x-20,pageY:i.altPosition.y-20},a.contextual=!0),a.bound=!1,a.removeOnHide=!0,e.is(this.ctxMenu)&&this.ctxMenu.destroy(),this.ctxMenu=null,C.getOption("search_web_in_win")?(a.target=e.extendElement(document.body),a.id="SearchMenu",this.ctxMenu=new f(a)):(e.is(i)||(a.scrollMode=!1),a.events={onHide:function(){e.is(n.ctxMenu)&&this.destroy(),n.ctxMenu=null},onClickOutside:function(){e.is(n.ctxMenu)&&this.destroy(),n.ctxMenu=null}},a.className="search-ctx-actions-dropdown-container",e.is(i,"object")&&e.is(i.fromPreview,"boolean")&&!0===i.fromPreview&&(a.className="search-preview-ctx-actions-dropdown-container"),a.scrollMode=!1,this.ctxMenu=new m(a)),e.is(o,"object")){let e=this.ctxMenu.items,t=this.computeOpenWithIndex(e);(new Y).set3DXContent(o).setIndex(t).render(this.ctxMenu)}e.is(r)?this.ctxMenu.show(!1,r):this.ctxMenu.show()},50),computeOpenWithIndex:function(e){let t=-1,i=-1,n=-1,s=-1,o=-1,a=C.getOption("command_id.add_tag"),r=C.getOption("command_id.new_preview"),l=C.getOption("command_id.new_information"),c=C.getOption("command_id.relations");for(let t=0;t<e.length;t++)if(e[t].id==c&&(o=t),e[t].id==a&&(i=t),e[t].id==l&&(s=t),e[t].id==r){n=t;break}return n>-1?t=n:i>-1?t=i:s>-1?t=s:o>-1&&(t=o),t+2},setCtxMenuForItemViewOptions:function(t){if(!e.is(t))return;var i=this;e.is(t.somethingSelected)&&"0"===t.somethingSelected&&P._displayAlert({message:V.get("error_select_command"),className:"error"});var n=t.actions_data,s=t.dropdownOptions;if(!e.is(n)||!e.is(n.actions))return;let o=this.getCollection();e.is(s)&&e.is(s.collection)&&(o=s.collection);var a=n.actions.length;a>C.getOption("max_item_for_contextualPanel")&&C.getOption("search_web_in_win")&&P._displayAlert({message:V.get("warning_max_ctx_panel",{nb1:a}),className:"info"});for(var r=0;r<a;r++){var l=o.get(n.actions[r].id);e.is(l)&&e.is(l.actions)&&(e.is(n.actions[r].actions)||(n.actions[r].actions=[]),l.actions.forEach(function(e){if(e._attributes.multisel&&n.actions.length>1)n.actions[r].actions.push(e);else if(1===n.actions.length)var t=i.chechActionToAddInMenu(e);!0===t&&n.actions[r].actions.push(e)}))}if(n.actions.length>0){var c=i._parseContextualMenu(n.actions,o),d=null,u=c.length;if(d=1===u?c[0]:i._menusIntersection(n.actions,c),e.is(s)&&e.is(s.fromPreview)&&!0===s.fromPreview){function h(e){for(var t=d.length-1;t>=0;t--){var i=d[t];if(i&&i.id===e){d.splice(t,1);break}}}h("unselect_all"),h("select_all")}i._initDropDown(d,s)}},chechActionToAddInMenu:function(t){var i=!0;if(e.is(t)){if(!0===C.getOption("nav_history"))if("config_explore"===t.id||"whereUsed"===t.id)!1===this.getOption("navHistory")&&(i=!1);return i}},fetchAll:function(t){var i=this,n="fetch",s="fetch";if(e.is(t)&&e.is(t.type)&&(n=t.type),e.is(t)&&e.is(t.subType)&&(n=t.subType),e.is(t)&&e.is(t.action_type)&&(s=t.action_type),e.is(t)&&e.is(t.subType)&&(s=t.subType),e.is(i._in_app_multiSel)&&"nullToMany"!==i._in_app_multiSel&&"fetch"===s)P._displayAlert({message:V.get("error_select_all"),className:"info"});else{var o=C.getOption("max_selection_for_selectall",{tenant:this.getActiveTenant()});i.param=t,e.is(i._searchActions.setSelected,"function")&&i._searchActions.setSelected(i._modelSelected);var a=o,r=this._skeleton.getViewAt(0);if(!e.is(r))throw new Error("Error, rootView undefined in SNSkeletonMgt.fetchAll !");var l=r.collection.totalCount;if(!1===r.collection.hasNextPage()||r.collection.length>=o){i.resetMultisel();let a=Math.max(o,r.collection.length);l>a&&(n="msgType_"+s,n=V.replace(V.get(n),{action_type:V.get("msgType_"+s)}),u.publish({channel:this.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:r.collection.length}}),P._displayAlert({message:V.get("warning_fetch_all",{nb1:r.collection.length,nb2:r.collection.totalCount,msgType:n}),className:"success"})),e.is(t)&&e.is(t.callback,"function")&&t.callback.call(t.context,t)}else{r.collection.state.pageSize=a;var c=C.serialize(),d=JSON.parse(c);i._default_results_perpage=d.search_settings.results_perpage,d.search_settings.results_perpage=a,C.initialize(d),r.collection.reset();var h=i.getContainer();h&&_.mask(h),r.collection.getFirstPageOfResults({reset:!0,fetchAll:!0,onComplete:function(){ee.log("SNSkeletonMgt_v2.fetchAll->onComplete getFirstPageOfResults"),l=r.collection.totalCount;let a=Math.max(o,r.collection.length);l>a&&(n="msgType_"+s,n=V.replace(V.get(n),{action_type:V.get("msgType_"+s)}),u.publish({channel:i.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:r.collection.length}}),P._displayAlert({message:V.get("warning_fetch_all",{nb1:r.collection.length,nb2:r.collection.totalCount,msgType:n}),className:"success"})),r.collection.generateTreeModelAsync().then(function(){let n=C.serialize(),s=JSON.parse(n);s.search_settings.results_perpage=i._default_results_perpage,C.initialize(s),_.unmask(h),e.is(t)&&e.is(t.callback,"function")&&t.callback.call(t.context,t)})},onFailure:function(){let n=C.serialize(),s=JSON.parse(n);s.search_settings.results_perpage=i._default_results_perpage,C.initialize(s),_.unmask(h),e.is(t)&&e.is(t.callback,"function")&&t.callback.call(t.context,{error:"TOO_MANY_RESULTS"})}})}}},onFetchAndSelectAllCallback:function(t){var i=this;e.is(t)||(t={}),t.callback=function(t){e.is(t.error)||i._selectAll()},i.fetchAll(t)},notifyReset:function(){this.resetCompassSelection();var t=this.getCollection().getTaggerProxy();for(var i in e.is(t)&&t.unfocus(),this.notifySelectionAddinMode(),this._viewsId)u.publish({channel:"Qchannel-searchgriview-"+this._viewsId[i],topic:"Qtopic-searchgriview-disableMultiSelMode",data:{}})},resetCompassSelection:function(){this._compass_socket&&(this._compass_socket.dispatchEvent("onResetObject",{}),this._compass_socket.dispatchEvent("onResetX3DContent",{}))},clearWebInWinCSO:function(){if(!0===C.getOption("search_web_in_win")){var e={objets_name:[]};this.onDispatchToWin(e,"onAddToCSO")}},resetMultisel:function(){this._model.unselectAll(),this.notifyReset(),this.clearWebInWinCSO()},resetMultiselWebInWinWithoutFire:function(){this._model.unselectAll(),this.notifyReset()},logout:function(){e.is(this._searchActions)&&e.is(this._searchActions.logOut)?this._searchActions.logOut():ee.error("!UWACore.is(this._searchActions) && (UWACore.is(this._searchActions.logOut)")},_parseContextualMenu:function(e,t){var i=[],n=0,s=e.length;for(n=0;n<s;n++)i[n]=this._getActionsForOneObject(e[n].id,e[n].actions,"",t);return i},_getActionsForOneObject:function(e,t,i,n){var s=[],o=0,a=t.length;for(o=0;o<a;o++)s[o]=this._getOneActionForOneObject(e,t[o],i,n);return s},_getActionsHelper:function(t){var i=this,n=this.getCollection();return{getModel:function(t){var i=n.get(t.id);if(e.is(i))return i},getValue:function(t){var i,s=n.get(t.id);if(e.is(s)){var o=t.predicate?t.predicate:t.attribute;i=s.get(o+"_value")}return i},getNLSValue:function(t){var i=n.get(t.id);if(e.is(i))return i.get(t.predicate)},getAllValues:function(t){var i=n.get(t.id);if(e.is(i))return i.toJSON()},setLabel:function(t){var s=n.get(t.id);if(e.is(s)){var o=n.indexOf(s),a=s.get("ds6w:label");s.set("ds6w:label",t.newLabel);var r=n.getTreeDocument().getNthRoot(o)._options.label;n.getTreeDocument().getNthRoot(o)._options.label=r.split(a).join(t.newLabel),n.getTreeDocument().getNthRoot(o)._options.grid["ds6w:label"]=t.newLabel,n.getTreeDocument().getNthRoot(o)._options.grid["ds6w:label_value"]=t.newLabel,i.getCurrentView().updateView()}},getCurrentViewID:function(){return i._skeleton.getViewAt(0).currentViewId},deleteResults:function(t){for(var s=0;s<t.ids.length;s++){var o=n.get(t.ids[s]);if(e.is(o)){var a=n.indexOf(o);n.remove(t.ids[s]),n.totalCount--,n.getTreeDocument().removeRoot(n.getTreeDocument().getNthRoot(a)),n.generateTreeModel(),i.getCurrentView().updateView()}}},displayAlert:function(e){e.widgetId=i.getOption("widgetId");var t=UWA.clone(e,!0);t.level&&(t.className=t.level),P._displayAlert(t)},getServiceID:function(t){var i=n.get(t.id);if(e.is(i))return i.getServiceID()},getPlatformID:function(t){var i=n.get(t.id);if(e.is(i))return i.getPlatformID()},getServiceURL:function(t){var i=n.get(t.id),s=t.service_id,o=t.platform_id;if(e.is(i)&&(s=i.getServiceID(),o=i.getPlatformID()),s&&o)if(C.getOption("search_web_in_win"))switch(s){case"3DSpace":t.onComplete.call(void 0,n.getSearchRessources().get3DSpaceUrl());break;default:e.is(t.onFailure,"function")&&t.onFailure.call(void 0,"unknown service ID in native context : "+t.serviceID)}else J.getServiceUrl({serviceName:s,platformId:o,onComplete:function(i){e.is(t.onComplete,"function")&&t.onComplete.call(void 0,i)},onFailure:function(){e.is(t.onFailure,"function")&&t.onFailure.call()}})},isMultiSelMode:function(){return!!(t&&t.selectedModels&&t.selectedModels.length>1)},getType:function(e){var i;return e?i=this.getValue({id:e,attribute:"ds6w:type"}):t&&t.id?i=this.getValue({id:t.id,attribute:"ds6w:type"}):t&&t.selectedModels&&t.selectedModels.length>0&&t.selectedModels[0]&&(i=this.getValue({id:t.selectedModels[0].id,attribute:"ds6w:type"})),i},getParentContainer:function(){var t=null;return e.is(i)&&e.is(i._skeleton)&&e.is(i._skeleton.container)&&(t=i._skeleton.container.parentElement),t},getClientInfo:function(){return T.identifyClientInfo(i.getOption("addinMode"))},isAPinnedWidget:function(){var t=i.getOption("widgetId"),n=!1;if(e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances,"array"))for(var s=0;s<UWA.Widgets.instances.length;++s){var o=UWA.Widgets.instances[s];if(o.id===t){e.is(o.getView,"function")&&"windowed"===o.getView().type&&(n=!0);break}}return n},canOpenATab:function(){var t=!1,n=i.getOption("observable").getOption("isTabBarVisible");return e.is(n,"function")&&(t=n()),t},getTarget:function(){return e.is(i._ctxMenuTarget)?i._ctxMenuTarget:null},dispatchEvent:function(e){i.getSearchActions().dispatchEvent(e.event,e.params)},setPopover:function(e){i.popover=e},isInContextMode:function(){var t=i.getOption("in_apps_search");if(e.is(t,"object"))return!0},hidePopover:function(){e.is(i.popover)&&(i.popover.hide(),i.popover=null)},selectAll:function(e){u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Select All"}}}),T.trackerData.search.selectItem=!0,i.onFetchAndSelectAllCallback(e)},unselectAll:function(){i.resetMultisel()},preview:function(t){if(!e.is(t))return;i._listSelectedElementsFromSearchBeforeLaunchingPreview=null;let n=i._getTreedocumentFromCollection(i.getCollection());if(e.is(n)&&e.is(n.getXSO,"function")){const t=n.getXSO();e.is(t)&&e.is(t.get,"function")&&(i._listSelectedElementsFromSearchBeforeLaunchingPreview=t.get())}var s=i.getOption("observable");if(e.is(s)){var o=i.ActivateDeactivatePreviewPanel();s.managepreviewPanel(o)}},getInformation:function(e){e.actionItem={model:{get:function(){return"InfoPanel"}}},i.getSearchActions().onActionClick(e)}}},_getOneActionForOneObject:function(t,i,n,s){var o,a=this,r=a.getCollection();if(e.is(s)&&(r=s),e.is(i.items))o={text:i.title,fonticon:i.icon},void 0!==i.id&&null!==i.id?(o.actionId=i.id,o.id=i.id):void 0!==i.title&&null!==i.title&&(o.id=i.title),o.items=this._getActionsForOneObject(t,i.items,i.title,s);else{var l=!1,c=!1,d=!1;"action-id-separator"===i.id?o={className:"divider"}:(C.getOption("actionsProtocol_FUN065512")?e.is(i.collection)?l=!0:e.is(i.image)?d=!0:c=!0:e.is(i.collection)?e.is(i.get("sourcejs"))?c=!0:l=!0:d=!0,C.getOption("actionsProtocol_FUN065512")?(o={text:d||c?i.title:i.get("title"),icon:d?i.image:c?i.icon:i.get("icon"),multisel:d||c?i.multisel:i.get("multisel"),sourcejs:d||c?i.sourcejs:i.get("sourcejs")},!c&&!l||C.getOption("search_web_in_win")||(o.fonticon=o.icon,delete o.icon)):o={text:d?i.title:i.get("title"),icon:d?i.image:i.get("icon"),multisel:d?i.multisel:i.get("multisel"),sourcejs:d?i.sourcejs:i.get("sourcejs")},!0===d&&(o.availabilityMode=i.availabilityMode),void 0!==i.id&&(o.actionId=i.id,o.data=i.id,o.id=i.id),void 0!==i.accelerator&&(o.accelerator=d?i.accelerator:i.get("accelerator")),e.is(i.disabled)&&(o.disabled=d?i.disabled:i.get("disabled")),o.handler=function(){T.trackerData.search.previewItem?(T.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"SearchAction",action:T.trackerData.search.scenario,persVal:{pv13:T.trackerData.search.indexItem}}})):T.trackerData.search.selectItem&&(T.trackerData.search.scenario="Open",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:T.trackerData.search.scenario,persVal:{pv13:T.trackerData.search.indexItem}}})),"goToDashboard"===i.id&&a.getPreviewStatus()&&a.getPreviewPanel().hideAndclean();var n={action_id:i.id,object_id:t,object_cid:a._currentItemViewCid,collection:r,model:r.get(t),actionsHelper:a._getActionsHelper({id:t}),object_ids:[t],widget_id:a.getOption("widgetId"),nav_history:y.getItem("nav_history")};if(l)i.get("callback")(n,arguments),a.dispatchEvent("onExploreAction",n);else if(c){var s=C.getOption("actionsProtocol_FUN065512")?i.sourcejs:i.get("sourcejs");if(e.is(s,"string"))require([s],function(e){e.executeAction(n,arguments)},function(e){ee.warn("Cannot load action handler "+e.requireModules),n.actionsHelper.getServiceURL({id:t,onComplete:function(e){var i=x.getRealtivePath({serviceID:n.actionsHelper.getServiceID({id:t})});x.loadModuleFromService(s,{serviceURL:e,relativePath:i}).then(function(e){},function(e){ee.warn("Cannot load action handler "+e.requireModules)})}})});else{ee.log("action handler not provided");var o=i.executeOptions;e.is(o,"object")?(o.selected_obj=n.object_id,o.displayAlert=n.actionsHelper.displayAlert,O.executeWSAction(o)):ee.warn("no options provided to execute the action")}}else require([i.sourcejs],function(e){e.executeAction(n,arguments)})},o.internalHelper={getCmdInfo:function(){return e.is(i.get,"function")?i.get("cmdInfo"):i.cmdInfo},getObjectID:function(){return t},getPlatformID:function(){return r.get(t).getPlatformID()},getServiceID:function(){return r.get(t).getServiceID()},getType:function(){return r.get(t).getType()},getDisplayName:function(){return r.get(t).getDisplayName()},getDisplayType:function(){return r.get(t).getDisplayType()},getContextId:function(){return r.get(t).getContextId()}}),e.is(n)&&(o.menu=n)}return o},_menusIntersection:function(t,i){var n=i.length;if(0===n)return[];for(var s=i[0],o=[],a=1;a<n;a++){var r=i[a],l=0;e.is(r)&&e.is(r.length)&&(l=r.length);for(var c=0;c<l;c++){for(var d=s.length,u=!1,h=0;h<d;h++)if(e.is(r[c].sourcejs)&&e.is(r[c].actionId)&&e.is(s[h].sourcejs)&&e.is(s[h].actionId)){if(r[c].actionId===s[h].actionId&&r[c].sourcejs===s[h].sourcejs){u=!0;break}}else if(r[c].items&&s[h].items&&r[c].text===s[h].text){u=!0;var g=[];g[0]=r[c].items,g[1]=s[h].items;var p=this._menusIntersection(t,g);r[c].items=p;break}!0===u&&o.push(r[c])}s=o,o=[]}return this._updateHandler(t,s),s},_handleAction:function(t,i,n){var s={action_id:n[t].id,actionsHelper:this._getActionsHelper({selectedModels:i}),collection:this.getCollection(),object_ids:function(){var t=[];if(e.is(i,"array"))for(var n=0;n<i.length;n++)t.push(i[n].id);return t}(),widget_id:this.getOption("widgetId")};require([n[t].sourcejs],function(e){e.executeAction(s,arguments)},function(e){x.loadModuleFromService(n[t].sourcejs,{serviceID:s.actionsHelper.getServiceID({id:i[0].id}),platformID:s.actionsHelper.getPlatformID({id:i[0].id})}).then(function(e){e.executeAction(s,arguments)},function(e){ee.warn("Cannot load action handler "+e.requireModules)})})},_updateHandler:function(t,i){var n=this,s=t.length;if(0===s)return i;var o=0;if(e.is(i)&&(o=i.length),s>1)for(var a=0;a<o;a++)for(var r=0;r<1;r++)if(void 0!==i[a].handler&null!==i[a].handler)if(C.getOption("actionsProtocol_FUN065512"))i[a].handler=n._handleAction.bind(n,a,t,i);else{var l={object_id:t[r].id};i[a].handler=function(e){var i=this,s=t[0].actions[0].sourcejs||t[0].actions[0]._attributes.sourcejs;require([s],function(s){for(var o,a=0;a<i.items.length;a++)if(e.id===i.items[a].id){o=i.items[a].actionId;break}t.action_id=o,t.collection=n.getCollection(),s.executeAction(t,l)})}}else void 0!==i[a].items&null!==i[a].items&&n._updateHandler(t,i[a].items)},_buildSkeletonRenderers:function(){var t=this,i={onesearch:{collection:"DS/SNResultUX/collections/SearchCollection",collectionOptions:function(){var i=C.getOption("results_perpage")<40?40:C.getOption("results_perpage");return e.is(i)&&"number"!==e.typeOf(i)&&(i=parseInt(i)),{state:{pageSize:i},event:{onSetup:function(i){try{e.is(t._advSearchMgr)||(t._advSearchMgr=new M({collection:t._onesearch_collection=i,tagger_proxy:t.getOption("tagger_proxy"),resources:t.getOption("resources")})),t._onesearch_collection=i,t.setup(),t._onesearch_collection.setSearchRessources(t.getOption("resources")),t._onesearch_collection.setTaggerProxy(t.getOption("tagger_proxy")),t._onesearch_collection.addEvent("failure_on_parse",function(e){t._failure(i,e,"failure_on_parse")}),t._onesearch_collection.addEvent("response_treated",function(e){C.getOption("actionsProtocol_FUN065512")||t.computeCtxActions(e)}),t._onesearch_collection.addEvent("update_title",function(e){t._updateWidgetTitleWithNbResult(e)}),t._onesearch_collection._ctx_options=t.getOption("in_apps_search"),t._onesearch_collection.setSearchSource(t.getOption("source")),t._searchActions.setCollection(i),t._searchActions.setSkeleton(t._skeleton),i.setSNSkeleton(t);var n={isTransientWidget:!0};"3DDashboard"===T.identifyClientInfo().identifier&&(n.isTransientWidget="true"===t.getOption("transient_context")),i.setTagsTransformer(new R(n)),t.dispatchEvent("onSkeletonReady"),t._model=t._onesearch_collection.getTreeDocument();let s=t.getPreference("informationPanelState");e.is(s,"boolean")&&t.setInformationStatus(s)}catch(e){ee.log("[3dSearch|buildSR::onSetup]",e)}}},fetchSynthesisSeparately:T.isFetchSynthesisSeparately(),transient_context:t.getOption("transient_context")}},view:"DS/SNResultUX/views/utils/SearchContentSet",viewOptions:t._onesearch_viewOptions.bind(t),fetchMode:"never",swipe:!1,cacheFacets:!1}};return e.merge(i,k.availableviews()),i},_onesearch_viewOptions:function(){var t=this,i=E.getItemViewOptions(this.getOption("resources"));i.request_criteria=t._retrieveRequestCriterias.bind(t),i.request_criteria_without_precond=t._retrieveRequestCriteriasWithoutPrecond.bind(t),i.getCollection=t.getCollection.bind(t);var n=this.getOption("in_apps_search"),s=this.getOption("pinToDashboard");e.is(n)&&e.is(n.multiSel)&&!1===n.multiSel&&(t._selectionMode_techno="oneToOne"),t._in_app_multiSel=t._selectionMode_techno;var o=t._searchActions.getGlobalActions({itemViewOptions:i,XMLViewOptions:E.getXMLViewOptions(),widgetId:t.getOption("widgetId"),in_apps_search:t.getOption("in_apps_search"),pinToDashboard:s,tenant:t.options.resources.active_tenant}),a=[],r=C.getOption("enableDataGridView")?F:L;if(a=UWA.clone(E.getAvailableViews({activeTenant:this.options.resources.active_tenant}))){this._viewsId=[];for(var l=0;l<a.length;l++)switch(a[l].id){case"thumbnail":a[l].view=X,this._viewsId.push("RespThumbnailGridView");break;case"tilebig":a[l].view=W,this._viewsId.push("RespTextualTileGridView");break;case"tile":a[l].view=j,this._viewsId.push("RespTileGridView");break;case"table":a[l].view=r,C.getOption("enableDataGridView")?this._viewsId.push("DataGridView"):this._viewsId.push("TreeListView")}}T.isFUN109031Active()&&!this.inContextSearch()&&(a.push({id:"what",title:V.get("view.what.title"),nlsKeys:"view.what.title",view:B,actived:!1}),this._viewsId=["WhatView"],a.push({id:"who",title:V.get("view.who.title"),nlsKeys:"view.who.title",view:z,actived:!1}),this._viewsId=["WhoView"],a.push({id:"when",title:V.get("view.when.title"),nlsKeys:"view.when.title",view:G,actived:!1}),this._viewsId=["WhenView"],a.push({id:"where",title:V.get("view.where.title"),nlsKeys:"view.where.title",view:H,actived:!1}),this._viewsId=["WhereView"],a.push({id:"myContent",title:V.get("view.myContent.title"),nlsKeys:"view.myContent.title",view:q,actived:!1,default:!1}),this._viewsId=["myContent"]);for(var c=0,d=a.length;c<d;c++)e.is(a[c])&&(a[c].itemViewOptions=i,a[c].widgetId=t.getOption("widgetId"),a[c].advSearchMgr=function(){return t.getAdvSearchMgr()});e.is(a)&&a.push({id:"list",view:g,itemViewOptions:i,selectionMode:"oneToOne"});var h={name:"onesearch",lazyRender:!0,detail:{title:V.get("TitleSkeleton"),view:Z},actions:e.is(o)?o:{},contents:{useInfiniteScroll:!0,usePullToRefresh:!1,selectionMode:"oneToOne",selectionMode_techno:t._selectionMode_techno,neverAction:t._neverAction,views:a,itemViewOptions:{getCurrentView:function(){var i=null,n=t._skeleton.getViewAt(0);return e.is(n)&&e.is(n.currentViewId)&&e.is(n.contentsViews)&&(i=n.contentsViews[n.currentViewId].nestedView),i},getWidgetId:function(){return t.getOption("widgetId")}}},events:{onSwitch:function(){t._defineViews();var i=t.getOption("in_apps_search"),n="LastSearchViewMode";e.is(i)&&(n="LastInAppsSearchViewMode"),"what"!==arguments[2]&&"who"!==arguments[2]&&"when"!==arguments[2]&&"where"!==arguments[2]&&"myContent"!==arguments[2]&&(y.setItem(n,arguments[2]),y.commit());var s=t._skeleton.getViewAt(0);if(s)for(var o in s.contentsViews)e.is(s.contentsViews[o])&&e.is(s.contentsViews[o].onSwitch,"function")&&s.contentsViews[o].onSwitch(s.currentViewId);var a=arguments[2];u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"InvestigateDisplay",persDim:{pd4:a}}}),t._searchActions.setDisplayMode(a),e.is(t.options)&&e.is(t.options.observable)&&e.is(t.options.observable.options)&&e.is(t.options.observable.options.update_preference,"function")&&t.options.observable.options.update_preference("searchViewMode",a),null!==t.getPreviewPanel()&&t.getPreviewPanel().switchViewMode(t.getCurrentView()),null!==t.getInformationPanel()&&t.getInformationPanel().switchViewMode(t.getCurrentView()),t._searchActions&&t._searchActions.updatePopoverPosition(),e.is(t._myDatagridView)&&e.is(t._myDatagridView._deleteCustoPanel,"function")&&t._myDatagridView._deleteCustoPanel(),t.popover&&t.popover.hide(),t.getCollection().custoAction&&t.getCollection().custoAction.popover&&t.getCollection().custoAction.popover.hide(),setTimeout(function(){t._BI_Shades&&t.setShadings(t._BI_Shades)},500)}},switcher:{view:U}},p=null;e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances)&&UWA.Widgets.instances.forEach(function(i){i.id===t.getOption("widgetId")&&e.is(i.data)&&e.is(i.data.searchViewMode,"string")&&(p=i.data.searchViewMode)});var _=t.getOption("in_apps_search");e.is(_)&&e.is(_.UXOptions)&&e.is(_.UXOptions.viewMode,"string")&&_.UXOptions.viewMode.length>0&&(p=_.UXOptions.viewMode),!e.is(_)||e.is(p)&&e.is(p,"string")&&0!==p.length||(p=y.getItem("LastInAppsSearchViewMode")),!e.is(_)||"what"!==p&&"where"!==p&&"who"!==p&&"when"!==p||(p=y.getItem("LastInAppsSearchViewMode")),e.is(p)&&e.is(p,"string")&&0!==p.length||(p=y.getItem("LastSearchViewMode")),e.is(p)&&e.is(p,"string")&&0!==p.length||(p=C.getOption("defaultViewModeAfterCacheCleaning",{tenant:this.getOption("resources").getActiveTenant()}));for(var f=h.contents.views,m=0,v=f.length;m<v;m++)delete f[m].default,f[m].id===p&&(f[m].default=!0,u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"InvestigateDisplay",persDim:{pd3:p}}}));return h.tempSingleIconOnMobile=!0,h["data-rec-id"]=!0,h},_failure:function(t,i){if(!e.is(this._skeleton))throw new Error("Error, this._skeleton undefined in SNSkeletonMgt._failure!");if(!(e.is(t)&&e.is(t.state)&&e.is(t.state.currentPage,"number")&&0!==t.state.currentPage)){var n="";e.is(i)&&e.is(i.error)&&e.is(i.error.errorMessage)&&e.is(i.error.errorCode)?(""!==(n=V.get(i.error.errorCode))&&n!==i.error.errorCode||(n=i.error.errorMessage),this._searchActions.setEmptyViewMessage(n)):e.is(i,"string")&&this._searchActions.setEmptyViewMessage(i),r.dispatch("errorManager:tooltip",[])}},_retrieveRequestCriterias:function(){var t={};return e.is(this.getCollection())&&(t=this.getCollection().getRequestCriteria()),t},_retrieveRequestCriteriasWithoutPrecond:function(){var t={};e.is(this.getCollection())&&(t=this.getCollection().getRequestCriteria());var i=E.getContextOptions();if(e.is(i)&&e.is(i.precond)&&e.is(i.default_with_precond)&&e.is(i.show_precond)&&!0===i.default_with_precond&&!1===i.show_precond){var n=" AND "+i.precond;e.is(t.service_params)&&e.is(t.service_params.query)&&-1!==t.service_params.query.indexOf(n,t.service_params.query.length-n.length)&&(t.without_precond=t.service_params.query.replace(new RegExp(n+"$"),""))}return t},_getAndDisplayLastIndexTime:function(){if(C.getOption("show_last_indexation_time")&&!(e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.service_parameters)&&e.is(this._onesearch_collection.service_parameters.query)&&T.SearchTypeEnum.MY_RECENT_CONTENT===this._onesearch_collection.service_parameters.query)){var t=this.getCollection();if(e.is(t)){var i=t.getIndexingDate();if(e.is(i,"object")){var n=null,s="",o=null;for(var a in i)if(e.is(i[a])&&-1!==i[a]){var r=(o=new Date(1e3*i[a])).toLocaleString();s.length>0&&(s+="<br>"),s+=V.replace(V.get("lastVaultIndexedTime"),{vault:a,time:r}),n?i[a]<n&&(n=i[a]):n=i[a]}var l=null;if(n){var c=new Date(1e3*n),d=new Date;l=(d-c)/1e3/3600>24||c.getDay()!==d.getDay()?c.toLocaleString():c.toLocaleTimeString()}this.updateLastIndexInfo(o,l)}}}},_defineViews:function(){var t=this._skeleton.getViewAt(0);t&&"table"===t.currentViewId?e.is(this._myDatagridView)||(this._myDatagridView=t.contentsViews.table):t&&"tile"===t.currentViewId?e.is(this._myTileGridView)||(this._myTileGridView=t.contentsViews.tile):t&&"thumbnail"===t.currentViewId&&(e.is(this._myThumbnailGridView)||(this._myThumbnailGridView=t.contentsViews.thumbnail))},updateLastIndexInfo:function(e,t){if(this.indexedtimeIcon){let i;this.indexedtimeIcon.className="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock";let n=this;if(e){let s=C.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});i=V.replace(V.get("lastIndexedTime"),{indexTime:t,recentDelta:s}),this.indexedtimeMenu.items[0].elements.container.setAttribute("timestampIndex",e.getTime()),this.indexedtimeMenu.updateItem({id:this.indexedtimeMenu.items[0].id,text:i}),this.indexedtimeMenu.elements.container.setStyles({"max-width":"434px"}),this.indexedtimeMenu.items[0].elements.container.setStyles({"text-transform":"none"}),this.indexedtimeMenu.items[1].elements.container.setStyles({"text-transform":"none","font-weight":"bold"}),setTimeout(function(){n.updateByUXOptions(t)},200)}else setTimeout(function(){n.updateLastIndexInfo(e,t)},200)}else if(T.isFUN109031Active()&&this.errorManagerTooltip)if(e)this.errorManagerTooltip.getBody()&&this.errorManagerTooltip.getBody().getChildren()[0]&&this.errorManagerTooltip.getBody().getChildren()[0].setHTML(V.replace(V.get("lastIndexedTime6w"),{indexTime:t,recentDelta:C.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()})}));else{var i=this;setTimeout(function(){i.updateLastIndexInfo(e,t)},200)}},updateByUXOptions:function(t){if(e.is(this.options))if(e.is(this.options.observable))if(e.is(this.options.observable.onesearch_indexedtimeIcon))if(e.is(this.options.observable.onesearch_indexedtimeIcon.tooltip))if(e.is(this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody,"function")){var i=this.getCollection().getSNSkeleton()&&this.getCollection().getSNSkeleton().getOption("in_apps_search"),n=i&&i.UXOptions&&!i.UXOptions.searchRecentContent,s=i&&i.UXOptions&&!i.UXOptions.lastIndexationTime,o=C.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});this.options.observable.indexedtimeMenu.enabled=!n,n&&!s?(this.options.observable.onesearch_indexedtimeIcon.style.cursor="default",this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(V.replace(V.get("lastIndexedTimeTooltip"),{indexTime:t}))):!n&&s?this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(V.replace(V.get("switchToRecentContent"),{recentDelta:o})):n&&s?this.options.observable.onesearch_indexedtimeIcon.remove():this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody(V.replace(V.get("switchToRecentContent"),{recentDelta:o})+"<br>"+V.replace(V.get("lastIndexedTimeTooltip"),{indexTime:t}))}else ee.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable.onesearch_indexedtimeIcon.tooltip.setBody!");else ee.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable.onesearch_indexedtimeIcon.tooltip!");else ee.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable.onesearch_indexedtimeIcon!");else ee.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options.observable!");else ee.warn("SNSkeletonMgt_v2.updateByUXOptions no this.options!")},_updateWidgetTitleWithNbResult:function(t){e.is(this._WidgetTitleObj)&&(e.is(t)&&(e.is(t.originalSearchCriteria)&&(this._WidgetTitleObj.search_criteria=t.originalSearchCriteria),e.is(t.search_criteria_to_display,"string")&&(this._WidgetTitleObj.search_criteria=t.search_criteria_to_display),e.is(t.search_criteria,"string")&&t.search_mode,t.search_name?this._WidgetTitleObj.replacingString={search_name:t.search_name,search_criteria:this._WidgetTitleObj.search_criteria}:t.in_apps_search&&t.in_apps_search.search_name?this._WidgetTitleObj.replacingString={search_name:t.in_apps_search.search_name,search_criteria:this._WidgetTitleObj.search_criteria}:this._WidgetTitleObj.replacingString=void 0,e.is(t.applicativeTitle)?(this._WidgetTitleObj.applicativeTitle=t.applicativeTitle,e.is(t.applicativeTitleWithResults)&&(this._WidgetTitleObj.applicativeTitleWithResults=t.applicativeTitleWithResults)):e.is(this.options)&&e.is(this.options.in_apps_search)&&e.is(this.options.in_apps_search.applicativeTitle)?(this._WidgetTitleObj.applicativeTitle=this.options.in_apps_search.applicativeTitle,this._WidgetTitleObj.applicativeTitleWithResults=e.is(this.options.in_apps_search.applicativeTitleWithResults,"string")?this.options.in_apps_search.applicativeTitleWithResults:this.options.in_apps_search.applicativeTitle):(this._WidgetTitleObj.applicativeTitle="",this._WidgetTitleObj.applicativeTitleWithResults="")),this._WidgetTitleObj.nb_results=e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.state)&&e.is(this._onesearch_collection.state.totalRecords)?this._onesearch_collection.state.totalRecords:this._WidgetTitleObj.nb_results=null,this.setTitle(this._WidgetTitleObj))},setTitle:function(t){if(!e.is(t,"object"))throw ee.error("Invalid Arg in SNSkeleton.setTitle:",t),new Error("Invalid Arg in SNSkeleton.setTitle!");var i=new Date,n=new Date(i.getTime()-6e4*C.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()})),s=(i-n)/1e3/3600,o=n.toLocaleTimeString();(s>24||n.getDay()!==i.getDay())&&(o=n.toLocaleString()),!e.is(t.nb_results)&&e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.state)&&e.is(this._onesearch_collection.state.totalRecords)&&(t.nb_results=this._onesearch_collection.state.totalRecords),this._WidgetTitleObj=t;e.is(this._onesearch_collection)&&e.is(this._onesearch_collection.service_parameters)&&(T.SearchTypeEnum.ADVANCED_SEARCH===this._onesearch_collection.service_parameters.query||e.is(this._onesearch_collection.service_parameters.adv_search)&&!0===this._onesearch_collection.service_parameters.adv_search?t.specialSearchKey="adv_search_launch":T.SearchTypeEnum.FAVORITE_SEARCH===this._onesearch_collection.service_parameters.query||T.SearchTypeEnum.FAVORITE_SEARCH===t.search_criteria?t.specialSearchKey="myContent_searchFav":T.SearchTypeEnum.MY_CONTENT===this._onesearch_collection.service_parameters.query||T.SearchTypeEnum.MY_CONTENT===t.search_criteria?t.specialSearchKey="myContentTitle":T.SearchTypeEnum.MY_RECENT_CONTENT===this._onesearch_collection.service_parameters.query?t.specialSearchKey="*"===this._WidgetTitleObj.search_criteria||this._WidgetTitleObj.search_criteria===T.SearchTypeEnum.MY_RECENT_CONTENT?"AllRecentSearchTitle":"RecentSearchTitle":t.specialSearchKey="SearchTitle");var a,c="",d=e.is(t.searchTitlePrefix,"string")?t.searchTitlePrefix:"";if(!e.is(this._WidgetTitleObj.applicativeTitle)||this._WidgetTitleObj.applicativeTitle.length<=0?(a=e.is(t.specialSearchKey,"string")?t.specialSearchKey:"SearchTitle",e.is(this._WidgetTitleObj.nb_results)&&(a+="WithResults"),e.is(t.search_criteria_to_display,"string")?c=t.search_criteria_to_display:e.is(t.search_criteria,"string")&&t.search_criteria.length>0?c=t.search_criteria:(!e.is(t.search_criteria)||e.is(t.search_criteria,"string")&&0===t.search_criteria.length)&&"adv_search_launch"===t.specialSearchKey&&(c=t.specialSearchKey),c.length>0&&(d+=(d.length>0?" - ":"")+V.replace(V.get(a),e.is(t.replacingString,"object")?t.replacingString:{search_criteria:c,nb_results:t.nb_results,date:o}))):d+=(d.length>0?" - ":"")+V.replace(e.is(this._WidgetTitleObj.nb_results)?this._WidgetTitleObj.applicativeTitleWithResults:this._WidgetTitleObj.applicativeTitle,{search_criteria:e.is(t.search_criteria_to_display,"string")&&t.search_criteria_to_display.length>0?t.search_criteria_to_display:t.search_criteria,nb_results:t.nb_results,date:o}),void 0!==t.replacingString&&e.is(t.replacingString.search_name)){let i=t.replacingString.search_name;void 0!==i&&e.is(t.replacingString.search_criteria)&&""!==t.replacingString.search_criteria&&(d=d.length>0?d.replace(t.replacingString.search_criteria,i):V.replace(V.get(a),{search_criteria:i}))}this._panelTitle!==d&&(this._panelTitle=d);let u="";if((!("false"!==l.getApplicationConfiguration("app.feature.widget-tenant-icon.enabled")||C.getOption("widget-tenant-icon"))||"true"===this.getOption("transient_context"))&&e.is(this._panelTitle,"string")&&this._panelTitle.length>0&&e.is(this.getCollection())){let t=this.getCollection().getSearchRessources();if(e.is(t)&&t.getAvailableTenants().length>1){let i=t.getActiveTenant();e.is(i,"string")&&(u=t.getTenantDisplayName(i),e.is(u,"string")&&u.length>0&&(this._panelTitle+=" ("+u+")"))}}var h=this._panelTitle;if("SearchTitle"===t.specialSearchKey&&c.length>0&&(h=c,e.is(u,"string")&&u.length>0&&(h+=" ("+u+")")),this._panelTitle&&this._panelTitle.length>0){var g=this.getOption("observable");e.is(g)&&e.is(g.dispatchOnTitleUpdate,"function")&&g.dispatchOnTitleUpdate({panelTitle:this._panelTitle,tab_title:h,tab_tooltip:this._panelTitle}),r.dispatch("search:titleUpdate",this._panelTitle)}},getTitle:function(){return e.is(this._panelTitle)||this.setTitle(this._WidgetTitleObj),this._panelTitle},getCustomTitle:function(){var t=this.getSearchWidget();return e.is(t)&&e.is(t.getPreference("title"))?t.getPreference("title").value:""},getAdvSearchMgr:function(){return this._advSearchMgr},getSearchActions:function(){return this._searchActions},setShadings:function(e){if(this._BI_Shades=e,this.getCollection().length&&this._skeleton){var t=this._skeleton.getViewAt(0);e&&t.setShadings(e)}},getDataGridView:function(){var t=this._myDatagridView;if(!e.is(t)&&e.is(this._skeleton)&&e.is(this._skeleton.getViewAt,"function")){var i=this._skeleton.getViewAt(0);if(e.is(i)){var n=i.currentViewId;"table"===n&&e.is(i.contentsViews,"object")&&e.is(i.contentsViews[n])&&(t=i.contentsViews[n].nestedView)}}return t},computeCtxActions:function(t){if(!e.is(this._onesearch_collection))throw new Error("invalid state: SNSkeletonMgt._onesearch_collection is null !");var n=this;if(e.is(t.data,"array")){for(var s=[],o=t.data.length,r=0;r<o;r++){var l=t.data[r];if(e.is(l)){var c=t.rawData?l["ds6w:what/ds6w:type_value"]:l.get("ds6w:what/ds6w:type_value");e.is(c)||(c=t.rawData?l["ds6w:type_value"]:l.get("ds6w:type_value")),"SavedSearch"===c&&s.push(l.id)}}var d=function(){if(e.is(n._myDatagridView)&&e.is(n._myDatagridView.view))return n._myDatagridView.view.getManager()};if(s.length>0){var u=n._onesearch_collection.getSearchRessources().getFetchOptions({service_name:"actions_for_results",service_data:{ids:s},original_options:{onComplete:function(t){var s={},o=0;if("success"===(s=e.is(t,"string")&&t.length>0?e.Json.decode(t):t).status){var a=UWA.Class.extend(i,{_collection:null,init:function(e){this.setOptions(e),this._collection=e.collection},executeAction:function(){var t=arguments;e.is(t)&&e.is(t.length)&&t.length>0&&(t[0].collection=this._collection);var i=this.getOption("sourcejs");require([i],function(e){n._onesearch_collection.custoAction=e,e.executeAction.apply(e,t)})}});for(o=0;o<s.actions.length;o+=1){var r=n._onesearch_collection.get(s.actions[o].id);if(r)for(var l=0;l<s.actions[o].actions.length;l++){var c=s.actions[o].actions[l];c.collection=n._onesearch_collection;var u=new a(c);c.callback=u.executeAction.bind(u),r.actions.push(c)}}d()&&d().updateView()}},onFailure:function(e){ee.log("Cannot retrieve the actions"),ee.log(e.message)}}});!0===n._onesearch_collection.getSearchRessources().is_odt_source()?ee.warn("No action retrieved in ODT mode"):a.authenticatedRequest(u.url,u)}}},getGlobalDownOpen:function(){if(e.is(this._skeleton))return this._skeleton.getViewAt(0).getElement(".fonticon-down-open")},launchGlobalDropdown:function(){var e={target:this.getGlobalDownOpen(),events:{onHide:function(){this.destroy()},onClickOutside:function(){this.destroy()}}};this._model.getSelectedNodes().length>=0&&this.getCurrentView().launchContextMenu(this._model.getSelectedNodes()[0],e)},computeCtxActions2:function(t,i){this.ctxMenu&&this.ctxMenu.isVisible&&(this.ctxMenu.hide(),this.ctxMenu=null),e.is(i,"object")?i.skeleton=this:i={skeleton:this},O.computeCtxActions(t,i)},ActivateDeactivateInformationsPanel:function(){var t=this,i=!1;if(null===this._informationZone){require(["DS/SNResultUX/views/utils/InformationsView"],function(i){let n=t.getSearchWidget(),s=420,o="",a=null,r=null;e.is(n)&&e.is(n.body)?(r=n.body,o=n.id):r=e.extendElement(document.body).getElement(".onesearch_results"),e.is(r)&&(a=r.getDimensions()),e.is(a)&&(s=a.width);var l=null,c=t.getOption("observable");e.is(c)&&(l=c.getOneSearchPreviewAction());var d={parentContainer:t._skeleton.getViewAt(0),lastSelectedItem:t._lastSelectedItem,width:s,widgetId:o,parent:t,oneSearchPreviewAction:l};t._informationZone=new i(d),t._informationZone._initInformationsPanel(),t.breturn=!0}),i=!0}else i=!this._informationZone.getVisibleFlag(),this._lastSelectedItem?(t._informationZone.setActiveObject(t._lastSelectedItem),e.is(t._informationZone.switchVisibleFlag,"function")&&t._informationZone.switchVisibleFlag(),e.is(t._informationZone.activate_deactivateNoPreview,"function")&&t._informationZone.activate_deactivateNoPreview(!1)):(e.is(t._informationZone.activate_deactivateNoPreview,"function")&&t._informationZone.activate_deactivateNoPreview(!0),e.is(t._informationZone.switchVisibleFlag,"function")&&t._informationZone.switchVisibleFlag());return i},ActivateDeactivatePreviewPanel:function(t){var i=this,n=!0,s=function(){setTimeout(function(){i.scrollToCellAt()},250)};if(null===i.getPreviewPanel()){require(["DS/SNResultUX/views/utils/SearchLightboxPreview"],function(n){let o,a,r=i.getSearchWidget(),l=420,c="",d=null,u=null,h=null;if(e.is(r)&&e.is(r.body)?(u=r.body,c=r.id,h=e.extendElement(u).getElement(".onesearch_results")):h=u=e.extendElement(document.body).getElement(".onesearch_results"),e.is(u)&&(d=u.getDimensions()),e.is(d)&&(l=d.width),y.getItem("nav_history")){if(e.is(r)){o={parentContainer:e.extendElement(r.elements.body).getElementsByClassName("searchContainer")[0],lastSelectedItem:i._lastSelectedItem,width:l,widgetId:c,parent:i,bNewUI:!1}}}else{let n=!0,s=null;if(!1===P.getinformationPanel())n=!1;else{let t=i.getOption("observable");e.is(t)&&(s=t.getOneSearchPreviewAction())}o={parentContainer:i._skeleton.getViewAt(0),lastSelectedItem:e.is(t)&&e.is(t.clickedItem)?t.clickedItem:i._lastSelectedItem,selectedItems:e.is(t)&&e.is(t.selectedItems)?t.selectedItems:null,width:l,widgetId:c,parent:i,bNewUI:n,oneSearchPreviewAction:s,rootContainer:i._skeleton.placeHolder}}i._informationPanel=new n(o),i._informationPanel._initInformationsPanel(),i.breturn=!0,i._informationPanel.addEvent("onExitPreviewMode",function(){if(e.is(i._listSelectedElementsFromSearchBeforeLaunchingPreview)){ee.log("Restoring selection");let t=i._getTreedocumentFromCollection(i.getCollection());e.is(t)&&e.is(t.getXSO,"function")&&(t.getXSO().empty(),t.getXSO().add(i._listSelectedElementsFromSearchBeforeLaunchingPreview))}i._listSelectedElementsFromSearchBeforeLaunchingPreview=null,i.setPreviewStatus(!1),i.dispatchEvent("onExitPreviewMode"),i._managePreviewAndBackshow(a)}),i._informationPanel.addEvent("onPreviewModeRequest",function(){a=i._managePreviewAndBackhide(),i.setPreviewStatus(!0),i.dispatchEvent("onPreviewModeRequest")}),i.setPreviewStatus(!0),i.dispatchEvent("onPreviewModeRequest"),i._informationPanel.addEvent("onLightBoxPanelCreated",function(){if(e.is(C.getOption("search_compact_mode"))&&null===i._lastSelectedItem){var t=null;e.is(i.getSearchContentSetHeader,"function")&&(t=i.getSearchContentSetHeader()),!e.is(t)&&e.is(i._skeleton)&&e.is(i._skeleton.container)&&e.is(i._skeleton.container.getElement,"function")&&(t=i._skeleton.container.getElement(".search-content-set-header")),e.is(t)&&!0===t.isHidden()?i._informationPanel.switchVisibleFlag():e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!0)}else s()}),a=i._managePreviewAndBackhide()})}else null!==i._informationPanel&&(i._informationPanel.switchVisibleFlag(),!0===(n=i._informationPanel.getVisibleFlag())?i._lastSelectedItem?(i._informationPanel.setActiveObject(i._lastSelectedItem),e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!1),s()):(e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!0),i._informationPanel.switchVisibleFlag()):i._informationPanel.switchVisibleFlag());return n&&(T.trackerData.search.previewItem=!0,T.trackerData.search.selectItem&&(T.trackerData.search.scenario="Preview",u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:T.trackerData.search.scenario,persVal:{pv13:T.trackerData.search.indexItem}}}))),n},sortForAllView:function(t){var i=this;C.getOption("search_web_in_win")&&(i._order_by=t.order_by,i._order_field=t.order_field);var n=this.getOption("observable").getOption("update_preference");if(e.is(n)&&(n("order_by",t.order_by),n("order_field",t.order_field)),!e.is(i._onesearch_collection)||!e.is(i._onesearch_collection.service_parameters))throw new Error("No collection or service_parameters in SNSkeletonMgt.sortForAllView!");if(e.is(i._onesearch_collection.service_parameters.query)&&T.SearchTypeEnum.MY_RECENT_CONTENT===i._onesearch_collection.service_parameters.query)i._onesearch_collection.sortCollection(t);else{var s=i._onesearch_collection;s._resetState(),s.reset(),s.setGlobalOrder(t.order_field,t.order_by);var o=i.getContainer();o&&_.mask(o),s.getFirstPageOfResults({reset:!0,onComplete:function(){i.getCollection().generateTreeModel(),_.unmask(o)},onFailure:function(){_.unmask(o)}})}switch(t.order_field){case"ds6w:when/ds6w:created":case"ds6w:when/ds6w:modified":case"ds6w:created":case"ds6w:modified":t.order_type="num";break;case"d6w:type":t.order_type="group";break;case"relevance":t.order_type="pertinency";break;default:t.order_type="alpha"}u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"GlobalAction",persDim:{pd5:"Sort",pd6:t.order_by,pd7:t.order_type,pd8:t.order_field}}}),y.setItem("searchSort",t),y.commit()},onItemSelected:function(t,i,n,s){let o=this,a=this.getCollection();if(e.is(n)&&(a=n),!e.is(a))return void ee.error("No collection in onItemSelect !");let r=null;e.is(t)&&(r=a.get(t)),o._lastSelectedItem=r;let l=a.getTreeDocument();e.is(s)&&(l=s);let c=l.getXSO().get(),d=c.length;u.publish({channel:this.getOption("messagingChannel"),topic:"updateSelectionNumber",data:{number:d,isMultiSelMode:this.getCurrentView().isMultiSelMode()}});let h=[];c.forEach(function(e){h.push(a.get(e._options.id))});let g=h.length;u.publish({channel:this.getOption("messagingChannel"),topic:"onItemSelection",data:{lastItemSelected:g>0?r:null}});let p=a.getTaggerProxy(),_=[];if(0===g)o._lastItemsSelected=[],o._modelSelected=[],e.is(o._searchActions.setSelected,"function")&&o._searchActions.setSelected(o._modelSelected),o.notifyReset();else{o._selectionOccurred=!0,e.is(o._searchActions.setSelected,"function")&&o._searchActions.setSelected(h);let t=[],i=[],n={},s=null,a=null;for(let o=0,r=g;o<r;o++){let r=h[o];if(!e.is(r))throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect");if(s=r.get("id"),!e.is(s,"string"))throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect");t.push({objectType:r.get("ds6w:type_value"),objectId:s,envId:r.getPlatformID(),contextId:""}),_.push({id:s,session_object:r.hasOwnProperty("session_object")});let l=r.getSourceID(),c=l||"3dspace",d=r.getPlatformID();(a=T.getTaggerSubjectURI({subjects:[{id:s,source:c,platform:d}],source:c,platform:d,service:l?r.getServiceID():"3DSpace"})[s])&&(i.push(a),e.is(l,"string")&&(n[a]=this.getTaggerService(r)))}let r=P.buildCompassSelectionData({widgetId:e.is(o.getOption("widgetId"))?o.getOption("widgetId"):"",selectedModels:h});if(1===g){let i=t[0];e.is(r)&&e.is(r.data)&&e.is(r.data.items,"array")&&1===r.data.items.length&&(i=r.data.items[0]),this._compass_socket.dispatchEvent("onSetObject",i)}this._compass_socket.dispatchEvent("onSetX3DContent",r),this.notifySelectionAddinMode(r),e.is(p)&&p.focusOnSubjects(i,null,n)}if(C.getOption("search_web_in_win")){let i=!0;if(e.is(t),!0===i){let e={objets_name:_};e.tabID=this.getOption("observable").getTabID(),this.onDispatchToWin(e,"onAddToCSO")}}this.dispatchEvent("selected_obj",h),/*!UWACore.is(selectedViewItems) && selectedViewItems === null &&*/
e.is(window.event,"object")&&e.is(window.event.currentTarget)&&(o._currentItemView=window.event.currentTarget,o._currentItemView.container=window.event.currentTarget);let f=!1;g>0&&e.is(o._lastSelectedItem)&&h.forEach(function(e){e.id===o._lastSelectedItem.id&&(f=!0)}),!1===f&&g>0&&(o._lastSelectedItem=h[g-1]);T.isInTheSimpleSearch({tenant:o.getActiveTenant()}),o.isCompactMode();let m=o.getPreviewPanel();m=o.getPreviewPanel(),o._lastSelectedItem=null,g&&(o._lastSelectedItem=h[g-1]),r=o._lastSelectedItem,o.options.events.onItemViewClick&&o.options.events.onItemViewClick(r)},getTaggerService:function(e){return T.getTaggerService(e)},restoreSelectionOnTabActivation:function(){var t=this.getCollection();let i=this._getTreedocumentFromCollection(t);if(e.is(i)&&e.is(i.getXSO())){var n=i.getXSO().get(),s=[];n.forEach(function(e){s.push(t.get(e._options.id))});var o=[];if(s.length>=0){for(var a=[],r=null,l=0,c=s.length;l<c;l++){var d=s[l];if(!e.is(d))throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect");if(r=d.get("id"),!e.is(r,"string"))throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect");a.push({objectType:d.get("ds6w:type_value"),objectId:r,envId:d.getPlatformID(),contextId:""}),o.push({id:r,session_object:d.hasOwnProperty("session_object")})}var u=P.buildCompassSelectionData({widgetId:e.is(this.getOption("widgetId"))?this.getOption("widgetId"):"",selectedModels:s});if(1===s.length){var h=a[0];e.is(u)&&e.is(u.data)&&e.is(u.data.items,"array")&&1===u.data.items.length&&(h=u.data.items[0]),this._compass_socket.dispatchEvent("onSetObject",h)}this._compass_socket.dispatchEvent("onSetX3DContent",u),this.notifySelectionAddinMode(u)}if(C.getOption("search_web_in_win")){let e={objets_name:o};this.onDispatchToWin(e,"onAddToCSO")}}},onItemUnselected:function(e){return ee.log("onItemUnselected:",e),this.onItemSelected(null)},onItemTitleClick:function(t,i,n,s){var o=this.getOption("in_apps_search"),a=e.is(o),r=ie.isAdvSearchRun(o),l=this.getOption("addinMode"),c=e.is(l,"string")&&l.length>0;if(a&&!r&&!c)return;const d=e.is(t,"object")&&e.is(t._options,"object")&&e.is(t._options.id,"string")?t._options.id:null;let u=this,h=u.getCurrentView().id;if("what"===h||"who"===h||"when"===h||"where"===h){let e=this._getTreedocumentFromCollection(n);u.getPreviewPanel()&&u.getPreviewPanel().changeModel(e)}if(!0===C.getOption("search_web_in_win")||!0===u.inContextSearch()&&!r)(!0!==u.isCompactMode()||!0!==this.inContextSearch()||e.is(i)&&e.is(i.realTitleClick,"boolean")&&!0===i.realTitleClick)&&u._onItemTitleClick(t,i,n);else{let s=e.is(n)?n:this._onesearch_collection,o=s.get(d);if(e.is(o)){let o=P.buildCompassSelectionData({widgetId:e.is(u.getOption("widgetId"))?u.getOption("widgetId"):"",selectedModels:[s.get(d)]});this.doubleClickHandler(d,o,s,function(){ee.log("failed to open, should try preview!"),u._onItemTitleClick(t,i,n)})}}},_onItemTitleClick:function(t,i,n){const s=e.is(t,"object")&&e.is(t._options,"object")&&e.is(t._options.id,"string")?t._options.id:null,o=e.is(n)?n:this.getCollection();if(e.is(o)||ee.error("SNSkeletonMgt_v2.onItemTitleClick: No collection!"),this._listSelectedElementsFromSearchBeforeLaunchingPreview=null,e.is(t._getID,"function")){let i=this._getTreedocumentFromCollection(n);if(e.is(i)&&e.is(i.getXSO,"function")){const n=i.getXSO();e.is(n)&&e.is(n.get,"function")&&(this._listSelectedElementsFromSearchBeforeLaunchingPreview=n.get(),n.empty(),n.add(t))}}let a;e.is(i)&&e.is(i.model)?a=i.model:e.is(s)?a=o.get(s):e.is(i.object_ids)&&i.object_ids.length>0&&(a=o.get(i.object_ids[i.object_ids.length-1])),null===this.getPreviewPanel()?this.ActivateDeactivatePreviewPanel({clickedItem:a,selectedItems:e.is(this._listSelectedElementsFromSearchBeforeLaunchingPreview)&&this._listSelectedElementsFromSearchBeforeLaunchingPreview.length>1?this._listSelectedElementsFromSearchBeforeLaunchingPreview:null}):!1===this.getPreviewPanel().getVisibleFlag()&&void 0!==a&&this.getPreviewPanel().switchVisibleFlag(),e.is(this.getPreviewPanel())&&(e.is(a)?a&&this.getPreviewPanel().setActiveObject(a):this.getPreviewPanel().setActiveObject(null))},_selectAll:function(){"oneToOne"!==this._selectionMode_techno&&this._model.getXSO().get().length!==this._model.getRoots().length&&this._model.selectAll()},_toggleLoader:function(){var t,i=this.getCurrentView();if(e.is(i)&&(t=i.container),e.is(this._mySpinner)&&e.is(this._mySpinner.elements)){var n=this._mySpinner.elements.container.getParent().getParent();e.is(n)&&n!==t&&this._mySpinner.elements.container.getParent().inject(t),this._mySpinner.toggle()}else{var s=o.create("div",{class:"datagrid-loader"});s.setStyle("text-align","center"),s.setStyle("position","absolute"),s.setStyle("left","calc(50% - 15px)"),s.setStyle("bottom","8px"),s.inject(t),this._mySpinner=new v({className:"search-spinner"}).inject(s).show()}},loadMoreData:function(t,i){u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"SearchResult",action:"Scroll"}});var n=this,s=this.getCollection();e.is(s)&&s.hasNextPage()&&(!e.is(this._mySpinner)||e.is(this._mySpinner)&&!this._mySpinner.isVisible)&&this._toggleLoader(),ee.log("Infinite scroll : loading more models..."),!1===s._search_in_progress&&!1===s.interruptRequested()&&s.hasNextPage()?s.getNextPage({remove:!1,onComplete:function(){s.generateTreeModel(),n._toggleLoader(),n._updateWidgetTitleWithNbResult(),n._getAndDisplayLastIndexTime(),t&&t()},onFailure:function(){n.dispatchEvent("on_search_failure",V.get("on_search_failure")),i&&i()}}):t&&t()},_loadFirstPage:function(t){var i=this,n=this.getCollection(),s=this.getContainer();n.service_parameters&&!n.service_parameters.adv_search&&!s&&i._skeleton.container&&_.mask(i._skeleton.container);var o,a=!1;if(n._ctx_options&&n._ctx_options.advanced_search&&n._ctx_options.advanced_search.searchOnInit&&(a=!0),i._informationPanel&&!0===i._informationPanel.getVisibleFlag()&&(e.is(i._informationPanel.activate_deactivateNoPreview,"function")&&i._informationPanel.activate_deactivateNoPreview(!0),i._informationPanel.setActiveObject(null)),!e.is(n.getRequestCriteria().service_params)||n.getRequestCriteria().service_params.query!==T.SearchTypeEnum.ADVANCED_SEARCH&&""!==n.getRequestCriteria().service_params.query||!e.is(n.getRequestCriteria().service_params.adv_search)||e.is(n.getRequestCriteria().service_params.refine)&&e.is(n.getRequestCriteria().service_params.refine.PLMParameters)&&e.is(n.getRequestCriteria().service_params.refine.PLMParameters.plmparam)&&Object.keys(n.getRequestCriteria().service_params.refine.PLMParameters.plmparam).length>0||a){s&&_.mask(s);var l=this;if(e.is(l)){var c=l.getHelperCollectionId(),d=function(s){e.is(s)&&!0===s._isAHelper&&(l.copyDataFromHelperCollection(n,s),n.dispatchAsEventListener("on_sync")(),e.is(s._parse_alert,"array")&&s._parse_alert.length>0&&l._failure(s,{service:s.snservices,messages:s._parse_alert}),n._setTagsPromise&&n._setTagsPromise.promise.then(function(){T.deleteHelperCollection(c)})),e.is(s)&&!0===s._failureView&&T.deleteHelperCollection(c),n.generateTreeModel(!0),l._updateWidgetTitleWithNbResult(),l._getAndDisplayLastIndexTime(),l.getContainer()&&_.unmask(l.getContainer()),t&&e.is(t.onComplete,"function")&&t.onComplete.call(this);var o=null;try{o=l.inContextSearch()}catch(e){console.log("FedSearch callback in context state fail",e)}if(T.isFUN109031Active()&&!1===o&&e.is(n.service_parameters)&&e.is(n.service_parameters.query)&&"#myContent"===n.service_parameters.query&&(e.is(n.allMyContent)&&!0===n.allMyContent?r.dispatch("fedsearch:myContent",[{groups:[]}]):r.dispatch("fedsearch:myContent",[])),y.getItem("nav_history")&&i.dispatchEvent("onFedSearchComplete",n.totalCount),s.getRequestCriteria()&&s.getRequestCriteria().service_params&&u.publish({channel:i.getOption("messagingChannel"),topic:"addSortItem",data:{order_by:s.getRequestCriteria().service_params.order_by,order_field:s.getRequestCriteria().service_params.order_field,nlsName:void 0}}),e.is(s)&&e.is(s._collabSpaceError)&&!0===s._collabSpaceError){var a={model:{get:function(){return"Grid_Custo"}},getContent:function(){return i.elements.onesearchactions},isError:!0};i._searchActions.searchSettingsUI(a),!0===i._diplaySecurityContextInfoOnce&&(i._diplaySecurityContextInfoOnce=!1)}u.publish({channel:"3dSearch-back-arrow-view",topic:"update",data:{number:n.totalCount}})},h=function(t,n){var s="";e.is(i._searchActions)&&e.is(i._searchActions.setEmptyViewMessage,"function")&&(e.is(n,"object")&&e.is(n.error,"object")&&e.is(n.error.errorMessage,"string")&&(s=n.error.errorMessage),i._searchActions.setEmptyViewMessage(s)),t.dispatchAsEventListener("onError")();var o=i.getCurrentView();e.is(o)&&e.is(o.checkToDisplayEmptyView,"function")&&o.checkToDisplayEmptyView(),l.getContainer()&&_.unmask(l.getContainer());var a=T.getHelperCollection(c);e.is(a)&&(t._fedSearchLabel=UWA.clone(a._fedSearchLabel)),l._failure(t,n),T.deleteHelperCollection(c)},g=T.getHelperCollection(c);e.is(g)?(g._currentState===T.HelperCollectionStatus.SEARCH_IN_PROGRESS?(ee.log("helper search_in_progress"),g._CBOnComplete=d,g._CBOnFailure=h):g._currentState===T.HelperCollectionStatus.SEARCH_SUCCEEDED?(ee.log("helper search_succeeded"),d(g)):g._currentState===T.HelperCollectionStatus.SEARCH_FAILED&&(ee.log("helper search_failed"),e.is(g.fedSearch_error)&&h(g,g.fedSearch_error)),n._lastFetchOptions=g._lastFetchOptions,n.fetchAndSetTags()):n.getFirstPageOfResults({reset:!0,onComplete:d,onFailure:h})}}else{var p=this._advSearchMgr;!e.is(p)||e.is(p._dataSetsForSource)&&e.is(p._dataSetsForSource.options)&&e.is(p._dataSetsForSource.options.datasets)&&e.is(p._dataSetsForSource.options.datasets.items)&&Object.keys(p._dataSetsForSource.options.datasets.items).length>0||p.clearFilters()}e.is(n.getRequestCriteria())&&e.is(n.getRequestCriteria().service_params)&&e.is(n.getRequestCriteria().service_params.idWaitLoading)&&(o=n.getRequestCriteria().service_params.idWaitLoading,$.WaitManager.removeWaitCondition(o));var f=+new Date-T.trackerData.timeData.searchDataTime;u.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"InvestigateDisplay",persDim:{pd6:"Search display Time"},persVal:{pv6:f}}})},_updateResultsToNative:function(t){if(C.getOption("search_web_in_win")){e.is(t)||(t=this.getCollection());var i=e.is(C.getOption("tabbed_ui_support_level"));if(e.is(t)){for(var n=[],s=t.pluck("id"),o=0;o<s.length;o++)i?n.push({id:s[o]}):n.push(s[o]);var a={notif_name:"onResultsUpdate",notif_parameters:{tabID:this.getTabID(),objects:n}};i||(a.notif_parameters=n),setTimeout(function(){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("QueryEnd",JSON.stringify({nb_results:t.hits,collection:t}))},1e3),this._searchcom_socket.dispatchEvent("onDispatchToWin",a,"search_web_in_win")}}},setup:function(){var e=this;this.listenTo(this.getCollection(),{onAdd:function(){},onRemove:function(){},onSort:function(){},onAnyEvent:function(){},onReset:function(){e.getContainer();e.getCollection()&&e.getCollection().service_parameters&&e.getCollection().service_parameters.adv_search&&!e.getCollection().advanced_criteria&&e.getCollection().initTreeDocument(),null!==e.getInformationPanel()&&e.getInformationPanel().updateSelection(null)},on_sync:function(t){var i=e.getContainer();i&&_.unmask(i),t&&t.generateTreeModel(),e._updateResultsToNative(t)},onInitTreeDocument:function(t){e._model=t,e.getPreviewPanel()&&e.getPreviewPanel().changeModel(t)}})},notifySelectionAddinMode:function(t){if(e.is(this.getOption("addinMode"),"string")){e.is(t)||(t=P.buildCompassSelectionData({widgetId:this.getOption("widgetId"),selectedModels:[]}));let i=JSON.stringify({event:"selection",source:t.source,version:t.version,content:t});ee.log("publishing webinwin:web:notification SELECTION event, data:"+i),l.publish("webinwin:web:notification",i)}},getSearchWidget:function(){var t=null,i=this.getOption("observable");return e.is(i)&&e.is(i.getSearchWidget,"function")&&(t=i.getSearchWidget()),t},getTabID:function(){var t=null,i=this.getOption("observable");return e.is(i)&&e.is(i.getTabID,"function")&&(t=i.getTabID()),t},setPrintWindow:function(e){this._printWindow=e},getSocketID:function(t){var i=e.is(t)?this._WebInWinCtxActionSocket:this._searchcom_socket;if(i)return i.id},handleKeyboardEvent:function(e){var t=UWA.Event.whichKey(e);"ctrl+a"===t||"ctrl+shift+a"===t?(this.onFetchAndSelectAllCallback({DoSelection:!0}),"ctrl+a"===t&&(e.preventDefault(),e.stopPropagation())):T.isFUN109031Active()&&!this.inContextSearch()&&"ctrl+g"===t&&this.switchOnView("map")},getActiveTenant:function(){if(this.getCollection()&&this.getCollection().getSearchRessources())return this.getCollection().getSearchRessources().getActiveTenant()},ActivatePreviewByClick:function(){let t=!0;!0===this.inContextSearch()&&(t=!1);let i=this.getOption("addinMode");return e.is(i,"string")&&i.length>0&&(t=!1),t},inContextSearch:function(){return C.getOption("debug")&&ee.log("Skeleton in apps mode:",e.is(this.getOption("in_apps_search"),"object")),e.is(this.getOption("in_apps_search"),"object")},isCompactMode:function(){let t=C.getOption("search_compact_mode");return e.is(t)&&!0===t},refreshUIAfterRender:function(){var t=null,i=C.getOption("search_compact_mode");if(e.is(i)&&!0!==i){var n=!1;if(e.is(this.getInformationStatus()))!0===this.getInformationStatus()&&(n=!0);else{n=!1;var s=this.getPreference("informationPanelState");e.is(s,"boolean")&&(n=s)}!0===n&&null===this.getInformationPanel()&&(t=this.getOption("observable"),e.is(t)&&(this.ActivateDeactivateInformationsPanel(),t.manageInformationPanel(!0)))}},getSecurityContext:function(){var t,i,n;if(i=e.is(this.getSearchWidget,"function")&&e.is(this.getSearchWidget())&&e.is(this.getSearchWidget().getValue,"function")?this.getSearchWidget().getValue("securityContext"):y.getItem("securityContext"+this.getActiveTenant()),e.is(i)&&(n=JSON.parse(i)),""===(t=e.is(n)&&e.is(n.csName)?n.csName:"")){var s=[];s=T.getSecurityContext3DSpace(),e.is(s,"array")&&s.forEach(function(i){e.is(i.isDefault)&&(!0===i.isDefault&&(t=i.name))})}return t},getInformationStatus:function(){return this._informationState},setInformationStatus:function(e){this._informationState=e,this.setPreference("informationPanelState",e)},getInformationPanel:function(){return this._informationZone},getPreviewStatus:function(){return this._previewState},setPreviewStatus:function(e){this._previewState=e},getPreviewPanel:function(){return this._informationPanel},getMessagingChannel:function(){return this.getOption("messagingChannel")},setCurrentTabId:function(e){this._currentTabId=e},getCurrentTabId:function(){return this._currentTabId},getPreference:function(t){var i=null,n=this.getSearchWidget();return e.is(n)&&0!==n.id.indexOf("preview")&&(i=n.getValue(t)),e.is(i)||(i=y.getItem(t+this.getTabID())),e.is(i)||(i=y.getItem(t)),e.is(i)||(i=C.getOption(t)),i},setPreference:function(t,i){var n=this.getSearchWidget();e.is(n)&&0!==n.id.indexOf("preview")?n.setValue(t,i):(y.setItem(t+this.getTabID(),i),y.setItem(t,i),y.commit())},switchOnView:function(t){e.is(this._skeleton.getViewAt(0))&&this._skeleton.getViewAt(0).switcherView.switchView(t);let i=this._skeleton.container.getElement(".search-content-set-header");e.is(i)&&("where"===t||C.getOption("FUN127551")&&"who"===t?i.addClassName("forceMarginWHERE"):i.removeClassName("forceMarginWHERE")&&this.getOption("observable").getRefineHelpers().hideGlobeView())},maskContainer:function(){this.getOption("observable").maskContainer()},unmaskContainer:function(){this.getOption("observable").unmaskContainer()},_getTreedocumentFromCollection:function(t){return e.is(t)&&t.getTreeDocument()},_managePreviewAndBackshow:function(t){t.back;let i=t.globe,n=this.getOption("observable");"where"!==this.getCurrentView().id&&!0!==i||e.is(n)&&n.getRefineHelpers().showGlobeView()},_managePreviewAndBackhide:function(){let t=!1,i=(this.getCurrentView().id,this.getOption("observable"));if(e.is(i)){let n=i.getEmbeddedTaggerTags();if(e.is(n)&&e.is(n.groups)){let e=n.groups[0];"computedCountryInfo"===(e?e.predicate:"")&&(i.getRefineHelpers().hideGlobeView(),t=!0)}}return{back:!1,globe:t}},updateCounterView:function(t,i){let n=this._skeleton&&this._skeleton.getContent()&&this._skeleton.getContent().querySelector(".set-detail-view-count");e.is(n)&&(n.textContent=t,n.title="",e.is(i)&&(n.title=i))},getWhereView:function(){let t;if(e.is(this._skeleton)&&e.is(this._skeleton.getViewAt,"function")){let i=this._skeleton.getViewAt(0);if(e.is(i)){let n="where";e.is(i.contentsViews,"object")&&e.is(i.contentsViews[n])&&(t=i.contentsViews[n].nestedView)}}return t},onDispatchToWin:function(t,i){!0===C.getOption("search_web_in_win")&&(e.is(t)?this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:i,notif_parameters:JSON.stringify(t)},"search_web_in_win"):this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:i},"search_web_in_win"))}})}),define("DS/SNResultUX/SNResultMgt",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Collection","UWA/Element","UWA/Utils/InterCom","DS/WebappsUtils/Performance","DS/PlatformAPI/PlatformAPI","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","css!DS/SNResultUX/SNResultUX","DS/SNResultUX/layouts/SNSkeletonMgt_v2","DS/TagNavigatorProxy/TagNavigatorProxy","DS/SNResultUX/utils/ResultUX_customization","DS/SNResultUX/utils/ResultsUtils","DS/SNResultUX/utils/SearchServices","DS/SNResultUX/utils/SearchViewOptions","text!DS/SNResultUX/assets/SNResultUX_custo.json","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SNUnitConversion","DS/SNInfraUX/Logger","DS/SNInfraUX/RefineHelper/RefineHelper","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/AdvSearchMgr","DS/SNResultUX/utils/SNResultTypeCustoHelper","DS/SNResultUX/utils/SearchSortView","DS/SNResultUX/views/utils/SwitcherView6wGrouping","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/SNResultUX/views/utils/SearchHistoryTree","DS/i3DXCompassServices/i3DXCompassPubSub","DS/PubSub/PubSub","DS/SNInfraUX/SearchPreferences","DS/WebRecordEnabler/Adapter","DS/SNResultUX/utils/OneSearchActions","DS/SNInfraUX/utils/SNUnitConversionHelper","DS/SNResultUX/utils/6WRefineHelpers"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b,C,y,I,D,T,A,x,N,O,P,E,k,M,R,V,U,L,F,j,W,X,B,H){"use strict";return i.extend(n,s,h,{uwaClassName:"DS/SNResultUX/SNResultMgt",name:"onesearch_results",_resources:null,_taggerProxy:null,_searchcom_socket:null,_search_criteria:"",_originalSearchCriteria:"",_search_tag_filter:{},_selected_objects:null,_adv_search:!1,_advanced_criteria:"",_ok_Button:null,_apply_Button:null,_adv_search_field:null,onesearch_indexedtimeIcon:null,indexedtimeMenu:null,_isMultiSelModeOnTouch:!1,_historySearch:null,_headersSearch:null,_idWaitLoading:null,_compass_socket:null,_subscriptions:null,_keydownEventHandler:null,_minimizedSidePanel:!1,_forceOnSearch:!1,_oneSearchActions:null,_detailsviewSelected:null,oRefineHelpers:null,getRefineHelpers:function(){return this.oRefineHelpers},embeddedTaggerContainer:null,searchLayoutContainer:null,embeddedTaggerTags:null,getEmbeddedTaggerTags:function(){return this.embeddedTaggerTags},_DockingElement:null,_collapser:null,_icon:null,_searchBackViewContainer:null,_searchBackViewContainerContent:null,_searchBackViewContainerContent:null,updateSNtabbedContainerClass:null,embeddedTaggerContent:null,_BroadcastchannelManager:null,init:function(t){if(this.embeddedTaggerContainer=null,this.searchLayoutContainer=null,this.embeddedTaggerTags=null,this.oRefineHelpers=new H({referer:this}),this._DockingElement=null,this._collapser=null,this._icon=null,this._searchBackViewContainer=null,this._searchBackViewContainerContent=null,this.updateSNtabbedContainerClass=null,this.embeddedTaggerContent=null,this._BroadcastchannelManager=null,A.groupCollapsed("SNResultMgt.init"),A.log("options:"),t){let e="";try{e=JSON.parse(JSON.stringify(t))}catch(i){e=t}A.log(e)}var i=this;if(this._subscriptions={},this._detailsviewSelected=null,t.viewData||(t.viewData={},t.viewData.global_actions=t.incontext_global_actions),this._parent(t),e.is(t)&&e.is(t.search_settings)&&p.initialize({search_settings:t.search_settings}),window.addEventListener("resize",this.updateDimension.bind(this)),!0===p.getOption("isSearchActionConfigured")&&_.checkCustomerConfigs({resources:new u(this.getOption("resources"))}).then(function(e){A.log("checkCustomerConfigs SUCCESS : "+e)},function(e){A.log("checkCustomerConfigs FAILURE : "+e)}),this._searchcom_socket=g.createSocket({socket_id:this.getSocketID(),widgetId:this.getOption("widget_id")}),this._searchcom_socket&&(this._searchcom_socket.addListener("toggleProxyFocus",this._toggleProxyFocus.bind(this)),this._searchcom_socket.addListener("clearfilterbyclosesidepanel",this.clearfilterbyclosesidepanel.bind(this)),this._searchcom_socket.addListener("manageActionIconOnSidePanel",this.manageActionIconOnSidePanel.bind(this)),this._searchcom_socket.addListener("UpdateInContextSearch",this._updateInContextSearch.bind(this)),this._searchcom_socket.addListener("widgetResize",this.updateDimension.bind(this)),this._searchcom_socket.addListener("hideGlobeView",this.getRefineHelpers().hideGlobeView.bind(this))),t.updateContainerClass&&(this.updateSNtabbedContainerClass=t.updateContainerClass),this._createDispatchers(),t.resources instanceof u)this._resources=t.resources,p.getTenantSettings(this.getActiveTenant()).then(i._ready_to_customized(t));else try{i._resources=new u(t.resources,function(){i._resources=this instanceof u?this:i._resources,p.getTenantSettings(i.getActiveTenant()).then(i._ready_to_customized(t))})}catch(e){console.log(e),A.log("SearchRessources not initialized!")}p.getOption("load_PQs")&&D.fetchPQsFromServer(i._resources),A.groupEnd()},_createDispatchers:function(){var t=this;F.add("Search:updateSearchCriteria",function(t){if(""===t)try{let t=options.resetOriginalOptions;e.is(t,"function")&&t(["search_criteria","search_criteria_to_display"])}catch(e){p.getOption("debug")&&A.log("Update search criteria error",e)}}),F.add("search:onSearch",function(e){t.onSearch(e)}),F.add("errorManager:maximumResults",function(i){e.is(t.onesearch_errorManagerIcon)&&(e.is(i)&&e.is(i.estimated)&&e.is(i.nhits)&&!0===i.estimated?t._setErrorManagerMaximumResultsTooltip(i.nhits):t._setErrorManagerMaximumResultsTooltip())}),F.add("errorManager:clear",function(){e.is(t.onesearch_errorManagerIcon)&&t.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(""),t._manageErrorManagerDisplay()}),F.add("fedsearch:myContent",function(e){t.OnGroupingChange(e)}),this._subscriptions.updateSelectionNumber=d.subscribe({channel:this.getMessagingChannel(),topic:"updateSelectionNumber",callback:this.updateSelectionNumber.bind(this)}),this._subscriptions.displayContentSetHeader=d.subscribe({channel:"3dSearch-switcher-view",topic:"displayContentSetHeader",callback:e=>{let i=e.view?e.view:null;!0===e.displayed?t.showSearchContentSetHeader(i):t.hideSearchContentSetHeader(i)}}),e.is(this.getOption("getTabID"),"function")||this._subscribeToKeyboardEvents()},_ready_to_customized:function(t){let i=JSON.parse(y),n=this;S.setAddinMode(this.getOption("addinMode")),S.addCustomization(i,function(){e.is(t.result_ux_customization)?S.addCustomization(t.result_ux_customization,function(){n._ready_to_initialize(t)}):n._ready_to_initialize(t)})},_ready_to_initialize:function(t){var i=this;this._createTaggerProxy(t,function(){let t=i.getOption("search_options");i._searchcom_socket&&e.is(t)&&e.is(t.tag_filter)&&i._searchcom_socket.dispatchEvent("Last_Tag_Filter",i.options.search_options.tag_filter),i._selected_objects=new o;var n={source:i.options.source,events:{selected_obj:function(){if(i._selected_objects.reset(),e.is(arguments))for(var t=0,n=arguments.length;t<n;t++)i._selected_objects.add(arguments[t]);if(i._ok_Button){let e=i.getInContextMinSelect();i._ok_Button.setDisabled(i._selected_objects.size()<e)}i._apply_Button&&i._apply_Button.setDisabled(0===i._selected_objects.size())},onItemViewClick:function(t){var n=i.options.itemViewClickHandler;e.is(n)&&require([n],function(e){e.executeAction({model:t})})},onSkeletonReady:function(){e.is(i.getOption("renderTo"))&&i.render().inject(i.getOption("renderTo"));var t=i.getOption("search_options");if(e.is(t)?(!e.is(t.viewData)&&(t.viewData=i.getOption("viewData")),i._forceOnSearch=!0):!e.is(i.options.donotshowlastsearch)&&e.is(i.options)&&e.is(i.options._lastSearchOptions)&&i.dispatchEvent("onSearchSkeleton",i.options._lastSearchOptions),e.is(i.elements)&&e.is(i.skeleton)&&e.is(i.skeleton.getSearchActions)&&e.is(i.skeleton.getSearchActions())){let t=i.skeleton.getSearchActions();t.addEvent("onRefreshResultRequest",function(t){let n=void 0;if(e.is(t))n={},e.is(t.criteria)&&(e.is(t.criteria.search_crit)&&(n.search_criteria=t.criteria.search_crit),e.is(t.criteria.originalSearchCriteria)&&(n.originalSearchCriteria=t.criteria.originalSearchCriteria),e.is(t.criteria.tagger_crit)&&(n.tag_filter=t.criteria.tagger_crit),e.is(t.criteria.search_name)&&(n.search_name=t.criteria.search_name),e.is(t.criteria.source)&&(n.source=t.criteria.source),e.is(t.criteria.queryType)&&(n.queryType=t.criteria.queryType)),n.savedSearch=!0,window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("SaveSearch",JSON.stringify(n));else if(n=e.clone(i.options.search_options),e.is(n)&&(n.refresh=!0,e.is(n.tag_filter,"object"))){var s=i._taggerProxy.getCurrentFilter();e.is(s,"object")&&e.is(s.allfilters,"object")&&0<Object.keys(s.allfilters).length?A.log("refreshSearchResult with tagg filter"):n.tag_filter=null}e.is(n)&&(i._historySearch&&(e.is(i.elements.containerProduct)&&i.elements.containerProduct.empty(),e.is(i.elements.containerRelational)&&i.elements.containerRelational.empty(),i._historySearch.cleanAll()),i.onSearch(n))}),t.addEvent("onClickFavSearchTopBar",function(){i._searchcom_socket.dispatchEvent("clickOnChoiceFavoriteSearch")}),t.addEvent("onRunSavedSearch",function(t){if(A.log("onRunSavedSearch"),e.is(t)){var n={};if(n.tag_filter=t.tag_filter,n.search_criteria=t.search_criteria,n.search_criteria_to_display=t.search_criteria_to_display,n.originalSearchCriteria=t.originalSearchCriteria,n.saved_search=!0,n.search_name=t.search_name,e.is(t.originalSearchCriteria,"string")&&t.originalSearchCriteria===_.SearchTypeEnum.ADVANCED_SEARCH&&(n.adv_search=!0),i._updateWdgPreferences(n),e.is(t.search_criteria)&&e.is(t.tag_filter.allfilters)&&e.is(t.tag_filter.allfilters.condition)&&t.tag_filter.allfilters.condition.length>0){var s=i._extractFTSFromFilter(t.tag_filter);if(x.isSimplifiedTaggerFilters(t.tag_filter.allfilters)&&(s.source=x.extractSourceInSimplifiedTagger(t.tag_filter.allfilters)),e.is(s))var o=!1;o=e.is(s.source,"array")&&s.source.indexOf("other")>-1;var a=i._getSearchCriteriaForAdvancedFilters(s.new_filter,i._search_criteria,o);t.advanced_criteria=a}t.resetLocalFilter=!0,i.onSearch(t)}}),!0===j.getItem("nav_history")&&t.addEvent("onDisplayRelations",function(t){if(A.log("onDisplayRelations"),e.is(t,"object")&&e.is(t.relation,"string")&&e.is(t.ids,"array")){let o,a="";if(e.is(i._taggerProxy.clearLocalFilter,"function")&&i._taggerProxy.clearLocalFilter(),e.is(i._taggerProxy.clearLocalGrouping,"function")&&i._taggerProxy.clearLocalGrouping(),e.is(t.searchParam))(o=t.searchParam).fromSearchHistory=!0,o.refresh=!1;else{for(var n=0;n<t.ids.length;n++)a+="physicalid:"+t.ids[n],n<t.ids.length-1&&(a+=" OR ");var s="";switch(t.relation){case"parents":s=I.get("parents.box");break;case"children":s=I.get("children.box");break;case"drawings":s=I.get("drawings.box");break;case"simulations":s=I.get("simulations.box");break;case"configurations":s=I.get("configurations.box")}o={search_criteria:a,originalSearchCriteria:s,tag_filter:{},source:["3dspace"],fromSearchHistory:!0};let e={};e.tag_filter=o.tag_filter,e.search_criteria=o.search_criteria,e.search_criteria_to_display=o.originalSearchCriteria,e.originalSearchCriteria=o.originalSearchCriteria,e.saved_search=!1,i._updateWdgPreferences(e)}i.onSearch(o)}}),t.addEvent("onNonDefaultGlobalAction",function(t){if(A.log("onNonDefaultGlobalAction"),e.is(t)&&e.is(t.id)&&i._searchcom_socket){var n,s,o=C.getViewData();e.is(o)&&(n=o.global_actions),n&&(s=n.app_socket_id),s&&i._searchcom_socket.dispatchEvent("Selected_global_action",{selected_objects:i._selected_objects.toArray(),id:t.id,command_data:t.command_data},s)}}),t.addEvent("onInformationPanelAction",function(){A.log("onInformationPanelAction");var e;e=i.getSNSkeleton().ActivateDeactivateInformationsPanel(),i.manageInformationPanel(e)}),t.addEvent("onPreviewPanelAction",function(){A.log("onPreviewPanelAction");var e;e=i.getSNSkeleton().ActivateDeactivatePreviewPanel(),i.managepreviewPanel(e)}),t.addEvent("onPinToDashboardAction",function(){A.log("onPinToDashboardAction"),i.onPinToDashboardAction()})}else A.error("Unable to retrieve skeleton !");i.elements.container.addClassName(i.getOption("css_view_class")),!0===i.getOption("swymContext")&&i.elements.container.addClassName("swym"),i.elements.container.addClassName(i.getOption("css_view_class")),_.isFUN109031Active()&&!i._isInAppsSearch()&&i.elements.container.addClassName("BETA-FUN109031"),!0===j.getItem("BETA-FUN109031-resizefullmode-"+i.getOption("widget_id")+"-"+i.getTabID())&&i.elements.container.addClassName("withoutMargin"),_.isFUN109031Active()&&i.embeddedTaggerContent&&i.embeddedTaggerContainer&&i.embeddedTaggerContent.inject(i.embeddedTaggerContainer),i.dispatchEvent("onReady"),i.updateDimension()}}};i.opts_skeleton=n,i._buildSkeleton(n)})},_createTaggerProxy:function(t,i){var n=this;let s,o=p.getOption("enablePLM",{tenant:n._resources.getActiveTenant()});if(t.in_apps_search&&t.in_apps_search.advanced_search&&!1===t.in_apps_search.advanced_search.showPLMParameter&&(o=!1),e.is(n._resources)&&e.is(n._resources.getActiveTenant())&&(s=n._resources.getActiveTenant()),p.getOption("ENO_BI_ON_TAGGER")){require(["DS/ENOFilterBIUX/FilterBIComponentProxy"],function(t){let a={enablePLM:o,tenant:s,processingMode:"appProcessing",colorize:!0,events:{addFilterChangeListener:n.onFilterChange.bind(n),addCriteriaChangeListener:n.onCriteriaChange.bind(n),addPLMUpdateListener:n.onPLMUpdate.bind(n),addOpenTaggerListener:n.onOpenTagger.bind(n),addCloseTaggerListener:n.onCloseTagger.bind(n),addRequestSuggestsListener:n.OnSuggestUpdate.bind(n)}};if(e.is(n.getOption("tagger_context_id")))a.contextId=n.getOption("tagger_context_id");else if(j.getItem("integratedSearch")){var r=_.getSearchWidget(n.getOption("widget_id"));e.is(r)&&(a.contextId=r.context)}else a.widgetId=n.getOption("widget_id");n._taggerProxy=new t(a),n._taggerProxy.addEvent("FilterBIColorize",n.onTaggerColorization.bind(n)),n._taggerProxy.addEvent("FilterBIUnColorize",n.onTaggerUnColorization.bind(n)),n._buildDOM()&&i.call()})}else{var r={enablePLM:o,tenant:s,filteringMode:"FilteringOnServer",disableAutoComplete:!0,events:{addFilterChangeListener:n.onFilterChange.bind(n),addCriteriaChangeListener:n.onCriteriaChange.bind(n),addPLMUpdateListener:n.onPLMUpdate.bind(n),addCloseTaggerListener:n.onCloseTagger.bind(n),addOpenTaggerListener:n.onOpenTagger.bind(n),addRequestSuggestsListener:n.OnSuggestUpdate.bind(n),addGroupingChangeListener:n.OnGroupingChange.bind(n)},freeInput:!1,defaultDatePicker:!0,preciseCount:p.getOption("preciseCount",{tenant:n.getActiveTenant()})};let t=this.isPinnedWidget();(1==p.getOption("SearchExclude")||p.getOption("editTagsRelationships")&&!t)&&(r.exclude=!0),1==p.getOption("colorizeResults")&&(r.colorize=!0);let c=!1,d=n.getOption("search_options");if(e.is(d)&&e.is(d.tag_filter)&&x.isSimplifiedTaggerFilters(d.tag_filter.localfilters)&&(c=!0),"3DDashboard"!==_.identifyClientInfo().identifier||("true"===n.getOption("transient_context")||c)){r.simplified={data_location:!0,type_categorization:!0,person_data:!0,editTagsRelationships:p.getOption("editTagsRelationships")};let e=n.getOption("pinToDashboard");_.isFUN109031Active()&&!1!==e&&!n._isInAppsSearch()&&(n.embeddedTaggerContent=a.create("div",{id:"embedded-tagger-"+this.getOption("widget_id")+"-"+this.getTabID()+"_content"}),n.embeddedTaggerContent.inject(document.body),r.embeddedTagger={target:"#embedded-tagger-"+n.getOption("widget_id")+"-"+n.getTabID()+"_content",rootw:{allw:{label:"All",subLabel:I.replace(I.get("sortBy"),{criteria:I.get("relevancySort").toLowerCase(),sortType:I.get("tooltip_SortDesc").toLowerCase()})},"ds6w:what":{},"ds6w:who":{},"ds6w:when":{},"ds6w:where":{subLabel:"Location"}},multiselect:!1,zIndexForMenu:-1==["iphone","android"].indexOf(_.getDeviceCategory())?200:1301},!0===_.is6WInWebInWinActive()&&(r.embeddedTagger.is6WInWebInWinActive=!0),r.enableGrouping={maxLevels:1,withIconInfo:!0})}if(p.options.search_settings.taggerClosed=_.isFUN109031Active()&&!n._isInAppsSearch()&&!1!==n.getOption("pinToDashboard"),e.is(n.getOption("tagger_context_id")))r.contextId=n.getOption("tagger_context_id");else if(j.getItem("integratedSearch")){let t=_.getSearchWidget(n.getOption("widget_id")),i=!0;if(e.is(t)){var l=t.getValue("launch_mode");e.is(t.data)&&!e.is(t.data.pinToDashboard)&&l!==_.widgetLaunchMode.PINNED&&(r.contextId="RightPanelContext"),l!==_.widgetLaunchMode.COMPASS_TRANSIENT&&l!==_.widgetLaunchMode.COMPASS_PINNED&&l!==_.widgetLaunchMode.INCONTEXT_TRANSIENT||(r.contextId=""),r.widgetId=n.getOption("widget_id"),i=!1}!0===i&&(r.widgetId=n.getOption("widget_id"))}else r.widgetId=n.getOption("widget_id");if(!0===p.getOption("search_web_in_win"))require(["DS/SNResultUX/webinwin/WebInWinTaggerProxy"],function(t){r.proxyId=n.getTabID(),r.contextId=_.TAGGERPROXY_CONTEXTID_WEB_IN_WIN,!0!==_.is6WInWebInWinActive()||n._isInAppsSearch()||n._listenBroadcast(),n._taggerProxy=new t(r),e.is(p.getOption("tabbed_ui_support_level"))||(n._taggerProxy.clearLocalFilter(),n._taggerProxy.clearLocalGrouping&&n._taggerProxy.clearLocalGrouping()),n._buildDOM()&&i.call()});else{n._buildDOM(),n._taggerProxy=v.createProxy(r),1==p.getOption("colorizeResults")&&(n._taggerProxy.addEvent("colorize",n.onTaggerColorization.bind(n)),n._taggerProxy.addEvent("unColorize",n.onTaggerUnColorization.bind(n)));let t=_.getSearchWidget(n.getOption("widget_id"));if(_.isFUN109031Active()&&!n._isInAppsSearch()&&e.is(t)){t.getValue("launch_mode")===_.widgetLaunchMode.COMPASS_TRANSIENT&&n._taggerProxy.showEmbeddedView()}i.call()}}},isPinnedWidget:function(){let e=!1;this.getOption("addinMode");return"3DSwym"!==_.identifyClientInfo(this.getOption("addinMode")).identifier&&(e="true"!==this.getOption("transient_context")&&!0!==this.getOption("transient_context")),e},destroy:function(){if(A.groupCollapsed("SNResultMgt.destroy"),_.trackerData.search.selectItem&&d.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"NoSelection",persVal:{pv13:0}}}),window.removeEventListener("resize",this.updateDimension.bind(this)),this.onesearch_selectionNumberDiv&&this.onesearch_selectionNumberDiv.removeEvents(),this.onesearch_globalDropdownIcon&&this.onesearch_globalDropdownIcon.removeEvents(),this.indexedtimeMenu&&this.indexedtimeMenu.removeEvents(),this._beingDestroyed=!0,this._contentSetHeader){try{this._contentSetHeader.removeEvent("contextmenu")}catch(e){}this._contentSetHeader=null}if(this._resources&&(delete this._resources,this._resources=null),this.sortPanelView&&this.sortPanelView._view&&(d.unsubscribe(this.sortPanelView._subscriptions.setOrderInGridView),this.sortPanelView.destroy(),this.sortPanelView=null),this._oneSearchActions&&this._oneSearchActions._view&&(this._oneSearchActions.tooltip&&(this._oneSearchActions.tooltip.destroy(),this._oneSearchActions.tooltip=null),this._oneSearchActions.destroy(),this._oneSearchActions=null),e.is(this.elements)&&e.is(this.elements.onesearchactionspreview)&&(e.is(this.elements.onesearchactionspreview.tooltipActionspreview)&&(this.elements.onesearchactionspreview.tooltipActionspreview.destroy(),this.elements.onesearchactionspreview.tooltipActionspreview=null),e.is(this.elements.onesearchactionspreview.tooltipActionsnext)&&(this.elements.onesearchactionspreview.tooltipActionsnext.destroy(),this.elements.onesearchactionspreview.tooltipActionsnext=null),e.is(this.elements.onesearchbacksearch.tooltipActionsback)&&(this.elements.onesearchbacksearch.tooltipActionsback.destroy(),this.elements.onesearchbacksearch.tooltipActionsback=null)),this._searchcom_socket){if(this._searchcom_socket.removeListener("OnRefreshWebInWin"),this._searchcom_socket.removeListener("toggleProxyFocus"),this._searchcom_socket.removeListener("clearfilterbyclosesidepanel"),this._searchcom_socket.removeListener("manageActionIconOnSidePanel"),this._searchcom_socket.removeListener("UpdateInContextSearch"),this._searchcom_socket.removeListener("widgetResize"),d.unsubscribe(this._subscriptions.updateSelectionNumber),d.unsubscribe(this._subscriptions.displayContentSetHeader),g.deleteSocket(this.getSocketID()),!1===_._isSearchWidgetTransientAvailable(this.getOption("widget_id")))if(!e.is(this.getOption("getTabID"),"function")){var t="windowed"===this.getOption("css_view_class");!0===_.isTaggerOpenedByCode()&&!1===t&&this._searchcom_socket.dispatchEvent("closeTagger");var i=this.getOption("in_apps_search");this._searchcom_socket.dispatchEvent("onCloseTransient",{in_apps_search:i})}A.log("Disconnect the socket from the server"),this._searchcom_socket.disconnect(),delete this._searchcom_socket}this._compass_socket&&(this._compass_socket.removeListener("onSetX3DContent"),this._compass_socket.disconnect(),delete this._compass_socket),e.is(this._BroadcastchannelManager)&&this._BroadcastchannelManager.destroy(),e.is(this._BroadcastchannelSearchManager)&&delete this._BroadcastchannelSearchManager,this._BroadcastchannelManager=null;try{e.is(this._taggerProxy)&&e.is(this._taggerProxy.die,"function")&&(console.log('Calling "die" on tagger proxy'),this._taggerProxy.die(),delete this._taggerProxy,this._taggerProxy=null)}catch(e){console.log('[SNRes::destroy] - Calling "die" on tagger proxy failed due to error',e)}e.is(this.indexedtimeMenu)&&(e.is(this.indexedtimeMenu.destroy,"function")&&this.indexedtimeMenu.destroy(),this.indexedtimeMenu=null),this.onesearch_selectionNumberDiv=null,this.onesearch_globalDropdownIcon=null,this.onesearch_indexedtimeIcon&&this.onesearch_indexedtimeIcon.tooltip&&(this.onesearch_indexedtimeIcon.tooltip.destroy(),this.onesearch_indexedtimeIcon.tooltip=null),this._selected_objects=null,e.is(this._keydownEventHandler,"function")&&UWA.Element.removeEvent.call(document,"keydown",this._keydownEventHandler),e.is(this.skeleton)&&e.is(this.skeleton.destroy)&&(this.skeleton.destroy(),this.skeleton=null),this.options={},this.opts_skeleton=null,this._subscriptions={},this._DockingElement&&this._DockingElement.destroy(),this._searchBackViewContainerContent&&this._searchBackViewContainerContent.destroy(),this.elements.resizerContent&&this.elements.resizerContent.destroy(),this.resizerContentSpan&&this.resizerContentSpan.destroy(),this._parent(),A.groupEnd()},_isInAppsSearch:function(){let t=this.getOption("in_apps_search");return e.is(t,"object")},updateDimension:function(t){var i=this;clearTimeout(i.resizeEventId),i.resizeEventId=setTimeout(function(){if(e.is(i.skeleton)){var n=null,s=i.skeleton.getSearchWidget();e.is(s)&&e.is(s.body)?(n=s.body,e.is(i.getOption("addinMode"),"string")||!0===i.getOption("swymContext")?0:(e.is(s.getView,"function")&&e.is(s.getView().type)&&"windowed"===s.getView().type||"sidepanel"===s.getView().type)&&(24,e.is(t)&&-1)):n=e.extendElement(document.body).getElement(".onesearch_results");let o=i.skeleton.getCurrentView();o&&e.is(o.manageDisplayChannelView,"function")&&o.manageDisplayChannelView(n.getDimensions())}},100)},_updateInContextSearch:function(e){this.setOption("update_incontext_options",void 0),this.setOption("update_incontext_options",e),!1!==e.refresh&&this.refreshSearch()},getInContextMinSelect:function(){var t=1,i=this.getOption("in_apps_search");return i&&i.furtive_options&&e.is(i.furtive_options.min_select)&&(t=i.furtive_options.min_select),t},getMessagingChannel:function(){var e=this.getTabID();return this.getOption("widget_id")+"-#-"+e},getSocketID:function(){var t="result_socket_"+this.getOption("widget_id"),i=this.getTabID();return e.is(i,"string")?t+"-"+i:t},getTabID:function(){return e.is(this.getOption("getTabID"),"function")?this.getOption("getTabID").call():"3DSearch-non-tabbed-ui"},_getSearchType:function(){let t=_.SearchTypeEnum.SEARCH,i=this.getOption("search_options");if(e.is(i,"object")){let n=i.search_criteria;n===_.SearchTypeEnum.MY_CONTENT||n===_.SearchTypeEnum.ADVANCED_SEARCH||n===_.SearchTypeEnum.FAVORITE_SEARCH?t=n:""===n&&e.is(i.adv_search,"boolean")&&!0===i.adv_search&&(t=_.SearchTypeEnum.ADVANCED_SEARCH)}return t},getTabIcon:function(){var e={iconName:"search",fontIconFamily:1};switch(this._getSearchType()){case _.SearchTypeEnum.MY_CONTENT:e.iconName="user";break;case _.SearchTypeEnum.ADVANCED_SEARCH:e.iconName="search-cog";break;case _.SearchTypeEnum.FAVORITE_SEARCH:e.iconName="favorite-on"}return e},_updateWdgPreferences:function(t){var i=this.getOption("update_preference");if(e.is(i,"function")){var n=["tag_filter","search_criteria","search_criteria_to_display","originalSearchCriteria","search_mode","adv_search","advanced_criteria","source","searchViewMode","search_mode","order_by","order_field","saved_search","search_name"];for(var s in t)-1!==n.indexOf(s)&&i(s,t[s])}},OnTabActivated:function(){var t=p.getOption("search_web_in_win"),i=this.getOption("search_options");if(e.is(i))if(t&&window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")){if(e.is(p.getOption("tabbed_ui_support_level"))){var n=e.is(i.originalSearchCriteria)?i.originalSearchCriteria:"";sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:n}))}}else this._searchcom_socket.dispatchEvent("onSearch",{parameters:{search_criteria:e.is(i.search_criteria)?i.search_criteria:"",originalSearchCriteria:i.originalSearchCriteria,search_criteria_to_display:i.search_criteria_to_display,adv_search:i.adv_search},transient_widget:"true"===this.getOption("transient_context"),widget_id:this.getOption("widget_id"),in_apps_search:this.getOption("in_apps_search"),tabInfo:{tenant:this._resources.getActiveTenant(),client_identifier:_.identifyClientInfo().identifier}});this._taggerProxy&&(this._taggerProxy.activate(),t&&!0===p.getOption("proxy_button_available")&&this._taggerProxy.toggleProxyFocus(!0),this._getSearchType()!==_.SearchTypeEnum.ADVANCED_SEARCH&&this.setTaggerMode("tags"));var s=this.getSNSkeleton();e.is(s)&&(s.restoreSelectionOnTabActivation(),s.setCurrentTabId(this.getTabID()),e.is(p.getOption("tabbed_ui_support_level"))?this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onTabActivated",notif_parameters:{tabID:this.getTabID()}},"search_web_in_win"):s._updateResultsToNative(),this.managehistoryPanel(!1),this.manageInformationPanel(),this.manageActionIconOnSidePanel()),e.is(i)&&this._updateWdgPreferences(i),_.SearchTypeEnum.ADVANCED_SEARCH===this._getSearchType()&&this.setTaggerMode("criteria"),_.SearchTypeEnum.MY_RECENT_CONTENT===this._search_criteria&&e.is(this._taggerProxy)&&e.is(this._taggerProxy.deactivate,"function")&&this._taggerProxy.deactivate(),e.is(this.getSNSkeleton())&&this.getSNSkeleton().getSearchActions().updateDatagridObjInCusto()},OnTabDeactivated:function(){this._taggerProxy&&this._taggerProxy.deactivate();var t=this.getSNSkeleton();if(e.is(t)&&(t.resetCompassSelection(),t.clearWebInWinCSO(),e.is(t._searchActions)&&e.is(t._searchActions._cleanPopOver,"function")&&t._searchActions._cleanPopOver(),e.is(t.getPreviewPanel())&&e.is(t.getPreviewStatus()))){j.setItem("LastSearchPreview",t.getPreviewStatus()),j.commit()}},OnTabRemoved:function(){this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onTabRemoved",notif_parameters:{tabID:this.getTabID()}},"search_web_in_win")},onKeyboardEvent:function(t){var i=this.getSNSkeleton();e.is(i)&&i.handleKeyboardEvent(t)},_subscribeToKeyboardEvents:function(){var e=this;this._keydownEventHandler=function(t){e.onKeyboardEvent(t)},UWA.Element.addEvent.call(document,"keydown",this._keydownEventHandler)},onTaggerColorization:function(t){let i=this.getCollection();if(i&&e.is(t)&&i.setColorMap(t.tagColors),e.is(t)&&e.is(t.coloredSubjects)){this.setShadings([{criteria:function(e){return this.color=e.getColor(),!0}}])}else A.error("Invalid colorMap input in onTaggerColorization")},onTaggerUnColorization:function(){let e=this.getCollection();e&&e.unsetColorMap();this.setShadings([{color:"initial",criteria:function(){return!0}}])},onReady:function(){},onRefresh:function(){var e={};e.search_criteria=this._search_criteria,e.originalSearchCriteria=this._originalSearchCriteria,e.tag_filter=this._search_tag_filter,e.adv_search=this._adv_search,e.advanced_criteria=this._advanced_criteria,e.source=this.options.source,this.onSearch(e)},onSearchPQ:function(e){A.log("onSearchPQ");var t=this;D.fetchPQsFromServer(t._resources).then(function(){t.dispatchEvent("onSearchSkeletonPQ",e)})},onSearch:function(i){var n=Object.keys(t.parseQuery(window.location.search||"")).some(function(e){return"searchProto"===e})?"beta":"";_.trackerData.search.selectItem&&!_.trackerData.search.firstSearch&&d.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"NoSelection",persVal:{pv13:0}}}),_.trackerData.search.firstSearch&&(_.trackerData.search.firstSearch=!1),e.is(this.getCollection())&&(this.getTagsTransformer()&&this.getTagsTransformer().getAvblSource(this._resources.getActiveTenant(),this.getCollection()._isPinnedWidget()),(this.getCollection()._isPinnedWidget()||e.is(this.getOption("addinMode"),"string"))&&e.is(i.newActiveTenant,"string")&&this._resources.setActiveTenant(i.newActiveTenant)),_.isFUN109031Active()&&!this._isInAppsSearch()&&e.is(this.getCollection())&&(e.is(i.allMyContent)&&!0===i.allMyContent?this.getCollection().setAllMyContent(!0):this.getCollection().setAllMyContent(!1)),_.trackerData.search.scenario="",_.trackerData.search.selectItem=!1,_.trackerData.search.previewItem=!1,_.trackerData.search.openItem=!1,_.trackerData.search.indexItem=null,e.is(_)&&(_.trackerData.searchData.context=_.identifyClientInfo().identifier,_.trackerData.searchData.searchType=this._getSearchType().replace("#",""),_.trackerData.searchData.searchString=i.search_criteria_to_display),d.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"OneSearch",action:"Search",persDim:{pd1:e.is(_)?_.trackerData.searchData.context:"",pd2:e.is(_)?_.trackerData.searchData.searchType:"",pd9:_.trackerData.searchData.searchString,pd15:n}}});var s=this;if((!e.is(i.search_criteria)||!e.is(i.search_criteria_to_display)||e.is(i.queryType)&&Object.values(_.SearchTypeEnum).includes(i.queryType)||F.dispatch("search:showLastSearchResult",[i.search_criteria,i.search_criteria_to_display]),i.in_apps_search)&&!s.getOption("in_apps_search")){s.setOption("in_apps_search",i.in_apps_search);var o={search_criteria:i.search_criteria,originalSearchCriteria:i.originalSearchCriteria,search_criteria_to_display:i.search_criteria_to_display,source:i.source?i.source:this.source,search_mode:"index",tag_filter:i.tag_filter,adv_search:!!i.adv_search&&i.adv_search,savedSearch:i.savedSearch};return this.setOption("search_options",void 0),s.setOption("search_options",o),s._search_tag_filter=i.tag_filter,void s._rebuildSkeleton(s.opts_skeleton)}e.is(this.getCollection())?i&&i.search_criteria&&e.is(i.search_criteria,"string")&&i.search_criteria.indexOf(":")>0&&!e.is(s.getOption("in_apps_search"),"object")?D.fetchPQsFromServer(s._resources).then(function(){s.onSearchAsyncPQ(i)}):this.onSearchAsyncPQ(i):A.log("Skeleton Not Ready..")},_transformFilter:function(t){var i=this;this.getTagsTransformer()&&this.getTagsTransformer().transformFilterSourceToProject(t),this.getTagsTransformer()&&x.applyTransformation(t.allfilters,function(t){i.getTagsTransformer().transformFilterSourceToProject({allfilters:t,localfilters:e.clone(t)})})},onSearchAsyncPQ:function(t){if(A.groupCollapsed("SNResultMgt.onSearchAsyncPQ"),!e.is(t))return A.error("no options provided in SNResultMgt.onSearch !"),void A.groupEnd();if(A.log("options:",JSON.parse(JSON.stringify(t))),e.is(t.removeHistory)&&!0===t.removeHistory&&this._historySearch&&(e.is(this.elements.containerProduct)&&this.elements.containerProduct.empty(),e.is(this.elements.containerRelational)&&this.elements.containerRelational.empty(),this._historySearch.cleanAll()),e.is(t.recent_filter)||e.is(t.search_criteria===_.SearchTypeEnum.MY_RECENT_CONTENT)||e.is(this._taggerProxy)&&e.is(this._taggerProxy.activate,"function")&&this._taggerProxy.activate(),e.is(t.adv_search)&&!0===t.adv_search){if(t.search_criteria===_.SearchTypeEnum.ADVANCED_SEARCH){if(this.setTaggerMode("criteria"),void 0===t.displayValue&&void 0===t.in_apps_search&&void 0===t.source&&void 0===t.search_mode){var i={widgetId:this.getOption("widget_id")};return void this.showAdvancedSearch(i)}if(!0===_.isFUN109031Active()&&!0===p.getOption("search_web_in_win")&&void 0===t.displayValue&&void 0===t.in_apps_search&&void 0===t.search_mode&&!e.is(t.dontcallAgain)){let e={objets_name:[]};return void this.getSNSkeleton().onDispatchToWin(e,"showAdvancedSearch")}}}else this.setTaggerMode("tags");var n=this.getOption("in_apps_search");t.in_apps_search=e.is(t.in_apps_search)?t.in_apps_search:n,!e.is(n)||e.is(t.search_criteria_to_display)||p.getOption("search_web_in_win")||(t.search_criteria_to_display=""),!t.viewData&&n||C.setViewData(t.viewData),this.skeleton._searchActions.setEmptyViewMessage(I.get("loading"));let s=p.getOption("search_web_in_win");if(p.getOption("search_web_in_win")||e.is(t.originalSearchCriteria)&&0!==t.originalSearchCriteria.length||(t.originalSearchCriteria=t.search_criteria),this._search_criteria===_.SearchTypeEnum.MY_RECENT_CONTENT&&(""===t.search_criteria&&(t.search_criteria=_.SearchTypeEnum.MY_RECENT_CONTENT),t.search_criteria!==_.SearchTypeEnum.MY_RECENT_CONTENT&&this._taggerProxy&&this._taggerProxy.activate()),e.is(t)&&e.is(t.search_mode)&&e.is(t.search_criteria)&&_.SearchTypeEnum.MY_RECENT_CONTENT===t.search_criteria&&e.is(this.skeleton)&&e.is(this.skeleton._onesearch_collection)&&e.is(this.skeleton._onesearch_collection.service_parameters)&&e.is(this.skeleton._onesearch_collection.service_parameters.mode)&&_.SearchTypeEnum.MY_RECENT_CONTENT===this.skeleton._onesearch_collection.service_parameters.query&&(!e.is(t.refresh)||!0!==t.refresh))return A.log("Working on recent cache"),void this.skeleton._onesearch_collection.filterSearch(t);if(e.is(t.search_criteria)&&""!==t.search_criteria||_.SearchTypeEnum.MY_RECENT_CONTENT===t.search_criteria||!0===t.adv_search){var o=e.is(t.resetLocalFilter),a=!1;if(e.is(t)&&e.is(t.savedSearch)&&t.savedSearch&&(a=t.savedSearch),_.SearchTypeEnum.FAVORITE_SEARCH===t.search_criteria)t={search_criteria:t.search_criteria,originalSearchCriteria:t.originalSearchCriteria,adv_search:!1,advanced_criteria:null};e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("onSearch",{parameters:t,transient_widget:"true"===this.getOption("transient_context"),widget_id:this.getOption("widget_id"),in_apps_search:this.getOption("in_apps_search")}),e.is(n)||(t.search_criteria=N.manageWildcardAddtion(t.search_criteria));var r=!1;if(n&&e.is(n.searchable_types)&&(r=n.searchable_types),!n||r){var l=P.getGlobalSearchTypeCustoQuery(t.search_criteria);e.is(l)&&_.addSourceSpecificParameter(t,{sourceIds:["3dspace"],param:{id:"additional_query",value:l}})}if(t.widget_search_criteria&&t.search_criteria!==_.SearchTypeEnum.MY_RECENT_CONTENT){var c=N.manageWildcardAddtion(t.widget_search_criteria);t.search_criteria=c}if(t.update_incontext_options=this.getOption("update_incontext_options"),this.setOption("search_options",t),e.is(this._taggerProxy)&&e.is(this._search_criteria)){p.getOption("search_web_in_win")&&!0===p.getOption("proxy_button_available")&&this._taggerProxy.toggleProxyFocus(!0);var d="";if(e.is(this._taggerProxy.options)&&e.is(this._taggerProxy.options.widgetId,"string")?d=this._taggerProxy.options.widgetId:e.is(this._taggerProxy.widgetId,"string")&&(d=this._taggerProxy.widgetId),e.is(t.tag_filter,"object")&&e.is(t.tag_filter.allfilters,"object")&&0<Object.keys(t.tag_filter.allfilters).length&&"IsNotInWidget"!==d&&(t.localFilter=e.clone(t.tag_filter.allfilters)),!0!==a&&!0!==o||1==t.refresh){if((t.search_criteria===_.SearchTypeEnum.ADVANCED_SEARCH||e.is(this._adv_search)&&e.is(t.adv_search)&&this._adv_search!==t.adv_search)&&(!e.is(t.tag_filter,"object")||e.is(t.tag_filter.PLMParameters)&&e.is(t.tag_filter.PLMParameters.plmparam)&&e.is(t.tag_filter.PLMParameters.plmparam.length>0))&&e.is(this._taggerProxy.clearLocalFilter,"function")){var u=!1;if(e.is(n)&&"socket_id_#saved_search_edit#"===n.app_socket_id&&e.is(n.advanced_search)&&(u=!0),!u){this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping();let e=this.getSNSkeleton();e&&(e.getCollection()._resetState(),e.getCollection().reset(),e.getCollection().initTreeDocument(),e._updateWidgetTitleWithNbResult())}}if(e.is(t.tag_filter,"object"))e.is(t.tag_filter,"object")&&(t.advanced_criteria=this._getSearchCriteriaForAdvancedFilters(t.tag_filter,t._search_criteria),e.is(t.reSearch)&&!0===t.reSearch&&(this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping()));else if(e.is(this._taggerProxy)){var h=this._taggerProxy.getCurrentFilter();e.is(h)&&(e.is(h.allfilters)&&e.is(h.localfilters)&&this._transformFilter(h),t.tag_filter=this._removeAdvancedFiltersFromTagFilter(h),t.advanced_criteria=this._getSearchCriteriaForAdvancedFilters(h,t._search_criteria),this._taggerProxy.filters=t.tag_filter)}}else!0===p.getOption("search_web_in_win")?!0===o&&(this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping()):(this._taggerProxy.clearLocalFilter(),this._taggerProxy.clearLocalGrouping&&this._taggerProxy.clearLocalGrouping())}if(this._search_criteria=t.search_criteria,this._originalSearchCriteria=t.originalSearchCriteria,this._adv_search=t.adv_search,this._context=t.context,this._advanced_criteria=e.is(t.adv_search)&&!1===t.adv_search&&e.is(this._advanced_criteria)?"":t.advanced_criteria,this.options.source=t.source,e.is(n)&&(t.recent_search=n.recent_search,e.is(n.specific_source_parameter))){var g={specific_source_parameter:n.specific_source_parameter};t.context=g}if(this._idWaitLoading=W.WaitManager.addWaitCondition(1e5,"Wait loading search model"),t.idWaitLoading=this._idWaitLoading,(!this.getCollection()||this.getCollection().totalCount<0)&&e.is(n)&&e.is(n.order_field)&&e.is(n.order_by)&&(t.order_field=n.order_field,t.order_by=n.order_by),this.dispatchEvent("onSearchSkeleton",t),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")){var f=this.getSNSkeleton();e.is(f)&&A.log("SNSkeleton title: "+f.getTitle());var m=t.originalSearchCriteria,v=t.search_name;e.is(t.panelTitle)&&(v=t.panelTitle,m=t.search_criteria),sendNotificationWebInWin("SaveSearch",JSON.stringify({search_name:v,search_criteria:v,originalSearchCriteria:m}));var S=e.is(n)&&e.is(n.advanced_search);!1!==this._adv_search||S||this.hideAdvancedSearch()}{let t=this.getSNSkeleton();if(e.is(t)){var w=t.getSearchActions();e.is(w)&&w.updateGlobalActions()}}this.HideInformationLightboxPanel(),this.sortPanelView&&(e.is(this.getSNSkeleton())&&e.is(this.getSNSkeleton()._order_field)&&""!==this.getSNSkeleton()._order_field&&this.sortPanelView.updateRenderByExt({order_field:this.getSNSkeleton()._order_field,order_by:this.getSNSkeleton()._order_by}),this.sortPanelView.updateMenu()),A.groupEnd()}else if(!0===s&&""===t.search_criteria&&p.getOption("search_web_in_win")&&!0!==this._noCSOEventForWebInWin){let t=this.getSNSkeleton(),i=t&&t.getCollection(),n=t&&t._getTreedocumentFromCollection(i);if(e.is(n)&&e.is(n.getXSO())){let t=n.getXSO().get(),s=[];t.forEach(function(e){s.push(i.get(e._options.id))});let o=[];if(s.length>=0){let t=null;for(var b=0,y=s.length;b<y;b++){let i=s[b];if(!e.is(i))throw new Error("Invalid itemModel in SNSkeletonMgt.onItemSelect");if(t=i.get("id"),!e.is(t,"string"))throw new Error("Unable to get id of object in SNSkeletonMgt.onItemSelect");o.push({id:t,session_object:i.hasOwnProperty("session_object")})}let i={objets_name:o};this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onAddToCSO",notif_parameters:JSON.stringify(i)},"search_web_in_win")}}}},onViewChange:function(t){e.is(this.elements.container)&&(e.is(t.previous)&&e.is(t.previous.type)&&this.elements.container.removeClassName(t.previous.type),this.elements.container.addClassName(t.type))},openTagger:function(){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("openTagger",JSON.stringify({})):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("openTagger","")},closeTagger:function(){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("closeTagger",JSON.stringify({})):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("closeTagger","")},setTaggerMode:function(t){window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("setTaggerMode",t):e.is(this._searchcom_socket)&&this._searchcom_socket.dispatchEvent("setTaggerMode",t)},render:function(){return this},getActiveTenant:function(){return this._resources.getActiveTenant()},getTagsTransformer:function(){return this.getCollection()._tagsTransformer},onFilterChange:function(t){A.groupCollapsed("onFilterChange");var i=e.clone(t,!0);if(A.log("filters:",i),!0===this._beingDestroyed)return A.log("Being destroyed => exit"),void A.groupEnd();d.publish({channel:"3dSearch-global-view",topic:"emptyViews"});let n=this.getCollection();if(e.is(n)){if(n.isDestroyed())return void A.wxarn("Collection destroyed => don't take onFilterChange event into account!");n.interrupt(i)}this._isInAppsSearch()?this._onFilterChangeF(i):this.managePreferredUnitForAdvancedFilters(i),A.groupEnd()},_onFilterChangeF:function(t,i){var n=void 0!==i?i:this;if(n.getTagsTransformer()&&n.getTagsTransformer().getAvblSource(n._resources.getActiveTenant()),n._transformFilter(t),!e.is(n.options)||!e.is(n.options.search_options))return null;var s=n.getOption("search_options")||{};n.options.search_options.tag_filter=e.clone(t);var o,a,r,l,c=n._removeAdvancedFiltersFromTagFilter(t),d=null,u=!1,h="",g=[];if(e.is(s)&&(d=n._extractFTSFromFilter(t),x.isSimplifiedTaggerFilters(t.allfilters)&&(d.source=x.extractSourceInSimplifiedTagger(t.allfilters)),e.is(d))){var f=d.search_criteria;u=!0===d.search;var m;if(m=e.is(d.source,"array")&&d.source.indexOf("other")>-1,h=n._getSearchCriteriaForAdvancedFilters(d.new_filter,n._search_criteria,m),s.adv_search){if(e.is(n.getSNSkeleton,"function")&&e.is(n.getSNSkeleton().getAdvSearchMgr,"function")&&(o=n.getSNSkeleton().getAdvSearchMgr(),a=!(t.localfilters["sixw:ds6w:what/ds6w:type"]&&t.localfilters["sixw:ds6w:what/ds6w:type"].some(function(e){return e.object.split(":").pop()===o._adv_search_field})),e.is(o)&&(r=o._dataSetsForType&&o._dataSetsForType.options&&o._dataSetsForType.options.datasets&&o._dataSetsForType.options.datasets.items,a&&r)))for(o._adv_search_field=null,l=0;l<o._dataSetsForType.options.datasets.items.length;l++)!0===o._dataSetsForType.options.datasets.items[l].predefined&&delete o._dataSetsForType.options.datasets.items[l].predefined;g=d.source,e.is(f)&&f.length?n._search_criteria=f:e.is(h)&&h.length?n._search_criteria="":n._search_criteria=_.SearchTypeEnum.ADVANCED_SEARCH}}if(!n._adv_search&&"#myContent"!==n._search_criteria&&n._searchcom_socket&&n._searchcom_socket.dispatchEvent("Last_Tag_Filter",n.options.search_options.tag_filter),s.adv_search){let t=n.getOption("in_apps_search");t&&t.advanced_search&&e.is(t.precond,"string")&&t.precond.trim().length>0&&(e.is(h,"string")&&h.trim().length>0?h="("+h+") AND ("+t.precond+")":t.advanced_search&&!0===t.advanced_search.searchOnInit&&(h=t.precond))}n._search_tag_filter=c;var v={search_criteria:n._search_criteria,advanced_criteria:h,adv_search:u,tag_filter:n._search_tag_filter,source:g,originalSearchCriteria:n._originalSearchCriteria,fromSearchHistory:!0,refineSearch:!0,viewData:C.getViewData()};e.is(n.options.search_options.search_criteria_to_display)&&(v.search_criteria_to_display=n.options.search_options.search_criteria_to_display);var S={};S.tag_filter=n._search_tag_filter,u&&(S.search_criteria=n._search_criteria,S.originalSearchCriteria=n._originalSearchCriteria,S.adv_search=!0,S.advanced_criteria=h,e.is(d)&&e.is(d.source)&&(S.source=d.source)),n._updateWdgPreferences(S);let w=n.getCollection();if(e.is(w)){let t=w.getRequestCriteria();e.is(t)&&e.is(t.service_params)&&(v.adv_search=t.service_params.adv_search)}if(e.is(w)){if(w.dispatchEvent("onFilterChange",t),e.is(n.options.search_options.applicativeTitle)&&(v.applicativeTitle=n.options.search_options.applicativeTitle),e.is(n.options.search_options.applicativeTitleWithResults)&&(v.applicativeTitleWithResults=n.options.search_options.applicativeTitleWithResults),p.getOption("enablePLM",{tenant:n.getActiveTenant()})){var b=n.options.search_options.tag_filter.PLMParameters;if(e.is(b)&&e.is(b.plmparam)&&e.is(b.plmparam.double)){if(e.is(n.getSNSkeleton,"function")&&e.is(n.getSNSkeleton().getAdvSearchMgr,"function")){var y=n.getSNSkeleton().getAdvSearchMgr();e.is(y)&&y.convertPLMParamUnits(b,function(e){c.PLMParameters=e,n.onSearch(v)})}}else c.PLMParameters=b,n.onSearch(v)}else n.onSearch(v);e.is(n.options.search_options.tag_filter)&&n.displayAllForTypeAttribut(n.options.search_options.tag_filter.allfilters)}if(e.is(t)&&e.is(t.localfilters)&&(e.is(t.localfilters["sixw:ds6w:where/ds6w:source/ds6w:dataSource"])||e.is(t.localfilters["ds6w:where/ds6w:source/ds6w:dataSource"]))){let i=t.localfilters["sixw:ds6w:what/ds6w:type"],s={sixw:"ds6w:what/ds6w:type",value:[]};e.is(i)&&i.length>0&&i.forEach(function(e){s.value.push(e.object)}),n.onCriteriaChange(s)}},_isIncontextSourceHidden:function(){var t=this.getOption("in_apps_search");return t&&t.advanced_search&&e.is(t.advanced_search.showSource)&&!1===t.advanced_search.showSource},managePreferredUnitForAdvancedFilters:function(t){var i=this,n=e.clone(t,!0);if(t.localfilters=x.getAllAdvanceFilters(t.localfilters),t.allfilters=x.getAllAdvanceFilters(t.allfilters),B.getTypeListFromFilters(t.localfilters).length>0){var s={data:{},predicate2Type:{}};B.prepareRequestDataF(t.allfilters,s),B.prepareRequestDataF(t.localfilters,s),T.setResources(i._resources),T.convertValues({data:s.data,predicate2Type:s.predicate2Type,callback:function(e){Object.keys(e).length>0&&(B.modifyFilterData(t.allfilters,e),B.modifyFilterData(t.localfilters,e),x.applyTransformationAdvancedFilter(n.allfilters,function(e){B.copyConvertedValuesToOriginalFilter(e,t.allfilters)}),x.applyTransformationAdvancedFilter(n.localfilters,function(e){B.copyConvertedValuesToOriginalFilter(e,t.localfilters)})),i._onFilterChangeF(n)}})}else this._onFilterChangeF(n)},displayAllForTypeAttribut:function(t){if(e.is(t)&&e.is(t["ds6w:what/ds6w:type"])){var i=this.getCollection().getTaggerProxy();null!==i&&i.toggleDisplayAll(!0)}},onOpenTagger:function(){p.options.search_settings.taggerClosed=!1},onCloseTagger:function(){p.options.search_settings.taggerClosed=!0},onCriteriaChange:function(t){if(this.skeleton){var i=this.skeleton.getAdvSearchMgr();e.is(i)&&i.handleCriteriaChange(t)}},onPLMUpdate:function(t){if(this.skeleton){var i=this.skeleton.getAdvSearchMgr();e.is(i)&&i.handlePLMCriteriaChange(t)}},OnSuggestUpdate:function(t){if(this.elements&&this.skeleton){var i=this.skeleton.getAdvSearchMgr();e.is(i)&&i.handleTypeSuggestListChange(t)}},OnGroupingChange:function(t){p.getOption("debug")&&A.log("Grounping cb",t);let i=j.getItem("LastSearchViewMode");if(e.is(t)||"#myContent"!==this._search_criteria||(i="myContent",t=this._onGroupingOnMyRecent()),e.is(t,"object")){let n=this.getCollection();this.embeddedTaggerTags=t;let s=[];for(let e=0;e<t.groups.length;e++)s.push(t.groups[e].predicate);this.getRefineHelpers().hideTagcloudView(),this.getRefineHelpers().hideGlobeView(),this.getRefineHelpers().hideTimelineView(),this.getRefineHelpers().hidePhonebookView(),1===s.length&&("type_categorization"===s[0]&&(i="what")&&this.getRefineHelpers().showTagcloudView(),"person"===s[0]&&(i="who"),"ds6w:modified"===s[0]&&(i="when"),("computedCountryInfo"===s[0]||"ds6w:dataSource"===s[0])&&(i="where")&&this.getRefineHelpers().showGlobeView()),e.is(this.skeleton)&&this.skeleton.switchOnView(i),n&&n.dispatchEvent("OnGroupingChange",t)}e.is(this._taggerProxy)&&this._taggerProxy.setStatus({action:"grouping",status:!0,message:"Grouping sucessful"})},_onGroupingOnMyRecent:function(){let e=[],t=[],i={},n={iconInfo:{classes:"fonticon fonticon-clock"}};return n.dispText=I.get("myRecentContentTitle"),n.object=[],n.predicate=[],n.type="string",e.push(n),i.iconInfo={classes:"fonticon fonticon-user"},i.dispText=I.get("myContentTitle"),i.object=[],i.predicate=[],i.type="string",e.push(i),t.push({object:e,predLevel:!0,predicate:"myContent"}),{groups:t}},_extractFTSFromFilter:function(t){if(e.is(t)&&e.is(t.allfilters)){var i={new_filter:{allfilters:{}},search_criteria:"",search:t.search,source:[]};if(!1===this._isIncontextSourceHidden()&&this._adv_search&&!t.localfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&!t.allfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource"))return i;for(var n in t.allfilters)if(0!==n.indexOf("sixw:fts_value"))if("sixw:ds6w:where/ds6w:source/ds6w:dataSource"===n){let e=t.allfilters[n];for(let t=0;t<e.length;t++)0===t&&(i.source=[]),i.source.push(e[t].object)}else"ds6w:where/ds6w:source/ds6w:dataSource"===n?i.source=t.allfilters["ds6w:where/ds6w:source/ds6w:dataSource"][0].object:i.new_filter.allfilters[n]=t.allfilters[n];else{let e=t.allfilters[n];for(let t=0;t<e.length;t++)0===t&&1<e.length&&(i.search_criteria="("),0<t&&(i.search_criteria+=" OR "),i.search_criteria+=e[t].object,e.length===t+1&&1<e.length&&(i.search_criteria+=")")}return i}},getCollection:function(){if(this.skeleton)return this.skeleton.getCollection()},setShadings:function(e){this.getSNSkeleton().setShadings(e)},getItemsId:function(){var e=this.getCollection();if(e)return e.pluck("id")},dispatchInContextSelection:function(t,i){var n=this.getOption("in_apps_search");!0===p.getOption("search_web_in_win")?this._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onInContextAction",notif_parameters:JSON.stringify({action:i,selected_ids:this._selected_objects.pluck("id")})},t):(this._searchcom_socket&&(t&&this._selected_objects&&(this._selected_objects.size()?this._searchcom_socket.dispatchEvent("Selected_Objects_search",this._selected_objects.toArray(),t):A.log("No object selected")),this._searchcom_socket.dispatchEvent("clearSearch",{destroy:!0}),d.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{bCloseSidePanel:!e.is(n.closeTransient)||!0===n.closeTransient,bPinnedWidget:!(e.is(n)&&e.is(n.fromPinnedWidget,"boolean")&&!0===n.fromPinnedWidget),bEditSavedSearchSocket:"socket_id_#saved_search_edit#"===t}})),e.is(n.closeTransient)&&!0!==n.closeTransient||this._searchcom_socket.dispatchEvent("closeTransient",{command_id:i}),this.dispatchPowerByInContextSelection()),this._searchcom_socket&&t&&this._searchcom_socket.dispatchEvent("InContextSearch_Response",{selected_data:b.buildCompassSelectionData({selectedModels:this._selected_objects.toArray()}),selected_objects:this._selected_objects?this._selected_objects.toArray():[],search_params:this.getCollection().service_parameters,selected_command:i},t),"in_app_apply"!=i&&this._taggerClearLocalFilter(!0),this.hideAdvancedSearch()},dispatchPowerByInContextSelection:function(t){if(e.is(this.getOption("addinMode"),"string")&&this._selected_objects)if(this._selected_objects.size()>=this.getInContextMinSelect()){var i=b.buildCompassSelectionData({widgetId:this.getOption("widget_id"),selectedModels:this._selected_objects.toArray()}),n=JSON.stringify({event:"search_in_context_OK",source:i.source,version:i.version,content:i});A.log("publishing webinwin:web:notification SELECTION event, data:"+n),c.publish("webinwin:web:notification",n)}else if(!t)throw new Error("OK event fired without a selection !")},_rebuildSkeleton:function(t){A.log("_rebuildSkeleton"),this.skeleton&&(this.skeleton.stopListening(),this.skeleton.destroy(),delete this.skeleton),this._search_criteria="",this._originalSearchCriteria="",this._selected_objects=new o,this._adv_search=!1,this._advanced_criteria="",this._ok_Button=null,this._apply_Button=null,this._adv_search_field=null,this.onesearch_indexedtimeIcon=null,e.is(this.indexedtimeMenu)&&(e.is(this.indexedtimeMenu.destroy,"function")&&this.indexedtimeMenu.destroy(),this.indexedtimeMenu=null),this._isMultiSelModeOnTouch=!1,this._historySearch=null,this._headersSearch=null,this._idWaitLoading=null,this.elements.container&&this.elements.container.remove(),this.elements.container=null,this.embeddedTaggerTags=null,this.oRefineHelpers.reset(),this._searchBackViewContainer=null,this._searchBackViewContainerContent=null,this.searchLayoutContainer=null,this._buildDOM(),this._buildSkeleton(t)},_buildDOM:function(){var t=this.getOption("in_apps_search"),i=!1;if(e.is(t,"object")&&"furtive"===t.mode&&(i=!0),!e.is(this.elements.container)){var n=this.getClassNames();n.replace(" ","_"),this.elements.container=a.create("div",{class:this.getClassNames(),"data-rec-id":n})}var s=this.elements.container;let o=this.getOption("pinToDashboard");return _.isFUN109031Active()&&!this._isInAppsSearch()&&!1!==o&&(!i||i&&!0===t.modifysavedsearch)&&(e.is(this.embeddedTaggerContainer)||(this.embeddedTaggerContainer=a.create("div",{id:"embedded-tagger-"+this.getOption("widget_id")+"-"+this.getTabID()})),this.embeddedTaggerContainer.inject(s),e.is(this.searchLayoutContainer)||(this.searchLayoutContainer=a.create("div",{id:"3dsearch-layout-"+this.getOption("widget_id")+"-"+this.getTabID()})),this.searchLayoutContainer.inject(s)),this.getRefineHelpers().create6WRefineHelpers(this._isInAppsSearch(),i,t,s,this.searchLayoutContainer,this.getOption("widget_id"),this.getTabID()),j.getItem("nav_history")&&!0===bOkTonav_history&&(!j.getItem("integratedSearch")&&searcWidget&&(searcWidget.context="transient"),this.elements.containerContent=a.create("div",{class:"searchContainer","data-rec-id":"searchContainer"}),this.elements.containerContent.inject(this.elements.container),null===this._historySearch&&(this.elements.containerHistory=a.create("div",{class:"history-div","data-rec-id":"history-div",styles:{display:"none"}}),this.elements.containerHistory.inject(this.elements.containerContent,"bottom"),this._historySearch=new U,this._historySearch.addEvent("onSelected",this.onhistorySearchSelect.bind(this))),this.elements.containerProduct=a.create("div",{class:"product-div","data-rec-id":"product-div",styles:{display:"none",height:"100%"}}),this.elements.containerProduct.inject(this.elements.containerContent),this.elements.containerRelational=a.create("div",{class:"relational-div","data-rec-id":"relational-div",styles:{display:"none",height:"100%"}}),this.elements.containerRelational.inject(this.elements.containerContent),s=this.elements.containerContent),!0},_buildSkeleton:function(t){var i=this,n=this.getOption("in_apps_search"),s=!1,o=i.elements.container;e.is(n,"object")&&"furtive"===n.mode&&(s=!0);var a=!1,r=_.getSearchWidget(i.getOption("widget_id"));r&&e.is(r.getView,"function")&&(e.is(r.getView().previous)&&e.is(r.getView().previous.type)&&"windowed"===r.getView().previous.type?a=!0:e.is(r.getView().type)&&"sidepanel"===r.getView().type&&(a=!0)),e.is(n)&&(a=!1);var l=!1;j.getItem("nav_history")&&!0===a&&(l=!0);let c=!1;if(j.getItem("integratedSearch")&&o&&(o.addClassName("sideSearch"),c=this.getOption("pinToDashboard"),r&&void 0===this.getOption("pinToDashboard"))){var d=r.getValue("launch_mode");d!==_.widgetLaunchMode.COMPASS_TRANSIENT&&d!==_.widgetLaunchMode.COMPASS_PINNED&&d!==_.widgetLaunchMode.INCONTEXT_TRANSIENT||(c=!1)}e.is(this.skeleton)&&e.is(this.skeleton.destroy)&&this.skeleton.destroy(),this.skeleton=new m({messagingChannel:i.getMessagingChannel(),renderTo:null!=i.searchLayoutContainer&&null!=i.searchLayoutContainer?i.searchLayoutContainer:o,observable:this,resources:this._resources,tagger_proxy:this._taggerProxy,in_apps_search:n,furtive:s,events:t.events,source:t.source,widgetId:this.getOption("widget_id"),transient_context:this.getOption("transient_context"),use_preexisting_call:this.getOption("use_preexisting_call"),viewData:this.getOption("viewData"),pinToDashboard:c,navHistory:l,addinMode:this.getOption("addinMode"),idWaitLoading:this._idWaitLoading}),s&&this._createFurtiveControls(),j.getItem("nav_history")&&(i.getSNSkeleton().addEvent("onExploreAction",i.onExploreAction.bind(i)),i.getSNSkeleton().addEvent("onFedSearchComplete",i.onAddSearchBox.bind(i)),i.getSNSkeleton().addEvent("selected_obj",i.onSelected_obj.bind(i))),i.getSNSkeleton().addEvent("onPreviewModeRequest",function(){A.log("onPreviewModeRequest"),i._onPreviewModeRequest()}),i.getSNSkeleton().addEvent("onExitPreviewMode",function(){A.log("onExitPreviewMode"),i._onExitPreviewModeRequest()})},_setPreviewMode:function(e){this._previewMode=e},_getPreviewMode:function(){return this._previewMode},_onPreviewModeRequest:function(){this._setPreviewMode(!0);let t=this;t.dispatchEvent("onPreviewModeRequest"),this._bTaggerClosedForPreview=!1;let i=_.getWidth()<=1920;p.getOption("search_web_in_win")&&(t._bWidgetMaximizedForPreview=!1,i&&e.is(t.isTaggerVisible,"function")&&t.isTaggerVisible(function(e){!0===e&&(t.closeTagger(),t._bTaggerClosedForPreview=!0)}),t.requestView({type:"fullscreen"}),t._bWidgetMaximizedForPreview=!0,window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("PreviewModeRequest"))},_onExitPreviewModeRequest:function(){this._setPreviewMode(!1),this.dispatchEvent("onExitPreviewMode"),p.getOption("search_web_in_win")&&(e.is(this.requestView,"function"),!0===this._bTaggerClosedForPreview&&e.is(this.openTagger,"function")&&this.openTagger(),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("ExitPreviewModeRequest"))},isTaggerVisible:function(t){let i=!0,n=this.getCollection();if(e.is(n,"object")&&e.is(n.getTaggerProxy,"function")){let t=this.getCollection().getTaggerProxy();e.is(t,"object")&&e.is(t.getDisplayStatus,"function")&&(i=t.getDisplayStatus())}t(i)},requestView:function(){A.log("SNResultMgt.requestView TO IMPLEMENT")},_createFurtiveControls:function(){A.log("furtive mode activated");var t=this,i=this.getOption("in_apps_search"),n=i.app_socket_id,s=!1,o="Apply";e.is(i,"object")&&!0===i.showApplyButton&&(s=!0),e.is(i,"object")&&i.applyButton_Nls&&(o=i.applyButton_Nls);var r=I.get("OKButton"),l=I.get("APPLYButton");if(e.is(i)&&e.is(i.nls)){var u=i.nls;e.is(u.button_ok_label,"string")&&u.button_ok_label.length>0&&(r=u.button_ok_label),e.is(u.button_apply_label,"string")&&u.button_apply_label.length>0&&(l=u.button_apply_label)}require(["DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/Button"],function(u,h){var g=t.elements.container;if(-1!==["iphone","android"].indexOf(_.getDeviceCategory())){g=a.create("div",{class:"buttonContainer",styles:{order:"1",position:"absolute",height:"10%",bottom:"0",right:"0"}}).inject(t.elements.container),t.elements.container.setStyle("flex-direction","column");var f=t.elements.container.getElement(".onesearch_skeleton");e.is(f)&&f.setStyle("order","2")}else g=a.create("div",{class:"buttonContainer footer_button"}).inject(t.elements.container);new h({id:"id_in_app_cancel",value:I.get("CancelButton"),className:"default in_app_search_btn",events:{onClick:function(){!0===_.isTaggerOpenedByCode()&&!0===_.isFUN109031Active()&&t._searchcom_socket.dispatchEvent("closeTagger"),function(s){if(!0===p.getOption("search_web_in_win"))t._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onInContextAction",notif_parameters:JSON.stringify({action:"in_app_cancel"})},s);else if(t._searchcom_socket&&(t._searchcom_socket.dispatchEvent("clearSearch",{destroy:!0}),e.is(i.closeTransient)&&!0!==i.closeTransient||t._searchcom_socket.dispatchEvent("closeTransient",{command_id:"in_app_cancel"}),d.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",data:{bCloseSidePanel:!e.is(i.closeTransient)||!0===i.closeTransient,bPinnedWidget:!(e.is(i)&&e.is(i.fromPinnedWidget,"boolean")&&!0===i.fromPinnedWidget),bEditSavedSearchSocket:"socket_id_#saved_search_edit#"===s}})),e.is(t.getOption("addinMode"),"string")){var o=JSON.stringify({event:"search_in_context_CANCEL",source:_.SEARCH_APP_ID,version:"1.0",content:{}});A.log("publishing webinwin:web:notification search_in_context_CANCEL event, data:"+o),c.publish("webinwin:web:notification",o)}n&&t._searchcom_socket.dispatchEvent("InContextSearch_Response",{selected_objects:t._selected_objects.toArray(),search_params:t.getCollection().service_parameters,selected_command:"in_app_cancel"},n),e.is(t._taggerProxy)&&(e.is(t._taggerProxy.clearLocalFilter,"function")&&t._taggerProxy.clearLocalFilter(),e.is(t._taggerProxy.clearLocalGrouping,"function")&&t._taggerProxy.clearLocalGrouping(),t._taggerProxy.unsetTags()),t.hideAdvancedSearch()}(n)}}}).inject(g,"bottom");let m=null;s&&(m=new h({id:"id_in_app_apply",value:l,className:"default in_app_search_btn",disabled:!0,events:{onClick:function(){!0===_.isTaggerOpenedByCode()&&!0===_.isFUN109031Active()&&t._searchcom_socket.dispatchEvent("closeTagger"),t.dispatchInContextSelection(n,"in_app_apply")}}}).inject(g,"bottom"),new R({position:"top",target:m.getContent(),body:o}));var v=!0;i.furtive_options&&0===i.furtive_options.min_select&&(v=!1);var S=new h({id:"id_in_app_ok",value:r,className:"default in_app_search_btn primary",disabled:v,events:{onClick:function(){!0===_.isTaggerOpenedByCode()&&!0===_.isFUN109031Active()&&t._searchcom_socket.dispatchEvent("closeTagger"),t.dispatchInContextSelection(n,"in_app_ok")}}}).inject(g,"bottom");t._ok_Button=S,e.is(m)&&(t._apply_Button=m,m.disable()),S.setDisabled(v)})},_removeAdvancedFiltersFromTagFilter:function(t){if(!e.is(t))return t;if(!e.is(t.allfilters))return t;let i=x.isSimplifiedTaggerFilters(t.allfilters),n={allfilters:{}},s=null;for(s in t.allfilters)n.allfilters[s]=t.allfilters[s];if(e.is(t.localfilters))for(s in t.localfilters)e.is(n.localfilters)||(n.localfilters={}),n.localfilters[s]=t.localfilters[s];return i&&(t.allfilters=this._getAllFilters(t.allfilters),t.localfilters=this._getAllFilters(t.localfilters)),this._adv_search&&e.is(t.localfilters)&&(e.is(this.getSNSkeleton())&&e.is(this.getSNSkeleton().getAdvSearchMgr())&&this.getSNSkeleton().getAdvSearchMgr().showSourceField()&&t.localfilters.hasOwnProperty("sixw:ds6w:what/ds6w:type")&&1===Object.keys(t.localfilters).length||t.localfilters.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&1===Object.keys(t.localfilters).length||0===Object.keys(t.localfilters).length)?(e.is(this._taggerProxy)&&e.is(this._taggerProxy.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter(),e.is(this._taggerProxy)&&e.is(this._taggerProxy.clearLocalGrouping,"function")&&this._taggerProxy.clearLocalGrouping(),this._taggerProxy.unsetTags(),{allfilters:{}}):n},_getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){0==i.indexOf("sixw:")?(t[i]=t[i]||[],(e[i]||[]).forEach(function(e){t[i].push(e)})):(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],n=e.value||[],s=e.field;i.forEach(function(i,o){t[i.predicate]||(t[i.predicate]=[]);var a={disptext:e.display,object:n[o],type:i.type,field:s?[s[o]]:["implicit"]};t[i.predicate].push(a)})})})}),t},_getSearchCriteriaForAdvancedFilters:function(t,i,n){if(!e.is(t))return i;if(!e.is(t.allfilters))return i;var s=p.getOption("SEARCH_INSTANCES",{tenant:this.getActiveTenant()});return w.from_filters_to_uql(t.allfilters,i,n,s)},_toggleProxyFocus:function(t){e.is(this._taggerProxy)&&!0===p.getOption("proxy_button_available")&&(this._taggerProxy._attributes.widgetId===t.widgetId&&-1===["iphone","ipad","android"].indexOf(_.getDeviceCategory())&&!0!==p.options.search_settings.taggerClosed&&this._taggerProxy.toggleProxyFocus(t.maximized))},setTitle:function(t){var i=this.getSNSkeleton();e.is(i)&&i.setTitle(t)},getSNSkeleton:function(){var t;return e.is(this.skeleton)&&(t=this.skeleton),t},updateSelectionNumber:function(t){var i=this.getSNSkeleton();if(!e.is(i))throw new Error("No skeleton in SNResultMgt.updateSelectionNumber !");if(e.is(this.onesearch_selectionNumber)){this.onesearch_selectionNumber.style.display=this._isMultiSelModeOnTouch||t.number>0&&"nullToMany"===i._selectionMode_techno?"inline":"none",this.onesearch_selectionNumber.innerHTML=t.number,!t.isMultiSelMode&&t.number<=1&&!this._isMultiSelModeOnTouch?this.onesearch_selectionNumberDiv.style.color="rgb(180, 182, 186)":this._isMultiSelModeOnTouch&&(this.onesearch_selectionNumberDiv.style.color="#368ec4");var n=i.getOption("in_apps_search"),s=n&&n.UXOptions&&!n.UXOptions.localActions;!t.isMultiSelMode&&"nullToMany"!==i._selectionMode_techno||s?this.onesearch_globalDropdownIcon.style.display="none":this.onesearch_globalDropdownIcon.style.display="inline"}else{var o=p.getOption("search_compact_mode");if(e.is(o)&&!1===o&&e.is(this._detailsviewSelected))if(t.number>0){this._detailsviewSelected.setStyle("display","flex");var a=this._detailsviewSelected.getElement(".set-detail-view-select");e.is(a)&&a.setText(t.number)}else this._detailsviewSelected.setStyle("display","none")}},getSearchContentSetHeader:function(){return this._contentSetHeader},showSearchContentSetHeader:function(e){this._contentSetHeader.getElement(".onesearch_sortcontent")&&this._contentSetHeader.getElement(".onesearch_sortcontent").setStyle("display",""),this._contentSetHeader.getElement(".onesearch_action")&&this._contentSetHeader.getElement(".onesearch_action").setStyle("display",""),this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher")&&this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher").setStyle("display",""),this._contentSetHeader.getElement(".onesearch_resizer_6w")&&this._contentSetHeader.getElement(".onesearch_resizer_6w").setStyle("display","none"),this._contentSetHeader.getElement(".search-content-set-actions")&&this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display","")},hideSearchContentSetHeader:function(e){this._contentSetHeader.getElement(".onesearch_sortcontent")&&this._contentSetHeader.getElement(".onesearch_sortcontent").setStyle("display","none"),this._contentSetHeader.getElement(".onesearch_action")&&this._contentSetHeader.getElement(".onesearch_action").setStyle("display","none"),this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher")&&this._contentSetHeader.getElement(".search-content-set-switcher.content-set-switcher.set-switcher").setStyle("display","none"),this._contentSetHeader.getElement(".onesearch_resizer_6w")&&this._contentSetHeader.getElement(".onesearch_resizer_6w").setStyle("display","block"),"where"===e&&this._contentSetHeader.getElement(".search-content-set-actions")?this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display","none"):this._contentSetHeader.getElement(".search-content-set-actions").setStyle("display","")},_injectRecentStuff:function(t){var i=this,n=this.getSNSkeleton();if(!0===p.getOption("show_last_indexation_time")){this.elements.recentcontent=a.create("div",{class:"onesearch_recentcontent","data-rec-id":"onesearch_recentcontent"}),this.elements.recentcontent.inject(t),this.onesearch_indexedtimeIcon=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-clock",styles:{fontSize:"24px"}}).inject(this.elements.recentcontent);var s=p.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()}),o=I.replace(I.get("switchToRecentContent"),{recentDelta:s});this.onesearch_indexedtimeIcon.tooltip=new R({position:"bottom",target:this.onesearch_indexedtimeIcon,body:o});var r,l,c={},d={},u={};_.isODTMode()&&(c={"data-rec-id":"recentMenu"},d={"data-rec-id":"recent"},u={"data-rec-id":"allRecent"}),c.style="max-width: 600px;",d.style="white-space: normal;";var h=this.getOption("in_apps_search");e.is(h)&&e.is(h.recent_search)&&e.is(h.recent_search.types)&&h.recent_search.types.length>0?(r=I.get("searchInMyRecentContentInContext"),l=I.get("displayAllMyRecentContentInContext")):(r=I.get("searchInMyRecentContent"),l=I.get("displayAllMyRecentContent")),this.indexedtimeMenu=n.indexedtimeMenu=new M({className:"search_recent_container",target:this.elements.recentcontent,items:[{id:"last_index",text:I.replace(I.get("lastIndexedTimeTooltip"),{indexTime:I.get("indexTimeNotAvailable")}),className:"header",attributes:{style:"text-transform: none;"}},{id:"warning",name:"warning",className:"header",text:I.get("warningIndexed"),attributes:{style:"text-transform: none; display: none;"}},{id:"divider",className:"divider"},{id:"my_recent",name:"my_recent",text:r,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",selectable:!0,attributes:d},{id:"all_my_recent",name:"all_my_recent",text:l,fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search",selectable:!0,attributes:u}],attributes:c,events:{onClick:function(t,s){i._taggerProxy&&(i._taggerProxy.deactivate(),i._taggerProxy.unsetTags());var o=i.getOption("search_options")||{};if(!0===i._adv_search){var a=n.getAdvSearchMgr();e.is(a)&&e.is(a.hideAdvancedSearchTab,"function")&&a.hideAdvancedSearchTab()}o.search_criteria_to_display&&(this.last_search_criteria=o.search_criteria_to_display),"my_recent"===s.name?(n._myDatagridView&&n._myDatagridView._model&&n._myDatagridView._model.getXSO().empty(),n.getCollection().reset(),i._searchcom_socket.dispatchEvent("onSearchModeSwitch",{new_mode:_.SearchTypeEnum.MY_RECENT_CONTENT,paramsFilter:o.search_criteria_to_display?o.search_criteria_to_display:this.last_search_criteria,widgetId:n.options.widgetId}),!0===p.getOption("search_web_in_win")&&(o.search_criteria=_.SearchTypeEnum.MY_RECENT_CONTENT,o.recent_filter=o.originalSearchCriteria,n._searchActions.dispatchEvent("onRefreshResultRequest"))):"all_my_recent"===s.name&&(_.SearchTypeEnum.MY_RECENT_CONTENT===o.search_criteria?(window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")?sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:_.SearchTypeEnum.MY_RECENT_CONTENT,search_mode:"index"})):i._searchcom_socket.dispatchEvent("onRefreshSearchField",""),n.getCollection().filterSearch({recent_filter:"*"}),o.recent_filter="*"):(n._myDatagridView&&n._myDatagridView._model&&n._myDatagridView._model.getXSO().empty(),n.getCollection().reset(),i._searchcom_socket.dispatchEvent("onSearchModeSwitch",{new_mode:_.SearchTypeEnum.MY_RECENT_CONTENT,paramsFilter:"*",widgetId:n.options.widgetId}),!0===p.getOption("search_web_in_win")&&(o.search_criteria=_.SearchTypeEnum.MY_RECENT_CONTENT,o.recent_filter="*",o.adv_search=!1,o.advanced_criteria="",n._searchActions.dispatchEvent("onRefreshResultRequest"),window.hasOwnProperty("sendNotificationWebInWin")&&e.is(sendNotificationWebInWin,"function")&&sendNotificationWebInWin("UpdateSearchField",JSON.stringify({search_criteria:"#myRecentContent"}))))),i.onesearch_indexedtimeIcon.className=s.fonticon},onShow:function(){if(-1!==i.onesearch_indexedtimeIcon.className.indexOf("wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-clock")){var t=!0;switch(i._getSearchType()){case _.SearchTypeEnum.MY_CONTENT:case _.SearchTypeEnum.ADVANCED_SEARCH:case _.SearchTypeEnum.FAVORITE_SEARCH:t=!1}this.items.forEach(function(n){if(n.selected=!1,n.elements.container.removeClassName("selected"),e.is(n)&&"my_recent"===n.name)if(n.elements.container.setStyle("display","inline-block"),!1===t)n.elements.container.setStyle("display","none");else{var s="",o=i.options.search_options.originalSearchCriteria;s=e.is(h)&&e.is(h.recent_search)&&e.is(h.recent_search.types)&&h.recent_search.types.length>0?I.replace(I.get("searchInMyRecentContentInContext"),{searchCriteria:o}):I.replace(I.get("searchInMyRecentContent"),{searchCriteria:o}),i.indexedtimeMenu.updateItem({id:i.indexedtimeMenu.items[3].id,text:s})}})}}}}),n.indexedtimeIcon=this.onesearch_indexedtimeIcon}this.getSNSkeleton()&&this.getSNSkeleton().updateByUXOptions&&this.getSNSkeleton().updateByUXOptions(I.get("indexTimeNotAvailable"))},_setErrorManagerMaximumResultsTooltip:function(t){for(var i=this.onesearch_errorManagerIcon.tooltip.getBody().getElementsByTagName("div"),n="",s="",o=0;o<i.length;o++)i[o].className.contains("sourceErrorTooltipContent")&&(n=i[o].outerHTML);e.is(t)&&(s='<div class="maximumResultsTooltipContent">'+I.replace(I.get("maximum_results"),{count:t})+"</div>");var a=s+n;this.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(a),this._manageErrorManagerDisplay()},_setErrorManagerSourceErrorsTooltip:function(e){for(var t=this.onesearch_errorManagerIcon.tooltip.getBody().getElementsByTagName("div"),i="",n="",s=0;s<t.length;s++)t[s].className.contains("maximumResultsTooltipContent")&&(n=t[s].outerHTML);""===e?this.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(n):(i="<div class='sourceErrorTooltipContent'>"+e+"</div>",this.onesearch_errorManagerIcon.tooltip.getBody().getChildren()[2].setHTML(n+i)),this._manageErrorManagerDisplay()},_manageErrorManagerDisplay:function(){for(var e=this.onesearch_errorManagerIcon.tooltip.getBody().getElementsByTagName("div"),t=!1,i=!1,n=0;n<e.length;n++)e[n].className.contains("sourceErrorTooltipContent")&&(t=!0),e[n].className.contains("maximumResultsTooltipContent")&&(i=!0);_.isFUN109031Active()||(!0===t||!0===i?this.onesearch_errorManagerIcon.show():this.onesearch_errorManagerIcon.hide())},setSearchContentSetHeader:function(t){let i=this.getSNSkeleton();if(!e.is(i))throw new Error("No skeleton in SNResultMgt.setSearchContentSetHeader !");e.is(t)||A.error("Unexpected error in setSearchContentSetHeader invalid iContentSetHeader !");let n=_.isInTheSimpleSearch({tenant:this._resources.active_tenant}),s=this.getOption("swymContext");this._contentSetHeader=t;try{return!0===n||!0===s?this._setSearchContentSetHeaderForPreviewSwym():this._setSearchContentSetHeaderForStandardCase()}catch(e){console.log("Init content set header failed",e)}},_setSearchContentSetHeaderForPreviewSwym:function(){let t=p.getOption("search_compact_mode"),i=_.isInTheSimpleSearch({tenant:this._resources.active_tenant}),n=j.getItem("NoindexOnBar"),s=j.getItem("NomultiSelection"),o=j.getItem("NoSort"),r=this.getOption("swymContext"),l=this._contentSetHeader;var c=this;if(!0===s&&l.setStyle("height","0px"),!0!==n&&!0!==r||!e.is(l.getElement(".set-multiselHeader"))||l.getElement(".set-multiselHeader").setStyle("height","0px"),!1===o){var d=6;e.is(t)&&!0===t&&(d=4),this.elements.sortcontent=a.create("div",{class:"onesearch_sortcontent","data-rec-id":"onesearch_sortcontent",styles:{order:d}}),this.elements.sortcontent.inject(l),this.sortPanelView=new E({container:this.elements.sortcontent,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()})}if(!0!==r){var u=!0;!0===i&&(u=!1),e.is(t)&&(u=!0,!0===t&&(u=!1)),!0!==u||!1!==_.isFUN109031Active()&&!this._isInAppsSearch()||this._injectRecentStuff(l)}this._setErrorManager(l);let h=c.getOption("search_options");if(this._forceOnSearch&&e.is(h)){var g=this.getOption("in_apps_search");e.is(g)&&e.is(g.displayValue)&&(h.search_criteria_to_display=g.displayValue),this._forceOnSearch=!1,this.onSearch(h)}l.removeClassName("search_compact_mode");var f="";if("ipad"===_.getDeviceCategory()&&(f="ipad",t=!1),e.is(t)&&!1===t){c.elements.onesearchactions=a.create("div",{class:"onesearch_action"}),c.elements.onesearchactions.inject(l),a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-chevron-down ",styles:{fontSize:"24px","align-self":"center","margin-left":"-5px"}}).inject(c.elements.onesearchactions);var m=new R({position:"bottom",target:c.elements.onesearchactions,body:I.get("OneSeachActions")});c._oneSearchActions=new X({container:c.elements.onesearchactions,collection:c.getCollection(),searchActions:c.skeleton.getSearchActions(),messagingChannel:c.getMessagingChannel(),mode:f}),c._oneSearchActions.tooltip=m,l.addClassName("search_compact_mode"),c._detailsviewSelected=a.create("div",{class:"container-selectCount",styles:{order:0,display:"none"}}),c._detailsviewSelected.inject(l),a.create("span",{class:"set-detail-view-select",id:"search-multisel-count"}).inject(c._detailsviewSelected),a.create("span",{class:"set-detail-view-of"}).inject(c._detailsviewSelected).setText(I.get("setdetailviewof"))}_.isFUN109031Active()&&!this._isInAppsSearch()&&(this.elements.resizerContent=a.create("div",{class:"onesearch_resizer","data-rec-id":"onesearch_resizer"}),this.elements.resizerContent.tooltip=new R({position:"bottom",target:this.elements.resizerContent,className:"resizeTooltip",body:I.get("relation.maxminTooltip")}),this.resizerContentSpan=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-"+(void 0===j.getItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID())||!1===j.getItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID())?"full":"small"),"data-rec-id":"SNResultMgt_onesearch_resizer",id:"onesearch_resizer_span",events:{click:function(){c._toggle6WResizeFullMode()}}}).inject(this.elements.resizerContent),this.elements.resizerContent.inject(l),this.elements.switcher6w=a.create("div",{class:"onesearch_resizer_6w","data-rec-id":"onesearch_resizer_6w"}),this.sortPanelView=new k({container:this.elements.switcher6w,collection:this.getCollection(),widgetId:this.getOption("widget_id")}),this.elements.switcher6w.inject(l))},_setSearchContentSetHeaderForStandardCase:function(){let t=this._contentSetHeader,i=p.getOption("neverCheckbox");var n=this,s=this.getSNSkeleton();if(UWA.Element.addEvent.call(this._contentSetHeader,"contextmenu",function(e){if("undefined"!=typeof dscef){0===dscef.getEnv("CATCEF_DEVTOOLS").length&&e.preventDefault()}}),(!1===_.isFUN109031Active()||this._isInAppsSearch())&&this._injectRecentStuff(t),this._setErrorManager(t),!e.is(i)||!0!==i){this.onesearch_selectionNumberDiv=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-select-on","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-select-on",styles:{fontSize:"22px",color:"#b4b6ba",marginRight:"0.1em",lineHeight:"40px"},events:{touchstart:function(){this.isTouchable=!0},click:function(){(document.querySelector("html .touch")||this.isTouchable)&&(n._isMultiSelModeOnTouch=!n._isMultiSelModeOnTouch,n._isMultiSelModeOnTouch?n._searchcom_socket.dispatchEvent("toggleMultiSelMode",!0):n._searchcom_socket.dispatchEvent("toggleMultiSelMode",!1))}}}).inject(t.getElement(".set-multiselHeader")),this.onesearch_selectionNumber=a.create("span",{id:"search-multisel-count","data-rec-id":"search-multisel-count",styles:{fontSize:"15px",padding:"0 5px",color:"currentColor",display:"none"}}).inject(this.onesearch_selectionNumberDiv);let i=s.getOption("in_apps_search"),o=i&&i.UXOptions&&!i.UXOptions.localActions;this.onesearch_globalDropdownIcon=a.create("span",{class:"fonticon fonticon-2x fonticon-down-open","data-rec-id":"SNResultMgt_fonticon_fonticon-2x_fonticon-down-open",id:"search-multisel-dropdown",styles:{color:"#b4b6ba",display:o||"oneToOne"===s._selectionMode_techno?"none":"inline",margin:"0",cursor:"pointer"},events:{click:function(){e.is(s)&&s.launchGlobalDropdown()}}}).inject(t.getElement(".set-multiselHeader"))}this.elements.sortcontent=a.create("div",{class:"onesearch_sortcontent","data-rec-id":"onesearch_sortcontent"}),this.elements.sortcontent.inject(t),this.sortPanelView=new E({container:this.elements.sortcontent,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()});let o=this.getOption("search_options");this._forceOnSearch&&e.is(o)&&(this._forceOnSearch=!1,this.onSearch(o)),_.isFUN109031Active()&&!this._isInAppsSearch()&&(this.elements.resizerContent=a.create("div",{class:"onesearch_resizer","data-rec-id":"onesearch_resizer"}),this.elements.resizerContent.tooltip=new R({position:"bottom",target:this.elements.resizerContent,className:"resizeTooltip",body:I.get("relation.maxminTooltip")}),this.resizerContentSpan=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-"+(void 0===j.getItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID())||!1===j.getItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID())?"full":"small"),"data-rec-id":"SNResultMgt_onesearch_resizer",id:"onesearch_resizer_span",events:{click:function(){n._toggle6WResizeFullMode()}}}).inject(this.elements.resizerContent),this.elements.resizerContent.inject(t),this.elements.switcher6w=a.create("div",{class:"onesearch_resizer_6w","data-rec-id":"onesearch_resizer_6w"}),this.sortPanelView=new k({container:this.elements.switcher6w,collection:this.getCollection(),widgetId:this.getOption("widget_id"),messagingChannel:this.getMessagingChannel()}),this.elements.switcher6w.inject(t))},_toggle6WResizeFullMode:function(){let t;void 0===j.getItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID())||!1===j.getItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID())?(t=!0,j.setItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID(),t),e.is(this.elements)&&e.is(this.elements.container)&&this.elements.container.addClassName("withoutMargin"),this.resizerContentSpan.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-small"):(t=!1,j.setItem("BETA-FUN109031-resizefullmode-"+this.getOption("widget_id")+"-"+this.getTabID(),t),e.is(this.elements)&&e.is(this.elements.container)&&this.elements.container.removeClassName("withoutMargin"),this.resizerContentSpan.className="wux-ui-3ds wux-ui-3ds-2x wux-ui-3ds-width-full"),this.dispatchEvent("onToggle6WResizeFullMode",t),j.commit(),d.publish({channel:"Qchannel-searchgriview-all",topic:"Qtopic-searchgriview-refreshMargins",data:{}})},_setErrorManager:function(t){var i=this;let n=this.getSNSkeleton();F.add("errorManager:tooltip",function(t){if(e.is(t)&&t.length>0){var n="",s="";if(p.getOption("debug"))for(var o=0;o<t.length;o++)e.is(t[o].name)&&e.is(t[o].error)&&e.is(t[o].error.errorCode)&&(o>0&&(n+="<br>"),""===(s=I.get(t[o].error.errorCode))&&(s=t[o].error.errorCode),n+="<b>"+t[o].name+"</b>: "+s);else n=I.get("errorManager_basicMessage");i._setErrorManagerSourceErrorsTooltip(n)}else i._manageErrorManagerDisplay()}),this.elements.errorManager=a.create("div",{class:"onesearch_errorManager","data-rec-id":"onesearch_errorManager"}).inject(t),this.onesearch_errorManagerIcon=a.create("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-help","data-rec-id":"SNResultMgt_wux-ui-3ds_wux-ui-3ds-1x_wux-ui-3ds-help",styles:{fontSize:"18px","max-width":"500px"}}).inject(this.elements.errorManager),!0===this.getOption("swymContext")&&this.onesearch_errorManagerIcon.addClassName("searchErrorManagerSwym");let s=j.getItem("errorManager:limit"),o="";e.is(s)?(o=I.replace(I.get("maximum_results"),{count:s}),this.onesearch_errorManagerIcon.show()):_.isFUN109031Active()?this.onesearch_errorManagerIcon.show():this.onesearch_errorManagerIcon.hide(),this.onesearch_errorManagerIcon.tooltip=n.errorManagerTooltip=new R({position:"bottom",target:this.onesearch_errorManagerIcon,className:"maximumResultsTooltip search-ui-tooltip",body:'<div class="Search-errorManager-freeText"></div><div class="Search-errorManager-findLink">'+(_.isFUN109031Active()&&!_.isODTMode()?"<div></div>"+I.get("lastIndexedTimeFindLink")+"<div></div>":"")+'</div><div class="Search-errorManager-errors">'+(""!==o?'<div class="maximumResultsTooltipContent">'+o+"</div>":"")+"</div>"})},refreshSearch:function(){var t=e.clone(this.options.search_options);e.is(t)&&(this._historySearch&&(e.is(i.elements.containerProduct)&&i.elements.containerProduct.empty(),e.is(i.elements.containerRelational)&&i.elements.containerRelational.empty(),this._historySearch.cleanAll()),t.refresh=!0,this.onSearch(t));var i=this;i.HideInformationLightboxPanel()},hideAdvancedSearch:function(){this.skeleton&&this.skeleton.getAdvSearchMgr().hideAdvancedSearchTab()},showAdvancedSearch:function(t){if(e.is(t)&&e.is(t.widgetId)){var i=this.getOption("widget_id");if((!e.is(i)||i===t.widgetId)&&(this._adv_search_field=null,this.skeleton)){var n=this.skeleton.getAdvSearchMgr();if(!e.is(n)||!e.is(n.getAndDisplayAdvancedSearch,"function"))throw new Error("Error in showAdvancedSearch !");var s=!0,o=!0,a=null,r=this.getCollection().getTaggerProxy(),l=r.getCurrentFilter(),c=this.getOption("in_apps_search");if(e.is(l)&&(a=l.allfilters),e.is(r)&&e.is(l)&&e.is(a)&&0!==Object.keys(a).length&&(e.is(t)&&e.is(t.adv_search_field)&&e.is(t.adv_search_field,"string")||1===Object.keys(a).length&&(a.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")||a.hasOwnProperty("ds6w:where/ds6w:source/ds6w:dataSource"))?(n.clearFilters(),n.getAndDisplayAdvancedSearch(!0)):e.is(c)&&e.is(c.title)&&!n._fieldsToSet||(o=!1)),this._originalSearchCriteria===_.SearchTypeEnum.ADVANCED_SEARCH&&(o||(s=!1)),o?(n._adv_search_field=null,e.is(t)&&e.is(t.adv_search_field)&&e.is(t.adv_search_field,"string")&&(this._adv_search_field=t.adv_search_field,n._adv_search_field=t.adv_search_field),n.getAndDisplayAdvancedSearch(!0,t)):e.is(c)&&e.is(c.title)&&!n._fieldsToSet?n.getAndDisplayAdvancedSearch(!0,t):n.getAndDisplayAdvancedSearchWithProxyFilterSettings(),s){if(!c){e.is(r)&&e.is(r.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter();var d=this.getSNSkeleton();d&&(d.getCollection()._resetState(),d.getCollection().reset(),d.getCollection().initTreeDocument(),d._updateWidgetTitleWithNbResult())}var u={search_criteria:"#advancedSearch",adv_search:!0,recent_filter:"*",source:[],search_mode:"index",tag_filter:"",refresh:!1};!0===p.getOption("search_web_in_win")&&(u.dontcallAgain=!0),this.onSearch(u)}}}},manageInformationPanel:function(t){var i=null;if(i=e.is(this.getOption("getContainer"),"function")?this.getOption("getContainer").call():e.extendElement(document.body),e.is(i)){var n=null;if(j.getItem("nav_history")?i.parentElement&&(n=i.parentElement.getElement(".searchHeaderCmd_content")):n=i.getElement(".search-content-set-container"),null!==n){var s=this.getSNSkeleton();if(e.is(s)){var o=t,a=_.getSearchWidget(this.getOption("widget_id"));e.is(a)&&!e.is(o)&&(o=a.getValue("informationPanelState"+this.getTabID())),!0===o?(n.addClassName("informationPanel_Icon"),e.is(a)&&a.setValue("informationPanelState"+this.getTabID(),!0)):(n.removeClassName("informationPanel_Icon"),e.is(a)&&a.setValue("informationPanelState"+this.getTabID(),!1)),s.setInformationStatus(o,o)}}}},managepreviewPanel:function(t){var i=null;if(i=e.is(this.getOption("getContainer"),"function")?this.getOption("getContainer").call():e.extendElement(document.body),e.is(i)){var n=null;if(j.getItem("nav_history")?i.parentElement&&(n=i.parentElement.getElement(".searchHeaderCmd_content")):n=i.getElement(".search-content-set-container"),null!==n){var s=this.getSNSkeleton();e.is(s)&&(t!==s.getPreviewStatus()&&(s.setPreference("previewDefautActivateState",t),j.commit()),s.setPreviewStatus(t)),!0===t?n.addClassName("previewPanel_Icon"):n.removeClassName("previewPanel_Icon")}}},managehistoryPanel:function(t){var i,n=null,s=_.getSearchWidget(this.getOption("widget_id"));if(e.is(s)){if(n=e.extendElement(s.elements.body).getElement(".searchHeaderCmd_content"),i=e.extendElement(s.elements.body).getElement(".history-div"),null===n){var o=null;o=e.is(this.getOption("getContainer"),"function")?this.getOption("getContainer").call():o=e.extendElement(document.body),e.is(o)&&o.parentElement&&(n=o.parentElement.getElement(".searchHeaderCmd_content"))}var a;a=s.getValue("navigationHistoryState"+this.getTabID()),null!==n&&(!0===t?!1===a||void 0===a?(n.addClassName("navigationHistory_Icon"),!0===t&&s.setValue("navigationHistoryState"+this.getTabID(),!0),e.is(i)&&i.setStyle("display","inline-block"),void 0===a&&this._historySearch&&this._historySearch.render(i)):(n.removeClassName("navigationHistory_Icon"),!0===t&&s.setValue("navigationHistoryState"+this.getTabID(),!1),e.is(i)&&i.setStyle("display","none")):!0===a?(this._historySearch&&this._historySearch.render(i),n.addClassName("navigationHistory_Icon"),e.is(i)&&i.setStyle("display","inline-block")):(n.removeClassName("navigationHistory_Icon"),e.is(i)&&i.setStyle("display","none")))}},HideInformationLightboxPanel:function(){var t=this.getSNSkeleton();if(e.is(t)&&e.is(t.getPreviewPanel,"function")){var i=t.getPreviewPanel();e.is(i)&&!0===i.getVisibleFlag()&&(e.is(i.hideAndclean,"function")&&i.hideAndclean(),i.setActiveObject(null)),e.is(t._lightBoxView)&&!0===t._lightBoxView._LightBoxPanel.visibleFlag&&this.managepreviewPanel(t.ActivateDeactivatePreviewPanel())}},getSearchWidget:function(){return _.getSearchWidget(this.getOption("widget_id"))},onhistorySearchSelect:function(t){var i=this;if(e.is(t)&&e.is(t.SNtype)&&e.is(i._historySearch)){"Children"===t.SNtype&&(i.getSNSkeleton()._searchActions.dispatchEvent("onDisplayRelations",t),_.setContentVisibility(t));var n=function(){_.setContentVisibility("Search");var t=i.getSNSkeleton();t&&(t.getCollection()._resetState(),t.getCollection().reset(),t.getCollection().initTreeDocument(),t._updateWidgetTitleWithNbResult()),e.is(i._taggerProxy.clearLocalFilter,"function")&&i._taggerProxy.clearLocalFilter(),e.is(i._taggerProxy.clearLocalGrouping,"function")&&i._taggerProxy.clearLocalGrouping(),i._taggerProxy.unsetTags()};"Search"===t.SNtype&&e.is(t.searchParam)?(_.setContentVisibility(t),t.searchParam.fromSearchHistory=!0,i.onSearch(t.searchParam)):"Explore"===t.SNtype?(_.setContentVisibility(t),i._historySearch.ShowContainers(t)):"Relational"===t.SNtype?(_.setContentVisibility(t),i._historySearch.ShowContainers(t)):"Select"===t.SNtype?(n(),b.getRelations({model:t.model,onComplete:function(e){e.contextid=t.contextid,e.widgetAppId=t.widgetAppId,i._historySearch.stopCreation(!1),i._historySearch.addRelationsModel(e)},onFailure:function(){i._historySearch.stopCreation(!1)}})):""===t.SNtype&&n()}},onAddSearchBox:function(t){if(e.is(t)){if(e.is(this.options)&&e.is(this.options.search_options)&&e.is(this._historySearch)){var i=this.options.search_options,n=!0,s=!1,o=!1;e.is(i.fromSearchHistory)&&!0===i.fromSearchHistory&&(n=!1,this.options.search_options.fromSearchHistory=!1,e.is(i.refineSearch)&&!0===i.refineSearch&&(s=!0,n=!0,this.options.search_options.refineSearch=!1));var a=this._taggerProxy.getCurrentFilter();if(e.is(a,"object")&&e.is(a.allfilters,"object")&&0<Object.keys(a.allfilters).length&&(o=!0),!0===n){var r,l=_.getSearchWidget(this.getOption("widget_id"));if(e.is(l)&&(r=l.context,j.getItem("integratedSearch"))){var c=l.getValue("launch_mode");e.is(l.data)&&!e.is(l.data.pinToDashboard)&&c!==_.widgetLaunchMode.PINNED&&(r="RightPanelContext"),c!==_.widgetLaunchMode.COMPASS_TRANSIENT&&c!==_.widgetLaunchMode.COMPASS_PINNED&&c!==_.widgetLaunchMode.INCONTEXT_TRANSIENT||(r="")}var d=i.search_criteria_to_display;void 0===d&&(d="#myContent"===i.search_criteria?I.get("myContentTitle"):"#myRecentContent"===i.search_criteria?I.get("searchInMyRecentContent"):"#advancedSearch"===i.originalSearchCriteria?I.get("adv_search_launch"):"#favoriteSearches"===i.search_criteria?I.get("my_fav_searches"):i.search_criteria);var u={description:d+" "+t+" results",searchParam:e.clone(i),widgetAppId:this.getOption("widget_id"),contextid:r,refine:s,count:t,filter:o};this._historySearch.addSearchModel(u)}}}},onExploreAction:function(t){if(e.is(this._historySearch)&&e.is(t)&&e.is(t.model)){var i,n=_.getSearchWidget(this.getOption("widget_id"));e.is(n)&&(i=n.context),{description:t.model._attributes["ds6w:label"],widgetAppId:t.widgetAppId,contextid:i};var s=null;"whereUsed"===t.action_id?s=this._historySearch.addRelationalModel(null):"config_explore"===t.action_id&&(s=this._historySearch.addExploreModel(null)),e.is(s)&&(t.historyNode=s)}},onSelected_obj:function(){if(e.is(this._historySearch)){var t={},i=0,n=null;e.is(arguments)&&1===(i=arguments.length)&&(n=arguments[0]),t.size=i,t.itemModel={},null!==n&&(t.itemModel.label=n.get("ds6w:label"),t.itemModel.id=n.id,t.itemModel.model=n),this._addNavHistorySelectBox(t)}},_addNavHistorySelectBox:function(t){var i=this;if(e.is(i._historySearch)&&e.is(t)){var n,s=_.getSearchWidget(i.getOption("widget_id"));e.is(s)&&(n=s.context);var o=null,a=0;if(e.is(t.size)&&1===(a=t.size)&&e.is(t.itemModel)&&(o=t.itemModel),null!==o){var r=o.label,l={description:r,contextid:n,id:o.id,model:o.model,widgetAppId:i.getOption("widget_id")};void 0!==i._historySearch.addSearchSelectModel(l)&&(i._historySearch.stopCreation(!0),b.getRelations({model:o.model,onComplete:function(e){e.contextid=n,e.widgetAppId=i.getOption("widget_id"),e.model.fromApp=!0,e.model.displayName=r,i._historySearch.stopCreation(!1),i._historySearch.addRelationsModel(e)},onFailure:function(){i._historySearch.stopCreation(!1)}}))}else a>1?i._historySearch.addSearchSelectModel(a):i._historySearch.removeLastSelectNode()}},onPinToDashboardAction:function(){var t=this,i=t.getSNSkeleton();if(e.is(i)){var n=_.getSearchWidget(t.getOption("widget_id"));if(e.is(n)){var s={widgetIdOrUrl:n.uwaUrl,widgetAppId:_.SEARCH_APP_ID,widgetTitle:i.getTitle(),widgetId:t.getOption("widget_id"),widgetData:n.data,success:function(){t._searchcom_socket&&t._searchcom_socket.dispatchEvent("hideSidePanel")}};_.pinToDashboard(s)}}},setActiveTenant:function(t){if(e.is(this._resources)&&e.is(this._resources.setActiveTenant,"function"))try{this._resources.setActiveTenant(t)}catch(e){A.log("SearchRessources.setActiveTenant throw !")}},clearfilterbyclosesidepanel:function(){let t=this.getSNSkeleton();if(t){let i=t.getCurrentView();i&&e.is(i.CloseSidePanel,"function")&&i.CloseSidePanel()}e.is(this._taggerProxy)&&e.is(this._taggerProxy.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter(),e.is(this._taggerProxy)&&e.is(this._taggerProxy.clearLocalGrouping,"function")&&this._taggerProxy.clearLocalGrouping(),this.embeddedTaggerTags=null,this.getRefineHelpers().hideGlobeView(),this.getSNSkeleton().switchOnView(j.getItem("LastSearchViewMode"))},manageActionIconOnSidePanel:function(t){if(e.is(this.elements)&&e.is(this.elements.container)){var i=!1;if(e.is(this.skeleton)&&(i="true"!==this.skeleton.getOption("transient_context")&&!0!==this.skeleton.getOption("transient_context")),!0!==i){var n=_.getSearchWidget(this.getOption("widget_id"));if(e.is(n)&&e.is(n.getView,"function")&&(!e.is(n.getView().type)||"sidepanel"===n.getView().type)&&e.is(t)&&e.is(t.position)){var s=t.position;"fitted"===s||"maximized"===s?this.updateDimension(-1):this.updateDimension();let i=this.getSNSkeleton();if(i){let t=i.getCurrentView();t&&e.is(t.manageDisplayChannelView,"function")&&t.manageDisplayChannelView(s)}}}}},navhistorycontextifcreateaNewTab:function(){var t=!1;return e.is(this._historySearch)&&(t=this._historySearch.navhistorycontextifcreateaNewTab()),t},getOneSearchPreviewAction:function(){var t=null;return e.is(this.elements)&&e.is(this.elements.onesearchactionspreview)&&(t=this.elements.onesearchactionspreview),t},_taggerClearLocalFilter:function(t){return!!e.is(this._taggerProxy)&&(e.is(this._taggerProxy.clearLocalFilter,"function")&&this._taggerProxy.clearLocalFilter(),e.is(this._taggerProxy.clearLocalGrouping,"function")&&this._taggerProxy.clearLocalGrouping(),!0===t&&this._taggerProxy.unsetTags(),!0)},dispatchOnTitleUpdate:function(t){if(e.is(this.getOption("getTabID"),"function"))this.dispatchEvent("onTitleUpdate",t);else{let i=e.extendElement(document.body).getElement("span#divSearchHeadDescription");e.is(i)&&i.setText(I.get("AppName")+" - "+t.panelTitle)}},maskContainer:function(){e.is(this.elements.container)&&!1===V.isMasked(this.elements.container)&&V.mask(this.elements.container)},unmaskContainer:function(){this.elements.container&&V.unmask(this.elements.container)},backToMultiView:function(t){let i,n=this,s=n.getSNSkeleton();if(!s||t===s.getCurrentView().id){if(s.updateCounterView(s.getCurrentView()&&s.getCurrentView()._totalCount),"where"===t&&e.is(n.getRefineHelpers().globeViewContainerContent))i=n.oRefineHelpers.getRefineHelpers().globeViewContainerContent.back();else{let t=s.getCurrentView();t&&e.is(t.clickOnBack,"function")&&t.clickOnBack()}return i}},clickOnTitleMultiView:function(t,i){let n=this;"where"===t&&e.is(n.oRefineHelpers.getRefineHelpers().globeViewContainerContent)&&n.getRefineHelpers().globeViewContainerContent.clickOnTitleMultiView(i)},getSelectedItems:function(){return this._selected_objects},getSelectedItemsCount:function(){return this.getSelectedItems().length},_listenBroadcast:function(){let t=this;e.is(this._BroadcastchannelManager)&&this._BroadcastchannelManager.destroy(),e.is(this._BroadcastchannelManager)&&delete this._BroadcastchannelManager,this._BroadcastchannelManager=null,require(["DS/SNResultUX/utils/BroadcastchannelManager"],function(e){let i={embeddedTaggerContent:t.embeddedTaggerContent,embeddedTaggerContainer:t.embeddedTaggerContainer,resultMgt:t};t._BroadcastchannelManager=new e,t._BroadcastchannelManager.setup(i),t._BroadcastchannelManager.listenBroadcast(i)})},_manageEmbeddedTaggerView:function(t){let i=this;if(e.is(i.embeddedTaggerContainer))if(t)i.embeddedTaggerContainer.setStyle("display","none");else{i.embeddedTaggerContainer.setStyle("display","block");let t=e.extendElement(i.embeddedTaggerContainer.querySelector(".embedded-tagger-view"));e.is(t)&&t.setStyle("display","block")}}})}),define("DS/SNResultUX/SearchTab",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Mask","DS/SNInfraUX/SearchDebug","DS/Controls/TooltipModel","DS/SNResultUX/SNResultMgt"],function(e,t,i,n,s,o){"use strict";return t.extend(n,{uwaClassName:"DS/SNResultUX/SearchTab",name:"onesearch_results_tab",_snResultMgt:null,_onActivateEvents:null,init:function(e){this._parent(e),this._onActivateEvents={}},destroy:function(){this._snResultMgt=null,this._onActivateEvents=null,this._parent(),this.options=null},render:function(t){var n=this;if(i.mask(this.getOption("renderTo")),e.is(t,"object")){var s=null;e.is(t.events)&&e.is(t.events.onReady,"function")&&(s=e.clone(t.events.onReady));let a={};for(let i in t.events)a[i]=e.clone(t.events[i]);t.getTabID=function(){return n.getTabID()},t.isTabBarVisible=function(){return n.getOption("wuxTabBar").visibleFlag},t.getTabOption=function(e){return n.getOption(e)},t.setTabOption=function(e,t){n.setOption(e,t)},t.getContainer=function(){return n.getOption("renderTo")};for(let i in t.events)"onReady"!==i&&(a[i]=e.clone(t.events[i]),t.events[i]=function(){n._snResultMgt=this,e.is(a[i])&&a[i].call(this)});t.events.onReady=function(){n._snResultMgt=this,n.onActivate(),n.setIcon(n._snResultMgt.getTabIcon()),i.unmask(n.getOption("renderTo")),e.is(s)&&s.call(this),n.dispatchEvent("onTabReady")},t.events.onTitleUpdate=function(e){n.setTitle(e.tab_title),n.setTooltip(e.tab_tooltip),n.dispatchEvent("updateWidgetTitle",e.panelTitle),n.setOption("panelTitle",e.panelTitle)},t.searchWidget=t.search_widget,this.elements.container=new o(t)}return this},setTitle:function(e){var t=this.getOption("wuxTab");this.getOption("wuxTabBar").updateTab(t.value,{label:e})},getTabID:function(){var t=this.getOption("wuxTab");if(e.is(t))return t.value},setTooltip:function(e){var t=this.getOption("wuxTab"),i=this.getOption("wuxTabBar");t.tooltipInfos?t.tooltipInfos.shortHelp=e:t.tooltipInfos=new s({shortHelp:"",mouseRelativePosition:!0,isEmpty:function(){return this.shortHelp.length>0},allowUnsafeHTMLTitle:i.allowUnsafeHTMLOnTabButton,allowUnsafeHTMLShortHelp:i.allowUnsafeHTMLOnTabButton,allowUnsafeHTMLLongHelp:i.allowUnsafeHTMLOnTabButton})},setIcon:function(e){var t=this.getOption("wuxTab");this.getOption("wuxTabBar").updateTab(t.value,{icon:e})},setActiveTenant:function(e){this._snResultMgt&&this._snResultMgt.setActiveTenant(e)},getActiveTenant:function(){if(this._snResultMgt)return this._snResultMgt.getActiveTenant()},getTabType:function(){},getTabView:function(){return this._snResultMgt},getTaggerProxy:function(){if(e.is(this._snResultMgt))return this._snResultMgt._taggerProxy},getAdvSearchMgr:function(){if(e.is(this._snResultMgt)&&e.is(this._snResultMgt.getSNSkeleton,"function")&&e.is(this._snResultMgt.getSNSkeleton().getAdvSearchMgr,"function"))return this._snResultMgt.getSNSkeleton().getAdvSearchMgr()},showAdvancedSearch:function(t){if(e.is(this._snResultMgt))return this._snResultMgt.showAdvancedSearch(t)},hideAdvancedSearch:function(){if(e.is(this._snResultMgt))return this._snResultMgt.hideAdvancedSearch()},onActivate:function(){if(this._snResultMgt){for(var t in this.getOption("renderTo").setContent(this._snResultMgt),this._snResultMgt.OnTabActivated(),this._onActivateEvents)switch(t){case"unsetShading":this._snResultMgt.setShadings([{color:"initial",criteria:function(){return!0}}]);break;case"refresh":this.onRefresh()}delete this._onActivateEvents,this._onActivateEvents={}}var i=this.getOption("panelTitle");e.is(i,"string")||(i=this.getOption("wuxTab").label),this.dispatchEvent("updateWidgetTitle",i),this.dispatchEvent("onTabActivated")},onDeactivate:function(){this._snResultMgt&&this._snResultMgt.OnTabDeactivated()},onRemoval:function(){this._snResultMgt&&this._snResultMgt.OnTabRemoved()},updateOnActivate:function(t){if(e.is(t,"object"))for(var i in t)this._onActivateEvents[i]=t[i]},setSensitivity:function(e){this.getOption("wuxTab").disabled=!e},onSearch:function(t){e.is(this._snResultMgt)&&(this._snResultMgt.onSearch(t),this.setIcon(this._snResultMgt.getTabIcon()))},onRefresh:function(){e.is(this._snResultMgt)&&this._snResultMgt.refreshSearch()},onKeyboardEvent:function(t){e.is(this._snResultMgt)&&this._snResultMgt.onKeyboardEvent(t)},navhistorycontextifcreateaNewTab:function(){var t=!1;return e.is(this._snResultMgt)&&(t=this._snResultMgt.navhistorycontextifcreateaNewTab()),t}})}),define("DS/SNResultUX/SNTabbedResultMgt",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Class/Collection","UWA/Class/Model","UWA/Element","DS/UIKIT/Tooltip","DS/PubSub/PubSub","DS/MessageBus/MessageBus","DS/SNInfraUX/SearchCom","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","css!DS/SNResultUX/SNResultUX","DS/SNResultUX/SearchTab","DS/SNResultUX/views/utils/SearchHeaderCmd","DS/SNInfraUX/SearchRessources","DS/SNInfraUX/PredicatesNLS","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/Controls/TabBar","DS/SNInfraUX/SearchPreferences"],function(e,t,i,n,s,o,a,r,l,c,d,u,h,g,p,_,f,m,v,S,w,b){"use strict";let C=o.extend({idAttribute:"tabID"});return t.extend(i,n,u,{uwaClassName:"DS/SNResultUX/SNTabbedResultMgt",name:"onesearch_tabbed_results",_tabContainer:null,_disableTabbedUI:!1,_currentTabContent:null,_searchcom_socket:null,_tabs:null,_valueOfCurrentTab:null,_tabIDCounter:null,_first_search_COMPASS_TRANSIENT:null,_messagingChannel:null,_subscriptions:null,_keydownEventHandler:null,_headersSearch:null,_originalEvts:{},init:function(t){this._parent(t),this._tabIDCounter=0,this._first_search_COMPASS_TRANSIENT=!1,this._messagingChannel="3DSearch-TabManager-"+t.widget_id,this._subscriptions={},this._keyboardEventsSubscription=!1;let i=this;this._searchcom_socket=d.createSocket({socket_id:"widget_tabMgt_"+this.getOption("widget_id"),widgetId:this.getOption("widget_id")}),v.setResources({resources:new m(this.getOption("resources"))});let n=this.getOption("launch_mode");if(this._disableTabbedUI=!0!==b.getItem("search_tabbed_ui")||e.is(n,"string")&&(n===g.widgetLaunchMode.COMPASS_PINNED||n===g.widgetLaunchMode.PINNED||n===g.widgetLaunchMode.COMPASS_TRANSIENT||n===g.widgetLaunchMode.INCONTEXT_TRANSIENT),n!==g.widgetLaunchMode.PINNED&&n!==g.widgetLaunchMode.COMPASS_PINNED&&this._subscribeToKeyboardEvents(),!e.is(this.elements.container)){let e=this.getClassNames();e.replace(" ","_"),this.elements.container=a.create("div",{class:this.getClassNames(),"data-rec-id":e,styles:{position:"relative",height:"100%"}}),this.elements.container.addClassName(this.getOption("css_view_class"))}let o=g.identifyClientInfo();if(h.getOption("ShowSearchTitleHeader")&&"3DSwym"===o.identifier){this._titleBar=a.create("div",{class:"searchHeader"}),this._titleArea=a.create("span",{class:"searchHeader__title"}),this._titleTextArea=a.create("span",{class:"searchHeader__title__text"}),this._titleBar.inject(this.elements.container),this._titleArea.inject(this._titleBar),this._titleTextArea.inject(this._titleArea),l.add("search:titleUpdate",function(e){i._titleTextArea.setText(e)}),this._closeArea=a.create("span",{class:"close fonticon fonticon-cancel",styles:{right:"0px",position:"absolute"},events:{click:function(){l.dispatch("search:closeRequested")}}});new r({position:"left",target:this._closeArea,body:S.get("closeButton")});this._closeArea.inject(this._titleArea)}if(this._tabContainer=new w({displayStyle:["strip"],centeredFlag:!1,newTabButtonFlag:!0,editableFlag:!1,multiSelFlag:!1,reorderFlag:!1,touchMode:!0,closeButtonFlag:!0,showComboBoxFlag:!0,allowUnsafeHTMLOnTabButton:!1}),this._tabContainer._endEditTab=function(){},this._tabContainer._editTab=function(e){let t=this.getButtonFromValue(e);this.closeButtonFlag&&t.elements._closeButton&&t.elements._closeButton.hide(),this.modelEvent.publish({event:"editTab",data:{value:e}}),this.fire("edit",{value:e})},this._subscribeToGlobal3DSearchMessageChannel(),this._tabContainer.inject(this.elements.container),this._tabs=new s([],{model:C}),this._currentTabContent=a.create("div",{styles:{position:"relative",height:"100%",width:"100%"}}),this._currentTabContent.inject(this.elements.container),!0===this._disableTabbedUI?this.hideTabBar():this.showTabBar(),!0===b.getItem("nav_history")){let e=this._tabContainer.getContent();if(e){let t=e.getElementsByClassName("wux-controls-tabBar-buttonsContainer");null!==t&&(i._headersSearch=new f,i._headersSearch.render(t[0]),i._headersSearch.addEvent("onInformationPanelAction",function(){let e=i.getActiveTab();if(e&&null!==e._snResultMgt){let t=!1;t=e._snResultMgt.getSNSkeleton().ActivateDeactivateInformationsPanel(),e._snResultMgt.manageInformationPanel(t)}}),i._headersSearch.addEvent("onHistoryAction",function(){let e=i.getActiveTab();e&&null!==e._snResultMgt&&e._snResultMgt.managehistoryPanel(!0)}))}}this._registerTabEventHandlers()},_subscribeToGlobal3DSearchMessageChannel:function(){let t=!1;t="true"!==this.getOption("transient_context")&&!0!==this.getOption("transient_context");let i=e.is(this.getOption("swymContext"))&&this.getOption("swymContext"),n=this;this.isTabBarVisible()&&(this._subscriptions.addTab=c.subscribe({channel:this.getMessagingChannel(),topic:"addTab",callback:this.addTab.bind(this)})),this._subscriptions.activateInContextSearch=c.subscribe({channel:this.getMessagingChannel(),topic:"activateInContextSearch",callback:this._onActivateInContextSearch.bind(this)}),this._subscriptions.deactivateInContextSearch=c.subscribe({channel:this.getMessagingChannel(),topic:"deactivateInContextSearch",callback:this._onDeactivateInContextSearch.bind(this)}),t&&!i||(this._subscriptions["GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID:activateInContextSearch"]=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"activateInContextSearch",callback:this._onActivateInContextSearch.bind(this)}),this._subscriptions["GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID:deactivateInContextSearch"]=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"deactivateInContextSearch",callback:this._onDeactivateInContextSearch.bind(this)}),this._subscriptions["GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID:sidePanelClosed"]=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"sidePanelClosed",callback:this._onDeactivateInContextSearch.bind(this)})),this._subscriptions.updateSidePanelStatus=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"updateSidePanelStatus",callback:function(e){n.setOption("sidePanelClosed",e.sidePanelclosed)}}),this._subscriptions.manualSwitchToView=c.subscribe({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"manualSwitchToView",callback:function(e){n.getActiveTab().getTabView().getSNSkeleton().switchOnView(e.view)}})},destroy:function(){let t=void 0,i=this._getTabView();e.is(i)&&(t=i.getOption("in_apps_search")),this._searchcom_socket.dispatchEvent("onCloseTransient",{in_apps_search:t});for(let e=0;e<this._tabs.length;e++){this._tabs.at(e).get("tab").destroy()}this._tabs.reset(),this._tab=null;for(let e in this._subscriptions)c.unsubscribe(this._subscriptions[e]);if(this._unsubscribeToKeyboardEvents(),!1===g._isSearchWidgetTransientAvailable(this.getOption("widget_id"))){let e="windowed"===this.getOption("css_view_class");!0===g.isTaggerOpenedByCode()&&!1===e&&this._searchcom_socket.dispatchEvent("closeTagger")}this._searchcom_socket.disconnect(),d.deleteSocket(this._searchcom_socket.id),this._tabContainer.destroy(),this._tabContainer=null,this.options=null,this._parent()},getMessagingChannel:function(){return this._messagingChannel},addTab:function(t){if(e.is(t)&&e.is(t.search_ux_options)&&e.is(t.search_ux_options.events))for(let i in t.search_ux_options.events)this._originalEvts[i]&&(this._originalEvts[i+"BACKUP"]=e.clone(this._originalEvts[i])),this._originalEvts[i]=e.clone(t.search_ux_options.events[i]);let i=this._tabContainer.getTabCount();!0===this._disableTabbedUI&&i>1&&this.removeTab(this.getActiveTab().getTabID());let n=this,s=this._generateTabID();0===i&&(this._valueOfCurrentTab=s);let o=this._tabContainer.add({label:e.is(t.tabTitle,"string")?t.tabTitle:"",isSelected:!0,icon:{iconName:"search",fontIconFamily:1},allowClosableFlag:0!==i,value:s});return this._setMinmumTabWidth(o),this._addCommonOptions(t.search_ux_options),t.search_ux_options.updateContainerClass=((e,t)=>{g.isFUN109031Active()&&(!0===t?this.elements.container.removeClassName(e):this.elements.container.addClassName(e))}),this._tabs.add(new C({tabID:s,tab:new _({wuxTab:o,wuxTabBar:n._tabContainer,renderTo:this._currentTabContent,events:{updateWidgetTitle:function(t){let i=n.getOption("updateTitle");e.is(i,"function")&&i(t)}}}).render(t.search_ux_options)})),l.dispatch("search:addTab"),this.getTabByID(s)},_addCommonOptions:function(t){e.is(t.widget_id)||(t.widget_id=this.getOption("widget_id")),t.css_view_class=e.is(t.css_view_class)?t.css_view_class:this.getOption("css_view_class"),t.pinToDashboard=this.getOption("pinToDashboard"),e.is(t.resources)||(t.resources=this.getOption("resources")),e.is(t.source)||(t.source=this.getOption("source")),e.is(t.itemViewClickHandler)||(t.itemViewClickHandler=this.getOption("itemViewClickHandler")),e.is(t.update_preference)||(t.update_preference=this.getOption("update_preference")),e.is(t.tagger_context_id)||(t.tagger_context_id=this.getOption("tagger_context_id")),e.is(t.resetOriginalOptions)||(t.resetOriginalOptions=this.getOption("resetOriginalOptions")),t.addinMode=this.getOption("addinMode"),t.transient_context=this.getOption("transient_context"),t.use_preexisting_call=this.getOption("use_preexisting_call"),t.events=e.clone(this._originalEvts)},onSearch:function(t){if(g.widgetLaunchMode.COMPASS_TRANSIENT===this.getOption("launch_mode")&&!1===this._first_search_COMPASS_TRANSIENT&&(this._first_search_COMPASS_TRANSIENT=!0,!0===b.getItem("search_tabbed_ui")&&(this._disableTabbedUI=!1,this.showTabBar(),e.is(this._subscriptions.addTab)||(this._subscriptions.addTab=c.subscribe({channel:this.getMessagingChannel(),topic:"addTab",callback:this.addTab.bind(this)})))),t.fromTopbar=!0,e.is(t)&&e.is(t.addNewTab)&&!0===t.addNewTab){let e=this;e.addTab({search_ux_options:{events:{onReady:function(){e.getActiveTab().onSearch(t)}}}})}else this.getActiveTab().onSearch(t)},onRefresh:function(){this.getActiveTab().onRefresh()},_onViewChange:function(t){e.is(t.previous)&&e.is(t.previous.type)&&this.elements.container.removeClassName(t.previous.type),this.elements.container.addClassName(t.type),"maximized"===t.type?this._subscribeToKeyboardEvents():this._unsubscribeToKeyboardEvents()},getActiveTab:function(){if(e.is(this._tabContainer))return this.getTabByID(this._valueOfCurrentTab?this._valueOfCurrentTab:"3DSearch-tab-1")},getTabByID:function(t){let i=this._tabs.get(t);if(e.is(i))return i.get("tab")},_generateTabID:function(){return++this._tabIDCounter,"3DSearch-tab-"+this._tabIDCounter},isTabBarVisible:function(){return this._tabContainer.visibleFlag},hideTabBar:function(){this._tabContainer.visibleFlag=!1,this._tabContainer.elements.container.addClassName("hidden"),e.is(this._currentTabContent)&&this._currentTabContent.setStyle("height","100%")},showTabBar:function(){if(!1===this._disableTabbedUI&&(this._tabContainer.visibleFlag=!0,this._tabContainer.elements.container.removeClassName("hidden")),-1!==["iphone","ipad","android"].indexOf(g.getDeviceCategory())){let t=e.extendElement(this._tabContainer.getContent()).getBoundingClientRect(),i=44;e.is(t,"object")&&t.height>15&&(i=t.height),e.is(this._currentTabContent)&&this._currentTabContent.setStyle("height","calc(100% - "+i+"px)")}},removeTab:function(e){this._onRemoveTabHandler({value:e}),this._tabContainer.removeTab(e)},_getTabView:function(t){let i=null;if(i=e.is(t,"string")?this.getTabByID(t):this.getActiveTab(),e.is(i))return i.getTabView()},_getAllTabs:function(){if(e.is(this._tabs))return this._tabs.toArray()},_setMinmumTabWidth:function(t){let i=h.getOption("miminumTabWith");(!e.is(i,"number")||i>300)&&(i=100),t.minWidth=i},_onPreNewTabHandler:function(e){let t=this._tabContainer.getButtonFromValue(e.value);this._setMinmumTabWidth(t);let i=this._generateTabID();t.value=i,t.label=S.get("newTabTitle"),this._tabContainer.newTabButtonFlag=!1},_onNewTabHandler:function(t){let i=this,n=this._tabContainer.getValueByIndex(t.index),s=this._tabContainer.getButtonFromValue(n);this._tabContainer.updateTab(n,{allowClosableFlag:!0});for(let t in this._originalEvts)this._originalEvts[t+"BACKUP"]&&(this._originalEvts[t]=e.clone(this._originalEvts[t+"BACKUP"]),delete this._originalEvts[t+"BACKUP"]);let o={search_options:{search_mode:"index",refresh:!1},events:{}};this._addCommonOptions(o),this._tabs.add(new C({tabID:n,tab:new _({wuxTab:s,wuxTabBar:i._tabContainer,isNewTab:!0,renderTo:this._currentTabContent,events:{updateWidgetTitle:function(t){let n=i.getOption("updateTitle");e.is(n,"function")&&n(t)},onTabReady:function(){i._tabContainer.newTabButtonFlag=!0}}}).render(o)}))},_onRemoveTabHandler:function(t){let i=this.getTabByID(t.value);e.is(i)&&(i.onRemoval(),i.destroy()),this._tabs.remove(t.value)},_onSelectTabHandler:function(t){let i=this._tabContainer.getValueByIndex(t.index),n=this._valueOfCurrentTab,s=this.getTabByID(i),o=this.getTabByID(n);if(this._valueOfCurrentTab=i,e.is(o)&&e.is(o._snResultMgt,"object")&&e.is(o._snResultMgt.getSNSkeleton,"function")){let t=o._snResultMgt.getSNSkeleton();if(e.is(t)&&e.is(t.getPreviewStatus,"function")&&t.getPreviewStatus()&&e.is(t.getPreviewPanel,"function")){let i=t.getPreviewPanel();e.is(i)&&e.is(i._exitPreview,"function")&&e.is(o._snResultMgt._onExitPreviewModeRequest,"function")&&o._snResultMgt._onExitPreviewModeRequest()}}e.is(o)&&o.onDeactivate(),e.is(s)&&s.onActivate(),1===this._tabContainer.getTabCount()?this._tabContainer.updateTab(i,{allowClosableFlag:!1}):this._tabContainer.updateTab(n,{allowClosableFlag:!0})},_onContextualMenuEventHandler:function(e){let t=this;e.menu.push({type:"PushItem",title:S.get("closeOtherTabs"),action:{callback:function(){t._closeOtherTabs(t._valueOfCurrentTab)}}})},_registerTabEventHandlers:function(){this._tabContainer.onPreNewTab(this._onPreNewTabHandler.bind(this)),this._tabContainer.onNewTab(this._onNewTabHandler.bind(this)),this._tabContainer.onRemoveTabEvent(this._onRemoveTabHandler.bind(this)),this._tabContainer.onSelectTab(this._onSelectTabHandler.bind(this)),this._tabContainer.onContextualMenuEvent(this._onContextualMenuEventHandler.bind(this))},_closeOtherTabs:function(e){let t=[];for(let i=0;i<this._tabs.length;i++){let n=this._tabs.at(i).get("tabID");e!==n&&(t.push(n),this._tabContainer.removeTab(n))}for(let e=0;e<t.length;e++)this._onRemoveTabHandler({value:t[e]});1===this._tabContainer.getTabCount()&&this._tabContainer.updateTab(e,{allowClosableFlag:!1})},setActiveTenant:function(t){let i=this.getOption("resources");if(e.is(i)&&(i.active_tenant=t.value),!1!==t.update_tab){let i=this.getActiveTab();e.is(i)&&i.setActiveTenant(t.value)}},getActiveTaggerProxy:function(){let t=this.getActiveTab();if(e.is(t))return t.getTaggerProxy()},getActiveAdvSearchMgr:function(){let t=this.getActiveTab();if(e.is(t))return t.getAdvSearchMgr()},_isCV5OpenUsage:function(){return"catiav5"===this.getOption("addinMode")&&!0===h.getOption("lockedapp")},_subscribeToKeyboardEvents:function(){if(!e.is(this._keydownEventHandler,"function")){let t=this;this._keydownEventHandler=function(i){let n=t.getActiveTab();e.is(n)&&n.onKeyboardEvent(i)},UWA.Element.addEvent.call(document,"keydown",this._keydownEventHandler)}},_unsubscribeToKeyboardEvents:function(){e.is(this._keydownEventHandler,"function")&&(UWA.Element.removeEvent.call(document,"keydown",this._keydownEventHandler),delete this._keydownEventHandler)},_onActivateInContextSearch:function(t){let i=this,n=function(){c.publish({channel:i.getMessagingChannel(),topic:"InContextInit",data:{}}),c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"InContextInit",data:{}})},s=void 0,o=e.is(this.getOption("addinMode"),"string")&&this.getOption("addinMode").length>0,a=e.is(t)&&"furtive"!==t.mode&&"socket_id_#saved_search_edit#"===t.app_socket_id;return o?n():s=this.addTab({tabTitle:e.is(t)&&e.is(t.title,"string")?t.title:"",search_ux_options:{widget_id:this.getOption("widget_id"),resources:this.getOption("resources"),css_view_class:"maximized",in_apps_search:t,search_widget:this.getOption("search_widget"),events:{onReady:function(){n()}}}}),a||this.hideTabBar(),s},_onDeactivateInContextSearch:function(t){let i=this.getActiveTab();if(e.is(i)){let n=i.getTabView();if(e.is(n)&&n.getOption("in_apps_search")){let s=n.getOption("in_apps_search");this._searchcom_socket.dispatchEvent("onInContextSearchDeactivated",{in_apps_search:s});let o=i.getTabID();!0===t.bComeFromSidePanelCloseEvent&&this._closeOtherTabs(o),this.removeTab(o),c.publish({channel:"searchView",topic:"deactivateInContextSearch",data:{in_apps_search:s}});for(let t in this._tabs._models)e.is(this._tabs._models[t]._attributes.tab.elements.container.options.in_apps_search)&&this._tabs._models[t]._attributes.tab.elements.container.options.in_apps_search.app_socket_id===s.app_socket_id&&this.removeTab(this._tabs._models[t].id);!0===b.getItem("search_tabbed_ui")&&(this._disableTabbedUI=!1),this.showTabBar();let a=!e.is(this.getOption("sidePanelClosed"))||!0===this.getOption("sidePanelClosed");!0!==t.bCloseSidePanel&&null!=t.bCloseSidePanel||!a||c.publish({channel:"GLOBAL_3DSEARCH_MESSAGE_CHANNEL_ID",topic:"closeRightPanel"})}}},navhistorycontextifcreateaNewTab:function(){let t=!1;!1===b.getItem("integratedSearch")&&(t=!1);let i=this.getActiveTab();return e.is(i)&&(t=i.navhistorycontextifcreateaNewTab()),t}})});