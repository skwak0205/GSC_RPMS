function RequirementStructureBrowser(e){var t={v1:{ap_custo:"ap_custo",ap_root_pids:"ap_root_pids",ap__root_pids_detached:"ap__root_pids_detached"}},n={widget:null,pad_app:null,home_app:null,paddebug:!1,lastStatus:{timer:null},setting_names:t.v1,enoreq_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,ReqTypesPrefOptions:null,layout:{title_update:!0,view_customization:null,store_roots_in_pref:!0,slidder:!1,root_panel:!0,drop_invite:"dynamic",padshell:!1},settings:null,authorize_setStructure:!0,authorizeChangeControl:!1},closeActionbarOnStartup:!1,init:function(e){this.pcsPrefix=widget.id+"_"+widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),this.widget=e.widget,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this))},onRefresh:function(){"StructureEditor"===this.active_view?this.req_component._onWidgetRefresh():this.trmModelEvents.publish({event:"welcome-panel-action-selected",data:{id:this.active_view}})},onLoad:function(){var e=this;localStorage.removeItem("PADTreeListDefinition.ENORERE_AP"),window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload"),require(["DS/PADUtils/Configuration","text!DS/RequirementStructureBrowser/assets/ENOREQComponentConf.json"],function(n,i){var r=JSON.parse(i);n.mergeConfig(r),require(["text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","UWA/Core","DS/PADUtils/PADSession","text!DS/RequirementStructureBrowser/assets/enoreq_settings.json","DS/HomePage/HomePage","text!DS/RequirementStructureBrowser/assets/ENOREQ.2D.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOTRMApp.json","DS/PADUtils/views/PADAlert"],function(n,i,r,o,s,a,l,c,d,u,p){window.top.performance.mark(e.pcsPrefix+"_require_infra_padutils"),window.top.performance.measure(e.pcsPrefix+"_require_infra",e.pcsPrefix+"_onload",e.pcsPrefix+"_require_infra_padutils");var h=JSON.parse(l),f=JSON.parse(n);JSON.parse(d);r.setApp(h.padsettings,"enoreq",!0),r.with_security_context=!0,e.widget.mergePreferences(r.getWidgetPreferences()),e.widget.addEvent("endEdit",e.onPreferencePanelClose.bind(e)),r.updateWidgetPreferences(),r.setSetting("add_objects_when_select",!1),r.setSetting("open_in_v5_v2",!1),r.setSetting("newCtxMenu",!0),r.setSetting("EditModeActivated",!0),r.setSetting("expandAllwithApplyFilter",!0),r.setSetting("local_preferences_file",{module:"ENOREQComponent",file:"ENOREQ.2D.json"}),r.setSetting("authorized_find_in_ctx_types",["Requirement Specification","Requirement","Chapter","Comment"]),r.setSetting("FedDictionnaryAccess",!1);r.setSetting("changeControlActivation",!0),r.setSetting("changeControlPosition","bottom-right");e.ReqTypesPrefOptions={types:f.Customized_types},e.widget.getValue("x3dSharedId")||e.widget.getValue("x3dAppId")||e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"REQ_appId"}),e.widget.addPreference({name:"AddObjectOnReviseDuplicate",defaultValue:!0,type:"boolean",label:u.AddRevised_DuplicatedRootObject});var g=e._initializeENOREQComponent.bind(e);if(e.setting_names=t.v1,void 0===e.req_app){var m=e.enoreq_opts;m.x3dAppId=e.widget.getValue("x3dAppId"),m.widget=e.widget,m.lang=e.widget.lang,m.active_view=e.widget.getValue("default_view")?e.widget.getValue("default_view"):"treelistview",m.settings=h,m.layout.padshell=!0,r.setSetting("authorizeChangeControl",!1),m.authorizeChangeControl=!1,g(m)}})})},onDestroy:function(){this.pad_app.destroy()},onPreferencePanelClose:function(){var e=require("DS/PADUtils/PADSettingsMgt");e.updateWidgetPreferences.bind(e);var t=self.widget.getPreferences();if(widget.hasOwnProperty("data")&&widget.data.hasOwnProperty("trm_security_ctx")){var n=require("DS/TraceableRequirementsUtils/Utils"),i=widget.getValue("trm_security_ctx");n.setXPrefCredentials(widget,i)}this.req_component.reqCommandProxy.preferenceModification({preferences:t,appId:widget.getValue("appId"),widgetId:widget.id})},onResize:function(e){var t=this;setTimeout(function(){var e=!1;null!==t.lastStatus.timer?e=Date.now()-t.lastStatus.timer>1e3:e=!0;if(e){t.lastStatus.timer=Date.now();var n=window.getComputedStyle(t.widget.body,null).getPropertyValue("width");n=parseInt(n.replace("px","")),t.pad_app&&t.pad_app.elements&&t.pad_app.elements.padslidder&&t.pad_app.elements.padslidder._updateMaxSizes(n)}},500)},_buildDOM:function(){var e=this;if(!e.elements){e.elements={};require(["DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable"],function(t){e.immersiveFrame=t.getImmersiveFrame();var n=e.elements.mainBody=document.createElement("div");e.elements.mainBody.classList.add("trm-root"),e.elements.mainBody.classList.add("trm-appMainBody"),e.elements.mainBody.style.position="absolute",e.elements.mainBody.style.height="100%",e.elements.mainBody.style.width="100%",e.immersiveFrame.setContentInBackgroundLayer(n),e.widget.setBody(e.immersiveFrame.getContent())})}},_initializeENOREQComponent:function(e){var t=this;e.closeActionbarOnStartup=t.closeActionbarOnStartup,window.top.performance.mark(t.pcsPrefix+"_require_padcomponent_before"),require(["DS/RequirementStructureBrowser/RequirementAppContext","UWA/Core","DS/TraceableRequirementsUtils/Services/RequirementUserPrefrences","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementSecurityCtxMgt","DS/TraceableRequirementsUtils/Services/RequirementTypeMgt","DS/PADUtils/PADUtilsServices","DS/HomePage/HomePage","DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable","DS/RequirementStructureBrowser/utils/TRMModelEvent"],function(n,i,r,o,s,a,l,c,d,u){var p=t.trmModelEvents=u.getModelEvents(),h=require("DS/RequirementStructureBrowser/utils/RequirementsConstant");t.active_view=widget.getValue(h.ACTIVE_VIEW);var f={modelEvents:p};o.app_initialization(function(){t._buildDOM(),widget.mergePreferences([{name:"trm_tv_addednodes",type:"hidden",defaultValue:""}]);widget.addPreference({name:"trm_tv_addednodes",type:"hidden",defaultValue:{},options:[]}),widget.setValue("trm_tv_addednodes",{}),s.addSecurityCtx2Preferences().then(function(){var i;i=new r,widget.displayNameSettings=i.getDisplayNamePref(),a.addTypes2Preferences(t.ReqTypesPrefOptions),t.welcome=new c(f),t.welcome.initialize().then(function(){t.active_view&&""!==t.active_view||(t.active_view=h.VIEW_RECENTLY_OPEN,t._setActiveView(t.activeBody,t.welcome))}),t._checkIfChangeControlEnabled(function(){window.top.performance.mark(t.pcsPrefix+"_require_padcomponent_done"),window.top.performance.measure(t.pcsPrefix+"_require_padcomponent",t.pcsPrefix+"_require_padcomponent_before",t.pcsPrefix+"_require_padcomponent_done");var i=t._retrieveinitializationOpts(),r=UWA.extend(e,i);t.req_component=new n(r)})}),p.subscribe({event:"welcome-panel-action-CreateActions"},function(e){t._launchSelectedAction(e)})})})},_retrieveinitializationOpts:function(){var e=this;widget.addEvents({onSearch:function(t){e.req_component.search(t)},onResetSearch:function(){e.req_component.search()},onReady:function(){window.top.performance.mark(e.pcsPrefix+"_padcomponent_onready"),window.top.performance.measure(e.pcsPrefix+"_padcomponent_ready",e.pcsPrefix+"_require_padcomponent_done",e.pcsPrefix+"_padcomponent_onready"),e.req_app=this;var t=e.widget.getValue("X3DContentId"),n=require("DS/RequirementStructureBrowser/utils/TRMModelEvent").getModelEvents();if(UWA.is(t)){var i=UWA.is(t,"string")?JSON.parse(t):t;e.req_component.addNodesFromContent(i,{callback:function(){e.widget.deleteValue("X3DContentId")}})}function r(){var t=e.widget.getPreference("dnd"),n=t?t.value:"MOVE";e.req_component.setDnDBehavior(n)}r();var o=require("DS/RequirementStructureBrowser/utils/RequirementsConstant");e.req_component.addEvent("onToggleView",function(t){e.widget.setValue("default_view",t)});var s=require("DS/PADUtils/PADSession"),a="false"!==e.widget.getValue("useIndexAccleration");s.setUseIndexPreference(a,void 0,!0),e.widget.addEvent("endEdit",r),e.req_component._initWorkUnderChange(e.elements.mainBody),n.subscribe({event:"welcome-panel-active-view"},function(t){e.active_view!==o.VIEW_STRUCTURE_BROWSER&&(e.req_component.previous_view=e.active_view),e.req_component.active_view=e.active_view=t.id,widget.setValue(o.ACTIVE_VIEW,t.id)}),n.subscribe({event:o.CREATE_ROOT_OBJECT},function(t){e.req_component.createRootobjects(t)}),n.subscribe({event:"TRMViews-WelcomePanel-updateStoredObjects"},function(t){var i=t.item2remove,r=[],o=e.req_component.PersistencyManager.getUserWorkingNodeIDs();"null"===o&&(o=null);var s=!1;if(Array.isArray(o))for(var a=0;a<o.length;a++){if(o&&-1!==o.indexOf(i[a]))e.req_component.options.model.searchRootById(i[a])&&r.push(i[a]),delete o[a],s=!0}s&&e.req_component.PersistencyManager.saveUserWorkingRootNodes(o);var l=e.req_component.PersistencyManager.getRecentItems();if(UWA.is(l,"string")){var c=l.trim().split(",");for(a=0;a<c.length;a++)if(c&&-1!==c.indexOf(i[a])){var d=c.indexOf(i[a]);c.splice(d,1)}l=c.toString()}e.widget.setValue("UserRecentItem",l),r.length&&n.publish({event:"TRMViews-WelcomePanel-removeFromView",data:{item2remove:r}})}),n.subscribe({event:"TRMViews-WelcomePanel-OpenStructure"},function(t){e.req_component.launchStructureBrowser(t),n.publish({event:"welcome-panel-active-view",data:{id:o.VIEW_STRUCTURE_BROWSER}})}),n.subscribe({event:"TRMViews-WelcomePanel-removeFromView"},function(t){var n=t.item2remove,i=n?n.length:0,r=e.req_component.getPADTreeDocument();r.withTransactionUpdate(function(){for(var e=0;e<i;e++){var t=r.searchRootById(n[e]);t&&r.removeRoot(t)}})}),n.subscribe({event:"TRMViews-WelcomePanel-activate"},function(t){e._setActiveView("welcomePanel",e.welcome),e.req_component.previous_view&&""!==e.req_component.previous_view||(e.req_component.previous_view=o.VIEW_RECENTLY_OPEN,e.active_view!==o.VIEW_STRUCTURE_BROWSER&&(e.req_component.previous_view=e.active_view)),n.publish({event:"welcome-panel-action-selected",data:{id:e.req_component.previous_view}})}),n.subscribe({event:"TRMViews-WelcomePanel-closeLandingPage"},function(){e._setActiveView("container",e.req_component.elements.container)}),n.publish({event:"TRMViews-WelcomePanel-loadData"}),window.top.performance.mark(e.pcsPrefix+"_app_load_complete")},onSaveRoots:function(){var t=[],n=[],i=e.req_app.getPADTreeDocument();i.getRoots().forEach(function(e){t.push(e.getID())}),i.hasOwnProperty("detachedRoots")&&i.detachedRoots.forEach(function(e){n.push(e.getID()),-1===t.indexOf(e.getID())&&t.push(e.getID())}),widget.setValue(e.setting_names.ap_root_pids,JSON.stringify(t)),widget.setValue(e.setting_names.ap__root_pids_detached,JSON.stringify(n))},onRootsVisibility:function(){var t=[],n=e.req_app.getPADTreeDocument();n.hasOwnProperty("detachedRoots")&&n.detachedRoots.forEach(function(e){t.push(e.getID())}),widget.setValue(e.setting_names.ap__root_pids_detached,JSON.stringify(t))},onCustoViewChange:function(t){widget.setValue(e.setting_names.ap_custo,encodeURIComponent(JSON.stringify(t)))},onSaveAsTemplate:function(t){widget.setValue(e.setting_names.ap_custo,encodeURIComponent(JSON.stringify(t))),require(["DS/PADUtils/PADWSAccess"],function(e){e.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId"),value:encodeURIComponent(JSON.stringify(t)),onComplete:function(e){console.log("Saved as template")},onFailure:function(e){console.warn("Cannot save customization template")}})})},onAuthoringCtxAvailable:function(t){if(!0===t.isLicenseValid){var n=require("DS/PADUtils/PADSettingsMgt"),i=n.getSetting("changeControlActivation"),r=n.getSetting("changeControlPosition");e.widget.addPreference({name:"changeControlActivation",defaultValue:i,type:"hidden",label:"changeControlActivation_label"}),e.widget.addPreference({name:"changeControlPosition",defaultValue:r,type:"hidden",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]}),require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(e){!0===n.getSetting("changeControlActivation")?e.show():e.hide()}),n.addEvent("onChangeControlActivation",function(t){var n=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");e.debouncePrefSynchro?e.debouncePrefSynchro=!1:e._proxy.preferenceModification({name:"changeControlActivation",value:t}),!0===t?n.show():n.hide()}),n.addEvent("onChangeControlPosition",function(e){require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").setPosition(e)})}}})},_launchSelectedAction:function(e){var t=this;e.div=document.querySelector("#CreateActions"),require(["DS/RequirementStructureBrowser/components/CreateActionMenu"],function(n){n.executeAction({div:e.div,appPtr:self,modelEvents:t.trmModelEvents})})},_setActiveView:function(e,t){var n;(this.initDiv||(this.initDiv={}),void 0===e&&(e="default-"+Date.now()),this.previousBody=this.activeBody,this.activeBody=e,!0!==this.initDiv[e])&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("trm-"+e),this.elements[e].classList.add("trm-div"),this.elements.mainBody.appendChild(this.elements[e])),"function"==typeof t.render?(n=t.render(),this.initDiv[e]=!0):n=t,this.elements[e].appendChild(n));this._showActiveView(e)},_showActiveView:function(e){for(var t=Object.keys(this.elements),n=0;n<t.length;n++)e===t[n]?this.elements[t[n]].classList.remove("trm-hidden"):"mainBody"!==t[n]&&this.elements[t[n]].classList.add("trm-hidden")},_checkIfChangeControlEnabled:function(e){var t=!1,n=this;require(["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADSettingsMgt"],function(i,r,o){i.getTRMExpressionValue({expression:"TRM_AuthoringContext_Enabled",securityContext:r.getSecurityContext(),onComplete:function(i){var r=JSON.parse(i).results.value;UWA.is(r,"boolean")?t=r:UWA.is(r,"string")&&"true"===r&&(t=!0),o.setSetting("authorizeChangeControl",t),widget.setValue("authorizeChangeControl",t),n.enoreq_opts.authorizeChangeControl=t,e(t)},onFailure:function(i){console.error("Could not get change control enabled state: "+i),console.warn("--\x3e Change Control deactivated"),o.setSetting("authorizeChangeControl",t),n.enoreq_opts.authorizeChangeControl=t,e(t)},onTimeout:function(){console.error("Could not get change control enabled state: "+error),console.warn("--\x3e Change Control deactivated"),o.setSetting("authorizeChangeControl",t),n.enoreq_opts.authorizeChangeControl=t,e(t)}})})}};return n.init(e),n}define("DS/RequirementStructureBrowser/utils/REQExporter",["i18n!DS/PADUtils/assets/nls/PADUtils","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst","UWA/Class","DS/PADServices/utils/AttributesMgtV2","DS/PADUtils/PADUtilsServices","DS/PADUtils/Utility"],function(e,t,n,i,r,o){"use strict";var s='<table style="border:1px solid black; border-collapse:collapse;">',a="</table><br/>",l='<th style="border:1px solid black; background-color:#A7C942; text-align:left; color:#FFFFFF; font-size:.8em; padding-top:5px; paddingbottom:4px;word-break:break-word;display:table-cell;">',c="</th>",d="<tr>",u="</tr>",p="<td>",h="</td>";!function(){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},t=/[&<>"'\/]/g,n=/[<>\/]/g;function i(t){return e[t]}}();function f(e,t,n){for(var i=e.length,r=0;r<i;r++){n(t,e[r],r)}}function g(e){return""+e}function m(e){return'"'+e+'"'}function v(e,t){var n=e.options.grid[t];return o.convertDateTime(n)}function _(e,t){return"tree"===e?t.options.label:UWA.is(R.customizedColumnRenderers[e],"function")?R.customizedColumnRenderers[e](t):UWA.is(t.options.grid[e],"string")?t.options.grid[e]:UWA.is(t.options.grid[e],"number")?g(t.options.grid[e]):""}function y(e,t,n){var i=[];i.push(g(n.getDepth())),i.push(_("tree",n)),f(t,null,function(e,t){var r=t.customisation?t.customisation:t.xnav_options,o=UWA.is(r)?r.kind:void 0;if(o)switch(o){case"date":i.push(v(n,t.dataIndex));break;default:i.push(_(t.dataIndex,n))}else i.push(_(t.dataIndex,n))}),e.rows.push(i)}function S(t,n){var i={columns:[],tables:[]},r=(t.columnManager.getAvailableColumns(),t.columnManager.getVisibleColumns());f(r,null,function(e,t){var i=t.customisation?t.customisation:t.xnav_options,r=!(!i||!i.exportable)&&i.exportable.value;if(void 0!==r&&!r){var o=t.dataIndex;-1===n.indexOf(o)&&n.push(o)}});var o={kept:[],tree:null};return f(r,o,function(e,t){"tree"===t.dataIndex?e.tree=t:e.kept.push(t)}),i.columns.push(e.export_level),i.columns.push(o.tree.text),f(o.kept,i,function(t,n){t.columns.push(function(t){var n=t.text;if(""===n||null==n){var i="treelistview_customization_"+t.dataIndex;n=UWA.is(e[i])?e[i]:t.dataIndex}return n}(n))}),f(t.options.model.getRoots(),i,function(e,t){var n=null;t.isVisible()&&(n={rows:[]},e.tables.push(n),y(n,o.kept,t),t.processDescendants({processNode:function(){this.isVisible()&&y(n,o.kept,this)}}))}),i}function b(){this._str=""}function A(e){var t=e||{};this._debug=!0===t.debug,this._builder=new b}function C(){this._builder=new b}b.prototype={CRLF:"\r\n",append:function(e){this._str+=e+""},appendCRLF:function(){this._str+=this.CRLF},toString:function(){return this._str}},A.prototype={render:function(e){var t=this;return this.appendCRLF(),f(e.tables,e.columns,function(e,n){t._builder.append(s),t._builder.append("<thead><tr>"),t.appendCRLF(),f(e,null,function(e,n){t._builder.append(l),t._builder.append(n),t._builder.append(c)}),t.appendCRLF(),t._builder.append("</tr></thead>"),t._builder.append("<tbody>"),f(n.rows,null,function(e,n){t.appendCRLF(),t._builder.append(d),f(n,null,function(e,n){t._builder.append(p),t._builder.append(n),t._builder.append(h)}),t._builder.append(u)}),t.appendCRLF(),t._builder.append("</tbody>"),t._builder.append(a)}),this._builder.toString()},appendCRLF:function(){this._debug&&this._builder.appendCRLF()}},C.prototype={getSeperatorCharacter:function(e){var t="";switch(e){case"Semicolon":t=";";break;case"Comma":t=",";break;default:t=","}return t},renderHeaders:function(e,t){var n=e.length-1,i=this.getSeperatorCharacter(t);f(e,this,function(e,t,r){e._builder.append(m(t)),r!==n&&e._builder.append(i)}),this._builder.appendCRLF()},renderTables:function(e,t,n){var i=this,r=this.getSeperatorCharacter(n);f(e,null,function(e,t){f(t.rows,null,function(e,t){var n=t.length-1;f(t,null,function(e,t,o){i._builder.append(m(t)),o!==n&&i._builder.append(r)}),i._builder.appendCRLF()})})},render:function(e,t){return this._builder.append("\ufeff"),this.renderHeaders(e.columns,t),this.renderTables(e.tables,e.columns,t),this._builder.toString()}};var R={customizedColumnRenderers:{"ds6w:created":function(e){return v(e,"ds6w:created")},"ds6w:modified":function(e){return v(e,"ds6w:modified")},"ds6w:reserved":function(e){var n=e.options.grid["ds6w:reserved"];return n&&"true"===n.toLowerCase()?t.tooltip_reserved:t.tooltip_unreserved}},options:{columns_to_remove:["tree","find_in_ctx","hide_show","bi_color"],csv_base_file_name:t.csv_base_file_name}};return n.singleton({printHtml:function(e){var t=S(e.context,R.options.columns_to_remove.slice()),n=(new A).render(t);r.printhtml(n)},generateCsv:function(e){var t=e.context.structureEditor._dataGridView;e.csv_base_file_name&&(R.options.csv_base_file_name=e.csv_base_file_name);var n=t.getAsCSV();r.downloadfile(n,R.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")},exportForRMC:function(e,t){require(["DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json"],function(t,n){var i=e;t.getAllStructure({pid:i,onComplete:function(e){var t=(e=UWA.is(e,"string")?JSON.parse(e):e).Seperator;e=e.ObjectArray;var i=JSON.parse(n).attributes_exportRMC,o={columns:[],tables:[]};for(var s in i)i.hasOwnProperty(s)&&o.columns.push(i[s]);var a={rows:[]};e.forEach(function(e){e.forEach(function(e){var t=[];for(var n in i){var r=n.replace("attribute_",""),o=document.createElement("textarea");o.innerHTML=e[r],e[r]=o.value.replace(/"/g,'""'),e.hasOwnProperty(r)?t.push(e[r]):t.push("")}a.rows.push(t)});a.rows.push([])}),o.tables.push(a);var l=(new C).render(o,t);r.downloadfile(l,R.options.csv_base_file_name+(new Date).toString().split(" ").splice(1,4).join(" ")+".csv","text/csv")},onFailure:function(e,t){console.warn("WS getInfo.onFailure")},onTimeout:function(e){console.warn("WS getInfo.onFailure")}})})},generateRenderStruct:S})}),define("DS/RequirementStructureBrowser/components/RequirementContextualMenu",["UWA/Core","UWA/Class","DS/ApplicationFrame/CommandsManager","i18n!DS/ENXNav/assets/nls/ENXNav.json","DS/TraceableRequirementsUtils/REQClipboard","DS/WebappsUtils/WebappsUtils","DS/RichView/Command/CreateLinkAction","DS/RichView/Command/CtxMenu_StartLinkCmd","DS/RichView/Command/CtxMenu_EndLinkCmd","DS/RichView/Command/DeleteLinkAction","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOTRMApp","i18n!DS/CfgWebAppEffectivityUX/assets/nls/CfgEffectivityNLS","DS/PADUtils/PADContext"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,h){"use strict";var f=function(){};return f.prototype._getContextualMenu=function(e){var t=[],r=this;if(r.externalProviders=e.externalProviders,null!==e){"noExpandState"!==e._expandState&&(t.push({title:i.PAD_CMDExpandAll,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_ExpandAll.png")+")",type:"PushItem",action:{callback:r._expandAll.bind(r)}}),t.push({title:i.PAD_CMDCollapseAll,icon:"url("+o.getWebappsAssetUrl("ENXNav","icons/32/I_CollapseAll.png")+")",type:"PushItem",action:{callback:r._collapseAll.bind(r)}}),t.push({type:"SeparatorItem"}));var s=h.get(),a=s.getSelectedNodes(),l=s.getSetting("root_type");1==a.length&&l.indexOf(a[0].getKindOf())>-1&&r.CopyLink(t),t.push({title:i.PAD_CMDProperties,icon:"url("+o.getWebappsAssetUrl("ENOCollabSharingCmds","icons/32/I_CATSSEditorDisplayProperties.png")+")",type:"PushItem",action:{callback:r._editProperties.bind(r)}}),e.isRoot()||r.detachCommand(t);var c=e._defaultTypes[e.options.reqKindOf]||e.options.reqKindOf;"Requirement"===c&&(e.options.externalObject?r.AddRequirementCommand(t):(e.isRoot()||r.Appendnewcommand(t),r.InsertnewcommandReq(t),r.CreateExternalRequirementCommand(t),r.InsertExternalRequirementCommand(t),r.InsertExistingRequirementCommand(t),r.insertParameterCommand(t),t.push({title:d.StartLink,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/DerivedRequirementStartLink.png")+")",type:"PushItem",action:{context:e,callback:r._startLink.bind(r)}}),t.push({title:d.EndLink,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/DerivedRequirementEndLink.png")+")",type:"PushItem",action:{context:e,callback:r._endLink.bind(r)}}),t.push({name:"linkManagement",title:u.ENOTRMApp_Cmd_DeleteLink,icon:"",data:"",type:"PushItem",action:{context:e,callback:r._linkManagement.bind(r)}}))),"Chapter"===c&&(r.Appendnewcommand(t),r.Insertnewcommand(t)),"Requirement Specification"!==c&&"DOCUMENTS"!==c||(e.isRoot()||r.AppendnewcommandSPF(t),r.Insertnewcommand(t)),"Requirement Group"===c&&(e.isRoot()||r.AppendnewcommandSPF(t),r.InsertnewcommandSPF(t),r.insertInsertExistingCommandSPF(t)),"Comment"===c&&r.Appendnewcommand(t),"Comment"!=c&&"Requirement"!=c&&"PlmParameter"!=c&&"PARParameter"!=c&&"Requirement Group"!=c&&r.insertInsertExistingCommand(t),"PlmParameter"!=c&&"PARParameter"!=c&&(t.push({type:"PushItem",title:d.CMDCopy,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_Copy.png")+")",state:n.getCommand("Copy")._isEnabled?"enabled":"disabled",action:{context:e,callback:function(){r._launchAction({command:"Copy"})}}}),t.push({type:"PushItem",title:d.CMDCut,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_Cut.png")+")",state:n.getCommand("Cut")._isEnabled?"enabled":"disabled",action:{context:e,callback:function(){r._launchAction({command:"Cut"})}}}),t.push({type:"PushItem",title:d.CMDPaste,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_Paste.png")+")",state:n.getCommand("Paste")._isEnabled?"enabled":"disabled",action:{context:e,callback:function(){r._launchAction({command:"Paste"})}}}),r.CopyPasteEffectiviy(t))}return t},f.prototype._startLink=function(e){var t=e.context;this._startLinkCmd=new a;var n={id:t.getID(),physicalId:t.getID(),type:t.options.type,kindof:t.options.reqKindOf,typeNls:t.options.grid["ds6w:type"],path:t.getOccurencePath(),title:t.options.label};this._startLinkCmd.execute(n)},f.prototype._endLink=function(e){var t=h.get().getSelectedNodes();if(this._endLinkCmd=new l({container:".pad_view_container"}),null!=t&&null!=t&&0!=t.length){for(var n=Array(),i=0;i<t.length;i++){var r=t[i],o="";r.options.hasOwnProperty("kindof")?o=r.options.kindof:r.options.hasOwnProperty("reqKindOf")&&(o=r.options.reqKindOf);r.getID();var s=r.getID(),a=r.options.grid["ds6w:type"],c={id:s,physicalId:s,type:r.options.type,typeNls:a,kindof:o,path:r.getOccurencePath(),title:r.options.label};n.push(c)}this._endLinkCmd.execute(n)}},f.prototype._linkManagement=function(e){var t=e.context;c._initialized||(this._deleteLinkAction=c.init({context:this,renderTo:".structure-details"}));var n={physicalid:t.getID(),type:t.options.type,name:t.options.label};this._deleteLinkAction.execute(n)},f.prototype.AddRequirementCommand=function(e){var t=this;e.push({title:d.AddRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewRequirement"})}}})},f.prototype.CreateExternalRequirementCommand=function(e){if(this.externalProviders){var t=this;e.push({type:"PushItem",title:d.InsertNewExtReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",submenu:[{type:"PushItem",title:d.ExternalSubReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"CreateExternalSubRequirement"})}}},{type:"PushItem",title:d.ExternalDerivedReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"CreateExternalDerRequirement"})}}}]})}},f.prototype.InsertExternalRequirementCommand=function(e){if(this.externalProviders){var t=this;e.push({type:"PushItem",title:d.InsertExistExtReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",submenu:[{type:"PushItem",title:d.ExternalSubReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"InsertExternalSubRequirement"})}}},{type:"PushItem",title:d.ExternalDerivedReq,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",action:{callback:function(){t._launchAction({command:"InsertExternalDerRequirement"})}}}]})}},f.prototype.AddCommentCommand=function(e){var t=this;e.push({title:d.AddComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewComment"})}}})},f.prototype.Appendnewcommand=function(e){var t=this;e.push({type:"PushItem",title:d.AddNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:d.AddComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewComment"})}}},{title:d.AddChapter,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewChapter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewChapter"})}}},{title:d.AddRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirement.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewRequirement"})}}}]})},f.prototype.AppendnewcommandSPF=function(e){var t=this;e.push({type:"PushItem",title:d.AddNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:d.AddRequirementSpecification,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewRequirementSpecification.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewRequirementSpecification"})}}},{title:d.AddSpecificationFolder,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertNewSpecificationFolder.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"AddNewSpecificationFolder"})}}}]})},f.prototype.InsertnewcommandReq=function(e){var t=this;e.push({type:"PushItem",title:d.InsertNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:d.InsertRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertRequirement"})}}}]})},f.prototype.Insertnewcommand=function(e){var t=this;e.push({type:"PushItem",title:d.InsertNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:d.InsertRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubReq.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertRequirement"})}}},{title:d.InsertChapter,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubChapter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertChapter"})}}},{title:d.InsertComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertComment"})}}}]})},f.prototype.InsertnewcommandSPF=function(e){var t=this;e.push({type:"PushItem",title:d.InsertNew,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/Create_it1.png")+")",submenu:[{title:d.InsertRequirementSpecification,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubRequirementSpecification.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertRequirementSpecification"})}}},{title:d.InsertSpecificationFolder,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertSubSpecFolder.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertSpecificationFolder"})}}}]})},f.prototype.CopyPasteEffectiviy=function(e){var t=this;e.push({type:"PushItem",title:d.Copy_Paste_Effectivity,submenu:[{title:p.CFG_COPY_VARIANT_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Copy_Variant_Effectivity.png")+")",state:t._checkActionCmdState("CopyVariantEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"CopyVariantEffectivity"})}}},{title:p.CFG_PASTE_VARIANT_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Paste_Variant_Effectivity.png")+")",state:t._checkActionCmdState("PasteVariantEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"PasteVariantEffectivity"})}}},{title:p.CFG_COPY_EVOLUTION_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Copy_Evolution_Effectivity.png")+")",state:t._checkActionCmdState("CopyEvolutionEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"CopyEvolutionEffectivity"})}}},{title:p.CFG_PASTE_EVOLUTION_EFFECTIVITY,icon:"url("+o.getWebappsAssetUrl("CfgWebAppEffectivityUX","icons/I_Paste_Evolution_Effectivity.png")+")",state:t._checkActionCmdState("PasteEvolutionEffectivity"),type:"PushItem",action:{callback:function(){t._launchAction({command:"PasteEvolutionEffectivity"})}}}]})},f.prototype.insertInsertExistingCommand=function(e){var t=this;e.push({title:d.InsertExisting,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",submenu:[{title:d.InsertExistingRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExisting.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingRequirement"})}}},{title:d.InsertExistingChapter,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingChapter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingChapter"})}}},{title:d.InsertExistingComment,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingComment.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingComment"})}}}]})},f.prototype.insertInsertExistingCommandSPF=function(e){var t=this;e.push({title:d.InsertExisting,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",submenu:[{title:d.InsertExistingRequirementSpecification,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingReqSpec.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingRequirementSpecification"})}}},{title:d.InsertExistingSpecificationFolder,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingSpecFolder.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingSpecificationFolder"})}}}]})},f.prototype.InsertExistingRequirementCommand=function(e){var t=this;e.push({title:d.InsertExisting,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExistingObject.png")+")",type:"PushItem",submenu:[{title:d.InsertExistingRequirement,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdInsertExisting.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"InsertExistingRequirement"})}}}]})},f.prototype.insertParameterCommand=function(e){var t=this;e.push({title:d.insertParameterCommand,icon:"url("+o.getWebappsAssetUrl("PARParameterCommands","icons/32/I_AddParameter.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"ActionBar_Parameters"})}}})},f.prototype.detachCommand=function(e){var t=this;e.push({title:d.DetachCommand,icon:"url("+o.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/iconReqCmdDetach.png")+")",type:"PushItem",action:{callback:function(){t._launchAction({command:"Detach"})}}})},f.prototype._expandAll=function(){this._launchAction({command:"ExpandAll"})},f.prototype._collapseAll=function(){this._launchAction({command:"CollapseAll"})},f.prototype._editProperties=function(){this._launchAction({command:"ActionBar_Attributes"})},f.prototype._checkActionCmdState=function(e){var t="enable",i=n.getCommand(e);return null!=i&&(i._checkSelection(),0==i._isEnabled&&(t="disabled")),t},f.prototype._launchAction=function(e){var t=n.getCommand(e.command,widget);t&&t.begin()},f.prototype.CopyLink=function(e){var t=this;e.push({title:d.CopyLink,typeRepresentation:"functionIcon",icon:{iconName:"link",fontIconFamily:1},type:"PushItem",action:{callback:function(){t._launchAction({command:"CopyLink"})}}})},f}),define("DS/RequirementStructureBrowser/requirementServices/TRMPersistencyManager",["UWA/Core","UWA/Class","UWA/Class/Promise"],function(e,t,n){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){e.PersistencyManager=e.PersistencyManager=this,this.app=e,this._isWidgetRefreshing=null},saveUserSelectedNodes:function(e){var t,n=[];e.forEach(function(e){t=e.getID(),n.push(t)}),widget.setValue("selectedNodeIDs",n)},saveUserWorkingRootNodes:function(e){widget.setValue("workingNodeIDs",e)},addRecentItem:function(e){var t=this.getRecentItems(),n="";if(t&&(n=t.replace(new RegExp('"',"g"),"")),e&&!(e.length<3)&&0!==n.indexOf(e)){var i=this.updateRecentsList(n,e);i&&widget.setValue("UserRecentItem",i)}},updateRecentsList:function(t,n){if(!e.is(n))return console.log("error for recent id"),null;var i=null;for(i=t&&""!==t.trim()?t.trim().split(","):[];-1!==i.indexOf(n);){var r=i.indexOf(n);i.splice(r,1)}return i.length>=20?(i.pop(),i.unshift(n),i.join()):(i.unshift(n),i.join())},getUserSelectedNodeIDs:function(){return widget.getValue("selectedNodeIDs")},getRecentItems:function(){return widget.getValue("UserRecentItem")},getUserWorkingNodeIDs:function(){return widget.getValue("workingNodeIDs")},setWidgetRefreshStatus:function(e){this._isWidgetRefreshing=e},getWidgetRefreshStatus:function(){return this._isWidgetRefreshing},getNGFilter:function(){return widget.getValue("NGFilter")},setNGFilter:function(e){widget.setValue("NGFilter",e)},resetNGFilter:function(){widget.deleteValue("NGFilter")}})}),define("DS/RequirementStructureBrowser/utils/TRMMask",["UWA/Core","DS/UIKIT/Spinner","i18n!DS/UIKIT/assets/nls/UIKIT"],function(e,t,n){"use strict";return{mask:function(i,r){var o;this.isMasked(i)&&this.unmask(i),i.addClassName("masked"),o=e.createElement("div",{class:"mask"}),r=e.is(r,"string")?r:n.loading,r=e.createElement("div",{class:"mask-wrapper",html:{tag:"div",class:"mask-content",html:[new t({visible:!0,animate:!0,spin:!0}),e.createElement("span",{class:"text",text:r})]}}).inject(o),o.inject(i)},unmask:function(e){var t=e.getElement(" > .mask");t&&t.destroy(),e.removeClassName("masked")},isMasked:function(e){return e.hasClassName("masked")}}}),define("DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable",["UWA/Class","DS/Windows/ImmersiveFrame"],function(e,t){"use strict";var n;return e.singleton({getImmersiveFrame:function(){return n||this.createImmersiveFrame(),n},createImmersiveFrame:function(){n&&UWA.is(n.destroy,"function")&&(n.destroy(),n=void 0),n=new t({})}})}),define("DS/RequirementStructureBrowser/components/RequirementStatusInfos",["css!DS/RequirementStructureBrowser/RequirementStructureBrowser","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Drivers/Alone","DS/Logger/Logger","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/UIKIT/Tooltip","DS/Controls/Loader","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADSession"],function(e,t,n,i,r,o,s,a,l,c,d){"use strict";var u=n.extend(i,{name:"pad_status",_logger:null,_tooltipInfo:null,init:function(e){this._logger=o.getLogger(u),this._logger.log("init"),this._parent(e),e.withProgress?(this.elements.container=UWA.createElement("div",{class:this.getClassNames()+" with_progress"}),this.elements.loaderContainer=UWA.createElement("div",{class:"pad_status_loader_div"}).inject(this.elements.container),this._loader=(new l).inject(this.elements.loaderContainer),this.elements.fonticonInfoContainer=UWA.createElement("div",{class:"pad_status_fonticon_info_div"}).inject(this.elements.container),this.elements.fonticonInfo=UWA.createElement("i",{class:"fonticon fonticon-info pad_status_span"}).inject(this.elements.fonticonInfoContainer),this._tooltipInfo=new a({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top",trigger:"touch",events:e.events}),this.elements.fonticonAttentionContainer=UWA.createElement("div",{class:"pad_status_fonticon_attention_div"}).inject(this.elements.container),this.elements.fonticonAttention=UWA.createElement("i",{class:"fonticon fonticon-attention pad_status_span"}).inject(this.elements.fonticonAttentionContainer),this._tooltipAttention=new a({className:this.getClassNames("_tooltipAttention"),target:this.elements.fonticonAttention,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo")),this.getOption("attention")&&this._tooltipAttention.setBody(this.getOption("attention")),this.showLoader=function(e){if(e){var t=this;this._isloading=!0,t._loadingText=e.nlsTooltip,setTimeout(function(){!0===t._isloading&&t._loader&&(t._loader.on(),t.elements.fonticonInfoContainer.style.display="",t.elements.fonticonAttentionContainer.style.display="none",e.fonticon&&(t._replacedFonticon=e.fonticon,t.elements.fonticonInfo.removeClassName("fonticon-info"),t.elements.fonticonInfo.addClassName(e.fonticon)),t._addLoading(),!1===t._tooltipInfo.isVisible&&t._tooltipInfo.toggle())},e.timeout?e.timeout:0)}else this._loader&&(this._loader.on(),this.elements.fonticonInfoContainer.style.display="",this.elements.fonticonAttentionContainer.style.display="none")},this.hideLoader=function(e){this._isloading=!1,this._loader&&(this._loader.off(),e&&!0===e.memoryFull&&(this.elements.fonticonAttentionContainer.style.display="",this.elements.fonticonInfoContainer.style.display="none")),!0===this._tooltipInfo.isVisible&&this._tooltipInfo.toggle(),this.elements.fonticonInfo.addClassName("fonticon-info"),this.elements.fonticonInfo.removeClassName(this._replacedFonticon),this._removeLoading()},this.elements.fonticonAttentionContainer.style.display="none"):(this.elements.container=UWA.createElement("span",{class:this.getClassNames()+" fonticon fonticon-info"}),this._tooltipInfo=new a({className:this.getClassNames("_tooltipInfo"),target:this.elements.container,position:"top left",trigger:"touch",events:e.events}),this.getOption("status")&&this._tooltipInfo.setBody(this.getOption("status")),this.getOption("renderTo")&&this.inject(this.getOption("renderTo")))},setStatus:function(e){this._tooltipInfo.setBody(e),this._isloading&&this._addLoading()},_addLoading:function(){var e=this._tooltipInfo.getBody(),t=UWA.createElement("div",{id:"loadingTooltip",text:this._loadingText});null===e.querySelector("loadingTooltip")&&t.inject(e)},_removeLoading:function(){var e=this._tooltipInfo.getBody().querySelector("loadingTooltip");null!==e&&e.remove(e)}});return u.buildStatus=function(e){var t=UWA.createElement("div",{class:"pad_status_msg"});if(e.tree_content){if(!UWA.is(e.tree_content.nbObjectsSelected))throw new Error("Invalid status. Parameter nbObjectsSelected missing");void 0!==e.tree_content.nbObjectsInTree?e.tree_content.nbObjectsInTree>0?(1===e.tree_content.nbObjectsInTree?UWA.createElement("div",{text:s.REQStatusInfos_oneObjectInTree}).inject(t):UWA.createElement("div",{text:e.tree_content.nbObjectsInTree+s.REQStatusInfos_nbObjectsInTree}).inject(t),UWA.createElement("div",{text:e.tree_content.nbObjectsSelected+s.REQStatusInfos_nbObjectsSelected}).inject(t)):UWA.createElement("div",{text:s.REQStatusInfos_noObjectInTree}).inject(t):null!=e.tree_content.nbObjectsSelected?UWA.createElement("div",{text:e.tree_content.nbObjectsSelected+s.REQStatusInfos_nbObjectsSelected}).inject(t):UWA.createElement("div",{text:s.REQStatusInfos_noObjectInTree}).inject(t);var n=d.isAuthoring()?s.REQStatusInfos_authoringModeEnabled:s.REQStatusInfos_authoringModeDisabled;UWA.createElement("div",{text:n,style:"border-top: 1px;"}).inject(t)}var i=c.getTenantsPreference();return e.Tenant&&i.length>1&&UWA.createElement("div",{text:s.REQStatusInfos_Tenant+e.Tenant}).inject(t),t},u}),define("DS/RequirementStructureBrowser/utils/TRMModelEvent",["DS/CoreEvents/ModelEvents"],function(e){"use strict";var t=new e;return{getModelEvents:function(){return t},publish:function(e){return t.publish(e)},subscribe:function(e,n){return t.subscribe(e,n)},unsubscribe:function(e){return t.unsubscribe(e)},unsubscribeAll:function(e){return t.unsubscribeAll(e)}}}),define("DS/RequirementStructureBrowser/command/_Copy",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.copy()}}}),define("DS/RequirementStructureBrowser/utils/TRMPromiseUtils",["UWA/Promise"],function(e){"use strict";return{wrappedWithPromise:function(t){return new e(t)},allSettled:function(t){return e.allSettled(t)},all:function(t){return e.all(t)},getResilientPromise:function(t){return new e(function(n,i){e.cast(t.promise).then(function(e){n(e)}).catch(function(r){e.cast(t.getFallback()).then(function(e){t.onSuccessFallBack&&t.onSuccessFallBack(),n(e)}).catch(function(e){console.log("fail of callback %s",e),i(r)})})})}}}),define("DS/RequirementStructureBrowser/components/RequirementCCP",["UWA/Class","DS/Logger/Logger","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/REQClipboard","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/PADUtils/views/PADDropConfirm","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/TraceableRequirementsUtils/utils/TRMReportPanel","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(e,t,n,i,r,o,s,a,l,c,d,u){"use strict";var p=e.extend({init:function(){this._parent(arguments),this._acceptedNodes={},this._rejectedNodes={},this._relPattern=JSON.parse(u)},acceptNode:function(e){var t=!1,n=e.getPath(),i=n.length,r=n[0].getID();if(this._acceptedNodes.hasOwnProperty(r)){var o=this._acceptedNodes[r];if(o.depth<=i)o.nodes.push(e);else{var s=e.getFirstCommonAncestor(o.nodes[0]);o.nodes.length=0,o.nodes.push(s),o.depth=s.getPath().length,t=!0}}else this._acceptedNodes[r]={depth:i,nodes:[e]};return t},applyOnAcceptedNodes:function(e){var t=!0,n=!1,i=!1;for(var r in this._acceptedNodes)if(n=!0,UWA.is(r,"string"))for(var o=this._acceptedNodes[r].nodes,a=0;a<o.length;a++)e(o[a]);if(this._rejectedNodes.nonPSNodes)if(i=!0,1===this._rejectedNodes.nonPSNodes.nodes.length){var c=l.replace(l.copyNonPSNode,{label:this._rejectedNodes.nonPSNodes.nodes[0].getLabel()});s.warningAlert(c)}else if(this._rejectedNodes.nonPSNodes.nodes.length>=1){c=l.replace(l.copyNonPSNodes,{label:this._rejectedNodes.nonPSNodes.nodes.length});s.warningAlert(c)}return!0===i&&!1===n&&(t=!1),t}});function h(e,t){Date.now();e.withBroadcastSelect(function(){var t=e.getXSO();if(!t.isEmpty()){var n=t.get(),i=!1;n.sort(function(e,t){var n=e.getDepth(),i=t.getDepth();return n===i?0:n<i?-1:n>i?1:void 0});var r=new p;if(n.forEach(function(e){i=r.acceptNode(e)||i}),i){Date.now();e.unselectAll();Date.now();!0===r.applyOnAcceptedNodes(function(e){Date.now();e.select()})&&s.warningAlert(l.reselectionFeedback)}}})}function f(e,t){var n=e.getXSO();if(!n.isEmpty()){var i,o,a=n.get(),l={action:t,objects:[]},d=[];a.forEach(function(n){if(n.isVisible())if("PlmParameter"===(o=n.getType()))s.warningAlert(c.Requirement_Notif_CmdNotAvailable+" Selected object type: "+o);else{if(1===(i=n.getOccurencePath()).length&&"cut"===t)return s.warningAlert(c.Requirement_Notif_RootSelection),!1;l.objects.push({path:i,labelPath:n.buildPath()}),d.push(e.getNodeByOccurencePath(i))}}),0!=d.length&&(r.setData(r.OBJECT,l),"cut"===t&&m(d))}}var g=[];function m(e){g=e}function v(){return g}return e.extend({activeCutting:!1,activeNodes:[],getActiveNodes:function(){return v()},setStateCuttingNodes:function(e){e&&(this.activeCutting&&this.activeNodes.length>0&&this.setStateUncuttingNodes(this.activeNodes),e.forEach(function(e){e.updateOptions({isBeingCut:!0})}),this.activeCutting=!0,this.activeNodes=e)},setStateUncuttingNodes:function(e){e.length>0&&e.forEach(function(e){e.options.isBeingCut&&e.updateOptions({isBeingCut:!1})}),this.activeCutting=!1,this.activeNodes=[]},copy:function(){var e=this.getPADTreeDocument(),t=e.getSelectedNodes();this.uncut(),m([]),e.withBroadcastSelect(function(){e.withTransactionUpdate(function(){t.forEach(function(e){e.select()})})}),h(e),f(e,"copy")},cut:function(){var e=this.getPADTreeDocument();h(e),f(e,"cut"),this.options.model.setCuttingNodes(v()),this.setStateCuttingNodes(v())},uncut:function(){this.activeCutting&&(this.options.model.setCuttingNodes([]),this.setStateUncuttingNodes(this.activeNodes)),this.getPADTreeDocument().unselectAll(),r.isEmpty(r.OBJECT)||r.clear(r.OBJECT)},resetClipboard:function(){this.uncut()},_processTargets:function(e){var t,n=[],i=[];return e.forEach(function(e){e.isRoot()?n.push(e):(t=e.getID(),i.indexOf(t)<0&&(n.push(e),i.push(t)))}),n},_inputDataNew:function(e,t){var n=[],i=t[0].getID(),r=t[0].options.reqKindOf,o=this._relPattern[r],s=t[0].getLabel();return e.forEach(function(e){var t=e.getKindOf(),a=e.getRelationID(),l=e.getID(),c=e._parentNode.getID();null==c&&(c=l);var d,u=e.getLabel();d=o[t]?o[t]:"";var p=e.getOccurencePath();n.push({children:l,parentid:c,childtype:t,childrelationship:d,childpath:p,oldrelid:a,newparentID:i,newparenttype:r,newparentlable:s,childLabel:u})}),n},_performCutPaste:function(e,r){var a=this,l=o.get(),u=n.getSecurityContext(),p={dataArray:[]};e.forEach(function(e,t){var n={objectId:e.children,position:{},oldParentId:e.parentid,oldRelId:e.oldrelid,newParentId:e.newparentID,mode:r};p.dataArray.push(n)}),i.reorder({securityContext:u,json:p,onComplete:function(e){t.log("WS reorder.onComplete");var n=(UWA.is(e,"string")?JSON.parse(e):e).results;if(n.Success.length>0&&(l.refreshOnDnD(n.Success,!1,r),a.resetClipboard&&a.resetClipboard()),n.Failure.length>1||n.Success.length>1)new d({title:"CutCopyPaste",reportData:n});else{if(n.Success.length>0){var i=n.Success[0],o=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision;u=(u=c.CutCopyPaste_Success_msg).replace("{TNR}",o),s.sucessAlert(u)}if(n.Failure.length>0){var u;i=n.Failure[0],o=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision;u=(u=c.CutCopyPaste_Failure_msg+" "+c.FailureReasons).replace("{TNR}",o),s.errorAlert(u)}}a.endBlockingTransaction()},onFailure:function(e){t.log("WS reorder.onFailure"),e=UWA.is(e,"string")?JSON.parse(e):e,s.errorAlert(c.cut_copy_paste_error+e.message),a.endBlockingTransaction()},onTimeout:function(){t.warn("WS reorder.onTimeout"),s.errorAlert(c.Requirement_Notif_RequestTimeout),a.endBlockingTransaction()}})},_distinguishInsertReparentCases:function(e,t){var n={insertExisting:[],reparent:[]};return e.forEach(function(e){!e.getRelationID()||"copy"===t?n.insertExisting.push(e):n.reparent.push(e)}),n},paste:function(){var e,t,n=this;this.setStateUncuttingNodes(v());var i=this.getPADTreeDocument(),o=i._confirmDialog||!1,d=0,u=0,p=0,h=i.getXSO();if(!h.isEmpty()){var f=h.get();if(f.some(function(e){if("Comment"===e.options.type||"PlmParameter"===e.options.type)return e.options.type}))return s.warningAlert(c.Requirement_Notif_CmdNotAvailable),!1;u=(f=this._processTargets(f)).length;var g=c.selected_target;if(u>1)return s.warningAlert(c.Requirement_Notif_MutliSelection),!1;if(!r.isEmpty(r.OBJECT)){var m=!1;v().length>0&&(m=!0);var _=r.consumeData(r.OBJECT,m),y=_.action;if(y&&(t="copy"===y?"COPY":"MOVE",e=function(e,t){var n=[];return e.objects.forEach(function(e){var i=t.getNodeByOccurencePath(e.path);if(i&&i.getOccurencePath().length===e.path.length)n.push(i);else{var r=e.labelPath.replace(/\/$/,"")+l.pasteObjectNotInView;s.errorAlertAlert(r)}}),n}(_,i)),e.length>0){var S=n._distinguishInsertReparentCases(e,y);d=S.reparent.length,p=S.insertExisting.length}if(u*d>1e3)return void s.errorAlert(c.limit_cut_paste);var b=function(t){if(t){if(p>0){n.beginBlockingTransaction(l.composite);var i=n._inputDataNew(e,f),r="COPY";n._performCutPaste(i,r)}if(d>0){n.beginBlockingTransaction(l.composite);i=n._inputDataNew(e,f),r="MOVE";n._performCutPaste(i,r)}}};if(o){var A=c.all_selected_objects;1===e.length&&(A=e[0]._options.display||e[0]._options.label),1===f.length&&(g=f[0]._options.display||f[0]._options.label);new a({copyMode:t,dropName:A,targetName:g,callback:b})}else b(!0)}}}})}),define("DS/RequirementStructureBrowser/command/_Cut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.cut()}}}),define("DS/RequirementStructureBrowser/utils/RequirementAppConfig",[],function(){"use strict";var e={LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,MOBILE_BREAKPOINT:550,PATH_HOME:"home",PATH_LANDING_PAGE:"LandingPage",PATH_RECENTY_OPENED:"RecentlyOpened",PATH_MY_REQUIREMNTS:"MyRequirements",ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home.LandingPage",ROUTE_STRUCTURE_BROWSER:"home.RecentlyOpened",ROUTE_RECENTY_OPENED:"home.RecentlyOpened",ROUTE_MY_REQUIREMENTS:"home.MyRequirements"};return e.ROUTE_MY_REQUIREMENTS="home.MyReqSPec",e.DRAG_NODE_START=!1,e}),define("DS/RequirementStructureBrowser/command/_REQExport",[],function(){"use strict";return{execute:function(e){require(["DS/RequirementStructureBrowser/utils/REQExporter","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/DictionaryAccess","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst"],function(t,n,i,r){switch(e.command_id){case"Print":t.printHtml({context:e.xnav_app});break;case"ExportCSV":e.xnav_app.beginBlockingTransaction(r.exportMask),i.updateNLSforexport(e.xnav_app.getPADTreeDocument()).then(function(){t.generateCsv({context:e.xnav_app}),e.xnav_app.endBlockingTransaction()}).catch(function(t){console.error(t),e.xnav_app.endBlockingTransaction()});break;case"PrintOptions":case"ExportCSVOptions":e.xnav_app.getPADTreeListView();break;case"ExportToRMC":var o=e.xnav_app.getSelectedNodes(),s="";o.forEach(function(e){"Requirement Specification"==e._options.reqKindOf&&(s+=e._options.resourceid,s+=",")}),s=(s=s.trim()).substring(0,s.length-1),t.exportForRMC(s,r)}setTimeout(function(){e.cmd&&e.cmd.enable()},500)})}}}),define("DS/RequirementStructureBrowser/utils/RequirementsConstant",["UWA/Core"],function(e){"use strict";return Object.freeze({TYPE_REQUIREMENT:"Requirement",TYPE_REQUIREMENT_SPECIFICATION:"Requirement Specification",TYPE_REQUIREMENT_GROUP:"Requirement Group",TYPE_CHAPTER:"Chapter",TYPE_COMMENT:"Comment",CUSTOMIZED_TYPE:["Requirement","Chapter","Comment","Requirement Specification","Requirement Group"],MOBILE_BREAKPOINT:550,LEFT_PANEL_SIZE_EXPANDED:300,LEFT_PANEL_SIZE_COLLAPSED:40,ROUTE_HOME:"home",ROUTE_LANDING_PAGE:"home",PATH_TRM_REQSPEC:"CreateRequirmentSpecification",PATH_TRM_REQ:"CreateRequirement",PATH_TRM_REQFOLDER:"CreateSpecificationFolder",PATH_TRM_INFO:"ReqInfo",PATH_CREATE_ACTIONS:"CreateActions",PATH_NEW_REQSPEC:"NewReqSpec",PATH_NEW_SPECFOLDER:"SpecFolder",PATH_OPEN_SPEC:"OpenSpec",PATH_LIST_REQ:"MyRequirements",PATH_LIST_REQSPEC:"MyReqSPec",PATH_RECENTLY_OPENED:"RecentlyOpen",EVENT_REFRESH_BY_IDS:"event-refresh-by-id",ACTIVE_VIEW:"Active_View",VIEW_REQ_SPEC_LIST:"MyReqSPec",VIEW_REQ_LIST:"MyRequirements",VIEW_RECENTLY_OPEN:"RecentlyOpen",VIEW_STRUCTURE_BROWSER:"StructureEditor",CREATE_ROOT_OBJECT:"create-trm-root-object",UPDATE_LIST_SELECTION:"update_list_selection",UPDATE_SELECTED_ROW:"update_selected_row",AFTER_ALL_SETTLED:"after_all_settled",STR_ORG_KEY:"organization:",STR_CURRENT_KEY:"current:",STR_OWNER:"owner:",STR_BACKSLASH_DBL_QUOTE:'"',STR_OR:"OR",STR_AND:"AND",LEFT_BRACKET:"(",RIGHT_BRACKET:")",STR_COLON:":",STR_SPACE:" ",WELCOME_PANEL_STATE:"welcome-panel-state",WELCOME_PANEL_COLLAPSE:"COLLAPSED",WELCOME_PANEL_EXPAND:"EXPANDED",EVENT_WELCOME_PANEL_COLLAPSE:"welcome-panel-collapse",EVENT_WELCOME_PANEL_EXPAND:"welcome-panel-expand"})}),define("DS/RequirementStructureBrowser/components/StructureRootNodes",["css!DS/PADServices/PADServices","i18n!DS/PADServices/assets/nls/PADServices","DS/TraceableRequirementsUtils/Utils","DS/CollectionView/ResponsiveLargeTilesCollectionView","DS/Tree/TreeDocument","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils"],function(e,t,n,i,r,o,s){"use strict";function a(e){var t=this;t._context=e,this._broadcastSelect=!0,this._roots2add=[],this._root2select=[],this.elements={},this.elements.container=UWA.createElement("div",{class:"rootLst-main"}),this.options={grid:null,model:null},this.options.dgvOptions={selectionBehavior:{unselectAllOnEmptyArea:!0,toggle:!0,canMultiSelect:!0,enableShiftSelection:!0,enableFeedbackForActiveCell:!1,canInteractiveMultiselectWithCheckboxClick:!0},allowUnsafeHTMLContent:!1};var n=this.options.grid=new i(this.options.dgvOptions);n.onStatusbarIconPointerDown=function(e){var n=e.cellInfos,i=e.clickedIconIndex,r=n?n.cellModel:void 0;switch(i){case 0:t._removeTile({tile_id:r.options.resourceid});break;default:console.warn("RootListController: Unknown Icon")}},n.getContent().addEventListener("dragover",function(e){return e.preventDefault(),e.stopPropagation(),!1}),n.getContent().addEventListener("drop",this._onDropBlank.bind(this)),n.touchMode=!0;this.options.model=new r({shouldAcceptDrag:function(){return!1}}),this.options.model.id="rootListModel",this.options.model.getXSO().onPostAdd(function(e){if(t._broadcastSelect){var n=t.options.model.getSelectedNodes().map(function(e){return e.options.resourceid});t._context._localModelEvent.publish({event:"RequirementStructureBrowser-Root-select",data:{tile_ids:n}})}}),this.options.model.getXSO().onPostRemove(function(e){if(t._broadcastSelect){var n=t.options.model.getSelectedNodes().map(function(e){return e.options.resourceid});t._context._localModelEvent.publish({event:"RequirementStructureBrowser-Root-select",data:{tile_ids:n}})}}),this.options.model.getXSO().onEmpty(function(n){t._broadcastSelect&&e._localModelEvent.publish({event:"RequirementStructureBrowser-Root-select",data:{tile_ids:[]}})}),n.model=this.options.model,n.getContent().inject(t.elements.container),t._context._localModelEventsTokens.push(t._context._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-manage"},this._manageRoot.bind(this))),t._context._localModelEventsTokens.push(t._context._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-sync"},this._syncTitle.bind(this))),t._context._localModelEventsTokens.push(t._context._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-remove"},this._removeTiles.bind(this)))}return a.prototype.getContent=function(){return this.elements.container},a.prototype.getTabLabel=function(){return t.rootLst.rootLstLabel},a.prototype.setVisible=function(e){e?this.elements.container.removeAttribute("hidden"):this.elements.container.setAttribute("hidden","")},a.prototype.selectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length?t[0].select():-1===this._root2select.indexOf(e.data.nodeModel.getID())&&this._root2select.push(e.data.nodeModel.getID()),this._broadcastSelect=!0},a.prototype.unselectTile=function(e){this._broadcastSelect=!1;var t=this._search(e.data.nodeModel.getID());1===t.length&&t[0].unselect(),this._broadcastSelect=!0},a.prototype._addRootTiles=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(!0!==i.waiting4validation){var r={resourceid:i.resourceid,label:i.label,icons:UWA.clone(i.icons,!0),thumbnail:i.thumbnail?i.thumbnail:o.getWebappsAssetUrl("PADServices","icons/32/I_DefaultThumbnail.png"),statusbarIcons:["open wux-ui-3ds-flip-vertical"],statusbarIconsTooltips:[t.rootLst.removeRoot],children:null,subLabel:i.grid["ds6w:responsible"],description:i.grid["ds6w:identifier"]};i.badges&&(r.badges=UWA.clone(i.badges)),r.icons[0]&&r.icons[0].badges&&delete r.icons[0].badges.topRight,delete r.contextualMenu,this._roots2add.push(r),this._realAddInWebUX(this._roots2add)}}},a.prototype._manageRoot=function(e){var t=void 0!==e.added_node?[e.added_node]:void 0!==e.added_nodes?e.added_nodes:[];if("boolean"!=typeof e.isremove||!0!==e.isremove){for(var n=[],i=0;i<t.length;i++){var r=t[i],o=!1,s=this.options.model.getRoots();if(s&&s.length>0)for(var a=0;a<s.length;a++)if(s[a].options.resourceid===r.options.resourceid){o=!0;break}o||(n.push(r.options),r.onSelect(this.selectTile.bind(this)),r.onUnselect(this.unselectTile.bind(this)))}n.length&&this._addRootTiles(n)}},a.prototype._syncTitle=function(e){if(e.isRoot()){var t=e.getID?e.getID():"FakeTreeNode",n=this._search(t);if(1===n.length){var i=n[0],r=this.options.model,o=e.options.filtered;i.getLabel()===e.getLabel()&&i.options.subLabel===e.options.grid["ds6w:responsible"]&&i.options.filtered===o||(r.prepareUpdate(),i.setLabel(e.getLabel()||e.options.display),i.updateOptions({subLabel:e.options.grid["ds6w:responsible"],description:e.options.grid["ds6w:identifier"]}),i.options.filtered=o,!0===i.options.filtered?i.setBadges({bottomRight:"filter"}):i.setBadges({bottomRight:""}),r.pushUpdate(),this.options.grid.layout.invalidate())}}},a.prototype._search=function(e){return this.options.model.search({match:function(t){if(t.nodeModel.options.resourceid===e)return!0}})},a.prototype._removeTiles=function(e){for(var t=!0===e.all?this._getAllIDs():Array.isArray(e.pids)?e.pids:[],n=0;n<t.length;n++)this._removeTile({tile_id:t[n],noDispatch:e.noDispatch})},a.prototype._removeTile=function(e){var t=e.tile_id,n=this._search(t);if(1===n.length){var i=this;this.options.model.withTransactionUpdate(function(){i.options.model.removeRoot(n[0]);var r={tile_id:t};!0!==e.noDispatch&&i._context._localModelEvent.publish({event:"RequirementStructureBrowser-Root-removeTile",data:r})})}},a.prototype._realAddInWebUX=s.debounce(function(e){var t=[],n=[],i=[],r=[];r=e;for(var o=e.length-1;o>=0&&!(this._search(e[o].resourceid).length>0);o--)t.push(e[o]);for(var s=t.length-1;s>=0&&-1===i.indexOf(t[s].resourceid);s--)i.push(t[s].resourceid),n.push(t[s]);if(0!==(e=n).length){if(this.options.model.addRoot(e),r[0].resolve)for(var a=0;a<r.length;a++)r[a].resolve();this._roots2add=[],this._broadcastSelect=!1;for(var l=0;l<e.length;l++){var c=this._search(e[l].resourceid);1===c.length&&(e[l].nSelect||c[0].select(),e[l].isFiltered?c[0].setBadges({bottomRight:"filter"}):!1===e[l].isFiltered&&c[0].setBadges({bottomRight:""}))}this._broadcastSelect=!0}else if(r[0].resolve)for(var d=0;d<r.length;d++)r[d].resolve()},200),a.prototype._onDropBlank=function(e,t){var i=n.deserializeDroppedData(e);return GlobalModelEvents.publish({event:"RequirementStructureBrowser-Root-addTile",data:{unserializedData:i,behavior:"WITHOUT_CONTEXT"}}),!0},a.prototype._getAllIDs=function(){var e=[],t=this.options.model.getRoots();for(var n in t)e.push(t[n].options.resourceid);return e},a}),define("DS/RequirementStructureBrowser/components/ActionBar",["DS/Core/Core","DS/ApplicationFrame/FrameWindow","DS/RuntimeView/NLSManager","DS/ApplicationFrame/ActionBar","DS/Core/ModelEvents","css!DS/RequirementStructureBrowser/RequirementStructureBrowser.css"],function(e,t,n,i,r){"use strict";var o=function(e){this.options={action_bar:{file:"RequirementStructureBrowser.xml",module:"RequirementStructureBrowser",context:null,language:"en"},renderTo:null,callback:{onactionbarcb:null}}};return o.prototype.initializeActionBar=function(e,t){this.mediator=e.mediator,this._modelEvents1=new r,n.DEFAULT_LANGUAGE=widget.lang?widget.lang:widget.getValue("lang"),n.loadResource({resourceFile:"RequirementStructureBrowser/RequirementStructureBrowser"}),n.onResourceLoaded({resourceFile:"RequirementStructureBrowser/RequirementStructureBrowser",language:widget.lang?widget.lang:widget.getValue("lang")},function(){}),new i(this.options.action_bar).inject(t)},o}),define("DS/RequirementStructureBrowser/treemodel/RequirementNodeModel",["DS/Tree/TreeNodeModel","UWA/Core","DS/WebappsUtils/WebappsUtils","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst.json"],function(e,t,n,i){"use strict";function r(t){if(this.options={matrixID:null,physicalID:null,cestamp:null,elementID:null,elementRV:null,type:"",kindof:"",title:"",name:"",revision:"",content:"",relationtype:"",relationid:null,parentID:"",attributes:[],level:0,editable:!0,isDocx:!1,format:"html",filteringContext:{isFilterOutByTagger:!1,isFilterOutBySearch:!1}},this.tenant=t.tenant,this.options=UWA.clone(t),t&&t.grid){this.options.subLabel=t.grid["ds6w:responsible"],this.options.description=t.grid["ds6w:identifier"];var n=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"]:t.padgrid&&t.padgrid["ds6w:reserved"]?t.padgrid["ds6w:reserved"]:null;if(null!==n)if("boolean"==typeof n?n:"TRUE"===n.toUpperCase())this._isLockedByMe(t)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips="Locked"):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips="Locked");else this.options.statusbarIcons=["lock-open"],this.options.statusbarIconsTooltips="Unlocked"}this.options=UWA.extend(this.options,t),this.options.relationOrder||(this.options.relationOrder=-1),this.options.grid||(this.options.grid={});this.options;e.call(this,this.options)}return r.prototype=Object.create(e.prototype),r.prototype.getType=function(){return this.options.type},r.prototype.getKindOf=function(){return this.options.reqKindOf?this.options.reqKindOf:this.options.type},r.prototype.setParentID=function(e){this.options.parentID=e},r.prototype.getParentID=function(){return this.options.parentID},r.prototype.getParentId=function(){return this.getParent().getID()},r.prototype.setLevel=function(e){this.options.level=e},r.prototype.unMatch=function(e){if(!e)return!1;var t=e.toLowerCase();if((this.getCreatedDate()||"").toLowerCase().includes(t)||(this.getModifedDate()||"").toLowerCase().includes(t)||(this.getDescription()||"").toLowerCase().includes(t)||(this.getLabel()||"").toLowerCase().includes(t)||(this.getOwner()||"").toLowerCase().includes(t)||(this.getMaturity()||"").toLowerCase().includes(t))return!1;var n=!0;return(this.getAttributes()||[]).forEach(function(e){e.value.toLowerCase().includes(t)&&(n=!1)}),n},r.prototype.match=function(e,t){if(!e||""==e)return!1;for(var n=e.toLowerCase(),i=0;t.length>i;i++){if("ds6w:reserved"!=t[i].ds6w)if(t[i].kind&&-1!==["datetime","timestamp"].indexOf(t[i].kind.toLowerCase())){if((new Date(this.options.grid[t[i].ds6w]).toString()||"").toLowerCase().includes(n))return!0}else if("date"==t[i].kind.toLowerCase()){if((new Date(this.options.grid[t[i].ds6w]).toLocaleString("en",{month:"short",day:"numeric",year:"numeric"})||"").toLowerCase().includes(n))return!0}else if("tree"==t[i].dataIndex){if((this.options.grid.displayName||"").toLowerCase().includes(n))return!0}else if((this.options.grid[t[i].ds6w]||"").toLowerCase().includes(n))return!0}return!1},r.prototype.getColor=function(){return this.options.grid.bi_color},r.prototype.setColor=function(e){this.updateOptions({grid:{bi_color:e}})},r.prototype.resetColor=function(){this.updateOptions({grid:{bi_color:"rgba(0, 0, 0, 0)"}})},r.prototype.getOwner=function(){return this.options.grid["ds6w:responsible"]},r.prototype.getAttributes=function(){return this.options.attributes},r.prototype.getMaturity=function(){return this.options.grid["ds6w:status"]},r.prototype.setMaturity=function(e){e&&e.length>0&&(this.options.grid["ds6w:status"]=e)},r.prototype.getLabel=function(){return this.options.grid["ds6w:label"]},r.prototype.getCreatedDate=function(){return this.options.grid["ds6w:created"]},r.prototype.getModifedDate=function(){return this.options.grid["ds6w:modified"]},r.prototype.getDescription=function(){return this.options.grid["ds6w:description"]},r.prototype.getLevel=function(){return this.options.level},r.prototype.setRelationOrder=function(e){this.options.relationOrder=e},r.prototype.getRelationOrder=function(){return this.options.relationOrder},r.prototype.getRelationType=function(){return this.options.relationtype},r.prototype.setRelationType=function(e){this.options.relationtype=e},r.prototype.setENOTRMAppElementID=function(e){this.options.elementID=e},r.prototype.getENOTRMAppElementID=function(){return this.options.elementID},r.prototype.setENOTRMAppElement=function(e){this.options.elementRV=e},r.prototype.getENOTRMAppElement=function(){return this.options.elementRV},r.prototype.applyFilters=function(){this.shouldBeVisible()?this.show():this.hide()},r.prototype.shouldBeVisible=function(e){return!this.isHiddenBySearch()&&!this.isHiddenByTagger()},r.prototype.isHiddenByTagger=function(){return this.options.filteringContext.isFilterOutByTagger},r.prototype.isHiddenBySearch=function(){return this.options.filteringContext.isFilterOutBySearch},r.prototype.setTaggerFilterState=function(e){this.options.filteringContext.isFilterOutByTagger=e},r.prototype.setSearchFilterState=function(e){this.options.filteringContext.isFilterOutBySearch=e},r.prototype.getNodesByRelId=function(e){var t={listOfFoundNodes:[],foundId:void 0};return this._getNodesByRelId(e,t),t.listOfFoundNodes},r.prototype.getDepth=function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},r.prototype._getNodesByRelId=function(e,t){var n=this.options.relationid,i=this.getID();if(n===e)t.listOfFoundNodes.push(this),t.foundId=i;else if(i!==t.foundId){var r=this.getChildren();if(r)for(var o=0;o<r.length;o++)r[o]._getNodesByRelId(e,t)}},r.prototype.getNodeByPath=function(e,t,n,i){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof n||n<0||n>=e.length)&&(n=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==n&&(this.isExpanded()||this.childComputed||void 0!==i&&!1!==i)){var r=e[t+1],o=this.getChildren();if(o&&0!==o.length){for(var s=null,a=0;a<o.length&&null===s;a++){var l=o[a];r===l.options.relationid&&(s=l)}return null===s?this:s.getNodeByPath(e,t+2,n,i)}return this}return this}},r.prototype.getChildByIds=function(e,t){var n,i=this.getChildren();if(i)for(var r=0;r<i.length;r++)if(void 0===e){if(i[r].getID()===t){n=i[r];break}}else if(i[r].getRelationID()===e){n=i[r];break}function o(n){var i;return void 0===e?n.getID()===t&&(i=n):n.getRelationID()===e&&(i=n),i}if(void 0===n&&void 0!==this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren&&this.options._childrenFilterInfo.filteredOutChildren.length>0)for(var s=this.options._childrenFilterInfo.filteredOutChildren,a=0;a<s.length;a++){var l=s[a];if(n=o(l))break;var c=l.getChildren();if(c)for(var d=0;d<c.length&&!(n=o(c[d]));d++);}return n},r.prototype.isDescendantOf=function(e){var t;if(t=e instanceof r?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var n=this.getParent();if(n)return n.isDescendantOf(t)}return!1},r.prototype.getChildById=function(e){var t,n=this.getChildren();if(n)for(var i=0;i<n.length;i++)if(n[i].getID()===e){t=n[i];break}return t},r.prototype._removeFilterInfo=function(){delete this.options._filterInfo},r.prototype._removeChildrenFilterInfo=function(){delete this.options._childrenFilterInfo},r.prototype._getFilterInfo=function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},r.prototype._getChildrenFilterInfo=function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},r.prototype.getViewType=function(){return this.options.viewType},r.prototype.isAttributePending=function(e){if(!t.is(e,"string"))return!1;return-1!==["#loading#","#queued#"].indexOf(this.getAttributeValue(e))},r.prototype.getOccurencePath=function(e,t){if(t=t||!1,UWA.is(e,"function")&&e(this),!this.isRoot()&&this.getParent()){var n=this.getParent().getOccurencePath(e,t);return 1==t?(n.push({resourceid:this.options.relationid,type:this.options.relationtype}),n.push({resourceid:this.options.resourceid,type:this.options.type})):(n.push(this.options.relationid),n.push(this.options.resourceid)),n}return 1==t?[{resourceid:this.options.resourceid,type:this.options.type}]:[this.options.resourceid]},r.prototype.getAttribute=function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},r.prototype.getID=function(){return this.options.resourceid},r.prototype.getRelationID=function(){return this.options.relationid},r.prototype.setRelationID=function(e,t){this.options.relationid=e,this.options.relationtype=t},r.prototype.getNodesById=function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},r.prototype._getNodesById=function(e,t){var n=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),n=!0;else{var i=this.getChildren();if(i)for(var r=0;i&&r<i.length;r++)n=i[r]._getNodesById(e,t)||n}return n},r.prototype.updateOptions=function(t){if(t.grid){this.options.thumbnail||t.thumbnail||(t.thumbnail=n.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),t.subLabel=t.grid["ds6w:responsible"]?t.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",t.description=t.grid["ds6w:identifier"]?t.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:"";var r=t.grid["ds6w:reserved"]?t.grid["ds6w:reserved"]:t.padgrid&&t.padgrid["ds6w:reserved"]?t.padgrid["ds6w:reserved"]:null;if(null!==r)if("boolean"==typeof r?r:"TRUE"===r.toUpperCase())this._isLockedByMe(t)?(this.options.statusbarIcons=["key"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]):(this.options.statusbarIcons=["lock"],this.options.statusbarIconsTooltips=[i.tooltip_reserved]);else t.statusbarIcons=["lock-open"],t.statusbarIconsTooltips=[i.tooltip_unreserved]}this.options.edit&&(t.edit=this.options.edit),e.prototype.updateOptions.call(this,t)},r.prototype._isLockedByMe=function(e){var t=!0,n=e.grid["ds6w:reservedBy"]?e.grid["ds6w:reservedBy"]:e.padgrid&&e.padgrid["ds6w:reservedBy"]?e.padgrid["ds6w:reservedBy"]:"",i=e.grid["ds6w:displayName"]?e.grid["ds6w:displayName"]:e.padgrid&&e.padgrid["ds6w:displayName"]?e.padgrid["ds6w:displayName"]:"",r=require("DS/TraceableRequirementsUtils/Utils"),o=r.getUserLogin()?r.getUserLogin():"",s=r.getUser()?r.getUser():"";(s.firstName||s.lastName)&&(s=s.firstName+" "+s.lastName);t=!0;return n.trim().length>0?(t=n.toUpperCase().trim()===o.toUpperCase().trim()||!1)||(t=n.toUpperCase().trim()===s.toUpperCase().trim()||!1):i.trim().length>0&&(t=s.toUpperCase().trim()===i.toUpperCase().trim()||!1),t},r}),define("DS/RequirementStructureBrowser/command/REQActionBarCmds",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/Windows/Dialog","DS/Controls/Button","UWA/Controls/Web","DS/Controls/Find","DS/TraceableRequirementsUtils/Utils"],function(e,t,n,i,r,o,s,a,l){"use strict";var c=["Print","PrintOptions","ExportToRMC","ExportCSV","ExportCSVOptions"],d=["Print","PrintOptions","ExportToRMC","ExportCSV","ExportCSVOptions"],u=["Print","ExportCSV","ExportToRMC"],p=["ColumnVisibility"],h=["Print","PrintOptions","ExportCSV","ExportCSVOptions"],f=["Copy","Cut"];function g(e,t){return-1!==e.indexOf(t)}return e.extend({init:function(e){this._parent(e);var i=this,r=(s=t.get()).options.model?s.options.model:s.getPADTreeDocument();if(n.isMobileDevice()&&-1!==h.indexOf(this.options.ID))this.disable();else if(-1!==c.indexOf(this.options.ID)){this._check_roots();var o=this._check_roots.bind(this);r.addEventListener("addChild",o),r.addEventListener("removeChild",o),g(d,this.options.ID)&&(this._check_roots(),s.addEvent("onRootsVisibility",this._check_roots.bind(this)))}else if(u.indexOf(this.options.ID)&&-1!==u.indexOf(this.options.ID)){this._parent(e);var s;r=(s=t.get()).options.model?s.options.model:s.getPADTreeDocument();this.disable(),s.getPADTreeDocument().getModelEvents().subscribe({event:"onRootAdded"},this._check_added_roots.bind(this))}else g(p,this.options.ID)&&(this._check_if_treeview(),UWA.is(s.addEvent,"function")&&s.addEvent("onToggleView",this._check_if_treeview.bind(this)));-1!==f.indexOf(this.options.ID)&&(this._check_select(),t.get().options.model.getXSO().onChange(this._check_select.bind(this))),"Paste"===this.options.ID&&require(["DS/TraceableRequirementsUtils/REQClipboard"],function(e){t.get().getPADTreeDocument().getXSO().onChange(i._activate_paste.bind(i)),e.addEvent("post_setData",i._activate_paste.bind(i)),e.addEvent("post_clear",i._activate_paste.bind(i)),i._activate_paste()})},execute:function(){var e=this,n=t.get(),i=n.options.model?n.options.model:n.getPADTreeDocument();switch(this.options.ID){case"Print":case"PrintOptions":case"ExportCSV":case"ExportCSVOptions":if("Print"===e.options.ID)return void n._applicationChannel.publish({event:"RequirementStructureBrowser-inject-print",data:null});e.disable(),require(["DS/RequirementStructureBrowser/command/_REQExport"],function(t){t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,model:i})});break;case"ExportToRMC":require(["DS/RequirementStructureBrowser/command/_REQExport"],function(t){t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,model:i})});break;case"ColumnVisibility":e.disable(),require(["DS/RequirementStructureBrowser/command/_REQColumnCusto"],function(t){var i=n.options.views?n.options.views.treelistview:n.getPADTreeListView();t.execute({command_id:e.options.ID,cmd:e,xnav_app:n,tree:i})});break;case"Find":this.disable();var o=n.getActiveDGV(),s=new a({displayMatchCaseToggle:!0,displayClose:!1,relatedWidget:o,onFindRequest:o.setFindStr,onFindPreviousResult:o.goToPreviousMatchingCell,onFindNextResult:o.goToNextMatchingCell,onFindClose:o.closeFind}),l=new r({title:n.getNls("find_title"),content:s,immersiveFrame:n.getAppImmersiveFrame(),resizableFlag:!1});l._onCloseButtonClick=function(){s.close(),l.close(),e.enable()};break;case"Copy":require(["DS/RequirementStructureBrowser/command/_Copy"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Cut":require(["DS/RequirementStructureBrowser/command/_Cut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Paste":require(["DS/RequirementStructureBrowser/command/_Paste"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;case"Uncut":require(["DS/RequirementStructureBrowser/command/_Uncut"],function(n){n.execute({command_id:e.options.ID,context:t.get()})});break;default:throw new Error("Unknown command")}e.enable()},_check_roots:function(){t.get().getPADTreeDocument().getRoots().length>0?this.enable():this.disable()},_check_added_roots:function(e){t.get().getPADTreeDocument();0===e.data.nb_root?this.disable():this.enable()},_check_select:function(){if(!0===!!t.get().getPADTreeDocument().getXSO().get().length){t.get().getPADTreeDocument().getXSO().get();g(f,this.options.ID)?this.enable():this.disable()}else this.disable()},_check_if_treeview:function(){switch(t.get().getPADTreeDocument().options.active_view){case"treelistview":this.enable();break;case"graphview":case"tileview":case"thumbnailview":this.disable()}},_activate_paste:function(){var e=require("DS/TraceableRequirementsUtils/REQClipboard"),n=t.get().getPADTreeDocument().getXSO().get().length>0,i=t.get().getEditMode();!0!==e.isEmpty(e.OBJECT)&&!0===n&&!0===i?this.enable():this.disable()}})}),define("DS/RequirementStructureBrowser/requirementservices/RequirementsServices",["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils"],function(e,t,n){"use strict";var i=function(){};return i.prototype.getInfo=function(i){t.get(),i.pid,i.selects;e.expand({securityContext:n.getSecurityContext(),json:i.json,onComplete:function(e){(UWA.is(e,"string")?JSON.parse(e):e).results},onFailure:function(e,t){console.log(e)},onTimeout:function(){}})},i}),define("DS/RequirementStructureBrowser/command/_Uncut",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.uncut()}}}),define("DS/RequirementStructureBrowser/treemodel/ReqTransactionManager",["UWA/Class","UWA/Class/Events"],function(e,t){"use strict";var n=function(e,t,n){this.getId=function(){return t},this.isNested=function(){return n};var i=this;this.end=function(){e(i)}};return e.extend(t,{_transactionStack:[],startTransaction:function(e){var t=Boolean(this._transactionStack.length>0),i=this;var r=new n(function(e){var t=i._transactionStack.indexOf(e),n=e.getId();if(t<0)throw new Error('This "'+n+'" transaction is not part of the transaction stack, may be it has already been ended');if(t!==i._transactionStack.length-1)throw new Error('Cannot end this "'+n+'" transaction as it is not the innermost transaction');i._transactionStack.pop();var r=e.isNested();i.dispatchEvent("onTransactionEnd",[n,r])},e,t);return this._transactionStack.push(r),t=r.isNested(),this.dispatchEvent("onTransactionStart",[e,t]),r},wrapInTransaction:function(e,t){var n=this.startTransaction(t);try{UWA.is(e,"function")&&e()}finally{n.end()}}})}),define("DS/RequirementStructureBrowser/command/_Paste",["UWA/Class"],function(e){"use strict";return{execute:function(e){e.context.paste()}}}),define("DS/RequirementStructureBrowser/components/CreateActionMenu",["i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/Menu/Menu","DS/WebappsUtils/WebappsUtils","DS/RequirementStructureBrowser/utils/RequirementsConstant"],function(e,t,n,i){"use strict";var r,o=["newGroup","newReqSpec","newReq"],s={newGroup:{id:"newGroup",title:e.CreateSpecificationFolder,icon:n.getWebappsAssetUrl("RequirementStructureBrowser","icons/22/iconReqCmdInsertNewSpecificationFolder.png"),types:i.TYPE_REQUIREMENT_GROUP},newReqSpec:{id:"newReqSpec",title:e.CreateRequirmentSpecification,icon:n.getWebappsAssetUrl("RequirementStructureBrowser","icons/22/iconReqCmdInsertNewRequirementSpecification.png"),types:i.TYPE_REQUIREMENT_SPECIFICATION},newReq:{id:"newReq",title:e.AddNewRequirement,icon:n.getWebappsAssetUrl("RequirementStructureBrowser","icons/22/iconReqCmdInsertNewRequirement.png"),types:i.TYPE_REQUIREMENT}};function a(){this._menu=[]}return a.prototype={getAction:function(e){var t=s[e];return{id:t.id,title:t.title,icon:t.icon}},executeAction:function(e){this._buildMenu(e);var n=e.div.getBoundingClientRect();t.show(this._menu,{position:{x:n.left,y:n.bottom}})},_buildMenu:function(e){if(0===this._menu.length)for(var t=0;t<o.length;t++){var n=s[o[t]];this._menu.push({title:n.title,icon:n.icon,type:"PushItem",action:{this:this,callback:function(t){e.modelEvents.publish({event:i.CREATE_ROOT_OBJECT,data:t.context})},context:n.types}})}}},r||(r=new a),r}),define("DS/RequirementStructureBrowser/treemodel/RequirementModelParser",["DS/Logger/Logger","DS/RequirementStructureBrowser/treemodel/RequirementNodeModel","DS/TraceableRequirementsUtils/Utils","DS/WebappsUtils/WebappsUtils","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/RequirementStructureBrowser/assets/nls/TreeLst.json","DS/RequirementStructureBrowser/utils/RequirementsConstant"],function(e,t,n,i,r,o,s,a){"use strict";e.getLogger("DS/RequirementStructureBrowser/treemodel/RequirementModelParser");var l,c,d,u={},p={},h=function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},f=["revision","current","policy","project"],g=function(){if(!l){var e=JSON.parse(r);l=e.Icons,c=e.mql_colmuns,e.req_column,e.thumbnail,d=e.tileview_thumbnails}},m=function(e,t){g();var r,s,a,l,u=function(e){var t="",n=" < ",i=UWA.is(e.unit)&&UWA.is(e.unit.displayName)?" "+e.unit.displayName:"";if(null!=e.minvalue&&""!=e.minvalue&&("true"==e.mininclus&&(n=" <= "),null!=e.maxvalue&&""!=e.maxvalue?t=e.minvalue+i+n:(t=e.minvalue+i+n,i+=" < ... "),n=" < "),UWA.is(e.values,"array")&&e.values.length>0){if(null!=e.value)if(""!=e.value)t=t+e.value+i;else{for(var r="",o=0;o<e.values.length;o++)""!==(r=""===r?e.values[o].displayName:r+","+e.values[o].displayName)&&(r+=i);t+=r}}else null!=e.value&&(""!=e.value?t=t+e.value+i:t+="...");return null!=e.maxvalue&&""!=e.maxvalue&&("true"==e.maxinclus&&(n=" <= "),t=null!=e.minvalue&&""!=e.minvalue?t+n+e.maxvalue+i:" ... < "+t+n+e.maxvalue+i,n=" < "),t},p={grid:{},padgrid:{},label:null,type:null,cestamp:null,externalObject:!1,reqInterface:null,resourceid:null,thumbnail:null,icons:[],subLabel:null,statusbarIcons:[],attributes:"",subtitle:"",statusbarIconsTooltips:"",filteringContext:{isFilterOutByTagger:!1,isFilterOutBySearch:!1},relationOrder:null,tenant:"tenant",useAsyncPreExpand:!1,reqKindOf:null};if(UWA.is(e.interface)&&UWA.is(e.interface.name)&&null!==e.interface.name){var m=[];e.interface.name.indexOf(",")>=0?m=e.interface.name.split(","):m.push(e.interface.name);for(var v=0;v<m.length;v++)t.externalTypes.indexOf(m[v])>=0&&(p.externalObject=!0);p.reqInterface=m}for(var _ in e)if(e.hasOwnProperty(_))if(null!==e[_]&&void 0!==e[_]&&(e[_].hasOwnProperty("value")&&e[_].hasOwnProperty("displayName")?(e[_].value=h(e[_].value),e[_].displayName=h(e[_].displayName)):"string"==typeof e[_]&&(e[_]=h(e[_]))),"physicalid[connection]"===_&&(p.relationid=e[_]),"attribute[TreeOrder]"===_)p.relationOrder=parseFloat(e[_]);else if("cestamp"===_)p.cestamp=e[_];else if("type[connection]"===_)p.relationtype=e[_];else if("physicalid"===_)p.resourceid=e[_];else if("attribute[Title]"===_)p.label=null!==e[_]?h(e[_]):e.name,p.req_label=h(e[_]),p.grid["ds6w:label"]=p.req_label;else if("name"===_)p.req_name=e[_],p.grid["ds6w:identifier"]=e[_];else if("type"===_){l=UWA.is(e[_].displayName)?e[_].value:e[_];var y=UWA.is(e[_].displayName)?e[_].displayName:e[_];p.type=l,y=h(y),null!=c[_]&&(p.grid[c[_]]=y),!(a=t._defaultTypes[p.type]||p.type)&&e["type.kindof"]&&(a=e["type.kindof"]),p.reqKindOf=a}else if("description"===_)null!=c[_]&&(p.grid[c[_]]=null!==e[_]?e[_]:"");else if("organization"===_)null!=c[_]&&(p.padgrid[c[_]]=o[_]),null!=c[_]&&null!==e[_]&&(e[_].value?p.grid[c[_]]=e[_].value:p.grid[c[_]]=e[_]);else if("originated"===_||"modified"===_)null!=c[_]&&(p.grid[c[_]]=h(e[_]));else if("owner"===_)null!=c[_]&&(void 0!==e[_].displayName?p.grid["ds6w:responsible"]=h(e[_].displayName):p.grid["ds6w:responsible"]=h(e[_]));else if("interface"===_&&UWA.is(e.interface.value))p.grid.paramContent=u(e[_]);else if("attribute[Change Id]"===_)""===e[_]?p.grid[c[_]]=h(e["interface[Change Control]"]):p.grid[c[_]]=h(e[_]);else{if(p.externalObject&&f.indexOf(_)<0)continue;if(UWA.is(e[_],"object"))null!=c[_]&&(p.grid[c[_]]=null!==e[_].displayName?h(e[_].displayName):"");else if(null!=c[_])p.grid[c[_]]=null!==e[_]?e[_]:"";else{var S=!1;if(t.DataService.customerAttributeToFetch&&t.DataService.customerAttributeToFetch.forEach(function(t){var n=t.attrName?"attribute["+t.attrName+"]":"";if(n===_.trim()){var i=t.SixWPredicate?t.SixWPredicate:t.sixWTag;p.grid[i]=null!==e[n]?h(e[n]):"",S=!0}}),!1===S){var b=_.startsWith("attribute[")?_.substring(10,_.length-1):_;b===_&&(p.grid["ds6wg:"+b]=null!==e[_]?e[_]:"")}}}if(e.type_icon_url&&(r=e.type_icon_url),r={iconPath:"url("+r+")"},p.icons.push(r),s=e.thumbnails&&-1==e.thumbnails.indexOf("iconLargeDefault.")&&-1==e.thumbnails.indexOf("iconSmallDefault.")?e.thumbnails:i.getWebappsAssetUrl("RequirementStructureBrowser","icons/64/"+d[a]),p.subLabel=p.grid["ds6w:status"]+" | "+p.grid["ds6w:responsible"]+" | "+p.grid["ds6w:modified"],p.thumbnail=s,p.grid.thumbnail="url("+s+")",p.grid.displayName=e.name,p.display=e.name,widget&&!UWA.is(widget.displayNameSettings)){var A=sessionStorage.getItem("RMTPreferredDisplayName");widget.displayNameSettings=UWA.is(A,"string")?JSON.parse(A):A}var C=widget.displayNameSettings[a]?widget.displayNameSettings[a]:widget.displayNameSettings[l];return UWA.is(name)&&UWA.is(C)&&(p.label=n.computeDisplayName({name:e.name,title:p.label,revision:p.grid["ds6wg:revision"]},C)),p.grid.displayName=p.label,p.display=p.label,p};return p.parse_attributes=function(e,t,i){g();var r,o,s={};if(e.forEach(function(e){if("type"===e.name)e.name="ds6w:type";else if("ds6w:businessType"===e.name)console.log("noooooooooooooooooo");else if("owner"===e.name)e.name="ds6w:responsible";else{var n=e.name.split("/");e.name=n[n.length-1]}if(UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(s.type=e.value,o=i._defaultTypes[s.type]||s.type,s.reqKindOf=o),"resourceid"===e.name||"physicalid"===e.name)s.resourceid=e.value;else if("did"===e.name)s.did=e.value;else if("spec.TreeOrder"===e.name)s.relationOrder=parseFloat(e.value);else if("preview_url"===e.name||"thumbnail_2d"===e.name)s.thumbnail=e.value,s.grid||(s.grid={}),s.grid.thumbnail="url("+e.value+")";else if("type_icon_url"===e.name||"icon"===e.name)s.icons||(s.icons=[]),s.icons.push(e.value);else if("ECChangement"===e.name||"COChangement"===e.name){s.grid||(s.grid={});var a=PADUtilsServices.get3DSpaceUrl()+"/common/images/iconSmallECRO.gif";s.grid.changeManagement=a}else if(e.name===t.tree||"ds6w:label"===e.name)s.label=e.value,s.req_label=e.value;else if("ds6w:refinedInto"===e.name)s.refined||(s.refined=[]),s.refined.push(e.value);else if("Req_Test_Cases"===e.name)s.test_cases||(s.test_cases=[]),s.test_cases.push(e.value);else if("ds6w:covers"===e.name)s.covers||(s.covers=[]),s.covers.push(e.value);else if("name"===e.name)r=e.value,s.req_name=e.value;else if("interface"===e.name)s.reqInterface||(s.reqInterface=[]),s.reqInterface.push(e.value);else if("ds6w:status"===e.name){s.grid||(s.grid={});var l=null;l=e.dispValue?e.dispValue:e.value,s.grid[e.name]=l}else if("ds6wg:revision"===e.name)s.grid||(s.grid={}),s.grid[e.name]=e.dispValue?e.dispValue:e.value;else if("ds6w:reserved"===e.name)s.grid||(s.grid={}),t.available_columns&&-1!==t.available_columns.indexOf(e.name)&&(s.grid[e.name]=e.value);else if(t.available_columns&&-1!==t.available_columns.indexOf(e.name)){s.grid||(s.grid={});var c=e.dispValue?e.dispValue:e.value;UWA.is(s.grid[e.name])?s.grid[e.name]=s.grid[e.name]+","+c:s.grid[e.name]=c}else s.padgrid||(s.padgrid={}),s.padgrid[e.name]=e.dispValue?e.dispValue:e.value}),s.refined&&(s.grid["ds6w:refinedInto"]=s.refined.length.toString()),s.test_cases&&(s.grid.Req_Test_Cases=s.test_cases.length.toString()),s.covers&&(s.grid["ds6w:covers"]=s.covers.length.toString()),e.length>4){if(widget&&!UWA.is(widget.displayNameSettings)){var a=sessionStorage.getItem("RMTPreferredDisplayName");widget.displayNameSettings=UWA.is(a,"string")?JSON.parse(a):a}s.grid["ds6w:label"]=s.req_label,UWA.is(r)&&UWA.is(widget.displayNameSettings[o])&&(s.label=n.computeDisplayName({name:r,title:s.grid["ds6w:label"],revision:s.grid["ds6wg:revision"]},widget.displayNameSettings[o])),s.grid.displayName=s.label,s.display=s.label}return s},p.parse_searchdata=function(e,t,n){g();var i={};return e.forEach(function(e){"ds6w:refinedInto"===e.name?(i.grid||(i.grid={}),i.refined||(i.refined=[]),i.refined.push(e.value)):"ds6w:covers"===e.name&&(i.grid||(i.grid={}),i.covers||(i.covers=[]),i.covers.push(e.value))}),i.refined&&(i.grid["ds6w:refinedInto"]=i.refined.length.toString()),i.covers&&(i.grid["ds6w:covers"]=i.covers.length.toString()),i},u.parse_expand=function(e,t,n){for(var i={nodes:{},did_to_resourceid:{},structure:{}},r=null,o=0;o<e.length;o++)if(e[o].hasOwnProperty("icon__default_thumbnail_2d")){var s=e[o].icon__default_thumbnail_2d;null==r&&(r=new Map),s.forEach(function(e){var t=e.did,n=e.icon;t.forEach(function(e){r[e]=n})});break}var a=n;return a._defineDefaultTypes(),e.forEach(function(e){if(e.hasOwnProperty("attributes")){var n=p.parse_attributes(e.attributes,t,a);null!=r&&r.hasOwnProperty(n.did)&&n.hasOwnProperty("icons")&&(n.icons[0]=r[n.did]),i.nodes[n.resourceid]=n,UWA.is(n.did)&&(i.did_to_resourceid[n.did]=n.resourceid)}else if(e.hasOwnProperty("path")){var o=i.structure;e.path.forEach(function(e,t){o.hasOwnProperty(e)||(o[e]={}),o=o[e]})}else console.log("parse_expand: Unknown object "+JSON.stringify(e))}),i},p.process={createNode:function(e,n){var i=m(e.data,e.treedocument);return i.tenant=e.tenant,new t(i)},fetch:function(e){e.treedocument.withTransactionUpdate(function(){var n=[];if(e.authored){console.log("process.fetch on mql");for(var i=0;i<e.response.results.length;i++){var r=new t(m(e.response.results[i],e.treedocument.app));n.push(r),e.treedocument.app.active_view===a.VIEW_STRUCTURE_BROWSER?(e.treedocument.addRoot(r),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_nodes:[r]}})):e.treedocument.app.launchStructureBrowser(r)}}else{if(console.log("process.fetch"),!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results isn't an array");console.log(e.response.results.length+" nodes to create"),e.response.results.forEach(function(i,r){if(console.log("Create node "+(r+1)),!UWA.is(i.attributes,"array"))throw new Error("Invalid result format - attributes isn't an array");var o=e.treedocument.columnManager.getVisibleColumns(),s=p.parse_attributes(i.attributes,o,e.treedocument.app),a=new t(s);e.treedocument.addRoot(a),n.push(a),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:a}}),e.treedocument.getModelEvents().publish({event:"onReqAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:a}})})}})},expand:function(e,n){if(console.log("process.expand"),!e.filterMode)return this.expandMql(e);if(!UWA.is(e.treedocument,"object")||!UWA.is(e.root_nodes,"array")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");e.starting_from_root=void 0===e.starting_from_root||e.starting_from_root,e.treedocument.withTransactionUpdate(function(){var i=u.parse_expand(e.response.results,n,e.treedocument),r="expanded",o=!1,s=!1,a=e.expand_level;switch(e.mode){case"find_in_ctx":r="partiallyExpanded",o=!0;break;case"refresh":s=!0}var l=function(t){for(var n,i=0;i<e.root_nodes.length;i++)if(!0===e.starting_from_root){if(e.root_nodes[i].getID()===t){n=[e.root_nodes[i]];break}}else if(void 0!==(n=e.root_nodes[i].getNodesById(t))&&n.length>0)break;return n},c=function(e,t){var n=!1,i={};t.label!==e.options.label&&(i.label=t.label,n=!0),UWA.equals(t.grid,e.options.grid)||(i.grid=t.grid,n=!0),UWA.equals(t.padgrid,e.options.padgrid)||(i.padgrid=t.padgrid,n=!0),n&&e.updateOptions(i)},d=function(e,n){s=!0;var l=Object.getOwnPropertyNames(e),u=s?[].concat(n.getChildren()):void 0;if(l.length>0){for(var p=!1,h=-1,f=[],g=0;g<l.length;g++){var m=l[g];if(i.did_to_resourceid.hasOwnProperty(m)){var v=i.did_to_resourceid[m],_=i.nodes[v].type,y=i.nodes[v].relationOrder,S=Object.getOwnPropertyNames(e[m])[0],b=i.did_to_resourceid[S],A=n.getChildByIds(v,b);if(UWA.is(A,"object")){if(!0===s&&c(A,i.nodes[b]),void 0!==u){var C=u.indexOf(A);-1!==C&&u.splice(C,1)}}else{p=!0;var R=i.nodes[b];if(R.relationid=v,R.relationtype=_,R.relationOrder=y,A=new t(R),y>=h)n.addChild(A),h=y,f.push(y);else{var w=null,E=n.getChildren();if(E)for(var D=0,I=E.length;D<I;D++)if(f[D]>y){w=E[D],f.splice(D,0,y);break}n.insertBefore(A,w)}}d(e[m][S],A)}else console.log("Invalid CV id ["+m+"]")}o?(n.childComputed=!1,n.select()):n.childComputed=!0,!0===s&&!1===p?console.log("State is not changed in refresh context"):(n.setState({state:r}),n.options.padstate=r)}else if(!0!==s){a&&(-1===a||a>1)?"Requirement Specification"!==n.options.type&&(n.childComputed=!0,n.options.children=null,n.setState({state:"noChildren"}),n.options.padstate="noChildren",-1===a&&(n._expandState="noExpandState")):null!==n.options.relcount&&0===n.options.relcount&&(n.setState({state:"noChildren"}),n.options.padstate="noChildren",n.childComputed=!0,n.options.children=null,o&&n.select())}null!=u&&u.length>0&&u.forEach(function(e){null!==e&&n.removeChild(e)})},p=Object.getOwnPropertyNames(i.structure);if(p.length>0)for(var h=0;h<p.length;h++){var f=p[h];if(i.did_to_resourceid.hasOwnProperty(f)){var g=l(i.did_to_resourceid[f]);void 0!==g?g.forEach(function(e){if(void 0!==e){c(e,i.nodes[i.did_to_resourceid[f]]);var t=i.structure[f];d(t,e)}}):console.log("Invalid root id: "+f)}}else console.log("No roots found")})}},p}),define("DS/RequirementStructureBrowser/treemodel/RequirementWSAccess",["UWA/Core","DS/WAFData/WAFData","DS/WebappsUtils/WebappsUtils","DS/PADUtils/PADSession","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","DS/PADUtils/PADContext","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/PADUtils/PADProbes","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/utils/TRMPromiseUtils"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,h){var f,g=function(){return f||(f=JSON.parse(a)),f},m=function(e){var t,n,i,r=g(),a=UWA.extend({root_physical_id:e.data.root_physicalid,type_filter:e.data.type_filter_bo,rel_filter:e.data.type_filter_rel},r.expand.mql_expand_data,!1);s.expand({securityContext:(n=c.get(),i={context:n},null==n&&alert("Can't find localContext"),d.getInstance(i).getSecurityContext({onSuccess:function(e){t=e.SecurityContext},onFailure:function(e){o.errorAlert(e.message)}},{serverName:null,serverUri:null}),t),json:a,onComplete:e.onComplete,onFailure:e.onFailure,headers:e.headers,OptimizedLoading:e.OptimizedLoading})},v=function(e,n){require("DS/PADUtils/PADSettingsMgt");return t.authenticatedRequest(e,n)},_={padtreelistOpts:function(e){var i=require("DS/PADUtils/PADSettingsMgt"),o=r.get3DSpaceUrl()+"/resources/enopad/admin/readsettings";if(!i.getSetting("local_preferences")){if(void 0!==e.data&&UWA.is(e.data,"object")&&void 0!==e.data.app&&void 0!==e.data.intent&&void 0!==e.data.reset){var s=e;if(!UWA.is(o)||!UWA.is(s,"object"))throw new Error("Invalid inputs for PADWSAccess.padtreelistOpts");return s.method="POST",s.headers={Accept:"application/json"},s.data="intent="+e.data.intent+"&app="+e.data.app+"&reset="+(!0===e.data.reset?"true":"false"),v(o,s)}throw new Error("Invalid inputs for PADWSAccess.padtreelistOpts")}o=n.getWebappsAssetUrl("ENOREQComponent","ENOREQ.2D.json");var a=e;a.data={},t.request(o,a)},multiexpand:function(e){var n=r.get3DSpaceUrl(),i=e,o=require("DS/PADUtils/PADSettingsMgt");n=n+"/cvservlet/multiexpand?SecurityContext="+r.getSecurityContext()+"&tenant="+r.getPlatformId();return delete(i=UWA.extend({method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":o.getSetting("lang")},timeout:e.timeout?e.timeout:o.getSetting("webapi_timeout")},e)).data.intent,delete i.data.authored,delete i.data.expand_iter,delete i.data.type_filter_bo,delete i.data.type_filter_rel,i.data.select_bo=i.data.select_bo.filter(function(e,t,n){return n.indexOf(e)===t}),i.onTimeout=i.onTimeout||i.onFailure,i.data.label=r.getRequestLabel(),i.data=JSON.stringify(i.data),t.authenticatedRequest(n,i)},navigate:function(e){var n=require("DS/PADUtils/PADSettingsMgt");if(!e.data.authored){var i=r.get3DSpaceUrl(),o=e;if("cv_expand"===e.data.executor?i+="/cvservlet/expand":i+="/cvservlet/multiexpand",!UWA.is(i)||!UWA.is(o,"object"))throw new Error("Invalid inputs for PADWSAccess.navigate");if(!UWA.is(o.data,"object"))throw new Error("Invalid inputs for PADWSAccess.navigate options.data not found");o.method="POST",o.headers={Accept:"application/json","Content-Type":"application/json"},o.data.label=r.getRequestLabel();return delete o.data.authored,delete o.data.expand_iter,delete o.data.type_filter_bo,delete o.data.type_filter_rel,o.onTimeout=o.onTimeout||o.onFailure,o.data=JSON.stringify(o.data),t.authenticatedRequest(i,o)}e.headers={"Accept-Language":n.getSetting("lang")},e.OptimizedLoading=!0===n.getSetting("useOptimizedLoading")||"true"===n.getSetting("useOptimizedLoading"),m(e)},fetch:function(e){c.get();var t=require("DS/PADUtils/PADSettingsMgt");if(!e.authored){var n="",i=e,o="physicalid:"+i.pids.join(" OR physicalid:");if(!UWA.is(n)||!UWA.is(i,"object"))throw new Error("Invalid inputs for PADWSAccess.fetch");i.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getSetting("lang")};var a=!0===i.isLinkAttributes?["ds6w:refinedInto","ds6w:covers"]:g().fetch.CV_fetch;return i.method="POST",(n=r.getServiceSearchUrl()+"/search").contains("3DSpace")&&(n=n.replace("/3DSpace","")),i.data={label:r.getRequestLabel(),query:o,nresults:1e3,locale:t.getSetting("lang"),tenant:r.getPlatformId(),source:["3dspace"],with_synthesis_attribute:!1,select_synthesis:a,select_predicate:a},UWA.is(e.isParameter)&&1==e.isParameter&&(i.data.specific_source_parameter={"3dspace":{plmparam:{retrieve_plmparam:!0}}}),delete i.authored,i.data=JSON.stringify(i.data),i.onTimeout=i.onTimeout||i.onFailure,v(n,i)}e.headers={Accept:"application/json","Content-Type":"application/json","Accept-Language":t.getSetting("lang")},function(e){var t="",n=c.get().columnManager.getDGVVisibleColumns();n=(n=n.join(",")).concat(",cestamp");for(var i=0;i<e.pids.length-1;i++)t+=e.pids[i]+",";t+=e.pids[e.pids.length-1],s.getInfo({securityContext:r.getSecurityContext(),pid:t,selectables:n,onComplete:e.onComplete,onFailure:e.onFailure})}(e)},_fetchData:function(e){var n=c.get();return h.wrappedWithPromise(function(i,o){try{var s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}},a="",l=[];"Requirement Specification"!==e&&"Requirement"!==e||(a=_._getSearchQuery(e),l=n.getSetting("FETCH_PREDICATE"));var c=UWA.merge(UWA.clone({}),{label:r.getRequestLabel(),with_indexing_date:!0,with_synthesis:!1,with_nls:!0,locale:r.getLanguage(),select_predicate:l,query:a,refine:{},order_by:"desc",order_field:"relevance",nresults:30,start:"0",source:["3dspace"],tenant:r.getTenant()});s.data=JSON.stringify(c),s.async=!1,s.onComplete=function(e){var t=(new Date).getTime(),n=UWA.is(e,"string")?JSON.parse(e):e,r=_._parseResponse(n);console.log("after parse response "+((new Date).getTime()-t)+"ms"),i(r)},s.onFailure=function(e){o(e)},s.onTimeout=function(e){o(e)};var d=r.getServiceSearchUrl()+"/search";t.authenticatedRequest(d,s)}catch(e){console.log("Exception occured while fetching data"+e.message)}})},getTenant:function(){return r.getPlatformId()},_getSearchQuery:function(e){var t,n="";return n="Requirement Specification"===e?"types/"+e+p.STR_BACKSLASH_DBL_QUOTE+p.STR_SPACE+p.STR_OR+p.STR_SPACE+"flattenedtaxonomies:"+p.STR_BACKSLASH_DBL_QUOTE+"types/Requirement Group":"types/"+e,t=p.STR_OWNER+p.STR_BACKSLASH_DBL_QUOTE+r.getUserLogin()+p.STR_BACKSLASH_DBL_QUOTE,p.LEFT_BRACKET+p.LEFT_BRACKET+"flattenedtaxonomies:"+p.STR_BACKSLASH_DBL_QUOTE+n+p.STR_BACKSLASH_DBL_QUOTE+p.RIGHT_BRACKET+p.STR_SPACE+p.STR_AND+p.STR_SPACE+t+p.RIGHT_BRACKET},_parseResponse:function(e){var t=[];if(e){var n=e.results;if(n&&n.length>0){for(var i=(new Date).getTime(),r=0,o=n.length;r<o;r++)if(n[r]&&n[r].attributes){for(var s=n[r].attributes,a={},l=0,c=s.length;l<c;l++)switch(s[l].name){case"ds6w:identifier":a.name=s[l].value;break;case"ds6w:label":s[l].dispValue?a["attribute[Title]"]=s[l].dispValue:a["attribute[Title]"]=s[l].value;break;case"ds6w:description":a.description=s[l].value;break;case"resourceid":a.physicalid=s[l].value;break;case"ds6w:what/ds6w:type":case"ds6w:type":UWA.is(s[l].displayName)||(s[l].displayName=s[l].dispValue?s[l].dispValue:s[l].value),a.type=s[l];break;case"ds6w:when/ds6w:modified":case"ds6w:when/ds6w:created":case"ds6w:modified":case"ds6w:created":try{if(s[l].dispValue){var d=new Date(s[l].dispValue).toLocaleString(this._currLang);"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=d:"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=d)}else{d=new Date(s[l].value).toLocaleString(this._currLang);"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=d:"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=d)}}catch(e){s[l].dispValue?"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=s[l].dispValue?s[l].dispValue:"":"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=s[l].dispValue?s[l].dispValue:""):"ds6w:when/ds6w:modified"===s[l].name||"ds6w:modified"===s[l].name?a.modified=d:"ds6w:when/ds6w:created"!==s[l].name&&"ds6w:created"!==s[l].name||(a.originated=d)}break;case"ds6wg:revision":a.revision=s[l].value;break;case"ds6w:what/ds6w:status":case"ds6w:status":var u=s[l].dispValue?s[l].dispValue:s[l].value;u&&(u.indexOf("Requirement Specification.")>-1||u.indexOf("Requirement Group.")>-1||u.indexOf("Requirement.")>-1)?a.current=u.slice(u.indexOf(".")+1):a.current=u||s[l].value;break;case"ds6w:who/ds6w:responsible":case"ds6w:responsible":s[l].dispValue?a.owner=s[l].dispValue:a.owner=s[l].value;break;case"ds6w:who/ds6w:responsible/ds6w:organizationResponsible":case"ds6w:organizationResponsible":s[l].dispValue?a.organization=s[l].dispValue:a.organization=s[l];break;case"ds6w:what/ds6w:status/ds6w:reserved":case"ds6w:reserved":s[l].dispValue?a.reserved=s[l].dispValue:a.reserved=s[l].value;break;case"ds6w:where/ds6w:context/ds6w:project":case"project":s[l].dispValue?a.project=s[l].dispValue:a.project=s[l].value;break;case"type_icon_url":a.type_icon_url=s[l].value}void 0===a.description&&(a.description=""),t.push(a)}console.log("for loop data in "+((new Date).getTime()-i)+"ms")}}return t}};return _}),define("DS/RequirementStructureBrowser/controllers/RootNodeController",["DS/Controls/TabBar","DS/RequirementStructureBrowser/components/StructureRootNodes"],function(e,t){"use strict";function n(n){var i=this;i.elements={},i.elements.container=UWA.createElement("div",{class:"enx-leftsidepanel"}),i.elements.leftHeaderdiv=document.createElement("div"),i.elements.leftHeaderdiv.classList.add("enx-left-header"),i.elements.container.appendChild(i.elements.leftHeaderdiv),i.elements.leftsidetabbar=new e({displayStyle:"strip"}),i.elements.leftsidetabbar.onContextualMenuEvent(function(){return Promise.resolve([])}),i.elements.leftsidetabbar.getContent().setStyle("width","calc(100% - 38px)"),i.elements.leftHeaderdiv.appendChild(i.elements.leftsidetabbar.getContent()),i.elements.leftContentdiv=document.createElement("div"),i.elements.leftContentdiv.classList.add("enx-left-content"),i.elements.container.appendChild(i.elements.leftContentdiv),i.elements.rootLst=new t(n),i.elements.leftsidetabbar.add({label:i.elements.rootLst.getTabLabel(),isSelected:!0,value:"rootlst",icon:{iconName:"list",fontIconFamily:WUXManagedFontIcons.Font3DS}}),i.elements.leftContentdiv.appendChild(i.elements.rootLst.getContent()),i.elements.leftsidetabbar.addEventListener("change",function(e){switch(e.dsModel.value[0]){case"rootlst":i.elements.rootLst.setVisible(!0)}})}return n.prototype.getContent=function(){return this.elements.container},n}),define("DS/RequirementStructureBrowser/requirementServices/ColumnMgtService",["UWA/Core","UWA/Class","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/WebappsUtils/WebappsUtils","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","text!DS/RequirementStructureBrowser/assets/ColumnsMetas.json","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","DS/PADServices/utils/DictionaryAccess"],function(e,t,n,i,r,o,s,a,l,c){"use strict";var d=JSON.parse(s),u=null,p=null,h=null;return t.singleton({init:function(e){this._parent(e)},initialize:function(e){u=e;return e.columnManager=this,this.loadedProviders=null,u.optionalStartup.push(this._fetchColumnNls()),this._loadColumnsProviders()},_fetchColumnNls:function(){var e=[];(this.getAvailableAttributes()||[]).forEach((t,n)=>e.push(t.ds6w));var t=c.getResourcesInfo(e);return new Promise(function(e,n){t.then(function(t){h=t.reduce((e,t)=>Object.assign(e,{[t.curi]:t.label}),{}),e()}).catch(function(t){console.log(t),h=[],e()})})},getVisibleAdditionalColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag&&e.isAdditionalColumn})},getVisibleColumns:function(){return this.getAvailableColumnsWithNls().filter(function(e){return e.visibleFlag})},getAvailableColumnsWithNls:function(){return(this.getAvailableColumns()||[]).map(function(e){return e.text=h[e.ds6w]?h[e.ds6w]:e.text?e.text:u.getNls(e.ds6w),e})},getAvailableColumns:function(){var e=u.PrefService.getUserPreferences()?u.PrefService.getUserPreferences().columns:[],t={};if(e.forEach(function(e){t[e.dataIndex]=!0}),this.getAllProvidedColumns().forEach(function(n){t[n.dataIndex]||e.push(n)}),u.isAttributeManagmentEnabled()){var n=u.DataService.customerExtension,i=u.getCustomizedColumn();for(key in n)if(n.hasOwnProperty(key)){var r=n[key],o=i[key],s={dataIndex:"",dbName:"",text:"",kind:"",visibleFlag:!1};t[r.sixWTag]||(s.dataIndex=r.sixWTag,s.dbName=r.attrName,s.text=r.attrNls,s.kind=r.type,s.visibleFlag=!o.isHidden,e.push(s))}}return t=null,e},getDGVVisibleColumns:function(e){var t=u.getSetting("fetch").MQL_fetch.split(",");return e&&(t=u.getSetting("fetch").CV_fetch),this.getVisibleColumns().forEach(function(n){var i="";e?(i=n.dataIndex,-1===t.indexOf(i)&&"tree"!==i&&t.push(i)):(i=n.dbName?n.dbName:n.dataIndex?n.dataIndex.split(":")[1]:"",-1===t.indexOf(i)&&void 0!==i&&t.push("attribute["+i+"]"))}),t},getAvailableAttributeWithNls:function(){return(this.getAvailableAttributes()||[]).map(function(e){return e.text=e.text?e.text:u.getNls(e.ds6w),e})},getAvailableAttributes:function(){return(u.PrefService.getUserPreferences()?u.PrefService.getUserPreferences().columns:[]).filter(function(e){return!e.isAdditionalColumn})},_getColumnsProvidersDefinitions:function(){return u.getColumnProviderSetting()},getColumnsProviderWithMetas:function(e){var t=this._getColumnsProvidersDefinitions().find(function(t){return t.ID===e});return t&&this.loadedProviders?(t.instance=this.loadedProviders[e],t):null},getLoadedColumnProvidersAsArray:function(){var e=this;return this.getLoadedColumnProvidersIDAsArray().map(function(t){return e.getColumnsProviderWithMetas(t)})},_providerValidateAndRegister:function(e,t,n){return a.wrappedWithPromise(function(i,r){e.isAdditionalColumnsAvailable(function(r){!0===r&&(n[t||e.getName()]=e),i()})})},getLoadedColumnProvidersIDAsArray:function(){return this.loadedProviders?Object.keys(this.loadedProviders):[]},getAttributeMetas:function(e){return this.getAvailableAttributeWithNls().find(function(t){return t.dataIndex===e})},getAllProvidedColumns:function(){return this._retrieveProvidedColumns().map(function(e){return{dataIndex:e.dataIndex,kind:"string",provider:e.provider,visibleFlag:!1,isAdditionalColumn:!0,customisation:{layout:{removableFromView:!0,groupingLocked:!0,removable:!1},exportable:{lock:!0,value:!0}}}})},getMappingOfAdditionalColumns:function(e){if(!e&&this._cachedAdditionalColumnsMapping)return this._cachedAdditionalColumnsMapping;var t={};return this._retrieveProvidedColumns().forEach(function(e){t[e.dataIndex]=e}),this._cachedAdditionalColumnsMapping=t},_retrieveProvidedColumns:function(){if(Array.isArray(this._cachedAdditionalCols)&&this._cachedAdditionalCols.length>0)return this._cachedAdditionalCols;var e=[];return this.getLoadedColumnProvidersAsArray().forEach(function(t){if(t.instance&&"function"==typeof t.instance.getAdditionalColumnsUX){var n=[];t.instance.getAdditionalColumnsUX(n),e=e.concat(n.map(function(e){return e.provider=t.ID,e}))}}),this._cachedAdditionalCols=e,e},retrieveAvailableColumnProviders:function(){var e=this;return a.wrappedWithPromise(function(t,n){e._loadColumnsProviders().finally(function(){try{var i=e.getLoadedColumnProvidersAsArray().filter(e._shouldLoadColumnProvider.bind(e));t(i)}catch(e){n(e)}})})},_shouldLoadColumnProvider:function(e){return"whole"===e.loadingPolicy||this.getVisibleAdditionalColumns().some(function(t){return t.provider===e.ID})},_getQuantityViewColumns:function(){var e=this.getVisibleColumns();return e.filter(function(e){return(!e.ds6wFrom||"rel"!==e.ds6wFrom)&&-1===["Effectivity","VariantEffectivity","CurrentEvolutionEffectivity","ProjectedEvolutionEffectivity"].indexOf(e.ds6w)}),e},getAdditionalColumnDefinition:function(t){var n=this.getMappingOfAdditionalColumns()[t];if(n){var i={text:n.text,dataIndex:n.dataIndex,maxWidth:n.maxWidth,minWidth:n.minWidth,width:n.width};return-1!==["Effectivity","ProjectedEvolutionEffectivity","ConfigurationContext","EvolutionEffectivity"].indexOf(n.dataIndex)?e.extend(i,{getCellValue:function(e){if(e&&e.nodeModel){var t=e.nodeModel.options.grid[n.dataIndex];return t?"Configuration"==n.dataIndex&&0===t.trim().length?t="":"function"==typeof t.trim&&0===t.trim().length&&(t=""):e.nodeModel.isRoot()&&(t=""),t}}}):e.extend(i,{typeRepresentation:"url",hyperlinkTarget:"_self",getCellValue:function(e){if(!e||!e.nodeModel)return{};var t=e.nodeModel.options.grid[n.dataIndex];return t||(t=e.nodeModel.isRoot()?"":"None"),{label:t,url:"#UNEXISTANT_ID"}},getCellValueForCopy:function(e){return e.cellModel.label},getCellValueForExport:function(e){if(e.nodeModel)return e.cellModel.label}})}},_setCellValue:function(e,t,n){var i=this.getAttributeMetas(t);(i?i.dbName:null)&&u.getModels().updateNodesByID(data)},_loadColumnsProviders:function(){var e=this;return e._cachedColProvPromise?e._cachedColProvPromise:a.wrappedWithPromise(function(t,n){if(e.loadedProviders)return t();e._cachedColProvPromise=u.loadFiles(e._getColumnsProvidersDefinitions().map(function(e){return e.loader})).then(function(){for(var n=arguments[0],i=[],r={},o=0;o<n.length;o++){var s=e._getColumnsProvidersDefinitions()[o],l=n[o];s&&l&&(i.push(e._providerValidateAndRegister(l,s.ID,r)),s.isInternal&&"function"==typeof l.bindApp&&l.bindApp(u))}a.allSettled(i).then(function(){e.loadedProviders=r,t(!0)})}).catch(function(e){n(e)})})},getDatagridViewColumns:function(){var e=this;this.getMappingOfAdditionalColumns(!0);var t=e._getQuantityViewColumns();return null==p&&(p=JSON.parse(JSON.stringify(u.defaultAttributeRange))),t.map(function(t){return t.isAdditionalColumn?e.getAdditionalColumnDefinition(t.dataIndex):e.getColumnDefinition(t.dataIndex)}).filter(function(e){return e})},getColumnMetas:function(e){return d.common_column[e]&&d.common_column[e].options?d.common_column[e].options:{}},getColumnDefinition:function(t){var n=this;if(!t)return null;var r=(n=this).getAttributeMetas(t),s=r.ds6wFrom&&"rel"===r.ds6wFrom?{iconName:"flow-cascade dgv-header-icon",fontIconFamily:WUXManagedFontIcons.Font3DS}:void 0;switch(t){case"tree":return e.extend(this.getColumnMetas("tree"),{text:r.text,icon:s,getCellKPIColor:function(e){if(e.nodeModel)return e.nodeModel.getColor()},getCellValue:function(e){if(e&&e.nodeModel)return this.isCellInEdition(e.cellID)?e.nodeModel.options.grid["ds6w:label"]:e.nodeModel.options.label},setCellValue:function(e,n){if(0==n.length||""===n.trim())return o.warningAlert(u.getNls("Title_empty")),void e.nodeModel.updateOptions({});u.DataService.updateAttribute(e,n,t).then(function(t){t||(t=e.nodeModel),u.getModels().updateNodesByID(t)})}});case"ds6wg:revision":return e.extend(this.getColumnMetas(t),{text:r.text,hyperlinkTarget:"_self",icon:s,getCellValue:function(e){return e&&e.nodeModel?{label:e.nodeModel.options.grid[t]?e.nodeModel.options.grid[t]:"",url:"#UNEXISTANT_ID"}:{}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]},getCellValueForExport:function(e){if(e.nodeModel)return e.cellModel.label}});case"ds6w:reservedBy":case"ds6w:type":case"ds6w:identifier":return{text:r.text,dataIndex:t,icon:s};case"ds6w:reserved":return e.extend(this.getColumnMetas(t),{text:r.text,icon:s,getCellValue:function(e){if(e&&e.nodeModel)return"FALSE"===e.nodeModel.options.grid[t]?i.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_CheckIn.png"):"TRUE"===e.nodeModel.options.grid[t]?i.getWebappsAssetUrl("RequirementStructureBrowser","icons/32/I_lock.png"):"N/A"},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]},getCellValueForExport:function(e){if(e.nodeModel)return e.nodeModel.options.grid[t]}});case"ds6w:isLastRevision":return e.extend(this.getColumnMetas(t),{text:r.text,icon:s,getCellValue:function(e){return e&&e.nodeModel?(!e.nodeModel.options.grid[t]||"false"!==e.nodeModel.options.grid[t].toString().toLowerCase())&&(!(!e.nodeModel.options.grid[t]||"true"!==e.nodeModel.options.grid[t].toString().toLowerCase())||{}):{}},getCellClassName:function(e){var n=[];return e.nodeModel&&(e.nodeModel.options.grid[t]&&"false"===e.nodeModel.options.grid[t].toString().toLowerCase()?n.push("dgv-isLastRevision-false"):e.nodeModel.options.grid[t]&&"true"===e.nodeModel.options.grid[t].toString().toLowerCase()&&n.push("dgv-isLastRevision-true")),n.join(" ")}});case"ds6w:status":case"ds6w:responsible":return e.extend(this.getColumnMetas(t),{text:r.text,hyperlinkTarget:"_self",icon:s,getCellValue:function(e){return e&&e.nodeModel?{label:void 0===e.nodeModel.options.grid[t]?"":e.nodeModel.options.grid[t],url:"#UNEXISTANT_ID"}:{}},getCellValueForCopy:function(e){return e.cellModel.label},getCellGroupingKey:function(e){return e.nodeModel.options.grid[t]},getCellValueForExport:function(e){if(e.nodeModel)return e.cellModel.label}});case"ds6w:refinedInto":case"ds6w:covers":return e.extend(this.getColumnMetas(t),{text:r.text,hyperlinkTarget:"_self",typeRepresentation:"url",setCellValue:function(e,n){u.DataService.updateAttribute(e,n,t).then(function(e){u.getModels().updateNodesByID(e)})},getCellValue:function(e){if(e&&e.nodeModel)return{label:e.nodeModel.options.grid[t],url:"#UNEXISTANT_ID"}},getCellEditableState:function(e){return!1},getCellValueForExport:function(e){if(e.nodeModel)return e.nodeModel.options.grid[t]}});case"paramContent":return e.extend(this.getColumnMetas(t),{text:u.getNls(t),typeRepresentation:"string",getCellValue:function(e){if(e&&e.nodeModel)return"PlmParameter"===e.nodeModel.options.reqKindOf||"PARParameter"===e.nodeModel.options.reqKindOf?e.nodeModel.options.grid.paramContent:void 0},getCellEditableState:function(e){return!1}});case"ds6w:description":return e.extend(this.getColumnMetas(t),{text:r.text,typeRepresentation:"string",setCellValue:function(e,n){u.DataService.updateAttribute(e,n,t).then(function(e){u.getModels().updateNodesByID(e)})},getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid["ds6w:description"]},getCellEditableState:function(e){return!1}});case"ds6wg:requirement category":return e.extend(this.getColumnMetas(t),{text:u.getNls(t),typeRepresentation:"string",editionPolicy:"EditionOnDoubleClick",setCellValue:function(e,t){u.DataService.updateAttribute(e,t,"Requirement Category").then(function(e){u.getModels().updateNodesByID(e)})},getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid["ds6wg:requirement category"]}});case"ds6w:realizedChangeAction":return e.extend(this.getColumnMetas(t),{text:r.text,editionPolicy:"EditionInPlace",typeRepresentation:"mandatory",setCellValue:function(e,n){var i=1==n?"Set":"UnSet",r=e.nodeModel.options.resourceid;u.DataService.setUnsetWorkUnderControl(r,i).then(function(n){n&&("any"==n.CCValue?e.nodeModel.options.grid[t]="TRUE":e.nodeModel.options.grid[t]="FALSE"),u.getModels().updateNodesByID(e.nodeModel)})},getCellValue:function(e){if(e&&e.nodeModel)return e.nodeModel.options.grid[t]},getCellTypeRepresentation:function(e){if(e.nodeModel)return"TRUE"!==e.nodeModel.options.grid[t]&&"FALSE"!==e.nodeModel.options.grid[t]?"string":"mandatory"},getCellEditableState:function(e){if(e.nodeModel)return"TRUE"===e.nodeModel.options.grid[t]||"FALSE"===e.nodeModel.options.grid[t]}});case"ds6w:priority":case"ds6w:difficulty":case"ds6w:classification":case"ds6w:importance":return e.extend(this.getColumnMetas(t),{text:r.text,typeRepresentation:"enumString",setCellValue:function(e,t){t=p[r.dbName][t]?p[r.dbName][t]:t,u.DataService.updateAttribute(e,t,r.dbName).then(function(e){null!=e&&u.getModels().updateNodesByID(e)})},getCellSemantics:function(e){if("Requirement"===e.nodeModel.options.reqKindOf){var t=u.defaultAttributeRange[r.dbName];for(var n in t)t[n]=n;return{possibleValues:t}}return{possibleValues:[]}},getCellValue:function(e){if(e&&e.nodeModel){if("Requirement"===e.nodeModel.options.reqKindOf){var n=e.nodeModel.options.grid[t],i=p[r.dbName];return Object.keys(i).find(e=>i[e]===n)?Object.keys(i).find(e=>i[e]===n):n}return""}},getCellEditableState:function(e){if(e&&e.nodeModel&&"Requirement"===e.nodeModel.options.reqKindOf)return!0}});default:if(r){var a=u.DataService.getCustomerAttribute(t);let e=a[0]?a[0]:r;a.length>1&&(e.isReadOnly=!0);let i="true"===e.isMultiValuated;e.attrNls&&(r.text=e.attrNls),"boolean"===r.kind&&(e.authorizedValues='{"TRUE":"TRUE","FALSE":"FALSE"}');var l={text:r.text?r.text:u.getNls(t),dataIndex:t,editionPolicy:"EditionOnDoubleClick"};let o=(e.authorizedValues?e.authorizedValues.length:0)>0;return l.getCellTypeRepresentation=function(){let t=r.kind;if(e.dataType=t,i)return"string";if(o)t="enumString";else{if(-1!==["real","double"].indexOf(t.toLowerCase()))return"float";if(-1!==["datetime","timestamp"].indexOf(t.toLowerCase()))return"date"}return t},l.getCellValue=function(r){if(i)return n.getMultivalueToDisplay(r,e,t);if(r&&r.nodeModel){var s=r.nodeModel.options.grid[t];if(""!=s&&null!=s&&null!=s){if(o){var a=e.authorizedValues;a=JSON.parse(a.toString());var l=s.split(","),c=[];return l.forEach(function(e){for(var t in a)if(e===a[t]){c.push(t);break}}),c[0]}return s}}},l.setCellValue=function(n,i){-1!==["datetime","timestamp"].indexOf(r.kind.toLowerCase())&&null!==i&&(i=(i=new Date(i)).toGMTString()),i=i.toString(),u.DataService.updateAttribute(n,i,e.attrName).then(function(e){null!=e&&(e.options.grid[t]=i,u.getModels().updateNodesByID(e))})},l.getCellEditableState=function(r){return!i&&n.getCellEditableState(r,e,t)},o&&(l.getCellSemantics=function(n){var i=e.authorizedValues;return i=JSON.parse(i.toString()),void 0!==n.nodeModel.options.grid[t]?{possibleValues:i}:{possibleValues:[]}}),l}}},getCellEditableState:function(e,t,n){if(!e.nodeModel)return!0;if("true"===t.isMultiValuated)return!1;try{var i=e.nodeModel.options.reqInterface?e.nodeModel.options.reqInterface:[];if((null!==i&&-1!==i.indexOf(t.extensionName)||e.nodeModel.options.type===t.extensionName)&&void 0!==e.nodeModel.options.grid[n])return!1===t.isReadOnly}catch(e){return console.log(e),!1}return!1},getMultivalueToDisplay:function(t,n,i){var r=t.nodeModel.options.grid[i];if(""===(r=r||""))return"";var o=r.split(","),s=[];try{if(n.authorizedValues&&n.authorizedValues.length>0){Array.isArray(n.authorizedValues)&&(n.authorizedValues=n.authorizedValues.toString());var a=e.is(n.authorizedValues,"string")?JSON.parse(n.authorizedValues):n.authorizedValues;o.forEach(function(e){for(var t in a)if(e===a[t]){s.push(t);break}})}else if(-1!==["datetime","timestamp"].indexOf(n.dataType.toLowerCase())){for(var l=0;l<o.length;l++)if(""!==o[l]){isNaN(o[l])||(o[l]=parseInt(o[l]),o[l]=1e3*o[l]);let e=new Date(o[l]).toLocaleString("en",{month:"short",day:"numeric",year:"numeric"});s.push(e)}}else for(l=0;l<o.length;l++)s.push(o[l])}catch(e){for(l=0;l<o.length;l++)s.push(o[l]);console.log(e)}return s}})}),define("DS/RequirementStructureBrowser/requirementServices/StructureEditorDataService",["DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/RequirementStructureBrowser/treemodel/RequirementWSAccess","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","UWA/Core","UWA/Class/Promise","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","DS/PADUtils/PADSettingsMgt","DS/TraceableRequirementsUtils/utils/TRMReportPanel","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","DS/Core/PointerEvents"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,h,f,g){var m=function(){};return m.prototype.init=function(e){this.app=e,this.req_navigate_options=JSON.parse(c),this.isChangeEnabled="false",this.isConcurrentEngineeringEnabled="false",this.customerAttributeToFetch=[],this.customerExtension=[];var t=this.loadListOfAttributes();e.optionalStartup.push(t),this.loadConfigurationSettings();var n=this.req_navigate_options.DefaultRangeAttribute;this.getAttributeRange(n)},m.prototype.setUnsetWorkUnderControl=function(t,n){var s="pid:"+t,a=[];a.push(s);var l={};return l="Set"==n?{ObjectsListForSetChangeControl:a}:{ObjectsListForUnSetChangeControl:a},e.wrappedWithPromise(function(e,t){r.enforceWorkUnder({json:l,securityContext:i.getSecurityContext(),tenant:i.getTenant(),onComplete:function(t){var n={};if((t=UWA.is(t,"string")?JSON.parse(t):t)&&t.objectListChangeControlled){var i=t.objectListChangeControlled[0];i&&(n.CCValue=i.changeControlValue)}t&&t.ChangeData&&(n.ChangeData=t.ChangeData[0]),e(n)},onFailure:function(t,n){var i=UWA.is(n,"string")&&JSON.parse(n);i=JSON.parse(n),o.errorAlert(i.errorMessage),e()}})})},m.prototype.updateAttribute=function(t,s,a){var l=this,c=[],u=null;return u="tree"===a?"Title":"ds6w:difficulty"===a?"Difficulty":"ds6w:priority"===a?"Priority":"ds6w:importance"===a?"User Requirement Importance":"ds6w:status"===a?"current":a,c.push({name:u,value:s}),0===c.length?reject("invalid input"):e.wrappedWithPromise(function(e,s){var a=t.nodeModel.getID(),u=t.nodeModel.options.cestamp;r.getInfo({securityContext:i.getSecurityContext(),pid:a,selectables:"cestamp,current.access[modify]",onComplete:function(t){var s=(UWA.is(t,"string")?JSON.parse(t):t).results[0];"FALSE"===s["current.access[modify]"]?(o.errorAlert(d.EditionModifyAccess),e()):"true"==l.isConcurrentEngineeringEnabled&&s.cestamp!=u?(o.errorAlert(d.EditionNotUpToDate),e()):r.edit({pid:a,json:{attributes:c},securityContext:i.getSecurityContext(),onComplete:function(t){var r=(UWA.is(t,"string")?JSON.parse(t):t).results,s=n.process.createNode({treedocument:l.app,data:r,tenant:i.getTenant()},l.app.externalTypes),a=(UWA.is(r.type,"object")?r.type.displayName:r.type)+" "+r.name+" "+r.revision,c=d.ENOTRMApp_Notif_ObjectUpdated;c=c.replace("{TNR}",a),o.sucessAlert(c),e(s)},onFailure:function(t,n){n=UWA.is(n,"string")?JSON.parse(n):n;o.errorAlert(n.message),e()}})},onFailure:function(e,t){console.log(t)}})})},m.prototype.getAttributeRange=function(t){var n=this,o=((new Date).getTime(),[]);t.forEach(function(t){o.push(e.wrappedWithPromise(function(e,o){r.getAttributeRange({securityContext:i.getSecurityContext(),attributeName:t,onComplete:function(i){var r=(UWA.is(i,"string")?JSON.parse(i):i).results.toString();n.app.defaultAttributeRange[t]=JSON.parse(r),e(n.app.defaultAttributeRange.attrName)},onFailure:function(e){console.log(e)}})}))})},m.prototype.getParameterInfo=function(e){var t=[],n=this;function i(e,i){var o={physicalid:e.join(",")},s=n.req_navigate_options.expand.mql_expand_data.object_selects;n.getObjectsInfoArray(o,s).then(function(t){for(var i=0;i<e.length;i++)for(var r=0;r<n.app.getModels().getNodesById(e[i]).length;r++)n.app.getModels().getNodesById(e[i])[r].updateOptions(t[i].options)}).catch(function(e){console.log(e)}),r(t,i+100)}function r(e,t){e.length-t>0&&i(e.slice(t,t+100),t)}!function e(n){if(n)for(var i=0;i<n.length;i++)"PlmParameter"==n[i].options.type?-1==t.indexOf(n[i].options.resourceid)&&t.push(n[i].options.resourceid):t.concat(e(n[i].getChildren()))}(e),t.length>100?r(t,0):t.length>0&&i(t,0)},m.prototype.updateConfigurationData=function(e){this.app.getModels().updateConfiguredTreeNodes(e)},m.prototype.createRootObject=function(t){var n=this;return e.wrappedWithPromise(function(e,s){if(!t)return s("invalid input");r.create({type:t,securityContext:i.getSecurityContext(),json:{ReQConfigAuthManagement:n.isChangeEnabled},onComplete:function(t){var i=(UWA.is(t,"string")?JSON.parse(t):t).results;n.getObjectInfo(i).then(function(t){var n=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision,r=d.ENOTRMApp_Notif_ObjectUpdated;r=r.replace("{TNR}",n),o.sucessAlert(r),e(t)}).catch(function(e){console.log(e)})},onFailure:function(e,t){if(UWA.is(e,"string"))try{e=JSON.parse(t)}catch(e){}if(UWA.is(t,"string"))try{t=JSON.parse(t)}catch(e){}UWA.is(t)&&UWA.is(t.message,"string")?o.errorAlert(t.message):UWA.is(e)&&UWA.is(e.message,"string")?o.errorAlert(e.message):UWA.is(e,"string")?o.errorAlert(e):console.error('"RequirementWebServices.create(...)" failed without returning an error message!')}})})},m.prototype.setTreeOrder=function(t){var n=t.physicalid,s=t.currentObjRelID,a=t.nextSiblingRelID;return e.wrappedWithPromise(function(e,l){r.setAttributeTreeOrder({securityContext:i.getSecurityContext(),json:{pid:n,currentObjRelID:s,nextSiblingRelID:a},onComplete:function(n){n=(n=UWA.is(n,"string")?JSON.parse(n):n).status,n=UWA.extend(n,t),e(n)},onFailure:function(e,t){t=UWA.is(t,"string")?JSON.parse(t):t,o.errorAlert(t.message),l()}})})},m.prototype.getTreeOrder=function(t){var n=t.physicalid;return e.wrappedWithPromise(function(e,s){r.getAttributeTreeOrder({securityContext:i.getSecurityContext(),pid:n,onComplete:function(n){n=(n=UWA.is(n,"string")?JSON.parse(n):n).results[0],n=UWA.extend(n,t),e(n)},onFailure:function(e,t){t=UWA.is(t,"string")?JSON.parse(t):t,o.errorAlert(t.message),s()}})})},m.prototype.getObjectInfo=function(t){var s=this,a=s.app.columnManager.getDGVVisibleColumns();a=(a=a.join(",")).concat(",cestamp");var c=t.physicalid;return e.wrappedWithPromise(function(e,d){r.getInfo({securityContext:i.getSecurityContext(),pid:c,selectables:a,onComplete:function(r){r=(r=UWA.is(r,"string")?JSON.parse(r):r).results[0],r=UWA.extend(r,t);var o=n.process.createNode({treedocument:s.app,data:r,tenant:i.getTenant()},s.app.externalTypes);e(o)},onFailure:function(e,t){(t=UWA.is(t,"string")?JSON.parse(t):t).message===l.objectNotExist?o.errorAlert(l.objectDeleted):o.errorAlert(t.message),d()}})})},m.prototype.getObjectsInfoArray=function(t,o){var s=this,a=t.physicalid;return e.wrappedWithPromise(function(e,t){r.getInfo({securityContext:i.getSecurityContext(),pid:a,selectables:o,onComplete:function(t){var r=(UWA.is(t,"string")?JSON.parse(t):t).results,o=[];r.forEach(function(e){var t=n.process.createNode({treedocument:s.app,data:e,tenant:i.getTenant()},s.app.externalTypes);o.push(t)}),e(o)},onFailure:function(e){console.log(e)}})})},m.prototype.getExpandData=function(t){var o=!1;!0===p.getSetting("useOptimizedLoading")&&(o=!0);var s=this;return e.wrappedWithPromise(function(e,a){var l=UWA.extend({root_physical_id:t.options.resourceid,type_filter:s.req_navigate_options.expand.cv_expand_data.no_folder_expand.type_filter_bo,rel_filter:s.req_navigate_options.expand.cv_expand_data.no_folder_expand.type_filter_rel,object_selects:s.req_navigate_options.expand.mql_expand_data.object_selects,relationship_selects:["physicalid[connection]","level","attribute[TreeOrder]","type[connection]"]});"Requirement Specification"===t.options.reqKindOf?(l.type_filter=s.req_navigate_options.expand.cv_expand_data.no_folder_expand.type_filter_bo,l.rel_filter=s.req_navigate_options.expand.cv_expand_data.no_folder_expand.type_filter_rel):"Requirement Group"===t.options.reqKindOf?(l.type_filter=s.req_navigate_options.expand.cv_expand_data.folder_expand.type_filter_bo,l.rel_filter=s.req_navigate_options.expand.cv_expand_data.folder_expand.type_filter_rel):l=UWA.extend(l,s.req_navigate_options.expand.cv_expand_data.no_folder_expand,!0),l.object_selects=s.app.columnManager.getDGVVisibleColumns(),l.object_selects.push("cestamp"),r.expand({securityContext:i.getSecurityContext(),json:l,OptimizedLoading:o,onComplete:function(r){var o=(UWA.is(r,"string")?JSON.parse(r):r).results,a=[t];o.forEach(function(e){var t=n.process.createNode({treedocument:s.app,data:e,tenant:i.getTenant()},s.app.externalTypes),r=parseInt(e.level);r>=1&&(a[r]=t,a[r].options.children=null,a[r-1].childComputed=!0,a[r-1].addChild(a[r]))}),e(t)},onFailure:function(e){console.log(e)}})})},m.prototype.getConfigSettings=function(){return Array.isArray(this.configSettings)?this.configSettings:[]},m.prototype.getEnforceSettings=function(){return this.isChangeEnabled},m.prototype.InsertExisting=function(e){var t=this,n=e.droppedData,s=e.json,c={Success:[],Failure:[]},d=function(e,t){var n,i,r=[],o=t;for(n=0,i=e.length;n<i;n+=o)r.push(e.slice(n,n+o));return r}(s.dataArray,10),u=0;t.app.beginBlockingTransaction(f.composite);for(var p=d.length,g=0;g<p;g++){var m=new a(function(e,s){var a={dataArray:d[g]};r.insertExisting({securityContext:i.getSecurityContext(),json:a,onComplete:function(i){u++;var r=(UWA.is(i,"string")?JSON.parse(i):i).results;r.Success.forEach(function(e){c.Success.push(e)}),r.Failure.forEach(function(e){c.Failure.push(e)}),r.Success.length>0&&(t.app.refreshOnInsert(r.Success,!1,"insertExisting"),void 0!==n&&n.length>0&&n.forEach(function(e){t.app.getModels().removeRoot(e)})),u===d.length&&e()},onFailure:function(n,i){u++,i=UWA.is(i,"string")?JSON.parse(i):i,o.errorAlert(i.message),t.app.endBlockingTransaction(),u===d.length&&e()},onTimeout:function(){u++,o.errorAlert(l.Requirement_Notif_RequestTimeout),t.app.endBlockingTransaction(),u===d.length&&e()}})});a.allSettled(m).then(function(){if(s.dataArray.length>1)(c.Failure.length>0||c.Success.length>0)&&new h({title:"InsertExisting",reportData:c});else{if(c.Success.length>0){var e=c.Success[0],n=(UWA.is(e.type,"object")?e.type.displayName:e.type)+" "+e.name+" "+e.revision;i=(i=l.InsertExisting_Success_msg).replace("{TNR}",n),o.sucessAlert(i)}if(c.Failure.length>0){var i;e=c.Failure[0],n=(UWA.is(e.type,"object")?e.type.displayName:e.type)+" "+e.name+" "+e.revision;i=(i=l.InsertExisting_Failure_msg+" "+l.FailureReasons).replace("{TNR}",n),o.errorAlert(i)}}t.app.endBlockingTransaction()})}},m.prototype.reorder=function(e){var t=this;r.reorder({securityContext:i.getSecurityContext(),json:e,onComplete:function(e){var n=(UWA.is(e,"string")?JSON.parse(e):e).results;if(n.Success.length>0&&t.app.refreshOnDnD(n.Success,!1,"MOVE"),n.Success.length>1||n.Failure.length>1)new h({title:"DragNDrop",reportData:n});else{if(n.Success.length>0){var i=n.Success[0],r=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision;s=(s=l.DragNDrop_Success_msg).replace("{TNR}",r),o.sucessAlert(s)}if(n.Failure.length>0){var s;i=n.Failure[0],r=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision;s=(s=i.errorMsg?l[i.errorMsg]:l.DragNDrop_Failure_msg+" "+l.FailureReasons).replace("{TNR}",r),o.errorAlert(s)}}t.app.endBlockingTransaction()},onFailure:function(e){e=UWA.is(e,"string")?JSON.parse(e):e,o.errorAlert(l.DragNDrop_error+e.message),t.app.endBlockingTransaction()},onTimeout:function(){o.errorAlert(RequirementNls.Requirement_Notif_RequestTimeout),t.app.endBlockingTransaction()}})},m.prototype.getUserRecentsItems=function(t){var n=this,i=n.app.PersistencyManager.getRecentItems();if(i){var r=[];i.split(",").forEach(function(t){r.push(e.wrappedWithPromise(function(e,i){var r={physicalid:t};n.getObjectInfo(r).then(function(t){e(t)}).catch(function(e){i()})}))}),e.allSettled(r).then(function(e){e.forEach(function(e){"fullfilled"===e.state&&t.addRoot(e.value)}),t.getModelEvents().publish({event:"TRMViews-recent-model-update"})}).catch(function(e){console.log(e)})}else i="",t.getModelEvents().publish({event:"TRMViews-recent-model-update"})},m.prototype.loadListOfAttributes=function(t){var n=this;return this._retrieveCustomerColumnsPromise?this._retrieveCustomerColumnsPromise:e.wrappedWithPromise(function(e,i){n._retrieveCustomerColumnsPromise=n.retrieveCustomerColumns(t).finally(function(){e(n._retrieveCustomerColumnsPromise)})})},m.prototype.retrieveCustomerColumns=function(t){var n=this;return e.wrappedWithPromise(function(e,t){var o={securityContext:i.getSecurityContext(),onComplete:function(t){(t=UWA.is(t,"string")?JSON.parse(t):t).results?(t.results=n._buildAuthorizedValuesArray(t.results),n._storeCustomerAttributes(t.results)):t.Dictionary&&n._filterAndStoreCustomerAttributes(t.Dictionary,t.DictionaryNLS),e(n.customerExtension)},onFailure:function(e){console.log(e)}},s=[];n.app.isAttributeManagmentEnabled()?(n.app.getCustomizedColumn().forEach(function(e){var t=e.dataIndex?e.dataIndex.substring(e.dataIndex.indexOf(":")+1,e.dataIndex.length):"";void 0!==t&&""!==t&&s.push(t)}),o.attributes=s.join(","),r.getAttributeInfo(o)):r.getDictionaryCUSTO(o)})},m.prototype._storeCustomerAttributes=function(e){var t=this;for(key in this.customerAttributes=e,t.customerExtension=[],e)e.hasOwnProperty(key)&&e[key].forEach(function(e){t.customerExtension.push(e)})},m.prototype._filterAndStoreCustomerAttributes=function(e,t){var n=this;if(this.customerAttributes=e,n.customerExtension=[],e&&e.Types)for(key in e.Types)if(e.Types.hasOwnProperty(key)&&e.Types[key].Attributes){var i=n.req_navigate_options.Customized_types;if(i.indexOf(e.Types[key].Parent)>-1||i.indexOf(e.Types[key].FirstOOTB)>-1)for(AttKey in e.Types[key].Attributes)e.Types[key].Attributes[AttKey].attrNls=t["Attribute."+AttKey],e.Types[key].Attributes[AttKey].attrName=e.Types[key].Attributes[AttKey].Name,e.Types[key].Attributes[AttKey].sixWTag?e.Types[key].Attributes[AttKey].sixWTag=e.Types[key].Attributes[AttKey].sixWTag:e.Types[key].Attributes[AttKey].sixWTag="ds6wg:"+e.Types[key].Attributes[AttKey].Name,e.Types[key].Attributes[AttKey].type=e.Types[key].Attributes[AttKey].Type,e.Types[key].Attributes[AttKey].extensionName=e.Types[key].Name,e.Types[key].Attributes[AttKey].preferredunitNls=e.Types[key].Attributes[AttKey].ManipulationUnit,e.Types[key].Attributes[AttKey].UIAccess&&"readwrite"==e.Types[key].Attributes[AttKey].UIAccess.toLowerCase()?e.Types[key].Attributes[AttKey].isReadOnly=!1:e.Types[key].Attributes[AttKey].isReadOnly=!0,e.Types[key].Attributes[AttKey].dimension=e.Types[key].Attributes[AttKey].Dimension,e.Types[key].Attributes[AttKey].defaultValue=e.Types[key].Attributes[AttKey].Default,e.Types[key].Attributes[AttKey].authorizedValues=n._translateAuthorizedValuesArray(e.Types[key].Attributes[AttKey].AuthorizedValues,AttKey,t),e.Types[key].Attributes[AttKey].MultiValuated&&"yes"==e.Types[key].Attributes[AttKey].MultiValuated.toLowerCase()?e.Types[key].Attributes[AttKey].isMultiValuated="true":e.Types[key].Attributes[AttKey].isMultiValuated="false",e.Types[key].Attributes[AttKey].Multiline&&"yes"==e.Types[key].Attributes[AttKey].Multiline.toLowerCase()?e.Types[key].Attributes[AttKey].isMultiline=!0:e.Types[key].Attributes[AttKey].isMultiline=!1,n.customerExtension.push(e.Types[key].Attributes[AttKey])}if(e&&e.Interfaces){var r=n.app.getSetting("authorized_types"),o=n.app.getModels()._defaultTypes;for(key in e.Interfaces)e.Interfaces.hasOwnProperty(key)&&e.Interfaces[key].Attributes&&e.Interfaces[key].ScopeTypes&&e.Interfaces[key].ScopeTypes.forEach(function(i){var s=o[i]?o[i]:i;if(r.indexOf(s)>-1){var a=e.Interfaces[key].Attributes;for(AttKey in a)a[AttKey].attrNls=t["Attribute."+AttKey]?t["Attribute."+AttKey]:t["Attribute."+e.Interfaces[key].Name+"."+AttKey],"OtbERConfiguration"==e.Interfaces[key].Package?(a[AttKey].attrName=e.Interfaces[key].Name+"."+a[AttKey].Name,a[AttKey].authorizedValues=n._translateAuthorizedValuesArray(a[AttKey].AuthorizedValues,e.Interfaces[key].Name+"."+AttKey,t)):(a[AttKey].attrName=a[AttKey].Name,a[AttKey].authorizedValues=n._translateAuthorizedValuesArray(a[AttKey].AuthorizedValues,AttKey,t)),a[AttKey].sixWTag?a[AttKey].sixWTag=a[AttKey].sixWTag:a[AttKey].sixWTag="ds6wg:"+a[AttKey].attrName,a[AttKey].type=a[AttKey].Type,a[AttKey].extensionName=e.Interfaces[key].Name,a[AttKey].preferredunitNls=a[AttKey].ManipulationUnit,a[AttKey].UIAccess&&"readwrite"==a[AttKey].UIAccess.toLowerCase()?a[AttKey].isReadOnly=!1:a[AttKey].isReadOnly=!0,a[AttKey].dimension=a[AttKey].Dimension,a[AttKey].defaultValue=a[AttKey].Default,a[AttKey].MultiValuated&&"yes"==a[AttKey].MultiValuated.toLowerCase()?a[AttKey].isMultiValuated="true":a[AttKey].isMultiValuated="false",a[AttKey].Multiline&&"yes"==a[AttKey].Multiline.toLowerCase()?a[AttKey].isMultiline=!0:a[AttKey].isMultiline=!1,n.customerExtension.push(a[AttKey])}})}},m.prototype._buildAuthorizedValuesArray=function(e){for(var t in e)e[t].forEach(function(e){e.authorizedValues=e.authorizedValues?e.authorizedValues.split(","):[],e.attrName&&(e.alphaNumAttrName=e.attrName.replace(/[^a-zA-Z0-9 ]/g,""))});return e},m.prototype._translateAuthorizedValuesArray=function(e,t,n){var i="{";if(e&&n&&t)for(let r=0;r<e.length;r++){i=i+'"'+(n["Range."+t+"."+e[r]]?n["Range."+t+"."+e[r]]:e[r])+'":"'+e[r]+'",'}return e=(i="{"!==i?i.slice(0,-1)+"}":void 0)?i.split(","):[]},m.prototype.getCustomerAttribute=function(e){for(var t=[],n=0;n<this.customerExtension.length;n++){e===(this.customerExtension[n].SixWPredicate?this.customerExtension[n].SixWPredicate:this.customerExtension[n].sixWTag)&&(this.customerAttributeToFetch.push(this.customerExtension[n]),t.push(this.customerExtension[n]))}return t},m.prototype.loadConfigurationSettings=function(){var t=this;return e.wrappedWithPromise(function(e,n){if(t.configSettingsIsLoaded)return e(t.getConfigSettings());r.getConfigSettings({securityContext:i.getSecurityContext(),json:{version:"1.0",settings:["DecoupleVariantEvolution"]},onComplete:function(n){t.configSettingsIsLoaded=!0,n=JSON.parse(n),Array.isArray(n.settings)&&(t.configSettings=n.settings),e(n)},onFailure:function(e){console.log(e)}}),r.getReQConfigAuthManagement({onComplete:function(e){JSON.parse(e).family.forEach(function(e){"WorkUnderConfiguration"==e.id?e.parameter.forEach(function(e){"ReqECCEnabled"==e.id&&e.argument.forEach(function(e){"Enabled"===e.argValue&&(t.isChangeEnabled="true")})}):"ConcurrentEngineering"==e.id&&e.parameter.forEach(function(e){"ReqCEEnabled"==e.id&&e.argument.forEach(function(e){"Enabled"===e.argValue&&(t.isConcurrentEngineeringEnabled="true")})})})},onFailure:function(e){console.log(e)}})})},m}),define("DS/RequirementStructureBrowser/treemodel/RequirementTreeDocument",["DS/Tree/TreeDocument","DS/PADUtils/PADSettingsMgt","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/RequirementStructureBrowser/treemodel/RequirementWSAccess","DS/PADUtils/views/PADAlert","i18n!DS/PADUtils/assets/nls/PADUtils.json","DS/PADUtils/PADSession","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/PADUtils/PADProbes","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","DS/TraceableRequirementsUtils/REQCommandProxy","DS/TraceableRequirementsUtils/Services/RequirementWebServices","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/RequirementStructureBrowser/treemodel/RequirementNodeModel","DS/PADServices/utils/AttributesMgt","i18n!DS/RichView/assets/nls/RichView","DS/Utilities/Array","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/treemodel/ReqTransactionManager","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/TraceableRequirementsUtils/utils/TRMReportPanel","DS/PADServices/utils/DictionaryAccess"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,h,f,g,m,v,_,y,S,b,A,C){"use strict";return e.extend(S,{name:"pad_treedocument",_insertFlag:!0,req_navigate_options:{},_defaultTypes:{},_selected_paths:[],_active_cutting_nodes:[],defaultOptions:{nodeModelClass:g},reroderSpecTypes:["Chapter","Comment","Requirement","Requirement Specification","Specification Folder"],externalTypes:["ProxyItem"],_relPattern:null,nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},init:function(e){var t=e||{};UWA.is(t.shouldAcceptDrop)||(t.shouldAcceptDrop=this._shouldAcceptDrop.bind(this)),UWA.is(t.shouldAcceptDrag)||(t.shouldAcceptDrag=this._shouldAcceptDrag.bind(this)),this._parent(t),this.getXSO().onPostAdd(this.selectionUpdated.bind(this)),this.getXSO().onPostRemove(this.selectionUpdated.bind(this)),this.reqCommandProxy=d.create(),this._defineDefaultTypes(),this._relPattern=JSON.parse(p),this.req_navigate_options=JSON.parse(a),this.subscribeModelEvents(),this},initialize:function(e){this.app=e},_selectOccurence:function(){var e=this.getRoots(),t=this._selected_paths,n=null,i=!0;if(t.length>0){n=this._selected_paths[0][this._selected_paths[0].length-1],this._doNotBroadcastSelect=!0,this.prepareUpdate();var r=[];if(e.forEach(function(e){for(var n=0;n<t.length;n++){var i=e.getNodeByPath(t[n]);i&&(r.push(i),i.isSelected()||i.select())}}),0===r.length){i=!1;for(var o=this.getSelectedNodes(),s=0;s<o.length;s++){o[s].getID()===n&&(i=!0)}if(!i&&this.getNodesById(n).length>0)this.unselectAll(),this.getNodesById(n).forEach(function(e){e.select()})}else{this.unselectAll();for(var a=0;a<r.length;a++)r[a].isSelected()||r[a].select()}this.pushUpdate(),this._doNotBroadcastSelect=!1}},subscribeModelEvents:function(){var e=this;e.getModelEvents().subscribe({event:"onRootAdded"},function(t){var n=t.data.added_nodes,i=e.getRoots(),r=[];i.forEach(function(e){r.push(e.getID())}),e.app.PersistencyManager.saveUserWorkingRootNodes(r),n&&n.forEach(function(t){e.app.PersistencyManager.addRecentItem(t.getID())}),n&&e.app._localModelEvent.publish({event:"RequirementStructureBrowser-Root-manage",data:{added_nodes:n}})}),e.getModelEvents().subscribe({event:"onRemoveRoot"},function(t){var n={pids:[t.data.pid]};e.app._localModelEvent.publish({event:"RequirementStructureBrowser-Root-remove",data:n})}),e.getModelEvents().subscribe({event:"onChildAdded"},function(t){var n=t.data;Array.isArray(n)||(n=[n]),e.updateConfiguredTreeNodes(n)})},shouldAcceptDrag:function(e,t){return!0},selectionUpdated:function(e){this.getSelectedNodes();this.app.active_view!==y.VIEW_STRUCTURE_BROWSER||this.app.richViewDropIn||this.updateStructureEditorDGV(),this.app.richViewDropIn=!1},setDnDBehavior:function(e){this._copyMode=e},setCuttingNodes:function(e){this._active_cutting_nodes=e},updateStructureEditorDGV:function(){var e=this.app.getSelectedNodes()[0];if(e){var t=e.options,n=e.options.reqKindOf;if(e.isRoot()||n===y.TYPE_REQUIREMENT_SPECIFICATION||"DOCUMENTS"===n){var i={paths:[e.options.resourceid],appId:widget.getValue("appId")};this.reqCommandProxy.drop(i)}this.app._padCommandProxy.select(this._buildSelectData()),t=e.getRoot().options,this.app._applicationChannel.publish({event:"structure-editor-add-title",data:t})}this.app._onSelect()},_buildSelectData:function(){var e=[],n=this._selected_paths;!0===t.getSetting("add_objects_when_select")&&n.length&&this.getXSO().get().length?this.getRoots().forEach(function(t){for(var i=0;i<n.length;i++){var r=t.getNodeByPath(n[i],void 0,void 0,!0);r&&e.push(r)}}):e=this.getXSO().get();var i,r={paths:[],tenant:h.getPlatformId()};r.attributes={},r.version="1.1";if(i=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(r),r.paths=e.map(function(e){return e.getOccurencePath(i)}),t.getSetting("authorizeChangeControl")){var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");try{r.changeControl=o.get()}catch(e){console.warn("No Change")}}return this._currentApp=h.getSharedId(),r.sharedID=this._currentApp,null===this._pagerview&&!0!==this._focusOn?r.focusOn=!1:r.focusOn=!0,r},add:function(e){var t=this,r=[];UWA.is(e.pids,"array")&&e.pids.forEach(function(e){-1===r.indexOf(e)&&UWA.is(e)&&r.push(e)});for(var a=this.getRoots(),l=0;l<a.length;l++){var c=r.indexOf(a[l].options.resourceid);-1!==c&&r.splice(c,1)}r.length>0?i.fetch({pids:r,authored:!0,onComplete:function(i){var a=UWA.is(i,"string")?JSON.parse(i):i;if(!a.results||a.results.length<r.length)if(s.determineAuthoredFlag())if(a.infos&&a.infos.sources&&a.infos.sources.length>0&&a.infos.sources[0].error){var l=a.infos.sources[0],c=l.error.errorMessage||"An error has occurred in "+l.name;f.errorAlert(c)}else s.setAuthoringState(!0,o.PADSession_disabling_index_object_not_found),t.add(e);else f.errorAlert(o.object_not_found_in_db);else{if(a.results.length>r.length)throw new Error("More results than input objects");if(!s.determineAuthoredFlag()&&1===a.results.length&&UWA.is(a.results[0]["type.kindof"])){var d=a.results[0]["type.kindof"];if(-1===t.req_navigate_options.root_type.indexOf(d))return f.warningAlert(o.replace(o.get("unsupported_type_v2"),{type:d})),e.callback.call(),t.getModelEvents().publish({event:"onReqAdded",data:{isremove:!0,added_node:1===t.getRoots().length?t.getRoots()[0]:null,nb_root:t.getRoots().length}}),void t.getModelEvents().publish({event:"onReqAdded",data:{isremove:!0,added_node:1===t.getRoots().length?t.getRoots()[0]:null,nb_root:t.getRoots().length}})}b.wrappedWithPromise(function(){t.unselectAll(),n.process.fetch({treedocument:t,response:a,authored:!0})});for(var u=widget.getValue("trm_tv_addednodes"),p=0;p<r.length;p++)UWA.is(u[r[p]])||(u[r[p]]={},u[r[p]].tenant=t.getTenant());widget.setValue("trm_tv_addednodes",u)}e.callback.call()},onFailure:function(t){f.errorAlert(o.generic_service_failure),e.callback.call()}}):e.callback.call()},calculateColoredSubject:function(e,t){var n=new Map;return e.forEach(function(e){var i,r,o;if(e.attributes.forEach(function(e){"resourceid"==e.name&&(i=e.value),"ds6w_facet"==e.format&&(o=e)}),o&&"date"==o.type){let e=new Date(o.value),n=e.toLocaleString("en",{year:"numeric"});r=n,t.get(r)||(n=e.toLocaleString("en",{month:"numeric"}),r=r+"/"+String(n).padStart(2,0)),t.get(r)||(n=e.toLocaleString("en",{day:"numeric"}),r=r+"/"+String(n).padStart(2,0))}else if(o&&UWA.is(o.value,"array")){var s;o.value.forEach(function(e){s=s?s+"/"+e:e,t.get(s)&&(r=s)})}else o&&(r=o.value);n.set(i,t.get(r))}),n},applyColor:function(e){var t=this;if(void 0!==e){var n=new Map;e.tagColors.forEach(function(e){n.set(e.object,e.color)});var i=e.tagColors[0].predicate.split("/"),r=i.length?i[i.length-1]:"",o=[];!function e(t){if(t)for(var n=0;n<t.length;n++)-1==o.indexOf(t[n].getID())&&o.push(t[n].getID()),o.concat(e(t[n].getChildren()))}(t.getRoots()),u.fetchPredicateData({predicate:r,PIDs:o,onComplete:function(e){var i,r=UWA.is(e,"string")?JSON.parse(e):e;r&&r.results&&(i=t.calculateColoredSubject(r.results,n)),t.getRoots().forEach(function(e){i.has(e.options.resourceid)&&e.setColor(i.get(e.options.resourceid)),e.getAllDescendants().forEach(function(e){i.has(e.options.resourceid)&&e.setColor(i.get(e.options.resourceid))})})},onFailure:function(e,t){t=UWA.is(t,"string")?JSON.parse(t):t;f.errorAlert(t.message)}})}else t.getRoots().forEach(function(e){e.resetColor(),e.getAllDescendants().forEach(function(e){e.resetColor()})})},applyFilter:function(e){var t,n=this.getRoots(),i=[];if(null===e)for(e={},t=0;t<n.length;t++)i.push(n[t].getID());else e.root_physicalid&&i.push(e.root_physicalid);var r=!1;if(void 0!==e.filterRootIds){var o=this;this.withTransactionUpdate(function(){for(t=0;t<e.filterRootIds.length;t++){var n=o.searchRootById(e.filterRootIds[t]);if(n)if(!0===e.empty){if(delete n.options.filtered,n.options.CVQuery=null,n.options.sequence_filter=null,n.options.config_filter=null,n.options.icons&&n.options.icons.length)"string"==typeof(l=UWA.clone(n.options.icons[0]))&&(l={iconPath:"url("+l+")"}),l.badges={bottomRight:null},n.updateOptions({icons:[l]});n.childComputed=!1,n.options.children=[],o.app.isConfigAuthorized()&&o.app.DataService.getExpandData(n).then(function(e){o.updateConfiguredTreeNodes([e]),o.app.DataService.getParameterInfo([e]);var t=e.getState();e.childComputed=!1,o.prepareUpdate(),"collapsed"===t?e.collapseAll():e.expandAll(),o.pushUpdate()})}else{if(r=!0,n.options.filtered=!0,n.options.CVQuery=e.CVQuery,e.CVQuery&&e.CVQuery.union&&e.CVQuery.union.expand)for(var i=!0,s=0;s<e.CVQuery.union.expand.length&&i;s++){1===(a=e.CVQuery.union.expand[s].root_path_physicalid).length&&-1!==a[0].indexOf(n.getID())&&(n.options.sequence_filter=e.CVQuery.union.expand[s].sequence_filter,n.options.config_filter=e.CVQuery.union.expand[s].config_filter)}else if(e.CVQuery&&e.CVQuery.intersection&&e.CVQuery.intersection.expand)for(i=!0,s=0;s<e.CVQuery.intersection.expand.length&&i;s++){var a;1===(a=e.CVQuery.intersection.expand[s].root_path_physicalid).length&&-1!==a[0].indexOf(n.getID())&&(n.options.sequence_filter=e.CVQuery.intersection.expand[s].sequence_filter,n.options.config_filter=e.CVQuery.intersection.expand[s].config_filter)}else n.options.sequence_filter=null,n.options.config_filter=null;var l;if(n.collapseAll(),n.removeChildren(),n.options.children=[],n.setState({state:"collapsed"}),n.options.padstate="collapsed",n.childComputed=!1,n.options.icons&&n.options.icons.length)"string"==typeof(l=UWA.clone(n.options.icons[0]))&&(l={iconPath:"url("+l+")"}),l.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},n.updateOptions({icons:[l]})}}})}else console.warn("Structure Editor: No filterRootIds properties");r&&this.showAppliedFilter(e)},showAppliedFilter:function(e){for(var t=this,s=[],a=(t.getRoots().slice(),0);a<e.filterRootIds.length;a++){var l=t.searchRootById(e.filterRootIds[a]);l&&(l.options.CVQuery=e.CVQuery,s.push(l))}if(void 0!==e.CVQuery.union||void 0!==e.CVQuery.intersection||void 0!==e.CVQuery.minus){var c=UWA.clone(e.CVQuery);if(c.union&&c.union.expand&&c.union.expand.length>1){for(var d=[],u=0;u<c.union.expand.length;u++){c.union.expand[u].volume_filter&&d.push(u)}for(var p=0;p<d.length;p++)c.union.expand.splice(d[p],1)}else if(c.intersection&&c.intersection.expand&&c.intersection.expand.length>1){for(d=[],u=0;u<c.intersection.expand.length;u++){c.intersection.expand[u].volume_filter&&d.push(u)}for(p=0;p<d.length;p++)c.intersection.expand.splice(d[p],1)}(c="Requirement Group"===s[0].options.reqKindOf?UWA.extend(c,this.req_navigate_options.expand.cv_expand_data.folder_expand,!0):UWA.extend(c,this.req_navigate_options.expand.cv_expand_data.no_folder_expand,!0)).select_bo=t.app.columnManager.getDGVVisibleColumns(!0),c.authored=!1,c.label=h.getRequestLabel();var g={available_columns:[]};t.app.columnManager.getVisibleColumns().forEach(function(e){g.available_columns.push(e.dataIndex)}),t.prepareUpdate(),c.union?c.union.expand.forEach(function(e,t){delete e["q.iterative_filter_query_bo"],delete e.no_type_filter_rel}):c.intersection&&c.intersection.expand.forEach(function(e,t){delete e["q.iterative_filter_query_bo"],delete e.no_type_filter_rel}),c.compute_select_bo=["icon"],i.multiexpand({data:c,onComplete:function(e){var i;try{i=t.startTransaction("expand");var a=UWA.is(e,"string")?JSON.parse(e):e;void 0===a.results||0===a.results.length?r.displayNotification({msg:o.sequence_filter_error,eventID:"info"}):n.process.expand({treedocument:t,root_nodes:s,response:a,mode:"filter",authored:!1,filterMode:!0,expand_level:-1},g)}catch(e){r.displayNotification({msg:o.generic_service_failure,eventID:"error"})}finally{s.forEach(function(e){e.childComputed=!0;var t=UWA.clone(e.options.icons[0]);"string"==typeof t&&(t={iconPath:"url("+t+")"}),t.badges={bottomRight:{iconName:"filter",fontIconSize:"1x",className:"dgv-badge"}},e.updateOptions({icons:[t]})}),t._selectOccurence(),i&&i.end(),t.pushUpdate(),t.getModelEvents().publish({event:"endBlockingTransaction",context:t}),t.app.isConfigAuthorized()&&(t.app.DataService.getParameterInfo(s),t.updateConfiguredTreeNodes(s));t.getAttributeNLSValue(s,["ds6w:status","ds6w:type","ds6w:organizationResponsible"])}},onFailure:function(e){f.errorAlert(o.generic_service_failure)}})}},getAttributeNLSValue:function(e,t){var n=[];!function e(t){if(t)for(var i=0;i<t.length;i++)n.push(t[i]),n.concat(e(t[i].getChildren()))}(e),t.forEach(function(e){var t=[];if(n.forEach(function(n){-1==t.indexOf(n.options.grid[e])&&t.push(n.options.grid[e])}),t&&t.length>0){var i={[e]:t};C.retrieveNLS({nlsData:i}).then(function(t){n.forEach(function(n){n.updateOptions({grid:{[e]:t[e][n.options.grid[e]]}})})})}})},searchRootById:function(e){var t,n=this.getRoots(!0);this.hasOwnProperty("detachedRoots")&&(n=n.concat(this.detachedRoots));for(var i=0;i<n.length;i++)if(n[i].options.resourceid===e){t=n[i];break}return t},_viewInsertExisting:function(e){if(!(e.modified&&e.inserted&&e.created))throw new Error("Invalid input parameters "+JSON.stringify(e));var s,a=[];for(s=0;s<e.modified.length;s++)a.push(this.getNodesById(e.modified[s]));var l=this;i.fetch({enopad_webapis:t.getSetting("enopad_webapis"),pids:e.inserted,authored:!0,onComplete:function(t){l.prepareUpdate(),l.invalidateViewPort();var i=UWA.is(t,"string")?JSON.parse(t):t;!i.results||i.results.length<e.inserted.length?r.displayNotification({msg:o.object_not_found_in_db,eventID:"error"}):i.results.length>e.inserted.length?r.displayNotification({msg:o.tooManyResults,eventID:"error"}):l.wrapInTransaction(function(){i.results.forEach(function(t){var i=e.inserted.indexOf(t.physicalid);t.relationid=e.created[i],l.externalTypes=["ProxyItem"];var r=n.process.createNode({treedocument:l.app,data:t,tenant:h.getTenant()},l.externalTypes);r.options.relationid=e.created[i],l.app.DataService.getExpandData(r).then(function(e){var t=a[i];t&&t.forEach(function(e){e.getChildById(r.options.resourceid)||(e.addChild(r),e.setState({state:"partiallyExpanded"}),e.options.padstate="partiallyExpanded")}),l.pushUpdate()}).catch(function(e){console.error(e)})})})},onFailure:function(){r.displayNotification({msg:o.generic_service_failure,eventID:"error"}),e.callback&&e.callback.call()}})},_viewDetach:function(e){if(!e.deleted)throw new Error("Invalid input parameters "+JSON.stringify(e));var t=this;this.withTransactionUpdate(function(){for(var n=0;n<e.deleted.length;n++){t.getNodesByRelId(e.deleted[n]).forEach(function(e){e.getParent().removeChild(e)})}})},_viewReParent:function(e){this._viewInsertExisting(e),this._viewDetach(e)},removeRoot:function(e,t,n){var i=this;if(this.wrapInTransaction(function(){var r=i.hasOwnProperty("detachedRoots")?i.detachedRoots.indexOf(e):-1;if(r>=0)i.detachedRoots.splice(r,1);else if(i.invalidateViewPort(),i.getRoots().indexOf(e)>=0&&i._parent(e,t,n),(!UWA.is(n,"boolean")||!n)&&UWA.is(i._getChildrenFilterInfo,"function")){var o=i._getChildrenFilterInfo();if(o&&UWA.is(o.childrenBeforeFiltering,"array")){var s=o.childrenBeforeFiltering.indexOf(e);s>=0&&o.childrenBeforeFiltering.splice(s,1)}}}),!UWA.is(t,"boolean")||!t){var r=this.getRoots().length;0===r&&UWA.is(this.detachedRoots,"array")&&(r=this.detachedRoots.length),this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:e.getID(),remainingRoots:r}}),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:1===this.getRoots().length?this.getRoots()[0]:null,nb_root:r}}),this.getModelEvents().publish({event:"onReqAdded",data:{isremove:!0,added_node:1===this.getRoots().length?this.getRoots()[0]:null,nb_root:r}})}},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},updateNodesByID:function(e,t){var n=this,i={authored:{modified:[]}},r=e.options,o=r.resourceid,s=[];if(!(s=n.app.isWidgetRefresh&&n.ids_nodes[o]?n.ids_nodes[o]:n.getNodesById(o))||0===s.length){n.prepareUpdate();var a=e.getParent().getID(),l=[];(l=n.app.isWidgetRefresh&&n.ids_nodes[a]?n.ids_nodes[a]:n.getNodesById(a))&&l.forEach(function(t){t.addChild(e),t.expand()}),n.pushUpdate()}var c={grid:r.grid,label:r.label,cestamp:r.cestamp};s&&s.forEach(function(e){n.prepareUpdate(),e.updateOptions(c),n.pushUpdate()}),t||(i.authored.modified.push(o),this.app._padCommandProxy.refresh(i))},updateConfiguredTreeNodes:function(e){var t=this;t.app.columnManager.retrieveAvailableColumnProviders().then(function(n){if(n.length){var i={relids:[],pids:[],pairs:{}};t.buildConfigJson(e,i);for(var r=[],o=0;o<n.length;o++){let e=n[o].instance,a=e.getName();if(-1!=["CfgConfigurationContextColumn","CfgEffectivityColumns"].indexOf(a)){var s=b.wrappedWithPromise(function(n,r){e.updateAttributes(i,function(e){var t=UWA.is(e,"string")?JSON.parse(e):e;n(t),r("Error in Cfg_updateAttributes")},t)});r.push(s)}}r.length&&b.all(r).then(function(e){for(var n={},i=!1,r=0;r<e.length;r++){let t=e[r];if(!i){let e=Object.keys(t.pids),n=Object.keys(t.relids);i=e.length>0&&0===n.length}UWA.extend(n,e[r],!0)}var o=Object.getOwnPropertyNames(n.pids),s=Object.getOwnPropertyNames(n.relids),a=[];s.forEach(function(n){var i=t.getNodesByRelId(n);i&&i.length&&i.forEach(i=>{e&&e.length&&e.forEach(e=>{if(e.relids){var r=e.relids[n];r&&(r.VariantEffectivity&&"function"==typeof r.VariantEffectivity.trim&&0===r.VariantEffectivity.trim().length&&(r.VariantEffectivity=t.app.getNls("Label_None")),r.CurrentEvolutionEffectivity&&"function"==typeof r.CurrentEvolutionEffectivity.trim&&0===r.CurrentEvolutionEffectivity.trim().length&&(r.CurrentEvolutionEffectivity=t.app.getNls("Label_None")),r.ProjectedEvolutionEffectivity&&"function"==typeof r.ProjectedEvolutionEffectivity.trim&&0===r.ProjectedEvolutionEffectivity.trim().length&&(r.ProjectedEvolutionEffectivity=t.app.getNls("Label_None")),i.updateOptions({grid:r}))}});var r=i.getID();-1!==o.indexOf(r)&&a.push(r)})}),i||a.length>0&&a.forEach(function(e){var t=o.indexOf(e);-1!==t&&o.splice(t,1)}),o.forEach(function(n){var i=t.getNodesById(n);i&&i.length&&i.forEach(t=>{e&&e.length&&e.forEach(e=>{if(e.pids){var i=e.pids[n];i&&!i.Effectivity&&t.updateOptions({grid:i})}})})})}).catch(e=>{console.log("An Error Occured")})}else console.info("No cfg Columns Module")})},_beginBlockingTransaction:function(e){this.getModelEvents().publish({event:"beginBlockingTransaction",data:e,context:this})},_endBlockingTransaction:function(){this.getModelEvents().publish({event:"endBlockingTransaction",context:this})},deleteNodes:function(e,t){var n=this;this.wrapInTransaction(function(){n.withTransactionUpdate(function(){var i={detach:{deleted:[]}};e.forEach(function(e){if(e.isRoot())n.removeRoot(e);else{var t=e.getParent(),r=t.getState();e.remove(),i.detach.deleted.push(e.getID()),"partiallyExpanded"!==r||t.options.children||(t.options.children=[],t.setState({state:"collapsed"}))}}),!0===t&&n.reqCommandProxy.refresh(i)})})},insertNodes:function(e,t,n){var r=this,s=[];e.forEach(function(e){s.push(e.resourceid),s.push(e.parentID)}),this._beginBlockingTransaction("Inserting nodes..."),i.fetch({pids:s,authored:!0,onComplete:function(i){var o=UWA.is(i,"string")?JSON.parse(i):i;if(0===o.results.length)throw new Error("Cannot find object with the physicalid "+s);if(o.results.length!==s.length)throw new Error("More results than input objects");for(var a=0;a<e.length;a++)for(var l=0;l<o.results.length;l++){var c=o.results[l];e[a].resourceid===c.physicalid&&null!=e[a].treeOrder?c["attribute[TreeOrder]"]=e[a].treeOrder:c["attribute[TreeOrder]"]=n}b.wrappedWithPromise(function(){r.insert_nodes({treedocument:r,response:o,insert_parameters:e,beforeNode:t})},"insert_nodes"),r._endBlockingTransaction()},onFailure:function(e){f.errorAlert(o.generic_service_failure),r._endBlockingTransaction()}})},insert_nodes:function(e){var t=this;if(console.log("process.insert_nodes"),!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.insert_parameters,"array"))throw new Error("Invalid input parameters");for(var i=0;i<e.insert_parameters.length;i++)for(var r=e.insert_parameters[i],o=0;o<e.response.results.length;o++){var s=e.response.results[o],a=[];e.treedocument.getRoots().forEach(function(e){a=a.concat(e.getNodesById(r.parentID))});var l=s;e.treedocument.withTransactionUpdate(function(){a.forEach(function(i){if(s.physicalid===r.resourceid){t.externalTypes=["ProxyItem"],l["physicalid[connection]"]=r.relationid;var o=n.process.createNode({treedocument:e.treedocument.app,data:l,tenant:h.getTenant()},t.externalTypes);if(t.app.DataService.getExpandData(o).then(function(e){console.log(e)}).catch(function(e){console.error(e)}),t.prepareUpdate(),UWA.is(e.beforeNode)&&null!=e.beforeNode)i.addChild(o,e.beforeNode+1);else if(UWA.is(r.treeOrder)&&null!=r.treeOrder){var a=i.getChildren(),c=r.treeOrder,d=0;if(a&&a.length>0)for(;d<a.length;){if(a[d].options.relationOrder>c){o.options.relationOrder=c,i.insertBefore(o,a[d]);break}if(d==a.length-1){o.options.relationOrder=c,i.addChild(o);break}d++}else o.options.relationOrder=c,i.addChild(o)}else i.addChild(o);i.expand(),t.pushUpdate(),t.getModelEvents().publish({event:"onChildAdded",data:o})}else if(s.physicalid===r.parentID){var u={cestamp:s.cestamp};i.updateOptions(u)}})})}return{insertExisting:{modified:[],inserted:[],created:[]}}},_defineDefaultTypes:function(){this._defaultTypes={"Requirement Proxy":"Requirement"};var e=t.getSetting("authorized_types"),n=this;widget&&["Requirement Specification","Comment","Requirement","Chapter","Requirement Group"].forEach(function(t){var i=t.replace(" ","_"),r=widget.getPreference("trm_types_"+i);UWA.is(r)&&r.options.forEach(function(i){e.push(i.value),e.push(i.value.replace(new RegExp(" ".replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),"_")),n._defaultTypes[i.value]=t})}),t.setSetting("authorized_types",e)},_shouldAcceptDrop:function(e){return!0},_shouldAcceptDrag:function(e,t){return!0},reParent:function(e,t,n,i){t?this.app.DataService.reParent(e):((e.json&&e.json.dataArray?e.json.dataArray:[]).forEach(e=>{UWA.is(n)&&UWA.is(i)||(i=this.getNodesById(e.pid)[0].options.type,n=this.getNodesById(e.id)[0].options.type);var t=this._defaultTypes[n]||n,r=this._defaultTypes[i]||i,o=this._relPattern[r][t];e.relationship=o}),this.app.DataService.InsertExisting(e))},getDefaultType:function(e){var t=e.replace(" ","_"),n=widget.getPreference("trm_types_"+t);return UWA.is(n)?widget.getValue("trm_types_"+t):e},handleReparent:function(e,t,n,i){var r=this;try{n=n;b.wrappedWithPromise(function(){r.withTransactionUpdate(function(){var i=e.getID(),o=t.getID(),s=e.getRelationID(),a=!Boolean(s),l={transactions:[]};a?l.transactions.push({insertExisting:{modified:[o],inserted:[i],created:[n],withContext:!a}}):l.transactions.push({reParent:{modified:[o],inserted:[i],created:[n],deleted:[s]}}),r.reqCommandProxy.refresh(l)},r)}),r._endBlockingTransaction()}catch(e){r._endBlockingTransaction(),f.errorAlert(o.generic_service_failure)}},setAdditionalAttributes:function(e){var n=this;setTimeout(function(){var i={ids:[]},r=t.getSetting("authorized_find_in_ctx_types");function o(e,t){var n=!1;switch(t){case"boolean":e&&e.length&&("TRUE"===e.toUpperCase()||"FALSE"===e.toUpperCase())&&(n=!0)}return n}n.getNodesById(e).forEach(function(e){!function e(t){var n=t.options.reqKindOf;if(!t.isHidden()&&-1!==r.indexOf(n)){var s=t.getID();o(t.options.grid.isDuplicated,"boolean")&&o(t.options.grid.isLastMinorRevision,"boolean")||!(i.ids.indexOf(s)<0)||i.ids.push(s)}var a=t.getChildren();a&&a.forEach(function(t){e(t)})}(e)}),n._completeNodes(i,!1)})},_completeNodes:function(e,r){var a=this,l=function(e,t){var i;i={available_columns:["ds6w:refinedInto","ds6w:covers"]};var r=n.parse_searchdata(t.attributes,i,a);return UWA.is(e.options.externalObject)&&e.options.externalObject&&(r.icons=e.options.icons),UWA.is(a.filterAttributesForUpdate,"function")&&(r=a.filterAttributesForUpdate({node:e,node_opts:r})),r},c=[];if(UWA.is(e.ids)&&UWA.is(e.ids,"array")&&(c=e.ids),0!==c.length){t.getSetting("enopad_webapis_debug");var d=function(t,n){i.fetch({pids:t,isParameter:!1,isLinkAttributes:!0,authored:s.determineAuthoredFlag(),onComplete:function(i){UWA.is(n)&&UWA.is(n,"function")&&n.call();var r=UWA.is(i,"string")?JSON.parse(i):i;if(0===r.results.length)throw new Error("Cannot find object with the physicalid "+t);r.results.length===t.length&&(b.wrappedWithPromise(function(){a.withTransactionUpdate(function(){r.results.forEach(function(e){var t="",n=0;for(n=0;n<e.attributes.length;n++){var i=e.attributes[n];if("resourceid"===i.name||"physicalid"===i.name){t=i.value;break}}if(""===t)for(n=0;n<e.attributes.length;n++){var r=e.attributes[n];if("physicalid"===r.name){t=r.value;break}}if(""===t)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(e));a.getRoots().forEach(function(n){n.getNodesById(t).forEach(function(t){t.updateOptions(l(t,e))})});var o=a.searchRootById(t);o&&o.updateOptions(l(o,e))})})}),void 0!==e.onComplete&&e.onComplete())},onFailure:function(e){f.errorAlert(o.generic_service_failure)}},"BOR")},u=function(e,t){e.length-t>0&&d(e.slice(t,t+150),function(){u(e,t+151)})};c.length>150?u(c,0):d(c)}},getTenant:function(){return require("DS/TraceableRequirementsUtils/Utils").getTenant()},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[],n=this;n&&n.wrapInTransaction(function(){n.withTransactionUpdate(function(){n.addRoot(e);for(var i=0;i<e.length;i++)t.push(e[i].getID());n.getRoots().length;UWA.is(n.detachedRoots,"array")&&n.detachedRoots.length,n.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n.getRoots().length,added_nodes:e}})})})},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){this.app.reqCommandProxy.select(this._buildSelectData()),this._doNotBroadcastSelect=!1},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},buildConfigJson:function(e,t){var n=this;e.forEach(function(e){var i=e.getID();-1===t.pids.indexOf(i)&&t.pids.push(i);var r=e.getRelationID();if(r&&-1===t.relids.indexOf(r)&&!e.isRoot()&&(t.relids.push(r),t.pairs[i]=r),e.hasChildren()){var o=e.getChildren();n.buildConfigJson(o,t)}})},retrieveNodesByIdsInMultiStructure:function(e){var t=this,n=[];return e.forEach(function(e){t.getRoots().forEach(function(t){var i=t.getNodesById(e);n=n.concat(i)})}),n},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(n){var i=n.getNodesById(e);t=t.concat(i)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),n=0;n<t.length;n++){var i=t[n].getNodeByPath(e,void 0,void 0,!0);if(i)return i}},getNodesByRelId:function(e){var t=[];return this.getRoots().forEach(function(n){var i=n.getNodesByRelId(e);t=t.concat(i)}),t}})}),define("DS/RequirementStructureBrowser/requirementServices/TRMUserPreferenceService",["UWA/Core","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/Utils"],function(e,t,n,i,r){"use strict";var o=null;return{initialize:function(e){o=e;var t=this;e.PrefService=this;var n=this.retrieveUserPreferences();return t.paramAttributes={},o._applicationChannel.subscribe({event:"ENXViews/AttributesCustomization/columnModification"},function(e){t._columnsModificationListener(e)}),n},_columnsModificationListener:function(e){if(e&&e.what)switch(e.what){case"close":this._updateUserPreferences(e);break;case"addRemoveColumns":break;case"reset":this._resetToDefaultValue();break;case"visibilityColumn":case"changeTitle":break;case"exportColumn":case"pinChange":default:console.warn("column modification intent is not handle "+e.what)}},getUserPreferences:function(){return this.userPreferences},_resetToDefaultValue:function(){this._persistPreferences(this._getDefaultAttributesPreferences())},_updateUserPreferences:function(e){console.log(e.selectedAttributes);var t=e.selectedAttributes.map(function(e){var t={dataIndex:e.dataIndex,ds6w:e.ds6w,kind:e.kind,dbName:e.internalName,visibleFlag:e.attrVisible,text:e.text};return e.ds6wFrom&&(t.ds6wFrom=e.ds6wFrom),e.isAdditionalColumn&&e.provider&&(t.isAdditionalColumn=e.isAdditionalColumn,t.provider=e.provider),e.customisation&&e.customisation.layout&&Object.keys(e.customisation.layout).length>0&&(e.customisation.layout.canBeGroup||delete e.customisation.layout.canBeGroup,t.customisation=e.customisation),e.attrDim&&e.attrDim.length>0&&(t.attrDim=e.attrDim,e.attrUnit&&e.attrUnit.length>0&&(t.attrUnit=e.attrUnit)),t});if(e&&t&&e.selectedExtensions&&e.selectedTypes){this.userPreferences={selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columns:t};this._persistPreferences(this.userPreferences)}},retrieveUserPreferences:function(){var e=this;return t.wrappedWithPromise(function(t,n){var i=e._retrievePreferenceFromWidget();i&&(e.userPreferences=i,t(i)),e._retrievePreferencesFromCompass().then(function(n){e.userPreferences=n,t(n)}).catch(function(n){i?(e.userPreferences=i,t(i)):e.userPreferences=o._getDefaultAttributesPreferences(),t(e.userPreferences)})})},_persistPreferences:function(e){if(e&&e.columns&&e.selectedExtensions&&e.selectedTypes){this.userPreferences=e;var t=JSON.stringify(e);widget.setValue("ap_custo",t);widget.getValue("x3dAppId"),r.getPlatformId();n.setMyAppPreferences({preference_name:widget.getValue("x3dAppId")+"-"+r.getPlatformId(),value:t,onComplete:function(e){console.log(e)},onFailure:function(e){console.log(e)}})}},_retrievePreferencesFromCompass:function(){return t.wrappedWithPromise(function(e,t){n.getMyAppPreferences({preference_name:widget.getValue("x3dAppId")+"-"+r.getPlatformId(),onComplete:function(n){return n?"string"==typeof n&&""===n.trim()?t(null):("string"==typeof n&&(n=JSON.parse(n)),n.selectedTypes&&n.selectedExtensions&&n.columns?e(n):void t(null)):t(null)},onFailure:function(e){console.log(e),t(null)}})})},_retrievePreferenceFromWidget:function(){var t={};try{t=JSON.parse(widget.getValue("ap_custo")||"{}")}catch(e){console.error(e)}return t&&t.selectedExtensions&&Array.isArray(t.columns)&&t.columns.length>0&&t.selectedTypes?e.extend({},{columns:t.columns,selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}):null},_getDefaultAttributesPreferences:function(){return{selectedTypes:o.getDefaultSelectedTypes("defaultSelectedTypes"),selectedExtensions:o.getDefaultSelectedExtensions("defaultSelectedExtensions"),columns:o.getDefaultAttributes("defaultAttributes")}}}}),define("DS/RequirementStructureBrowser/controllers/StructureEditorContoller",["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/RequirementStructureBrowser/treemodel/RequirementModelParser","DS/DataGridView/DataGridView","DS/RequirementStructureBrowser/components/RequirementContextualMenu","DS/RequirementStructureBrowser/components/ActionBar","DS/ApplicationFrame/CommandsManager","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","DS/Core/PointerEvents","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/RequirementStructureBrowser/utils/TRMMask","DS/Utilities/Utils","DS/PADUtils/PADTypesMgt","DS/PADUtils/PADSession","DS/PlatformAPI/PlatformAPI","DS/RequirementStructureBrowser/controllers/RootNodeController","DS/RequirementStructureBrowser/utils/RequirementAppConfig","UWA/Core","DS/RequirementFrameUtils/RequirementFrameUtils","DS/ENOXTriptych/js/ENOXTriptych","DS/RequirementFrameUtils/components/topbaraction/TopbarActionWrapper","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/TraceableRequirementsUtils/utils/TRMReportPanel","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,h,f,g,m,v,_,y,S,b,A,C,R,w,E,D){"use strict";var I=function(){};I.prototype.init=function(e){this._applicationChannel=e._applicationChannel,this._triptychOptions={left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},this._topbarOpts={withInformationButton:!1,withWelcomePanelButton:!1,modelEvents:e._applicationChannel},this.app=e,this._model=e.options.model,this.opened_ids=[],this._isDestroyed=!1,this.mediator={},this.req_navigate_options=JSON.parse(a),this._ContextualMenu=new r,t.mediator.installTo(this.mediator),this._unSubscribeEvents(),this._initDivs(),this._subscribeEvents(),this._dataGridViewHandler()},I.prototype._initDivs=function(){var e=this;e.container=this.app.elements.container=UWA.createElement("div",{class:"StructureEditor"});var t=UWA.createElement("div",{class:"trm_viewmain"});this._topbarOpts.parentContainer=t,this._topbarAction=new A,this._topbarAction.init(this._topbarOpts),t.addClassName("withToolbar");var n=UWA.createElement("div",{class:"trm_Content"}).inject(t),i=UWA.createElement("div",{class:"trm_viewright rightSidePanel"});this.reqshell=new b,this._triptychOptions.container=e.container,this.reqshell.init(this._triptychOptions,e.createRootListSlidder(),t,i),e.reqshell.togglePanel=function(t){"left"===t?e.reqshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):e.reqshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"})},e.reqshell.openPanel=function(t){e.app.elements.openPanel._modelEvents.publish({event:"triptych-show-panel",data:t})},require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),this.getStatusInfo(this.container),this.action_bar=new o,this.action_bar.initializeActionBar(this.mediator,e.container),this._structure_container=UWA.createElement("div"),this._structure_container.classList.add("structure-details"),this._structure_container.addEventListener("dragenter",this._onDragSpec.bind(this)),this._structure_container.addEventListener("dragleave",this._onDragLeave.bind(this)),this._structure_container.addEventListener("dragover",this._onDragOver.bind(this)),this._initStructureDataGridView(),this._dataGridView.inject(this._structure_container),this._structure_container.inject(n)},I.prototype.togglePanel=function(e,t){this.reqshell.togglePanel(e,t)},I.prototype.createRootListSlidder=function(){var e=this;return this.leftsidepanel=new v(e.app),e._model.onNodeModelUpdate(function(t){e.app._localModelEvent.publish({event:"RequirementStructureBrowser-Root-sync",data:t.data.nodeModel})}),e.app._localModelEventsTokens.push(e.app._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-select"},this._onTileSelect.bind(this))),e.app._localModelEventsTokens.push(e.app._localModelEvent.subscribe({event:"RequirementStructureBrowser-Root-removeTile"},this._onRemoveTile.bind(this))),this.leftsidepanel.getContent()},I.prototype._onTileSelect=function(e){if(!UWA.is(e.tile_ids,"array"))throw new Error("Invalid input param, no params.tile_ids defined");var t=this;t._model.unselectAll(),e.tile_ids.forEach(function(e){var n=t._model.searchRootById(e);n?(n.select(),t._applicationChannel.publish({event:"structure-editor-add-title",data:n.options})):console.log("Cannot find ["+e+"] in the TreeDocument")})},I.prototype._onRemoveTile=function(e){if(!UWA.is(e.tile_id))throw new Error("Invalid input parameter");var t=this._model.searchRootById(e.tile_id);return UWA.is(t)&&this._model.removeRoot(t),0===this._model.getRoots().length&&this.app._applicationChannel.publish({event:"breadcrumb-link-clicked",data:{linkID:d.VIEW_RECENTLY_OPEN}}),!1},I.prototype.getStatusInfo=function(e){var n=this,i=new u.wrappedWithPromise(function(e){require(["DS/RequirementStructureBrowser/components/RequirementStatusInfos"],function(i){var r=new i({withProgress:!0,events:{onShow:function(){r.setStatus(i.buildStatus({Tenant:t.getPlatformId(),tree_content:{nbObjectsInTree:n.app.options.model.getAllDescendants().length,nbObjectsSelected:n.app.options.model.getSelectedNodes().length}}))}}});e(r)})});u.allSettled(i).then(function(t){"fullfilled"===t[0].state&&t[0].value&&t[0].value.getContent().inject(e)}).catch(function(e){console.error(e)})},I.prototype.inject=function(e){e.appendChild(this.container)},I.prototype._onDragSpec=function(e,t){e.preventDefault(),e.stopPropagation()},I.prototype._onDragLeave=function(e,t){this._structure_container.classList.remove("dragOver"),e.preventDefault(),e.stopPropagation()},I.prototype._onDragOver=function(e,t){e.preventDefault(),e.stopPropagation()},I.prototype._onDropRowHeader=function(e,t){this.performDnD(e,t),e.preventDefault()},I.prototype._onDropSpec=function(e,n){var i,r=this;r.app.TRMTypeManagement.retrieveDragWidgetId(e)!=t.getWidgetId()&&r.app.TRMTypeManagement.retrieveAuthorizedObjects({dnd_event:e,callback:function(e){if((i=e)&&0!=i.authorized_root_objects.length){r._loadData(i.authorized_root_objects)}}}),this._structure_container.classList.remove("dragOver"),e.preventDefault(),r._dataGridView.onDropBlankDefault(r._dataGridView,e,n)},I.prototype._loadData=function(e){var t=this;p.mask(this._structure_container);var n=JSON.parse(a).root_type,i=!1;for(var r in n)n[r]==e[0].options.reqKindOf&&(i=!0);i?u.wrappedWithPromise(function(n,i){var r=[];t._model.addRootNodes(e),e.forEach(function(e){var n=(new Date).getTime();e&&(t._model.prepareUpdate(),r.push(t.app.DataService.getExpandData(e).then(function(e){t._model.pushUpdate(),console.log("onComplete data in "+((new Date).getTime()-n)+"ms"),1!=g.determineAuthoredFlag()&&t._model.setAdditionalAttributes(e.getID())}).catch(function(e){console.error(e)})),e.expand())}),u.allSettled(r).then(function(){t.app._applicationChannel.publish({event:d.AFTER_ALL_SETTLED,data:e}),t.app.DataService.getParameterInfo(e),t.app.DataService.updateConfigurationData(e),p.unmask(t._structure_container)}).catch(function(e){console.log(e),p.unmask(t._structure_container),i()}),n(e)}):(t.app.deactivatedStructureBrowser(),t.app._trmModelEvents.publish({event:"TRMViews-WelcomePanel-activate"}),t.app._trmModelEvents.publish({event:d.EVENT_WELCOME_PANEL_EXPAND}),t.app.previous_view?data.id=t.previous_view:data.id=d.VIEW_RECENTLY_OPEN,t.app._trmModelEvents.publish({event:"welcome-panel-active-view",data:data}))},I.prototype._initStructureDataGridView=function(){var e=this.app.columnManager.getDatagridViewColumns();this._dataGridView=new i({identifier:"TRM-DatagridView_"+t.getWidgetId(),treeDocument:this._model,columns:e,defaultColumnDef:{width:"auto",typeRepresentation:"string",editionPolicy:"EditionOnDoubleClick"}}),this._dataGridView.rowSelection="multiple",this._dataGridView.cellSelection="none",this._dataGridView.showSelectionCheckBoxesFlag="OnOver",this._dataGridView.rowDragEnabledFlag=!0,this._dataGridView.cellDragEnabledFlag=!0,this._dataGridView.onDragStartRowHeader=this._onDragStartRowHeader.bind(this),this._dataGridView.onDragOverCell=this._onDragOverRowHeader.bind(this),this._dataGridView.onDragRowHeader=this._onDragRowHeader.bind(this),this._dataGridView.onDropRowHeader=this._onDropRowHeader.bind(this),this._dataGridView.onDragEndRowHeader=this._onDragEndRowHeader.bind(this),this._dataGridView.onDragStartCell=this._onDragStartRowHeader.bind(this),this._dataGridView.onDragOverCell=this._onDragOverRowHeader.bind(this),this._dataGridView.onDragCell=this._onDragRowHeader.bind(this),this._dataGridView.onDropCell=this._onDropRowHeader.bind(this),this._dataGridView.onDragEndCell=this._onDragEndRowHeader.bind(this),this._dataGridView.onDropBlank=this._onDropSpec.bind(this),this.registerCustomAttribute(this._dataGridView)},I.prototype.registerCustomAttribute=function(e){e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(this.registerCustomTypeRepresentation()))},I.prototype.registerCustomTypeRepresentation=function(){var e={};return this.app.DataService.customerExtension.forEach(function(t){Array.isArray(t.authorizedValues)&&t.authorizedValues.length>0?e[t.alphaNumAttrName]={stdTemplate:"comboSelector",semantics:{possibleValues:t.authorizedValues}}:e[t.alphaNumAttrName]={string:{stdTemplate:"edit"}}}),e.mandatory={stdTemplate:"switch"},e};return I.prototype._onDragStartRowHeader=function(e,t){var n=t.draggedNodes;e.dataTransfer.effectAllowed="all",_.DRAG_NODE_START=!0;var i=this.app.TRMTypeManagement.prepareDragData(n);return e.dataTransfer.setData("Text",i),!1},I.prototype._onDragEndRowHeader=function(e,t){_.DRAG_NODE_START=!1},I.prototype._onDragOverRowHeader=function(e,t){return e.preventDefault(),!0},I.prototype._onDragRowHeader=function(e,t){},I.prototype._InterWidgetDnD=function(e,t){var n=this;n.app.beginBlockingTransaction(R.composite),n.app.TRMTypeManagement.retrieveAuthorizedObjects({dnd_event:e,callback:function(e){var i={dataArray:[]},r=JSON.parse(C),o=e.authorized_objects?e.authorized_objects:[];if(o.length>0&&0==i.dataArray.length){var s=t.nodeModel.options.resourceid,a=r[t.nodeModel.options.reqKindOf]||r[t.nodeModel.options.type],l="";o.forEach(function(e){var t=e.options.reqKindOf;if(!a||!a[t])return c.warningAlert(n.app.getNls("INSERT_FAILED")),void n.app.endBlockingTransaction();l=a[t],i.dataArray.push({pid:s,id:e.options.resourceid,relationship:l,previousSibling:{},nextSibling:{}})})}i.dataArray.length>0&&(e.json=i,n.app.DataService.InsertExisting(e))}}),e.preventDefault()},I.prototype.performDnD=function(e,n){var i=this,r=i.app.TRMTypeManagement.retrieveDragWidgetId(e),o=n.droppedNodes,s={dataArray:[]},a={dataArray:[]};if(r==t.getWidgetId()){var l,d=n.dropPosition;if((l=n.nodeModel.isRoot()&&"bottom"===d?n.nodeModel:"top"===d||"bottom"===d?n.nodeModel.getParent():n.nodeModel).options.externalObject)c.errorAlert(R.Transaction_forbidden);else{var u=l.options.reqKindOf,p=JSON.parse(C)[u];o.forEach(function(e){var t=e.options.reqKindOf;if(p&&p[t]){var r=null,o=null,u=l.getChildren();if("top"===d){if(o=n.nodeModel.getRelationID(),!u)return;var h=u.indexOf(n.nodeModel);h>0&&(r=u[h-1].getRelationID())}if("bottom"===d){if(r=n.nodeModel.getRelationID(),!u)return;var f=u.indexOf(n.nodeModel);f<u.length-1&&(o=u[f+1].getRelationID())}if(e.isRoot()){var g={id:e.getID(),pid:l.getID(),relationship:p[t],previousSibling:{},nextSibling:{}};null!=r&&(g.previousSibling.relId=r),null!=o&&(g.nextSibling.relId=o),a.dataArray.push(g)}else{g={objectId:e.getID(),position:{},oldParentId:null!=e._parentNode?e._parentNode.getID():null,oldRelId:e.getRelationID(),newParentId:l.getID(),mode:"MOVE"};null!=r&&(g.position.previousSiblingRelId=r),null!=o&&(g.position.nextSiblingRelId=o),s.dataArray.push(g)}}else c.warningAlert(i.app.getNls("INSERT_FAILED"))});var h=s.dataArray.length,f=a.dataArray.length;h>0&&f>0?c.warningAlert(w.Requirement_Notif_RootAndLeafSelection):(h>0&&(i.app.beginBlockingTransaction(R.composite),i.app.DataService.reorder(s)),f>0&&(i.app.beginBlockingTransaction(R.composite),i.app.DataService.InsertExisting({json:a,droppedData:o})))}}else i._InterWidgetDnD(e,n)},I.prototype._getContextualMenu=function(e){var t=[];if(e&&e.collectionView&&e.cellInfos){e.collectionView.columns.length;var n=e.cellInfos.columnID,i=e.cellInfos.rowID;if(0!=n&&1!=n&&-1===i)t=e.collectionView.buildDefaultContextualMenu(e,{pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!1});else if(i>-1&&e.cellInfos.nodeModel){var r=e.cellInfos.nodeModel;this.app.externalProviders&&(r.externalProviders=this.app.externalProviders),r._defaultTypes=this.app._defaultTypes,t=this._ContextualMenu._getContextualMenu(r)}}return t},I.prototype.getModels=function(){return this._model},I.prototype.UpdateModifiedNodes=function(e){var t=this;return new Promise(function(n){var i=[];e.forEach(function(e){i.push(u.wrappedWithPromise(function(n,i){var r={physicalid:e};t.app.DataService.getObjectInfo(r).then(function(e){n(e)}).catch(function(e){console.log(e)})}))}),u.allSettled(i).then(function(e){e.forEach(function(e){if("fullfilled"===e.state&&e.value){var n=e.value,i=t._model.getNodesById(n.getID());i.length>0&&i.forEach(function(e){var t={grid:n.options.grid};t.label=n.options.label,t.cestamp=n.options.cestamp,e.updateOptions(t)})}})}).catch(function(e){console.log(e)})})},I.prototype.refresh=function(e,t,n){this.getModels().prepareUpdate();for(var i=0;i<e.length;i++)e[i].refreshByModel(t[i]);this.getModels().pushUpdate()},I.prototype.reDrawColumns=function(e){var t=this,n=t.app.columnManager.getDatagridViewColumns(t.getModels());if(Array.isArray(n)&&n.length>0){var i=(t._dataGridView.columns||[]).map(function(e){return e.dataIndex});t._dataGridView.prepareUpdateView(),i.forEach(function(i){var r=n.find(function(e){return e.dataIndex===i});"tree"===i||!e&&r||t._dataGridView.removeColumnOrGroup(i),t._dataGridView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)});var r=0;n.forEach(function(n){var o=i.find(function(e){return n.dataIndex===e});"tree"===n.dataIndex||!e&&o||t._dataGridView.addColumnOrGroup(n,r),r++})}},I.prototype._dataGridViewHandler=function(){var n=this,i=n._dataGridView;i.addEventListener(l.POINTERHIT,function(i,r){if(r){if(i.multipleHitCount>=2){let i=r.cellID;if(n.app.getActiveDGV().getCellEditableState(i)){let o=r.nodeModel.getID(),s=r.nodeModel.options.cestamp,a=["cestamp","current.access[modify]"];e.getInfo({pid:o,securityContext:t.getSecurityContext(),selectables:a,onComplete:function(e){let t=(e=UWA.is(e,"string")?JSON.parse(e):e).results[0];"FALSE"===t["current.access[modify]"]?(n.app.getActiveDGV()._setEditionMode(i,!1),c.warningAlert(D.EditionModifyAccess)):"true"==n.app.DataService.isConcurrentEngineeringEnabled&&t.cestamp!=s&&(n.app.getActiveDGV()._setEditionMode(i,!1),c.warningAlert(D.EditionNotUpToDate))},onFailure:function(e){console.log(e)}})}}if(!(i.target instanceof HTMLAnchorElement||i.target instanceof HTMLImageElement))return;var o=i.dsModel.layout.getDataIndexFromColumnIndex(r.columnID);if(r.nodeModel)if("ds6w:status"===o)s.getCommand("MaturityHdr",n).begin();else if("ds6wg:revision"===o){s.getCommand("HistoryHdr",n).begin()}else if("ds6w:responsible"===o){s.getCommand("ActionBar_ChangeOwner",n).begin()}else if("VariantEffectivity"===o&&n.app.isConfigAuthorized()){s.getCommand("EditVariant",n).begin()}else if("CurrentEvolutionEffectivity"===o&&n.app.isConfigAuthorized()){s.getCommand("EditEvolution",n).begin()}else if("ds6w:reserved"===o){var a="ActionBar_ReserveCmd";"TRUE"===r.nodeModel.options.grid["ds6w:reserved"]&&(a="ActionBar_UnreserveCmd"),s.getCommand(a,n).begin()}else if(("ds6w:covers"===o||"ds6w:refinedInto"===o)&&UWA.is(r.nodeModel.options.getAttributeValueForFiltering(o))){var l={context:r.nodeModel};n._ContextualMenu._linkManagement(l)}}}),i.onContextualEvent=function(e){return n._getContextualMenu(e)}},I.prototype.registerOnViewInstance=function(e){e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(this.registerCustomTypeRepresentation()))},I.prototype._unSubscribeEvents=function(){var e=this;this._applicationChannel&&(e.app._structureEditorEventsTokens.forEach(function(t){e._applicationChannel.unsubscribe(t)}),e.app._structureEditorEventsTokens=[])},I.prototype._subscribeEvents=function(){var e=this,t="cfgEffectivityModifications_"+widget.id;m.subscribe(t,function(t){t=JSON.parse(t),e.app.refreshGridForSetEffectivities(t)}),m.subscribe("Lifecycle.Modification",function(t){var n=UWA.is(t,"object")?t:JSON.parse(t),i=e.app.getPADTreeDocument().getSelectedNodes(),r=[];if(n&&n.Refresh&&n.Refresh.created&&n.Refresh.created.length>0){var o=n.Refresh.created;if(widget&&widget.getPreference("AddObjectOnReviseDuplicate")&&widget.getPreference("AddObjectOnReviseDuplicate").value){i.forEach(function(e){e.getParent()&&(e.getParent().isSelected()||r.push(e.getID()))});for(var s=0;s<o.length;s++)if("Revise"==o[s].operation||"Duplicate"==o[s].operation){var a=e.app.getPADTreeDocument().getNodesById(o[s].sourceObjectId)[0];r.indexOf(o[s].sourceObjectId)>-1&&a?e.req_navigate_options.root_type.indexOf(a.options.reqKindOf)>-1&&e.app.refreshOnCreate(o[s],!1,!1):(a&&!a.isSelected()||null==a)&&e.app.refreshOnCreate(o[s],!1,!1)}}r=[];o.forEach(function(e){"Revise"===e.operation&&r.push(e.sourceObjectId)})}n&&n.Refresh&&n.Refresh.modified&&n.Refresh.modified.length>0&&(i=n.Refresh.modified).forEach(function(t){if(r.push(t.physicalid),"Promote"===t.operation&&"Chapter"===t.policy){var n=e.app.getModels().getNodesById(t.physicalid)[0];if(n.hasChildren())n.getChildren().forEach(function(e){r.push(e.getID())})}}),e.UpdateModifiedNodes(r).then(function(){console.log("Is last revision refreshed")})}),m.subscribe("DS/PADUtils/PADCommandProxy/refresh",function(t){var n,i,r=[];t.data.authored&&t.data.authored.modified&&t.data.authored.modified.forEach(function(e){"object"==typeof e?r.push(e.physicalid):r.push(e)});var o=t.data.authored.deleted;(o&&o.forEach(function(t){var r=e.app.getPADTreeDocument().getNodesById(t);r&&0!==r.length||(r=e.getPADTreeDocument().getNodesByRelId(t)),r.forEach(function(e){e.isRoot()?(n||(n=[]),n.push(t)):(i||(i=[]),i.push(e))})}),i&&e.app.getPADTreeDocument().deleteNodes(i),n)&&(n.length&&require("DS/RequirementStructureBrowser/utils/TRMModelEvent").getModelEvents().publish({event:"TRMViews-WelcomePanel-clearAll",data:{item2remove:n}}));e.UpdateModifiedNodes(r)}),e._applicationChannel.subscribe({event:"structure-editor-add-title"},function(t){var n={linkID:"home."+e.app.previous_view,linkText:t.label,additionalData:t.resourceid};e._applicationChannel.publish({event:"breadcrumb-reset",data:null}),e._applicationChannel.publish({event:"breadcrumb-add-link",data:n})}),e.app._structureEditorEventsTokens.push(e._applicationChannel.subscribe({event:d.AFTER_ALL_SETTLED},function(t){var n={paths:[t[t.length-1].options.resourceid],appId:widget.getValue("appId")};e.app.reqCommandProxy.drop(n),e._applicationChannel.publish({event:"structure-editor-add-title",data:t[t.length-1].options})})),e.app._structureEditorEventsTokens.push(e._applicationChannel.subscribe({event:"RequirementStructureBrowser-inject-print"},function(){e._dataGridView.openPrintableViewWindow(!0)})),e.app._structureEditorEventsTokens.push(e._applicationChannel.subscribe({event:"event-change-structure-view-changed"},function(t){e._applicationChannel.publish({event:"columns-changed",updateExitingColumns:!0}),!0===t&&e._applicationChannel.publish({event:"TRMViews-StructureEditor-update",data:t})})),e.app._structureEditorEventsTokens.push(e._applicationChannel.subscribe({event:"columns-changed"},function(t){var n=!1;t&&t.updateExitingColumns&&(n=!0),e.reDrawColumns(n)}))},I}),define("DS/RequirementStructureBrowser/utils/TRMTypeManagement",["UWA/Core","UWA/Class","text!DS/RequirementStructureBrowser/assets/enoreq_settings.json","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/TraceableRequirementsUtils/Utils","DS/RequirementStructureBrowser/treemodel/RequirementModelParser"],function(e,t,n,i,r,o){"use strict";return t.singleton({init:function(e){this._parent(e)},initialize:function(e){this.app=e},supported_dnd_types:function(t){for(var n="",i=["text/searchitems","text/plain","Text"],r=e.is(t.dataTransfer.types.indexOf,"function")?"indexOf":"contains",o=0;o<i.length&&""===n;o++){var s=t.dataTransfer.types[r](i[o]);(e.is(s,"number")&&s>=0||e.is(s,"boolean")&&!0===s)&&(n=i[o])}return n},retrieveDragWidgetId:function(t){var n=this.supported_dnd_types(t),i=t.dataTransfer.getData(n);return(e.is(i,"string")?JSON.parse(i):i).widgetId},retrieveAuthorizedObjects:function(t){var r=this,o={authorized_objects:[],authorized_root_objects:[]},s=r.supported_dnd_types(t.dnd_event),a=t.dnd_event.dataTransfer.getData(s),l=JSON.parse(n),c=l.padsettings.enoreq.run_options.authorized_root_types,d=l.padsettings.enoreq.run_options.authorized_types;if(null!=a){var u=e.is(a,"string")?JSON.parse(a):a;if(e.is(u.data)&&e.is(u.data.items,"array")&&u.data.items.length>0){var p=[];u.data.items.forEach(function(e){var t={physicalid:e.objectId};p.push(r.app.DataService.getObjectInfo(t).then(function(e){c.value.includes(e.options.reqKindOf)&&o.authorized_root_objects.push(e),d.value.includes(e.options.reqKindOf)&&o.authorized_objects.push(e)}).catch(function(e){console.log(e)}))}),i.allSettled(p).then(function(){t.callback(o)}).catch(function(e){console.log(e)})}}},retrieveSelectedRootObjects:function(e){var t=this,r=[],o=e.data,s=JSON.parse(n),a=s.padsettings.enoreq.run_options.authorized_root_types;s.padsettings.enoreq.run_options.authorized_types;if(null!=o&&o.length>0){var l=[];o.forEach(function(e){var n={physicalid:e.id};l.push(t.app.DataService.getObjectInfo(n).then(function(e){a.value.includes(e.options.reqKindOf)&&r.push(e)}).catch(function(e){console.log(e)}))}),i.allSettled(l).then(function(){e.callback(r)}).catch(function(e){console.log(e)})}},prepareDragData:function(e){var t={protocol:"3DXContent",version:"1.1",source:r.getAppId(),widgetId:r.getWidgetId(),data:{items:[]}},n=[];return e.forEach(function(e){var t={envId:r.getPlatformId(),serviceId:"3DSpace",contextId:r.getSecurityContext(),objectId:e.getID(),objectType:e.getType(),displayName:e.getLabel(),displayType:e.getType(),path:e.getOccurencePath(null,!0)};n.push(t)}),t.data.items=n,JSON.stringify(t)},getTreeNodeModel:function(e){return o.process.createNode({treedocument:this.app,data:e,tenant:r.getTenant()},this.app.externalTypes)},updateRecentItemModel:function(e){this.app.DataService.getUserRecentsItems(e)}})}),define("DS/RequirementStructureBrowser/RequirementAppContext",["DS/CoreEvents/ModelEvents","UWA/Class/Options","UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Mask","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/RichView/mixins/_RichBIFilter","DS/Utilities/Utils","UWA/Class/Promise","DS/PADUtils/PADContext","DS/PADUtils/PADSession","DS/PADUtils/PADCommandProxy","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/utils/TRMSearchNav","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/REQCommandProxy","DS/RequirementStructureBrowser/controllers/StructureEditorContoller","DS/RequirementStructureBrowser/utils/TRMMask","DS/RequirementStructureBrowser/requirementServices/StructureEditorDataService","DS/RequirementStructureBrowser/requirementServices/ColumnMgtService","DS/RequirementStructureBrowser/requirementServices/TRMUserPreferenceService","DS/RequirementStructureBrowser/requirementServices/TRMPersistencyManager","DS/RequirementStructureBrowser/utils/TRMPromiseUtils","DS/RequirementStructureBrowser/utils/RequirementsConstant","DS/RequirementStructureBrowser/utils/RequirementAppConfig","DS/RequirementStructureBrowser/utils/TRMTypeManagement","DS/RequirementStructureBrowser/treemodel/RequirementTreeDocument","DS/RequirementStructureBrowser/components/RequirementCCP","text!DS/RequirementStructureBrowser/assets/RequirementAppSetting.json","i18n!DS/RequirementStructureBrowser/assets/nls/RequirementNls.json","DS/RequirementStructureBrowser/utils/TRMModelEvent","DS/RequirementStructureBrowser/treemodel/RequirementNodeModel","DS/RequirementStructureBrowser/utils/RequirementsGlobalVariable","DS/CfgBaseUX/scripts/CfgUtility","text!DS/RequirementStructureBrowser/assets/ENOREQ.2D.json","css!DS/RequirementStructureBrowser/RequirementStructureBrowser.css"],function(e,t,n,i,r,o,s,a,l,c,d,u,p,h,f,g,m,v,_,y,S,b,A,C,R,w,E,D,I,P,T,x,O,N,q,U,M,W){"use strict";var B=JSON.parse(x),V=JSON.parse(W);return i.extend(t,o,a,T,{init:function(t){var n=this;d.set(this),this._parent(t),this.options=UWA.extend(this.options,t,!0),this.elements.container=UWA.createElement("div",{class:"req_component"}),this._appContext=d.get(),n.mandatoryStartup=[],n.optionalStartup=[],this._initProxyEvents(),this._localModelEvent=new e,this._applicationChannel=new e,this._trmModelEvents=N.getModelEvents(),n.mandatoryStartup.push(C.initialize(n)),this.defaultAttributeRange={Priority:{},"User Requirement Importance":{},Difficulty:{},"Requirement Classification":{}},w.allSettled(n.mandatoryStartup).then(function(){R.initialize(n),n.options.model=new P,n.options.model.initialize(n),n.initializeBI(n),n.DataService=new b,n.DataService.init(n);var e=function(e){return new c(function(t,n){c.cast(A.initialize(e)).finally(function(){return t(!0)})})}(n),t=w.allSettled(n.optionalStartup),i=w.allSettled(e);t.then(function(){i.finally(function(){n.initApp()}).catch(function(e){})})})},initApp:function(e){this._defineDefaultTypes(),this.reqProxy=_,this.reqCommandProxy=_.create(),this._applicationChannelTokens=[],this._localModelEventsTokens=[],this._structureEditorEventsTokens=[],this.TRMTypeManagement=I,this.TRMTypeManagement.initialize(this),this.externalTypes=["ProxyItem"],this.active_view="",this.previous_view="",this.buildStructureView(),this.subscribeEvents(),this.options.widget.dispatchEvent("onReady")},saveCSRF:function(e){this._csrf=e},getCSRF:function(e){return this._csrf},buildStructureView:function(){this.structureEditor||(this.structureEditor=new y,this.structureEditor.init(this))},displayNotification:function(e){switch(e.eventID){case"warning":g.warningAlert(e.msg);break;default:g.notifyAlert(e.msg)}},getNls:function(e){return O.get(e)},getSetting:function(e){return n.is(e,"string")&&n.is(B[e])?B[e]:null},getAppImmersiveFrame:function(){return this.immersiveFrame||(this.immersiveFrame=U.getImmersiveFrame()),this.immersiveFrame},setDnDBehavior:function(e){this.getModels().setDnDBehavior()},setConfirmdDialog:function(e){this.options.model.setConfirmdDialog(e)},loadStruct:function(e){void 0!==e&&e.length>0&&this.structureEditor._loadData(e),0===this.getModels().getRoots().length&&this.empty()},updateStoredObjects:function(e){void 0!==e&&e.length>0&&this._trmModelEvents.publish({event:"TRMViews-WelcomePanel-updateStoredObjects",data:{item2remove:e}})},launchStructureBrowser:function(e){var t=this,n=[];if(e)if(e&&1==e.x3DSearch&&e.data)t.TRMTypeManagement.retrieveSelectedRootObjects({data:e.data,callback:function(e){var n=e;Array.isArray(e)||(n=[e]),t.options.model.removeRoots(),t.loadStruct(n)}});else if(e.physicalid)t.DataService.getObjectInfo(e).then(function(e){t.structureEditor._loadData([e])}).catch(function(n){console.log(n),t.updateStoredObjects([e.physicalid]),0===t.getModels().getRoots().length&&t.empty(),!0});else{var i=e;Array.isArray(e)||(i=[e]),t.loadStruct(i)}else{var r=t.PersistencyManager.getUserWorkingNodeIDs(),o=[];r.forEach(function(e){var i=w.wrappedWithPromise(function(i,r){var o={physicalid:e};t.DataService.getObjectInfo(o).then(function(e){i(e)}).catch(function(t){n.push(e),r()})});i&&o.push(i)}),w.allSettled(o).then(function(e){var i=[];e.forEach(function(e){"fullfilled"===e.state&&e.value&&i.push(e.value)}),t.updateStoredObjects(n),t.loadStruct(i)}).catch(function(e){console.log(e),!0})}t._trmModelEvents.publish({event:"TRMViews-WelcomePanel-closeLandingPage"})},empty:function(){this._applicationChannel.publish({event:"breadcrumb-link-clicked",data:{linkID:E.VIEW_RECENTLY_OPEN}})},search:function(e){var t="";e&&e.length>0&&(t=e),this._applicationChannel.publish({event:"search-in-current-dashboard",data:t})},getModels:function(){return this.options.model},getActiveDGV:function(){return this.structureEditor._dataGridView},_initWorkUnderChange:function(e){var t=this;UWA.is(t.CfgAuthoringContext)||widget.getValue("authorizeChangeControl")&&require(["DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext"],function(n){t.CfgAuthoringContext=n;n.initialize2(e,t.reqProxy.appId(),"show","bottom-right",function(e){t.options.widget.dispatchEvent("onAuthoringCtxAvailable",e),s.subscribe(t.CfgAuthoringContext.myAuthkey,function(e){setTimeout(function(){t._applicationChannel.publish("onRefresh")},1e3)}),s.subscribe("toggleDeActiveCA"+t.CfgAuthoringContext.myAuthkey,function(e){setTimeout(function(){t._applicationChannel.publish("onRefresh")},200)}),s.subscribe("removeAuthCtxEvent"+t.CfgAuthoringContext.myAuthkey,function(e){setTimeout(function(){t._applicationChannel.publish("onRefresh")},200)})},{isEvolution:!1})})},getAuthoringContextPID:function(){var e="";if(UWA.is(this.CfgAuthoringContext))try{var t=this.CfgAuthoringContext.get();e=UWA.is(t)&&UWA.is(t.change.id)?t.change.id:""}catch(e){console.warn("CfgAuthoringContext throw an error")}return e},getAuthoringContextName:function(){var e="";if(UWA.is(this.CfgAuthoringContext))try{var t=this.CfgAuthoringContext.get();e=UWA.is(t)&&UWA.is(t.change.name)?t.change.name:""}catch(e){console.warn("CfgAuthoringContext throw an error")}return e},isAttributeManagmentEnabled:function(){return!(!this.useENOREQ2D||"true"!==this.useENOREQ2D)},getCustomizedColumn:function(){return V.pad_columns?V.pad_columns:[]},getDefaultAttributes:function(){return this.getSetting("defaultAttributes")},getDefaultSelectedTypes:function(){return this.getSetting("defaultSelectedTypes")},getDefaultSelectedExtensions:function(){return this.getSetting("defaultSelectedExtensions")},getColumnProviderSetting:function(){return this.getSetting("columnsProviders")},isConfigAuthorized:function(){return!!this.isDecouplingActivated()},isDecouplingActivated:function(){for(var e=this.DataService.getConfigSettings(),t=null,n=0;n<e.length;n++)if("decoupleVariantEvolution"===e[n].settingName){t=e[n];break}return!(!t||"enabled"!=t.value)},getReqSpecRoot:function(e){return e.getRoot().getID()},refreshOnRevise:function(e){var t=this;this.author(!0);var n=[],i=[],r=[];new c(function(o){e.forEach(function(s){var a=t.options.model.getNodesByRelId(s.old_rel_id)[0],l=a.options.Effectivity,d=a.options.grid["ds6w:isLastRevision"],u=a.options.grid["ds6w:status"],p=a.getParent().getID();r.push(p);var h={parentID:p};new c(function(e){e(M.getConfiguredObjectInfo(h))}).then(function(r){r=r.contexts.content.results;a.getParent();i.push({resourceid:s.object.physicalid,relationid:s.object["physicalid[connection]"],treeOrder:s.object["attribute[TreeOrder]"],parentID:p});var c=s.ChangeActionID;if(""==c||null==c&&null==c||0==r||null==r){f=s.old_rel_id;n.push({physicalid:f});var h=t.options.model.getNodesByRelId(s.old_rel_id)[0].getParent().getOccurencePath();h.push(s.object["physicalid[connection]"]),h.push(s.object.physicalid),t.reqCommandProxy.revise({data:s,newPath:h,selection:t.options.model.getNodesByRelId(s.old_rel_id)[0].getParent().getOccurencePath(),path:t.options.model.getNodesByRelId(s.old_rel_id)[0].getOccurencePath(),appId:widget.getValue("appId")})}else{if("Yes"==l&&"TRUE"==d&&"Released"!=u){var f=s.old_rel_id;n.push({physicalid:f})}var g=[];g.push(s.old_object_id),t.structureEditor.UpdateModifiedNodes(g).then(function(){console.log("Is last revision refreshed")});var m=a.getParent().getOccurencePath();m.push(s.object["physicalid[connection]"]),m.push(s.object.physicalid);var v={appId:widget.getValue("appId"),object:s.object,path:m,selection:a.getOccurencePath(),mode:"insert"};t.reqCommandProxy.attach(v)}e.length==i.length&&o(i)})})}).then(function(e){t.refreshView({deleted:n}),t.insertNodes(e),t._updateNodesOnTRMWidget(r)})},refreshOnRemove:function(e){this.author(!0);var t=[],n=[],i=e.path[e.path.length-2];t.push({physicalid:i});var r=this.getModels().getNodesByRelId(i)[0];if(r){var o=r.getParentId();n.push(o)}this.refreshView({deleted:t}),this.reqCommandProxy.detach({appId:widget.getValue("appId"),path:e.path}),this._updateNodesOnTRMWidget(n)},refreshOnInsert:function(e,t,n){var i=this,r=[],o=[],s=[];i.author(!0),null==n&&(n="insert"),null===t&&(t="ENORETV_AP"),(UWA.is(e,"string")?JSON.parse(e):e).forEach(function(e){var a=e["from.physicalid[connection]"],l=e.physicalid,c=e["physicalid[connection]"],d=e["attribute[TreeOrder]"],u=i.options.model.getNodesById(a)[0];r.push({resourceid:l,relationid:c,parentID:a,treeOrder:d}),s.push(a);var p=u.getOccurencePath();p.push(e["physicalid[connection]"]),p.push(e.physicalid);var h={object:e,path:p,selection:p,mode:n};if("ENORERV_AP"!==t)if("DOCUMENTS"===e["type.kindof"]){var f={paths:[[l]],appId:widget.getValue("appId")};i.reqCommandProxy.drop(f)}else o.push(h);var g=i.getAuthoringContextName();g&&(u.options.grid["ds6w:realizedChangeAction"]=g,u.updateOptions(u.options))}),i.insertNodes(r),"ENORERV_AP"!==t&&i.reqCommandProxy.attach({appId:widget.getValue("appId"),eventData:o}),i._updateNodesOnTRMWidget(s)},_updateNodesOnTRMWidget:function(e){if(e.length>0){var t={authored:{modified:e}};this._padCommandProxy.refresh(t)}},refreshOnReorder:function(e,t){var n=this,i=parseFloat(e.new_position.treeOrder);n.options.model.getRoots().forEach(function(t){for(var r=function(t,n){var r=t.getChildren(),o=0;if(r&&r.length>0)for(;o<r.length;){if(r[o].options.relationOrder>i){if(n.options.resourceid===r[o].options.resourceid){r[o].options.relationOrder=i,r[o].options.relationid=e.new_position.relid;break}n.options.relationOrder=i,n.options.relationid=e.new_position.relid,t.insertBefore(n,r[o]);break}if(o==r.length-1){n.options.relationOrder=i,n.options.relationid=e.new_position.relid,t.addChild(n);break}o++}else n.options.relationOrder=i,n.options.relationid=e.new_position.relid,t.addChild(n),t.expand()},o=t.getNodesById(e.new_position.path[e.new_position.path.length-1]),s=n.options.model.getNodesById(e.id),a=0;a<s.length;a++)o[a]&&r(o[a],s[a])})},refreshView:function(e){var t,n,i=e.deleted;if(i){var r=this;i.forEach(function(e){var i=e.physicalid,o=r.getPADTreeDocument().getNodesById(i);o&&0!==o.length||(o=r.getPADTreeDocument().getNodesByRelId(i)),o.forEach(function(e){e.isRoot()?(t||(t=[]),t.push(i)):(n||(n=[]),n.push(e))})})}(n&&this.getPADTreeDocument().deleteNodes(n),t)&&(this._onRemoveRoot({pids:t}),t.length&&require("DS/PADServices/utils/GlobalModelEvents").publish({event:"TRMViews/WelcomePanel/cleanup",data:{item2remove:t}}))},refreshOnDnD:function(e,t,n){var i=this,r=[];i.author(!0);var o=UWA.is(e,"string")?JSON.parse(e):e;"COPY"==n?i.refreshOnInsert(o,null,"insertExisting"):(o.forEach(function(e){var t=e["physicalid[connection]"],n=e["from.physicalid[connection]"],o=i.getModels().getNodesById(n),s=e["old_physicalid[connection]"],a=s?i.options.model.getNodesByRelId(s):"",l=a?a[0].getOccurencePath():"",c=a?a[0].getParent().options.resourceid:n,d=e.physicalid,u={id:d,appId:widget.getValue("appId"),new_position:{relid:t,path:o[0].getOccurencePath(),treeOrder:e["attribute[TreeOrder]"],relType:e["type[connection]"]},old_position:{relid:s||t,path:c?i.getModels().getNodesById(c)[0].getOccurencePath():"",id:c}};r.push(d),r.push(n),r.push(c),i.refreshOnReorder(u),"Reparent"==e.operation&&(s&&i.reqCommandProxy.detach({appId:widget.getValue("appId"),path:l}),i.reqCommandProxy.attach({appId:widget.getValue("appId"),object:e,path:i.getModels().getNodesById(e.physicalid)[0].getOccurencePath(),mode:"insertExisting",selection:o[0].getOccurencePath()}),u.old_position.path=o[0].getOccurencePath()),i.reqCommandProxy.reorder(u)}),i._updateNodesOnTRMWidget(r))},openPanel:function(e){this.elements.openPanel(e)},insertNodes:function(e,t,n){this.options.model.insertNodes(e,t,n)},refreshOnCreate:function(e,t,n){var i=this;i.DataService.getObjectInfo(e).then(function(e){i.options.model.prepareUpdate(),e&&B.root_type.indexOf(e.options.reqKindOf)>-1&&i.options.model.addRootNodes([e]),i.options.model.pushUpdate(),t||i.DataService.getExpandData(e).then(function(e){e.getAllDescendants().forEach(function(e){i.options.model.updateNodesByID(e)}),n&&i.options.model.removeRoot(n)}),i._applicationChannel.publish({event:"RequirementStructureBrowser-Root-manage",data:{added_node:e}})}).catch(function(e){console.log(e)})},refreshOnInsertSibling:function(e,t,n){this.author(!0);var i=[],r=this.getSelectedNodes(),o=r[0].getParent().getID(),s=UWA.is(e,"string")?JSON.parse(e):e,a=s;Array.isArray(s)&&(a=s[0]);var l=a.physicalid,c=a["physicalid[connection]"],d=a["attribute[TreeOrder]"],u=[];u.push({resourceid:l,relationid:c,parentID:o}),i.push(o),this.insertNodes(u,n,d),this.options.model.prepareUpdate(),this.options.model.pushUpdate();var p=r[0].getOccurencePath(),h=r[0].getParent().getOccurencePath();h.push(a["physicalid[connection]"]),h.push(a.physicalid);var f={appId:widget.getValue("appId"),object:a,path:h,selection:p,mode:"append"};if("DOCUMENTS"===a["type.kindof"]){var g={paths:[[r[0].options.resourceid]],appId:widget.getValue("appId")};this.reqCommandProxy.drop(g)}else this.reqCommandProxy.attach(f);this._updateNodesOnTRMWidget(i)},refreshGridForSetEffectivities:function(e){this.author(!0);var t=this,n=[],i=!1,r=UWA.is(e,"string")?JSON.parse(e):e;r.commandName;r=r.response.results?r.response.results:r.data;var o=[];r.pids?(r.pids=r.pids?r.pids:[],r.pids.forEach(function(e){var n=t.getModels().getNodesById(e)[0];o.push(n)})):r.forEach(function(e){if("SUCCESS"===e.status)if(e.existing&&!e.new){var s=t.getModels().getNodesByRelId(e.existing.pid);o.push(s[0])}else if(e.new){i=!0;var a=w.wrappedWithPromise(function(i,s){var a,l=t.options.model.getNodesByRelId(e.existing.pid)[0],c=l.options.relationid;a=l&&l.getNextBrother()?l.getNextBrother().options.relationid:"";var d=l.getParent().getID(),u={physicalid:e.new.pid,currentObjRelID:c,nextSiblingRelID:a};t.DataService.setTreeOrder(u).then(function(s){if("success"==s){var a={physicalid:e.new.pid};t._appContext.DataService.getTreeOrder(a).then(function(s){var a="";null==s["attribute[TreeOrder]"]&&""==s["attribute[TreeOrder]"]||(a=s["attribute[TreeOrder]"]),n.push({resourceid:l.options.resourceid,relationid:e.new.pid,treeOrder:a,parentID:d});var c=t.getModels().getNodesByRelId(e.existing.pid)[0];o.push(c);var u=l.getOccurencePath(),p=l.getParent().getOccurencePath();p.push(e.new.pid),p.push(l.options.resourceid);var h={};h.displayName=l.options.type,h.value=l.options.type;var f=[],g={"attribute[Title]":l.options.req_label,"attribute[TreeOrder]":a,"from.physicalid[connection]":l.getParent().getID(),name:l.options.req_name,physicalid:l.options.resourceid,"physicalid[connection]":e.new.pid,"type.kindof":l.options.reqKindOf,"type[connection]":l.options.relationtype,type:{displayName:l.options.grid["ds6w:type"],value:l.options.type},revision:l.options.grid["ds6wg:revision"]};f.push(g);var m={appId:widget.getValue("appId"),object:f[0],path:p,selection:u,mode:"insertExisting"};t.reqCommandProxy.attach(m),r.length==n.length&&i(n)}).catch(function(e){console.log(e)})}}).catch(function(e){console.log(e)})});w.allSettled(a).then(function(e){"fullfilled"===e[0].state&&(t.insertNodes(e[0].value),t.DataService.updateConfigurationData(o))})}}),o.length>0&&!1===i&&t.DataService.updateConfigurationData(o)},refreshOnTraceabilityAuthoring:function(e){var t=this;"create"===e.event?t.options.model.getRoots().forEach(function(n){var i,r,o=n.getNodesById(e.data.from.id),s=n.getNodesById(e.data.to.id);"refined"==e.data.link_type?(i="ds6w:refinedInto",r="ds6w:covers"):(i="ds6w:covers",r="ds6w:refinedInto"),t.options.model.wrapInTransaction(function(){t.options.model.withTransactionUpdate(function(){o.forEach(function(e){if(e.options.grid[i]){var t=parseFloat(e.options.grid[i])+1;e.options.grid[i]=""+t,e.updateOptions(e.options.grid)}else e.options.grid[i]="1",e.updateOptions(e.options.grid)}),s.forEach(function(e){if(e.options.grid[r]){var t=parseFloat(e.options.grid[r])+1;e.options.grid[r]=""+t,e.updateOptions(e.options.grid)}else e.options.grid[r]="1",e.updateOptions(e.options.grid)})})})}):"delete"===e.event&&t.options.model.getRoots().forEach(function(n){for(var i=n.getNodesById(e.data.selected_id),r=[],o=[],s=e.data.covered_ids,a=e.data.refined_ids,l=0;l<s.length;l++){var c=n.getNodesById(s[l]);r=r.concat(c)}for(l=0;l<a.length;l++){c=n.getNodesById(a[l]);o=o.concat(c)}t.options.model.wrapInTransaction(function(){t.options.model.withTransactionUpdate(function(){i.forEach(function(e){var t;e.options.grid["ds6w:refinedInto"]&&a.length>0&&(t=(t=parseFloat(e.options.grid["ds6w:refinedInto"])-a.length)<=0?"":t,e.options.grid["ds6w:refinedInto"]=""+t,e.updateOptions(e.options.grid));e.options.grid["ds6w:covers"]&&s.length>0&&(t=(t=parseFloat(e.options.grid["ds6w:covers"])-s.length)<=0?"":t,e.options.grid["ds6w:covers"]=""+t,e.updateOptions(e.options.grid))}),r.forEach(function(e){if(e.options.grid["ds6w:covers"]){var t=parseFloat(e.options.grid["ds6w:covers"])-1;t=t<=0?"":t,e.options.grid["ds6w:covers"]=""+t,e.updateOptions(e.options.grid)}}),o.forEach(function(e){if(e.options.grid["ds6w:refinedInto"]){var t=parseFloat(e.options.grid["ds6w:refinedInto"])-1;t=t<=0?"":t,e.options.grid["ds6w:refinedInto"]=""+t,e.updateOptions(e.options.grid)}})})})})},getPADTreeDocument:function(){return this.options.model},getSelectedElement:function(){var e=this.getSelectedNodes();return e.length<1?null:e.length>1?null:{physicalid:e[0].getID(),type:e[0].options.type,path:e[0].getOccurencePath(),ParentLabel:e[0]._parentNode.options.label,label:e[0].options.label,kindof:this._defaultTypes[e[0].options.type]||e[0].options.type}},getSelectedElementList:function(){var e,t=this.getSelectedNodes(),n=[];if(t.length<1)return null;for(var i=0;i<t.length;i++)e={physicalid:t[i].getID(),type:t[i].options.type,path:t[i].getOccurencePath(),ParentLabel:t[i]._parentNode.options.label,label:t[i].options.label,kindof:this._defaultTypes[t[i].options.type]||t[i].options.type},n.push(e);return n},author:function(e){u.setAuthoringState(e,"Disabling index acceleration following an authoring operation")},getDefaultType:function(e){var t=e.replace(" ","_"),n=widget.getPreference("trm_types_"+t);return UWA.is(n)?widget.getValue("trm_types_"+t):e},getSecurityContext:function(){return{SecurityContext:f.getSecurityContext()}},getTenant:function(){return f.getTenant()},getSelectedNodes:function(){var e=this,t=this.options.model.getSelectedNodes();return UWA.is(t)&&t.forEach(function(t){t.tenant=e.getTenant()}),t},getToAddSelectedElement:function(){var e=this.getSelectedNodes();if(e.length<1)return null;if(e.length>1)return null;var t=e[0],n=t.getParent(),i=n.getChildren(),r=i.indexOf(t),o={},s={id:t.options.resourceid,relId:t.options.relationid};return i.length>r+1&&(o={id:i[r+1].options.resourceid,relId:i[r+1].options.relationid}),{physicalid:n.options.resourceid,type:n.options.type,path:e[0].getOccurencePath(),kindof:this._defaultTypes[n.options.type]||n.options.type,nextSibling:o,previousSibling:s,previousNode:r}},_defineDefaultTypes:function(){this._defaultTypes={"Requirement Proxy":"Requirement"};var e=[],t=this;["Requirement Specification","Comment","Requirement","Chapter","Requirement Group"].forEach(function(n){var i=n.replace(" ","_"),r=widget.getPreference("trm_types_"+i);UWA.is(r)?r.options.forEach(function(i){e.push(i.value),e.push(i.value.replace(new RegExp(" ".replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),"_")),t._defaultTypes[i.value]=n}):t._defaultTypes[n]=n}),widget.addPreference("authorized_types",e)},getEditMode:function(){return!0},beginBlockingTransaction:function(e){S.mask(this.elements.container,e)},endBlockingTransaction:function(){S.unmask(this.elements.container)},addNodesFromContent:function(e,t,n,i){var r=this,o={physicalid:e.data.items[0].objectId};console.log(e.data.items[0]),r.DataService.getObjectInfo(o).then(function(e){r._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:e}),t.callback()}).catch(function(e){t.callback(),reject(e)})},createRootobjects:function(e){var t=this,n=t.getDefaultType(e);t.DataService.createRootObject(n).then(function(e){t._trmModelEvents.publish({event:"TRMViews-WelcomePanel-OpenStructure",data:e})}).catch(function(e){console.log(e)})},_onWidgetRefresh:function(e){switch((t=this).PersistencyManager.setWidgetRefreshStatus(!0),this.activeView=widget.getValue(E.ACTIVE_VIEW)){case E.VIEW_REQ_SPEC_LIST:t.reqspeclistview(E.TYPE_REQUIREMENT_SPECIFICATION),t.PersistencyManager.setWidgetRefreshStatus(!1);break;case E.VIEW_REQ_LIST:t.reqspeclistview(E.TYPE_REQUIREMENT),t.PersistencyManager.setWidgetRefreshStatus(!1);break;case E.VIEW_STRUCTURE_BROWSER:var t;(t=this).isWidgetRefresh=!0;var n=t.getModels();S.mask(this.structureEditor._structure_container,t.getNls("WIDGET_REFRESH"));var i=n.getRoots(),r=[];n.ids_nodes={},i.forEach(function(e){e.getAllDescendants().forEach(function(e){var t=[];n.ids_nodes[e.options.resourceid]&&(t=n.ids_nodes[e.options.resourceid]),t.push(e),n.ids_nodes[e.options.resourceid]=t}),n.ids_nodes[e.options.resourceid]=[e],r.push(e.getID())});var o=[],s=[];r.forEach(function(e){o.push(w.wrappedWithPromise(function(i,r){var o={physicalid:e};(new Date).getTime();t.DataService.getObjectInfo(o).then(function(e){t.DataService.getExpandData(e).then(function(r){n.updateNodesByID(r,!0),r.getAllDescendants().forEach(function(e){var i=n.ids_nodes[e.options.resourceid];if(i){var r=i[0],o=r.getParent().getOccurencePath(),s=e.getParent().getOccurencePath();if(!s.equals(o)){var a={appId:widget.getValue("appId"),id:r.getID(),old_position:{id:r.getParent().getID(),relid:r.getRelationID(),path:o},new_position:{id:e.getParent().getID(),relid:e.options.relationid,reltype:e.options.relationtype,path:s,treeOrder:e.options.relationOrder}};t.refreshOnReorder(a)}}n.updateNodesByID(e,!0),delete n.ids_nodes[e.options.resourceid]}),delete n.ids_nodes[r.options.resourceid],i(e)})}).catch(function(t){console.log(t),s.push(e),r()})}))}),w.allSettled(o).then(function(e){t.PersistencyManager.setWidgetRefreshStatus(!1),S.unmask(t.structureEditor._structure_container);var r=[];for(var o in n.ids_nodes)n.ids_nodes.hasOwnProperty(o)&&r.push(n.ids_nodes[o][0]);n.deleteNodes(r,!0),n.ids_nodes={},t.isWidgetRefresh=!1,t.DataService.getParameterInfo(i),t.DataService.updateConfigurationData(i),t.updateStoredObjects(s),0===t.getModels().getRoots().length&&t.empty(),g.notifyAlert(t.getNls("WIDGET_REFRESH_DONE"))}).catch(function(e){console.log(e)});break;case E.VIEW_RECENTLY_OPEN:t.DataService.getRecentItems()&&(S.mask(this._applicationContent,t.getNls("WIDGET_REFRESH")),t.getModels().removeRoots(),t.RecentlyOpenSpec._loadData(),S.unmask(this._applicationContent)),t.PersistencyManager.setWidgetRefreshStatus(!1)}},_initProxyEvents:function(){var e=this;if(e.mandatoryStartup.push(w.wrappedWithPromise(function(t,n){v.getCustomTypes({type:"Requirement",selectables:"type,name,revision,attribute[Title]",onComplete:function(n){var i=UWA.is(n,"string")?JSON.parse(n):n;e.saveCSRF(i.csrf),e.useENOREQ2D=i.useENOREQ2D,t(e.useENOREQ2D)},onFailure:function(e){g.errorAlert(e)}})})),"enopad_odt_wgd"!=widget.id)try{require(["text!DS/OSLCConsumer/assets/OSLCConfig.json"],function(t){e.OSLCProviders=JSON.parse(t),UWA.is(e.OSLCProviders)&&UWA.is(e.OSLCProviders.repositories)&&e.OSLCProviders.repositories.length>0&&(e.externalProviders=!0)})}catch(e){console.log("/OSLCConsumer/assets/OSLCConfig.json file not found")}try{require(["text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(t){e._relPattern=JSON.parse(t)})}catch(e){console.log("/OSLCConsumer/assets/OSLCConfig.json file not found")}UWA.is(this._padCommandProxy)||(e._padCommandProxy=p.create({events:{onRefresh:function(e){},onSelect:function(e,t){}}})),require(["DS/TraceableRequirementsUtils/REQCommandProxy"],function(t){e.reqCommandProxy=t.create({events:{onDrop:function(t){if("ENORETV_AP"!=t.appId){"new"===t.action&&e.author(!0);var n={pids:[t.id],id_to_detach:[]};e.richViewDropIn=!0,e.add(n)}},onReorder:function(t){"ENORETV_AP"!==t.appId&&e.refreshOnReorder(t)},onDetach:function(t){if("ENORETV_AP"!==t.appId&&"enopad_odt_wgd"!==widget.id){var n=e.options.model.getNodesById(t.path[t.path.length-1])[0];e.author(!0),n.getID()===t.path[t.path.length-1]&&e.refreshOnRemove(t)}},onTraceabilityAuthoring:function(t){e.refreshOnTraceabilityAuthoring(t)},onAttach:function(t,n){if("ENORETV_AP"!==t.appId&&"enopad_odt_wgd"!=widget.id){e.author(!0);var i=[];e.richView_node_id=t.selection[t.selection.length-1];var r=e.options.model.getNodesById(e.richView_node_id)[0];if("insert"===t.mode)r&&"expandState"!==r._expandState&&(i.push({resourceid:t.object.physicalid,relationid:t.object["physicalid[connection]"],parentID:r.getID()}),e.refreshOnInsert([t.object],"ENORERV_AP"));else{var o=r.getParent(),s=o.getChildren();if(o&&"expandState"!==o._expandState){var a=s.indexOf(r);i.push({resourceid:t.object.physicalid,relationid:t.object["physicalid[connection]"],parentID:o.getID()}),e.insertNodes(i,a)}}}},onReqSelect:function(t,n){if(!UWA.is(t.commandId)||"TVDeleteCommand"!==t.commandId)if("ENORETV_AP"!==t.appId){var i=e.options.model.getNodesById(t.paths[0][t.paths[0].length-1])[0];UWA.is(i)&&(e.options.model.unselectAll(),setTimeout(function(){var t=e.getSelectedNodes()[0];UWA.is(t)||(e.richViewDropIn=!0,i.select())},50))}else e.deleteCommand(t.data)},onPreferenceModification:function(e){if(UWA.is(e)&&UWA.is(e.appId)&&e.appId!==widget.getValue("appId")){var t=e.preferences;UWA.is(t)&&t.length>0&&t.forEach(function(e){widget.hasPreference(e.name)?widget.setValue(e.name,e.value):"req_tenant"===e.name?widget.setValue("x3dPlatformId",e.value):"trm_security_ctx"===e.name&&widget.setValue("pad_security_ctx",e.value),"trm_security_ctx"===e.name&&f.setXPrefCredentials(widget,e.value)})}},onRefresh:function(t){var n=function(n){var i=Object.getOwnPropertyNames(n);for(var r in i)"insertExisting"===i[r]?t.origin&&"CCP"===t.origin||e.getModels()._viewInsertExisting(n.insertExisting):"detach"===i[r]?e.getModels()._viewDetach(n.detach):"reParent"===i[r]&&e.getModels()._viewReParent(n.reParent)};if(t.transactions)t.transactions.forEach(function(e){n(e)});else if(t.authored){var i={physicalid:t.authored.modified[0]};e.DataService.getObjectInfo(i).then(function(t){e.getModels().updateNodesByID(t,!0)}).catch(function(e){console.log(e),reject(e)})}else n(t);e.isWidgetRefresh=!1}}})}),s.subscribe("DS/PARParameterComponent/PlatformAPI/create",function(t){if(UWA.is(t.parentid)&&UWA.is(t.physicalid)&&UWA.is(t.relid)){var n=[{"from.physicalid[connection]":t.parentid,physicalid:t.physicalid,"physicalid[connection]":t.relid}];e.refreshOnInsert(n)}})},add:function(e,t,n){var i=this,r=e||{},o=[];switch(e.content){case"idslist":o=(r=e).pids;break;case"pathslist":for(var s=0;s<e.paths.length;s++)o.push(e.paths[s][0]);break;case"3DXContent":o=(r=_build3DXContentParams(e)).pids;break;default:if(!r.pids)throw new Error("Not supported content");o=r.pids}for(var a=widget.getValue("trm_tv_addednodes"),l=0;l<o.length;l++)if(UWA.is(a[o[l]])&&a[o[l]].tenant!=this.getTenant())return;if(UWA.is(t,"function")&&(e.callback=t),!1===this.richViewDropIn){var c={paths:[r.pids],appId:widget.getValue("appId")};this.reqCommandProxy.drop(c)}else this.richViewDropIn=!1;this.options.model.getModelEvents().subscribe({event:"onReqAdded"},function(e){}),o.length>0&&this.options.model.add({pids:o,callback:function(){UWA.is(r.id_to_detach,"array")&&r.id_to_detach.length>0&&r.id_to_detach.forEach(function(e){var t=i.options.model.searchRootById(e);UWA.is(t)&&i.toggleRoot({context:t})}),UWA.is(e.callback,"function")&&e.callback.call(null)}})},_onSelect:function(e){if("enopad_odt_wgd"!=widget.id){var t=this.getSelectedNodes();if(h.clearObjects(),h.addAssignee([f.getUserLogin()]),t.length>0)for(var n=0;n<t.length;n++)h.addProposed([t[n].getID()]);else h.clearObjects()}},getEnforceSettings:function(){return this.DataService.isChangeEnabled},getSelectedExtensions:function(){return B.defaultSelectedExtensions},getBaseReferenceTypes:function(){return B.baseReferenceTypes},getBaseExtensions:function(){return B.baseExtentions},getBaseInstanceTypes:function(){return[]},getSelectedTypes:function(){return B.defaultSelectedTypes},_getDefaultAttributesPreferences:function(){return{selectedTypes:B.defaultSelectedTypes,selectedExtensions:B.defaultSelectedExtensions,columns:B.defaultAttributes}},focusChange:function(e){var t=this;null!==t._pagerview&&("previous"==e.event&&(t._selectedIdx--,t.reframeOn()),"next"==e.event&&(t._selectedIdx++,t.reframeOn()),"selectAll"==e.event&&(t.select_on=!0,t._pagerview.elements.selectButton.addClassName("TRMSearchNavSelectButtonActive"),t._matchedNodes.forEach(function(e){var n=t.options.model.getNodesByRelId(e);n&&n.forEach(function(e){e.select()})})),"unSelectAll"==e.event&&(t.select_on=!1,t.getActiveDGV().unselectAll(),t._pagerview.elements.selectButton.removeClassName("TRMSearchNavSelectButtonActive"),t.reframeOn()))},reframeOn:function(){-1===this._selectedIdx&&(this._selectedIdx=this._matchedNodes.length-1);var e=this._selectedIdx%this._matchedNodes.length;if(this._pagerview){var t=e+1+"/"+this._matchedNodes.length;this._pagerview.setLabel(t)}this.options.model.getSelectedNodes().forEach(function(e){e.unselect()});var n=this.options.model.getNodesByRelId(this._matchedNodes[e]);n&&n.forEach(function(e){e.select()})},displayTRMSearchNav:function(e,t){var n=this;n._selectedIdx=0,n.select_on=!1,n.searchString=t,n._matchedNodes=e,n._pagerview||(n._pagerview=new m({renderTo:document.body,multiSel:!0}),n._pagerview.subscribe({event:"previous"},function(){n.focusChange({event:"previous"})}),n._pagerview.subscribe({event:"next"},function(){n.focusChange({event:"next"})}),n._pagerview.subscribe({event:"close"},function(){n._selectedIdx=0,n._matchedNodes=[],n._pagerview.hide()}),n._pagerview.subscribe({event:"select-on"},function(){n.select_on&&1==n.select_on?n.focusChange({event:"unSelectAll"}):n.focusChange({event:"selectAll"})})),n._pagerview.show()},subscribeEvents:function(){var e=this;e._applicationChannel.subscribe({event:"breadcrumb-link-clicked"},function(t){e.deactivatedStructureBrowser(),e._trmModelEvents.publish({event:"TRMViews-WelcomePanel-activate"}),e._trmModelEvents.publish({event:E.EVENT_WELCOME_PANEL_EXPAND}),e.previous_view?t.id=e.previous_view:t.id=E.VIEW_RECENTLY_OPEN,e._trmModelEvents.publish({event:"welcome-panel-active-view",data:t})}),e._applicationChannel.subscribe({event:"search-in-current-dashboard"},function(t){if("StructureEditor"==e.active_view){var n="";t&&t.length>0&&(n=t);var i=e.options.model.getRoots(),r=e.options.model.getAllDescendants();i.forEach(function(e){e.expandAll()});for(var o=[],s=e.columnManager.getVisibleColumns(),a=0;a<r.length;a++)r[a].match(n,s)&&-1==o.indexOf(r[a].getRelationID())&&o.push(r[a].getRelationID());o.length>0?(e.displayTRMSearchNav(o,n),e.reframeOn()):e._pagerview&&e._pagerview.hide(),o.length<=0&&""!=n&&g.notifyAlert(O.SearchWithInDashboard_OccurenceNotFound)}}),e._applicationChannel.subscribe({event:"TRMViews-StructureEditor-update"},function(t){setTimeout(function(){e._onWidgetRefresh(t)},500)})},deactivatedStructureBrowser:function(){var e=this.options.model.getRoots();this.cleanProxy(),this._pagerview&&this._pagerview.hide(),e&&e.length>0&&(this.options.model.removeRoots(),this._localModelEvent.publish({event:"RequirementStructureBrowser-Root-remove",data:{all:!0,noDispatch:!0}}),this.PersistencyManager.saveUserWorkingRootNodes([]))},loadFiles:function(e,t){return new c(function(t,n){var i=function(e){n(e)};Array.isArray(e)?require(e,function(){t(arguments)},i):i(e)})},getSelectedParentWithChild:function(e){if(null!=e&&e.length){for(var t=[],n=e.length,i=0;i<n;){for(var r=e[i],o=i+1;o<e.length;o++){for(var s=e[o],a=s.getParent(),l=!1;a;)r===a&&(l=!0,t.push({parent:r,child:s})),a=a.getParent();if(0==l)for(a=r.getParent();a;)s==a&&t.push({parent:r,child:s}),a=a.getParent()}i++}return t}return[]}})});