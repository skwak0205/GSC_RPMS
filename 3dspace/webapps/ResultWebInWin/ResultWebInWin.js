define("DS/ResultWebInWin/ResultWebInWinAction",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Events","DS/SNInfraUX/SearchCom"],function(e,t,n,i,s){"use strict";return t.singleton(i,n,{myWebInWinActionSocket:null,executeAction:function(t,n){e.log("Execute action: "+n);var i,a=0;if(e.is(this.myWebInWinActionSocket)||(this.myWebInWinActionSocket=s.createSocket({socket_id:"search_WebInWinAction_"+Math.floor(1e5*Math.random()+1)})),!e.is(n))throw new Error("No options given to executeAction method !");var o=!1;e.is(n,"array")&&(o=!0);var r=!1;if(e.is(t,"array")&&(r=!0),!0===r){if(!e.is(t[0]))throw new Error("No selectedModels given to executeAction method !");if(!e.is(t.action_id))throw new Error("No selectedModels.action_id given to executeAction method !");var c=t.length;for(i={action:t.action_id,objectIds:[]},a=0;a<c;a++){if(!e.is(t[a].id))throw new Error("No selectedModels.id given to executeAction method !");i.objectIds.push(t[a].id)}}else if(!1===o){if(!e.is(t))throw new Error("No selectedModels given to executeAction method !");if(!e.is(t.action_id))throw new Error("No selectedModels.action_id given to executeAction method !");(i={action:t.action_id,objectIds:[]}).objectIds.push(t.id)}else{if(!e.is(n[0]))throw new Error("No options given to executeAction method !");if(!e.is(n[0].action_id))throw new Error("No options.action_id given to executeAction method !");for(i={action:n[0].action_id,objectIds:[]},a=0;a<n.length;a++){if(!e.is(n[a].action_id))throw new Error("No options.action_id given to executeAction method !");if(!e.is(n[a].object_id))throw new Error("No options.object_id given to executeAction method !");i.objectIds.push(n[a].object_id)}}this.myWebInWinActionSocket.dispatchEvent("onDispatchToWin",{notif_name:"onCtxMenuClick",notif_parameters:JSON.stringify(i)},"search_web_in_win")}})}),window.onload=function(){-1===window.location.search.indexOf("no_jsnotif=true")&&sendNotificationWebInWin("PageLoaded","done"),window.parent.postMessage("search_web_in_win_ready","*"),require(["UWA/Core","UWA/Drivers/Alone","i18n!DS/SNResultUX/assets/nls/SNResultUX.json"],function(e,t,n){var i=window.document.getElementById("temp-search-msg-span");if(e.is(i)){var s=e.extendElement(i);e.is(s)&&s.setHTML(n.get("webinwin_search_loading"))}})},define("DS/ResultWebInWin/ResultWebInWin",["UWA/Drivers/Alone","UWA/Core","UWA/Class/Debug","UWA/Controls/Abstract","UWA/Class/Listener","UWA/Element","UWA/Event","DS/MessageBus/MessageBus","DS/SNResultUX/SNTabbedResultMgt","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchCom","text!DS/SNResultUX/assets/WebInWin_settings.json","DS/SNResultUX/utils/WildcardMgr","DS/SNResultUX/utils/SearchServices","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SearchUtils","i18n!DS/SNResultUX/assets/nls/SNResultUX.json","DS/SNInfraUX/SearchRevisionDelegator","DS/SNResultUX/views/WebUiAssets/UIKIT/Mask"],function(e,t,n,i,s,a,o,r,c,l,d,g,_,h,u,m,v,p,f,b,S,E){"use strict";return i.extend(n,s,{name:"DS_ResultWebInWin_ResultWebInWin",_searchResult:null,_searchcom_socket:null,_listAccelerator:{},snTabManager:null,_widget_id:null,_socket_id:"search_web_in_win",_searchcontent_id:"",_timeOut:0,init:function(e){var n=this;this.setDebugMode(d.getDebugMode()),this._widget_id="web_in_win",a.addEvent.call(document,"keydown",function(e){var t=o.whichKey(e),n=o.getElement(e)?o.getElement(e).getTagName():"unknown";"backspace"!==t&&"alt+left"!==t||-1!==["input","select"].indexOf(n)||o.stop(e)}),a.addEvent.call(document,"contextmenu",function(e){dscef&&(0===dscef.getEnv("CATCEF_DEVTOOLS").length&&e.preventDefault())}),d.initialize(JSON.parse(h)),S.initialize("OnPremise");var i=d.getOption("OneSearch");t.is(i)&&!0===i&&d.setCompactMode(!1),n._searchcom_socket=_.createSocket({socket_id:this._socket_id}),n._searchcom_socket.addListener("onDispatchToWin",n._dispathTowin.bind(n)),n._searchcontent_id=e.searchcontent;var s=t.extendElement(document.body).getElement("."+n._searchcontent_id);!0===f.is6WInWebInWinActive()&&s.addClassName("embeddedTaggerWebInWin"),n.snTabManager=new c({widget_id:this._widget_id,resources:e.federated_source,updateTitle:function(e){n._dispathTowin({notif_name:"UpdatePanelTitle",notif_parameters:{panel_title:e}})},css_view_class:"maximized"}),s.setContent(n.snTabManager);var g={css_view_class:"maximized",in_apps_search:e.in_apps_search?e.in_apps_search:null,events:{onReady:function(){t.extendElement(document.body).getElement(".onesearch_recentcontent");n._dispathTowin({notif_name:"Init",notif_parameters:"done"});var i=window.document.getElementById("temp-search-msg");if(t.is(i)){var s=t.extendElement(i);t.is(s)&&i.destroy()}e.events&&e.events.onReady&&e.events.onReady.call(null)}}};g.source=e.source,n.snTabManager.addTab({tabTitle:b.get("newTabTitle"),search_ux_options:g}),window.addEventListener("resize",function(){var e=this;n._timeOut=750,l.log("window.addEventListener _timeOut: ",n._timeOut),l.log("window.addEventListener window.innerWidth: ",window.innerWidth),l.log("window.addEventListener window.innerHeight: ",window.innerHeight),setTimeout(function(){e.mySearchWebinWin&&e.mySearchWebinWin._searchcom_socket&&e.mySearchWebinWin._searchcom_socket.dispatchEvent("widgetResize"),l.log("setTimeout 500 widgetResize window.innerWidth: ",window.innerWidth),l.log("setTimeout 500 window.addEventListener window.innerHeight: ",window.innerHeight)},500)}),this.ressources=e.federated_source,r.subscribe({channel:this._widget_id,topic:"beforeSearchReload",callback:function(){n.log("treating beforeSearchReload event"),n.destroy()}}),r.subscribe({channel:f.TAGGERPROXY_CONTEXTID_WEB_IN_WIN,topic:"WebInWinTaggerProxy_die",callback:function(e){n.log("treating WebInWinTaggerProxy_die event"),n._dispathTowin(e)}}),n._searchcom_socket.addListener("Last_Tag_Filter",function(e){t.is(n._reSearchQuery)&&(n._reSearchQuery.last_tag_filter=e)})},destroy:function(){this.log("inside ResultWebInWin destroy"),t.is(this.snTabManager)&&this.snTabManager.destroy();try{null!==this._searchcom_socket&&this.searchcom_socket.disconnect()}catch(e){console.error(e.message)}},search:function(e){var n=this;setTimeout(function(){n._timeOut=0,t.is(e.value,"string")&&e.value.indexOf(":")>0?v.fetchPQsFromServer(n.ressources).then(function(){n.searchAsyncPQ(e)}):n.searchAsyncPQ(e)},n._timeOut)},searchAsyncPQ:function(e){this.log("ResultWebInWin search");var n=this.snTabManager.getActiveTab();if(t.is(n._snResultMgt)){n._snResultMgt._taggerProxy&&this.nextIsNewSearch&&""!==e.value&&(n._snResultMgt._taggerProxy.clearLocalFilter(),n._snResultMgt._taggerProxy.clearLocalGrouping&&n._snResultMgt._taggerProxy.clearLocalGrouping(),n._snResultMgt.sortPanelView.reinitMenu(),t.is(e)&&(e.donotshowlastsearch=!0),t.is(e)&&t.is(e.adv_search)&&e.adv_search&&(this.nextIsNewSearch=!1),this.nextIsNewSearch=!1);var i=e.value,s=e.search_mode;if(t.is(n._snResultMgt.options)&&t.is(n._snResultMgt.options.search_options)&&t.is(n._snResultMgt.options.search_options.search_mode)&&"recent"===n._snResultMgt.options.search_options.search_mode&&t.is(n._snResultMgt.options.search_options.adv_search)&&!1===n._snResultMgt.options.search_options.adv_search?s="recent":e.value=u.manageWildcardAddtion(e.value),e.value=f.replacePQsWithCVPrefixes(e.value),p.clear(),"*?*"===e.value||"?"===e.value)n._snResultMgt.onSearchPQ({search_criteria:e.value,adv_search:e.adv_search,search_mode:s,originalSearchCriteria:i});else if(t.is(e)&&"6WEmbeddedTagger"===e.value&&t.is(e.embeddedtaggerState)){let t={state:e.embeddedtaggerState,onComplete:function(e){r.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"searchBetaOnNativeApp",persDim:{pd1:e?"disabled":"enabled"}}}),sendNotificationWebInWin("6WEmbeddedTaggerPreference",e)},onFailure:function(){sendNotificationWebInWin("6WEmbeddedTaggerPreferenceClose")}};f.clickOnSearchBETA(t)}else{var a,o=!1;if(t.is(n._snResultMgt)&&t.is(n._snResultMgt._taggerProxy)&&(a=n._snResultMgt._taggerProxy.getCurrentFilter()),t.is(n._snResultMgt)&&t.is(n._snResultMgt._taggerProxy)&&t.is(a)&&t.is(a.allfilters)&&0!==Object.keys(a.allfilters).length&&(o=!0),e.adv_search&&o&&(!e.adv_search||n._snResultMgt._adv_search)||t.is(e.appCriteria,"string")&&e.appCriteria.length>0&&(e.value+=" AND "+e.appCriteria),e.adv_search&&"#advancedSearch"===e.value&&!o){let e=t.is(this.snTabManager.options)&&t.is(this.snTabManager.options.widget_id)?this.snTabManager.options.widget_id:"web_in_win";return n._snResultMgt.showAdvancedSearch({widgetId:e}),void n.setIcon(n.getTabView().getTabIcon())}e.adv_search&&o||(t.is(e.last_search)&&!0===e.last_search&&t.is(this._reSearchQuery)?(n.setOption("panelTitle",this._reSearchQuery.panelTitle),n.setTitle(this._reSearchQuery.value),n.onSearch({search_criteria:this._reSearchQuery.value,panelTitle:this._reSearchQuery.panelTitle,refine:this._reSearchQuery.last_tag_filter,adv_search:e.adv_search,search_mode:s,originalSearchCriteria:i,applicativeTitle:e.applicativeTitle,applicativeTitleWithResults:e.applicativeTitleWithResults})):n.onSearch({search_criteria:e.value,adv_search:e.adv_search,search_mode:s,originalSearchCriteria:i,applicativeTitle:e.applicativeTitle,applicativeTitleWithResults:e.applicativeTitleWithResults}),""!==e.value&&"#myContent"!==e.value&&"#favoriteSearches"!==e.value&&(this._reSearchQuery={value:e.value,panelTitle:n.options.panelTitle,last_tag_filter:{}}))}}},activateInContextSearch:function(e){var n=this;if(t.is(this.snTabManager)){if(!t.is(d.getOption("tabbed_ui_support_level"))){var i=this.snTabManager.getActiveTab();t.is(i)?this.listenToOnce(i,"onTabActivated",function(){n.refresh(i.getTabID())}):l.log("ERROR : no active tab found !!")}t.is(e.app_socket_id,"string")||(e.app_socket_id=this._socket_id);var s=this.snTabManager.addTab({tabTitle:t.is(e)&&t.is(e.title,"string")?e.title:"",search_ux_options:{widget_id:this._widget_id,resources:this.ressources,css_view_class:"maximized",in_apps_search:e,events:{onReady:function(){var e=this.getOption("in_apps_search");if(t.is(e,"object")){var i=e.app_socket_id;t.is(i)&&"socket_id_#saved_search_edit#"===i?n._searchcom_socket.dispatchEvent("InContextInit","done",i):t.is(d.getOption("tabbed_ui_support_level"))?n._dispathTowin({notif_name:"InContextInit",notif_parameters:"done"}):this.dispatchEvent("onRealInContextInit")}}}}});t.is(d.getOption("tabbed_ui_support_level"))||("socket_id_#saved_search_edit#"!==e.app_socket_id&&n._dispathTowin({notif_name:"InContextInit",notif_parameters:"done"}),this._realInContextInitDone=!1,this.listenToOnce(s.elements.container,"onRealInContextInit",function(){n._realInContextInitDone=!0,t.is(n._inContextCriteria)&&n.inContextSearch(n._inContextCriteria)})),"socket_id_#saved_search_edit#"===e.app_socket_id&&"furtive"!==e.mode||(this.snTabManager.hideTabBar(),!0===f.is6WInWebInWinActive()&&sendNotificationWebInWin("openTagger","OK"))}},deactivateInContextSearch:function(e){if(t.is(this.snTabManager)){var n=this.snTabManager.getActiveTab();if(t.is(n)){var i=n.getTabID();this.snTabManager.removeTab(i)}this.snTabManager.showTabBar()}this._realInContextInitDone=void 0,this._inContextCriteria=void 0,!0===f.is6WInWebInWinActive()&&t.is(e)&&t.is(e.action_id)&&"edit_saved_search"===e.action_id&&sendNotificationWebInWin("closeTagger","OK")},inContextSearch:function(e){if(!1===this._realInContextInitDone)this._inContextCriteria=e;else{var n=this;t.is(e.searchString,"string")&&e.searchString.indexOf(":")>0?v.fetchPQsFromServer(this.ressources).then(function(){n.inContextSearchAsyncPQ(e)}):this.inContextSearchAsyncPQ(e)}},inContextSearchAsyncPQ:function(e){this.log("ResultWebInWin inContextSearch");var n=this.snTabManager.getActiveTab();if(t.is(n._snResultMgt)){if(!t.is(e,"object"))throw new Error("E_INVALIDARG: bad arguments ==> criteria for inContextSearch is not an object!");var i=n._snResultMgt.getOption("in_apps_search");if(!t.is(i,"object"))throw new Error("E_INVALIDARG: no in_apps_search options found !");var s=i.precond,a=i.source;if(e.adv_search=!1,e.advanced_criteria="",t.is(e.searchString,"string")){if(e.searchString===f.SearchTypeEnum.ADVANCED_SEARCH){e.adv_search=!0,e.advanced_criteria="";let i=t.is(this.snTabManager.options)&&t.is(this.snTabManager.options.widget_id)?this.snTabManager.options.widget_id:"web_in_win";return void n._snResultMgt.showAdvancedSearch({widgetId:i})}var o=v.isAPQSearch(e.searchString);t.is(e.originalSearchCriteria)||(e.originalSearchCriteria=e.searchString),e.searchString=u.manageWildcardAddtion(e.searchString),e.searchString=f.replacePQsWithCVPrefixes(e.searchString),!t.is(o)&&e.searchString.length>0&&"#favoriteSearches"!==e.searchString&&(t.is(s,"string")&&s.length>0?!0===e.adv_search?e.searchString="#advancedSearch":e.searchString+=" AND "+s:t.is(e.applicativeCriteria,"string")&&e.applicativeCriteria.length>0&&(e.searchString+=" AND "+e.applicativeCriteria))}else{if(!t.is(s,"string")||s.length<=0)throw new Error("invalid in_apps_search options, no in_apps_search.precond found !");e.searchString=i.precond,e.originalSearchCriteria=""}var r={search_criteria:e.searchString,adv_search:e.adv_search,advanced_criteria:e.advanced_criteria,search_mode:"index",originalSearchCriteria:e.originalSearchCriteria,search_criteria_to_display:i.displayValue,tag_filter:e.tag_filter,source:a,search_name:e.search_name,resetLocalFilter:!0};n._snResultMgt.onSearch(r)}},refresh:function(e){var n=this.snTabManager._getTabView(e);t.is(n)&&n.onRefresh()},getSuggestions:function(e){var t=this;this.ressources.getSuggestions(e,function(e){var n=(e=e||[]).map(function(e){return{label:e.entry,command:query.replace(/^\s+|\s+$/g,"").replace(/[A-Za-z\1-9\_\u00C0-\u017F]+$/,e.entry),icon:"lightbulb"}});t._dispathTowin({notif_name:"UpdateSuggests",notif_parameters:{serverSuggests:n}})})},setCtxMenu:function(e,n,i){var s=this,a=void 0,r=!0,c=-1;t.is(i,"object")?(a=i.tabID,r=i.doNotDisplay,t.is(i.somethingSelected)&&(c=i.somethingSelected)):1!==i&&(r=!1,c=1);var l=this.snTabManager._getTabView(a),g=t.is(n)&&t.is(n.actions)&&t.is(n.actions.length)?n.actions.length:0,_=d.getOption("max_item_for_contextualPanel"),h=0;let u=l.getCollection();t.is(u.totalCount)&&u.totalCount;let m=[],v="OnPremise";if(g>0){for(let e of n.actions)m.push(u.get(e.id));v=m[0].getPlatformID()}let p=f.hasTaggerSubjectURI(m,v);if(f.isFUNActive("FUN075064")){for(1===g&&"V_LocationWithoutSelectedObject"===n.actions[0].id&&1,h=0;h<g;h++){if(g>_&&(n.actions[h].actions=[]),p){var S={availabilityMode:" Normal=YES CommandSet=YES Editability=NO SmallScale=YES LargeScale=YES",id:d.getOption("command_id.add_tag"),image:"Search_Add_Tag",multisel:!0,sourcejs:"DS/SNResultUX/utils/AddTag_ActionHandler",title:b.get("add_tag.add_tag_header")};n.actions[h].actions.unshift(S)}if(!0!==l.getSNSkeleton().getPreviewStatus()){var E={availabilityMode:" Normal=YES CommandSet=YES Editability=NO SmallScale=YES LargeScale=YES",id:"new_preview",image:"I_SearchPreview",multisel:!0,sourcejs:"DS/SNResultUX/utils/Select_ActionHandler",title:b.get("previewTitle")};n.actions[h].actions.unshift(E)}}}if(!t.is(e)||!t.is(e.actions))throw new Error("E_INVALIDARG: bad jsonCtxMenu.actions given to setCtxMenu method !");if(!r)if(d.getOption("actionsProtocol_FUN065512")&&g<=_){var w={SavedSearch:!0},T={},I=function(e){if(t.is(e)&&t.is(e.actions,"array")){var n=[];if(!t.is(u))return n;for(var i=0;i<e.actions.length;i++){var s=u.get(e.actions[i].id);t.is(s)&&t.is(w[s.get("ds6w:type_value")])&&(n.push(s),T[e.actions[i].id]=e.actions[i].actions)}return n}}(n);t.is(I,"array")&&I.length>0?require(["DS/SNResultUX/utils/SearchLocalActions"],function(e){e._isSelectionFromSameSource(I).then(function(i){i.data.applicativeInfo={incontextMode:t.is(l.getOption("in_apps_search")),clientAppInfo:f.identifyClientInfo(l.getSNSkeleton().getOption("addinMode"))},i.onComplete=function(e){if("success"===e.status){for(h=0;h<e.actions.length;h++){var i=e.actions[h].id;t.is(T.hasOwnProperty(i))&&e.actions[h].actions.forEach(function(e){T[i].push(e)})}s._searchcom_socket.dispatchEvent("onSetCtxMenuForItemViewOptions",{actions_data:n,somethingSelected:c},l.getSNSkeleton().getSocketID(!0))}else s._searchcom_socket.dispatchEvent("onSetCtxMenuForItemViewOptions",{actions_data:n,somethingSelected:c},l.getSNSkeleton().getSocketID(!0))},i.onFailure=function(){s._searchcom_socket.dispatchEvent("onSetCtxMenuForItemViewOptions",{actions_data:n,somethingSelected:c},l.getSNSkeleton().getSocketID(!0))},e.getActions(i)},function(){s._searchcom_socket.dispatchEvent("onSetCtxMenuForItemViewOptions",{actions_data:n,somethingSelected:c},l.getSNSkeleton().getSocketID(!0))})}):this._searchcom_socket.dispatchEvent("onSetCtxMenuForItemViewOptions",{actions_data:n,somethingSelected:c},l.getSNSkeleton().getSocketID(!0))}else this._searchcom_socket.dispatchEvent("onSetCtxMenuForItemViewOptions",{actions_data:n,somethingSelected:c},l.getSNSkeleton().getSocketID(!0));s._listAccelerator={};var y=e.actions,R=y.length;for(h=0;h<R;h++)for(var M=y[h].actions,k=0,x=M.length;k<x;k++){var C=M[k];t.is(C.accelerator)&&C.accelerator.length>0&&(s._listAccelerator[C.accelerator.replace(/\+/g,"")]=C.id)}Object.keys(s._listAccelerator).length>0&&(document.onkeydown=function(e){var n="",i=window.event?event:e;if(i.ctrlKey&&i.shiftKey?n+="CtrlShift":i.ctrlKey?n+="Ctrl":i.altKey?n+="Alt":i.shiftKey?n+="Shift":i.metaKey&&(n+="Meta"),13===i.keyCode?n+="Enter":32===i.keyCode?n+="Space":46===i.keyCode?n+="Del":n+=String.fromCharCode(i.keyCode).toUpperCase(),t.is(s._listAccelerator[n],"string"))sendNotificationWebInWin("acceleratorEvt",'{ "action":"'+s._listAccelerator[n]+'"}');else if("CtrlP"===n){var a=t.extendElement(document.body).getElements(".fonticon-print");if(t.is(a)){var r=a[0].getParent();if(t.is(r)){var c=r.getParent();t.is(c)&&o.dispatchEvent(c,"click")}}}})},setSessionResults:function(e){var n=void 0,i=void 0;if(t.is(e,"object"))if(t.is(e.sessionResponse)){n=e.tabID;try{i=JSON.parse(e.sessionResponse)}catch(e){i=void 0}}else i=e;var s=this.snTabManager._getTabView(n);this._searchcom_socket.dispatchEvent("onSetSessionResponse",i,s.getCollection().getSocketID())},_getTaggerProxySocketId:function(e){return"webinwinproxy_socket_"+this._widget_id+"_"+e},addFilterChangeListener:function(e){if(this.log("-> ResultWebInWin.addFilterChangeListener"),!t.is(e,"object")||!t.is(e.data)||!t.is(e.event_id))throw this.log("Error, expect to have parameters.data or parameters.event_id arg!!!"),new Error("No parameters.data or parameters.event_id given to addFilterChangeListener method !");this._searchcom_socket.dispatchEvent(e.event_id,e.data,this._getTaggerProxySocketId(e.proxyId))},addCriteriaChangeListener:function(e){if(this.log("-> ResultWebInWin.addCriteriaChangeListener"),!t.is(e,"object")||!t.is(e.data)||!t.is(e.event_id))throw this.log("Error, expect to have parameters.data or parameters.event_id arg!!!"),new Error("No parameters.data or parameters.event_id given to addCriteriaChangeListener method !");this._searchcom_socket.dispatchEvent(e.event_id,e.data,this._getTaggerProxySocketId(e.proxyId))},addPLMUpdateListener:function(e){if(this.log("-> ResultWebInWin.addPLMUpdateListener"),!t.is(e,"object")||!t.is(e.data)||!t.is(e.event_id))throw this.log("Error, expect to have parameters.data or parameters.event_id arg!!!"),new Error("No parameters.data or parameters.event_id given to addPLMUpdateListener method !");this._searchcom_socket.dispatchEvent(e.event_id,e.data,this._getTaggerProxySocketId(e.proxyId))},addRequestSuggestsListener:function(e){if(this.log("-> ResultWebInWin.addRequestSuggestsListener"),!t.is(e,"object")||!t.is(e.data)||!t.is(e.event_id))throw this.log("Error, expect to have parameters.data or parameters.event_id arg!!!"),new Error("No parameters.data or parameters.event_id given to addRequestSuggestsListener method !");this._searchcom_socket.dispatchEvent(e.event_id,e.data,this._getTaggerProxySocketId(e.proxyId))},onFilterChange:function(e){if(this.log("-> ResultWebInWin.onFilterChange"),!t.is(e)||!t.is(e.data))throw this.log("Error, expect to have parameters.data arg !!!"),new Error("No parameters.data given to onFilterChange method !");this._searchcom_socket.dispatchEvent("onFilterChange",e.data,this._getTaggerProxySocketId(e.proxyId))},_internalFilterChangeListener:function(e){if(this.log("-> ResultWebInWin._internalFilterChangeListener"),!t.is(e)||!t.is(e.data))throw this.log("Error, expect to have parameters.data arg !!!"),new Error("No parameters.data given to _internalFilterChangeListener method !");this._searchcom_socket.dispatchEvent("_internalFilterChangeListener",e.data,this._getTaggerProxySocketId(e.proxyId))},onGroupingChange:function(e){if(this.log("-> ResultWebInWin.onGroupingChange"),!t.is(e)||!t.is(e.data))throw this.log("Error, expect to have parameters.data arg !!!"),new Error("No parameters.data given to onGroupingChange method !");this._searchcom_socket.dispatchEvent("onGroupingChange",e.data,this._getTaggerProxySocketId(e.proxyId))},onCriteriaSelect:function(e){if(this.log("-> ResultWebInWin.onCriteriaSelect"),!t.is(e)||!t.is(e.data))throw this.log("Error, expect to have parameters.data arg !!!"),new Error("No parameters.data given to onCriteriaSelect method !");this._searchcom_socket.dispatchEvent("onCriteriaSelect",e.data,this._getTaggerProxySocketId(e.proxyId))},addVisibilityChangeListener:function(e){if(this.log("-> ResultWebInWin.addVisibilityChangeListener"),!t.is(e,"object")||!t.is(e.data)||!t.is(e.event_id))throw this.log("Error, expect to have parameters.data or parameters.event_id arg!!!"),new Error("No parameters.data or parameters.event_id given to addFilterChangeListener method !");this._searchcom_socket.dispatchEvent(e.event_id,e.data,this._getTaggerProxySocketId(e.proxyId))},_dispathTowin:function(e){if(!t.is(e,"object")||!t.is(e.notif_name)||void 0===e.notif_parameters)throw this.log("E_INVALIDARG, expect to have parameters.notif_name arg & parameters.notif_parameters in _dispathTowin !!!"),new Error("No parameters.notif_name arg & parameters.notif_parameters given to _dispathTowin method !");this.log("ResultWebInWin._dispathTowin for "+e.notif_name);var n=t.is(e.notif_parameters,"string")?e.notif_parameters:JSON.stringify(e.notif_parameters);!0===d.getOption("no_jsnotif")?this.log("JSNOTIF deactivated for "+e.notif_name):sendNotificationWebInWin(e.notif_name,n)},resetMultisel:function(){r.publish({channel:this.snTabManager._getTabView().getSNSkeleton().getOption("messagingChannel"),topic:"onResetMultisel",data:{}})},clearWebInWinCSO:function(){r.publish({channel:this.snTabManager._getTabView().getSNSkeleton().getOption("messagingChannel"),topic:"onclearWebInWinCSO",data:{}})},updateMultisel:function(e){this._searchcom_socket.dispatchEvent("onUpdateMultisel",e,this.snTabManager._getTabView().getSNSkeleton().getSocketID())},componentToHex:function(e){var t=e.toString(16);return 1===t.length?"0"+t:t},rgbToHex:function(e,t,n){return"#"+this.componentToHex(e)+this.componentToHex(t)+this.componentToHex(n)},SetShadingValues:function(e,n){if(l.log("ResultWebInWin SetShadingValues"),!t.is(e))throw new Error("E_INVALIDARG: bad jsonRGBTData given to SetRGBTValues method !");this._unsetShadingValues(n);for(var i=e.length,s=[],a=0;a<i;a++){var o=e[a],r={criteria:function(e){var t=!1;return e.id===this.id&&(t=!0),t},color:this.rgbToHex(o.r,o.g,o.b),id:o.id};s.push(r)}this.snTabManager._getTabView(n).setShadings(s)},_unsetShadingValues:function(e){l.log("ResultWebInWin UnSetShadingValues"),this.snTabManager._getTabView(e).setShadings([{color:"initial",criteria:function(){return!0}}])},UnSetShadingValues:function(e){this._unsetShadingValues(e);var n=this.snTabManager.getActiveTab();if(t.is(n)){var i=n.getTabID(),s=this.snTabManager._getAllTabs();if(t.is(s,"array"))for(var a=0;a<s.length;a++){var o=s[a].get("tab");o.getTabID()!==i&&o.updateOnActivate({unsetShading:!0})}}},clearTaggerLocalFilters:function(){var e=this.snTabManager.getActiveTab();t.is(e._snResultMgt)&&(t.is(e._snResultMgt._search_tag_filter,"object")&&(e._snResultMgt._search_tag_filter={}),t.is(e._snResultMgt._taggerProxy)&&(e._snResultMgt._taggerProxy.clearLocalFilter(),e._snResultMgt._taggerProxy.clearLocalGrouping&&e._snResultMgt._taggerProxy.clearLocalGrouping()))},logout:function(){this._searchcom_socket.dispatchEvent("onLogout")},setVisibility:function(e){if(l.log("visiblility:",e),0===e){this.nextIsNewSearch=!0;var n=this.snTabManager.getActiveTab();if(n._snResultMgt&&n._snResultMgt.getCollection(),n._snResultMgt&&n._snResultMgt.getCollection()&&n._snResultMgt.getCollection().service_parameters){if(t.is(g.getItem("searchSort"))){let e=g.getItem("searchSort");n._snResultMgt.getCollection().service_parameters.order_by=e.order_by,n._snResultMgt.getCollection().service_parameters.order_field=e.order_field,n._snResultMgt.sortPanelView.updateRenderByExt({order_field:e.order_field,order_by:e.order_by})}else if(d.getOption("default_sort")){var i=d.getOption("default_sort");t.is(i,"object")&&t.is(i.order_by,"string")&&t.is(i.order_field,"string")&&(n._snResultMgt.getCollection().service_parameters.order_by=i.order_by,n._snResultMgt.getCollection().service_parameters.order_field=i.order_field,n._snResultMgt.sortPanelView.updateRenderByExt({order_field:i.order_field,order_by:i.order_by}))}else d.getOption("apply_sort_on_modified_by_default")?(n._snResultMgt.getCollection().service_parameters.order_by="desc",n._snResultMgt.getCollection().service_parameters.order_field="ds6w:modified",n._snResultMgt.sortPanelView.updateRenderByExt({order_field:"ds6w:modified",order_by:"desc"})):(n._snResultMgt.getCollection().service_parameters.order_by="desc",n._snResultMgt.getCollection().service_parameters.order_field="relevance",n._snResultMgt.sortPanelView&&t.is(n._snResultMgt.sortPanelView._setOrder,"function")&&n._snResultMgt.sortPanelView._setOrder("relevance","pertinency","group"),n._snResultMgt.sortPanelView.updateMenu(),n._snResultMgt.sortPanelView._view&&n._snResultMgt.sortPanelView._view.elements.container&&n._snResultMgt.sortPanelView._view.elements.container.children[0]&&n._snResultMgt.sortPanelView._view.elements.container.children[0].children[1]&&n._snResultMgt.sortPanelView._view.elements.container.children[0].children[1].children[0]&&(n._snResultMgt.sortPanelView._view.elements.container.children[0].children[1].children[0].className="fonticon fonticon-sorting"));n._snResultMgt.getSNSkeleton().order_by=n._snResultMgt.getCollection().service_parameters.order_by,n._snResultMgt.getSNSkeleton().order_field=n._snResultMgt.getCollection().service_parameters.order_field;var s=0,a=null;do{(a=n._snResultMgt.getSNSkeleton()._skeleton.getViewAt(s))&&a.contentsViews&&a.contentsViews[a.currentViewId]&&a.contentsViews[a.currentViewId].nestedView&&a.contentsViews[a.currentViewId].nestedView.view&&t.is(a.contentsViews[a.currentViewId].nestedView.view.initComponentState,"function")&&a.contentsViews[a.currentViewId].nestedView.view.initComponentState({dataIndex:n._snResultMgt.getCollection().service_parameters.order_field,sort:n._snResultMgt.getCollection().service_parameters.order_by}),s++}while(t.is(a))}var o=this.snTabManager._getTabView();if(t.is(o)){var r=o.getOption("in_apps_search");t.is(r,"object")&&t.is(r.app_socket_id)&&"socket_id_#saved_search_edit#"===r.app_socket_id&&deactivateInContextSearch()}}},setSecurityContext:function(e){this.ressources.setSecurityContext(e)},_getSearchView:function(){return this.snTabManager._getTabView()},setTaggerVisibility:function(e){m.isTaggerVisibleFlag(e)},setTaggerDisplayStatus:function(e){let n=e;m.setTaggerDisplayStatus(e);let i=t.extendElement(document.body).getElement("."+this._searchcontent_id);t.is(i)&&!0===f.is6WInWebInWinActive()&&(i.removeClassName("taggerVisible"),n&&i.addClassName("taggerVisible"));let s=this.snTabManager.getActiveTab();t.is(s._snResultMgt)&&s._snResultMgt._manageEmbeddedTaggerView(e)},ODTFunction:function(e){let n=!0;if(!t.is(e.functionName))throw"E_INVALIDARG: bad jsonArg.functionName given to ODTFunction method !";if(!t.is(e.functionArg))throw"E_INVALIDARG: bad jsonArg.functionArg given to ODTFunction method !";var i=e.functionName,s=e.functionArg;console.log(s);let a,o,r=this,c=r.snTabManager.getActiveTab();if(t.is(c._snResultMgt)){let e=c._snResultMgt.getCollection();t.is(e)&&(a=e.getTreeDocument())}if(!t.is(a))throw"E_INVALIDARG: bad treeDocument given to ODTFunction method !";switch(i){case"ActivateItem":for(let e=0,t=o=s.objects.length;e<t;e++){let t=s.objects[e].id;c._snResultMgt.skeleton.onItemDblClick(t)}break;case"SelectItems":a.unselectAll(),o=s.objects.length;let g=t.is(a)&&a.getRoots();if(t.is(g,"array")){let e=g.length,n=0;for(let i=0,a=o;i<a;i++){let a=s.objects[i].id;for(;n<e;n++){let e=g[n];t.is(e)&&t.is(e._options)&&e._options.id===a&&e.select()}}}break;case"ODTOnCtxMenu":t.is(c._snResultMgt.skeleton)&&t.is(c._snResultMgt.skeleton._selectedcellView)&&t.is(c._snResultMgt.skeleton._selectedcellView.contentView)&&t.is(c._snResultMgt.skeleton._selectedcellView.contentView.elements)&&t.Event.dispatchEvent(c._snResultMgt.skeleton._selectedcellView.contentView.elements.menu,"click");break;case"MyContentShowAll":if(t.is(c._snResultMgt.skeleton)){let e=c._snResultMgt.skeleton.getContainer();if(t.is(e)){let n=e.getElement(".onesearch_recentcontent");t.Event.dispatchEvent(n,"click"),setTimeout(function(){let e=t.extendElement(document.body).getElement(".search_recent_container");if(e){let n=t.extendElement(e).getElements(".item-text");if(n){for(let e=n.length-1;e>=0;e--)-1!==n[e].getText().indexOf("Show all")&&(t.Event.dispatchEvent(n[e],"click"),e=-1)}}},5)}}break;case"SearchInMyContent":if(t.is(c._snResultMgt.skeleton)){let e=c._snResultMgt.skeleton.getContainer();if(t.is(e)){let n=e.getElement(".onesearch_recentcontent");t.Event.dispatchEvent(n,"click"),setTimeout(function(){let e=t.extendElement(document.body).getElement(".search_recent_container");if(e){let n=t.extendElement(e).getElements(".item-text");if(n){for(let e=n.length-1;e>=0;e--)-1!==n[e].getText().indexOf("Search in my recent content")&&(t.Event.dispatchEvent(n[e],"click"),e=-1)}}},5)}}break;case"Drag":if(t.is(c._snResultMgt.skeleton)){var l=[],d=c._snResultMgt.skeleton.getCollection().getTreeDocument().getXSO().get();t.is(d,"array")&&d.forEach(function(e){if(c._snResultMgt.skeleton.getCollection().getTreeDocument().getRoots().indexOf(e)>=0){let t=c._snResultMgt.skeleton.getCollection().get(e._options.id);t&&l.push(t)}});let e=m.buildCompassSelectionData({widgetId:c._snResultMgt.skeleton.getOption("widgetId"),selectedModels:l});c._snResultMgt.skeleton._searchcom_socket.dispatchEvent("onDispatchToWin",{notif_name:"onDragNotif",notif_parameters:JSON.stringify(e)},"search_web_in_win"),n=!1}break;case"DisplayPreview":t.is(c._snResultMgt.skeleton)&&t.is(c._snResultMgt.skeleton._selectedcellView)&&t.is(c._snResultMgt.skeleton._selectedcellView.contentView)&&t.is(c._snResultMgt.skeleton._selectedcellView.contentView.elements)&&(t.Event.dispatchEvent(c._snResultMgt.skeleton._selectedcellView.contentView.elements.title,"click"),n=!1);break;case"ClosePreview":let _=t.extendElement(document.body).getElement(".lightbox--responsive");if(t.is(_)){let e=_.getElement(".fonticon-close");t.is(e)&&(t.Event.dispatchEvent(e,"click"),n=!1)}break;case"Preview3DPlay":let h=t.extendElement(document.body).getElement(".lightbox__content");if(t.is(h)){let e=h.getElement(".SHAREPluginless_background");t.is(e)&&(t.Event.dispatchEvent(e,"click"),n=!1)}break;case"switchOnView":let u=s.objects[0].id;c._snResultMgt.skeleton.switchOnView(u);break;case"AddDensity":if(t.is(c._snResultMgt.skeleton)){let e="table";c._snResultMgt.skeleton.switchOnView(e),n=!1;let i=c._snResultMgt.skeleton.getContainer();if(t.is(i)){let e=i.getElement(".onesearch_action");t.Event.dispatchEvent(e,"click"),setTimeout(function(){require(["DS/SNResultUX/utils/SearchCustoServices"],function(e){let i=t.extendElement(document.body).getElement(".one_search_actions");if(i){let s=t.extendElement(i).getElements(".item-text");if(s){for(let i=s.length-1;i>=0;i--)-1!==s[i].getText().indexOf(b.get("actions.Grid_Custo.title"))&&(t.Event.dispatchEvent(s[i],"click"),setTimeout(function(){let i=t.extendElement(document.body).getElements("#show-custo-manager");t.is(i)&&(t.Event.dispatchEvent(i[0],"click"),setTimeout(function(){e.colCustoPanelEndUser.oSourceAutocomplete.dispatchEvent("onSelect",[e.colCustoPanelEndUser.oSourceAutocomplete.datasets[0].items[0]]),setTimeout(function(){let i=e.colCustoPanelEndUser.oTypeAutocomplete,s="ds6wg:CATMatReference",a=0;for(a in i.datasets[0].items)if(s===i.datasets[0].items[a].value)break;i.dispatchEvent("onSelect",[i.datasets[0].items[a]]);let o=t.extendElement(document.body).getElements("div.typesInput>div.autocomplete-searchbox");t.is(o)&&(t.Event.dispatchEvent(o[0],"click"),setTimeout(function(){let i=t.extendElement(document.body).getElements(".autocomplete-suggestsDisplayed");if(t.is(i)&&i.length){s="Generic Material";for(const a of i[0].querySelectorAll("span"))if(a.textContent.includes(s)){t.Event.dispatchEvent(a,"click"),setTimeout(function(){if(i=t.extendElement(document.body).getElements(".autocomplete-filled"),t.is(i)&&i.length&&(t.Event.dispatchEvent(i[0],"click"),i=t.extendElement(document.body).getElements(".column-custo-grid-div-content.available"),t.is(i)&&i.length)){s="Density";for(const t of i[0].querySelectorAll(".wux-datagrid-cell-even"))if(t.textContent.includes(s)){let n=t.getAttribute("row-id");e.colCustoPanelEndUser.availablePredicates.getManager().selectRow(n,!0),e.colCustoPanelEndUser._onAddPredicate();break}let a=t.extendElement(document.body).getElements("#apply_customization_btn");t.is(a)&&(t.Event.dispatchEvent(a[0],"click"),setTimeout(function(){sendNotificationWebInWin("EndODTAsync","OK"),n=!1},1e3))}},500);break}}else{let e=t.extendElement(document.body).getElements("#apply_customization_btn");t.is(e)&&(t.Event.dispatchEvent(e[0],"click"),setTimeout(function(){sendNotificationWebInWin("AddDensityReStart","OK"),n=!1},1e3))}},500))},5e3)},500))},500),i=-1)}}})},500)}}break;case"searchUntilIndexed":let v=60;n=!1;r._searchUntilIndexed(v);break;case"6WEmbeddedEnableDisable":let p=t.extendElement(document.body).getElement(".modal-footer");if(t.is(p)){let e=p.getElement(".btn-root");t.is(e)&&(t.Event.dispatchEvent(e,"click"),n=!1)}break;case"6WEmbeddedClckOnW":let f=s.objects[0].w,S=".embedded-"+f+" .root-icon-div",E=document.body.getElement(S);t.is(E)&&(t.Event.dispatchEvent(E,"click"),setTimeout(function(){sendNotificationWebInWin("6WEmbeddedClckOnW",f)},1e3),n=!1);break;case"6WEmbeddedClckOnSection":let w=s.objects[0].section,T='//div[contains(@class, "MultiView") and not(contains(@style,"display: none"))]//div[contains(@class, "search-multi-view-encart")]',I=document.evaluate(T,document,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null);if(t.is(I)){let e=I.iterateNext();for(;e;){-1!==e.textContent.indexOf(w)?(t.Event.dispatchEvent(e,"click"),setTimeout(function(){sendNotificationWebInWin("6WEmbeddedClckOnSection",w)},1e3),n=!1,e=null):e=I.iterateNext()}}break;case"AddTabSetting":if(t.is(c._snResultMgt.skeleton)){n=!1;let e=c._snResultMgt.skeleton.getContainer();if(t.is(e)){let n=e.getElement(".onesearch_action");t.Event.dispatchEvent(n,"click"),setTimeout(function(){let e=t.extendElement(document.body).getElement(".one_search_actions");if(e){let n=t.extendElement(e).getElements(".item-text");if(n){for(let e=n.length-1;e>=0;e--)-1!==n[e].getText().indexOf(b.get("actions.Grid_Custo.title"))&&(t.Event.dispatchEvent(n[e],"click"),setTimeout(function(){let e=t.extendElement(document.body).getElements("#search_tabbed_ui");t.is(e,"array")&&(t.Event.dispatchEvent(e[1],"click"),setTimeout(function(){let e=t.extendElement(document.body).getElements("#applySettings");t.is(e,"array")&&(t.Event.dispatchEvent(e[0],"click"),setTimeout(function(){let e=t.extendElement(document.body).getElements(".btn-root");t.is(e,"array")&&(sendNotificationWebInWin("EndODTAsync_AddTabSetting","OK"),t.Event.dispatchEvent(e[0],"click"))},500))},500))},500),e=-1)}}},500)}}break;case"AddTab":if(t.is(c._snResultMgt.skeleton)){n=!1;let e=t.extendElement(document.body).getElement(".onesearch_tabbed_results");if(t.is(e)){let n=e.getElement(".wux-controls-tabBar-tabs-container-buttonNewTab");t.Event.dispatchEvent(n,"click"),setTimeout(function(){sendNotificationWebInWin("EndODTAsync_AddTab","OK")},500)}}break;case"BIEssentials":if(t.is(c._snResultMgt.skeleton)){n=!1;let e=c._snResultMgt.skeleton.getContainer();if(t.is(e)){let n=e.getElement(".onesearch_action");t.Event.dispatchEvent(n,"click"),setTimeout(function(){let e=t.extendElement(document.body).getElement(".one_search_actions");if(e){let n=t.extendElement(e).getElements(".item-text");if(n){for(let e=n.length-1;e>=0;e--)-1!==n[e].getText().indexOf(b.get("actions.BI_Activated.title"))&&(t.Event.dispatchEvent(n[e],"click"),setTimeout(function(){sendNotificationWebInWin("EndODTAsync_BIEssentials","OK")},500),e=-1)}}},500)}}break;default:console.warn(e.functionName+"ODTFunction not implemented")}!0===n&&setTimeout(function(){sendNotificationWebInWin("EndODTAsync","OK")},1e3)},_searchUntilIndexed:function(e,n){let i=this,s=t.is(n)?n:0,a=0;if(e===s)return 60;let o=i.snTabManager.getActiveTab();if(t.is(o._snResultMgt)){let n=o._snResultMgt.getCollection();if(t.is(n)){if(0!==(a=n.length))return setTimeout(function(){sendNotificationWebInWin("EndODTAsync","OK")},500),a;setTimeout(function(){return s++,i.searchAsyncPQ({last_search:!0,adv_search:!1,search_mode:"index",value:""}),n=o._snResultMgt.getCollection(),0!==(a=n.length)?(setTimeout(function(){sendNotificationWebInWin("EndODTAsync","OK")},500),a):(a=i._searchUntilIndexed(e,s))?(setTimeout(function(){sendNotificationWebInWin("EndODTAsync","OK")},500),a):void 0},1e4)}}return a}})});