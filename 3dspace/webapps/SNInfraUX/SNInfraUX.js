/*!  COPYRIGHT DASSAULT SYSTEMES 2014   */
define("DS/SNInfraUX/SearchDataSources",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Data","UWA/Promise","DS/WebappsUtils/WebappsUtils","text!DS/SNInfraUX/assets/SearchDataSources.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/SearchSettings"],function(e,t,i,r,s,n,a,o,c,l,u){"use strict";return t.singleton(i,{options:{search_dataSources:{},search_dataSources_odt:{}},loadComplete:!1,settings_loaded:[],onCompleteLoad:void 0,init:function(){c.groupCollapsed("SearchDataSources.init"),-1===location.search.indexOf("debug")&&-1===location.search.indexOf("searchLogs")||(this.setDebugMode(!0),window.searchLogs=!0,c.info("3DSearch traces activated")),e.is(this.options)||(this.options={search_dataSources:{}}),e.is(this.options.search_dataSources)||(this.options.search_dataSources={});var t=null;if(!0===u.getOption("dataSourcesFile"))try{t=JSON.parse(a),c.log("DataSources from SearchDataSources.json:"),t&&c.log(JSON.parse(JSON.stringify(t)))}catch(e){c.error("Error parsing SearchDataSources.json:",e)}e.is(t)&&(e.merge(this.options,t),e.is(t.search_dataSources)&&e.merge(this.options.search_dataSources,t.search_dataSources)),c.groupEnd()},getOption:function(t,i){if(e.is(this.options))return this.options.search_dataSources[t]}})}),define("DS/SNInfraUX/SearchSettings",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Data","UWA/Promise","DS/WebappsUtils/WebappsUtils","text!DS/SNInfraUX/assets/SearchSettings.json","text!DS/SNInfraUX/assets/SearchSettings_Public.json","text!DS/SNInfraUX/assets/SearchSettings_IP.json","DS/WebRecordEnabler/Adapter","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchControlCenterFetchService"],function(e,t,i,r,s,n,a,o,c,l,u,d,p){"use strict";var h=function(e){return/(http|https):\/\//.test(e)},g=t.singleton(i,{options:{search_settings:{},search_settings_odt:{}},loadComplete:!1,settings_loaded:[],onCompleteLoad:void 0,_tenantSettingsPC:{},_tenantSettings:{},setODToption:function(t,i){e.is(this.options.search_settings_odt,"object")||(this.options.search_settings_odt={}),this.options.search_settings_odt[t]=i,d.info("ODT option SET, "+t+" = "+this.options.search_settings_odt[t])},init:function(){d.groupCollapsed("SearchSettings.init"),-1===location.search.indexOf("debug")&&-1===location.search.indexOf("searchLogs")||(this.setDebugMode(!0),window.searchLogs=!0,d.info("3DSearch traces activated"));try{this.options=JSON.parse(c),d.log("Settings from SearchSettings_IP.json:"),this.options&&d.log(JSON.parse(JSON.stringify(this.options)))}catch(e){d.error("Error parsing SearchSettings_IP.json:",e)}e.is(this.options)||(this.options={search_settings:{}}),e.is(this.options.search_settings)||(this.options.search_settings={});var t=null;try{t=JSON.parse(o),d.log("Settings from SearchSettings_Public.json:"),t&&d.log(JSON.parse(JSON.stringify(t)))}catch(e){d.error("Error parsing SearchSettings_Public.json:",e)}e.is(t)&&(e.merge(this.options,t),e.is(t.search_settings)&&e.merge(this.options.search_settings,t.search_settings));var i=null;try{i=JSON.parse(a),d.log("Settings from SearchSettings.json:"),i&&d.log(JSON.parse(JSON.stringify(i)))}catch(e){d.error("Error parsing SearchSettings.json:",e)}e.is(i)&&(e.merge(this.options,i),e.is(i.search_settings)&&e.merge(this.options.search_settings,i.search_settings)),this.options.url_search_settings={};var r=null;if(e.is(window)&&e.is(window.location)&&e.is(window.location.search,"string")&&(r=window.location.search.substring(1)),e.is(r,"string")&&r.length>0&&r.indexOf("widgetDomain=")>=0){for(var s=r.split("&"),n={},l=0;l<s.length;l++){var u=s[l].split("=");if(2===u.length&&"widgetDomain"===u[0]){var p=u[1];if(e.is(p,"string")&&p.length>0&&p.indexOf("%3F")>-1){p=p.substring(p.indexOf("%3F")+3);for(var h=(p=decodeURIComponent(p)).split("&"),g=0;g<h.length;g++){var f=h[g].split("=");1===f.length?n[f[0]]=!0:2===f.length&&f[0].length>0&&(n[f[0]]=f[1])}}}}this.urlSettings(n),d.log("Settings from URL:"),n&&d.log(JSON.parse(JSON.stringify(n)))}if(this.isODTMode()){let t=sessionStorage.getItem("search_settings");if(e.is(t,"string"))try{let i=JSON.parse(t);e.is(i,"object")&&(t=i)}catch(e){d.error("Invalid settings from sessionStorage",t)}if(e.is(t,"object")){this.options.sessionStorageSettings=t,d.log("Settings from local storage:",t);for(let[e,i]of Object.entries(t))this.options.search_settings[e]=i}}this._adjustLegacySettings(),this.debugMode=this.getDebugMode(),d.groupEnd()},load:function(e){this.settings_loaded.indexOf(e.url)&&(this.onCompleteLoad=e.onComplete,this._loadSettings(e.url),this.settings_loaded.push(e.url))},urlSettings:function(t){for(var i in d.groupCollapsed("SearchSettings.urlSettings"),d.log("upd_settings input:"),d.log(t),e.is(t.debug_me)&&(this.options.search_settings.debug_mode=!0,d.log("debug_me key present")),!0===this.options.search_settings.debug_mode&&(this.setDebugMode(!0),d.log("debug_mode true => activate debug")),e.is(this.options.url_search_settings)||(this.options.url_search_settings={}),t)if("debug_me"===i)d.log("Debug mode already taken into account");else{var r=t[i];if(void 0!==r&&"string"==typeof r.valueOf()&&r.length>0&&("false"===r.toLowerCase()?r=!1:"true"===r.toLowerCase()&&(r=!0)),e.is(this.options.search_settings[i],"number")&&(isNaN(r)||(r=Number(r))),e.is(r,"string")&&r.indexOf("%")>-1&&(r=decodeURIComponent(r)).indexOf("{")>-1)try{r=JSON.parse(r)}catch(e){d.error("Error parsing arg:",e)}this.options.url_search_settings[i]=r}d.log("Updated settings:"),d.log(this.options.url_search_settings),d.groupEnd()},initialize:function(t){this.options=e.extend(this.options,t,!0),this._adjustLegacySettings(),this.debugMode=this.getDebugMode()},serialize:function(){return JSON.stringify(this.options)},getDebugMode:function(){return!!(e.is(this.options)&&e.is(this.options.search_settings)&&this.options.search_settings.debug_mode)},getDebug:function(){return!!(e.is(this.options)&&e.is(this.options.search_settings)&&e.is(this.options.search_settings.debug)&&!0===this.options.search_settings.debug)},manageHardcodedSettings:function(t,i){if("Recent_Content_Delta_Time"===t)this.getOption("deactivate_checks")||(i>30?i=5:i<1&&(i=5));else if("defaultViewModeAfterCacheCleaning"===t){var r=i.toLowerCase();if("table"===r||"grid"===r?i="table":!0!==this.options.search_settings.simple_search_experience&&(i="thumbnail"),!0===this.getOption("newSearch19xFD02")&&!0===this.getOption("predefinedBetaUser")&&!0===this.options.search_settings.simple_search_experience&&(i="tilebig"),!0===this.getOption("OneSearch")&&("table"===i||"tile"===i||"thumbnail"===i)){var s=/iPhone/.test(navigator.userAgent)&&!window.MSStream,n=/iPad/.test(navigator.userAgent)&&!window.MSStream,a=/Android/.test(navigator.userAgent)&&!window.MSStream;if(-1!==["iphone","ipad","android"].indexOf(s?"iphone":(n?"ipad":"")||(a?"android":""))){var o=screen.availWidth;e.is(o)&&o<1023&&(i="tilebig")}else!0===this.getOption("search_compact_mode")&&(i="tilebig")}}else if("max_selection_for_selectall"===t||"max_selection_for_actions"===t)e.is(i)||(i=200),i>1e3?i=1e3:i<1&&(i=200);else if("results_perpage"===t&&(!e.is(i,"number")||i<=1||i>200)){let t=window.devicePixelRatio,r=26;t<1&&(t=1/t);let s,n=window.innerWidth,a=window.innerHeight;d.log("Settings results_perpage width: ",n),d.log("Settings results_perpage height: ",a);let o=/iPhone/.test(navigator.userAgent)&&!window.MSStream,c=/iPad/.test(navigator.userAgent)&&!window.MSStream,l=/Android/.test(navigator.userAgent)&&!window.MSStream;-1!==["iphone","ipad","android"].indexOf(s=o?"iphone":(c?"ipad":"")||(l?"android":""))&&(r=40);let u=10*Math.ceil(n*a/(t*t)/53e3/10),p=Math.ceil(a/r+1),h=Math.max(u,p);d.log("Settings results_perpage ratio: ",t),d.log("Settings results_perpage computedMaxTileValue: ",u),d.log("Settings results_perpage computedMaxGridValue: ",p),d.log("Settings results_perpage computedValue: ",h),e.is(h,"number")&&h>1&&h<200?(i=h,!0===g.getOption("search_web_in_win")&&h<41&&(i=40)):i=200}return i},getOptionPerTenant:function(t,i){var r=null;return e.is(t)&&e.is(i,"object")&&e.is(i.tenant,"string")&&i.tenant.length>0&&e.is(this._tenantSettings[i.tenant])&&e.is(this._tenantSettings[i.tenant].search_settings)&&e.is(this._tenantSettings[i.tenant].search_settings[t])&&(r=this._tenantSettings[i.tenant].search_settings[t]),e.is(r)||e.is(t)&&e.is(i,"object")&&e.is(i.tenant,"string")&&i.tenant.length>0&&e.is(this._tenantSettings[i.tenant])&&e.is(this._tenantSettings[i.tenant][t])&&(r=this._tenantSettings[i.tenant][t]),r},getOption:function(t,i){var r=l.getenv(t);if(e.is(this.options)){var s=null,n=!1;return e.is(this.options.url_search_settings)&&!0===this.options.url_search_settings.ignoreAdminSettings?n=!0:e.is(this.options.sessionStorageSettings)&&!0===this.options.sessionStorageSettings.ignoreAdminSettings&&(n=!0),!1===n&&(s=this.getOptionPerTenant(t,i)),e.is(this.options.url_search_settings,"object")&&e.is(this.options.url_search_settings[t])?this.options.url_search_settings[t]:e.is(this.options.sessionStorageSettings,"object")&&e.is(this.options.sessionStorageSettings[t])?this.options.sessionStorageSettings[t]:!0===i&&e.is(this.options.search_settings_odt)?this.options.search_settings_odt[t]:e.is(window.dscef)&&e.is(window.dscef.getEnv,"function")&&e.is(window.dscef.getEnv(t),"string")&&window.dscef.getEnv(t).length>0?window.dscef.getEnv(t):e.is(this.options.search_settings)&&e.is(this.options.search_settings[t])?(r=this.options.search_settings[t],e.is(s)&&(r=s),r=this.manageHardcodedSettings(t,r)):e.is(s)?r=this.manageHardcodedSettings(t,s):e.is(this.options[t])?this.options[t]:this.manageHardcodedSettings(t,s)}},_loadSettings:function(t){d.groupCollapsed("SearchSettings._loadSettings"),d.log("url=",t);var i=this,s={timeout:5e4,method:"GET",data:{},type:"json",headers:{Accept:"application/ds-json"},onComplete:function(t){d.log("setting file successfully retrieved");var r={};if(e.is(t,"string"))try{r=JSON.parse(t)}catch(e){d.log("Error parsing file",e),d.log("resp=",t)}else r=t;r.error?d.log("Bad format for SearchSettings"):i.initialize(r),i.loadComplete=!0,e.is(i.onCompleteLoad,"function")&&i.onCompleteLoad.call(void 0,null),d.log("Available Search Settings:\n"+JSON.stringify(i.options)),d.groupEnd()},onFailure:function(){d.log("failed retrieving setting file"),e.is(i.onCompleteLoad,"function")&&i.onCompleteLoad.call(void 0,null),d.groupEnd()},onTimeout:function(){d.log("No settings found timeout reach"),d.groupEnd()}};try{if(!h(t)){var a="";a=n.getWebappsBaseUrl();a=a.replace(/\/$/,""),d.log("Base URL "+a),h(a)||(d.log("The base URL is not a valid one (webapp context?)"),a=""),t=a+t}d.log("Used URL "+t),r.request(t,s)}catch(e){d.log("Failure : "+e),d.groupEnd()}},getSettingsToDisplayInUI:function(){var t=[];e.is(this.options.search_settings.searchOptionsDisplayedInUI,"array")&&(t=this.options.search_settings.searchOptionsDisplayedInUI);for(var i=t.length-1;i>=0;i--){var r=t[i];if(e.is(r)&&e.is(r.optionID)){var s=r.optionID,n=u.get(s),a=u.get(s+".tooltip");if(r.optionLabel=n,r.optionTooltip=a,e.is(r.moreOptions,"array")){for(var o=r.moreOptions,c=0;c<o.length;c++){var l=o[c];e.is(l)&&e.is(l.optionID)&&(s=l.optionID,n=u.get(s),a=u.get(s+".tooltip"),l.optionLabel=n,l.optionTooltip=a,l.father=s,t.push(l))}r.moreOptions=void 0,!1===this.getDebug()&&(t[i]=void 0)}}}return t},_adjustLegacySettings:function(){e.is(this.options.search_settings)&&e.is(this.options.search_settings.topbar_search_banned_list)&&(e.is(this.options.search_settings.topbar_search_banned_list.types,"array")&&(this.options.search_settings.topbar_search_banned_list.types={"3dspace":this.options.search_settings.topbar_search_banned_list.types}),e.is(this.options.search_settings.topbar_search_banned_list.users,"array")&&(this.options.search_settings.topbar_search_banned_list.users={"3dspace":this.options.search_settings.topbar_search_banned_list.users}))},_loadTenantSettings:function(t){var i=this;i._tenantSettingsPC[t]||(i._tenantSettingsPC[t]=s.deferred(),i._tenantSettings[t]={},p.getSearchSettings({tenantID:t}).then(function(r){e.is(r)&&(i._initializeIrrelevantTags(t,r),Object.keys(r).forEach(function(s){var n=r[s];"relevant_tags"===s?e.is(n,"object")&&Object.keys(n).length>0&&(i._tenantSettings[t][s]=n):i._tenantSettings[t][s]=n})),i._tenantSettingsPC[t].resolve()},function(){i._tenantSettingsPC[t].resolve()}))},_initializeIrrelevantTags:function(t,i){if(d.groupCollapsed("SearchSettings._initializeIrrelevantTags from SCC relevant_tags"),d.log("tenantId:",t),d.log("SCCsettings:",i),e.is(i)&&e.is(i.relevant_tags)){for(var r=i.relevant_tags,s=this.getOption("irrelevant_tags")||[],n=Object.keys(r),a=0;a<n.length;a++)if(e.is(n[a],"string")){var o=r[n[a]];e.is(o)&&e.is(o.weight)&&-1===o.weight&&(d.log("Adding key",n[a]," in irrelevant_tags setting"),s.indexOf(n[a])<0&&s.push(n[a]),d.log("Deleting key",n[a]," from relevant_tags setting"),delete i.relevant_tags[n[a]])}this._tenantSettings[t].irrelevant_tags=s}else e.is(i)?e.is(i.relevant_tags)||d.log("relevant_tags key not found in SCC settings"):d.log("SCC setting is undefined");d.groupEnd()},getTenantSettings:function(e){return this._loadTenantSettings(e),this._tenantSettingsPC[e].promise},_resolveTenantSettings:function(e){this._tenantSettingsPC[e]=s.deferred(),this._tenantSettingsPC[e].resolve()},changeSettingForFD01:function(){!0!==this.getOption("enableNewSearchViews")&&(e.is(this.options.search_settings.keepOldSearchViews)||(this.options.search_settings.keepOldSearchViews=!0),e.is(this.options.search_settings.informationsPanel)&&(this.options.search_settings.informationsPanel=!1))},changeSettingForBETA:function(){d.groupCollapsed("SearchSettings.changeSettingForBETA");var e={contentsLocation_FUN072059:!0,keepOldSearchViews:!1};d.log("Overriding the settings for beta "+JSON.stringify(e)),this.initialize({search_settings:e}),d.groupEnd()},changeSettingForBETA_deactivated:function(e){d.groupCollapsed("SearchSettings.changeSettingForBETA_deactivated");var t=e||{};d.log("Overriding the settings when beta option is available but deactivated: "+JSON.stringify(t)),this.initialize({search_settings:t}),d.groupEnd()},changeSettings:function(e){this.initialize({search_settings:e})},isODTMode:function(){let e=sessionStorage.getItem("isODTMode")||this.getOption("isODTMode");return"true"===e&&(e=!0),e&&!this._warningAlreadyDisplayed&&(this._warningAlreadyDisplayed=!0,d.warn("ODT Mode active !!!")),e},setCompactMode:function(t){if(e.is(this.options.search_settings)){var i=t;e.is(i)||(i=!0),this.options.search_settings.simple_search_experience=!0,this.options.search_settings.search_compact_mode=i,this.options.search_settings.NoadvOnMenu=i,this.options.search_settings.NofavoritesOnMemu=i,this.options.search_settings.NoPQMenu=i,this.options.search_settings.show_last_indexation_time=!i}}});return g}),define("DS/SNInfraUX/tracker/SearchTrackerApi",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/Usage/TrackerAPI","DS/MessageBus/MessageBus"],function(e,t,i,r,s,n){"use strict";return t.singleton(i,r,{tracker:null,messageBus:null,init:function(){},trackPageView:function(){s.trackPageView({pageURL:window.location.href})},trackPageEvent:function(e,t){s.trackPageEvent({eventCategory:e,eventAction:t})},set:function(){this.messageBus=n.subscribe({channel:"SearchTrackerApi",topic:"hit",callback:this._track.bind(this)})},register:function(e){s.registerData(e)},_track:function(t){e.is(t)&&s.trackPageEvent({eventCategory:e.is(t.category)?t.category:"category",eventAction:e.is(t.action)?t.action:"actions",persDim:e.is(t.persDim)?t.persDim:{},persVal:e.is(t.persVal)?t.persVal:{}})}})}),define("DS/SNInfraUX/SearchViewServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","text!DS/SNInfraUX/assets/SearchView.json"],function(e,t,i,r,s){"use strict";return t.singleton(i,r,{_searchViewSpec:null,init:function(){this._searchViewSpec=JSON.parse(s)},initialize:function(t){this._searchViewSpec=e.extend(this._searchViewSpec,t,!0)},_getSourceSpecificAllPredicates:function(e){var t=this.getViewSpecs(e),i=[],r=Object.keys(t);if(Array.isArray(r)&&r.length>0)for(var s=0;s<r.length;s++)Array.isArray(t[r[s]])&&(i=i.concat(t[r[s]]));return i.filter(function(e,t,i){return t===i.indexOf(e)})},getAllSelectClause:function(t){var i=[];if(!0===t){var r=Object.getOwnPropertyNames(this._searchViewSpec.SearchView);if(e.is(r,"array")&&r.length>0){var s=r.indexOf("UXSupportedFields");s>=0&&r.splice(s,1)}for(var n=0,a=r.length;n<a;n++){var o=this._getSourceSpecificAllPredicates(r[n]);i=i.concat(o)}}else i=this._getSourceSpecificAllPredicates("default");return i.filter(function(e,t,i){return t===i.indexOf(e)})},getViewSpecs:function(t,i){""===t&&(t="default");var r=i;e.is(r)||(r=[]);var s={};if(e.is(this._searchViewSpec)&&this._searchViewSpec.hasOwnProperty("SearchView")){this._searchViewSpec.SearchView.hasOwnProperty(t)||(t="default");var n=this._searchViewSpec.SearchView[t];if(Array.isArray(r)&&(r.length<=0&&this._searchViewSpec.SearchView.hasOwnProperty("UXSupportedFields")&&(r=e.clone(this._searchViewSpec.SearchView.UXSupportedFields)),r.length>0))for(var a=0,o=0;o<r.length;o++)if(e.is(n)&&n.hasOwnProperty(r[o]))s[r[a++]]=n[r[o]];else{var c=this._searchViewSpec.SearchView.default;e.is(c)&&c.hasOwnProperty(r[o])&&(s[r[a++]]=c[r[o]])}}return s}})}),define("DS/SNInfraUX/Logger",[],function(){"use strict";return-1!==location.search.indexOf("searchLogs")&&(window.searchLogs=!0),new function(e){var t,i,r,s,n;function a(e){return function(){if(t)if(i.console){if("function"==typeof i.console[e]&&(i.searchLogs||"info"===e||"warn"===e||"error"===e))return i.console[e].apply(i.console,Array.prototype.slice.call(arguments));if("function"!=typeof i.console[e]&&"object"==typeof i.console[e]&&"debug"!==e&&i.searchLogs)return i.console[e](Array.prototype.slice.call(arguments))}else if(i.opera&&"function"==typeof i.opera.postError&&i.searchLogs)return i.opera.postError.apply(null,Array.prototype.slice.call(arguments))}}for("boolean"!=typeof e&&(e=!1),t=e,i=window||global||{},this.disable=function(){return t=!1,this},r=0,s=(n=["log","info","warn","error","debug","group","groupEnd","groupCollapsed"]).length;r<s;r++)this[n[r]]=a(n[r])}(!0)}),define("DS/SNInfraUX/RefineHelper/RefineHelper",["UWA/Core","UWA/Class","UWA/Class/Debug"],function(e,t,i){"use strict";return t.singleton(i,{isSimplifiedTaggerFilters:function(e){return e&&e.operator&&e.condition},isEmpty:function(e){return this.isSimplifiedTaggerFilters(e)&&0===e.condition.length},getAllFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],r=e.value||[];i.forEach(function(e,i){t[e.predicate]||(t[e.predicate]=[]),t[e.predicate].push(r[i])})})})}),t},extractSourceInSimplifiedTagger:function(e){var t=[],i=this.getAllAdvanceFilters(e);i.hasOwnProperty("sixw:ds6w:where/ds6w:source/ds6w:dataSource")&&i["sixw:ds6w:where/ds6w:source/ds6w:dataSource"].forEach(function(e){t.push(e.object)});return t},getAllAdvanceFilters:function(e){var t={};return((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){i.includes("sixw:")&&(t[i]=t[i]||[],(e[i]||[]).forEach(function(e){t[i].push(e)}))})}),t},convertToRefineAndUQL:function(e){var t=e||{},i=t.operator||!1,r=t.excluded||!1,s=t.condition||[],n="AND"!==i||r,a="",o={};return s.reduce(function(e,t){Object.keys(t).forEach(function(e){if(0!==e.indexOf("sixw:")){var r=t[e],s=this._ds6w(r,n);a=this._mergeQuery(a,s.uql,i,!0),this._andRefines(o,s.refine)?this._collectRefines(o,s.refine):a=this._mergeQuery(a,this._refineToQuery(s.refine),i,!0)}}.bind(this))}.bind(this),{}),r&&a&&(a="NOT"+a),{uql:a,refine:o}},_ds6w:function(e,t){var i="",r={},s=e.excluded||!1,n=s?"OR":e.operator,a=e.condition||[],o=e.display||[],c=o.length===a.length,l=!1;return s||(l=this._allConditionsExluded(a)),t=t||s||this._uqlonly_ds6w(e),a.forEach(function(e,s){var a=t||!this._canRefine(r,e,n),u=this._condition(e,a,c?o[s].nls:void 0,l),d=u.uql;e.excluded&&!l&&u.uql&&(d="NOT ("+u.uql+")"),i=this._mergeQuery(i,d,n),this._collectRefines(r,u.refine)}.bind(this)),(l||s)&&i&&(i="NOT("+i+")"),{uql:i,refine:r}},_allConditionsExluded:function(t){return t.every(t=>e.is(t.excluded)&&t.excluded)},_condition:function(t,i,r,s){var n="",a={},o=t.value,c=t.predicates,l=t.operator||"OR",u=t.excluded||!1,d=t.field;return d&&c.length!==d.length&&(d=null),u&&!s?{uql:n,refine:a}:(i?c.forEach(function(t,i){if(e.is(o[i],"array"))n=this._mergeQuery(n,this._keyValue(t.predicate,JSON.stringify(o[i].join("/"))),l);else if(e.is(o[i],"string"))n=this._mergeQuery(n,this._keyValue(t.predicate,JSON.stringify(o[i])),l);else if(e.is(o[i],"object")){var r=this._range_query(t,o[i]);n=this._mergeQuery(n,r,l)}}.bind(this)):c.forEach(function(e,t){var i=e.predicate;a[i]||(a[i]=[]),a[i].push({type:e.type,object:o[t],disptext:r||o[t],field:d?[d[t]]:["implicit"]})}),{uql:n&&!u?"("+n+")":n,refine:a})},_uqlonly_ds6w:function(e){var t=e.operator;e.excluded;if("AND"===t)return!1;if("XOR"===t)return!0;for(var i=e.condition||[],r={},s=0;s<i.length;s++){var n=i[s],a=this._canRefineCondition(n);if(!1===a)return!0;for(var o=Object.keys(a),c=0;c<o.length;c++){var l=o[c];if(!r[l]){if(Object.keys(r).length>0)return!0;r[l]=[]}}}return!1},_canRefineCondition:function(t){var i={},r=t.predicates||[],s=t.operator||"OR",n=t.excluded||!1,a=t.value;if(n)return!1;for(var o=0;o<r.length;o++){if(e.is(a[o],"object"))return!1;var c=r[o];if(i[c.predicate]){if("OR"!==s)return!1}else if(i[c.predicate]=[],Object.keys(i).length>1&&"AND"!==s)return!1}return i},_canRefine:function(e,t,i){var r=this._canRefineCondition(t);if(!1===r)return!1;for(var s=Object.keys(r),n=0;n<s.length;n++){if(e[s[n]]){if("OR"!==i)return!1}else if(Object.keys(e).length>0&&"AND"!==i)return!1}return!0},_keyValue:function(t,i){var r=t.split("/");return e.is(i,"array")&&(i=i.join("/")),"["+r[r.length-1]+"]:"+i},_mergeQuery:function(e,t,i,r){return t&&r&&(t="("+t+")"),e?t?e+" "+i+" "+t:e:t},_collectRefines:function(e,t){Object.keys(t).forEach(function(i){e[i]||(e[i]=[]),e[i]=e[i].concat(t[i])})},_andRefines:function(e,t){return!Object.keys(t).some(function(t){return e[t]})},_refineToQuery:function(e){var t="",i=this;return Object.keys(e).forEach(function(r){var s=e[r],n="";s.forEach(function(e){var t=i._keyValue(r,JSON.stringify(e.object));n=i._mergeQuery(n,t,"OR")}),t=i._mergeQuery(t,n,"AND")}),t},_range_query:function(t,i){var r="",s="["+t.predicate+"]",n="",a="";if("date"===t.type){if(e.is(i.from)){var o=new Date(i.from+" 00:00:00");n=s+'>="'+new Date(o).toISOString()+'"'}if(e.is(i.to)){var c=new Date(i.to+" 23:59:59");a=s+'<="'+new Date(c).toISOString()+'"'}r+=this._mergeQuery(n,a,"AND")}return r},applyTransformation:function(e,t){this.isSimplifiedTaggerFilters(e)&&((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){(e[i].condition||[]).forEach(function(e){var i=e.predicates||[],r=e.value||[],s=e.field;i.forEach(function(i,n){var a={};a[i.predicate]=[];var o={disptext:e.display,object:r[n],type:i.type,field:s?[s[n]]:["implicit"]};a[i.predicate].push(o),t.call(void 0,a),Object.keys(a).forEach(function(e){r[n]=a[e][0].object,i.predicate=e})})})})})},applyTransformationAdvancedFilter:function(e,t){this.isSimplifiedTaggerFilters(e)&&((e=e||{}).condition||[]).forEach(function(e){Object.keys(e).forEach(function(i){if(i.includes("sixw:")){var r={};e[i].forEach(function(e){r[i]=[];var t={disptext:e.displayValue,object:e.object,type:e.type,field:e.field?[e.field]:["implicit"]};r[i].push(t)}),t.call(void 0,r)}})})},preMergeSimplifiedTagger:function(e,t,i,r,s){if(this.isSimplifiedTaggerFilters(i)){var n=i.condition||[],a={};n.forEach(function(e){Object.keys(e).forEach(function(t){a[t]=e[t]})});var o=this.getAllFilters(i);if(a["ds6w:where/ds6w:location/computedCountryInfo"]||a["ds6w:where/ds6w:location/computedCityInfo"]){var c=[];r.forEach(function(e){e.sixw.startsWith("ds6w:who/")||c.push(e)}),r=c}else if(a["ds6w:who/person"]){e.filter(function(e){return e.sixw.startsWith("ds6w:who/")}).forEach(function(e){o[e.sixw]||r.push(e)})}s=s||[],Object.keys(o).map(function(e){return e.split("/").pop()}).some(function(e){return s.indexOf(e)>=0})&&e.forEach(function(e){var t=e.sixw.split("/").pop();s.indexOf(t)>=0&&!o[e.sixw]&&r.push(e)})}return r},mergeWhat:function(e,t,i,r){if(this.isSimplifiedTaggerFilters(i)){var s=i.condition||[],n={};if(s.forEach(function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})}),n["ds6w:where/ds6w:location/computedCountryInfo"]||n["ds6w:where/ds6w:location/computedCityInfo"])return[];var a=e.filter(function(e){return e.sixw.startsWith("ds6w:who/")}),o=this.getAllFilters(i);a.forEach(function(e){o[e.sixw]||r.push(e)})}return r},postMergeSimplifiedTagger:function(e,t){var i={};if(this.isSimplifiedTaggerFilters(e)){(e.condition||[]).forEach(function(e){Object.keys(e).forEach(function(t){i[t]=e[t]})});var r=[];function s(e){e&&e.condition&&e.condition.forEach&&e.condition.forEach(function(e){r.push.apply(r,e.value)})}s(i["ds6w:where/ds6w:location/computedCountryInfo"]),s(i["ds6w:where/ds6w:location/computedCityInfo"]),t=t.filter(function(e){return!(e.sixw.startsWith("ds6w:who/")&&r.length>0&&r.indexOf(e.object)<0)})}return t}})}),define("DS/SNInfraUX/SWFiltering",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Json"],function(e,t,i,r){"use strict";return t.singleton(i,{_select_predicates:null,_select_exclude_synthesis:null,_additional_criteria:null,_specificSourceParameter:null,init:function(){},setSelectPredicates:function(t){e.is(t)&&(e.is(t,"string")&&(t=r.decode(t)),e.is(t,"array")&&(this._select_predicates=t))},getSelectPredicates:function(){return this._select_predicates},isAVisiblePredicate:function(t){var i=!0;return e.is(this._select_predicates,"array")&&-1===this._select_predicates.indexOf(t)&&(i=!1),i},setSelectExcludeSynthesis:function(t){e.is(t)&&(e.is(t,"string")&&(t=e.Json.decode(t)),e.is(t,"array")&&(this._select_exclude_synthesis=t))},getSelectExcludeSynthesis:function(){return this._select_exclude_synthesis},setAdditionalQueryCriteria:function(t){e.is(t,"string")&&(this._additional_criteria=t)},getAdditionalQueryCriteria:function(){return this._additional_criteria},setSpecificSourceParameter:function(t){e.is(t)&&(this._specificSourceParameter=t)},getSpecificSourceParameter:function(){return this._specificSourceParameter},clear:function(){this._select_predicates=null,this._select_exclude_synthesis=null,this._additional_criteria=null,this._specificSourceParameter=null}})}),define("DS/SNInfraUX/SearchDebug",["UWA/Core","UWA/Class/Debug","DS/SNInfraUX/SearchSettings"],function(e,t,i){"use strict";return t.extend({_check_activated:!1,log:function(t){return!1===this._check_activated&&(this.setDebugMode(i.debugMode),this._check_activated=!0),this._parent(String.prototype.format.apply("{0}: {1}".format(e.is(this.uwaClassName,"string")?this.uwaClassName:"[UNKNOWN]",t),[].slice.call(arguments,1)))}})}),define("DS/SNInfraUX/utils/SNCompassUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],function(e,t,i,r,s,n,a,o){"use strict";return t.singleton(i,{init:function(){},getApplicationsFromCompass:function(e){return new r(function(t,i){a.searchApplication({query:e,onComplete:function(e){s.info("List of application from compass >> "+e),t(e)},onFailure:function(e){s.error("Error from compass>>"+e),i(e)}})})},launchApplicationFormCompass:function(t){return new r(function(i,r){n.publish("launchApp",{appId:t},function(t){s.log(t),e.is(t)&&"COMPLETE"===t.response?i(o.get("AppLaunchSuccess")):r(o.get("AppLaunchFail"))})})},searchApplicationsInCompass:function(t){e.is(t)?n.publish("search",{query:t,onComplete:function(e){s.log(e)}}):s.log("Invalid query")}})}),define("DS/SNInfraUX/SearchPreferences",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger","UWA/Promise","DS/i3DXCompass/Data"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(i,{preferences:{},_previousPrefOptionsValue:{},_tenantData:{},_tenantSpecificPreferences:["optionMode"],init:function(){s.groupCollapsed("SearchPreferences"),this._restoreDataFromLocalStorage(),s.groupEnd()},getItemPromise:function(t,i){if(s.groupCollapsed("SearchPreferences.getItemPromise"),s.log("Key:",t),!e.is(t,"string"))throw s.groupEnd(),new Error("Invalid input key"+t);let r=n.deferred();if(e.is(this._previousPrefOptionsValue[t]))s.log("Retrieving value from cache:",this._previousPrefOptionsValue[t].parsed),this._isTenantSpecificPreference(t)?r.resolve(this._tenantData&&this._tenantData[i]?this._tenantData[i]:{}):r.resolve(this._previousPrefOptionsValue[t].parsed);else{s.log("item not found in cache, trying to retrieve it from compass service");let e=this;this.getPreference({name:t,onComplete:function(n){s.log("Retrieval successful: ",n),e._previousPrefOptionsValue[t]={stringified:JSON.stringify(n&&n[i]?n[i]:null),parsed:n&&n[i]?n[i]:null},e._tenantData=n,r.resolve(n&&n[i]?n[i]:{})},onFailure:function(e){s.warn("fail to get data",e),r.reject()}})}return s.groupEnd(),r.promise},_restoreDataFromLocalStorage:function(){if(e.is(localStorage)){var t=localStorage.getItem("searchPreferences");if(e.is(t))try{this.preferences=JSON.parse(t),s.log("preferences (from localStorage):",t)}catch(e){s.error("Error parsing searchPreferences:",e)}e.is(this.preferences)||(this.preferences={})}else s.warn("localStorage not supported !")},setItem:function(t,i){e.is(localStorage)?(this._checkUpdateToDo(),this.preferences[t]=e.clone(i)):s.warn("localStorage not supported !")},removeItem:function(t){e.is(localStorage)&&delete this.preferences[t]},_checkUpdateToDo:function(){if(!e.is(localStorage))return;let t=localStorage.getItem("updateToDo");e.is(t)&&"true"===t&&(this._restoreDataFromLocalStorage(),localStorage.removeItem("updateToDo"))},getItem:function(t){if(!e.is(localStorage))return;this._checkUpdateToDo();let i=this.preferences[t];if(!e.is(i))if(e.is(this.uiSettings))i=this.uiSettings[t];else{this.uiSettings={};var n=r.getSettingsToDisplayInUI();if(e.is(n,"array")&&n.length>0)for(var a=0,o=n.length;a<o;a++)e.is(n[a])&&e.is(n[a].optionID)&&e.is(n[a].optionDefaultValue)&&(this.uiSettings[n[a].optionID]=n[a].optionDefaultValue,e.is(r.getOption(n[a].optionID))&&r.getOption(n[a].optionID)!==n[a].optionDefaultValue&&(s.log("Default value for "+n[a].optionID+" in searchOptionsDisplayedInUI overloaded with value="+r.getOption(n[a].optionID)),this.uiSettings[n[a].optionID]=r.getOption(n[a].optionID)));i=this.uiSettings[t]}if(!e.is(i)){let s=r.getOption("SearchPreferencesDefault");e.is(s,"object")&&e.is(s[t])&&(i=s[t])}return i},commit:function(t){this._checkUpdateToDo(),localStorage.setItem("searchPreferences",JSON.stringify(this.preferences));var i={};!0===r.getOption("newSearch19xFD02")&&!0===r.getOption("predefinedBetaUser")&&e.is(this.preferences.simple_search_experience)&&(i.simple_search_experience=this.preferences.simple_search_experience),i.revisionDisplayType=this.preferences.revisionDisplayType,i.find_in_this_tab_default=this.preferences.find_in_this_tab_default,this.setPreference({name:"3DSearchOptions",value:JSON.stringify(i),onComplete:t?t.onComplete:void 0,onFailure:t?t.onFailure:void 0})},setPreference:function(t){if(!e.is(t,"object")||!e.is(t.name,"string")||!e.is(t.value,"string"))throw s.error("Invalid arg in SearchPreferences.setPreference!",t),new Error("Invalid arg in SearchPreferences.setPreference!");var i=this;if("{}"===t.value||e.is(this._previousPrefOptionsValue,"object")&&e.is(this._previousPrefOptionsValue[t.name],"object")&&e.is(this._previousPrefOptionsValue[t.name].stringified,"string")&&this._previousPrefOptionsValue[t.name].stringified===t.value)e.is(t.onComplete,"function")&&t.onComplete();else{try{this._previousPrefOptionsValue[t.name]={},this._previousPrefOptionsValue[t.name].parsed=JSON.parse(t.value),this._previousPrefOptionsValue[t.name].stringified=t.value}catch(e){return void s.warn("Cannot parse this data")}if(e.is(a,"object")&&!e.is(a.setPreferencesUrl,"string")&&e.is(window.COMPASS_CONFIG,"object")&&e.is(COMPASS_CONFIG.userId,"string")&&a.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:""}),!e.is(a.setPreferencesUrl))return s.warn("No compass service to store preferences, using local storage instead"),void this.setItem(t.name,t.value);this._isTenantSpecificPreference(t.name)&&(this._tenantData[t.tenantId]=JSON.parse(t.value),t.value=JSON.stringify(this._tenantData));var r={url:a.setPreferencesUrl,urlParams:{name:t.name,value:t.value},onComplete:function(e){e&&0===e.code?(t&&t.onComplete&&t.onComplete(),i._isTenantSpecificPreference(t.name)&&(i.optionMode=JSON.parse(t.value))):(s.warn("Compass service reponding with unexpected answer, using local storage instead"),i.setItem(t.name,t.value),t&&t.onFailure&&t.onFailure())},onFailure:function(){s.warn("Failure when trying to use compass service to store preferences, using local storage instead"),i.setItem(t.name,t.value),t&&t.onFailure&&t.onFailure()}};a.request(r)}},getPreference:function(t){if(!e.is(t,"object")||!e.is(t.name,"string"))throw s.error("Invalid arg in SearchPreferences.getPreference!",t),new Error("Invalid arg in SearchPreferences.getPreference!");var i=this;if(e.is(a,"object")&&!e.is(a.getPreferencesUrl,"string")&&e.is(window.COMPASS_CONFIG,"object")&&a.initialize({lang:COMPASS_CONFIG.lang,userId:COMPASS_CONFIG.userId,myAppsBaseUrl:COMPASS_CONFIG.myAppsBaseUrl,passportUrl:"",proxyTicketUrl:""}),!e.is(a.getPreferencesUrl))return s.warn("No compass service to get preferences, using local storage instead"),void(t&&t.onComplete&&t.onComplete(this.getItem(t.name)));let n={url:a.getPreferencesUrl,urlParams:{name:t.name},onComplete:function(n){e.is(n)||(n={}),!0===r.getOption("newSearch19xFD02")&&!0===r.getOption("predefinedBetaUser")&&e.is(n.simple_search_experience)&&(i.preferences.simple_search_experience=n.simple_search_experience),e.is(n.find_in_this_tab_default)&&(i.preferences.find_in_this_tab_default=n.find_in_this_tab_default),e.is(n.revisionDisplayType)&&(i.preferences.revisionDisplayType=n.revisionDisplayType),s.log("preferences (from compass):",n),t&&t.onComplete&&t.onComplete(n)},onFailure:function(){s.warn("No compass service to get preferences, using local storage instead"),t&&t.onComplete&&t.onComplete(i.getItem(t.name))}};a.request(n)},_isTenantSpecificPreference:function(e){return this._tenantSpecificPreferences.indexOf(e)>=0}})}),define("DS/SNInfraUX/utils/SNUnitConversionHelper",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchPreferences"],function(e,t,i,r,s){"use strict";return t.singleton(i,{_resources:null,_predicate2TypeMapFromLocalCache:null,init:function(){this._predicate2TypeMapFromLocalCache=new Map,this._loadPredicate2TypeFromLocalCache()},_loadPredicate2TypeFromLocalCache:function(){let t=s.getItem("DataGridColumnCusto");if(e.is(t)&&e.is(t.views,"array")){let i;t.views.forEach(t=>{i=t.viewDefinition,e.is(i,"array")&&i.forEach(t=>{e.is(t.dataIndex)&&e.is(t.dataType)&&t.dataType.length>0&&!this._predicate2TypeMapFromLocalCache.has(t.dataIndex)&&this._predicate2TypeMapFromLocalCache.set(t.dataIndex,t.dataType)})})}},getTypeForPredicateFromLocalCache:function(e){return this._predicate2TypeMapFromLocalCache.get(e)},prepareRequestDataF:function(e,t){let i=t.data,r=t.predicate2Type;if(e){var s=this._getTypeAndExtensionList(e,t);Object.keys(e).forEach(function(t){var n=t.substring(5),a=e[t];i[n]||(i[n]=[]),a.forEach(function(e){var t=e.object;t&&("string"===e.type?i[n].push(t):"double"!==e.type&&"integer"!==e.type||(t.from&&i[n].push(t.from),t.to&&i[n].push(t.to)),r[n]=s)})})}},_getTypeAndExtensionList:function(e){return this.getTypeListFromFilters(e).concat(this.getExtensionListFormFilters(e))},getExtensionListFormFilters:function(t){var i=[],r=t["sixw:vpmextension"];return e.is(r,"array")&&r.forEach(e=>{i.push(e.object)}),i},getTypeListFromFilters:function(e){var t=[];if(e)for(var i in e){if("ds6w:type"===i.split("/").pop()){var r=e[i];r&&r.length>0&&t.push(r[0].object)}}return t},modifyFilterData:function(e,t){e&&Object.keys(e).forEach(function(i){var r=i.substring(5);e[i].forEach(function(e){var i=e.object;t[r]&&("string"===e.type?(i=t[r][i])&&(e.object=i):"double"!==e.type&&"integer"!==e.type||i&&(i.from&&(i.from=t[r][i.from]),i.to&&(i.to=t[r][i.to])))})})},copyConvertedValuesToOriginalFilter:function(e,t){Object.keys(e).forEach(function(i){e[i].forEach(function(e){e.object.from&&t[i][0].object.from&&(e.object.from=t[i][0].object.from),e.object.to&&t[i][0].object.to&&(e.object.to=t[i][0].object.to)})})}})}),define("DS/SNInfraUX/SearchLogin",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n){"use strict";return t.singleton({_loginPromises:{},_cacheLoginData:{},_serviceToSourceMapping:null,login:function(t){n.groupCollapsed("SearchLogin.login");var s=this,a="",o="";(e.is(t,"object")&&(e.is(t.tenantID)?(n.log("options.tenantID platformID : "+t.tenantID),a=t.tenantID):e.is(t.resources)&&(n.log("options.resources.getActiveTenant() platformID : "+t.resources.getActiveTenant()),a=t.resources.getActiveTenant()),e.is(t.fedSearchURL)?(n.log("options.fedSearchURL fedSearchURL : "+t.fedSearchURL),o=t.fedSearchURL):e.is(t.resources)&&(n.log("options.resources.getFedSearchUrl(platformID) : "+t.resources.getFedSearchUrl(a)),o=t.resources.getFedSearchUrl(a))),e.is(a,"string"))&&(this._loginPromises[a]||(this._loginPromises[a]=new r(function(r,c){s._cacheLoginData[a]=[];var l={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}};n.log("fetch_options.data tenant : "+a),l.data={tenant:a},l.url=s._buildFedSearchLoginURL(o),n.log("fetch_options.url : "+l.url),l.onComplete=function(t){n.log("FedSearch login succcessful with platform : "+a);var i=e.is(t,"string")?t.length>0?JSON.parse(t):{}:t;if(e.is(i.infos)&&e.is(i.infos.sources,"array")){var o=i.infos.sources;s.updateServiceToSourceMapping(a,o),r(),n.groupEnd()}else n.error("/federated/login WS response is not in expected format"),c(),n.groupEnd()},l.onFailure=function(t,i){n.error("FedSearch login FAILED with platform : "+a,t,i),s._serviceToSourceMapping||(s._serviceToSourceMapping={}),e.is(s._serviceToSourceMapping["3dspace"])||(s._serviceToSourceMapping["3dspace"]="3DSpace"),e.is(s._serviceToSourceMapping.swym)||(s._serviceToSourceMapping.swym="3DSwym"),e.is(s._serviceToSourceMapping.drive)||(s._serviceToSourceMapping.drive="3DDrive"),e.is(s._serviceToSourceMapping.dropbox)||(s._serviceToSourceMapping.dropbox="3DDrive"),e.is(s._serviceToSourceMapping.googledrive)||(s._serviceToSourceMapping.googledrive="3DDrive"),e.is(s._serviceToSourceMapping.onedrive)||(s._serviceToSourceMapping.onedrive="3DDrive"),e.is(s._serviceToSourceMapping.dashboard)||(s._serviceToSourceMapping.dashboard="3DDashboard"),c()},e.is(t.resources)&&!0===t.resources.is_odt_source()?(n.warn("No action retrieved in ODT mode"),r(),n.groupEnd()):i.authenticatedRequest(l.url,l)})),this._loginPromises[a].then(function(){t.onComplete.call(void 0,s._cacheLoginData[a]),n.groupEnd()},function(){t.onFailure.call(void 0,s._cacheLoginData[a]),n.groupEnd()}))},getAvailableSources:function(e){return this._cacheLoginData[e]},getServiceFromSource:function(t){if(e.is(this._serviceToSourceMapping))return this._serviceToSourceMapping[t]},getDiscoveryURL:function(t,i){var r=void 0;if(e.is(this._cacheLoginData)){var s=this._cacheLoginData[t];if(e.is(s,"array"))for(var n=0;n<s.length;n++)i===s[n].name&&(r=s[n].FSearchAppDiscovery_url)}return r},_buildFedSearchLoginURL:function(e){return-1===e.lastIndexOf("/federated")&&(e+="/federated"),e+"/login"},updateServiceToSourceMapping:function(t,i){if(e.is(t,"string")&&0!==t.length&&e.is(i,"array")){if(e.is(this._cacheLoginData[t]))for(var r=0,a=i.length;r<a;r++){for(var o=!1,c=0,l=this._cacheLoginData[t].length;c<l;c++)e.is(this._cacheLoginData[t][c])&&e.is(i[r])&&this._cacheLoginData[t][c].name===i[r].name&&this._cacheLoginData[t][c].name&&(o=!0);!1===o&&this._cacheLoginData[t].push(i[r])}else this._cacheLoginData[t]=i;this._serviceToSourceMapping||(this._serviceToSourceMapping={});for(var u=0;u<i.length;u++){var d=i[u];e.is(d,"object")&&e.is(d.name,"string")&&d.name.length>0&&e.is(d.service,"string")&&d.service.length>0&&(this._serviceToSourceMapping[d.name]=d.service)}1===i.length&&e.is(i[0],"object")&&e.is(i[0].service,"string")&&i[0].service.length>0&&(s.options.search_settings.service=i[0].service)}else n.error("Bad arguments used in updateServiceToSourceMapping:",t,i)}})}),define("DS/SNInfraUX/PlatformEnvServices",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,r,s){"use strict";return t.singleton(i,{_platformEnvServices:r.deferred(),_available_tenants:{},init:function(){},setEnvironments:function(t){if(this._platformEnvServices.resolve(),e.is(t,"object")&&e.is(t.available_tenants,"object"))Object.keys(t.available_tenants).forEach(i=>{e.is(this._available_tenants[i])?e.merge(this._available_tenants[i].sources,t.available_tenants[i].sources):this._available_tenants[i]=t.available_tenants[i]});else{let i=["cstorage","hpc","search","swym","tagger"];for(let r=0;r<i.length;r++){let s=i[r];if(e.is(t[s]))for(let i=0;i<t[s].length;i++){let r=t[s][i];e.is(this._available_tenants[r.id])||(this._available_tenants[r.id]={sources:{},displayName:r.displayName}),this._available_tenants[r.id].sources[s]={displayName:r.displayName,url:r.url},e.is(r.odt)&&(this._available_tenants[r.id].sources[s].odt=r.odt)}}}},getPlatformEnvServicesPromise:function(){return this._platformEnvServices.promise},getServiceURL:function(t,i){let r;return e.is(this._available_tenants)&&e.is(this._available_tenants[i])&&e.is(this._available_tenants[i].sources)&&e.is(this._available_tenants[i].sources[t])&&(r=this._available_tenants[i].sources[t].url),r},getAllTenants:function(){return this._available_tenants},getAvailableTenantsForSearch:function(){let t,i=[];for(let r in this._available_tenants)this._available_tenants.hasOwnProperty(r)&&(t=this._available_tenants[r],e.is(t)&&e.is(t.sources)&&e.is(t.sources.search)?i.push({tenantId:r,displayName:this._available_tenants[r].displayName}):s.warn("tenant "+r+" does not have search service available, so not listed in UI"));return i},tenantExists:function(t){return e.is(this._available_tenants[t])||"3DDashboard"===t},getTenantDisplayName:function(t){let i=void 0;return this.tenantExists(t)&&e.is(this._available_tenants[t].displayName)&&(i=this._available_tenants[t].displayName),i}})}),define("DS/SNInfraUX/PredicatesNLS",["DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchDebug","UWA/Core","UWA/Class","UWA/Class/Options","UWA/Promise","UWA/Class/Collection","UWA/Class/Model","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,i,r,s,n,a,o,c,l){"use strict";var u=c.extend({idAttribute:"uri"}),d=s.singleton(n,i,{uwaClassName:"DS/SNInfraUX/PredicatesNLS",_predicatesInfo:{},_callbacksInfo:{},_6wg_predicates:{},init:function(){this.setDebugMode(t.setDebugMode())},setResources:function(e){this.setOptions(e)},isLoaded:function(e){var t=!1,i=this._predicatesInfo[e];return r.is(i)&&r.is(i.status)&&"waiting"!==i.status&&(t=!0),t},loadVocabulary:function(t,i){this.log("loadVocabulary called for vocabId : "+t);var s=this.getOption("resources");if(r.is(s)){var n=this._predicatesInfo[t];if(r.is(n)){if(r.is(n.status))if("waiting"===n.status)this.log("Vocabulary : "+t+" is already requested to be loaded"),r.is(i,"function")&&(this._callbacksInfo.hasOwnProperty(t)||(this._callbacksInfo[t]=[]),this._callbacksInfo[t].push(i));else if(this.log("Vocabulary : "+t+" is already loaded"),r.is(i,"function")){var a={id:t,status:n.status};i(a)}}else{this._predicatesInfo[t]={status:"waiting",info:new o([],{model:u})};var c=this;s.PredicatesNLSNames(t,function(s){s.onComplete=function(s){var n;n=r.is(s,"string")?JSON.parse(s):s,e.log("Successfully loaded the vocabulary : "+t),c._predicatesInfo[t].status="success",r.is(n)&&r.is(n.vocabularyElementNLSInfo)&&c._predicatesInfo[t].info.add(n.vocabularyElementNLSInfo),c._sendCallbacks(i,{id:t,status:"success"})},s.onFailure=function(){e.log("FAILED to load the vocabulary : "+t),c._predicatesInfo[t].status="failed",c._sendCallbacks(i,{id:t,status:"failed"})},l.getVocabularyProperties(t,s)})}}else e.error("INVALID STATE: loadVocabulary is called before doing setResources on PredicatesNLS")},getVocabId:function(e){var t=e.match(/\/([^/]*)$/);if(t=null===t?e:t[1],r.is(t)){var i=t.split(":");if(r.is(i)&&2===i.length)return i[0]}},getNLSValueForPredicate:function(e){if(r.is(e,"array")){for(var t=0;t<e.length;t++)e[t]=this._getNLSValueForPredicateOne(e[t]);return e}return this._getNLSValueForPredicateOne(e)},_getNLSValueForPredicateOne:function(e){var t=e.match(/\/([^/]*)$/);t=null===t?e:t[1];var i=null;if(r.is(this._predicatesInfo)&&r.is(t)){var s=t.split(":");if(r.is(s)&&2===s.length){var n=this._predicatesInfo[s[0]];r.is(n)&&(i=n.info.get(t))}}return r.is(i)?i.get("nlsName"):t},_sendCallbacks:function(e,t){var i=this._callbacksInfo[t.id];r.is(i)?r.is(e,"function")&&i.unshift(e):(i=[],r.is(e,"function")&&i.push(e));for(var s=0;s<i.length;s++)i[s].call(void 0,t);this._callbacksInfo[t.id]=[]},_asyncCallToPredicatesWS:function(t,i){var s,n=this;return r.is(n.getOption("resources"))&&(s=n.getOption("resources").getActiveTenant()),n._6wg_predicates.hasOwnProperty(s)||(n._6wg_predicates[s]={classPredicates:{}}),t.indexOf("ds6wg:SavedSearch")>=0&&!r.is(n._6wg_predicates[s].classPredicates["ds6wg:SavedSearch"])&&(n._6wg_predicates[s].classPredicates={"ds6wg:SavedSearch":[{name:"Title",uri:"ds6w:label",nlsName:d.getNLSValueForPredicate("ds6w:label")},{name:"PLM_ExternalID",uri:"ds6w:identifier",nlsName:d.getNLSValueForPredicate("ds6w:identifier")},{name:"originated",uri:"ds6w:created",nlsName:d.getNLSValueForPredicate("ds6w:created")},{name:"modified",uri:"ds6w:modified",nlsName:d.getNLSValueForPredicate("ds6w:modified")},{name:"owner",uri:"ds6w:responsible",nlsName:d.getNLSValueForPredicate("ds6w:responsible")}]}),new a(function(a,c){r.is(t,"array")&&0!==t.length||c(new Error("No DS6WGTypeArray"));var d=[];for(let e=t.length-1;e>=0;e--)r.is(n._6wg_predicates[s].classPredicates[t[e]])&&d.push(t.splice(e,1)[0]);if(0===t.length){let e={classPredicates:[]};for(let t=0,i=d.length;t<i;t++)e.classPredicates.push({className:d[t],vocabularyPredicateInfo:n._6wg_predicates[s].classPredicates[d[t]]});a(e)}else{var p=t.join(","),h="Predicates",g="POST";r.is(i)&&r.is(i.service_name)&&(h=i.service_name),r.is(i)&&r.is(i.method)&&(g=i.method);var f={idService:h,method:g,data:p};n.getOption("resources").getServicewithRole(f,function(t){t.onComplete=function(t){if(n.log("GetRelevantPredicates succeeded"),r.is(i)&&r.is(i.forcetoresolve)&&!0===r.is(i.forcetoresolve))return a(t);let l=null;if(r.is(t)){l=t,r.is(l,"object")&&r.is(l.classPredicates,"array")||(e.error("Invalid response to Predicates WS"+l),c(new Error("Invalid response to Predicates WS")));let i=0,a=0;for(i=0,a=l.classPredicates.length;i<a;i++){var p=l.classPredicates[i].vocabularyPredicateInfo;if(n._6wg_predicates[s].classPredicates[l.classPredicates[i].className]=p,r.is(p)){r.is(n._predicatesInfo.ds6wg)||(n._predicatesInfo.ds6wg={status:"success",info:new o([],{model:u})});for(var h=0,g=p.length;h<g;h++)p[h].uri.startsWith("ds6wg:")&&n._predicatesInfo.ds6wg.info.add(p[h])}}}r.is(l)||(l={classPredicates:[]},e.warn("Strange response from _asyncCallToPredicatesWS"));for(let e=0,t=d.length;e<t;e++)l.classPredicates.push({className:d[e],vocabularyPredicateInfo:n._6wg_predicates[s].classPredicates[d[e]]});a(l)},t.onFailure=function(e,t){n.log("_asyncCallToPredicatesWS fails"),c(e,t)},l.getPropertiesForClass(p,t)})}})}});return d}),define("DS/SNInfraUX/SNAdvSearchCusto",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(r,i,{name:"DS_SNInfraUX_ANAdvSearchCusto",_thePromisePC:s.deferred(),_custo:{},_preferredTypeList:[],_easyAccessTypeList:[],_easyAccessTypeSource:{},_vocabularyElementNLSInfo:null,init:function(){},getCusto:function(e){return n.getTenantSettings(e)},isCustoEnabled:function(){return!0},_getAdvancedSearchOptions:function(e){var t=n.getOption("advanced_search",{tenant:e});return this.loadCusto(t,e),t},getDefaultSelectedSource:function(t){var i=this._getAdvancedSearchOptions(t);if(e.is(i))return i.default_datasource},getExcludedDataSources:function(t){var i=this._getAdvancedSearchOptions(t);if(e.is(i))return i.excluded_dataSource},getExcludedTypes:function(t,i){var r=n.getOption("topbar_search_banned_list",{tenant:t});if(e.is(r)&&e.is(r.types))return r.types[i]},loadCusto:function(t,i){var r=this;if(!this._custo[i]&&e.is(t)){this._custo[i]={};var s=this._custo[i];e.is(t.default_datasource,"string")&&(s.default_datasource=t.default_datasource),e.is(t.excluded_dataSource,"array")&&(s.excluded_dataSource=t.excluded_dataSource),e.is(t.exclusive_taxonomies,"boolean")&&(s._exclusive_taxonomies=t.exclusive_taxonomies);var n=t["ds6w:type"];e.is(n)&&Object.keys(n).forEach(function(t){var i=n[t];if(e.is(i,"array")){var a={selectedByDefault:[],preferredPosition:{}};s[t]=a;for(var o=0;o<i.length;o++){var c=i[o],l=c.uri;if(e.is(l)){r._preferredTypeList.push(l),a.preferredPosition[l]=o,!0===c.selectByDefault&&a.selectedByDefault.push(l),s[l]={},!0===c.easyTypeAcess&&(r._easyAccessTypeList.push(l),r._easyAccessTypeSource[l]=t);var u=c.interfaces;if(e.is(u,"array")){var d={preferredPosition:{},selectedByDefault:[]};s[l].interfaces=d;for(let t=0;t<u.length;t++){var p=u[t];e.is(p.name)&&(d.preferredPosition[p.name]=t,!0===p.selectByDefault&&d.selectedByDefault.push(p.name))}}var h=c.predicates;if(e.is(h,"array")){var g={preferredPosition:{}};s[l].predicates=g;for(let e=0;e<h.length;e++){var f=h[e];f.uri&&(g.preferredPosition[f.uri]=e)}}var _=c.excluded_predicates,S=[];if(e.is(_,"array")){for(let e=0;e<_.length;e++)S.push(_[e].uri);s[l].excluded_predicates=S}}}}})}},getAllPreferredTypes:function(){return null},hasPreferredTypesForSource:function(){return null},getTypesSelectedByDefault:function(){return null},getTypePreferredPosition:function(t,i){var r=this._getAdvancedSearchOptions(t);if(e.is(r)){var s=r["ds6w:type"];if(e.is(s)&&e.is(s[i])){for(var n=s[i],a={},o=0,c=0;c<n.length;c++)!0===n[c].easyTypeAcess&&(a[n[c].uri]=o++);return a}}},getInterfacesSelectedByDefault:function(e){var t=this._custo[e];if(t&&t.interfaces)return t.interfaces.selectedByDefault},getPredicatePreferredPosition:function(t,i){if(e.is(i)&&e.is(this._custo[i])){var r=this._custo[i][t];if(r&&r.predicates)return r.predicates.preferredPosition}},getExcludedPredicatesForType:function(t,i){if(e.is(i)&&e.is(this._custo[i])){var r=this._custo[i][t];if(r&&r.excluded_predicates)return r.excluded_predicates}},getInterfacePreferredPosition:function(){return null},getEasyAccessTypeList:function(){return this._easyAccessTypeList},getSelectedTypeSource:function(e){return this._easyAccessTypeSource[e]},isExclusiveTaxonomies:function(t){if(e.is(t)&&e.is(this._custo[t]))return this._custo[t]._exclusive_taxonomies},getCustoTypeListNLSNames:function(t){if(e.is(t)){var i=this;if(null===this._vocabularyElementNLSInfo){var r=i.getAllPreferredTypes();a._asyncCallToPredicatesWS(r,{service_name:"ElementsNLSNames",method:"POST",forcetoresolve:!0}).then(function(r){var s=null;e.is(r)&&r.length>0&&(s=JSON.parse(r),e.is(s)&&e.is(s.vocabularyElementNLSInfo)&&e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&(i._vocabularyElementNLSInfo={},s.vocabularyElementNLSInfo.forEach(function(e){var t=e.uri;i._vocabularyElementNLSInfo[t]=e}),t.onComplete.call(this,i._vocabularyElementNLSInfo)))},function(){e.is(t)&&e.is(t.onFailure)&&e.is(t.onFailure,"function")&&t.onFailure.call(this)})}else e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(this,i._vocabularyElementNLSInfo)}}})}),define("DS/SNInfraUX/utils/SNPreferenceUtil",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger"],function(e,t,i,r){"use strict";return t.singleton(i,{_unitPreferenceMap:null,init:function(){this._unitPreferenceMap=new Map},setUserUnitPreference:function(t){let i=this;e.is(t)&&e.is(t.displayUnits,"array")&&t.displayUnits.forEach((e,t)=>{i._unitPreferenceMap.set(e.dimension.toUpperCase(),e)})},getPreferenceUnitForDimension:function(e){return this._unitPreferenceMap.get(e.toUpperCase())}})}),define("DS/SNInfraUX/SNPLMDictionary",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(i,r,{_dictionaryPromise:null,_dimensions:{},_mksUnitName:{},_mksUnit:{},init:function(){},_createDictionaryPromise:function(){if(null===this._dictionaryPromise){var t=this.getOption("resources");if(e.is(t)){var i=this;this._dictionaryPromise=new n(function(r){var n=t.getFetchOptions({service_name:"listDimensions"});n.onComplete=function(t){var s=(e.is(t,"string")?JSON.parse(t):t).results;if(e.is(s))for(var n=0;n<s.length;n++){var a=s[n];i._dimensions[a.Name]=a;var o=a.MKSUnit;i._mksUnitName[a.Name]=o;var c=a.Units.filter(function(e){return e.Name===o});c.length>0&&(i._mksUnit[a]=c[0])}r.call()},n.onFailure=function(){a.log("FAILED to load Dimensions "),r.call()},s.authenticatedRequest(n.url,n)})}}},setResources:function(e){this.setOptions(e)},loadDictionary:function(t){return this._createDictionaryPromise(),e.is(t)&&this._dictionaryPromise.then(t),this._dictionaryPromise},getMKSNLSForDimension:function(t){var i=this._dimensions[t];if(e.is(i)){var r=i.MKSUnit,s=i.Units.filter(function(e){return e.Name===r});if(s.length>0)return s[0].NLSName}return""},getUnitNLSForDimension:function(t,i){var r=this._dimensions[t];if(e.is(r)){var s=r.Units.filter(function(e){return e.Name===i});if(s.length>0)return s[0].NLSName}return""},getMKSNLSLableNameForDimension:function(t){var i=this._dimensions[t];if(e.is(i)){var r=i.MKSUnit,s=i.Units.filter(function(e){return e.Name===r});if(s.length>0)return s[0].label}return""},getMKSNLSNameForDimension:function(t){var i=this._dimensions[t];if(e.is(i)){var r=i.MKSUnit,s=i.Units.filter(function(e){return e.Name===r});if(s.length>0)return s[0].Name}return""},loadConvertedMKSValues:function(t,i){var r=this.getOption("resources");if(!e.is(r))throw new Error("INVALID STATE: loadConvertedMKSValues is called before doing setResources");var n=r.getFetchOptions({service_name:"getConvertedMKSValues",service_data:t});n.onComplete=function(t){var r=e.is(t,"string")?JSON.parse(t):t;if(e.is(i,"function")){var s=r.Response;i(s)}},n.onFailure=function(e,t){a.log("Failure loaded the converted MKS values for : "+t),i([])},s.authenticatedRequest(n.url,n)},getMKSUnitNameForDimensionName:function(e){return this._mksUnitName[e]}})}),define("DS/SNInfraUX/SNSearchTypeCusto",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/PredicatesNLS"],function(e,t,i,r,s,n){"use strict";return t.singleton(i,r,{init:function(){var t=this,i=s.getOption("type_custo");if(i){var r=i.IncludedTypes;e.is(r)&&r.length>0&&(this._typeCusto={},r.forEach(function(e){t._typeCusto[e.typeURI]=e,t._typeCusto[e.typeURI].typeRef="Class"})),r=i.IncludedRelTypes,e.is(r)&&r.length>0&&(this._typeCustoInst={},r.forEach(function(e){t._typeCustoInst[e.typeURI]=e,t._typeCustoInst[e.typeURI].typeRef="Instance"}))}this._vocabularyElementNLSInfo=null},getSearchTypeCustoQuery:function(){if(this._globalSearchTypeCustoQuery)return this._globalSearchTypeCustoQuery;var e="";if(this._typeCusto)for(let t in this._typeCusto)if(this._typeCusto.hasOwnProperty(t)){let i,r=t.split(":");i=r.length>1?"ds6wg"===r[0]?'flattenedtaxonomies:"types/'+r[1]+'"':'type:"'+r[1]+'"':'flattenedtaxonomies:"types/'+r[0]+'"';let s=this._typeCusto[t].interfaceURIs;if(s&&s.length>0){let e="NOT listoffields:interface";for(let t=0;t<s.length;t++)e+=' OR flattenedtaxonomies:"interfaces/'+s[t]+'"';i="("+i+" AND ("+e+"))"}0===e.length?e=i:e+=" OR "+i}if(this._typeCustoInst)for(let t in this._typeCustoInst)if(this._typeCustoInst.hasOwnProperty(t)){let i,r=t.split(":");i=r.length>1?"ds6wg"===r[0]?'flattenedtaxonomies:"reltypes/'+r[1]+'"':'type:"'+r[1]+'"':'flattenedtaxonomies:"reltypes/'+r[0]+'"';let s=this._typeCustoInst[t].interfaceURIs;if(s&&s.length>0){let e="NOT listoffields:interface";for(let t=0;t<s.length;t++)e+=' OR flattenedtaxonomies:"interfaces/'+s[t]+'"';i="("+i+" AND ("+e+"))"}0===e.length?e=i:e+=" OR "+i}return e.length>0&&(this._globalSearchTypeCustoQuery=e),e},getTypeCusto:function(){var t=e.clone(this._typeCusto);if(e.is(this._typeCustoInst))for(var i in this._typeCustoInst)this._typeCustoInst.hasOwnProperty(i)&&(t[i]=this._typeCustoInst[i]);return t},getSearchTypeCustoList:function(t){var i=[];if(this._typeCusto)for(let e in this._typeCusto)if(this._typeCusto.hasOwnProperty(e)){let t=e.split(":");t.length>1?"ds6wg"===t[0]&&i.push(t[1]):i.push(t[0])}if(this._typeCustoInst&&e.is(t)&&!0===t)for(let e in this._typeCustoInst)if(this._typeCustoInst.hasOwnProperty(e)){let t=e.split(":");t.length>1?"ds6wg"===t[0]&&i.push(t[1]):i.push(t[0])}return i},getSearchTypeCustoListNLSNames:function(t){if(e.is(t)){var i=this;if(null===this._vocabularyElementNLSInfo){var r=[];if(this._typeCusto)for(let e in this._typeCusto)this._typeCusto.hasOwnProperty(e)&&r.push(e);if(this._typeCustoInst)for(let e in this._typeCustoInst)this._typeCustoInst.hasOwnProperty(e)&&r.push(e);n._asyncCallToPredicatesWS(r,{service_name:"ElementsNLSNames",method:"POST",forcetoresolve:!0}).then(function(r){var s=null;e.is(r)&&r.length>0&&(s=JSON.parse(r),e.is(s)&&e.is(s.vocabularyElementNLSInfo)&&e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&(i._vocabularyElementNLSInfo={},s.vocabularyElementNLSInfo.forEach(function(e){var t,r=e.uri.split(":");t=r.length>1?r[1]:r[0],i._vocabularyElementNLSInfo[t]=e}),t.onComplete.call(this,i._vocabularyElementNLSInfo)))},function(){e.is(t)&&e.is(t.onFailure)&&e.is(t.onFailure,"function")&&t.onFailure.call(this)})}else e.is(t)&&e.is(t.onComplete)&&e.is(t.onComplete,"function")&&t.onComplete.call(this,i._vocabularyElementNLSInfo)}}})}),define("DS/SNInfraUX/SearchVersioning",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/Logger"],function(e,t,i,r){"use strict";let s=new Set;return t.singleton(i,{_SUPPORTED_LEVELS:{R2023x:["FD01"],R2022x:["FD04","FD03","FD02","FD01","GA","BETA2","BETA1"],R2021x:["FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA","BETA2","BETA1"],R2020x:["FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA","BETA2","BETA1"],R2019x:["FD14","FD13","FD12","FD11","FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA","BETA3","BETA2","BETA1"],R2018x:["FD15","FD14","FD13","FD12","FD11","FD10","FD09","FD08","FD07","FD06","FD05","FD04","FD03","FD02","FD01","GA"],R2017x:["FD15","FD14","FD13","FD12","FD11","FD10","FD09"],R2016x:["FD16","FD15","FD14"]},init:function(){r.group("Info from SearchVersioning"),r.info("3DSearch code level:"+this.getCurrentVersion()),r.info("dsVersion:"+window.dsVersion),r.groupEnd()},isActiveWithCurrentVersion:function(t){e.is(t,"array")||(t=[t]);var i=this.getCurrentRelease(),r=[],s=0,n=t.length;for(s=0,n=t.length;s<n;s++)r.push(Object.keys(t[s])[0]);if(r.sort(),i>r[r.length-1])return!0;for(s=0,n=t.length;s<n;s++)if(this._SUPPORTED_LEVELS[i].indexOf(t[s][i])>-1)return!0;return!1},getCurrentBuildLevel:function(){return this._SUPPORTED_LEVELS[Object.keys(this._SUPPORTED_LEVELS)[0]][0]},getCurrentVersion:function(){var e=this._SUPPORTED_LEVELS[Object.keys(this._SUPPORTED_LEVELS)[0]];return Object.keys(this._SUPPORTED_LEVELS)[0]+e[0]},getCurrentRelease:function(){return Object.keys(this._SUPPORTED_LEVELS)[0]},addHFTracesInConsole:function(e){if(!s.has(e)){s.add(e),r.group("Info from SearchVersioning"),r.info("3DSearch code level:"+this.getCurrentVersion()),r.info("dsVersion:"+window.dsVersion),r.info("3DSearch HFs:");for(let e of s)r.info("  "+e);r.groupEnd()}}})}),define("DS/SNInfraUX/SearchControlCenterFetchService",["UWA/Core","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","text!DS/SNInfraUX/assets/SearchcontrolCenter_TagRelationship.json","DS/SNInfraUX/Logger","DS/SNInfraUX/PlatformEnvServices"],function(e,t,i,r,s,n,a){"use strict";var o={_searchControlCenterSettingsJSONFromDB:{},_tenantObjects:{},_tenantPromise:{},getTagRelationshipDefaultSettings:function(){let t={},i={},r=[],n=[],a=JSON.parse(s);if(e.is(a)&&a.hasOwnProperty("Predicates_Default_AND")&&e.is(a.Predicates_Default_AND,"array"))for(let t=0;t<a.Predicates_Default_AND.length;t++){let i={},s=a.Predicates_Default_AND[t];e.is(s)&&(i.uri=s,i.operator="AND",r.push(i))}if(e.is(a)&&a.hasOwnProperty("Predicates_Irrelevant_AND")&&e.is(a.Predicates_Irrelevant_AND,"array"))for(let t=0;t<a.Predicates_Irrelevant_AND.length;t++){let i={},s=a.Predicates_Irrelevant_AND[t];e.is(s)&&(n.push(s),i.uri=s,i.operator="OR",r.push(i))}return i.irrelevantANDPredicates=n,t.tagRelationship_IrrelevantOpert=i,t.tagRelationship_predicates=r,t.activate_tag_relationship=!0,t},getSearchSettings:function(i){var r=null,s=null;return e.is(i.tenantID)&&(r=i.tenantID),e.is(i.key)&&(s=i.key),this._tenantPromise[r]||(this._tenantPromise[r]=t.deferred(),this.loadSearchSettings(s,r)),this._tenantPromise[r].promise},transalateToSearchFormat:function(t){var i={},r=[],s=[],n=!1,a=localStorage.getItem("TagNavigator-simplifiedTagger");e.is(a)&&"true"===a&&(n=!0);var c=o._searchControlCenterSettingsJSONFromDB;if(e.is(t,"string"))e.is(c)&&"SCC_UI"===t&&(i=c);else if(e.is(c)&&!e.is(t)){if(Object.keys(c).length>0){var l,u,d,p,h,g,f,_,S,v,m,y=!1;if(c.hasOwnProperty("search_settings")&&(l=c.search_settings),c.hasOwnProperty("result_categories")&&(u=c.result_categories),c.hasOwnProperty("search_synonyms")&&(d=c.search_synonyms),c.hasOwnProperty("tagRelationships")&&(h=c.tagRelationships),c.hasOwnProperty("tagColorization")&&(p=c.tagColorization),c.hasOwnProperty("controlledVocabulary")&&(v=c.controlledVocabulary),c.hasOwnProperty("enterprise_ontology")&&(m=c.enterprise_ontology),c.hasOwnProperty("hierarchical_predicates")&&(S=c.hierarchical_predicates),c.hasOwnProperty("type_custo")&&(g=c.type_custo),c.hasOwnProperty("attribute_custo")&&(f=c.attribute_custo),c.hasOwnProperty("column_custo")&&(_=c.column_custo),e.is(l)&&e.is(g)){var D={},C={},I=[];if(g.hasOwnProperty("SEARCH_INSTANCES")){var b=g.SEARCH_INSTANCES;l.SEARCH_INSTANCES=b}if(g.hasOwnProperty("excluded_types")&&!0===g.type_display){for(var w=g.excluded_types,P=0;P<w.length;P++){let e=w[P].source,t=w[P].uri;C.hasOwnProperty(e)?(I=C[e]).push(t):(I.push(t),C[e]=I)}D.types=C}l.hasOwnProperty("simple_search_experience")&&delete l.simple_search_experience,l.topbar_search_banned_list=D,i.search_settings=l}var O={};if(e.is(g)&&e.is(f)){var A=!0;if(g.hasOwnProperty("default_datasourceandtype")){var N=g.default_datasourceandtype;N.length>0&&(O.default_datasource=N[0].source)}if(f.hasOwnProperty("ds6w:type")){var U={},T=f["ds6w:type"];if(e.is(T,"array"))for(var x=0;x<T.length;x++){let e={},t=T[x].source;if("AllDataSourcesandTypes"===t&&!0===f.attributes_display)f.hasOwnProperty("extend_to_widgets")&&(y=f.extend_to_widgets),A=!1,r=T[x].predicates,s=T[x].excluded_predicates;else if("AllDataSourcesandTypes"!==t&&!0===g.type_display)if(e.uri=T[x].uri,e.predicates=T[x].predicates,e.excluded_predicates=T[x].excluded_predicates,U.hasOwnProperty(t)){U[t].push(e)}else{var E=[];E.push(e),U[t]=E}}O["ds6w:type"]=U}if(f.hasOwnProperty("ds6w:type")&&!0!==A||(n&&r.push({uri:"computedCountryInfo"}),r.push({uri:"ds6w:dataSource"}),r.push({uri:"ds6w:type"}),n||r.push({uri:"ds6w:category"}),r.push({uri:"ds6w:modified"}),n&&r.push({uri:"ds6w:created"}),r.push({uri:"ds6w:lastModifiedBy"}),r.push({uri:"ds6w:responsible"})),g.hasOwnProperty("easyTypeAccess")&&!0===g.type_display)for(var F=g.easyTypeAccess,R=0;R<F.length;R++){var L=F[R],j=L.source;let t=L.uri;if(O.hasOwnProperty("ds6w:type")){var W=O["ds6w:type"];if(e.is(W)&&W.hasOwnProperty(j)){var M=W[j];if(e.is(M,"array")){for(var V=-1,X=0;X<M.length;X++){let e=M[X];t===e.uri&&(e.easyTypeAcess=!0,V=X)}if(-1===V){var k={};k.uri=t,k.easyTypeAcess=!0,M.push(k)}else M.push(M.splice(V,1)[0])}}else{var q={},B=[];q.uri=t,q.easyTypeAcess=!0,B.push(q),W[j]=B}}else{var J={},Q={},H=[];Q.uri=t,Q.easyTypeAcess=!0,H.push(Q),J[j]=H,O["ds6w:type"]=J}}}e.is(O)&&i.hasOwnProperty("search_settings")&&(i.search_settings.advanced_search=O),e.is(u)&&i.hasOwnProperty("search_settings")&&(i.search_settings.result_categories=u),e.is(d)&&i.hasOwnProperty("search_settings")&&(i.search_settings.search_synonyms=d),e.is(p)&&i.hasOwnProperty("search_settings")&&(i.search_settings.tagColorization=p),e.is(v)&&i.hasOwnProperty("search_settings")&&(i.search_settings.controlledVocabulary=v),e.is(m)&&i.hasOwnProperty("search_settings")&&(i.search_settings.enterprise_ontology=m),e.is(h)&&i.hasOwnProperty("search_settings")&&(i.search_settings.tagRelationships=h),e.is(S)&&i.hasOwnProperty("search_settings")&&(i.search_settings.hierarchical_predicates=S),e.is(_)&&i.hasOwnProperty("search_settings")&&(i.search_settings.column_custo=_)}}if(e.is(r,"array")||e.is(s,"array")){var G={extendToApplicablewidgets:y};if(e.is(r,"array"))for(var z=0;z<r.length;z++){var K=!1;"ds6w:type"!==r[z].uri&&"ds6w:dataSource"!==r[z].uri&&"ds6w:project"!==r[z].uri&&"ds6w:community"!==r[z].uri&&"computedCountryInfo"!==r[z].uri||(K=!0);var Y={relevant:!0,expanded:K,weight:100-z};G[r[z].uri]=Y}if(n||(G["ds6w:who"]={relevant:!0,expanded:!0,weight:7},G["ds6w:when"]={relevant:!0,expanded:!0,weight:6},G["ds6w:what"]={relevant:!0,expanded:!0,weight:5},G["ds6w:where"]={relevant:!0,expanded:!0,weight:4},G["ds6w:why"]={relevant:!0,expanded:!0,weight:3},G["ds6w:how"]={relevant:!0,expanded:!0,weight:2}),e.is(s,"array"))for(var $=0;$<s.length;$++){G[s[$].uri]={relevant:!0,expanded:!1,weight:-1}}i.relevant_tags=G}return e.is(f)&&f.hasOwnProperty("context_apps_predicates")&&(i.context_apps_predicates=f.context_apps_predicates),i},setResourceMgt:function(t){e.is(t,"object")&&t.hasOwnProperty("available_tenants")&&(o._tenantObjects=t.available_tenants)},get3DSpaceURL:function(e){return a.getServiceURL("cstorage",e)},loadSearchSettings:function(t,s){var a=t;r.getServiceUrl({serviceName:"3DSpace",platformId:s,onComplete:function(t){if(e.is(t,"string")){o.getURL=t+"/resources/SNAPI/infra_services/searchsettings?tenant="+s;let r={timeout:5e4,method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){var i=e.is(t,"string")?JSON.parse(t):t;require(["DS/SNInfraUX/SearchSettings"],function(e){(e.getOption("ODTLogs")||e.getOption("ODTLogs-SCCSettings"))&&n.warn("ODTLogs-SCCSettings:"+JSON.stringify(i))}),o._searchControlCenterSettingsJSONFromDB=i;var r=o.transalateToSearchFormat(a);e.is(r)&&o._tenantPromise[s].resolve(r)},onFailure:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)},onTimeout:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)}};i.authenticatedRequest(o.getURL,r)}else if(e.is(a))n.log("getServiceUrl was success, but URL is empty, ISSUE !!"),o._tenantPromise[s].reject();else{let t=o.get3DSpaceURL(s);if(e.is(t)){o.getURL=t+"/resources/SNAPI/infra_services/searchsettings?tenant="+s;let r={timeout:5e4,method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){var i=e.is(t,"string")?JSON.parse(t):t;o._searchControlCenterSettingsJSONFromDB=i;var r=o.transalateToSearchFormat(a);e.is(r)&&o._tenantPromise[s].resolve(r)},onFailure:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)},onTimeout:function(e){n.log("Response from server :: "+e),o._tenantPromise[s].reject(e)}};i.authenticatedRequest(o.getURL,r)}else n.log("getServiceUrl - By-pass URL is empty, ISSUE !!"),o._tenantPromise[s].reject()}},onFailure:function(t){if(e.is(a))n.error("URL building fails inside SearchControlCenterFetchService!!"),o._tenantPromise[s].reject(t);else{let r=o.get3DSpaceURL(s);if(e.is(r)){o.getURL=r+"/resources/SNAPI/infra_services/searchsettings?tenant="+s;let c={timeout:5e4,method:"GET",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"},onComplete:function(t){var i=e.is(t,"string")?JSON.parse(t):t;o._searchControlCenterSettingsJSONFromDB=i;var r=o.transalateToSearchFormat(a);e.is(r)&&o._tenantPromise[s].resolve(r)},onFailure:function(e){n.error("Error Response from server :: "+e),o._tenantPromise[s].reject(t)},onTimeout:function(e){n.error("Time Out Response from server :: "+e),o._tenantPromise[s].reject(t)}};i.authenticatedRequest(o.getURL,c)}else n.error("URL building fails inside SearchControlCenterFetchService also By-pass URL is empty, ISSUE !!"),o._tenantPromise[s].reject()}}})}};return o}),define("DS/SNInfraUX/SearchPreviewContainer",["UWA/Core","UWA/Class/Model","DS/MessageBus/MessageBus","DS/SNInfraUX/Logger"],function(e,t,i,r){"use strict";return t.extend({init:function(){},getPrimaryContent:function(t){e.is(t)&&e.is(t.searchmodel)&&e.is(t.onFailure,"function")&&t.onFailure.call()},getSecondaryContent:function(t){e.is(t)&&e.is(t.searchmodel)&&e.is(t.onFailure,"function")&&t.onFailure.call()},Open:function(t){if(!(e.is(t)&&e.is(t.searchmodel)&&e.is(t.widget_id)&&e.is(this.getAppIdForOpen,"function")))return;i.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"Preview",action:"openFromPreview"}});let s={searchmodel:t.searchmodel,widget_id:t.widget_id,onComplete:function(i){let s,n=void 0;e.is(i,"string")||e.is(i,"object")&&e.is(i.appId,"string")||r.error("Bad response from getAppIdForOpen:",i),e.is(i,"string")?s=i:e.is(i,"object")&&(s=i.appId,n=!e.is(i.closePreview,"boolean")||i.closePreview);require(["DS/i3DXCompassServices/i3DXCompassPubSub"],function(i){i.publish("launchApp",{appId:s}),e.is(t.cb,"function")&&t.cb(n)})},onFailure:function(){r.log("Open not available for this object type")}};this.getAppIdForOpen(s)},dispose:function(){},_applyHTMLHighlight:function(e,t,i){let r,s,n,a,o,c=e.childNodes;if(e.nodeType===e.TEXT_NODE)return s=RegExp(t,"gi"),a=e.textContent.replace(s,'<span class="'+i+'">'+t+"</span>"),void(e.textContent!==a&&((o=document.createElement("span")).innerHTML=a,o.className="filtered-node",e.parentNode.replaceChild(o,e)));for(r=0;r<c.length;r++)(n=c[r]).textContent&&!n.textContent.trim()||this._applyHTMLHighlight(n,t,i)}})}),define("DS/SNInfraUX/ServiceDelegationLoader",["UWA/Core","UWA/Class","UWA/Promise","DS/WAFData/WAFData","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchLogin","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,i,r,s,n,a,o){"use strict";return t.singleton({_loaderPromises:{},_cacheServiceDelegation:{},_discoverPromises:{},_cacheDiscovery:{},load:function(t){var r=this;if(e.is(t,"object")&&e.is(t.serviceID,"string")){var a=this._loaderPromises[t.serviceID];return a||(a=new i(function(i,a){r._cacheServiceDelegation[t.serviceID]=null;var o,c,l=(e.is(t.servicesData)?t.servicesData:n.getOption("servicesData"))[t.serviceID];e.is(l,"object")?(o=l.module,c=l.relativePath):e.is(l,"string")&&(o=l,c="/webapps"),e.is(o,"string")?require([o],function(e){r._cacheServiceDelegation[t.serviceID]=e,i(r._cacheServiceDelegation[t.serviceID])},function(e){s.warn("Cannot load service delegation"+e.requireModules),r.loadModuleFromService(o,{serviceID:t.serviceID,platformID:t.platformID,relativePath:c}).then(function(e){r._cacheServiceDelegation[t.serviceID]=e,i(r._cacheServiceDelegation[t.serviceID])},function(e){a(e)})}):a("Service delegation not registered for "+t.serviceID)}),this._loaderPromises[t.serviceID]=a),a}},loadServiceDelegations:function(e){var t=this,r=[];return e.services.forEach(function(i){var s=t.load({serviceID:i,platformID:e.platform});r.push(s)}),i.allSettled(r)},getDelegation:function(e){return this._cacheServiceDelegation[e.serviceID]},discover:function(t){if(e.is(t,"object")&&e.is(t.platformID,"string")&&e.is(t.sourceID)){var n=this,o=a.getDiscoveryURL(t.platformID,t.sourceID);this._discoverPromises[t.platformID]||(this._discoverPromises[t.platformID]={},this._cacheDiscovery[t.platformID]={});var c=this._discoverPromises[t.platformID][t.sourceID];return c||(c=new i(function(i,a){n._cacheDiscovery[t.platformID][t.sourceID]=null;var c={method:"GET",headers:{Accept:"application/json"}};c.data={tenant:t.platformID},c.url=o,c.onComplete=function(r){s.log("discovery call succcessful for "+t.sourceID+" for tenant : "+t.platformID);var o=e.is(r,"string")?r.length>0?JSON.parse(r):{}:r;e.is(o,"object")?(n._cacheDiscovery[t.platformID][t.sourceID]=o,i(n._cacheDiscovery[t.platformID][t.sourceID])):(s.error("discovery WS response is not in expected format"),a())},c.onFailure=function(e,i){s.log("discovery call FAILED for "+t.sourceID+" for tenant : "+t.platformID,e,i),a(new Error("discovery call FAILED"))},r.authenticatedRequest(c.url,c)}),this._discoverPromises[t.platformID][t.sourceID]=c),c}},getRealtivePath:function(t){var i=n.getOption("servicesData")[t.serviceID];return e.is(i,"object")?i.relativePath:e.is(i,"string")?"/webapps":void 0},loadModuleFromService:function(t,r){let n=this;return new i(function(i,a){requirejs.undef(t);let c=e.is(r.relativePath)?r.relativePath:n.getRealtivePath({serviceID:r.serviceID});var l=t.split("/");if(e.is(l,"array")&&l.length>2){var u=function(e){var r=l[0]+"/"+l[1],n=e+c;n+="/"+l[1];var o={};o[r]=n,require.config({paths:o}),require([t],function(e){i(e)},function(e){s.warn("Cannot load service delegation "+e.requireModules),a("Failed to load module. Error:"+e.requireModules)})};e.is(r.serviceURL,"string")?u(r.serviceURL):o.getServiceUrl({serviceName:r.serviceID,platformId:r.platformID,onComplete:function(e){u(e)},onFailure:function(){a("Failed to get the service URL for given service with serviceID : "+r.serviceID)}})}else a("AMD module name is not in a good format:"+serviceDelegationModule)})}})}),define("DS/SNInfraUX/PredefinedQueries",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n,a){"use strict";return t.singleton(i,r,{_PQDictionary:{},_pqFetchPC:n.deferred(),_PQs:null,_PQNLS:null,init:function(){},setResources:function(e){this.setOptions({resources:e})},fetchPQsFromServer:function(t){t&&this.setResources(t);var i=this;if(!i._pqFetchInitiated){let t=this.getOption("resources");if(!e.is(t))return a.error("INVALID STATE: getPQs is called before doing setResources on PredefinedQueries"),null;var r=t.get3DSpaceUrl();if(e.is(r,"string")&&r.length>0){var n=t.getFetchOptions({service_name:"loadPQData"});n.onComplete=function(t){var r;i._pqFetchInitiated=!0;var s=(r=e.is(t,"string")?JSON.parse(t):t).pqlist;if(e.is(r.custom)){for(var n=r.custom,a=0,o=n.PQ.length;a<o;a++){n.PQ[a].custom=!0}i.mergeRecursive(s,r.custom)}e.is(s)&&(i._PQs=s,i.loadPQDictionary(s));var c=r.nls;e.is(r.customnls)&&i.mergeRecursive(c,r.customnls),i._PQNLS=r.nls,i._pqFetchPC.resolve()},n.onFailure=function(){a.log("FAILED to load PQ data "),i._pqFetchPC.resolve()},e.is(n.url)?s.authenticatedRequest(n.url,n):(a.warn("3DSpace URL not found, PQs are not fetched.."),i._pqFetchPC.resolve())}else a.warn("3DSpace URL not found, PQs are not fetched.."),i._pqFetchPC.resolve()}return this._pqFetchPC.promise},mergeRecursive:function(t,i){for(var r in i)i.hasOwnProperty(r)&&(e.is(t[r],"array")?t[r]=t[r].concat(i[r]):e.is(t[r],"object")&&e.is(i[r],"object")?this.mergeRecursive(t[r],i[r]):t[r]||(t[r]=i[r]))},getPQFetchPromise:function(){return this._pqFetchPC.promise},loadPQDictionary:function(t){var i=void 0;if(e.is(t))for(var r=0;r<t.PQ.length;r++){var s=t.PQ[r].abbreviations;if(e.is(s))for(var n=s.split(","),a=0;a<n.length;a++){var o=n[a],c=o.toLowerCase();e.is(t.PQ[r].sort_order)&&1===(i=t.PQ[r].sort_order).length&&(i=i[0]);var l={pqPrefix:o,value:t.PQ[r].value,pqName:n[n.length-1],pqid:t.PQ[r].pqid,appData:t.PQ[r].appData,sort_order:i};this._PQDictionary[c]=l}}},isAPQAbbrevation:function(e){var t=e.toString().toLowerCase();return"type"!==t&&t in this._PQDictionary},isAPQSearch:function(t){var i=null;if(e.is(t)){var r=t.match(/[\s\b]*\w+:/g);if(e.is(r))for(var s=0;s<r.length;s++){var n=r[s].match(/\w+/g);if(this.isAPQAbbrevation(n)){i=n;break}}}return i},isAPrefixedPQSearch:function(t){if(e.is(t)&&/^3dexp/.test(t))return t=t.substring(5),this.isAPQSearch(t)},getSortOrder:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t].sort_order},getPQPrefix:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t].pqPrefix},getPQName:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t].pqName},getPQs:function(){return this._PQs},getPQNLS:function(){return this._PQNLS},getPQObjFromPQPrefix:function(e){var t=e.toString().toLowerCase();return this._PQDictionary[t]}})}),define("DS/SNInfraUX/SearchUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Data","UWA/Element","UWA/Utils/Client","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/ServiceDelegationLoader","DS/WAFData/WAFData","UWA/Promise","DS/SNInfraUX/PredefinedQueries","DS/SNInfraUX/SearchVersioning","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","text!DS/SNInfraUX/assets/SearchColumnCustoAdmin.json","DS/SNInfraUX/Logger","text!DS/SNInfraUX/assets/SourceToPredicateMapping.json","DS/SNInfraUX/tracker/SearchTrackerApi","DS/SNInfraUX/SearchLogin"],function(e,t,i,r,s,n,a,o,c,l,u,d,p,h,g,f,_,S,v){"use strict";var m=t.singleton(i,{_sessionUserId:null,_helper_collections:{},_searchViewPromise:null,_searchReadyPromise:null,_autocompletePromise:null,_securityContextPromise:null,_securityContext3DSpacePromise:null,_activeDataSourcePromise:null,_powerByInitPromise:null,_active_dataSource:[],_chosen_dataSource:[],_customerConfigPromise:null,trackerData:{timeData:[],searchData:[],search:{selectItem:!1,previewItem:!1,openItem:!1,indexItem:null,scenario:null,firstSearch:!0}},SEARCH_APP_ID:"X3DSEAR_AP",TRANSIENT_WIDGET_HELPER_ID:"transient_helper_collection",TAGGERPROXY_CONTEXTID_WEB_IN_WIN:"Universal_SearchCtx",_mappingURIPredicate:{},SearchTypeEnum:{ADVANCED_SEARCH:"#advancedSearch",MY_CONTENT:"#myContent",MY_RECENT_CONTENT:"#myRecentContent",SIMILAR_SEARCH:"#similarity",SEARCH_IN:"#searchIn",SEARCH:"#search",FAVORITE_SEARCH:"#favoriteSearches"},widgetLaunchMode:{TOPBAR_SEARCH:"from_topbar_search",COMPASS_PINNED:"from_compass_pinned",COMPASS_TRANSIENT:"from_compass_transient",PINNED:"pinned_widget",INCONTEXT_TRANSIENT:"in_context_transient"},HelperCollectionStatus:{SEARCH_IN_PROGRESS:"search_in_progress",SEARCH_SUCCEEDED:"search_succeeded",SEARCH_FAILED:"search_failed"},_securityContext:null,_securityContext3DSpace:null,_activeDataSource:null,_serverUrl:null,_searchtype:null,_mappingServices:{"3DPassport":"3DPassport","3dpassport":"3DPassport","3DCompass":"3DCompass","3dcompass":"3DCompass","3DSwym":"3DSwym",swym:"3DSwym","3DSpace":"3DSpace",space:"3DSpace",cstorage:"3DSpace","3DSearch":"3DSearch","3dsearch":"3DSearch",search:"3DSearch","3DMessaging":"3DMessaging","3DComputeOrchestration":"3DComputeOrchestration",hpc:"3DComputeOrchestration","3DDesign":"3DDesign","6WTags":"6WTags",tagger:"6WTags"},_platforms:{},_taggerOpenedByCode:!1,_adminCusto:null,_isInTheSimpleSearchMode:void 0,_isInTheSimpleSearchModePromise:null,_isInTheSimpleSearchModePromiseStatus:null,_sourceToPredicateMapping:null,_isDataSourceHasChanged:!1,init:function(){this.sessionUserId="",Object.freeze(this.SearchTypeEnum),this._searchViewPromise=u.deferred(),this._searchReadyPromise=u.deferred(),this._autocompletePromise=u.deferred(),this.getGrantedRoles(function(){}),this._securityContextPromise=u.deferred(),this._securityContext3DSpacePromise=u.deferred(),this._activeDataSourcePromise=u.deferred(),this._powerByInitPromise=u.deferred(),this._sourceToPredicateMapping=JSON.parse(_),S.set()},setUserId:function(e){this._sessionUserId=e,this.setUserSpecificSettings()},getUserId:function(){return this._sessionUserId},setserverUrl:function(e){this._serverUrl=e},getserverUrl:function(){return this._serverUrl},setAutocompleteRendered:function(){this._autocompletePromise.resolve()},autocompleteRendered:function(){return this._autocompletePromise.promise},setSearchViewRendered:function(){this._searchViewPromise.resolve()},getSearchViewPromise:function(){return this._searchViewPromise.promise},onSearchReady:function(){return this._searchReadyPromise.promise},setSearchReady:function(){this._searchReadyPromise.resolve()},setPowerByInitDone:function(){this._powerByInitPromise.resolve()},getPowerByInitPromise:function(){return this._powerByInitPromise.promise},setsearchType:function(e){this._searchtype=e},getsearchType:function(){return null===this._searchtype&&(this._searchtype="#searchIn"),this._searchtype},getWidth:function(){return Math.max(document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)},getHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},result:function(t,i){var r;return t?(r=t[i],"function"===e.typeOf(r)?r.call(t):r):null},replace:function(e,t){return e.replace(/\{([\w\-]+)\}/g,function(e,i){return void 0!==t[i]?t[i]:""})},getTaggerService:function(t){var i="",r=t.getSourceID(),s=r||"3dspace",n=t.getPlatformID();if(e.is(r,"string")){var a=v.getServiceFromSource(r),o=c.getDelegation({serviceID:a});i=o&&e.is(o.getTaggerService,"function")?o.getTaggerService({id:t.get("id"),source:s,platform:n}):r.indexOf("3dspace")>=0?"3DSpace":"6WTagger"}return i},getAvailableHeight:function(){var t=450,i=e.extendElement(document.body).getElement(".app-content>.module>.front");if(i){var r=i.getScrolls().height;r>t&&(t=r-110)}else a.getOption("search_web_in_win")&&document.body.parentElement.clientHeight>70&&(t=document.body.parentElement.clientHeight-70);return t+"px"},getLanguage:function(){var t;window&&window.dsLang?"devsymbol"===(t=window.dsLang)&&(t="en"):t=(window&&window.clntlang?window.clntlang:navigator&&navigator.languages&&e.is(navigator.languages,"array")&&navigator.languages.length>0?navigator.languages[0]:navigator?navigator.language||navigator.systemLanguage:DEFAULT_LANG).toLowerCase().split("-")[0];return t},getRegion:function(){return o.getItem("search_date_region")},getAdminSetting:function(t){var i={};return e.is(a)&&e.is(a._tenantSettings)&&e.is(a._tenantSettings[t])&&e.is(a._tenantSettings[t].search_settings)&&(i=a._tenantSettings[t].search_settings),i},dateToDisplay:function(t,i,r){let s,n,a;return e.is(r.date)||e.is(i.date)?(e.is(r)&&""!==r?(s=t.toLocaleString(i.date,r.date),n=t.toLocaleString(i.time,r.time)):(s=t.toLocaleString(i.date),n=t.toLocaleString(i.time)),a=s+" "+n):a=t.toLocaleString(i,r),a},getDeviceCategory:function(){let e=/iPhone/.test(navigator.userAgent)&&!window.MSStream,t=n.Platform.ipad,i="android"===n.Platform.name;return e?"iphone":(t?"ipad":"")||(i?"android":"")},setHelperCollection:function(t,i){e.is(t,"string")&&t.length>0&&(this.deleteHelperCollection(t),this._helper_collections[t]=i)},getHelperCollection:function(t){if(e.is(t))return this._helper_collections[t]},deleteHelperCollection:function(t){var i=this._helper_collections[t];e.is(i)&&(i.destroy(),i=null,delete this._helper_collections[t],f.info("removed helper collection for widget id = "+t))},replacePQsWithCVPrefixes:function(t){if(e.is(t)){for(var i="",r=0,s=/[\s\b]*(\w+):/g;;){var n=s.exec(t);if(!n)break;var a=n[1];if(d.isAPQAbbrevation(a)){var o=t.substring(r,n.index);o.length>0&&(o+=" "),i=i+o+"3dexp"+d.getPQPrefix(a),i+=":",r=s.lastIndex}}return i=(i+=t.substring(r)).replace(/3dexp(\w+):[*]+(?=($| |\)))/g,"3dexp$1:#all")}return t},executeWithPQ:function(e){if(e.wait&&e.wait()){var t=this;d.getPQFetchPromise().then(function(){t.executeWithPQ=function(e){e.run.call()},t.executeWithPQ(e)})}else e.run.call()},getPlatformServices:function(){return h},getGrantedRoles:function(t){var i=this;a.getOption("search_web_in_win")?t([]):e.is(this._grantedRoles)?t(i._grantedRoles):e.is(h.getGrantedRoles,"function")&&h.getGrantedRoles(function(r){if(e.is(r,"array")&&r.length){i._grantedRoles=r;var s=a.getOption("role");if(e.is(window.dsUserLogin,"string")&&"uxodtitp"===window.dsUserLogin&&e.is(s,"string")&&0<s.length){var n=!1;r.some(function(e){e.id===s&&(n=!0)}),!1===n&&i._grantedRoles.push({id:s,name:"Dummy role from ODT",platforms:[]})}t(i._grantedRoles)}else t([])})},isRoleAvailable:function(t,i,r){this.getGrantedRoles(function(s){var n=!0;if(e.is(t,"array")&&t.length>0&&e.is(s,"array")&&0<s.length){n=!1;var a=0,o=t.length;for(a=0;a<o;a++)s.some(function(r){return"InternalDS"===r.id||(r.id===t[a]&&e.is(r.platforms)?r.platforms.some(function(t){return!(e.is(i)&&i.length>0)||t===i}):void 0)})&&(n=!0)}r(n)})},getZIndex:function(t,i){try{var r=0;if(e.is(i)&&(r=i),e.is(t,"element")){var s=window.getComputedStyle(t).getPropertyValue("z-index");return isNaN(s)||(s=parseInt(s))>r&&(r=s),this.getZIndex(t.parentElement,r)}return r}catch(t){return f.error("Exception caught in getZIndex ! :"+t),e.is(i)?i:1049}},getURIToUse:function(t){var i=t;return e.is(t)&&!e.is(this._mappingURIPredicate[t])&&(this._mappingURIPredicate[t]=t.slice(t.lastIndexOf("/")+1,t.length)),e.is(this._mappingURIPredicate[t])&&(i=this._mappingURIPredicate[t]),i},getServicesToUse:function(t){return e.is(this._mappingServices[t])?this._mappingServices[t]:t},getServiceUrl:function(t,i){var r=this._platforms[i],s=null,n=this.getServicesToUse(t);return e.is(r,"object")&&e.is(r.services,"object")&&e.is(n,"string")&&e.is(r.services[n],"object")&&(s=r.services[n].url),s},setPlatforms:function(t){this._platforms={};var i=0,r=0;if(e.is(t,"array"))for(r=t.length,i=0;i<r;i++)if(e.is(t[i],"object")){var s=t[i];if(e.is(s.id,"string")&&s.id.length>0){var n={};n.name=s.name,n.services={};var a=s.services,o=0,c=0;if(e.is(a,"array"))for(c=a.length,o=0;o<c;o++)n.services[this.getServicesToUse(a[o].id)]={url:a[o].url};this._platforms[s.id]=n}}},getTaggerSubjectURI:function(t){var i={};if(e.is(t,"object")&&e.is(t.subjects,"array")){var r=c.getDelegation({serviceID:t.service});if(r&&e.is(r.getSubjectURI,"function"))i=r.getSubjectURI({subjects:t.subjects});else{var s="pid://";e.is(t.source,"string")&&t.source.indexOf("drive")>=0&&(s="driveid:"),t.subjects.length>0&&t.subjects[0].id&&-1===t.subjects[0].id.indexOf(":")?t.subjects.forEach(function(e){i[e.id]=s+e.id}):t.subjects.forEach(function(e){i[e.id]=e.id})}}return i||{}},setSecurityContext:function(e){this._securityContext=e},setSecurityContext3DSpace:function(e){this._securityContext3DSpace=e},getSecurityContext:function(){return this._securityContext},getSecurityContext3DSpace:function(){return this._securityContext3DSpace},stripHtml:function(e){var t=document.createElement("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},escapeHtml:function(t){if(!e.is(t,"string")||!e.is(t.replace,"function"))return f.warn("Trying to escapeHtml of a non string : ",t," !"),t;var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(e){return i[e]})},decodeHtml:function(t){if(!e.is(t,"string")||!e.is(t.replace,"function"))return f.warn("Trying to decodeHtml of a non string : ",t," !"),t;var i={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#039;":"'"};return t.replace(/&amp;|&lt;|&gt;|&quot;|&#039;/g,function(e){return i[e]})},constructEmptyViewMsg:function(e){var t=e.split("\n");return t[0]+'<br><br><div style="text-align:left">'+t[1]+'<br><ul style="font-size: 0.8em"><li>'+t[2]+"</li><li>"+t[3]+"</li><li>"+t[4]+"</li><li>"+t[5]+"</li></ul></div>"},initSecurityContext:function(t){var i=this,r=i.getSecurityContext();if(r&&r.trim().length>0)i._securityContextPromise.resolve();else{var s={method:"GET"};s.headers={"Accept-Language":m.getLanguage(),Accept:"application/json"},e.is(t.get3DSpaceUrl,"function")?(s.url=t.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext",s.data={tenant:t.getActiveTenant()}):(s.url=t.url+"/resources/pno/person/getsecuritycontext",s.data={tenant:t.tenant}),s.onComplete=function(e){var t=JSON.parse(e);i.setSecurityContext(t.SecurityContext),i._securityContextPromise.resolve()},s.onFailure=function(e){f.warn("Failed to get security context: "+e),i._securityContextPromise.resolve()},l.authenticatedRequest(s.url,s)}},getSecurityContextPromise:function(){return this._securityContextPromise.promise},initSecurityContext3DSpace:function(e){var t=this;t.getSecurityContext3DSpace();if(e.active_tenant===this.active_tenant)t._securityContext3DSpacePromise.resolve();else{this.active_tenant=e.getActiveTenant();var i=e.get3DSpaceUrl()+"/resources/bps/cspaces?tenant="+e.getActiveTenant(),r={type:"json",method:"GET",proxy:"passport"};r.headers={"Content-Type":"application/ds-json","Accept-Language":m.getLanguage()},r.timeout=6e5,r.that=t,r.onComplete=function(e){var i=e.cspaces,r=[];i&&0!==i.length||(i=[]);var s="",n=!0;i.forEach(function(e){var t=e.displayName.split(".");if(3===t.length&&n){var i=t[1];""===s&&(s=i),n=s===i}}),i.forEach(function(e){var t=e.displayName,i=e.displayName.split(".");3===i.length&&(t=i[2]+"  ",n||(t+=i[1]+"  "),t+=i[0]),r.push({label:t,value:e.name})}),t.setSecurityContext3DSpace(i),t._securityContext3DSpacePromise.resolve()},r.onFailure=function(e){f.log("getSecurityContext3DSpace:Failure..."+e)},r.ontimeout=function(){f.log("getSecurityContext3DSpace: A connection timeout occured.")},l.authenticatedRequest(i,r)}},getSecurityContext3DSpacePromise:function(){return this._securityContext3DSpacePromise.promise},setActiveDataSource:function(e){f.log("SearchUtils.setActiveDataSource",e),this._active_dataSource=e},getActiveDataSource:function(){return f.log("SearchUtils.getActiveDataSource",this._active_dataSource),this._active_dataSource},getActiveTenant:function(){return f.log("SearchUtils.getActiveTenant",this.active_tenant),this.active_tenant},setChosenDataSource:function(e){f.log("SearchUtils.setChosenDataSource",e),e.length>0&&(this._chosen_dataSource=e)},getChosenDataSource:function(){return f.log("SearchUtils.getChosenDataSource",this._chosen_dataSource),this._chosen_dataSource},addChosenDataSource:function(e){f.log("SearchUtils.addChosenDataSource",e),-1===this._chosen_dataSource.indexOf(e)&&(this._chosen_dataSource.push(e),this._isDataSourceHasChanged=!0)},suppressChosenDataSource:function(e){f.log("SearchUtils.suppressChosenDataSource",this._chosen_dataSource),0===this._chosen_dataSource.length&&(this._chosen_dataSource=m.getActiveDataSource());for(var t=0;t<this._chosen_dataSource.length;)this._chosen_dataSource[t]===e?(this._chosen_dataSource.splice(t,1),this._isDataSourceHasChanged=!0):++t},chosenDataSourceHasChanged:function(t){e.is(t.onComplete,"function")&&(this._chosenDataSourceHasChanged=t.onComplete)},resetDataSourceHasChanged:function(){this._isDataSourceHasChanged=!1},dataSourceChangeCompleted:function(){!0===this._isDataSourceHasChanged&&e.is(this._chosenDataSourceHasChanged,"function")&&this._chosenDataSourceHasChanged.call(this._chosen_dataSource)},setActiveDataSourcePromise:function(){return this._activeDataSourcePromise.resolve()},getActiveDataSourcePromise:function(){return this._activeDataSourcePromise.promise},isODTMode:function(){return a.isODTMode()},isFUNActive:function(t){if(!e.is(t,"string"))throw new Error("Invalid arg in SearchUtils.isFUNActive !");return!1!==a.getOption(t)},identifyClientInfo:function(t){var i="3DDashboard";e.is(document.getElementById("searchContainer"))||e.is(document.getElementById("targeted-search"))||e.is(document.getElementById("panelToggle"))?i="3DSpace":window.ds&&"3DSwym"===window.ds.env?i="3DSwym":a.getOption("search_web_in_win")&&(i="3DEXPERIENCE");var r={identifier:i};return e.is(t,"string")&&t.length>0&&(r.addinmode=t),r},_isSearchWidgetTransientAvailable:function(t){var i=!1;return e.Widgets&&e.Widgets.instances.filter(function(r){e.is(r)&&e.is(r.getView,"function")&&"maximized"===r.getView().type&&e.is(r.data)&&e.is(r.data.appId)&&"X3DSEAR_AP"===r.data.appId&&(i=!0,r.id===t&&(i=!1))}),i},instantiateAppInSearch:function(t,i,s,n){var a=this.createContent(t);this.setContentVisibility(t);var o=require,c=o("UWA/Class/Promise"),l=o("DS/i3DXCompass/i3DXCompass"),u=null,d=null;return new c(function(){var t,p;(t=["DS/UWPClientCode/WidgetFactory","DS/TopFrame/Environment"],p=[],e.is(t,"string")?p[0]=t:p=t,new c(function(e,t){require(p,function(){e(Array.prototype.slice.call(arguments))},function(e){t(new Error("Error loading modules."+(e&&e.requireModules?e:"")))})})).then(function(t){u=t[0],d=t[1],e.is(u)&&e.is(d)&&function(e){return new c(function(t,i){l?l.getAppInfo({appId:e,onComplete:function(e){e?t(e):i(new Error("Could not locate app information."))},onFailure:i}):i(new Error("No compass"))})}(i).then(function(t){return function(t,i,s,n){return new c(function(a){var c,l="",p=s;if(e.is(p,"object")&&(p=JSON.stringify(s)),e.is(t.config)&&t.config.length>0)l=t.config,r.request(l,{method:"GET",type:"json",cache:3600,onComplete:function(r){if(e.merge(s,r),p=JSON.stringify(s),c={el:i,title:"",parent:!1,preview:!0,appId:t.id,data:p||{},header:!0,config:l},!t||!(t.checksum&&t.launchInfos||t.platforms&&t.platforms[0]&&t.platforms[0].checksum&&t.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+c.appId);c=UWA.extend(c,{widgetId:e.is(t.launchInfos)?t.launchInfos:t.platforms[0].launchInfos,isolationLevel:e.is(t.isolationLevel)?t.isolationLevel:t.platforms[0].isolationLevel,token:e.is(t.checksum)?t.checksum:t.platforms[0].checksum}),u.load(c,function(){if(c.widget&&c.widget.environment){if(c.widget.setValue("X3DContentId",c.data),e.is(n)&&e.is(n.historyNode)&&e.is(n.historyNode._options)){n.historyNode._options.contextid="RightPanelContext",c.widget.context="RightPanelContext";let t=require("DS/TagNavigator/TagNavigator").get6WTagger(c.widget.context);t&&(t.setAsCurrent(),t.focusOnCC(n.historyNode._options.widgetAppId)),e.is(n.historyNode._options.containers,"array")||(n.historyNode._options.containers=[]),e.is(n.historyNode._options.containers)&&n.historyNode._options.containers.push(i),e.is(n.historyNode._options.widgets,"array")||(n.historyNode._options.widgets=[]),e.is(n.historyNode._options.widgets)&&n.historyNode._options.widgets.push(c.widget)}var t=o("DS/PlatformAPI/PlatformAPI");e.is(t)&&t.subscribe("onAppReady.CATC3D_AP",function(){c.widget.setTitle(" ")})}a(c.widget)},d)}});else{if(c={el:i,title:"",parent:!1,preview:!0,appId:t.id,data:s||{},header:!0},!t||!(t.checksum&&t.launchInfos||t.platforms&&t.platforms[0]&&t.platforms[0].checksum&&t.platforms[0].launchInfos))throw new Error("Could not get valid Config from MyApps for the App "+c.appId);c=UWA.extend(c,{widgetId:e.is(t.launchInfos)?t.launchInfos:t.platforms[0].launchInfos,isolationLevel:e.is(t.isolationLevel)?t.isolationLevel:t.platforms[0].isolationLevel,token:e.is(t.checksum)?t.checksum:t.platforms[0].checksum}),u.load(c,function(){if(c.widget&&c.widget.environment){if(c.widget.setValue("X3DContentId",JSON.stringify(c.data)),e.is(n)&&e.is(n.historyNode)&&e.is(n.historyNode._options)){n.historyNode._options.contextid="RightPanelContext",n.historyNode._options.widgetAppId=c.widget.id,c.widget.context="RightPanelContext";let t=require("DS/TagNavigator/TagNavigator").get6WTagger(c.widget.context);t&&(t.setAsCurrent(),t.focusOnCC(n.historyNode._options.widgetAppId)),e.is(n.historyNode._options.containers,"array")||(n.historyNode._options.containers=[]),e.is(n.historyNode._options.containers)&&n.historyNode._options.containers.push(i),e.is(n.historyNode._options.widgets,"array")||(n.historyNode._options.widgets=[]),e.is(n.historyNode._options.widgets)&&n.historyNode._options.widgets.push(c.widget)}c.widget.addEvent("onUpdateTitle",function(t){var i=c.el.querySelector(".moduleHeader__title");if(i){var r=!1,s=i.innerHTML.split(" - ");e.is(s)&&s[0]!==c.name?(s[0]=c.name,r=!0):(s[1]=t,r=!0),r&&(i.innerHTML=s.filter(function(e){return e}).join(" - "))}})}a(c.widget)},d)}})}(t,a,s,n)})})})},setContentVisibility:function(t){var i=this.getCurrentSearchWidget();if(null!==i){var r,s=t,n=!1;e.is(t)&&e.is(t.SNtype)&&(s=t.SNtype,n=!0,r=t.contextid);var a=require("DS/TagNavigator/TagNavigator"),o=i.elements.body.getElement(".onesearch_skeleton");e.is(o)&&o.setStyle("display","none");var c=i.elements.body.getElement(".relational-div");e.is(c)&&c.setStyle("display","none");var l=i.elements.body.getElement(".product-div");if(e.is(l)&&l.setStyle("display","none"),"Search"===s||"Children"===s?e.is(o)&&o.setStyle("display","block"):"Explore"===s||"ExploreList"===s||"Explore3D"===s?e.is(l)&&l.setStyle("display","flex"):"Relational"===s&&e.is(c)&&c.setStyle("display","block"),!0===n){var u=a.get6WTagger(r);u&&(u.setAsCurrent(),u.focusOnCC(t.widgetAppId))}}},createContent:function(t){var i=null,r=this.getCurrentSearchWidget();if(null!==r){var n=t,a=r.elements.body.getElement(".relational-div");e.is(a)&&a.setStyle("display","none");var o=r.elements.body.getElement(".product-div");return e.is(o)&&o.setStyle("display","none"),"Explore"===n||"ExploreList"===n||"Explore3D"===n?e.is(o)&&(o.setStyle("display","flex"),"ExploreList"===n?(i=s.create("div",{class:"productList-div",styles:{float:"left"}})).inject(o):"Explore3D"===n&&(i=s.create("div",{class:"product3D-div",styles:{float:"right"}})).inject(o)):"Relational"===n&&e.is(a)&&(a.setStyle("display","block"),i=a),i}},pinToDashboard:function(t){require(["DS/Dashboard/Notification/Subscribe"],function(i){var r=t.widgetData;e.is(t.widgetData)&&(r.pinToDashboard=!1),i.subscribe({notification:{data:JSON.stringify({contentData:{title:t.widgetTitle},url:t.widgetIdOrUrl,appId:t.widgetAppId,widgetId:t.widgetId,data:r})},type:"widget"}).then(function(){e.is(t.success,"function")&&t.success()},function(){e.is(t.failure,"function")&&t.failure()})})},getCurrentTabId:function(){var t,i,r,s=null,n=(t=e.Widgets&&e.Widgets.instances||[]).length;for(i=0;i<n;i++)if(void 0!==(r=t[i]).data&&void 0!==r.data.module&&"DS/Dashboard/Layout/Dashboard"===r.data.module&&void 0!==r.layout&&void 0!==r.layout.selectedTab&&void 0!==r.layout.selectedTab.options){s=r.layout.selectedTab.options.id;break}return s},getSearchWidget:function(t){let i=null;return e.is(t)&&e.is(UWA.Widgets)&&e.is(UWA.Widgets.instances)&&UWA.Widgets.instances.forEach(function(e){e.id===t&&(i=e)}),i},getCurrentSearchWidget:function(){var t=null,i=this.getCurrentTabId();if(e.Widgets){var r,s,n,a=(r=e.Widgets&&e.Widgets.instances||[]).length;for(s=0;s<a;s++)n=r[s],e.is(n,"object")&&n.getValue("appId")===m.SEARCH_APP_ID&&"maximized"===n.getView().type&&e.is(n.getView().previous)&&e.is(n.getView().previous.type)&&"windowed"===n.getView().previous.type&&(t=n,s=a);if(null===t)for(s=0;s<a;s++)n=r[s],e.is(n,"object")&&n.context===i&&n.getValue("appId")===m.SEARCH_APP_ID&&"maximized"===n.getView().type&&(t=n,s=a);if(null===t)for(s=0;s<a;s++)n=r[s],e.is(n,"object")&&n.getValue("appId")===m.SEARCH_APP_ID&&"sidepanel"===n.getView().type&&(t=n,s=a)}return t},addSourceSpecificParameter:function(t,i){if(e.is(t)&&e.is(i)){var r=i.sourceIds;if(e.is(r,"array"))for(var s=0;s<r.length;s++){var n=r[s];if(e.is(t.specific_source_parameter))var a=t.specific_source_parameter[n];e.is(a)||(a={});var o=i.param.id,c=i.param.value;if(e.is(o,"string")&&e.is(c)&&c.toString().length){var l=a[o];e.is(l,"string")?a[o]+=c:a[o]=c,e.is(t.specific_source_parameter)||(t.specific_source_parameter={}),e.is(t.specific_source_parameter[n])||(t.specific_source_parameter[n]=a)}}}},setTaggerOpenedByCode:function(e){this._taggerOpenedByCode=e},isTaggerOpenedByCode:function(){return this._taggerOpenedByCode},getResultArgsFromSearchArgs:function(e){var t={};switch(e.to){case"onSearch":var i=e.options;t.search_criteria=i.value,t.adv_search=i.adv_search,t.search_mode=i.search_mode,t.recent_filter=i.sFilter,t.search_criteria_to_display=i.searchStringToDisplayInSearchField,t.internalSearchCriteria=i.internalSearchCriteria,t.displayValue=i.displayValue,t.source=i.source,t.viewData=i.viewData,t.in_apps_search=i.customization_options,t.tag_filter=i.tag_filter,t.savedSearch=i.savedSearch;break;case"init":var r=e.preferences_wdg;t.incontext_global_actions=r.incontext_global_actions,t.in_apps_search=r.customization_options,t.transient_context="true",t.css_view_class="maximized",t.search_options={search_criteria:r.search_criteria,adv_search:r.adv_search,search_criteria_to_display:r.search_criteria_to_display,search_mode:"index",tag_filter:r.reSearch,source:r.source},t.viewData=r.viewData,t.result_ux_customization=r.result_ux_customization,t.tagger_context_id=e.tagger_context_id}return t},getResultInitArgs:function(e){return m.getResultArgsFromSearchArgs({to:"init",preferences_wdg:e.preferences_wdg})},getResultUpdateArgs:function(e){return m.getResultArgsFromSearchArgs({to:"onSearch",options:e.options})},checkCustomerConfigs:function(t){return e.is(this._customerConfigPromise)||(this._customerConfigPromise=new u(function(i,r){if(e.is(t,"object")&&e.is(t.resources)){var s=t.resources.getFedSearchUrl();if(e.is(s,"string")){var n={"DS/SNSearchCusto":s+"/webapps/SNSearchCusto"};require.config({paths:n});var o="text!DS/SNSearchCusto/assets/SearchCmdConfig.json";a.getOption("cmd_config_cache")||(o+="?app="+m.identifyClientInfo().identifier),require([o],function(t){try{var s=JSON.parse(t);e.is(s.require,"object")&&e.is(s.require.config,"object")&&e.is(s.require.config.paths,"object")?(require.config(s.require.config),i("customer config set as : "+JSON.stringify(s.require.config))):r(new Error("SearchCmdConfig.json is not in required format, contents = "+t))}catch(e){r(new Error("Issue during parsing SearchCmdConfig.json, error = "+e+"file content = "+t))}},function(e){r(new Error("Issue during require of SearchCmdConfig.json, error = "+e.message))})}else r(new Error("Invalid federated Service Base URL"))}else r(new Error("Invalid Inputs"))})),this._customerConfigPromise},isFUN072117Active:function(){return a.getOption("preferredUnit_FUN072117")||p.isActiveWithCurrentVersion({R2019x:"BETA3"})},isFUN109031Active:function(){let t=this.is6WInWebInWinActive();if(!0===t)return t;let i=a.getOption("addinmode"),r=a.getOption("force6w");if((!this.isODTMode()||null!==r)&&!1===this.isWebInWin()&&-1===["solidworks","catiav5"].indexOf(i)&&void 0===o.getItem("BETA-FUN109031")){let t=a.getOption("6w_default_activated");o.setItem("BETA-FUN109031",!e.is(t,"boolean")||t)}return!0===o.getItem("BETA-FUN109031")&&-1===["solidworks","catiav5"].indexOf(i)&&!1===this.isWebInWin()},is6WInWebInWinActive:function(){return!0===a.getOption("W6_In_WebInWin")},isFUN096612Active:function(){return a.getOption("SearchDisplayName")},isWebInWin:function(){return!!e.is(a.getOption("search_web_in_win"),"boolean")&&a.getOption("search_web_in_win")},getValidDatasources:function(t){var i={},r=t.dataSourcesToFilterFromAdvancedSearch||a.getOption("dataSourcesToFilterFromAdvancedSearch");e.is(r)||(r={});var s=a.getOption("RDFDataSources");if(e.is(s)||(s={}),e.is(t)){var n=t.dataSources;if(e.is(n,"array")){for(var o=[],c=[],l=[],u=0;u<n.length;u++){var d=n[u];if(!0===d.status){var p=d.name;e.is(r[p])||e.is(s[p])?e.is(s[p])&&(e.is(d.service)?l.push(d.service):l.push(d.name)):(o.push(p),e.is(d.service)?c.push(d.service):c.push(d.name))}}o=o.filter(function(e,t,i){return i.indexOf(e)===t}),l.length>0&&(o.push("other"),o.push(o.splice(o.indexOf("other"),1)[0])),i.dataSourceNames=o,i.dataSourceServices=c,i.otherDataSourceServices=l}}return i},getValidDatasourcesWithConfiguration:function(t){var i={},r=a.getOption("dataSourcesToFilterFromAdvancedSearch");e.is(r)||(r={});var s=a.getOption("RDFDataSources");if(e.is(s)||(s={}),e.is(t)){var n=t.dataSources;if(this._chosen_dataSource.length<1&&(this._chosen_dataSource=o.getItem("dataSource")||[]),e.is(n,"array")){for(var c=[],l=[],u=[],d=0;d<n.length;d++){var p=n[d];if(!0===p.status){var h=p.name;(this._chosen_dataSource.length<1||this._chosen_dataSource.indexOf(h)>-1)&&(e.is(r[h])||e.is(s[h])?e.is(s[h])&&(e.is(p.service)?u.push(p.service):u.push(p.name)):(c.push(h),e.is(p.service)?l.push(p.service):l.push(p.name)))}}c=c.filter(function(e,t,i){return i.indexOf(e)===t}),u.length>0&&(c.push("other"),c.push(c.splice(c.indexOf("other"),1)[0])),i.dataSourceNames=c,i.dataSourceServices=l,i.otherDataSourceServices=u}}return i},getAdminCustoDefinition:function(){if(!e.is(this._adminCusto))try{sessionStorage&&sessionStorage.getItem("SearchColumnCustoAdmin.json")&&(this._adminCusto=JSON.parse(sessionStorage.getItem("SearchColumnCustoAdmin.json"))),e.is(this._adminCusto)||(this._adminCusto=JSON.parse(g))}catch(e){f.error("Error parsing SearchColumnCustoAdmin.json:",e)}return this._adminCusto},_getPredicateTypeFromDataType:function(t){var i="",r="string";return e.is(t)&&e.is(t.range)&&e.is(t.range.dataTypes)&&e.is(t.range.dataTypes.length)?"http://www.w3.org/2001/XMLSchema#string"===(i=t.range.dataTypes[0])?r="string":"http://www.w3.org/2001/XMLSchema#boolean"===i?r="boolean":"http://www.w3.org/2001/XMLSchema#integer"===i?r=e.is(t.rangeValues,"object")&&Object.keys(t.rangeValues).length>0?"string":"integer":"http://www.w3.org/2001/XMLSchema#dateTime"===i?r="date":"http://www.w3.org/2001/XMLSchema#date"===i?r="date":"http://www.w3.org/2001/XMLSchema#double"===i?r="double":"http://www.w3.org/2001/XMLSchema#real"===i?r="double":"http://www.w3.org/2001/XMLSchema#timestamp"===i?r="date":"http://www.w3.org/2001/XMLSchema#time"===i&&(r="date"):e.is(t.type)&&(r=t.type),r},ensureBetaStatus:function(){var t=this;return e.is(this._isInTheSimpleSearchModePromise)||(this._isInTheSimpleSearchModePromise=new u(function(e){!0===a.getOption("newSearch19xFD02")&&!0===a.getOption("predefinedBetaUser")||!0===t.isOneSearchInternalProd()?o.getPreference({name:"3DSearchOptions",onComplete:function(){t._isInTheSimpleSearchModePromiseStatus="resolved",e(t.isInTheSimpleSearch())},onFailure:function(){t._isInTheSimpleSearchModePromiseStatus="resolved",e(t.isInTheSimpleSearch())}}):(t._isInTheSimpleSearchModePromiseStatus="resolved",e(t.isInTheSimpleSearch()))})),this._isInTheSimpleSearchModePromise},isOneSearchInternalProd:function(){var t=a.getOption("DoNotRestoreSearchChoice"),i=a.getOption("OneSearch"),r=m.identifyClientInfo(),s=!1;return!0!==t&&!0===i&&!0===a.getOption("internalProd")&&(!e.is(r,"object")||"3DDashboard"!==r.identifier&&"3DSwym"!==r.identifier||(s=!0)),s},isInTheSimpleSearch:function(){if(e.is(this._isInTheSimpleSearchMode))return this._isInTheSimpleSearchMode;this._isInTheSimpleSearchMode=a.getOption("simple_search_experience");var t=!1;if(!0===a.getOption("internalProd")){var i=m.identifyClientInfo();e.is(i,"object")&&"3DDashboard"===i.identifier&&(t=!0)}var r=a.getOption("OneSearch");if(e.is(a.options.url_search_settings.simple_search_experience))this._isInTheSimpleSearchMode=a.options.url_search_settings.simple_search_experience;else if(e.is(a.getOption("Odt_simple_search")))this._isInTheSimpleSearchMode=a.getOption("Odt_simple_search");else if(!0!==r||!0!==a.getOption("search_web_in_win")&&!a.getOption("addinmode")){var s=a.getOption("newSearch19xFD02"),n=a.getOption("predefinedBetaUser");if(!0===s&&!0===n){var c=o.getItem("simple_search_experience");e.is(c,"boolean")&&(this._isInTheSimpleSearchMode=c),!0===this._isInTheSimpleSearchMode&&(t=!1)}}else this._isInTheSimpleSearchMode=!0;return this.isOneSearchInternalProd()&&(t=o.getItem("find_in_this_tab_default")),a.changeSettingForBETA_deactivated({find_in_this_tab_default:t}),!1===this._isInTheSimpleSearchMode?a.changeSettingForFD01():a.changeSettingForBETA(),e.is(this._isInTheSimpleSearchMode)&&(a.options.search_settings.simple_search_experience=this._isInTheSimpleSearchMode),this._isInTheSimpleSearchMode},isSnippetAvailable:function(t){var i=!0;return!1===a.getOptionPerTenant("search_snippet_admin",{tenant:t})&&(i=!1),!0===a.getOption("OneSearchOFF")&&(i=!1),e.is(a.getOption("search_snippet"),"boolean")&&(i=a.getOption("search_snippet")),i},isSuggestAvailable:function(t){var i=!0;return!1===a.getOptionPerTenant("suggest_admin",{tenant:t})&&(i=!1),!0===a.getOption("OneSearchOFF")&&(i=!1),e.is(a.getOption("suggest"),"boolean")&&(i=a.getOption("suggest")),i},isCompactModeEnforced:function(e){var t=!0;return!0!==a.getOptionPerTenant("mobile_experience_admin",{tenant:e})&&(t=!1),t},isMobile:function(){return-1!==["iphone","ipad","android"].indexOf(m.getDeviceCategory())},isBetaEnabledForUser:function(){var t=!0,i=a.getOption("predefined_beta_users"),r=this.getUserId();return e.is(r)&&e.is(i,"array")&&(t=i.indexOf(r)>=0||i.indexOf(r.toUpperCase())>=0),t},setUserSpecificSettings:function(){a.changeSettings({predefinedBetaUser:this.isBetaEnabledForUser()})},activateCompactOrComfortMode:function(){var t=a.getOption("OneSearch");if(e.is(t)&&!0===t){var i=screen.availWidth;if(e.is(i)){var r=!0;if(i>1275)r=!1;else{var s=this.getDeviceCategory();-1!==["iphone","ipad","android"].indexOf(s)&&i>1023&&(r=!1)}a.setCompactMode(r)}}},getHierarchyClass:function(t){if(e.is(t)){var i={method:"POST"};i.headers=t.headers||{},i.headers["Content-Type"]="application/xml",i.headers.Accept="application/json",i.url=t.searchmodel.getFederatedSource().get3DSpaceUrl()+"/i3dx/services/xmql?tenant="+t.searchmodel.getFederatedSource().getActiveTenant();var r='<?xml version="1.0" encoding="utf-8"?>\n';r+='<executeSequence xmlns="http://www.3ds.com/xmql/query">\n',r+="\t<execute>\n",r+="\t\t<function>get_parents_bus_type</function>\n",r+="\t\t<version>1.0.0</version>\n",r+="\t\t<params>\n",r+='\t\t\t<param name="type">'+t.searchmodel.get("ds6w:type_value")+"</param>\n",r+="\t\t</params>\n",r+="\t</execute>\n",r+="</executeSequence>\n",i.data=r,i.onComplete=function(i){var r=[];try{var s=JSON.parse(i);if(e.is(s)&&(r=JSON.parse(s.xmql_response.body.result[2].output),e.is(r,"array"))){r.reverse(),r.push(t.searchmodel.get("ds6w:type_value"));var n=t.searchmodel.get("ds6w:kind_value");e.is(n,"array")?r=r.concat(n):e.is(n,"string")&&r.push(n)}Array.isArray(r)||(r=[])}catch(e){r=[]}e.is(t.onComplete,"function")&&t.onComplete.call(null,r)},i.onFailure=function(i){e.is(t.onFailure,"function")&&t.onFailure.call(null,i)},l.authenticatedRequest(i.url,i)}},getSourceToPredicateMapping:function(){var t=[];return e.is(this._sourceToPredicateMapping,"object")&&e.is(this._sourceToPredicateMapping.SourceToPredicate)&&(t=this._sourceToPredicateMapping.SourceToPredicate),t},getMinimalWidthForInformationPanelAvailability:function(){return 870},getCSVSeparatorValueFromId:function(t,i){let r,s;if(e.is(a)&&e.is(a._tenantSettings)&&e.is(a._tenantSettings[t])&&e.is(a._tenantSettings[t].search_settings)&&(s=a._tenantSettings[t].search_settings),e.is(s,"object")&&e.is(s.defaultCsvSeparator,"object")&&e.is(s.defaultCsvSeparator.id,"string")){let t=null;if(e.is(a.options)&&e.is(a.options.csvSeparatorArray,"array"))for(let i=0,n=(t=a.options.csvSeparatorArray).length;i<n;i++)e.is(t[i],"object")&&e.is(t[i].id,"string")&&t[i].id===s.defaultCsvSeparator.id&&e.is(t[i].value,"string")&&(r=t[i].value)}return r},isInternalProduction:function(){return!0===a.getOption("internalProd")||"DSEXT001"===this.getActiveTenant()&&["3DDashboard","3DSpace","3DSwym"].includes(m.identifyClientInfo().identifier)},getSericeURLPromise:function(e,t){return new u(function(i,r){h.getServiceUrl({serviceName:t,platformId:e,onComplete:function(e){e?i(e):r()},onFailure:function(e){r(e)}})})},addHFTracesInConsole:function(e){p.addHFTracesInConsole(e)},htmlDecode:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue},isFetchSynthesisSeparately:function(){var e=m.identifyClientInfo().identifier;return!1!==a.getOption("fetchSynthesisSeparately")&&("3DDashboard"===e||"3DSpace"===e)},arrayUnique:function(e){for(var t=e.concat(),i=0;i<t.length;++i)for(var r=i+1;r<t.length;++r)t[i]===t[r]&&t.splice(r--,1);return t},_getQueryFromRefine:function(t,i){return"["+t.split("/").pop()+"]:("+i.reduce((t,i)=>{var r='"'+(i=e.is(i.object,"array")?i.object.join("/"):i.object)+'"';return t?t+" OR "+r:r},"")+")"},getQueryFromRefines:function(e){var t="",i=this;return e&&Object.keys(e).length>0&&Object.keys(e).forEach((r,s)=>{var n=e[r],a=i._getQueryFromRefine(r,n);a&&(t&&(t+=" AND "),t+=a)}),t},getTaggerSubjectURIForMultipleSources:function(e,t){let i=[],r={};for(let i of e){let e=i.getSourceID(),s=e||"3dspace",n={id:i.id,source:s,platform:t};r[s]?r[s].push(n):r[s]=[n]}for(let s in r){let n=m.getTaggerSubjectURI({subjects:r[s],source:s,platform:t,service:e[0].collection.get(r[s][0].id).getServiceID()});for(let t in n)i.push({uri:n[t],service:m.getTaggerService(e[0].collection.get(r[s][0].id)),tags:[]})}return i},hasTaggerSubjectURI:function(e,t){return m.getTaggerSubjectURIForMultipleSources(e,t).some(function(e){return e.uri})},clickOnSearchBETA:function(t){require(["DS/UIKIT/SuperModal","DS/WebappsUtils/WebappsUtils","DS/MessageBus/MessageBus","text!DS/SNInfraUX/assets/templates/SearchBeta.html","text!DS/SNInfraUX/assets/templates/SearchBetaEXT.html","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json","css!DS/SNInfraUX/SNInfraUX"],function(i,r,s,n,a,c){let l=new i({renderTo:document.body,className:"betaWarning",closable:!0,events:{onHide:function(){e.is(t)&&e.is(t.onFailure,"function")&&t.onFailure.call(void 0)}}}),u=t&&t.state?t.state:m.isFUN109031Active(),d=m.isInternalProduction()?n:a,p=["BETA-FUN109031-modal-content-section-1","BETA-FUN109031-modal-content-section-directive-1","BETA-FUN109031-modal-content-section-directive-2","BETA-FUN109031-modal-content-what","BETA-FUN109031-modal-content-where","BETA-FUN109031-modal-content-who","BETA-FUN109031-modal-content-when","BETA-FUN109031-modal-content-feedback"];for(let e=0;e<p.length;e++)d=d.replace("###"+p[e]+"###",c.get(p[e]));d=(d=(d=(d=d.replace("###WHAT###",r.getWebappsAssetUrl("SNInfraUX","images/WHAT.png"))).replace("###WHERE###",r.getWebappsAssetUrl("SNInfraUX","images/WHERE.png"))).replace("###WHO###",r.getWebappsAssetUrl("SNInfraUX","images/WHO.png"))).replace("###WHEN###",r.getWebappsAssetUrl("SNInfraUX","images/WHEN.png")),l.dialog({body:d,title:c.get("BETA-FUN109031-modal-title"),buttons:[{className:"primary",value:!0!==u?c.get("beta_activation_ok_title"):c.get("beta_deactivation_ok_title"),action:i=>{!0!==u&&!1!==u&&(u=!1),s.publish({channel:"SearchTrackerApi",topic:"hit",data:{category:"LifeLikeSearch",action:"searchBeta",persDim:{pd14:u?"disabled":"enabled"}}}),o.setItem("BETA-FUN109031",!u),o.commit(),e.is(t)&&e.is(t.onComplete,"function")?(i&&i.hide(),t.onComplete.call(void 0,!u)):location.reload(!0)}}]})})}});return m}),define("DS/SNInfraUX/SessionSecurityContextServices",["UWA/Class","UWA/Class/Debug","DS/WAFData/WAFData","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/PlatformEnvServices","DS/SNInfraUX/Logger","UWA/Promise"],function(e,t,i,r,s,n,a){"use strict";return e.singleton(t,{_SCPromises:{},_SContexts:{},getSecurityContext3DSpace:function(e){var t=this;return t._SCPromises.hasOwnProperty(e)?t._SContexts.iTenantId:(t._SCPromises.iTenantId=new a(function(a,o){var c=s.getServiceURL("cstorage",e)+"/resources/bps/cspaces?tenant="+e,l={type:"json",method:"GET",proxy:"passport"};l.headers={"Content-Type":"application/ds-json","Accept-Language":r.getLanguage()},l.timeout=6e5,l.that=t,l.onComplete=function(i){var r=i.cspaces,s=[];r&&0!==r.length||(r=[]);var n="",o=!0;r.forEach(function(e){var t=e.displayName.split(".");if(3===t.length&&o){var i=t[1];""===n&&(n=i),o=n===i}}),r.forEach(function(e){var t=e.displayName,i=e.displayName.split(".");3===i.length&&(t=i[2]+"  ",o||(t+=i[1]+"  "),t+=i[0]),s.push({label:t,value:e.name})}),t._SContexts[e]=r,a(t._SContexts[e])},l.onFailure=function(e){n.log("getSecurityContext3DSpace:Failure..."+e),o("getSecurityContext3DSpace:Failure...")},l.ontimeout=function(){n.log("getSecurityContext3DSpace: A connection timeout occured."),o("getSecurityContext3DSpace: A connection timeout occured.")},i.authenticatedRequest(c,l)}),t._SCPromises.iTenantId)}})}),define("DS/SNInfraUX/SearchResultCategories",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","text!DS/SNInfraUX/assets/ResultPreviewDefinition.json","text!DS/SNInfraUX/assets/defaultCustomCategory.json","i18n!DS/SNInfraUX/assets/nls/SNInfraUX.json"],function(e,t,i,r,s,n,a,o,c){"use strict";var l=t.singleton(i,{_promises:{},_categories:{},getResultCategories:function(e){var t=this;return this._promises[e]||(this._promises[e]=new r(function(i,r){s.getOption("deactivate_FUN108944")||-1!==["iphone","ipad","android"].indexOf(n.getDeviceCategory())?(t._loadTenantCategories(e),i()):s.getTenantSettings(e).then(function(){var r=s.getOption("result_categories",{tenant:e});t._loadTenantCategories(e,r),i()})})),this._promises[e]},getActiveCategories:function(t,i){var r=(s.getOption("activateSuggestion")+"").split(",");if(this._categories[t]&&this._categories[t][i])return this._categories[t][i].list.filter(function(e){return!1!==e.active||r.indexOf(e.id)>=0}).map(t=>e.clone(t,!0))},getCategoryTitleNls:function(e){var t="search.suggestion.group.title."+e.name,i=c.get(t);return i==t?e.name:i},_loadTenantCategories:function(t,i){var r=JSON.parse(a);function n(t){if(t)for(var i=0;i<t.length;i++)t[i].nls=l.getCategoryTitleNls(t[i]),!0===t[i].custom&&t.splice(i,1,e.extend(JSON.parse(o),t[i])),!s.getOption("disable_InstantSearch_thumbnails")&&t[i].select_file.indexOf("thumbnail_2d")<0&&t[i].select_file.push("thumbnail_2d")}i&&i.suggestion&&(r.suggestion=i.suggestion),n(r.suggestion.list),n(r.result.list),this._categories[t]=r}});return l}),define("DS/SNInfraUX/Api/SearchApi",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Promise","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchUtils"],function(e,t,i,r,s,n,a,o,c){"use strict";return t.singleton(i,{_searchRessources:null,_searchApiPromise:r.deferred(),setResourceMgt:function(e){this._searchRessources=e,this.load(!0)},load:function(e){var t=this;return!0===e&&this._searchRessources&&(o.log("DS/SNInfraUX/Api/SearchApi load : "+this._searchRessources),a.login({resources:this._searchRessources,onComplete:function(){o.log("DS/SNInfraUX/Api/SearchApi login : onComplete"),t._searchApiPromise.resolve()},onFailure:function(){o.log("DS/SNInfraUX/Api/SearchApi login : onFailure"),t._searchApiPromise.resolve()}})),this._searchApiPromise.promise},getSearchApiPromise:function(){return this._searchApiPromise.promise},search:function(e){this._queryFedSearch(e)},_queryFedSearch:function(t){o.log("DS/SNInfraUX/Api/SearchApi _queryFedSearch : "+t);var i=this;n.getServiceUrl({serviceName:"3DSearch",platformId:t.tenant?t.tenant:i._searchRessources?i._searchRessources.getActiveTenant():void 0,onComplete:function(r){if(o.log("DS/SNInfraUX/Api/SearchApi onComplete urc : "+r),e.is(r,"string")){var n={query:t.query,order_field:t.order_field||"relevance",order_by:t.order_by||"desc",select_file:e.is(t.select_file,"array")?t.select_file:[],select_synthesis:t.select_synthesis||[],select_predicate:t.select_predicate||["ds6w:label"],label:"3DSearch-"+c.getUserId()+"-"+(new Date).getTime(),nresults:t.nresults||40,next_start:t.next_start,source:t.source,specific_source_parameter:t.specific_source_parameter||{},tenant:t.tenant};!n.tenant&&i._searchRessources&&(n.tenant=i._searchRessources.getActiveTenant()),o.log("DS/SNInfraUX/Api/SearchApi onComplete fedsearch_data : "+n);var a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:JSON.stringify(n),onComplete:function(e){o.log("DS/SNInfraUX/Api/SearchApi onComplete onComplete : "+e);var i=JSON.parse(e);!0!==t.with_info&&delete i.infos,delete i.facets,t.onComplete(i)},onFailure:function(e){o.log(e),t.onFailure(e)}};o.log("DS/SNInfraUX/Api/SearchApi onComplete fedsearch_options : "+a),s.authenticatedRequest(r+"/search",a)}else t.onFailure()},onFailure:function(e){o.log(e),t.onFailure(e)}})},getSearchResources:function(){return this._searchRessources&&e.clone(this._searchRessources)}})}),define("DS/SNInfraUX/SearchCom",["UWA/Core","UWA/Utils/InterCom","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,r){"use strict";return{_searchCom_server:null,_created_special_server:[],_created_socket_global:[],_created_socket:[],in3DDashboardApp:void 0,createSocket:function(s){if(e.is(this._searchCom_server)||this._init(s),void 0===this.in3DDashboardApp&&(this.in3DDashboardApp=r.identifyClientInfo().identifier,e.is(s)&&e.is(s.clientInfo)&&(this.in3DDashboardApp=s.clientInfo)),e.is(s.socket_id)){var n=null;if(-1!==this._created_socket.indexOf(s.socket_id))throw new Error("SearchCom: socket with id "+s.socket_id+" already created");return"3DDashboard"===this.in3DDashboardApp&&s.widgetId&&-1===s.widgetId.indexOf("preview")?(-1===this._created_special_server.indexOf(s.widgetId)&&(this._searchCom_server=new t.Server("SearchComServer_"+s.widgetId,{isPublic:!1}),this._created_special_server.push(s.widgetId),this.updateGlobalSockets()),n=new t.Socket(s.socket_id,{dispacthRetryInterval:0}),i.getOption("search_web_in_win")||i.getOption("SearchComServer_odt")?n.subscribeServer("SearchComServer_"+s.widgetId,window):n.subscribeServer("SearchComServer_"+s.widgetId),this._created_socket.push(s.socket_id)):(n=new t.Socket(s.socket_id,{dispacthRetryInterval:0}),i.getOption("search_web_in_win")||i.getOption("SearchComServer_odt")?n.subscribeServer("SearchComServer",window):n.subscribeServer("SearchComServer"),this._created_socket.push(s.socket_id),this._created_socket_global.push(n),this.subscribeServer_global(n)),n}throw new Error("SearchCom: socket_id not found")},updateGlobalSockets:function(){var e=this;this._created_socket_global.forEach(function(t){e.subscribeServer_global(t)})},subscribeServer_global:function(e){"searchview_socket_id"!==e.id&&this._created_special_server.forEach(function(t){var r="SearchComServer_"+t;!e.servers[r]&&e&&(i.getOption("search_web_in_win")||i.getOption("SearchComServer_odt")?e.subscribeServer(r,window):e.subscribeServer(r))})},unsubscribeServer:function(t){if(e.is(t)&&0!==this._created_special_server.length){var i=this;this._created_socket_global.forEach(function(e){i._created_special_server.forEach(function(i){var r="SearchComServer_"+i;t===i&&e.servers[r]&&e.unsubscribeServer(r)})})}},deleteSocket:function(t){var i=this._created_socket.indexOf(t);if(-1!==i){this._created_socket.splice(i,1);var r=this._created_socket_global.length,s=null,n=null,a=null;for(n=0;n<r;n++)if(a=this._created_socket_global[n],e.is(a)&&e.is(a.id)&&a.id===t){s=a;break}n&&null!==s&&(this._created_socket_global.splice(n,1),this._created_special_server.forEach(function(e){var t="SearchComServer_"+e;a.servers[t]&&s.unsubscribeServer(t)}))}},_init:function(){this._searchCom_server=new t.Server("SearchComServer",{isPublic:!1}),!0===i.getOption("debug_mode")&&(this.in3DDashboardApp=location.pathname.match(/\/3DDashboard\//))}}}),define("DS/SNInfraUX/SNVocabAccess",["UWA/Core","UWA/Class","UWA/Class/Debug","UWA/Class/Options","DS/WAFData/WAFData","UWA/Class/Model","UWA/Class/Collection","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchSettings","UWA/Promise","DS/SNInfraUX/SearchUtils","DS/FedDictionaryAccess/FedDictionaryAccessAPI"],function(e,t,i,r,s,n,a,o,c,l,u,d){"use strict";var p=n.extend({idAttribute:"name"}),h=n.extend({idAttribute:"uri"}),g=n.extend({idAttribute:"className"}),f=t.singleton(i,r,{_cacheVocabularyInfo:{},_cacheInterfacesInfo:{},_cachePredicatesInfo:{},_vocabPromises:{},_interfacePromises:{},_predicatePromises:{},_fedPropertiesPromise:{},init:function(){},setResources:function(e){this.setOptions(e)},loadVocabularyClasses:function(t,i){if(o.groupCollapsed("SNVocabAccess.loadVocabularyClasses"),!e.is(t,"object"))throw o.error("INVALID STATE: loadVocabularyClasses is called with incorrect arguments",t),new Error("INVALID STATE: loadVocabularyClasses is called with incorrect arguments");o.log("requestedVocabData : ",t);var r=t.vocabId,s=t.tenantId,n=t.lang,p=t.rdfSources;this.log("loadVocabulary called for vocabId : "+r);var g=this;if(!e.is(s)){var f=this.getOption("resources");if(!e.is(f))throw new Error("INVALID STATE: loadVocabularyClasses is called before doing setResources");s=f.getActiveTenant()}e.is(n)||(n=u.getLanguage()),e.is(this._vocabPromises[r])||(this._vocabPromises[r]=new l(function(t,i){g._cacheVocabularyInfo[r]={info:new a([],{model:h})};var l={tenantId:s,lang:n,apiVersion:"R2019x"};!0===c.getOption("SEARCH_INSTANCES",{tenant:s})&&(l.includeInstances=!0,delete l.apiVersion),l.onComplete=function(s){var n=function(t,i){let r=[];if(!e.is(i,"array"))return o.error("Bad arg when calling loopOnClasses",i),r;let s=null;for(let a=0;a<i.length;a++)if(s=i[a],e.is(s,"object")&&(e.is(s.curi,"string")||e.is(s.uri,"string"))){var n=s.label||s.nlsName||s.curi||s.uri;r.push({nlsName:n,uri:s.curi||s.uri,type:s.type,service:e.is(t,"string")?t:"3dspace"})}else o.error("Invalid data : ",s);return r};try{if(e.is(s,"string")&&0>=s.length)return o.warn("Empty response for vocabulary : "+r),void i(new Error("Empty response for vocabulary"));var a=null;if(e.is(s,"string")&&s.length>0)try{a=JSON.parse(s)}catch(e){o.error("Error parsing response:",e)}else a=s;o.log("Successfully loaded the vocabulary : "+r);var l={};if(Array.isArray(a)){l.vocabularyClassInfo=[];let t=null;for(let i=0;i<a.length;i++){if(!e.is(a[i])){o.error("Unexpected data structure returned by FedDictionaryAccess.getServiceClasses (invalid element in returned array,  index = "+i+") :",a);continue}let r=a[i].service;if(o.log("Treating service "+r),t=a[i].classes,e.is(t))l.vocabularyClassInfo=l.vocabularyClassInfo.concat(n(r,t));else{if(!e.is(a[i].vocabularies,"array")){o.error('Unexpected data structure returned by FedDictionaryAccess.getServiceClasses (no "classes" or "vocabularies" property found on '+i+" element) :",a);continue}for(let t=0,s=a[i].vocabularies.length;t<s;t++)e.is(a[i].vocabularies[t],"object")&&e.is(a[i].vocabularies[t].classes||a[i].vocabularies[t].vocabularyClassInfo,"array")?l.vocabularyClassInfo=l.vocabularyClassInfo.concat(n(r,a[i].vocabularies[t].classes||a[i].vocabularies[t].vocabularyClassInfo)):o.error("Unexpected data structure returned by FedDictionaryAccess.getServiceClasses json_nls["+i+"].vocabularies.classes is not an array",a)}}}else l=a;var u=c.getOption("vocabToExtend_"+r,!1);if(e.is(u)&&!0===u.includeCommonClasses)for(var d=u.commonClasses,p=d.length-1;p>=0;p--)l.vocabularyClassInfo.push({uri:d[p]});l.vocabularyClassInfo.sort(function(t,i){var r=t.nlsName;e.is(r)||(r=t.uri),r=r.toUpperCase();var s=i.nlsName;return e.is(s)||(s=i.uri),r<(s=s.toUpperCase())?-1:r>s?1:0}),g._cacheVocabularyInfo[r].info.add(l.vocabularyClassInfo),t()}catch(e){o.error("Exception caught in SNVocabAccess.loadVocabularyClasses.onComplete ! :"+e),i(new Error("Exception caught in SNVocabAccess.loadVocabularyClasses.onComplete"))}},l.onFailure=function(e,t){o.log("FAILED to load the vocabulary : "+r,e,t),i(new Error("FAILED to load the vocabulary"))},"other"===r?d.getServiceClasses(p,l):d.getServiceClasses(r,l)}));var _=function(){e.is(i)&&i({classInfos:g._cacheVocabularyInfo[r].info.toJSON()}),o.groupEnd()};this._vocabPromises[r].then(_,_)},getVocabularyClasses:function(e){if(this._cacheVocabularyInfo[e]&&this._cacheVocabularyInfo[e].info.length>0)return this._cacheVocabularyInfo[e].info.toJSON()},_getRDFServiceIdByClassName:function(e){var t="";if(this._cacheVocabularyInfo.other&&this._cacheVocabularyInfo.other.info.length>0)for(var i=this._cacheVocabularyInfo.other.info.toJSON(),r=0;r<i.length;r++)if(i[r].uri===e){t=i[r].service;break}return t},loadRelevantInterfaces:function(t,i){var r=t.className,s=t.lang;e.is(s)||(s=u.getLanguage()),r=r.replace("ds6wg:","");var n=this;e.is(this._interfacePromises[r])||(this._interfacePromises[r]=new l(function(i,c){n._cacheInterfacesInfo[r]={info:new a([],{model:p})};var l={};if(e.is(t.currentDataSource)?"other"===t.currentDataSource?l.serviceName=n._getRDFServiceIdByClassName(r):l.serviceName=t.currentDataSource:l.serviceName="3DSpace",e.is(t.tenantId))l.tenantId=t.tenantId;else{var u=n.getOption("resources");e.is(u)&&(l.tenantId=u.getActiveTenant())}l.lang=s,l.onComplete=function(t){o.log("Successfully loaded the vocabulary : "+r);var s=null;if(e.is(t,"string")&&t.length>0)try{s=JSON.parse(t)}catch(e){o.error("Error parsing response:",e)}else s=t;s.extensions.sort(function(e,t){return e.label.toUpperCase()<t.label.toUpperCase()?-1:e.label.toUpperCase()>t.label.toUpperCase()?1:0});for(var a=s.extensions,c=[],l=0;l<a.length;l++){var u={name:a[l].curi,nlsName:a[l].label};c.push(u)}n._cacheInterfacesInfo[r].info.add(c),i()},l.onFailure=function(e,t){o.log("FAILED to load the vocabulary : "+r,e,t),c(new Error("FAILED to load the vocabulary"))},d.getExtensionsForClass(r,l)}));var c=function(){e.is(i)&&i({interfaces:n._cacheInterfacesInfo[r].info.toJSON()})};this._interfacePromises[r].then(c,c)},RemoveDuplicateJsonObj:function(t,i){if(e.is(t)){for(var r=[],s=0;s<t.length;s++)if(t[s].hasOwnProperty(i)){let e=0;for(e=0;e<r.length&&t[s][i]!==r[e][i];e++);e===r.length?r.push(t[s]):o.log(t[s].nlsName+" is ignored : DUPLICATE :"+t[s][i])}return r}},loadRelevantPredicates:function(t,i){if(!e.is(t,"object"))throw new Error("INVALID STATE: loadRelevantPredicates is called with incorrect arguments");var r=t.className;r.indexOf(":")!==r.lastIndexOf(":")&&r.startsWith("ds6wg:")&&(r=r.substring(6));var s=t.tenantId;this.log("loadRelevantPredicates called for "+r);var n=this;if(!e.is(s)){var c=this.getOption("resources");if(!e.is(c))throw new Error("INVALID STATE: loadRelevantPredicates is called before doing setResources");s=c.getActiveTenant()}e.is(this._predicatePromises[r])||(this._predicatePromises[r]=new l(function(i,c){n._cachePredicatesInfo[r]={status:"waiting",info:new a([],{model:g})},e.is(t.serviceName)?"other"===t.serviceName&&(t.serviceName=n._getRDFServiceIdByClassName(r)):t.serviceName="3DSpace";var l={tenantId:s,lang:u.getLanguage(),serviceName:t.serviceName,onComplete:function(t){o.log("Successfully loaded the vocabulary : "+r);var s=null;if(e.is(t,"string")&&t.length>0)try{s=JSON.parse(t)}catch(e){o.error("Error parsing response:",e)}else s=t;if(e.is(s)){var a=[];if(e.is(s.classPredicates,"array")&&s.classPredicates.length>0)for(var l=0,u=s.classPredicates.length;l<u;l++)a.push(f.RemoveDuplicateJsonObj(s.classPredicates[l].vocabularyPredicateInfo,"uri"));if(e.is(a,"array")&&a.length>0)for(var d=0,p=a.length;d<p;d++)n._cachePredicatesInfo[r].info.add(a[d]);i()}else o.log("Response Object is EMPTY : "+r),c(new Error("Empty response given by FedDictionaryAccess.getPropertiesForClass"))},onFailure:function(e,t){o.log("FAILED to load the vocabulary : ",r,e,t),c(new Error("Error when calling FedDictionaryAccess.getPropertiesForClass"))}};d.getPropertiesForClass(r,l)}));var p=function(){e.is(i)&&i({vocabularyPredicateInfo:n._cachePredicatesInfo[r].info.toJSON()})};this._predicatePromises[r].then(p,p)},loadPLMSuggestList:function(t,i){var r=this.getOption("resources");if(!e.is(r))throw new Error("INVALID STATE: loadPLMSuggestList is called before doing setResources");var n=u.getLanguage(),a=c.getOption("PLMParamNLS"),l="plmparam.title";e.is(a,"object")&&e.is(a[n],"string")&&(l=a[n]);var d,p=new Date;d="3DSearch-"+u.getUserId()+"-"+p.getTime();var h=r.getFetchOptions({service_name:"listAvailablePamameters",service_data:{query:"type:PlmParameter AND ["+l+"]:("+t+")",order_field:"plmparam.title",select_predicate:[l,"plmparam.itf","plmparam.displayunit","plmparam.title"],label:d,source:["3dspace"],nresults:101}});h.onComplete=function(r){o.log("Successfully loaded the suggest list for : "+t);var s=null;if(e.is(r,"string")&&r.length>0)try{s=JSON.parse(r)}catch(e){o.error("Error parsing response:",e)}else s=r;if(e.is(i,"function")){var n={plmtitle:t,info:s.results};i(n)}},h.onFailure=function(e,t){o.log("Failure loaded the suggest list for : "+t)},s.authenticatedRequest(h.url,h)},loadSearchSuggestList:function(t,i,r){var n=this.getOption("resources");if(!e.is(n))throw new Error("INVALID STATE: loadSearchSuggestList is called before doing setResources");var a=n.getFetchOptions({service_name:"listSuggestPamameters",service_data:t});a.onComplete=function(t){o.log("Successfully loaded the suggest list for : ");var r=null;if(e.is(t,"string")&&t.length>0)try{r=JSON.parse(t)}catch(e){o.error("Error parsing response:",e)}else r=t;e.is(i,"function")&&i(r)},a.onFailure=function(t,i){o.log("Failure loaded the suggest list for : "+i),e.is(r,"function")&&r()},s.authenticatedRequest(a.url,a)},_sendCallbacks:function(e,t){for(var i=e.length,r=0;r<i;r++)e[r].call(void 0,t)},getVocabularyName:function(t){var i={"3dspace":"3DSpace",swym:"3DSwym",drive:"3DDrive"};return e.is(i[t])?i[t]:t},IsClassAnInstance:function(t){this.log("IsClassAnInstance called for "+t);var i=!1,r=t.split(":");if(2===r.length){var s=r[0];if(e.is(this._cacheVocabularyInfo[s])||"ds6wg"==s&&(s=this.getVocabularyName("3dspace")),e.is(this._cacheVocabularyInfo[s])){var n=this._cacheVocabularyInfo[s].info.get(t);e.is(n)&&"Instance"===n.get("type")&&(i=!0)}}return i},updateRootInPredicateLineage:function(t){var i=this.options.resources,r=e.is(i)?i.getActiveTenant():"OnPremise",s=u.getLanguage();return new l(i=>{var n={},a="";n.tenantId=r,n.lang=s,n.onComplete=function(r){e.is(r,"array")&&t.forEach(t=>{const i=r.find(function(e){return e.curi===t.sixw});e.is(i)&&(t.root6w=i.lineage)}),i(t)},n.onFailure=function(){i(t)},e.is(t)?(t.forEach(t=>{var i=t.sixw;e.is(i)&&1===i.split("/").length&&!a.includes(i)&&(a+=a.length>0?","+t.sixw:t.sixw)}),a.length<1?i(t):d.getPropertiesRoots(a,n)):i(t)})},getAllVocabPredicatesInfo:function(e){return this._fedPropertiesPromise[e]||(this._fedPropertiesPromise[e]=new l(function(t,i){d.getFedProperties({tenantId:e,apiVersion:"R2021x",lang:u.getLanguage(),onComplete:function(e){t(e)},onFailure:function(e){i(e)}})})),this._fedPropertiesPromise[e]}});return f}),define("DS/SNInfraUX/TaggerConfigAccess",["UWA/Core","UWA/Promise","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchControlCenterFetchService","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/Logger"],function(e,t,i,r,s,n){"use strict";var a={_tenantPromise:{},_tagColorizationPromises:{},_communityOntologyPromises:{},_OntologyPromises:{},_tagRelationshipPromise:{},get6WTagsColorsConfiguration:function(r){var s=null;if(!r||!r.tenantID)return s;if(!this._tagColorizationPromises[r.tenantID]){this._tagColorizationPromises[r.tenantID]=new t(function(t,n){i.getTenantSettings(r.tenantID).then(function(n){var a=i.getOption("tagColorization",{tenant:r.tenantID});(a=e.is(a)?a.colorization:a)&&(s={},Object.keys(a).forEach(function(e){s[e]=[],Object.keys(a[e]).forEach(function(t){s[e].push({object:t,color:a[e][t]})})})),t(s)},function(){n()})})}return this._tagColorizationPromises[r.tenantID]},get6WTagsConfiguration:function(i){var s=null,n=null,o=null;if(!e.is(i.tenantID)||!e.is(i.appID))return s;if(e.is(i.tenantID)&&e.is(i.appID)){n=i.tenantID,o=i.appID;var c={tenantID:n};a._tenantPromise[n]||(a._tenantPromise[n]={}),a._tenantPromise[n][o]||(a._tenantPromise[n][o]=t.deferred(),r.getSearchSettings(c).then(function(e){s=a._transalateToTaggerFormat(o,e),a._tenantPromise[n][o].resolve(s)},function(e){a._tenantPromise[n][o].reject()}))}return this._tenantPromise[n][o].promise},_transalateToTaggerFormat:function(t,i){var r=null;if(e.is(i)&&(Object.keys(i).length>0&&i.hasOwnProperty("context_apps_predicates"))){var s=i.context_apps_predicates;if(e.is(s,"array"))for(var n=0;n<s.length;n++){var a=s[n];if(r={},t===Object.keys(a)[0]){var o=null,c=null;if(a[t].hasOwnProperty("preferred_predicates")&&(o=a[t].preferred_predicates),a[t].hasOwnProperty("excluded_predicates")&&(c=a[t].excluded_predicates),e.is(o,"array"))for(var l=0;l<o.length;l++){var u={relevant:!0,expanded:!0,weight:100-l};r[o[l].uri]=u}if(e.is(c,"array"))for(var d=0;d<c.length;d++){r[c[d].uri]={relevant:!0,expanded:!0,weight:0}}break}}}return r},getAssociatedOntologies:function(r){if(!r||!r.tenantID||!r.name)return null;let s=r.tenantID+"_"+r.name;if(!this._communityOntologyPromises[s]){this._communityOntologyPromises[s]=new t(function(t,s){i.getTenantSettings(r.tenantID);var n=i.getOption("controlledVocabulary",{tenant:r.tenantID});if(n&&e.is(n,"array"))for(let e=0;e<n.length;e++)if(r&&r.type&&n[e].type==r.type&&r&&r.name&&n[e].name==r.name){t(n[e]);break}})}return this._communityOntologyPromises[s]},getEnterpriseOntology:function(r){let s=this;if(!e.is(r)||!e.is(r.tenantID))return null;n.log("DS/SNInfraUX/TaggerConfigAccess:getEnterpriseOntology",r);let a=r.tenantID;return s._OntologyPromises[a]||(s._OntologyPromises[a]=new t(function(t,s){i.getTenantSettings(r.tenantID);var a=i.getOption("enterprise_ontology",{tenant:r.tenantID});if(a){if(t(a),n.log("DS/SNInfraUX/TaggerConfigAccess:getEnterpriseOntology:resolve",a),e.is(r.onCompleteConceptsOfConcept)){require(["DS/SearchControlCenter/scripts/ControlledOntology/OntologyDatasetsHelpers"],function(e){let t={sessionsId:a[0].sessionId,onComplete:function(e){r.onCompleteConceptsOfConcept.call(void 0,e),n.log("DS/SNInfraUX/TaggerConfigAccess:getEnterpriseOntology:getConceptsOfConcept",e)}};e.getConceptsOfConcept(t)})}}else s()})),s._OntologyPromises[a]},get6WTagsRelationship:function(s){let o=null,c=this;if(!e.is(s)||!e.is(s.tenantID))return o;n.log("DS/SNInfraUX/TaggerConfigAccess:get6WTagsRelationship",s);let l=s.tenantID;if(!c._tagRelationshipPromise[l]){c._tagRelationshipPromise[l]=t.deferred();let s=i.getOption("tagRelationships",{tenant:l});e.is(s)||(s=r.getTagRelationshipDefaultSettings()),e.is(s)?(o=a._transalateToTagRelationshipFormat(s),a._tagRelationshipPromise[l].resolve(o)):a._tagRelationshipPromise[l].reject()}return this._tagRelationshipPromise[l].promise},_transalateToTagRelationshipFormat:function(t){let i=null;if(e.is(t)&&t.hasOwnProperty("activate_tag_relationship")&&!1===t.activate_tag_relationship&&(t=r.getTagRelationshipDefaultSettings()),e.is(t)){if(Object.keys(t).length>0){i={};let r=t;if(r.hasOwnProperty("activate_tag_relationship")&&!0===r.activate_tag_relationship){if(r.hasOwnProperty("tagRelationship_predicates")){let t=r.tagRelationship_predicates;if(e.is(t,"array"))for(let r=0;r<t.length;r++){let s=t[r];if(e.is(s)){if(s.hasOwnProperty("uri")&&s.hasOwnProperty("operator")){let e=s.uri,t={operator:s.operator};i[e]=t}}}}if(r.hasOwnProperty("tagRelationship_IrrelevantOpert")){let t=r.tagRelationship_IrrelevantOpert;if(e.is(t)&&t.hasOwnProperty("irrelevantANDPredicates")){let r=t.irrelevantANDPredicates;if(e.is(r,"array")&&r.length>0)for(let t=0;t<r.length;t++){let s=r[t];if(i.hasOwnProperty(s)){let t=i[s];e.is(t)&&(t.irrelevantOperator=["AND"])}else{let e={irrelevantOperator:["AND"]};i[s]=e}}}}}}}return i}};return a}),define("DS/SNInfraUX/SNUnitConversion",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SNVocabAccess","DS/SNInfraUX/SWFiltering","DS/SNInfraUX/SNPLMDictionary","DS/SNInfraUX/utils/SNPreferenceUtil"],function(e,t,i,r,s,n,a,o,c){"use strict";return t.singleton(r,i,{name:"DS_SNInfraUX_SNUnitConversion",_predicateDimensionName:{},_manipulationUnit:{},init:function(){this.setDebugMode(s.getDebugMode())},setResources:function(e){n.setResources({resources:e}),o.setResources({resources:e})},getPreferredUnitLabelForPredicate:function(e){var t=this,i=e.predicates,r=e.callback,s={};i.forEach(function(e){if(e.startsWith("ds6wg")){var i=t._manipulationUnit[e],r=t._predicateDimensionName[e],n=o.getUnitNLSForDimension(r,i);s[e]=n}}),r(s)},loadManipulationUnitForTypePredicates:function(t,i){var r=this;n.loadRelevantPredicates({className:t},function(s){var n=s.vocabularyPredicateInfo;n&&n.forEach(function(t){var i=e.is(t.lineage)?t.lineage:t.uri,s=t.manipulationUnit;s&&s.trim().length>0&&(r._manipulationUnit[i]=s.trim()),t.dimension&&(r._predicateDimensionName[i]=t.dimension)}),i(t)})},getManipulationUnitForPredicateURI:function(t){var i=this._predicateDimensionName[t];if(i){var r=c.getPreferenceUnitForDimension(i);if(e.is(r))return r.unitInternal}return this._manipulationUnit[t]},getDimensionNameForPredicateURI:function(e){return this._predicateDimensionName[e]},convertValues:function(t){var i=t.data,r=t.callback,n=t.toPreferredUnit,a=t.predicate2Type,l=this,u=function(){var t={},a={},u={Data:[]};Object.keys(i).forEach(function(e){var t=l.getManipulationUnitForPredicateURI(e);if(t){var r,s,a=i[e].join(";"),c=l.getDimensionNameForPredicateURI(e),d=o.getMKSUnitNameForDimensionName(c);n?(r=d,s=t):(r=t,s=d),r!==s&&u.Data.push({UnitFrom:r,UnitTo:s,Dimension:c,Values:a})}});var d=function(){var r=s.getOption("preferredUnit_decimals");Object.keys(i).forEach(function(s){var u=i[s];t[s]={};var d,p=l.getManipulationUnitForPredicateURI(s),h=l.getDimensionNameForPredicateURI(s),g="";if(h&&(d=o.getMKSUnitNameForDimensionName(h)),p){var f=n?d:p,_=n?p:d;if(n){var S=c.getPreferenceUnitForDimension(h);g=e.is(S)?S.unitSymbol:o.getUnitNLSForDimension(h,_)}u.forEach(function(i){var o;a[f]&&(o=a[f][_]);var c=o&&o[i]?1*o[i]:i;n&&e.is(r,"number")&&(c=1*(Math.round(c+"e"+r)+"e-"+r));var l=c;g.length>0&&(l=l+" "+g),t[s][i]=l})}else n&&d&&(g=o.getUnitNLSForDimension(h,d)),i[s].forEach(function(e){var i=e;g.length>0&&(i=i+" "+g),t[s][e]=i})})};u.Data.length>0?o.loadConvertedMKSValues(u,function(e){e.forEach(function(e){var t=e.UnitFrom,i=e.UnitTo,r=e.ValuesToConvert.split(";"),s=e.ConvertedValues.split(";");a[t]||(a[t]={}),a[t][i]||(a[t][i]={});for(var n=a[t][i],o=0;o<r.length;o++)n[r[o]]=s[o]}),d.call(),r(t)}):(d.call(),r(t))},d={},p=function(e){d[e]=!0,Object.keys(d).every(function(e){return d[e]})&&o.loadDictionary().then(u)};Object.keys(i).length>0?(Object.keys(i).forEach(function(t){var i=a[t];e.is(i,"array")?i.forEach(t=>{t.startsWith("ds6wg:")&&(e.is(d[t])||(d[t]=!1,l.loadManipulationUnitForTypePredicates(t,p)))}):i&&i.startsWith("ds6wg:")&&(e.is(d[i])||(d[i]=!1,l.loadManipulationUnitForTypePredicates(i,p)))}),0===Object.keys(d).length&&r({})):r({})}})}),define("DS/SNInfraUX/SearchRevisionDelegator",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SearchPreferences"],function(e,t,i,r,s,n){"use strict";return t.singleton(i,{_revisionImpl:null,_modLoadPromise:null,_revision_options:null,init:function(){},load:function(t){var i=this;require(["DS/RevisionHelper/3DSearchRevisionImpl"],function(r){e.is(t.onLoaded,"function")&&(i._revisionImpl=r,t.onLoaded.call(void 0,r))},function(){})},initialize:function(){var e=this,t={onLoaded:function(t){e._revision_options=t.getRevisionOptions()}};this.load(t)},isRevisioLoaded:function(){return!!e.is(this._revision_options)},getAdditionalQuery:function(t){var i,s=r.getOption("defaultRevision",{tenant:t.tenant}),a=n.getItem("revisionDisplayType");if(e.is(this._revision_options&&e.is(this._revision_options.show_search_results_revision_array,"array"))){var o=this._revision_options.show_search_results_revision_array[0].id;if(e.is(a)||(a=s||o),a){var c=a.id,l=this._revision_options.show_search_results_revision_array;if(e.is(l)&&l.length>0)for(var u=0;u<l.length;u++)c===l[u].id&&(i=l[u])}if(i){var d=Object.keys(i.specific_source_parameter);return e.is(d,"array")?i.specific_source_parameter:null}return null}return""},getOptionsDetails:function(t){var i=this;this.load().then(function(){t&&e.is(i._revisionImpl.getOptionsDetails,"function")&&i._revisionImpl.getOptionsDetails(t)})},isCSVRole:function(e){var t=!1;return this._checkCSVAvailability(e).then(function(){t=!0}),t},_checkCSVAvailability:function(t){var i=this;return r.getOption("search_web_in_win")?(i.CSVpromise.resolve([]),i.CSVpromise.promise):(s.getGrantedRoles(function(r){for(var s=!1,n=0;n<r.length;n++){var a=r[n];if(e.is(a)&&e.is(a.platforms,"array")&&(0===a.platforms.length||a.platforms.indexOf(t)>=0&&"CSV"===a.id)){s=!0;break}}s?i.CSVpromise.resolve(r):i.CSVpromise.reject(r)}),this.CSVpromise.promise)}})}),define("DS/SNInfraUX/utils/SynonymsUtils",["UWA/Core","UWA/Class","UWA/Class/Debug","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchUtils"],function(e,t,i,r,s){"use strict";var n=t.singleton(i,{_synonyms:{},_isSupported:!1,init:function(){var t;try{var i=r.getOption("search_synonyms",{tenant:s.getActiveTenant()});if(!e.is(i))return;t=i.synonyms,this._isSupported=i.activateSnonyms}catch(e){this.log("Error in parsing client side synonyms.")}t&&Object.keys(t).forEach(e=>{t[e].unshift(e),t[e].forEach(i=>{this._synonyms[i]=t[e]})})},isSynonymAvailable:function(t){return e.is(this._synonyms[t])&&e.is(this._synonyms[t],"array")&&this._synonyms[t].length>1},getQueryWithSynonyms:function(t){var i="",r=this._findValue(this._synonyms,t);return e.is(r)&&e.is(r,"array")&&r.length>1?r.forEach((e,t)=>{e.indexOf(" ")>0&&(e='"'+e+'"'),i+=0===t?e:" OR "+e}):i=t,i},_findValue:function(t,i){let r=Object.keys(t).find(e=>0===e.localeCompare(i,"en",{sensitivity:"base"}));if(e.is(r))return t[r].filter(e=>0!==e.localeCompare(i,"en",{sensitivity:"base"}))},isSynonymSupportAvailable:function(){return!0===this._isSupported},_treatWithSynonymsForSources:function(e,t){s.addSourceSpecificParameter(e,{sourceIds:["3dswym"],param:{id:"with_synonyms",value:t}})},treatSynonyms:function(t){let i=this;if("client"===r.getOption("Synonyms_impl_type")){let r=n.getQueryWithSynonyms(t.query);if(r===t.query)return;r="("+r+")";let a=t.source,o=t.specific_source_parameter||{};e.is(a,"array")&&a.length>0&&(a=i._sourcesToTreat(a)).forEach(i=>{let n;e.is(o[i])&&e.is(o[i].additional_query)?(n=o[i].additional_query,n=" OR ("+r+n+")"):n="OR "+r,s.addSourceSpecificParameter(t,{sourceIds:[i],param:{id:"additional_query",value:n}})})}else"server"===r.getOption("Synonyms_impl_type")&&(t.with_synonyms=!0,this._treatWithSynonymsForSources(t,!0))},_sourcesToTreat:function(e){let t=r.getOption("SynonymsSupportBlackList",{tenant:s.getActiveTenant()}),i=r.getOption("SynonymsSupportWhiteList",{tenant:s.getActiveTenant()});return t.length>0?e.filter(e=>!(t.indexOf(e)>=0)):i.length>0?i.filter(t=>e.indexOf(t)>=0):e}});return n}),define("DS/SNInfraUX/SearchRessources",["UWA/Core","UWA/Class","UWA/Class/Options","UWA/Promise","DS/WAFData/WAFData","DS/SNInfraUX/SearchSettings","DS/SNInfraUX/SearchPreferences","DS/SNInfraUX/SearchDebug","DS/SNInfraUX/SearchUtils","DS/SNInfraUX/SWFiltering","DS/WebappsUtils/WebappsUtils","DS/SNInfraUX/SNSearchTypeCusto","DS/SNInfraUX/SearchViewServices","DS/SNInfraUX/SearchLogin","DS/SNInfraUX/Logger","DS/SNInfraUX/SearchRevisionDelegator","DS/SNInfraUX/SearchDataSources","DS/SNInfraUX/PlatformEnvServices","DS/SNInfraUX/utils/SynonymsUtils"],function(e,t,i,r,s,n,a,o,c,l,u,d,p,h,g,f,_,S,v){"use strict";return t.extend(o,i,{uwaClassName:"DS/SNInfraUX/SearchRessources",source_names:["cstorage","hpc","search","swym","tagger"],valid:!1,active_tenant:"",active_role:null,_fedSearchLabel:"",available_services:{fed_search:function(t){var i=t.original_options||{},r=n.getOption("fedSearchTimeout");if(e.is(r)&&(g.log("fedSearchTimeout found, value=",r),!isNaN(r))){var o=+r;o>0&&(i.timeout=1e3*o)}var u=c.SearchTypeEnum.MY_RECENT_CONTENT===t.service_data.query;i.method="POST",i.headers={Accept:"application/json","Content-Type":"application/json"};var _=t.original_options.data||{};if(t.service_data.specific_source_parameter&&(_.specific_source_parameter=t.service_data.specific_source_parameter),u){i.url=this.getFedSearchUrl()+"/recent";var S=n.getOption("Recent_Content_Delta_Time",{tenant:this.getActiveTenant()});_.delta_time_interval=60*S,_.version=2,t.service_data.recent_search&&t.service_data.recent_search.types&&(_.select_type=t.service_data.recent_search.types)}else i.url=this.getFedSearchUrl()+"/search",_.with_indexing_date=!0,_.with_synthesis=!0,e.is(t.service_data.with_synthesis)&&(_.with_synthesis=t.service_data.with_synthesis);_.with_nls=!0,n.getOption("activate_dictionary_NLS_computation")&&(_.with_nls=!1);let m=t.featureId;var y=new Date;e.is(t.service_data)&&e.is(t.service_data.adv_search)&&e.is(t.service_data.adv_search)&&!0===t.service_data.adv_search&&(m=n.getOption("fedsearch_query_label.feature_id.AdvancedSearch")),e.is(t.context_options)&&(m=n.getOption("fedsearch_query_label.feature_id.InContextSearch")),e.is(m)||(m=n.getOption("fedsearch_query_label.feature_id.TopBarSearch")),this._fedSearchLabel="3DSearch-"+c.getUserId()+(m?"-"+m:"")+"-"+y.getTime(),_.label=this._fedSearchLabel,_.locale=c.getLanguage(),i.ajax=s.authenticatedRequest;var D=[];t.context_options&&t.context_options.columns&&(D=e.clone(t.context_options.columns)),t.attributesToRetrieve&&Array.prototype.push.apply(D,t.attributesToRetrieve);D=D.concat(p.getAllSelectClause(!0)),!0===n.getOption("SEARCH_INSTANCES")&&(D=D.concat("ds6wg:isAnInstance")),e.is(t.displayNamePredicates,"array")&&t.displayNamePredicates.length>0&&(D=D.concat(t.displayNamePredicates)),e.is(t.service_data.select_predicate,"array")&&(D=t.service_data.select_predicate);var C=D,I=l.getSelectPredicates();e.is(I,"array")&&(C=I),C.length>0&&(_.select_predicate=C),t.context_options&&(t.context_options.resourceid_in&&(_.resourceid_in=e.clone(t.context_options.resourceid_in)),t.context_options.resourceid_not_in&&(_.resourceid_not_in=e.clone(t.context_options.resourceid_not_in))),!0===n.getOption("synthesis_hierarchical")&&(_.with_synthesis_hierarchical=!0),e.is(t.service_data.with_synthesis_hierarchical)&&(_.with_synthesis_hierarchical=t.service_data.with_synthesis_hierarchical),_.select_file=["icon","thumbnail_2d"],e.is(t.service_data.select_file,"array")&&(_.select_file=t.service_data.select_file);var b={};if(!u){if(_.query=t.service_data.query,"*"===_.query&&(_.query="#all"),t.service_data&&t.service_data.query&&(0===t.service_data.query.indexOf(c.SearchTypeEnum.MY_CONTENT)||t.service_data.queryType===c.SearchTypeEnum.MY_CONTENT||0===t.service_data.query.indexOf("("+c.SearchTypeEnum.MY_CONTENT))){let e=c.getUserId();_.query=t.service_data.query.replace(c.SearchTypeEnum.MY_CONTENT,"(owner:"+e+" OR username:"+e+")");let i=d.getSearchTypeCustoQuery();i.length>0&&c.addSourceSpecificParameter(_,{sourceIds:["3dspace"],param:{id:"additional_query",value:" AND ("+i+")"}})}if(0===t.service_data.query.indexOf(c.SearchTypeEnum.FAVORITE_SEARCH)||t.service_data.queryType===c.SearchTypeEnum.FAVORITE_SEARCH){let e=c.getUserId();_.query=t.service_data.query.replace(c.SearchTypeEnum.FAVORITE_SEARCH,"((owner:"+e+" AND flattenedtaxonomies:types/PLMWspFavoriteSearch) OR flattenedtaxonomies:types/SavedSearch)")}else e.is(t.context_options)&&e.is(t.context_options.precond,"string")&&0<t.context_options.precond.length&&-1===_.query.indexOf(t.context_options.precond)&&(_.query="("+_.query+") AND ("+t.context_options.precond+")");if(e.is(t.service_data.searchInCriteria,"string")&&0<=t.service_data.searchInCriteria.length&&(_.query+=" AND ("+t.service_data.searchInCriteria+")"),e.is(t.service_data.refine,"object")&&e.is(t.service_data.refine.allfilters,"object")){var w=t.service_data.refine.allfilters,P={};for(var O in w)0!==O.indexOf("sixw:")&&(P[O]=w[O]);b=this.treatMyContentRefine(P),e.is(b,"object")&&e.is(b.additionalQuery,"string")&&b.additionalQuery.length>0&&c.addSourceSpecificParameter(_,{sourceIds:["3dspace"],param:{id:"additional_query",value:b.additionalQuery}}),_.refine=P}var A=l.getAdditionalQueryCriteria();e.is(A)&&c.addSourceSpecificParameter(_,{sourceIds:["3dspace"],param:{id:"additional_query",value:" "+A}});var N=l.getSpecificSourceParameter();e.is(N)&&c.addSourceSpecificParameter(_,{sourceIds:[N.source],param:{id:N.parameter,value:N.value}});var U=t.context_options,T=t.service_data&&t.service_data.isAPQSearch,x=t.service_data.adv_search&&e.is(t.service_data.advanced_criteria,"string")&&(t.service_data.advanced_criteria.indexOf("flattenedtaxonomies")>=0||t.service_data.advanced_criteria.indexOf("[ds6w:type]")>=0),E=_.query.indexOf("flattenedtaxonomies")>=0||_.query.indexOf("[ds6w:type]")>=0,F=e.is(t.service_data.refine,"object")&&e.is(t.service_data.refine.allfilters,"object")&&t.service_data.refine.allfilters.hasOwnProperty("ds6w:what/ds6w:type"),R=t.service_data.query.indexOf("#similarity")>=0,L=!0;if(t.context_options&&e.is(t.context_options.show_banned_types)&&(L=t.context_options.show_banned_types),!(U&&L||T||R)){var j="",W=n.getOption("topbar_search_banned_list",{tenant:this.getActiveTenant()});if(!x&&!E&&!F||U&&!L||t.uqlAvailable)if(W&&W.types)Object.keys(W.types).forEach(function(t){var i=e.is(W.types[t])?W.types[t]:[];if("3dspace"===t){var r=n.getOption("topbar_search_banned_types_21xFD05_tactical");e.is(r,"array")&&r.forEach(function(e){i.indexOf(e)<0&&i.push(e)}),j=this._create3DSpaceBannedTypeQuery(i)}else j=this._createBannedTypeQuery(i);j.length>0&&c.addSourceSpecificParameter(_,{sourceIds:[t],param:{id:"additional_query",value:j}})}.bind(this));if("OnPremise"!==this.active_tenant&&c.SearchTypeEnum.MY_CONTENT!==t.service_data.query){var M=n.getOption("topbar_search_banned_list"),V=[];if(e.is(M)&&e.is(M.users)&&(V=M.users["3dspace"]),e.is(V,"array")&&V.length>0){j=" AND NOT (";for(var X=0;X<V.length;X++)j+='owner:"'+V[X]+'"',X<V.length-1&&(j+=" OR ");(j+=")").length>0&&c.addSourceSpecificParameter(_,{sourceIds:["3dspace"],param:{id:"additional_query",value:j}})}}}var k,q=t.service_data.update_incontext_options;if(q){if(q.precond&&q.precond.length>0&&(_.query="("+_.query+") AND ("+q.precond+")"),e.is(q.resourceid_in,"array")&&q.resourceid_in.length>0){var B=_.resourceid_in,J=q.resourceid_in;_.resourceid_in=!e.is(B)||e.is(B,"array")&&B.length<1?J:J.filter(function(e){return B.includes(e)}),_.resourceid_in.length<1&&(_.resourceid_in=[""])}if(e.is(q.resourceid_not_in,"array")&&q.resourceid_not_in.length>0){var Q=_.resourceid_not_in||[],H=q.resourceid_not_in;_.resourceid_not_in=H.concat(Q.filter(function(e){return!H.includes(e)}))}}if(k=e.is(t.context_options)&&e.is(t.context_options.irrelevant_tags,"array")&&t.context_options.irrelevant_tags.length>0?t.context_options.irrelevant_tags:n.getOption("irrelevant_tags",{tenant:this.getActiveTenant()}),e.is(k,"array")&&k.length>0){e.is(_.select_exclude_synthesis,"array")||(_.select_exclude_synthesis=[]);for(var G=0;G<k.length;G++){var z=k[G];-1===_.select_exclude_synthesis.indexOf(z)&&_.select_exclude_synthesis.push(z)}}if(e.is(t.select_exclude_synthesis,"array")&&t.select_exclude_synthesis.length>0&&(e.is(_.select_exclude_synthesis,"array")?_.select_exclude_synthesis=_.select_exclude_synthesis.concat(t.select_exclude_synthesis):_.select_exclude_synthesis=t.select_exclude_synthesis),e.is(t.select_exclude_synthesis,"array")&&t.select_exclude_synthesis.length>0&&t.select_exclude_synthesis.indexOf("ds6w:dataSource")>=0)!e.is(k,"array")||k.indexOf("ds6w:dataSource")>=0||_.select_exclude_synthesis.push("ds6w:dataSource");else if(e.is(k,"array")&&-1!==k.indexOf("ds6w:dataSource")){var K=c.getSourceToPredicateMapping();if(e.is(K,"array"))for(let t=0;t<K.length;t++){let i=K[t];e.is(i,"object")&&e.is(i.predicate,"string")&&-1===_.select_exclude_synthesis.indexOf(i.predicate)&&_.select_exclude_synthesis.push(i.predicate)}}this._addOrderInfo(t,_),e.is(_.specific_source_parameter)&&e.is(t.service_data.context)?this.mergeRecursive(_.specific_source_parameter,t.service_data.context.specific_source_parameter):e.merge(_,t.service_data.context);var Y=f.getAdditionalQuery({tenant:this.active_tenant});if(e.is(Y)){var $=Object.keys(Y),Z=Object.values(Y);for(let e=0;e<$.length;e++)c.addSourceSpecificParameter(_,{sourceIds:[$[e]],param:{id:"additional_query",value:Z[e].additional_query}})}var ee=null;if(n.getOption("rangeValuesClassification")&&(ee={with_synthesis_ranged:n.getOption("rangeValuesClassification"),enable_mono_sixw:!1}),!0===n.getOption("activate_hierarchical_tag_depth")){var te=n.getOption("hierarchical_predicates",{tenant:this.active_tenant});if(e.is(te)&&!0===te.specify_hierarchical_predicates&&e.is(te.hierarchical_predicates,"array")){var ie=n.getOption("default_deep_hierarchy_tag_depth"),re=n.getOption("default_deep_hierarchy_tag_width"),se=n.getOption("max_deep_hierarchy_tags"),ne={},ae=0;te.hierarchical_predicates.forEach(function(t,i){if(ae<se){var r=t.uri,s=t.depth||ie,n=t.width||re;ne[r]={depth:s},e.is(n)&&(ne[r].width=n),ae++}}),(ee=ee||{}).facet_params=ne}}if(ee&&c.addSourceSpecificParameter(_,{sourceIds:["3dspace"],param:{id:"option",value:ee}}),!0===n.getOption("add_taxonomies_in_select_clause")&&e.is(_.select_predicate,"array")&&_.select_predicate.push("taxonomies"),!0===c.isSnippetAvailable(this.getActiveTenant())){var oe=n.getOption("select_snippets");if(e.is(oe)&&e.is(oe,"object")){var ce=Object.keys(oe).map(function(e){return oe[e]});e.is(ce,"array")&&(_.select_snippets=ce)}}e.is(t.service_data.select_snippets,"array")&&(_.select_snippets=t.service_data.select_snippets),_.nresults=""+t.state.pageSize,void 0===t.state.next_start?_.start="0":_.next_start=t.state.next_start,e.is(t.service_data.in_ctx_role)&&n.getOption("activate_default_role")?_.user_ctx=t.service_data.in_ctx_role:n.getOption("activate_default_role")&&(_.user_ctx=n.getOption("default_user_ctx")),this.addInstanceSearchParam(_)}if(t.service_data.query.indexOf("#similarity")>=0?_.source=["onepart"]:e.is(t.service_data.isAPQSearch)?_.source=["3dspace"]:t.service_data.queryType===c.SearchTypeEnum.FAVORITE_SEARCH?_.source=["3dspace"]:e.is(t.service_data.source)?_.source=t.service_data.source:e.is(t.source)?_.source=t.source:e.is(_.source)||(_.source=[]),e.is(b,"object")&&!0===b.isRefineOnlyFavorite&&(_.source=["3dspace"]),0===_.source.length){var le=h.getAvailableSources(this.active_tenant);if(e.is(le)&&0<le.length&&!c.isInTheSimpleSearch({tenant:this.active_tenant})){var ue=n.getOption("exclusiveDataSourcesForSSE",{tenant:this.active_tenant});e.is(ue)&&0<ue.length&&(le=le.filter(function(e){return-1===ue.indexOf(e.name)})).forEach(function(e){_.source.push(e.name)})}}t.service_data.ignoreRestrictedSources||this._removeRestrictedSources(_);var de=c.getChosenDataSource();if(c.setActiveDataSource(_.source),de.length>0?_.source=de:(de=a.getItem("dataSource"),e.is(de)&&de.length>0?_.source=de:de=_.source),e.is(t.context_options)&&e.is(t.context_options.source)&&t.context_options.source.length>0&&!t.hasfilterToSourceQueryTransformed&&(_.source=t.context_options.source),e.is(_.source,"array")&&(0===_.source.length||_.source.indexOf("drive")>=0)){var pe=' AND NOT ([flattenedtaxonomies]:"types/DriveNode" AND ( [current]:"Trashed" OR [policy]:"Drive File Iteration") )';e.is(pe)&&c.addSourceSpecificParameter(_,{sourceIds:["drive"],param:{id:"additional_query",value:pe}})}e.is(_.source,"array")&&_.source.length>0&&_.source.indexOf("other")>=0&&(_.source=this._getOtherRDFDataSources()),c.getGrantedRoles(function(t){for(var i=!1,r=0;r<t.length;r++){var s=t[r];if(e.is(s)&&e.is(s.platforms,"array")&&"Operator"===s.id){i=!0;break}}if(e.is(_.source,"array")&&!i&&(0===_.source.length||_.source.indexOf("swym")>=0)){c.addSourceSpecificParameter(_,{sourceIds:["swym"],param:{id:"additional_query",value:' AND NOT (([ds6w:type]:"pno:Person") AND (ut_state:0))'}})}});var he=n.getOption("data_predicates");if(Object.keys(he).forEach(function(e){if(_.source.indexOf(e)>=0||0==_.source.length){var t=he[e];_.select_predicate=_.select_predicate.concat(t)}}),_.select_predicate=_.select_predicate.filter(function(e,t,i){return t===i.indexOf(e)}),n.getOption("enablePLM",{tenant:this.getActiveTenant()})&&!0===t.service_data.adv_search&&e.is(t.service_data)&&e.is(t.service_data.refine)&&e.is(t.service_data.refine.PLMParameters)&&e.is(t.service_data.refine.PLMParameters.plmparam)&&0!==Object.keys(t.service_data.refine.PLMParameters.plmparam).length){var ge={"3dspace":t.service_data.refine.PLMParameters};_.specific_source_parameter=ge}if(_.tenant=this.active_tenant,e.is(this.active_role)){let e={"3dspace":{SecurityContext:this.active_role}};_.login=e}else{let t=c.identifyClientInfo();if("3DSpace"===t.identifier){let t=[];t=c.getSecurityContext3DSpace(),e.is(t,"array")&&t.forEach(function(t){if(e.is(t.isDefault)&&!0===t.isDefault){let e={"3dspace":{SecurityContext:t.name}};_.login=e}})}else if("3DDashboard"===t.identifier){var fe=a.getItem("securityContext"+this.active_tenant);if(e.is(fe)){let e={"3dspace":{SecurityContext:JSON.parse(fe).name}};_.login=e}else{let t=[];t=c.getSecurityContext3DSpace();let i=!1;if(e.is(t,"array")&&(t.forEach(function(t){if(e.is(t.isDefault)&&!0===t.isDefault){let e={"3dspace":{SecurityContext:t.name}};_.login=e,i=!0}}),!1===i&&t.length>0)){let e={"3dspace":{SecurityContext:t[0].name}};_.login=e}}}}if(!1===_.with_synthesis&&_.refine){var _e=c.getQueryFromRefines(_.refine);_e&&(_.query="("+_.query+") AND ("+_e+")",delete _.refine)}if(v.isSynonymSupportAvailable()&&!e.is(t.context_options)&&v.treatSynonyms(_),i.data=_,this.is_odt_source()){var Se=i.onComplete,ve=i.onFailure;(i={}).method="GET",i.headers={Accept:"application/json"},i.auth={},i.proxy="",i.url=t.service_data.query,e.is(Se,"function")&&(i.onComplete=Se),e.is(ve,"function")&&(i.onFailure=ve)}return(n.getOption("ODTLogs")||n.getOption("ODTLogs-FederatedSearchOptions"))&&g.warn("ODTLogs-FederatedSearchOptions:"+JSON.stringify(i)),i},logOut:function(e){var t=e.original_options||{};return t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.getFedSearchUrl()+"/logout",t},getSavedSearches:function(e){let t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearches",t.data={page:1,pageSize:"all"},t},saveSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"};var i=c.getSecurityContext();i&&i.trim().length>0&&(t.headers.SecurityContext=i),t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/saveSearch";var r=e.service_data||{};return t.data=JSON.stringify(r),t},renameSavedSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/updateSearch";var i=e.service_data||{};return t.data=JSON.stringify(i),t},runSavedSearch:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearch",t.data="id="+e.service_data.id,t},deleteSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json, application/xml","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/deleteSearch";var i=e.service_data||{};return t.data=JSON.stringify(i),t},shareSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json, application/xml","Content-Type":"application/json"};var i=c.getSecurityContext();i&&i.trim().length>0&&(t.headers.SecurityContext=i),t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearch/lifecycle/share";var r=e.service_data||{};return t.data=JSON.stringify(r),t},unshareSearch:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json, application/xml","Content-Type":"application/json"};var i=c.getSecurityContext();i&&i.trim().length>0&&(t.headers.SecurityContext=i),t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_services/savedSearch/lifecycle/unshare";var r=e.service_data||{};return t.data=JSON.stringify(r),t},lastObjects:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/AppsMngt/user/objects",t},actions_for_results:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/SNAPI/search_delegation/actions";var i=e.service_data||{};return t.data=JSON.stringify(i),t},fed_search_odt:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json"},t.auth={},t.proxy="",t.url=e.service_data.url,t},loginToSources:function(e){var t=e.original_options||{};return t.method="GET",t.headers={Accept:"application/json","Content-Type":"application/json"},t.data={tenant:this.active_tenant},t.url=this.getFedSearchUrl()+"/login",t},listAvailablePamameters:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.getFedSearchUrl()+"/search/suggestresult";var i=e.service_data||{};return i.tenant=this.active_tenant,t.data=JSON.stringify(i),t},listSuggestPamameters:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.getFedSearchUrl()+"/search";var i=e.service_data||{};return i.tenant=this.active_tenant,this.addInstanceSearchParam(i),t.data=JSON.stringify(i),t},getConvertedMKSValues:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/dictionary/dimensions/convertValues";var i=e.service_data||{};return i.tenant=this.active_tenant,t.data=JSON.stringify(i),t},getRelevantInterfaces:function(e){var t=e.original_options||{};t.method="POST",t.headers={Accept:"application/json","Accept-Language":c.getLanguage(),"Content-Type":"application/json"},t.url=this.get3DSpaceUrl()+"/resources/dictionary/class/interfaces";var i=e.service_data||{};return t.data=JSON.stringify(i),t},listDimensions:function(e){var t=e.original_options||{};return t.method="GET",t.headers={"Accept-Language":c.getLanguage(),Accept:"application/json"},t.url=this.get3DSpaceUrl()+"/resources/dictionary/dimensions",t},getSecurityContext:function(e){var t=e.original_options||{};return t.method="GET",t.headers={"Accept-Language":c.getLanguage(),Accept:"application/json"},t.url=this.get3DSpaceUrl()+"/resources/pno/person/getsecuritycontext",t},loadPQData:function(e){var t=this,i=e.original_options||{};return c.isRoleAvailable(["CSV"],this.active_tenant,function(e){!0===e?(i.method="GET",i.headers={"Accept-Language":c.getLanguage(),Accept:"application/json"},i.data={tenant:t.active_tenant},i.url=t.get3DSpaceUrl()+"/resources/SNAPI/pq_services/pqs?lang="+c.getLanguage()):i.url=void 0}),i}},addInstanceSearchParam:function(e){var t=n.getOption("SEARCH_INSTANCES",{tenant:this.getActiveTenant()});!0===t&&c.addSourceSpecificParameter(e,{sourceIds:["3dspace"],param:{id:"option",value:{with_Idx_Search:t,with_relationship_search:t}}})},_createBannedTypeQuery:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND NOT ([ds6w:type]:(";for(var r=0;r<t.length;r++){var s=t[r];s.startsWith("ds6w:")&&(s=s.substring(5)),i+='"'+s+'"',r<t.length-1&&(i+=" OR ")}i+="))"}return i},_create3DSpaceBannedTypeQuery:function(t){var i="";if(e.is(t,"array")&&t.length>0){i+=" AND NOT (flattenedtaxonomies:(";for(var r=0;r<t.length;r++){var s=t[r];s.startsWith("ds6wg:")&&(s=s.substring(6)),i+='"types/'+s+'"',r<t.length-1&&(i+=" OR ")}i+="))"}return i},init:function(t,i){if(this.setDebugMode(n.getOption("debug_mode")),this._reset_internals(),!e.is(t))throw new Error("SearchRessources:init called without valid options!");e.is(t.platforms)&&c.setPlatforms(t.platforms),S.setEnvironments(t);let r=null;if(e.is(t.active_tenant))r=t.active_tenant;else if(e.is(t.x3dplatformid))r=t.x3dplatformid;else{let t=a.getItem("defaultTenantId");e.is(t,"string")&&t.length>0&&(r=t)}if(!e.is(r,"string")||!S.tenantExists(r)){let t=S.getAvailableTenantsForSearch();e.is(t,"array")&&t.length>0&&e.is(t[0],"object")&&e.is(t[0].tenantId,"string")&&(r=t[0].tenantId)}S.tenantExists(r)&&(this.setActiveTenant(r),this.valid=!0),c.initSecurityContext3DSpace(this),e.is(i,"function")&&i.call(this,{})},_addOrderInfo:function(t,i){e.is(t.service_data.order_field)&&""!==t.service_data.order_field&&e.is(t.service_data.order_by)&&""!==t.service_data.order_by.length?(i.order_by=t.service_data.order_by,i.order_field=t.service_data.order_field):(i.order_by="desc",i.order_field="relevance")},mergeRecursive:function(t,i){for(var r in i)i.hasOwnProperty(r)&&(e.is(t[r],"array")?t[r]=t[r].concat(i[r]):e.is(t[r],"object")&&e.is(i[r],"object")?this.mergeRecursive(t[r],i[r]):t[r]||(t[r]=i[r]))},treatMyContentRefine:function(t){var i={};if(t.hasOwnProperty("ds6w:what/ds6w:category")){for(var r=e.clone(t["ds6w:what/ds6w:category"]),s=!1,n=!1,a=!1,o=r.length-1;o>=0;o--)"#myFavoriteSearches"===r[o].object?(s=!0,r.splice(o,1)):"#myFavoriteContent"===r[o].object?(n=!0,r.splice(o,1)):"#myOtherContent"===r[o].object&&(a=!0,r.splice(o,1));var c="";(s||n||a)&&(!s||n||a?!n||s||a?!a||s||n?n&&s&&!a?c+=" AND ([ds6w:type]:PLMWspFavoriteSearch OR [ds6w:type]:SavedSearch OR [ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)":n&&a&&!s?c+=" AND NOT [ds6w:type]:PLMWspFavoriteSearch AND NOT [ds6w:type]:SavedSearch":s&&a&&!n&&(c+=" AND NOT ([ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)"):c+=" AND NOT ([ds6w:type]:PLMWspFavoriteSearch OR [ds6w:type]:SavedSearch OR [ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)":c+=" AND ([ds6w:type]:PLMWspFavoriteAuthoring OR [ds6w:type]:PLMWspFavoriteNavigation)":c+=" AND ([ds6w:type]:PLMWspFavoriteSearch OR [ds6w:type]:SavedSearch)"),0===r.length&&delete t["ds6w:what/ds6w:category"],i.additionalQuery=c,i.isRefineOnlyFavorite=!1===a&&(!0===s||!0===n)}return i},PredicatesNLSNames:function(t,i){var r=this;!function(t){if(e.is(t,"array")){var s=r.getActiveTenant(),n=c.getLanguage();i({tenantId:s,lang:n})}}([])},getFetchOptions:function(e){e.original_options;var t=e.service_name;if(!(t in this.available_services))throw new Error("Unknown federated service "+t);return this.log("getFetchOptions for service "+t),this.available_services[t].call(this,e)},setActiveTenant:function(e){if(!S.tenantExists(e)&&"3DDashboard"!==e)throw g.warn("Unknown tenant "+e),new Error("Unknown tenant "+e);this.active_tenant=e,c.initSecurityContext3DSpace(this)},getActiveTenant:function(){return this.active_tenant},toJSON:function(){return{active_tenant:this.active_tenant,available_tenants:S.getAllTenants()}},getAvailableTenants:function(){return S.getAvailableTenantsForSearch()},getTenantDisplayName:function(e){return S.getTenantDisplayName(e)},get3DSpaceUrl:function(){return S.getServiceURL("cstorage",this.active_tenant)},getFedSearchUrl:function(t){let i="",r=e.is(t,"string")?t:this.active_tenant;return i=S.getServiceURL("search",r),e.is(i)&&-1===i.lastIndexOf("/federated")&&(i+="/federated"),i},getVocabularyUrl:function(){let t=this.get3DSpaceUrl();return e.is(t,"string")||(t=S.getServiceURL("tagger",this.active_tenant)),t},is_odt_source:function(t){let i=!1;if(!0===n.getOption("odt_active",!0))i=!0;else{let r=S.getAllTenants(),s=!1;e.is(this.active_tenant,"string")&&this.active_tenant.length>0&&e.is(r)&&e.is(r[this.active_tenant])&&e.is(r[this.active_tenant].sources)&&(s=e.is(t)&&e.is(r[this.active_tenant].sources[t])?r[this.active_tenant].sources[t].odt:!!e.is(r[this.active_tenant].sources.search)&&r[this.active_tenant].sources.search.odt),i=!!e.is(s)&&s}return i},_reset_internals:function(){this.valid=!1,this.active_tenant=""},getFedSearchLabel:function(){return this._fedSearchLabel},getServicewithRole:function(t,i){var r=this;!function(s){if(e.is(s,"array")){var n=t.tenantId;e.is(n)||(n=r.getActiveTenant());var a=c.getLanguage();i({tenantId:n,lang:a})}}([])},getSuggestions:function(t,i){var r=this;if(!e.is(t,"object")||!e.is(t.query,"string")||t.query.indexOf(":")>0)return!1;e.is(t.input,"array")&&t.input.length>0&&t.input.pop();var n=this.getFedSearchUrl()+"/suggest",a=c.getSecurityContext(),o={method:"GET",data:{query:t.query,SecurityContext:a&&a.trim().length>0?a:void 0,tenant:this.active_tenant,field:"ds6w:label"},headers:{"Accept-Language":c.getLanguage(),Accept:"application/json"},onComplete:function(s){return s&&(s=JSON.parse(s)),e.is(s,"object")?i(r._prioritizeSuggestions(s,t.query)):i([])},onFailure:function(e){return g.error(e),i([])}};!0===c.isSuggestAvailable(this.getActiveTenant())?s.authenticatedRequest(n,o):o.onComplete()},_prioritizeSuggestions:function(t){var i=t,r=["swym","drive","3dspace","dashboard"],s=[],o=n.getOption("suggest_max_display");e.is(o)||(o=7),!0!==a.getItem("InstantSearchSCC")||e.is(a.getItem("InstantSearch"))&&!0!==a.getItem("InstantSearch")||(o=2);var c=!1;e.is(n.getOption("search_compact_mode"))&&!0===n.getOption("search_compact_mode")&&(o=n.getOption("suggest_max"));for(var l=0;l<o;l++)r.forEach(function(t){if(c=!1,e.is(i[t])&&e.is(i[t].entries)&&l<i[t].entries.length&&s.length<o){var r=i[t].entries[l],n=r.entry;if(0===s.length)s.push(r);else{for(var a=0;a<s.length;a++)if(s[a].entry===n){c=!0;break}!1===c&&s.push(r)}}});return s},setSecurityContext:function(e){this.active_role=e},getUserPicture:function(t){if(!e.is(t))throw new Error("Invalid argument in getUserPicture. No options provided");let i=u.getWebappsAssetUrl("SNResultUX","images/anonymized_34x34.png");if(e.is(this.active_tenant,"string")){let r=S.getServiceURL("swym",this.active_tenant);e.is(r,"string")&&(i="{0}/api/user/getpicture/login/{1}/format/{2}".format(r,t.login,t.format))}return i},_removeRestrictedSources:function(t){var i=n.getOption("restrictedSourcesForTopBarSearch");if(e.is(i,"array")&&i.length>0){var r=h.getAvailableSources(this.active_tenant);e.is(r,"array")&&r.length>0&&(0===t.source.length?(r=r.filter(function(e){return-1===i.indexOf(e.name)&&!0===e.status})).forEach(function(e){t.source.push(e.name)}):t.source.length>0&&(t.source=t.source.filter(function(e){return-1===i.indexOf(e)})))}},_getOtherRDFDataSources:function(){var t=[],i=h.getAvailableSources(this.active_tenant);if(e.is(n.getOption("RDFDataSources"))){var r=Object.keys(n.getOption("RDFDataSources"));e.is(r,"array")&&r.length>0&&(i=i.filter(function(e){return-1<r.indexOf(e.name)&&!0===e.status})).forEach(function(e){t.push(e.name)})}return t}})});