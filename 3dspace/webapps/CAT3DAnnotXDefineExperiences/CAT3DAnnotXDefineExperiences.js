define("DS/CAT3DAnnotXDefineExperiences/CATDIFAnnotationSetExperience",["DS/3DPlayExperienceModule/PlayExperience3D","DS/CAT3DAnnotPlayServices/CAT3DAnnotPlayServices","DS/Visualization/ThreeJS_DS","DS/CATWebUXComponents/CATWebUXUtils","DS/CAT3DAnnotationController/CAT3DAnnotBaseControllerInstance","DS/CAT3DAnnotationModelLoader/CAT3DAnnotationModelLoader","DS/CAT3DAnnotationController/CAT3DAnnotationController","DS/CAT3DAnnotationBaseCmds/controllers/CAT3DAnnotationBrowserController","DS/DibUDLWebLoader/CATDibUDLWebLoaderForAnnotationSet","DS/PADUtils/PADUtilsServices","DS/CoreEvents/Events","DS/PADUtils/PADSettingsMgt"],function(e,t,n,i,o,r,a,s,l,d,A,C){"use strict";var c;return e.extend({init:function(e){var D=this;let u,p,w,h;const m={};this.internalLoad=function(e){if(D.pad3DViewer&&e&&e.asset){(new l).getProductIDAssociatedToAnnotationSet({physicalid:e.asset.physicalid,serverUrl:d.get3DSpaceUrl(),securityContext:C.getSetting("pad_security_ctx"),onComplete:function(e){e&&D.pad3DViewer.addRoots({objects:[{path:[e]}]})}})}},this.internalClear=function(){h&&(h.ctxViewer=D.pad3DViewer,t.cleanSelAndPrefMgrs(h));var e=a.giveAnnotationController({context:D.pad3DViewer});w&&e&&e.unsubscribe(w),c&&e&&e.saveLastFTAViewOrCaptureDisplayed(!0),a.unreferenceAnnotationController({context:D.pad3DViewer}),c||r.unreferenceAnnotationModelLoader({context:D.pad3DViewer}),s.unreference3DAnnotBrowserController({context:D.pad3DViewer}),D.pad3DViewer.getFrameWindow()&&D.pad3DViewer.getFrameWindow().getContextualUIManager().unregister("CATDIFAnnotationSetExperience"),p=null,u=null,c=!1,w=null,m.annotationSetPhyID=null,m.type=null},this.internalRefresh=function(){D.internalClear()},this.internalPostCreate=function(){let e;D.autoReframe=!1,u=new o({ctxViewer:D.pad3DViewer}),w=u.subscribe("onSlideShowActiveStateModified",function(e){A.publish({event:e.state?"3DPLAY/SPECTREE/DISABLE":"3DPLAY/SPECTREE/ENABLE",data:{}}),D._enableCMenu=!e.state}),a.registerAnnotationController({annotController:u,context:D.pad3DViewer}),(p=r.getAnnotationModelLoader({context:D.pad3DViewer})).setActiveState(1),u.setActiveState(!0),s.get3DAnnotBrowserController({context:D.pad3DViewer,defaultDockingSide:"left"}).setActiveState(!0),h=t.initSelAndPrefMgrs({ctxViewer:D.pad3DViewer});D.frmWindow.getContextualUIManager().register({subscriberId:"CATDIFAnnotationSetExperience",workbenchName:"CATDIFAnnotationSetExperience",context:D.pad3DViewer.getCommandContext(),cmdPrefix:"",module:"CAT3DAnnotXDefineExperiences",merge:!0,onContextualMenuReady:function(e,t){var o=[];if(t&&t.XmousePosition){var r=new n.Vector2(t.XmousePosition,t.YmousePosition),a=D.frmWindow.getViewer().getMousePosition(r);0===D.frmWindow.getViewer().pick(a,"mesh",!0).path.length&&(i.isMobile()||(o=[{line:1,name:"CATDIFAnnotationSetExperienceDisplaySubMenu",resourceFile:"CAT3DAnnotationBaseCmds/CAT3DAnnotationBaseCmds",hdr_list:["VisuQMCommand"]}]),o=o.concat([{line:1,name:"CATDIFAnnotationSetExperienceAmbiencesSubMenu",resourceFile:"CAT3DAnnotationBaseCmds/CAT3DAnnotationBaseCmds",hdr_list:["VisuPureWhiteOCACmd","VisuWhiteMirrorOCACmd","VisuWhiteReviewOCACmd","VisuWhiteExperienceOCACmd","VisuStudioOCACmd","VisuDarkMirrorOCACmd","VisuDarkReviewOCACmd","VisuWhiteDesignOCACmd","VisuBlueDesignOCACmd","VisuDarkDesignOCACmd","VisuIndoorOCACmd","VisuCityOCACmd","VisuRoadOCACmd","VisuOutdoorOCACmd","VisuBasicOCACmd"]}]))}return{cmdList:o}},onContextualBarReady:function(){return e||(e=u.onAdditionalInfosRequired({controller:"AnnotScenario"}).getSelectedAnnotationsVisibilityFlag),t.getContextualCommandList({ctxViewer:D.pad3DViewer,getSelectedAnnotationsVisibilityFlag:e})}})},e.commandApplication=!1,e.workbenchs=e.workbenchs||[],e.workbenchs.push({name:"CATDIFAnnotationSetExperience",module:"CAT3DAnnotXDefineExperiences"}),e.workbenchs.push({name:"3DPlayShare.xml",module:"3DPlay"}),this._parent(e)},onPostCreate:function(){this.pad3DViewer.getViewer().setPrePicking({activated:!0,displayHL:!0}),window.widget.setMetas({helpPath:"CAT3DAnnotXDefineExperiences/assets/help"}),window.widget.dispatchEvent("onPlayExperienceReady",[{pad3DViewer:this.pad3DViewer}]),this.internalPostCreate&&this.internalPostCreate()},dispose:function(e){window.widget.setMetas({helpPath:void 0}),this.internalClear&&this.internalClear(),this._parent(e)},refresh:function(){this.internalRefresh&&this.internalRefresh()},loadAsset:function(e){e&&e.asset&&e.asset.physicalid&&this.internalLoad&&(this.clearView(),this.internalLoad(e))},acceptSwitch:function(e){return!(!e||!e.options||"ENOR3D_AP"!==e.options.id&&"CATC3D_AP"!==e.options.id&&"CATA3I_AP"!==e.options.id&&"ENOR3V_AP"!==e.options.id&&"ENOR3R_AP"!==e.options.id)&&(c="CATC3D_AP"!==e.options.id,!0)}})});