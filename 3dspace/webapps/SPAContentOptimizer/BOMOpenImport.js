/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/BOMOpenImport",["DS/CSICommandBinder/CSICommandBinder","DS/SPAContentOptimizer/COBOMFcsId","DS/SPAContentOptimizer/COProductStructure"],function(n,s,e){"use strict";var t=new n.Parameters,i=function(s){this._node=s,this._nodeId=null,this._DocId=-1,this.onOpenResult=null,this.onProgress=null,this.onMissingFiles=null,this.onErrors=null,this.onInfo=null,this.onAsm=null,this.onAssembly=null,this.onBOMResponses=null,this._serverRequest=null,this._responseOpen=new n.Response,this._responseImport=new n.Response};return i.prototype={constructor:i,callbackOpen:function(n){this._responseOpen.callDomains(n)},callbackImport:function(n){this._responseImport.callDomains(n)},onAnswerOpenResult:function(n){var s=n.readString("Result"),e=n.readInt16("Document");if(null!=this.onOpenResult&&"function"==typeof this.onOpenResult){var t="Success"==s&&0<=e;this.onOpenResult(t)}this._DocId=e},onAnswerProgress:function(n){if(null!=this.onProgress&&"function"==typeof this.onProgress){var s=n.readDouble("Progress");this.onProgress(s)}},onAnswerErrors:function(n){if(null!=this.onErrors&&"function"==typeof this.onErrors){var s=n.readString("CommandName"),e=n.readStringArray("Errors");this.onErrors(s,e)}},onAnswerMissingFiles:function(n){if(null!=this.onMissingFiles&&"function"==typeof this.onMissingFiles){var s=n.readStringArray("FilePaths");this.onMissingFiles(s)}},OnAnswerInfo:function(n){if(null!=this.onInfo&&"function"==typeof this.onInfo){var s=n.toJSObject();this.onInfo(s)}},OnAnswerAsm:function(n){if(null!=this.onAsm&&"function"==typeof this.onAsm){var s=n.toJSObject();this.onAsm(s)}if(null!=this.onAssembly&&"function"==typeof this.onAssembly){var e=n.readObject("AsmObject","COProductStructure");this.onAssembly(e)}},OnBOMResponses:function(n){if(null!=this.onBOMResponses&&"function"==typeof this.onBOMResponses){var s=n.readUint32("RefId"),e=n.readString("Part"),t=n.readString("Cgr"),i=n.readString("Png"),o=n.readBool("PartOk"),r=n.readBool("CgrOk"),l=n.readBool("PngOk");this.onBOMResponses(s,e,t,i,o,r,l)}},initOpenRequest:function(){return this._nodeId=this._node.select("ContentOptimizer"),this._responseOpen.onAnswerDomain("OpenResult",this.onAnswerOpenResult.bind(this)),this._responseOpen.onAnswerDomain("Info",this.OnAnswerInfo.bind(this)),this._responseOpen.onAnswerDomain("Asm",this.OnAnswerAsm.bind(this)),this._responseOpen.onAnswerDomain("MissingFiles",this.onAnswerMissingFiles.bind(this)),this._responseOpen.onAnswerDomain("Errors",this.onAnswerErrors.bind(this)),null!=this.onProgress&&"function"==typeof this.onProgress&&(this._node.subscribe(this._nodeId,"Progress",this._responseOpen),this._responseOpen.onAnswerDomain("Progress",this.onAnswerProgress.bind(this))),this._node.createRequest({destinationNodeId:this._nodeId,command:"BOMOpen",version:1,onComplete:this.callbackOpen.bind(this)})},open:function(s,e){var i=!1,o=this.initOpenRequest();if(null!=o){this._serverRequest=o;var r=new n.Parameters;r.writeString("InputFileName",s),r.writeString("InputFileUrl",e),o.send(t,r,t),i=!0}return i},importPart:function(s,e,i,o,r){var l=!1;this._responseImport.onAnswerDomain("BOMResponses",this.OnBOMResponses.bind(this)),this._responseImport.onAnswerDomain("Errors",this.onAnswerErrors.bind(this));var h=this._node.createRequest({destinationNodeId:this._nodeId,command:"BOMImportPart",version:1,onComplete:this.callbackImport.bind(this)});if(null!=h){this._serverRequest=h;var u=new n.Parameters;u.writeInt16("Document",this._DocId),u.writeUint32("RefId",s),u.writeString("ConfigName",e),null!=i&&u.writeObject("PartFcsId","COBOMFcsId",i),null!=o&&u.writeObject("CgrFcsId","COBOMFcsId",o),null!=r&&u.writeObject("PngFcsId","COBOMFcsId",r),h.send(t,u,t),l=!0}return l},close:function(){var s=!1,e=this._node.createRequest({destinationNodeId:this._nodeId,command:"BOMClose",version:1,onComplete:this.callbackOpen.bind(this)});if(null!=e){this._serverRequest=e;var i=new n.Parameters;i.writeInt16("Document",this._DocId),e.send(t,i,t),s=!0}return s}},i});