/*!  Copyright 2020 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/coptExport",["DS/CSICommandBinder/CSICommandBinder","DS/SPAContentOptimizer/COptExportOption","DS/SPAContentOptimizer/COptProductStructure"],function(o,n,t){"use strict";new o.Parameters;var r=function(o){this._node=o,this._nodeId=null,this.onResultFile=null,this.onErrors=null,this.onProgress=null,this.onWarnings=null};return r.prototype={constructor:r,onAnswerResultFile:function(o){console.log("coptExport.onAnswerResultFile");var n=o.readBool("status");if(null!=n){var t=o.readBuffer("data"),r=o.readString("type");this.onResultFile(n,t,r)}this.onAnswerWarnings(o),this.dispose()},onAnswerWarnings:function(o){if(console.log("coptExport.onAnswerWarnings"),null!=this.onWarnings&&"function"==typeof this.onWarnings){var n=o.readStringArray("warnings");null!=n&&0<n.length&&this.onWarnings(n)}},onAnswerProgress:function(o){if(console.log("coptExport.onAnswerProgress"),o.existsWithType("progress","double")&&null!=this.onProgress&&"function"==typeof this.onProgress){var n=o.readDouble("progress");this.onProgress(n)}},onAnswerErrors:function(o){console.log("coptExport.onAnswerErrors");var n=JSON.stringify(o.toJSObject());null!=this.onErrors&&"function"==typeof this.onErrors&&this.onErrors(n),this.dispose()},export:function(n,t,r){console.log("coptExport::export"),this._nodeId=this._node.select("ContentOptimizer");var s=new o.Parameters;return console.log("coptExport: outputType: "+t),s.writeString("outputType",t),s.writeObject("productStructure","COptProductStructure",n),this._node.call({destinationNodeId:this._nodeId,name:"coptExport",version:1,parameters:s,onSuccess:this.onAnswerResultFile.bind(this),onError:this.onAnswerErrors.bind(this),onProgress:this.onAnswerProgress.bind(this)}),console.log("coptExport::Export end call"),!0,!0},dispose:function(){null!=this._nodeId&&(this._nodeId.close(),this._nodeId=null)}},r});