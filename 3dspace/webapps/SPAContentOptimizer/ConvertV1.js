/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/ConvertV1",["DS/CSICommandBinder/CSICommandBinder"],function(n){"use strict";var e=function(e){this._node=e,this._nodeId=null,this._serverRequest=null,this.onResultFile=null,this.onMissingFiles=null,this.onErrors=null,this.onProgress=null,this.onThumb2D=null,this.onThumb3D=null,this._response=new n.Response};return e.prototype={constructor:e,callback:function(n){this._response.callDomains(n)},onAnswerResultFile:function(n){if(null!=this.onResultFile&&"function"==typeof this.onResultFile){var e=n.readString("Result"),s=n.readBuffer("File");this.onResultFile(e,s)}this.dispose()},onAnswerProgress:function(n){if(null!=this.onProgress&&"function"==typeof this.onProgress){var e=n.readDouble("Progress");this.onProgress(e)}},onAnswerErrors:function(n){if(null!=this.onErrors&&"function"==typeof this.onErrors){var e=n.readStringArray("Errors");this.onErrors(e)}},onAnswerMissingFiles:function(n){if(null!=this.onMissingFiles&&"function"==typeof this.onMissingFiles){var e=n.readStringArray("FilePaths");this.onMissingFiles(e)}},onAnswerThumb2D:function(n){if(null!=this.onThumb2D&&"function"==typeof this.onThumb2D){var e=n.readBuffer("Thumb"),s=n.readString("Type");this.onThumb2D(s,e)}},onAnswerThumb3D:function(n){if(null!=this.onThumb3D&&"function"==typeof this.onThumb3D){var e=n.readBuffer("Thumb"),s=n.readString("Type");this.onThumb3D(s,e)}},createRequestAndResponse:function(){return this._nodeId=this._node.select("ContentOptimizer"),this._response.onAnswerDomain("ResultFile",this.onAnswerResultFile.bind(this)),this._response.onAnswerDomain("MissingFiles",this.onAnswerMissingFiles.bind(this)),this._response.onAnswerDomain("Errors",this.onAnswerErrors.bind(this)),this._response.onAnswerDomain("Thumb2D",this.onAnswerThumb2D.bind(this)),this._response.onAnswerDomain("Thumb3D",this.onAnswerThumb3D.bind(this)),null!=this.onProgress&&"function"==typeof this.onProgress&&(this._node.subscribe(this._nodeId,"Progress",this._response),this._response.onAnswerDomain("Progress",this.onAnswerProgress.bind(this))),this._node.createRequest({destinationNodeId:this._nodeId,command:"Convert",version:1,onComplete:this.callback.bind(this)})},convert:function(e,s,i,t){var r=this.createRequestAndResponse();if(null!=r){this._serverRequest=r;var o=new n.Parameters,u=new n.Parameters;u.writeString("InputFileName",e),u.writeBuffer("InputFile",s),u.writeString("OutputType",i),u.writeObject("Options","COConvertOption",t),r.send(o,u,o)}},convertUrl:function(e,s,i,t){var r=this.createRequestAndResponse();if(null!=r){this._serverRequest=r;var o=new n.Parameters,u=new n.Parameters;u.writeString("InputFileName",e),u.writeString("InputFileUrl",s),u.writeString("OutputType",i),u.writeObject("Options","COConvertOption",t),r.send(o,u,o)}},dispose:function(){null!=this._nodeId&&(this._nodeId.close(),this._nodeId=null)}},e});