/*!  Copyright 2020 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/coptConvertV1",["DS/CSICommandBinder/CSICommandBinder","DS/SPAContentOptimizer/COptErrors","DS/SPAContentOptimizer/COptConvertOption"],function(n,e,r){"use strict";new n.Parameters;var t=function(n){this._node=n,this._nodeId=null,this.onResultFile=null,this.onMissingFiles=null,this.onErrors=null,this.onProgress=null,this.onWarnings=null};return t.prototype={constructor:t,onAnswerResultFile:function(n){console.log("coptConvertV1.onAnswerResultFile");var e=n.readBool("result");if(null!=e){var r=n.readBuffer("resultFile"),t=n.readString("resultExtension");this.onResultFile(e,r,t)}this.onAnswerMissingFiles(n),this.onAnswerWarnings(n),this.dispose()},onAnswerWarnings:function(n){if(null!=this.onWarnings&&"function"==typeof this.onWarnings){var e=n.readStringArray("warnings");null!=e&&0<e.length&&this.onWarnings(e)}},onAnswerProgress:function(n){if(n.existsWithType("progress","double")&&null!=this.onProgress&&"function"==typeof this.onProgress){var e=n.readDouble("progress");this.onProgress(e)}},onAnswerErrors:function(n){var e=new r;e.errors=n.readStringArray("errors","COptErrors"),null!=e.errors&&0<e.errors.length&&this.onErrors(e.errors),this.dispose()},onAnswerMissingFiles:function(n){if(null!=this.onMissingFiles&&"function"==typeof this.onMissingFiles){var e=n.readStringArray("missingFilePaths");null!=e&&0<e.length&&this.onMissingFiles(e)}},convert:function(e,r,t,o){console.log("coptConvertV1::convert"),this._nodeId=this._node.select("ContentOptimizer");var s=new n.Parameters;return s.writeString("inputFileName",e),s.writeBuffer("inputFile",r),s.writeString("outputType",t),s.writeObject("options","COptConvertOption",o),console.log("coptConvertV1: inputFileName: "+e),console.log("coptConvertV1: outputType: "+t),this._node.call({destinationNodeId:this._nodeId,name:"coptConvert",version:1,parameters:s,onSuccess:this.onAnswerResultFile.bind(this),onError:this.onAnswerErrors.bind(this),onProgress:this.onAnswerProgress.bind(this)}),console.log("coptConvertV1::convert end call"),!0,!0},convertUrl:function(e,r,t,o){this._nodeId=this._node.select("ContentOptimizer"),console.log("coptConvertV1::convertUrl");var s=new n.Parameters;return s.writeString("inputFileName",e),s.writeString("inputFileUrl",r),s.writeString("outputType",t),s.writeObject("options","COptConvertOption",o),this._node.call({destinationNodeId:this._nodeId,name:"coptConvert",version:1,parameters:s,onSuccess:this.onAnswerResultFile.bind(this),onError:this.onAnswerErrors.bind(this),onProgress:this.onAnswerProgress.bind(this)}),!0,!0},dispose:function(){null!=this._nodeId&&(this._nodeId.close(),this._nodeId=null)}},t});