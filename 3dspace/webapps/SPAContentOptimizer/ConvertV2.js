/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/ConvertV2",["DS/CSICommandBinder/CSICommandBinder"],function(n){"use strict";var s=function(s){this._node=s,this._nodeId=null,this._serverRequest=null,this.onResultFile=null,this.onMissingFiles=null,this.onErrors=null,this.onProgress=null,this.onThumb2D=null,this.onThumb3D=null,this._response=new n.Response};return s.prototype={constructor:s,callback:function(n){this._response.callDomains(n)},onAnswerCreatedObject:function(n){if(null!=this.onDocument&&"function"==typeof this.onDocument){var s=n.readObject("ObjectId","SPAEObjObjectId"),e=new Document(s,this._pool);console.log("onLoadDocument ObjectId:",s),this.onDocument(e)}},onAnswerResultFile:function(n){if(null!=this.onResultFile&&"function"==typeof this.onResultFile){var s=n.readString("Result");this.onResultFile(s)}this.dispose()},onAnswerProgress:function(n){if(null!=this.onProgress&&"function"==typeof this.onProgress){var s=n.readDouble("Progress");this.onProgress(s)}},onAnswerErrors:function(n){if(null!=this.onErrors&&"function"==typeof this.onErrors){var s=n.readStringArray("Errors");this.onErrors(s)}},onAnswerMissingFiles:function(n){if(null!=this.onMissingFiles&&"function"==typeof this.onMissingFiles){var s=n.readStringArray("FilePaths");this.onMissingFiles(s)}},onAnswerThumb2D:function(n){if(null!=this.onThumb2D&&"function"==typeof this.onThumb2D){var s=n.readBuffer("Thumb"),e=n.readString("Type");this.onThumb2D(e,s)}},onAnswerThumb3D:function(n){if(null!=this.onThumb3D&&"function"==typeof this.onThumb3D){var s=n.readBuffer("Thumb"),e=n.readString("Type");this.onThumb3D(e,s)}},convert:function(s,e,i){if(this._nodeId=this._node.select("ContentOptimizer"),this._response.onAnswerDomain("ResultFile",this.onAnswerResultFile.bind(this)),this._response.onAnswerDomain("MissingFiles",this.onAnswerMissingFiles.bind(this)),this._response.onAnswerDomain("Errors",this.onAnswerErrors.bind(this)),this._response.onAnswerDomain("Thumb2D",this.onAnswerThumb2D.bind(this)),this._response.onAnswerDomain("Thumb3D",this.onAnswerThumb3D.bind(this)),null!=this.onProgress&&"function"==typeof this.onProgress&&(this._node.subscribe(this._nodeId,"Progress",this._response),this._response.onAnswerDomain("Progress",this.onAnswerProgress.bind(this))),this._serverRequest=this._node.createRequest({destinationNodeId:this._nodeId,command:"ConvertFilePath",version:1,onComplete:this.callback.bind(this)}),null!=this._serverRequest){var t=new n.Parameters,o=new n.Parameters;o.writeString("InputFilePath",s),o.writeString("OutputFilePath",e),o.writeObject("Options","COConvertOption",i),this._serverRequest.send(t,o,t)}},dispose:function(){null!=this._nodeId&&(this._nodeId.close(),this._nodeId=null)}},s});