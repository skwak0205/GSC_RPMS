/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/Generate3DPrint",["DS/CSICommandBinder/CSICommandBinder"],function(e){"use strict";var n=function(n){this._node=n,this._nodeId=null,this._serverRequest=null,this.onResultFile=null,this.onMissingFiles=null,this.onErrors=null,this.onProgress=null,this._response=new e.Response};return n.prototype={constructor:n,callback:function(e){this._response.callDomains(e)},onAnswerResultFile:function(e){if(null!=this.onResultFile&&"function"==typeof this.onResultFile){var n=e.readString("Result"),s=e.readBuffer("File");this.onResultFile(n,s)}this.dispose()},onAnswerProgress:function(e){if(null!=this.onProgress&&"function"==typeof this.onProgress){var n=e.readDouble("Progress");this.onProgress(n)}},onAnswerErrors:function(e){if(null!=this.onErrors&&"function"==typeof this.onErrors){var n=e.readStringArray("Errors");this.onErrors(n)}},onAnswerMissingFiles:function(e){if(null!=this.onMissingFiles&&"function"==typeof this.onMissingFiles){var n=e.readStringArray("FilePaths");this.onMissingFiles(n)}},createRequestAndResponse:function(){return this._nodeId=this._node.select("ContentOptimizer"),this._response.onAnswerDomain("ResultFile",this.onAnswerResultFile.bind(this)),this._response.onAnswerDomain("MissingFiles",this.onAnswerMissingFiles.bind(this)),this._response.onAnswerDomain("Errors",this.onAnswerErrors.bind(this)),null!=this.onProgress&&"function"==typeof this.onProgress&&(this._node.subscribe(this._nodeId,"Progress",this._response),this._response.onAnswerDomain("Progress",this.onAnswerProgress.bind(this))),this._node.createRequest({destinationNodeId:this._nodeId,command:"Generate3DPrint",version:1,onComplete:this.callback.bind(this)})},generate:function(n,s,i,t){var r=this.createRequestAndResponse();if(null!=r){this._serverRequest=r;var o=new e.Parameters,l=new e.Parameters;l.writeString("InputFileName",n),l.writeBuffer("InputFile",s),l.writeUint8("PrintType",i),l.writeObject("Options","CO3DPrintOption",t),r.send(o,l,o)}},generateUrl:function(n,s,i,t){var r=this.createRequestAndResponse();if(null!=r){this._serverRequest=r;var o=new e.Parameters,l=new e.Parameters;l.writeString("InputFileName",n),l.writeString("InputFileUrl",s),l.writeUint8("PrintType",i),l.writeObject("Options","CO3DPrintOption",t),r.send(o,l,o)}},dispose:function(){null!=this._nodeId&&(this._nodeId.close(),this._nodeId=null)}},n});