/*!  Copyright 2015 Dassault Systemes. All rights reserved. */
define("DS/SPAContentOptimizer/BOMExport",["DS/CSICommandBinder/CSICommandBinder","DS/SPAContentOptimizer/COBOMFcsId","DS/SPAContentOptimizer/COProductStructure"],function(s,r,e){"use strict";var n=function(r){this._node=r,this._serverRequest=null,this.onBOMResponse=null,this.onErrors=null,this.onProgress=null,this._response=new s.Response};return n.prototype={constructor:n,callback:function(s){this._response.callDomains(s)},onAnswerBOMResponse:function(s){if(null!=this.onBOMResponse&&"function"==typeof this.onBOMResponse){var r=s.readString("Asm"),e=s.readBool("Ok");this.onBOMResponse(r,e)}},onAnswerProgress:function(s){if(null!=this.onProgress&&"function"==typeof this.onProgress){var r=s.readDouble("Progress");this.onProgress(r)}},onAnswerErrors:function(s){if(null!=this.onErrors&&"function"==typeof this.onErrors){var r=s.readString("CommandName"),e=s.readStringArray("Errors");this.onErrors(r,e)}},runExport:function(r,e,n){var o=!1,t=this._node.select("ContentOptimizer");if(this._response.onAnswerDomain("BOMResponse",this.onAnswerBOMResponse.bind(this)),this._response.onAnswerDomain("Errors",this.onAnswerErrors.bind(this)),null!=this.onProgress&&"function"==typeof this.onProgress&&(this._node.subscribe(t,"Progress",this._response),this._response.onAnswerDomain("Progress",this.onAnswerProgress.bind(this))),this._serverRequest=this._node.createRequest({destinationNodeId:t,command:"BOMExport",version:1,onComplete:this.callback.bind(this)}),null!=this._serverRequest){var i=new s.Parameters,u=new s.Parameters;u.writeString("Format",e),u.writeObject("ProductStructure","COProductStructure",r),u.writeObject("FcsId","COBOMFcsId",n),this._serverRequest.send(i,u,i),o=!0}return o}},n});