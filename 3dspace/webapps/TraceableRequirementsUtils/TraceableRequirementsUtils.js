/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
if(define("DS/TraceableRequirementsUtils/Command/HomePage_InsertRootCmd",["UWA/Core","DS/Logger/Logger","DS/ApplicationFrame/Command","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json"],function(e,t,n,i,r){"use strict";var s=n.extend({name:"REQ_HOMEPAGE_PANEL",_logger:null,_options:null,init:function(e){this._logger=t.getLogger(s),this._options=e},_displayMessage:function(e,t,n){UWA.is(e.displayNotification)?e.displayNotification({eventID:n,msg:t}):alert(t)},beginExecute:function(){this._logger.log(this._id+".beginExecute")},execute:function(){this._logger.log(this._id+".execute");var e=this;require(["DS/PADUtils/PADContext","DS/PADUtils/views/PADModalChooser"],function(t,n){var r,s,o=t.get(),a=e._options.arguments[0].Type;if(UWA.is(a)){for(var l=new Array(a.length),c=0;c<a.length;c++)l[c]=a[c];r="(";for(var u=0;u<l.length;u++)r+=0===u?'flattenedtaxonomies:"types/'+l[u]+'"':' OR flattenedtaxonomies:"types/'+l[u]+'"';s=r+=")",new n({renderTo:document.body,position:"above_action_bar",in_apps_search:{multiSel:!1,in_apps_callback:e._onSelectionDone.bind(e),precond:s}})}else o.displayNotification({eventID:"warning",msg:i.Requirement_Notif_CmdNotAvailable})})},endExecute:function(){this._logger.log(this._id+".endExecute")},_onSelectionDone:function(e){require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices"],function(t,n,i){var r=t.get(),s=e[0].id;i.getInfo({securityContext:n.getSecurityContext(),pid:s,selectables:"type,name,revision,attribute[Title],type.kindof,current,physicalid,id",onComplete:function(e){var t=(UWA.is(e,"string")?JSON.parse(e):e).results[0];t.indexCreation=!1,r.refreshOnCreate(t,!0)},onFailure:function(e,t){console.warn("WS getInfo.onFailure")},onTimeout:function(e){console.warn("WS getInfo.onFailure")}})})}});return s}),-1===require.toUrl("DS/VENREQPlugins/Fancytree").indexOf("latest")){var lFancytreePath=require.toUrl("DS/VENREQPlugins/External/fancytree/latest/media/");(lIndexOfQuestionMark=lFancytreePath.indexOf("?"))>-1&&(lFancytreePath=lFancytreePath.substring(0,lIndexOfQuestionMark)),require.config({paths:{"DS/VENREQPlugins/Fancytree":lFancytreePath+"jquery.fancytree-all.min"},shim:{"DS/VENREQPlugins/Fancytree":{deps:["DS/TraceableRequirementsUtils/jQueryUI","DS/TraceableRequirementsUtils/jQuery"],exports:"jQuery.ui.fancytree"}}})}if(define("DS/TraceableRequirementsUtils/Fancytree",["DS/VENREQPlugins/Fancytree"],function(e){"use strict";return e}),define("DS/TraceableRequirementsUtils/REQCommandProxy",["text!DS/TraceableRequirementsUtils/assets/RequirementCommandProxyResources.json","UWA/Core","UWA/Class","DS/PlatformAPI/PlatformAPI","DS/Logger/Logger"],function(e,t,n,i,r){"use strict";var s,o={},a=JSON.parse(e);for(var l in a)if(a.hasOwnProperty(l)){var c="on"+(s=l).charAt(0).toUpperCase()+s.slice(1);a[l].callback=c,o[c]=l}function u(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function d(){var e="/no_private_channel";return"undefined"!=typeof widget&&null!==widget&&(void 0!==widget.getValue("x3dSharedId")?e="/"+widget.getValue("x3dSharedId"):void 0!==widget.getValue("x3dAppId")?e="/"+widget.getValue("x3dAppId"):void 0!==widget.getValue("appId")&&(e="/"+widget.getValue("appId")+"_"+widget.id)),e}function g(e){var t="DS/TraceableRequirementsUtils/REQCommandProxy/"+e;return UWA.is(a[e])&&!0===a[e].private&&(t+=d()),t}var h=n.extend({init:function(e,t,n){this.ownerProxyUid=e,this.eventHandlingFunction=t,this.ignoreMyEvents=n},handleEvent:function(e){var n=Date.now();if(t.debug&&(r.debug("Event received at %d, %dms after event creation",n,n-e.metadata.timestamp),r.debug("    %o",e.metadata)),!0===this.ignoreMyEvents&&e.metadata.originUid===this.ownerProxyUid)t.debug&&r.debug("Ignoring this event (sent by me)");else try{this.eventHandlingFunction(e.data,e.metadata)}catch(t){r.error("Error while handling event %o",e),r.error(t)}}}),p=n.extend({init:function(e){this.uid=u(),this.subscriptions=[],t.debug&&r.debug("Creating proxy %s",this.uid),this.addProxyEvents(e)},addProxyEvents:function(e){if(e)for(var n in e){var s=o[n];if(s){var a=e[n];if("function"==typeof a||Array.isArray(a)&&a.length>0&&"function"==typeof a[0]){var l,c=!0;"function"==typeof a?l=a:(l=a[0],c=a.length<2||!1!==a[1]);var u=new h(this.uid,l,c),d=g(s);t.debug&&r.debug("Subscribing to topic [%s]",d);var p=i.subscribe(d,u.handleEvent.bind(u));this.subscriptions.push(p)}else r.warn("Input [events.%s] is not a function",n)}else r.info("Input [events.%s] is not a known event",n)}},destroy:function(){t.debug&&r.debug("Destroying proxy [%s]",this.uid),this.subscriptions&&(t.debug&&r.debug("Unsubcribing"),this.subscriptions.forEach(function(e){i.unsubscribe(e)}),delete this.subscriptions),this.destroyed=!0}});for(var m in p.prototype._publish=function(e,n){if(!0===this.destroyed)throw new Error("This proxy has been destroyed");var s=g(e),o=function(e,t,n){return{metadata:{uid:u(),originUid:e,timestamp:Date.now(),appid:d(),originWidgetId:void 0!==n?n:"undefined"!=typeof widget&&null!==widget?widget.id:e},data:t}}(this.uid,n,this.odtWidgetId);t.debug&&(r.debug("Publishing to topic [%s]",s),r.debug("\t%o",o)),i.publish(s,o)},a)a.hasOwnProperty(m)&&(p.prototype[m]=function(e){return function(t){this._publish(e,t)}}(m));return p.create=function(e){var t;return e&&(t=e.events),new p(t)},p.appId=function(){return d()},p}),"undefined"!=typeof jQuery&&void 0!==jQuery.ui)define("DS/TraceableRequirementsUtils/jQueryUI",function(){"use strict";return jQuery.ui});else if(-1===require.toUrl("DS/VENENO6WPlugins/jQueryUI").indexOf("latest")){var lJQueryUIPath=require.toUrl("DS/VENENO6WPlugins/plugins/jqueryui/latest/js/");(lIndexOfQuestionMark=lJQueryUIPath.indexOf("?"))>-1&&(lJQueryUIPath=lJQueryUIPath.substring(0,lIndexOfQuestionMark)),require.config({paths:{"DS/VENENO6WPlugins/jQueryUI":lJQueryUIPath+"jquery.ui.custom.min"},shim:{"DS/VENENO6WPlugins/jQueryUI":{deps:["DS/TraceableRequirementsUtils/jQuery"],exports:"jQuery.ui"}}})}if(define("DS/TraceableRequirementsUtils/jQueryUI",["DS/VENENO6WPlugins/jQueryUI"],function(e){"use strict";return e}),define("DS/TraceableRequirementsUtils/REQClipboard",["UWA/Class","UWA/Class/Events","DS/Logger/Logger"],function(e,t,n){"use strict";var i=n.getLogger("DS/TraceableRequirementsUtils/REQClipboard"),r={OBJECT:null,POSITION:null},s=e.extend(t,{init:function(){this._parent();var e=this;document&&document.addEventListener&&document.addEventListener("keyup",function(t){27===t.keyCode&&(i.log("Clear the Clipboard"),e.clear())})},_checkpageAndThrow:function(e){if(i.debug('Checking if "%s" is a valid page',e),!r.hasOwnProperty(e))throw i.error("Check failed"),new Error('"'+e+'" is not a valid page')},setData:function(e,t){i.info('Setting data in page "%s"',e),i.debug("  Data %o",t),this._checkpageAndThrow(e),this.dispatchEvent("pre_setData",arguments),r[e]=UWA.clone(t),this.dispatchEvent("post_setData",arguments)},getData:function(e){return i.info('Getting data in page "%s"',e),this._checkpageAndThrow(e),UWA.clone(r[e])},consumeData:function(e,t){i.info('Consuming data in page "%s"',e);var n=this.getData(e);return t&&this.clear(e),n},clear:function(e){if(e)i.info('Clearing clipboard page "%s"',e),this._checkpageAndThrow(e),this.dispatchEvent("pre_clear",arguments),r[e]=void 0;else for(var t in i.info("Clearing clipboard"),this.dispatchEvent("pre_clear",arguments),r)r.hasOwnProperty(t)&&(r[t]=void 0);this.dispatchEvent("post_clear",arguments)},isEmpty:function(e){if(e){if(this._checkpageAndThrow(e),r[e])return!1}else for(var t in r)if(r.hasOwnProperty(t)&&r[t])return!1;return!0}}).singleton({init:function(){this._parent()}});for(var o in r)r.hasOwnProperty(o)&&(s[o]=o);return s}),define("DS/TraceableRequirementsUtils/views/TRMFloatingPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/Logger/Logger"],function(e,t,n,i,r,s,o){"use strict";var a=t.extend(n,{name:"GenericReportPanel",_logger:null,options:{},init:function(e){this._parent(e);e.renderTo||(widget&&widget.body?e.renderTo=widget.body:e.renderTo=document.body),this._logger=o.getLogger(a),this.setOptions(e),this._createPanel(e)},_createPanel:function(t){var n=this;n._dialogBody=e.createElement("div",{class:"trm_floating_panel_body",id:"trm_floating_panel_body"}),n._dialogBody.innerText=t.innerText,n._footer=e.createElement("div"),t.button1&&(n.button1=new i({value:t.button1.title,name:t.button1.title,className:t.button1.className||"default",active:t.button1.active}),n.button1.addEvents({onClick:function(e){n._closePanel()}}),n.button1.inject(n._footer)),t.button2&&(n.button2=new i({value:t.button2.title,name:t.button2.title,className:t.button2.className||"default",active:t.button2.active}),n.button2.addEvents({onClick:function(e){n._closePanel()}}),n.button2.inject(n._footer)),t.button3&&(n.button3=new i({value:t.button3.title,name:t.button3.title,className:t.button3.className||"default",active:t.button3.active}),n.button3.addEvents({onClick:function(e){n._closePanel()}}),n.button3.inject(n._footer)),n._floatingComponent=new s({className:"trm_floating_panel",title:t.Title,body:n._dialogBody,footer:n._footer,overlay:!0,closable:!0,resizable:!0,animate:!0,events:{onResizeFloating:function(){n._logger.log("onResizeFloating")},onClose:function(){n._logger.log("onClose"),n._closePanel()}}}).inject(n.options.renderTo),new r({element:e.Element.getElement.call(n._floatingComponent.getBody(),".hierarchical_revision_dialog")}),n._floatingComponent.show()},_closePanel:function(){this._logger.log("close panel"),this._floatingComponent.hide(),this._floatingComponent.destroy()}});return a}),define("DS/TraceableRequirementsUtils/Command/ActionBar_CleanAllCmd",["DS/ApplicationFrame/Command","DS/i3DXCompassServices/i3DXCompassPubSub"],function(e,t){"use strict";return e.extend({name:"req_cleanAll",init:function(e){this._parent(e,{isAsynchronous:!0})},beginExecute:function(){},execute:function(){var e=this;require(["DS/PADUtils/PADContext"],function(n){t.publish("resetObject"),t.publish("resetX3DContent");var i=UWA.is(widget.getValue("X3DContentId"),"string")?JSON.parse(widget.getValue("X3DContentId")):null;UWA.is(i)&&UWA.is(i.data)&&(i.data.items=[],widget.setValue("X3DContentId",JSON.stringify(i))),n.get().cleanAll(),e.end()})},endExecute:function(){}})}),define("DS/TraceableRequirementsUtils/Command/TRMRootInfoPanel",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext"],function(e,t,n){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get(),this._change_state_from_close=!1;var t=this;t._context.structureEditor.reqshell&&t._context.structureEditor.reqshell._modelEvents&&t.addCallback(),t=this,this.onStateChange(function(){t._change_state_from_close?t._change_state_from_close=!1:t._context.structureEditor.togglePanel("left")})},addCallback:function(){var e=this;!1===this._callbackAdd&&(this._context.structureEditor.reqshell._modelEvents.subscribe({event:"triptych-hide-panel"},function(t){"left"===t&&(e._change_state_from_close=!0,e.setState(!1,!1))}),e._callbackAdd=!0)}})}),define("DS/TraceableRequirementsUtils/Command/ReqCmdBase",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0}),t.get()&&(this._check_select(),t.get().getPADTreeDocument().getXSO().onChange(this._check_select.bind(this)))},_check_select:function(){!0===!!t.get().getPADTreeDocument().getXSO().get().length?this.enable():this.disable()}})}),define("DS/TraceableRequirementsUtils/utils/SearchUtils",["UWA/Utils/InterCom","DS/Utilities/Utils"],function(e,t){"use strict";function n(){return"object"==typeof n.instance?n.instance:(n.instance=this,this)}return n.prototype.inAppsSearch=function(n){var i,r=Object.assign({mode:"furtive",default_with_precond:!0,widget_id:"default-widget-id",app_socket_id:"enosearchutils_default-widget-id",idcard_activated:!1,multiSel:!0,advanced_search:{showByDefault:!1},tenant:(i=widget.getValue("x3dPlatformId"))&&""!==i?i:"OnPremise"},n),s=new e.Socket(r.app_socket_id,{dispacthRetryInterval:0});!0===n.debug_mode&&s.setDebugMode(!0),UWA.is(n.parent_window)?s.subscribeServer("SearchComServer",window):s.subscribeServer("SearchComServer"),s.dispatchEvent("RegisterContext",r),UWA.is(n.context_name)&&(r.context_title=n.context_name),r.default_search_criteria=n.fts_value,s.dispatchEvent("InContextSearch",r);var o=[];s.addListener("Selected_Objects_search",function(e){o=e});var a=t.debounce(function(e){switch(e.command_id){case"in_app_ok":n.callback.call(null,o);break;case"in_app_apply":n.apply?n.apply.call(null,o):n.callback.call(null,o);break;default:n.cancel_callback.call(null,o)}s.dispatchEvent("UnregisterContext",{widget_id:r.widget_id})},200);s.addListener("closeTransient",a),s.addListener("onCloseTransient",function(e){n.cancel&&n.cancel.call(null),s.dispatchEvent("UnregisterContext",{widget_id:r.widget_id})})},new n}),define("DS/TraceableRequirementsUtils/views/TRMDetachReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Logger/Logger","i18n!DS/TraceableRequirementsUtils/assets/nls/TRMDetachReportPanel.json"],function(e,t,n,i,r,s,o,a){"use strict";var l=t.extend(n,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(e){this._parent(e);e.renderTo||(widget&&widget.body?e.renderTo=widget.body:e.renderTo=document.body),this._logger=o.getLogger(l),this.setOptions(e),this._createPanel(e)},_fillTab:function(t,n,i,r){for(var s="<ul>",o=0,a=n.length;o<a;o++)s+="<li>"+n[o]+"</li>";s+="</ul>";var l=new e.Element("div",{html:s}),c=new e.Element("div",{styles:{padding:"2px","word-wrap":"break-word"}});return c.appendChild(l),{label:t+" ("+n.length+")",isSelected:r===i,content:c,index:i}},_createTab:function(e,t){var n=0;e.success.length>0&&(e.tab.add(this._fillTab(a.success,e.success,n,e.selectedIndex)),n++),e.failure.length>0&&(e.tab.add(this._fillTab(a.failure,e.failure,n,e.selectedIndex)),n++),e.neutral.length>0&&(e.tab.add(this._fillTab(a.neutral,e.neutral,n,e.selectedIndex)),n++),e.aborted.length>0&&(e.tab.add(this._fillTab(a.aborted,e.aborted,n,e.selectedIndex)),n++),e.tab.inject(t)},_createPanel:function(t){var n=this,o=new e.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),a=new e.Element("div",{class:"wux-control-inline-container"});o.inject(a),n.immersiveFrame=new s,n.immersiveFrame.inject(n.options.renderTo);var l=n.ReportTabCont=new e.Element("div",{class:"wux-control-container"}),c=new i({displayStyle:"panel"});c.reorderFlag=!1,c.pinFlag=!0,c.showComboBoxFlag=!1,c.editableFlag=!1,c.multiSelFlag=!0,c.centeredFlag=!1,c.touchMode=!0;var u={tab:c,selectedIndex:0};void 0!==t.success&&null!==t.success&&Array.isArray(t.success)&&(u.success=t.success),void 0!==t.failure&&null!==t.failure&&Array.isArray(t.failure)&&(u.failure=t.failure),void 0!==t.neutral&&null!==t.neutral&&Array.isArray(t.neutral)&&(u.neutral=t.neutral),void 0!==t.aborted&&null!==t.aborted&&Array.isArray(t.aborted)&&(u.aborted=t.aborted),n._createTab(u,l),n._panel=new r({title:t.title,content:l,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:n.immersiveFrame,resizableFlag:!0,collapsibleFlag:!1,minWidth:600,minHeight:85}),n._panel.addEventListener("close",n._onClosePanel.bind(n),!1),(u.success.length>15||t.failure.length>15||t.neutral.length>15||t.aborted.length>15)&&(n._panel.height=400),n._panel.elements.container.classList.add("AuthGenericReportPanel_Panel")},_onClosePanel:function(){this._panel.destroy(),this._panel=null,this.immersiveFrame.destroy(),this.immersiveFrame=null}});return l}),"undefined"!=typeof jQuery)define("DS/TraceableRequirementsUtils/jQuery",function(){"use strict";return jQuery});else if(-1===require.toUrl("DS/VENENO6WPlugins/jQuery").indexOf("latest")){var lIndexOfQuestionMark,lJQueryPath=require.toUrl("DS/VENENO6WPlugins/plugins/jquery/latest/");(lIndexOfQuestionMark=lJQueryPath.indexOf("?"))>-1&&(lJQueryPath=lJQueryPath.substring(0,lIndexOfQuestionMark)),require.config({paths:{"DS/VENENO6WPlugins/jQuery":lJQueryPath+"jquery"},shim:{"DS/VENENO6WPlugins/jQuery":{exports:"jQuery"}}})}define("DS/TraceableRequirementsUtils/jQuery",["DS/VENENO6WPlugins/jQuery"],function(e){"use strict";return e.noConflict(),e}),define("DS/TraceableRequirementsUtils/utils/TRMReportPanel",["UWA/Core","UWA/Class","UWA/Class/Options","DS/Controls/Tab","DS/Windows/Panel","DS/Windows/ImmersiveFrame","DS/Logger/Logger","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(e,t,n,i,r,s,o,a){"use strict";var l=t.extend(n,{name:"GenericReportPanel",_logger:null,_panel:null,options:{},init:function(e){this._parent(e);e.renderTo||(widget&&widget.body?e.renderTo=widget.body:e.renderTo=document.body),this._logger=o.getLogger(l),this.setOptions(e),this._createPanel(e)},_fillTab:function(t,n,i,r,s){for(var o="<ul>",l=0,c=n.length;l<c;l++){var u=n[l],d=(e.is(u.type,"object")?u.type.displayName:u.type)+" "+u.name+" "+u.revision,g=u.successMsg?u.successMsg:u.errorMsg,h=g?a[g]:a[s+"_"+t+"_msg"];o+="<li>"+(h=h.replace("{TNR}",d))+"</li>"}o+="</ul>","Failure"===t&&(o+=a.FailureReasons);var p=new e.Element("div",{html:o}),m=new e.Element("div",{styles:{padding:"2px","word-wrap":"break-word"}});return m.appendChild(p),{label:a[t]+" ("+n.length+")",isSelected:r===i,content:m,index:i}},_createTab:function(e,t){var n=0;e.Success&&e.Success.length>0&&(e.tab.add(this._fillTab("Success",e.Success,n,e.selectedIndex,e.title)),n++),e.Failure&&e.Failure.length>0&&(e.tab.add(this._fillTab("Failure",e.Failure,n,e.selectedIndex,e.title)),n++),e.neutral&&e.neutral.length>0&&(e.tab.add(this._fillTab("Neutral",e.neutral,n,e.selectedIndex,e.title)),n++),e.aborted&&e.aborted.length>0&&(e.tab.add(this._fillTab("Aborted",e.aborted,n,e.selectedIndex,e.title)),n++),e.tab.inject(t)},_createPanel:function(t){var n=this,o=new e.Element("div",{styles:{"vertical-align":"top","min-height":"286px",position:"relative"}}),l=new e.Element("div",{class:"wux-control-inline-container"});o.inject(l),n.immersiveFrame=new s,n.immersiveFrame.inject(n.options.renderTo);var c=n.ReportTabCont=new e.Element("div",{class:"wux-control-container"}),u=new i({displayStyle:"panel"});u.reorderFlag=!1,u.pinFlag=!0,u.showComboBoxFlag=!1,u.editableFlag=!1,u.multiSelFlag=!0,u.centeredFlag=!1,u.touchMode=!0;var d=t.reportData;d.tab=u,d.selectedIndex=0,d.title=t.title,n._createTab(d,c),n._panel=new r({title:a["title_"+t.title],content:c,position:{my:"center",at:"center"},width:600,allowedDockAreas:0,immersiveFrame:n.immersiveFrame,resizableFlag:!0,collapsibleFlag:!1,minWidth:600,minHeight:85}),n._panel.addEventListener("close",n._onClosePanel.bind(n),!1),n._panel.elements.container.classList.add("AuthGenericReportPanel_Panel")},_onClosePanel:function(){this._panel.destroy(),this._panel=null,this.immersiveFrame.destroy(),this.immersiveFrame=null}});return l}),define("DS/TraceableRequirementsUtils/Command/ReqNextGenFilterCmd",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd","DS/PADUtils/PADContext","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSession"],function(e,t,n,i){"use strict";return e.extend({_openFilterPanelNow:!1,_selectionId:-1,init:function(e){this._parent(e);var n=this;t.get().getPADTreeDocument().getModelEvents().subscribe({event:"onRemoveRoot"},function(e){UWA.is(n.removeFilter,"function")&&n.removeFilter({widgetId:n.getAppParams().widgetId,rootIds:[e.data.pid]}),t.get()._biFilter&&t.get()._biFilter.removeRoot(e.data.pid)}),i.subscribe({event:"authoringStateModified"},function(e){if("function"==typeof n.hasSelection)var t=n.hasSelection();t||!e.authored?n.enable():n.disable()});var r=t.get().getPADTreeDocument().getXSO();r.onChange(function(){r.isEmpty()||i.determineAuthoredFlag()?n.disable():n.enable()})},getWidgetId:function(){return n.getWidgetId()},getAppParams:function(){return{widgetId:n.getWidgetId(),appId:n.getSharedId()}},getSelectorManager:function(){return t.get().getPADTreeDocument().getXSO()||null},setOpenFilterNow:function(e){this._openFilterPanelNow=!0,this._selectionId=e},getRoots:function(){if(!1!==this._openFilterPanelNow){this._openFilterPanelNow=!1;var e=[],n=t.get().options.model.getNodesById(this._selectionId)[0],i={};return n.isRoot()?i=n:(i=n.getRoot()).select(),e.push({id:i.getID(),label:i.getLabel(),filtered:i.options.sequence_filter||i.options.config_filter?1:0}),e}return t.get().getPADTreeDocument().getRoots().map(function(e){return{id:e.getID(),label:e.getLabel(),filtered:e.options.sequence_filter||e.options.config_filter?1:0}})},getSelection:function(){var e=t.get().getPADTreeDocument().getSelectedNodes(),n={path:[],label:[]};return e.forEach(function(e){n.path.push(e.getOccurencePath()),n.label.push([e.getLabel()])}),n}})}),define("DS/TraceableRequirementsUtils/Command/ActionBar_LaunchWebAppCmd",["DS/ApplicationFrame/Command","UWA/Utils/InterCom"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0}),this.socketName="selection_socket_"+widget.id,this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("com.ds.compass",window.parent)},beginExecute:function(){},execute:function(){var e=this;function t(e){"ENOREQL_AP"===e.appId&&e.widgetId===widget.id&&console.log(e.response)}require(["DS/i3DXCompassServices/i3DXCompassPubSub","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices"],function(n,i,r,s){var o={appId:"ENOREQL_AP",widgetId:widget.id},a=void 0;UWA.is(i.get().getSelectedElement())&&(a=i.get().getSelectedElement().physicalid),s.getInfo({securityContext:r.getSecurityContext(),pid:a,selectables:"physicalid,id",onComplete:function(e){console.log("data",e);var i=(UWA.is(e,"string")?JSON.parse(e):e).results[0];i.id&&(a=i.id);var s=r.getSecurityContext();n.publish("setObject",{objectId:a,contextId:s}),n.subscribe("launchAppCallback",t),n.publish("launchApp",o)},onFailure:function(t){e._logger.log(t)},onTimeout:function(){e._logger.log("RequirementWebServices.getInfo timed out")}})})},endExecute:function(){}})}),define("DS/TraceableRequirementsUtils/Command/ActionBar_AttributeManagementCmd",["DS/ApplicationFrame/Command","DS/RequirementAttrManagement/views/AttributesCustomization","DS/Windows/Dialog","DS/Controls/Button","DS/PADUtils/PADContext","DS/Windows/ImmersiveFrame"],function(e,t,n,i,r,s){"use strict";function o(e){if(e){if(!e.elements||!e.elements.container)return void(e=null);var t=e.getContent();if(t){var n=t.querySelector(".wux-windows-window-content.wux-element-contentbox");n&&(n.innerHTML="")}}}return e.extend({init:function(e){this._parent(e);var t=this;this.enable(),t.localContext=r.get(),console.log("#AttributesManagementCmd: init called"),this.dialog=null,t.localContext._applicationChannel.subscribe({event:"ENXViews/Views/showInWidgetBody"},function(e){if(e&&e.restore){try{o(t.dialog),t.dialog&&t.dialog.close(),t.dialog=null}catch(e){console.error(e),t.dialog=null}t.localContext._applicationChannel.publish({event:"event-change-structure-view-changed",data:e.refreshStructure})}else{try{o(t.dialog),t.dialog&&t.dialog.close(),t.dialog=null}catch(e){console.error(e),t.dialog=null}t.dialog=new n({title:"Attribute Management",content:e.html,immersiveFrame:t.localContext.getAppImmersiveFrame(),resizableFlag:!0}),t.dialog.maximizedFlag=!0,t.dialog.maximizeButtonFlag=!1}})},execute:function(e){var n=r.get(),i={COLUMNS_EXPORT:"export",TOOLBAR_ACTION_MORE_ATTRIBUTES:"moreAttributes",TOOLBAR_ACTION_DIVISER:"diviser",TOOLBAR_ACTION_MOVE_UP:"moveUp",TOOLBAR_ACTION_MOVE_DOWN:"moveDown",TOOLBAR_ACTION_MOVE_TOP:"moveFirst",TOOLBAR_ACTION_MOVE_BOTTOM:"moveLast",TOOLBAR_ACTION_CHANGE_COLOR:"changeColor",TOOLBAR_ACTION_REMOVE:"trash"};n.isAttributeManagmentEnabled()||(i.TOOLBAR_DEFAULT_ACTIONS=["moreAttributes","diviser","trash"]),n.attribute_customization=new t({modelEvents:this.localContext._applicationChannel,viewMode:"comfortable",configuration:{providedColumns:[],selectedColumns:[]},toolbarActions:i.TOOLBAR_DEFAULT_ACTIONS,appColumns:n.columnManager.getAvailableColumnsWithNls(),baseTypes:n.getBaseReferenceTypes(),baseExtensions:n.getBaseExtensions(),baseInstanceTypes:n.getBaseInstanceTypes(),selectedTypes:n.getSelectedTypes(),selectedExtensions:n.getSelectedExtensions(),withDgv:!0,rowHeaderActivated:!0}),this.end()}})}),define("DS/TraceableRequirementsUtils/utils/RequirementAlertManager",["DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen"],function(e,t){"use strict";return{_notif_manager:null,init:function(n){null===this._notif_manager&&(this._notif_manager=e,t.setNotificationManager(this._notif_manager),t.setStackingPolicy(5),t.setRemoveStackOnFirstTimeoutFlag(!0),t.setFadeOutPolicy(2))},errorAlert:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"error",message:e,sticky:!1})},sucessAlert:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"success",message:e,sticky:!1})},notifyAlert:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"info",message:e,sticky:!1})},warningAlert:function(e){this._notif_manager||this.init(),this._notif_manager.addNotif({level:"warning",message:e,sticky:!1})}}}),define("DS/TraceableRequirementsUtils/views/TRMDetachDlgConfirm",["UWA/Controls/Abstract","UWA/Class/Events","DS/UIKIT/SuperModal","DS/Controls/Toggle","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(e,t,n,i,r){return e.extend(t,{init:function(e){var t=this;this.className="TRMDetachDlgConfirm_modal",this.options=e,t.confirmModal=new n({className:this.className,closable:!0,okButtonText:e.action,animate:!0,renderTo:e.renderTo});var s=e.callback;e.callback=function(e){if(e){var n=t.displayToggle.checkFlag;localStorage.setItem("TRMDetachLocalStorage",!n)}s(e)},t.confirmModal.confirm(e),this.displayToggle=new i({type:"checkbox",label:r.displayAgain,checkFlag:!1});var o=document.querySelector("."+this.className+" .modal-body");this.displayToggle.inject(o)}})}),define("DS/TraceableRequirementsUtils/Command/ActionBar_DetachCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/Logger/Logger","DS/TraceableRequirementsUtils/views/TRMDetachReportPanel"],function(e,t,n,i,r){"use strict";var s=e.extend({name:"REQ_ACTION_BAR",_logger:null,init:function(e){this._logger=i.getLogger(s),this._parent(e,{isAsynchronous:!0}),this._options=e},beginExecute:function(){var e=this;require(["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(n,i,r){var s=t.get(),o=s.getSelectedElement(),a=[];if(null!==o){var l=[];l.push(o),a=l}else a=s.getSelectedElementList();"false"===localStorage.getItem("TRMDetachLocalStorage")?e._checkSelection(a):e._launchConfirm({callback:function(t){t?e._checkSelection(a):e.end()}}),e.end()})},_launchConfirm:function(e){var n=this;require(["DS/TraceableRequirementsUtils/views/TRMDetachDlgConfirm","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(i,r){var s;s=r.unparent_confirm_message_multiple,t.get()._ConfirmModal=n._confirmModal=new i({className:"TRMDetachDlgConfirm_modal",renderTo:document.body,action:r.unparent_confirm_title,title:r.unparent_confirm_title,message:s,callback:e.callback})})},_checkSelection:function(e){var t=this;require(["DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","UWA/Class/Promise","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(i,s,o,a,l){var c=[];t._reportFailure=[],t._reportAborted=[],t._reportSuccess=[];var u=!1,d=e.length;e.forEach(function(e){var i=e.path;if(UWA.is(i)&&UWA.is(i.length)&&1!==i.length)c.push(i[i.length-2]);else{var r=e.label+l.unparent_unsupported_root;1==d?n.errorAlert(r):t._reportFailure.push(r)}});var g=[],h=o.get(),p=new a(function(r,o){i.detach({securityContext:s.getSecurityContext(),json:{relationship_physical_ids:c},onComplete:function(n){var i=UWA.is(n,"string")?JSON.parse(n):n;t._logger.log("WS detach.onComplete"),(!UWA.is(i.PhysicalDelete)||UWA.is(i.PhysicalDelete)&&i.PhysicalDelete)&&(t._logger.log("Detach and refresh Element"),u=!0,i.results.Success.forEach(function(n){t._logger.log(n),e.forEach(function(e){var i=e.path;if(UWA.is(i)&&UWA.is(i.length)&&1!==i.length){if(i[i.length-2]==n){var r=l.DetachOf+e.label+l.From+e.ParentLabel+l.Succeeded;h.refreshOnRemove(e,!0),t._reportSuccess.push(r)}}else t._logger.log("Root cannot be detached")})}),i.results.Fail.forEach(function(n){t._logger.log(n),e.forEach(function(e){var i=e.path;if(UWA.is(i)&&UWA.is(i.length)&&1!==i.length){if(i[i.length-2]==n){var r=l.DetachOf+e.label+l.From+e.ParentLabel+l.Failed+l.FailureReasons;t._reportFailure.push(r)}}else t._logger.log("Root cannot be detached")})})),r()},onFailure:function(e,n){t._logger.log("WS detach.onFailure"),u=!1,t._reportFailure.push(l.unparent_error),o()},onTimeout:function(){u=!1,t._logger.warn("WS detach.onTimeout"),n.errorAlert(RequirementNls.Requirement_Notif_RequestTimeout),o()}})});p&&g.push(p),a.allSettled(g).then(function(){1==u&&(1==d?1==t._reportSuccess.length?n.sucessAlert(t._reportSuccess[0]):1==t._reportFailure.length&&n.errorAlert(t._reportFailure[0]):o.get()._ReportPanel=t.reportPanel=new r({title:l.DetachTitle,success:t._reportSuccess,failure:t._reportFailure,neutral:[],aborted:t._reportAborted}))})})}});return s}),define("DS/TraceableRequirementsUtils/Command/ActionBar_InsertNewCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0}),this._options=e,this._relPattern=JSON.parse(n),this._promisesData=[],this._promises=[]},beginExecute:function(){var e=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(n,r,s,o){var a,l,c,u,d=n.get(),g=!0,h=void 0,p=e._options.arguments[0].Type,m=p;UWA.is(d.getDefaultType)&&(m=d.getDefaultType(m));var f=d.getSelectedElement();UWA.is(f)?(a=f.physicalid,f.element,l=f.type,c=f.kindof,u=e._relPattern[c]||e._relPattern[l],h=null,UWA.is(u)?(h=u[p],UWA.is(h)||(g=!1,t.errorAlert(o.Requirement_Notif_CmdNotAvailable))):(g=!1,t.errorAlert(o.Requirement_Notif_CmdNotAvailable))):(t.warningAlert(o.Requirement_Notif_ObjectSelection),g=!1),g&&(d.beginBlockingTransaction(i.composite),r.insertNew({securityContext:s.getSecurityContext(),type:m,json:{pid:a,relationship:h,previousSibling:{},nextSibling:{},attributes:[]},onComplete:function(e){var n=(UWA.is(e,"string")?JSON.parse(e):e).results;if(n.Success.length>0){d.refreshOnInsert(n.Success,null,"insert");var i=n.Success[0],r=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision;s=(s=o.Requirement_Notif_ObjectCreated).replace("{TNR}",r),t.sucessAlert(s)}if(n.Failure.length>0){var s=o.Requirement_Notif_ObjectCreationFailed+" "+o.FailureReasons;t.errorAlert(s)}d.endBlockingTransaction()},onFailure:function(e,n){n=UWA.is(n,"string")?JSON.parse(n):n;UWA.is(n)&&UWA.is(n.message,"string")?t.errorAlert(n.message):t.errorAlert(e),d.endBlockingTransaction()},onTimeout:function(){t.errorAlert(o.Requirement_Notif_RequestTimeout),d.endBlockingTransaction()}})),e.end()})}})}),define("DS/TraceableRequirementsUtils/Command/ActionBar_InsertExternalObject",["UWA/Core","DS/Logger/Logger","DS/TraceableRequirementsUtils/Command/ReqCmdBase","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json"],function(e,t,n,i,r,s){"use strict";var o=n.extend({name:"REQ_ACTION_BAR",_logger:null,_options:null,init:function(e){this._logger=t.getLogger(o),this._options=e,this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._relPattern=JSON.parse(r)},beginExecute:function(){this._logger.log(this._id+".beginExecute")},execute:function(){var e=this,t="",n=e._options.arguments[2].operation;if(t="selectionDialog"===n?i.InsertExistExtReq:i.InsertNewExtReq,"enopad_odt_wgd"!=widget.id||"dummy"!=widget.id)try{require(["DS/LifecycleCmd/OSLCConsumerCmd","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/ApplicationFrame/CommandsManager"],function(r,o,a,l,c){var u=o.get(),d=c.getCommand("OSLCConsumerHdr",u.options.action_bar_opts&&u.options.action_bar_opts.context?u.options.action_bar_opts.context:null);d.setup({title:t,resourceType:"http://open-services.net/ns/rm#Requirement",operation:n,proxyType:"Requirement Proxy",providerFilter:"RM",securityContext:a.getSecurityContext(),tenantId:a.getTenant(),singleObject:!0,notification:function(t){if(UWA.is(t.error))u.displayNotification({eventID:"error",msg:t.error});else if(UWA.is(t.objects,"array")){if(0===t.objects.length)return console.log("result:"),void console.log(t);var n=u.getSelectedElement(),r=n.physicalid,o=(n.type,n.kindof,{dataArray:[]}),c=t.objects[0].proxy.id,d=e._options.arguments[1].relType;o.dataArray.push({pid:r,id:c,relationship:d,previousSibling:{},nextSibling:{}}),UWA.is(d)&&(u.beginBlockingTransaction(s.composite),l.insertExisting({securityContext:a.getSecurityContext(),json:o,onComplete:function(t){e._logger.log("WS insertExisting.onComplete");var n=(UWA.is(t,"string")?JSON.parse(t):t).results;if(u.refreshOnInsert(n,null,"insertExisting"),n.Success.length>0){var r=n.Success[0],s=(UWA.is(r.type,"object")?r.type.displayName:r.type)+" "+r.name+" "+r.revision;o=(o=i.InsertExisting_Success_msg).replace("{TNR}",s),RequirementAlertManager.sucessAlert(o),u.endBlockingTransaction()}if(n.Failure.length>0){var o;r=n.Failure[0],s=(UWA.is(r.type,"object")?r.type.displayName:r.type)+" "+r.name+" "+r.revision;o=(o=i.InsertExisting_Failure_msg+" "+i.FailureReasons).replace("{TNR}",s),RequirementAlertManager.errorAlert(o)}},onFailure:function(t){e._logger.log("WS insertExisting.onFailure"),t=UWA.is(t,"string")?JSON.parse(t):t,u.displayNotification({eventID:"error",msg:t.message}),u.endBlockingTransaction()},onTimeout:function(){e._logger.warn("WS insertExisting.onTimeout"),u.displayNotification({eventID:"error",msg:i.Requirement_Notif_RequestTimeout}),u.endBlockingTransaction()}}))}}}),d.execute()})}catch(e){console.log("DS/OSLCConsumer/OSLCConsumer file not found")}},endExecute:function(){this._logger.log(this._id+".endExecute")}});return o}),define("DS/TraceableRequirementsUtils/Command/ActionBar_ReplaceByNewVersion",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/Logger/Logger"],function(e,t){"use strict";var n=e.extend({name:"REQ_ACTION_BAR",_logger:null,init:function(e){this._logger=t.getLogger(n),this._parent(e,{isAsynchronous:!0}),this._options=e},_displayMessage:function(e,t,n){UWA.is(e.displayNotification)?e.displayNotification({eventId:n,msg:t}):alert(t)},beginExecute:function(){var e=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(t,n,i,r){var s,o=t.get(),a={},l=!1,c=o.getSelectedNodes();if(c.length>1)for(var u=c.length-1;u>0;u--)for(var d=0;d<u;d++)if(c[d+1].getOccurencePath().length<c[d].getOccurencePath().length){var g=c[d];c[d]=c[d+1],c[d+1]=g}if(UWA.is(c)&&c.length>0){var h=[];for(u=0;u<c.length;u++){var p=c[u].getOccurencePath();c[u].isRoot()&&(l=!0),s=o.getReqSpecRoot(c[u]);var m={object_id:p[p.length-1],rel_id:p[p.length-2],parent_id:s};h.push(m)}if(o.getSelectedParentWithChild(c).length>0)return e._displayMessage(o,r.Requirement_Notif_ParentChildSelection,"warning"),void e.end();if(l)return e._displayMessage(o,r.Requirement_Headers_ReviseRoot,"warning"),void e.end();if(null==s)return void e._displayMessage(o,r.Requirement_Headers_ReviseRoot,"warning");a={objects_to_revise:h,revise_mode:e._options.arguments[0].Type},n.replaceByNewLatestRevision({securityContext:i.getSecurityContext(),json:a,onComplete:function(n){e._logger.log("WS Revise.onComplete"),e._displayMessage(o,r[e._options.arguments[0].Type+".Requirement_Headers_Revise"],"success");var i=t.get(),s=UWA.is(n,"string")?JSON.parse(n):n;if("success"===s.status){var a=s.results;i.refreshOnRevise(a)}},onFailure:function(t,n){var i=t.message;n=UWA.is(n,"string")?JSON.parse(n):n,UWA.is(n.message)&&(i=UWA.is(r[n.message])?r[n.message]:n.message),e._displayMessage(o,i,"error")},onTimeout:function(){e._logger.warn("WS detach.onTimeout"),e._displayMessage(o,r.Requirement_Notif_RequestTimeout,"error")}})}else o.displayNotification({eventID:"warning",msg:r.Requirement_Notif_ObjectSelection});e.end()})}});return n}),define("DS/TraceableRequirementsUtils/Command/ActionBar_FindInReqDashboardCmd",["DS/Logger/Logger","DS/Controls/Button","DS/ENOFloatingPanel/ENOFloatingPanel","DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/PADUtils/PADContext","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/Controls/LineEditor","DS/WebappsUtils/WebappsUtils","DS/Controls/Toggle"],function(e,t,n,i,r,s,o,a,l){"use strict";var c=null,u=0,d=i.extend({name:"REQ_ACTION_BAR",_logger:null,init:function(t){return c=this,this._logger=e.getLogger(d),this._parent(t,{isAsynchronous:!0}),this.mediator=t.mediator,this._options=t,this.context=r.get(),this.defaultOptions.renderTo=".xnav_component",this._initialized=!0,this},_displayMessage:function(e,t,n){UWA.is(e.displayNotification)?e.displayNotification({eventId:n,msg:t}):alert(t)},_decodeHtml:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},launchFindWindow:function(){c._buildDialog()},beginExecute:function(){this.launchFindWindow(),this.end()},RemoveHighLight:function(e){var t=document.getElementsByClassName(e);for(u=0;t.length>0;)t[0].outerHTML=t[0].innerText},UpdateLabel:function(e){var t=0;e>0&&(t=u+1),c._label.innerText=t+" of "+e},HandleEscapeSequence:function(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},getHtmlDivAndText:function(e){var t=e;"rich-object-header"==e.className?t=e.getElementsByClassName("object-link")[0]:"rich-object-body"==e.className&&(t=e.getElementsByClassName("rich-object-content")[0].children[0]);return{innerHtmlofDiv:t.innerHTML,innerTextOfDiv:t.innerText}},SetInnerHtmlDiv:function(e,t){var n=e;"rich-object-header"==e.className?n=e.getElementsByClassName("object-link")[0]:"rich-object-body"==e.className&&(n=e.getElementsByClassName("rich-object-content")[0].children[0]),n.innerHTML=t},isIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>0||n>0},HighLightText:function(e){var t=c._SearchEditor.value,n=c._SearchEditor.value;t=t.replace(new RegExp("\\$","g"),"[$]"),c._Check_WholeWord.checkFlag&&(t="\\b"+t+"\\b");var i=null;0==c._Check_MatchCase.checkFlag?i=new RegExp(t,"gi"):1==c._Check_MatchCase.checkFlag&&(i=new RegExp(t,"g"));var r,s=this.context.getPADTreeDocument().getAllDescendants();for(r=0;r<s.length;r++){var o=s[r].getRichViewElement();if(null!==o){var a=new Array(2),l=0;"Chapter"===o.options.kindof?(a[0]="rich-container-title",l=1):(l=2,a[0]="rich-object-header",a[1]="rich-object-body");for(var d=0;d<l;d++){var g=c.getHtmlDivAndText(o.container[0].getElementsByClassName(a[d])[0]),h=g.innerHtmlofDiv,p=g.innerTextOfDiv,m=p.search(i);if(-1!=m){for(var f,v=[],S=[];f=i.exec(p);)-1==v.indexOf(f[0])&&(v.push(f[0]),S.push(f));for(var _=0;_<v.length;_++){m=S[_].index;var y=p.substring(m,m+n.length),b=c.HandleEscapeSequence(y),C=new RegExp(b.replace(new RegExp("\\$","g"),"[$]"),"g"),x=h.replace(C,"<span class = 'highlight_Find'>"+b+"</span>");c.SetInnerHtmlDiv(o.container[0].getElementsByClassName(a[d])[0],x),h=x,0==u&&(document.getElementsByClassName("highlight_Find")[0].style.backgroundColor="aqua")}}y}}}},_buildDialog:function(){c._dialogBody=new UWA.Element("div",{class:"wux-control-inline-container",style:{"vertical-align":"center"},styles:{float:"center",display:"flex"}}),c._footer=UWA.createElement("div",{class:"wux-control-inline-container",style:{"vertical-align":"center"},styles:{float:"center",display:"flex",width:"350px"}}),c._Check_MatchCase=new l({domId:"idMatchCaseCheckBox",type:"checkbox",label:s.Find_InDashboard_MatchCaseCheckBox,value:0,checkFlag:!0}),c._Check_WholeWord=new l({domId:"idWholeWordCheckBox",type:"checkbox",label:s.Find_InDashboard_WholeWordCheckBox,value:1}),c._Check_MatchCase.inject(c._footer),c._Check_WholeWord.inject(c._footer),c._label=new UWA.Element("div",{domId:"idFindLabel",text:"0 of 0",styles:{float:"right",flex:"1",padding:"5px"}}),c._label.inject(c._footer),c._NextButton=new t({domId:"idNextButton",icon:{iconClasses:"fonticon fonticon-chevron-right ",fontIconSize:"5x"}}),c._PreviousButton=new t({domId:"idPrevButton",icon:{iconClasses:"fonticon fonticon-chevron-left ",fontIconSize:"5x"}}),c._FindButton=new t({domId:"idFindButton",icon:{iconClasses:"fonticon fonticon-search",fontIconSize:"5x"}}),c._FindButton.addEventListener("buttonclick",function(e){if(c.RemoveHighLight("highlight_Find"),c._SearchEditor.value.length<4){var t=r.get();return c._displayMessage(t,s.Find_InDashboard_Less_Char,"error"),void c.UpdateLabel(document.getElementsByClassName("highlight_Find").length)}c.HighLightText("rich-object-header"),c.UpdateLabel(document.getElementsByClassName("highlight_Find").length)}),c._PreviousButton.addEventListener("buttonclick",function(e){var t=document.getElementsByClassName("highlight_Find")[u];t.removeAttribute("style"),t.outerHTML.replace('style=""',""),--u<0&&(u=document.getElementsByClassName("highlight_Find").length-1);var n=document.getElementsByClassName("highlight_Find")[u];n.style.backgroundColor="aqua",c.UpdateLabel(document.getElementsByClassName("highlight_Find").length),c.isIE()||n.parentElement.scrollIntoView({behavior:"smooth",block:"nearest"})}),c._NextButton.addEventListener("buttonclick",function(e){var t=document.getElementsByClassName("highlight_Find")[u];t.removeAttribute("style"),t.outerHTML.replace('style=""',""),++u>document.getElementsByClassName("highlight_Find").length-1&&(u=0);var n=document.getElementsByClassName("highlight_Find")[u];n.style.backgroundColor="aqua",c.UpdateLabel(document.getElementsByClassName("highlight_Find").length),c.isIE()||n.parentElement.scrollIntoView({behavior:"smooth",block:"nearest"})}),c._SearchEditor=new o({domId:"idFindEditor",placeholder:s.id_Find_Editor,style:{height:"50px"}}),c._SearchEditor.inject(c._dialogBody),c._FindButton.inject(c._dialogBody),c._PreviousButton.inject(c._dialogBody),c._NextButton.inject(c._dialogBody),c._floatingComponent=new n({className:"FindInDashBoard",title:s.Find_InDashboard_Cmd,body:c._dialogBody,footer:c._footer,closable:!0,resizable:!1,overlay:!0,events:{onResizeFloating:function(){c._logger.log("onResizeFloating")},onClose:function(){c._logger.log("onClose"),c._onCancel(c._floatingComponent)}}}).inject(widget.body),c._floatingComponent.show(),c._dialogBody.show()},_onCancel:function(){c.RemoveHighLight("highlight_Find"),c._onLoadingUI=!1,c._logger.log("onCancel"),c._floatingComponent.hide(),c._floatingComponent.destroy()}});return d}),define("DS/TraceableRequirementsUtils/Command/ActionBar_AddNewCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0}),this._options=e,this._relPattern=JSON.parse(n),this._promisesData=[],this._promises=[]},beginExecute:function(){var e=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(n,r,s,o){var a,l,c,u,d,g,h,p=n.get(),m=!0,f=void 0,v=null,S=null,_=e._options.arguments[0].Type,y=_;UWA.is(p.getDefaultType)&&(y=p.getDefaultType(y));var b=null;if(UWA.is(p.getToAddSelectedElement)){if(null==(b=p.getToAddSelectedElement()))return void t.warningAlert(o.Requirement_Notif_MutliSelection);a=b.physicalid,l=b.element,c=b.type,u=b.kindof,g=b.previousSibling,h=b.nextSibling,UWA.is(b.previousNode)&&null!=b.previousNode&&(v=b.previousNode)}else if(UWA.is(p.authoring)&&UWA.is(p.authoring.placeholder)){a=(b=p.getSelectedElement()).physicalid,l=b.element,c=b.type,u=b.kindof;S=null;b.position="after",b.content="",b.target={element:l,id:UWA.is(l)?l.attr("id"):""},a=(S=p.authoring.placeholder(b)).parent.objectId,c=S.parent.type,g=S.previousSibling,h=S.nextSibling,u=S.parent.kindof}else t.errorAlert(o.Requirement_Notif_CmdNotAvailable);d=e._relPattern[u]||e._relPattern[c],f=null,UWA.is(d)?(f=d[_],UWA.is(f)||(m=!1,t.errorAlert(o.Requirement_Notif_CmdNotAvailable))):(m=!1,t.errorAlert(o.Requirement_Notif_CmdNotAvailable)),m&&(p.beginBlockingTransaction(i.composite),r.insertNew({securityContext:s.getSecurityContext(),type:y,json:{pid:a,relationship:f,previousSibling:g,nextSibling:h,attributes:[]},onComplete:function(e){var n=(UWA.is(e,"string")?JSON.parse(e):e).results;if(n.Success.length>0){UWA.is(p.refreshOnInsertSibling)?p.refreshOnInsertSibling(n.Success,S,v):p.refreshOnInsert(n.Success,S,"insert");var i=n.Success[0],r=(UWA.is(i.type,"object")?i.type.displayName:i.type)+" "+i.name+" "+i.revision;s=(s=o.Requirement_Notif_ObjectCreated).replace("{TNR}",r),t.sucessAlert(s)}if(n.Failure.length>0){var s=o.Requirement_Notif_ObjectCreationFailed+" "+o.FailureReasons;t.errorAlert(s)}p.endBlockingTransaction()},onFailure:function(e,n){UWA.is(S)&&S.placeholder.container.remove(),UWA.is(n)&&UWA.is(n.message,"string")?t.errorAlert(n.message):t.errorAlert(e),p.endBlockingTransaction()},onTimeout:function(){UWA.is(S)&&S.placeholder.container.remove(),t.errorAlert(o.Requirement_Notif_RequestTimeout),p.endBlockingTransaction()}})),e.end()})}})}),define("DS/TraceableRequirementsUtils/Command/ActionBar_CreateStandaloneCmd",["DS/ApplicationFrame/Command","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","DS/TraceableRequirementsUtils/utils/RequirementAlertManager"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e,{isAsynchronous:!0}),this._options=e,this._relPattern=JSON.parse(t)},_displayMessage:function(e,t,n){UWA.is(e.displayNotification)?e.displayNotification({eventID:n,msg:t}):alert(t)},beginExecute:function(){var e=this;require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(t,i,r,s){var o=t.get(),a=e._options.arguments[0].Type;UWA.is(o.getDefaultType)&&(a=o.getDefaultType(a));var l="false";UWA.is(o.getEnforceSettings,"function")&&(l=o.getEnforceSettings()),i.create({securityContext:r.getSecurityContext(),ReQConfigAuthManagement:l,type:a,json:{ReQConfigAuthManagement:l},onComplete:function(e){var t=(UWA.is(e,"string")?JSON.parse(e):e).results;o.refreshOnCreate(t,!0);var i=(UWA.is(t.type,"object")?t.type.displayName:t.type)+" "+t.name+" "+t.revision,r=s.Requirement_Notif_ObjectCreated;r=r.replace("{TNR}",i),n.sucessAlert(r)},onFailure:function(e,t){if(UWA.is(e,"string"))try{e=JSON.parse(t)}catch(e){}if(UWA.is(t,"string"))try{t=JSON.parse(t)}catch(e){}UWA.is(t)&&UWA.is(t.message,"string")?n.errorAlert(t.message):UWA.is(e)&&UWA.is(e.message,"string")?n.errorAlert(e.message):UWA.is(e,"string")?n.errorAlert(e):console.error('"RequirementWebServices.create(...)" failed without returning an error message!')},onTimeout:function(){n.errorAlert(s.Requirement_Notif_RequestTimeout)}}),e.end()})}})}),define("DS/TraceableRequirementsUtils/Utils",["UWA/Core","DS/Logger/Logger","DS/TraceableRequirementsUtils/jQuery","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","UWA/Utils/Client","DS/PlatformAPI/PlatformAPI","UWA/Class/Promise"],function(e,t,n,i,r,s,o){"use strict";var a,l,c,u=t.getLogger("DS/TraceableRequirementsUtils/Utils"),d=function(e,t){return this.channels[e]||(this.channels[e]=[]),this.channels[e].push({context:this,callback:t}),this},g=function(e){if(!this.channels[e])return!1;for(var t=Array.prototype.slice.call(arguments,1),n=0,i=this.channels[e].length;n<i;n++){var r=this.channels[e][n];r.callback.apply(r.context,t)}return this},h={mediator:{channels:{},publish:g,subscribe:d,installTo:function(e){e.channels={},e.subscribe=d,e.publish=g}},getSecurityContextForProperties:function(){var e="";return e="ENOLCMT_AP"===this.getAppId()?widget.data.securityContext:this.getSecurityContext(),UWA.is(e,"string")&&-1===e.indexOf("ctx::")&&(e="ctx::"+e),e},getSecurityContext:function(){var e=widget.getValue("trm_security_ctx");if(UWA.is(e)&&""!==e||""!==(e=widget.getValue("pad_security_ctx")))return UWA.is(e,"string")&&-1===e.indexOf("ctx::")&&(e="ctx::"+e),e},getTenant:function(){var e=widget.getValue("req_tenant");if(UWA.is(e)||(e=widget.getValue("x3dPlatformId")),UWA.is(e))return UWA.is(e.value)?e.value:e},setXPrefCredentials:function(e,t){var n=t.replace("ctx::","");e.setValue("xPref_CREDENTIAL",n),e.setValue("tenantAware",!0)},computeDisplayName:function(e,t){var n=e.name,i=UWA.is(t,"string")?JSON.parse(t):t,r=i.treeDisplayName,s=i.treeDisplayTitle,o=i.treeDisplayRevision,a=i.treeDisplaySeperation,l=i.treeDisplayTitleMaxSize;l=Math.floor(l);var c=e.title,u="  ";return""!==a&&"false"!==a&&(u=" | "),"false"!==r&&""!==r&&"false"!==s&&""!==s&&0!==c.length&&(n=e.name+u+c),"false"!==r&&""!==r||"false"===s||""===s||0===c.length||(n=c),"false"!=o&&""!=o&&(n+=u+e.revision),"false"!==r&&""!==r||"false"!==s&&""!==s||"false"!==o&&""!==o||(n=c+" "+e.revision),n},app_initialization:function(e){if(u.log("app_initialization"),!UWA.is(e,"function"))throw new Error("Invalid callback for the REQ app initialization");i.getPlatformServices({onComplete:function(t){a=t,e.call(null)},onFailure:function(e){throw u.error("Cannot retrieve the Platform Services"),new Error("Cannot retrieve the Platform Services")}});try{i.getServiceUrl({serviceName:"3DSearch",platformId:widget.getValue("x3dPlatformId"),onComplete:function(e){"string"==typeof e?l=e:(l=e[0].url,e.forEach(function(e){e.platformId==widget.getValue("x3dPlatformId")&&(l=e.url)}))},onFailure:function(e){}})}catch(e){}},getUserLogin:function(){var e=h.getUser(),t="";return void 0!==e&&(t=e.login),t},getUser:function(){var e=null;return null==e&&(e=s.getUser()),e},getPlatformId:function(){return"undefined"!=typeof widget&&widget.getValue("x3dPlatformId")},getSharedId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dSharedId")?widget.getValue("x3dSharedId"):this.getAppId()},getTenantsPreference:function(){var e=[];if(!UWA.is(a,"array"))throw new Error("Platform services not initialize yet");return a.forEach(function(t){e.push({label:t.displayName,value:t.platformId})}),e},getCurrentUser:function(){return new o(function(e,t){i.getUser({onComplete:function(t){e({id:t.id,email:t.email,firstName:t.firstname,lastName:t.lastname})},onFailure:t})})},loadCurrentUserRoles:function(){return new o(function(e,t){i.getGrantedRoles(function(t){e(t)})})},getAppId:function(){if("undefined"!=typeof widget)return widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):widget.getValue("appId")},getRequestLabel:function(){return h.getUserLogin()+"-"+h.getAppId()+"-"+Date.now()},getTenant3DSpaceUrl:function(e){for(var t=0,n=0;n<a.length;n++)a[n].platformId===e&&(t=n);return a[t]["3DSpace"]},getServiceSearchUrl:function(){return l},get3DSpaceUrl:function(){if(!UWA.is(a,"array"))throw new Error("Platform services not initialize yet");var e=this.getTenantIndex();return a[e]["3DSpace"]},getServiceURL:function(e,t){t=t||this.getPlatformId();var n=this.getTenantIndex();return a[n][e]},getUserPrefKey:function(e){return this.getPlatformId()+"_"+e},getTenantIndex:function(){var e=this.getTenant(),t=!1;if(UWA.is(e)){var n=e;if(!UWA.is(c)||a[c].displayName!==n){for(var i=0;i<a.length&&!t;i++)a[i].platformId===n&&(c=i,t=!0);UWA.is(c)||(c=0)}}return c},setTenantIndex:function(e){var t=e;if(a[c].displayName!==t)for(var n=0;n<a.length;n++)a[n].platformId===t&&(c=n)},getPlatformServices:function(){if(!UWA.is(a,"array"))throw new Error("Platform services not initialize yet");return a},getLanguage:function(){var e;widget&&widget.lang?e=widget.lang:e=(navigator?navigator.language||navigator.systemLanguage:"en").toLowerCase().split("-")[0];return e},getWidgetId:function(){return"undefined"!=typeof widget?widget.id:-1},isOnCloud:function(){var e=this.getTenant();return!(!UWA.is(e)||"OnPremise"===e)},isIpad:function(){return r.Platform.ipad},isAndroid:function(){return r.Platform.android},isSurface:function(){return r.Platform.tablet&&(r.Platform.win32||r.Platform.win64)},isMobile:function(){return this.isIpad()||this.isAndroid()||this.isSurface()},copyTexttoCLipboard:function(e){var t=document.createElement("textarea");if(t.classList.add("bookmark-txt-link"),t.value=e,document.body.appendChild(t),r.Platform.hasOwnProperty("ios")&&!0===r.Platform.ios){t.contentEditable=!0,t.readOnly=!0;var n=document.createRange();n.selectNodeContents(t);var i=window.getSelection();i.removeAllRanges(),i.addRange(n),t.setSelectionRange(0,t.value.length)}else t.select();try{var s=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),!!s},_decodeHTML:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}};return h}),define("DS/TraceableRequirementsUtils/utils/TRMSearchNav",["UWA/Core","UWA/Controls/Abstract","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils.json","DS/Controls/Button","DS/UIKIT/Tooltip","DS/Core/ModelEvents"],function(e,t,n,i,r,s,o){"use strict";return t.extend({renderTo:null,visible:!1,_modelEvents:null,init:function(e){this.renderTo=e.renderTo?e.renderTo:document.body,this._parent(e),this._buildSkeleton(e.multiSel),this._modelEvents=new o;require(["DS/PADServices/utils/GlobalModelEvents"],function(e){e.subscribe({event:"ENXViews/TRMSearchNav/close"},function(e){this.getModelEvents().publish({event:"close"})}.bind(this))}.bind(this))},show:function(){!1===this.visible&&(this.elements.container.inject(this.renderTo),this.visible=!0)},hide:function(){!0===this.visible&&(this.renderTo.removeChild(this.elements.container),this.visible=!1)},setLabel:function(e){this.elements.textInfo&&(this.elements.textInfo.innerHTML=e)},publish:function(e){this.getModelEvents().publish(e)},subscribe:function(e,t){return this.getModelEvents().subscribe(e,t)},unsubscribe:function(e){this.getModelEvents().unsubscribe(e)},getModelEvents:function(){return this._modelEvents},_buildSkeleton:function(e){var t=this;this.elements.container=UWA.createElement("div",{class:"TRMSearchNavContainer"}),this.elements.topBarContainer=UWA.createElement("span",{class:"TRMSearchSelectionNavigatiorTopBar"}).inject(this.elements.container),this.elements.previousButton=UWA.createElement("span",{class:"wux-ui-fa-PreviousImage TRMSearchNavPreviousButton","data-toggle":"tooltip","data-placement":"bottom",title:i.ENOTRMApp_Tooltip_Previous}).inject(this.elements.topBarContainer),this.elements.previousButton.addEventListener("click",function(e){t.getModelEvents().publish({event:"previous"})}),this.elements.previousButton.addEventListener("touchend",function(e){t.getModelEvents().publish({event:"previous"})}),this.elements.textInfo=UWA.createElement("div",{class:"TRMSearchNavLabel wux-afr-label"}).inject(this.elements.topBarContainer),this.elements.nextButton=UWA.createElement("span",{class:"wux-ui-fa-NextImage TRMSearchNavNextButton","data-toggle":"tooltip","data-placement":"bottom",title:i.ENOTRMApp_Tooltip_Next}).inject(this.elements.topBarContainer),this.elements.nextButton.addEventListener("click",function(e){t.getModelEvents().publish({event:"next"})}),this.elements.nextButton.addEventListener("touchend",function(e){t.getModelEvents().publish({event:"next"})}),e&&(this.elements.selectButton=UWA.createElement("span",{class:"fonticon fonticon-select-on TRMSearchNavSelectButton","data-toggle":"tooltip","data-placement":"bottom",title:i.ENOTRMApp_Tooltip_SelectAll}).inject(this.elements.topBarContainer),this.elements.selectButton.addEventListener("click",function(e){t.getModelEvents().publish({event:"select-on"})}),this.elements.selectButton.addEventListener("touchend",function(e){t.getModelEvents().publish({event:"selectAll"})})),this.elements.closeButton=UWA.createElement("span",{class:"fonticon fonticon-wrong TRMSearchNavCloseButton","data-toggle":"tooltip","data-placement":"bottom",title:i.ENOTRMApp_Tooltip_Close}).inject(this.elements.topBarContainer),this.elements.closeButton.addEventListener("click",function(e){t.getModelEvents().publish({event:"close"})}),this.elements.closeButton.addEventListener("touchend",function(e){t.getModelEvents().publish({event:"close"})})}})}),define("DS/TraceableRequirementsUtils/Services/RichContentObjectServices",["UWA/Drivers/Alone","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/WAFData/WAFData","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","DS/Logger/Logger"],function(e,t,n,i,r,s,o,a,l){"use strict";return n.extend(i,r,{name:"RichContentObjectServices",defaultOptions:{url:null,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:100,thumbnailHeight:100,maxFiles:null,params:{},ignoreHiddenFiles:!0,autoProcessQueue:!0,addRemoveLinks:!1,previewsContainer:null,accept:function(e,t){return t()}},init:function(e){this,this.options=UWA.merge(this.defaultOptions,e||{})},checkinFiles:function(e){var t={},n=o.get3DSpaceUrl()+"/resources/richeditor/res/checkinRCO";if(n+="?objectId="+e.physicalid,!UWA.is(e.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(e.callbacks.onTimeout,"function"))throw new Error("No onTimeout callback function defined");if(!UWA.is(e.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var i=e.callbacks.onComplete;t.onComplete=function(t){i(t,e)};var r=e.callbacks.onTimeout;t.onTimeout=function(t){r(t,e)};var l=e.callbacks.onFailure;t.onFailure=function(t){l(t,e)};var c=e.files;if(c&&c.length){t.method="POST",t.headers={Accept:"application/json","Cache-Control":"no-cache"},t.timeout=24e4;var u=a.get();if(UWA.is(u)&&u.getCSRF&&UWA.is(u.getCSRF)){var d=u.getCSRF(),g=Object.keys(d)[0],h=d[g];n+="&"+g+"="+h+"&"+h+"="+d[h]}else UWA.is(u)&&(n+="&csrfTokenName="+u.csrf.csrfTokenName+"&ENO_CSRF_TOKEN="+u.csrf.ENO_CSRF_TOKEN);var p=c[0],m=new FormData;m.append("file",p,p.name),t.data=m,s.authenticatedRequest(n,t)}}})}),define("DS/TraceableRequirementsUtils/Services/RequirementTenantMgt",["UWA/Class","UWA/Class/Events","DS/Logger/Logger","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(e,t,n,i,r,s){"use strict";var o=e.singleton(t,{name:"RequirementTenantMgt",options:{},_preferences_added:!1,_logger:null,init:function(){this._logger=n.getLogger(o)},addTenant2Preferences:function(e){if(this._logger.log("addTenant2Preferences"),!UWA.is(widget))throw new Error("widget variable isn't defined");void 0!==e&&void 0!==e.events&&this.addEvents(e.events),!1===this._preferences_added&&(this._logger.log("add tenant information to the widget preferences"),widget.mergePreferences([{name:"req_tenant",type:"list",label:s.trm_Tenant,defaultValue:""}]),this._logger.log("Fill the values"),this._fillPreferences(),this._preferences_added=!0)},_fillPreferences:function(){this._logger.log("_fillPreferences");if(void 0===widget)throw new Error("widget variable isn't defined");var e=[];r.getPlatformServices().forEach(function(t){e.push({label:t.displayName,value:t.platformId})}),this._update_req_tenant_pref(e)},_update_req_tenant_pref:function(e){var t=!1,n=widget.getValue("req_tenant")?widget.getValue("req_tenant"):e[0];if(""===widget.getValue("req_tenant"))for(var i=widget.getValue("x3dPlatformId"),r=0;r<e.length&&!t;r++)e[r].value===i&&(n=e[r],t=!0);UWA.is(e)&&e.length>0&&(widget.addPreference({name:"req_tenant",type:"list",label:s.trm_Tenant,defaultValue:n,options:e,onchange:"onUpdateTenant"}),widget.setValue("req_tenant",n),this.dispatchEvent("onUpdateTenant",n))}});return o}),define("DS/TraceableRequirementsUtils/Command/ActionBar_DownloadMSAddin",["DS/ApplicationFrame/Command","DS/TraceableRequirementsUtils/Utils"],function(e,t){"use strict";var n=null;return e.extend({init:function(e){n=this,this._parent(e,{isAsynchronous:!0}),this.path="/requirements/ENOVIA_RMCInstaller.zip",!0!==t.isOnCloud()&&!0!==t.isMobile()||this.disable()},beginExecute:function(){},execute:function(){n=this;var e=t.get3DSpaceUrl()+n.path;window.open(e)},endExecute:function(){}})}),define("DS/TraceableRequirementsUtils/Services/RequirementWebServices",["UWA/Core","DS/WAFData/WAFData","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/PADUtils/PADUtilsServices","require"],function(e,t,n,i,r,s,o,a){"use strict";var l=function(e,i){var r=n.getLanguage();e.timeout=1e9,e.method="GET",e.headers||(e.headers.Accept="application/json",e.headers["Cache-Control"]="no-cache",e.headers["Content-Type"]="application/json"),e.headers["Accept-Language"]=r,i=(i=i.replace(/\[/g,"%5B")).replace(/\]/g,"%5D"),t.authenticatedRequest(i,e)},c=function(r,s,o){var a=n.getLanguage();r.timeout=1e9,r.method="POST",r.headers.Accept="application/json",r.headers["Content-Type"]="application/json",r.headers["Cache-Control"]="no-cache",r.headers["Accept-Language"]=a;var l=i.get();if(e.is(l)&&e.is(l.getCSRF)&&(o.csrf=l.getCSRF()),e.is(l)&&e.is(l.getAuthoringContextPID)){var c=l.getAuthoringContextPID();""!==c&&null!==c&&(r.headers["DS-Change-Authoring-Context"]="pid:"+c)}r.data=JSON.stringify(o),t.authenticatedRequest(s,r)},u=function(i,r,s){var o=n.getLanguage();i.method="PUT",i.headers.Accept="application/json",i.headers["Content-Type"]="application/json",i.headers["Accept-Language"]=o;var l=null;try{var c=a("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").get();l=e.is(c)&&e.is(c.change.id)?c.change.id:null}catch(e){console.warn("CfgAuthoringContext throw an error")}null!=l&&""!=l.trim()&&(i.headers["DS-Change-Authoring-Context"]="pid:"+l),s.csrf=i.csrf,i.data=JSON.stringify(s),t.authenticatedRequest(r,i)},d=function(r,s,o){var a=n.getLanguage();r.method="PUT",r.headers||(r.headers.Accept="application/json",r.headers["Content-Type"]="application/json",r.headers["Accept-Language"]=a);var l=i.get();if(e.is(l)&&e.is(l.getCSRF)&&(o.csrf=l.getCSRF()),e.is(l)&&e.is(l.getAuthoringContextPID)){var c=l.getAuthoringContextPID();""!==c&&null!==c&&(r.headers["DS-Change-Authoring-Context"]="pid:"+c)}r.data=JSON.stringify(o),t.authenticatedRequest(s,r)};return{fetchPredicateData:function(t){var i=t;i.method="POST",i.headers||(i.headers={});var r,s=n.getServiceSearchUrl()+"/search";i.PIDs&&i.PIDs.length,r="physicalid:"+i.PIDs.toString().replaceAll(","," OR physicalid:");var a=e.is(i.predicate,"array")?i.predicate:[i.predicate],l=e.merge(e.clone({}),{label:o.getRequestLabel(),with_indexing_date:!0,select_predicate:a,select_synthesis:a,query:r,source:["3dspace"],tenant:n.getTenant()});c(i,s,l)},insertExisting:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.insertExisting");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/insertexisting";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},connect:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.connect");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/insertexisting";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},endLinkConnect:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.connect");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/endlinkconnect";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},insertNew:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.insert");i.headers||(i.headers={});var r=t.type,s=n.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/"+r+"/insertnew";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var o=t.json;c(i,s,o)}else this.getsecuritycontext({onComplete:function(n){var r=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=r.SecurityContext;n=t.json;c(i,s,n)}})},reorder:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.reorder");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/reorder";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},getEffectivityInfo:function(t){var i=t;i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/modeler/configuration/navigationServices/getMultipleFilterableObjectInfo";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},getConfigSettings:function(t){var i=t;i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/modeler/configuration/settingsServices/getConfigurationSettings";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},getReQConfigAuthManagement:function(e){var t=e;t.headers||(t.headers={});var i=n.get3DSpaceUrl()+"/resources/ParamWS/access/DomainElements?tenant=OnPremise&domainid=RequirementsConfiguration&xrequestedwith=xmlhttprequest";e.familyid&&(i=i+"&familyid="+e.familyid),l(t,i)},create:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.create");i.headers||(i.headers={});var r=t.type,s=n.get3DSpaceUrl()+"/resources/trm/authoring/model/"+r+"/create";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var o=t.json;c(i,s,o)}else this.getsecuritycontext({onComplete:function(n){var r=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=r.SecurityContext;n=t.json;c(i,s,n)}})},edit:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.insert");i.headers||(i.headers={});var r=t.pid,s=n.get3DSpaceUrl()+"/resources/trm/authoring/model/edit/"+r;if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var o=t.json;d(i,s,o)}else this.getsecuritycontext({onComplete:function(n){var r=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=r.SecurityContext;n=t.json;d(i,s,n)}})},enforceWorkUnder:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for enforceWorkUnder");var r=n.getLanguage();i.headers||(i.headers={},i.headers.Accept="application/json",i.headers["Content-Type"]="application/json",i.headers["Accept-Language"]=r);var s=t.tenant,o=n.get3DSpaceUrl()+"/resources/modeler/change/changecontrol?tenant="+s;if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var a=t.json;d(i,o,a)}else this.getsecuritycontext({onComplete:function(n){var r=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=r.SecurityContext;n=t.json;d(i,o,n)}})},editRelationAttributes:function(t){console.log("function called");var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.insert");i.headers||(i.headers={});var r=t.pid,s=n.get3DSpaceUrl()+"/resources/trm/authoring/model/updateRelationAttr/"+r;if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var o=t.json;console.log("in if"),d(i,s,o)}else this.getsecuritycontext({onComplete:function(n){var r=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=r.SecurityContext;n=t.json;console.log("in else"),d(i,s,n)}})},getRelStatusValues:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getKindOf");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/rmt/get/browsing";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},getContent:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.insert");i.headers||(i.headers={});var r=t.pid,s=n.get3DSpaceUrl()+"/resources/trm/browsing/model/content/"+r;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,s)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,s)}})},getHistory:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.insert");i.headers||(i.headers={});var r=t.pid,s=n.get3DSpaceUrl()+"/resources/trm/dictionary/history/"+r;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,s)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,s)}})},getAttributeRange:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.insert");i.headers||(i.headers={});var r=t.attributeName,s=n.get3DSpaceUrl()+"/resources/trm/dictionary/attributerange/"+r;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,s)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,s)}})},getMyAppPreferences:function(e){var t=n.getServiceURL("3DCompass")+"/resources/AppsMngt/user/preference",i=e;return i.method="GET",i.headers={Accept:"application/json, text/plain"},i.data={name:e.preference_name},this.executeRequest(t,i)},setMyAppPreferences:function(e){var t=n.getServiceURL("3DCompass")+"/resources/AppsMngt/user/preference",i=e;return i.method="PUT",i.headers={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},i.data={name:e.preference_name,value:e.value},this.executeRequest(t,e)},getDictionaryCUSTO:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for API DictionaryCUSTO");i.headers||(i.headers={});var r=n.getLanguage(),s=n.get3DSpaceUrl()+"/resources/dictionary/DictionaryCUSTO?displayAttributes=true&lang="+r;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,s)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,s)}})},getAttributeInfo:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getAttributeInfo");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/dictionary/attributeInfo";void 0!==t.attributes&&null!==t.attributes&&(r+="?attributes="+t.attributes),e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getsecuritycontext:function(t){var i=n.get3DSpaceUrl(),r=t.tenant;e.is(r)&&(i=n.getTenant3DSpaceUrl(r)),t.proxy="passport";var s=i+"/resources/modeler/pno/person?current=true&select=preferredcredentials&select=collabspaces",o=t;if(o.headers||(o.headers={}),e.is(r)&&(s+="&tenant="+r),!e.is(s)||!e.is(o,"object"))throw new Error("Invalid inputs for RequirementWebServices.getsecuritycontext");l(o,s)},availablesecuritycontext:function(t){var i=n.get3DSpaceUrl(),r=t.tenant;e.is(r)&&(i=n.getTenant3DSpaceUrl(r)),t.proxy="passport";var s=i+"/resources/bps/cspaces",o=t;if(o.headers||(o.headers={}),e.is(r)&&(s+="?tenant="+r),!e.is(s)||!e.is(o,"object"))throw new Error("Invalid inputs for RequirementWebServices.availablesecuritycontext");l(o,s)},getInfo:function(t){var r=t;if(!e.is(r,"object"))throw new Error("Invalid inputs for RequirementWebServices.getInfo");r.headers||(r.headers={});var s=n.get3DSpaceUrl()+"/resources/trm/dictionary/info";s+="?pid="+t.pid,void 0!==t.selectables&&null!==t.selectables&&(s+="&select="+t.selectables);var o=i.get();if(e.is(o)&&e.is(o.getAuthoringContextPID)){var a=o.getAuthoringContextPID();""!==a&&null!==a&&(r.headers["DS-Change-Authoring-Context"]="pid:"+a)}e.is(t.securityContext)?(r.headers.SecurityContext=t.securityContext,l(r,s)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;r.headers.SecurityContext=n.SecurityContext,l(r,s)}})},setAttributeTreeOrder:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.setAttributeTreeOrder");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/structure/treeOrder";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},getAttributeTreeOrder:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getAttributeTreeOrder");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/dictionary/treeOrder";r+="?pid="+t.pid,e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getCustomTypes:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getCustomTypes");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/browsing/model/custom/"+t.type;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getKindOf:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getKindOf");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/browsing/model/"+t.pid+"/kindof";e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getAllStructure:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getKindOf");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/browsing/model/"+t.pid+"/getAllStructure";e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},expand:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getKindOf");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/browsing/model/expand";if(t.OptimizedLoading&&(r+="?optimizedloading=true"),e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},detach:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.detach");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/detach";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},replaceByNewLatestRevision:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.replaceByNewRevision");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/replacebynewlatestrevision";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},navigate:function(t){var i=n.get3DSpaceUrl(),r=t;if(i+="/cvservlet/multiexpand",!e.is(i)||!e.is(r,"object"))throw new Error("Invalid inputs for PADWSAccess.navigate");if(!e.is(r.data,"object"))throw new Error("Invalid inputs for PADWSAccess.navigate options.data not found");return r.method="POST",r.headers={Accept:"application/json","Content-Type":"application/json"},t.data.label=o.getRequestLabel(),delete r.data.authored,delete r.data.expand_iter,delete r.data.type_filter_bo,delete r.data.type_filter_rel,r.onTimeout=r.onTimeout||r.onFailure,r.data=JSON.stringify(r.data),this.executeRequest(i,r)},executeRequest:function(e,n){return t.authenticatedRequest(e,n)},replaceByExistingRevision:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.replaceByExistingRevision");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/replacebyexisitngrevision";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},getHierarchyOfSelectedNode:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.replaceByNewRevision");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/authoring/model/topDownRevise";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},handlePasteEvent:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.handlePasteEvent");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/richeditor/res/htmlpreview?format=rtf";if(e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var s=t.json;c(i,r,s)}else this.getsecuritycontext({onComplete:function(n){var s=e.is(n,"string")?JSON.parse(n):n;i.headers.SecurityContext=s.SecurityContext;n=t.json;c(i,r,n)}})},setsecuritycontext:function(i){var r=i;if(!e.is(r,"object"))throw new Error("Invalid inputs for RequirementWebServices.setsecuritycontext");r.headers||(r.headers={});var s=n.get3DSpaceUrl()+"/resources/pno/person/setsecuritycontext";r.data=i.json,r.method="POST",r.proxy="passport",r.headers["Content-Type"]="application/x-www-form-urlencoded",t.proxifiedRequest(s,r)},getScopeInformation:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getScopeInformation");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/syc/api/scope/v1/res"+t.scopeId;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getDisplayNamePref:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getDisplayNamePref");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/res/preferences/displayname";i.async=t.async,i.responseType="text",e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getStructureWithStreaming:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getStructureWithStreaming");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/streaming/structure/"+t.id;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getContentWithStreaming:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getContentWithStreaming");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/streaming/content/"+t.id;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getRichContentWithStreaming:function(t){var r=t;if(!e.is(r,"object"))throw new Error("Invalid inputs for RequirementWebServices.getRichContentWithStreaming");i.get();r.headers||(r.headers={});var s=n.get3DSpaceUrl()+"/resources/trm/streaming/richContentAttr/"+t.id;e.is(t.securityContext)?(r.headers.SecurityContext=t.securityContext,l(r,s)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;r.headers.SecurityContext=n.SecurityContext,l(r,s)}})},editRichText:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RichViewWebService.editRichText");i.headers||(i.headers={});var r=t.pid,s=n.get3DSpaceUrl()+"/resources/trm/authoring/model/editContent/"+r;if(console.log("EditRich called from here"),e.is(t.securityContext)){i.headers.SecurityContext=t.securityContext;var o=t.json;u(i,s,o)}else this.getsecuritycontext({onComplete:function(r){var o=e.is(r,"string")?JSON.parse(r):r;o.SecurityContext?i.headers.SecurityContext=o.SecurityContext:i.headers.SecurityContext=n.getSecurityContextForProperties();r=t.json;u(i,s,r)}})},htmlConvert:function(t){var i=e.merge(t||{},{responseType:"text",cache:!1});i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/richeditor/res/HTMLConvert?objectId="+t.id;e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,r)):this.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,r)}})},getOSLCContent:function(t){var n=t;if(!e.is(n,"object"))throw new Error("Invalid inputs for RequirementWebServices.getContentWithStreaming");n.headers||(n.headers={}),function(e,t){s.isLogicalDeleteActive(function(n){try{r.oslcRequest(e.tenant,e.service,t,{method:"GET",onSuccess:e.onComplete,onError:e.onFailure})}catch(e){console.log("OauthRequest not found")}})}(n,t.doors_url)},getTRMExpressionValue:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebServices.getTRMTRCExpressionValue");i.headers||(i.headers={});var r=this,s=function(){var s;if(e.is(t.expression,"string")){t.expression;s=n.get3DSpaceUrl()+"/resources/trm/res/preferences/reqconfig/"+t.expression,e.is(t.securityContext)?(i.headers.SecurityContext=t.securityContext,l(i,s)):r.getsecuritycontext({onComplete:function(t){var n=e.is(t,"string")?JSON.parse(t):t;i.headers.SecurityContext=n.SecurityContext,l(i,s)}})}else console.error("Expression value not specified or not a String. Please specify the expression value to get in {options.expression}.")};try{n.get3DSpaceUrl(),s()}catch(e){console.error(e),n.app_initialization(s)}},getTRCSessionInfo:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebService.getTRCSessionInfo");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/res/TRCSessionInfo";l(i,r)},setTRCSessionId:function(t){var i=t;if(!e.is(i,"object"))throw new Error("Invalid inputs for RequirementWebService.setTRCSessionId");i.headers||(i.headers={});var r=n.get3DSpaceUrl()+"/resources/trm/res/TRCSessionId",s=t.json;c(i,r,s)}}}),define("DS/TraceableRequirementsUtils/Services/RequirementUserPrefrences",["UWA/Core","UWA/Controls/Abstract","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/Logger/Logger"],function(e,t,n,i,r){"use strict";var s=null,o=r.getLogger(l);try{i.getPlatformServices(),a(!1)}catch(e){null,i.app_initialization(function(){a(!1)})}function a(e){return UWA.is(e)||(e=!1),null===s&&(s=sessionStorage.getItem("RMTPreferredDisplayName"),null===(s=UWA.is(s,"string")?JSON.parse(s):s)&&n.getDisplayNamePref({async:!e,onComplete:function(e){e=UWA.is(e,"string")?JSON.parse(e):e,s=e.results,sessionStorage.setItem("RMTPreferredDisplayName",JSON.stringify(s))},onFailure:function(e){o.log(e.message)},onTimeout:function(){o.log("WS timeout")}})),s}var l=t.extend({init:function(){this,this._logger=o},getDisplayNamePref:function(){try{return a(!0)}catch(e){}}});return l}),define("DS/TraceableRequirementsUtils/Command/ActionBar_InsertExistingCmd",["UWA/Core","DS/Logger/Logger","DS/TraceableRequirementsUtils/Command/ReqCmdBase","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","text!DS/TraceableRequirementsUtils/assets/RequirementRelationshipsPatterns.json","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/utils/TRMReportPanel","UWA/Class/Promise","i18n!DS/RequirementStructureBrowser/assets/nls/ENOREQ.json"],function(e,t,n,i,r,s,o,a,l,c,u,d){"use strict";var g=n.extend({name:"REQ_ACTION_BAR",_logger:null,_options:null,init:function(e){this._logger=t.getLogger(g),this._options=e,this._parent(e,{mode:"exclusive",isAsynchronous:!1}),this._relPattern=JSON.parse(s)},beginExecute:function(){this._logger.log(this._id+".beginExecute")},execute:function(){this._logger.log(this._id+".execute");var e=this;e.executingSearch=!0,require(["DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/utils/SearchUtils"],function(t,n){var s,o=function(t){var i={precond:t,callback:e._onSelectionDone.bind(e),cancel_callback:e._endExecute.bind(e)};n.inAppsSearch(i)},a=t.get().getSelectedElement(),l=e._options.arguments.map(function(e){return e.Type});if(UWA.is(a)){var c=a.type,u=a.kindof,d=e._relPattern[u]||e._relPattern[c];if(UWA.is(d)){var g=Object.keys(d);if(l.length>0){s="(";for(var h=0;h<l.length;h++)s+=0===h?'flattenedtaxonomies:"types/'+l[h]+'"':' OR flattenedtaxonomies:"types/'+l[h]+'"';o(s+=")")}else{g.pop("Root"),s="(";for(h=0;h<g.length;h++)s+=0===h?'flattenedtaxonomies:"types/'+g[h]+'"':' OR flattenedtaxonomies:"types/'+g[h]+'"';o(s+=")")}}else r.warningAlert(i.Requirement_Notif_CmdNotAvailable),e._endExecute()}else r.warningAlert(i.Requirement_Notif_MutliSelection),e._endExecute()})},_endExecute:function(e){this._logger.log(this._id+".endExecute"),this.executingSearch=!1,this.end()},_onSelectionDone:function(e){var t=this;if(t.executingSearch){for(var n=o.get(),s=n.getSelectedElement(),g=s.physicalid,h=s.type,p=s.kindof,m=t._relPattern[h]||t._relPattern[p],f={dataArray:[]},v=e.length,S=n._defaultTypes,_=t._options.arguments.map(function(e){return e.Type}),y=0;y<v;y++){var b,C=e[y]["ds6w:type_value"];t._options&&_.indexOf(S[C])>-1&&(b=m[S[C]]),UWA.is(b)&&f.dataArray.push({pid:g,id:e[y].resourceid,relationship:b,previousSibling:{},nextSibling:{}})}var x=f,R={Success:[],Failure:[]},A=t.chunk(x.dataArray,10),D=0;n.beginBlockingTransaction(d.composite);v=A.length;for(var U=0;U<v;U++){var T=new u(function(e,s){var o={dataArray:A[U]};l.insertExisting({securityContext:a.getSecurityContext(),json:o,onComplete:function(i){D++,t._logger.log("WS insertExisting.onComplete");var r=(UWA.is(i,"string")?JSON.parse(i):i).results;r.Success.forEach(function(e){R.Success.push(e)}),r.Failure.forEach(function(e){R.Failure.push(e)}),r.Success.length>0&&n.refreshOnInsert(r.Success,null,"insertExisting"),D===A.length&&e()},onFailure:function(i,s){D++,t._logger.log("WS insertExisting.onFailure"),s=UWA.is(s,"string")?JSON.parse(s):s,r.errorAlert(s.message),n.endBlockingTransaction(),D===A.length&&e()},onTimeout:function(){D++,t._logger.warn("WS insertExisting.onTimeout"),r.errorAlert(i.Requirement_Notif_RequestTimeout),n.endBlockingTransaction(),D===A.length&&e()}})});u.allSettled(T).then(function(){if(f.dataArray.length>1)(R.Failure.length>0||R.Success.length>0)&&new c({title:"InsertExisting",reportData:R});else{if(R.Success.length>0){var e=R.Success[0],t=(UWA.is(e.type,"object")?e.type.displayName:e.type)+" "+e.name+" "+e.revision;s=(s=i.InsertExisting_Success_msg).replace("{TNR}",t),r.sucessAlert(s)}if(R.Failure.length>0){var s;e=R.Failure[0],t=(UWA.is(e.type,"object")?e.type.displayName:e.type)+" "+e.name+" "+e.revision;s=(s=i.InsertExisting_Failure_msg+" "+i.FailureReasons).replace("{TNR}",t),r.errorAlert(s)}}n.endBlockingTransaction()})}t._endExecute()}},chunk:function(e,t){var n,i,r=[],s=t;for(n=0,i=e.length;n<i;n+=s)r.push(e.slice(n,n+s));return r}});return g}),define("DS/TraceableRequirementsUtils/Command/ActionBar_CopyLinkCmd",["DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/PADUtils/PADContext","DS/TraceableRequirementsUtils/utils/RequirementAlertManager","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(e,t,n,i,r,s){"use strict";return e.extend({name:"REQ_ACTION_BAR",init:function(e){this._parent(e,{isAsynchronous:!0}),this._options=e},beginExecute:function(){var e=t.get().getSelectedNodes();this._copyLink(e),this.end()},_copyLink:function(e){if(1==e.length){let n="#app:"+r.getAppId()+"/content:X3DContentId=",s=this._buildData(e[0]);var t=r.getServiceURL("3DDashboard")+n+encodeURIComponent(JSON.stringify(s)),i=r.copyTexttoCLipboard(t)}i?n.sucessAlert(s.replace(s.msg_success_copyLink,{label:e[0].getLabel()})):n.errorAlert(s.msg_error_copyLink)},_buildData:function(e){var t={source:r.getAppId(),widgetId:r.getWidgetId(),data:{items:[]}};if(e&&e.options){var n={envId:r.getPlatformId(),serviceId:"3DSpace",contextId:r.getSecurityContext(),objectId:e.options.resourceid,objectType:e.options.type};t.data.items.push(n)}return t}})}),define("DS/TraceableRequirementsUtils/Command/ActionBar_ReplaceHierarchyByNewVersion",["DS/ApplicationFrame/Command","DS/Logger/Logger","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/Tree/TreeListView","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","DS/ENOFloatingPanel/ENOFloatingPanel","DS/PlatformAPI/PlatformAPI","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/TraceableRequirementsUtils/REQCommandProxy","DS/TraceableRequirementsUtils/Command/ReqCmdBase","DS/PADUtils/PADContext","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(e,t,n,i,r,s,o,a,l,c,u,d,g,h,p,m){"use strict";var f=null,v=h.extend({name:"REQ_ACTION_BAR",_logger:null,init:function(e){return f=this,this._logger=t.getLogger(v),this._parent(e,{isAsynchronous:!0}),this.mediator=e.mediator,this._options=e,this.context=p.get(),this.defaultOptions.renderTo=this.context.structureEditor.container,this._commandProxy=new g,this._initialized=!0,this},_displayMessage:function(e,t,n){UWA.is(e.displayNotification)?e.displayNotification({eventId:n,msg:t}):alert(t)},_decodeHtml:function(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},launchRevisionWindow:function(e){var t=UWA.is(e.context)?e.context:e;f._buildDialog(t)},beginExecute:function(){var e,t=p.get(),n=!1,i=t.getSelectedNodes();if(UWA.is(i)&&1==i.length){var r=[],s=(i[0].getOccurencePath(),i[0].options.grid);this._logger.log(s["ds6w:status"]);var o=this._decodeHtml(s["ds6w:status"]);this._logger.log(o),i[0].isRoot()&&(n=!0),e=t.getReqSpecRoot(i[0]);var a={node:i};if(r.push(a),n)return this._displayMessage(t,m.Requirement_Headers_ReviseRoot,"warning"),void this.end();if(null==e)return this._displayMessage(t,m.Requirement_Headers_ReviseRoot,"warning"),void this.end();if(o!=m.HierarchicalRevise_Frozen&&o!=m.HierarchicalRevise_Released)return this._displayMessage(t,m.Requirement_Revise_Editable,"warning"),void this.end();({objects_to_revise:r}),this.launchRevisionWindow(a)}else UWA.is(i)&&i.length>1?t.displayNotification({eventID:"warning",msg:m.Requirement_Notif_MutliSelection}):t.displayNotification({eventID:"warning",msg:m.Requirement_Notif_ObjectSelection});this.end()},_buildDialog:function(e){f._dialogBody=UWA.createElement("div",{class:"hierarchical_revision_dialog",id:"hierarchical_revision"}),f.buildTreeListView(e).inject(f._dialogBody),f._footer=UWA.createElement("div"),f._cancelButton=new o({value:m.Hierarchical_DiaCancelBtn,name:"cancel_button"}),f._cancelButton.addEvents({onClick:function(e){f._onCancel(e)}}),f._doneButton=new o({value:m.Hierarchical_DiaDoneBtn,name:"done_button",className:"primary"}),f._doneButton.addEvents({onClick:function(e){f._onDone(e)}}),f._doneButton.inject(f._footer),f._cancelButton.inject(f._footer),f._floatingComponent=new l({className:"HierarchicalRevisionModel",title:m.Revise_Cmd_HierarchicalRevise,body:f._dialogBody,footer:f._footer,overlay:!0,closable:!0,resizable:!0,events:{onResizeFloating:function(){f._logger.log("onResizeFloating"),jQuery(".wux-layouts-gridengine-poolcontainer-rel:last").addClass("disabledCheckbox")},onClose:function(){f._logger.log("onClose"),f._onCancel(f._floatingComponent)}}}).inject(f.defaultOptions.renderTo),new a({element:UWA.Element.getElement.call(f._floatingComponent.getBody(),".hierarchical_revision_dialog")}),f._floatingComponent.show()},buildTreeListView:function(e){f._toReviseObjects=[],f._rootToRevise={},f._rootRevised=!1,f.selectedNode=e;var t=e.node[0].getParents(),o=[];o.push(e.node[0]);for(var a=0;a<t.length;a++)o.push(t[a]);var l=new n({}),c=[{text:m.Hierarchical_COL_Name,dataIndex:"tree",width:"auto"},{text:m.Hierarchical_COL_Revision,dataIndex:"ds6wg:revision",width:70},{text:m.Hierarchical_COL_State,dataIndex:"ds6w:status",width:70},{text:m.Hierarchical_COL_Owner,dataIndex:"ds6w:responsible",width:"auto"}],u=new s({treeDocument:l,columns:c,useAsyncPreExpand:!0,enableDragAndDrop:!1,height:"inherit",selection:{unselectAllOnEmptyArea:!1,toggle:!1},resize:{columns:!0},defaultColumnDef:{width:"auto",minWidth:40}});new r;l.useAsyncPreExpand=!0,l.prepareUpdate();var d=null;for(a=o.length-1;a>=0;a--){var g=o[a].options.grid,h=f._decodeHtml(g["ds6w:status"]);g.objectId=o[a]._options.resourceid,g.relId=o[a]._options.relationid,g.parentId=o[a]._parentNode._options.resourceid;var p=new i({label:g.displayName,grid:g});if(null==d){if(d=p,l.addChild(d),h==m.HierarchicalRevise_Frozen||h==m.HierarchicalRevise_Released){p.select();var v=o[a]._options.resourceid;f._rootToRevise={object_id:v},f._rootRevised=!0}}else if(null==d.getChildren()?d.addChild(p):d.getAllDescendants()[d.getAllDescendants().length-1].addChild(p),h==m.HierarchicalRevise_Frozen||h==m.HierarchicalRevise_Released){p.select();var S={object_id:v=o[a]._options.resourceid,rel_id:o[a]._options.relationid,parent_id:o[a]._parentNode._options.resourceid};f._toReviseObjects.push(S)}else{f._toReviseObjects=[],f._rootToRevise={},f._rootRevised=!1;for(var _=p.getParents(),y=0;y<_.length;y++)_[y].unselect()}}return l.expandAll(),l.pushUpdate(),u},_onCancel:function(){f._onLoadingUI=!1,f._logger.log("onCancel"),f._floatingComponent.hide(),f._floatingComponent.destroy()},_onDone:function(){var e;f._onLoadingUI=!1,f._logger.log("onDelete");var t=f.selectedNode.node[0].getParents(),n=f._toReviseObjects,i=f._rootToRevise,r=p.get();e={root_to_revise:i,objects_to_revise:n,revise_mode:"replaceByNewRevision"},u.getHierarchyOfSelectedNode({securityContext:d.getSecurityContext(),json:e,onComplete:function(e){f._logger.log("WS Revise.onComplete");var n=UWA.is(e,"string")?JSON.parse(e):e;if("success"===n.status)if(f._rootRevised){var i;i=(s=n.rootObject).root_object.physicalid,u.getInfo({securityContext:d.getSecurityContext(),pid:i,selectables:"type,name,revision,attribute[Title],type.kindof,current,physicalid,id",onComplete:function(e){var n=(UWA.is(e,"string")?JSON.parse(e):e).results[0];n.indexCreation=!1,r.refreshOnCreate(n,!1,t[t.length-1]),f._displayMessage(r,m[f._options.arguments[0].Type+".Requirement_Headers_Revise"],"success")},onFailure:function(e,t){console.warn("WS getInfo.onFailure");var n=e.message;t=UWA.is(t,"string")?JSON.parse(t):t,UWA.is(t.message)&&(n=UWA.is(m[t.message])?m[t.message]:t.message),f._displayMessage(r,n,"error")},onTimeout:function(e){console.warn("WS getInfo.onFailure"),f._displayMessage(r,m.Requirement_Notif_RequestTimeout,"error")}})}else{var s=n.results;r.refreshOnRevise(s),f._displayMessage(r,m[f._options.arguments[0].Type+".Requirement_Headers_Revise"],"success")}},onFailure:function(e,t){var n=e.message;t=UWA.is(response,"string")?JSON.parse(t):t,UWA.is(t.message)&&(n=UWA.is(m[t.message])?m[t.message]:t.message),f._displayMessage(r,n,"error"),f._logger.warn(e+""+t)},onTimeout:function(){f._logger.warn("WS detach.onTimeout")}}),f._onCancel()}});return v}),define("DS/TraceableRequirementsUtils/Services/RequirementSecurityCtxMgt",["UWA/Class","UWA/Class/Events","DS/Logger/Logger","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils","UWA/Promise"],function(e,t,n,i,r,s,o,a){"use strict";var l=e.singleton(t,{name:"RequirementSecurityCtxMgt",options:{},_preferences_added:!1,_logger:null,init:function(){this._logger=n.getLogger(l);var e=this;new a(function(t,n){!1===widget.hasEvent("onUpdateTenant")&&widget.addEvent("onUpdateTenant",function(n,i){UWA.is(i.value)&&(i=i.value),e._logger.log("onUpdateTenant "+n+" "+i),widget.setValue("req_tenant",i),e._fillPreferences({tenant:i,update:!0}).then(function(){t([])})})})},buildSecurityContext:function(e,t,n){return"ctx::"+n+"."+t+"."+e},buildDisplayString:function(e,t,n,i){return i?e+"  "+n:e+"  "+t+"  "+n},addSecurityCtx2Preferences:function(e,t){var n=this;return n._logger.log("addSecurityCtx2Preferences"),new a(function(t,i){if(void 0===widget)throw new Error("widget variable isn't defined");void 0!==e&&void 0!==e.events&&n.addEvents(e.events),!1===n._preferences_added&&(n._logger.log("add the preferences"),widget.mergePreferences([{name:"trm_security_ctx",type:"list",label:o.trm_SecurityCtx,defaultValue:""}]),n._logger.log("Fill there values"),n._fillPreferences({tenant:void 0,update:!1}).then(function(){t([])}),n._preferences_added=!0)})},updatePreferences:function(){this._logger.log("updatePreferences"),this.dispatchEvent("onUpdateSecurityContext",widget.getValue("trm_security_ctx"))},_fillPreferences:function(e){this._logger.log("_fillPreferences");var t=this;if(void 0===widget)throw new Error("widget variable isn't defined");return new a(function(n,s){UWA.is(e.tenant)||(e.tenant=r.getTenant()),new a(function(n,r){i.getsecuritycontext({tenant:e.tenant,onComplete:function(e){var i=UWA.is(e,"string")?JSON.parse(e):e,r=t.prepareForStorage(i);n({securityContext:r.securityContext,securityContextList:r.cspaces})},onFailure:function(e){console.log("selected tenant: "+this.tenant),console.log("called url: "+this.url),console.log("generated error: ",e)}})}).then(function(i){t._update_trm_security_ctx_pref(i.securityContext,i.securityContextList,e.update),n([])}).catch(function(e){t._update_trm_security_ctx_pref(null),n([])})})},prepareForStorage:function(e){var t,n,i,r="ctx:",s=e.pid,o=[];for(var a in e.preferredcredentials){var l=e.preferredcredentials[a];switch(a){case"collabspace":t=l.name,l.title?l.title:t;break;case"organization":n=l.name;break;case"role":i=l.name}}r=this.buildSecurityContext(t,n,i);for(var c=!1,u=function(e,t){for(var n=[],i=0;i<e.collabspaces.length;i++)for(var r=e.collabspaces[i],s=0;s<r.couples.length;s++){var o=t.extractCouple(r.couples[s]);-1===n.indexOf(o.org)&&n.push(o.org)}return 1===n.length}(e,this),d=0;d<e.collabspaces.length;d++)for(var g=e.collabspaces[d],h=0;h<g.couples.length;h++){var p=this.extractCouple(g.couples[h]),m=this.buildSecurityContext(g.name,p.org,p.role),f=g.title?g.title:g.name,v={csName:f,label:this.buildDisplayString(f,p.orgTitle,p.roleNls,u),value:m};r===m&&(v.isDefault=!0,c=!0),o.push(v)}if(!c&&o.length){var S=o[0];S.isDefault=!0,r=S.value}return{userId:s,securityContext:r,cspaces:o}},extractCouple:function(e){var t="",n="",i="",r="";for(var s in e){var o=e[s];switch(s){case"organization":t=o.name,n=o.title;break;case"role":i=o.name,r=o.nls?o.nls:i}}return{org:t,orgTitle:n,role:i,roleNls:r}},_update_trm_security_ctx_pref:function(e,t,n){if(""!==e&&t.length>0){if(UWA.is(widget.getValue("trm_security_ctx"))&&""!==widget.getValue("trm_security_ctx")){var i=widget.getValue("trm_security_ctx");t.forEach(function(t){t.value===i&&(e=i)})}e||(e=t[0].value);var s=-1===e.indexOf("ctx::")?"ctx::"+e:e;widget.addPreference({name:"trm_security_ctx",type:"list",label:o.trm_SecurityCtx,defaultValue:s,options:t}),r.setXPrefCredentials(widget,s),widget.setValue("trm_security_ctx",s),this.dispatchEvent("onUpdateSecurityContext",s),!0===n&&widget.dispatchEvent("onEdit")}}});return l}),define("DS/TraceableRequirementsUtils/Services/RequirementTypeMgt",["UWA/Class","UWA/Class/Events","DS/Logger/Logger","DS/TraceableRequirementsUtils/Services/RequirementWebServices","DS/TraceableRequirementsUtils/Utils","DS/PADUtils/PADContext","i18n!DS/TraceableRequirementsUtils/assets/nls/TraceableRequirementsUtils"],function(e,t,n,i,r,s,o){"use strict";var a=e.singleton(t,{name:"RequirementTypeMgt",options:{},_preferences_added:!1,_token_sent:!1,_logger:null,_context:null,init:function(){this._logger=n.getLogger(a)},addTypes2Preferences:function(e){if(this._logger.log("addTypes2Preferences"),void 0===widget)throw new Error("widget variable isn't defined");if(void 0!==e&&void 0!==e.events&&this.addEvents(e.events),!1===this._preferences_added){this._logger.log("add the preferences");var t=this;e.types.forEach(function(e){e.replace(" ","_");i.getCustomTypes({securityContext:r.getSecurityContext(),type:e,onComplete:function(n){var i=UWA.is(n,"string")?JSON.parse(n):n,r=[];if(i.results.length>1&&(i.results.forEach(function(e){"FALSE"===e.abstract&&"Requirement Proxy"!=e.value&&r.push({label:e.label,value:e.value})}),t.addType2Pref(e,r)),!1===t._token_sent){var o=s.get();UWA.is(o)&&UWA.is(o.saveCSRF)&&(o.saveCSRF(i.csrf),t._token_sent=!0)}}})}),this._preferences_added=!0}},addType2Pref:function(e,t){if(this._logger.log("Add management of "+e+"to the preferences"),void 0===widget)throw new Error("widget variable isn't defined");var n=e.replace(" ","_");widget.mergePreferences([{name:"trm_types_"+n,type:"list",label:o["trm_Types_"+n],defaultValue:""}]),this._update_trm_req_types_pref(e,t)},_update_trm_req_types_pref:function(e,t){if(t.length>0){var n=e.replace(" ","_");widget.addPreference({name:"trm_types_"+n,type:"list",label:o["trm_Types_"+n],defaultValue:t[0].value,options:t});var i=null;i=void 0===widget.getValue("trm_types_"+n)||""===widget.getValue("trm_types_"+n)?widget.setValue("trm_types_"+n,t[0].value):widget.getValue("trm_types_"+n),this.dispatchEvent("onUpdateTypePreferences",{type:n,value:i})}}});return a});