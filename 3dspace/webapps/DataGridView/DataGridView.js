define("DS/DataGridView/DataGridViewFilterPopup",["UWA/Core","DS/Core/BaseComponent","DS/Utilities/Dom","DS/Core/PointerEvents","DS/Controls/Popup","DS/Controls/Accordeon","DS/Controls/Button","DS/TreeModel/ConditionAndSetBaseFilter","DS/Controls/TooltipModel","DS/Utilities/KeyboardUtils","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o,l,r,s,a,d,u){"use strict";var h=function(e){const t=void 0!==e?e:this.filter.filterModel;return this._isModelServerSide()||this.filter&&"set"!==this.filterId&&!Array.isArray(t)?"ByConditions":"ByValues"},c=function(){if(this.filter instanceof s&&!this._isModelServerSide()){this._accordion=new l({exclusive:!0,collapsibleFlag:!1,style:"divided",items:[{header:u.get("FilterView").FilterByValues,content:null},{header:u.get("FilterView").FilterByConditions,content:null}]});var e=this;i.addEventOnElement(this,this._accordion,"expand",function(t){t&&t.options&&0==t.options.expanderIndex?e.filterMode="ByValues":e.filterMode="ByConditions";var i=e.getActiveFilterView();i&&i.focusContentView()})}else this._accordion=null;return this.filterMode=h.call(this),this._accordion},g=function(){var t=new e.Element("div",{class:"wux-datagridview-filter-footer"}),o=this;this._resetLabel=e.createElement("span",{class:"wux-datagridview-filter-reset"}),this._resetLabel.textContent=u.get("FilterView").Reset,this._resetLabel.inject(t),i.addEventOnElement(this,this._resetLabel,n.POINTERHIT,function(e){if(o.filter){var t=o.getActiveFilterView();if(t){var i=t.buildFilterModelFromView();if(!o.filter.filterModelsAreEqual(o.filter.defaultFilterModel,i)){var n=h.call(o,o.filter.defaultFilterModel);o.filterMode!==n&&(o.filterMode=n,t=o.getActiveFilterView()),t&&t.refreshContentView(void 0!==o.filter.defaultFilterModel?o.filter.defaultFilterModel:null)}}}}),this._OKButton=new r({label:u.get("FilterView").OK,emphasize:"primary",onClick:function(e){o.validateView(),o.elements._popup&&(o.elements._popup.visibleFlag=!1)}}),this._OKButton.getContent().addClassName("wux-datagridview-filter-ok"),this._OKButton.inject(t);var l=new r({label:u.get("FilterView").Cancel,onClick:function(e){o.elements._popup&&(o.elements._popup.visibleFlag=!1)}});return l.getContent().addClassName("wux-datagridview-filter-cancel"),l.inject(t),i.addEventOnElement(this,this.elements._popup,"keydown",function(e){d.ENTER===e.keyCode&&o._OKButton&&!o._OKButton.disabled&&o._OKButton.onClick()}),t};return t.inherit({name:"DataGridViewFilterPopup",publishedProperties:{filterViewManager:{defaultValue:void 0,type:"object",readOnly:!0},filterId:{defaultValue:"",type:"string",readOnly:!0},propertyId:{defaultValue:"",type:"string",readOnly:!0},validFlag:{defaultValue:!0,type:"boolean"},filter:{defaultValue:null,type:"object",readOnly:!0},filterMode:{defaultValue:"ByValues",type:"string"}},destroy:function(){this._parent()},showPopup:function(){if(this.elements._popup||function(){if(!this.elements._popup){var t=this;this.elements._popup=new o({target:this.getContent(),position:"bottom",offset:{x:0,y:4},alignment:"near",className:"wux-controls-popup wux-datagridview-filter-popup",constraint:"screen",overlap:!1,trigger:"click",beforeDisplayCallback:function(){t._refreshIconView()}});var i=new e.Element("div"),n=c.call(this);n&&n.inject(i,"top"),this._footerDiv=g.call(this),this._footerDiv.inject(i,"bottom"),this.elements._popup.setBody(i),t=this,this.elements._popup.addEventListener("show",function(e){if("popup"===e.dsModel.name){t._displayModalContainer(),t.refreshView();var i=t.getActiveFilterView();i&&i.focusContentView()}}),this.elements._popup.addEventListener("hide",function(e){"popup"===e.dsModel.name&&(t._refreshIconView(),t._removeModalContainer())})}}.call(this),this.elements._popup){this._applyFilterMode();var t=this.getActiveFilterView();t&&(this.elements._popup.visibleFlag=!0,this._displayModalContainer(),t.focusContentView())}},refreshView:function(){var e=this.getActiveFilterView();e&&e.refreshContentView(),this._refreshIconView()},validateView:function(){this.validFlag&&this._updateFilterModelFromView()},clearView:function(){this.validFlag=!0;var e=this.getActiveFilterView();e&&(e.clearFilterViewContent(),this._updateFilterModelFromView())},_build:function(){this._parent(),this.elements.container=new e.Element("div"),this.elements.container.dsModel=this,this._filterViewByValues=null,this._filterViewByConditions=null,this._OKButton=null,this.handleEvents()},_postBuild:function(){this._refreshIconView()},handleEvents:function(){var e=this,t=function(o){e.showPopup(),i.removeEventOnElement(e,e.elements.container,n.POINTERHIT,t),o.stopPropagation()};i.addEventOnElement(this,this.elements.container,n.POINTERHIT,t)},getActiveFilterId:function(){return"ByConditions"===this.filterMode&&this.filter?this.filter.getFilterByConditionId():"set"},getActiveFilterView:function(){return"ByValues"===this.filterMode?this._filterViewByValues:this._filterViewByConditions},_getOrCreateActiveFilterView:function(){var e=this.getActiveFilterView();if(!e&&this.filterViewManager&&this.elements._popup){var t=this.getActiveFilterId(),n=this.filterViewManager.getFilterViewClassName(t);if(n){var o=this.filter;(e=new n({filterViewManager:this.filterViewManager,propertyId:this.propertyId,filterId:t,filter:o})).elements._popup=this.elements._popup,e.buildContentView();var l=this;i.addEventOnElement(this,e,"validFlagChange",function(){l._updateValidFlag()}),i.addEventOnElement(this,e,"change",function(){l._updateResetState()}),"set"===t?this._filterViewByValues=e:this._filterViewByConditions=e}else console.log("Cannot create the filter view for Id: "+t)}return e},_updateFilterModelFromView:function(){var e=this.getActiveFilterView();if(e&&this.filterViewManager){var t=this.filterViewManager.filterManager;if(t){var i,n=e.buildFilterModelFromView();this.filterViewManager.disableUpdateView();var o=t.getFilters();if(o){var l=o[this.propertyId];l&&(i=l.filterOptions)}t.setPropertyFilterModel(this.propertyId,{filterId:this.filterId,filterModel:n,filterOptions:i},{isUserInteraction:!0}),(o=t.getFilters())&&o[this.propertyId]&&e.filter!==o[this.propertyId]&&(e.filter&&e.filter.destroy(),e.filter=o[this.propertyId]),this.filterViewManager.enableUpdateView(),this._refreshIconView()}}},_updateValidFlag:function(){var e=this.getActiveFilterView();e&&(this.validFlag=e.validFlag)},_updateResetState:function(){if(this.filter&&this._resetLabel){var e=this.getActiveFilterView();if(e){var t=e.buildFilterModelFromView();this.filter.filterModelsAreEqual(this.filter.defaultFilterModel,t)?this._resetLabel.setAttributeNode(document.createAttribute("disabled")):this._resetLabel.removeAttribute("disabled")}}},_refreshIconView:function(){var e;this.elements.container&&this.filter&&(this.filter.isEmpty()?this.elements._popup&&this.elements._popup.visibleFlag?(this.elements.container.className="wux-datagridview-filter wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-search-filter",e=u.get("FilterView").FilterValues):this.elements.container.className="":(this.elements.container.className="wux-datagridview-filter wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-filter",e=u.get("FilterView").ModifyFilter),this.tooltipInfos=new a({shortHelp:e}))},_applyValidFlag:function(e){this._OKButton&&(this._OKButton.disabled=!this.validFlag)},_applyFilterMode:function(e){var t=this._getOrCreateActiveFilterView();if(t)if(t.refreshContentView(),this._accordion){var i="ByValues"===this.filterMode?0:1,n=t.getPopupContentDiv();n&&this._accordion.updateItem(i,{body:n}),this._accordion.expandItem(i)}else if(this.elements._popup&&this._footerDiv){var o=t===this._filterViewByValues?this._filterViewByConditions:this._filterViewByValues;if(o){var l=o.getPopupContentDiv();l&&l.remove()}var r=t.getPopupContentDiv();r&&r.inject(this._footerDiv,"before")}this._updateValidFlag(),this._updateResetState()},_applyProperties:function(e){this._parent()},_displayModalContainer:function(){if(this.filterViewManager){var e=this.filterViewManager.view;e&&e.displayModalContainer(null,{transparentFlag:!0})}},_removeModalContainer:function(){if(this.filterViewManager){var e=this.filterViewManager.view;e&&e.removeModalContainer()}},_isModelServerSide:function(){var e=!1;return this.filterViewManager&&this.filterViewManager.view&&this.filterViewManager.view._rowModel&&(e=this.filterViewManager.view._rowModel._isServerSide()),e}})}),define("DS/DataGridView/DataGridViewCustomViewsDialog",["UWA/Core","DS/Utilities/Dom","DS/Windows/Dialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Button","DS/Tweakers/TweakerBoolean","DS/Controls/TooltipModel","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/SelectionChips","DS/Core/PointerEvents","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","text!DS/Tweakers/assets/defaultTypeRepresentations.json","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o,l,r,s,a,d,u,h,c,g,m,p){"use strict";const f=[{identifier:p.get("DefaultView")}];var C=JSON.parse(m);function _(t){_.prototype._setSortModel=function(e){var t=this._customViewsDialog._customViewsSortModels&&this._customViewsDialog._customViewsSortModels[this._customViewsDialog._comboBox.selectedIndex];this._sortModel=[].concat(e||t||this._dataGridView._rowModel._originalSortModel||[]);const i=this._dataGridView.sortOptions?this._dataGridView.sortOptions.maxSortedColumnsCount:void 0;"number"==typeof i&&this._sortModel.length>i&&(this._sortModel.length=i)},_.prototype.reset=function(){for(;this._table.rows.length;)this._table.deleteRow(-1);this._selectedDataIndexMap.clear()},_.prototype.getComboBoxAtLine=function(e){return e<this._table.rows.length?this._table.rows[e].cells[0].firstElementChild.dsModel:void 0},_.prototype.getTweakerBooleanAtLine=function(e){return e<this._table.rows.length&&this._table.rows[e].cells.length>1?this._table.rows[e].cells[1].firstElementChild.dsModel:void 0},_.prototype.addLine=function(e){const t=this._dataGridView.sortOptions?this._dataGridView.sortOptions.maxSortedColumnsCount:void 0;if(!("number"==typeof t&&this._table.rows.length>=t)){var i=this._table.insertRow(),n=0,o=void 0,l=!0;void 0!==e&&(o=e.dataIndex,l=Boolean("asc"===e.sort));for(var s=new Map,d=["-- "+p.get("DataGridViewCustomViewsDialog").SortByComboxBoxFirstLine+" --"],u=this._dataGridView.layout.getLeafColumns(),h=0;h<u.length;h++){var c=u[h];if(this._dataGridView.layout.getColumnSortableFlag(c.dataIndex)){s.set(h+1,c.dataIndex),c.dataIndex===o&&(n=h+1);var g=void 0!==c.text&&""!==c.text?c.text:c.dataIndex;d.push(g)}}var m=new a({enableSearchFlag:!1,elementsList:d,selectedIndex:n});m.getContent().classList.add("wux-datagridview-custom-views-combo"),m._previouslySelectedIndex=-1,m.getSelectedDataIndex=function(){return s.get(this.selectedIndex)};var f=this;m.inject(i.insertCell()),n>0?_(l):(m._previouslySelectedIndex=n,this._customViewsDialog._updateButtonsState()),m.addEventListener("change",function(){_(),f._customViewsDialog._customViewsSortModels[f._customViewsDialog._comboBox.selectedIndex]=f.getSortModel(),f._customViewsDialog._updateButtonsState()})}function _(e){if(m.selectedIndex!==m._previouslySelectedIndex)if(f._selectedDataIndexMap.get(s.get(m.selectedIndex)))m.selectedIndex=m._previouslySelectedIndex;else{if(m._previouslySelectedIndex>0&&f._selectedDataIndexMap.set(s.get(m._previouslySelectedIndex),!1),i.cells.length>1&&i.deleteCell(1),0===m.selectedIndex){const e=f._dataGridView.sortOptions?f._dataGridView.sortOptions.maxSortedColumnsCount:void 0;if("number"==typeof e){if(e){let t=f.getComboBoxAtLine(f._table.rows.length-1);m!==t&&f._table.deleteRow(i.rowIndex),0!==t.selectedIndex&&f._table.rows.length===e-1&&f.addLine()}}else f._table.deleteRow(i.rowIndex)}else if(m.selectedIndex>0){var t="sorting-asc",n="sorting-desc",o=f._dataGridView.getColumnOrGroup(m.selectedIndex-1).typeRepresentation;C[o]&&C[o].semantics&&C[o].semantics.numeric?(t="num-sorting-1-2",n="num-sorting-2-1"):"string"===o&&(t="alpha-sorting-a-z",n="alpha-sorting-z-a");var l=new r({value:void 0===e||e,displayStyle:"toggleIcon",possibleValues:[{value:"true",icon:{iconName:t,fontIconFamily:0}},{value:"false",icon:{iconName:n,fontIconFamily:0}},{value:"undefined",icon:""}]});l.addEventListener("change",function(){f._selectedDataIndexMap.set(s.get(m.selectedIndex),l.value?"asc":"desc"),f._customViewsDialog._customViewsSortModels[f._customViewsDialog._comboBox.selectedIndex]=f.getSortModel(),f._customViewsDialog._updateButtonsState()}),l.inject(i.insertCell()),f._selectedDataIndexMap.set(s.get(m.selectedIndex),l.value?"asc":"desc"),0===m._previouslySelectedIndex&&f.addLine()}m._previouslySelectedIndex=m.selectedIndex,f._customViewsDialog._updateButtonsState()}}},_.prototype.loadSortModel=function(e){this.reset(),this._setSortModel(e);for(var t=0;t<this._sortModel.length;t++)this.addLine(this._sortModel[t]);this.addLine();let i=this._customViewsDialog._comboBox.selectedIndex;i<0&&(i=0),this._customViewsDialog._customViewsSortModels[this._customViewsDialog._comboBox.selectedIndex]=e},_.prototype.getSortModel=function(){let e=[];for(let t=0;t<this._table.rows.length;++t){let i=this.getComboBoxAtLine(t).getSelectedDataIndex();i&&e.push({dataIndex:i,sort:this._selectedDataIndexMap.get(i)})}return e},_.prototype.inject=function(e){this._container.inject(e)},_.prototype.setUpdateFromCurrentView=function(e){this._statusVisualFeedback.style.backgroundColor=e?"#E87B00":"transparent"},this._customViewsDialog=t,this._dataGridView=t.dataGridView,this._container=e.createElement("div",{class:"wux-datagridview-custom-views-part"}),this._container.style.display="flex",this._statusVisualFeedback=e.createElement("div",{class:"wux-datagridview-custom-sortmodel-status-feedback"}),this._statusVisualFeedback.inject(this._container);var i=e.createElement("div",{class:"wux-datagridview-custom-sortmodel-label"});i.innerHTML=p.get("DataGridViewCustomViewsDialog").SortByTitle,i.inject(this._container),this._table=e.createElement("table"),this._table.inject(this._container),this._selectedDataIndexMap=new Map,this._setSortModel()}return i.inherit({name:"DataGridViewCustomViewsDialog",publishedProperties:{dataGridView:{defaultValue:null,type:"object"},title:{defaultValue:p.get("DataGridViewCustomViewsDialog").Title,type:"string",category:"Appearance"},modalFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},autoCloseFlag:{defaultValue:!1,type:"boolean",category:"Behavior"},resizableFlag:{defaultValue:!0,type:"boolean",category:"Behavior"},activateButtonsIfActionPerformed:{defaultValue:!1,type:"boolean",category:"Behavior"},width:{defaultValue:600,type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},height:{defaultValue:530,type:"integer",category:"Appearance",advancedSetter:!0,recordFlag:!0},minWidth:{defaultValue:330,defaultTouchValue:330,advancedSetter:!0,type:"integer",category:"Appearance"}},_preBuild:function(){this._parent(),this._comboBox=null,this._densityComboBox=null,this._renameViewEditor=null,this._editedCustomViews=[],this._selectedCustomView=null,this._treeDocuments=[],this._layoutDensities=[],this._customViewsGroupingOptions=[],this._customViewsSortModels=[],this._updateFromCurrentViewButton=null,this._sortModelView=null},_postBuildView:function(){this._parent();var n=this,o=e.createElement("div",{class:"wux-datagridview-custom-views-maindiv"}),r=e.createElement("div",{});e.createElement("div",{class:"wux-datagridview-custom-views-selected-view",html:p.get("DataGridViewCustomViewsDialog").SelectedView}).inject(r),this._comboBox=new a({enableSearchFlag:!1}),this._comboBox.getContent().classList.add("wux-datagridview-custom-views-combo"),this._comboBox.inject(r),this._updateComboFromCustomViews(),this._renameViewEditor=new d({requiredFlag:!0,placeholder:p.get("DataGridViewCustomViewsDialog").RenameViewEditor.placeHolder,selectAllOnFocus:!0}),this._renameViewEditor.getContent().classList.add("wux-datagridview-custom-views-editor"),this._renameViewEditor.visibleFlag=!1,this._renameViewEditor.inject(r);var c=new l({icon:{iconName:"pencil",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon"});c.getContent().classList.add("wux-datagridview-custom-views-button"),c.tooltipInfos=new s({shortHelp:p.get("DataGridViewCustomViewsDialog").RenameView.ShortHelp,longHelp:p.get("DataGridViewCustomViewsDialog").RenameView.LongHelp}),c.inject(r),c.addEventListener("buttonclick",function(e){n.renameCurrentCustomView()}),this._renameViewEditor.addEventListener("change",function(e){var t=n._renameViewEditor.value;n._selectedCustomView&&""!==t&&n._selectedCustomView.identifier!=t&&(n.getEditedCustomView(t)?n._displayNotificationMessage(p.get("DataGridViewCustomViewsDialog").ViewAlreadyExists+"'"+t+"'"):n._selectedCustomView.identifier=t,n._updateComboFromCustomViews()),n._renameViewEditor.visibleFlag=!1,n._comboBox.visibleFlag=!0}),this._renameViewEditor.addEventListener("blur",function(e){n._renameViewEditor.visibleFlag=!1,n._comboBox.visibleFlag=!0});var g=new l({icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon"});g.getContent().classList.add("wux-datagridview-custom-views-button"),g.tooltipInfos=new s({shortHelp:p.get("DataGridViewCustomViewsDialog").DeleteView.ShortHelp,longHelp:p.get("DataGridViewCustomViewsDialog").DeleteView.LongHelp}),g.inject(r),g.addEventListener("buttonclick",function(e){if(n._selectedCustomView)var t=new i({immersiveFrame:n.dataGridView.getContainingImmersiveFrame(),modalFlag:!0,title:p.get("DataGridViewCustomViewsDialog").DeleteView.ShortHelp,content:p.get("DataGridViewCustomViewsDialog").DeleteView.ConfirmationQuestion+" '"+n._selectedCustomView.identifier+"'?",buttons:{Yes:new l({onClick:function(e){n.deleteCustomView(n._comboBox.selectedIndex),t.close()}}),No:new l({onClick:function(e){t.close()}})}})});var m=new l({icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},displayStyle:"icon"});m.getContent().classList.add("wux-datagridview-custom-views-button"),m.tooltipInfos=new s({shortHelp:p.get("DataGridViewCustomViewsDialog").CreateView.ShortHelp,longHelp:p.get("DataGridViewCustomViewsDialog").CreateView.LongHelp}),m.inject(r),m.addEventListener("buttonclick",function(e){n.createNewCustomView(),n.renameCurrentCustomView()});var f=this.dataGridView.getCustomViewsManager().getCurrentCustomViewIndex();c.disabled=0===f,g.disabled=0===f,r.inject(o),n._comboBox.addEventListener("change",function(){n._comboBox.value;c.disabled=0===n._comboBox.selectedIndex,g.disabled=0===n._comboBox.selectedIndex,n.loadCustomView(n._comboBox.selectedIndex,!1),n._updateButtonsState()}),e.createElement("div",{html:p.get("DataGridViewCustomViewsDialog").Description,class:"wux-datagridview-custom-views-part"}).inject(o);var C=e.createElement("div",{class:"wux-datagridview-custom-views-part wux-datagridview-custom-views-datagridview"}),w=require("DS/DataGridView/DataGridView");this._attributesDataGridView=new w({identifier:this.dataGridView.identifier+"_CustomViews",cellDragEnabledFlag:!0,rowDragEnabledFlag:!0,rowReorderEnabledFlag:!0,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!1,showOutlineFlag:!0,rowSelection:"none",cellSelection:"none",showModelChangesFlag:!0,columns:[{text:p.get("DataGridViewCustomViewsDialog").ColumnsName,dataIndex:"tree",editableFlag:!1,resizableFlag:!0,selectableFlag:!1,width:"auto",getCellClassName:function(e){if(e.nodeModel&&e.nodeModel.hasChildren())return"wux-datagridview-custom-views-column-group"}},{text:p.get("DataGridViewCustomViewsDialog").ColumnsVisibleFlag,dataIndex:"visibleFlag",typeRepresentation:"boolean",editionPolicy:"EditionInPlace",width:80,getCellEditableState:function(e){return n._getNodeModelVisibleFlagEditableState(e.nodeModel)},getCellValue:function(e){return n._getNodeModelVisibleFlag(e.nodeModel)}},{text:p.get("DataGridViewCustomViewsDialog").ColumnsWidth,dataIndex:"width",typeRepresentation:"integer",width:80,editionPolicy:"EditionOnDoubleClick",allowResetToUndefinedByUIFlag:!0,getCellEditableState:function(e){var t=!1;if(!e.nodeModel.hasChildren()){var i=e.nodeModel.getAttributeValue("dataIndex");t=!!n.dataGridView.layout.getColumnResizableFlag(i)}return t}},{text:p.get("DataGridViewCustomViewsDialog").ColumnsPinnedState,dataIndex:"pinned",typeRepresentation:"pinnedEnum",width:"auto",editionPolicy:"EditionOnOver",getCellValue:function(e){return n._getNodeModelPinned(e.nodeModel)}}],defaultColumnDef:{minWidth:30,editableFlag:!0,resizableFlag:!1,editionPolicy:"EditionOnOver",sortableFlag:!1,getCellKPIColor:function(e){var t=void 0;if(e.nodeModel&&!e.nodeModel.hasChildren()){n.dataGridView.layout;var i=e.nodeModel.getAttributeValue("dataIndex");if(1===e.columnID&&e.nodeModel.getAttributeValue("visibleFlag")!==n.dataGridView.layout.getColumnVisibleFlag(i))t="#e87b00";else if(2===e.columnID){var o=e.nodeModel.getAttributeValue("width"),l=n.dataGridView.layout.getColumnWidth(i);o==l||void 0===o&&"auto"===l||(t="#e87b00")}else 3===e.columnID&&e.nodeModel.getAttributeValue("pinned")!==n.dataGridView.layout.getColumnPinned(i)&&(t="#e87b00")}return t}}}),this._attributesDataGridView.buildDefaultContextualMenu=function(e,t){return n._attributesDataGridView._contextualMenuBuilder.buildMenu(e,{filter:!0,pin:!1,firstColumnsVisibility:!1,columnsManagement:!1,sizeColumnToFit:!1,insertRow:!1})};var v=function(e,t){if(t.droppedNodes&&t.droppedNodes.length>0){var i=t.droppedNodes[0],o=t.nodeModel,l="top"===t.dropPosition?"before":"after";if(i&&o){var r=i.getTreeDocument();r&&r.options.shouldAcceptDrop({dropPosition:t.dropPosition,draggedTreeNodeModel:i,dropNode:o})&&(r.prepareUpdate(),r.setUseChangeTransactionMode(!1),n._extractNodeModel(i),n._insertNodeModelNextTo(r,i,o,l),n._mergeChildren(r._getTrueRoot()),r.setUseChangeTransactionMode(!0),r.pushUpdate(),n._attributesDataGridView.flashEffectOnNodeModel("ui-modified",i),i.processDescendants({onlyVisibleNodes:!0,processNode:function(e){n._attributesDataGridView.flashEffectOnNodeModel("ui-modified",e.nodeModel)}}),e.preventDefault())}}};this._attributesDataGridView.onDropCell=function(e,t){return v(e,t)},this._attributesDataGridView.onDropRowHeader=function(e,t){return v(e,t)},t.addEventOnElement(this,this._attributesDataGridView,h.POINTERHIT,function(e,t){2===e.multipleHitCount&&t&&t.nodeModel&&t.nodeModel.hasChildren()&&(t.nodeModel.isExpanded()?t.nodeModel.collapse():t.nodeModel.expand())});var D={"":"unpinned"};if(D[p.get("DataGridViewCustomViewsDialog").LeftPinned]="left",D[p.get("DataGridViewCustomViewsDialog").RightPinned]="right",this._attributesDataGridView.getTypeRepresentationFactory().registerEnum("pinnedEnum",D),this._attributesDataGridView.inject(C),C.inject(o),this.dataGridView.rowGroupingEnabledFlag){var I=e.createElement("div",{class:"wux-datagridview-custom-views-part"}),V=function(e,t){var i=n.dataGridView.getDraggedRowData(e);if(i){var o={label:i.label,value:i.grid.dataIndex,index:void 0},l=t.chipCellView?t.chipCellView.associatedModelItem:void 0;if(l){var r=t.dropPosition;"left"===r?o.index=n._groupingSelectionChips.getChipPosition(l.chipOptions.label):"right"===r&&(o.index=n._groupingSelectionChips.getChipPosition(l.chipOptions.label)+1)}n._groupingSelectionChips.addChip(o)}return e.preventDefault(),!0};this._groupingSelectionChips=new u({placeholder:p.get("DataGridViewCustomViewsDialog").GroupingPlaceholder,onDropCell:function(e,t){return V(e,t)},onDropBlank:function(e,t){return V(e,t)}}),this._groupingSelectionChips.addEventListener("change",function(e){var t=n._groupingSelectionChips.getAllChipsOptions().map(function(e){return e.value});n._customViewsGroupingOptions[n._comboBox.selectedIndex]={dataIndexesToGroup:t},n._updateButtonsState()}),this._groupingSelectionChips.inject(I),I.inject(o)}var y=e.createElement("div",{class:"wux-datagridview-custom-views-sub-container"});this._sortModelView=new _(this),this._sortModelView.inject(y);var b=e.createElement("div",{class:"wux-datagridview-custom-views-layout-density wux-datagridview-custom-views-part"});e.createElement("div",{class:"wux-datagridview-custom-views-layout-density-label",html:p.get("DataGridViewCustomViewsDialog").LayoutDensity}).inject(b),this._densityComboBox=new a({enableSearchFlag:!1}),this._densityComboBox.getContent().classList.add("wux-datagridview-custom-views-combo"),this._densityComboBox.elementsList=[p.get("DataGridViewCustomViewsDialog").Compact,p.get("DataGridViewCustomViewsDialog").Comfortable],this._densityComboBox.addEventListener("change",function(){n._layoutDensities[n._comboBox.selectedIndex]=1===n._densityComboBox.selectedIndex?"comfortable":"compact",n._updateButtonsState()}),this._densityComboBox.inject(b),b.inject(y),y.inject(o);var M=e.createElement("div",{class:"wux-datagridview-custom-views-part wux-datagridview-custom-views-footer"});this._resetToDefaultButton=new l({label:p.get("DataGridViewCustomViewsDialog").ResetPreferences,onClick:function(e){n.resetToDefault()}}),this._resetToDefaultButton.getContent().addClassName("wux-datagridview-custom-views-flushButton"),this._resetToDefaultButton.inject(M),this._updateFromCurrentViewButton=new l({label:p.get("DataGridViewCustomViewsDialog").UpdateFromCurrentView.Label,emphasize:"medium-attention"}),this._updateFromCurrentViewButton.getContent().classList.add("wux-datagridview-custom-views-update-button"),this._updateFromCurrentViewButton.tooltipInfos=new s({shortHelp:p.get("DataGridViewCustomViewsDialog").UpdateFromCurrentView.ShortHelp,longHelp:p.get("DataGridViewCustomViewsDialog").UpdateFromCurrentView.LongHelp}),this._updateFromCurrentViewButton.inject(M),this._updateFromCurrentViewButton.addEventListener("buttonclick",function(e){n.updateFromCurrentView()}),M.inject(o),this.content=o,this.buttons={Ok:new l({label:p.get("DataGridViewCustomViewsDialog").SaveAndApply,onClick:function(e){n.saveCustomViews(!0),n.visibleFlag=!1}}),Save:new l({onClick:function(e){n.saveCustomViews(),n.visibleFlag=!1}}),Cancel:new l({onClick:function(e){n.visibleFlag=!1}})},this.buttons.Save.emphasize="secondary",this.addEventListener("close",function(e){n.visibleFlag=!1})},loadCustomViews:function(){this._editedCustomViews=e.clone(this.dataGridView.getCustomViewsManager().getCustomViews()),0===this._editedCustomViews.length&&(this._editedCustomViews=[...f]),this._layoutDensities=[],this._customViewsGroupingOptions=[],this._customViewsSortModels=[],this._treeDocuments=[];for(var t=0;t<this._editedCustomViews.length;t++)this._createNewTreeDocument();var i=this.dataGridView.getCustomViewsManager().getCurrentCustomViewIndex();i<0&&(i=0),this.loadCustomView(i,!0),this._updateComboFromCustomViews()},_createNodeModelFromColumnOrGroup:function(e,t,i,n){var l;if(e){var r={dataIndex:e.dataIndex||""};e.children||(r.visibleFlag=t,r.width="auto"===i?void 0:i,r.pinned=n||"unpinned"),l=new o({label:e.text,icons:e.icon&&""!==e.icon?[e.icon]:[],grid:r})}return l},_generateTreeDocumentFromCustomView:function(e,t){if(e&&t){e.prepareUpdate();for(var i=this.dataGridView.layout,n=i.getLeafColumns(),o=i._getOrderedColumnIndexesFromChanges(t),l=null,r=0;r<n.length;r++){var s=n[o[r]];if(s){var a=s.dataIndex;if(this.dataGridView.getColumnOrGroup(a)){var d,u,h;d=t.columnsVisibleFlag&&void 0!==t.columnsVisibleFlag[a]?t.columnsVisibleFlag[a]:i._getOriginalColumnOptionValue(a,"visibleFlag"),u=t.columnsWidth&&void 0!==t.columnsWidth[a]?t.columnsWidth[a]:i._getOriginalColumnOptionValue(a,"width"),h=t.columnsPinnedState&&void 0!==t.columnsPinnedState[a]?t.columnsPinnedState[a]:i._getOriginalColumnOptionValue(a,"pinned");var c=this._createNodeModelFromColumnOrGroup(s,d,u,h);this._insertNodeModelNextTo(e,c,l,"after"),l=c}}}e.setUseChangeTransactionMode(!0),e.expandAll(),e.pushUpdate()}},_extractNodeModel:function(e){if(e){var t=e.getParent();if(t)for(t.removeChild(e,!0);t&&!t.hasChildren();){var i=t.getParent();i&&i.removeChild(t,!0),t=i}}},_getColumnOrGroupFromNodeModel:function(e){var t;if(e&&this.dataGridView){var i=e.getAttributeValue("dataIndex");t=this.dataGridView.getColumnOrGroup(i)}return t},_insertNodeModelNextTo:function(e,t,i,n){if(e&&t){this.dataGridView.layout;var o=this._getColumnOrGroupFromNodeModel(t);if(o){for(var l=o._parent;l&&(!l.dataIndex||""===l.dataIndex);)l=l._parent;if(l){var r=t.getAttributeValue("pinned"),s=i?i.getAttributeValue("pinned"):void 0,a=null,d=i?i.getParent():null;if(r===s)for(a=d;a&&!this._isNodeModelMatchingColumnOrGroup(a,l)&&!(a&&a.getParent()&&a.getParent()._isTrueRoot());)a=a.getParent();var u=a;if(a&&this._isNodeModelMatchingColumnOrGroup(a,l))d=a;else{a=this._createNodeModelFromColumnOrGroup(l);for(var h=d?d.getParent():null,c=d?h&&!h._isTrueRoot()?h:d:null,g=l._parent;g;){if(c&&this._isNodeModelMatchingColumnOrGroup(c,g)){c.addChild(a,"before"===n?0:void 0);break}var m;if(g.dataIndex&&""!==g.dataIndex&&(m=this._isNodeModelMatchingColumnOrGroup(u,g)?u:this._createNodeModelFromColumnOrGroup(g),a.getParent()?c&&m.addChild(c,"before"===n?0:void 0):m.addChild(a,"before"===n?0:void 0),m.expand(),c=m),!g._parent)break;g=g._parent}var p=this._getNodeModelLocalIdInHierarchy(i,e._getTrueRoot());void 0!==p&&"after"===n&&p++,!c||c.getParent()||c._isTrueRoot()?a.getParent()||e.addRoot(a,p):e.addRoot(c,p),d=a}}l&&d||(d=e._getTrueRoot());var f=this._getNodeModelLocalIdInHierarchy(i,d);void 0!==f&&"after"===n&&f++,d.addChild(t,f),d.expand()}}},_getNodeModelFromDataIndex:function(e,t){var i=null;return e&&e.processDescendants({processNode:function(e){if(e.nodeModel.getAttributeValue("dataIndex")===t)return i=e.nodeModel,{stopProcessing:!0}}}),i},_getNodeModelLocalIdInHierarchy:function(e,t){var i;if(e&&t)for(var n=e;n;){if(n.getParent()===t){i=n._getLocalID();break}n=n.getParent()}return i},_isNodeModelMatchingColumnOrGroup:function(e,t){for(var i=!1;e&&t;){if(t.dataIndex&&""!==t.dataIndex){if(!(i=e.getAttributeValue("dataIndex")===t.dataIndex))break;e=e.getParent()}t=t._parent}return i},_getNodeModelVisibleFlagEditableState:function(e){var t=this,i=!1;if(e.hasChildren())e.processDescendants({processNode:function(e){if(t._getNodeModelVisibleFlagEditableState(e.nodeModel))return i=!0,{stopProcessing:!0}}});else{var n=e.getAttributeValue("dataIndex");i=!t.dataGridView.layout.getColumnAlwaysVisibleFlag(n)}return i},_getNodeModelVisibleFlag:function(e){var t=this,i=void 0;return e&&(e.hasChildren()?e.processDescendants({processNode:function(e){var n=t._getNodeModelVisibleFlag(e.nodeModel);return void 0===n?(i=void 0,{stopProcessing:!0}):void 0!==i&&i!==n?(i=void 0,{stopProcessing:!0}):void(i=n)}}):i=e.getAttributeValue("visibleFlag")),i},_getNodeModelPinned:function(e){var t="unpinned";return e&&(t=e.hasChildren()?this._getNodeModelPinned(e.getChildren()[0]):e.getAttributeValue("pinned")),t},_mergeChildren:function(e){if(e){var t=e.getChildren();if(t){if(t.length>1)for(var i=t.length-1;i>0;i--){var n=t[i],o=t[i-1];if(n&&n.hasChildren()&&o&&o.hasChildren()&&n.getAttributeValue("dataIndex")===o.getAttributeValue("dataIndex"))if(this._getNodeModelPinned(n)===this._getNodeModelPinned(o)){for(var l=n.getChildren().slice(),r=0;r<l.length;r++)o.addChild(l[r]);e.removeChild(n)}}for(i=0;i<t.length;i++)this._mergeChildren(t[i])}}},loadCustomView:function(e,t){var i=this._editedCustomViews[e];if(i&&(this._selectedCustomView!==i||t)){if(this._selectedCustomView=i,this._groupingSelectionChips){this._groupingSelectionChips.removeAllChips(),(!this._customViewsGroupingOptions[e]||this._customViewsGroupingOptions[e].dataIndexesToGroup&&0===this._customViewsGroupingOptions[e].dataIndexesToGroup.length)&&(this._customViewsGroupingOptions[e]=i.groupingOptions||{dataIndexesToGroup:[]});var n=this._customViewsGroupingOptions[e];if(n&&n.dataIndexesToGroup)for(var o=0;o<n.dataIndexesToGroup.length;o++){var l=n.dataIndexesToGroup[o];this._groupingSelectionChips.addChip({label:this.dataGridView.layout.getColumnOptionValue(l,"text"),value:l})}}var r=this._treeDocuments[e];if(r){var s=r.getChildren();s&&0!==s.length||this._generateTreeDocumentFromCustomView(r,i)}this._attributesDataGridView.treeDocument=r,this._attributesDataGridView.setActiveCell(-1),this._attributesDataGridView.setScrollerPosition({x:0,y:0}),this._customViewsSortModels[e]||(this._customViewsSortModels[e]=i.columnsSortModel),this._sortModelView.loadSortModel(this._customViewsSortModels[e]),this._layoutDensities[e]||(this._layoutDensities[e]=i.layoutDensity||this.dataGridView.layout._getOriginalLayoutDensity());var a=this._layoutDensities[e];this._densityComboBox.selectedIndex="comfortable"===a?1:0,this._updateButtonsState()}},resetToDefault:function(){var e=this._attributesDataGridView.getTreeDocument();if(e){e.prepareUpdate();for(var t=this.dataGridView.layout,i=t.getLeafColumns(),n=0;n<i.length;n++){var o=i[n].dataIndex,l=this._getNodeModelFromDataIndex(e,o);if(l){var r=t._getOriginalColumnOptionValue(o,"visibleFlag"),s=t._getOriginalColumnOptionValue(o,"width"),a=t._getOriginalColumnOptionValue(o,"pinned");l.updateOptions({grid:{visibleFlag:r,width:"auto"===s?void 0:s,pinned:a||"unpinned"}})}}e._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(e,i){for(;e.hasChildren();)e=e.getChildren()[0];for(;i.hasChildren();)i=i.getChildren()[0];var n=e.getAttributeValue("dataIndex"),o=i.getAttributeValue("dataIndex"),l=t.getColumnIndex(n),r=t.getColumnIndex(o);return t._originalOrderedColumnsReverseIndexes[l]-t._originalOrderedColumnsReverseIndexes[r]}}),e.pushUpdate()}this._groupingSelectionChips&&this._groupingSelectionChips.removeAllChips(),this._customViewsSortModels[this._comboBox.selectedIndex]=[],this._sortModelView.loadSortModel(this.dataGridView._rowModel._originalSortModel||[]),this._densityComboBox.selectedIndex="comfortable"===t._getOriginalLayoutDensity()?1:0,this._resetToDefaultButton.disabled=!0},updateFromCurrentView:function(){var e=this._attributesDataGridView.getTreeDocument();if(e){e.prepareUpdate();(t=this.dataGridView.layout).getOrderedColumnsIndexes();for(var t,i=(t=this.dataGridView.layout).getLeafColumns(),n=0;n<i.length;n++){var o=i[n].dataIndex,l=this._getNodeModelFromDataIndex(e,o);if(l){var r=t.getColumnVisibleFlag(o),s=t.getColumnWidth(o),a=t.getColumnPinned(o);l.updateOptions({grid:{visibleFlag:r,width:"auto"===s?void 0:s,pinned:a||"unpinned"}})}}if(e._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(e,i){if(e.hasChildren())return e._getRowID()-i._getRowID();var n=e.getAttributeValue("dataIndex"),o=i.getAttributeValue("dataIndex"),l=t.getColumnIndex(n),r=t.getColumnIndex(o);return t._orderedColumnsReverseIndexes[l]-t._orderedColumnsReverseIndexes[r]}}),e.pushUpdate(),this._selectedCustomView&&(this._customViewsSortModels[this._comboBox.selectedIndex]=this.dataGridView._rowModel.sortModel),this._groupingSelectionChips){this._groupingSelectionChips.removeAllChips();var d=this.dataGridView._rowModel._groupingOptions;if(d)for(n=0;n<d.dataIndexesToGroup.length;n++){var u=d.dataIndexesToGroup[n];this._groupingSelectionChips.addChip({label:this.dataGridView.layout.getColumnOptionValue(u,"text"),value:u})}}this._sortModelView.loadSortModel(this.dataGridView.sortModel),this._densityComboBox.selectedIndex="comfortable"===t.layoutDensity?1:0,this._updateFromCurrentViewButton&&(this._updateFromCurrentViewButton.disabled=!0,this._updateFromCurrentViewButton.emphasize=void 0)}},_checkIfResetToDefaultIsPossible:function(){var e=!1,t=this.dataGridView.layout,i=this._attributesDataGridView.getTreeDocument();if(i){var n=t._getOriginalOrderedColumnsIndexes(),o=0;i.processDescendants({processNode:function(i){if(i.nodeModel&&!i.nodeModel.hasChildren()){var l=i.nodeModel.getAttributeValue("dataIndex");if(n[o]!==t.getColumnIndex(l))return e=!0,{stopProcessing:!0};var r=i.nodeModel.getAttributeValue("visibleFlag"),s=i.nodeModel.getAttributeValue("width"),a=i.nodeModel.getAttributeValue("pinned");if(!e&&r!==t._getOriginalColumnOptionValue(l,"visibleFlag"))return e=!0,{stopProcessing:!0};if(!e){var d=t._getOriginalColumnOptionValue(l,"width");if(s!=d&&(void 0!==s||"auto"!==d))return e=!0,{stopProcessing:!0}}if(!e&&a!==t._getOriginalColumnOptionValue(l,"pinned"))return e=!0,{stopProcessing:!0};o++}}})}if(!e&&this._selectedCustomView){var l=this.dataGridView._rowModel._originalSortModel||[],r=this._sortModelView.getSortModel();r instanceof Array&&l instanceof Array&&JSON.stringify(r)!==JSON.stringify(l)&&(e=!0)}if(!e&&this._groupingSelectionChips&&this._groupingSelectionChips.getNumberOfChips()>0&&(e=!0),!e){var s="comfortable"===t._getOriginalLayoutDensity()?1:0;this._densityComboBox.selectedIndex!==s&&(e=!0)}return this._resetToDefaultButton&&(this._resetToDefaultButton.disabled=!e),e},_checkIfUpdateFromCurrentViewIsPossible:function(){var e=!1,t=this.dataGridView.layout,i=[];if(this._groupingSelectionChips){var n=this._groupingSelectionChips.getAllChipsOptions();i=n.map(function(e){return e.value})}var o=this._attributesDataGridView.getTreeDocument();if(o){var l=this,r=t.getOrderedColumnsIndexes(),s=0;o.processDescendants({processNode:function(n){if(n.nodeModel&&!n.nodeModel.hasChildren()){var o=n.nodeModel.getAttributeValue("dataIndex");if(r[s]!==t.getColumnIndex(o))return e=!0,{stopProcessing:!0};t.getColumnAlwaysVisibleFlag(o);var a=n.nodeModel.getAttributeValue("visibleFlag")&&(!l.dataGridView.rowGroupingEnabledFlag||!l.dataGridView.rowGroupingOptions.hideGroupedColumns||"tree"===o||i.indexOf(o)<0),d=n.nodeModel.getAttributeValue("width"),u=n.nodeModel.getAttributeValue("pinned");if(!e&&a!==t.getColumnVisibleFlag(o))return e=!0,{stopProcessing:!0};if(!e){var h=t.getColumnWidth(o);if(d!=h&&(void 0!==d||"auto"!==h))return e=!0,{stopProcessing:!0}}if(!e&&u!==t.getColumnPinned(o))return e=!0,{stopProcessing:!0};s++}}})}if(this._selectedCustomView){var a=this.dataGridView.sortModel,d=this._sortModelView.getSortModel();!a&&d&&d.length>0||!d&&a&&a.length>0||a instanceof Array&&d instanceof Array&&JSON.stringify(d)!==JSON.stringify(a)?(e=!0,this._sortModelView.setUpdateFromCurrentView(!0)):this._sortModelView.setUpdateFromCurrentView(!1)}if(!e&&this._groupingSelectionChips){i=(n=this._groupingSelectionChips.getAllChipsOptions()).map(function(e){return e.value});var u=this.dataGridView._rowModel._groupingOptions;(!u&&i.length>0||u&&!u.dataIndexesToGroup.equals(i))&&(e=!0)}if(!e){var h="comfortable"===t.layoutDensity?1:0;this._densityComboBox.selectedIndex!==h&&(e=!0)}return this._updateFromCurrentViewButton&&(this._updateFromCurrentViewButton.disabled=!e,this._updateFromCurrentViewButton.emphasize=e?"medium-attention":void 0),e},_checkIfSaveAndApplyArePossible:function(){var e=!1,t=!1,i=this.dataGridView.layout,n=[];if(this._groupingSelectionChips){var o=this._groupingSelectionChips.getAllChipsOptions();n=o.map(function(e){return e.value});for(var l=0;l<this._editedCustomViews.length;++l){var r=this._editedCustomViews[l].groupingOptions||{dataIndexesToGroup:[]};if(r=JSON.stringify(r),void 0!==this._customViewsGroupingOptions[l]&&JSON.stringify(this._customViewsGroupingOptions[l])!==r){e=!0;break}}var s=this.dataGridView._rowModel._groupingOptions?JSON.stringify(this.dataGridView._rowModel._groupingOptions):JSON.stringify({dataIndexesToGroup:[]});(r=this._customViewsGroupingOptions[this._comboBox.selectedIndex]?JSON.stringify(this._customViewsGroupingOptions[this._comboBox.selectedIndex]):JSON.stringify({dataIndexesToGroup:[]}))!==s&&(t=!0)}if(!e)for(l=0;l<this._treeDocuments.length;l++){var a=this._treeDocuments[l],d=this._editedCustomViews[l];if(a&&d){var u=i._getOrderedColumnIndexesFromChanges(d),h=0;a.processDescendants({processNode:function(t){if(t.nodeModel&&!t.nodeModel.hasChildren()){var n=t.nodeModel.getAttributeValue("dataIndex"),o=t.nodeModel.getAttributeValue("pinned");if(u[h]!==i.getColumnIndex(n))return e=!0,{stopProcessing:!0};var l=t.nodeModel.getAttributeValue("visibleFlag");if(l!==i._getOriginalColumnOptionValue(n,"visibleFlag")&&(!d.columnsVisibleFlag||!d.columnsVisibleFlag.hasOwnProperty(n))||d.columnsVisibleFlag&&d.columnsVisibleFlag.hasOwnProperty(n)&&d.columnsVisibleFlag[n]!==l)return e=!0,{stopProcessing:!0};var r=t.nodeModel.getAttributeValue("width");if(void 0===r&&(r="auto"),r!=i._getOriginalColumnOptionValue(n,"width")&&(!d.columnsWidth||!d.columnsWidth.hasOwnProperty(n))||d.columnsWidth&&d.columnsWidth.hasOwnProperty(n)&&d.columnsWidth[n]!=r)return e=!0,{stopProcessing:!0};if(o!==i._getOriginalColumnOptionValue(n,"pinned")&&(!d.columnsPinnedState||!d.columnsPinnedState.hasOwnProperty(n))||d.columnsPinnedState&&d.columnsPinnedState.hasOwnProperty(n)&&d.columnsPinnedState[n]!==o)return e=!0,{stopProcessing:!0};h++}}})}}var c=this._selectedCustomView.columnsSortModel||this.dataGridView._rowModel._originalSortModel||[],g=this._customViewsSortModels[this._comboBox.selectedIndex];c instanceof Array&&g instanceof Array&&JSON.stringify(c)!==JSON.stringify(g)&&(e=!0);var m=this.dataGridView.getCustomViewsManager().getCurrentCustomViewIndex();this._comboBox.selectedIndex!==m&&m>=0&&(t=!0);var f=this.dataGridView.getCustomViewsManager().getCustomViews();if(this._editedCustomViews.length!==f.length)e=!0;else for(l=0;l<this._editedCustomViews.length;++l)if(this._editedCustomViews[l].identifier!==f[l].identifier){e=!0;break}if(!e)for(l=0;l<this._editedCustomViews.length;++l){var C=this._editedCustomViews[l].layoutDensity||i._getOriginalLayoutDensity();void 0!==this._layoutDensities[l]&&this._layoutDensities[l]!==C&&(e=!0)}if(!t){var _="comfortable"===i.layoutDensity?1:0;this._densityComboBox.selectedIndex!==_&&(t=!0)}if(!t){if(a=this._attributesDataGridView.getTreeDocument()){var w=i.getOrderedColumnsIndexes(),v=(h=0,this);a.processDescendants({processNode:function(e){if(e.nodeModel&&!e.nodeModel.hasChildren()){var o=e.nodeModel.getAttributeValue("dataIndex");if(w[h]!==i.getColumnIndex(o))return t=!0,{stopProcessing:!0};i.getColumnAlwaysVisibleFlag(o);var l=e.nodeModel.getAttributeValue("visibleFlag")&&e.nodeModel.getAttributeValue("visibleFlag")&&(!v.dataGridView.rowGroupingEnabledFlag||!v.dataGridView.rowGroupingOptions.hideGroupedColumns||"tree"===o||n.indexOf(o)<0),r=e.nodeModel.getAttributeValue("width"),s=e.nodeModel.getAttributeValue("pinned");if(!t&&l!==i.getColumnVisibleFlag(o))return t=!0,{stopProcessing:!0};if(!t){var a=i.getColumnWidth(o);if(r!=a&&(void 0!==r||"auto"!==a))return t=!0,{stopProcessing:!0}}if(!t&&s!==i.getColumnPinned(o))return t=!0,{stopProcessing:!0};h++}}})}if(!t&&this._selectedCustomView){var D=this.dataGridView.sortModel||[],I=this._sortModelView.getSortModel();D instanceof Array&&I instanceof Array&&JSON.stringify(D)!==JSON.stringify(I)&&(t=!0)}}var V=this.buttons.Ok;V&&(V.disabled=!t,V.label=e?p.get("DataGridViewCustomViewsDialog").SaveAndApply:p.get("DataGridViewCustomViewsDialog").Apply);var y=this.buttons.Save;return y&&(y.disabled=!e),e&&t},_displayNotificationMessage:function(e){g.getNotificationManager()||(g.setNotificationManager(c),g.setRemoveStackOnFirstTimeoutFlag(!0),g.setStackingPolicy(31)),c.addNotif({level:"info",subtitle:e})},_updateButtonsState:function(){this._checkIfResetToDefaultIsPossible(),this._checkIfUpdateFromCurrentViewIsPossible(),this._checkIfSaveAndApplyArePossible()},_createNewTreeDocument:function(){var e=this,t=new n({shouldAcceptDrop:function(t){if("middle"!==t.dropPosition&&t.draggedTreeNodeModel&&t.dropNode&&e.dataGridView){var i=e._getNodeModelPinned(t.draggedTreeNodeModel);if(e._getNodeModelPinned(t.dropNode)===i&&!t.draggedTreeNodeModel.isAscendantOf(t.dropNode)&&!t.dropNode.isAscendantOf(t.draggedTreeNodeModel)){for(var n="top"===t.dropPosition?"before":"after",o=t.dropNode;o&&o.hasChildren();)o=o.getChildren()[0],n="before";if(o){var l=e._getColumnOrGroupFromNodeModel(t.draggedTreeNodeModel),r=o.getAttributeValue("dataIndex");if(e.dataGridView.layout._columnMoveIsPossible(l,r,n))return!0}}}return!1}});t.setFilterModel({label:{filterId:"string"},visibleFlag:{filterId:"set"},width:{filterId:"numberWithCondition"},pinned:{filterId:"set"}}),t.onUpdate(function(t){t.options.updateType!==WUXModelUpdateTypes.Selection&&t.options.updateType!==WUXModelUpdateTypes.PreSelection&&e._updateButtonsState()}),t.onNodeModelUpdate(function(t){if(!e._inNodeModelUpdate){e._inNodeModelUpdate=!0;var i=t.data.nodeModel,n=i.getTreeDocument();if(t.data&&t.data.attributes&&void 0!==t.data.attributes.pinned){var o=e._getTopNonSplittableGroupNodeModel(i);o&&(i=o),n.prepareUpdate(),i.hasChildren()&&i.processDescendants({treeTraversalOrder:"postOrder",processNode:function(e){e.nodeModel.setAttribute("pinned",t.data.attributes.pinned)}}),n.setUseChangeTransactionMode(!1),e._extractNodeModel(i);var l=null,r="before";if("left"===t.data.attributes.pinned||"unpinned"===t.data.attributes.pinned)if(l=e._getLastNodeModelWithPinnedState(n,"left"))r="after";else if(l=e._getFirstNodeModelWithPinnedState(n,"unpinned"))r="before";else{if(!(l=e._getFirstNodeModelWithPinnedState(n,"right")))return;r="before"}else if("right"===t.data.attributes.pinned)if(l=e._getFirstNodeModelWithPinnedState(n,"right"))r="before";else if(l=e._getLastNodeModelWithPinnedState(n,"unpinned"))r="after";else{if(!(l=e._getLastNodeModelWithPinnedState(n,"left")))return;r="after"}e._insertNodeModelNextTo(n,i,l,r),e._mergeChildren(n._getTrueRoot()),n.setUseChangeTransactionMode(!0),n.pushUpdate(),e._attributesDataGridView.ensureNodeModelVisible(i,!0,!1,void 0,!0),i.processDescendants({onlyVisibleNodes:!0,processNode:function(t){e._attributesDataGridView.flashEffectOnNodeModel("ui-modified",t.nodeModel)}})}else if(t.data&&t.data.attributes&&void 0!==t.data.attributes.visibleFlag){var s=e._attributesDataGridView.layout,a=s.getColumnIndex("visibleFlag"),d={updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1};if(i.hasChildren()){i.processDescendants({treeTraversalOrder:"postOrder",processNode:function(i){var n=i.nodeModel.getAttributeValue("dataIndex");e.dataGridView.layout.getColumnAlwaysVisibleFlag(n)||i.nodeModel.setAttribute("visibleFlag",t.data.attributes.visibleFlag)}});var u=s.getCellIDFromCoordinates({rowID:i._getRowID(),columnID:a});e._attributesDataGridView.updateCellView(u,d)}for(var h=n._getTrueRoot(),c=i.getParent();c&&c!==h;){u=s.getCellIDFromCoordinates({rowID:c._getRowID(),columnID:a});e._attributesDataGridView.updateCellView(u,d),c=c.getParent()}}e._updateButtonsState(),e._inNodeModelUpdate=!1}}),this._treeDocuments.push(t)},_clearCustomView:function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&"identifier"!==t&&delete e[t]},_setCustomViewPropertyValue:function(e,t,i,n){e&&(e[t]||(e[t]={}),e[t][i]=n)},getCurrentEditedCustomViewIndex:function(){return this._editedCustomViews.indexOf(this._selectedCustomView)},getEditedCustomView:function(e){var t;if("string"!=typeof e)return this._editedCustomViews[e];for(var i=0;i<this._editedCustomViews.length;i++){var n=this._editedCustomViews[i];if(n&&n.identifier===e){t=n;break}}return t},_addEditedCustomView:function(e){const t=this._editedCustomViews.reduce((e,t,i)=>(e[t.identifier]=i,e),{}),i=e=>{void 0===t[e.identifier]&&this._editedCustomViews.push(e)};if(Array.isArray(e))for(const t of e)i(t);else i(e)},createNewCustomView:function(){for(var e=p.get("CustomViewDefaultName"),t=1;this.getEditedCustomView(e);)t++,e=p.get("CustomViewDefaultName")+" "+t;var i={identifier:e};return this._addEditedCustomView(i),this._createNewTreeDocument(),this._selectedCustomView=i,this._updateComboFromCustomViews(),i},renameCurrentCustomView:function(){this._selectedCustomView&&this._comboBox&&this._renameViewEditor&&(this._renameViewEditor.value=this._selectedCustomView.identifier,this._comboBox.visibleFlag=!1,this._renameViewEditor.visibleFlag=!0,this._renameViewEditor._giveFocus())},deleteCustomView:function(e){var t=this.getEditedCustomView(e);this._editedCustomViews.splice(e,1),this._treeDocuments.splice(e,1),this._selectedCustomView===t&&(this._selectedCustomView=this._editedCustomViews.length>0?this._editedCustomViews[0]:null,this.loadCustomView(0,!0)),this._updateComboFromCustomViews()},saveCustomViews:function(t){var i=this.getCurrentEditedCustomViewIndex();this.dataGridView.prepareUpdateView();for(var n={},o=0;o<this._editedCustomViews.length;o++)this.saveCustomView(o,o===i&&t);var l=e.clone(this._editedCustomViews),r=l[this._comboBox.selectedIndex].identifier;if(this.dataGridView.getCustomViewsManager().setCustomViews(l,r,t,!0),this.dataGridView.rowGroupingEnabledFlag&&this._groupingSelectionChips&&t){var s=this._groupingSelectionChips.getAllChipsOptions().map(function(e){return e.value});this.dataGridView._rowModel._groupingOptions&&this.dataGridView._rowModel._groupingOptions.dataIndexesToGroup.equals(s)||(n={updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},this.dataGridView.groupRows({dataIndexesToGroup:s}))}this.dataGridView.pushUpdateView(n),this._updateButtonsState()},saveCustomView:function(e,t){var i=this._editedCustomViews[e];if(i){var n=this.dataGridView.layout;t&&n.deleteDataGridViewPreferences();var o=i.layoutDensity||n._getOriginalLayoutDensity();let m=i.columnsSortModel,p=i.groupingOptions;var l={},r=this._treeDocuments[e];if(r){var s=r.getChildren();s&&0!==s.length||this._generateTreeDocumentFromCustomView(r,i),this._clearCustomView(i);var a=0,d=this;r.processDescendants({processNode:function(e){if(e.nodeModel&&!e.nodeModel.hasChildren()){var t=e.nodeModel.getAttributeValue("dataIndex"),o=e.nodeModel.getAttributeValue("visibleFlag");o!==n._getOriginalColumnOptionValue(t,"visibleFlag")&&d._setCustomViewPropertyValue(i,"columnsVisibleFlag",t,o);var r=e.nodeModel.getAttributeValue("width");void 0===r&&(r="auto"),r!==n._getOriginalColumnOptionValue(t,"width")&&d._setCustomViewPropertyValue(i,"columnsWidth",t,r);var s=e.nodeModel.getAttributeValue("pinned");s!==n._getOriginalColumnOptionValue(t,"pinned")&&(d._setCustomViewPropertyValue(i,"columnsPinnedState",t,s),d._saveColumnOrderInCustomView(t,s,a,i));var u=n._originalOrderedColumnsReverseIndexes[n.getColumnIndex(t)];a!==u&&l[a]!==u&&(l[u]=a,d._saveColumnOrderInCustomView(t,s,a,i)),a++}}})}if(this._groupingSelectionChips){var u=this._customViewsGroupingOptions[e]||p;void 0!==u&&Array.isArray(u.dataIndexesToGroup)&&u.dataIndexesToGroup.length>0&&(i.groupingOptions=u)}var h=this.dataGridView._rowModel._originalSortModel||[],c=this._customViewsSortModels[e]||m;h instanceof Array&&c instanceof Array&&JSON.stringify(h)!==JSON.stringify(c)&&(i.columnsSortModel=c);var g=this._layoutDensities[e]||o;g!==n._getOriginalLayoutDensity()&&(i.layoutDensity=g)}},_getTreeDocumentFromCustomView:function(e){var t=null,i=this._editedCustomViews.indexOf(e);return i>=0&&(t=this._treeDocuments[i]),t},_getFirstNodeModelWithPinnedState:function(e,t){var i=null;return e.processDescendants({processNode:function(e){if(i)return{stopProcessing:!0};if(e.nodeModel&&!e.nodeModel.hasChildren()&&e.nodeModel.getAttributeValue("pinned")===t)return i=e.nodeModel,{stopProcessing:!0}}}),i},_getLastNodeModelWithPinnedState:function(e,t){var i=null;return e.processDescendants({processNode:function(e){if(e.nodeModel&&!e.nodeModel.hasChildren()){var n=e.nodeModel.getAttributeValue("pinned");if(n===t)i=e.nodeModel;else if("left"===t||"unpinned"===t&&"right"===n)return{stopProcessing:!0}}}}),i},_getFirstOrLastUnpinnedColumnIndex:function(e,t){var i=0,n=0;return e.processDescendants({processNode:function(e){if(e.nodeModel&&!e.nodeModel.hasChildren()){var t=e.nodeModel.getAttributeValue("pinned");"left"===t?n++:"right"===t?0:i++}}}),"undefined"===t||"left"===t?n:"right"===t?n+i-1:-1},_getNumberOfColumnsToTheLeft:function(e){return{left:0,unpinned:this._getFirstOrLastUnpinnedColumnIndex(e,"left"),right:this._getFirstOrLastUnpinnedColumnIndex(e,"right")+1}},_getTopNonSplittableGroupNodeModel:function(e){for(var t,i=e;i;){var n=this._getColumnOrGroupFromNodeModel(i);n&&!1===n.splittableFlag&&(t=i),i=i.getParent()}return t},_saveColumnOrderInCustomView:function(e,t,i,n){var o=this._getTreeDocumentFromCustomView(n);if(o){var l="unpinned"===t?"unpinnedColumnsOrder":"pinnedColumnsOrder",r=this._getNumberOfColumnsToTheLeft(o);this._setCustomViewPropertyValue(n,l,e,i-r[t])}},_updateComboFromCustomViews:function(){for(var e=this.getCurrentEditedCustomViewIndex(),t=[],i=0;i<this._editedCustomViews.length;i++)t.push(this._editedCustomViews[i].identifier);this._comboBox.elementsList=t,this._comboBox.selectedIndex=e}})}),define("DS/DataGridView/ModelMassUpdateDialog",["UWA/Core","UWA/Element","DS/Windows/Dialog","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Controls/Button","DS/Controls/Toggle","DS/Controls/ButtonGroup","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o,l,r,s,a){"use strict";return i.inherit({name:"ModelMassUpdateDialog",publishedProperties:{treeDocument:{defaultValue:null,type:"object"},attributes:{defaultValue:[],type:"array"},setNodeModelValueFunction:{defaultValue:null,type:"function"}},destroy:function(){this._dataGridView&&(this._dataGridView.destroy(),this._dataGridView=null),this._parent()},_postBuildView:function(){this._parent();var t=e.createElement("div",{class:"wux-model-mass-update-maindiv"}),i=e.createElement("div",{class:"wux-model-mass-update-description"});e.createElement("div",{html:a.get("ModelMassUpdate").Description,class:"wux-model-mass-update-description-label"}).inject(i);this._selectionButtonGroup=new s({type:"radio"}),this._selectionButtonGroup.getContent().addClassName("wux-model-mass-update-target"),this._selectionButtonGroup.addChild(new r({type:"radio",label:a.get("ModelMassUpdate").ApplyToSelected,value:0,checkFlag:!0})),this._selectionButtonGroup.addChild(new r({type:"radio",label:a.get("ModelMassUpdate").ApplyToAll,value:1})),this._selectionButtonGroup.inject(i),i.inject(t),this._selectionButtonGroup.addEventListener("change",function(e){o._updateButtonsDisableState()});var n=require("DS/DataGridView/DataGridView");this._dataGridView=new n({identifier:this.identifier+"_DataGridView",height:"auto",treeDocument:null,columns:[{text:"Name",dataIndex:"tree",typeRepresentation:"string",alignment:"far",width:"250",minWidth:"50",alwaysVisibleFlag:!0,editableFlag:!1},{text:"Value",dataIndex:"value",getCellTypeRepresentation:function(e){return e.nodeModel?e.nodeModel.getAttributeValue("typeRepresentation"):"string"},getCellSemantics:function(e){if(e.nodeModel)return e.nodeModel.getAttributeValue("semantics")},resizableFlag:!1,width:"auto",minWidth:"100",alwaysVisibleFlag:!0,editableFlag:!0,editionPolicy:"EditionInPlace"}],cellSelection:"none",selectionBehavior:{selectNodeModelOnCellSelection:!1},focusNextEditableCellOnTabFlag:!0,showBackgroundFlag:!1,cellActivationFeedback:"none",cellPreselectionFeedback:"none",columnDragEnabledFlag:!1,showAlternateBackgroundFlag:!1,showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!0,showRowHeaderBackgroundFlag:!1,defaultColumnDef:{minWidth:30,sortableFlag:!1}}),this._dataGridView.layout.columnsHeader=!1,this._dataGridView.layout.rowSpacing=6,this._applyAttributes();var o=this;this._dataGridView.addEventListener("liveChange",function(e,t){var i=o._dataGridView.model[t.rowID];i&&i.select()}),this._dataGridView.addEventListener("change",function(e,t){if(t.columnID===o._dataGridView.layout.getColumnIndex("value")){var i=o._dataGridView.model[t.rowID];i&&i.select()}}),this._dataGridView.inject(t),this.content=t,this.title=a.get("ModelMassUpdate").Title;o=this;this.buttons={Ok:new l({onClick:function(e){o.applyAttributesValues(),o.visibleFlag=!1}}),Apply:new l({onClick:function(e){o.applyAttributesValues()}}),Close:new l({onClick:function(e){o.visibleFlag=!1}})},this.addEventListener("close",function(e){o.visibleFlag=!1})},_applyProperties:function(e){this._parent(e),this.isDirty("treeDocument")&&this._applyTreeDocument(e.treeDocument),this.isDirty("attributes")&&this._applyAttributes(e.attributes)},_applyTreeDocument:function(e){if(this.treeDocument){var t=this.treeDocument.getXSO();if(t){var i=this;t.onPostAdd(function(e){i._updateButtonsDisableState()}),t.onPostRemove(function(e){i._updateButtonsDisableState()})}}},_applyAttributes:function(e){if(this._dataGridView){var t=new n,i=this.attributes;if(i)for(var l=0;l<i.length;l++){var r=i[l],s=r.label?r.label:r.name,a=this._getDefaultValue(r.typeRepresentation);t.addRoot(new o({label:s,grid:{name:r.name,typeRepresentation:r.typeRepresentation,semantics:r.semantics,value:a}}))}this._dataGridView.treeDocument=t;var d=this.buttons.Ok;d&&(d.disabled=!0);var u=this.buttons.Apply;u&&(u.disabled=!0);var h=t.getXSO();if(h){var c=this;h.onPostAdd(function(e){c._updateButtonsDisableState()}),h.onPostRemove(function(e){c._updateButtonsDisableState()})}c=this;var g=this._dataGridView.addEventListener("allCellsRendered",function(){c._dataGridView.removeEventListener("allCellsRendered",g),c._dataGridView.sizeColumnToFit("tree",{isUserInteraction:!1,computeAllRows:!0})})}},_getDefaultValue:function(e){var t=void 0;if(this._dataGridView){var i,n=this._dataGridView.getTypeRepresentationFactory(),o=n.getRegisteredTypeRepresentation(e);(i=o&&o.semantics&&o.semantics.possibleValues?o.semantics.possibleValues:n.getRegisteredEnum(e))&&(t=Array.isArray(i)?i[0]:i[Object.keys(i)[0]])}return t},resetAttributesValues:function(){if(this._dataGridView){for(var e=0;e<this._dataGridView.model.length;e++){var t=this._dataGridView.model[e];if(t){var i=t.getAttributeValue("typeRepresentation"),n=this._getDefaultValue(i);t.setAttribute("value",n)}}this._dataGridView.unselectAll()}},_applyAttributesValues:function(e,t){if(e&&t)if(this.setNodeModelValueFunction)for(var i=0;i<t.length;i++){if(r=t[i]){var n=r.getAttributeValue("name"),o=r.getAttributeValue("value");this.setNodeModelValueFunction(e,n,o)}}else{var l={grid:{}};for(i=0;i<t.length;i++){var r;if(r=t[i]){n=r.getAttributeValue("name"),o=r.getAttributeValue("value");l.grid[n]=o}}e.updateOptions(l)}},applyAttributesValues:function(){if(this._dataGridView&&this.treeDocument){var e=1==this._selectionButtonGroup.value[0],t=this._dataGridView.getNodesXSO().get();if(t.length>0){var i=this;this.treeDocument.prepareUpdate(),e?this.treeDocument.processDescendants({onlyVisibleNodes:!0,processNode:function(e){i._applyAttributesValues(e.nodeModel,t)}}):this.treeDocument.processSelectedNodes({processNode:function(e){i._applyAttributesValues(e.nodeModel,t)}}),this.treeDocument.pushUpdate({updateType:WUXModelUpdateTypes.AttributesChange})}}},_updateButtonsDisableState:function(){var e=!0;if(this.treeDocument&&this._dataGridView&&this._dataGridView.treeDocument){var t=this.treeDocument.getXSO(),i=this._dataGridView.treeDocument.getXSO();if(t&&i)e=1==this._selectionButtonGroup.value[0]?i.isEmpty():t.isEmpty()||i.isEmpty()}var n=this.buttons.Ok;n&&(n.disabled=e);var o=this.buttons.Apply;o&&(o.disabled=e)}})}),define("DS/DataGridView/DataGridViewCell",["DS/CollectionView/CollectionViewCell"],function(e){"use strict";return e.inherit({name:"DataGridViewCell",publishedProperties:{showKPIColorFlag:{defaultValue:!1,type:"boolean"},KPIColor:{defaultValue:void 0,type:"string"}},_applyShowKPIColorFlag:function(e){this._updateKPIColor()},_applyKPIColor:function(e){this._updateKPIColor()},_updateKPIColor:function(){this.showKPIColorFlag?(this.elements.KPIColorDiv?this.elements.KPIColorDiv.show():this.elements.KPIColorDiv=new UWA.Element("div",{class:"wux-layouts-datagridview-kpi-color"}),void 0!==this.KPIColor?(this.elements.KPIColorDiv.style.background=this.KPIColor,this.elements.KPIColorDiv.style.outlineColor=this.KPIColor,this.elements.KPIColorDiv.style.visibility=""):this.elements.KPIColorDiv.style.visibility="hidden",this.elements.KPIColorDiv.parentNode||this.elements.KPIColorDiv.inject(this.elements.container,"top")):this.elements.KPIColorDiv&&this.elements.KPIColorDiv.hide()},_applyProperties:function(e){this._parent(e),this.isDirty("showKPIColorFlag")&&this._applyShowKPIColorFlag(e.showKPIColorFlag),this.isDirty("KPIColor")&&this._applyKPIColor(this.KPIColor)},blackBoxFlag:!0,getInitialClassName:function(){return this._parent()+" wux-layouts-datagridview-cell"},getCleaningMode:function(){return 1},isRow:function(){return!1}})}),define("DS/DataGridView/DataGridViewLayout",["DS/CollectionView/layouts/CollectionViewGridLayout","DS/Utilities/Utils","DS/Utilities/TreeUtils","DS/TreeModel/ModelUtils","DS/Utilities/Dom","DS/TreeModel/TreeNodeModel"],function(e,t,i,n,o,l){"use strict";return e.inherit({name:"CollectionViewDataGridLayout",publishedProperties:{columns:{defaultValue:[],type:"array"},cellWidth:{defaultValue:100,type:"integer"},cellHeight:{defaultValue:26,type:"integer"},layoutDensity:{defaultValue:"compact",type:"string"},columnsHeader:{defaultValue:!0,type:"boolean"},columnHeaderHeight:{defaultValue:27,type:"integer"},rowsHeader:{defaultValue:!0,type:"boolean"},rowSpacing:{defaultValue:0,type:"integer"},addCellCoordinates:{defaultValue:!1,type:"boolean"},useLastColumnWidthAutoFlag:{defaultValue:!1,type:"boolean"}},_dataGridViewPrefKey:"wux-collectionView-dataGridView",init:function(e){this._parent(e),this._balancedColumnTree=[],this._columnItemsByDepth=[],this._leafColumns=[],this._leafColumnsCount=0,this._orderedColumnsIndexes=[],this._computedColumns=[],this._computedRows=[],this._columnTreeItemCount=0,this._columnHeaderCellCount=3+(this.rowsHeader?1:0),this._hasAutoWidthColumnWithAutoRowHeightFlag=!1,this._autoRowHeightColumnIndexes=[],this._manageTouchChange()},_applyProperties:function(e){this._parent(e),this.isDirty("layoutDensity")&&this._applyLayoutDensity(e.layoutDensity)},_manageTouchChange:function(){var e=this;o.addEventOnElement(this,document,"touchChange",function(){e.collectionView&&(e.collectionView._applyMaxVisibleRowCount(void 0,e.collectionView.maxVisibleRowCount),e.invalidate({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}))})},prepareLayout:function(){var e=this.rowsHeader,t=this.getLeafColumns();this._leafColumnsCount=t.length+(e?1:0),this._columnHeaderCellCount=this._columnTreeItemCount+(e?1:0)+3,this._computeColumnsWidth(),this._leftPinnedRowColumnID=e?-4:-3,this._unpinnedRowColumnID=e?-3:-2,this._rightPinnedRowColumnID=e?-2:-1,this._isInvalid=!1},_applyColumnGroupsExpandedFlag:function(){if(this._columnItemsByDepth&&this._columnItemsByDepth.length>0)for(var e=0;e<this._columnItemsByDepth.length-1;e++)for(var t=this._columnItemsByDepth[e],i=0;i<t.length;i++){var n=t[i],o=n.children;if(o&&o.length>0)for(var l=0;l<o.length;l++){var r=o[l];"closed"!==r.columnGroupShow&&"open"!==r.columnGroupShow||(n.expandedFlag=!1)}}},_applyColumns:function(e,t){this._balancedColumnTree=i.createBalancedTree(this.columns),this._columnItemsByDepth=i.computeItemsByDepth(this._balancedColumnTree);var n=!!this.collectionView.defaultColumnDef&&this.collectionView.defaultColumnDef.autoRowHeightFlag;if(this._leafColumns=[],this._hasAutoWidthColumnWithAutoRowHeightFlag=!1,this._autoRowHeightColumnIndexes=[],this._columnItemsByDepth&&this._columnItemsByDepth.length>0)for(var o=this._columnItemsByDepth[this._columnItemsByDepth.length-1],l=0;l<o.length;l++){var r=o[l];void 0!==r.dataIndex?(void 0!==r.pinned&&"left"!==r.pinned&&"right"!==r.pinned&&"unpinned"!==r.pinned&&(r.pinned="unpinned"),this._leafColumns.push(r),(n||r.autoRowHeightFlag)&&(this._autoRowHeightColumnIndexes.push(l),"auto"===this.getColumnWidth(l)&&(this._hasAutoWidthColumnWithAutoRowHeightFlag=!0))):console.warn("The leaf column at index "+l+" does not have a defined dataIndex")}this._autoRowHeightColumnIndexes.length>0?this.getRowHeightFunction?this.resetRowHeights():this.getRowHeightFunction=this.getRowHeightFromCellContents:this.getRowHeightFunction===this.getRowHeightFromCellContents&&(this.getRowHeightFunction=null),this._originalLeafColumns=i.cloneTree(this._leafColumns),this._computeOriginalOrderedColumnsIndexes(),this._updateColumnTreeFromOrderedIndexes(),this._computeColumnsWidth(),(e&&e.length>0||t)&&this.invalidate({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0})},applyColumns:function(){this.collectionView.prepareUpdateView(),this._applyColumns(),this._applyPreferencesOnColumns(),this.invalidate({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}),this.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},_computeColumnItems:function(){this._mergeColumnGroups(this._balancedColumnTree,this.collectionView._draggedColumnOrGroup),this._columnItemsByDepth=i.computeItemsByDepth(this._balancedColumnTree),this._columnTreeItemCount=i.countItem(this._balancedColumnTree);var e=this.rowsHeader,t=this.getLeafColumns();this._leafColumnsCount=t.length+(e?1:0),this._columnHeaderCellCount=this._columnTreeItemCount+(e?1:0)+3,this._computeColumnsReverseIndexes(),this._computeOrderedColumnsIndexes()},_mergeColumnGroups:function(e,t){if(e.length>1)for(var i=e.length-1;i>0;i--){var n=e[i],o=e[i-1];if(n&&n.children&&o&&o.children&&n.dataIndex===o.dataIndex&&(!t||n!==t&&o!==t)){var l=this.getColumnOrGroupPinned(n),r=this.getColumnOrGroupPinned(o);if(l===r||void 0===l&&"unpinned"===r||"unpinned"===l&&void 0===r){o.children=o.children.concat(n.children);for(var s=0;s<n.children.length;s++)n.children[s]._parent=o;e.splice(i,1)}}}for(i=0;i<e.length;i++){var a=e[i];a&&a.children&&this._mergeColumnGroups(a.children,t)}},_updateColumnTreeFromOrderedIndexes:function(){for(var e=this.getLeafColumns(),t=[],n=0;n<this._orderedColumnsIndexes.length;n++){var o=e[this._orderedColumnsIndexes[n]],l=i.extractItemHierarchy(o,this._balancedColumnTree,!1);l&&t.push(l)}this._balancedColumnTree=t,this._computeColumnItems()},_applyRowsHeader:function(e,t){this.invalidate({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0})},getDefaultCellHeight:function(){return this.collectionView._getCurrentTouchMode()||"comfortable"===this.layoutDensity?40:26},_applyCellHeight:function(e,t){if(t<26)return this.cellHeight=26,void(this.collectionView&&this.collectionView._applyMaxVisibleRowCount(void 0,this.collectionView.maxVisibleRowCount));this.resetRowHeights(),this.collectionView&&this.collectionView._applyMaxVisibleRowCount(void 0,this.collectionView.maxVisibleRowCount)},_applyLayoutDensity:function(e,t){this.collectionView&&(this.collectionView._isCurrentlyCalledFromUIInteraction()||this.collectionView._currentlyCalledFromApplyPreferencesFlag)||(this._originalLayoutDensity=this.layoutDensity),this.collectionView&&this.collectionView.getContent()&&(this.collectionView.getContent().setAttribute("layout-density",this.layoutDensity),this.collectionView._applyMaxVisibleRowCount(void 0,this.collectionView.maxVisibleRowCount,!0)),this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})},_getOriginalLayoutDensity:function(){return this._originalLayoutDensity||this.layoutDensity},_applyColumnsHeader:function(e,t){this.invalidate({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0})},_applyColumnHeaderHeight:function(e,t){if(t<27)return this.columnHeaderHeight=27,void(this.collectionView&&this.collectionView._applyMaxVisibleRowCount(void 0,this.collectionView.maxVisibleRowCount));this.collectionView&&this.collectionView._applyMaxVisibleRowCount(void 0,this.collectionView.maxVisibleRowCount),this.invalidate({updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!1})},_applyRowSpacing:function(e,t){this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})},_applyAddCellCoordinates:function(e,t){this.invalidate({updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})},_applyUseLastColumnWidthAutoFlag:function(e,t){this.invalidate({updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})},getLeafColumns:function(){return this._leafColumns},getVisibleOrderedLeafColumns:function(){if(!this._leafColumns)return[];for(var e=[],t=this.getLeafColumns(),i=this.getVisibleOrderedColumnsIndexes(),n=0;n<i.length;n++){var o=t[i[n]];e.push(o)}return e},_getColumnTreeDepth:function(){return this._columnItemsByDepth?this._columnItemsByDepth.length:0},_getOriginalLeafColumns:function(){return this._originalLeafColumns},getColumnOptionValue:function(e,t){var i,n=this.getColumnIndex(e);if(n>-1){var o=this.getLeafColumns()[n];if(o&&(i=o[t]),void 0===i){var l=this.collectionView.defaultColumnDef;l&&(i=l[t])}}return i},_getOriginalColumnOptionValue:function(e,t){var i;if((e=this.getColumnIdentifiers(e).columnIndex)>-1){var n=this._getOriginalLeafColumns()[e];n&&(i=n[t]),void 0===i&&this.collectionView.defaultColumnDef&&(i=this.collectionView.defaultColumnDef[t])}return i},_computeColumnsReverseIndexes:function(){this._columnsReverseIndexes={};for(var e=this.getLeafColumns(),t=0,i=e.length;t<i;t++){var n=e[t].dataIndex;void 0!==n&&(this._columnsReverseIndexes[n]=t)}this._columnsReverseIndexes.rowHeader=-1},_computeOriginalOrderedColumnsIndexes:function(){for(var e=this.getLeafColumns().length,t=[],i=[],n=[],o=0;o<e;o++){var l=this.getColumnPinned(o);"left"===l?t.push(o):"right"===l?n.push(o):i.push(o)}this._orderedColumnsIndexes=t.concat(i).concat(n),this._originalOrderedColumnsIndexes=this._orderedColumnsIndexes.slice(0),this._computeOrderedColumnsReverseIndexes(),this._originalOrderedColumnsReverseIndexes=this._orderedColumnsReverseIndexes.slice(0)},_getOriginalOrderedColumnsIndexes:function(){return this._originalOrderedColumnsIndexes},_computeOrderedColumnsIndexes:function(){this._orderedColumnsIndexes=[];for(var e=this._columnItemsByDepth[this._columnItemsByDepth.length-1],t=0;t<e.length;t++){var i=e[t];this._orderedColumnsIndexes.push(this.getColumnIndex(i.dataIndex))}this._computeOrderedColumnsReverseIndexes()},getOrderedColumnsIndexes:function(){return this._orderedColumnsIndexes},getOrderedColumnsReverseIndexes:function(){return this._orderedColumnsReverseIndexes},_computeOrderedColumnsReverseIndexes:function(){this._orderedColumnsReverseIndexes=[];for(var e=0;e<this._orderedColumnsIndexes.length;e++)this._orderedColumnsReverseIndexes[this._orderedColumnsIndexes[e]]=e},hasCellsInLeftContainer:function(){return void 0!==this._firstLeftPinnedColumnIndex},hasCellsInRightContainer:function(){return void 0!==this._firstRightPinnedColumnIndex},_computeColumnsWidth:function(){this._firstUnpinnedColumnIndex=void 0,this._lastUnpinnedColumnIndex=void 0,this._firstLeftPinnedColumnIndex=void 0,this._lastLeftPinnedColumnIndex=void 0,this._firstRightPinnedColumnIndex=void 0,this._lastRightPinnedColumnIndex=void 0;var e=this.collectionView.getViewportDimensions(),i=this.collectionView.getDimensions(),n=this._getEstimatedVirtualHeight(!0)>e.height?t.getScrollbarWidth():0,o=i.width-n-(this.rowsHeader?this.getRowHeaderWidth():0);this.getRightContainerWidth()>0&&o--,this.getLeftContainerWidth()>0&&o--;var l=void 0;if(this.useLastColumnWidthAutoFlag)for(var r=this.getColumnIndex("ContextualMenuColumn"),s=this._orderedColumnsIndexes.length-1;s>=0;s--){if((_=this._orderedColumnsIndexes[s])!==r)if(h=this.getColumnVisibleState(_))if("right"!==(v=this.getColumnPinned(_))&&"left"!==v){l=_;break}}for(var a=0,d=(s=0,this.getLeafColumns().length);s<d;s++){var u=!1,h=this.getColumnVisibleState(s);void 0===(w=this.getColumnWidth(s))&&(w="auto"),this.useLastColumnWidthAutoFlag&&s===l&&(w="auto");var c=this.getColumnMinWidth(s);h?("string"==typeof w&&("auto"===w?(w=0,u=!0,a++):w=w.indexOf("%")>-1?Math.floor(i.width*(parseInt(w,10)/100)):parseInt(w,10)),w=Math.max(0,w),c&&!u&&(w=Math.max(c,w))):w=0,o-=w,this._setColumnComputedWidth(s,w)}var g=this.cellWidth,m=0,p=0,f=0,C=0;for(s=0;s<this._orderedColumnsIndexes.length;s++){var _=this._orderedColumnsIndexes[s],w=(c=this.getColumnMinWidth(_),h=this.getColumnVisibleState(_),this.getColumnWidth(_));this.useLastColumnWidthAutoFlag&&_===l&&(w="auto");var v=this.getColumnPinned(_);if("auto"===w&&h){var D=Math.floor(o/(a-C)),I=Math.max(g,D);c&&(I=Math.max(c,I)),o-=I,this._setColumnComputedWidth(_,I),C++}var V=0,y=this.getColumnComputedWidth(_);"left"===v?(V=m,m+=y,void 0===this._firstLeftPinnedColumnIndex&&h&&(this._firstLeftPinnedColumnIndex=_),h&&(this._lastLeftPinnedColumnIndex=_)):"right"===v?(V=p,p+=y,void 0===this._firstRightPinnedColumnIndex&&h&&(this._firstRightPinnedColumnIndex=_),h&&(this._lastRightPinnedColumnIndex=_)):(V=f,f+=y,void 0===this._firstUnpinnedColumnIndex&&h&&(this._firstUnpinnedColumnIndex=_),h&&(this._lastUnpinnedColumnIndex=_)),this._setColumnPosition(_,V)}},_setColumnPosition:function(e,t){this._computedColumns[e]||(this._computedColumns[e]={}),this._computedColumns[e].position=t},getColumnPosition:function(e){return this._computedColumns[e]?this._computedColumns[e].position:0},getColumnOrGroupPosition:function(e){var t=0;return e&&(t=e.children?this.getColumnOrGroupPosition(e.children[0]):this.getColumnPosition(this.getColumnIndex(e.dataIndex))),t},moveColumn:function(e,t,i){var n=this.getLeafColumns()[this.getColumnIndex(e)];return this.moveColumnOrGroup(n,t,i)},moveColumnOrGroup:function(e,t,n){if(!e)return!1;"string"==typeof t&&(t=this.getColumnIndex(t));var o=this.getLeafColumns()[t];if(!o)return!1;var l=this.getFirstLeafColumnIndex(e),r=this.getLastLeafColumnIndex(e),s=this._orderedColumnsReverseIndexes[l],a=this._orderedColumnsReverseIndexes[t],d=n&&n.insertBeforeOrAfter?n.insertBeforeOrAfter:s<a?"after":"before";if(!this._columnMoveIsPossible(e,t,d))return!1;this.collectionView._draggedColumnOrGroupPreviousFather=e._parent;var u=i.getLeafItems(e),h=this._getPreviousVisibleColumnID(l),c=this._getNextVisibleColumnID(r),g=this._columnTreeItemCount,m=i.getCommonParent(e,o);m||(m=this._balancedColumnTree);var p=i.extractItemHierarchy(e,m,!0);if(p){i.splitParentAtItemIndex(o,m,d);var f=i.getIndexInRootParent(o,m),C="after"===d?f+1:f;m&&m!==this._balancedColumnTree?i.addChild(m,p,C):this._balancedColumnTree.splice(C,0,p)}this._computeColumnItems();for(var _=this.getColumnPinned(t),w=this._orderedColumnsReverseIndexes[l]<this._orderedColumnsReverseIndexes[h]?l:c,v=this._orderedColumnsReverseIndexes[l]<this._orderedColumnsReverseIndexes[h]?h:l,D=this._orderedColumnsReverseIndexes[w];D<=this._orderedColumnsReverseIndexes[v];D++){var I=this._orderedColumnsIndexes[D];if(this.getColumnVisibleState(I))this.getColumnPinned(I)===_&&this.collectionView._freeUpColumnCells(I,1)}if(n&&n.isUserInteraction){for(D=0;D<u.length;D++)this._saveColumnOrderInPreferences(u[D].dataIndex);this._updateAllOrderInPreferences(e)}this.collectionView._updateColumnHeaderCells({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0});var V=!1;this._columnTreeItemCount!==g&&(V=!0);var y=!1;return this.collectionView._draggedColumnOrGroup&&(y=!0),this.invalidate({updateCellContent:V,updateCellLayout:!0,updateCellAttributes:y}),this.collectionView.fire("columnOrderChange"),!0},_columnMoveIsPossible:function(e,t,n){var o=!1;"string"==typeof t&&(t=this.getColumnIndex(t));var l=this.getLeafColumns()[t];if(l&&e){for(var r=i.getLeafItems(e),s=0;s<r.length;s++){if(r[s]===l)return!1}if("before"!==n&&"after"!==n){var a=this.getFirstLeafColumnIndex(e);n=this._orderedColumnsReverseIndexes[a]<this._orderedColumnsReverseIndexes[t]?"after":"before"}var d=i.getCommonParent(e,l);d||(d=this._balancedColumnTree);var u=i.getParents(e);for(s=u.length-1;s>=0;s--){var h=u[s];if(h===d)break;if(!1===h.splittableFlag)return!1}var c=i.getParents(l);for(s=c.length-1;s>=0;s--){var g=c[s];if(g===d)break;if(!1===g.splittableFlag&&("after"===n&&t!==this.getLastLeafColumnIndex(g)||"before"===n&&t!==this.getFirstLeafColumnIndex(g)))return!1}o=!0}return o},getColumnShowTextFlag:function(e){return this.getColumnOptionValue(e,"showTextFlag")},getColumnAutoRowHeightFlag:function(e){return this.getColumnOptionValue(e,"autoRowHeightFlag")},setColumnAutoRowHeightFlag:function(e,t){var i=this.getColumnIndex(e),n=this.getLeafColumns();n[i].autoRowHeightFlag!==t&&(n[i].autoRowHeightFlag=t,this.applyColumns())},hasAutoWidthColumn:function(){for(var e=!1,t=(this.layout,this.getLeafColumns()),i=0;i<t.length;i++){var n=this.getColumnPinned(i);if("left"!==n&&"right"!==n&&"auto"===this.getColumnWidth(i)&&this.getColumnVisibleState(i)){e=!0;break}}return e},hasColumnWithAutoRowHeightFlag:function(){return this._autoRowHeightColumnIndexes&&this._autoRowHeightColumnIndexes.length>0},hasAutoWidthColumnWithAutoRowHeightFlag:function(){return this._hasAutoWidthColumnWithAutoRowHeightFlag},getColumnVisibleState:function(e){return this.getColumnAlwaysVisibleFlag(e)||this.getColumnVisibleFlag(e)&&this._isColumnDisplayedByHierarchy({rowID:-1,columnID:e})},getColumnVisibleFlag:function(e){return this.getColumnOptionValue(e,"visibleFlag")},setColumnVisibleFlag:function(e,t,i){var n=this.getColumnIndex(e);if(!(n<0)){var o=this.getLeafColumns();if(o[n].visibleFlag!==t){if(!t&&this.getColumnAlwaysVisibleFlag(e))return;o[n].visibleFlag=t,(this.getColumnAutoRowHeightFlag(n)||this.hasAutoWidthColumnWithAutoRowHeightFlag())&&this.resetRowHeights({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!0}),t&&this.collectionView.requestDelayedModelData("OnShowColumn"),this.getColumnAutoRowHeightFlag(n)||this.hasAutoWidthColumnWithAutoRowHeightFlag()||this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!0}),this._updateAutoWidthStyle(),this.collectionView.findStr&&""!=this.collectionView.findStr&&!this.collectionView._muteFind&&this.collectionView.setFindStr(this.collectionView.findStr,this.collectionView.matchCase,this.collectionView._currentMatchingStringIndex,!0,!0),this.collectionView.fire("columnVisibleStateChange",{visibleState:t,columnID:e});var l=o[n]._parent;if(l&&void 0!==l.expandedFlag){var r=this.getColumnOrGroupCellCoordinates(l);this.collectionView.updateCellView(this.getCellIDFromCoordinates(r),{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}}i&&i.isUserInteraction&&this._saveColumnVisibleFlagInPreferences(n)}},getColumnAlwaysVisibleFlag:function(e){return this.getColumnOptionValue(e,"alwaysVisibleFlag")},getColumnOrGroupVisibleState:function(e){var t=!1;if(e)if(e.children)for(var i=0;i<e.children.length;i++){var n=e.children[i];if(t=this.getColumnOrGroupVisibleState(n))break}else t=this.getColumnVisibleState(e.dataIndex);return t},getColumnOrGroupSelectableState:function(e){var t=!1;if(e&&this.getColumnOrGroupVisibleState(e))if(e.children)for(var i=0;i<e.children.length;i++){var n=e.children[i];if(t=this.getColumnOrGroupSelectableState(n))break}else t=this.getColumnSelectableFlag(e.dataIndex);return t},getColumnOrGroupPrintableState:function(e){var t=!1;if(e&&this.getColumnOrGroupVisibleState(e))if(e.children)for(var i=0;i<e.children.length;i++){var n=e.children[i];if(t=this.getColumnOrGroupPrintableState(n))break}else t=this.getColumnPrintableFlag(e.dataIndex);return t},_getVisibleLeafCount:function(e){var t=0;if(e&&e.children)for(var i=0;i<e.children.length;i++){var n=e.children[i];n.children?t+=this._getVisibleLeafCount(n):this.getColumnOrGroupVisibleState(n)&&t++}return t},setColumnOrGroupProperties:function(e,t){this.collectionView.prepareUpdateView();var i=!1;if((t.hasOwnProperty("text")||t.hasOwnProperty("icon"))&&(o=this.collectionView.getColumnOrGroup(e))){t.hasOwnProperty("text")&&(o.text=t.text),t.hasOwnProperty("showTextFlag")&&(o.showTextFlag=t.showTextFlag),t.hasOwnProperty("icon")&&(o.icon=t.icon);var n=this.getColumnOrGroupCellCoordinates(o);this.collectionView.updateCellView(this.getCellIDFromCoordinates(n),{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}t.hasOwnProperty("editableFlag")&&((o=this.collectionView.getColumnOrGroup(e))&&(o.editableFlag=t.editableFlag),i=!0);t.hasOwnProperty("disabled")&&((o=this.collectionView.getColumnOrGroup(e))&&(o.disabled=t.disabled),i=!0);if(t.hasOwnProperty("pinned")&&this.setColumnPinned(e,t.pinned),t.hasOwnProperty("width")||t.hasOwnProperty("minWidth")){var o;if(t.hasOwnProperty("minWidth"))(o=this.collectionView.getColumnOrGroup(e))&&(o.minWidth=t.minWidth);this.setColumnWidth(e,t.width)}if(t.hasOwnProperty("typeRepresentation")&&this.setColumnTypeRepresentation(e,t.typeRepresentation),t.hasOwnProperty("visibleFlag")&&this.setColumnVisibleFlag(e,t.visibleFlag),t.hasOwnProperty("autoRowHeightFlag")&&this.setColumnAutoRowHeightFlag(e,t.autoRowHeightFlag),t.hasOwnProperty("alignment")){var l=this.getColumnIndex(e);if(l<0)return;var r=this.getLeafColumns();r[l].alignment!==t.alignment&&(r[l].alignment=t.alignment),i=!0}i&&this.collectionView.updateColumnView(e,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}),this.collectionView.pushUpdateView()},getColumnEditableFlag:function(e){return this.getColumnOptionValue(e,"editableFlag")},getColumnEditionPolicy:function(e){return this.getColumnOptionValue(e,"editionPolicy")},getColumnDisabled:function(e){return this.getColumnOptionValue(e,"disabled")},getColumnResizableFlag:function(e){return this.getColumnOptionValue(e,"resizableFlag")},getColumnSelectableFlag:function(e){return this.getColumnOptionValue(e,"selectableFlag")},getColumnSortableFlag:function(e){return this.getColumnOptionValue(e,"sortableFlag")},getColumnFindableFlag:function(e){return this.getColumnOptionValue(e,"findableFlag")},getColumnPrintableFlag:function(e){return this.getColumnOptionValue(e,"printableFlag")},getColumnMassUpdateAllowedFlag:function(e){return this.getColumnOptionValue(e,"massUpdateAllowedFlag")},getColumnCompareFunction:function(e){return this.getColumnOptionValue(e,"compareFunction")},getColumnIcon:function(e){return this.getColumnOptionValue(e,"icon")},getColumnWidth:function(e){return this.getColumnOptionValue(e,"width")},setColumnWidth:function(e,t,i){if(isNaN(t)&&"auto"!==t)console.log("The width given for column "+e+" is not a Number");else{var n=this.getColumnIndex(e),o=this.getLeafColumns(),l=this.getColumnMinWidth(n);if(l&&"number"==typeof t&&(t=Math.max(t,l)),o[n].width!==t){o[n].width=t,"number"==typeof t?this._setColumnComputedWidth(n,t):this._computeColumnsWidth();var r=this.getColumnPinned(n);"left"!==r&&"right"!==r||this.collectionView._updateViewportDimensions(),i&&!i.isUserInteraction&&(this.getColumnAutoRowHeightFlag(n)||this.hasAutoWidthColumnWithAutoRowHeightFlag())?this.resetRowHeights():this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),e===this._lastLeftPinnedColumnIndex&&this.collectionView.elements.leftScroller?this.collectionView.elements.leftScroller.setPosition({x:this.getLeftContainerWidth()},!0):e===this._firstRightPinnedColumnIndex&&this.collectionView.elements.rightScroller&&this.collectionView.elements.rightScroller.setPosition({x:0},!0),"left"!==r&&"right"!==r&&this._updateAutoWidthStyle(),this.collectionView.fire("columnWidthChange",{columnID:e})}i&&i.isUserInteraction&&this._saveColumnWidthInPreferences(n)}},setColumnOrGroupWidth:function(e,t){if(!e.children||0===e.children.length){var i=this.getColumnOrGroupCellCoordinates(e);return this.setColumnWidth(i.columnID,t)}for(var n=0,o=[],l=0;l<e.children.length;l++)this._isColumnOrGroupResizable(e.children[l],t)?(n++,o.push(1)):o.push(0);if(0!==n)for(var r=(t-this.getColumnOrGroupComputedWidth(e))/n,s=0;s<o.length;s++)1===o[s]&&this.setColumnOrGroupWidth(e.children[s],this.getColumnOrGroupComputedWidth(e.children[s])+r)},_isColumnOrGroupResizable:function(e,t){if(e.children){for(var i=0;i<e.children.length;i++){var n=e.children[i];if(this._isColumnOrGroupResizable(n,t))return!0}return!1}var o=this.getColumnMinWidth(e.dataIndex);return o&&"string"==typeof o&&(o=parseFloat(o,10)),!1!==e.resizableFlag&&(!o||o<=t)},setColumnsWidth:function(e,t){for(var i=this.getLeafColumns(),n=Object.keys(e),o=[],l=!1,r=!1,s=0;s<n.length;s++){var a=n[s],d=e[a];if(isNaN(d)&&"auto"!==d)return void console.log("The width given for column "+columnID+" is not a Number");var u=this.getColumnIndex(a),h=this.getColumnMinWidth(u);if(h&&"number"==typeof d&&(d=Math.max(d,h)),i[u].width!==d){if(i[u].width=d,"number"==typeof d?this._setColumnComputedWidth(u,d):this._computeColumnsWidth(),!l){var c=this.getColumnPinned(u);"left"!==c&&"right"!==c||(l=!0)}r||!t||t.isUserInteraction||!this.getColumnAutoRowHeightFlag(u)&&!this.hasAutoWidthColumnWithAutoRowHeightFlag()||(r=!0),t&&t.isUserInteraction&&this._saveColumnWidthInPreferences(u),o.push(a)}}l&&this.collectionView._updateViewportDimensions(),this._updateAutoWidthStyle(),r?this.resetRowHeights():this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1}),this.collectionView.fire("columnWidthChange",{columnIDs:o})},_updateAutoWidthStyle:function(){this.hasAutoWidthColumn()?this.collectionView.getContent().setAttribute("has-auto-width-column",""):this.collectionView.getContent().removeAttribute("has-auto-width-column")},_setColumnComputedWidth:function(e,t){this._computedColumns[e]||(this._computedColumns[e]={}),this._computedColumns[e].width=t},getColumnComputedWidth:function(e){var t=this.getColumnIndex(e);if(-1===t)return this.rowsHeader?this.getRowHeaderWidth():0;var i=this._computedColumns[t]?this._computedColumns[t].width:0;return void 0===i||isNaN(i)?0:i},getColumnOrGroupComputedWidth:function(e){var t=0;if(e)if(e.children)for(var i=0;i<e.children.length;i++){var n=e.children[i];t+=this.getColumnOrGroupComputedWidth(n)}else t=this.getColumnComputedWidth(e.dataIndex);return t},getColumnMinWidth:function(e){return this.getColumnOptionValue(e,"minWidth")},getColumnPinned:function(e){return this.getColumnOptionValue(e,"pinned")},setColumnPinned:function(e,t,i){var n=this.getColumnIndex(e);this.setColumnOrGroupPinned(this._leafColumns[n],t,i)},setColumnOrGroupPinned:function(e,t,n){if(e&&this._isGroupInBalancedTree(e)){var o=this.getFirstLeafColumnIndex(e),l=this.getDataIndexFromColumnIndex(o);"right"!==t&&"left"!==t&&(t="unpinned");var r=this.getLeafColumns(),s=i.getLeafItems(e);if(r[o].pinned!==t){var a=this._getTopNonSplittableGroup(e);if(a)return this.setColumnOrGroupPinned(a,t,n);var d=o,u=this._getNumberOfColumnsToTheLeft();if("unpinned"===t){var h=this._getUnpinnedColumnsOrderInPreferences();if(h&&"number"==typeof h[l]){var c=h[l]+u[t];"left"===r[o].pinned&&(c-=1),d=this._orderedColumnsIndexes[c]}else{var g=this._orderedColumnsIndexes[this._originalOrderedColumnsReverseIndexes[o]],m=this.getColumnPinned(g);if("unpinned"===m)d=g;else{var p=this._getFirstOrLastUnpinnedColumnIndex(m);m===r[o].pinned&&"left"===m?p-=1:m===r[o].pinned&&"right"===m&&(p+=1),d=this._orderedColumnsIndexes[p]}}}else{p=this._getFirstOrLastUnpinnedColumnIndex(t);d=this._orderedColumnsIndexes[p]}for(var f=0;f<s.length;f++)s[f].pinned=t;i.splitParentAtItemIndex(s[0],this._balancedColumnTree,"before"),i.splitParentAtItemIndex(s[s.length-1],this._balancedColumnTree,"after"),this.moveColumnOrGroup(e,d,n),n&&!1===n.mergeGroups||this._updateColumnTreeFromOrderedIndexes(),this._updateAutoWidthStyle(),this.collectionView._updateViewportDimensions(),this.invalidate({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0})}if(n&&n.isUserInteraction){for(f=0;f<s.length;f++){var C=this.getColumnIndex(s[f].dataIndex);this._saveColumnPinnedStateInPreferences(C),this._saveColumnOrderInPreferences(C)}this._updateAllOrderInPreferences()}}else console.warn("setColumnOrGroupPinned has been called on a column or Group that does not exist in the DataGridView")},getColumnOrGroupPinned:function(e){var t;if(e)if(e.children){t=this.getColumnOrGroupPinned(e.children[0]);for(var i=1;i<e.children.length;i++)if(t!==this.getColumnOrGroupPinned(e.children[i]))return}else t=this.getColumnPinned(this.getColumnIndex(e.dataIndex));return t},getColumnAutoSizePadding:function(e){return this.getColumnOptionValue(e,"autoSizePadding")},getColumnAllowUnsafeHTMLContent:function(e){return this.getColumnOptionValue(e,"allowUnsafeHTMLContent")},getColumnShouldCellAllowUnsafeHTMLContentAt:function(e){return this.getColumnOptionValue(e,"shouldCellAllowUnsafeHTMLContentAt")},getColumnTypeRepresentation:function(e){return this.getColumnOptionValue(e,"typeRepresentation")},getColumnGetCellTypeRepresentation:function(e){return this.getColumnOptionValue(e,"getCellTypeRepresentation")},_getCellTypeRepresentation:function(e){if(e){if(e.nodeModel&&e.nodeModel.getNodeSource()===l.NODE_SOURCE.GROUPING)if("tree"===this.getDataIndexFromColumnIndex(e.columnID))return"string";var t=this.getColumnGetCellTypeRepresentation(e.columnID);return t?t.call(this.collectionView,e):void 0}},setColumnTypeRepresentation:function(e,t){var i=this.getColumnIndex(e),n=this.getLeafColumns();n[i].typeRepresentation!==t&&(n[i].typeRepresentation=t,this.getColumnAutoRowHeightFlag(e)&&this.collectionView._resetRowHeightsOnAllCellsRendered(),this.collectionView.updateColumnView(i,{updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}))},getColumnOnCellRequest:function(e){return this.getColumnOptionValue(e,"onCellRequest")},getColumnGetCellEditableState:function(e){return this.getColumnOptionValue(e,"getCellEditableState")},getColumnGetCellSelectableState:function(e){return this.getColumnOptionValue(e,"getCellSelectableState")},getColumnGetCellActivableState:function(e){return this.getColumnOptionValue(e,"getCellActivableState")},getColumnGetCellGroupingKey:function(e){return this.getColumnOptionValue(e,"getCellGroupingKey")},getColumnHasCellValue:function(e){return this.getColumnOptionValue(e,"hasCellValue")},getColumnGetCellValue:function(e){return this.getColumnOptionValue(e,"getCellValue")},getColumnSetCellValue:function(e){return this.getColumnOptionValue(e,"setCellValue")},getColumnGetCellTooltip:function(e){return this.getColumnOptionValue(e,"getCellTooltip")},getColumnGetCellIcons:function(e){return this.getColumnOptionValue(e,"getCellIcons")},getColumnGetCellSemantics:function(e){return this.getColumnOptionValue(e,"getCellSemantics")},getColumnSemantics:function(e){return this.getColumnOptionValue(e,"semantics")},getColumnGetCellKPIColor:function(e){return this.getColumnOptionValue(e,"getCellKPIColor")},getColumnClassName:function(e){return this.getColumnOptionValue(e,"className")},getColumnGetCellClassName:function(e){return this.getColumnOptionValue(e,"getCellClassName")},getColumnGetCellAttributes:function(e){return this.getColumnOptionValue(e,"getCellAttributes")},_getFirstVisibleColumnID:function(){for(var e=0;e<this._orderedColumnsIndexes.length;){if(this.getColumnVisibleState(this._orderedColumnsIndexes[e]))return this._orderedColumnsIndexes[e];e+=1}return-1},_getLastVisibleColumnID:function(){for(var e=this._orderedColumnsIndexes.length-1;e>=0;){if(this.getColumnVisibleState(this._orderedColumnsIndexes[e]))return this._orderedColumnsIndexes[e];e-=1}return-1},_getFirstOrLastUnpinnedColumnIndex:function(e){if("right"===e)for(var t=this._orderedColumnsIndexes.length-1,i=t;i>=0;i--){if("right"!==(o=this.getColumnPinned(this._orderedColumnsIndexes[i])))return"left"===o?-1:t;t--}else if("left"===e){var n=0;for(i=0;i<this._orderedColumnsIndexes.length;i++){var o;if("left"!==(o=this.getColumnPinned(this._orderedColumnsIndexes[i])))return"right"===o?-1:n;n++}}return-1},_getNumberOfColumnsToTheLeft:function(){return{left:0,unpinned:this._getFirstOrLastUnpinnedColumnIndex("left"),right:this._getFirstOrLastUnpinnedColumnIndex("right")+1}},_getNumberOfColumnsToTheLeftFromChanges:function(e){if(e){for(var t=0,i=0,n=e.columnsPinnedState,o=this.getLeafColumns(),l=0;l<o.length;l++){var r,s=o[l].dataIndex;"left"===(r=n&&n.hasOwnProperty(s)?n[s]:this._getOriginalColumnOptionValue(s,"pinned"))?i++:"right"===r?0:t++}return{left:0,unpinned:i,right:i+t}}},getVisibleOrderedColumnsIndexes:function(){for(var e=[],t=0;t<this._orderedColumnsIndexes.length;t++)this.getColumnVisibleState(this._orderedColumnsIndexes[t])&&e.push(this._orderedColumnsIndexes[t]);return e},getDisplayedColumnsIndexes:function(){for(var e=-1,t=-1,i=this.collectionView.getViewportDimensions(),n=this.collectionView.getScrollerPosition(),o=n.x,l=n.x+i.width,r=this.getVisibleOrderedColumnsIndexes(),s=0;s<r.length;s++){var a=r[s],d=this.getColumnPinned(a);if("left"!==d&&"right"!==d){var u=this.getColumnPosition(a);if(u<=o&&(e=a),!(u<l))break;t=a}}var h=[];if(e>=0&&t>=0)for(var c=!0,g=e;g>=0&&c;){if(h.push(g),g===t){c=!1;break}g=this._getNextVisibleColumnID(g)}return this._getListOfVisiblePinnedColumnIDs("left").concat(h).concat(this._getListOfVisiblePinnedColumnIDs("right"))},_getNumberOfInvisibleColumnsBetween:function(e,t){for(var i=Math.min(e,t),n=Math.max(e,t),o=0,l=i+1;l<n;l++)this.getColumnVisibleState(this._orderedColumnsIndexes[l])||o++;return o},_getPreviousVisibleColumnID:function(e){if(-1===e)return-1;var t=this._orderedColumnsReverseIndexes[e];if(void 0===t||0===t)return-1;for(var i=t-1;i>=0;){if(this.getColumnVisibleState(this._orderedColumnsIndexes[i]))return this._orderedColumnsIndexes[i];i-=1}return-1},_getPreviousVisibleGroupOrColumnID:function(e,t){if(e>=-1)return this._getPreviousVisibleColumnID(t);for(var i=this.getColumnOrGroupFromCoordinates({rowID:e,columnID:t}),n=0;n<this._columnItemsByDepth.length;n++)for(var o,l=this._columnItemsByDepth[n],r=0;r<l.length;r++){if(l[r]===i)return o?this.getColumnOrGroupCellCoordinates(o).columnID:void 0;o=l[r]}},_getNextVisibleColumnID:function(e){var t=this.getColumnIndex(e);if(-1===t)return-1;var i=this._orderedColumnsReverseIndexes[t];if(void 0===i||i===this._orderedColumnsIndexes.length-1)return-1;for(var n=i+1;n<this._orderedColumnsIndexes.length;){if(this.getColumnVisibleState(this._orderedColumnsIndexes[n]))return this._orderedColumnsIndexes[n];n+=1}return-1},_getNextVisibleGroupOrColumnID:function(e,t){if(e>=-1)return this._getNextVisibleColumnID(t);for(var i=this.getColumnOrGroupFromCoordinates({rowID:e,columnID:t}),n=0;n<this._columnItemsByDepth.length;n++)for(var o,l=this._columnItemsByDepth[n],r=l.length-1;r>=0;r--){if(l[r]===i)return o?this.getColumnOrGroupCellCoordinates(o).columnID:void 0;o=l[r]}},_getListOfVisiblePinnedColumnIDs:function(e){for(var t=[],i="left"===e?this._getFirstVisibleColumnID():this._getLastVisibleColumnID(),n="left"===e?this._getNextVisibleColumnID:this._getPreviousVisibleColumnID;i>=0;){if(this.getColumnPinned(i)!==e)return t;t.push(i),i=n.call(this,i)}return t},_getLeafColumnsCount:function(e){if(e){if(e.children){for(var t=0,i=0;i<e.children.length;i++)t+=this._getLeafColumnsCount(e.children[i]);return t}return 1}return this._leafColumnsCount},_getColumnTreeItemCount:function(){return this._columnTreeItemCount},_getColumnHeaderCellCount:function(){return this._columnHeaderCellCount},getRowHeaderWidth:function(){var e=this.collectionView._getCurrentTouchMode(),t=this._cachedRowHeaderStringWidth?this._cachedRowHeaderStringWidth:10,i=this.collectionView.showSelectionCheckBoxesFlag;if(this.collectionView.showRowIndexFlag){if(this.isValid()&&this.collectionView.getModelLength()>0){var n=this.getMinMaxVisibleRowIDs();if(n){var l=this.collectionView.getCellInfosAt(this.getCellIDFromCoordinates({rowID:n.maxRowID,columnID:-1}));if(l){var r=12;e&&(r=14);var s=5;e&&(s=10),t=s+Math.ceil(o.computeStringWidth(l.cellModel,r,"Arial",!1,!1))+s}}this._cachedRowHeaderStringWidth=t}i&&(e||"OnOver"!==i)&&(t+=18)}else i&&(t=e?40:30);if(this.collectionView.showNodeKPIColorFlag&&(t+=6),this.collectionView.rowDragEnabledFlag&&(t+=e?16:12),i){var a=this.collectionView.rowDragEnabledFlag?34:24;t=Math.max(t,a)}return t},_getXSORectangularShape:function(){var e=this.collectionView.getCellsXSO();if(!e.isEmpty()){for(var t,i,n,o,l,r,s=e.get(),a=0;a<s.length;a++){var d=s[a];if(d){var u={rowID:d.rowID,columnID:this.getColumnIndex(d.columnDataIndex)};if(void 0===t)o=this._orderedColumnsReverseIndexes[u.columnID],i=this._orderedColumnsReverseIndexes[u.columnID],l=u.columnID,r=u.columnID,n=u.rowID,t=u.rowID;else{var h=this._orderedColumnsReverseIndexes[u.columnID];h>o&&(o=h,l=u.columnID),h<i&&(i=h,r=u.columnID),u.rowID>n&&(n=u.rowID),u.rowID<t&&(t=u.rowID)}}}return(o+1-i-this._getNumberOfInvisibleColumnsBetween(r,l))*(n+1-t)===s.length?{minColumnID:r,width:o-i+1-this._getNumberOfInvisibleColumnsBetween(r,l),minRowID:t,height:n-t+1}:void 0}},getDataIndexFromColumnIndex:function(e){var t=this.getLeafColumns();return e>=0&&e<t.length?t[e].dataIndex:"rowHeader"},getColumnIndex:function(e){if(null!=e){var t=-1;if("string"==typeof e){this._columnsReverseIndexes||this._computeColumnsReverseIndexes();t=this._columnsReverseIndexes[e]}else t=e;return t}},getColumnIdentifiers:function(e){var t,i;return"string"==typeof e?(i=e,t=this.getColumnIndex(e)):"object"==typeof e?(i=e.dataIndex?e.dataIndex:this.getDataIndexFromColumnIndex(e.columnIndex),t=e.columnIndex?e.columnIndex:this.getColumnIndex(e.dataIndex)):(t=e,i=this.getDataIndexFromColumnIndex(e)),{dataIndex:i,columnIndex:t}},getRowHeightFromCellHeight:function(){var e=this.getDefaultCellHeight();return Math.max(this.cellHeight,e)},getRowHeightFromCellContents:function(e){var t=this.getRowHeightFromCellHeight();if(this._autoRowHeightColumnIndexes)for(var i=0;i<this._autoRowHeightColumnIndexes.length;i++){var n=this._autoRowHeightColumnIndexes[i];if(this.getColumnVisibleState(n)){var o=this.getCellIDFromCoordinates({rowID:e,columnID:n}),l=!1,r=this.collectionView._getRenderedCellAt(o);if(r||(r=this.collectionView._renderCell(o,{updateCellContent:!1,updateCellLayout:"ignore",updateCellAttributes:!1}),l=!0),r&&r.component){var s=r.component.getReusableContent();if(s){var a=r.component.getContent().style,d=this.getColumnComputedWidth(n);a.width=d+"px";var u=a.lineHeight,h=a.display;a.lineHeight="",a.display="block";var c,g=r.component.getContent().offsetHeight;(c=s.getContent?s.getContent().offsetHeight:s.offsetHeight)!==g&&(c+=2),t<c&&(t=c),a.display=h,a.lineHeight=u}else{var m=this.collectionView.getCellInfosAt(o);this.collectionView.hasCellValue(m)&&this.collectionView._resetRowHeightsOnAllCellsRendered()}l&&this.collectionView._freeUpCell(o,1)}}}return t},getRowSpacing:function(){return this.rowSpacing},getDefaultRowHeight:function(){return this.getRowHeightFromCellHeight()},getRowPosition:function(e){if(e<0){var t=this.getColumnHeaderHeight();return(e+this._getColumnTreeDepth())*t}return this._parent(e)},_getEstimatedVirtualHeight:function(e){var t=0,i=this.collectionView.getModelLength();if(0===i)return t=1;var n=this.rowSpacing;if(this._useVariableRowHeight&&(!e||!this._autoRowHeightColumnIndexes||0===this._autoRowHeightColumnIndexes.length||this._computedRows[i-1]&&void 0!==this._computedRows[i-1].top)){for(var o=-1,l=this._computedRows.length-1;l>=0;l--)if(void 0!==this._computedRows[l].top&&void 0!==this._computedRows[l].height){o=l;break}var r=0,s=0;o>=0?(r=this._computedRows[o].top+this._computedRows[o].height+(this.collectionView.showRowBorderFlag?1:0),s=parseInt(r/(o+1))):s=this.getRowHeight()+n,t=r+(i-(o+1)==0?0:(i-(o+1))*s-n)}else{var a=this._getNumberOfItems();t=a*this.getRowHeight()+(a-1)*n}return t},_getNumberOfItems:function(){return this.collectionView.paginationManager?this.collectionView.paginationManager.getNumberOfItemsOnPage():this.collectionView.getRowModelLength()},getCellCoordinatesAt:function(e){var t=-1,i=-1,n=this.rowsHeader,o=(this.columnsHeader,this._getFirstCellIDInScroller());if(e<o)if(e<0)t=-this._columnItemsByDepth.length-1,i=-4-(n?1:0);else{t=-this._columnItemsByDepth.length;var l=3+(n?1:0);if(e<l)i=e-l;else for(var r=0,s=0;s<this._columnItemsByDepth.length;s++){var a=this._columnItemsByDepth[s];if(e<r+a.length+l){i=e-r-l;break}t++,r+=a.length}}else{var d=this._getNumberOfColumns();t=Math.floor((e-o)/d),i=(e-o)%d-3-(n?1:0)}return{rowID:t,columnID:i}},getCellIDFromCoordinates:function(e){var i=-1,n=this.rowsHeader;if(e.columnID=this.getColumnIndex(e.columnID),!t.isUndefinedNullNaN(e.columnID)&&!t.isUndefinedNullNaN(e.rowID)){if(e.rowID<0)if(e.columnID<0)i=e.rowID<-this._columnItemsByDepth.length?-1:e.columnID+3+(n?1:0);else{for(var o=3+(n?1:0),l=0,r=0;r<=this._columnItemsByDepth.length+e.rowID;r++){var s=this._columnItemsByDepth[r];r<this._columnItemsByDepth.length+e.rowID?l+=s.length:l+=e.columnID}i=o+l}else{var a=this._getNumberOfColumns();i=this._getFirstCellIDInScroller()+a*e.rowID+e.columnID+3+(n?1:0)}return i<-1&&(i=-1),i}},getColumnOrGroupFromCoordinates:function(e){var t=null;if(-1===e.rowID)t=this._leafColumns[e.columnID];else{var i=this._columnItemsByDepth[this._columnItemsByDepth.length+e.rowID];i&&(t=i[e.columnID])}return t},getColumnOrGroupCellCoordinates:function(e){var t=-1,n=-1;if(e&&this._balancedColumnTree){var o=i.computeFirstBranchDepth(e);if(o>1){var l=this._getColumnTreeDepth(),r=this._columnItemsByDepth[l-o];if(r)for(var s=0;s<r.length;s++)if(r[s]===e){t=-o,n=s;break}}else t=-1,n=this.getColumnIndex(e.dataIndex)}return{rowID:t,columnID:n}},getFirstLeafColumnIndex:function(e,t){var i=-1;if(e)if(e.children){var n=null;if(t)for(var o=0;o<e.children.length;o++){var l=e.children[o];if(l&&this.getColumnOrGroupVisibleState(l)){n=l;break}}else n=e.children[0];n&&(i=this.getFirstLeafColumnIndex(n,t))}else i=this.getColumnIndex(e.dataIndex);return i},getLastLeafColumnIndex:function(e,t){var i=-1;if(e)if(e.children){var n=null;if(t)for(var o=e.children.length-1;o>=0;o--){var l=e.children[o];if(l&&this.getColumnOrGroupVisibleState(l)){n=l;break}}else n=e.children[e.children.length-1];n&&(i=this.getLastLeafColumnIndex(n,t))}else i=this.getColumnIndex(e.dataIndex);return i},isRow:function(e){var t=this.getCellCoordinatesAt(e);return t.columnID===this._leftPinnedRowColumnID||t.columnID===this._unpinnedRowColumnID||t.columnID===this._rightPinnedRowColumnID},getContentDimensions:function(){for(var e=this._getEstimatedVirtualHeight(),t=0,i=this.getLeafColumns(),n=0;n<i.length;n++){var o=this.getColumnPinned(n);if("left"!==o&&"right"!==o)this.getColumnVisibleState(n)&&(t+=this.getColumnComputedWidth(n))}return{width:t,height:e}},getLayoutStylesForCellAt:function(e){var t={},i=this.getCellCoordinatesAt(e),n=i.columnID===this._leftPinnedRowColumnID||i.columnID===this._unpinnedRowColumnID||i.columnID===this._rightPinnedRowColumnID,o=this.collectionView.showRowBorderFlag?1:0,l=this.getDefaultCellHeight();if(n){var r=this.getRowHeight(i.rowID);r!==l+o&&(t.height=r+"px");var s=this.getRowPosition(i.rowID);t.transform="translateY("+s+"px)"}else{var a=0;if(i.columnID>-1){var d=this.getColumnOrGroupFromCoordinates(i);a=d?this.getColumnOrGroupPosition(d):this.getColumnPosition(i.columnID)}var u=this.getDimensionsForCellAt(e);t.width=u.width+"px";var h=-1===i.columnID?l+o:l;if(u.height!==h){var c=u.height+"px";t.height=c;var g=u.height-2;i.rowID<=-1&&(g+=1),t.lineHeight=g+"px"}if(i.columnID>=0&&i.rowID>=0)t.left=a+"px";else{s=this.getRowPosition(i.rowID);t.transform="translate3d("+a+"px,"+s+"px,0)"}}return t},getLayoutAttributesForCellAt:function(e){var t,i=this.getCellCoordinatesAt(e),n=this.getColumnOrGroupFromCoordinates(i),o=i.columnID===this._leftPinnedRowColumnID||i.columnID===this._unpinnedRowColumnID||i.columnID===this._rightPinnedRowColumnID,l={"cell-id":e},r=!1;if(this.addCellCoordinates?r=!0:window.__karma__&&window.__karma__.config&&window.__karma__.config.json?r=window.__karma__.config.json.ADD_CELL_COORDINATES:!window.__karma__&&navigator.webdriver&&(r=!0),r&&(l["row-id"]=i.rowID,l["column-id"]=i.columnID),this.rowsHeader&&-1===i.columnID&&(l["row-header"]=""),!o){if(i.rowID<=-1){l["column-header"]="";var s=n?this.getFirstLeafColumnIndex(n,!0):i.columnID;s!==this._firstUnpinnedColumnIndex&&s!==this._firstLeftPinnedColumnIndex&&s!==this._firstRightPinnedColumnIndex||(l["first-column"]="")}if(i.rowID<=-1||this.collectionView.showColumnBorderFlag){var a=n?this.getLastLeafColumnIndex(n,!0):i.columnID;a!==this._lastUnpinnedColumnIndex&&a!==this._lastLeftPinnedColumnIndex&&a!==this._lastRightPinnedColumnIndex||(l["last-column"]="")}this.getColumnAutoRowHeightFlag(i.columnID)&&(l["auto-height"]="")}return"left"!==(t=i.columnID===this._leftPinnedRowColumnID?"left":i.columnID===this._rightPinnedRowColumnID?"right":-1===i.columnID?"left":n?this.getColumnOrGroupPinned(n):this.getColumnPinned(i.columnID))&&"right"!==t||(l.pinned=t),o&&(i.rowID%2==0?l["even-row"]="":l["odd-row"]=""),l},_getFirstCellIDInScroller:function(){return this.columnsHeader?this._getColumnHeaderCellCount():0},_getNumberOfColumns:function(){return this._getLeafColumnsCount()+3},_getLastCellIDInScroller:function(){return this._getNumberOfItems()*this._getNumberOfColumns()-1},renderListOfVisibleCellsInViewport:function(e){if(e&&e.render){var i=this.collectionView;if(i&&i.elements&&i.elements.container){var n,l=!1;e.allottedTime>0&&(n=window.performance?performance.now():Date.now());var r=this.getMinMaxVisibleCellIDs(),s=this.getCellCoordinatesAt(r.minCellID),a=this.getCellCoordinatesAt(r.maxCellID),d=this.columnsHeader,u=this.rowsHeader,h=this._getFirstCellIDInScroller();0,i._listOfRenderedCells.forEach(function(e,t){if(t<r.minCellID&&t>=h||t>r.maxCellID){var n=e&&e.component?e.component.getCleaningMode():1;if(i._freeUpCell(t,n),e&&e.component&&e.component.isRow()){var l=e.component;o.empty(l.getContent())}}});for(var c=void 0!==this._firstLeftPinnedColumnIndex,g=void 0!==this._firstRightPinnedColumnIndex,m=s.rowID,p=a.rowID,f=m;f<=p;f++){if(c){var C=this.getCellIDFromCoordinates({rowID:f,columnID:this._leftPinnedRowColumnID});e.render(C,{cellType:f%2==0?"__left_even_row__":"__left_odd_row__"})}if(g){C=this.getCellIDFromCoordinates({rowID:f,columnID:this._rightPinnedRowColumnID});e.render(C,{cellType:f%2==0?"__right_even_row__":"__right_odd_row__"})}C=this.getCellIDFromCoordinates({rowID:f,columnID:this._unpinnedRowColumnID});e.render(C,{cellType:f%2==0?"__even_row__":"__odd_row__"})}if(d){u&&e.render(3,{cellType:"__topleft_row_header__"});var _=3+(this.rowsHeader?1:0),w=this.collectionView.getViewportDimensions(),v=this.collectionView.getScrollerPosition(),D=v.x,I=v.x+w.width;for(f=0;f<this._columnItemsByDepth.length;f++)for(var V=this._columnItemsByDepth[f],y=0;y<V.length;y++){var b;if(b=f===this._columnItemsByDepth.length-1?this._leafColumns[y]:V[y],this.getColumnOrGroupVisibleState(b)){var M=!1;if((c||g)&&("left"!==(q=this.getColumnOrGroupPinned(b))&&"right"!==q||(M=!0)),!M){var x=this.getColumnOrGroupPosition(b);x+this.getColumnOrGroupComputedWidth(b)>=D&&x<I&&(M=!0)}if(M)H="left"===q?"__topleft_item__":"right"===q?"__topright_item__":"__top_item__",e.render(_,{cellType:H})}_++}}if(u){for(var F=[],S=m;S<=p;S++){_=this.getCellIDFromCoordinates({rowID:S,columnID:-1});(z=e.render(_,{cellType:"__row_header__"}))&&z.component&&!z.component.getContent().parentNode&&F.push(z.component.getContent())}F.length>0&&t.appendToParent(i.elements.rowHeaderExtensionPoolContainer,F)}var R=this.getDisplayedColumnsIndexes(),O=[],A=[],P=[],G=[],N=[],T=[];for(S=m;S<=p;S++){var E,L,U=i._getViewAt(this.getCellIDFromCoordinates({rowID:S,columnID:this._unpinnedRowColumnID}));if(c&&(E=i._getViewAt(this.getCellIDFromCoordinates({rowID:S,columnID:this._leftPinnedRowColumnID}))),g&&(L=i._getViewAt(this.getCellIDFromCoordinates({rowID:S,columnID:this._rightPinnedRowColumnID}))),!e.lightRendering&&!l){if(e.allottedTime>0)(window.performance?performance.now():Date.now())-n>e.allottedTime&&(l=!0);if(!l){U&&(U.getContent().hasChildNodes()||U.getContent().remove()),E&&(E.getContent().hasChildNodes()||E.getContent().remove()),L&&(L.getContent().hasChildNodes()||L.getContent().remove());for(var B=0;B<R.length;B++){var k=R[B];if(k>-1){_=this.getCellIDFromCoordinates({rowID:S,columnID:k});var H,W,j,q=this.getColumnPinned(k);H="tree"===this.getDataIndexFromColumnIndex(k)?"__tree_item__":"__item__","left"===q?(W=E,j=N):"right"===q?(W=L,j=T):(W=U,j=G);var X=W&&"function"==typeof W.getCellPool?W.getCellPool():void 0,z=e.render(_,{cellType:H,cellPool:X});j&&z&&z.component&&z.component.getContent().parentNode!==W.getContent()&&j.push(z.component.getContent())}}U&&G.length>0&&(t.appendToParent(U.getContent(),G),G=[]),E&&N.length>0&&(t.appendToParent(E.getContent(),N),N=[]),L&&T.length>0&&(t.appendToParent(L.getContent(),T),T=[])}}O&&U&&!U.getContent().parentNode&&O.push(U.getContent()),A&&E&&!E.getContent().parentNode&&A.push(E.getContent()),P&&L&&!L.getContent().parentNode&&P.push(L.getContent())}return O.length>0&&t.appendToParent(i.elements.poolContainer,O),A.length>0&&t.appendToParent(i.elements.leftPoolContainer,A),P.length>0&&t.appendToParent(i.elements.rightPoolContainer,P),{taskInterrupted:l}}}},getCellType:function(e){var t,i=this.getCellCoordinatesAt(e);if(i.columnID>-1){var n=this.getColumnOrGroupFromCoordinates(i);t=n?this.getColumnOrGroupPinned(n):this.getColumnPinned(i.columnID)}var o=i.rowID%2==0;if(i.rowID<=-1)return-1===i.columnID?"__topleft_row_header__":"left"===t?"__topleft_item__":"right"===t?"__topright_item__":"__top_item__";if(i.columnID===this._leftPinnedRowColumnID)return o?"__left_even_row__":"__left_odd_row__";if(i.columnID===this._unpinnedRowColumnID)return o?"__even_row__":"__odd_row__";if(i.columnID===this._rightPinnedRowColumnID)return o?"__right_even_row__":"__right_odd_row__";if(-1===i.columnID)return"__row_header__";var l=this.getLeafColumns();return l[i.columnID]&&"tree"===l[i.columnID].dataIndex?"left"===t?"__left_tree_item__":"right"===t?"__right_tree_item__":"__tree_item__":"left"===t?"__left_item__":"right"===t?"__right_item__":"__item__"},getColumnHeaderHeight:function(){var e=this.collectionView._getCurrentTouchMode()?40:26;return Math.max(this.columnHeaderHeight,e+1)},getHeaderContainerHeight:function(){var e=this._getColumnTreeDepth(),t=this.getColumnHeaderHeight();return this.columnsHeader?t*e:0},getLeftContainerWidth:function(){for(var e=0,t=this.getLeafColumns(),i=0;i<t.length;i++){if("left"===this.getColumnPinned(i))this.getColumnVisibleState(i)&&(e+=this.getColumnComputedWidth(i))}return e},getRightContainerWidth:function(){for(var e=0,t=this.getLeafColumns(),i=0;i<t.length;i++){if("right"===this.getColumnPinned(i))this.getColumnVisibleState(i)&&(e+=this.getColumnComputedWidth(i))}return e},computeCenterContainerSideMargin:function(e,t,i){var n;if("left"===e){var o=this.rowsHeader?this.getRowHeaderWidth():0;n=(l=t+o)>i+o?i+o:l}else if("right"===e){var l;n=(l=t)>i?i:l}return n},computeSideContainerMaxWidth:function(e,t,i,n){var o=this.rowsHeader?this.getRowHeaderWidth():0;return this._parent(e,t-o,i,n)},computeCenterContainerMinWidth:function(e,t,i){var n=this.rowsHeader?this.getRowHeaderWidth():0;return this._parent(e,t,i-n)},computeSideContainerWidth:function(e,t,i){var n=0;if("left"===e){const e=i||1;n=t+(t?e:0)}else"right"===e&&(n=this._parent(e,t,i));return n},getPositionForCellAt:function(e){var t={top:0,left:0},i=this.getCellCoordinatesAt(e);if(t.top=this.getRowPosition(i.rowID),i.columnID>-1){var n=this.getColumnOrGroupFromCoordinates(i);t.left=n?this.getColumnOrGroupPosition(n):this.getColumnPosition(i.columnID)}return t},getCellIDFromPositionInView:function(e){var t=-1;if(e){var i=this.getHeaderContainerHeight();if(e.top>=i){var n=this._getRowIDFromPosition(e.top-i);if(n<this.collectionView.getModelLength()){var o=this.collectionView.getViewportDimensions(),l=this.rowsHeader?this.getRowHeaderWidth():0,r=this.getLeftContainerWidth(),s=(this.getRightContainerWidth(),0),a="unpinned";e.left<=l+r?(a="left",s=l):e.left>=l+r+o.width?(a="right",s=l+r+o.width):s=l+r;var d=-1;if(e.left>=s)for(var u=0;u<this._orderedColumnsIndexes.length;u++){var h=this._orderedColumnsIndexes[u],c=this.getColumnVisibleState(h),g=this.getColumnPinned(h);if(c&&g===a&&(s+=this.getColumnComputedWidth(h),e.left<=s)){d=h;break}}n>=0&&d>=0&&(t=this.getCellIDFromCoordinates({rowID:n,columnID:d}))}}}return t},getDimensionsForCellAt:function(e){var t=this.getCellCoordinatesAt(e),i=t.columnID===this._leftPinnedRowColumnID||t.columnID===this._unpinnedRowColumnID||t.columnID===this._rightPinnedRowColumnID,n=0;if(t.columnID>=-1){var o=this.getColumnOrGroupFromCoordinates(t);n=o?this.getColumnOrGroupComputedWidth(o):this.getColumnComputedWidth(t.columnID)}else if(t.columnID===this._leftPinnedRowColumnID)n=this.collectionView._leftContainerWidth;else if(t.columnID===this._unpinnedRowColumnID){n=this.collectionView.getViewportDimensions().width}else t.columnID===this._rightPinnedRowColumnID&&(n=this.collectionView._rightContainerWidth);var l,r=this.getRowHeight(t.rowID);if(i)l=r;else if(t.rowID<=-1)l=-1===t.columnID?this.getHeaderContainerHeight():this.getColumnHeaderHeight();else if(-1===t.columnID)l=r;else{l=r-(this.collectionView.showRowBorderFlag?1:0)}return{width:n,height:l}},computeCellRange:function(e,t){var i=[],n=this.getCellCoordinatesAt(e),o=this.getCellCoordinatesAt(t);n.columnID<0&&(n.columnID=0),o.columnID<0&&(o.columnID=0);var l=this._orderedColumnsReverseIndexes[n.columnID],r=this._orderedColumnsReverseIndexes[o.columnID];if(void 0!==l&&void 0!==r){for(var s=Math.min(l,r),a=Math.max(l,r),d=Math.min(n.rowID,o.rowID),u=Math.max(n.rowID,o.rowID),h=d;h<=u;h++)for(var c=s;c<=a;c++){var g=this._orderedColumnsIndexes[c];if(this.getColumnVisibleState(g)){var m=this.getCellIDFromCoordinates({rowID:h,columnID:g});i.push(m)}}return i}},isCellInRange:function(e,t,i){var n=!1,o=this.getCellCoordinatesAt(e),l=this.getCellCoordinatesAt(t),r=this.getCellCoordinatesAt(i),s=Math.min(l.rowID,r.rowID),a=Math.max(l.rowID,r.rowID);if(o.rowID>=s&&o.rowID<=a){var d=this._compareColumnIDs(l.columnID,r.columnID)<0?l.columnID:r.columnID,u=d===l.columnID?r.columnID:l.columnID;this._compareColumnIDs(o.columnID,d)>=0&&this._compareColumnIDs(o.columnID,u)<=0&&(n=!0)}return n},isNodeModelInRange:function(e,t,i){var n=!1;if(e){var o=e._getRowID(),l=this.getCellCoordinatesAt(t),r=this.getCellCoordinatesAt(i),s=Math.min(l.rowID,r.rowID),a=Math.max(l.rowID,r.rowID);n=o>=s&&o<=a}return n},getCellsFromNodeModel:function(e,t){var i=[];if(e){var n=e._getRowID();if(t){var o=this.getVisibleOrderedColumnsIndexes();for(r=0;r<o.length;r++)i.push(this.getCellIDFromCoordinates({rowID:n,columnID:o[r]}))}else for(var l=this.getLeafColumns().length,r=0;r<l;r++)i.push(this.getCellIDFromCoordinates({rowID:n,columnID:r}))}return i},_compareColumnIDs:function(e,t){var i=this.getColumnPinned(e),n=this.getColumnPinned(t);if(i===n){var o=this.getColumnIdentifiers(e),l=this.getColumnIdentifiers(t);return o.columnIndex===l.columnIndex?0:o.columnIndex<l.columnIndex?-1:1}return"left"===i?-1:"right"===i?1:"left"===n?1:-1},_computeCellIDFromCell:function(e,t,i,n){var o=e,l=this.getCellCoordinatesAt(e);if(l.rowID>=0&&l.columnID>=0){var r=-1,s=-1;if("up"===t)r=l.rowID>0?l.rowID-1:l.rowID,s=l.columnID;else if("right"===t)r=l.rowID,s="row"===this.collectionView.cellActivationFeedback?this.getColumnIndex("tree"):this._getNextVisibleColumnID(l.columnID);else if("down"===t)r=l.rowID<this.collectionView.getModelLength()-1?l.rowID+1:l.rowID,s=l.columnID;else if("left"===t)r=l.rowID,s="row"===this.collectionView.cellActivationFeedback?this.getColumnIndex("tree"):this._getPreviousVisibleColumnID(l.columnID);else if("tab"===t){if(n?(r=l.rowID,(s=this._getPreviousVisibleColumnID(l.columnID))<0&&r>0&&(r--,s=this._getLastVisibleColumnID())):(r=l.rowID,(s=this._getNextVisibleColumnID(l.columnID))<0&&r<this.collectionView.getModelLength()-1&&(r++,s=this._getFirstVisibleColumnID())),this.collectionView.focusNextEditableCellOnTabFlag){var a=this.getCellIDFromCoordinates({rowID:r,columnID:s});if(!this.collectionView.getCellEditableState(a))for(;;){var d=a;if((a=this._computeCellIDFromCell(a,t,i,n))===d){r=-1,s=-1;break}if(this.collectionView.getCellEditableState(a)){var u=this.getCellCoordinatesAt(a);r=u.rowID,s=u.columnID;break}}}}else if("pageup"===t){this.collectionView.getViewportDimensions();var h=(c=this.getMinMaxVisibleRowIDs()).maxRowID-c.minRowID;r=Math.max(0,l.rowID-h),s=l.columnID}else if("pagedown"===t){var c;this.collectionView.getViewportDimensions(),h=(c=this.getMinMaxVisibleRowIDs()).maxRowID-c.minRowID;r=Math.min(this.collectionView.getModelLength()-1,l.rowID+h),s=l.columnID}else if("home"===t)if(r=i||"row"===this.collectionView.cellActivationFeedback?0:l.rowID,"row"===this.collectionView.cellActivationFeedback){const e=this._getRowFirstVisibleCellWithActivableState(r);s=this.getCellCoordinatesAt(e).columnID}else s=this._getFirstVisibleColumnID();else if("end"===t)if(r=i||"row"===this.collectionView.cellActivationFeedback?this.collectionView.getModelLength()-1:l.rowID,"row"===this.collectionView.cellActivationFeedback){const e=this._getRowFirstVisibleCellWithActivableState(r);s=this.getCellCoordinatesAt(e).columnID}else s=this._getLastVisibleColumnID();else"enter"===t&&(r=l.rowID,s=l.columnID,this.collectionView.selectNextCellOnEnterFlag&&(n?r>0&&r--:r<this.collectionView.getModelLength()-1&&r++));r>=0&&s>=0&&(o=this.getCellIDFromCoordinates({rowID:r,columnID:s}))}return o},_hasValidIdentifier:function(){if(""!==this.identifier){var e=Math.floor(Number(this.identifier));return e<0||String(e)!==this.identifier}return!1},_getDataFromPreferences:function(e){var i=void 0;return this._hasValidIdentifier()&&(i=t.getDataFromLocalPreferences(this.collectionView,this._dataGridViewPrefKey,e)),i},_saveDataInPreferences:function(e,i){this._hasValidIdentifier()&&(t.saveDataInLocalPreferences(this.collectionView,this._dataGridViewPrefKey,e,i),this.collectionView.fire("userPreferencesChange"))},_saveColumnOptionValueInPreferences:function(e,t,i){var n=this._getDataFromPreferences(i);n||(n={});var o=this.getColumnIdentifiers(e);n[o.dataIndex]=this.getColumnOptionValue(o.columnIndex,t),this._saveDataInPreferences(i,n)},_saveParentColumnGroupsExpandedStateInPreferences:function(e){e&&(void 0!==e.columnGroupShow&&this._saveColumnGroupExpandedStateInPreferences(e),this._saveColumnGroupExpandedStateInPreferences(e._parent))},_saveColumnGroupExpandedStateInPreferences:function(e){if(e){var t=e.expandedFlag;if(void 0!==t){var i=this._getColumnGroupIndexInItsRow(e);if(-1!==i){var n="columnGroupsExpandedStates",o=e.dataIndex+"_"+i,l=this._getDataFromPreferences(n);l||(l={}),l[o]=t?1:0,this._saveDataInPreferences(n,l)}}}},_updateColumnGroupExpandedStateInPreferences:function(e,t){for(var i="columnGroupsExpandedStates",n=0;n<e.numberOfDataIndexOccurences.length;n++)if(!(0===e.childrenCount&&0===t.childrenCount&&e.childrenCountInParent>1&&t.childrenCountInParent>1))if(e.numberOfDataIndexOccurences[n]<t.numberOfDataIndexOccurences[n]){(s=this._getDataFromPreferences(i))||(s={});for(var o=t.columnGroupDataIndexes[n],l=t.numberOfDataIndexOccurences[n]-1;l>=t.indexInParent[n];l--){if(void 0!==s[c=o+"_"+l.toString()]){var r=s[c];delete s[c],s[h=o+"_"+(l+1).toString()]=r,this._saveDataInPreferences(i,s)}}}else if(e.numberOfDataIndexOccurences[n]>t.numberOfDataIndexOccurences[n]){(s=this._getDataFromPreferences(i))||(s={});for(o=t.columnGroupDataIndexes[n],l=t.indexInParent[n];l<e.numberOfDataIndexOccurences[n];l++){if(void 0!==s[c=o+"_"+l.toString()]){r=s[c];delete s[c],s[h=o+"_"+(l-1).toString()]=r,this._saveDataInPreferences(i,s)}}}else{var s;(s=this._getDataFromPreferences(i))||(s={});var a=[],d=[],u=[];o=t.columnGroupDataIndexes[n];if(t.indexInParent[n]>e.indexInParent[n])for(l=t.indexInParent[n];l>=e.indexInParent[n];l--){if(void 0!==(r=s[c=o+"_"+(e.indexInParent[n]+t.indexInParent[n]-l).toString()])){a.push(c),u.push(r);var h=o+"_"+l.toString();d.push(h)}}else for(l=t.indexInParent[n];l<=e.indexInParent[n];l++){var c;if(void 0!==(r=s[c=o+"_"+(l===t.indexInParent[n]?e.indexInParent[n]:l-1).toString()])){a.push(c),u.push(r);h=o+"_"+l.toString();d.push(h)}}for(var g=0;g<a.length;g++)delete s[a[g]];for(g=0;g<d.length;g++)s[d[g]]=u[g];this._saveDataInPreferences(i,s)}},checkPresenceOfDataGridViewPreferences:function(){return!!this._hasValidIdentifier()&&t.checkPresenceOfPreferences(this.collectionView,this._dataGridViewPrefKey)},deleteDataGridViewPreferences:function(){t.deleteDataFromLocalPreferences(this.collectionView,this._dataGridViewPrefKey)},deleteDataGridViewKeyPreference:function(e){t.deleteDataFromLocalPreferences(this.collectionView,this._dataGridViewPrefKey,e)},_getColumnsVisibleFlagInPreferences:function(){return this._getDataFromPreferences("columnsVisibleFlag")},_saveColumnVisibleFlagInPreferences:function(e){this._saveColumnOptionValueInPreferences(e,"visibleFlag","columnsVisibleFlag")},_getUnpinnedColumnsOrderInPreferences:function(){return this._getDataFromPreferences("unpinnedColumnsOrder")},_getPinnedColumnsOrderInPreferences:function(){return this._getDataFromPreferences("pinnedColumnsOrder")},_getcolumnGroupsExpandedStatesInPreferences:function(){return this._getDataFromPreferences("columnGroupsExpandedStates")},_saveColumnOrderInPreferences:function(e){var t=this.getColumnPinned(e),i="unpinned"===t?this._getUnpinnedColumnsOrderInPreferences():this._getPinnedColumnsOrderInPreferences();i||(i={});var n=this._getNumberOfColumnsToTheLeft(),o=this.getColumnIdentifiers(e),l=this._orderedColumnsReverseIndexes[o.columnIndex];l-=n[t],i[o.dataIndex]=l;var r="unpinned"===t?"unpinnedColumnsOrder":"pinnedColumnsOrder";this._saveDataInPreferences(r,i)},_updateAllOrderInPreferences:function(e){for(var t=this._getUnpinnedColumnsOrderInPreferences(),i=this._getPinnedColumnsOrderInPreferences(),n=this._getNumberOfColumnsToTheLeft(),o=0;o<this._orderedColumnsIndexes.length;o++){var l=this._orderedColumnsIndexes[o],r=this.getDataIndexFromColumnIndex(l);if(this.getColumnVisibleState(r)){var s=this.getColumnPinned(r);t&&"unpinned"===s&&null!=t[r]?t[r]=o-n[s]:i&&"unpinned"!==s&&null!=i[r]&&(i[r]=o-n[s])}}this._saveDataInPreferences("unpinnedColumnsOrder",t),this._saveDataInPreferences("pinnedColumnsOrder",i)},isInGroup:function(e,t){var i=this.getColumnIdentifiers(e);if(t){if(!t.children)return t.dataIndex===i.dataIndex;for(var n=0;n<t.children.length;n++)if(this.isInGroup(e,t.children[n]))return!0}return!1},_isGroupInBalancedTree:function(e){return this.getColumnOrGroupCellCoordinates(e).columnID>=0},_getTopNonSplittableGroup:function(e){var t;if(e)for(var n=i.getParents(e),o=0;o<n.length;o++)if(n[o]&&!1===n[o].splittableFlag){t=n[o];break}return t},_getColumnsWidthInPreferences:function(){return this._getDataFromPreferences("columnsWidth")},_saveColumnWidthInPreferences:function(e){this._saveColumnOptionValueInPreferences(e,"width","columnsWidth")},_hasColumn:function(e){return this._columnsReverseIndexes||this._computeColumnsReverseIndexes(),void 0!==this._columnsReverseIndexes[e]},_getColumnsPinnedStateInPreferences:function(){return this._getDataFromPreferences("columnsPinnedState")},_saveColumnPinnedStateInPreferences:function(e){this._saveColumnOptionValueInPreferences(e,"pinned","columnsPinnedState")},_getColumnsSortModelInPreferences:function(){return this._getDataFromPreferences("columnsSortModel")},saveColumnSortModelInPreferences:function(){this._saveDataInPreferences("columnsSortModel",this.collectionView.sortModel)},_saveColumnSortModelInPreferences:function(){this.saveColumnSortModelInPreferences()},_getGroupingOptionsInPreferences:function(){return this._getDataFromPreferences("groupingOptions")},_saveGroupingOptionsInPreferences:function(){this._saveDataInPreferences("groupingOptions",this.collectionView._rowModel._groupingOptions)},_getOrderedColumnIndexesFromChanges:function(e){var i,n=this._originalOrderedColumnsIndexes.slice(0),o=e.unpinnedColumnsOrder,l=e.pinnedColumnsOrder,r=e.columnsPinnedState;i=t.concatenateObjects(l,o);var s=[],a=[],d=[],u=this._getNumberOfColumnsToTheLeftFromChanges(e);for(var h in i){var c;if("left"===(c=r&&r.hasOwnProperty(h)?r[h]:this.getColumnPinned(h))){if(l&&void 0!==l[h]){var g=l[h];s.push({dataIndex:h,columnIndexInPref:g})}}else if("right"===c){if(l&&void 0!==l[h]){g=l[h];a.push({dataIndex:h,columnIndexInPref:g+u[c]})}}else if("unpinned"===c&&o&&void 0!==o[h]){g=o[h];d.push({dataIndex:h,columnIndexInPref:g+u[c]})}}var m=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return void e.splice(i,1)},p=s.concat(d).concat(a),f=[];for(var C in p)if(p.hasOwnProperty(C)&&this._hasColumn(p[C].dataIndex)){var _=this.getColumnIndex(p[C].dataIndex);f[p[C].columnIndexInPref]=_,m(n,_)}for(var w=0;w<this._orderedColumnsIndexes.length;w++){if(f.length<w)return f.concat(n);void 0===f[w]&&n.length>0&&(f[w]=n[0],n.splice(0,1))}return f=f.filter(function(e){return void 0!==e})},_getCurrentViewChanges:function(){var e={columnsVisibleFlag:void 0,columnsWidth:void 0,columnsPinnedState:void 0,columnsSortModel:void 0,layoutDensity:void 0,groupingOptions:void 0,unpinnedColumnsOrder:void 0,pinnedColumnsOrder:void 0,columnGroupsExpandedStates:void 0},i=this.collectionView.getCustomViewsManager().getCurrentCustomView();i&&(e.columnsVisibleFlag=i.columnsVisibleFlag,e.columnsWidth=i.columnsWidth,e.columnsPinnedState=i.columnsPinnedState,e.columnsSortModel=i.columnsSortModel,e.layoutDensity=i.layoutDensity,e.groupingOptions=i.groupingOptions,e.unpinnedColumnsOrder=i.unpinnedColumnsOrder,e.pinnedColumnsOrder=i.pinnedColumnsOrder);var n=this._getColumnsVisibleFlagInPreferences();(e.columnsVisibleFlag||n)&&(e.columnsVisibleFlag=t.concatenateObjects(e.columnsVisibleFlag,n));var o=this._getColumnsWidthInPreferences();(e.columnsWidth||o)&&(e.columnsWidth=t.concatenateObjects(e.columnsWidth,o));var l=this._getColumnsPinnedStateInPreferences();(e.columnsPinnedState||l)&&(e.columnsPinnedState=t.concatenateObjects(e.columnsPinnedState,l));var r=this._getColumnsSortModelInPreferences();e.columnsSortModel||(e.columnsSortModel=r),e.layoutDensity||(e.layoutDensity=this._getOriginalLayoutDensity());var s=this._getGroupingOptionsInPreferences();(e.groupingOptions||s)&&(e.groupingOptions=t.concatenateObjects(e.groupingOptions,s));var a=this._getUnpinnedColumnsOrderInPreferences();(e.unpinnedColumnsOrder||a)&&(e.unpinnedColumnsOrder=t.concatenateObjects(e.unpinnedColumnsOrder,a));var d=this._getPinnedColumnsOrderInPreferences();(e.pinnedColumnsOrder||d)&&(e.pinnedColumnsOrder=t.concatenateObjects(e.pinnedColumnsOrder,d));var u=this._getcolumnGroupsExpandedStatesInPreferences();return u&&(e.columnGroupsExpandedStates=u),e},_getOrderedColumnIndexesFromPreferences:function(){var e=this._getCurrentViewChanges();return this._getOrderedColumnIndexesFromChanges(e)},_applyPreferencesOnColumns:function(){this.collectionView.getCustomViewsManager().getCustomViews();for(var e=this._getCurrentViewChanges(),t=!1,i=Object.keys(e).map(function(t){return e[t]}),o=0;o<i.length;o++)if(void 0!==i[o]){t=!0;break}if(this.collectionView.prepareUpdateView(),t){var l=this.getLeafColumns();for(o=0;o<l.length;o++)e.columnsVisibleFlag&&e.columnsVisibleFlag.hasOwnProperty(l[o].dataIndex)&&this.setColumnVisibleFlag(o,e.columnsVisibleFlag[l[o].dataIndex]),e.columnsWidth&&e.columnsWidth.hasOwnProperty(l[o].dataIndex)&&this.setColumnWidth(o,e.columnsWidth[l[o].dataIndex]),e.columnsPinnedState&&e.columnsPinnedState.hasOwnProperty(l[o].dataIndex)&&this.setColumnPinned(o,e.columnsPinnedState[l[o].dataIndex])}if(this._orderedColumnsIndexes=this._getOrderedColumnIndexesFromPreferences(),this._computeOrderedColumnsReverseIndexes(),this._updateColumnTreeFromOrderedIndexes(),this.collectionView._currentlyCalledFromApplyPreferencesFlag=!0,e.columnsSortModel&&(!this.collectionView._useTreeDocumentRestoration||this.collectionView.sortModel&&0!==this.collectionView.sortModel.length||n.saveTreeDocumentOrder(this.collectionView.treeDocument),this.collectionView.sortModel=e.columnsSortModel),e.layoutDensity&&(this.layoutDensity=e.layoutDensity),e.groupingOptions){var r=e.groupingOptions.dataIndexesToGroup;this.collectionView._rowModel._groupingOptions&&this.collectionView._rowModel._groupingOptions.dataIndexesToGroup.equals(r)||this.collectionView.groupRows(e.groupingOptions)}if(e.columnGroupsExpandedStates)for(var s in e.columnGroupsExpandedStates){var a=0!==e.columnGroupsExpandedStates[s],d=s.split("_");if(d&&d.length>0){var u=d[d.length-1],h=d.slice(0,d.length-1).join("_"),c=this.collectionView.getColumnOrGroup(h,parseInt(u,10));c&&(c.expandedFlag=a)}}this.collectionView._currentlyCalledFromApplyPreferencesFlag=!1,this.collectionView.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},_getRowFirstVisibleCellWithActivableState:function(e){let t,i=0;for(;-1!==i&&(i>=0&&i>=0&&(t=this.getCellIDFromCoordinates({rowID:e,columnID:i})),!this.collectionView.getCellActivableState(t));)i=this._getNextVisibleColumnID(i);return-1===i&&(t=-1),t},setColumnGroupExpandedFlag:function(e,t,i,n){var o=this.getColumnOrGroupFromCoordinates({rowID:e,columnID:t});o&&(o.expandedFlag=i,this.invalidate({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!0}),n&&n.isUserInteraction&&this._saveColumnGroupExpandedStateInPreferences(o))},_isColumnDisplayedByHierarchy:function(e){var t=e.columnID,i=this.getColumnIndex(t),n=this.getColumnOrGroupFromCoordinates({rowID:e.rowID,columnID:i});if(n){if(!n._parent)return!0;var o=this.getColumnOrGroupCellCoordinates(n._parent);if(void 0===n.columnGroupShow)return this._isColumnDisplayedByHierarchy(o);if("open"===n.columnGroupShow)return(!0===n._parent.expandedFlag||!0===n._parent.isExpanderHidden)&&this._isColumnDisplayedByHierarchy(o);if("closed"===n.columnGroupShow)return(!1===n._parent.expandedFlag||!0===n._parent.isExpanderHidden)&&this._isColumnDisplayedByHierarchy(o)}return!1},_getColumnGroupIndexInItsRow:function(e){if(!this._columnItemsByDepth||!this._columnItemsByDepth.length)return-1;for(var t=0;t<this._columnItemsByDepth.length;t++)for(var i=this._columnItemsByDepth[t],n=0,o=0;o<i.length;o++){if(e===i[o])return n;e.dataIndex===i[o].dataIndex&&n++}return-1},_getDataIndexOccurrenceNumberInRow:function(e){for(var t=0,i=0;i<this._columnItemsByDepth.length;i++){for(var n=this._columnItemsByDepth[i],o=0;o<n.length;o++)e.dataIndex===n[o].dataIndex&&t++;if(t>0)break}return t},_getColumnOrGroupPositionData:function(e){for(var t=[],i=[],n=[],o=(e.children&&e.children.length,e._parent?e._parent.children.length:-1);e&&e.dataIndex;)e.children&&e.children.length>0&&(t.push(this._getDataIndexOccurrenceNumberInRow(e)),i.push(this._getColumnGroupIndexInItsRow(e)),n.push(e.dataIndex)),e=e._parent;return{numberOfDataIndexOccurences:t,indexInParent:i,columnGroupDataIndexes:n,childrenCountInParent:o}},_getColumnIDInLeafColumnHierarchyAtRowID:function(e,t){if(t>=-1)return e;var i=-1,n=this.getColumnOrGroupFromCoordinates({rowID:i,columnID:e});if(!n)return e;for(;;){if(i--,!(n=n._parent))return e;if(i===t)return this.getColumnOrGroupCellCoordinates(n).columnID}}})}),define("DS/DataGridView/DataGridViewBaseFilterView",["UWA/Core","DS/Controls/Abstract"],function(e,t){"use strict";return t.inherit({name:"datagridviewbasefilterview",publishedProperties:{filterViewManager:{defaultValue:void 0,type:"object",readOnly:!0},filterId:{defaultValue:"",type:"string",readOnly:!0},propertyId:{defaultValue:"",type:"string",readOnly:!0},validFlag:{defaultValue:!0,type:"boolean"},filter:{defaultValue:null,type:"object"}},buildContentView:function(){},buildFilterModelFromView:function(){},clearFilterViewContent:function(){},refreshContentView:function(e){},focusContentView:function(){},_build:function(){this._parent(),this.elements.container=new e.Element("div"),this.elements.container.dsModel=this,this._popupContentDiv=new e.Element("div")},_applyValidFlag:function(e){this.fire("validFlagChange")},getPopupContentDiv:function(){return this._popupContentDiv}})}),define("DS/DataGridView/DataGridViewPaginationManager",["DS/CollectionView/CollectionViewPaginationManager"],function(e){"use strict";return e.inherit({name:"dataGridViewPaginationManager",publishedProperties:{nodeDepth:{defaultValue:0,type:"integer"}},_id:0,_applyNodeDepth:function(){this.updatePagination()},_applyProperties:function(e){this._parent(e),this.isDirty("pageSize")||this.isDirty("currentPage")||!this.isDirty("nodeDepth")||this.updatePagination()},getPageNumber:function(){if(this._collectionView){var e=this._collectionView.getRowModelLength(this.nodeDepth);if(e)return Math.ceil(e/this.pageSize);if(0===e)return 1}},getNumberOfItemsOnPage:function(e){void 0===e&&(e=this.currentPage);var t=this._collectionView.getRowModelLength(this.nodeDepth),i=Math.max(Math.ceil(t/this.pageSize),1);return e>i||e<0?void 0:e===i?t-(i-1)*this.pageSize:this.pageSize}})}),define("DS/DataGridView/RowModelBase",["DS/Core/BaseComponent","DS/TreeModel/ModelUtils","DS/Utilities/StringUtils"],function(e,t,i){"use strict";return e.inherit({name:"RowModelBase",publishedProperties:{},_preBuild:function(){this.modelEventsListener=[],this.xsoEventsListener=[],this.pxsoEventsListener=[]},_syncModel:function(e,t){var i=this.dataGridView,n=this;i._hasFlatTreeState=!0;var o=[];n._DGVRowIDNodeModelMapping.clear(),n._DGVNodeModelRowIDMapping.clear();var l=0;if(n._getTreeDocument()){n._getTreeDocument()._getTrueRoot().processDescendants({onlyVisibleNodes:!0,processNode:function(e){var t=e.nodeModel;if(t&&i.shouldNodeBeRepresented(t)){if(o.push(t),void 0!==t.options.multipleNodesRep)for(var r=0;r<t.options.multipleNodesRep;r++)n._DGVRowIDNodeModelMapping.set(l,t),0===r&&n._DGVNodeModelRowIDMapping.set(t,l),l++;else n._DGVRowIDNodeModelMapping.set(l,t),n._DGVNodeModelRowIDMapping.set(t,l),l++;t.getChildren()&&(i._hasFlatTreeState=!1)}}}),i.prepareUpdateView();var r=!(!e||!(e.updateType&WUXModelUpdateTypes.Addition||e.updateType&WUXModelUpdateTypes.Removal||e.updateType&WUXModelUpdateTypes.Expand));r&&!n._isModelBeingFetched()&&UWA.equals(i.model,o)?i.updateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}):e&&e.updateType&WUXModelUpdateTypes.Filtering&&UWA.equals(i.model,o)?i.updateRowView(-1,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}):i.model=o,r&&i._applyMaxVisibleRowCount(void 0,i.maxVisibleRowCount,!0),!i.findStr||""===i.findStr||i._muteFind||t||i.setFindStr(i.findStr,i.matchCase,i._rowModel._computeFindEditorCurrentValue(),!0,!0,!0),i.pushUpdateView(void 0,void 0)}},_updateModel:function(){this._syncModel({updateType:WUXModelUpdateTypes.Addition})},_getCurrentPaginationOptions:function(){var e,t=this.dataGridView;if(t&&t.paginationManager){e={};var i=t.paginationManager.pageSize;e.nodeMin=(t.paginationManager.currentPage-1)*i,e.nodeMax=e.nodeMin+i-1,e.paginationNodeDepth=t.paginationManager.nodeDepth,e.currentPage=t.paginationManager.currentPage,e.pageSize=i}return e},getRowModelLength:function(e){if(void 0===e)return this.dataGridView.getModelLength();if(!this._rowModelLength){var t=0;this._getTreeDocument()&&this._getTreeDocument()._getTrueRoot().processDescendants({onlyVisibleNodes:!0,processNode:function(i){if(-1===e)t++;else if(i.nodeModel.getNodeDepth()===e)return t++,{shouldProcessDescendants:!1}}}),this._rowModelLength=t}return this._rowModelLength},modelLengthModified:function(){this._rowModelLength=void 0},getNodesXSO:function(){var e=null,t=this._getTreeDocument();return t&&(e=t.getXSO()),e},getNodesPXSO:function(){var e=null,t=this._getTreeDocument();return t&&(e=t.getPXSO()),e},shouldBeSelected:function(e){var t=this._getTreeDocument();return!(t&&!t.options.shouldBeSelected.call(t,e))},groupRows:function(e){var t=this.dataGridView;if(e&&e.dataIndexesToGroup){e.dataIndexesToGroup=e.dataIndexesToGroup.filter(function(e){return t.layout.getColumnOptionValue(e,"groupableFlag")});var i=this._groupingOptions&&this._groupingOptions.dataIndexesToGroup||[];if(this._groupingOptions=e,0===e.dataIndexesToGroup.length&&0===i.length)return;e.dataIndexesToGroup.length>0&&0===i.length?t.disableRowReordering():0===e.dataIndexesToGroup.length&&i.length>0&&t.enableRowReordering(),t.rowGroupingOptions.hideGroupedColumns&&(e.dataIndexesToGroup.forEach(function(e){if("tree"!==e){var n=i.indexOf(e);-1!==n&&i.splice(n,1),t.layout.setColumnVisibleFlag(e,!1)}}),i.forEach(function(e){t.layout.setColumnVisibleFlag(e,!0)})),this._doGroupingOnModel(e),this.modelLengthModified()}},_listenToTreeDocument:function(){var e=this,i=this.dataGridView,n=this._getTreeDocument();if(!n)return;var o=n.onUpdate(function(t){var n=!0;t.options.updateType===WUXModelUpdateTypes.Expand&&(n=!1),t.options.updateType&&(t.options.updateType&WUXModelUpdateTypes.Addition||t.options.updateType&WUXModelUpdateTypes.Removal||t.options.updateType&WUXModelUpdateTypes.Expand||t.options.updateType&WUXModelUpdateTypes.VisibilityChange)&&e.modelLengthModified(),t.options.updateType!==WUXModelUpdateTypes.Selection&&t.options.updateType!==WUXModelUpdateTypes.PreSelection&&t.options.updateType!==WUXModelUpdateTypes.AttributesChange&&e._syncModel(t.options,n),e._isModelBeingFetched()||(i.model&&0===i.getModelLength()?i._displayEmptyContentMessage():i._removeEmptyContentMessage()),e._mustClearViewSelection&&(i.getCellsXSO().empty(),e._mustClearViewSelection=!1)});this.modelEventsListener.push(o),e._syncModel({updateType:WUXModelUpdateTypes.Addition}),e._isModelBeingFetched()||(i.model&&0===i.getModelLength()?i._displayEmptyContentMessage():i._removeEmptyContentMessage()),o=n.onNodeModelUpdate(function(e){var t=e.data.nodeModel;if(t){var n=i.layout,o=t._getRowID();i.updateRowView(o,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}),n._useVariableRowHeight&&n.resetRowHeight(o)}}),this.modelEventsListener.push(o);var l=function(e){var t=e.target;if(t&&!t._isTrueRoot()&&!t.isExpanded()){var n=t.getChildren();if("addChild"===e.event&&n&&1===n.length||"removeChild"===e.event&&(!n||0===n.length)){var o=i.layout.getColumnIndex("tree");if(void 0===o)return;i.updateCellView(i.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:o}),{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}}},r=function(e){var t=e.target;t&&i.updateCellView(i.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:i.layout.getColumnIndex("tree")}),{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})},s=function(e,t){var n=e.target;if(n){var o=n._getRowID();i.updateRowView(o,{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})}};o=n.addModelEventListener("addChild",l),this.modelEventsListener.push(o),o=n.addModelEventListener("removeChild",l),this.modelEventsListener.push(o),o=n.addModelEventListener("highlight",s),this.modelEventsListener.push(o),o=n.addModelEventListener("unhighlight",s),this.modelEventsListener.push(o),o=n.addModelEventListener("matchSearch",r),this.modelEventsListener.push(o),o=n.addModelEventListener("unmatchSearch",r),this.modelEventsListener.push(o),o=n.addModelEventListener("documentRemoveRoots",function(e){t.destroyTreeDocumentOrderSnapshot(n)}),this.modelEventsListener.push(o),this._manageTreeDocumentSelection(),this._manageTreeDocumentPreSelection()},_manageTreeDocumentSelection:function(){var e=this.dataGridView,t=this.dataGridView.layout,i=this.getNodesXSO(),n=i.onPostAdd(function(i){var n=t.getMinMaxVisibleRowIDs();i.forEach(function(t){var i=t._getRowID();if(i>=n.minRowID&&i<=n.maxRowID){e._updateRenderedRowCellsAttributes(i);var o=e._getRowSelectionCheckBox(i);if(o){var l=o.preventTriggeringChangeEvent;o.preventTriggeringChangeEvent=!0,o.checkFlag=!0,o.preventTriggeringChangeEvent=l}}}),e._updateSelectAllCheckBox()});this.xsoEventsListener.push(n),n=i.onPostRemove(function(i){var n=t.getMinMaxVisibleRowIDs();i.forEach(function(t){var i=t._getRowID();if(i>=n.minRowID&&i<=n.maxRowID){e._updateRenderedRowCellsAttributes(i);var o=e._getRowSelectionCheckBox(i);if(o){var l=o.preventTriggeringChangeEvent;o.preventTriggeringChangeEvent=!0,o.checkFlag=!1,o.preventTriggeringChangeEvent=l}}}),e._updateSelectAllCheckBox()}),this.xsoEventsListener.push(n)},_manageTreeDocumentPreSelection:function(){const e=this.dataGridView,t=this.dataGridView.layout,i=this.getNodesPXSO();let n=i.onPostAdd(function(i){const n=t.getMinMaxVisibleRowIDs();i.forEach(function(t){const i=t._getRowID();i>=n.minRowID&&i<=n.maxRowID&&e._updateRenderedRowCellsAttributes(i)})});this.pxsoEventsListener.push(n),n=i.onPostRemove(function(i){const n=t.getMinMaxVisibleRowIDs();i.forEach(function(t){const i=t._getRowID();i>=n.minRowID&&i<=n.maxRowID&&e._updateRenderedRowCellsAttributes(i)})}),this.pxsoEventsListener.push(n)},prepareUpdate:function(){this._getTreeDocument().prepareUpdate()},pushUpdate:function(){this._getTreeDocument().pushUpdate()},_removeModelEvents:function(e){if(e&&e.getModelEvents()){for(var t=0;t<this.modelEventsListener.length;t++)e.getModelEvents().unsubscribe(this.modelEventsListener[t]);this.modelEventsListener.splice(0,this.modelEventsListener.length)}},_removeXSOEventsListener:function(e){var t=e?e.getXSO():null;if(t){for(var i=0;i<this.xsoEventsListener.length;i++)t.unsubscribe(this.xsoEventsListener[i]);this.xsoEventsListener.splice(0,this.xsoEventsListener.length)}},_removePXSOEventsListener:function(e){const t=e?e.getPXSO():null;if(t){for(let e=0;e<this.pxsoEventsListener.length;e++)t.unsubscribe(this.pxsoEventsListener[e]);this.pxsoEventsListener.splice(0,this.pxsoEventsListener.length)}},getFilterViewManager:function(){return this._filterViewManager||(this._filterViewManager=new DataGridViewFilterViewManager({view:this})),this._filterViewManager},destroy:function(){this._removeModelEvents(this._getTreeDocument()),this._removeXSOEventsListener(this._getTreeDocument()),this._removePXSOEventsListener(this._getTreeDocument()),this._parent()},_findAndDisplayAllCellIDsMatchingFindStr:function(e,t,i,n,o,l,r){var s=this,a=(this.dataGridView,performance.now());s._lastFindRequestTimeStamp=a;var d=function(i,o,r){o||s._findAllCellIDsMatchingFindStrInClientSide(e,t,n),l.call(s.dataGridView,i,r)};o?d.call(s,i,r):this._updateClientModelFromFind(e,t,i,d,r)},_findAllCellIDsMatchingFindStrInClientSide:function(e,t,n){var o=this.dataGridView,l=o.layout;if(o._matchingFoundArrays=[],o._matchingCellIDsArray=[],o._matchingCellIDsMap={},o._matchingNodeModelsArray=[],o._matchingNodeModelsMap={},o._matchingAllNodeModelsArray=[],!n){var r=o.getNodeModelToProcessForFind;if(r)n=r.call(o,e,t);else n=[],this._getTreeDocument()._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(e){var t=e.nodeModel;t&&!1===t.isHidden()&&!1===t.isFiltered()&&n.push(t)}})}if(0!==n.length)for(var s=this._getColumnsToProcessForFindData(o,e,t),a=s.findableColumnsDataIndexes,d=s.areFindableColumnsModified,u=i.toComparable(o.findStr.toString(),{toLowerCase:!t}),h=[],c=[],g=0;g<n.length;g++){var m=n[g];if(m&&m.hasRowID()/*!nodeModel.hasNoRepresentation()*/)for(var p=m.isVisible(),f=!(!p||null!==m._getRowID())||void 0,C=m._getRowID(f),_=0;_<a.length;_++){var w=a[_];if(!0!==d||-1!==a.indexOf(w)){var v;h[_]?v=h[_]:(v=l.getColumnIndex(w),h[_]=v);var D,I=l.getCellIDFromCoordinates({rowID:C,columnID:v}),V=!1===p?-1:I,y=this._getNodeCellInfos(m,p,I,o,l,v);c[_]?D=c[_]:(D=o.layout.getColumnOptionValue(v,"getCellValueAsStringForFind"),c[_]=D);var b=o._getCellValueAsStringForFind(D,y,w,l.getColumnTypeRepresentation(w));if(b&&UWA.is(b,"string")){var M=i.toComparable(b.toString(),{toLowerCase:!t}),x=o._getIndexesOfMatchingString(M,u);if(x.length>0){o._matchingFoundArrays.push(x),o._matchingCellIDsArray.push(V);var F=m.buildStringIdentifierArray;m._idForFind=F,o._matchingAllNodeModelsArray.push(m),-1!==V&&(o._matchingCellIDsMap[V]=o._matchingCellIDsArray.length-1),-1===o._matchingNodeModelsArray.indexOf(m)&&o._matchingNodeModelsArray.push(m),void 0!==m._getRowID()&&null!==m._getRowID()&&void 0===o._matchingNodeModelsMap[m._getRowID()]&&(o._matchingNodeModelsMap[m._getRowID()]=o._matchingNodeModelsArray.length-1)}}}}}},_getNodeCellInfos:function(e,t,i,n,o,l){var r=!1===t?-1:i;if(-1!=r)return n.getCellInfosAt(r);var s,a={columnID:l,nodeModel:e},d=o.getColumnHasCellValue(l);if(!d||d.call(n,a)){var u=o.getColumnGetCellValue(l);u&&(s=u.call(n,a))}if(e&&!s){var h=o.getDataIndexFromColumnIndex(l);if("tree"===h)"string"===o._getCellTypeRepresentation({columnID:a.columnID,cellModel:e.options.label,nodeModel:e})&&(s=e.options.label);s||(s=e.getAttributeValue(h))}return a.cellModel=s,a},_updateClientModelFromFind:function(e,t,i,n,o,l){return n?n.call(this,i,o,l):0},_computeNextMatchingData:function(e,t){var i=-1;if("substring"===e.findNavigationMode)i=e._currentMatchingStringIndex===this._computeMatchingStringsCount(t)-1?0:e._currentMatchingStringIndex+1;else if("cell"===e.findNavigationMode){var n=e._currentMatchingCellIDIndex;n===e._matchingCellIDsArray.length-1?n=0:n+=1,i=e._getMatchingStringIndexFromMatchingCellIDIndex(n)}else{var o=e._currentMatchingRowIDIndex;o===e._matchingNodeModelsArray.length-1?o=0:o+=1,i=e._getMatchingStringIndexFromMatchingRowIDIndex(o)}return i},_computeMatchingStringsCount:function(){for(var e=0,t=0;t<this.dataGridView._matchingFoundArrays.length;t++)e+=this.dataGridView._matchingFoundArrays[t].length;return e},_computePreviousMatchingData:function(e){var t=-1;if("substring"===e.findNavigationMode)t=0===e._currentMatchingStringIndex?e.matchingStringCount-1:e._currentMatchingStringIndex-1;else if("cell"===e.findNavigationMode){var i=e._currentMatchingCellIDIndex;0===i?i=e._matchingCellIDsArray.length-1:i-=1,t=e._getMatchingStringIndexFromMatchingCellIDIndex(i)}else{var n=e._currentMatchingRowIDIndex;0===n?n=e._matchingNodeModelsArray.length-1:n-=1,t=e._getMatchingStringIndexFromMatchingRowIDIndex(n)}return t},_getColumnsToProcessForFindData:function(e,t,i){var n=!1,o=e.getColumnsToProcessForFind,l=[];if(o&&(l=o.call(e,t,i),n=!0),!1===n){e.layout.getVisibleOrderedColumnsIndexes();for(var r=e.layout.getVisibleOrderedLeafColumns(),s=[],a=0;a<r.length;a++)!1!==r[a].findableFlag&&s.push(r[a].dataIndex);l=s}return{areFindableColumnsModified:n,findableColumnsDataIndexes:l}}})}),define("DS/DataGridView/DataGridViewContextualMenuBuilder",["DS/Utilities/Dom","DS/TreeModel/TreeNodeModel","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i){"use strict";var n=function(e){this._collectionView=e,this._supportedMenus=["filter","pin","sizeColumnToFit","firstColumnsVisibility","columnsManagement","expandCollapse","insertRow"]};return n.prototype.buildMenu=function(e,t){if(!this._collectionView)return console.log("A collection view is mandatory to build its contextual menu"),[];t=UWA.extend({filter:!0,pin:!0,firstColumnsVisibility:!0,columnsManagement:!0,sizeColumnToFit:!0,expandCollapse:!1,insertRow:!1},t);var i=this,n=[];return this._supportedMenus.forEach(function(o){if(!0===t[o]){var l="_create"+(o.substring(0,1).toUpperCase()+o.substring(1,o.length))+"ContextualMenu";if(i[l]instanceof Function){var r=i[l](e);r.length>0&&n.length>0&&n.push({type:"SeparatorItem",title:""}),n=n.concat(r)}}}),n},n.prototype.showCustomViewsDialog=function(){this._collectionView.showCustomViewsDialog()},n.prototype._createFilterContextualMenu=function(e){var t=[];if(this._collectionView&&e.cellInfos&&e.cellInfos.rowID<=-1&&e.cellInfos.columnID>-1){var n=this._collectionView.layout.getDataIndexFromColumnIndex(e.cellInfos.columnID),o=this._collectionView.getFilterViewManager();if(o){var l=o.filterManager;if(l){var r="tree"===n?"label":n;let a=l.getFilters(),d=a[r];if(d){var s=o.getFilterPopups()[r];if(s){let n={type:"PushItem",title:i.get("ContextualMenuBuilder").FilterColumn,icon:{iconName:"filter",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{context:{cellInfos:e.cellInfos},callback:function(e){s.showPopup()}}},o=this._collectionView.filterOptions?this._collectionView.filterOptions.maxAppliedFilterCount:void 0,l=d.canBeReset();if("number"==typeof o&&!l){let e=0;Object.keys(a).forEach(t=>{a[t].canBeReset()&&++e}),e>=o&&(n.state="disabled",n.tooltip=i.ContextualMenuBuilder.MaxFilterColumn)}t.push(n),l&&t.push({type:"PushItem",title:i.get("ContextualMenuBuilder").ResetColumnFilter,icon:{iconName:"filter-delete",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{context:{cellInfos:e.cellInfos},callback:function(e){e&&e.context&&e.context.cellInfos&&d.reset()}}})}}}}}return t},n.prototype._createPinContextualMenu=function(e){var t=this,n=[];if(e.cellInfos&&e.cellInfos.rowID<=-1&&e.cellInfos.columnID>-1){var o,l;-1===e.cellInfos.rowID?o=this._collectionView.layout.getColumnPinned(e.cellInfos.columnID):(l=t._collectionView.layout.getColumnOrGroupFromCoordinates({rowID:e.cellInfos.rowID,columnID:e.cellInfos.columnID}),o=this._collectionView.layout.getColumnOrGroupPinned(l));var r=[];r.push({type:"RadioItem",title:i.get("ContextualMenuBuilder").PinLeft,state:"left"===o?"selected":"unselected",action:{callback:function(i){l?t._collectionView.layout.setColumnOrGroupPinned(l,"left",{isUserInteraction:!0}):t._collectionView.layout.setColumnPinned(e.cellInfos.columnID,"left",{isUserInteraction:!0})}}}),r.push({type:"RadioItem",title:i.get("ContextualMenuBuilder").PinRight,state:"right"===o?"selected":"unselected",action:{callback:function(i){l?t._collectionView.layout.setColumnOrGroupPinned(l,"right",{isUserInteraction:!0}):t._collectionView.layout.setColumnPinned(e.cellInfos.columnID,"right",{isUserInteraction:!0})}}}),r.push({type:"RadioItem",title:i.get("ContextualMenuBuilder").NoPin,state:"left"!==o&&"right"!==o?"selected":"unselected",action:{callback:function(i){l?t._collectionView.layout.setColumnOrGroupPinned(l,"unpinned",{isUserInteraction:!0}):t._collectionView.layout.setColumnPinned(e.cellInfos.columnID,"unpinned",{isUserInteraction:!0})}}}),n.push({type:"PushItem",title:i.get("ContextualMenuBuilder").PinMenu,icon:{iconName:"pin",fontIconFamily:WUXManagedFontIcons.Font3DS},submenu:r})}return n},n.prototype._createFirstColumnsVisibilityContextualMenu=function(t){var i=[],n=t.cellInfos&&-1===t.cellInfos.rowID;if(!n&&t.infos&&t.infos.target&&(n=e.firstParentWithClass(t.infos.target,"wux-layouts-header")),n)for(var o=void 0,l=this._collectionView.layout,r=l.getLeafColumns(),s=0;s<r.length&&s<8;s++){o=r[l._orderedColumnsIndexes[s]];var a=l.getColumnVisibleFlag(o.dataIndex)?"selected":"unselected";i.push({type:"CheckItem",title:o.text,icon:o.icon,state:l.getColumnAlwaysVisibleFlag(o.dataIndex)?"disabled|"+a:a,action:{callback:function(e){if(e&&e.context&&e.context.id){var t=l.getColumnVisibleFlag(e.context.id);l.setColumnVisibleFlag(e.context.id,!t,{isUserInteraction:!0})}},context:{id:o.dataIndex}}})}return i},n.prototype._createColumnsManagementContextualMenu=function(t){var n=this,o=[],l=t.cellInfos&&-1===t.cellInfos.rowID;return!l&&t.infos&&t.infos.target&&(l=e.firstParentWithClass(t.infos.target,"wux-layouts-header")),l&&o.push({type:"PushItem",title:i.get("ContextualMenuBuilder").CustomViews,action:{callback:function(e){n.showCustomViewsDialog()}}}),o},n.prototype._createSizeColumnToFitContextualMenu=function(t){var n=[],o=t.cellInfos&&-1===t.cellInfos.rowID;return!o&&t.infos&&t.infos.target&&(o=e.firstParentWithClass(t.infos.target,"wux-layouts-header")),o&&t.cellInfos&&(n.push({type:"PushItem",title:t.cellInfos.rowID<-1?i.get("ContextualMenuBuilder").SizeGroupToFit:i.get("ContextualMenuBuilder").SizeToFit,icon:{iconName:"table-column-size",fontIconFamily:WUXManagedFontIcons.Font3DS},state:!1===this._collectionView.layout.getColumnResizableFlag(t.cellInfos.columnID)?"disabled":"",action:{context:{cellInfos:t.cellInfos},callback:function(e){if(e&&e.context&&e.context.cellInfos){var t=e.context.cellInfos.manager,i=(t.layout,e.context.cellInfos.columnID),n=e.context.cellInfos.rowID;t&&i>=0&&t.sizeColumnOrGroupToFit(i,n,{isUserInteraction:!0,computeColumnHeader:!0})}}}}),n.push({type:"PushItem",title:i.get("ContextualMenuBuilder").SizeAllToFit,icon:{iconName:"table-column-size-all",fontIconFamily:WUXManagedFontIcons.Font3DS},action:{context:{cellInfos:t.cellInfos},callback:function(e){e&&e.context&&e.context.cellInfos&&e.context.cellInfos.manager.sizeAllColumnsToFit({isUserInteraction:!0,computeColumnHeader:!0})}}})),n},n.prototype._createExpandCollapseContextualMenu=function(e){var t=[];return e.cellInfos&&e.cellInfos.columnID===e.collectionView.layout.getColumnIndex("tree")&&e.cellInfos.rowID>-1&&(e.cellInfos.nodeModel.canBeExpanded()&&(e.cellInfos.nodeModel.isExpanded()?t.push({type:"PushItem",title:i.get("Collapse"),action:{callback:function(t){e.cellInfos.nodeModel.collapse()}}}):t.push({type:"PushItem",title:i.get("Expand"),action:{callback:function(t){e.cellInfos.nodeModel.expand()}}})),e.cellInfos.nodeModel.canBeExpandedAll()&&(t.push({type:"PushItem",title:i.get("ExpandAll"),action:{callback:function(t){e.cellInfos.nodeModel.expandAll()}}}),t.push({type:"PushItem",title:i.get("CollapseAll"),action:{callback:function(t){e.cellInfos.nodeModel.collapseAll()}}}))),t},n.prototype._createInsertRowContextualMenu=function(e){var n=[];if(!e.cellInfos||e.cellInfos.rowID<=-1)return n;var o=function(i,n){if(i&&i.context&&i.context.cellInfos){var o=i.context.cellInfos.manager,l=o.getTreeDocument();l.prepareUpdate();var r=new t,s=i.context.cellInfos.nodeModel._getLocalID();i.context.cellInfos.nodeModel.getParent().addChild(r,"before"===n?s:s+1),l.pushUpdate(WUXModelUpdateTypes.Addition);var a=r._getRowID();o.insertRowCallback(r,a,e.cellInfos),o.ensureNodeModelVisible(r,!0),o.flashEffectOnNodeModel("ui-modified",r)}};return n.push({type:"PushItem",title:i.get("ContextualMenuBuilder").InsertRowBefore,action:{context:{cellInfos:e.cellInfos},callback:function(e){o(e,"before")}}}),n.push({type:"PushItem",title:i.get("ContextualMenuBuilder").InsertRowAfter,action:{context:{cellInfos:e.cellInfos},callback:function(e){o(e,"after")}}}),n},n}),define("DS/DataGridView/DataGridViewConditionBaseFilterView",["DS/DataGridView/DataGridViewBaseFilterView","DS/Utilities/Dom","DS/Core/PointerEvents","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n){"use strict";function o(e){for(let t=e;t<this._numberOfConditionDisplayed;t++){const e=this._conditionsElements[t];e.container&&e.container.remove(),this.resetConditionElements(e)}this._numberOfConditionDisplayed=e,0===e&&this.displayConditionElements(0)}function l(){"and"===this._operator?this._operatorLabel.innerHTML=n.get("FilterView_Condition_All"):this._operatorLabel.innerHTML=n.get("FilterView_Condition_Any"),t.addEventOnElement(this,this._operatorLabel.querySelector("#conditionToggle"),i.POINTERHIT,()=>{"and"===this._operator?this._operator="or":this._operator="and",l.call(this)})}return e.inherit({name:"datagridviewconditionbasefilterview",publishedProperties:{},buildConditionElements:function(e){},refreshConditionElements:function(e,t){},resetConditionElements:function(e){},buildConditionFilterModel:function(e){},isConditionEmpty:function(e){return!0},focusConditionElements:function(e){},_build:function(){this._parent(),this._operatorLabel=null,this._conditionsElements=[],this._numberOfConditionDisplayed=0,this._operator="and"},buildContentView:function(){var e=this._popupContentDiv;e&&(e.addClassName("wux-datagridview-filter-conditions"),this._operatorLabel=document.createElement("div"),this._operatorLabel.classList.add("wux-datagridview-filter-operator"),e.appendChild(this._operatorLabel),this.refreshContentView())},hideConditionElements:function(e){const t=e>=0?e:this._numberOfConditionDisplayed-1;this._conditionsElements.length>0&&t>0&&this._numberOfConditionDisplayed>t&&this._conditionsElements.length>=this._numberOfConditionDisplayed&&o.call(this,t)},displayConditionElements:function(e){var t=this._popupContentDiv;if(t&&!(e>3)){if(this._conditionsElements.length<=e){const e=this.buildConditionElements(this._conditionsElements.length);return e.container.classList.add("wux-datagridview-filter-condition"),t.appendChild(e.container),this._conditionsElements.push(e),this._numberOfConditionDisplayed++,e}if(this._numberOfConditionDisplayed<=e){const e=this._conditionsElements[this._numberOfConditionDisplayed];return t.appendChild(e.container),this._numberOfConditionDisplayed++,e}return this._conditionsElements[e]}},isConditionElementsDisplayed:function(e){return e<this._numberOfConditionDisplayed},resetFilterViewContent:function(){this._operator="and",l.call(this),o.call(this,0)},clearFilterViewContent:function(){this.resetFilterViewContent()},refreshContentView:function(e){if(this.filter&&this.elements._popup){var t=void 0!==e?e:this.filter.filterModel;if(!t||Array.isArray(t))return void this.resetFilterViewContent();this._operator=t.operator||"and",l.call(this);const i=Object.keys(t).length-(void 0!==t.operator?1:0);for(let e=0;e<i;e++){const i=this.displayConditionElements(e);if(i){const n=t["condition"+(e+1)];this.refreshConditionElements(i,n)}}const n=this.displayConditionElements(i);this.resetConditionElements(n),i+1<this._conditionsElements.length&&o.call(this,i+1)}},focusContentView:function(){this._conditionsElements[0]&&this.focusConditionElements(this._conditionsElements[0])},buildFilterModelFromView:function(){if(0===this._numberOfConditionDisplayed)return this.filter&&this.filter.filterModel;let e={};for(let t=0;t<this._numberOfConditionDisplayed;t++){const i=this._conditionsElements[t];if(this.isConditionEmpty(i))break;e["condition"+(t+1)]=this.buildConditionFilterModel(i)}return Object.keys(e).length>=2&&(e.operator=this._operator),e}})}),define("DS/DataGridView/DataGridViewTreeNodeCell",["UWA/Core","DS/Core/Core","DS/DataGridView/DataGridViewCell","DS/Utilities/Dom","DS/Core/PointerEvents"],function(e,t,i,n,o){"use strict";var l=function(e){e.stopPropagation(),e.preventDefault()};function r(t){if(t){if(!this.nodeModel||!this.nodeModel.hasBadges())return this._latestAddedBadges={},t;var i;i="string"==typeof t?n.isAPath(t)?{iconPath:t}:{iconName:t}:e.clone(t);var o=s.call(this,t);return i.badges=o,this._latestAddedBadges=o,i}}function s(t){if(t){var i=t.badges?e.clone(t.badges):{},n=this.nodeModel.getBadges();if(n){var o={};Object.keys(n).forEach(function(e){n[e]&&(o[e]=n[e])}),e.merge(i,o)}return i}return{}}return i.inherit({name:"DataGridViewTreeNodeCell",publishedProperties:{nodeModel:{defaultValue:null,type:"object",category:"Model"},readOnly:{defaultValue:!0,type:"boolean",category:"Model"},buildLinks:{defaultValue:!0,type:"boolean",category:"Appearance"},depthIncrement:{defaultValue:22,type:"integer"},showIconsFlag:{defaultValue:!0,type:"boolean"},expanderStyle:{defaultValue:"classic",type:"string"},flatTreeFlag:{defaultValue:!1,type:"boolean"},icons:{defaultValue:void 0,type:"Array"},getNodeDepth:{defaultValue:function(e){return e.getNodeDepth()},type:"function",noNeedToApplyFlag:!0}},_applyNodeModel:function(e){var t=this.nodeModel;t&&(this.__applyExpanderState(t.getState()),this.__applyDepth(this.getNodeDepth.call(this,t)))},_applyReadOnly:function(e){this._reusableContent&&(this._reusableContent.readOnly=this.readOnly)},_applyShowIconsFlag:function(e){this.elements.iconsContainer&&(this.showIconsFlag?this.elements.iconsContainer.show():this.elements.iconsContainer.hide())},_applyFlatTreeFlag:function(e){!this.isDirty("nodeModel")&&this.nodeModel&&this.__applyDepth(this.nodeModel.getNodeDepth()),this.flatTreeFlag?this.elements.expanderContainer.hide():this.elements.expanderContainer.show()},_applyExpanderStyle:function(e){this.elements.container.setAttribute("expander-style",this.expanderStyle)},_applyBuildLinks:function(e){!this.isDirty("nodeModel")&&this.nodeModel&&this.__applyDepth(this.nodeModel.getNodeDepth()),!1===this.buildLinks?this.elements.expanderContainer.setAttributeNode(document.createAttribute("no-link")):this.elements.expanderContainer.removeAttribute("no-link")},_applyProperties:function(e){this.isDirty("nodeModel")&&this._applyNodeModel(this.nodeModel),this.isDirty("icons")&&this._applyIcons(this.icons),this.isDirty("readOnly")&&this._applyReadOnly(e.readOnly),this.isDirty("showIconsFlag")&&this._applyShowIconsFlag(e.showIconsFlag),this.isDirty("flatTreeFlag")&&this._applyFlatTreeFlag(e.flatTreeFlag),this.isDirty("expanderStyle")&&this._applyExpanderStyle(e.expanderStyle),this.isDirty("buildLinks")&&this._applyBuildLinks(e.buildLinks),this._parent(e)},buildView:function(){this.elements.linksContainer=new e.Element("div",{class:"wux-layouts-treeview-links"}).inject(this.elements.container),this.elements.expanderContainer=new e.Element("div",{class:"wux-layouts-treeview-expander"}).inject(this.elements.container),this.elements.tweakerContainer=new e.Element("div",{class:"wux-layouts-datagridview-tweaker-container"}).inject(this.elements.container),this.__observeEvents()},_getContentContainer:function(){return this.elements.tweakerContainer},__observeEvents:function(){this.nodeModel;var e=this;this.elements.expanderContainer.addEvent(o.POINTERHIT,function(t){t.stopPropagation(),"touchend"===t.type&&t.preventDefault(),1!==t.which&&"touchend"!==t.type||e.nodeModel.getChildren()&&"noExpandState"!==e.nodeModel._expandState&&"expandingState"!==e.nodeModel._expandState&&(e.nodeModel.isExpanded()&&"partiallyExpandedState"!==e.nodeModel._expandState?e.nodeModel.collapse():(e.__applyExpanderState("expanding"),e.nodeModel.expand()))}),this.elements.expanderContainer.addEventListener("contextmenu",l),this.elements.expanderContainer.addEventListener(o.LONGHOLD,l)},__applyDepth:function(e){var t=this.nodeModel,i=this.elements;void 0===e&&(e=t.getParents().length);var n=this.depthIncrement;if(this.buildLinks&&e>0){for(var o,l,r,s,a=t.isLastChild(),d=[t],u=t,h=1;h<e;h++)u=u?u.getParent():void 0,d.push(u);var c=0,g="";for(o=0;o<e;o++){var m=a&&o===e-1;r=(o===e-1?0:n)-1,s=(0===o?n:0)+c,""===(l=!m&&d[e-1-o]&&d[e-1-o].isLastChild()?"border-color:transparent":"")?(c=0,g=g+"<li"+(' data-depth="'+o+"/"+(e-1)+'"')+' style="'+l+";height: "+(m?"50%":"100%")+";margin-right:"+r+"px;margin-left:"+s+'px" class="wux-layouts-treeview-link"></li>'):c=r+s+1}g="<span>"+g+"</span>",i.linksContainer.innerHTML!==g&&(i.linksContainer.innerHTML=g)}else i.linksContainer.innerHTML="";var p=this.flatTreeFlag?0:this._getCurrentTouchMode()?25:18,f=n*e;i.linksContainer.setStyles({"margin-left":p,"min-width":f}),this._nodeOffsetX=f+p+2,i.container.setAttribute("data-node-depth",e)},__applyExpanderState:function(e){e&&(e.indexOf("noChildren")>-1&&(e="noChildren"),this.elements.expanderContainer.setAttribute("data-wux-state",e))},__applyLabel:function(e){"number"==typeof e&&(e=e.toString()),this._reusableContent&&(this._reusableContent.disableEvents(),this._reusableContent.value=e,this._reusableContent.enableEvents())},checkBadges:function(){return!(!this.icons||this.icons.length<=0)&&(this._latestAddedBadges||(this._latestAddedBadges={}),!e.equals(s.call(this,this.icons[0]),this._latestAddedBadges))},_applyIcons:function(){var t=this;if(this.elements.iconsContainer){this.elements.iconsContainer.removeAttribute("wux-icon-name");var i=this.elements.iconsContainer.getChildren();i&&i.forEach(function(e){e.hasClassName("wux-layouts-datagridview-icon")&&e.remove()})}var n=this.icons;if(n&&(n instanceof Array&&n.length>0||"string"==typeof n&&""!==n)){if(this.elements.iconsContainer||(this.elements.iconsContainer=new e.Element("div",{class:"wux-layouts-treeview-icons"})),n instanceof Array&&n.length>0){var o=document.createDocumentFragment();n.forEach(function(e,i){var l=e;if(0===i&&(l=r.call(t,n[0])),l){var s=t.__buildIcon(l);o.appendChild(s)}}),this.elements.iconsContainer.appendChild(o)}else if("string"==typeof n&&""!==n){var l=r.call(this,n);t.__addIcon(l,"css")}this._applyShowIconsFlag(),this.elements.iconsContainer.parentNode||(this.elements.tweakerContainer?this.elements.iconsContainer.inject(this.elements.tweakerContainer,"before"):this.elements.iconsContainer.inject(this.elements.container))}else this.elements.iconsContainer&&this.elements.iconsContainer.hide()},__addIcon:function(e,t){this.__buildIcon(e,t).inject(this.elements.iconsContainer)},__buildIcon:function(e,t){var i=n.createElement("div",{class:"wux-layouts-datagridview-icon"});switch(t){case"css":i.setAttribute("icon-type","css"),i.setAttribute("wux-icon-name",e);break;default:"string"==typeof e&&i.setAttribute("icon-type","css"),n.generateIcon(e,{target:i})}return i},computeContentSize:function(){var e=this.elements.expanderContainer&&this.elements.expanderContainer.offsetWidth>0?this.elements.expanderContainer.offsetWidth+3:0,t=this.elements.iconsContainer?this.elements.iconsContainer.offsetWidth:0,i=this._nodeOffsetX+e+t,n=this.getReusableContent();return n&&n.computeContentSize&&(i+=n.computeContentSize()),Math.ceil(i)},getFontSize:function(){var e=window.getComputedStyle(this.getContent(),null).getPropertyValue("font-size");return parseFloat(e)},getFontFamily:function(){return"arial"},getInitialClassName:function(){return this._parent()+" wux-layouts-datagridview-tree-node-cell wux-tree-treelistview"},destroy:function(){this.elements&&this.elements.expanderContainer&&(this.elements.expanderContainer.removeEventListener("contextmenu",l),this.elements.expanderContainer.removeEventListener(o.LONGHOLD,l)),this._parent()}})}),define("DS/DataGridView/DataGridViewRowHeaderCell",["UWA/Core","DS/Core/Core","DS/DataGridView/DataGridViewCell","DS/Utilities/Utils","DS/Utilities/Dom","DS/Controls/Toggle"],function(e,t,i,n,o,l){"use strict";return i.inherit({name:"DataGridViewRowHeaderCell",publishedProperties:{},buildView:function(){this._parent(),new e.Element("div",{class:"wux-datagridview-selection-label"}).inject(this.elements.container)},buildDragGrip:function(){this.elements._dragGrip||(this.elements._dragGrip=o.generateIcon({iconName:"drag-grip",fontIconFamily:WUXManagedFontIcons.Font3DS}),this.elements._dragGrip.classList.add("wux-datagridview-drag-grip"),this.elements._dragGrip.setAttribute("draggable",!0),this.elements._dragGrip.inject(this.elements.container,"top"))},buildSelectionCheckBox:function(){this.elements._selectionCheckBox||(this.elements._selectionCheckBox=new l({type:"checkbox",checkFlag:!1,fireOnlyFromUIInteractionFlag:!0}),this.elements._selectionCheckBox.getContent().classList.add("wux-datagridview-selection-checkbox"),this.elements._selectionCheckBox.inject(this.elements.container))},getSelectionCheckBox:function(){return this.elements._selectionCheckBox},getInitialClassName:function(){return this._parent()+" wux-layouts-datagridview-row-header-cell"},getCleaningMode:function(){return 2}})}),define("DS/DataGridView/DataGridViewColumnHeaderCell",["UWA/Core","DS/Core/Core","DS/DataGridView/DataGridViewCell","DS/Utilities/Utils","DS/Utilities/Dom","DS/Controls/Toggle","DS/Core/PointerEvents"],function(e,t,i,n,o,l,r){"use strict";return i.inherit({name:"DataGridViewColumnHeaderCell",publishedProperties:{filterView:{defaultValue:void 0,type:"DS/DataGridView/DataGridViewBaseFilterView",category:"Appearance"}},buildView:function(){},_applyFilterView:function(e){var t=this.filterView;t?this.elements.iconsContainer?e!==t&&(this.elements.iconsContainer.empty(),t.inject(this.elements.iconsContainer)):(this.buildIconsContainer(),t.inject(this.elements.iconsContainer)):this.elements.iconsContainer&&void 0!==e&&this.elements.iconsContainer.empty()},_buildContentContainer:function(){!this.elements.tweakerContainer&&this.elements.container&&(this.elements.tweakerContainer=new e.Element("div",{class:"wux-layouts-datagridview-tweaker-container"}).inject(this.elements.container,"top"))},_getContentContainer:function(){return this.elements.tweakerContainer||this._buildContentContainer(),this.elements.tweakerContainer},buildIconsContainer:function(){!this.elements.iconsContainer&&this.elements.container&&(this.elements.iconsContainer=new e.Element("div",{class:"wux-layouts-datagridview-column-header-icons"}).inject(this.elements.container,"bottom"))},buildSelectionCheckBox:function(){!this.elements._selectionCheckBox&&this.elements.container&&(this.elements._selectionCheckBox=new l({type:"checkbox",checkFlag:!1,fireOnlyFromUIInteractionFlag:!0}),this.elements._selectionCheckBox.getContent().classList.add("wux-datagridview-selection-checkbox"),this.elements.iconsContainer?this.elements._selectionCheckBox.inject(this.elements.iconsContainer,"before"):this.elements._selectionCheckBox.inject(this.elements.container),o.addEventOnElement(this,this.elements._selectionCheckBox,r.POINTERHIT,function(e,t){e.stopPropagation()}))},buildColumnGroupExpander:function(t,i){var n=i.expandedFlag;if(!this.elements._columnGroupExpander&&this.elements.container){if(void 0===n)return;var l=t,s=t.layout;this.elements._columnGroupExpander=new e.Element("div",{class:"wux-column-group-expander"}),this.elements.tweakerContainer?this.elements._columnGroupExpander.inject(this.elements.tweakerContainer,"after"):this.elements._columnGroupExpander.inject(this.elements.container,"top"),o.addEventOnElement(this,this.elements._columnGroupExpander,r.POINTERHIT,function(e,t){var i=e.target;if(i){var n,o=i.getAttribute("expanded");if("true"===o?(n=!1,i.setAttribute("expanded","false")):"false"===o&&(n=!0,i.setAttribute("expanded","true")),void 0!==n)(t=l.getCellInfosFromHtmlElement(i))&&s.setColumnGroupExpandedFlag(t.rowID,t.columnID,n,{isUserInteraction:!0})}})}i.isExpanderHidden=void 0,this.elements._columnGroupExpander.removeAttribute("expander");var a=i.children?i.children.length:0;if(!0===n||!1===n){for(var d=!1,u=!1,h=!1,c=0;c<a;c++){var g=t.layout.getColumnOrGroupVisibleState(i.children[c]);if(void 0===i.children[c].columnGroupShow&&g){if(d=!0,u||h)break}else if("open"===i.children[c].columnGroupShow&&!1!==i.children[c].visibleFlag){if(u=!0,d||h)break}else if("closed"===i.children[c].columnGroupShow&&!1!==i.children[c].visibleFlag&&(h=!0,u||d))break}!(d&&u||d&&h||u&&h)&&(this.elements._columnGroupExpander.setAttribute("expander","hidden"),i.isExpanderHidden=!0)}!0===n?this.elements._columnGroupExpander.setAttribute("expanded","true"):!1===n?this.elements._columnGroupExpander.setAttribute("expanded","false"):this.elements._columnGroupExpander.setAttribute("expanded","")},getSelectionCheckBox:function(){return this.elements._selectionCheckBox},getInitialClassName:function(){return this._parent()+" wux-layouts-datagridview-column-header-cell"}})}),define("DS/DataGridView/DataGridViewStringRegExpFilterView",["DS/DataGridView/DataGridViewConditionBaseFilterView","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Utilities/Dom","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o){"use strict";return e.inherit({name:"datagridviewstringregexpfilterview",publishedProperties:{},buildConditionElements:function(e){var l=this;const r={container:null,chooser:null,editor:null};r.container=document.createElement("div"),r.chooser=new t({enableSearchFlag:!1,elementsList:[{label:o.get("FilterView_String_Contains"),value:"contains"},{label:o.get("FilterView_String_EqualsTo"),value:"equal"},{label:o.get("FilterView_String_StartsWith"),value:"startsWith"},{label:o.get("FilterView_String_EndsWith"),value:"endsWith"},{label:o.get("FilterView_String_Empty"),value:"empty"},{label:o.get("FilterView_String_NotEmpty"),value:"notEmpty"}],value:"contains"}).inject(r.container);let s={};this.filter&&void 0!==this.filter.filterOptions&&Object.assign(s,this.filter.filterOptions),s.displayClearFieldButtonFlag=!0,r.editor=new i(s).inject(r.container);const a=t=>{this.isConditionEmpty(r)?l.hideConditionElements(e+1):l.displayConditionElements(e+1),l.fire("change")};n.addEventOnElement(this,r.editor,"uncommittedChange",a);return n.addEventOnElement(this,r.chooser,"change",function(e){"empty"===r.chooser.value||"notEmpty"===r.chooser.value?(r.editor.remove(),r.editor.value=""):r.editor.inject(r.container),l.fire("change"),a()}),r},resetConditionElements:function(e){e&&e.container&&(e.chooser.value="contains",e.editor.value="")},refreshConditionElements:function(e,t){t?e.container&&(e.chooser.value=t.type,e.editor.value=t.filter):this.resetConditionElements(e)},buildConditionFilterModel:function(e){const t={type:e.chooser.value};return"empty"!==t.type&&"notEmpty"!==t.type&&(t.filter=e.editor.valueToCommit),t},isConditionEmpty:function(e){return"empty"!==e.chooser.value&&"notEmpty"!==e.chooser.value&&(void 0===e.editor.valueToCommit||null===e.editor.valueToCommit||""===e.editor.valueToCommit)},focusConditionElements:function(e){e&&e.editor&&e.editor.focus()},buildContentView:function(){var e=this._popupContentDiv;e&&(e.addClassName("wux-datagridview-filter-string"),this._parent())}})}),define("DS/DataGridView/DataGridViewRow",["DS/CollectionView/CollectionViewCell","DS/Utilities/ReusableContentsManager","DS/DataGridView/DataGridViewCell","DS/DataGridView/DataGridViewTreeNodeCell"],function(e,t,i,n){"use strict";return e.inherit({name:"DataGridViewRow",publishedProperties:{},_postBuildView:function(){this._parent(),this._cellPool=new t;var e=this.collectionView,o=e&&e.cellClass?e.cellClass:i;this._registerPool("__item__",o);var l=e&&e.treeNodeCellOptions&&e.treeNodeCellOptions.cellClass?e.treeNodeCellOptions.cellClass:n;this._registerPool("__tree_item__",l)},_registerPool:function(e,t){var i=this;this._cellPool.register({id:e,buildContent:function(){return new t({collectionView:i.collectionView,cellType:e})}})},destroy:function(){this._parent(),this._cellPool&&(this._cellPool.destroy(),this._cellPool=null)},getCellPool:function(){return this._cellPool},getInitialClassName:function(){return this._parent()+" wux-layouts-datagridview-row"},getCleaningMode:function(){return 2},isRow:function(){return!0}})}),define("DS/DataGridView/DataGridViewSetFilterView",["DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/CollectionView/CollectionViewStatusBar","DS/DataGridView/DataGridViewBaseFilterView","DS/Controls/LineEditor","DS/Utilities/StringUtils","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o,l,r){"use strict";var s=function(e){return null==e||""===e?"(Blank)":e},a=function(e,i){var n=s.call(this,e);if(this._possibleValuesNodes[n])this._possibleValuesNodes[n].options.count+=i;else{var o=new t({label:n+" ("+i+")",attributeName:e,attributeId:n,count:i});this._treeDocumentPossibleValues&&this._treeDocumentPossibleValues.addRoot(o),this._possibleValuesNodes[n]=o}return this._possibleValuesNodes[n]},d=function(e){if(1!==e.getFilteredCount())return!1;var t=this.filter;if(this.filterViewManager){var i=this.filterViewManager.filterManager;if(i){var n=i.getFilters();n&&n[this.propertyId]&&t!==n[this.propertyId]&&(t=n[this.propertyId])}}return!!function(e,t){if(e&&t){var i=t.getListOfFilteredData();if(i)for(var n=0;n<=i.length;n++)if(i[n]===e)return!0}return!1}.call(this,e,t)},u=function(e,t){if(e&&Array.isArray(e)&&e.length===t.length){this._possibleValuesMap=new Map,this._possibleValuesReverseMap=new Map;for(var i=0;i<t.length;i++)this._possibleValuesMap.set(t[i],e[i]),this._possibleValuesReverseMap.set(e[i],t[i])}},h=function(e){for(var t in this._xsoListeningDisabled=!0,this._treeDocumentPossibleValues.prepareUpdate(),this._treeDocumentPossibleValues.empty(),this._possibleValuesNodes={},this._possibleValuesWithCount){var i;let e=this._possibleValuesWithCount[t].id;i="(Blank)"!==e?this._possibleValuesMap&&void 0!==e?this._possibleValuesMap.get(e):e:void 0,a.call(this,i,this._possibleValuesWithCount[e].count)}this._treeDocumentPossibleValues.pushUpdate(),this._xsoListeningDisabled=!1,g.call(this,e),this._dataGridViewPossibleValues&&this._dataGridViewPossibleValues.reapplySortModel()},c=function(e){if(this._treeDocumentPossibleValues){var t=this.filterViewManager.filterManager.model,i=this;this._unvisibleOrFilteredByAnother=[],this._unvisibleOrFilteredByMeAndAnother=[],this._selectAllClickedCount=0,i._selectAllCheckedFlag=void 0,this._possibleValuesWithCount={},this._possibleValuesMap=null,this._possibleValuesReverseMap=null,t.processDescendants({processNode:function(e){var t=e.nodeModel.options&&e.nodeModel.options.getAttributeValueForFiltering?e.nodeModel.options.getAttributeValueForFiltering(i.propertyId):e.nodeModel.getAttributeValue(i.propertyId),n=function(e){return 1===e.getFilteredCount()&&!!d.call(this,e)}.call(i,e.nodeModel);if(e.nodeModel.isVisible()||n){var o=s.call(this,t);i._possibleValuesWithCount[o]?i._possibleValuesWithCount[o].count++:i._possibleValuesWithCount[o]={id:o,count:1}}else!function(e){return 0!==e.getFilteredCount()&&!d.call(this,e)}.call(i,e.nodeModel)?-1===i._unvisibleOrFilteredByMeAndAnother.indexOf(t)&&i._unvisibleOrFilteredByMeAndAnother.push(t):-1===i._unvisibleOrFilteredByAnother.indexOf(t)&&i._unvisibleOrFilteredByAnother.push(t)}});var n=this.filterViewManager.view;if(n){var o=n.getColumnOrGroup(this.propertyId);if(o&&o.filterOptions&&o.filterOptions.mapPossibleValues){var l=o.filterOptions.mapPossibleValues;if(l instanceof Function){var a=Object.keys(this._possibleValuesWithCount).map(function(e){return i._possibleValuesWithCount[e].id}),c=l.call(this,a);if(c&&Array.isArray(c))u.call(this,c,a);else if(c instanceof Promise){this._dataGridViewPossibleValues&&(this._dataGridViewPossibleValues.displayModalLoader(r.get("Loading")),this._dataGridViewPossibleValues.placeholder="");i=this;return void c.then(function(t){u.call(i,t,a),h.call(i,e)}).finally(function(e){i._dataGridViewPossibleValues&&(i._dataGridViewPossibleValues.removeModalLoader(r.get("Loading")),i._dataGridViewPossibleValues.placeholder=r.get("NoObjectsFound"))})}}}}h.call(i,e)}},g=function(e){var t=void 0!==e?e:this.filter.filterModel,i=Array.isArray(t),n=!1;t&&0!==t.length&&i||(n=!0);var o=[];for(var l in this._possibleValuesNodes){var r=this._possibleValuesNodes[l];if(n)o.push(r);else if(i){var s=r.options.attributeName;if(null==s||""===s)-1===t.indexOf(void 0)&&-1===t.indexOf(null)&&-1===t.indexOf("")||o.push(r);else{if(this._possibleValuesReverseMap){var a=this._possibleValuesReverseMap.get(s);void 0!==a&&(s=a)}-1!==t.indexOf(s)&&o.push(r)}}}this._treeDocumentPossibleValues.getXSO().add(o)};return n.inherit({name:"datagridviewsetfilterview",publishedProperties:{},_build:function(){this._parent(),this._possibleValuesNodes=null,this._treeDocumentPossibleValues=null,this._searchLineEditor=null,this._dataGridViewPossibleValues=null},buildContentView:function(){var t=this._popupContentDiv;if(t){t.addClassName("wux-datagridview-filter-set");var n=this;this._searchLineEditor=new o({placeholder:r.get("FilterView").AttributeValuePlaceHolder,displayClearFieldButtonFlag:!0}).inject(t),this._searchLineEditor.getContent().addClassName("wux-datagridview-filter-set-editor"),this._searchLineEditor.addEventListener("uncommittedChange",function(){var e=new RegExp(l.toComparable(n._searchLineEditor.valueToCommit,{toLowerCase:!0}),"i"),t=n._treeDocumentPossibleValues.getRoots();n._treeDocumentPossibleValues.prepareUpdate(),t.forEach(function(t){var i=t.options.attributeId.toString();e.test(i)?t.show():t.hide(!0)}),n._treeDocumentPossibleValues.pushUpdate()}),this._possibleValuesWithCount={},this._mappedPossibleValues=null,this._possibleValuesNodes={},this._treeDocumentPossibleValues=new e;var s=this._treeDocumentPossibleValues.getXSO(),a=function(){n._xsoListeningDisabled||(n.validFlag=!s.isEmpty(),n.fire("change"))};s.onPostAdd(a),s.onPostRemove(a);var d=require("DS/DataGridView/DataGridView");this._dataGridViewPossibleValues=new d({treeDocument:this._treeDocumentPossibleValues,height:200,columns:[{text:"("+r.get("FilterView").SelectAll+")",dataIndex:"tree",editableFlag:!1,resizableFlag:!1,width:"auto"}],showRowIndexFlag:!1,showSelectionCheckBoxesFlag:!0,sortModel:[{dataIndex:"tree",sort:"asc"}],onContextualEvent:function(){return[]},selectionBehavior:{toggle:!0,unselectAllOnEmptyArea:!1,unselectAllOnEscapeKey:!1,selectNodeModelOnCellSelection:!0},cellSelection:"none",rowSelection:"multiple",cellActivationFeedback:!1}).inject(t),this._dataGridViewPossibleValues.addEventListener("buttonclick",function(e,t){if(e.target.hasClassName("wux-datagridview-selection-checkbox")&&n._dataGridViewPossibleValues._selectAllCheckBoxListenChange){var i=e.target.dsModel;i&&(t.rowID<0&&n._selectAllClickedCount++,void 0===n._selectAllCheckedFlag&&(n._selectAllCheckedFlag=i.checkFlag?1:0))}}),this._dataGridViewPossibleValues.buildStatusBar([{type:i.STATUS.NB_SELECTED_AND_TOTAL_ROWS}]),this.refreshContentView()}},clearFilterViewContent:function(){this._treeDocumentPossibleValues.selectAll()},refreshContentView:function(e){this.filter&&this.elements._popup&&(c.call(this,e),this._searchLineEditor&&(this._searchLineEditor.value=""))},focusContentView:function(){this._searchLineEditor&&this._searchLineEditor.focus()},buildFilterModelFromView:function(){if(!this._dataGridViewPossibleValues)return this.filter&&this.filter.filterModel;var e=this,t=[],i=[];this._treeDocumentPossibleValues.getRoots().forEach(function(n){var o=n.options.attributeName;if(e._possibleValuesReverseMap){var l=e._possibleValuesReverseMap.get(o);void 0!==l&&(o=l)}n.isSelected()?null==o||""===o?t.push(void 0,null,""):t.push(o):i.push(o)});var n=function(e,t){for(var n=0;n<e.length;n++)-1===t.indexOf(e[n])&&-1===i.indexOf(e[n])&&t.push(e[n])};return 0===this._selectAllClickedCount?n.call(this,this._unvisibleOrFilteredByAnother,t):this._selectAllClickedCount%2===this._selectAllCheckedFlag&&(n.call(this,this._unvisibleOrFilteredByAnother,t),n.call(this,this._unvisibleOrFilteredByMeAndAnother,t)),this.filter.isEmpty(t)?[]:t}})}),define("DS/DataGridView/CustomViewsManager",["DS/DataGridView/DataGridViewCustomViewsDialog","DS/Utilities/Utils","DS/TreeModel/ModelUtils","DS/Utilities/Dom","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o){"use strict";const l=[{identifier:o.get("DefaultView")}];var r=function(e){this.collectionView=e.collectionView?e.collectionView:void 0,this.name="CustomViewsManager",this._customViews=[...l],this._currentCustomViewIdentifier=void 0,this._customViewsDialog=void 0,this._prefsLoaded=!1};return r.prototype.getCustomViews=function(){return 0!==this._customViews.length&&!1!==this._prefsLoaded||this._loadCustomViewsFromLocalPreferences(),this._customViews},r.prototype.getCustomView=function(e){return this._getCustomViewInArray(this._customViews,e)},r.prototype.getCurrentCustomView=function(){return this.getCustomView(this.getCurrentCustomViewIdentifier())},r.prototype.getCurrentCustomViewIdentifier=function(){return this._currentCustomViewIdentifier},r.prototype.getCurrentCustomViewIndex=function(){for(var e=0;e<this._customViews.length;e++)if(this._customViews[e].identifier===this.getCurrentCustomViewIdentifier())return e;return-1},r.prototype._setCustomViews=function(e){this._customViews=e,t.saveDataInLocalPreferences(this.collectionView,this.collectionView.layout._dataGridViewPrefKey,"customViews",this._customViews)},r.prototype.setCurrentCustomView=function(e){this._currentCustomViewIdentifier=e;var t=this.getCustomView(e);if(t){var o=this.collectionView.layout;this.collectionView.prepareUpdateView();for(var l=!1,r=t.columnsVisibleFlag,s=t.columnsWidth,a=t.columnsPinnedState,d=o.getLeafColumns(),u=0;u<d.length;u++){var h=d[u].dataIndex,c=r?r[h]:void 0,g=o._getOriginalColumnOptionValue(h,"visibleFlag"),m=o.getColumnVisibleFlag(h);void 0!==c&&c!==m?o.setColumnVisibleFlag(h,c,{isUserInteraction:!0}):void 0===c&&m!==g&&o.setColumnVisibleFlag(h,g);var p=s?s[h]:void 0,f=o._getOriginalColumnOptionValue(h,"width"),C=o.getColumnWidth(h);void 0!==p&&p!=C?o.setColumnWidth(h,p,{isUserInteraction:!0}):void 0===p&&C!=f&&o.setColumnWidth(h,f);var _=a?a[h]:void 0,w=o._getOriginalColumnOptionValue(h,"pinned"),v=o.getColumnPinned(h);void 0!==_&&_!==v?o.setColumnPinned(h,_,{isUserInteraction:!0}):void 0===_&&v!==w&&o.setColumnPinned(h,w)}var D=o._getOrderedColumnIndexesFromChanges(t);UWA.equals(o._orderedColumnsIndexes,D)||(o._orderedColumnsIndexes=D.slice(0),o._computeOrderedColumnsReverseIndexes(),o._updateColumnTreeFromOrderedIndexes(),this.collectionView.invalidateLayout(),l=!0);var I=this.collectionView._rowModel._originalSortModel||[],V=this.collectionView.sortModel||[],y=t.columnsSortModel,b=this.collectionView.sortModel;V instanceof Array&&y instanceof Array&&JSON.stringify(V)!==JSON.stringify(y)?b=y:void 0===y&&JSON.stringify(V)!==JSON.stringify(I)&&(b=I),n.isCurrentlyCalledFromUIInteraction()&&(this.collectionView.sortModel&&this.collectionView.sortModel.length>0&&(!b||0===b.length)?i.restoreTreeDocumentOrder(this.collectionView.treeDocument):b&&b.length>0&&(!this.collectionView.sortModel||0===this.collectionView.sortModel.length)&&i.saveTreeDocumentOrder(this.collectionView.treeDocument)),this.collectionView.sortModel=b;var M=t.layoutDensity||o._getOriginalLayoutDensity();if(o.layoutDensity=M,this.collectionView.invalidateLayout(),l=!0,o._saveColumnSortModelInPreferences(),(M=t.layoutDensity)&&o.layoutDensity!==M&&(o.layoutDensity=M),this.collectionView.rowGroupingEnabledFlag&&t.groupingOptions){var x=t.groupingOptions;this.collectionView._rowModel._groupingOptions&&this.collectionView._rowModel._groupingOptions.dataIndexesToGroup.equals(x)||(l=!0,this.collectionView.groupRows(x))}this._modifyDataGridViewPreferences(t),this.collectionView.layout._saveDataInPreferences("currentCustomViewId",this.getCurrentCustomViewIdentifier());var F={};l&&(F={updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}),this.collectionView.pushUpdateView(F)}},r.prototype.createNewCustomView=function(){for(var e=o.get("CustomViewDefaultName"),t=1;this.getCustomView(e);)t++,e=o.get("CustomViewDefaultName")+" "+t;var i={identifier:e};return this.addCustomView(i),this.setCurrentCustomView(i.identifier),i},r.prototype.addCustomView=function(e,t=!1){const i=this._customViews.reduce((e,t,i)=>(e[t.identifier]=i,e),{}),n=e=>{const n=i[e.identifier];void 0===n?this._customViews.push(e):(!0===t||this._customViews[n].identifier===o.get("DefaultView")&&1===Object.keys(this._customViews[n]).length)&&(this._customViews[n]=e)};if(Array.isArray(e))for(const t of e)n(t);else n(e)},r.prototype.deleteCustomView=function(e){for(var t=0;t<this._customViews.length&&this._customViews[t].identifier!==e;t++);this._customViews.splice(t,1),this._currentCustomViewIdentifier===e&&(this._currentCustomViewIdentifier=void 0)},r.prototype._loadCustomViewsFromLocalPreferences=function(){if(0===this._customViews.length||!1===this._prefsLoaded){const o=t.getDataFromLocalPreferences(this.collectionView,this.collectionView.layout._dataGridViewPrefKey,"customViews");o&&o.length>0&&this.addCustomView(o),this._currentCustomViewIndex=-1;var e=t.getDataFromLocalPreferences(this.collectionView,this.collectionView.layout._dataGridViewPrefKey,"currentCustomViewId");if(e)for(var i=0;i<this._customViews.length;i++){var n=this._customViews[i];if(n&&n.identifier===e){this._currentCustomViewIdentifier=e,this._currentCustomViewIndex=i;break}}this._prefsLoaded=!0}},r.prototype.setCustomViews=function(e,t,i,n){e&&(this._setCustomViews(e),i&&this.setCurrentCustomView(t),n&&(this.onCustomViewsSave&&this.onCustomViewsSave.call(this,e,t),this.collectionView.onCustomViewsSave&&this.collectionView.onCustomViewsSave.call(this,e,this.getCurrentCustomViewIndex())),i&&this.collectionView.layout._applyPreferencesOnColumns())},r.prototype._getCustomViewInArray=function(e,t){var i;if(e)for(var n=0;n<e.length;n++){var o=e[n];if(o&&o.identifier===t){i=o;break}}return i},r.prototype._modifyDataGridViewPreferences=function(e){for(var t=["columnsPinnedState","columnsVisibleFlag","columnsWidth","pinnedColumnsOrder","unpinnedColumnsOrder","columnsSortModel"],i=this.collectionView.layout,n=0;n<t.length;n++)i.deleteDataGridViewKeyPreference(t[n]),e[t[n]]&&i._saveDataInPreferences(t[n],e[t[n]])},r.prototype.showCustomViewsDialog=function(){var t=!!(this.collectionView&&this.collectionView.customViewsOptions&&this.collectionView.customViewsOptions.dialogMaximizedFlag);return this._customViewsDialog||(this._customViewsDialog=new e({identifier:this.collectionView.identifier+"_CustomViewsDialog",dataGridView:this.collectionView,maximizeButtonFlag:!0,allowMaximizeFlag:!0,maximizedFlag:t})),this._customViewsDialog.loadCustomViews(),this._customViewsDialog.immersiveFrame=this.collectionView.getContainingImmersiveFrame(),this._customViewsDialog.visibleFlag=!0,this._customViewsDialog.maximizedFlag=t,this._customViewsDialog},r.prototype.destroy=function(){this._customViewsDialog&&(this._customViewsDialog.destroy(),this._customViewsDialog=null),this._customViews=void 0,this._currentCustomViewIdentifier=void 0,this.collectionView=void 0},r}),define("DS/DataGridView/DataGridViewNumberFilterView",["DS/Utilities/Dom","DS/DataGridView/DataGridViewConditionBaseFilterView","DS/Controls/ComboBox","DS/Controls/SpinBox","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o){"use strict";return t.inherit({name:"datagridviewnumberfilterview",publishedProperties:{},buildConditionElements:function(t){const l={container:null,chooser:null,editor:null,rangeLabels:[],rangeMaxEditor:null};l.container=document.createElement("div"),l.chooser=new i({enableSearchFlag:!1,elementsList:[{label:o.get("FilterView_Number_Range"),value:"range"},{label:o.get("FilterView_Number_Equal"),value:"equal"},{label:o.get("FilterView_Number_NotEqual"),value:"notEqual"},{label:o.get("FilterView_Number_LessThan"),value:"lessThan"},{label:o.get("FilterView_Number_LessThanOrEqual"),value:"lessThanOrEqual"},{label:o.get("FilterView_Number_GreaterThan"),value:"greaterThan"},{label:o.get("FilterView_Number_GreaterThanOrEqual"),value:"greaterThanOrEqual"},{label:o.get("FilterView_Number_Empty"),value:"empty"},{label:o.get("FilterView_Number_NotEmpty"),value:"notEmpty"}],value:"range"}).inject(l.container);var r=this,s={allowUndefinedFlag:!0,value:void 0,placeholder:" "};this.filter&&void 0!==this.filter.filterOptions&&Object.assign(s,this.filter.filterOptions),l.editor=new n(s).inject(l.container);const a=()=>{""!==l.editor.valueToCommit&&void 0!==l.editor.valueToCommit&&("range"!==l.chooser.value||""!==l.rangeMaxEditor.valueToCommit&&void 0!==l.rangeMaxEditor.valueToCommit)?this.displayConditionElements(t+1):this.hideConditionElements(t+1),r.fire("change")},d=()=>{this.isConditionEmpty(l)?this.hideConditionElements(t+1):this.displayConditionElements(t+1),r.fire("change")};l.editor.addEventListener("uncommittedChange",a),l.editor.addEventListener("change",d);const u=()=>{if("empty"===l.chooser.value||"notEmpty"===l.chooser.value?(l.editor.remove(),l.editor.value=void 0):l.editor.inject(l.container),"range"===l.chooser.value){if(null===l.rangeMaxEditor){l.rangeMaxEditor=new n(s),l.rangeMaxEditor.addEventListener("uncommittedChange",a),l.rangeMaxEditor.addEventListener("change",d);const e=document.createElement("div");e.textContent=o.get("FilterView_Number_Range_From"),l.rangeLabels.push(e);const t=document.createElement("div");t.textContent=o.get("FilterView_Number_Range_To"),l.rangeLabels.push(t)}l.container.insertBefore(l.rangeLabels[0],l.editor.getContent()),l.container.appendChild(l.rangeLabels[1]),l.rangeMaxEditor.inject(l.container)}else null!==l.rangeMaxEditor&&(l.rangeLabels[0].remove(),l.rangeLabels[1].remove(),l.rangeMaxEditor.remove());r.fire("change"),d()};return e.addEventOnElement(this,l.chooser,"change",u),u(),l},refreshConditionElements:function(e,t){t?e.container&&(e.chooser.value=t.type,Array.isArray(t.filter)&&"range"===t.type?(e.editor.value=t.filter[0],e.rangeMaxEditor.value=t.filter[1]):e.editor.value=t.filter):this.resetConditionElements(e)},resetConditionElements:function(e){e&&e.container&&(e.chooser.selectedIndex=0,e.editor.value=void 0,e.rangeMaxEditor&&(e.rangeMaxEditor.value=void 0))},buildConditionFilterModel:function(e){const t={type:e.chooser.value};return"range"===t.type?t.filter=[e.editor.value,e.rangeMaxEditor.value]:"empty"!==t.type&&"notEmpty"!==t.type&&(t.filter=e.editor.value),t},isConditionEmpty:function(e){if(!e.container)return!0;if("empty"===e.chooser.value||"notEmpty"===e.chooser.value)return!1;if(void 0===e.editor.value||null===e.editor.value||""===e.editor.value)return!0;if("range"===e.chooser.value){if(void 0===e.rangeMaxEditor.value||null===e.rangeMaxEditor.value||""===e.rangeMaxEditor.value)return!0;if(e.rangeMaxEditor.value<e.editor.value)return!0}return!1},focusConditionElements:function(e){e&&e.editor&&e.editor.focus()},buildContentView:function(){var e=this._popupContentDiv;e&&(e.addClassName("wux-datagridview-filter-number"),this._parent())}})}),define("DS/DataGridView/DataGridViewFilterViewManager",["DS/Core/BaseComponent","DS/DataGridView/DataGridViewFilterPopup","DS/DataGridView/DataGridViewStringRegExpFilterView","DS/DataGridView/DataGridViewSetFilterView","DS/DataGridView/DataGridViewNumberFilterView"],function(e,t,i,n,o){"use strict";var l=function(e,i){var n=0,o=this._listOfFilterPopups[e];if(!i)return o&&(o.destroy(),this._listOfFilterPopups[e]=void 0,delete this._listOfFilterPopups[e]),0;if(void 0!==o){if(o.filterId===i.filterId)return o.refreshView(),3;o.destroy(),this._listOfFilterPopups[e]=void 0,delete this._listOfFilterPopups[e],n=1}return this._listOfFilterPopups[e]=new t({filterViewManager:this,propertyId:e,filterId:i.filterId,filter:i}),1+n};return e.inherit({name:"datagridviewfilterviewmanager",publishedProperties:{view:{defaultValue:void 0,type:"object",readOnly:!0},filterManager:{defaultValue:void 0,type:"object"}},registerFilterView:function(e,t){this.FILTERVIEWS_MAP[e]=t},refreshFilterViews:function(){if(this.filterManager){var e=this,t=Object.keys(this._listOfFilterPopups),i=this.filterManager.getFilters();Object.keys(i).forEach(function(n){l.call(e,n,i[n]);var o=t.indexOf(n);-1!==o&&t.splice(o,1)}),t.forEach(function(t){e._listOfFilterPopups[t].destroy(),delete e._listOfFilterPopups[t]})}},getFilterPopups:function(){return this._listOfFilterPopups},getFilterViews:function(){var e={},t=this;return Object.keys(this._listOfFilterPopups).forEach(function(i){var n=t._listOfFilterPopups[i];if(n){var o=n.getActiveFilterView();o&&(e[i]=o)}}),e},isEmpty:function(){var e=this;return Object.keys(this._listOfFilterPopups).every(function(t){return!e._listOfFilterPopups[t].filter||e._listOfFilterPopups[t].filter.isEmpty()})},disableUpdateView:function(){this._preventUpdateView++},enableUpdateView:function(){this._preventUpdateView--},getFilterViewClassName:function(e){return this.FILTERVIEWS_MAP[e]},_build:function(){this.FILTERVIEWS_MAP={set:n,stringStdexp:i,stringRegexp:i,numberWithCondition:o},this._listOfFilterPopups={},this._onFilterModelChangeToken=void 0,this._preventUpdateView=0},_applyFilterManager:function(e){var t=this;this._onFilterModelChangeToken&&e&&e.unsubscribe(this._onFilterModelChangeToken);var i=Object.keys(this._listOfFilterPopups);i.length>0&&i.forEach(function(e){t._listOfFilterPopups[e].destroy(),delete t._listOfFilterPopups[e]}),this.filterManager&&(this._onFilterModelChangeToken=this.filterManager.subscribe("filterModelChange",function(e){t._preventUpdateView>0||(e?l.call(t,e.propertyId,e.filter):t.refreshFilterViews())}),this.refreshFilterViews())},_applyProperties:function(e){this._parent(e),this.isDirty("filterManager")&&this._applyFilterManager(e.filterManager)}})}),define("DS/DataGridView/RowModelClientSide",["DS/DataGridView/RowModelBase","DS/DataGridView/DataGridViewFilterViewManager","DS/Utilities/StringUtils","DS/Utilities/Dom","i18n!DS/DataGridView/assets/nls/translation"],function(e,t,i,n,o){"use strict";function l(e){return null==e||""===e}return e.inherit({name:"RowModelClientSide",publishedProperties:{dataGridView:{defaultValue:null,type:"object"},treeDocument:{defaultValue:null,type:"object"},sortModel:{defaultValue:null,type:"array"}},_applyProperties:function(e){this._parent(e),this.isDirty("treeDocument")&&this._applyTreeDocument(e.treeDocument),this.isDirty("sortModel")&&this._applySortModel(e.sortModel)},_getTreeDocument:function(){return this.treeDocument},getVisibleNodeModel:function(e){return this.dataGridView.getNodeModelAtRowID(e)},_isModelBeingFetched:function(){return!1},_applyTreeDocument:function(e){if(this._removeModelEvents(e),this._removeXSOEventsListener(e),this.treeDocument){var i=this.dataGridView;i&&(i._rowModel=this);var n=this.treeDocument.getFilterManager();n&&(this._filterViewManager?this._filterViewManager.filterManager=n:this._filterViewManager=new t({view:this.dataGridView,filterManager:n})),this._listenToTreeDocument()}},_syncModel:function(e){var t=this.dataGridView;t._hasFlatTreeState=!0;var i=[],n=0,o=this._getCurrentPaginationOptions();if(this._getTreeDocument()){this._getTreeDocument()._getTrueRoot().processDescendants({onlyVisibleNodes:!0,processNode:function(e){if(t.shouldNodeBeRepresented(e.nodeModel)){if(o){if(n<o.nodeMin)return-1===o.paginationNodeDepth||e.nodeModel.getNodeDepth()===o.paginationNodeDepth?(n++,{shouldProcessDescendants:-1===o.paginationNodeDepth}):void 0;if(n>o.nodeMax&&(-1===o.paginationNodeDepth||e.nodeModel.getNodeDepth()<=o.paginationNodeDepth))return{stopProcessing:!0};-1!==o.paginationNodeDepth&&e.nodeModel.getNodeDepth()!==o.paginationNodeDepth||n++}i.push(e.nodeModel),e.nodeModel.getChildren()&&(t._hasFlatTreeState=!1)}}}),t.prepareUpdateView();var l=!(!e||!(e.updateType&WUXModelUpdateTypes.Addition||e.updateType&WUXModelUpdateTypes.Removal||e.updateType&WUXModelUpdateTypes.Expand));l&&UWA.equals(t.model,i)?UWA.equals(t.model,i)&&t.updateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}):e&&e.updateType&WUXModelUpdateTypes.Filtering&&UWA.equals(t.model,i)?t.updateRowView(-1,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1}):t.model=i,l&&t._applyMaxVisibleRowCount(void 0,t.maxVisibleRowCount,!0),t._rowModel&&t.findStr&&""!==t.findStr&&!t._muteFind&&t.setFindStr(t.findStr,t.matchCase,t._rowModel._computeFindEditorCurrentValue(),!0,!0),t.pushUpdateView()}},_applySortModel:function(e){var t=this.dataGridView;if(t._isCurrentlyCalledFromUIInteraction()||this.dataGridView._currentlyCalledFromApplyPreferencesFlag||(this._originalSortModel=this.sortModel?[].concat(this.sortModel):this.sortModel),this.sortModel&&this.sortModel.length>0){var n=this.treeDocument;if(n){for(var o=t.layout,r=[],s=new Intl.Collator,a=0;a<this.sortModel.length;a++){var d=this.sortModel[a].dataIndex,u=o.getColumnIndex(d);if(u>-1){var h=o.getColumnCompareFunction(u);h||h||(h=function(e,t,n,o,r){return"string"==typeof e&&"string"==typeof t?i.compareLocal(e,t,{intlCollator:s}):UWA.equals(e,t)||l(e)&&l(t)?0:e>t?1:e<t?-1:l(e)&&!l(t)?-1:1});var c="desc"===this.sortModel[a].sort?-1:1;r.push({dataIndex:d,compareFunction:h,reverseFactor:c})}t._updateRenderedRowCellsAttributes(-1)}n._getTrueRoot().sortChildren({isRecursive:!0,sortFunction:function(e,i){for(var n=0,o=0;o<r.length&&0===n;){var l=r[o],s=t._getCellValueForSort(e,l.dataIndex),a=t._getCellValueForSort(i,l.dataIndex);n=l.reverseFactor*l.compareFunction(s,a,e,i,l.dataIndex),o++}return 0===n?e._getID()-i._getID():n}})}}else t._updateRenderedRowCellsAttributes(-1)},_doGroupingOnModel:function(e){var t=this,i=t.treeDocument,l=this.dataGridView;let r=l._isCurrentlyCalledFromUIInteraction();l.displayModalLoader(o.get("UpdatingGrouping"),function(){i.prepareUpdate();var s=function(e,t){var i=l.layout.getColumnGetCellValue(t);if(i){var n=l.layout.getColumnIdentifiers(t),o={cellID:l.layout.getCellIDFromCoordinates({rowID:e._getRowID(),columnID:n.columnIndex}),columnID:n.columnIndex,rowID:e._getRowID(),nodeModel:e};return i.call(l,o)}return e.getAttributeValue("tree"===t?"label":t)},a={propertiesToGroup:e.dataIndexesToGroup,getNodeGroupingKey:function(e,t){var i=l.layout.getColumnGetCellGroupingKey(t);if(i){var n=l.layout.getColumnIdentifiers(t),o=l.layout.getCellIDFromCoordinates({rowID:e._getRowID(),columnID:n.columnIndex}),r=l.getLightCellInfosAt(o);return r.nodeModel=e,i.call(l,r,t)}return s(e,t)},updateGroupingNodeOptions:function(e){var t=this.getProperty(),i=l.layout.getColumnOptionValue(t,"text"),n={label:(i?i+": ":"")+this.getIdentifier()+" ("+this.getOriginalChildrenInformation().notHiddenNotFilteredChildrenCount+")",grid:{}};l.rowGroupingOptions.getGroupingNodeOptions?n.grid=l.rowGroupingOptions.getGroupingNodeOptions.call(l,this,e):l.layout.getLeafColumns().forEach(function(t){var i=l.layout.getColumnOptionValue(t.dataIndex,"getGroupingNodeOptions");if(i)if("string"==typeof i)switch(i){case"sum":var o=0;e.forEach(function(e){o+=parseInt(s(e,t.dataIndex),10)}),n.grid[t.dataIndex]=o;break;case"avg":o=0,e.forEach(function(e){o+=parseInt(s(e,t.dataIndex),10)}),n.grid[t.dataIndex]=o/e.length;break;case"min":var r=void 0;e.forEach(function(e){var i=s(e,t.dataIndex);(void 0===r||i<r)&&(r=i)}),n.grid[t.dataIndex]=r;break;case"max":var a=void 0;e.forEach(function(e){var i=s(e,t.dataIndex);(void 0===a||i>a)&&(a=i)}),n.grid[t.dataIndex]=a;break;case"first":n.grid[t.dataIndex]=s(e[0],t.dataIndex);break;case"last":n.grid[t.dataIndex]=s(e[e.length-1],t.dataIndex)}else{var d=[];e.forEach(function(e){d.push(s(e,t.dataIndex))}),n.grid[t.dataIndex]=i.call(l,d)}}),this.updateOptions(n)}},d=l.rowGroupingOptions.depth;if(0===d)i.groupRoots(a);else{var u=function(e,t){if(t>=d)e.groupChildren(a);else{var i=e.getChildren();i&&i.forEach(function(e){u(e,t+1)})}};u(i._getTrueRoot(),0)}r&&n.pushUserInteractionContext(),t._applySortModel(),r&&n.popUserInteractionContext(),i.pushUpdate(),l.removeModalLoader(o.get("UpdatingGrouping"))})},_computeMatchingCellIDsCount:function(){return this.dataGridView._matchingCellIDsArray.length},_computeMatchingNodeModelsCount:function(){return this.dataGridView._matchingNodeModelsArray.length},_computeCurrentMatchingStringIndex:function(e,t){var i;return i=t>0?t-1:0,"cell"===e.findNavigationMode?e._getMatchingStringIndexFromMatchingCellIDIndex(i):"row"===e.findNavigationMode?e._getMatchingStringIndexFromMatchingRowIDIndex(i):i},_computeFindEditorCurrentValue:function(){return"substring"===this.dataGridView.findNavigationMode?this.dataGridView._currentMatchingStringIndex+1:"cell"===this.dataGridView.findNavigationMode?this.dataGridView._currentMatchingCellIDIndex+1:this.dataGridView._currentMatchingRowIDIndex+1},_getNodeModelsToProcessFromMatchCaseChange:function(){return this.dataGridView._matchingNodeModelsArray},_isServerSide:function(){return!1},_getNodeModelAtRowID:function(e){if(this.dataGridView.model&&Array.isArray(this.dataGridView.model))return this.dataGridView.model[e]},_getDataGridViewModelDisplayedLength:function(){return this.dataGridView.model&&Array.isArray(this.dataGridView.model)?this.dataGridView.model.length:0}})}),define("DS/DataGridView/DataGridView",["UWA/Core","UWA/Utils/Client","DS/CollectionView/CollectionView","DS/DataGridView/DataGridViewLayout","DS/DataGridView/RowModelClientSide","DS/DataGridView/RowModelServerSide","DS/Core/PointerEvents","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/Tweakers/TypeRepresentationFactory","DS/DataGridView/DataGridViewRow","DS/DataGridView/DataGridViewCell","DS/DataGridView/DataGridViewColumnHeaderCell","DS/DataGridView/DataGridViewRowHeaderCell","DS/DataGridView/DataGridViewTreeNodeCell","DS/DataGridView/CustomViewsManager","DS/Utilities/Dom","DS/Utilities/Utils","DS/Menu/ContextualMenu","DS/DataGridView/DataGridViewContextualMenuBuilder","DS/DataGridView/DataGridViewPaginationManager","DS/Controls/SelectionChips","DS/Tweakers/GeneratedToolbar","DS/CollectionView/edition/CollectionViewEditionOnDoubleClick","DS/CollectionView/edition/CollectionViewEditionOnClick","DS/CollectionView/edition/CollectionViewDelayedEditionOnClick","DS/CollectionView/edition/CollectionViewEditionOnOver","DS/CollectionView/edition/CollectionViewEditionInPlace","DS/Utilities/TouchUtils","i18n!DS/DataGridView/assets/nls/translation","DS/DataGridView/DataGridViewFilterViewManager","DS/Utilities/TreeUtils","DS/TreeModel/ModelUtils","DS/DataGridView/ModelMassUpdateDialog","DS/Selection/XSO","DS/WebappsUtils/WebappsUtils","DS/Core/WebUXComponents"],function(e,t,i,n,o,l,r,s,a,d,u,h,c,g,m,p,f,C,_,w,v,D,I,V,y,b,M,x,F,S,R,O,A,P,G,N,T){"use strict";var E,L,U,B,k=!1,H=t.Engine,W=4,j=!1,q=!1,X=!1;function z(e,t){if(window.notifs){var i={level:"info",title:S[e],message:S[t],sticky:!1};window.notifs.addNotif(i)}}function K(t){var i=void 0;if("object"==typeof t.cellModel?i=t.cellModel instanceof Date?t.cellModel.toLocaleDateString():JSON.stringify(t.cellModel):"string"==typeof t.cellModel?i=t.cellModel:void 0!==t.cellModel&&(i=t.cellModel.toString()),void 0!==t.cellModel&&this.layout.getColumnAllowUnsafeHTMLContent(t.columnID)){var n=e.createElement("div");n.innerHTML=i,i=n.innerText}return i}function J(e,t){return"object"==typeof e.cellModel&&null!==e.cellModel?e.cellModel instanceof Date?new Date(t):JSON.parse(t):t}function Y(e,t){return"tree"===t?e.options.label:e.options.grid[t]}function Q(t,i){if(X){var n=this.layout,o="middle"===t.dropPosition?n.getRowHeight(t.rowID):2,l=0;l="top"===t.dropPosition?n.getRowPosition(t.rowID):"bottom"===t.dropPosition?n.getRowPosition(t.rowID)+n.getRowHeight(t.rowID):n.getRowPosition(t.rowID);var r,s,a=n.getHeaderContainerHeight()+l-this.getScrollerPosition().y,d=n.getColumnIndex("tree"),u=-1;if(void 0!==d){var h=n.getCellIDFromCoordinates({rowID:t.rowID,columnID:d}),c=this._getViewAt(h);if(c){var g=c.elements.linksContainer.getBoundingClientRect(),m=this.getContent().getBoundingClientRect();u=g.right-m.left+1}}this._rowReorderDnDInfos.elements.line||(this._rowReorderDnDInfos.elements.line=new e.Element("div",{class:"wux-datagridview-drag-row-feedback"}),this._rowReorderDnDInfos.elements.chip=new e.Element("div",{class:"wux-datagridview-drag-row-feedback-chip"}).inject(this._rowReorderDnDInfos.elements.line),this._rowReorderDnDInfos.elements.line.inject(this.getContent())),"middle"===t.dropPosition?(r="none",s=!0===i?"1px solid #368ec4":!1===i?"1px solid #844138":"1px solid #E87B00"):(r=!0===i?"#368ec4":!1===i?" #844138":"#E87B00",s="none"),this._rowReorderDnDInfos.elements.line.setStyles({display:"block",top:a,height:o,border:s,background:r}),this._rowReorderDnDInfos.elements.chip.setStyles({display:"middle"===t.dropPosition||-1===u?"none":"block",left:u,background:r})}}function Z(){this._rowReorderDnDInfos.elements.line&&this._rowReorderDnDInfos.elements.line.hide()}function $(e,t){var i;if(t.cellView){var n=0,o=0,l=t.cellView.getContent().getBoundingClientRect(),r=!0,s=this.getTreeDocument();if(s){var a=s.usesAsyncDndCallbacks(),d=Object.getPrototypeOf(this).__rowReorderDnDInfos;if(d&&d.nodes&&d.nodes.length>0)for(var u=0;u<d.nodes.length;u++){if(d.nodes[u].isAscendantOf(t.nodeModel)||!a&&"function"==typeof s.options.shouldAcceptDrop&&!s.options.shouldAcceptDrop({parentTreeNodeModel:t.nodeModel,draggedTreeNodeModel:d.nodes[u],draggedNodes:d.nodes,dropNode:t.nodeModel,dropPosition:"middle"})){r=!1;break}}}r?(n=l.top+l.height/3,o=l.top+2*l.height/3):n=o=l.top+l.height/2,i=e.clientY<n?"top":e.clientY>=o?"bottom":"middle"}return i}function ee(t,i){if(!(i.draggedNodes&&0!==i.draggedNodes.length||t.defaultPrevented))return!1;this._rowReorderDnDInfos.dropPosition=i.dropPosition;var n=this,o=!1,l=this.getTreeDocument();if(l&&i.draggedNodes){var r={parentTreeNodeModel:"middle"===i.dropPosition?i.nodeModel:i.nodeModel.getParent(),draggedNodes:i.draggedNodes,dropPosition:i.dropPosition,dropNode:i.nodeModel};if(e.equals(r,this._latestShouldAcceptDropOptions))o=this._rowReorderDnDInfos.dropAccepted;else if(this._latestShouldAcceptDropOptions=r,l.usesAsyncDndCallbacks()){o=null;new Promise(function(e,t){l.options.shouldAcceptDrop(r,e,t)}).then(function(e){e||(t.dataTransfer.dropEffect="none"),n._rowReorderDnDInfos.dropAccepted=e,Q.call(n,i,e)})}else{o=!0;for(var s=0;s<i.draggedNodes.length;s++){var a=i.draggedNodes[s].isAscendantOf(i.nodeModel);if(r.draggedTreeNodeModel=i.draggedNodes[s],a||"function"==typeof l.options.shouldAcceptDrop&&!l.options.shouldAcceptDrop(r)){o=!1;break}}}}return this._rowReorderDnDInfos.dropAccepted=o,Q.call(this,i,o),this._rowReorderDnDInfos.dropAccepted}function te(e,t){var i=Object.getPrototypeOf(this).__rowReorderDnDInfos;if(!i||i.source!==this._uuid||!i.nodes)return!1;var n=this.getDraggedRowData(e);if(n&&n.rowID!==t.rowID&&this._rowReorderDnDInfos.dropAccepted){var o=t.nodeModel.getTreeDocument();if(o){o.prepareUpdate(),this.prepareUpdateView();var l=o.getUseChangeTransactionMode();o.setUseChangeTransactionMode(!1);let e="middle"===this._rowReorderDnDInfos.dropPosition?0:"top"===this._rowReorderDnDInfos.dropPosition?-1:1;var r=A.moveNodes(i.nodes,t.nodeModel,{direction:e,ensureVisible:!0});if(o.pushUpdate(),this.sortModel=[],this.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0}),r.isExpanded()||r._isTrueRoot()){for(var s=0;s<i.nodes.length;s++){var a=i.nodes[s];a&&this.flashEffectOnNodeModel("ui-modified",a)}this.ensureNodeModelVisible(i.nodes[0],!0,!0,.5)}else this.flashEffectOnNodeModel("ui-modified",r),this.ensureNodeModelVisible(r,!0,!0,.5);o.setUseChangeTransactionMode(l)}else this._flashEffectOnRow("ui-notmodified",n.rowID)}return!0}function ie(e,t){var i,n={},o={};for(i=t.offsetParent,n.x=e.touches?e.touches[0].pageX:e.pageX,n.y=e.touches?e.touches[0].pageY:e.pageY,o.left=t.offsetLeft,o.top=t.offsetTop;i;)o.left+=i.offsetLeft,o.top+=i.offsetTop,i=i.offsetParent;return{x:n.x-o.left,y:n.y-o.top}}function ne(){null!==this._autoScrollInfos.interval&&(clearInterval(this._autoScrollInfos.interval),this._autoScrollInfos.interval=null)}function oe(e,t){var i=this._getScroller().getContent(),n=ie(e,i),o=this.getScrollerPosition();if(this._autoScrollInfos.moveY=0,this._autoScrollInfos.moveX=0,n.x>=-this._leftContainerWidth&&n.x<=i.clientWidth+this._rightContainerWidth&&n.y>=0&&n.y<=i.clientHeight){n.y<40&&0!==o.y?this._autoScrollInfos.moveY=n.y-40:n.y>i.clientHeight-40&&Math.abs(o.y+i.clientHeight-i.scrollHeight)>=1&&(this._autoScrollInfos.moveY=n.y-(i.clientHeight-40))}if(t&&t.rowID<0){let t=this.elements.headerScrollContainer,i=ie(e,t);if(i.x>=0&&i.x<=t.clientWidth){let e=60;i.x<e&&0!==o.x?this._autoScrollInfos.moveX=i.x-e:i.x>t.clientWidth-e&&Math.abs(o.x+t.clientWidth-t.scrollWidth)>=1&&(this._autoScrollInfos.moveX=i.x-(t.clientWidth-e))}}return this._autoScrollInfos.interval||0===this._autoScrollInfos.moveY&&0===this._autoScrollInfos.moveX?0===this._autoScrollInfos.moveX&&0===this._autoScrollInfos.moveY&&ne.call(this):function(e){var t=this,i={x:e.x,y:e.y};this._autoScrollInfos.interval=setInterval(function(){i.x+=t._autoScrollInfos.moveX,i.y+=t._autoScrollInfos.moveY,t.setScrollerPosition(i)},60)}.call(this,o),0!==this._autoScrollInfos.moveY}function le(t){var i=S.Menu,n=F.getTouchMode(),o=n?14:12,l=n?28:14,r={completed:!0,text:i,dataIndex:"ContextualMenuColumn",pinned:"right",editableFlag:!1,sortableFlag:!1,groupableFlag:!1,resizableFlag:!1,selectableFlag:!1,printableFlag:!1,width:Math.max(Math.ceil(f.computeStringWidth(i,o,"Arial",!1,!1))+l,45),alignment:"center",getCellValue:function(e){return{}}};let s=e.merge(t,r);return s.typeRepresentation="chevronMenuIcon",s}var re=new d;return i.inherit({name:"dataGridView",publishedProperties:{identifier:{defaultValue:"",type:"string",readOnly:!0,category:"Behavior"},maxVisibleRowCount:{defaultValue:void 0,type:"number",category:"Behavior"},treeDocument:{defaultValue:null,type:"object"},dataSource:{defaultValue:null,type:"object"},layoutOptions:{defaultValue:null,type:"object",readOnly:!0},virtuallyLoadAllModelItems:{defaultValue:!1,type:"boolean"},syncClientModelOnDemand:{defaultValue:!1,type:"boolean"},cellSelection:{defaultValue:"multiple",type:"string"},defaultColumnDef:{defaultValue:{showTextFlag:!0,description:"",typeRepresentation:"string",getCellTypeRepresentation:function(e){var t=this.layout;return t?t.getColumnTypeRepresentation(e.columnID):"string"},width:"auto",minWidth:40,autoRowHeightFlag:!1,visibleFlag:!0,editableFlag:!1,disabled:!1,editionPolicy:"EditionOnDoubleClick",resizableFlag:!0,selectableFlag:!0,sortableFlag:!0,groupableFlag:!0,printableFlag:!0,massUpdateAllowedFlag:!0,pinned:"unpinned",autoSizePadding:0,allowUnsafeHTMLContent:!1,shouldCellAllowUnsafeHTMLContentAt:function(e){var t=this.layout;return!!t&&t.getColumnAllowUnsafeHTMLContent(e.columnID)},allowResetToUndefinedByUIFlag:!1,className:"",getCellClassName:function(e){var t=this.layout;return!!(t&&e.rowID>=0)&&t.getColumnClassName(e.columnID)},getCellIcons:function(e){if(e.nodeModel&&e.nodeModel.getIcons)return e.nodeModel.getIcons()}},type:"object"},columns:{defaultValue:[],type:"array"},sortModel:{defaultValue:null,type:"array",advancedSetter:!0},sortOptions:{defaultValue:void 0,type:"object"},layout:{defaultValue:null,type:"object"},cellClass:{defaultValue:h,type:"object"},rowGroupingOptions:{defaultValue:{depth:0,hideGroupedColumns:!0,getGroupingNodeOptions:null},type:"object"},onContextualEvent:{defaultValue:function(e){var t=[];return e&&e.collectionView&&(t=e.collectionView.buildDefaultContextualMenu(e)),t},type:"function"},columnSelection:{defaultValue:"none",type:"string"},rowReorderEnabledFlag:{defaultValue:!0,type:"boolean",noNeedToApplyFlag:!0},rowGroupingEnabledFlag:{defaultValue:!0,type:"boolean",noNeedToApplyFlag:!0},columnDragEnabledFlag:{defaultValue:!0,type:"boolean"},onDragStartColumnHeader:{defaultValue:void 0,type:"function"},onDragEndColumnHeader:{defaultValue:void 0,type:"function"},onDragEnterColumnHeader:{defaultValue:void 0,type:"function"},onDragLeaveColumnHeader:{defaultValue:void 0,type:"function"},onDragColumnHeader:{defaultValue:void 0,type:"function"},onDragOverColumnHeader:{defaultValue:void 0,type:"function"},onDropColumnHeader:{defaultValue:void 0,type:"function"},rowDragEnabledFlag:{defaultValue:!1,type:"boolean"},onDragStartRowHeader:{defaultValue:void 0,type:"function"},onDragEndRowHeader:{defaultValue:void 0,type:"function"},onDragEnterRowHeader:{defaultValue:void 0,type:"function"},onDragLeaveRowHeader:{defaultValue:void 0,type:"function"},onDragRowHeader:{defaultValue:void 0,type:"function"},onDragOverRowHeader:{defaultValue:void 0,type:"function"},onDropRowHeader:{defaultValue:void 0,type:"function"},cellDragEnabledFlag:{defaultValue:!1,type:"boolean"},onDragStartCell:{defaultValue:void 0,type:"function"},onDragEndCell:{defaultValue:void 0,type:"function"},onDragEnterCell:{defaultValue:void 0,type:"function"},onDragLeaveCell:{defaultValue:void 0,type:"function"},onDragCell:{defaultValue:void 0,type:"function"},onDragOverCell:{defaultValue:void 0,type:"function"},onDropCell:{defaultValue:void 0,type:"function"},onDragStartBlank:{defaultValue:void 0,type:"function"},onDragEndBlank:{defaultValue:void 0,type:"function"},onDragEnterBlank:{defaultValue:void 0,type:"function"},onDragLeaveBlank:{defaultValue:void 0,type:"function"},onDragBlank:{defaultValue:void 0,type:"function"},onDragOverBlank:{defaultValue:void 0,type:"function"},onDropBlank:{defaultValue:void 0,type:"function"},focusNextEditableCellOnTabFlag:{defaultValue:!1,type:"boolean",noNeedToApplyFlag:!0},selectNextCellOnEnterFlag:{defaultValue:!0,type:"boolean",noNeedToApplyFlag:!0},cellActivationFeedback:{defaultValue:"cell",type:"string"},cellPreselectionFeedback:{defaultValue:"cell",type:"string"},showEditableFeedbackFlag:{defaultValue:!0,type:"boolean"},showRequiredFeedbackFlag:{defaultValue:!0,type:"boolean"},showRowBorderFlag:{defaultValue:!1,type:"boolean"},showColumnBorderFlag:{defaultValue:!1,type:"boolean"},showModelChangesFlag:{defaultValue:!1,type:"boolean"},showAlternateBackgroundFlag:{defaultValue:!0,type:"boolean"},showRowIndexFlag:{defaultValue:!0,type:"boolean"},showSelectionCheckBoxesFlag:{defaultValue:"OnOver",type:"string"},showOutlineFlag:{defaultValue:!1,type:"boolean"},showRowHeaderBackgroundFlag:{defaultValue:!0,type:"boolean"},showContextualMenuColumnFlag:{defaultValue:!1,type:"boolean"},treeNodeCellOptions:{defaultValue:void 0,type:"TreeNodeCellOptions"},showNodeKPIColorFlag:{defaultValue:!1,type:"boolean"},placeholder:{defaultValue:S.get("NoObjectsFound"),type:"string"},getCellTooltip:{defaultValue:null,type:"function",noNeedToApplyFlag:!1},useAsyncPreExpand:{defaultValue:void 0,type:"boolean"},selectionStyle:{defaultValue:"",type:"string"},findNavigationMode:{defaultValue:"substring",type:"string"},showMatchingCellBackgroundFlag:{defaultValue:!1,type:"boolean"},shouldNodeBeRepresented:{defaultValue:function(e){return!0},type:"function",noNeedToApplyFlag:!0},nodeModelClass:{defaultValue:a,type:"function",noNeedToApplyFlag:!0},customViewsOptions:{defaultValue:void 0,type:"object",noNeedToApplyFlag:!0},filterOptions:{defaultValue:void 0,type:"object",noNeedToApplyFlag:!0}},_useTreeDocumentRestoration:!0,_currentlyCalledFromApplyPreferencesFlag:!1,_manageKeyboard:function(){this._parent();const t=Object.assign({},this.commands);e.extend(t,{rightMove:function(){const e=this.computeCellIDFromActiveCell("right");if("row"===this.cellActivationFeedback){const t=this.getCellInfosAt(e);t&&t.nodeModel&&t.nodeModel.getChildren()&&"noExpandState"!==t.nodeModel._expandState&&"expandingState"!==t.nodeModel._expandState&&(!t.nodeModel.isExpanded()||"partiallyExpandedState"===t.nodeModel._expandState)&&t.nodeModel.expand()}else this.selectionBehavior.toggle?this.setActiveCell(e):this.selectCell(e,!1,!1);return{preventDefault:!0}},leftMove:function(){const e=this.computeCellIDFromActiveCell("left");if("row"===this.cellActivationFeedback){const t=this.getCellInfosAt(e);t&&t.nodeModel&&t.nodeModel.getChildren()&&"noExpandState"!==t.nodeModel._expandState&&"expandingState"!==t.nodeModel._expandState&&t.nodeModel.isExpanded()&&"partiallyExpandedState"!==t.nodeModel._expandState&&t.nodeModel.collapse()}else this.selectionBehavior.toggle?this.setActiveCell(e):this.selectCell(e,!1,!1);return{preventDefault:!0}}}),this.commands=t},_preBuildView:function(e){this._editionManagers=[],this._useClipboardFlag=!0,this._properties.layout.value=new n(e?e.layoutOptions:e),this._properties.treeNodeCellOptions.value={showIconsFlag:!0,buildLinks:!0,expanderStyle:"classic",depthIncrement:22,cellClass:m},this._contextualMenuBuilder=new w(this),this._selectAllCheckBoxListenChange=!0,this._hasFlatTreeState=!0,this._tweakerToGenerateCount=0,this._inOnAllCellsRendered=!1,this._resetRowHeightsOnAllCellsRenderedFlag=!1,this._modelMassUpdateDialog=null,this._asyncExpandSubscribed=!1,this._asyncExpandToken=null,this._customViewsManager=new p({collectionView:this}),this._rowReorderDnDInfos={elements:{line:null,chip:null},direction:-1,dropAccepted:!1},this._disableRowReorderCpt=0,this._autoScrollInfos={interval:null,moveX:0,moveY:0},this._parent(e)},buildView:function(){this._parent(),this.getContent().classList.add("wux-layouts-datagridview"),this.elements.rowHeaderExtension=new e.Element("div",{class:"wux-datagridview-layouts-row-header-extension"}),this.elements.rowHeaderExtensionHeaderPoolContainer=new e.Element("div",{class:"wux-datagridview-layouts-row-header-extension-header-poolcontainer"}).inject(this.elements.rowHeaderExtension),this.elements.rowHeaderExtensionScrollContainer=new e.Element("div",{class:"wux-datagridview-layouts-row-header-extension-scroll-container"}),this.elements.rowHeaderExtensionPoolContainer=new e.Element("div",{class:"wux-datagridview-layouts-row-header-extension-poolcontainer"}).inject(this.elements.rowHeaderExtensionScrollContainer),this.elements.rowHeaderExtensionScrollContainer.inject(this.elements.rowHeaderExtension),this.elements.rowHeaderExtension.inject(this.elements.container)},_handleEvents:function(){this._parent();var e=this.elements.scroller;f.addEventOnElement(this,this.elements.rowHeaderExtensionPoolContainer,"wheel",function(t){var i=t.deltaY;t.deltaMode&&1===t.deltaMode&&(i*=this.layout.cellHeight),e.setPosition({y:e.elements.container.scrollTop+i},!0)});var t=this;f.addEventOnElement(this,this,"change",function(e,i){if(t._isCurrentlyCalledFromUIInteraction()&&i&&i.columnID>=0&&i.cellView&&i.rowID>=0){t._rowModel&&t._rowModel._isServerSide()&&(t.findCtx?t.findCtx.close():t.findWidget&&t.findWidget.close());var n=i.cellView.getReusableContent();if(n){var o=n.value,l=n.referenceValue;t.setModelAt(i.cellID,o,l),t._matchingCellIDsArray&&!t._muteFind&&t.setFindStr(t.findStr,t.matchCase,t._rowModel._computeFindEditorCurrentValue(),!0,!0)}}})},_applyProperties:function(e){this._parent(e),this.isDirty("identifier")&&this._applyIdentifier(e.identifier),this.isDirty("dataSource")&&this._applyDataSource(e.dataSource),this.isDirty("virtuallyLoadAllModelItems")&&this._applyVirtuallyLoadAllModelItems(e.virtuallyLoadAllModelItems),this.isDirty("treeDocument")&&this._applyTreeDocument(e.treeDocument),this.isDirty("defaultColumnDef")&&this._applyDefaultColumnDef(e.defaultColumnDef),this.isDirty("layout")&&this._applyLayout(e.layout),this.isDirty("columns")&&this._applyColumns(e.columns),this.isDirty("showContextualMenuColumnFlag")&&this._applyShowContextualMenuColumnFlag(e.showContextualMenuColumnFlag),this.isDirty("sortModel")&&T._applyForAdvancedSetterProperty(this,"sortModel",e.sortModel,this.sortModel),this.isDirty("columnSelection")&&this._applyColumnSelection(e.columnSelection),this.isDirty("columnDragEnabledFlag")&&this._applyColumnDragEnabledFlag(e.columnDragEnabledFlag),this.isDirty("rowDragEnabledFlag")&&this._applyRowDragEnabledFlag(e.rowDragEnabledFlag),this.isDirty("cellDragEnabledFlag")&&this._applyCellDragEnabledFlag(e.cellDragEnabledFlag),this.isDirty("cellActivationFeedback")&&this._applyCellActivationFeedback(e.cellActivationFeedback),this.isDirty("cellPreselectionFeedback")&&this._applyCellPreselectionFeedback(e.cellPreselectionFeedback),this.isDirty("showEditableFeedbackFlag")&&this._applyShowEditableFeedbackFlag(e.showEditableFeedbackFlag),this.isDirty("showRequiredFeedbackFlag")&&this._applyShowRequiredFeedbackFlag(e.showRequiredFeedbackFlag),this.isDirty("showRowBorderFlag")&&this._applyShowRowBorderFlag(e.showRowBorderFlag),this.isDirty("showColumnBorderFlag")&&this._applyShowColumnBorderFlag(e.showColumnBorderFlag),this.isDirty("showAlternateBackgroundFlag")&&this._applyShowAlternateBackgroundFlag(e.showAlternateBackgroundFlag),this.isDirty("showRowIndexFlag")&&this._applyShowRowIndexFlag(e.showRowIndexFlag),this.isDirty("showSelectionCheckBoxesFlag")&&this._applyShowSelectionCheckBoxesFlag(e.showSelectionCheckBoxesFlag),this.isDirty("showOutlineFlag")&&this._applyShowOutlineFlag(e.showOutlineFlag),this.isDirty("showRowHeaderBackgroundFlag")&&this._applyShowRowHeaderBackgroundFlag(e.showRowHeaderBackgroundFlag),this.isDirty("treeNodeCellOptions")&&this._applyTreeNodeCellOptions(e.treeNodeCellOptions),this.isDirty("showNodeKPIColorFlag")&&this._applyShowNodeKPIColorFlag(e.showNodeKPIColorFlag),this.isDirty("rowGroupingOptions")&&this._applyRowGroupingOptions(e.rowGroupingOptions),this.isDirty("placeholder")&&this._applyPlaceholder(e.placeholder),this.isDirty("useAsyncPreExpand")&&this._applyUseAsyncPreExpand(e.useAsyncPreExpand),this.isDirty("selectionStyle")&&this._applySelectionStyle(e.selectionStyle),this.isDirty("findNavigationMode")&&this._applyFindNavigationMode(e.findNavigationMode),this.isDirty("showMatchingCellBackgroundFlag")&&this._applyShowMatchingCellBackgroundFlag(e.showMatchingCellBackgroundFlag)},_applyMaxVisibleRowCount:function(e,t,i){if(void 0!==this.maxVisibleRowCount){var n=this._rowModel?this._rowModel.getRowModelLength():0,o=0===n?0:this.layout.getRowHeight(0),l=0===n?0:this.layout.rowSpacing,r=this.layout.getHeaderContainerHeight(),s=Math.min(this.maxVisibleRowCount,n);this._heightForGivenRowCount=o*s+l*(s-1)+r,this._updateDimensions(),!0!==i&&this.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})}},_applyTouchMode:function(){this._parent();let e=F.getTouchMode();W=e?8:4},_applyVirtualViewportSize:function(){this._parent(),void 0!==this.maxVisibleRowCount&&void 0!==this._heightForGivenRowCount&&(this._hasLeftContainerHorizontalOverflow||this._hasCenterContainerHorizontalOverflow||this._hasRightContainerHorizontalOverflow?this.height=this._heightForGivenRowCount+C.getScrollbarWidth():this.height=this._heightForGivenRowCount);var e=this.layout,t=this.getStatusBarContainerHeight();this.elements.rowHeaderExtension.setStyle("bottom",t+"px");var i=e.rowsHeader?e.getRowHeaderWidth():0;e.rowsHeader?(this.elements.rowHeaderExtension.removeAttribute("hideBorder"),this.elements.rowHeaderExtension.style.width=i+"px"):(this.elements.rowHeaderExtension.setAttribute("hideBorder",""),this.elements.rowHeaderExtension.style.width="0px");var n=this._headerContainerHeight;this._rowHeaderExtensionHeaderContainerHeight!==n&&(this._rowHeaderExtensionHeaderContainerHeight=n,this.elements.rowHeaderExtensionHeaderPoolContainer.setStyle("height",this._headerContainerHeight));var o=this.__cachedContentDimensions.height+(this._hasCenterContainerHorizontalOverflow?0:1);this._rowHeaderExtensionContainerHeight!==o&&(this._rowHeaderExtensionContainerHeight=o,this.elements.rowHeaderExtensionScrollContainer.setStyle("height",o),this.elements.rowHeaderExtensionPoolContainer.setStyle("height",o));var l=this.getScrollerPosition();if(this.elements.rowHeaderExtensionPoolContainer.setStyle("top",(l?-l.y:0)+"px"),this.hasLeftContainer()&&this._rowHeaderWidth!==i){this._rowHeaderWidth=i;var r=i;this.elements.leftHeaderScrollContainer.setStyle("left",r),this.elements.leftScrollContainer.setStyle("left",r),this.elements.leftSpacerContainer.setStyle("left",r)}},_applyModel:function(e){this._parent(e),this.layout&&(this.layout.resetRowHeights(),this.layout.hasColumnWithAutoRowHeightFlag()&&this._resetRowHeightsOnAllCellsRendered());var t=this._activeCellStableID;this._updateXSOElements(),this._updateActiveCell(t)},_applyHeight:function(e){e!==this.height&&(this._parent(),"inherit"!==this.height&&(this.elements.container.style.position&&"static"!==this.elements.container.style.position||(this.elements.container.style.position="relative")))},_flashEffectOnRow:function(e,t){var i=this.getNodeModelAtRowID(t);i&&this.flashEffectOnNodeModel(e,i)},getFilterViewManager:function(){if(this._rowModel)return this._rowModel.getFilterViewManager()},getUseClipboardFlag:function(){return this._useClipboardFlag},setUseClipboardFlag:function(e){this._useClipboardFlag=e},_applyDataSource:function(e){this.dataSource&&e!==this.dataSource&&(void 0===this._rowModel&&(this._rowModel=new l({dataGridView:this,sortModel:this.sortModel,rowGroupingOptions:this.rowGroupingOptions,virtuallyLoadAllModelItems:this.virtuallyLoadAllModelItems})),this.dataSource&&this.dataSource!==this._rowModel.dataSource&&(this._rowModel.dataSource=this.dataSource,this._rowModel._setFilterViewManager(this.dataSource)))},_applyIdentifier:function(e){this.identifier?this.getContent().setAttribute("wux-identifier",this.identifier):this.getContent().removeAttribute("wux-identifier")},_applyVirtuallyLoadAllModelItems:function(e){this._rowModel&&this._rowModel.dataSource&&(this._rowModel.virtuallyLoadAllModelItems=this.virtuallyLoadAllModelItems)},_applyTreeDocument:function(e){e&&this.treeDocument!==e&&(this._unsubscribeToPreExpand(e),this._useTreeDocumentRestoration&&A.destroyTreeDocumentOrderSnapshot(e)),this.treeDocument&&(void 0===this._rowModel?this._rowModel=new o({dataGridView:this,sortModel:this.sortModel,rowGroupingOptions:this.rowGroupingOptions,treeDocument:this.treeDocument}):this._rowModel.treeDocument=this.treeDocument,this.treeDocument!==e&&this._subscribeToPreExpand(this.treeDocument))},_applyUseAsyncPreExpand:function(e){var t=this.getTreeDocument();t&&void 0!==this.useAsyncPreExpand&&(t.options.useAsyncPreExpand=this.useAsyncPreExpand)},_applySelectionStyle:function(e){"lightSelectionEdging"===this.selectionStyle?this.getContent().setAttribute("selection-style",this.selectionStyle):this.getContent().removeAttribute("selection-style")},_applyFindNavigationMode:function(e){if(this.getContent().setAttribute("find-navigation-mode",this.findNavigationMode),this.findStr&&""!=this.findStr&&!this._muteFind){var t=void 0===this._currentMatchingStringIndex?0:this._currentMatchingStringIndex+1;this.setFindStr(this.findStr,this.matchCase,t,!0,!0)}},_applyShowMatchingCellBackgroundFlag:function(e){this.showMatchingCellBackgroundFlag?this.getContent().setAttribute("show-matching-cell-background",""):this.getContent().removeAttribute("show-matching-cell-background")},_unsubscribeToPreExpand:function(e){e&&this._asyncExpandToken&&e.getModelEvents()&&e.getModelEvents().unsubscribe(this._asyncExpandToken),this._asyncExpandSubscribed=!1,this._asyncExpandToken=null},_subscribeToPreExpand:function(e){if(e&&!this._asyncExpandSubscribed){this._asyncExpandSubscribed=!0;var t=this;this._asyncExpandToken=e.getModelEvents().subscribe({event:"preExpandPrivate"},function(i){if(e.useAsyncPreExpand){var n=i.target,o=t.layout.getColumnIndex("tree");if(void 0!==o){var l=t.layout.getCellIDFromCoordinates({rowID:n._getRowID(),columnID:o}),r=t._getViewAt(l);r&&(r.elements.expanderContainer.setAttribute("data-wux-state","expanding"),e.getModelEvents().subscribeOnce({event:"PRE_EXPAND_DONE"},function(e){var t=n.getChildren();"collapsed"===n.getState()?r.elements.expanderContainer.setAttribute("data-wux-state","collapsed"):t&&0!==t.length?"partiallyExpanded"===n.getState()?r.elements.expanderContainer.setAttribute("data-wux-state","partiallyExpanded"):r.elements.expanderContainer.setAttribute("data-wux-state","expanded"):r.elements.expanderContainer.setAttribute("data-wux-state","noChildren")}))}}})}},hasFlatTreeState:function(){return this._hasFlatTreeState},_applyDefaultColumnDef:function(e){var t=this.defaultColumnDef;void 0===t.showTextFlag&&(t.showTextFlag=!0),void 0===t.description&&(t.description=""),void 0===t.typeRepresentation&&(t.typeRepresentation="string"),void 0===t.getCellTypeRepresentation&&(t.getCellTypeRepresentation=function(e){var t=this.layout;return t?t.getColumnTypeRepresentation(e.columnID):"string"}),void 0===t.width&&(t.width="auto"),void 0===t.minWidth&&(t.minWidth=40),void 0===t.autoRowHeightFlag&&(t.autoRowHeightFlag=!1),void 0===t.visibleFlag&&(t.visibleFlag=!0),void 0===t.editableFlag&&(t.editableFlag=!1),void 0===t.disabled&&(t.disabled=!1),void 0===this.defaultColumnDef.editionPolicy&&(this.defaultColumnDef.editionPolicy="EditionOnDoubleClick"),void 0===t.resizableFlag&&(t.resizableFlag=!0),void 0===t.selectableFlag&&(t.selectableFlag=!0),void 0===t.sortableFlag&&(t.sortableFlag=!0),void 0===t.findableFlag&&(t.findableFlag=!0),void 0===t.groupableFlag&&(t.groupableFlag=!0),void 0===t.printableFlag&&(t.printableFlag=!0),void 0===t.massUpdateAllowedFlag&&(t.massUpdateAllowedFlag=!0),void 0===t.pinned&&(t.pinned="unpinned"),void 0===t.autoSizePadding&&(t.autoSizePadding=0),void 0===t.allowUnsafeHTMLContent&&(t.allowUnsafeHTMLContent=!1),void 0===t.shouldCellAllowUnsafeHTMLContentAt&&(t.shouldCellAllowUnsafeHTMLContentAt=function(e){var t=this.layout;return!!t&&t.getColumnAllowUnsafeHTMLContent(e.columnID)}),void 0===t.allowResetToUndefinedByUIFlag&&(t.allowResetToUndefinedByUIFlag=!1),void 0===t.className&&(t.className=""),void 0===t.getCellClassName&&(t.getCellClassName=function(e){var t=this.layout;return!!(t&&e.rowID>=0)&&t.getColumnClassName(e.columnID)}),void 0===t.getCellIcons&&(t.getCellIcons=function(e){if(e.nodeModel&&e.nodeModel.getIcons)return e.nodeModel.getIcons()})},_applyColumns:function(e){var t=this.layout;if(t){if(this.showContextualMenuColumnFlag){var i=this._getColumnOrGroup(this.columns,"ContextualMenuColumn");i?i.completed||le(i):(i=le({}),this.columns.push(i))}t.columns=this.columns,t.hasAutoWidthColumn()?this.getContent().setAttribute("has-auto-width-column",""):this.getContent().removeAttribute("has-auto-width-column"),t._getColumnTreeDepth()>1?this.getContent().setAttribute("has-column-groups",""):this.getContent().removeAttribute("has-column-groups")}},_applyShowContextualMenuColumnFlag:function(e){var t=this.layout;this.showContextualMenuColumnFlag&&!this._getColumnOrGroup(this.columns,"ContextualMenuColumn")&&(this._applyColumns(this.columns),t._applyColumns(t.columns)),this._getColumnOrGroup(this.columns,"ContextualMenuColumn")&&t.setColumnVisibleFlag("ContextualMenuColumn",!0===this.showContextualMenuColumnFlag)},_getColumnOrGroup:function(e,t,i){for(var n,o=0;o<e.length;o++){var l=e[o];if(l){if(!(l.dataIndex!==t||i&&i!==this.layout._getColumnGroupIndexInItsRow(l))){n=l;break}if(l.children&&(n=this._getColumnOrGroup(l.children,t,i)))break}}return n},getColumnOrGroup:function(e,t){var i=this.layout,n="string"==typeof e?e:i.getColumnIdentifiers(e).dataIndex;return this._getColumnOrGroup(i._balancedColumnTree,n,t)},_addColumnOrGroup:function(e,t,i){for(let n of t){let t=!1;if(n.dataIndex)for(let o of e)if(n.dataIndex===o.dataIndex){t=!0,n.children&&(o.children?this._addColumnOrGroup(o.children,n.children,i):o.children=n.children);break}if(!t){let t=void 0===i||i>e.length?e.length:i;e.splice(t,0,n)}}},addColumnOrGroup:function(e,t){var i=this.columns;i||(this.columns=[],i=this.columns),this._addColumnOrGroup(i,[e],t),this.layout.applyColumns(),this.requestDelayedModelData("OnAddColumn")},_removeColumnOrGroup:function(e,t){for(var i=0,n=0;n<e.length;n++){var o=e[n];if(o){if(o.dataIndex===t){e.splice(n,1),o._parent=null,i=1;break}if(o.children&&(i=this._removeColumnOrGroup(o.children,t))){0===o.children.length&&delete o.children;break}}}return i},removeColumnOrGroup:function(e){var t=this.layout.getColumnIdentifiers(e).dataIndex;this._removeColumnOrGroup(this.columns,t)&&this.layout.applyColumns()},_preEditSortModel:function(e,t){const i=this.sortOptions?this.sortOptions.maxSortedColumnsCount:void 0;if(!(!t||"number"!=typeof i||t.length<=i)){const n=this.sortOptions.onOutOfBoundSortRequest;n&&f.isCurrentlyCalledFromUIInteraction()&&n({currentSortModel:e,rejectedSortModel:t});let o=[...t];return o.length=i,{validValue:o}}return!0},_applySortModel:function(e){this._rowModel&&(this._rowModel.sortModel=this.sortModel,this.fire("sortModelChange"))},_applySortOptions(e,t){if(t&&"number"==typeof t.maxSortedColumnsCount){let e=this.sortModel;!this.isDirty("sortModel")&&e&&e.length>t.maxSortedColumnsCount&&(e.length=t.maxSortedColumnsCount)}},_applyLayout:function(e){this._parent(e)},_applyColumnSelection:function(){if(this.getContent().setAttribute("column-selection",this.columnSelection),"none"===this.columnSelection||this._columnsXSO)"none"===this.columnSelection&&this._columnsXSO&&this._columnsXSO.empty();else{var e=this;this._columnsXSO=new G({useUniqueID:!0,getElementID:this.getXSOColumnID}),this._columnsXSO.onPostAdd(function(t){if(t.forEach(function(t){const i=t;e.updateColumnView(i,{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})}),e._updateColumnHeaderCells({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}),e._modelMassUpdateDialog){const t=e._buildMassUpdateDialogAttributes();e._modelMassUpdateDialog.attributes=t,e._modelMassUpdateDialog.resetAttributesValues()}}),this._columnsXSO.onPostRemove(function(t){if(t.forEach(function(t){const i=t;e.updateColumnView(i,{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})}),e._updateColumnHeaderCells({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}),e._modelMassUpdateDialog){const t=e._buildMassUpdateDialogAttributes();e._modelMassUpdateDialog.attributes=t,e._modelMassUpdateDialog.resetAttributesValues()}})}this._isReady&&this._renderViewport({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})},_applyColumnDragEnabledFlag:function(e){},_applyRowDragEnabledFlag:function(e){this._updateFromRowDragEnabledState(),this.invalidateLayout({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1})},_applyCellDragEnabledFlag:function(e){},_applyCellActivationFeedback:function(e){this.cellActivationFeedback&&"none"!==this.cellActivationFeedback?this.getContent().setAttribute("cell-activation-feedback",this.cellActivationFeedback):this.getContent().removeAttribute("cell-activation-feedback")},_applyRowSelection:function(e){this._parent(e),this._applyCellPreselectionFeedback()},_applyCellSelection:function(e){this._parent(e),this._applyCellPreselectionFeedback()},getUsedCellPreselectionFeedback:function(){if(void 0===this._usedCellPreselectionFeedback){var e=this.cellPreselectionFeedback;if("cell"===e){var t=this.cellSelection;"single"!==t&&"multiple"!==t&&(e="row")}this._usedCellPreselectionFeedback=e}return this._usedCellPreselectionFeedback},_applyCellPreselectionFeedback:function(e){this._usedCellPreselectionFeedback=void 0;var t=this.getUsedCellPreselectionFeedback();t&&"none"!==t?this.getContent().setAttribute("cell-preselection-feedback",t):this.getContent().removeAttribute("cell-preselection-feedback")},_applyShowEditableFeedbackFlag:function(e){this.invalidateLayout({updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})},_applyShowRequiredFeedbackFlag:function(e){this.invalidateLayout({updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})},_applyShowRowBorderFlag:function(e,t){this.showRowBorderFlag?this.getContent().setAttribute("show-row-border",""):this.getContent().removeAttribute("show-row-border"),this.layout&&this.layout.resetRowHeights()},_applyShowColumnBorderFlag:function(e,t){this.showColumnBorderFlag?this.getContent().setAttribute("show-column-border",""):this.getContent().removeAttribute("show-column-border")},_applyShowModelChangesFlag:function(e){this.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})},_applyShowAlternateBackgroundFlag:function(e){this.showAlternateBackgroundFlag?this.getContent().setAttribute("show-alternate-background",""):this.getContent().removeAttribute("show-alternate-background")},_applyShowRowIndexFlag:function(e){this.showRowIndexFlag?this.getContent().setAttribute("show-row-index",""):this.getContent().removeAttribute("show-row-index"),this.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})},_applyShowSelectionCheckBoxesFlag:function(e){!1!==this.showSelectionCheckBoxesFlag?this.getContent().setAttribute("show-selection-check-boxes",this.showSelectionCheckBoxesFlag):this.getContent().removeAttribute("show-selection-check-boxes"),this.invalidateLayout({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1})},_applyShowOutlineFlag:function(e){this.showOutlineFlag?this.getContent().setAttribute("show-outline",""):this.getContent().removeAttribute("show-outline")},_applyShowRowHeaderBackgroundFlag:function(e){this.showRowHeaderBackgroundFlag?this.getContent().setAttribute("show-row-header-background",""):this.getContent().removeAttribute("show-row-header-background")},_applyTreeNodeCellOptions:function(e){if(this._isReady){var t=this.layout.getColumnIndex("tree");t>=0&&this.updateColumnView(t,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}},_applyShowNodeKPIColorFlag:function(e){this.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})},_applyPlaceholder:function(e){this.model&&0===this.model.length&&(this._removeEmptyContentMessage(),this.placeholder&&""!==this.placeholder&&this._displayEmptyContentMessage())},_updateFromRowDragEnabledState:function(){this.rowDragEnabledFlag?this.getContent().setAttribute("row-drag-enabled",""):this.getContent().removeAttribute("row-drag-enabled")},reapplySortModel:function(){this._rowModel&&this._rowModel._applySortModel(this.sortModel)},initialize:function(){this.getContent().setAttribute("layout-density",this.layout.layoutDensity),this._manageCellRequests(),this.dataSource&&this._applyDataSource(),this.treeDocument&&this._applyTreeDocument(),this.sortModel?this.reapplySortModel():this._rowModel&&this._rowModel._resetTreeDocument&&this._rowModel._resetTreeDocument(),this._applyColumns(),this.layout._applyColumnGroupsExpandedFlag(),!this.hasLeftContainer()&&this.layout.hasCellsInLeftContainer()&&this._createLeftFixedContainer(),!this.hasRightContainer()&&this.layout.hasCellsInRightContainer()&&this._createRightFixedContainer(),this.layout._applyPreferencesOnColumns(),void 0!==this.maxVisibleRowCount&&this._applyMaxVisibleRowCount(void 0,this.maxVisibleRowCount,!0),this._manageUserInteractions(),this._manageDragAndDrop(),this.paginationManager&&this.paginationManager.updatePagination()},getCustomViewsManager:function(){return this._customViewsManager},destroy:function(){this._unsubscribeToPreExpand(this.getTreeDocument()),this._modelMassUpdateDialog&&(this._modelMassUpdateDialog.destroy(),this._modelMassUpdateDialog=null),this._rowModel&&this._rowModel.destroy(),this._rowModel=null,this._customViewsManager&&(this._customViewsManager.destroy(),this._customViewsManager=null),this.layout.destroy(),this._toolbar=null,this._parent()},_displayEmptyContentMessage:function(){if(!this.elements.poolContainerSync.querySelector(".wux-datagridview-emptycontentmessage")){var t=e.createElement("div",{class:"wux-datagridview-emptycontentmessage"}),i=e.createElement("div");void 0!==this.placeholder&&null!==this.placeholder||(this.placeholder=""),"string"==typeof this.placeholder?i.textContent=this.placeholder:(e.is(this.placeholder,"element")&&(this.placeholder=new e.extendElement(this.placeholder)),this.placeholder.inject(i)),i.inject(t),t.inject(this.elements.poolContainerSync)}},_removeEmptyContentMessage:function(){var e=this.elements.poolContainerSync.querySelector(".wux-datagridview-emptycontentmessage");e&&e.parentElement&&e.parentElement.removeChild(e)},_registerPools:function(){this._parent(),this._registerPool("__row_header__",null,g),this._registerPool("__topleft_row_header__",this.elements.rowHeaderExtensionHeaderPoolContainer,g),this._registerPool("__top_item__",this.elements.headerPoolContainer,c);var e=this.treeNodeCellOptions&&this.treeNodeCellOptions.cellClass?this.treeNodeCellOptions.cellClass:m;this._registerPool("__tree_item__",this.elements.poolContainer,e),this._registerPool("__odd_row__",null,u),this._registerPool("__even_row__",null,u)},_createLeftFixedContainer:function(){this._parent(),this._registerPool("__topleft_item__",this.elements.leftHeaderPoolContainer,c);var e=this.treeNodeCellOptions&&this.treeNodeCellOptions.cellClass?this.treeNodeCellOptions.cellClass:m;this._registerPool("__left_tree_item__",this.elements.leftPoolContainer,e),this._registerPool("__left_odd_row__",null,u),this._registerPool("__left_even_row__",null,u)},_createRightFixedContainer:function(){this._parent(),this._registerPool("__topright_item__",this.elements.rightHeaderPoolContainer,c);var e=this.treeNodeCellOptions&&this.treeNodeCellOptions.cellClass?this.treeNodeCellOptions.cellClass:m;this._registerPool("__right_tree_item__",this.elements.rightPoolContainer,e),this._registerPool("__right_odd_row__",null,u),this._registerPool("__right_even_row__",null,u)},getTreeDocument:function(){return this._rowModel?this._rowModel._getTreeDocument():void 0},getTypeRepresentationFactory:function(){return re},supportsKeyboardNavigation:function(){return!0},supportsSelection:function(){return!0},supportsLightRendering:function(){return!0},supportsCustomScrolling:function(){return!0},setToolbar:function(e){var t="object"==typeof e?e:JSON.parse(e),i=this.getTypeRepresentationFactory();if(t.enums)for(var n in t.enums)i.registerEnum(n,t.enums[n]);t.typeRepresentations&&i.registerTypeRepresentations(t.typeRepresentations);var o=I.prototype.createTreeDocument(t);return this._toolbar=new I({items:o,overflowManagement:"dropdown",direction:"horizontal",typeRepresentationFactory:i,executionContext:this}),this._toolbar},getToolbar:function(){return this._toolbar},getCellCssClassesAt:function(e){var t=this.layout,i=this._parent(e),n=t.getColumnGetCellClassName(e.columnID);if(n){var o=n.call(this,e);o&&""!=o&&(i+=" "+o)}return i},getCellAttributesAt:function(e){var t=this.layout,i=this._parent(e);if(e.rowID<=-1){if(this.columnDragEnabledFlag){i.draggable=!0;var n=this.columnSelection,o=t.getColumnOrGroupFromCoordinates(e);e.columnID>=0&&("single"===n&&e.rowID<-1||!t.getColumnOrGroupSelectableState(o))&&(i.unselectable=!0),this._draggedColumnOrGroup&&o&&o._isMoving&&(i["is-moving"]=!0)}if(-1===e.rowID){var l=t._getCellTypeRepresentation(e);l&&(i["type-representation"]=l);var r=this.sortModel;if(r&&r.length>0){for(var s,a=t.getDataIndexFromColumnIndex(e.columnID),d=0;d<r.length;d++)if(r[d].dataIndex===a){s=r[d].sort;break}void 0!==s&&(i["sort-direction"]=s,r.length>1&&(i["sort-order"]=d+1))}}}else{var u=this.getNodeModelAtRowID(e.rowID);if(u&&(u.getChangeStates()&WUXModelChangeStates.NodeToBeRemoved?i["to-be-removed"]=!0:u.getChangeStates()&WUXModelChangeStates.NodeAdded&&(i.added=!0),-1===e.columnID?this._rowModel&&!this._rowModel.shouldBeSelected(u)&&(i.unselectable=!0):e.columnID>=0&&this.cellDragEnabledFlag&&(this.isCellInEdition(e.cellID)||(i.draggable=!0)),!this._muteFind&&this._currentMatchingCellIDIndex>=0&&("row"===this.findNavigationMode?(this._currentMatchingRowIDIndex>=0&&this._matchingNodeModelsArray.length>this._currentMatchingRowIDIndex&&this._matchingNodeModelsArray[this._currentMatchingRowIDIndex]._getRowID()===e.rowID&&(i["current-matching-cell"]=""),this._matchingNodeModelsMap&&void 0!==this._matchingNodeModelsMap[e.rowID]&&(i["match-search"]="")):e.cellID===this._getMatchingCellID(this._currentMatchingCellIDIndex)&&(i["current-matching-cell"]=""),this._matchingCellIDsMap&&void 0!==this._matchingCellIDsMap[e.cellID]&&(i["match-search"]=""))),e.columnID>=0){var h=t.getColumnEditionPolicy(e.columnID);"EditionInPlace"!==h&&(i.lite=""),this.showRequiredFeedbackFlag&&this.getCellRequiredState(e.cellID)&&(i["is-required"]=""),this.showEditableFeedbackFlag&&"EditionInPlace"!==h&&this.getCellEditableState(e.cellID)&&(i["is-editable"]="")}if(this._draggedColumnOrGroup){var c=t.getLeafColumns()[e.columnID];c&&c._isMoving&&(i["is-moving"]=!0,c._isFirstColumnMoving&&(i["is-first-column-moving"]=!0))}var g=t.getColumnGetCellAttributes(e.columnID);if(g){var m=g.call(this,e),p=Object.keys(m);for(d=0;d<p.length;d++)i[p[d]]=m[p[d]]}}return i},setPreselectedCell:function(e){if(!F.getTouchMode()){var t=this.getPreselectedCellID();if(this._parent(e),t!==e){this._preselectedCellStableID=void 0!==e?this._getXSOElementFromCellID(e):void 0;var i,n=this._preselectedRowID;if(void 0!==e)i=this.layout.getCellCoordinatesAt(e).rowID;n!==i&&(this._preselectedRowID=i,void 0!==n&&this._updateRenderedRowCellsAttributes(n),void 0!==this._preselectedRowID&&this._updateRenderedRowCellsAttributes(this._preselectedRowID));const l=this.getPreselectedCellID(),r=this.getUsedCellPreselectionFeedback();function o(e){const t=this.layout.getCellCoordinatesAt(e),i=this.layout.getCellIDFromCoordinates({rowID:-1,columnID:t.columnID}),n=this.layout.getCellIDFromCoordinates({rowID:t.rowID,columnID:-1});this._updateRenderedCellAttributes(i),this._updateRenderedCellAttributes(n)}t!==l&&"cell"===r&&(void 0!==n&&o.call(this,t),void 0!==l&&o.call(this,l))}}},_updateRenderedRowCellsAttributes:function(e){var t=this.layout,i=e<0;if(!i){var n=t.getMinMaxVisibleRowIDs();e>=n.minRowID&&e<=n.maxRowID&&(i=!0)}if(i)for(var o=t.getLeafColumns().length,l=t._leftPinnedRowColumnID;l<o;l++)this._updateRenderedCellAttributes(t.getCellIDFromCoordinates({rowID:e,columnID:l}))},_updateRenderedActiveCell:function(e){if(this._updateRenderedCellAttributes(e),"row"===this.cellActivationFeedback){var t=this.layout,i=t.getCellCoordinatesAt(e);this._updateRenderedCellAttributes(t.getCellIDFromCoordinates({rowID:i.rowID,columnID:t._leftPinnedRowColumnID})),this._updateRenderedCellAttributes(t.getCellIDFromCoordinates({rowID:i.rowID,columnID:t._unpinnedRowColumnID})),this._updateRenderedCellAttributes(t.getCellIDFromCoordinates({rowID:i.rowID,columnID:t._rightPinnedRowColumnID}))}},updateRenderedRow:function(e,t){return this.updateRowView(e,t)},updateRowView:function(e,t){var i=this.layout,n=e<0;if(!n){var o=i.getMinMaxVisibleRowIDs();e>=o.minRowID&&e<=o.maxRowID&&(n=!0)}if(n){this._isPrivateRendering(!0);for(var l=i.getLeafColumns().length,r=i._leftPinnedRowColumnID;r<l;r++)this.updateCellView(i.getCellIDFromCoordinates({rowID:e,columnID:r}),t);this._isPrivateRendering(!1)}},updateRenderedColumn:function(e,t){return this.updateColumnView(e,t)},updateColumnView:function(e,t){this._isPrivateRendering(!0);for(var i=this.layout,n=i.getMinMaxVisibleRowIDs(),o=n.minRowID;o<=n.maxRowID;o++)this.updateCellView(i.getCellIDFromCoordinates({rowID:o,columnID:e}),t);this._isPrivateRendering(!1)},_updateColumnHeaderCells:function(e){for(var t=this.layout,i=3+(t.rowsHeader?1:0),n=0;n<t._columnItemsByDepth.length;n++)for(var o=t._columnItemsByDepth[n],l=0;l<o.length;l++)this.updateCellView(i,e),i++},_freeUpColumnCells:function(e,t){for(var i=this.layout,n=this.getModelLength(),o=i.columnsHeader?-1:0;o<n;o++)this._freeUpCell(i.getCellIDFromCoordinates({rowID:o,columnID:e}),t)},_endRendering:function(){this._parent(),0!==this._tweakerToGenerateCount||this._activeScroller||this._onAllCellsRendered()},_onAllCellsRendered:function(){if(!this._inOnAllCellsRendered&&this.isInitialized()){if(this._inOnAllCellsRendered=!0,this._resetRowHeightsOnAllCellsRenderedFlag&&(this._resetRowHeightsOnAllCellsRenderedFlag=!1,this.layout.resetRowHeights()),this._inOnAllCellsRendered=!1,this._allCellsRenderedCallBacks)for(var e=this._allCellsRenderedCallBacks.length-1;e>=0;e--){var t=this._allCellsRenderedCallBacks[e];this._allCellsRenderedCallBacks.pop(),t&&t.call()}this.fire("allCellsRendered")}},subscribeOnceToAllCellsRendered:function(e){this._allCellsRenderedCallBacks||(this._allCellsRenderedCallBacks=[]),this._allCellsRenderedCallBacks.unshift(e)},_addTweakerToGenerate:function(){this._tweakerToGenerateCount++},_removeTweakerToGenerate:function(){this._tweakerToGenerateCount--,this._isRendering()||this._isPrivateRendering()||0!=this._tweakerToGenerateCount||this._onAllCellsRendered()},_isPrivateRendering:function(e){if(void 0===e)return void 0!==this.__isPrivateRendering&&this.__isPrivateRendering;this.__isPrivateRendering=e},hasPendingCellsToRender:function(){return this._isRendering()||this._tweakerToGenerateCount>0&&!this._isPrivateRendering()},_resetRowHeightsOnAllCellsRendered:function(){this._resetRowHeightsOnAllCellsRenderedFlag=!0},isCellHighlighted:function(e){return!!(e&&e.cellView&&e.cellView.isRow()&&e.nodeModel)&&e.nodeModel.isHighlighted()},isCellPreselected:function(e){let t=!1;if(F.getTouchMode())return t;const i=this.layout,n=this.getUsedCellPreselectionFeedback(),o=i.getCellCoordinatesAt(e);if(o.rowID>-1)if("cell"===n)if(-1===o.columnID){const e=i.getCellCoordinatesAt(this.getPreselectedCellID());t=o.rowID===e.rowID}else t=this.getPreselectedCellID()===e;else if("row"===n){if(!(t=o.rowID===this._preselectedRowID)){const i=this.getNodeModelAt(e);if(i){const e=this.getNodesPXSO();e&&(t=e.isIn(i))}}}else t=o.rowID===this._preselectedRowID&&-1===o.columnID;else if(-1===o.rowID&&"cell"===n){const e=i.getCellCoordinatesAt(this.getPreselectedCellID());e.rowID>=-1&&(t=o.columnID===e.columnID)}else t=this.getPreselectedCellID()===e;return t},isCellActive:function(e){var t=!1,i=this.getActiveCellID();if(i>=0)if("row"===this.cellActivationFeedback){var n=this.layout,o=n.getCellCoordinatesAt(e);if(o.columnID===n._leftPinnedRowColumnID||o.columnID===n._unpinnedRowColumnID||o.columnID===n._rightPinnedRowColumnID){var l=n.getCellCoordinatesAt(i);t=o.rowID===l.rowID}else t=e===i}else t=e===i;return t},sizeColumnToFit:function(e,t){var i=this.layout;this._isPrivateRendering(!0);var n=this._getMaxContentSizeInfo([e],t),o=n[Object.keys(n)[0]];return this._isPrivateRendering(!1),void 0!==o.maxContentSize&&o.isWidthComputed&&i.setColumnWidth(e,o.maxContentSize,{isUserInteraction:!(!t||!t.isUserInteraction)}),o.maxContentSize},sizeColumnOrGroupToFit:function(e,t,i){var n=this.layout;this.prepareUpdateView(),i||(i={}),i.minMax=n.getMinMaxVisibleRowIDs();var o=n.getColumnOrGroupFromCoordinates({rowID:t,columnID:e});if(o.children&&o.children.length)for(var l=0;l<o.children.length;l++){var r=n.getColumnOrGroupCellCoordinates(o.children[l]).columnID;this.sizeColumnOrGroupToFit(r,t+1,i)}else this.sizeColumnToFit(e,i);this.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)},sizeColumnsToFit:function(e,t){var i=this.layout;"object"==typeof columnIDs&&O.getLeafItems(columnIDs),this._isPrivateRendering(!0);for(var n={},o=this._getMaxContentSizeInfo(e,t),l=Object.keys(o),r=0;r<l.length;r++){var s=l[r];void 0!==o[s].maxContentSize&&o[s].isWidthComputed&&(n[s]=o[s].maxContentSize)}return this._isPrivateRendering(!1),i.setColumnsWidth(n,{isUserInteraction:!(!t||!t.isUserInteraction)}),n},_getMaxContentSizeInfo:function(t,i){var n,o=this.layout,l=this;i=e.extend({isUserInteraction:!1,computeAllRows:!1,computeColumnHeader:!1},i),n=i.computeAllRows?{minRowID:0,maxRowID:this.getModelLength()-1}:i.minMax?i.minMax:o.getMinMaxVisibleRowIDs();for(var r={},s=0;s<t.length;s++){var a=o.getColumnIdentifiers(t[s]),d=o.getColumnMinWidth(a.columnIndex),u=o.getColumnAutoSizePadding(a.columnIndex);r[a.dataIndex]={maxContentSize:d,autoSizePadding:u,isWidthComputed:!1}}var h=[],c=[];function g(e,t){var i=l.layout.getCellIDFromCoordinates({rowID:t,columnID:e}),n=l._getRenderedCellAt(i);n||(n=l._renderCell(i,{updateCellContent:!1,updateCellLayout:"ignore",updateCellAttributes:!1}),c.push(i)),h.push({cell:n,columnID:e})}if(n.minRowID>=0&&n.maxRowID>=0||i.computeColumnHeader){var m=500,p=(n.maxRowID+1-n.minRowID)*t.length,f=Math.ceil(p/m),C=(Object.keys(r),{columnIndex:0,rowID:n.minRowID});function _(){for(var e=0;e<m;e++){if(g(o.getColumnIdentifiers(t[C.columnIndex]).dataIndex,C.rowID),-1===C.rowID){if(C.columnIndex===t.length-1)break;C.columnIndex+=1,C.rowID=n.minRowID}else if(C.rowID===n.maxRowID)if(i.computeColumnHeader)C.rowID=-1;else{if(C.columnIndex===t.length-1)break;C.columnIndex+=1,C.rowID=n.minRowID}else C.rowID+=1}for(e=0;e<h.length;e++){var s=h[e].columnID,a=h[e].cell;if(s&&a&&a.component){r[s].isWidthComputed=!0;var d=a.component.computeContentSize()+2+r[s].autoSizePadding;d>r[s].maxContentSize&&(r[s].maxContentSize=d)}}h=[];for(var u=0;u<c.length;u++)l._freeUpCell(c[u],1);c=[]}for(var w=0;w<f;w++)_()}return r},sizeAllColumnsToFit:function(e){var t=this.layout;t.isValid()||t.prepareLayout();var i=this.layout.getLeafColumns();this.prepareUpdateView(),e||(e={}),e.minMax=t.getMinMaxVisibleRowIDs(),this.sizeColumnsToFit(i,e),this.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)},_applyRowGroupingOptions:function(t){this._properties.rowGroupingOptions.value=e.extend({depth:0,hideGroupedColumns:!0,getGroupingNodeOptions:null},this.rowGroupingOptions)},onFindRequest:function(e,t){if(this.findCtx||(this.findCtx={opts:{}}),this.findCtx.opts=Object.assign({},e),this.findCtx.actionCompleted=t,e.findInContentSelected&&Array.isArray(e.findInContentSelected)&&e.findInContentSelected.length>0){let t={};for(const e of this.layout.getLeafColumns())t[e.text]=e.dataIndex;const i=e.findInContentSelected.map(e=>t[e]);this.getColumnsToProcessForFind=(()=>i)}else this.getColumnsToProcessForFind=void 0;const i=this._muteFind;this._muteFind=!0,this.findNavigationMode=e.navigationMode,this._muteFind=i,this.setFindStr(e.findStr,e.matchCase,e.currentValue,void 0,!0)},onFindPreviousResult:function(e,t){this.findCtx||(this.findCtx={}),this.findCtx.opts=Object.assign({},e),this.findCtx.actionCompleted=t,this.goToPreviousMatchingCell()},onFindNextResult:function(e,t){this.findCtx||(this.findCtx={opts:{}}),this.findCtx.opts=Object.assign({},e),this.findCtx.actionCompleted=t,this.goToNextMatchingCell()},onFindInit:function(e){this.findCtx||(this.findCtx={opts:{}}),this.findCtx.close=e},onFindClose:function(){this.closeFind(),this.findCtx=null},onFindAutoSelect:function(e,t){if(this.findCtx||(this.findCtx={opts:{}}),this.findCtx.opts=Object.assign({},e),this.findCtx.actionCompleted=t,this.findCtx.opts&&this.findCtx.opts.autoSelect&&(this.findCtx.opts.autoSelect.modified&&this.unselectAll(),this.findCtx.opts.autoSelect.value))for(const e of this._matchingNodeModelsArray)this.selectNodeModel(e,!0);this.findCtx&&this.findCtx.actionCompleted&&this.findCtx.actionCompleted()},onFindReset:function(){this.findCtx||(this.findCtx={opts:{}}),this.setFindStr("",!1,0,void 0,!0)},setFindStr:function(e,t,i,n,o,l,r){if(this._muteFind||this.findStr!==e||t!==this.matchCase||o){var s=!1;!0===this._muteFind&&this._rowModel._isServerSide()&&(s=!0),this._muteFind=!1;var a=this.findStr,d=this.matchCase;this.matchCase=t,(this.findStr!==e||s)&&(this._matchingFoundArrays=[],this._matchingCellIDsArray=[],this._matchingCellIDsMap={},this._matchingNodeModelsArray=[],this._matchingNodeModelsMap={},this._currentMatchingCellIDIndex=-1,this._currentMatchingRowIDIndex=-1,this._rowModel&&(this._rowModel._findResultNumber=0,this._rowModel._findCurrentResultValue=void 0,this._rowModel._matchingStringCount=0,this._rowModel._matchingCellIDsCount=0,this._rowModel._matchingRowsCount=0,this._rowModel._currentMatchingNodeModel=void 0)),this.findStr=e,this._hasARegExpFilter=r,void 0===i&&this.findWidget&&this.findWidget.setLoadingState&&this.findWidget.setLoadingState(!0);var u=function(){if(this._rowModel){if(this.matchingStringCount=this._rowModel._computeMatchingStringsCount(),this.findCtx||this.findWidget){let e;this.findWidget&&(this.findWidget.count=-1),"substring"===this.findNavigationMode?e=this.matchingStringCount:"cell"===this.findNavigationMode?(this._matchingCellIDsCount=this._rowModel._computeMatchingCellIDsCount(),e=this._matchingCellIDsCount):(this._matchingRowsCount=this._rowModel._computeMatchingNodeModelsCount(),e=this._matchingRowsCount),this.findCtx?this.findCtx.opts.count=e:this.findWidget&&(this.findWidget.count=e)}if(this._matchingCellIDsArray.length>0){if(void 0===i)this._currentMatchingStringIndex=0,this._currentMatchingCellIDIndex=0,this._currentMatchingRowIDIndex=0;else{var e=this._rowModel._computeCurrentMatchingStringIndex(this,i);if(this._currentMatchingStringIndex=e,this._currentMatchingCellIDIndex=this._getMatchingCellIDIndexFromMatchingStringIndex(this._currentMatchingStringIndex),this._currentMatchingRowIDIndex=this._getMatchingRowIDIndexFromMatchingStringIndex(this._currentMatchingStringIndex),this.findCtx)this.findCtx.currentValue=this._rowModel._computeFindEditorCurrentValue();else if(this.findWidget){var t=this._rowModel._computeFindEditorCurrentValue();this.findWidget.setCurrentValue(t)}}if(this._currentMatchingRowIDIndex>=0&&(this._rowModel._currentMatchingNodeModel=this._matchingNodeModelsArray[this._currentMatchingRowIDIndex]),!n){var o=this._matchingAllNodeModelsArray[this._currentMatchingCellIDIndex];o&&this.ensureNodeModelVisible(o,!1,!0,.5),this.ensureCellVisible(this._matchingCellIDsArray[this._currentMatchingCellIDIndex],!1,.5)}}if(a&&""!=a)this.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0});else if("row"===this.findNavigationMode)for(var l=0;l<this._matchingNodeModelsArray.length;l++)this.updateRowView(this._matchingNodeModelsArray[l]._getRowID(),{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0});else for(l=0;l<this._matchingCellIDsArray.length;l++)this.updateCellView(this._matchingCellIDsArray[l],{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0});this.findCtx&&this.findCtx.actionCompleted?this.findCtx.actionCompleted(Object.assign({},this.findCtx.opts)):this.findWidget&&this.findWidget.setLoadingState&&this.findWidget.setLoadingState(!1)}};if(""!=this.findStr){var h;a===this.findStr&&this.matchCase!==d&&!0===this.matchCase&&this._rowModel&&(h=this._rowModel._getNodeModelsToProcessFromMatchCaseChange());let e=0;this.findCtx&&this.findCtx.opts.currentValue&&void 0!==i?e=this.findCtx.opts.currentValue-1:this.findWidget&&this.findWidget.currentValue&&void 0!==i&&(e=this.findWidget.currentValue-1),this._findAllCellIDsMatchingFindStr(this.findStr,this.matchCase,e,h,l,u)}else u.call(this)}},getMatchingFindNodeModelArray:function(){return this._matchingNodeModelsArray},getMatchingFindCurrentNodeModel:function(){return this._rowModel?this._rowModel._currentMatchingNodeModel:void 0},_findAllCellIDsMatchingFindStr:function(e,t,i,n,o,l,r){this._rowModel&&this._rowModel._findAndDisplayAllCellIDsMatchingFindStr(e,t,i,n,o,l,r)},_getCellValueAsStringForFind:function(e,t,i,n){if(e)return e.call(this,t);var o=this.layout._getCellTypeRepresentation(t),l=this.getTypeRepresentationFactory(),r={touchMode:F.getTouchMode(),readOnly:!this.isCellInEdition(t.cellID),semantics:{showReferenceValueFlag:this.showModelChangesFlag,allowUnsafeHTMLContent:a}},s=l.getRegisteredTypeRepresentation(o);s||(s={semantics:{possibleValues:l.getRegisteredEnum(o)}}),s.semantics&&(s.semantics.possibleValues&&(r.semantics.possibleValues=s.semantics.possibleValues),s.semantics.valueType&&(r.semantics.valueType=s.semantics.valueType));var a=this.layout.getColumnShouldCellAllowUnsafeHTMLContentAt(t.columnID).call(this,t);r.typePath=o,r.context="inlinedTemplate",r.semantics.executionContext=t;var d=l._getTypeData(r.typePath,r.semantics,t.cellModel),u=l.getTemplateIdentifierFromTypeRep(d.typeRep,r.context),h=l.options.directory.getRegisteredTemplate(u);if(h&&h.src){var c=h.src.prototype;if(c._properties={},c.elements={},c.possibleValues=r.semantics.possibleValues,c.valueType=r.semantics.valueType,c.isValueDisplayedAsString(h.options.displayStyle)){c._properties={},c.elements={},c.possibleValues=r.semantics.possibleValues,c.valueType=r.semantics.valueType;var g="progress"===n?"%":"percentage"===n?" %":"",m=c.getStringFromValue(t.cellModel)+g;return c.possibleValues=void 0,c.valueType=void 0,c._properties=void 0,c.elements=void 0,m}}},_getIndexesOfMatchingString:function(e,t){for(var i=[],n=e.indexOf(t);-1!=n;)i.push(n),n=e.indexOf(t,n+t.length);return i},_getSelectedIndexFromMatchingCellIDIndex:function(e){for(var t=0,i=0;i<this._matchingFoundArrays.length&&!(i>e||t>this._currentMatchingStringIndex);i++){var n=t;if(t+=this._matchingFoundArrays[i].length,i===e&&t>this._currentMatchingStringIndex)return this._currentMatchingStringIndex-n}return-1},_getMatchingRowIDIndexFromMatchingStringIndex:function(e){for(var t=0,i=0;i<this._matchingFoundArrays.length;i++){if(t>=e){var n=this._matchingAllNodeModelsArray[i];return this._matchingNodeModelsArray.indexOf(n)}t+=this._matchingFoundArrays[i].length}return-1},_getMatchingCellIDIndexFromMatchingStringIndex:function(e){for(var t=0,i=0;i<this._matchingFoundArrays.length;i++)if((t+=this._matchingFoundArrays[i].length)>e)return i;return-1},_getMatchingStringIndexFromMatchingCellIDIndex:function(e){if(e>=0&&e<this._matchingFoundArrays.length){for(var t=0,i=0;i<e;i++)t+=this._matchingFoundArrays[i].length;return t}return-1},_getMatchingStringIndexFromMatchingRowIDIndex:function(e){if(e>=0&&e<this._matchingNodeModelsArray.length){var t=0,i=this._matchingNodeModelsArray[e];if(i)for(var n=0;n<this._matchingAllNodeModelsArray.length&&this._matchingAllNodeModelsArray[n]!==i;n++)t+=this._matchingFoundArrays[n].length;return t}return-1},_getMatchingCellID:function(e){var t=-1;return this._matchingCellIDsArray&&e>=0&&e<this._matchingCellIDsArray.length&&(t=this._matchingCellIDsArray[e]),t},goToPreviousMatchingCell:function(){this.findStr&&""!=this.findStr&&this.matchingStringCount>0&&(!0===this._muteFind&&(this._muteFind=!1,this.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})),this._setCurrentMatchingCell(-1))},goToNextMatchingCell:function(){this.findStr&&""!=this.findStr&&this.matchingStringCount>0&&(!0===this._muteFind&&(this._muteFind=!1,this.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0})),this._setCurrentMatchingCell(1))},closeFind:function(){!1===this._muteFind&&(this._muteFind=!0,this.findStr&&""!==this.findStr&&this.invalidateLayout({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}))},_setCurrentMatchingCell:function(e){this.findWidget&&this.findWidget.setLoadingState&&this.findWidget.setLoadingState(!0);let t;this.findCtx?t=this.findCtx.opts.currentValue-1:this.findWidget&&(t=this.findWidget.currentValue-1),this._findAllCellIDsMatchingFindStr(this.findStr,this.matchCase,t,void 0,!1,function(t,i){var n;if(n=1===e?this._rowModel._computeNextMatchingData(this,i):this._rowModel._computePreviousMatchingData(this,i),this._currentMatchingStringIndex!==n||this._rowModel._isServerSide()){var o=this.layout,l=this._currentMatchingStringIndex,r=this._getMatchingCellIDIndexFromMatchingStringIndex(l),s=this._getMatchingCellID(r),a=n,d=this._getMatchingCellIDIndexFromMatchingStringIndex(a),u=this._getMatchingCellID(d);if(this._currentMatchingStringIndex=a,this._currentMatchingCellIDIndex=d,this._currentMatchingRowIDIndex=this._getMatchingRowIDIndexFromMatchingStringIndex(this._currentMatchingStringIndex),this._currentMatchingRowIDIndex>=0&&(this._rowModel._currentMatchingNodeModel=this._matchingNodeModelsArray[this._currentMatchingRowIDIndex]),this._currentMatchingCellIDIndex>=0){var h=this._matchingAllNodeModelsArray[this._currentMatchingCellIDIndex];if(h&&this.ensureNodeModelVisible(h,!1,!0,.5),this.updateCellView(u,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}),"row"===this.findNavigationMode){var c=o.getCellCoordinatesAt(u).rowID;this._updateRenderedRowCellsAttributes(c)}this.ensureCellVisible(u,!1,.5)}s&&(this.updateCellView(s,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0}),"row"===this.findNavigationMode)&&(c=o.getCellCoordinatesAt(s).rowID,this._updateRenderedRowCellsAttributes(c)),this.findCtx&&this.findCtx.actionCompleted?this.findCtx.actionCompleted(Object.assign({},this.findCtx.opts)):this.findWidget&&this.findWidget.setLoadingState&&this.findWidget.setLoadingState(!1)}else this.findCtx&&this.findCtx.actionCompleted?this.findCtx.actionCompleted(Object.assign({},this.findCtx.opts)):this.findWidget&&this.findWidget.setLoadingState&&this.findWidget.setLoadingState(!1)},!0)},groupRows:function(e){this._rowModel&&this._rowModel.groupRows(e)},createGroupingUI:function(){var e=this,t=void 0,i=function(t,i){-1===e._draggedRowID&&e.rowGroupingEnabledFlag&&t.preventDefault()},n=function(i,n){var o=e.getDraggedColumnData(i);if(o&&-1===o.rowID&&e.layout.getColumnOptionValue(o.columnID,"groupableFlag")){var l={label:o.label,value:e.layout.getColumnOptionValue(o.columnID,"dataIndex"),index:void 0},r=n.chipCellView?n.chipCellView.associatedModelItem:void 0;if(r){var s=n.dropPosition;"left"===s?l.index=t.getChipPosition(r.chipOptions.label):"right"===s&&(l.index=t.getChipPosition(r.chipOptions.label)+1)}t.addChip(l)}return i.preventDefault(),!0};t=new D({placeholder:S.get("GroupingUIPlaceholder"),onDragOverCell:function(e,t){return i(e)},onDragOverBlank:function(e,t){return i(e)},onDropCell:function(e,t){return n(e,t)},onDropBlank:function(e,t){return n(e,t)}});var o=!0,l=!0;t.getContent().addEventListener("change",function(t){if(t&&t.dsModel&&o){var i=[];t.dsModel.getAllChipsOptions().forEach(function(e){i.push(e.value)}),l=!1,e.groupRows({dataIndexesToGroup:i}),e.layout._saveGroupingOptionsInPreferences(),l=!0}}),t.getContent().addEventListener("onPostRemove",function(t){f.isCurrentlyCalledFromUIInteraction()&&e._rowModel&&e._rowModel._isServerSide()&&(e.findCtx?e.findCtx.close():e.findWidget&&e.findWidget.close())});var r=this.getTreeDocument();if(r){e=this;var s=function(i){if(l&&e._rowModel._groupingOptions&&e._rowModel._groupingOptions.dataIndexesToGroup){o=!1,t.removeAllChips();for(var n=0;n<e._rowModel._groupingOptions.dataIndexesToGroup.length;n++){var r=e._rowModel._groupingOptions.dataIndexesToGroup[n];t.addChip({label:e.layout.getColumnOptionValue(r,"text"),value:r})}o=!0}};r.addEventListener("groupChildren",s),s()}return t},setCellInEdition:function(e){if(!this.getCellEditableState(e))return!1;var t=this.setActiveCell(e,!0);if(this._getViewAt(e)){var i=this._setEditionMode(e,!0);return this.setFocusOnCellContentFlag(!0),i}if(t){var n=this;return new Promise(function(t,i){n.subscribeOnceToAllCellsRendered(function(){var i=n._setEditionMode(e,!0);n.setFocusOnCellContentFlag(!0),t(i)})})}},getCellEditableState:function(e){var t=this.layout,i=t.getCellCoordinatesAt(e);if(-1===i.columnID||i.rowID<=-1)return!1;var n=t.getColumnGetCellEditableState(i.columnID),o=this.getNodeModelAtRowID(i.rowID);if(n){var l=this.getLightCellInfosAt(e);return l.nodeModel=o,n.call(this,l)}if(o){var r=o.getTreeDocument();if(r&&r.options&&r.options.shouldBeEditable&&!r.options.shouldBeEditable(o))return!1}return t.getColumnEditableFlag(i.columnID)},getCellActivableState:function(e){var t=this.layout,i=t.getCellCoordinatesAt(e);if(-1===i.columnID||i.rowID<=-1)return!0;var n=t.getColumnGetCellActivableState(i.columnID);if(n){var o=this.getLightCellInfosAt(e);return o.nodeModel=this.getNodeModelAtRowID(i.rowID),n.call(this,o)}return!0},_resetFocus:function(e){if(this._parent(e),e&&f.isASystemEvent(e)){var t=e.relatedTarget?e.relatedTarget:document.activeElement;if(!t||!f.isElementInside(t,this.getContent(),{lookInPopup:!0})){var i=this.getActiveCellID();i>=0&&this._setEditionMode(i,!1)}}},getCellRequiredState:function(e){return!1},_getCellSemantics:function(e){var t=this.layout;if(e.columnID>-1&&e.rowID>-1){var i=t.getColumnGetCellSemantics(e.columnID);return i?i.call(this,e):t.getColumnSemantics(e.columnID)}return null},_getCellKPIColor:function(e){var t=this.layout;if(e.columnID>-1&&e.rowID>-1){var i=t.getColumnGetCellKPIColor(e.columnID);if(i)return i.call(this,e)}return null},computeCellIDFromActiveCell:function(e,t,i){var n=this.getActiveCellID();return i&&this._getLastRangeCellID()>=0&&("up"===e||"right"===e||"down"===e||"left"===e||"pageup"===e||"pagedown"===e)&&(n=this._getLastRangeCellID()),this.layout._computeCellIDFromCell(n,e,t,i)},onDragStartCellDefault:function(e,t){this.getRowReorderEnabledState()&&(this._rowModel&&this._rowModel._isServerSide()&&(this.findCtx?this.findCtx.close():this.findWidget&&this.findWidget.close()),this._serializeDragAndDropEvent(e,t))},onDragEndCellDefault:function(e,t){},onDragEnterCellDefault:function(e,t){if(t.nodeModel&&this.getRowReorderEnabledState()&&t.draggedNodes){var i=ee.call(this,e,t);(i||null===i)&&e.preventDefault()}},onDragLeaveCellDefault:function(e,t){Z.call(this)},onDragCellDefault:function(e,t){},onDragOverCellDefault:function(e,t){if(t.nodeModel&&this.getRowReorderEnabledState()){var i=ee.call(this,e,t);(i||null===i)&&e.preventDefault()}else e.defaultPrevented&&(this._draggedColumnOrGroup?e.dataTransfer.dropEffect="none":(t.dropPosition="middle",Q.call(this,t,!0)))},onDragOverBlankDefault:function(e,t){this._draggedColumnOrGroup||(this.elements.scroller.elements.container.setAttribute("highlightTopBottom",""),this.hasLeftContainer()&&(""===this.elements.leftScrollContainer.getAttribute("empty")&&this.elements.scroller.elements.container.setAttribute("highlightLeft",""),this.elements.leftScrollContainer.setAttribute("highlight",""),this.elements.leftSpacerContainer.setAttribute("highlight","")),this.hasRightContainer()&&(""===this.elements.rightScrollContainer.getAttribute("empty")&&this.elements.scroller.elements.container.setAttribute("highlightRight",""),this.elements.rightScrollContainer.setAttribute("highlight",""),this.elements.rightSpacerContainer.setAttribute("highlight","")))},onDragLeaveBlankDefault:function(e,t){this.elements.scroller.elements.container.removeAttribute("highlightTopBottom"),this.elements.scroller.elements.container.removeAttribute("highlightLeft"),this.elements.scroller.elements.container.removeAttribute("highlightRight"),this.hasLeftContainer()&&(this.elements.leftScrollContainer.removeAttribute("highlight"),this.elements.leftSpacerContainer.removeAttribute("highlight")),this.hasRightContainer()&&(this.elements.rightScrollContainer.removeAttribute("highlight"),this.elements.rightSpacerContainer.removeAttribute("highlight"))},onDropBlankDefault:function(e,t){this.elements.scroller.elements.container.removeAttribute("highlightTopBottom"),this.elements.scroller.elements.container.removeAttribute("highlightLeft"),this.elements.scroller.elements.container.removeAttribute("highlightRight"),this.hasLeftContainer()&&(this.elements.leftScrollContainer.removeAttribute("highlight"),this.elements.leftSpacerContainer.removeAttribute("highlight")),this.hasRightContainer()&&(this.elements.rightScrollContainer.removeAttribute("highlight"),this.elements.rightSpacerContainer.removeAttribute("highlight"))},onDropCellDefault:function(e,t){if(t.nodeModel&&this.getRowReorderEnabledState()&&te.call(this,e,t))return void e.preventDefault()},getRowReorderEnabledState:function(){return this.rowDragEnabledFlag&&this.rowReorderEnabledFlag&&0===this._disableRowReorderCpt},enableRowReordering:function(){this._disableRowReorderCpt--},disableRowReordering:function(){this._disableRowReorderCpt++},_serializeDragAndDropEvent:function(t,i){if(i&&i.draggedNodes){var n;if(t.dataTransfer&&"string"==typeof t.dataTransfer.getData("text")&&t.dataTransfer.getData("text").length>0)try{n=JSON.parse(t.dataTransfer.getData("text"))}catch(t){return}var o=[];i.draggedNodes.forEach(function(e){o.push(e._getID())});var l={source:{uuid:this._uuid,amd:"DS/DataGridView/DataGridView"},data:{DataGridView_Row_Options:{"dswebux/x-datagridview.rows+json":o,"dswebux/x-datagridview.row+number":i.nodeModel._getID(),"dswebux/x-datagridview.row.options.label+json":i.nodeModel.options.label,"dswebux/x-datagridview.row.options.icons+json":i.nodeModel.options.icons,"dswebux/x-datagridview.row.options.grid+json":i.nodeModel.options.grid,"dswebux/x-datagridview.row.id+json":i.rowID}}};n&&(l=e.extend(l,n,!0)),t.dataTransfer.setData("text",JSON.stringify(l))}},onDragStartRowHeaderDefault:function(e,t){if(this.rowDragEnabledFlag&&(this._rowModel&&this._rowModel._isServerSide()&&(this.findCtx?this.findCtx.close():this.findWidget&&this.findWidget.close()),this._serializeDragAndDropEvent(e,t),e.dataTransfer.setDragImage)){var i=this.layout.getColumnIndex("tree");if(void 0!==i){var n=this.layout.getCellIDFromCoordinates({rowID:t.rowID,columnID:i}),o=!1,l=this._getRenderedCellAt(n);if(l||(l=this._renderCell(n,{updateCellContent:!1,updateCellLayout:"ignore",updateCellAttributes:!1}),o=!0),l&&l.component&&e.dataTransfer.setDragImage(l.component.getContent(),10,10),o){var r=this;setTimeout(function(){r._freeUpCell(n,1)},0)}}}},onDragEndRowHeaderDefault:function(e,t){},onDragEnterRowHeaderDefault:function(e,t){},onDragLeaveRowHeaderDefault:function(e,t){Z.call(this)},onDragRowHeaderDefault:function(e,t){},onDragOverRowHeaderDefault:function(e,t){t.nodeModel&&this.getRowReorderEnabledState()&&t.draggedNodes&&(ee.call(this,e,t)&&e.preventDefault())},onDropRowHeaderDefault:function(e,t){if(t.nodeModel&&this.getRowReorderEnabledState()&&te.call(this,e,t))return void e.preventDefault()},onDragStartColumnHeaderDefault:function(e,t){if(this.columnDragEnabledFlag){var i=this.layout;if(this._draggedColumnOrGroup=i.getColumnOrGroupFromCoordinates({rowID:t.rowID,columnID:t.columnID}),this._draggedColumnOrGroupPreviousPositionData=i._getColumnOrGroupPositionData(this._draggedColumnOrGroup),this._draggedRowID=t.rowID,this._draggedColumnOrGroup){this._draggedColumnOrGroup._isMoving=!0,O.processTreeChildren(this._draggedColumnOrGroup.children,function(e){e._isMoving=!0}),this._updateColumnHeaderCells({updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0});for(var n=O.getLeafItems(this._draggedColumnOrGroup),o=0;o<n.length;o++){var l=n[o];0===o&&(l._isFirstColumnMoving=!0);var r=i.getColumnIndex(l.dataIndex);this.updateColumnView(r,{updateCellContent:!1,updateCellLayout:!1,updateCellAttributes:!0})}}}var s={source:{uuid:this._uuid,amd:"DS/DataGridView/DataGridView"},data:{DataGridView_Column_Options:{"dswebux/x-datagridview.column.label+json":t.cellModel,"dswebux/x-datagridview.row.id+json":t.rowID,"dswebux/x-datagridview.column.id+json":t.columnID}}};e.dataTransfer.setData("text",JSON.stringify(s))},onDragEndColumnHeaderDefault:function(e,t){if(this._draggedColumnOrGroup){var i=this.layout;this._draggedColumnOrGroup._isMoving=!1,O.processTreeChildren(this._draggedColumnOrGroup.children,function(e){e._isMoving=!1});for(var n=O.getLeafItems(this._draggedColumnOrGroup),o=0;o<n.length;o++){var l=n[o];0===o&&(l._isFirstColumnMoving=!1)}var r=this._draggedColumnOrGroup;this._draggedColumnOrGroupPreviousFather,this._draggedColumnOrGroup._parent;this._draggedColumnOrGroup=null;var s=i._getColumnTreeItemCount();i._computeColumnItems();var a=this._draggedColumnOrGroupPreviousPositionData,d=i._getColumnOrGroupPositionData(r);i._updateColumnGroupExpandedStateInPreferences(a,d),i._saveParentColumnGroupsExpandedStateInPreferences(r);var u=!1;i._getColumnTreeItemCount()!==s&&(u=!0),this.invalidateLayout({updateCellContent:u,updateCellLayout:!0,updateCellAttributes:!0})}},onDragEnterColumnHeaderDefault:function(e,t){this._draggedColumnOrGroup&&(e.preventDefault(),e.dataTransfer.dropEffect="move"),Z.call(this)},onDragLeaveColumnHeaderDefault:function(e,t){},onDragColumnHeaderDefault:function(e,t){this._rowModel&&this._rowModel._isServerSide()&&(this.findCtx?this.findCtx.close():this.findWidget&&this.findWidget.close())},onDragOverColumnHeaderDefault:function(e,t){if(this.columnDragEnabledFlag&&this._draggedColumnOrGroup&&(e.dataTransfer.dropEffect="move",e.preventDefault(),this._draggedColumnOrGroup)){var i,n,o=this.layout,l=!1,r=o.getColumnOrGroupFromCoordinates({rowID:t.rowID,columnID:t.columnID}),s=function(e,t){var i=(t=t||e.target||e.srcElement).getBoundingClientRect();return{offsetX:e.clientX?e.clientX-i.left:0,offsetY:e.clientY?e.clientY-i.top:0}}(e).offsetX;if(-1===t.rowID)i=t.columnID,n=s;else for(var a=0,d=O.getLeafItems(r),u=0;u<d.length;u++){var h=d[u],c=o.getColumnIndex(h.dataIndex),g=o.getColumnComputedWidth(c);if(s<=a+g){i=c,n=s-a;break}a+=g}if(void 0!==i){var m=o.getColumnOrGroupPinned(this._draggedColumnOrGroup),p=o.getColumnPinned(i),f=o.getColumnOrGroupComputedWidth(this._draggedColumnOrGroup),C=o.getColumnComputedWidth(i),_=o.getFirstLeafColumnIndex(this._draggedColumnOrGroup,!0),w=o.getOrderedColumnsReverseIndexes(),v=w[_],D=w[i],I=n>C/2?"after":"before";v<D&&n>C/2&&n>C-f||v>D&&n<C/2&&n<f?l=!0:m!==p&&(l=!0);var V=o._columnMoveIsPossible(this._draggedColumnOrGroup,i,I);if(l&&V){if(m!==p){var y=O.computeFirstBranchDepth(this._draggedColumnOrGroup),b=o.getLeafColumns()[_];if(o.setColumnOrGroupPinned(this._draggedColumnOrGroup,p,{isUserInteraction:!0,mergeGroups:!1}),b){var M=b;for(u=0;u<y-1&&M;u++)M=M._parent;M&&(this._draggedColumnOrGroup=M)}}o.moveColumnOrGroup(this._draggedColumnOrGroup,i,{insertBeforeOrAfter:I,isUserInteraction:!0})}if(!V){var x=!0,F=o.getLeafColumns()[i];for(d=O.getLeafItems(this._draggedColumnOrGroup),u=0;u<d.length;u++){if((h=d[u])===F){x=!1;break}}x&&(e.dataTransfer.dropEffect="none")}}}},onDropColumnHeaderDefault:function(e,t){e.preventDefault(),this._draggedColumnOrGroup&&this.onDragEndColumnHeaderDefault(e,t)},onDragEnterBlankDefault:function(e,t){Z.call(this)},_processDragAndDropCallbacks:function(e,t){var i=t||{};if("dragstart"===e.type){if(X=!0,t){var n=this.getEditionManager(t.cellID);n&&n.onCellDragStart(t.cellID);var o=this.getTreeDocument();if(t.nodeModel&&o&&!o.options.shouldAcceptDrag(t.nodeModel))return void e.preventDefault()}if(e.dataTransfer){var l=e.target.getBoundingClientRect(),r=e.clientX-l.left,s=e.clientY-l.top;if("function"==typeof e.dataTransfer.setDragImage){var a=e.target;t.cellView&&(a=t.cellView.getContent()),e.dataTransfer.setDragImage(a,r,s)}}if(t&&t.rowID>=0){t.nodeModel&&!t.nodeModel.isSelected()&&this.selectNodeModel(t.nodeModel);var d=[],u=this.getNodesXSO();u&&(d=u.get().concat(),A.sortNodesByRowID(d)),d&&0!==d.length||(d=[t.nodeModel]),i.draggedNodes=d,Object.getPrototypeOf(this).__rowReorderDnDInfos={source:this._uuid,nodes:d}}}else if("dragover"===e.type||"drag"===e.type||"dragenter"===e.type||"dragleave"===e.type){if(X=!0,"dragover"===e.type||"dragleave"===e.type)if(oe.call(this,e,t))return;(h=Object.getPrototypeOf(this).__rowReorderDnDInfos)&&h.nodes&&(i.draggedNodes=h.nodes),i.dropPosition=$.call(this,e,i)}else if("drop"===e.type){X=!1,(h=Object.getPrototypeOf(this).__rowReorderDnDInfos)&&h.source===this._uuid&&(i.droppedNodes=h.nodes),i.dropPosition=$.call(this,e,i),Z.call(this)}else if("dragend"===e.type){var h;X=!1,(h=Object.getPrototypeOf(this).__rowReorderDnDInfos)&&h.nodes&&(i.draggedNodes=h.nodes),this._rowReorderDnDInfos.dropAccepted||te.call(this,e,t),Object.getPrototypeOf(this).__rowReorderDnDInfos=null,ne.call(this),Z.call(this)}var c={dragstart:"onDragStart",dragend:"onDragEnd",dragenter:"onDragEnter",dragleave:"onDragLeave",drag:"onDrag",dragover:"onDragOver",drop:"onDrop"}[e.type],g=this;function m(t,n){var o=!0,l=g[t+n],r=g[t+n+"Default"];l?(o=l.call(g,e,i),k&&console.info("[dnd]",t+n,">",o,e.target)):r||k&&console.warn("[dnd]","cannot find",t+n,"callback"),r&&o&&(k&&(l&&o?console.info("\t>[dnd]","dev want to continue to the default behavior for ",t+n," callback"):console.info("\t>[dnd]","use the default behavior for ",t+n," callback")),r.call(g,e,i))}t&&void 0!==t.columnID&&void 0!==t.rowID?-1===t.columnID?m(c,"RowHeader"):t.rowID<=-1?m(c,"ColumnHeader"):m(c,"Cell"):m(c,"Blank")},_manageDragAndDrop:function(){f.addEventOnElement(this,this,"dragstart",this._processDragAndDropCallbacks.bind(this)),f.addEventOnElement(this,this,"drop",this._processDragAndDropCallbacks.bind(this)),f.addEventOnElement(this,this,"dragover",this._processDragAndDropCallbacks.bind(this)),f.addEventOnElement(this,this,"drag",this._processDragAndDropCallbacks.bind(this)),f.addEventOnElement(this,this,"dragend",this._processDragAndDropCallbacks.bind(this)),f.addEventOnElement(this,this,"dragleave",this._processDragAndDropCallbacks.bind(this)),f.addEventOnElement(this,this,"dragenter",this._processDragAndDropCallbacks.bind(this))},getDraggedRowData:function(e){var t=e.dataTransfer.getData("text");try{if(void 0!==t&&""!==t){var i=JSON.parse(t);if(i&&void 0!==i.data.DataGridView_Row_Options)return{uuid:i.source.uuid,listOfDumpedNodes:i.data.DataGridView_Row_Options["dswebux/x-datagridview.rows+json"],nodeModel:i.data.DataGridView_Row_Options["dswebux/x-datagridview.row+number"],label:i.data.DataGridView_Row_Options["dswebux/x-datagridview.row.options.label+json"],icons:i.data.DataGridView_Row_Options["dswebux/x-datagridview.row.options.icons+json"],grid:i.data.DataGridView_Row_Options["dswebux/x-datagridview.row.options.grid+json"],rowID:i.data.DataGridView_Row_Options["dswebux/x-datagridview.row.id+json"]}}}catch(e){console.warn('the element being in dataTransfer type "DataGridView_Row_Options" is not parsable usable JSON.parse')}},getDraggedColumnData:function(e){var t=e.dataTransfer.getData("text");try{if(void 0!==t&&""!==t){var i=JSON.parse(t);if(i&&void 0!==i.data.DataGridView_Column_Options)return{uuid:i.source.uuid,label:i.data.DataGridView_Column_Options["dswebux/x-datagridview.column.label+json"],rowID:i.data.DataGridView_Column_Options["dswebux/x-datagridview.row.id+json"],columnID:i.data.DataGridView_Column_Options["dswebux/x-datagridview.column.id+json"]}}}catch(e){console.warn('the element being in dataTransfer type "DataGridView_Column_Label" is not parsable usable JSON.parse')}},_getSelectionCheckBox:function(e){var t,i=this.layout.getCellIDFromCoordinates(e),n=this._getViewAt(i);return n&&"function"==typeof n.getSelectionCheckBox&&(t=n.getSelectionCheckBox()),t},_getRowSelectionCheckBox:function(e){return this._getSelectionCheckBox({rowID:e,columnID:-1})},_getColumnSelectionCheckBox:function(e){return this._getSelectionCheckBox({rowID:-1,columnID:e})},_updateSelectAllCheckBox:function(){if(this.layout.columnsHeader){var e=this._getRowSelectionCheckBox(-1);if(e){var t=this.getTreeDocument();if(t){var i=0===t.getRoots().length;e.disabled=i;var n=t.getXSO();if(n){var o=n.isEmpty();e.checkFlag=!o;var l=this.isEveryVisibleNodeSelected(),r=this._selectAllCheckBoxListenChange;this._selectAllCheckBoxListenChange=!1,e.mixedState=!o&&!l,this._selectAllCheckBoxListenChange=r}}}}},_getCellTooltip:function(e){if(this.getCellTooltip)return this.getCellTooltip(e);var t=this.layout.getColumnGetCellTooltip(e.columnID);return t?t(e):this.getCellDefaultTooltip(e)},getCellDefaultTooltip:function(e,t){var i=this,n=t;return{getAllInformationCB:function(){var t,o=i.layout,l=!0===n&&n,r="";if(e.rowID<0&&!l){var s=o.getColumnOrGroupFromCoordinates(e);s&&(s.description?(l=!0,r=s.description):(l=!o.getColumnShowTextFlag(e.columnID)&&o.getColumnIcon(e.columnID))&&(r=s.text))}if(!l&&!e.cellModel)return{model:{shortHelp:""},updateModel:!1};if(!l&&((h=e.cellView.getReusableContent())&&h.computeContentSize)){var a=h.computeContentSize(),d=h.getTweakerPadding();d>2&&(a=a-d+2);var u=e.cellView._getContentContainer();u&&u.offsetWidth<a&&(l=!0)}if(l){var h;if(""===r)if(h=e.cellView.getReusableContent())h.value instanceof Function||(r=h.getStringFromValue(h.value));t=C.getUnsafeHTMLContentValueToApply(o.getColumnShouldCellAllowUnsafeHTMLContentAt(e.columnID).call(i,e))}return void 0!==t?{model:{shortHelp:r,allowUnsafeHTMLShortHelp:t,allowUnsafeHTMLLongHelp:t,allowUnsafeHTMLTitle:t},updateModel:!1}:{model:{shortHelp:r},updateModel:!1}}}},defaultOnCellRequest:function(t){var i=this.layout,n=i.getLeafColumns()[t.columnID],o=!1;if(t.rowID>=0&&t.columnID>=0){var l=this.getNodeModelAtRowID(t.rowID);if("tree"===n.dataIndex){var r=t.cellView;r.setProperties(this.treeNodeCellOptions),r.flatTreeFlag=this.hasFlatTreeState(),r.nodeModel!==l?r.nodeModel=l:r._applyNodeModel(l);var s=this.layout.getColumnGetCellIcons(t.columnID);if(s){var a=s(t);e.equals(r.icons,a)?r.nodeModel&&r.checkBadges()&&r._applyIcons():r.icons=a}this._setTweakerForCell(t),o=!0}else{if(i._getCellTypeRepresentation(t))this._setTweakerForCell(t),o=!0;else{var d=t.cellModel;"number"==typeof d&&(d+=""),t.cellView.setReusableContent(null),C.getUnsafeHTMLContentValueToApply(i.getColumnShouldCellAllowUnsafeHTMLContentAt(t.columnID).call(this,t))?t.cellView.getContent().setHTML(d):t.cellView.getContent().textContent=d}}t.cellView._updateTooltip(this._getCellTooltip(t))}else if(-1===t.columnID&&i.rowsHeader){if("none"!==this.rowSelection&&"function"==typeof t.cellView.buildSelectionCheckBox&&t.cellView.buildSelectionCheckBox(),this.rowDragEnabledFlag&&"function"==typeof t.cellView.buildDragGrip&&t.cellView.buildDragGrip(),t.cellView&&"function"==typeof t.cellView.getSelectionCheckBox){if(f=t.cellView.getSelectionCheckBox()){var u=this.getNodesXSO();if(u){var h=f.preventTriggeringChangeEvent;if(f.preventTriggeringChangeEvent=!0,t.rowID>=0)f.checkFlag=!!t.nodeModel&&u.isIn(t.nodeModel),f.mixedState=!1;else{var c=u.isEmpty();f.checkFlag=!c;var g=this.isEveryVisibleNodeSelected();f.mixedState=!c&&!g}f.preventTriggeringChangeEvent=h}}t.cellView._updateTooltip({getAllInformationCB:function(){return{model:{shortHelp:t.cellModel?t.cellModel.toString():void 0},updateModel:!1}}})}var m=t.cellView.getContent().querySelector(".wux-datagridview-selection-label");m&&(m.textContent=t.cellModel),t.cellView.showKPIColorFlag=this.showNodeKPIColorFlag,t.cellView.KPIColor=t.nodeModel?t.nodeModel.options.color:void 0}else if(t.rowID<=-1&&t.columnID>=0){var p,f;if(this._setTweakerForCell(t),o=!0,-1===t.rowID&&this._rowModel&&this._rowModel._filterViewManager&&n){var _="tree"===n.dataIndex?"label":n.dataIndex;p=this._rowModel._filterViewManager.getFilterPopups()[_]}if(t.cellView.filterView=p,"none"!==this.columnSelection&&"function"==typeof t.cellView.buildSelectionCheckBox&&t.cellView.buildSelectionCheckBox(),t.cellView&&"function"==typeof t.cellView.getSelectionCheckBox)if((f=t.cellView.getSelectionCheckBox())&&this._columnsXSO){h=f.preventTriggeringChangeEvent;f.preventTriggeringChangeEvent=!0;var w=i.getColumnOrGroupFromCoordinates(t),v=this.isColumnOrGroupSelected(w);f.checkFlag=!1!==v,f.mixedState="mixedState"===v,f.preventTriggeringChangeEvent=h}(w=i.getColumnOrGroupFromCoordinates(t))&&"function"==typeof t.cellView.buildColumnGroupExpander&&t.cellView.buildColumnGroupExpander(this,w),t.cellView._updateTooltip(this._getCellTooltip(t))}else t.cellView.setReusableContent(null);t.columnID>=0&&(o?t.cellView.getContent().removeAttribute("no-tweaker"):t.cellView.getContent().setAttribute("no-tweaker",""))},_manageCellRequests:function(){var t=this;t.onCellRequest(function(i){if(i.rowID>=0&&i.columnID>=0){var n=t.layout,o=n.getLeafColumns()[i.columnID],l=t.layout.getColumnOnCellRequest(i.columnID);if(l){if(o&&"tree"===o.dataIndex){var r=i.cellView;r.setProperties(t.treeNodeCellOptions),r.flatTreeFlag=t.hasFlatTreeState(),r.nodeModel!==i.nodeModel?r.nodeModel=i.nodeModel:r._applyNodeModel(i.nodeModel);var s=n.getColumnGetCellIcons(i.columnID);if(s){var a=s(i);e.equals(r.icons,a)?r.nodeModel&&r.checkBadges()&&r._applyIcons():r.icons=a}}return l.call(t,i)}}t.defaultOnCellRequest(i)})},_setTweakerForCell:function(t,i){var n,o,l,r=this,s=this.layout,a=t.cellModel,d=!1,u=!1;if(t.rowID<=-1&&t.columnID>=0){n="string";var h=s.getColumnOrGroupFromCoordinates(t);o=h?h.icon:s.getColumnIcon(t.columnID),void 0===a&&void 0===o||(u=!0)}else{n=s._getCellTypeRepresentation(t);var c=this.getNodeModelAtRowID(t.rowID);if(c){var g=c.options.grid,m=s.getLeafColumns()[t.columnID],p=s.getColumnHasCellValue(t.columnID),_=p&&!p.call(this,t),w=s.getColumnGetCellValue(t.columnID);_||!g.hasOwnProperty(m.dataIndex)&&void 0===a&&void 0===w||(u=!0,"tree"===m.dataIndex&&"string"===n&&void 0===w?d=void 0!==(l=c.getReferenceLabel()):(l=c.getReferenceValue(m.dataIndex),d=c.hasReferenceValue(m.dataIndex),void 0===l&&void 0!==a&&(d||(l=e.clone(a,!1)))))}}var v=Date.now();if(t.cellView&&(t.cellView._currentTimeStamp=v),n&&u){var D,I=t.cellView.getReusableContent();if(I&&I.__disposable__)(P=re.getRegisteredTypeRepresentation(n))||(P={semantics:{possibleValues:re.getRegisteredEnum(n)}}),D=re.getTemplateIdentifierFromTypeRep(P,"inlinedTemplate");var V=s.getColumnShouldCellAllowUnsafeHTMLContentAt(t.columnID).call(this,t),y=s.getColumnOptionValue(t.columnID,"allowResetToUndefinedByUIFlag"),b=s.getColumnOptionValue(t.columnID,"disabled"),M=s.getColumnOptionValue(t.columnID,"hyperlinkTarget"),x={touchMode:F.getTouchMode(),readOnly:!this.isCellInEdition(t.cellID),semantics:{showReferenceValueFlag:this.showModelChangesFlag,allowUnsafeHTMLContent:V}};if(t.rowID<=-1&&t.columnID>=0&&(x.semantics.icon=o),void 0!==l&&(x.semantics.referenceValue=l),void 0!==y&&(x.semantics.allowResetToUndefinedByUIFlag=y),void 0!==b&&(x.semantics.disabled=b),t.rowID>-1){var S=s.getColumnOptionValue(t.columnID,"alignment");"near"!==S&&"center"!==S&&"far"!==S||(x.semantics.alignment=S)}void 0!==M&&(x.semantics.hyperlinkTarget=M);var R=this._getCellSemantics(t);R&&(R=e.clone(R,!1),x.semantics=e.merge(R,x.semantics)),i&&(x=e.merge(i,x)),x.semantics.executionContext=t;var O=void 0;if(!this._muteFind&&this._matchingCellIDsArray&&this._matchingCellIDsArray.length>0){var A;(A=this._matchingCellIDsMap[t.cellID])>=0&&(O={label:this.findStr,isARegExp:this._hasARegExpFilter,indexes:this._matchingFoundArrays[A],selectedIndex:this._getSelectedIndexFromMatchingCellIDIndex(A)})}if(x.semantics.highlightModel=O,I&&I.__disposable__&&I.__disposable__.identifier===D){var P;I.disableEvents(),x.semantics.value=a,x.semantics.readOnly=x.readOnly,(P=re.getRegisteredTypeRepresentation(n))||(P={semantics:{possibleValues:re.getRegisteredEnum(n)}});var G=re.getTemplateIdentifierFromTypeRep(P,"inlinedTemplate"),N=re.getRegisteredTypeTemplate(G);f.callOutsideUserinteraction(function(){C.setTweakerProperties(I,x.semantics,P,N)}),I.enableEvents()}else x.typePath=n,x.context="inlinedTemplate",x.semantics.executionContext=t,x.needToCreateViewAfterRequireEnded=function(){return!(!t.cellView||t.cellView._currentTimeStamp!==v)},r._addTweakerToGenerate(),x.onViewCreated=function(e){if(t.cellView.setReusableContent(e),t.columnID>=0&&t.rowID>=0&&r.cellDragEnabledFlag&&!r.isCellInEdition(t.cellID)){var i=e.getContent?e.getContent():e;i&&i.setAttribute("draggable",!0)}r._removeTweakerToGenerate()},x.onFailure=function(e){r._removeTweakerToGenerate()},f.callOutsideUserinteraction(function(){re.generateView(a,x)})}else t.cellView.setReusableContent(null);var T=this._getCellKPIColor(t);T?(t.cellView.KPIColor=T,t.cellView.showKPIColorFlag=!0):t.cellView.showKPIColorFlag=!1},_manageUserInteractions:function(){var e=this;f.addEventOnElement(e,e,"buttonclick",function(t,i){if(t.target.hasClassName("wux-datagridview-selection-checkbox")&&e._selectAllCheckBoxListenChange){var n=t.target.dsModel;if(n){if(i.rowID<0)if(i.columnID<0)n.checkFlag?e.selectAllVisibleNodes():e.unselectAll();else{var o=e.layout.getColumnOrGroupFromCoordinates(i);o&&(t.options.shiftKey||e.setActiveCell(i.cellID),n.checkFlag?e.selectColumnOrGroup(o,!0,t.options.shiftKey):e.unselectColumnOrGroup(o))}e._selectAllCheckBoxListenChange=!0}}}),this._managePointerEvents(),this._manageContextualMenu()},_manageContextualMenu:function(){var e=this;void 0===e._ctxMenuToken&&(e._ctxMenuToken=_.addEventListener(this.elements.container,{callback:function(t){if(!t.info.target||!f.hasClass(t.info.target,"wux-datagridview-drag-grip")){f.pushUserInteractionContext();var i=e.getCellInfosFromHtmlElement(t.info.target);if(e.selectionBehavior.selectOnContextualEvent)if(i)e.setActiveCell(i.cellID,!0,!0),e.isCellSelected(i.cellID)||e.selectCell(i.cellID,!1);else e.setActiveCell(-1);if(i&&e.isCellInEdition(i.cellID)&&t.data.target.getTagName){var n=t.data.target.getTagName();if("input"===n||"textarea"===n)return}var o=e.onContextualEvent.call(e,{context:t.context,collectionView:e,infos:t.info,data:t.data,cellInfos:i});return f.popUserInteractionContext(),o}}}))},buildDefaultContextualMenu:function(e,t){return this._contextualMenuBuilder?this._contextualMenuBuilder.buildMenu(e,t):[]},loadCustomViews:function(e,t){"number"==typeof t&&(t<e.length?t=e[t].identifier:console.log("You are trying to set a customView that does not exist")),this.getCustomViewsManager().setCustomViews(e,t,!0)},showCustomViewsDialog:function(){return this.getCustomViewsManager()?this.getCustomViewsManager().showCustomViewsDialog():null},_buildMassUpdateDialogAttributes:function(){const e=this.layout;let t,i;const n=e.getOrderedColumnsReverseIndexes();t=this._columnsXSO&&(i=[...this._columnsXSO.get()])&&i.length>0?i.sort((e,t)=>n[e]-n[t]):e.getVisibleOrderedColumnsIndexes();const o=[],l=e.getLeafColumns();for(const i of t)if(e.getColumnEditableFlag(i)&&e.getColumnMassUpdateAllowedFlag(i)){const t=l[i];if(t){const n={name:t.dataIndex,label:t.text,typeRepresentation:e.getColumnTypeRepresentation(i),semantics:e.getColumnSemantics(i)};o.push(n)}}return o},showModelMassUpdateDialog:function(){if(!this._modelMassUpdateDialog){const e=this;this._modelMassUpdateDialog=new P({identifier:this.identifier+"_MassUpdate",treeDocument:this.getTreeDocument(),setNodeModelValueFunction:function(t,i,n){if("tree"===i||t.options.grid.hasOwnProperty(i)||void 0!==e.layout.getColumnGetCellValue(i)){const o=e.layout.getCellIDFromCoordinates({rowID:t._getRowID(),columnID:e.layout.getColumnIndex(i)});e.getCellEditableState(o)&&(e.setNodeModelValue(t,i,n),e.flashEffectOnCell("ui-modified",o))}},autoCloseFlag:!1,resizableFlag:!0,width:500,height:500})}const e=this._buildMassUpdateDialogAttributes();this._modelMassUpdateDialog.attributes=e,this._modelMassUpdateDialog.resetAttributesValues(),this._modelMassUpdateDialog.immersiveFrame=this.getContainingImmersiveFrame(),this._modelMassUpdateDialog.visibleFlag=!0,this._modelMassUpdateDialog.bringToFront()},getContainingImmersiveFrame:function(){var e=f.firstParentWithClass(this.getContent(),"wux-windows-immersive-frame");return e?e.dsModel:void 0},_onPrivateScrollEnd:function(){0===this._tweakerToGenerateCount&&!this._renderingTaskInterrupted&&this.elements&&this.elements.container&&this._onAllCellsRendered()},_onPrivateReady:function(){0===this._tweakerToGenerateCount&&this._onAllCellsRendered()},_onEndResizeListener:function(){var e=this.layout;e&&e.hasAutoWidthColumnWithAutoRowHeightFlag()&&(e._computedRows=[]),this._parent()},requestDelayedModelData:function(e,t){if(this.onDelayedModelDataRequest&&this._rowModel){var i=this.layout;if(this.getViewportDimensions().height>0||t){var n=0,o=0;if(t){n=0,o=this.getRowModelLength()-1}else{var l=i.getMinMaxVisibleRowIDs();n=l.minRowID,o=l.maxRowID}var r=t?i.getOrderedColumnsIndexes():i.getDisplayedColumnsIndexes();this._rowModel.prepareUpdate(),this.onDelayedModelDataRequest.call(this,{collectionView:this,startNodeIndex:n,endNodeIndex:o,displayedColumnsIndexes:r,context:e}),this._rowModel.pushUpdate()}}},cellShouldBeSelected:function(e){var t=this.layout.getCellCoordinatesAt(e);return t.rowID>=0&&(!this.layout.rowsHeader||-1!==t.columnID)},getEditionManager:function(e){var t=this.layout.getCellCoordinatesAt(e),i=this.layout.getColumnEditionPolicy(t.columnID);if(!this._editionManagers[i]){if("EditionOnDoubleClick"===i)this._editionManagers[i]=new V;else if("EditionOnClick"===i)this._editionManagers[i]=new y;else if("DelayedEditionOnClick"===i)this._editionManagers[i]=new b;else if("EditionOnOver"===i)this._editionManagers[i]=new M;else{if("EditionInPlace"!==i)return null;this._editionManagers[i]=new x}this._editionManagers[i]&&(this._editionManagers[i].collectionView=this)}return this._editionManagers[i]},_onEditionModeChanged:function(e,t){var i=this.layout;if((l=i.getCellCoordinatesAt(e)).columnID>=0&&l.rowID>=0&&this.cellDragEnabledFlag){var n=this._getViewAt(e).getReusableContent(),o=n.getContent?n.getContent():n;o&&o.setAttribute("draggable",!t)}if(!t){var l=i.getCellCoordinatesAt(e);i.getColumnAutoRowHeightFlag(l.columnID)&&i.resetRowHeight(l.rowID)}},_managePointerEvents:function(){var e=this;this._selectionHasBeenDoneOnDown=!1,f.addEventOnElement(this,this,r.POINTERDOWN,function(t,i){e.callMethodFromUIInteraction("_onCapturePointerDown",t,i)},!0),f.addEventOnElement(this,this,r.POINTERMOVE,function(t,i){e.callMethodFromUIInteraction("_onPointerMove",t,i)}),f.addEventOnElement(this,this,r.POINTERUP,function(t,i){e.callMethodFromUIInteraction("_onPointerUp",t,i)}),f.addEventOnElement(this,this,r.POINTERHIT,function(t,i){e.callMethodFromUIInteraction("_onPointerHit",t,i)}),f.addEventOnElement(this,this,"dblclick",function(t,i){if(j){var n=e.layout,o=n.getLeafColumns();E>=0&&E<o.length&&!0===n.getColumnResizableFlag(E)&&(e.sizeColumnOrGroupToFit(E,L,{isUserInteraction:!0,computeColumnHeader:!0}),(n.getColumnAutoRowHeightFlag(E)||n.hasAutoWidthColumnWithAutoRowHeightFlag())&&n.resetRowHeights())}})},_onPointerHit:function(e,t){if(!e.target.hasClassName||!e.target.hasClassName("wux-layouts-treeview-expander")){if(this.PointerHitScope=!0,t&&t.rowID>-1&&t.columnID>-1&&(1!==e.multipleHitCount||this._selectionHasBeenDoneOnDown||this._manageCellSelection(e,t,"up")),this._selectionHasBeenDoneOnDown=!1,t&&-1===t.rowID){if(!j){var i=this.layout;if(i.getColumnSortableFlag(t.columnID)){this._rowModel&&this._rowModel._isServerSide()&&(this.findCtx?this.findCtx.close():this.findWidget&&this.findWidget.close());var n,o=i.getDataIndexFromColumnIndex(t.columnID),l=[],r=this.sortModel;let a=!1;if(r&&r.length>0)for(var s=0;s<r.length;s++)if(r[s].dataIndex===o){if(this._useTreeDocumentRestoration&&"desc"===r[s].sort){a=!0;continue}if(n="asc"===r[s].sort?"desc":"asc",l.push({dataIndex:o,sort:n}),!e.ctrlKey)break}else e.ctrlKey&&l.push(r[s]);0===l.length&&this._useTreeDocumentRestoration&&(a?A.restoreTreeDocumentOrder(this.treeDocument):r&&0!==r.length||A.saveTreeDocumentOrder(this.treeDocument)),void 0!==n||a||(n="asc",l.push({dataIndex:o,sort:n})),this.sortModel=l,i.saveColumnSortModelInPreferences()}}}else if(t&&-1===t.columnID&&this.showSelectionCheckBoxesFlag&&t.nodeModel){if(this._selectAllCheckBoxListenChange=!1,t.rowID>=0)if(t.nodeModel.isSelected())this.unselectNodeModel(t.nodeModel);else{var a=this.getTreeDocument();a&&a.options.shouldBeSelected.call(a,t.nodeModel)&&(e.shiftKey||this.setActiveCell(t.cellID),this.selectNodeModel(t.nodeModel,!0,e.shiftKey))}this._selectAllCheckBoxListenChange=!0}this.PointerHitScope=!1}},_onPointerUp:function(e,t){q&&void 0!==E&&(this.layout._saveColumnWidthInPreferences(E),(this.layout.getColumnAutoRowHeightFlag(E)||this.layout.hasAutoWidthColumnWithAutoRowHeightFlag())&&this.layout.resetRowHeights()),q=!1,B=void 0,this.getContent().removeAttribute("is-resizing-column")},_onPointerMove:function(e,t){if(q&&void 0!==E){var i,n;L<-1?(i=this.layout.getColumnOrGroupFromCoordinates({columnID:E,rowID:L}),n=this.layout.getColumnOrGroupPinned(i)):n=this.layout.getColumnPinned(E);var o=0;return o="right"===n?B+(U-e.clientX):B+(e.clientX-U),o=Math.max(0,o),void(i?this.layout.setColumnOrGroupWidth(i,o):this.layout.setColumnWidth(E,o))}this._computeResizedColumnID(e,t)},_onCapturePointerDown:function(e,t){if(!e.target.hasClassName||!e.target.hasClassName("wux-layouts-treeview-expander")){if(this.PointerDownScope=!0,this._computeResizedColumnID(e,t),j&&void 0!==E&&E>=0)if(q=!0,e.preventDefault(),U=e.clientX,L<-1){var i=this.layout.getColumnOrGroupFromCoordinates({rowID:L,columnID:E});B=this.layout.getColumnOrGroupComputedWidth(i)}else B=this.layout.getColumnComputedWidth(E);else if(t&&-1!==t.rowID&&t.columnID>=-1){if(!e.ctrlKey&&!e.shiftKey){var n=this.getEditionManager(t.cellID);n&&n.onCellPointerDown(t.cellID)}this._selectionHasBeenDoneOnDown=!1,!(t.columnID>-1)||r.isTouchEvent(e)||this.selectionBehavior&&this.selectionBehavior.selectOnPointerUp||(this._selectionHasBeenDoneOnDown=this._manageCellSelection(e,t,"down"))}else if(!t||t.columnID<-1){var o=!1;if(e.target===this.elements.scroller.getContent()||this.hasRightContainer()&&e.target===this.elements.rightScroller.getContent()||this.hasLeftContainer()&&e.target===this.elements.leftScroller.getContent()){const t=e.target.getDimensions(),i=C.getScrollbarWidth();let n=!1,l=!1;if(e.target===this.elements.scroller.getContent()){const e=this.layout.getContentDimensions();n=t.width<e.width,l=0===this.layout.getRightContainerWidth()&&t.height<e.height}else if(this.hasRightContainer()&&e.target===this.elements.rightScroller.getContent()){const e=this.layout.getRightContainerWidth();n=t.width<e;const i=this.layout.getContentDimensions();l=t.height<i.height}else if(this.hasLeftContainer()&&e.target===this.elements.leftScroller.getContent()){const e=this.layout.getLeftContainerWidth();n=t.width<e,l=!1}(n&&e.offsetY>=t.height-i&&e.offsetY<=t.height||l&&e.offsetX>=t.width-i&&e.offsetX<=t.width)&&(o=!0)}o||(!this.selectionBehavior.unselectAllOnEmptyArea||e.ctrlKey||e.shiftKey||this.unselectAll(),this.setFocusOnCellContentFlag(!1),this.setActiveCell(-1))}this.PointerDownScope=!1}},_manageCellSelection:function(e,t,i){var n=this.layout.getColumnGetCellSelectableState(t.columnID);if(n&&!n.call(this,t))return this.setActiveCell(t.cellID),!0;var o=this.selectionBehavior.toggle||e.ctrlKey,l={cellID:this.getActiveCellID(),nodeModel:this.getNodeModelAt(this.getActiveCellID())};if(!e.shiftKey&&t.cellView&&t.cellView._reusableContent&&t.cellView._reusableContent.manageSelection&&t.cellView._reusableContent.manageSelection(e,o,l))return this.setActiveCell(t.cellID),!0;var r=this.isCellSelected(t.cellID);return r&&(this.isCellInEdition(t.cellID)||"ContextualMenuColumn"===this.layout.getColumnIdentifiers(t.columnID).dataIndex)?(this.setActiveCell(t.cellID),!0):r&&o&&"up"===i?(this.unselectCell(t.cellID),this.setActiveCell(t.cellID),!0):!(r&&"up"!==i&&!e.shiftKey)&&(this.selectCell(t.cellID,o,e.shiftKey),e.shiftKey&&t.cellView&&t.cellView._reusableContent&&t.cellView._reusableContent.manageSelection&&t.cellView._reusableContent.manageSelection(e,o,l),!0)},_computeResizedColumnID:function(e,t){var i=this.layout;if(t&&t.columnID>-1&&(t.rowID<=-1||t.columnID===i._lastLeftPinnedColumnIndex||t.columnID===i._firstRightPinnedColumnIndex||t.columnID===i._firstUnpinnedColumnIndex)){E=-1,L=-1;var n,o,l,r,s=i.getColumnOrGroupFromCoordinates(t);let a=f.firstParentWithClass(e.target,"wux-layouts-collectionview-cell");if(a){let d=a.getBoundingClientRect().x;s?(n=i.getColumnOrGroupComputedWidth(s),o=i.getColumnOrGroupPinned(s),L=t.rowID,l=t.columnID,r=t.columnID):(n=i.getColumnComputedWidth(t.columnID),o=i.getColumnPinned(t.columnID),l=t.columnID,r=t.columnID),e.clientX-d>=-1&&e.clientX-d<=W?"right"===o?E=l:(t.rowID<=-1||t.columnID===i._firstUnpinnedColumnIndex)&&(E=i._getPreviousVisibleGroupOrColumnID(L,l)):e.clientX-d>=n-W&&e.clientX-d<=n&&("right"===o?t.rowID<=-1&&(E=i._getNextVisibleGroupOrColumnID(L,r)):(t.rowID<=-1||t.columnID===i._lastLeftPinnedColumnIndex)&&(E=r))}}else E=void 0,this.hasLeftContainer()&&(e.target===this.elements.leftHeaderScrollContainer||e.target===this.elements.leftScrollContainer||e.target===this.elements.leftScroller.getContent()||e.target===this.elements.leftSpacerContainer)&&e.offsetX>=this.elements.leftScrollContainer.clientWidth-W?E=i._getColumnIDInLeafColumnHierarchyAtRowID(i._lastLeftPinnedColumnIndex,L):e.target===this._getScroller().getContent()&&e.offsetX<=W?E=i._getColumnIDInLeafColumnHierarchyAtRowID(i._lastLeftPinnedColumnIndex,L):this.hasRightContainer()&&(e.target===this.elements.rightHeaderScrollContainer||e.target===this.elements.rightScrollContainer||e.target===this.elements.rightScroller.getContent()||e.target===this.elements.rightSpacerContainer)&&e.offsetX<=W&&(E=i._getColumnIDInLeafColumnHierarchyAtRowID(i._firstRightPinnedColumnIndex,L));E>=0&&i.getColumnResizableFlag(E)?(j=!0,this._preventScroll=!0,this.getContent().setAttribute("is-resizing-column","true")):(j=!1,this._preventScroll=!1,E=void 0,this.getContent().removeAttribute("is-resizing-column"))},getRowModelLength:function(e){return this._rowModel?this._rowModel.getRowModelLength(e):0},getNodeModelAt:function(e){var t=this.layout.getCellCoordinatesAt(e);if(this._rowModel)return this._rowModel.getVisibleNodeModel(t.rowID)},hasCellValue:function(e){var t=this.layout,i=!1,n=e.nodeModel;if(n){var o=n.options.grid,l=t.getDataIndexFromColumnIndex(e.columnID);if("tree"===l||o.hasOwnProperty(l)){i=!0;var r=t.getColumnHasCellValue(e.columnID);r&&(i=r.call(this,e))}}return i},getModelAt:function(e){var t=this.layout,i=t.getCellCoordinatesAt(e);if(!(i.rowID<=-1)){if(-1===i.columnID)return""+(i.rowID+1);if(i.columnID>-1){var n=this.getLightCellInfosAt(e);if(n.nodeModel=this.getNodeModelAtRowID(i.rowID),(n.nodeModel&&n.nodeModel.getNodeSource())===a.NODE_SOURCE.GROUPING){if("tree"===(n.nodeModel&&t.getDataIndexFromColumnIndex(i.columnID)))return n.nodeModel.options.label}var o=t.getColumnHasCellValue(i.columnID);if(!o||o.call(this,n)){var l=t.getColumnGetCellValue(i.columnID);if(l)return l.call(this,n)}var r=n.nodeModel;if(r){var s=t.getDataIndexFromColumnIndex(i.columnID);if("tree"===s)if("string"===t._getCellTypeRepresentation({cellID:e,columnID:i.columnID,rowID:i.rowID,cellModel:r.options.label,nodeModel:r}))return r.options.label;return r.getAttributeValue(s)}return this._rowModel&&this._rowModel.dataSource||console.log("!! No TreeNodeModel at rowID = "+i.rowID),""}return""}var d=t.getColumnOrGroupFromCoordinates(i);if(d){var u="";return i.columnID>-1&&(i.rowID<-1||t.getColumnShowTextFlag(i.columnID)||!t.getColumnIcon(i.columnID))&&(u=d.text),u}},setModelAt:function(e,t,i){var n=this.layout,o=n.getCellCoordinatesAt(e),l=this.getNodeModelAtRowID(o.rowID);if(l){var r=n.getDataIndexFromColumnIndex(o.columnID),s=this.setNodeModelValue(l,r,t,i);s&&s.updateCellView&&this.updateCellView(e,{updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!1})}else-1!==o.rowID&&console.log("!! setModelAt NO TreeNodeModel at rowID = "+o.rowID+" cellID = "+e)},setNodeModelValue:function(t,i,n,o){if(t){var l=this.layout,r=t._getRowID(),s=l.getColumnIndex(i),a=l.getCellIDFromCoordinates({rowID:r,columnID:s}),d=l.getColumnSetCellValue(i);if(d){var u=this.getCellInfosAt(a);return void 0===o&&void 0===(o=t.getReferenceValue(i))&&void 0===(o=u.cellModel)&&(o=e.clone(n,!1)),t.setReferenceValue(i,o),d.call(this,u,n)}if("tree"===i)"string"===l._getCellTypeRepresentation({cellID:a,columnID:s,rowID:r,cellModel:n,nodeModel:t})&&(t.setLabel(n),void 0!==o&&t.setReferenceLabel(o));t.setAttribute(i,n)}},getCellInfosAt:function(e){var t=this.getModelAt(e),i=this.layout.getCellCoordinatesAt(e),n=this.getNodeModelAtRowID(i.rowID);return{cellID:e,columnID:i.columnID,rowID:i.rowID,cellModel:t,nodeModel:n}},getLightCellInfosAt:function(e){var t=this.layout.getCellCoordinatesAt(e),i=this.getNodeModelAtRowID(t.rowID);return{cellID:e,columnID:t.columnID,rowID:t.rowID,nodeModel:i}},getXSOElementID:function(e){return e?e.id:void 0},_getXSOElementFromCellID:function(e){var t=this.layout,i=t.getCellCoordinatesAt(e),n=t.getDataIndexFromColumnIndex(i.columnID),o=this.getNodeModelAtRowID(i.rowID);return{id:i.rowID+"_"+n,rowID:i.rowID,columnDataIndex:n,nodeModel:o}},getCellIDFromXSOElement:function(e){var t=-1;if(e){var i=e.rowID,n=this.layout,o=n.getColumnIndex(e.columnDataIndex);t=n.getCellIDFromCoordinates({rowID:i,columnID:o})}return t},_updateXSOElements:function(){var e=this.getCellsXSO();if(e){var t=e.get(),i=this;t.forEach(function(e){if(i.getNodeModelAtRowID(e.rowID)!==e.nodeModel&&(i.unselectCell(i.getCellIDFromXSOElement(e)),e.nodeModel.isVisible())){var t=i.layout.getCellIDFromCoordinates({rowID:e.nodeModel._getRowID(),columnID:i.layout.getColumnIndex(e.columnDataIndex)});i.selectCell(t,!0,!1,!1)}})}},_updateActiveCell:function(e){if(e){if(!e.nodeModel)return void this.setActiveCell(-1);var t=void 0;if(e.rowID>=0&&e.rowID<this.getModelLength()&&(t=this.getNodeModelAtRowID(e.rowID)),t!==e.nodeModel)if(e.nodeModel.isVisible()){var i=this.layout.getCellIDFromCoordinates({rowID:e.nodeModel._getRowID(),columnID:this.layout.getColumnIndex(e.columnDataIndex)});this.setActiveCell(i,!1,!0)}else this.setActiveCell(-1)}},_shouldHandleCopy:function(e){if(!this._parent())return!1;var t=this.getActiveCellID();if(this.isCellInEdition(t)&&e.target.getTagName){var i=e.target.getTagName();if("input"===i||"textarea"===i)return!1}return!0},_copyToPlainText:function(){var e=this.getNodesXSO(),t="",i=void 0;if(e.isEmpty()||(i=e.get().filter(function(e){return e.isVisible()})),i&&i.length>0){A.sortNodesByRowID(i);for(var n=0;n<i.length;n++){for(var o=i[n],l=this.layout.getCellsFromNodeModel(o,!0),r=0;r<l.length;r++){var s=this.getCellInfosAt(l[r]);void 0!==(c=this._getCellValueForCopy(s))&&(t+=c),r<l.length-1&&(t+="\t")}n<i.length-1&&(t+="\n")}}else{if(!this.getCellsXSO().isEmpty()){var a=this.layout._getXSORectangularShape();if(void 0===a)z("ClipboardError","ClipboardActionKoMultipleSelection");else for(var d=a.minRowID;d<a.minRowID+a.height;d++){for(var u=a.minColumnID,h=0;h<a.width;h++){var c,g={rowID:d,columnID:u},m=this.layout.getCellIDFromCoordinates(g),p=this.getCellInfosAt(m);void 0!==(c=this._getCellValueForCopy(p))&&(t+=c),h<a.width-1&&(t+="\t"),u=this.layout._getNextVisibleColumnID(u)}d<a.minRowID+a.height-1&&(t+="\n")}}}return t},_pasteFromPlainText:function(e){var t=function(e){"\n"===e[e.length-1]&&(e=e.slice(0,e.length-2));for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=t[i].split("\t");return t}(e);if(t&&t.length&&t[0]&&t[0].length){for(var i=t.length,n=t[0].length,o=1;o<i;o++)if(t[o].length!==n)return void z("ClipboardError","InconsistentNbColumnsPerRowsInClipboard");var l=this,r=function(e,t){if(l.getCellEditableState(t)){var i=l.getCellInfosAt(t);l.setModelAt(t,l._processCellValueFromPaste(i,e)),l.flashEffectOnCell("ui-modified",t)}else l.flashEffectOnCell("ui-notmodified",t)},s=this.getNodesXSO(),a=void 0;if(s.isEmpty()||(a=s.get().filter(function(e){return e.isVisible()})),a&&a.length>0){var d=this.layout.getVisibleOrderedColumnsIndexes();if(d.length!==n){if(1===n&&1===i)r(t[0][0],this.getActiveCellID());else z("ClipboardError","NbColumnsOfClipboardNotEqualToNbVisibleColumns");return}A.sortNodesByRowID(a),this._rowModel.prepareUpdate(),this.prepareUpdateView();for(var u=0,h=0;h<d.length;h++){for(var c=d[h],g=0,m=0;m<t.length;m++){var p={rowID:a[m+g]._rowID,columnID:c},f=this.layout.getCellIDFromCoordinates(p);if(r(t[m][u],f),m+g===a.length-1)break;m===t.length-1&&a.length>t.length&&(m=-1,g+=t.length)}u++}this._rowModel.pushUpdate(),this.pushUpdateView()}else{var C=this.getCellsXSO(),_=this.getActiveCellID(),w=C.get(),v=void 0;if(w.length>1){if(void 0===(v=this.layout._getXSORectangularShape()))return void z("ClipboardError","MultipleSelection");_=this.layout.getCellIDFromCoordinates({rowID:v.minRowID,columnID:v.minColumnID})}else 1===w.length&&(_=this.getCellIDFromXSOElement(w[0]));this._rowModel.prepareUpdate(),this.prepareUpdateView();var D=this.layout.getCellCoordinatesAt(_);for(g=0,m=0;m<t.length;m++){var I=D.columnID;for(u=0;u<t[m].length;u++){p={rowID:D.rowID+m+g,columnID:I},f=this.layout.getCellIDFromCoordinates(p);if(r(t[m][u],f),-1===(I=this.layout._getNextVisibleColumnID(I)))break;if(v&&u===v.width-1)break}if(v){if(m+g===v.height-1)break;m===t.length-1&&v.height>t.length&&(m=-1,g+=t.length)}}this._rowModel.pushUpdate(),this.pushUpdateView()}}},getCellIDAsString:function(e){var t=this.layout,i=t.getCellCoordinatesAt(e),n=-1;i.columnID>-1&&(n=t.getOrderedColumnsReverseIndexes()[i.columnID]);return i.rowID+":"+n},getAsCSV:function(e){var t=this.getNodesXSO(),i=this.layout,n="\ufeff",o=void 0;if(e&&e.onlySelectedRows?t.isEmpty()||(o=t.get().slice(),A.sortNodesByRowID(o)):(this.requestDelayedModelData("OnExport",!0),o=this.model),o){var l=e?e.columnKeys:void 0,r=i.getLeafColumns();if(l)for(var s=0;s<l.length;s++)l[s]=i.getColumnIndex(l[s]);else if(e&&e.allColumns){l=new Array(r.length);for(var a=0;a<r.length;a++)l[a]=a}else l=i.getVisibleOrderedColumnsIndexes();var d,u,h,c,g,m=e&&e.columnSeparator?e.columnSeparator:",",p=[],f=[];for(d=0;d<l.length;d++){for(p=[],c=i.getColumnOrGroupFromCoordinates({rowID:-1,columnID:l[d]});c;)p.push(c),c=c._parent;var C=i._getColumnTreeDepth();for(u=0;u<C;u++){if(f[u]||(f[u]="",e&&e.addLevelInformation&&(0===u?e&&e.forceQuotes?f[u]+='"'+S.get("Level")+'"':f[u]+=S.get("Level"):e&&e.forceQuotes&&(f[u]+='""'),f[u]+=m)),u>0)h=p[u]&&p[u].text?p[u].text:"";else{var _=i.getCellIDFromCoordinates({rowID:-1,columnID:l[d]}),w=this.getCellInfosAt(_);h="string"==typeof(V=this._getCellValueForExport(w))?V:p[u]&&p[u].text?p[u].text:""}h=h.replace(/\"/g,'""'),e&&e.forceQuotes||-1!==h.search(m)?f[u]+='"'+h+'"':f[u]+=h,d<l.length-1&&(f[u]+=m)}}for(g=f.length-1;g>=0;g--)n+=f[g],n+="\n";for(var v=0;v<o.length;v++){var D=o[v];if(!e||"function"!=typeof e.canNodeModelBeExported||e.canNodeModelBeExported(D)){var I=!1;for(s=0;s<l.length;s++){var V;_=i.getCellIDFromCoordinates({rowID:D._rowID,columnID:l[s]}),w=this.getCellInfosAt(_);e&&e.addLevelInformation&&!I&&w&&w.nodeModel&&(I=!0,n+=w.nodeModel.getNodeDepth(),n+=m),"string"==typeof(V=this._getCellValueForExport(w))&&(V=V.replace(/\"/g,'""'),e&&e.forceQuotes||-1!==V.search(m)||V.indexOf("\n")>-1?n+='"'+V+'"':n+=V),s<l.length-1&&(n+=m)}v<o.length-1&&(n+="\n")}}return n}},isCellSelected:function(e){var t=!1,i=this.layout,n=i.getCellCoordinatesAt(e);if(n.columnID===i._leftPinnedRowColumnID||n.columnID===i._unpinnedRowColumnID||n.columnID===i._rightPinnedRowColumnID||-1===n.columnID){if(l=this.getNodeModelAt(e)){var o=this.getNodesXSO();o&&(t=o.isIn(l))}}else t=this._parent(e);if(!t&&this.isColumnSelected(n.columnID)){var l=this.getNodeModelAt(e),r=this.getTreeDocument();l&&r&&r.options.shouldBeSelected.call(r,l)&&(t=!0)}return t},selectColumn:function(e,t,i){var n=this.layout,o=this.columnSelection;if(this._columnsXSO&&("single"===o||"multiple"===o)&&n.getColumnSelectableFlag(e)){var l=n.getColumnIndex(e);if(i&&"multiple"===o){var r=n.getOrderedColumnsIndexes();if(r&&r.length>0){var s=r[0],a=this.getActiveCellID();a>=0&&(s=n.getCellCoordinatesAt(a).columnID);var d=n.getOrderedColumnsReverseIndexes(),u=Math.min(d[s],d[l]),h=Math.max(d[s],d[l]);if(!t){var c=[];this._columnsXSO.get().forEach(function(e){var t=e;(d[t]<u||d[t]>h)&&c.push(t)}),c.length>0&&this._columnsXSO.remove(c)}for(var g=[],m=u;m<=h;m++){var p=r[m];!this._columnsXSO.isIn(p)&&n.getColumnSelectableFlag(p)&&g.push(p)}g.length>0&&this._columnsXSO.add(g)}}else t&&"multiple"===o?this._columnsXSO.add(l):this._columnsXSO.unique(l)}},unselectColumn:function(e){if(this._columnsXSO){var t=this.layout.getColumnIndex(e);this._columnsXSO.remove(t)}},selectColumnOrGroup:function(e,t,i){var n=this.layout;if(n._isGroupInBalancedTree(e))if(e&&e.children){if(n.getColumnOrGroupSelectableState(e))for(var o=O.getLeafItems(e),l=0;l<o.length;l++){var r=o[l];this.selectColumn(n.getColumnIndex(r.dataIndex),t,i)}}else this.selectColumn(n.getColumnIndex(e.dataIndex),t,i);else console.warn("selectColumnOrGroup has been called on a column or Group that does not exist in the DataGridView")},unselectColumnOrGroup:function(e){var t=this.layout;if(t._isGroupInBalancedTree(e))if(e&&e.children)for(var i=O.getLeafItems(e),n=0;n<i.length;n++){var o=i[n];this.unselectColumn(t.getColumnIndex(o.dataIndex))}else this.unselectColumn(t.getColumnIndex(e.dataIndex));else console.warn("unselectColumnOrGroup has been called on a column or Group that does not exist in the DataGridView")},isColumnSelected:function(e){var t=!1;if(this._columnsXSO&&"none"!==this.columnSelection){var i=this.layout.getColumnIndex(e);this._columnsXSO.isIn(i)&&(t=!0)}return t},isColumnOrGroupSelected:function(e){var t=!1,i=!1;if(e&&e.children){var n=this.layout;if(n.getColumnOrGroupSelectableState(e)){t=void 0;for(var o=0;o<e.children.length;o++){var l=e.children[o];if(n.getColumnOrGroupSelectableState(l)){var r=this.isColumnOrGroupSelected(l);if(r?!1===t||"mixedState"===r?i=!0:t=!0:(t&&(i=!0),t=!1),i)break}}}}else e&&(t=this.isColumnSelected(e.dataIndex));return i?"mixedState":t},getColumnsXSO:function(){return this._columnsXSO},getXSOColumnID:function(e){return e},unselectAll:function(){this._parent(),this._columnsXSO&&this._columnsXSO.empty()},_getCellValueForExport:function(e){var t=this.layout.getColumnOptionValue(e.columnID,"getCellValueForExport");return t instanceof Function||(t=K),t.call(this,e)},_getCellValueForCopy:function(e){var t=void 0;return e.nodeModel&&!e.nodeModel._isFromOriginalModel()||(t=this.layout.getColumnOptionValue(e.columnID,"getCellValueForCopy")),t instanceof Function||(t=K),t.call(this,e)},_getCellValueForSort:function(e,t){var i=this.layout.getColumnOptionValue(t,"getCellValueForSort");return i instanceof Function||(i=Y),i.call(this,e,t)},_processCellValueFromPaste:function(e,t){var i=void 0;return e.nodeModel&&!e.nodeModel._isFromOriginalModel()||(i=this.layout.getColumnOptionValue(e.columnID,"processCellValueFromPaste")),i instanceof Function||(i=J),i.call(this,e,t)},insertRowCallback:function(e,t,i){},openPrintableViewWindow:function(e){var t=this;this.displayModalLoader(S.get("GeneratingPrintableView"),function(){var i="<!DOCTYPE html>";i+=t.generatePrintableViewHTML();var n=N.getWebappsAssetUrl("DataGridView","index-datagridview-print.htm");n=n.replace("assets/","");var o,l=!1;if(navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(l=!0),e&&!l){var r=document.createElement("iframe");document.body.appendChild(r),r.src="#"+(new Date).getTime(),r.style.border=0,r.style.position="absolute",r.style.width="0px",r.style.height="0px",r.style.right="0px",r.style.top="0px",r.doc=null,r.doc=r.contentDocument?r.contentDocument:r.contentWindow?r.contentWindow.document:r.document,o={win:r.contentWindow,doc:r.doc,elem:r}}else{var s=window.open(n,"_blank","scrollbars=yes,toolbar=yes,location=no,resizable=yes,width=1200,height=800");o={win:s,doc:s.document,elem:s}}if(o){o.doc.open("text/html","_blank");for(var a=window.document.styleSheets,d=0;d<a.length;d++){var u=a[d];o.doc.write('<link rel="stylesheet" type="text/css" href="'+u.href+'" />')}if(o.doc.write(i),o.doc.close(),o.doc.title=S.get("PrintableView"),o.doc.body&&(o.doc.body.style.overflow="auto"),e){t.displayModalLoader(S.get("GeneratingPrintableView"));var h=function(){o.win.focus(),o.win.onafterprint=function(){o.elem.parentElement.removeChild(r)},t.removeModalLoader(S.get("GeneratingPrintableView")),o.win.print()};H.ie?setTimeout(h,1e3):o.win.onload=h}}t.removeModalLoader(S.get("GeneratingPrintableView"))})},generatePrintableViewHTML:function(){this.requestDelayedModelData("OnPrint",!0);var e='<table class="wux-layouts-datagridview wux-print-datagridview-table">';e+=this._generatePrintableColumnHeaders();this.model;for(var t=0;t<this.getModelLength();t++){e+=this._generatePrintableRow(t)}return"</tbody>",e+="</table>"},_generatePrintableColumnHeaders:function(){for(var e=this.layout,t="<thead>",i=new c,n=0;n<e._columnItemsByDepth.length;n++){var o=e._columnItemsByDepth[n];t+="<tr>",this.hasFlatTreeState()||(t+='<th class="wux-layouts-collectionview-cell wux-layouts-datagridview-cell wux-layouts-datagridview-column-header-cell" column-header>',n===e._columnItemsByDepth.length-1&&(t+=S.get("Level")),t+="</th>");for(var l=0;l<o.length;l++){var r=o[l];if(e.getColumnOrGroupPrintableState(r)){var s,a=-e._columnItemsByDepth.length+n;s=a<-1?l:e.getColumnIndex(r.dataIndex);var d=e.getCellIDFromCoordinates({rowID:a,columnID:s}),u=this.getCellInfosAt(d);u.cellView=i,t+=this._generatePrintableCell(u)}}t+="</tr>"}return t+="</thead>",i.setReusableContent(null),i.destroy(),t},_generatePrintableRow:function(e){var t=this.layout,i=this.getNodeModelAtRowID(e),n=i.getNodeDepth(),o="<tr";0===n&&i.hasChildren()&&(o+=" root-node"),o+=">";var l=new h;if(!this.hasFlatTreeState()){o+='<td class="wux-layouts-collectionview-cell wux-layouts-datagridview-cell" align="center">';var r=i.hasChildren()&&(0===n||!i.isExpanded());if(n>0){if(r&&(o+='<div class="wux-print-datagridview-expander">'),o+='<div class="wux-tweakers wux-tweakers-string wux-tweakers-string-label">',o+=n,o+="</div>",r){var s=i.isExpanded()?"chevron-down":"chevron-right";o+=f.generateIcon({iconName:s,fontIconFamily:WUXManagedFontIcons.Font3DS}).outerHTML,o+="</div>"}}else if(r){s=i.isExpanded()?"chevron-down":"chevron-right";o+=f.generateIcon({iconName:s,fontIconFamily:WUXManagedFontIcons.Font3DS}).outerHTML}o+="</td>"}for(var a=t.getVisibleOrderedColumnsIndexes(),d=0;d<a.length;d++){var u=a[d];if(t.getColumnPrintableFlag(u)){var c=t.getCellIDFromCoordinates({rowID:e,columnID:u}),g=this.getCellInfosAt(c);g.cellView=l,o+=this._generatePrintableCell(g)}}return o+="</tr>",l.setReusableContent(null),l.destroy(),o},_generatePrintableCell:function(e){var t,i=this.layout;if(e.rowID<0){t='<th class="wux-layouts-collectionview-cell wux-layouts-datagridview-cell wux-layouts-datagridview-column-header-cell" column-header';var n=i.getColumnOrGroupFromCoordinates(e),o=i._getVisibleLeafCount(n);o>1&&(t+=' colspan="'+o+'"'),t+=">"}else{t='<td class="wux-layouts-collectionview-cell wux-layouts-datagridview-cell"';var l=i.getColumnOptionValue(e.columnID,"alignment");"center"===l?t+=' align="center"':"far"===l&&(t+=' align="right"'),t+=">"}this._setTweakerForCell(e,{readOnly:!0});var r=e.cellView.getReusableContent();r&&r.getContent&&(t+=r.getContent().outerHTML);return e.rowID<0?t+="</th>":t+="</td>",t},executePendingNotifications:function(e){if(this._rowModel&&this._rowModel._executePendingNotifications)return this._rowModel._executePendingNotifications(e)},flushPendingNotifications:function(){this._rowModel&&this._rowModel._flushPendingNotifications&&this._rowModel._flushPendingNotifications()},hasPendingNotifications:function(){if(this._rowModel&&this._rowModel._hasPendingNotifications)return this._rowModel._hasPendingNotifications()},getPendingNotifications:function(){if(this._rowModel&&this._rowModel._getPendingNotifications)return this._rowModel._getPendingNotifications()},getGroupingOptions:function(){if(this._rowModel)return this._rowModel._groupingOptions},resetTreeDocument:function(){if(this._rowModel&&this._rowModel._isServerSide())return this._rowModel._resetTreeDocument()},getNodeModelAtRowID:function(e){if(this._rowModel)return this._rowModel._getNodeModelAtRowID(e)},getModelLength:function(){return this._rowModel?this._rowModel._getDataGridViewModelDisplayedLength():0},_updateModel:function(){this._rowModel&&this._rowModel._updateModel()}})}),define("DS/DataGridView/RowModelServerSide",["DS/DataGridView/RowModelBase","DS/DataGridView/DataGridView","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/TreeModel/ModelUtils","DS/Utilities/Utils","DS/Utilities/Object","DS/DataGridView/DataGridViewFilterViewManager","UWA/Core"],function(e,t,i,n,o,l,r,s,a){"use strict";return e.inherit({name:"RowModelServerSide",publishedProperties:{dataGridView:{defaultValue:null,type:"object"},dataSource:{defaultValue:null,type:"object"},sortModel:{defaultValue:null,type:"array"},virtuallyLoadAllModelItems:{defaultValue:!1,type:"boolean"}},_preBuild:function(){this._parent(),this._rowRequestManager=new Map,this._loadedUnloadedNodesMap=new Map,this._DGVRowIDNodeModelMapping=new Map,this._DGVNodeModelRowIDMapping=new Map},_applyProperties:function(e){this._parent(e),this.isDirty("dataSource")&&this._applyDataSource(e.dataSource),this.isDirty("sortModel")&&this._applySortModel(e.sortModel)},_updateModel:function(){this._resetTreeDocument()},_loadRows:function(e,t,i,o){if(!this._treeDocument)return!1;if(e||(e=this._treeDocument._getTrueRoot()),!e)return!1;void 0===i&&(i=0,this._providePushNotifVisualFeedBack=!1);var l=this.dataGridView,s=this;if(e._dgv_allRowsLoaded&&(!l.paginationManager||e!==s._getTreeDocument()._getTrueRoot()))return!1;var a,d,u=e.buildStringIdentifierArray(),h=this._getCurrentPaginationOptions();if(h&&e===this._treeDocument._getTrueRoot()){var c=(h.currentPage-1)*h.pageSize;if(d=(a=o?o.startRow+c:e.getChildren()?e.getChildren().length+c:c)+s.dataSource.numberOfRowsPerRequest-1,a=a<h.nodeMin?h.nodeMin:a,(d=d>h.nodeMax?h.nodeMax:d)<a)return!1;if(e===s._getTreeDocument()._getTrueRoot()&&e._dgv_numberOfChildren){if(a===e._dgv_numberOfChildren)return!1;d=d>e._dgv_numberOfChildren?e._dgv_numberOfChildren:d}}else!0===this.virtuallyLoadAllModelItems&&void 0!==o?(a=o.startRow,d=o.endRow):d=(a=e.getChildren()?e.getChildren().length:0)+s.dataSource.numberOfRowsPerRequest-1;var g={startRow:a,endRow:d,sortModel:s.sortModel,rowGrouping:s._groupingOptions,groupKeys:u,filterModel:this.dataSource.getFilterManager()?this.dataSource.getFilterManager().filterModel:void 0};if(!0===this.virtuallyLoadAllModelItems){var m={parentNode:e,startRow:a};g.requestDataForVirtualLoading=m}return s._gettingRowsFlag=!0,0!==l.model.length||s._modalLoaderDisplayed||(l.displayModalLoader("Loading data"),s._modalLoaderDisplayed=!0),s.dataSource.getModelItems({request:g,successCallback:function(i,o,d,u){if(!t||t===s._lastModelRequestTimeStamp)if(0!==d&&0!==o){var h=a,c=[],g=[];if(!0===s.virtuallyLoadAllModelItems){if(void 0===d)throw"Error : need to provide total number of children (numberOfChildren) for all nodes when virtuallyLoadAllModelItems is set to true.";if(a=u.startRow,e=u.parentNode,s.dataGridView.model.length&&(h=s._getRealPositionInParentNode(e,a)),s._loadedUnloadedNodesMap){var m=s._loadedUnloadedNodesMap.get(e);if(m)for(var p=1;p<m.length;p++)g.push(m[p])}c=s._updateLoadedUnloadedData(e,d,a,i.length,s._loadedUnloadedNodesMap)}var f=h;s.prepareUpdate();var C=s._treeDocument.getUseChangeTransactionMode();s._treeDocument.setUseChangeTransactionMode(!1);for(var _=s._treeDocument&&s._treeDocument.options.nodeModelClass?s._treeDocument.options.nodeModelClass:n,w=0;w<i.length;w++){var v=i[w],D=a+w;let t=e.getChildren()?e.getChildren().length:0;var I=!0===s.virtuallyLoadAllModelItems?s._isNodeAlreadyLoaded(D,g):a+w<t,V=new _({label:v.tree,icons:v.icons,grid:v,children:v.wux_group?[]:void 0});if(v.stringIdentifier&&(V.stringIdentifier=v.stringIdentifier),I){if(!s._currentMatchingNodeModel||!r.areEquals(s._currentMatchingNodeModel.options.grid,V.options.grid)){V.destroy&&V.destroy(),f++;continue}e.removeChild(s._currentMatchingNodeModel),s._currentMatchingNodeModel=V}if(e.addChild(V,f),f++,s._providePushNotifVisualFeedBack){var y=V._getRowID();null!=y&&s.dataGridView._flashEffectOnRow("ui-modified-push-notif",y)}}s._providePushNotifVisualFeedBack=!1,!0===s.virtuallyLoadAllModelItems&&s._updateMultipleNodesRep(e,c);var b=s._rowRequestManager.get(e);if(s.virtuallyLoadAllModelItems||void 0!==b&&s._rowRequestManager.set(e,Math.min(b,e.getNumberOfChildren(!0)-s.dataSource.rowsOffsetToTriggerRequest)),d&&(e._dgv_numberOfChildren=d,l.paginationManager&&e===s._getTreeDocument()._getTrueRoot()&&l.paginationManager.pageNumberModified()),o>-1&&((!s.virtuallyLoadAllModelItems||1===c.length&&c[0]===d)&&(e._dgv_allRowsLoaded=!0),!e._dgv_numberOfChildren&&e===s._getTreeDocument()._getTrueRoot())){var M=s._getCurrentPaginationOptions();if(M){var x=(M.currentPage-1)*M.pageSize;e._dgv_numberOfChildren=e._options.children?e._options.children.length:0,e._dgv_numberOfChildren+=x,l.paginationManager.pageNumberModified()}else e._dgv_numberOfChildren=e._options.children?e._options.children.length:0}0===h&&e.preExpandDone(),s._treeDocument._indexRowIndexes(),s._syncModel({updateType:WUXModelUpdateTypes.Addition}),!0===s._modalLoaderDisplayed&&(l.removeModalLoader(),s._modalLoaderDisplayed=!1),l.model&&0===l.model.length?l._displayEmptyContentMessage():l._removeEmptyContentMessage(),s._gettingRowsFlag=!1,s._treeDocument.setUseChangeTransactionMode(C),s.pushUpdate(),s._groupingOptions&&s._groupingOptions.dataIndexesToGroup&&s._getTreeDocument().getModelEvents().publish({event:"groupChildren"})}else!0===s._modalLoaderDisplayed&&(l.removeModalLoader(),s._modalLoaderDisplayed=!1),!0===s.virtuallyLoadAllModelItems&&(e=u.parentNode),e&&(0===o&&(e._dgv_allRowsLoaded=!0),s._updateLoadedNodeWithoutChildExpander(e))},failCallback:function(e){!0===s._modalLoaderDisplayed&&(l.removeModalLoader(),s._modalLoaderDisplayed=!1),e&&console.warn(e),s._gettingRowsFlag=!1}}),!0},getRowModelLength:function(){var e=this._getTreeDocument();if(e){var t=e._getTrueRoot();if(t){if(!this.virtuallyLoadAllModelItems||this._getCurrentPaginationOptions()){if(void 0!==t._dgv_numberOfChildren)return t._dgv_numberOfChildren;var i=this._getCurrentPaginationOptions();return i?(i.currentPage-1)*i.pageSize+this.dataGridView.model.length:this.dataGridView.model.length}var n=0;return this._loadedUnloadedNodesMap.forEach(function(e,i){i&&(i===t||i.isVisible()&&i.isExpanded())&&(n+=e[0])}),n}}return 0},getVisibleNodeModel:function(e,t){if(!(e<0)){var i=this.dataGridView,n=void 0,o=i.model;e<this._getDataGridViewModelDisplayedLength()&&(n=this._getNodeModelAtRowID(e));var l=n;!l&&o.length&&(l=o[o.length-1]);var r=void 0;if(n&&(r=l.getParent()),r||(r=this._treeDocument._getTrueRoot()),l&&r){var s=this._getVirtualLocalIDInParentNodeFromRowID(e);if(void 0===s)return;var a=this._rowRequestManager.get(r);this.virtuallyLoadAllModelItems||void 0!==a||(a=this.dataSource.numberOfRowsPerRequest-this.dataSource.rowsOffsetToTriggerRequest);var d,u=!1;if(this.virtuallyLoadAllModelItems){u=(h=this._needToLoadRows(e,r,this.dataSource.numberOfRowsPerRequest,!1)).needLoadingRequest,d=h.requestData}else u=s>a;if(!0===u)if(this.virtuallyLoadAllModelItems){var h,c=this._getUnloadedItemsAfterIncludingRowID(e,r,this.dataSource.numberOfRowsPerRequest,this._rowRequestManager.get(r)),g=this._getUnloadedItemsBefore(e,r,this.dataSource.numberOfRowsPerRequest,this._rowRequestManager.get(r)),m=c.number,p=g.number,f=m>0&&p>0?this.dataSource.rowsOffsetToTriggerRequest:0,C=void 0!==r._getRowID()&&null!==r._getRowID()?r._getRowID()+1:0,_=Math.max(C,e-f);if(u=(h=this._needToLoadRows(_,r,this.dataSource.numberOfRowsPerRequest)).needLoadingRequest,d=h.requestData,!0===h.needLoadingRequest){this._requestToDo||(this._requestToDo=[],this._parentNodesArray=[]);var w={parentNode:r,rowID:e,rowIDToLoad:_,currentTimeStamp:t,requestData:d};this._requestToDo.push(w),this._parentNodesArray.push(r);var v=this;setTimeout(function(){if(v._requestToDo.length>1)v._requestToDo.splice(0,1);else if(1===v._parentNodesArray.length){var e=v._requestToDo[0];v._parentNodesArray=[],v._requestToDo=[],v._loadRows(e.parentNode,e.currentTimeStamp,e.rowIDToLoad,e.requestData)}else{for(var t=0;t<v._parentNodesArray.length;t++){var i=v._loadedUnloadedNodesMap.get(v._parentNodesArray[t]);if(i)for(var n=[],o=0;o<i.length;o++)n.push(i[o]);v._rowRequestManager.set(v._parentNodesArray[t],n)}var l=v._parentNodesArray[v._parentNodesArray.length-1];v._parentNodesArray=[];e=v._requestToDo[0];var r=v._getUnloadedItemsAfterIncludingRowID(e.rowID,l,v.dataSource.numberOfRowsPerRequest,v._rowRequestManager.get(l)),s=v._getUnloadedItemsBefore(e.rowID,l,v.dataSource.numberOfRowsPerRequest,v._rowRequestManager.get(l)),a=r.number,u=s.number,h=a>0&&u>0?v.dataSource.rowsOffsetToTriggerRequest:0,c=void 0!==l._getRowID()&&null!==l._getRowID()?l._getRowID()+1:0,g=Math.max(c,e.rowID-h),m=v._needToLoadRows(e.rowIDToLoad,e.parentNode,v.dataSource.numberOfRowsPerRequest);v._requestToDo=[],d=m.requestData,v._loadRows(e.parentNode,e.currentTimeStamp,g,d)}},500)}}else this._rowRequestManager.set(r,r.getNumberOfChildren(!0)+(this.dataSource.numberOfRowsPerRequest-this.dataSource.rowsOffsetToTriggerRequest)),this._loadRows(r,t,e,d)}else if(!n||n!=l){var D=this._getCurrentPaginationOptions();(!D||D.nodeMax-D.nodeMin>=i.model.length)&&this._loadRows(r,t,e)}return n}},_isModelBeingFetched:function(){return this._gettingRowsFlag},_getTreeDocument:function(){if(!this._treeDocument){this._treeDocument=new i({useAsyncPreExpand:!0,nodeModelClass:this.dataGridView.nodeModelClass||n}),this._listenToTreeDocument();var e=this;this._treeDocument.onPreExpand(function(t){var i=!1,n=t.target;n&&void 0!==n.getChildren()&&0===n.getChildren().length&&(n.setState({state:"expanding"}),i=e._loadRows(n)),i||n.preExpandDone()}),this._treeDocument.onPostExpand(function(t){var i=t.target;e._updateLoadedNodeWithoutChildExpander(i)}),this._treeDocument.onPostCollapse(function(t){var i=t.target;e._updateLoadedNodeWithoutChildExpander(i)})}return this._treeDocument},_resetTreeDocument:function(){if(this.dataGridView.getCellsXSO().empty(),this._rowRequestManager.clear(),this._loadedUnloadedNodesMap.clear(),this._treeDocument){var e=this._treeDocument.getUseChangeTransactionMode();this._treeDocument.setUseChangeTransactionMode(!1),this._treeDocument._getTrueRoot()._dgv_allRowsLoaded=!1,this._getCurrentPaginationOptions()||(this._treeDocument._getTrueRoot()._dgv_numberOfChildren=void 0),this._treeDocument.empty(),this._treeDocument.setUseChangeTransactionMode(e)}if(this.dataSource){this._getTreeDocument();var t=performance.now();this._lastModelRequestTimeStamp=t,this.getVisibleNodeModel(0,t)}},_applyDataSource:function(e){var t=this;this.dataGridView._isReady&&this._resetTreeDocument(),e&&e._modelEvents&&this._dataSourceModelEventListenerArray&&this._cleanDataSourceEventListener(),this.dataSource&&(this._rowRequestManager.clear(),this._loadedUnloadedNodesMap.clear(),this._dataSourceModelEventListenerArray||(this._dataSourceModelEventListenerArray=[]),this._dataSourceModelEventListenerArray.push(this.dataSource._modelEvents.subscribe({event:"pushUpdatesNotifications"},function(e){t._onPushUpdatesNotifications(e.dataToUpdateArray,e.callback)})),this._dataSourceModelEventListenerArray.push(this.dataSource._modelEvents.subscribe({event:"executePendingNotifications"},function(){t.dataGridView.executePendingNotifications()})),this._dataSourceModelEventListenerArray.push(this.dataSource._modelEvents.subscribe({event:"flushPendingNotifications"},function(){t.dataGridView.flushPendingNotifications()})))},_applyVirtuallyLoadAllModelItems:function(){if(this.dataGridView._isReady){if(this._getTreeDocument()){var e=this;this._getTreeDocument()._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(t){if(t.nodeModel){var i=[];if(e._loadedUnloadedNodesMap){var n=e._loadedUnloadedNodesMap.get(t.nodeModel.getParent());if(n)for(var o=1;o<n.length;o++)i.push(n[o]);e._rowRequestManager.clear(),e._loadedUnloadedNodesMap.clear()}e._updateMultipleNodesRep(t.nodeModel.getParent(),i)}}})}this._syncModel()}},_applySortModel:function(e){this.dataGridView._isCurrentlyCalledFromUIInteraction()||this.dataGridView._currentlyCalledFromApplyPreferencesFlag||(this._originalSortModel=this.sortModel?[].concat(this.sortModel):this.sortModel),this.dataGridView._isReady&&this._resetTreeDocument()},_doGroupingOnModel:function(e){this.dataGridView._isReady&&this._resetTreeDocument()},_updateLoadedUnloadedData:function(e,t,i,n,o,l){var r=o.get(e),s=[];if(r)for(var a=1;a<r.length;a++)s.push(r[a]);var d=[];if(0===s.length){var u;if(i>0)d.push(0),d.push(i),d.push(n),(u=t-n-i)>0&&d.push(u);else d.push(n),(u=t-n)>0&&d.push(u)}else{for(var h=[],c=[],g=n,m=0,p=0,f=i,C=0;C<s.length;C++){var _;if(p=m,m+=s[C],C%2==0){if(h.push(s[C]),f<m&&g>0)g-=_=Math.min(m-f,g),f=m}else if(f<m&&g>0)g-=_=Math.min(m-f,g),f-p>0?(c.push(f-p),h.push(_)):h[h.length-1]+=_,c.push(m-(f+_)),f=m;else c.push(s[C])}d=this._removeNullValues(void 0,h,c)}d.unshift(t),!1!==l&&o.set(e,d);for(var w=[],v=1;v<d.length;v++)w.push(d[v]);return w},_removeNullValues:function(e,t,i){if(!t){t=[],i=[];for(var n=0;n<e.length;n++)n%2==0?t.push(e[n]):i.push(e[n])}for(var o=[],l=!1,r=!1,s=0;s<t.length;s++)!1===l?0!==t[s]||0===s?o.push(t[s]):r=!0:(o[o.length-1]+=t[s],l=!1),s<i.length?!1===r?0!==i[s]?o.push(i[s]):l=!0:(o[o.length-1]+=i[s],r=!1):l=!0;return o},_modifyLoadedUnloadedNodes:function(e,t,i,n,o){var l=o.get(e);l||(l=[0,0]);var r=[],s=l[0];if(0===s&&!1===i)return-1;for(var a=1;a<l.length;a++)r.push(l[a]);for(var d=0,u=!1,h=0;h<r.length;h++)if((d+=r[h])>=t){if(h%2==0){var c=[];if(i)n?r[h]=r[h]+1:(c.push(r[h]-(d-t)),c.push(1),c.push(d-t),r.splice(h,1,c[0]),r.splice(h+1,0,c[1]),r.splice(h+2,0,c[2]),r=this._removeNullValues(r));else{if(d===t)continue;if(1===r[h])if(0===h)r[h]=0;else{var g=h+1<r.length?r[h+1]:0,m=r[h-1]+g;r.splice(h-1,3,m)}else r[h]>0?r[h]=r[h]-1:(h<r.length-1&&(r[h+1]=r[h+1]-1),r=this._removeNullValues(r))}u=!0;break}c=[];if(i)n?(c.push(r[h]-(d-t)),c.push(1),c.push(d-t),r.splice(h,1,c)):r[h]=r[h]+1;else{if(d===t)continue;if(1===r[h]){g=h+1<r.length?r[h+1]:0,m=r[h-1]+g;r.splice(h-1,3,m)}else r[h]=r[h]-1}u=!0;break}var p=s;return!1===u?console.log("Warning, trying to insert or remove a node at location",t," whereas parentNode called ",e.options.label," only owns ",d," items (loaded or unloaded)"):(p=i?s+1:s-1,r.unshift(p),o.set(e,r)),p},_addItemInLoadedUnloadedData:function(){},_updateMultipleNodesRep:function(e,t){this.prepareUpdate();var i=e.getChildren();if(i)for(var o=i.length-1;o>=0;o--){var l=i[o];void 0!==l.options.multipleNodesRep&&e.removeChild(l)}if(!0===this.virtuallyLoadAllModelItems)for(var r=this._treeDocument&&this._treeDocument.options.nodeModelClass?this._treeDocument.options.nodeModelClass:n,s=0,a=0;a<t.length;a++)if(a%2==0)s+=t[a];else{var d=new r({label:"",multipleNodesRep:t[a]});e.addChild(d,s),s+=1}this.pushUpdate()},_getVirtualLocalIDInParentNodeFromRowID:function(e){var t=this.dataGridView.model;if(this.virtuallyLoadAllModelItems){var i;if(!(i=this._getNodeModelAtRowID(e)).getParent())return;for(var n=i.getParent().getChildren(),o=0,l=0,r=0;r<n.length;r++){if(n[r]===i){o=l;break}void 0===n[r].options.multipleNodesRep?l++:l+=n[r].options.multipleNodesRep}return e-this._DGVNodeModelRowIDMapping.get(i)+o}return(i=t[e])._getLocalID()},_getRealPositionInParentNode:function(e,t){var i=e.getChildren(),n=0;if(!i||0===i.length)return 0;for(var o=0;o<=i.length;o++){if(t<=n)return o;if(o===i.length)return t;void 0===i[o].options.multipleNodesRep?n++:n+=i[o].options.multipleNodesRep}},_needToLoadRows:function(e,t,i,n){var o=this._computeRowsToLoad(e,t,i,this._rowRequestManager.get(t)),l=o.startRow,r=o.numberToLoad?o.numberToLoad:o.endRow-l==0?0:o.endRow-l+1;if(!(s=this._loadedUnloadedNodesMap.get(t)))return{needLoadingRequest:!0,requestData:o};var s,a=this._loadedUnloadedNodesMap.get(t)[0],d=[];if(s=this._rowRequestManager.get(t))for(var u=1;u<s.length;u++)d.push(s[u]);else d=this._updateLoadedUnloadedData(t,a,l,r,this._rowRequestManager);for(var h=0,c=0;c<d.length;c++){var g=h+=d[c];if(d.length>c+1&&(g+=d[c+1]),r>0&&l>=h&&l<g)return c%2==1?{needLoadingRequest:!1}:(this._updateLoadedUnloadedData(t,a,l,r,this._rowRequestManager,n),{needLoadingRequest:!0,requestData:o})}return{needLoadingRequest:!1}},_getUnloadedItemsBefore:function(e,t,i,n){var o=0,l=e,r=e,s=e,a=e,d=this._getDataGridViewModelDisplayedLength();if(this.dataGridView&&this.dataGridView.model&&e<d){for(var u=i+this.dataSource.rowsOffsetToTriggerRequest,h=Math.max(0,e-1-u),c=e-1;c>=h;c--){var g=this._getNodeModelAtRowID(c);if(this._isNodeLoadedOrLoading(g,t,c,n)||g.getParent()!==t||(0===o&&(r=c),l=c,o++),g.getParent()!==t)break;if(c<=e-this.dataSource.rowsOffsetToTriggerRequest&&0===o){o=0;break}}s=this._getVirtualLocalIDInParentNodeFromRowID(l),a=this._getVirtualLocalIDInParentNodeFromRowID(r)}return{number:o,startingRowID:s,endingRowID:a}},_getUnloadedItemsAfterIncludingRowID:function(e,t,i,n){var o=0,l=e,r=e,s=e,a=e,d=this._getDataGridViewModelDisplayedLength();if(this.dataGridView&&this.dataGridView.model&&e<d){for(var u=i+this.dataSource.rowsOffsetToTriggerRequest,h=Math.min(d,e+u),c=e;c<h;c++){var g=this._getNodeModelAtRowID(c);if(!this._isNodeLoadedOrLoading(g,t,c,n)&&g.getParent()===t){0===o&&(l=c);r=c;o++}if(g.getParent()!==t)break;if(c>=e+this.dataSource.rowsOffsetToTriggerRequest&&0===o){o=0;break}}s=this._getVirtualLocalIDInParentNodeFromRowID(l),a=this._getVirtualLocalIDInParentNodeFromRowID(r)}return{number:o,startingRowID:s,endingRowID:a}},_computeRowsToLoad:function(e,t,i,n){if(n&&n.length>2){var o=this._getUnloadedItemsAfterIncludingRowID(e,t,i,n);if(o.number>=i)return{startRow:o.startingRowID,endRow:o.startingRowID+i-1};var l=this._getUnloadedItemsBefore(e,t,i,n);return o.number>0?l.number>0&&l.endingRowID===o.startingRowID-1?{startRow:Math.max(l.startingRowID,o.endingRowID-i+1),endRow:o.endingRowID}:{startRow:o.startingRowID,endRow:Math.min(o.startingRowID+i-1,o.endingRowID),numberToLoad:o.number}:{startRow:Math.max(l.endingRowID-i+1,l.startingRowID),endRow:l.endingRowID}}return n&&2==n.length?{startRow:0,endRow:0}:{startRow:0,endRow:i-1}},_isNodeLoadedOrLoading:function(e,t,i,n){if(e.options.multipleNodesRep){for(var o=this._getVirtualLocalIDInParentNodeFromRowID(i),l=0,r=1;r<n.length;r++)if(o<(l+=n[r]))return r%2==1;return!1}return!0},_updateClientModelFromFind:function(e,t,i,o,l,r){if(e!==this._findStr&&(this._findCurrentResultValue=void 0,this._findStr=e),!this._isRequestNeededForNextFindValue(i,t))return this._findCurrentResultValue=i,this._parent(e,t,i,o,!0,!0);this._findMatchCase=t,this._findCurrentResultValue=i;var s=this;s._launchServerFindTimeout&&clearTimeout(s._launchServerFindTimeout),s._launchServerFindTimeout=setTimeout(function(){if(s._launchServerFindTimeout=null,!0!==s.virtuallyLoadAllModelItems)throw'Error : Find cannot be launched on a Server side model if "virtuallyLoadAllModelItems" of dataGridView is not applied.';var l=s.dataGridView,r=s._getColumnsToProcessForFindData(l,e,t).findableColumnsDataIndexes,a={findStr:e,matchCase:t,findCurrentValue:i,findNavigationMode:s.dataGridView.findNavigationMode,sortModel:s.sortModel,rowGrouping:s._groupingOptions,requestDataForFindOnServer:{findCurrentValue:i,findRequestTimeStamp:s._lastFindRequestTimeStamp},filterModel:s.dataSource.getFilterManager()?s.dataSource.getFilterManager().filterModel:void 0,findableColumnsDataIndexes:r};s._gettingRowsFlag=!0,0!==l.model.length||s._modalLoaderDisplayed||(l.displayModalLoader("Loading data"),s._modalLoaderDisplayed=!0),s.dataSource.getCurrentFindResult({request:a,successCallback:function(e,t,i,r,a,d){if(d.findRequestTimeStamp===s._lastFindRequestTimeStamp){var u=d.findCurrentValue;if(u>=r&&(u=0),s._findCurrentResultValue=u,s._findcurrentValueIndexInRow=a,e&&Array.isArray(e)&&e.length>0){if(e.length!==t.length||t.length!==i.length)throw"ERROR in Find server side returned values : all returned array must have the same length. Please check your returned arrays.";var h=s._treeDocument.getUseChangeTransactionMode();s._treeDocument.setUseChangeTransactionMode(!1);var c=s._getTreeDocument()._getTrueRoot();s.prepareUpdate();for(var g=s._treeDocument&&s._treeDocument.options.nodeModelClass?s._treeDocument.options.nodeModelClass:n,m=0;m<e.length;m++){var p=e[m],f=t[m],C=i[m],_=s._getNodeInClientModel(c,f);if(_)c=_;else{var w=s._updateLoadedUnloadedData(c,C,f,1,s._loadedUnloadedNodesMap);s._updateLoadedUnloadedData(c,C,f,1,s._rowRequestManager);var v=s.dataGridView.getGroupingOptions(),D=v&&v.dataIndexesToGroup?v.dataIndexesToGroup.length:0,I=new g({label:p.tree,icons:p.icons,grid:p,children:m!==e.length-1||m<D?[]:void 0,_isFindTempLoadedNode:!0});p.stringIdentifier&&(I.stringIdentifier=p.stringIdentifier);var V=f;s.dataGridView.model.length&&(V=s._getRealPositionInParentNode(c,f)),c.addChild(I,V),s._updateMultipleNodesRep(c,w),c=I}c&&m==e.length-1&&(s._currentMatchingNodeModel=c)}s._treeDocument._indexRowIndexes(),s._syncModel({updateType:WUXModelUpdateTypes.Addition},!0),!0===s._modalLoaderDisplayed&&(l.removeModalLoader(),s._modalLoaderDisplayed=!1),l.model&&0===l.model.length?l._displayEmptyContentMessage():l._removeEmptyContentMessage(),s._gettingRowsFlag=!1,s._treeDocument.setUseChangeTransactionMode(h),s.pushUpdate(),s._groupingOptions&&s._groupingOptions.dataIndexesToGroup&&s._getTreeDocument().getModelEvents().publish({event:"groupChildren"})}s._findResultNumber=r,s._matchingStringCount=r,"cell"===s.dataGridView.findNavigationMode?s._matchingCellIDsCount=r:"row"===s.dataGridView.findNavigationMode&&(s._matchingRowsCount=r),o&&o.call(s,u)}},failCallback:function(e){!0===s._modalLoaderDisplayed&&(l.removeModalLoader(),s._modalLoaderDisplayed=!1),e&&console.warn(e),s._gettingRowsFlag=!1}})},500)},_getNodeInClientModel:function(e,t){var i=e.getChildren(),n=-1;if(i)for(var o=0;o<i.length;o++)if(void 0===i[o].options.multipleNodesRep){if(++n===t)return i[o]}else if((n+=i[o].options.multipleNodesRep)>=t)return},_isNodeAlreadyLoaded:function(e,t){for(var i=0,n=0;n<t.length;n++)if(i+=t[n],n%2==0){if(e<i)return!0}else if(e<i)return!1},_computeMatchingStringsCount:function(e){return e?this._parent(e):this._matchingStringCount},_computeMatchingCellIDsCount:function(){return this._matchingCellIDsCount},_computeMatchingNodeModelsCount:function(){return this._matchingRowsCount},_computeCurrentMatchingStringIndex:function(e,t){return this._getCurrentSubstringAndCellIDIndexFromNodeModelOccurrence(e,this._currentMatchingNodeModel,this._findcurrentValueIndexInRow)},_getCurrentSubstringAndCellIDIndexFromNodeModelOccurrence:function(e,t,i){var n=e._matchingAllNodeModelsArray.indexOf(t);if(-1===n)throw"ERROR : given nodeModel is not found among found nodeModels.";var o,l=0;if("cell"===e.findNavigationMode){for(var r=0;r<e._matchingCellIDsArray.length;r++){var s=e._matchingCellIDsArray[r];if(e.getCellInfosAt(s).nodeModel===t)break;l++}var a=l+i;o=e._getMatchingStringIndexFromMatchingCellIDIndex(a)}else if("row"===e.findNavigationMode)l=e._matchingNodeModelsArray.indexOf(t),o=e._getMatchingStringIndexFromMatchingRowIDIndex(l);else{for(r=0;r<n;r++)l+=e._matchingFoundArrays[r].length;o=l+i}return o},_computeNextMatchingData:function(e,t){return t?this._parent(e,t):this._getCurrentSubstringAndCellIDIndexFromNodeModelOccurrence(this.dataGridView,this._currentMatchingNodeModel,this._findcurrentValueIndexInRow)},_computePreviousMatchingData:function(e,t){return t?this._parent(e):this._getCurrentSubstringAndCellIDIndexFromNodeModelOccurrence(this.dataGridView,this._currentMatchingNodeModel,this._findcurrentValueIndexInRow)},_computeFindEditorCurrentValue:function(){return this._findCurrentResultValue+1},_getNodeModelsToProcessFromMatchCaseChange:function(){},_isRequestNeededForNextFindValue:function(e,t){var i=this._findCurrentResultValue;if(void 0===i)return!0;if(this._findMatchCase!==t)return!0;var n,o=this.dataGridView,l=e-i;if(0===l)return!1;if(1===l||i===this._findResultNumber-1&&0===e)n=this._computeNextMatchingData(o,!0);else{if(-1!==l&&(0!==i||e!==this._findResultNumber-1))throw"Find increment is not possible : problem!!!!!!";n=this._computePreviousMatchingData(o,!0)}if(n===o._currentMatchingStringIndex)return!0;var r,s,a=o._getMatchingCellIDIndexFromMatchingStringIndex(n);if((a-o._currentMatchingCellIDIndex)*l<0)return!0;var d=o._getMatchingCellID(o._currentMatchingCellIDIndex),u=o._getMatchingCellID(a);if(a>o._currentMatchingCellIDIndex?(r=o.getNodeModelAt(d),s=o.getNodeModelAt(u)):(r=o.getNodeModelAt(u),s=o.getNodeModelAt(d)),!r||!s)return!0;if(r._getID()===s._getID())return!1;var h=!1,c=!1,g=!1;return this._getTreeDocument()._getTrueRoot().processDescendants({onlyVisibleNodes:!1,processNode:function(e){var t=e.nodeModel;if(t)if(t._getID()===r._getID()){if(c=!0,Array.isArray(t._options.children)&&0===t._options.children.length)return h=!0,g=!0,{stopProcessing:!0}}else{if(t._getID()===s._getID()&&!g)return h=!1,g=!0,{stopProcessing:!0};if(!0===c&&!g&&(void 0!==t.options.multipleNodesRep||Array.isArray(t._options.children)&&0===t._options.children.length))return h=!0,g=!0,{stopProcessing:!0}}}}),h},_isServerSide:function(){return!0},_setFilterViewManager:function(e){var t=this,i=e.getFilterManager();i&&(this._currentFilters=this._getFiltersModelData(e),i.subscribe("filterModelChange",function(i){var n=t._getFiltersModelData(e);r.areEquals(t._currentFilters,t._getFiltersModelData(e))||(t.dataGridView.findCtx?t.dataGridView.findCtx.close():t.dataGridView.findWidget&&t.dataGridView.findWidget.close(),t._resetTreeDocument(),t._currentFilters=n),t._currentFilters=n}),this._filterViewManager?this._filterViewManager.filterManager=i:this._filterViewManager=new s({view:this.dataGridView,filterManager:i}))},_getFiltersModelData:function(e){var t={};if(e.getFilterManager()&&e.getFilterManager().getFilters())for(var i in e.getFilterManager().getFilters())t[i]=a.clone(e.getFilterManager().getFilters()[i].filterModel,!0);return t},_updateLoadedNodeWithoutChildExpander:function(e){if(e&&!0===e._dgv_allRowsLoaded&&(null===e.getChildren()||0===e.getChildren().length)){var t=this.dataGridView;this.dataGridView.updateCellView(t.layout.getCellIDFromCoordinates({rowID:e._getRowID(),columnID:t.layout.getColumnIndex("tree")}),{updateCellContent:!0})}},destroy:function(){this._cleanDataSourceEventListener(),this._parent()},_cleanDataSourceEventListener:function(){if(this._dataSourceModelEventListenerArray)for(var e=0;e<this._dataSourceModelEventListenerArray.length;e++)this.dataSource._modelEvents.unsubscribe(this._dataSourceModelEventListenerArray[e])},_onPushUpdatesNotifications:function(e,t){var i=0;if(e&&Array.isArray(e))if(this.dataGridView.syncClientModelOnDemand){this._pendingPushNotificationsArray||(this._pendingPushNotificationsArray=[]);for(var n=0;n<e.length;n++)this._pendingPushNotificationsArray.push(e[n])}else{var o=this.dataSource.convertPushUpdatesNotificationsWithContext(e,{sortModel:this.sortModel,filterModel:this.dataSource.getFilterManager()?this.dataSource.getFilterManager().filterModel:void 0,rowGrouping:this.dataGridView.getGroupingOptions()});i=this._synchronizeTreeDocumentFromDataSourceUpdate(o)}t&&t.call(this.dataSource,{treatedNotificationsNodesNumber:i})},_hasPendingNotifications:function(){return this._pendingPushNotificationsArray&&this._pendingPushNotificationsArray.length>0},_getPendingNotifications:function(){return this._pendingPushNotificationsArray},_synchronizeTreeDocumentFromDataSourceUpdate:function(e){var t=0;if(e&&e.length>0){this.dataGridView.findCtx?this.dataGridView.findCtx.close():this.dataGridView.findWidget&&this.dataGridView.findWidget.close();var i=[];this.prepareUpdate(),this.dataGridView.prepareUpdateView();var n=this._treeDocument.getUseChangeTransactionMode();this._treeDocument.setUseChangeTransactionMode(!1),this._providePushNotifVisualFeedBack=!1;for(var o=0;o<e.length;o++){var l=this._treatNotification(e[o]);t+=l.treatedNotificationsNodesNumber,i=i.concat(l.modifiedNodes),this._syncModel(),"nodesRemoved"!==e[o].operationType&&(this._providePushNotifVisualFeedBack=!0)}this._treeDocument.setUseChangeTransactionMode(n);for(o=0;o<i.length;o++){var r=i[o];null!=r&&this.dataGridView._flashEffectOnRow("ui-removed",r)}this.pushUpdate(),this.dataGridView.pushUpdateView();var s=this;setTimeout(function(){s._providePushNotifVisualFeedBack=!1},2e3)}return t},_executePendingNotifications:function(e){if(this._pendingPushNotificationsArray&&Array.isArray(this._pendingPushNotificationsArray)){var t=this.dataSource.convertPushUpdatesNotificationsWithContext(this._pendingPushNotificationsArray,{sortModel:this.sortModel,filterModel:this.dataSource.getFilterManager()?this.dataSource.getFilterManager().filterModel:void 0,rowGrouping:this.dataGridView.getGroupingOptions()}),i=0;t&&Array.isArray(t)&&(i=this._synchronizeTreeDocumentFromDataSourceUpdate(t)),this._flushPendingNotifications()}e&&e.call(this.dataSource,{treatedNotificationsNodesNumber:i})},_flushPendingNotifications:function(){this._pendingPushNotificationsArray=[]},_treatNotification:function(e){switch(e.operationType){case"nodesAdded":return this._addNodesFromDataSourceRequest(e.nodesNumber,e.nodesPath);case"nodesRemoved":return this._removeNodesFromDataSourceRequest(e.nodesNumber,e.nodesPath);case"nodesChanged":return this._changeNodesFromDataSourceRequest(e.nodesNumber,e.nodesPath,e.nodesLocationsArrayAfterChange)}},_getNodeLocationData:function(e){for(var t=this._getTreeDocument()._getTrueRoot(),i=e.length>0?e[0]:void 0,n=0;n<e.length;n++){i=e[n];var o=this._getNodeInClientModel(t,i);if(!o)break;n<e.length-1&&(t=o)}return{parentNode:t,indexInParentNode:i}},_addNodesFromDataSourceRequest:function(e,t){return this._modifyNodesFromDataSourceRequest(e,t,"add")},_modifyNodesFromDataSourceRequest:function(e,t,i,n){var o=[];if(!e)return o;var l=e,r=this._getNodeLocationData(t),s=r.parentNode,a=!!s,d=r.indexInParentNode;s&&Array.isArray(s.getChildren())&&0===s.getChildren().length&&(a=!1);if(a)for(var u=0;u<e;u++){var h=this._loadedUnloadedNodesMap.get(s)?this._loadedUnloadedNodesMap.get(s)[0]:0;if(d<0||d>("add"===i?h:h-1))console.warn("Warning, given index is outside parent bounds."),l--;else if("add"===i)this._addNodeToParentAtPosition(s,d),d++;else if("remove"===i){var c=this._removeNode(s,d);void 0!==c&&o.push(c+u)}else if(this._removeNode(s,d),n){if(void 0===n[u]){for(var g=[],m=0;m<t.length;m++)m!==t.length-1?g.push(t[m]):g.push(d+u);n[u]=g}}else this._addNodeToParentAtPosition(s,d),d++}if(n){var p=n.sort(function(e,t){for(var i=Math.min(e.length,t.length),n=0;n<i;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}});for(u=0;u<p.length;u++){var f=p[u];this._modifyNodesFromDataSourceRequest(1,f,"add")}}return{modifiedNodes:o,treatedNotificationsNodesNumber:l}},_addNodeToParentAtPosition:function(e,t){var i=this._modifyLoadedUnloadedNodes(e,t,!0,!1,this._loadedUnloadedNodesMap);return this._modifyLoadedUnloadedNodes(e,t,!0,!1,this._rowRequestManager),e._dgv_numberOfChildren=i,e._dgv_allRowsLoaded=!1,this._updateRealAndUnloadedDataAfterUnitOperation(e),[]},_updateRealAndUnloadedDataAfterUnitOperation:function(e){for(var t=this._loadedUnloadedNodesMap.get(e),i=[],n=1;n<t.length;n++)i.push(t[n]);this._updateMultipleNodesRep(e,i),this._treeDocument._indexRowIndexes()},_removeNodesFromDataSourceRequest:function(e,t){return e&&t.length?this._modifyNodesFromDataSourceRequest(e,t,"remove"):[]},_removeNode:function(e,t){var i,n=this._getNodeInClientModel(e,t);if(t<(this._loadedUnloadedNodesMap.get(e)?this._loadedUnloadedNodesMap.get(e)[0]:0)){if(void 0!==n){var o=t;this.dataGridView.model.length&&(o=this._getRealPositionInParentNode(e,t));var l=e.getChildren()[o];l&&(l.isVisible()&&(i=l._getRowID()),e.removeChild(l))}this._modifyLoadedUnloadedNodes(e,t,!1,void 0,this._loadedUnloadedNodesMap),this._modifyLoadedUnloadedNodes(e,t,!1,void 0,this._rowRequestManager),this._updateRealAndUnloadedDataAfterUnitOperation(e)}return i},_changeNodesFromDataSourceRequest:function(e,t,i){if(e&&t.length)return this._modifyNodesFromDataSourceRequest(e,t,"change",i)},_getDataGridViewModelDisplayedLength:function(){if(!this.dataGridView.model||!Array.isArray(this.dataGridView.model))return 0;if(!this.dataGridView.virtuallyLoadAllModelItems)return this.dataGridView.model.length;var e=0;return this.dataGridView.model.forEach(function(t){t&&(void 0!==t.options.multipleNodesRep?e+=t.options.multipleNodesRep:e+=1)}),e},_getNodeModelAtRowID:function(e){if(this.dataGridView.model&&Array.isArray(this.dataGridView.model))return this.dataGridView.virtuallyLoadAllModelItems?this._DGVRowIDNodeModelMapping?this._DGVRowIDNodeModelMapping.get(e):void 0:this.dataGridView.model[e]}})});