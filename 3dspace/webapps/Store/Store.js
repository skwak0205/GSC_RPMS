define("DS/Store/StoreBodyPage",["UWA/Core","UWA/Class/View","i18n!DS/Store/assets/nls/StoreComponents"],function(e,t,n){"use strict";return t.extend({className:"registration3ds-steps-container",render:function(){var t,n,o;return this.stepInfoContainer=e.createElement("div",{class:"step-info-container"}),t=e.createElement("div",{class:"steps-info",html:[this._initNavTabs(),this.stepInfoContainer]}),this.greyContainer=e.createElement("div",{class:"grey-container"}),n=e.createElement("div",{class:"steps-info-for-user",html:this.greyContainer}),o=e.createElement("div",{class:"registrations-steps",html:[t,n]}),this.container.setContent(o),this},_updateNavTabs:function(e){this.step1.toggleClassName("current",1===e),this.step2.toggleClassName("current",2===e),this.step3.toggleClassName("current",3===e),this.step1.toggleClassName("validated",2===e||3===e),this.step2.toggleClassName("validated",3===e),this.transition1.toggleClassName("performed",2===e||3===e),this.transition2.toggleClassName("performed",3===e)},_initNavTabs:function(){return this.step1=e.createElement("div",{class:"steps step1",html:[e.createElement("div",{class:"numerotation font-3dsregular",text:"1"}),e.createElement("div",{class:"label-step-container",html:e.createElement("div",{class:"label-step font-3dsregular",text:n.get("login")})})]}),this.transition1=e.createElement("div",{class:"steps transition fonticon fonticon-chevron-right fonticon-4x"}),this.step2=e.createElement("div",{class:"steps step2",html:[e.createElement("div",{class:"numerotation font-3dsregular",text:"2"}),e.createElement("div",{class:"label-step-container",html:e.createElement("div",{class:"label-step font-3dsregular",text:n.get("validate")})})]}),this.transition2=e.createElement("div",{class:"steps transition fonticon fonticon-chevron-right fonticon-4x"}),this.step3=e.createElement("div",{class:"steps step3",html:[e.createElement("div",{class:"numerotation font-3dsregular",text:"3"}),e.createElement("div",{class:"label-step-container",html:e.createElement("div",{class:"label-step font-3dsregular",text:n.get("complete")})})]}),e.createElement("div",{class:"steps-nav",html:[this.step1,this.transition1,this.step2,this.transition2,this.step3]})}})}),define("DS/Store/StoreTokenInputComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Text","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFTokenModel/TokenModel","i18n!DS/Store/assets/nls/StoreComponents"],function(e,t,n,o,r,a,s,i){"use strict";return t.extend({className:"mpf-token-input",setup:function(e){e||(e={}),this._parent(e),a.requiredOfPrototype(e.token,s,"options.token must be a TokenModel"),this.token=e.token,this.codeInput=new n({placeholder:i.get("enterCode"),value:this.token.getToken(),multiline:!1,id:"token",disabled:!0}),this.alert=new r({visible:!0,maximumVisibleMessages:1}),this.spinner=new o},render:function(){var t;return t=e.createElement("form",{html:[this.codeInput,this.alert]}),this.container.setContent(t),this.dispatchEvent("onRender"),this},checkToken:function(){var e=this;return this.dispatchEvent("checkingToken"),this.spinner.inject(this.container.getElement(".mpf-token-input input"),"after"),this.spinner.show(),this.token.set({token:this.codeInput.getValue()}),this.token.savePromise().then(function(t,n){var o=e.token.getProcessingCode(),r=e.token.get("message");if(e.spinner.hide(),0===o||7===o)e._displayValidationMessage(),e.dispatchEvent("validated",e.token.getSource());else if(4===o){var a=window.location.origin.replace("apps","ifwe");window.location.replace(a)}else 5===o?e._displayErrorMessage(i.get("tokenAlreadyUsed")):6===o||9===o?e._displayErrorMessage(i.get("errDeployment")):8===o&&e.dispatchEvent("loading",e.token.getCartID());console.warn("token code: "+o+", message: "+r)}).catch(function(t){e.spinner.hide(),e._displayErrorMessage(i.get("tokenError")),console.error(t.response)})},_displayValidationMessage:function(){var e=this.alert.getMessages();e.length>0&&this.alert.remove(e[0]),this.alert.add({className:"success",message:i.get("tokenSuccess")})},_displayErrorMessage:function(e){var t=this.alert.getMessages();t.length>0&&this.alert.remove(t[0]),this.alert.add({className:"error",message:e})}})}),define("DS/Store/StoreHeaderPage",["UWA/Core","UWA/String","UWA/Class/View","i18n!DS/Store/assets/nls/StoreComponents"],function(e,t,n,o){"use strict";return n.extend({className:"registration3ds-page-header",render:function(){var t;return t=e.createElement("div",{class:"registration3ds-placeholder font-3dsregular",html:[this._getPlaceholderTitle(),this._getPlaceholderLabel()]}),this.container.setContent(t),this},_getPlaceholderTitle:function(){var t,n,o;return t=e.createElement("span",{class:"font-3dsbold",text:"3D"}).outerHTML+"EXPERIENCE",n=e.createElement("span",{class:"brand-container",html:t}),o=e.createElement("div",{class:"title",html:n.outerHTML+" Social Collaboration Services"}),e.createElement("div",{class:"title-container",html:o})},_getPlaceholderLabel:function(){var n,r,a,s;return n=e.createElement("span",{class:"font-3dsbold",text:"3D"}).outerHTML+"EXPERIENCE",r=t.format(o.get("power"),n),a=t.format(o.get("offerIsTheGateway"),e.createElement("span",{class:"font-3dsregular",html:r}).outerHTML),s=e.createElement("div",{class:"exp-label font-3dslight",html:a}),e.createElement("div",{class:"title-desc",html:s})}})}),define("DS/Store/StoreDeployBodyPage",["UWA/Core","DS/UIKIT/Spinner","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/Store/StoreBodyPage","DS/MPFCartModel/CartModel","i18n!DS/Store/assets/nls/StoreComponents"],function(e,t,n,o,r,a,s){"use strict";return r.extend({init:function(e){e||(e={}),this._parent(e),o.requiredOfPrototype(e.cart,a,"options.cart must be a CartModel"),this.cart=e.cart,this.alert=new n({className:"alert-deploy",visible:!0,maximumVisibleMessages:1})},render:function(){var n,o,r,a,i,c=this;return this._parent(),this.greyContainer.hide(),n=e.createElement("div",{class:"step-info-complete",html:[{tag:"span",class:"label-info-step3-bold",text:s.get("registrationComplete")},{tag:"br"},{tag:"span",class:"label-info-step3",text:s.get("waitMinutes")}]}),o=new t({animate:!1}),r=e.createElement("div",{class:"spinner-container",html:[o,this.alert]}),a=e.createElement("iframe",{width:"640",height:"360",src:"https://www.youtube.com/embed/kmI9zN3Uqyo"}),this._updateNavTabs(3),this.stepInfoContainer.setContent([n,r]),a.inject(this.greyContainer,"after"),o.show(),i=window.setInterval(function(){c.cart.fetch(c._manageDeploy(i,o,a))},2e3),window.setTimeout(function(){o.hide(),c._displayAlert("primary",s.get("deployPlatform")),window.clearInterval(i)},18e4),this},_manageDeploy:function(e,t,n){var o,r=this;return{onComplete:function(){r.cart.getState()===a.States.FAILED||r.cart.getState()===a.States.BLOCKED||r.cart.getState()===a.States.EXPIRED?(t.hide(),window.clearInterval(e),r._displayAlert("error",s.get("errDeployment"))):r.cart.getState()===a.States.DELIVERED&&(window.clearInterval(e),o=window.location.origin.replace("apps","ifwe"),window.location.replace(o))},onFailure:function(){window.clearInterval(e),t.hide(),r._displayAlert("error",s.get("errMsg"))}}},_displayAlert:function(e,t){var n;(n=this.alert.getMessages()).length>0&&this.alert.remove(n[0]),this.alert.add({className:e,message:t})}})}),define("DS/Store/StoreTokenBodyPage",["UWA/Core","UWA/String","DS/UIKIT/Input/Button","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/Store/StoreBodyPage","DS/MPFServices/ObjectService","DS/MPFUrl/UrlUtils","DS/MPFDataProxy/AppsConnector","DS/Store/StoreTokenInputComponent","DS/Usage/TrackerAPI","DS/MPFModelFactory/TokenFactory","DS/MPFModelFactory/SoftwareAgreementFactory","DS/MPFModelFactory/CartFactory","DS/MPFModelFactory/TCContractFactory","DS/MPFModelFactory/PersonFactory","i18n!DS/Store/assets/nls/StoreComponents"],function(e,t,n,o,r,a,s,i,c,l,d,p,m,h,g,u,f,S){"use strict";return s.extend({init:function(e){e||(e={}),this._parent(e),this._checkPrototypes(e),this.tokenFactory=e.tokenFactory,this.token=this.tokenFactory.createModel("validate"),this.personFactory=e.personFactory,this.me=this.personFactory.createModel("me"),this.softwareAgreementFactory=e.softwareAgreementFactory,this.softwareAgreementModel=this.softwareAgreementFactory.createModel(),this.cartFactory=e.cartFactory,this.cart=this.cartFactory.createModel("CART"),this.tcContractFactory=e.tcContractFactory,this.tcContract=this.tcContractFactory.createModel("existing-document"),this._checkTokenUrlParam(this.token),this.alert=new o({className:"alert-deploy",visible:!0,maximumVisibleMessages:1})},render:function(){var n,o;return n=e.createElement("div",{class:"step-info",html:[{tag:"div",class:"label-info-step2",html:[t.format(S.get("accessConditionToMy3DExperienceMessage"),e.createElement("span",{class:"ds-blue",html:[{tag:"strong",text:"3D"},"EXPERIENCE Social Collaboration Services"]}).outerHTML,e.createElement("strong",{text:"CATIA"}).outerHTML,e.createElement("strong",{text:"SOLIDWORKS"}).outerHTML)]},{tag:"div",class:"label-info-step2",text:S.get("accessConditionToMy3DExperienceMessage2")}]}),o=e.createElement("div",{text:S.get("registrationCode"),class:"labelInput"}),this._parent(),this._updateNavTabs(2),this.tokenInput=new d({token:this.token}),this._initListeners(),this.stepInfoContainer.setContent([n,this.alert]),o.inject(this.stepInfoContainer.getParent(),"after"),this.greyContainer.setContent(this.tokenInput.render()),this.tokenInput.checkToken(),this},_initListeners:function(){var e=this;this.listenTo(this.tokenInput,"validated",function(t){e._getAgreements(t)}),this.listenTo(this.tokenInput,"loading",function(t){e.cart.set({id:t}),e.dispatchEvent("onDeploy",e.cart)})},_getAgreements:function(e){var t=this;return this.me.fetchPromise().then(this.softwareAgreementModel.fetchPromise.bind(this.softwareAgreementModel,{token:t.token.getToken()})).then(this._displayAgreements.bind(this,e)).catch(function(){t._displayAlert("error",S.get("errMsg"))})},_displayAgreements:function(o){var a,s,i,c;console.warn("software agreements code: "+this.softwareAgreementModel.getCode()+", message: "+this.softwareAgreementModel.getMessage()),10===this.softwareAgreementModel.getCode()?this._displayAlert("error",S.get("serviceUnavailable")):(i=e.createElement("a",{text:S.get(o+"LinkAgreement"),target:"_blank",href:this.softwareAgreementModel.get("url")}),s=new n({value:S.get("next"),className:"primary next",disabled:"true",events:{onClick:this._signContracts.bind(this)}}),a=new r({type:"switch",value:"tc",label:"",className:"primary",events:{onChange:function(){s.setDisabled(!this.isChecked())}}}),c=e.createElement("span",{html:t.format(S.get(o+"Agreements"),i.outerHTML)}),a.inject(this.greyContainer,"after"),a.elements.label.setContent(c),s.inject(a.elements.container,"after")),p.registerData("authUser",this.me.getFirstName()+" "+this.me.getLastName())},_signContracts:function(){var e=this;return this.token.dataProxy=this.tokenFactory.getDataProxy("consume"),this.tcContract.set({consumerID:this.me.get("id"),documentID:this.softwareAgreementModel.get("id"),currentState:"IN_EFFECT"}),a.mask(this.greyContainer.getParent()),this.tcContract.savePromise().then(function(){return e.token.set({agreementID:e.tcContract.get("id")}),e.token.savePromise()}).then(function(){var t,n,o;t=e.token.getProcessingCode(),n=e.token.get("message"),2===t?(o=window.location.origin.replace("apps","ifwe"),window.location.replace(o)):3===t?e._displayAlert("error",S.get("noCustomer")):4===t||10===t?e._displayAlert("error",S.get("serviceUnavailable")):8===t?e._displayAlert("error",S.get("expiredLicenses")):(e.cart.set({id:e.token.getCartID()}),e.dispatchEvent("onDeploy",e.cart)),console.warn("token code: "+t+", message: "+n)}).catch(function(t){e._displayAlert("error",S.get("errMsg")),console.error(t.response)}).finally(function(){a.unmask(e.greyContainer.getParent())})},_checkTokenUrlParam:function(e){var t,n=window.location.search.match(/token=([^&#]+)/);n&&n[1]&&(t=n[1],e.set("token",t))},_displayAlert:function(e,t){var n;(n=this.alert.getMessages()).length>0&&this.alert.remove(n[0]),this.alert.add({className:e,message:t})},_checkPrototypes:function(e){i.requiredOfPrototype(e.tokenFactory,m,"options.tokenFactory must be a TokenFactory"),i.requiredOfPrototype(e.softwareAgreementFactory,h,"options.softwareAgreementFactory must be a SoftwareAgreementFactory"),i.requiredOfPrototype(e.cartFactory,g,"options.cartFactory must be a CartFactory"),i.requiredOfPrototype(e.tcContractFactory,u,"options.tcContractFactory must be a TokenFactory"),i.requiredOfPrototype(e.personFactory,f,"options.personFactory must be a PersonFactory")}})}),define("DS/Store/StoreTokenPage",["UWA/Core","UWA/Promise","UWA/Utils","UWA/Class/View","DS/MPFModelFactory/MPFFactoriesV2","DS/UIKIT/Mask","DS/i3DXCompass/i3DXCompass","DS/TopBar/TopBar","DS/TopBarProxy/TopBarProxy","DS/MPFDataProxy/MarketplaceConnector","DS/MPFDataProxy/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFAppsPlatform/ServiceEnum","DS/Store/StoreHeaderPage","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFPersonModel/MePersonDataProxy","DS/Store/StoreTokenBodyPage","DS/Store/StoreDeployBodyPage","DS/Usage/UsageManager","i18n!DS/Store/assets/nls/StoreComponents","css!DS/Store/Store","css!DS/TopBar/TopBar","css!DS/i3DXCompass/i3DXCompass"],function(e,t,n,o,r,a,s,i,c,l,d,p,m,h,g,u,f,S,y,w,v){"use strict";var C={LOADING:"loading",ACTIVE:"active"};return o.extend({className:"page-container",init:function(t){var n=this;this._parent(t),this.stateMachine=new u({state:C.LOADING,states:[C.LOADING,C.ACTIVE],transitions:[{from:C.LOADING,to:C.ACTIVE},{from:C.ACTIVE,to:C.LOADING}]}),e.createElement("div",{id:"my-apps-ct"}).inject(document.body,"top"),this._getPlatform().then(function(e){var t;if(!(t=e.services.get(h.PASSPORT.name)))throw new Error("Passport service not found");n._initTopBar(t.getUrl()),n._initCompass(),n.stateMachine.changeState(C.ACTIVE),n.render(t.getUrl())}),w.init("/upload","My3DExperience")},render:function(n){var o,s,c,d,p,m,h,g,u=this;return o=document.getElementById("topbar"),this.stateMachine.getState()===C.LOADING?a.mask(this.container):l.fetchPromise({service:"3DStore"}).then(function(e){return c=r.getInstance(e),t.all([c.getFactory(r.Types.TOKEN),c.getFactory(r.Types.PERSON),c.getFactory(r.Types.SOFTWARE_AGREEMENT),c.getFactory(r.Types.CART),c.getFactory(r.Types.TC_CONTRACT)])}).then(function(e){var t={};return d=e[0],h=e[1],p=e[2],g=e[3],m=e[4],s=h.createModel("me"),t[f.Params.ALLOW_CREATION]=!0,s.fetchPromise(t)}).then(function(){return s.fetchPromise()}).then(function(){s.getFirstName()&&s.getLastName()&&(i.set("userName",s.getFirstName()+" "+s.getLastName()),u._initTopBarSubmenus(n)),o.style.display="flex",e.is(o.getElement(".topbar-menu-item-badge"))&&o.getElement(".topbar-menu-item-badge").setStyle("display","none")}).finally(function(){var e;e=new S({tokenFactory:d,personFactory:h,softwareAgreementFactory:p,cartFactory:g,tcContractFactory:m}),u.listenTo(e,"onDeploy",function(e){u._displayDeployBodyPage(e)}),u._buildContainer(e),w.pages.push({url:"TokenPage",timestamp:Date.now()})}),this},_displayDeployBodyPage:function(e){var t;t=new y({cart:e}),this._buildContainer(t),w.pages.push({url:"DeployPage",timestamp:Date.now()})},_buildContainer:function(e){var t;t=new g,this.container.setContent([t.render(),e.render()])},_getPlatform:function(){var e,t;function n(e){return e.services.get(h.MARKETPLACE.name)}return e=new d(window.location.origin+"/enovia/resources/AppsMngt"),t=new p(e),new m([],{dataProxy:t}).fetchPromise().then(function(e){return e.find(n)})},_initTopBar:function(e){i.init({brand:"Onboarding",topMenus:{profile:!0,add:!1,share:!1,home:!1,help:!1},useTagger:!1,userName:"Profile",loginUrl:e+"/login?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash),signupUrl:e+"/register?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)}),i.view.container.getElement(".topbar-center").remove()},_initCompass:function(){var e,t=this;e={},window.location.hash&&window.location.hash.substring(1,window.location.hash.length).split("/").forEach(function(t){var n=t.split(":");e[n[0]]=n[1]}),s.initialize({compassTarget:"compass_ctn",appsTarget:"my-apps-ct",myAppsBaseUrl:n.buildUrl(window.location,"../../"),userId:e.userId,passportUrl:n.buildUrl(window.location,"assets/PassportStub"),proxyTicketUrl:n.buildUrl(window.location,"assets/AppStub/ticket?url=V6"),lang:"en",closable:!0,onOpen:function(){t.container.setStyles({width:"80%",float:"right"})},onClose:function(){t.container.setStyles({width:"100%",float:"none"})}})},_initTopBarSubmenus:function(e){var t=new c({id:"persoMenu"}),n={profile:[{label:v.get("signOut"),onExecute:function(){window.location.href=e+"/logout?service="+encodeURIComponent(window.location.origin+"/enovia/resources/ordering")}}]};t.setContent(n),i.MainMenuBar.setActiveMenuProviders("persoMenu")}})}),define("DS/Store/StoreRegistrationBodyPage",["UWA/Core","UWA/Utils","UWA/String","DS/UIKIT/Input/Button","DS/Store/StoreBodyPage","DS/MPFUrl/UrlUtils","DS/MPFDataProxy/AppsConnector","i18n!DS/Store/assets/nls/StoreComponents"],function(e,t,n,o,r,a,s,i){"use strict";return r.extend({render:function(){var t,r;return t=e.createElement("div",{class:"step-info",html:n.format(i.get("accessToMy3DExperienceMessage"),e.createElement("span",{class:"ds-blue",html:[{tag:"strong",text:"3D"},"EXPERIENCE Social Collaboration Services"]}).outerHTML,e.createElement("strong",{text:"3DEXPERIENCE ID"}).outerHTML,e.createElement("strong",{text:"SOLIDWORKS ID"}).outerHTML)}),r=new o({value:i.get("login"),className:"primary login",events:{onClick:this._onClick.bind(this)}}),this._parent(),this._updateNavTabs(1),this.stepInfoContainer.setContent(t),this.greyContainer.setContent(r),this},_onClick:function(){s.fetchPromiseSynchro().then(function(e){var n,o;o=new a(window.location.href).setPath("/enovia/resources/ordering/token").getUrl(),n=new a(e.rootUrl).addParameter("platform",e.platformId).addParameter("url",t.base64Encode(o)).addParameter("roles","MPU").getUrl(),window.location.href=n})}})}),define("DS/Store/StoreRegistrationPage",["UWA/Core","UWA/Utils","UWA/Class/View","DS/UIKIT/Mask","DS/i3DXCompass/i3DXCompass","DS/TopBar/TopBar","DS/MPFDataProxy/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFAppsPlatform/ServiceEnum","DS/Store/StoreHeaderPage","DS/Store/StoreRegistrationBodyPage","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/Usage/UsageManager","i18n!DS/Store/assets/nls/StoreComponents","css!DS/Store/Store","css!DS/TopBar/TopBar","css!DS/i3DXCompass/i3DXCompass"],function(e,t,n,o,r,a,s,i,c,l,d,p,m,h,g){"use strict";var u={LOADING:"loading",ACTIVE:"active"};return n.extend({className:"page-container",init:function(t){var n=this;this._parent(t),this.stateMachine=new m({state:u.LOADING,states:[u.LOADING,u.ACTIVE],transitions:[{from:u.LOADING,to:u.ACTIVE},{from:u.ACTIVE,to:u.LOADING}]}),e.createElement("div",{id:"my-apps-ct"}).inject(document.body,"top"),this._getPlatform().then(function(e){var t;if(!(t=e.services.get(l.PASSPORT.name)))throw new Error("Passport service not found");n._initTopBar(t.getUrl()),n._initCompass(),n.stateMachine.changeState(u.ACTIVE),n.render(t.getUrl())}),h.init("/upload","My3DExperience")},render:function(t){var n,r,a=document.getElementById("topbar");return this.stateMachine.getState()===u.LOADING?o.mask(this.container):(n=new d,r=new p,this.container.setContent([n.render(),r.render()]),a.style.display="flex",e.is(a.getElement(".topbar-menu-item-badge"))&&a.getElement(".topbar-menu-item-badge").setStyle("display","none"),o.unmask(this.container)),h.pages.push({url:"LoginPage",timestamp:Date.now()}),this},_getPlatform:function(){var e,t;function n(e){return e.services.get(l.MARKETPLACE.name)}return e=new s(window.location.origin+"/enovia/resources/AppsMngt"),t=new i(e),new c([],{dataProxy:t}).fetchPromise().then(function(e){return e.find(n)})},_initTopBar:function(e,t,n){a.init({brand:"Onboarding",topMenus:{profile:!1,add:!1,share:!1,home:!1,help:!1},useTagger:!1,userName:"",loginUrl:e+"/login?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash),signupUrl:e+"/register?service="+encodeURIComponent(window.location.origin+window.location.pathname+window.location.hash)}),a.view.container.getElement(".topbar-center").remove()},_initCompass:function(){var e,n=this;e={},window.location.hash&&window.location.hash.substring(1,window.location.hash.length).split("/").forEach(function(t){var n=t.split(":");e[n[0]]=n[1]}),r.initialize({compassTarget:"compass_ctn",appsTarget:"my-apps-ct",myAppsBaseUrl:t.buildUrl(window.location,"../"),userId:e.userId,passportUrl:t.buildUrl(window.location,"assets/PassportStub"),proxyTicketUrl:t.buildUrl(window.location,"assets/AppStub/ticket?url=V6"),lang:"en",closable:!0,onOpen:function(){n.container.setStyles({width:"80%",float:"right"})},onClose:function(){n.container.setStyles({width:"100%",float:"none"})}})}})});