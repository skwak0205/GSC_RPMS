define("DS/DMUFormatEdition/DMUEditFormatsCmd",["UWA/Utils","DS/ApplicationFrame/Command","DS/DMUControls/EXPNotify","DS/DMUBaseExperience/DMUContextManager","DS/DMUPlaySlide/DMUFormat","DS/DMUBaseUIControllers/DMUSlidesController","i18n!DS/DMUFormatEdition/assets/nls/DMUFormatEdition"],function(e,t,n,r,i,o,a){"use strict";return t.extend({init:function(t){this._parent(t,"exclusive");var s,d=this;this.beginExecute=function(){var t=r.getReviewContext({viewer:d.getFrameWindow().getViewer()});let l=t.getValidation();if(l||t){let h=l?l.getCurrentMarkup():null;for(;h&&"Markup"!==h.getValType();)h=h.getParentRepRef().getParent();h&&h.getValType&&"Markup"===h.getValType()&&(h=h.getRepRef());var m=h?h.getMarkupContent():t.getCurrentSessionMarkup();if(m){m.isVisible()||(t.getTransientReviewBag().removeDMUObjects(),m.setVisibleFlag(!0));var g=t.getEnvironment().getEnvironmentInfo(),u=!t.getUIManager().getFormatEditionModeFlag();if(t.getUIManager().setFormatEditionModeFlag(u),u&&!m.getFormats().length){var c=new i(d.getFrameWindow().getViewer(),m);c.setAttributes([{name:"sID",value:m.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:m.computeNewName({object:c,prefix:a.normalFormatTitle})}]),c.updateEnvironmentOverload({target:t.getEnvironment(),state:g}),m.addFormat(c),c.fireEvent("onDMUObjectInitialized",{dmuObject:c,dmuCont:m,mkpRepRef:h});var f=o.giveDMUSlidesController({context:d.getFrameWindow()});f&&f.setActiveSlide(c,{duration:0})}s&&s.destroy(),s=new n({body:d.getFrameWindow().getUIFrame(),type:"info",message:u?a.formatEditionModeStarted:a.slideEditionModeStarted});var D=r.giveEventsController({viewer:d.getFrameWindow().getViewer()});D&&D.fireEvent(u?"onFormatsEditionModeStarted":"onFormatsEditionModeEnded")}}d.end()}}})}),define("DS/DMUFormatEdition/DMUFormatEdition",[],function(){}),define("DS/DMUFormatEdition/DMUFormatChooserCtrl",["UWA/Core","UWA/Class","DS/Selection/CSOManager","DS/CATWebUXComponents/CATWebUXPanel","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUThumbnailChooser","DS/DMUBaseUIControllers/DMUSlidesController","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","i18n!DS/DMUFormatEdition/assets/nls/DMUFormatEdition"],function(e,t,n,r,i,o,a,s,d,l){"use strict";var m=t.extend({init:function(t){this._parent(t);var m,g=t||{},u=!1,c=null,f={},D=!1,h=this,v=e.createElement("canvas"),M=function(){m&&(m.clean(),m=null),c&&(c.setPanelVisibilityFlag(!1),c.clean(),c=null)},U=function(){u&&h.setActiveState(!1)};this.setActiveState=function(t){(u=t)?(D||(f.onAdd=n.onAdd(U),f.onRemove=n.onRemove(U),f.onEmpty=n.onEmpty(U),D=!0),function(){if(M(),u){var t,n=i.getReviewContext({viewer:g.frmWindow.getViewer()});if(n){var f=n.getCurrentSessionMarkup();if(f){var D=f.getFormats(),U=f.getCurrentSlide(),p=n.getUIManager().getSelectedObjects(),F=!1;if(p&&p.length){for(t=p.length-1;t>=0;t--){if("DMUSlide"!==p[t].getType())return;p[t]===U&&(F=!0,p.splice(t,1))}U&&F&&p.push(U);var C=1===p.length?p[0].getPointedFormats():null;if(!p.length)return;var S=[],w=e.createElement("img",{src:U&&F?U.getPreview():p[0].getPreview()}),E=v.getContext("2d");v.width=w.width,v.height=w.height,E.drawImage(w,0,0,w.width,w.height);for(var b=E.getImageData(0,0,w.width,w.height),W=0;W<b.height;W++)for(var A=0;A<b.width;A++){var x=4*W*b.width+4*A,O=(b.data[x]+b.data[x+1]+b.data[x+2])/3;b.data[x]=O,b.data[x+1]=O,b.data[x+2]=O}for(E.putImageData(b,0,0,0,0,w.width,w.height),S.push({id:"noFormat",title:l.NoFormat,icon:s.getWebappsAssetUrl("DMUFormatEdition","icons/22/I_DMU_NoFormat.png"),preview:v.toDataURL("image/jpg"),isSelected:C&&0===C.length}),t=0;t<D.length;t++)S.push({id:D[t].getAttribute("sID"),title:D[t].getAttribute("sName"),icon:s.getWebappsAssetUrl("DMUPlaySlide","icons/22/I_DMUFormat.png"),preview:D[t].getPreview(),isSelected:C&&-1!==C.indexOf(D[t])});(m=new o(g.frmWindow)).build({thumbnailData:S,onThumbnailSelectedCB:function(e){var n="noFormat"===e.id?[]:[e.id];for(t=0;t<p.length;t++){var r=p[t].getAttribute("sPointedFormats")||[];(r.length!==n.length||r.length&&n.length&&n[0]!==r[0])&&(p[t].setAttribute("sPointedFormats","noFormat"===e.id?[]:[e.id]),p[t].fireEvent("onSaveRequested",{}),p[t].refreshNode())}U&&F&&U.fireEvent("onSlidePreviewRefreshRequired",{dmuObject:U}),g.frmWindow.getViewer().render()},additionalCommands:1===p.length?[{nls:l.generateFormat,icon:s.getWebappsAssetUrl("DMUSlideEdition","icons/32/I_GenerateFormatCmd.png"),cb:function(){var e=i.getContextViewer({viewer:g.frmWindow.getViewer()});if(e){var t=d.getCommand("DMUGenerateFormatHdr",e.getCommandContext());t&&t.begin()}h.setActiveState(!1)}}]:[]});var y,P=m.getWidth()+10,_=m.getHeight()+10,I={id:"DMUFormatChooser",className:"DMUFormatChooserPanel",title:l.FormatChooserPanelTitle,titleBarVisibleFlag:!1,frameWindow:g.frmWindow,immersiveFrame:g.frmWindow.getImmersiveFrame(),viewerFrame:g.frmWindow.getViewerFrame(),content:m.getContent(),minHeight:_,height:_,minWidth:P,width:P,allowedDockAreas:WUXDockAreaEnum.NoneDockArea,currentDockArea:WUXDockAreaEnum.NoneDockArea,closeButtonFlag:!0,resizableFlag:!1,closePanelCB:function(){h.setActiveState(!1)}};c=new r(I);var R=a.giveDMUSlidesController({context:g.frmWindow});R&&(y=R.getActiveThumbnailCtxMenuPosition()),y&&(y.offsetX=y.x,y.offsetY=y.y-_/2),c.setPanelPosition(y),c.elements.container.setStyles({borderWidth:"0px"})}}}}}()):(D&&(n.unsubscribe(f.onAdd),n.unsubscribe(f.onRemove),n.unsubscribe(f.onEmpty),f={},D=!1),M())},this.getActiveState=function(){return u},this.clearController=function(){h.setActiveState(!1),m=c=v=null}}}),g=[];return t.singleton({init:function(){},getDMUFormatChooserCtrl:function(e){var t=this.giveDMUFormatChooserCtrl(e);if(!t&&e&&e.frmWindow){var n=new m({frmWindow:e.frmWindow});t=Object.freeze({setActiveState:function(e){n&&n.setActiveState(e)},getActiveState:function(){if(n)return n.getActiveState()},clearController:function(){n&&(n.clearController(),n=null)}}),g.push({frmWindow:e.frmWindow,ctrl:t})}return t},giveDMUFormatChooserCtrl:function(e){if(e&&e.frmWindow)for(var t=0;t<g.length;t++)if(g[t].frmWindow===e.frmWindow)return g[t].ctrl},unreferenceDMUFormatChooserCtrl:function(e){if(e&&e.frmWindow)for(var t=0;t<g.length;t++)if(g[t].frmWindow===e.frmWindow){g[t].ctrl.clearController(),g.splice(t,1);break}}})}),define("DS/DMUFormatEdition/DMUUpdateFormatSessionOverloadCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e);var n=this;this.beginExecute=function(){var e=t.getReviewContext({viewer:n.getFrameWindow().getViewer()});if(e){var r=e.getCurrentSessionMarkup();if(r){var i=r.getCurrentSlide();if(i){var o=i.getEnvironmentOverload(),a=e.getEnvironment().getEnvironmentInfo();a.sFocusProperty=o.state.sFocusProperty,i.updateEnvironmentOverload({target:e.getEnvironment(),state:a}),i.fireEvent("onDMUSlideSessionInfoChanged",{dmuObject:i})}}}n.end()}}})}),define("DS/DMUFormatEdition/DMUFormatContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/Selection/CSOManager"],function(e,t){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUSlide")||-1!==t.indexOf("DMUFormat"))){for(var n=this.getContextualMenuCommandList(),r=0;r<e.length;r++)if(e[r].getObjectOverloads&&e[r].getObjectOverloads().length)return n.unshift({line:1,name:"DMURemoveOverloadStr",hdr_list:["DMURemoveOverloadHdr"]}),n;return n}return[]},getContextualMenuCommandList:function(){var e=[];if("DMUSlide"===this.getType()||"DMUFormat"===this.getType()){if(e.push({line:1,name:"DMUSlideOrFormatStr",hdr_list:["DMUSlide"===this.getType()?"slideCmdHdr":"DMUFormatCmdHdr"]}),e=e.concat([{line:1,name:"DMUCutStr",hdr_list:["Format_DMUCutHdr"]},{line:1,name:"DMUCopyStr",hdr_list:["Format_DMUCopyHdr"]},{line:1,name:"DMUPasteStr",hdr_list:["Format_DMUPasteHdr"]},{line:1,name:"DMUPasteSpecialStr",hdr_list:["Format_DMUPasteSpecialHdr"]}]),"DMUSlide"===this.getType()&&!this.getAttribute("sParentSlideID"))if(e.push({line:1,name:"DMUFormatChooserStr",hdr_list:["DMUFormatChooserHdr"]}),1===t.get().length)this.getPointedFormats&&this.getPointedFormats().length&&e.push({line:1,name:"DMUEditAssociatedFormatStr",hdr_list:["DMUEditAssociatedFormatHdr"]});e.push({line:1,name:"DMUDeleteStr",hdr_list:["Format_DMUDeleteHdr"]})}return e},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUFormatEdition",workbenchName:"DMUFormatContextHdr"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUFormatEdition",workbenchName:"DMUFormatContextHdr"}})}})}),define("DS/DMUFormatEdition/DMUFormatExport",["require","exports","DS/DMUBaseExperience/EXPUtils"],function(e,t,n){"use strict";return class{static getObjectDefinition(e){function t(e,t){let r={};if(e&&t){let i=e.getParameters(),o=i.length;for(let e=0;e<o;e++){let o=i[e];if(o.isOverloadable&&void 0!==t[o.name]){let e=r,i=o.JSONname.split(".");for(;i.length;){let r=i.shift();if(r){if(0===i.length){let i=n.typeToStr(t[o.name],o.type);null!=i&&""!==i&&(e[r]=i);break}void 0===e[r]&&(e[r]={}),e=e[r]}}}}}return r}let r={EnvironmentOverload:{},ObjectOverloads:[]},i=e.getEnvironmentOverload();if(i){let e={targetId:"environment",state:t(i.target,i.state)};r.EnvironmentOverload=e}let o=e.getObjectOverloads();return o&&o.forEach(function(e){let n={targetId:e.target._sID,state:t(e.target,e.state)};r.ObjectOverloads.push(n)}),e.getSlideApplicativeContext()&&(r.ApplicativeContext=e.getSlideApplicativeContext()),r}}}),define("DS/DMUFormatEdition/DMUFormatChooserCmd",["DS/ApplicationFrame/Command","DS/DMUFormatEdition/DMUFormatChooserCtrl"],function(e,t){"use strict";return e.extend({init:function(e){var n=e||{};n.mode="shared",this._parent(n);var r=this,i=t.getDMUFormatChooserCtrl({frmWindow:r.getFrameWindow()});this.beginExecute=function(){i&&!i.getActiveState()&&i.setActiveState(!0),r.end()};var o=this._destroy;this._destroy=function(){t.unreferenceDMUFormatChooserCtrl({frmWindow:r.getFrameWindow()}),i=null,o.call(r)}}})});