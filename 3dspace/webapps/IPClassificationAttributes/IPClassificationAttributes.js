define("DS/IPClassificationAttributes/utils/AlertBox",["UWA/Core","DS/UIKIT/Alert","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes"],function(e,t,a){"use strict";return{createAlertBox:function i(n){if(e.is(n,"string"))return i({message:n,fixed:!1});if(e.is(n,"object"))return i([n]);if(e.is(n,"array")){var r=n.map(function(t){let i="";if(e.is(t,"string")&&(i=t),e.is(t,"object")){i=t.message||a.get(t.nls)||void 0;for(let[e,a]of Object.entries(t))i=i.replace("%"+e+"%",a);t.values&&(i=i+" <br/> "+t.values.map(e=>"&laquo; "+e+" &raquo;").join(" - "))}return i});let i=new t({visible:!0,autoHide:!0,hideDelay:2e3});return i.add({className:"error",message:1==r.length?r[0]:"<ol><li>"+r.join("</li><li>")+"</li></ol>"}),i}throw"Unexpected parameter type"},createCustoAlert:function(e){let a=e.message,i=e.type,n=e.delay,r=e.auto,l=!e.auto;return void 0===e.type&&(i="primary"),new t({visible:!0,autoHide:r,closable:l,hideDelay:n,className:i,messages:a})}}}),define("DS/IPClassificationAttributes/utils/TableBuilder",["UWA/Class","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Date","DS/UIKIT/Autocomplete"],function(e,t,a,i,n,r){"use strict";return e.singleton({init:function(){this._parent({})},createTextField:function(e,a){var i=new t({id:e.id+a,placeholder:e.placeholder?e.placeholder:"",className:e.className?e.className:"",events:{onChange:function(t){e.onChange&&e.onChange(t,e,a)}}});return e.onInput&&(i.elements.input.oninput=function(t){e.onInput(t,e)}),e.CustomValidate&&(i.CustomValidate=e.CustomValidate),i},createDateField:function(e,t){return new n({id:e.id+t,placeholder:e.placeholder?e.placeholder:"",showClearIcon:!0,events:{onChange:function(t){e.onChange&&e.onChange(t,e)}}})},createToggleField:function(e,t){return new i({id:e.id+t,type:e.type,value:e.value,label:"",checked:!!e.checked&&e.checked,events:{onChange:function(a){e.onChange&&e.onChange(a,e,t)}}})},createAutoCompleteField:function(e,t){let a=new r({showSuggestsOnFocus:!0,multiSelect:!1,minLengthBeforeSearch:0,datasets:[],placeholder:e.placeholder,style:{overflow:"visible"},events:{onSelect:function(a){e.onSelect&&e.onSelect(e,t,a)},onUnselect:function(a){e.onUnselect&&e.onUnselect(e,t,a)},onHideSuggests:function(){e.onHideSuggests&&e.onHideSuggests()}}});return e.datasets&&a.addDataset(e.datasets),a},createSelectField:function(e,t){return new a({id:e.id+t,placeholder:"Select an option...",disabled:!!e.disabled&&e.disabled,options:e.items})},createTable:function(e){var t=UWA.createElement("table",{class:"table",id:"attrTable",styles:{width:"2600px",height:"300px","max-width":"unset",display:"block","table-layout":"fixed"}});e.wrapper&&t.inject(e.wrapper);var a=UWA.createElement("thead",{class:"attrthead",id:"attrthead"}).inject(t),i=UWA.createElement("tbody",{class:"attrtbody",id:"attrtbody"}).inject(t),n=UWA.createElement("tr").inject(a);e.headersDef.forEach(function(e){if(e.visible){var t=UWA.createElement("th",{colspan:"1",align:"left",width:e.width?e.width:"250px","white-space":"nowrap",overflow:"hidden",id:e.headerId});UWA.createElement("p",{text:e.headerName,class:""}).inject(t),t.inject(n)}});for(var r=[],l=e.fieldsDef,s=this,o=0;o<3;o++){var d={},u=UWA.createElement("tr").inject(i);l.forEach(function(t){if(t.visible){t.headerDiv=e.alertContainer;var a=new UWA.createElement("td",{colspan:"1",align:"left",width:t.width?t.width:"250px"}).inject(u);switch(t.type){case"text":t.lines=r,d[t.fieldName]=s.createTextField(t,o),d[t.fieldName].inject(a);break;case"date":d[t.fieldName]=s.createDateField(t,o),d[t.fieldName].inject(a);break;case"autocomplete":var i=UWA.createElement("div",{id:t.id+o,class:t.className,styles:{overflow:"visible"}}).inject(a);t.lines=r,d[t.fieldName]=s.createAutoCompleteField(t,o),d[t.fieldName].inject(i);break;case"select":d[t.fieldName]=s.createSelectField(t,o),d[t.fieldName].inject(a);break;case"switch":t.lines=r,d[t.fieldName]=s.createToggleField(t,o),d[t.fieldName].inject(a);break;case"chooser":var n=UWA.createElement("div",{class:"input-group"}).inject(a);t.lines=r,d[t.fieldName]=s.createTextField(t,o),d[t.fieldName].inject(n);var l=UWA.createElement("span",{class:t.classIcon}).inject(n);l.line=d,l.onclick=function(e){t.iconClickAction&&t.iconClickAction(e,t,o)}}}}),r.push(d)}return r}})}),define("DS/IPClassificationAttributes/utils/AttributesUtil",["UWA/Class","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes","text!DS/IPClassificationAttributes/assets/IPClassificationAttributesProps.json"],function(e,t,a,i,n){"use strict";return e.singleton({init:function(){this._parent({})},checkRange:function(e,t,a,i){var n=(a?a.split(";"):[]).map(e=>e.trim()).filter(e=>e.length>0),r=t?t.split(";").filter(e=>!n.includes(e)):[];r.length&&(i.push({fixed:!0,nls:"attrRangeMissingValue",values:r}),n=n.concat(r));var l,s=n.filter((e,t)=>n.indexOf(e)==t),o=n.filter((e,t)=>n.indexOf(e)!=t);(o.length>0&&(i.push({fixed:!0,nls:"attrRangeErrDupValue",values:o.filter((e,t)=>o.indexOf(e)==t)}),n=s),"Integer"==e)&&((l=n.filter(e=>!/^[-+]?[0-9]+$/.test(e))).length&&i.push({fixed:!1,nls:"attrRangeErrInteger",values:l}));"Double"==e&&((l=n.filter(function(e){return!new RegExp("^[-+]?\\d+(\\.\\d+)?$").test(e)})).length&&i.push({fixed:!1,nls:"attrRangeErrDouble",values:l}));"String"==e&&((l=n.filter(e=>!/^[a-zA-Z0-9]+$/.test(e))).length&&i.push({fixed:!1,nls:"attrRangeErrAlphanumeric",values:l}));return n=(n=n.map(e=>e.trim())).filter(e=>e.length>0),"String"==e&&(n=n.sort()),"Integer"==e&&(n=n.sort((e,t)=>parseInt("0"+e)-parseInt("0"+t))),n},buildObjectToSend:function(e,t,a){var i=JSON.parse(n),r={AggregatorPackage:i.package_name,AggregatorName:i.interface_name,AggregateMode:"Global",AggregatorNature:"Interface",Attributes:{}};return e.every((e,i)=>{var n=t[i].nameField.getValue();if(console.log("name : "+n),n.length>0){var l=t[i].authorizedField,s=t[i].defaultValue;if(l&&s.validateWhenRangeIsDefined&&!s.validateWhenRangeIsDefined(l))return!1;var o=t[i].defaultValue.getValue();if("Date"==a){var d=t[i].defaultValue.getDate();if(null!=d||null!=d){let e=new Date(d.toDateString()+" 10:00:00 GMT");o=Math.floor(e.getTime()/1e3).toString()}}Array.isArray(o)&&o.length>0&&(o=o[0]);var u=[],c={};if("String"==a||"Integer"==a||"Double"==a){var m=l.getValue();if(m&&m.length>0&&(u=m.split(";")),u=(u=u.map(e=>e.trim())).filter(function(e){return""!=e}),null!=t[i].theRangeModal){var f=new Map(Object.entries(t[i].theRangeModal.getNLSRange()));f&&u.forEach((e,t)=>{var a=f.get(e);a?(Object.keys(a).forEach((e,t)=>{0==a[e].length&&delete a[e]}),c[e]=a):c[e]={value:e}})}}let D=e.getElement("#NLSValueEN"+i);var p={en:0==D.value.length?n:D.value,fr:e.getElement("#NLSValueFR"+i).value,de:e.getElement("#NLSValueDE"+i).value,ja:e.getElement("#NLSValueJA"+i).value,ko:e.getElement("#NLSValueKO"+i).value,ru:e.getElement("#NLSValueRU"+i).value,zh:e.getElement("#NLSValueZH"+i).value};Object.keys(p).forEach((e,t)=>{0==p[e].length&&delete p[e]});var h={};h.Name=n,h.Nature="Attribute",h.Description="",h.Type="DoubleWithDim"==a?"Double":a,h.Local="No",h.Owner="",h.Indexation="No",h.Protection="Free",h.NameNLS=p,h.SixWPredicate="",h.SixWPredicate_nls="";var g=t[i].predicateField.selectedItems;if(g&&g.length>0){h.SixWPredicate=g[0].value,h.SixWPredicate_nls=g[0].label.length>0?g[0].label:h.SixWPredicate;var b=t[i].displayIn6WTags.getValue();b[0]&&b[0].length>0&&(h.Indexation=b[0])}if(null!=t[i].multiValueField&&(h.MultiValuated=t[i].multiValueField.isChecked()?"Yes":"No"),null!=t[i].multiLineField&&(h.MultiLine=t[i].multiLineField.isChecked()?"Yes":"No"),h.HasRangeDefined=u.length>0?"Yes":"No",u.length>0&&(h.AuthorizedValues=u,h.AuthorizedValuesNLS=c),"DoubleWithDim"==a){var v=t[i].dimValue.selectedItems;v.length>0&&(h.HasMagnitude="Yes",h.Dimension=v[0].value,h.Dimension_nls=v[0].label.length>0?v[0].label:h.Dimension);var y=t[i].preferedUnitValue.selectedItems;y.length>0&&(h.ManipulationUnit=y[0].value,h.ManipulationUnit_nls=y[0].label.length>0?y[0].label:h.ManipulationUnit)}var A=t[i].hasDefaultField;A&&!A.isChecked()||"Yes"===h.MultiValuated?h.HasDefault=!1:(h.HasDefault=!0,h.Default=o),r.Attributes[n]=h}return!0})||(r.Attributes={}),r},buildObjectToIndex:function(e,t){var a=[];return Object.keys(t).forEach(function(i){if(e.includes(i)){var n=t[i];a.push({Name:n.Name,Type:n.Type,SixWTag:n.SixWPredicate&&n.SixWPredicate.length>0?n.SixWPredicate:"",Parametric:"Yes"==n.Indexation?"true":"false",dimPresent:!!(n.Dimension&&n.Dimension.length>0)})}}),a},addNewAttrsToGridView:function(e,n,r,l,s,o){Object.keys(n).forEach(function(d){if(e.includes(d)||o&&1==o){var u=n[d],c="";u.AuthorizedValues&&u.AuthorizedValues.length>0&&(c=u.AuthorizedValues.join(","));var m="";u.Dimension_nls?(m=u.Dimension_nls,u.ManipulationUnit_nls&&(m+="("+u.ManipulationUnit_nls+")")):u.Dimension&&(m=u.Dimension,u.ManipulationUnit&&(m+="("+u.ManipulationUnit+")"));var f=u.Name;u.NameNLS&&(f=u.NameNLS[widget.lang]?u.NameNLS[widget.lang]:u.NameNLS.en);var p=new t({label:u.Name,icons:[a.getWebappsAssetUrl("ClassificationEditor","icons/attributes.png")],grid:{attrName:u.Name,attrTitle:f,attrDesc:u.description?u.description:"",attrKind:u.Type,attrDefault:u.Default?u.Default:"",attrHasDefault:u.HasDefault&&1==u.HasDefault?i.HasDefault_TRUE:i.HasDefault_FALSE,attrDim:m,attrPredi:u.SixWPredicate_nls&&u.SixWPredicate_nls.length>0?u.SixWPredicate_nls:u.Name,attrAuthorizedValues:c,attrMinimum:"",attrMaximum:"",attrIsMultivalue:u.MultiValuated&&"Yes"==u.MultiValuated?"True":"False",attrIsParametric:"Yes"==u.Indexation?"true":"false",attrIsInDico:i.IS_IN_DICO_TRUE,attrSel:s}});r.treeDocument.addRoot(p,void 0);var h=r.layout.getCellsFromNodeModel(p),g=r.layout.getCellCoordinatesAt(h[0]),b=r.layout.getCellIDFromCoordinates(g),v=r.getCellInfosAt(b);l({},v)}})}})}),define("DS/IPClassificationAttributes/dataprovider/DataProvider",["UWA/Class","UWA/Promise","DS/IPClassifyUtil/IPClassifyUtility","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassificationAttributes/utils/AlertBox","text!DS/IPClassificationAttributes/assets/IPClassificationAttributesProps.json"],function(e,t,a,i,n,r,l){"use strict";var s={};return e.singleton({init:function(){this._parent({}),this.Dimensions={},this.Predicates={},this.Dictionary={},s=JSON.parse(l)},updateAttributeInfos:function(e){var t=n.updateAttributeInfos.bind(n),a={timeout:5e5,method:"POST",data:JSON.stringify(e)};return this._sendRequest(t,a)},getPredicates:function(e){var a=this;if(!a.Predicates[e.tenantUrl]){a.Predicates[e.tenantUrl]={ready:t.deferred()};var r=n.getPredicates.bind(n);a._sendRequest(r,{timeout:6e4,method:"GET",mappable:!0}).then(function(t){var i={};null!=t&&(t="string"==typeof t?JSON.parse(t):t,Object.keys(t).forEach(function(e){var a={};null!=t[e].properties&&t[e].properties.forEach(function(e){var t=e.dataType,i=t.substring(t.lastIndexOf("#")+1);i=i.includes("date")?"date":i,a[i]||(a[i]=[]),a[i].push(e)}),Object.keys(a).forEach(function(e){a[e].sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})}),i[t[e].label]=a})),a.Predicates[e.tenantUrl].ready.resolve(i),console.info("Predicates loaded")},function(t){console.log("Unable to get Predicates : "),console.log(t),a.Predicates[e.tenantUrl].ready.reject(i.get("FAILED_TO_FETCH_PREDICATES")),delete a.Predicates[e.tenantUrl]})}return a.Predicates[e.tenantUrl].ready},getDimensions:function(e){var a=this;if(!a.Dimensions[e.tenantUrl]){a.Dimensions[e.tenantUrl]={ready:t.deferred()};var r=n.getDimensionsInfos.bind(n);a._sendRequest(r,{timeout:6e4,method:"GET"}).then(function(t){t="string"==typeof t?JSON.parse(t):t,a.Dimensions[e.tenantUrl].ready.resolve(t),console.info("Dimensions loaded")},function(t){console.info("Dimensions load : failed"),console.log(t),a.Dimensions[e.tenantUrl].ready.reject(i.get("FAILED_TO_FETCH_DIMENSIONAL_ATTRIBUTES")),delete a.Dimensions[e.tenantUrl]})}return a.Dimensions[e.tenantUrl].ready},getDictionaryCusto:function(e){var a=this;if(!a.Dictionary[e.tenantUrl]){a.Dictionary[e.tenantUrl]={ready:t.deferred()};var r=n.getDictionaryCusto.bind(n),l={timeout:6e4,method:"GET",package:s.package_name,type:"json"};this._sendRequest(r,l).then(function(t){var i=(t="string"==typeof t?JSON.parse(t):t).Dictionary;console.log("dicoNode"),console.log(i);var n=[];Object.entries(i).forEach(function([e,t]){Object.entries(t).forEach(function([e,t]){t.Attributes&&(n=n.concat(Object.keys(t.Attributes)))})}),a.Dictionary[e.tenantUrl].ready.resolve(n),console.info("DictionaryCusto loaded")},function(t){console.log("Unable to get Dictionary : "),console.log(t),a.Dictionary[e.tenantUrl].ready.reject(i.get("FAILED_TO_FETCH_Dictionary")),delete a.Dictionary[e.tenantUrl]})}return a.Dictionary[e.tenantUrl].ready},createClassificationAttributes:function(e){var t=n.createAttributes.bind(n),a={timeout:5e5,method:"POST",type:"json",package:s.package_name,data:JSON.stringify(e)};return this._sendRequest(t,a)},launchImport:function(e){if(console.log("launchImportProcess"),e.type.match(/application\/x-zip-compressed/)){var t=n.launchImport.bind(n),a=new FormData;a.append("ClassificationAttributeszip",e,e.name);var l={method:"POST",type:"multipart/form-data",package:s.package_name,data:a,headers:{Accept:"multipart/form-data"}};return this._sendRequest(t,l)}this.userMessaging.add({className:"error",message:i.importBadFileExtension}),r.createAlertBox({nls:"importBadFileExtension"}).inject(l.headerDiv)},massupdateAttributeInfos:function(e){if(console.log("Updating attribute info"),e.type.match(/application\/x-zip-compressed/)){var t=new FormData;t.append("ClassificationAttributeszip",e,e.name);var a=n.massupdateAttributeInfos.bind(n),l={method:"POST",type:"multipart/form-data",package:s.package_name,data:t,headers:{Accept:"multipart/form-data"}};return this._sendRequest(a,l)}this.userMessaging.add({className:"error",message:i.importBadFileExtension}),r.createAlertBox({nls:"importBadFileExtension"}).inject(l.headerDiv)},_sendRequest:function(e,t){return new Promise(function(n,r){a.initURLSAsync().then(function(){var l={timeout:18e5,tenant:a.getTenantId(),headers:{"Content-Type":"application/json"}},s=UWA.extend(l,t);t.headers&&(s.headers=UWA.extend(l.headers,t.headers)),s.onComplete=function(e){n(e)},s.onFailure=function(e,t){console.log("Request failled"),console.log(e),console.log(t);var a="";try{if("DictionaryException"in(t="string"==typeof t?JSON.parse(t):t)){const e=t.DictionaryException,{Status:n,Message:r}=e;a=n.contains("403")&&r.contains("forbidden")?i.OperationForbiden:t.DictionaryException.Message}else a=i.Internal_Error}catch(e){a=i.Internal_Error}r(a)},e(s)})})}})}),define("DS/IPClassificationAttributes/views/AttrRangeCreateForm",["DS/UIKIT/Modal","DS/UIKIT/Input/Text","DS/IPClassificationAttributes/utils/AlertBox","DS/IPClassificationAttributes/utils/AttributesUtil","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes"],function(e,t,a,i,n){function r(e,t){var a={};return a.en=t("en",e.en,n.englishNLS),a.fr=t("fr",e.fr,n.frenchNLS),a.de=t("de",e.de,n.germanNLS),a.ja=t("ja",e.ja,n.japeneseNLS),a.ko=t("ko",e.ko,n.koreanNLS),a.ru=t("ru",e.ru,n.russianNLS),a.zh=t("zh",e.zh,n.chineseNLS),UWA.merge(a,e)}function l(e){if(!(this instanceof l))throw new TypeError("AttrRangeCreateForm constructor cannot be called as a function.");var t=this;this.options=UWA.extend({onShow:function(){},onHide:function(){},onSave:function(e){return!0},onError:function(e){}},e),this.nlsRange=e.nlsRange||{},this.editMode=e.editMode,this._rangeInit=e.rangeList.map(function(e){return r({value:e},a=>(t.nlsRange[e]||{})[a]||"")}),this._rangeEdit=this._rangeInit.map(function(e){return r(e,t.getNLSInput)})}return l.prototype={constructor:l,getNLSRange:function(){return this._rangeEdit.reduce(function(e,t){return e[t.value]=r(t,(e,t)=>t.value),e},{})},getNLSInput:function(e,t,a){return UWA.createElement("input",{type:"text",class:"form-control",value:t,"data-init":t})},getTableDataElement:function(e){return UWA.createElement("td",{colspan:"1",align:"left",width:e.width})},getTableHeaderElement:function(e){var t=UWA.createElement("p",{text:e.headerName,class:""}),a=UWA.createElement("th",{colspan:"1",align:"left",width:e.width,"white-space":"nowrap",overflow:"hidden",id:e.headerId});return t.inject(a),a},getTable:function(e,a){var i=this,l=UWA.createElement("div",{class:"tableDiv"}).inject(e);l.setStyle("height","300px"),l.setStyle("overflow-x","auto");var s=UWA.createElement("table",{class:"table",id:"attrTable"}).inject(l);s.setStyle("max-width","unset"),s.setStyle("table-layout","fixed");var o=UWA.createElement("thead",{class:"attrthead",id:"attrthead"}).inject(s),d=UWA.createElement("tr").inject(o);d.setStyle("background","whitesmoke"),d.setStyle("position","sticky"),d.setStyle("top","0");var u=this.getTableHeaderElement({headerName:n.attrRangeTableHeader,width:"250px",headerId:"nameColumn"}).inject(d),c=(r({},function(e,t,a){return i.getTableHeaderElement({headerName:a,width:"250px",headerId:"Trans"+e.toUpperCase()}).inject(d)}),UWA.createElement("tbody",{class:"attrtbody",id:"attrtbody"}).inject(s)),m=u.getElementsByTagName("p")[0];m.setStyle("cursor","pointer");var f=UWA.createElement("a",{class:"fonticon fonticon-search"});f.inject(m),f.setStyle("text-decoration","none"),f.setStyle("padding-left","5px");var p=new t({});p.inject(u),p.elements.input.setStyle("display","none");var h=[];function g(e){var t=p.getValue().toUpperCase(),a=e.getElementsByTagName("td")[0];a&&a.firstChild.value.toUpperCase().startsWith(t)?e.style.display="":e.style.display="none"}return f.onclick=function(){p.elements.input.setStyle("display","inline-block")},p.elements.input.onkeyup=function(){h.forEach(g)},function(e){return h.forEach(e=>e.destroy()),h=e.map(function(e,n){var l=UWA.createElement("tr").inject(c);return new t({id:"range_"+n,value:e.value}).inject(i.getTableDataElement({width:"250px"}).inject(l)).setDisabled(!0),r(e,function(e,t){t.id="NLSValue_"+e+"_"+n,t.disabled=!a,t.inject(i.getTableDataElement({width:"250px"}).inject(l))}),g(l),l})}},getTextRange:function(e){var a=new t({id:"rangeInput"});return a.elements.input.setStyle("margin-bottom","10px"),a.CustomValidate=function(){let t=!0;if("String"==e.attrType){this.getValue().split(";").forEach((e,a)=>{e=e.trim();var i=new RegExp("^[a-zA-Z0-9]+$");e.length>0&&!i.test(e)&&(t=!1)})}else if("Integer"==e.attrType){this.getValue().split(";").forEach((e,a)=>{e=e.trim();var i=new RegExp("^[-+]?[0-9]+$");e.length>0&&!i.test(e)&&(t=!1)})}else if("Double"==e.attrType){this.getValue().split(";").forEach((e,a)=>{e=e.trim();var i=new RegExp("^[-+]?\\d+(\\.\\d+)?$");e.length>0&&!i.test(e)&&(t=!1)})}return t?this.elements.input.style.borderColor=null:this.elements.input.setStyle("border-color","#EA4F37"),t},a.onChange=function(){var t=[],a=e.onChange(this.getValue(),t),i=t.reduce((e,t)=>e&&t.fixed,!0);this.setValue(a),this.elements.input.style.borderColor=i?null:"#EA4F37"},a},formModal:function(t){var a=UWA.createElement("div",{class:"global-div"}),i=(UWA.createElement("nav",{class:"tab tab-pills",id:"the-forms"}).inject(a),UWA.createElement("h4",{text:n.attrRangeTableTitle}).inject(a),new e({className:"fancy",visible:!0,closable:!0,header:a,body:t.form,footer:"<button type='button' id='SaveButton' class='btn btn-primary'>"+UWA.String.escapeHTML(n.attrRangeTableClose)+"</button><button type='button' id='CancelBtn' class='btn btn-default'>"+UWA.String.escapeHTML(n.attrRangeTableCancel)+"</button> ",renderTo:t.container,events:{onHide:function(){UWA.log("the Modal Closed2"),i.destroy(),t.onHide()},onShow:function(){t.onShow(),UWA.log("the Modal shown2")}}}));return t.editMode||(i.getFooter().getElement("#SaveButton").hidden=!0,i.getFooter().getElement("#CancelBtn").hidden=!0),i.getFooter().getElement("#SaveButton").addEvent("click",function(){t.onSave()&&i.hide()}),i.getFooter().getElement("#CancelBtn").addEvent("click",function(){t.onCancel()&&i.hide()}),i.elements.wrapper.setStyle("width","800px"),i},updateRangeList:function(e){var t=this;this._rangeEdit=e.map(function(e){var a=t._rangeInit.find(t=>t.value==e)||r({value:e},e=>"");return t._rangeEdit.find(t=>t.value==e)||r(a,t.getNLSInput)})},launchPanel:function(e){let t=this,n=e.editMode||this.editMode,l=e.attrName||this.options.attrName;UWA.log("add_type action");var s=UWA.createElement("div",{id:"myContent"}),o=UWA.createElement("div",{id:"got-tab-sample",class:"tab"});if(o.setStyle("justify-content","center"),o.inject(s),l){var d=UWA.createElement("h4");d.inject(o);var u=UWA.createElement("span",{class:"badge font-3dsregular badge-default",text:l});u.setStyle("padding-left","50px"),u.setStyle("padding-right","50px"),u.setStyle("padding-top","5px"),u.setStyle("padding-bottom","5px"),u.inject(d)}var c=this._rangeInit.map(e=>e.value).join(";");function m(e,n){var r=i.checkRange(t.options.attrType,c,e,n);return n.reduce((e,t)=>e&&t.fixed,!0)&&(t.updateRangeList(r),p(t._rangeEdit)),n.length&&(a.createAlertBox(n).inject(h.elements.header),t.options.onError(n)),r.join(";")}var f=this.getTextRange({attrType:this.options.attrType,onError:this.options.onError,onChange:m}),p=this.getTable(s,n),h=this.formModal({form:s,editMode:n,container:this.options.container,onShow:this.options.onShow,onHide:this.options.onHide,onSave:function(){var e=[],a=m(f.getValue(),e);return!!(e.reduce((e,t)=>e&&t.fixed,!0)&&f.CustomValidate()&&t.options.onSave(a))&&(f.setValue(a),!0)},onCancel:function(){return t._rangeEdit.forEach(function(e){r(e,function(e,t){return t.value=t.dataset.init,t})}),f.setValue(g),t.updateRangeList(c.split(";")),p(t._rangeEdit),!0}}),g=m(this._rangeEdit.map(e=>e.value).join(";"),[]);f.parent=h,f.setDisabled(!n),f.inject(o),f.setValue(g),p(this._rangeEdit)},enable:function(){this.editMode=!0},disable:function(){this.editMode=!1}},l}),define("DS/IPClassificationAttributes/utils/EventHandler",["UWA/Class","DS/IPClassificationAttributes/utils/AlertBox","DS/IPClassificationAttributes/utils/TableBuilder","DS/IPClassificationAttributes/views/AttrRangeCreateForm","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes","DS/IPClassificationAttributes/dataprovider/DataProvider","DS/IPClassificationAttributes/utils/AttributesUtil","text!DS/IPClassificationAttributes/assets/IPClassificationAttributesProps.json"],function(e,t,a,i,n,r,l,s){"use strict";var o=null,d=new Set,u=new Set,c={},m=e.singleton({init:function(){this._parent({}),c=JSON.parse(s)},hasDefaultToggled:function(e,t,a){var i=e.target,n=t.lines[a].defaultValue;if(i.checked){n.setDisabled(!1);var r=t.lines[a].multiValueField;r.isChecked()&&r.uncheck()}else{n.setDisabled(!0);try{n.setValue("")}catch(e){n.resetInput()}}},multiValueToggled:function(e,t,a){var i=e.target,n=t.lines[a].hasDefaultField;i.checked&&!n.isChecked()||n.elements.input.click()},parseInputValue:function(e,t){var a=e.target;"Integer"==t.attrType&&a.value.length>0&&(a.value=parseInt(a.value),a.value>2147483647?a.value=2147483647:a.value<-2147483647&&(a.value=-2147483647)),"Double"!=t.attrType&&"DoubleWithDim"!=t.attrType||a.value.length>0&&(a.value=parseFloat(a.value))},checkInputValue:function(e,t){var a="";if("Integer"==t.attrType&&(a="^[-+]?\\d+"),"Double"!=t.attrType&&"DoubleWithDim"!=t.attrType||(a="^[-+]?\\d+(\\.)?(\\d{1,6})?"),""==a)return!0;var i=e.target,n=new RegExp(a+"$");if(i.value.length>1&&!n.test(i.value)){var r=new RegExp(a),l=i.value.match(r);i.value=null!=l?l[0]:""}else 1==i.value.length&&"-"!=i.value&&"+"!=i.value&&isNaN(i.value)&&(i.value="")},dimUnSelected:function(e,t,a){e.lines[t].preferedUnitValue.reset()},dimSelected:function(e,t,a){var i=e.lines[t].preferedUnitValue;i.reset();var n=e.Units[a.value]?e.Units[a.value]:[],r=[];n.forEach(e=>{r.push({value:e.Name,label:e.NLSName})}),i.datasets[0].items.length=0,i.addItems(r,i.datasets[0])},predUnSelected:function(e,t,a){if("String"==e.attrType||"Boolean"==e.attrType){var i=e.lines[t].displayIn6WTags;i&&(i.setValue(1),i.disable())}},predSelected:function(e,t,a){var i=document.querySelector("#"+e.id+t),n=document.querySelector("#"+e.id+t+"_inputHidden");if(n||((n=UWA.createElement("input",{id:e.id+t+"_inputHidden"})).hidden=!0,n.inject(i)),n.value=a.value,"String"==e.attrType||"Boolean"==e.attrType){var r=e.lines[t].displayIn6WTags;r&&r.enable()}},isNameValid:function(e,a){var i=e.value,n=RegExp("^[a-zA-Z][a-zA-Z0-9]+$");if(i.length>0&&!n.test(i)){d.add(e.id),e.setStyle("border-color","#EA4F37");var r="ErrCreateAttrNameIncorrect";return isNaN(i[0])||(r="ErrCreateAttrNameStartWithNumber"),t.createAlertBox({nls:r}).inject(a),!1}return null!=e.style.borderColor&&(e.style.borderColor=null),d.has(e.id)&&d.delete(e.id),!0},isNameUnique:function(e,a,i){return a.some(function(t,a){var i=t.nameField.getValue();return!e.id.endsWith(a)&&i==e.value})?(d.add(e.id),e.setStyle("border-color","#EA4F37"),t.createAlertBox({nls:"ErrCreateAttrNameShouldBeUnique"}).inject(i),!1):(null!=e.style.borderColor&&(e.style.borderColor=null),d.has(e.id)&&d.delete(e.id),!0)},validateNameField:function(e,t){var a=e.target;m.isNameValid(a,t.headerDiv)&&a.value.length>0&&m.isNameUnique(a,t.lines,t.headerDiv),document.querySelector("#SaveButton").disabled=d.size>0||u.size>0},toggleTo:function(e,t){let a;switch(e,e){case 0:a=document.querySelector("#nameColumn");break;case 1:null==(a=document.querySelector("#authorizedValueColumn"))&&(a=document.querySelector("#defaultValueColumn"));break;case 2:a=document.querySelector("#TransEN")}null!=a&&a.scrollIntoView({behavior:"smooth",inline:"start"})},hideModal:function(e,t){console.log("the Modal Closed"),"string"==typeof t&&"HideForRangeModal"===t?(e.isVisible=!1,e.elements.container.setStyle("display","")):e.destroy()},showModal:function(e,t){o=e,console.log("the Modal shown");var a=new IntersectionObserver(function(e){e.sort(function(e,t){return e.intersectionRatio<t.intersectionRatio?1:e.intersectionRatio>t.intersectionRatio?-1:0});var a=document.querySelector("#got-tab-sample");Array.isArray(e)&&e.forEach(function(e){if(e.intersectionRatio>=.98){let i=-1;if(-1!=t)i=t,t=-1;else switch(e.target.id){case"nameColumn":i=0;break;case"authorizedValueColumn":case"defaultValueColumn":i=1;break;case"TransDE":case"TransZH":i=2}a.getElementsByClassName("active")[0].toggleClassName("active"),a.getChildren()[i].toggleClassName("active")}})},{threshold:[1]});null!=document.querySelector("#authorizedValueColumn")?a.observe(document.querySelector("#authorizedValueColumn")):a.observe(document.querySelector("#defaultValueColumn")),a.observe(document.querySelector("#nameColumn")),a.observe(document.querySelector("#TransDE")),a.observe(document.querySelector("#TransZH"))},createAttributes:function(e){var a=e.modal,i=e.lines,s=e.attribute_type,o=a.getBody().getElements("tbody>tr"),d="",u=e.attributeDBList&&Array.isArray(e.attributeDBList)?e.attributeDBList:[];if(i.some((e,t)=>{var a=e.nameField.getValue();return 0!=a.length&&(!!u.includes(a)&&(d=a,!0))}))return t.createAlertBox({nls:"ErrCreateAttrNameAlreadyTaken",NAME:d}).inject(e.header),!1;var m=l.buildObjectToSend(o,i,s);if(console.log(m.Attributes),Object.keys(m.Attributes).length>0){var f=document.querySelector("#SaveButton");f.disabled=!0,r.createClassificationAttributes(m).then(function(i){var s=(i="string"==typeof i?JSON.parse(i):i).Dictionary.Interfaces[c.interface_name].Attributes,o=Object.keys(s);l.addNewAttrsToGridView(o,m.Attributes,e.grid,e.changeGridObjects,!0);var d=l.buildObjectToIndex(o,m.Attributes);r.updateAttributeInfos(d).then(function(){a.destroy()},function(a){t.createAlertBox(n.updateAttributesInfosFail).inject(e.header),f.disabled=!1})},function(a){var i="";try{if(a.indexOf("Error: #1900005: Name")>-1&&a.indexOf("not unique")>-1){var n=a.indexOf("Error: #1900005: Name"),r=a.indexOf("not unique");i=(i=a.substring(n+"Error: #1900005: Name".length+1,r)).trim().length>0?i.replace("'",""):i}if(a.indexOf("Attribute'[")>-1&&a.indexOf("cannot be changed")>-1){n=a.indexOf("["),r=a.indexOf("]");i=a.substring(n+1,r)}}catch(i){t.createAlertBox(a).inject(e.header)}i.trim().length>0?t.createAlertBox({nls:"ErrCreateAttrNameAlreadyTaken",NAME:i.trim()}).inject(e.header):t.createAlertBox(a).inject(e.header),f.disabled=!1})}},iconClickAction:function(e,t,a){var n=e.srcElement,r=n.line.authorizedField.getValue().split(";");r=(r=r.map(e=>e.trim())).filter(function(e){return e.length>0}),n.line.authorizedField.setValue(r.join(";"));var l,s=n.line.nameField.getValue();o.dispatchEvent("onHide","HideForRangeModal"),n.line.theRangeModal||(n.line.theRangeModal=new i({rangeList:[],attrName:s,attrType:t.attrType,container:t.container,parent:o,editMode:!0,onSave:(l=n.line,function(e){return l.authorizedField.setValue(e),l.authorizedField.dispatchEvent("onChange"),!0}),onHide:function(){o.show()}})),n.line.theRangeModal.updateRangeList(r),n.line.theRangeModal.launchPanel({attrName:s})},authorizedValuesChanged:function(e,i,r){var l="",s=!1,o=i.lines[r].authorizedField,c=o.getValue(),m=c.split(";");m=(m=m.map(e=>e.trim())).filter(e=>e.length>0),o.setValue(m.join(";")),c=m.join(";");var f=m.filter((e,t)=>m.indexOf(e)==t),p=m.filter((e,t)=>m.indexOf(e)!=t);if(p.length>0&&(s=!0,l=n.get("attrRangeErrDupValue")+p.join(" - "),o.setValue(f.join(";"))),f.forEach((e,t)=>{if(console.log(e),(e=e.trim()).length>0){var a="",r=null;"Double"==i.attrType?(r=new RegExp("^[-+]?\\d+(\\.\\d+)?$"),a="attrRangeErrDouble"):"Integer"==i.attrType?(r=new RegExp("^[-+]?[0-9]+$"),a="attrRangeErrInteger"):"String"==i.attrType&&(r=new RegExp("^[a-zA-Z0-9]+$"),a="attrRangeErrAlphanumeric"),null!=r&&(r.test(e)&&null!=o.elements.input.style.borderColor?o.elements.input.style.borderColor=null:(s=!0,l=n.get(a)))}}),s)u.add(o),o.elements.input.setStyle("border-color","#EA4F37"),t.createAlertBox(l).inject(i.headerDiv);else{u.has(o)&&u.delete(o);let e=i.lines[r].defaultValue.isDisabled();var h=i.lines[r].defaultValue.elements.container.getParent(),g=i.lines[r].defaultValue;if(i.lines[r].defaultValue.elements.container.remove(),f.length>0&&""!=c){var b={name:"Types",items:[]};"Integer"==i.attrType?f.sort(function(e,t){return e-t}):f.sort(),f.forEach(function(e){(e=e.trim()).length>0&&b.items.push({value:e})});var v=a.createAutoCompleteField({placeholder:n.get("createAttrFieldDefaultValuePlaceholder"),datasets:b});i.lines[r].defaultValue=v,v.inject(h),v.validateWhenRangeIsDefined=function(e){if(this.isDisabled())return this.elements.inputContainer.style.borderColor=null,!0;let a=e.getValue(),n=this.getValue(),r=a.split(";");return r.length>0&&!r.includes(n)?(this.elements.inputContainer.setStyle("border-color","#EA4F37"),t.createAlertBox({nls:"attrDefaultValShouldBeOneAmongRangeVal"}).inject(i.headerDiv),!1):(this.elements.inputContainer.style.borderColor=null,!0)},e&&(v.resetInput(),v.setDisabled(!0))}else i.lines[r].defaultValue=g,i.lines[r].defaultValue.inject(h),e&&(i.lines[r].defaultValue.setValue(""),i.lines[r].defaultValue.setDisabled(!0))}document.querySelector("#SaveButton").disabled=u.size>0||d.size>0}});return m}),define("DS/IPClassificationAttributes/views/AttrCreateForm",["DS/UIKIT/Modal","DS/UIKIT/Toggler","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes","DS/IPClassificationAttributes/utils/TableBuilder","DS/IPClassificationAttributes/utils/EventHandler"],function(e,t,a,i,n){var r=[],l=[];return{createTabNavPanel:function(){var e=UWA.createElement("div",{id:"got-tab-sample",class:"tab"});return e.setStyle("justify-content","center"),UWA.createElement("a",{class:"tab-item",text:a.get("BasicsTab")}).inject(e),UWA.createElement("a",{class:"tab-item",text:a.get("ValuesTab")}).inject(e),UWA.createElement("a",{class:"tab-item",text:a.get("TranslationsTab")}).inject(e),new t({container:e,activeClass:"active",selected:0,events:{onToggle:function(e,t,a){n.toggleTo(t,0)}}}),e},formModal:function(t,i,s,o,d,u){var c=new e({className:"fancy",visible:!0,closable:!0,header:i,body:t,footer:"<button type='button' id='SaveButton' class='btn btn-primary'>"+a.get("Create")+"</button><button type='button' id='CancelBtn' class='btn btn-default'>"+a.get("Cancel")+"</button> ",renderTo:s,events:{onHide:function(e){n.hideModal(this,e)},onShow:function(){n.showModal(this,0)}}});return c.getFooter().getElement("#SaveButton").addEvent("click",function(){n.createAttributes({modal:c,lines:r,attribute_type:o,header:i,attributeDBList:l,grid:d,changeGridObjects:u})}),c.getFooter().getElement("#CancelBtn").addEvent("click",function(){c.destroy()}),c.elements.wrapper.setStyle("width","800px"),c},launchPanel:function(e){var t=e.container;_header=e.header,l=e.attributes;var s=UWA.createElement("div",{class:"global-div"}),o=UWA.createElement("div",{id:"myContent"});UWA.createElement("h4",{text:_header}).inject(s),UWA.createElement("nav",{class:"tab tab-pills",id:"the-forms"}).inject(s),this.createTabNavPanel().inject(o);var d=UWA.createElement("div",{class:"tableDiv",styles:{"overflow-x":"auto"},events:{onscroll:()=>{}}}).inject(o),u=[{visible:!0,headerId:"nameColumn",headerName:a.get("createAttrTableNameHeader")},{visible:!0,headerId:"predicateColumn",headerName:a.get("createAttrTablePredicateHeader")},{visible:!0,headerId:"displayIn6WTagsColumn",headerName:a.get("createAttrTableDisplayIn6WTagsHeader")},{visible:"String"==e.attrType||"Integer"==e.attrType||"Double"==e.attrType,headerId:"authorizedValueColumn",headerName:a.get("createAttrTableRangesHeader")},{visible:"DoubleWithDim"==e.attrType,headerId:"dimensionsValueColumn",headerName:a.get("createAttrTableDimensionHeader")},{visible:"DoubleWithDim"==e.attrType,headerId:"PreferendUnitValueColumn",headerName:a.get("createAttrTablePrefUnitHeader")},{visible:!0,headerId:"defaultValueColumn",headerName:"DoubleWithDim"===e.attrType?a.get("createAttrTableDefaultValueForDimHeader"):a.get("createAttrTableDefaultValueHeader")},{visible:!0,width:"100px",headerId:"multiValueColumn",headerName:a.get("createAttrTableMultiValueHeader")},{visible:"String"==e.attrType,width:"100px",headerId:"multiLineColumn",headerName:a.get("createAttrTableMultilineHeader")},{visible:!0,width:"100px",headerId:"hasDefaultColumn",headerName:a.get("createAttrHasDefaultHeader")},{visible:!0,headerId:"TransEN",headerName:a.get("createAttrTableEnHeader")},{visible:!0,headerId:"TransFR",headerName:a.get("createAttrTableFrHeader")},{visible:!0,headerId:"TransDE",headerName:a.get("createAttrTableDeHeader")},{visible:!0,headerId:"TransJA",headerName:a.get("createAttrTableJaHeader")},{visible:!0,headerId:"TransKO",headerName:a.get("createAttrTableKoHeader")},{visible:!0,headerId:"TransRU",headerName:a.get("createAttrTableRuHeader")},{visible:!0,headerId:"TransZH",headerName:a.get("createAttrTableZhHeader")}],c={name:"Predicates",items:[]};if(e.predicates){var m=e.predicates;Object.keys(m).forEach(function(t){var a={label:t,items:[]},i=m[t];if(i){var n=i["DoubleWithDim"===e.attrType?"double":e.attrType.toLowerCase()];n&&Array.isArray(n)&&n.length>0&&(n.forEach(function(e){a.items.push({value:e.curi,label:e.label})}),c.items.push(a))}})}var f={name:"Dimensions",items:[]},p={};if("DoubleWithDim"==e.attrType){var h=e.dimensions;h&&Array.isArray(h)&&h.length>0&&Object.keys(h).forEach(function(e){var t=h[e].Name,a=h[e].NLS;f.items.push({value:t,label:a}),p[t]=h[e].Units})}var g=[{type:"text",visible:!0,fieldName:"nameField",id:"attrNameInput_",placeholder:a.get("createAttrNameFieldPLHolder"),onChange:n.validateNameField},{type:"autocomplete",visible:!0,fieldName:"predicateField",id:"predicateInput_",datasets:c,placeholder:a.get("createAttrFieldPredicatePlaceholder"),className:"autoCompletePredicate",attrType:e.attrType,onSelect:n.predSelected,onUnselect:n.predUnSelected},{type:"select",visible:!0,fieldName:"displayIn6WTags",id:"attrDisplayIn6WTagsInput_",disabled:!0,items:[{value:"No",label:a.get("createAttrFieldNoLabel"),selected:!0},{value:"Yes",label:a.get("createAttrFieldYesLabel")}]},{type:"chooser",visible:"String"==e.attrType||"Integer"==e.attrType||"Double"==e.attrType,fieldName:"authorizedField",id:"attrAutorizedValueInput_",className:"form-control",classIcon:"input-group-addon fonticon fonticon-language",onChange:n.authorizedValuesChanged,iconClickAction:n.iconClickAction,attrType:e.attrType,container:t},{type:"autocomplete",visible:"DoubleWithDim"==e.attrType,fieldName:"dimValue",id:"attrDimValueInput_",datasets:f,Units:p,placeholder:a.get("createAttrFieldDimensionPlaceholder"),className:"autoCompleteDim",onSelect:n.dimSelected,onUnselect:n.dimUnSelected},{type:"autocomplete",visible:"DoubleWithDim"==e.attrType,fieldName:"preferedUnitValue",id:"attrPreferedUnitValueInput_",placeholder:a.get("createAttrFieldPrefUnitPlaceholder"),className:"autoCompletePreferedUnit",datasets:{items:[]}},{type:"Date"==e.attrType?"date":"Boolean"==e.attrType?"select":"text",visible:!0,fieldName:"defaultValue",id:"attrDefaultValueInput_",placeholder:"Date"==e.attrType?a.get("createAttrFieldDateDefaultValuePlaceholder"):"",items:"Boolean"==e.attrType?[{value:"true",label:a.get("createAttrFieldTrueLabel")},{value:"false",label:a.get("createAttrFieldFalseLabel")}]:void 0,attrType:e.attrType,onInput:n.checkInputValue,onChange:n.parseInputValue},{type:"switch",visible:!0,fieldName:"multiValueField",id:"attrMultiValueInput_",value:"option1",width:"100px",onChange:n.multiValueToggled},{type:"switch",visible:"String"==e.attrType,fieldName:"multiLineField",id:"attrMultiLineInput_",value:"option1",width:"100px"},{type:"switch",visible:!0,fieldName:"hasDefaultField",id:"attrHasDefaultInput_",value:"option1",width:"100px",checked:!0,onChange:n.hasDefaultToggled},{type:"text",visible:!0,fieldName:"inputEN",id:"NLSValueEN",className:"form-control"},{type:"text",visible:!0,fieldName:"inputFR",id:"NLSValueFR",className:"form-control"},{type:"text",visible:!0,fieldName:"inputDE",id:"NLSValueDE",className:"form-control"},{type:"text",visible:!0,fieldName:"inputJA",id:"NLSValueJA",className:"form-control"},{type:"text",visible:!0,fieldName:"inputKO",id:"NLSValueKO",className:"form-control"},{type:"text",visible:!0,fieldName:"inputRU",id:"NLSValueRU",className:"form-control"},{type:"text",visible:!0,fieldName:"inputZH",id:"NLSValueZH",className:"form-control"}];r=i.createTable({alertContainer:s,wrapper:d,headersDef:u,fieldsDef:g}),this.formModal(o,s,t,e.attrType,e.grid,e.changeGridObjects)}}}),define("DS/IPClassificationAttributes/CreateNewAttributes",["UWA/Class","DS/Controls/ModalContainer","DS/Controls/Loader","UWA/Promise","DS/IPClassificationAttributes/views/AttrCreateForm","i18n!DS/IPClassificationAttributes/assets/nls/IPClassificationAttributes","DS/IPClassificationAttributes/dataprovider/DataProvider","DS/IPClassifyUXUtil/FileImportPanel","DS/PADServices/utils/GlobalModelEvents","DS/IPClassifyUtil/IPClassifyAlert","DS/UIKIT/Mask","DS/IPClassificationAttributes/utils/AttributesUtil","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/ZipUtils","text!DS/IPClassificationAttributes/assets/IPClassificationAttributesProps.json"],function(e,t,a,i,n,r,l,s,o,d,u,c,m,f,p){"use strict";var h={},g={};return e.extend({name:"IPClassificationAttributes",init:function(){g=JSON.parse(p)},loadImportAttrPanel:function(e){var t=this,a=o.getModelEvents();t.importPanel=new s({panelHeaderName:r.importLibraryPanelHeader,panelHeaderIcon:{iconName:"import-multiple wux-ui-3ds",fontIconFamily:WUXManagedFontIcons.Font3DS},modelEvents:a,closePanelEvent:"CreateNewAttributes/Views/showInWidgetBody",importButton_label:r.importButton,importButton_state:"disabled",importFileEvent:"ImportClassificationAttributes/SelectedFileContent",inputChanged:"ImportClassificationAttributes/FileContentChanged",accept:"application/x-zip-compressed",placeHolder:r.importAttributesPanelPLHolder});var i=[];i.push(a.subscribe({event:"ImportClassificationAttributes/FileContentChanged"},function(e){var a=t.importPanel.elements.fileController.elements.content.getChildren()[0];if(e){if(a.removeAttribute("style"),!e.name.endsWith(".zip"))return t.importPanel.elements.importButton.disabled=!0,d.displayNotification({message:r.zipFileExpected,className:"error"}),!1;f.unzip(e).then(function(e){if(h=e,null==e)t.importPanel.elements.importButton.disabled=!0,d.displayNotification({message:r.jsonFormatNotValid,className:"error"});else{t.importPanel.elements.importButton.disabled=!1;var a={};Object.keys(e).forEach(function(t){"Dictionary"==t?a=e[t].Interfaces[g.interface_name].Attributes:e[t].Dictionary&&(a=e[t].Dictionary.Interfaces[g.interface_name].Attributes)}),0==Object.keys(a).length&&(t.importPanel.elements.importButton.disabled=!0,d.displayNotification({message:r.noAttributeToImport,className:"error"}))}})}else a&&(a.setAttribute("style","opacity: 0.8; color: #b4b6ba"),a.textContent=r.importAttributesPanelPLHolder,t.importPanel.elements.importButton.disabled=!0)})),i.push(a.subscribe({event:"ImportClassificationAttributes/SelectedFileContent"},function(t){u.mask(e.loaderDiv),console.log("launch Classification Attributes Import");var a=t.file?t.file:t;l.launchImport(a).then(function(t){l.massupdateAttributeInfos(a).then(function(t){if(null!=h&&Object.keys(h).length>0){var a={};Object.keys(h).forEach(function(e){"Dictionary"==e?a=h[e].Interfaces[g.interface_name].Attributes:h[e].Dictionary&&(a=h[e].Dictionary.Interfaces[g.interface_name].Attributes)}),c.addNewAttrsToGridView([],a,e.grid,e.changeGridObjects,!1,!0)}u.unmask(e.loaderDiv),console.log("Launch import complete"),d.displayNotification({message:r.importSuccess,className:"success"})},function(t){u.unmask(e.loaderDiv),console.log("Failure to update classification attributes infos");var a=r.updateAttributesInfosFail;null!=t&&0!==t.length&&(a+=": "+t),d.displayNotification({message:a,className:"error"})})},function(t){u.unmask(e.loaderDiv),console.log("Failure to import Classification Attributes");var a=r.importFail;null!=t&&0!==t.length&&(a+=": "+t),d.displayNotification({message:a,className:"error"})})})),i.push(a.subscribe({event:"CreateNewAttributes/Views/showInWidgetBody"},function(e){if(e.html){var t=document.querySelector(".LibraryEditor_containerTools");e.html.inject(t),e.keepOpacity||widget.body.right_side_div.setStyle("opacity",.5)}else if(!0===e.restore){i.forEach(function(e){a.unsubscribe(e)}),document.querySelector(".LibraryEditor_containerTools").getChildren()[1].remove(),widget.body.right_side_div.setStyle("opacity",1)}}))},loadAttrCreatePanel:function(e){var s=this;this.loader=new a({text:r.get("LOADING"),showButtonFlag:!1}),t.createModal(widget.body,this.loader.elements.container),s.loader.on(r.get("LOADING")),m.initURLSAsync().then(function(){s.tenantUrl=m.get3DSpaceUrl(),i.all([l.getPredicates({tenantUrl:s.tenantUrl}).promise,l.getDimensions({tenantUrl:s.tenantUrl}).promise,l.getDictionaryCusto({tenantUrl:s.tenantUrl}).promise]).then(function(a){t.removeModal(widget.body),n.launchPanel({attrType:e.attrType,header:r.get("HeaderPopupCreateAttr_"+e.attrType),container:e.container,predicates:a[0],dimensions:a[1].results,attributes:a[2],changeGridObjects:e.changeGridObjects,grid:e.grid})},function(e){d.displayNotification({message:e,className:"error"}),t.removeModal(widget.body)})})}})});