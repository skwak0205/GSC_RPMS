define("DS/VCXWebStyles/VCXModifiableStyle",["DS/CoreEvents/Events","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebModifiables/VCXModifiable","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyInfo","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r,n,s,i,o){"use strict";return r.extend({init:function(){this._parent()},OnChangeProperty:function(e,t,r){if(r||(r={}),r.fromChildClass);else if(this.OnChangePropertyBegin(e,t))return!0;if("Actor.Name"===e)this.GetObject().SetName(t.Value);else{var n=this.GetObject().GetPropertySet().GetProperty(e);if(!n)return r.fromChildClass=!0,this._parent(e,t,r);n.SetPropertyValue(t.Clone()),this.GetObject().GetPropertySet().AddOrModifyProperty(n)}return!0},OnChangePropertiesEnd:function(){},GetProperty:function(e){var t;if("Actor.Name"===e){var r=new n,a=this.GetObject().GetName();r.SetValue(a);var l=new i(e,i.EBehaviorType.Singleton,!0,o);t=new s(l,r)}else t=(t=this.GetObject().GetPropertySet().GetProperty(e))?t.Clone():this._parent(e);return t},GetProperties:function(){var e=this._parent();return e.AddOrModifyProperty(this.GetProperty("Actor.Name")),e.Merge(this.GetObject().GetPropertySet()),e}})}),define("DS/VCXWebStyles/VCXComponentStyle",["UWA/Class","DS/VCXWebProperties/VCXPropertySet"],function(e,t){"use strict";var r=e.extend({init:function(){this.propSet=new t,this.name="Style Name"},GetType:function(){return this.componentType},GetName:function(){return this.name},SetName:function(e){this.name=e},SetPropertySet:function(e){this.propSet=e.Clone()},GetPropertySet:function(){return this.propSet}});return Object.defineProperty(r.prototype,"componentType",{enumerable:!0,get:function(){return"VCXComponentStyle"}}),r}),define("DS/VCXWebStyles/VCXStylesManager",["UWA/Class","DS/WebappsUtils/WebappsUtils","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebExperienceLoader/VCXExperienceLoaderBase","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebKernelCommands/VCXCmdChangeLinkedProperties","DS/VCXWebProperties/VCXPropertySet","DS/CoreEvents/Events"],function(e,t,r,n,s,i,o,a,l){"use strict";var y=e.extend({initialize:function(){return this.stylesForType={},this._stylesID={},this._stylesfiles={},this._styles={},this._stylesIntegerID={},this._stylesVisibility={},this._stylesNextIntegerID=1,this._isInitialized=!0,this._numberOfFilesToLoad=0,this._numberOfFilesLoaded=0,this._masterfilevar=null,this.LoadStyles(this._moduleName)},unInitialize:function(){this._isInitialized=!1,this._styles=null},postInitialize:function(){},SetModuleName:function(e){this._moduleName=e},GetModuleName:function(){return this._moduleName},ParseMasterFiles:function(e){var t=[];this._masterfilevar=e;for(var r=0;r<e.styles.length;r++){var n=e.styles[r];n.type;if(n.x){for(var s=0;s<n.x.length;s++){var i=n.x[s];this._numberOfFilesToLoad++,t.push(this.LoadStyle(this._moduleName,"styles/"+i+".json",i))}for(var o=0;o<n.y.length;o++){var a=n.y[o];this._numberOfFilesToLoad++,t.push(this.LoadStyle(this._moduleName,"styles/"+a+".json",a))}}if(n.list)for(var l=0;l<n.list.length;l++){var y=n.list[l];this._numberOfFilesToLoad++,t.push(this.LoadStyle(this._moduleName,"styles/"+y+".json",y))}}return UWA.Promise.allSettled(t)},LoadStyles:function(e){if(!this._moduleName)return UWA.Promise.resolve();var n=this,s=t.getWebappsAssetUrl(e,"styles/styles_list.json");return r.PBlobURLToJSONText(s).then(function(e){return n.ParseMasterFiles(e)})},LoadStyle:function(e,r,n){var s=t.getWebappsAssetUrl(e,r);return this.LoadStyleURL(s,n).catch(function(e){console.error(e),UWA.Promise.reject(e)})},LoadStyleURL:function(e,t){var n=this,s=t;return r.PBlobURLToBlob(e,"").then(function(e){return r.PBlobToFileVar(e)}).then(function(e){var t=s;if(n._isInitialized&&(n._stylesID[t]=e.objectID,n._stylesfiles[t]=n.BuildStyle(e),e.visible?n._stylesVisibility[e.objectID]=!0:n._stylesVisibility[e.objectID]=!1,n._numberOfFilesLoaded++,n._numberOfFilesLoaded===n._numberOfFilesToLoad)){n.stylesForType={};e=n._masterfilevar;for(var r=0;r<e.styles.length;r++){var i=e.styles[r],o=i.type;if(n.stylesForType[o]=[],i.x)for(var a=0;a<i.x.length;a++)for(var l=i.x[a],y=0;y<i.y.length;y++){var p=i.y[y],h=n._stylesfiles[l],u=n._stylesfiles[p];(S=h.Clone(h)).Merge(u);var c=n._stylesID[l]+"."+n._stylesID[p];n.BuildStyleFromPropertySet(S,c,l+" "+p),n.stylesForType[o].push(c)}if(i.list)for(var f=0;f<i.list.length;f++){t=i.list[f];var S=(h=n._stylesfiles[t]).Clone(h);c=n._stylesID[t];n.BuildStyleFromPropertySet(S,c,t),n.stylesForType[o].push(c)}}}})},BuildStyle:function(e){var t=new n;return t.InitLoader(this._experienceBase),t.LoadPropSet(e.properties)},BuildStyleFromPropertySet:function(e,t,r){e.onEachProperty(function(e,t){t.GetPropertyInfo().SetBehaviorType(i.EBehaviorType.Singleton)});var n=this._experienceBase.Factory.BuildComponent("VCXComponentStyle");n&&(n.SetPersistency(2),n.SetID(t),n.SetName(r),this._experienceBase.ComponentsMap.AddComponent(n),this._styles[this._stylesNextIntegerID]=n,this._stylesIntegerID[n.GetID()]=this._stylesNextIntegerID,this._stylesNextIntegerID++),n.SetPropertySet(e);var o=n.QueryInterface("VCXIModifiable"),a=this._experienceBase.getManager("VCXScenarioManager"),l=new s(a,this._experienceBase.getManager("VCXCommandManager"));return e.onEachProperty(function(e,t){l.ChangeProperty(o,t)}),this._experienceBase.getManager("VCXCommandManager").Do(l),n},CreateStyle:function(e,t){for(var r=new a,n=0;n<e.length;n++)r.AddOrModifyProperty(t.GetProperty(e[n]));var s=this.BuildStyleFromPropertySet(r,"","New Style"),i=[];i.push(s),l.publish({event:"VCX_STYLE_ADDED",data:i})},Subscribe:function(e,t){var r=this._stylesIntegerID[t],n=this._styles[r];if(n){var s=this._experienceBase.getManager("VCXLinkedPropertyManager"),i=this._experienceBase.getManager("VCXScenarioManager"),a=this._experienceBase.getManager("VCXCommandManager"),l=new o(s,i,a),y=n.GetPropertySet();this._experienceBase.getManager("VCXScenarioManager");y.onEachProperty(function(r,n){l.AddLink(t,r,e.GetObject().GetID(),r,null)}),this._experienceBase.getManager("VCXCommandManager").Do(l)}},UnSubscribe:function(e,t){var r=this._stylesIntegerID[t],n=this._styles[r];if(n){var s=this._experienceBase.getManager("VCXLinkedPropertyManager"),i=this._experienceBase.getManager("VCXScenarioManager"),a=this._experienceBase.getManager("VCXCommandManager"),l=new o(s,i,a),y=n.GetPropertySet();this._experienceBase.getManager("VCXScenarioManager");y.onEachProperty(function(r,n){l.RemoveLink(t,r,e.GetObject().GetID(),r)}),this._experienceBase.getManager("VCXCommandManager").Do(l)}}});return Object.defineProperty(y.prototype,"componentType",{enumerable:!0,get:function(){return"VCXStylesManager"}}),y});