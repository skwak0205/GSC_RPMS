/*!  Copyright 2016 Dassault Systemes. All rights reserved. */
define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticSolveAttrLinkCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],function(t,e){"use strict";return t.extend(e,{init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0}),this.setRepeatMode(!1)}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticAttrBrowserCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/PADUtils/PADContext","DS/CAT3DAnnotationAttributeController/CAT3DAnnotationAttributeController"],function(t,e,n){"use strict";return t.extend({init:function(t){this._parent(t,{});var i,o=this,a=this.onStateChange(function(){i||(i=e.get()),n.get3DAnnotAttrBrowserController({context:i}).setActiveState(o.getState()),localStorage.setItem("CAT3DAnnotSemanticAttrBrowserCmd",o.getState()?"true":"false")}),r=this._destroy;this._destroy=function(){i&&n.unreference3DAnnotAttrBrowserController({context:i}),o._modelEvents.unsubscribe(a),r.call(o)},this.setState("false"!==localStorage.getItem("CAT3DAnnotSemanticAttrBrowserCmd"),!0)},_destroy:function(){this._parent()}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticCmds",[],function(){}),define("DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticController",[],function(){}),define("DS/CAT3DAnnotSemanticWidget/CATA3IAppInit",["DS/WAfrContainer/App"],function(t){"use strict";var e,n={wkbFile:"CAT3DAnnotSemanticWidgetWkb.xml",wkbModule:"CAT3DAnnotSemanticWidget",defaultCmdHdr:"CAT3DAnnotInsightWidgetDefaultHdr",defaultCmdJSModule:"DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticWidgetDefaultCmd"};return t.extend({setUp:function(t){var i=this;if(t.sourceApp)if(t.sourceApp.pad3DViewer){this.pad3DViewer=t.sourceApp.pad3DViewer,this.appMainDiv=t.sourceApp.appMainDiv;var o=function(o){o.sourceApp&&!o.sourceApp.isDisposeCalled()&&o.sourceApp.dispose();var a=o;a.widgetData=n;var r=o.done;t.done=function(e){i.appMainDiv||(i.appMainDiv=e.appMainDiv),t.done=r,t.done()},e.setUp(a)};e?o(t):require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(i){e=new i({widget:window.widget,data:n,pad3DViewer:t.sourceApp.pad3DViewer,appMainDiv:t.sourceApp.appMainDiv}),o(t)})}else t.done();else require(["DS/CAT3DAnnotationWidget/CAT3DAnnotationWidget"],function(o){e=new o({widget:window.widget,viewerAttachment:t.done,done:function(t){i.pad3DViewer=t.pad3DViewer,i.appMainDiv=t.appMainDiv},data:n})})},dispose:function(t){e&&e.dispose&&e.dispose(t),this._parent(t)},onWillEnter:function(t){return e&&e.onWillEnter&&e.onWillEnter(t),this._parent(t)},onWillLeave:function(t){return e&&e.onWillLeave&&e.onWillLeave(t),this._parent(t)}})}),define("DS/CAT3DAnnotSemanticWidget/CAT3DAnnotSemanticWidget",[],function(){}),define("DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance",["DS/CAT3DAnnotationExpController/CAT3DAnnotExpControllerInstance","DS/Selection/CSOManager","DS/CATWebUXSlideShow/CATWebUXSlideShowController"],function(t,e,n){"use strict";return t.extend({init:function(t){var i=t||{};i.workbenchName="CAT3DAnnotSemanticWidgetWkb",i.moduleName="CAT3DAnnotSemanticWidget",this._parent(i);var o=this,a=i.ctxViewer,r=this.setActiveState;this.setActiveState=function(t){r(t);var e=n.giveSlideShowController({context:a.getFrameWindow(),id:"CAT3DAnnotationSlideShow"});e&&e.setListOfCommandsAllowed(["CAT3DAnnotInsightWidgetDefaultHdr"])},this.getAnnotationControllerType=function(){return"3DAnnotationInsight"};var s=this.clearController;this.clearController=function(){s(),a=o=null};var l=this._onCommandStartCB;this._onCommandStartCB=function(t){l(t);for(var e=["CAT3DAnnotSemanticShowGeomAttachHdr","CAT3DAnnotSemanticShowRelatedAnnotHdr"],n=function(){setTimeout(o._refreshContextualBar)},i=0;i<e.length;i++)t._id===e[i]&&t.onEnd(n)};var g=this.getAnnotControllerPrototype;this.getAnnotControllerPrototype=function(){var t=g();return t.getReferencedAnnotations=function(t){if(o)return o.getReferencedAnnotations(t)},t};var A=this.getContextualCommandList;this.getContextualCommandList=function(){if(!a)return[];var t,n,i,r=A(),s=[],l=e.get(),g=a.getRootBagPath(),h=!1,d=!0;for(t=0;t<l.length;t++)if(l[t].pathElement&&g.isAParentOf(l[t].pathElement)){s.push(l[t].pathElement);var c=l[t].pathElement.getLastElement(!0);if(!c.getAnnotationClassType){d=!1;break}if(h=!0,"tps"!==c.getAnnotationClassType()){d=!1;break}}if(d)for(i=!1,t=0;t<s.length&&!i;t++)if(s[t].getLastElement(!0).isVisible()){var m=s[t].getLastElement(!0),u=void 0!==m.getGeometricalAttachmentList?m.getGeometricalAttachmentList():null;if(u&&u.length){var f=s[t].getParentPath().getParentPath().getLastElement(!0).children;for(n=0;n<f.length;n++){if("RootViews"!==f[n].getAnnotationType()&&"RootCaptures"!==f[n].getAnnotationType()&&"RootGeometries"!==f[n].getAnnotationType())for(var C=f[n].children,p=0;p<C.length;p++){if(-1!==u.indexOf(C[p].getAnnotationID())&&!C[p].isVisible()){r.unshift({name:"CAT3DAnnotInsightShowGeomAttachStr",line:1,hdr_list:["CAT3DAnnotSemanticShowGeomAttachHdr"]}),i=!0;break}}if(i)break}}}if(!h)for(i=!1,t=0;t<s.length&&!i;t++){var D=o.getPontingAnnotations(s[t]);if(D&&D.length)for(n=0;n<D.length;n++)if(!D[n].getLastElement(!0).isVisible()){r.unshift({name:"CAT3DAnnotInsightShowRelatedAnnotStr",line:1,hdr_list:["CAT3DAnnotSemanticShowRelatedAnnotHdr"]}),i=!0;break}}return r},this.getReferencedAnnotations=function(t){var e=t.getLastElement(!0);if("tps"!==e.getAnnotationClassType())return[];var n,i,a=o._getParentAnnotationSetPath(t),r=void 0!==e.getAnnotationReferenceFrame?e.getAnnotationReferenceFrame():null,s=[];if(r||32===e.getAnnotationType()){var l,g=a.getLastElement(!0).getReferenceFrames();for(n=0;n<g.length;n++)if(g[n].tpsID===r||e.getAnnotationUuid()===g[n].uuid){l=g[n].datums;break}if(void 0!==l){var A=a.getLastElement(!0).getRootAnnotationNode("RootDatums"),h=A.children,d=a.clone();for(d.addElement(A),n=0;n<l.length;n++)for(i=0;i<h.length;i++)if(h[i].getAnnotationID()===l[n]){var c=d.clone();c.addElement(h[i]),s.push(c);break}}}return s};var h=function(t,e){return e&&e.length&&(t=t&&t.length?t.concat(e):e),t},d=o.getPointedPaths;this.getPointedPaths=function(t){var e=d(t);if(a.getRootBagPath().isAParentOf(t)){var n=t.getLastElement(!0);if(n.getAnnotationClassType&&"tps"===n.getAnnotationClassType())if(e=h(e,o.getRelatedGeometryPaths([t])),e=h(e,o.getReferencedAnnotations(t)),8===n.getAnnotationSupertype())e=h(e,o.getPontingAnnotations(t));else{var i=o._getParentAnnotationSetPath(t);i&&(e=h(e,function(t,e){var n,i=t.getLastElement(!0);if(i.getDatumTargetList&&i.getDatumTargetList()){var o=i.getDatumTargetList(),a=e.getLastElement(!0).getRootAnnotationNode("RootDatums"),r=e.clone();r.addElement(a);var s=r.getChildrenPathes();n=[];for(var l=0;l<s.length;l++)-1!==o.indexOf(s[l].getLastElement(!0).getAnnotationID())&&n.push(s[l].clone())}return n}(t,i)),e=h(e,function(t,e){var n,i=t.getLastElement(!0);if(i.getAssociatedBasicDims&&i.getAssociatedBasicDims()){var o=i.getAssociatedBasicDims(),a=e.getChildrenPathes();n=[];for(var r=0;r<a.length;r++){var s=a[r].getLastElement(!0);if("RootViews"!==s.getAnnotationType()&&"RootCaptures"!==s.getAnnotationType()&&"RootGeometries"!==s.getAnnotationType())for(var l=a[r].getChildrenPathes(),g=0;g<l.length;g++)-1!==o.indexOf(l[g].getLastElement(!0).getAnnotationID())&&n.push(l[g].clone())}}return n}(t,i)),e=h(e,function(t,e){var n,i=t.getLastElement(!0),o=i.getAuxiliaryFeatures?i.getAuxiliaryFeatures():null;if(o&&(o.annotations||o.cgs)){var a=e.getChildrenPathes();n=[];for(var r=0;r<a.length;r++){var s=a[r].getLastElement(!0);if("RootViews"!==s.getAnnotationType()&&"RootCaptures"!==s.getAnnotationType()){var l,g=0;if("RootGeometries"===s.getAnnotationType()&&o.cgs.length)for(l=a[r].getChildrenPathes(),g=0;g<l.length;g++)-1!==o.cgs.indexOf(l[g].getLastElement(!0).getAnnotationID())&&n.push(l[g].clone());else if("RootGeometries"!==s.getAnnotationType()&&o.annotations.length)for(l=a[r].getChildrenPathes(),g=0;g<l.length;g++)-1!==o.annotations.indexOf(l[g].getLastElement(!0).getAnnotationID())&&n.push(l[g].clone())}}}return n}(t,i)),e=h(e,function(t,e){var n=[];if(t&&t.getLastElement(!0).getAnnotationSCSReframeArea&&t.getLastElement(!0).getAnnotationSCSReframeArea()){let l=t.getLastElement(!0).getAnnotationSCSReframeArea(),g=[];l.upperLimit&&l.upperLimit.length&&(g=g.concat(l.upperLimit)),l.lowerLimit&&l.lowerLimit.length&&(g=g.concat(l.lowerLimit));for(var i=e.getChildrenPathes(),o=0;o<i.length;o++){var a=i[o].getLastElement(!0);if("RootViews"!==a.getAnnotationType()&&"RootCaptures"!==a.getAnnotationType()&&"RootGeometries"!==a.getAnnotationType())for(var r=i[o].getChildrenPathes(),s=0;s<r.length;s++)-1!==g.indexOf(r[s].getLastElement(!0).getAnnotationID())&&n.push(r[s].clone())}}return n}(t,i)))}else e=h(e,o.getPontingAnnotations(t))}return e}}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticShowRelatedAnnotCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/PADUtils/PADContext","DS/CAT3DAnnotationController/CAT3DAnnotationController"],function(t,e,n,i,o){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0}),this.setRepeatMode(!1)},beginExecute:function(){var t=function(t){if(!t)return null;var e=void 0!==t.getLastElement(!0).getAnnotationID?t.getLastElement(!0).getAnnotationID():null,n=t.getParentPath().getParentPath();if(!n.getLastElement(!0).getAnnotationClassType||"tpsAnnotationSet"!==n.getLastElement(!0).getAnnotationClassType())return null;var i,o,a=null,r=n.getChildrenPathes();for(i=0;i<r.length;i++)if("RootViews"===r[i].getLastElement(!0).getAnnotationType()){a=r[i];break}if(a){var s=a.getChildrenPathes();for(i=0;i<s.length;i++){var l=s[i].getLastElement(!0).getTPSList();if(l&&l.length)for(o=0;o<l.length;o++)if(l[o]===e)return s[i]}}},n=e.get();n.length||this.end(),this.ctxBarPosition=this.getFrameWindow().getContextualUIManager().getContextualBar().getPosition(),this.ctxBarPosition=this.ctxBarPosition?{x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}:{x:0,y:0};var a,r,s,l=i.get(),g=o.giveAnnotationController({context:l}),A=[],h=[];for(a=0;a<n.length;a++){var d=g.getPontingAnnotations(n[a].pathElement);if(d&&d.length)for(r=0;r<d.length;r++){A.push(d[r]);var c=t(d[r]);c&&c.getLastElement(!0).isVisible()&&-1===A.indexOf(c)&&A.push(c);var m=d[r].getParentPath().getParentPath();-1===h.indexOf(m)&&h.push(m)}}if(h&&h.length)for(a=0;a<h.length;a++){var u=h[a].getChildrenPathes();for(r=0;r<u.length;r++){var f=u[r].getChildrenPathes();for(s=0;s<f.length;s++)f[s].getLastElement(!0).setVisibility(!1)}}if(A&&A.length)for(a=0;a<A.length;a++)A[a].getLastElement(!0).setVisibility(!0);this.end()},endExecute:function(){for(var t=e.get(),i=[],o=0;o<t.length;o++)i.push({pathElement:t[o].pathElement.clone()});e.empty(),n.empty(),e.add(i),n.add(i),this.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}),this.getFrameWindow().getViewer().render(),this.ctxBarPosition=null}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticShowGeomAttachCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/Selection/HSOManager"],function(t,e,n){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"shared",isAsynchronous:!0}),this.setRepeatMode(!1)},beginExecute:function(){var t=e.get();t.length||this.end(),this.ctxBarPosition=this.getFrameWindow().getContextualUIManager().getContextualBar().getPosition(),this.ctxBarPosition=this.ctxBarPosition?{x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}:{x:0,y:0};for(var n=0;n<t.length;n++)if(t[n].pathElement.getLastElement(!0).isVisible()){var i=t[n].pathElement.getLastElement(!0).getGeometricalAttachmentList();if(i&&i.length)for(var o=t[n].pathElement.getParentPath().getParentPath().getLastElement(!0).children,a=0;a<o.length;a++)if("RootViews"!==o[a].getAnnotationType()&&"RootCaptures"!==o[a].getAnnotationType()&&"RootGeometries"!==o[a].getAnnotationType())for(var r=o[a].children,s=0;s<r.length;s++){-1===i.indexOf(r[s].getAnnotationID())||r[s].isVisible()||r[s].setVisibility(!0)}}this.end()},endExecute:function(){for(var t=e.get(),i=[],o=0;o<t.length;o++)i.push({pathElement:t[o].pathElement.clone()});e.empty(),n.empty(),e.add(i),n.add(i),this.getFrameWindow().getContextualUIManager().showContextualBar({hideWithDistance:!0,x:this.ctxBarPosition.x,y:this.ctxBarPosition.y}),this.getFrameWindow().getViewer().render(),this.ctxBarPosition=null}})}),define("DS/CAT3DAnnotSemanticCmds/CAT3DAnnotSemanticWidgetDefaultCmd",["DS/CAT3DAnnotationCommands/CAT3DAnnotationWidgetDefaultCmd"],function(t){"use strict";return t.extend({init:function(t){var e=t||{};e.annotControllerLib="DS/CAT3DAnnotSemanticController/CAT3DAnnotSemanticContInstance",this._parent(e)}})});