define("DS/CAT3DExpAmbienceModelWeb/interfaces/CATI3DXAmbienceAsset",["UWA/Class","DS/WebComponentModeler/CATWebInterface"],function(e,n){"use strict";return n.singleton({interfaceName:"CATI3DXAmbienceAsset",required:{getAmbience:function(){}},optional:{}})}),define("DS/CAT3DExpAmbienceModelWeb/extensions/CATECXPAmbienceEnvironmentActivate",["UWA/Core","UWA/Class/Listener","DS/Visualization/ThreeJS_DS"],function(e,n,t){"use strict";return e.Class.extend(n,{init:function(){this._parent(),this._ambience=null,this._frameChanges={},this._refreshAtNextFrame=!1},Dispose:function(){this._parent(),this._frameChanges={},this._refreshAtNextFrame=!1,this._ambience&&this.Deactivate()},Activate:function(){var e=this;return this.QueryInterface("CATI3DXAmbienceAsset").getAmbience().done(function(n){var t=e.GetObject()._experienceBase.getManager("CAT3DXEnvironmentManager");e._ambience=n,t.isTransparentBackground()?e._ambience.getBackground().setActivated(!1):e._ambience.getBackground().setActivated(!0),t._getViewer().setAmbience(n,!0),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Exposure.CHANGED",function(){e._addFrameChanges("exposure",e._refreshExposure)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Radius.CHANGED",function(){e._addFrameChanges("domeRadius",e._refreshDomeRadius)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Finite Dome.CHANGED",function(){e._addFrameChanges("domeFinite",e._refreshDomeFinite)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Origin X.CHANGED",function(){e._addFrameChanges("domeTransform",e._refreshDomeTransform)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Origin Y.CHANGED",function(){e._addFrameChanges("domeTransform",e._refreshDomeTransform)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Origin Z.CHANGED",function(){e._addFrameChanges("domeTransform",e._refreshDomeTransform)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Rotation X.CHANGED",function(){e._addFrameChanges("domeTransform",e._refreshDomeTransform)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Rotation Y.CHANGED",function(){e._addFrameChanges("domeTransform",e._refreshDomeTransform)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Dome Rotation Z.CHANGED",function(){e._addFrameChanges("domeTransform",e._refreshDomeTransform)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Ground Scale Ratio.CHANGED",function(){e._addFrameChanges("groundScale",e._refreshGroundScaleRatio)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Ground Offset.CHANGED",function(){e._addFrameChanges("groundOffset",e._refreshGroundOffset)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Ground Reflectivity.CHANGED",function(){e._addFrameChanges("groundReflectivity",e._refreshGroundReflectivity)}),e.listenTo(e.QueryInterface("CATI3DExperienceObject"),"Ground Glossiness.CHANGED",function(){e._addFrameChanges("groundGlossiness",e._refreshGroundGlossiness)}),e._addFrameChanges("exposure",e._refreshExposure),e._addFrameChanges("domeRadius",e._refreshDomeRadius),e._addFrameChanges("domeFinite",e._refreshDomeFinite),e._addFrameChanges("domeTransform",e._refreshDomeTransform),e._addFrameChanges("groundScale",e._refreshGroundScaleRatio),e._addFrameChanges("groundOffset",e._refreshGroundOffset),e._addFrameChanges("groundReflectivity",e._refreshGroundReflectivity),e._addFrameChanges("groundGlossiness",e._refreshGroundGlossiness)})},_refreshExposure:function(){},_refreshDomeRadius:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Radius");0===e||"backplate"===this._ambience.getBackground().getType()?this._ambience.setFiniteMode(!1):(this._ambience.setGroundRadius(e),this._ambience.setFiniteMode(!0))},_refreshDomeFinite:function(){this.QueryInterface("CATI3DExperienceObject").HasVariable("Finite Dome")&&(this.QueryInterface("CATI3DExperienceObject").GetValueByName("Finite Dome")?this._ambience.setFiniteMode(!0):this._ambience.setFiniteMode(!1))},_refreshDomeTransform:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Origin X"),n=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Origin Y"),r=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Origin Z"),i=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Rotation X"),s=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Rotation Y"),a=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Dome Rotation Z"),o=new t.Matrix4;o.setRotationFromEuler(new t.Vector3(i*Math.PI/180,s*Math.PI/180,a*Math.PI/180)),o.setPosition(new t.Vector3(e,n,r)),this._ambience.setTransform(o);var c=new t.Matrix4;c.setRotationFromEuler(new t.Vector3(i*Math.PI/180,s*Math.PI/180,a*Math.PI/180)),this._ambience.setEnvironmentLightMatrix(c)},_refreshGroundScaleRatio:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Scale Ratio");this._ambience.setGroundHeight(new t.Vector3(0,0,e/6))},_refreshGroundOffset:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Offset");this._ambience.setGroundOffset(e)},_refreshGroundReflectivity:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Reflectivity");this._ambience.setGroundReflectivitiy(e/100)},_refreshGroundGlossiness:function(){var e=this.QueryInterface("CATI3DExperienceObject").GetValueByName("Ground Glossiness");this._ambience.setGroundGlossiness(e/100)},Deactivate:function(){this.stopListening(),this._ambience=null,this._frameChanges={}},_addFrameChanges:function(e,n){this._frameChanges[e]=n,this._refreshAtNextFrame||(this._refreshAtNextFrame=!0,this.GetObject()._experienceBase.getManager("CAT3DXEnvironmentManager")._refreshEnvironment(this))},Refresh:function(){for(var e in this._refreshAtNextFrame=!1,this._frameChanges)this._frameChanges.hasOwnProperty(e)&&(this._frameChanges[e].call(this),delete this._frameChanges[e])}})}),define("DS/CAT3DExpAmbienceModelWeb/extensions/CATE3DXAmbienceAsset",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Class/Events"],function(e,n,t,r){"use strict";return n.extend(t,r,{init:function(){},Build:function(){this.listenTo(this.QueryInterface("CATI3DExperienceObject"),"ASSET_CHANGED",()=>{this._clearAmbience(),this.dispatchEvent("AMBIENCE_CHANGED")})},Dispose:function(){this._clearAmbience()},_clearAmbience:function(){delete this._ambience,delete this._ambiencePromise},getAmbience:function(){return this._ambience?e.Promise.resolve(this._ambience):this._ambiencePromise?this._ambiencePromise:(this._ambiencePromise=this.QueryInterface("CATI3DXAssetHolder")._resolveAsset().then(e=>this._getAmbienceFromAsset(e)).then(e=>(this._ambience=e,delete this._ambiencePromise,this._ambience)).catch(n=>(delete this._ambiencePromise,e.Promise.reject(n))),this._ambiencePromise)},_getAmbienceFromAsset:function(){return e.Promise.reject(new Error("CATE3DXAmbienceAsset._getAmbienceFromAsset : Must be implemented by derived class"))}})});