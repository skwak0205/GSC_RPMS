define("DS/TerminologyEditor/TerminologyEditor",["UWA/Core","DS/ApplicationFrame/CommandsManager","DS/LifecycleServices/LifecycleServicesSettings","DS/Windows/ImmersiveFrame","DS/WebUAUtils/WebUAUtils","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/IPClassifyUtil/bsd_utils/BSDSettingsMgt","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/TerminologyEditor/TerminologyComponent","DS/TerminologyEditor/TerminologyIdCardCont","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/TerminologyTreeCont","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/commands/TerminologyCommands","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyCommunication","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/IPClassifyModelEvents","DS/WidgetServices/WidgetServices","DS/IPClassifyUXUtil/CredentialsView","DS/PlatformAPI/PlatformAPI","text!DS/TerminologyEditor/assets/terminology_settings.json","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v,T,_,C,S,b,E,D,w,A,I,x,P,N){"use strict";function O(){var t=this;t.options=t.options||{},UWA.extend(t.options,{custo_view_title:f.name_Widget_Title}),t.checkOnCommand=!1,l.set(t),window.top.performance.mark("loadRequire_end");var n,i,s,d=function(e){if(e){var t=f[e.label];e.label=t||e.label,e.options&&e.options.forEach(function(e){e.label=f[e.label]})}},g=function(e){var t=a.getSpecificWidgetPreference(e);t&&t.length>0&&d(t[0]),"useIndexAcceleration"==e&&(t[0].onchange="onUseOnlyDBChange",widget.addEvent("onUseOnlyDBChange",function(){var e=JSON.parse(JSON.stringify(widget.getPreference("autoSwitch")));widget.getValue("useIndexAcceleration")?e.disabled=!1:e.disabled=!0,widget.addPreference(e),widget.dispatchEvent("onEdit")})),"autoSwitch"==e&&(t[0].disabled=!widget.getValue("useIndexAcceleration")),t&&widget.mergePreferences(t)},h=JSON.parse(P);"function"==typeof window.updateSettings&&window.updateSettings(h),a.setApp(h.padsettings,"enopad",!0),widget.setValue("tenantAware",!0),widget.addEventOnce("onNoSecurityContext",function(e){!0!==e&&(C._isSecurityCTXInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:f.get("authentication_error"),class:"TerminologyEditor_auth_error"}).inject(widget.body))}),widget.addEventOnce("onNoPlatform",function(){C._isTenantInitialized=!1,widget.setBody(" "),UWA.createElement("div",{text:f.get("noPlatform_error"),class:"TerminologyEditor_auth_error"}).inject(widget.body)}),t.updateTitle=function(){t.setTitle&&t.setTitle(t._label)},widget.addEvent("onPad_security_ctx",t.updateTitle.bind(t)),widget.addEvent("onTenantChange",t.updateTitle.bind(t)),widget.addPreference({name:"xPref_CREDENTIAL",type:"hidden"}),n="drag-and-drop",(s=A.getWidgetPreference(n))&&s.length>0?d(s[0]):A.setWidgetPreferences({name:n,type:"hidden",value:i}),g("activateBIFilter"),a.setSetting("activateTreeFilter",!1),g("useIndexAcceleration"),g("autoSwitch"),!0===widget.getValue("noCompass")&&widget.setValue("autoSwitch","Never"),window.authoringModeODT&&widget.setValue("useIndexAcceleration",!1),"1"===widget.getValue("debug_me")&&(g("expandSaveLimitation"),g("resetCustomization"),g("compactModeForLeftSidebar")),!0===A.getWidgetPreferenceValue("Activate_relationsColumns")?g("activateRelationsColumns"):widget.addPreference({name:"activateRelationsColumns",type:"hidden"}),t.widget.addEvent("endEdit",a.updateWidgetPreferences.bind(a)),a.updateWidgetPreferences(),a.setSetting("activate_autodownload",!1),a.setSetting("EditModeActivated",!0),a.setSetting("compactMode",!0),t.widget.getValue("x3dAppId")||t.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOTERME_AP"}),t.widget.addEvent("onPlatformIdChange",function(e,t){"x3dPlatformId"==e&&widget.dispatchEvent("onTenantChange")}),C.setWidgetRefresh(t.onRefresh.bind(t));let _={};_.onRefresh=C.getWidgetRefresh(),_.widgetCBOnPopup=C.onTenantSecurityCTXPopup,I.render(_),t.promiseCtx=new Promise(function(e){C.checkSecurityCTXandTenantInitialization(function(){e()},!0),o.app_initialization(()=>{})}),p.onCurrentTerminologyChange(function(e){t.setTitle(this.getLabel())});var S=A.getWidgetId()+A.getTenantID()+"ENOTERME_AP";if(x.subscribe(S,function(){t.terminologyTree_Cont.refreshTerminologyTreeAndContent()}),p.onTerminologyRename(function(e){e.getID()===u.getCurrentTerminologyID()&&UWA.is(widget)&&t.setTitle(e.getLabel())}),t.setTitle=function(e){var o=A.getTenantID(),n=A.getWidgetPreferenceValue("xPref_CREDENTIAL");t._csName&&t._currentSC===n?t._setTitle(e,o,t._csName):(t._currentSC=n,t._csName=n?n.slice(n.lastIndexOf(".")+1,n.length).trim():"",t._setTitle(e,o,t._csName))},t._setTitle=function(e,o,n){var i=e||"";n&&(i=n+" - "+i),(o="OnPremise"===A.getTenantID()?"":o)&&(i+=" ("+o+")"),t._label=e,widget.setTitle(i)},t._onRefreshTerminology=function(e){var o=!1,n=[];if(c.switchtoAuthoringMode(),UWA.is(e.authored.connected,"array")){var i=u.getCurrentTerminology().getID(),r=e.authored.connected;if(r.length>0)for(var a=0;a<r.length;a++){var l=r[a];if(UWA.is(l,"array")){var s=l[0];if(l.length>1&&n.push(l[1]),s==i){o=!0;break}}}}o&&t.terminologyContent_Cont.loadContentAndSelect(u.getCurrentTerminology(),n)},E.subscribe("TerminologyEditor.refresh",t._onRefreshTerminology.bind(t)),t._commandProxy=r.create({events:{onRefresh:t._onRefreshTerminology.bind(t)}}),null===t.terminologyTree_Cont||void 0===t.terminologyTree_Cont){t.core=e,t.widget.body.empty(),t._buildSkeleton(),N.setContainer("global",this.widget.body.globalLoaderContainer),N.addComponentsToLoad("global",{widget:""});t.widget.addEvent("endEdit",function(){t.widget.getPreferences().forEach(function(e){var o="boolean"===e.type&&UWA.is(e.value,"string")?t.convertToBool(e.value):e.value;t.widget.setValue(e.name,o)})}),t.terminologyGlobal_div=t.widget.body.container,t.terminologyTree_div=t.widget.body.left_side_div,t.terminologySlide_div=t.widget.body.slide_div,t.terminologyTreeDoc_div=t.widget.body.right_side_div,t.terminologyIdCard_div=t.widget.body.top_right_side_div,t.terminologyContent_div=t.widget.body.bottom_right_side_div;var D=t._initializeTerminologyEditorComponent.bind(t);if(null===t.terminologyContent_Cont){var w={x3dAppId:t.widget.getValue("x3dAppId"),lang:t.widget.lang?t.widget.lang:t.widget.getValue("lang"),layout:{view_customization:null,css_view_class:t.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:h};!0===A.getWidgetPreferenceValue("resetCustomization")?(localStorage.removeItem("PADTreeListDefinition."+t.widget.getValue("x3dAppId")+"_"+widget.getValue("x3dPlatformId")),D(w)):b.getContentViewPreference().then(function(e){if(e){var t=e.preference;w.layout.view_customization=t;var o=widget.getValue("vMigration");t&&o!==t.version&&console.log("Terminology migration needed for preferences")}Promise.all([]).then(function(){D(w)})}),t.getSelectedNodes=function(){var e=m.getTempSelection(),t=e||u.getSelectedNodes();if(1===(Array.isArray(t)?t.length:0)){var o=t[0];if(o&&"TerminologySection_Trash"===o.plmType){var n=C.getTrashCont();if(n){var i=n.getSelectedNodes();Array.isArray(i)&&i.length>0&&(t=i)}}}return t},t.getCurrentTerminology=function(){var e=b.getCurrentSecurityContextAndTerminologyData(!0);return JSON.stringify(e)},t.getSecurityContext=function(){var e=b.getTenant();return{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),tenant:e}},t.RefreshView=function(e){var o=!1,n=e.created,i=e.modified,r=e.deleted,a=[],l=[];if(n.forEach(function(e){"Duplicate"===e.operation||"Revise"===e.operation?o=!0:console.log("  unknown operation :",e.operation)}),i.length>0){o=!1;var s={};s.modified=i,C.getContent().getPADTreeDocument().refreshNodeById(s)}r.length>0&&(o=!0,r.forEach(function(e){"Delete"===e.operation&&e.physicalid.length>0&&l.push(e.physicalid)}));for(var d=u.getCurrentTerminology(),c=d.getID(),g=!1,m=0;m<l.length;m++){var p=l[m];if(p===c){g=!0;break}if(d.isExpanded()&&d.hasChildren())for(var h=d.getChildren(),_=0;_<h.length;_++){var S=h[_];S.id===p&&C.getTreeCont().removeFromTree(S)}}if(!0===g){var b=d.getParent();b&&(C.getTreeCont().removeFromTree(d),b.select(!0),o=!1)}else if(l.length>0){var E=d.getType();if(v.inFamilyTerminology(E)&&UWA.is(C.getContent())){for(m=0;m<l.length;m++)C.getContent().removeNodeInContent(l[m]);o=!1}}if(!0===o&&a.length>0)y.AddContent({IDs:a,callbacks:{onComplete:function(e){var o=u.getCurrentTerminology();C.getContent().RefreshProductStructure=!0,t.terminologyContent_Cont.loadContentAndSelect(o,a[0]);var n,i,r="";if(e){var l=JSON.parse(e);n=l.objectsAlreadyPresent,i=l.objectsAdded,r=l.information?" ("+l.information+")":r}0!==n?T.displayNotification({message:f.replace(f.msg_info_Addinterminology,{objectsAlreadyPresent:n,objectsAdded:i,targetterminology:o.getLabel()})+r,className:"success"}):T.displayNotification({message:f.replace(f.msg_info_Addinterminology_1,{objectsAdded:i,targetterminology:o.getLabel()})+r,className:"success"})},onFailure:function(e){e&&e.advice?T.displayNotification({title:f.msg_error_Addinterminology,subtitle:e.advice,message:e.error,className:"error"}):e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500")?T.displayNotification({title:f.msg_error_objectNoLongerAccessible.Title,subtitle:f.msg_error_objectNoLongerAccessible.Advice,message:f.msg_error_objectNoLongerAccessible.Details,className:"error"}):T.displayNotification({message:e?f.msg_error_Addinterminology+"<br>"+e:f.msg_error_Addinterminology,className:"error"})}}});else if(!0===o&&0===a.length){var D=u.getCurrentTerminology();C.getContent().RefreshProductStructure=!0,t.terminologyContent_Cont.loadContentAndSelect(D)}return e},t.beginBlockingTransaction=function(e){require(["DS/UIKIT/Mask"],function(o){o.mask(t.terminologyContent_div,e)})},t.endBlockingTransaction=function(){require(["DS/UIKIT/Mask"],function(e){e.unmask(t.terminologyContent_div)})},t.author=function(e){},t.insertNodes=function(e){var o=[];function n(e){-1===o.indexOf(e.resourceid)&&o.push(e.resourceid)}for(var i in e)e.hasOwnProperty(i)&&e[i].forEach(n);var r=o[0];t._insertOrAdd(r,"insert")},t.addRoots=function(e){if(e.pids.length>0){var o=e.pids[0];t._insertOrAdd(o,"add",!0)}},t._insertOrAdd=function(e,t,o){var n=u.getCurrentTerminology();c.switchtoAuthoringMode();var i=!0;if(null!==n){var r=n.getType();if((v.inFamilyTerminology(r)||"TerminologySection_AllTerminologies"==r)&&(i=!1,UWA.is(C.getContent())&&C.getContent().loadContentAndSelect(n,e,{insertMode:t}),UWA.is(C.getTreeCont()))){var a=n,l="partiallyExpanded"===a.getState();null!==a&&a.isExpanded()&&!l?C.getTreeCont().updateTreeWithNewTerminology(a):n.isExpanded()&&!l||!0!==o||n.expand()}}if(i){var s=[];UWA.is(C.getTreeCont())&&(s=C.getTreeCont()._terminologies_TreeDocument.getRoots()),s.forEach(function(t){"TerminologySection_AllTerminologies"==t.plmType&&(null!==n&&n.unselect(),t.select(),UWA.is(C.getContent())&&C.getContent().loadContentAndSelect(t,e),t.isExpanded()?C.getTreeCont().updateTreeWithNewTerminology(t):o&&t.expand())})}},t.displayNotification=function(e){e&&e.eventID&&"error"===e.eventID&&e.msg&&-1!==e.msg.indexOf(f.msg_error_createNewFromFramework)?T.displayNotification({title:f.replace(f.msg_error_createNew.Title,{type:v.TYPE_FOLDERS_SECTION===u.getCurrentTerminologyID()?f.name_Terminology_type:f.name_Term_type}),subtitle:f.msg_error_createNew.Advice,message:f.msg_error_createNew.Details,className:e.eventID}):T.displayNotification({message:e.msg,className:e.eventID})},t.getPADTreeDocument=function(){return C.getContent()?C.getContent().getPADTreeDocument():this.options.model},t.toggleView=function(e){UWA.is(C.getContent().toggleView)&&C.getContent().toggleView(e)},t.getPADTreeListView=function(){return C.getContent().getPADTreeListView()},t.compactMode=function(e){return C.getContent().compactMode(e)}}}}function R(e){return void 0===widget.getValue(e)||null===widget.getValue(e)}function M(e){console.log(e)}var U=new Promise(function(e){require(["DS/TerminologyEditor/utils/TerminologyEditorUtil"],e)}),F=UWA.extend({widget:null,promiseCtx:null,promiseInit:null,terminologyContent_Cont:null,terminologyTree_div:null,terminologyTreeDoc_div:null,terminologyTree_Cont:null,terminologyIdCard_div:null,terminologyIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,_commandProxy:null,terminologyTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var t=this;this.widget=e.widget,e.launchWithReadMode&&(this.widget.launchWithReadMode=this.widget.readOnly=e.launchWithReadMode),this.widget.terminologyToOpen=e.terminologyToOpen,this.reInitialize=e.reInitialize;var o=null,n={};this.widget=e.widget,this.widget.changeInPreference={},this.widget.refreshDuetoChangeInPreference=!1,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.addEvent("onEdit",function(){o||(o=o||{},t.widget.preferences.forEach(function(e){"hidden"!==e.type&&(o[e.name]=t.widget.getValue(e.name))}))}),this.widget.addEvent("endEdit",function(e){t._manageOpenWith(),!(!e||!e.submitted&&!e.needRefresh)&&o&&(t.widget.changeInPreference={},Object.keys(o).forEach(function(e){if(n[e]=t.widget.getValue(e),o[e]!==n[e]){if("xPref_CREDENTIAL"===e&&n[e])require("DS/TerminologyEditor/service/TerminologyEditorWebService").setPreferredSecurityContext(n[e]);t.widget.changeInPreference[e]=n[e]}}),UWA.log(t.widget.changeInPreference),t.widget.refreshDuetoChangeInPreference=!0,o=null)})},onRefresh:function(e){if(e&&e.reInitialize)this._onReInit();else{if(this.terminologyContent_Cont.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),T.displayNotification({message:f.msg_info_refresh,className:"primary"})}),e&&UWA.is(e.authored.deleted,"array")){var t=u.getCurrentTerminology();t.getID()===e.authored.deleted[0]&&t.getParent().select(!0),c.switchtoAuthoringMode()}var n=C.getFindInCtx();n&&n.visibleFlag&&n.closeViewafterRefresh(),c.updateIconAndSettings(!1),this.terminologyTree_Cont.refreshTerminologyTreeAndContent(),require(["DS/PlatformAPI/PlatformAPI"],function(e){var t=!1;o.getEnforceFolderLinkSettingAsync(function(e,o){e||(t=o)}),(t||C.isCustomizedEnv()||C.isActiveTerminologyActivated())&&e.publish("TerminologyEditor.ActiveTerminologyCheck",{})}),this.widget.refreshDuetoChangeInPreference=!1,this.widget.changeInPreference={}}},setCtxMenu:function(e,t,o){h&&h.showWebInWinCtxMenu(e,t)},insertSelectedSearchObjs:function(e){var o=e[0].split(",");if(t)try{t.getCommand("AddExistingContent")._processInsertOperation(o)}catch(e){console.error("Error trying to execute command","ActiveTerminology",e)}},onClearSelection:function(){},onDestroy:function(){},onResize:function(){var e=this;setTimeout(function(){e.terminologyGlobal_div&&e.terminologyIdCard_Cont&&0!==e.terminologyGlobal_div.clientWidth&&e.terminologyIdCard_Cont.updateDisplayPath()},500);var t=C.getTreeCont();t&&(_.isWidgetMaximized()?t.setOrderToolAreaSelectable(!0):(t.activateTreeFilter(!1),t.setOrderToolAreaSelectable(!1)))},setSupportedTenant:function(){return new Promise((e,t)=>{require(["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],o=>{o.getAppInfo({appId:widget.getValue("x3dAppId")?widget.getValue("x3dAppId"):"ENOTERME_AP",onComplete:function(t){t.platforms.length>0&&widget.setValue("x3dPlatformId",t.platforms[0].id),e()},onFailure:t})})})},onLoad:function(){_.setPCSEntry(widget.id+"_TerminologyWidgetLoad",!0);var e=!0===widget.getValue("noCompass");if(!e){require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()})}this._assignTenantFromX3DContentId();var t=widget.getValue("x3dPlatformId"),o=Promise.resolve();t||e||(o=this.setSupportedTenant()),o.then(this._preLoad.bind(this))},_preLoad:function(){window.top.performance.mark("onLoad_begin");if(R("vMigration")&&R("xPref_CREDENTIAL"))widget.setValue("vMigration",7);else{var e=widget.getValue("vMigration");e=e||0}this._onLoad()},_onReInit:function(){delete F.terminologyTree_Cont,F.terminologyTree_Cont=null,delete F.terminologyContent_Cont,F.terminologyContent_Cont=null,delete F.terminologyIdCard_Cont,F.terminologyIdCard_Cont=null,F.widget.body.container=null,F.terminologyTree_W_NotLinked=!1,p.unsubscribeAll(),F.init({widget:this.widget,reInitialize:!0})},_onLoad:function(){var e=this;this.promiseInit=new Promise(function(t){!0===widget.getValue("noCompass")?p.onTerminologyEditorReadyforWenInWin(function(){t()}):e.widget.addEvent("onTerminologyEditorReady",function(){t()})}),require(["DS/IPClassifyUtil/bsd_utils/BSDConfiguration","text!DS/TerminologyEditor/assets/TerminologyEditorConf.json"],function(t,o){var n=JSON.parse(o);t.mergeConfig(n);var i=[];if(!0!==e.reInitialize){var r=D.initialize({defaultAttributesJSON:"DS/TerminologyEditor/assets/TerminologyEditorColumns.json"});i.push(r)}Promise.all(i).then(function(t){O.apply(e,t[0])})})},_slidderMoveEndCallback:function(){this.terminologyIdCard_Cont&&this.terminologyIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){var e=UWA.createElement("div",{class:"wux-control-inline-container",style:{"vertical-align":"top"}}).inject(this.widget.body),t=new n({identifier:"TerminologyEditor_helpFrame"});t.inject(e),"false"!==A.getUrlParameter("UAPanel")&&i.setPanelHelpMode({immersiveFrame:t}),this.widget.body.container=UWA.createElement("div",{class:"TerminologyEditor_global_container"}).inject(t.getFreeZone(),"top"),this.widget.body.globalLoaderContainer=UWA.createElement("div",{class:"TerminologyEditor_global_loader"}).inject(this.widget.body.container),this.widget.body.left_side_div=UWA.createElement("div",{class:"TerminologyEditor_left_side_div"}).inject(this.widget.body.container),this.widget.body.right_side_div=UWA.createElement("div",{class:"TerminologyEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"TerminologyEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"TerminologyEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div)}},convertToBool:function(e){return"true"===e.toLowerCase()},_assignTenantFromX3DContentId:function(){var e=this.widget.getValue("X3DContentId");if(e){var t=UWA.is(e,"string")?JSON.parse(e):e;if(t.data&&t.data.items&&t.data.items.length>0){var o=t.data.items[0].envId;o&&"OnPremise"!==o&&this.widget.setValue("x3dPlatformId",o)}}},_assignSelectedContentIdFromX3DContentId:function(){var e=widget.getValue("X3DContentId");if(e){var t=UWA.is(e,"string")?JSON.parse(e):e;if(t.data&&t.data.items&&t.data.items.length>0&&t.data.items[0].contentId){var o=t.data.items[0].contentId;this.widget.setValue("x3dSelectedContentId",o)}}},_manageOpenWith:function(){var e=this.widget.getValue("X3DContentId");if(e){var t=UWA.is(e,"string")?JSON.parse(e):e;if(t.data.items.length>0){this._assignTenantFromX3DContentId(),this._assignSelectedContentIdFromX3DContentId();var o=t.data.items[0],n=o.objectType;if("Terminology"==n||"Term"==n||null==n){c.switchtoAuthoringMode();var i=o.objectId,r=C.getTreeCont();this.widget.setValue("X3DContentId",""),r.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[i]},partiallyExpandPath:!0,onComplete:function(){},onGiveUp:M.bind(null," expandTreeAndSelectTerminology:onGiveUp"),onFailure:function(e){T.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})}}}},_initializeTerminologyEditorComponent:function(e){var n=this,i=n.terminologyTree_Cont;n.terminologyTree_Cont||(i=new g({lang:n.widget.lang?n.widget.lang:n.widget.getValue("lang"),css_view_class:n.css_view_class,events:{onReady:function(){if(C.setTreeCont(this),n.terminologyTree_Cont=this,null!==n.terminologyContent_Cont)n.terminologyTree_Cont.setOption("_terminologyContentView",n.terminologyContent_Cont);else{if(!0===n.terminologyTree_W_NotLinked)throw"TerminologyTree are not linked !!!";n.terminologyTree_W_NotLinked=!0}n.terminologyTree_Cont._commonToolSection.inject(this.elements.container,0),n._manageOpenWith(),!0===widget.getValue("noCompass")?p.notifyTerminologyEditorReady():n.widget.dispatchEvent("onTerminologyEditorReady")}}}));var r,a=n._retrieveinitializationOpts(),l=UWA.extend(e,a);(r=[]).length&&(l.additionalColumnsModules=r),new s(l,i),n.promiseInit.then(()=>{if(n.terminologyTree_Cont){n.terminologyTree_Cont._doScrolltotheSavedPosition(),_.setPCSEntry(widget.id+"_TerminologyWidgetLoad",!1),_.sendPCSTracketPageEvent("TerminologyWidget_Performance","TerminologyWidgetLoad",widget.id+"_TerminologyWidgetLoad");var e=window.top.performance.getEntriesByName("createWidget_begin");e&&e.length>0&&window.top.performance.mark("createWidget_end"),setTimeout(()=>{var e=!1;if(o.getEnforceFolderLinkSettingAsync(function(t,o){t||(e=o)}),e||C.isCustomizedEnv()||C.isActiveTerminologyActivated())try{var n=t.getCommand("ActiveTerminology",C.getContent());n&&n.begin()}catch(e){console.error("Error trying to execute command","ActiveTerminology",e)}})}}),n._keyboardListener||(n._keyboardListener=new S,n._keyboardListener.startObservingKeyboard())},_viewChanged:function(){w.getModelEvents().publish({event:"ENOTerm/AttributesCustomization/columnSwitchDone",data:{}})},_retrieveinitializationOpts:function(){var e=this;return{renderTo:e.terminologyContent_div,events:{onActionBarReadyToBuild:function(){e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.terminologyIdCard_Cont&&new d({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,events:{onReady:function(){e.terminologyIdCard_Cont=this,e.terminologyIdCard_Cont.render().inject(e.terminologyIdCard_div)}}})},onReady:function(){if(e.terminologyContent_Cont=this,e.addEvent=e.terminologyContent_Cont.addEvent.bind(e.terminologyContent_Cont),null!==e.terminologyTree_Cont)e.terminologyTree_Cont.setOption("_terminologyContentView",e.terminologyContent_Cont);else{if(!0===e.terminologyTree_W_NotLinked)throw"TerminologyTree are not linked !!!";e.terminologyTree_W_NotLinked=!0}e.terminologyContent_Cont.options.renderTo&&e.terminologyContent_Cont.render().inject(e.terminologyContent_Cont.options.renderTo),e.promiseInit.then(function(){if(e.terminologyTree_Cont){e.terminologyContent_Cont._OnPADComponentReady();var t=e.terminologyContent_Cont.getPADTreeListView();if(t&&e.terminologyTree_Cont.modeChange({viewMode:t.options.viewMode}),e.widget.dispatchEvent("onTerminologyComponentReady"),1==e.widget.launchWithReadMode&&e.widget.terminologyToOpen){var o=e.widget.terminologyToOpen;e.terminologyTree_Cont.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[o]},partiallyExpandPath:!0,onComplete:M.bind(null," expandTreeAndSelectTerminology:onComplete"),onGiveUp:M.bind(null," expandTreeAndSelectTerminology:onGiveUp"),onFailure:function(e){T.displayNotification({message:e instanceof Error?e.message:e,className:"error"})}})}}}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(t){if(!0===widget.getValue("noCompass")){var o;const n=function(n){clearTimeout(o),o=setTimeout(function(){var o=e.terminologyContent_Cont.getPADTreeDocument().getXSO().get(),n=[];o.forEach(function(e){n.push(e.getID())}),t.publish("onObjectSelected",n);var i=[];o.forEach(function(e){var t={id:e.getID(),label:e.getLabel(),type:e.options.type,cadMaster:e.options.grid["ds6w:cadMaster"],kind:e.options.grid["ds6w:kind"],contentStructure:e.options.grid["ds6w:contentStructure"]};i.push(t)}),t.publish("selectedObjectsInContent",i)},n)};e.terminologyContent_Cont.getPADTreeDocument().getXSO().onChange(function(){n(20)})}})},onCustoViewChange:function(t){U.then(function(o){o.setContentViewPreference(t,!1).then(e._viewChanged.bind(e))})},onSaveAsTemplate:function(t){U.then(function(o){o.setContentViewPreference(t,!0).then(e._viewChanged.bind(e))})},onToggleView:function(){m.updateCommands()}}}}});return F}),define("DS/TerminologyEditor/service/TerminologyEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/IPClassifyUtil/bsd_utils/BSDGlobalUtils","UWA/Utils/Client","text!DS/TerminologyEditor/assets/TerminologyEditorCmds.json"],function(e,t,o,n,i,r,a,l,s){"use strict";function d(e){return UWA.is(e,"array")?e.toString():e}var c=function(){var e=n.getWidgetValue("appId");return(e=e||n.getWidgetValue("x3dAppId"))+"-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},g={createCSRF:{url:"/resources/v1/application/CSRF",method:"GET"},fetch:{url:"/cvservlet/fetch/v2",method:"POST"},getContent:{url:"/resources/v1/TerminologyManagement/Terminologies/{pid}/getContent",method:"POST"},createBS:{url:"/resources/v1/modeler/dsbsd/dsbsd:BrowsingStructure",method:"POST"},createBN:{url:"/resources/v1/modeler/dsbsd/dsbsd:BrowsingNode",method:"POST"},navigate:{url:"/cvservlet/navigate",method:"POST"},setSecurityCtx:{url:"/resources/pno/person/setsecuritycontext",method:"POST"}};return{searchInTerminology:function(e){var t={};UWA.extend(t,e);var r=null;if(e.pid){if(Array.isArray(e.pid)&&e.pid.length>200)return void t.onFailure("warning",{error:{errorCode:"innerError",errorMessage:o.msg_warning_LimitInCtxSearchOnAllTerminologies}});if(e.searchQuery&&e.searchQuery.length<2)return void t.onFailure("warning",{error:{errorCode:"innerError",errorMessage:o.replace(o.SearchEnterMoreThan,{minNumber:2})}});var a="TerminologySection_AllTerminologies"===e.type?e.searchQuery:e.searchQuery+" AND NOT(physicalid:"+e.pid+")",l=i.get3DSearchUrl()+"/search",s=widget.lang?widget.lang:widget.getValue("lang");t.payload=Object.assign({},i.getSearchInfo());let u=i.getResultsCount();u&&(t.payload.nresults=u),t.payload.locale=s,t.payload.query=a,t.payload.tenant=n.getTenantID(),t.payload.next_start=void 0,t.payload.start=void 0,t.payload.source=["3dspace"],t.payload.select_predicate=i.getIndexPredicates(),t.payload.label=c(),e.order_field&&(t.payload.order_field=e.order_field,t.payload.order_by=e.order_by);var d="ctx::"+widget.getValue("xPref_CREDENTIAL");d&&(t.payload.login={"3dspace":{SecurityContext:d}}),"TerminologySection_AllTerminologies"===e.type?t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Term","Terminology"]}}}}:t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Term","Terminology"]}}}},t.filters&&(t.payload.refine=t.filters);var g=i.getInfoIndex();null!=g?t.payload.next_start=g.next_start:t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s},t.type="json",t.data=UWA.Json.encode(t.payload),t.withoutSC=!0,t.timeout=12e4,r=this._executeRequest(l,t,"searchInTerminology")}return r},loadThumbnails:function(e){return e.fetchThumbnails=!0,this.fetch(e)},get3DSpaceUrl:function(){let e=n.get3DSpaceUrl();return"OnPremise"!==widget.getValue("x3dPlatformId")&&(e=e.replace("ifwe","space").replace("3DSpace","enovia")),e},fetch:function(e){var t={};UWA.extend(t,e);var o=e.ids,i=g.fetch.url,r=null;if(o.length){var l=this.get3DSpaceUrl()+i,s=n.getLanguage(),d={physicalid:o,label:c()};t.fetchThumbnails&&(d.select_file=["thumbnail_2d"]),t.select_predicate&&(d.select_predicate=t.select_predicate),t.query={tenant:e.tenant},t.method=g.fetch.method,t.headers={Accept:"application/json","content-type":"application/json",SecurityToken:a.getUserLogin()+"|ctx::"+widget.getValue("xPref_CREDENTIAL")+"|"+n.getLanguage(),"Accept-Language":s},t.type="json",t.data=UWA.Json.encode(d),t.withoutSC=!0,r=this._executeRequest(l,t,"loadThumbnails")}return r},content:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=i+g.getContent.url.replace("{pid}",e.pid);return o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},o.payload={isRoot:!1,level:e.hasOwnProperty("level")?e.level:1,type:e.type,detailed:!0},o.data=UWA.Json.encode(o.payload),o.method=g.getContent.method,o.timeout=12e4,t._executeRequest(l,o,"content")},onFailure:function(e){}},i)},roots:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(e){var r=JSON.parse(e).csrf.value,a=i+g.getContent.url.replace("{pid}","Root");return o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:r},o.payload={isRoot:!0,level:1,detailed:!0},o.data=UWA.Json.encode(o.payload),o.method=g.getContent.method,o.timeout=12e4,t._executeRequest(a,o,"TerminologyEditor_getRoots")},onFailure:function(e){}},i)},createTerminologie:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=i+g.createBS.url;return o.method=g.createBS.method,o.timeout=12e4,o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},o.payload={items:[{attributes:{title:e.title,description:e.description,name:e.title}}]},o.data=UWA.Json.encode(o.payload),t._executeRequest(l,o,"TerminologyEditor_createTerminology")},onFailure:function(e){}},i)},createTerm:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=i+g.createBN.url;return o.method=g.createBN.method,o.timeout=12e4,o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},o.payload={parentID:e.parentID,items:[{attributes:{title:e.title,description:e.description,name:e.title}}]},o.data=UWA.Json.encode(o.payload),t._executeRequest(l,o,"TerminologyEditor_createTerminology")},onFailure:function(e){}},i)},createCSRFTokens:function(e,t){var o=e,n=t+g.createCSRF.url;o.method=g.createCSRF.method,this._executeRequest(n,o,"FolderActive-createCSRFToken")},allTerminologies:function(e){return e.start||(e.start=0),e.fetchAll=!0,e.noIcon=!0,this._performSearchQuery(e,"(type:Terminology)","allTerminologies")},getRootsFromChildren:function(e){(!e.ids||e.ids.length<=0)&&e.onFailure(),this._performNavigateQueryToRoot(e,"getRootsFromChildren")},_performSearchQuery:function(e,t){var o={};UWA.extend(o,e);var r=i.get3DSearchUrl()+"/search";o.payload=Object.assign({},i.getSearchInfo()),o.select_predicate?o.payload.select_predicate=o.select_predicate:o.payload.select_predicate=o.payload.select_predicate;var a=new Date,l=Math.random().toString(36).substring(2,11);o.payload.label=("TerminologyWidgetSearch_"+l+"_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var s=widget.lang?widget.lang:widget.getValue("lang");o.payload.locale=s,o.payload.query=t,o.payload.tenant=n.getTenantID(),o.payload.next_start=e.next_start,o.payload.start=e.start,e.noIcon&&(o.payload.select_file=void 0),o.payload.source=["3dspace"];var d="ctx::"+widget.getValue("xPref_CREDENTIAL");return d&&(o.payload.login={"3dspace":{SecurityContext:d}}),o.method="POST",o.headers={"content-type":"application/json"},o.withoutSC=!0,o.type="json",e.order_field&&(o.payload.order_field=e.order_field,o.payload.order_by=e.order_by),e.searchPageCount&&(o.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(o.payload.nresults=1e3),o.filters&&(o.payload.refine=o.filters),o.data=UWA.Json.encode(o.payload),this._executeRequest(r,o,"searchInLibrary")},_performNavigateQueryToRoot:function(e){var t={};UWA.extend(t,e);var o="ctx::"+widget.getValue("xPref_CREDENTIAL"),n=this.get3DSpaceUrl()+g.navigate.url;n+="?SecurityContext="+o;t.payload={},t.payload.input_physical_ids=e.ids,t.payload.primitives=[{navigate_from_rel:{id:1,filter:{rel_type:["Terminology","Term"]}}}],t.payload.patterns={WORKSPACE:[{id:1,iter:-1}]},t.payload.patternTypeFilters={typesToReturn:["Term"]},t.payload.attributes=e.select_predicate,t.payload.version=3;var i=new Date;return t.payload.label=("TerminologyWidgetNavigate_"+i.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method=g.navigate.method,t.headers={"content-type":"application/json"},t.type="json",t.withoutSC=!0,t.withoutTenant=!0,t.headers.SecurityContext="ctx::"+widget.getValue("xPref_CREDENTIAL"),t.data=UWA.Json.encode(t.payload),this._executeRequest(n,t,"searchInLibrary")},getTerminologyPathsforItem:function(e){var t={};UWA.extend(t,e);var o=this.get3DSpaceUrl()+"/cvservlet/navigate",i=widget.lang?widget.lang:widget.getValue("lang");t.payload={},t.payload.locale=i,t.payload.order_by="asc",t.payload.order_field="ds6w:label",t.payload.tenant=n.getTenantID(),t.query={SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),tenant:n.getTenantID()},t.payload.input_physical_ids=e.id,t.payload.attributes=["ds6w:label","ds6w:type"],t.payload.version=3,t.payload.primitives=[{navigate_from_rel:{id:1,filter:{bo_type:["Terminology","Term"]}}}],t.payload.patterns={GET_PARENT:[{id:1,iter:-1}]},t.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},t.payload.attributes=["ds6w:label","ds6w:type"],t.payload.source=["3dspace"];var r=new Date;return t.payload.label=("terminologyWidgetNavigate_"+r.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.payload.start=0,t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":i},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(o,t,"getTerminologyPathsforItem")},_findTerminologiesInTerminology:function(e){var t={};UWA.extend(t,e);var o=i.get3DSearchUrl()+"/search",r=widget.lang?widget.lang:widget.getValue("lang");t.payload={},t.payload.locale=r,e.searchFTSquery&&(t.payload.query=e.searchFTSquery),e.rscIdToSearch&&(t.payload.query="physicalid:"+e.rscIdToSearch),t.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"TerminologySection_AllTerminologies"===e.type?t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Terminology","Term"]}}}}:t.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Terminology","Term"]}}}},t.payload.nresults=100,t.payload.source=["3dspace"];var a=new Date;return t.payload.label=("_findTerminologiesInTerminology"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.timeout=12e4,t.method="POST",t.payload.tenant=n.getTenantID(),t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":r,SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(o,t,"_findTerminologiesInTerminology")},getToolbar:function(e){return new Promise(e=>{e(JSON.parse(s))})},setPreferredSecurityContext:function(e,t){var o=null,i=new Promise((i,r)=>{o=n.get3DSpaceUrlAsync({onComplete:n=>{var a=t||{};"OnPremise"!==widget.getValue("x3dPlatformId")&&(n=n.replace("ifwe","space").replace("3DSpace","enovia"));var l=n+g.setSecurityCtx.url;a.query={SecurityContext:e},a.method=g.setSecurityCtx.method,a.withoutSC=!0,(o=this._executeQuery(l,a,"commands")).then(i).catch(r)}})});return i.cancel=(()=>{o&&o.cancel()}),i},terminologies:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/terminologies";t.query={Level:t.level},t.method="GET",this._executeRequest(o,t,"terminologies")},terminologyTree:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=i;if(e.isRoot){var s=e.hasOwnProperty("level")?e.level:1;l+=g.getContent.url.replace("{pid}","Root"),o.payload={expandList:e.expandList,isRoot:!0,level:s,detailed:1==s},o.data=UWA.Json.encode(o.payload),o.method=g.getContent.method}else l+=g.getContent.url.replace("{pid}",e.pid),o.payload={expandList:e.expandList,isRoot:!1,level:e.hasOwnProperty("level")?e.level:1,type:e.type,detailed:!1},o.data=UWA.Json.encode(o.payload),o.method=g.getContent.method;return o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},o.timeout=12e4,t._executeRequest(l,o,"terminologyTree")},onFailure:function(e){}},i)},removecontent:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/removecontent";t.headers={"content-type":"application/json"},t.IDs&&(t.data={IDs:d(t.IDs)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"removeContent")},removecontentsearchwithin:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/removecontent";t.headers={"content-type":"application/json"},t.objectID&&t.terminologyIDs&&(t.data={ObjectID:d(t.objectID),TerminologyIDs:d(t.terminologyIDs)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"removecontentsearchwithin")},replaceContent:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/replacebycontent";t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:d(t.IDsRemoved),IDsAdded:d(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,this._executeRequest(o,t,"replaceContent")},addcontent:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/content";if(t.headers={"content-type":"application/json"},t.IDs){var n=this._deduplicateContentId(t.IDs);t.data={IDs:d(n)},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"addContent")},movecontent:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/content";t.headers={"content-type":"application/json"},t.IDs&&t.SourceTerminologyId&&(t.data={IDs:d(t.IDs),SourceTerminologyId:t.SourceTerminologyId},t.data=UWA.Json.encode(t.data)),t.method="PUT",t.timeout=12e4,this._executeRequest(o,t,"moveContent")},checkCopyterminology:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology";t.headers={"content-type":"application/json"},t.PhysicalId&&(o+="/checkCount",t.data={physicalIds:d(t.PhysicalId)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"copyTerminology")},copyterminology:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminologies/duplicateStructure";t.headers={"content-type":"application/json"},t.TargetPhysicalId&&t.PhysicalId&&(t.data={sourcePhysicalId:"",targetPhysicalId:t.TargetPhysicalId,physicalIds:t.PhysicalId},e.hasOwnProperty("withContent")&&(t.data.withContent=e.withContent),t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"copyTerminology")},getTerminologyProperties:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminologies/"+t.pid+"/properties";t.method="GET",this._executeRequest(o,t,"getTerminologyProperties")},getContentProperties:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/ContentProperties";t.method="POST",t.payload={},t.payload.select_predicate=i.getAuthAttributes(),t.headers={"content-type":"application/json"},t.data=UWA.Json.encode(t.payload),this._executeRequest(o,t,"getContentProperties")},setTerminologyProperties:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=i;return"Terminology"===e.type?l+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingStructure/"+o.pid+"?$mask=dsbsd:BsdMask.Details":"Term"===e.type&&(l+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingNode/"+o.pid+"?$mask=dsbsd:BsdMask.Details"),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},o.method="PATCH",o.data=UWA.Json.encode(o.properties),t._executeRequest(l,o,"setTerminologyProperties")},onFailure:function(e){}},i)},moveterminology:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminologies/changeRelationship";t.headers={"content-type":"application/json"},t.method="POST",t.timeout=12e4,t.TargetPhysicalId&&t.PhysicalId&&t.SourcePhysicalId&&(o+="/"+t.TargetPhysicalId,t.data={sourcePhysicalId:t.SourcePhysicalId,physicalIds:d(t.PhysicalId),targetPhysicalId:t.TargetPhysicalId},t.data=UWA.Json.encode(t.data)),this._executeRequest(o,t,"moveTerminology")},getTerminologyPath:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/path";t.headers={"content-type":"application/json"},t.pids&&(t.data={terminologyIds:d(t.pids)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(o,t,"getTerminologyPath")},deleteTerminology:function(e){var t=this,o=e,i=this.get3DSpaceUrl();this.createCSRFTokens({onComplete:function(r){var a=JSON.parse(r).csrf.value,l=i;return"Terminology"===e.type?l+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingStructure/"+e.pid:"Term"===e.type&&(l+="/resources/v1/modeler/dsbsd/dsbsd:BrowsingNode/"+e.pid),o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage(),SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),ENO_CSRF_TOKEN:a},o.method="DELETE",o.timeout=12e4,t._executeRequest(l,o,"deleteTerminology")},onFailure:function(e){}},i)},personSearch:function(e){var t=e,o=this.get3DSpaceUrl()+"/resources/v2/e6w/service/PersonSearch";t.query={searchStr:t.name},t.method="GET",this._executeRequest(o,t,"personSearch")},getUserPreferences:function(e){var t=e,o=this,i=null;return i=n.getCompassUrlAsync({onComplete:function(e){var n=e+"/resources/AppsMngt/user/getPreferences";t.query={name:t.name},t.method="GET",t.headers={Accept:"application/json",SecurityContext:void 0},t.withoutTenant=!0;var r=o._executeRequest(n,t,"getUserPreferences");i?i.cancel=r.cancel:i=r}})},setUserPreferences:function(e){this.saveUserPreferences(e)},saveUserPreferences:function(e){var t=this,o=e;this._lastPrefToSave||(this._lastPrefToSave={}),this._lastPrefToSave[e.name]=e,this._lastRequests||(this._lastRequests={}),this._lastRequests[e.name]&&this._lastRequests[e.name].cancel(),this._lastRequests[e.name]=null,n.getCompassUrlAsync({onComplete:function(n){var i=t._lastPrefToSave[e.name];if(i){var r=n+"/resources/AppsMngt/user/preference";o.method="PUT",o.headers={Accept:"application/json",SecurityContext:void 0,"Content-Type":"application/x-www-form-urlencoded"},o.data={name:i.name,value:i.value},o.withoutTenant=!0,t._lastRequests[e.name]&&t._lastRequests[e.name].cancel(),t._lastRequests[e.name]=t._executeRequest(r,o,"saveUserPreferences"),delete t._lastPrefToSave[e.name]}}})},_deduplicateContentId:function(e){var t=[],o=[];return null!=e&&Array.isArray(e)&&e.forEach(function(e){o.indexOf(e)<0&&(o.push(e),t.push(e))}),t},_executeQuery:function(e,t,o){var n=null,i=new Promise((i,r)=>{t.onTimeout=r,t.onFailure=r,t.onComplete=i,n=this._executeRequest(e,t,o)});return i.cancel=n?n.cancel:()=>{},i},_executeRequest:function(e,i,r){var a=Math.round(1e3*Math.random()).toString(),l=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("terminologyRequest_begin"+a);var s={};UWA.extend(s,i),UWA.is(s.onTimeout,"function")||(s.onTimeout=function(){var e={type:"timeout",toString:function(){return o.msg_InfoAction_Timeout}};s.onFailure(e)},s.onComplete=function(e){window.top.performance.mark("terminologyRequest_end"+a);var t=window.top.performance.getEntriesByName("terminologyRequest_begin"+a);t&&1===t.length&&(window.top.performance.measure(l+"_Request"+r,"terminologyRequest_begin"+a,"terminologyRequest_end"+a),window.top.performance.clearMarks("terminologyRequest_end"+a),window.top.performance.clearMarks("terminologyRequest_begin"+a)),i.onComplete&&i.onComplete(e)});var d={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};i.withoutSC||(d.SecurityContext=encodeURIComponent("ctx::"+widget.getValue("xPref_CREDENTIAL"))),i.headers?s.headers=UWA.extend(d,i.headers):s.headers=d,UWA.is(s.query)||(s.query={}),s.query.tenant||!0===i.withoutTenant||(s.query.tenant=n.getTenantID());var c=e;return 0!==Object.keys(s.query).length&&(c+=(e.indexOf("?")<0?"?":"&")+UWA.Utils.toQueryString(s.query)),t.authenticatedRequest(c,s)}}}),define("DS/TerminologyEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/bsd_utils/BSDSelLevel","DS/TerminologyEditor/Terminology_CSO","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i){})},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/IPClassifyUtil/bsd_utils/BSDSelLevel"),o=require("DS/TerminologyEditor/Terminology_CSO"),n=require("i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"),i=require("DS/TerminologyEditor/utils/TerminologyEditorcontrol").getContent().getSelectedNodes(),r=null;r=o.getCurrentTerminology(),i.length?new t({events:{onApply:function(e){i.forEach(function(t){null===t.options.children||t.expandNLevels({numberOfLevelsToExpand:parseInt(e),initialLevel:t.getNodeDepth()})})}}}):null===r?e.displayNotification({message:n.msg_warning_noselection,className:"warning"}):new t({events:{onApply:function(e){r.expand({expandLevel:parseInt(e),clearLast:!0,initialLevel:r.getNodeDepth()})}}})},endExecute:function(){}})}),define("DS/TerminologyEditor/utils/TerminologyLoaderGlobal",["UWA/Class","DS/Controls/Loader","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o){function n(e){console.log("%c"+e,"color: orange")}return e.singleton({init:function(){this.container={global:null,contentView:null},this.loader={global:new t({height:35}),contentView:new t({height:35})},this.counter={global:0,contentView:0},this.displayedMessages={global:0,contentView:0}},setContainer:function(e,t){this.container.hasOwnProperty(e)?(this.container[e]=t,this.loader[e].inject(t)):n('The type of loader "'+e+'" is not defined.')},addComponentsToLoad:function(e,t){var i,r,a=UWA.clone(this.counter);if(this.loader.hasOwnProperty(e)){for(var l in t)this.displayedMessages.hasOwnProperty(l)&&this.removeComponentToLoad(e,l),i=l[0].toUpperCase()+l.substring(1)+"_Loading",r=null!=o[i]?o[i]:t[l],this.loader[e].on(r),this.displayedMessages[l]=r,this.counter[e]++,this.displayedMessages[e]++;a[e]>=0&&this._show(this.container[e])}else n('The type of loader "'+e+'" is not defined.')},removeComponentToLoad:function(e,t){this.loader.hasOwnProperty(e)?this.displayedMessages.hasOwnProperty(e)?(this.loader[e].off(this.displayedMessages[t]),delete this.displayedMessages[t],this.counter[e]--,this.displayedMessages[e]--,this.displayedMessages[e]=this.displayedMessages[e]>0?this.displayedMessages[e]:0,this.counter[t]--,this.counter[t]=this.counter[t]>0?this.counter[t]:0,this.counter[e]=this.counter[e]>0?this.counter[e]:0,0==this.counter[e]&&this._hide(this.container[e])):(console.log("loaderType :  "+this.counter[e]+"  key:  "+this.counter[t]),n('The "'+t+'" message is not displayed on the loader.')):n("The type of loader "+e+" is not defined.")},_show:function(e){e.style.display="flex"},_hide:function(e){e.style.display="none"}})}),define("DS/TerminologyEditor/utils/TerminologyEditorDataConversion",[],function(){return{getObjectIdsFromSearchRes:function(e){var t=[];return e&&e.forEach(function(e){if(!e||!e.attributes||e.attributes.length<=0);else for(var o=0;o<e.attributes.length;++o)"physicalid"==e.attributes[o].name&&t.push(e.attributes[o].value)}),t},getParChildrenMapFromNavRes:function(e){var t={};return!e||!e.result||e.result.length<=0?t:(e.result.forEach(function(e){if(e&&e.input_object){var o=e.input_object.physicalid,n=o;e.outputs&&e.outputs.WORKSPACE&&e.outputs.WORKSPACE.length>0&&(n=e.outputs.WORKSPACE[0].physicalid),t[n]?t[n].push(o):t[n]=[o]}}),t)}}}),define("DS/TerminologyEditor/views/xTermInitError",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Options"],function(e,t,o){"use strict";return t.extend(o,{init:function(e){this._parent(e),this.elements.container=UWA.createElement("div",{class:"pad_error_all"}),this.elements.errormsg=UWA.createElement("span",{class:"pad_error_msg"}),this.elements.errormsg.innerHTML=e.msg,this.elements.errormsg.inject(this.elements.container)},render:function(){return this}})}),define("DS/TerminologyEditor/views/TerminologyCreationDialog",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/ModalContainer","DS/Controls/Button","DS/Controls/LineEditor","i18n!DS/TerminologyEditor/assets/nls/CreateTermDialog"],function(e,t,o,n,i,r){"use strict";var a=function(e){if(void 0===e.container||null===e.container)throw new Error(r.error.invalidFrame);if(void 0===e.callbacks.onYesCallback)throw new Error(r.error.missingcallback);if(void 0===e.type||"Terminology"!==e.type&&"Term"!==e.type)throw new Error(r.error.invalidType);this._parentContainer=e.container,this._type=e.type,this._dialog=void 0,this._modal=void 0,this._callbacks=e.callbacks,this.createDialog()};return a.prototype.constructor=a,a.prototype.getDialog=function(){return this._dialog},a.prototype.createDialog=function(){this._immersiveFrame=new t,this._immersiveFrame.getContent().addClassName("terminologyCreationDialog_frame");var i=this.createContent();this.yesButton=new n({label:r.buttons.create,disabled:!0,allowUnsafeHTMLLabel:!1}),this.yesButton.addEventListener("buttonclick",this.onYesCallback.bind(this),!1),this.cancelButton=new n({label:r.buttons.cancel,disabled:!1,allowUnsafeHTMLLabel:!1}),this.cancelButton.addEventListener("buttonclick",this.onClose.bind(this),!1),this._dialog=new e({immersiveFrame:this._immersiveFrame,title:"Term"===this._type?r.title.termCreation:r.title.terminologyCreation,content:i,activeFlag:!1,resizableFlag:!0,width:this._parentContainer.getSize().width/2,height:"fit-content",buttons:{Yes:this.yesButton,Cancel:this.cancelButton}}),this._dialog.addEventListener("close",this.onClose.bind(this),!1),this._modal=o.createModal(this._parentContainer,this._immersiveFrame.getContent())},a.prototype.onClose=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null,o.removeModal(this._parentContainer),this._callbacks.onClose()},a.prototype.onYesCallback=function(){this._dialog.destroy(),this._dialog=null,delete this._immersiveFrame,this._immersiveFrame=null;var e={title:this.titleOption.value,description:this.descriptionOption.value};o.removeModal(this._parentContainer),this._callbacks.onYesCallback(e),this._callbacks.onClose()},a.prototype.createContent=function(){var e=this,t=UWA.createElement("div",{class:"termCreationOptionsView_content"});new UWA.Element("span",{text:r.options.title}).inject(t);this.titleOption=new i({placeholder:r.options.titleMessage,requiredFlag:!0,pattern:"\\s*\\S+[\\S+\\s*]*",sizeInCharNumber:100}),this.titleOption.inject(t),this.titleOption.addEventListener("change",function(){e.yesButton.disabled=!1}),this.titleOption.addEventListener("validFlagChange",function(){0==e.titleOption.valueToCommit.trim().length?e.yesButton.disabled=!0:e.yesButton.disabled=!1});new UWA.Element("span",{text:r.options.description}).inject(t);return this.descriptionOption=new i({placeholder:r.options.descMessage,requiredFlag:!1,sizeInCharNumber:100}),this.descriptionOption.inject(t),t},a}),define("DS/TerminologyEditor/popup/AddMovePopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","i18n!DS/TerminologyEditor/assets/nls/AddMovePopup"],function(e,t,o,n,i,r,a){return e.extend({init:function(e){this._parent(e),this.buildSkeleton(e),this.buttonGroup=null},buildSkeleton:function(e){var l=new r,s=UWA.createElement("div",{class:"addMove-commonContent"}),d=UWA.createElement("div",{class:"addMove-Label"});d.innerText=a.operationToPerform,d.inject(s);var c=this.buttonGroup=new o({type:"radio"});c.addChild(new t({type:"radio",label:a.Add,value:"copy",checkFlag:!0})),c.addChild(new t({type:"radio",label:a.Move,value:"move"})),c.inject(s);var g=a.replace(a.get("msg_Title"),{number:e.objectValues.noOfObjects,terminologyName:e.objectValues.targetTerminology}),u=new i({immersiveFrame:l,title:g,content:s,activeFlag:!1,modalFlag:!0,resizableFlag:!0,height:150,width:400,buttons:{Ok:new n({onClick:function(t){t.preventDefault(),t.stopPropagation();var o=c.getContent().dsModel.value[0];e.callback(o),u.immersiveFrame.getContent().destroy(),u.destroy()}}),Cancel:new n({onClick:function(){e.callback("none"),u.immersiveFrame.getContent().destroy(),u.destroy()}})}});u.getContent().addClassName("bookmark_AddMovePopUp"),u.addEventListener("close",function(t){e.callback("none"),u.immersiveFrame.getContent().destroy(),u.destroy()}),l.inject(widget.body)}})}),define("DS/TerminologyEditor/utils/TerminologyCommunication",["DS/PlatformAPI/PlatformAPI"],function(e){"use strict";return{publish:function(t,o,n){e.publish(t,o),!1!==n&&e.publish("webinwin:web:notification",JSON.stringify({event:t,content:o}))},subscribe:function(t,o,n){var i=window,r=function(){if(i===top||i.parent)return o.apply(this,arguments);throw new Exception("widget has been destroyed")};e.subscribe(t,r),!1!==n&&e.subscribe("webinwin:win:notification",function(e){"string"==typeof e&&(e=JSON.parse(e)),e&&e.event===t&&r(e.content)})}}}),define("DS/TerminologyEditor/Terminology_Clipboard",["UWA/Class"],function(e){"use strict";return e.singleton({name:"terminology_clipboard",_currentTerminology:null,_currentSelectedNodes:null,_Mode:null,_IsEmpty:!0,_IsExternalDrop:!0,init:function(e){this._parent(e)},addInTerminologyClipboard:function(e,t,o){if(!UWA.is(t))throw new Error("No terminologyNode specified");if(!UWA.is(e))throw new Error("No selected nodes specified");o=o.toUpperCase(),this._Mode=o,this._IsEmpty=!1,this._currentTerminology=t,this._currentSelectedNodes=UWA.extend([],e)},IsEmpty:function(){return this._IsEmpty},ClearClipboard:function(){this._IsEmpty=!0},getTreeNode:function(){return this._currentTerminology},getSelectedNodes:function(){return this._currentSelectedNodes},getMode:function(){return this._Mode},SetAsExternalDrop:function(e){this._IsExternalDrop=e},IsExternalDrop:function(){return this._IsExternalDrop}})}),define("DS/TerminologyEditor/service/TerminologyTypeService",["UWA/Controls/Abstract"],function(e){return e.singleton({TYPE_BROWSING_STRUCTURE:"Browsing Structure",TYPE_TERMINOLOGY:"Terminology",TYPE_BROWSING_NODE:"Browsing Node",TYPE_TERM:"Term",TYPE_SECTION:"TerminologySection_AllTerminologies",init:function(){},isTerminology:function(e){return e===this.TYPE_BROWSING_STRUCTURE||e===this.TYPE_TERMINOLOGY},isTerm:function(e){return e===this.TYPE_BROWSING_NODE||e===this.TYPE_TERM},inFamilyTerminology:function(e){return this.isTerminology(e)||this.isTerm(e)},isSection:function(e){return e===this.TYPE_SECTION},isAllTerminologiesSection:function(e){return e===this.TYPE_SECTION}})}),define("DS/TerminologyEditor/utils/ColorUtil",["UWA/Class"],function(e){return e.singleton({colorMap:{},active:!1,setMapColor:function(e){this.colorMap=e},setActive:function(e){this.active=e},isActive:function(){return this.active},getCellKPIColor:function(e){var t=null;if(this.isActive()){var o=e.nodeModel.getID(),n=this.colorMap[o];t=n||"transparent"}return t}})}),define("DS/TerminologyEditor/views/ViewLoader",["UWA/Class","UWA/Promise"],function(e,t){"use strict";var o={graphview:"graphview",tileview:"tileview",thumbnailview:"thumbnailview",datagridview:"datagridview"};Object.freeze(o);var n=["onDragOverGraph","onDropBlankGraph","onDragLeaveGraph"],i=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],r=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"],a=["onDragEnterBlank","onDragOverBlank","onDragEndBlank","onDragLeaveBlank","onDropBlank","onDragStartCell","onDragEnterCell","onDragOverCell","onDragEndCell","onDragLeaveCell","onDropCell","onDragEnterColumnHeader","onDragOverColumnHeader","onDragEndColumnHeader","onDragLeaveColumnHeader","onDropColumnHeader","onDragStartColumnHeader"];return e.extend({init:function(e){this.options=e},loadView:function(e,t){var o=this;this.options.component.options.views[e]?t():this.buildOptions(e,t).then(function(n){o.requireView(e,n,t)})},requireView:function(e,t,n){var i=this,r=this.options.amd[e],a=function(){i.postLoad(e),n&&n()};require([r],function(n){var r=i.options.component;r.options.views[e]=new n(t),e===o.datagridview?r.options.views[e].initialize().then(function(){a()}):a()})},postLoad:function(e){var t=this.options.component;switch(t.options.views[e].isActiveView=t.options.active_view===e,e){case o.graphview:var n=!1;t.options.views.graphview.isActiveView&&(n=!0,t.options.views.graphview.setModel(t.options.model)),t.setDnD_onGraph(),t.options.isReady.graphview=!0,n&&t.options.views.graphview.reframeAll();break;case o.thumbnailview:t.options.views.thumbnailview.isActiveView&&t.options.views.thumbnailview.setModel(t.options.model),t.options.isReady.thumbnailview=!0;break;case o.datagridview:t.options.views.datagridview.isActiveView&&t.options.views.datagridview.setModel(t.options.model),t.options.isReady.datagridview=!0;break;case o.tileview:t.options.views.tileview.isActiveView&&t.options.views.tileview.setModel(t.options.model),t.options.isReady.tileview=!0}t.options.model.applyActiveView(e)},buildOptions:function(e,t){switch(e){case o.graphview:return this._buildGraphViewOptions();case o.tileview:return this._buildTileViewOptions();case o.thumbnailview:return this._buildThumbnailViewOptions();case o.datagridview:return this._builddatagridViewOptions();default:throw new Error("Invalid View Trying to load")}},mapCallbacks:function(e,t){var o=t,n={};return e.forEach(function(e){UWA.is(o.options.views_cb[e],"function")?n[e]=o.options.views_cb[e]:UWA.is(o[e],"function")&&(n[e]=o[e].bind(o))}),n},_buildGraphViewOptions:function(){var e=this;return new t(function(t,o){var i=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:i};r.active_view=UWA.clone(i.options.active_view),r.isActiveView="graphview"===r.active_view;var a=e.mapCallbacks(n,i);r=UWA.extend(r,a,!0),UWA.is(i.getOnContextualEvent)&&(r.onContextualEvent=i.getOnContextualEvent()),t(r)})},_buildTileViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,r={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:n};r.active_view=UWA.clone(n.options.active_view),r.isActiveView="tileview"===r.active_view;var a=e.mapCallbacks(i,n);r=UWA.extend(r,a,!0),UWA.is(n.getOnContextualEvent)&&(r.onContextualEvent=n.getOnContextualEvent()),t(r)})},_buildThumbnailViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="thumbnailview"===i.active_view;var a=e.mapCallbacks(r,n);i=UWA.extend(i,a,!0),UWA.is(n.getOnContextualEvent)&&(i.onContextualEvent=n.getOnContextualEvent()),t(i)})},_builddatagridViewOptions:function(){var e=this;return new t(function(t,o){var n=e.options.component,i={x3dAppId:e.options.x3dAppId,renderTo:e.options.renderTo,context:n};i.active_view=UWA.clone(n.options.active_view),i.isActiveView="datagridview"===i.active_view,i.view_customization=n.options.layout.view_customization,i.callbacks=e.mapCallbacks(a,n),n.options.additionalColumnsModules&&(i.additionalColumnsModules=n.options.additionalColumnsModules),t(i)})}})}),define("DS/TerminologyEditor/models/xTermNodeModel",["DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt"],function(e,t,o){"use strict";function n(e){e._getFilterInfo||(e._getFilterInfo=r.prototype._getFilterInfo.bind(e),e._getChildrenFilterInfo=r.prototype._getChildrenFilterInfo.bind(e),e._removeChildrenFilterInfo=r.prototype._removeChildrenFilterInfo.bind(e),e.filterInChild=r.prototype.filterInChild.bind(e),e.filterOutChild=r.prototype.filterOutChild.bind(e))}var i={label:"",icons:[],grid:{},padgrid:{},resourceid:"",type:"",plmType:"",relationid:"",relationtype:"",relationOrder:-1,did:"",relcount:null,isPADHidden:!1,padstate:"collapsed",children:[],thumbnail:null,useAsyncPreExpand:!0,emptyStatusbarVisibleFlag:!0,contextualMenu:[{type:"SeparatorItem"}]};function r(o){this.options=UWA.clone(i),this.options.grid.bi_color="rgba(0, 0, 0, 0)",o&&o.grid&&(this.options.subLabel=o.grid["ds6w:responsible"],this.options.description=o.grid["ds6w:identifier"],this.options.thumbnail=o.thumbnail?o.thumbnail:t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o&&UWA.is(o.relcount)&&0===o.relcount&&(o.children=null),this.options=UWA.extend(this.options,o),e.call(this,this.options)}r.prototype=Object.create(e.prototype);var a={getType:function(){return this.plmType},getOccurencePath:function(e){if(UWA.is(e,"function")&&e(this),!this.isRoot()&&this.getParent()){var t=this.getParent().getOccurencePath(e);return t.push(this.options.relationid),t.push(this.options.resourceid),t}return[this.options.resourceid]},getOccurencePathWithType:function(){if(!this.isRoot()&&this.getParent()){var e=this.getParent().getOccurencePathWithType();return e.push({resourceid:this.options.relationid,type:this.options.relationtype}),e.push({resourceid:this.options.resourceid,type:this.options.type}),e}return[{resourceid:this.options.resourceid,type:this.options.type}]},getNodeByPath:function(e,t,o,n){if(("number"!=typeof t||t<0)&&(t=0),("number"!=typeof o||o<0||o>=e.length)&&(o=e.length-1),this.options.resourceid instanceof Array&&this.options.resourceid.indexOf(e[t])>=0||this.options.resourceid===e[t]){if(t!==o&&(this.isExpanded()||this.childComputed||void 0!==n&&!1!==n)){var i=e[t+1],r=this.getChildren();if(r&&0!==r.length){for(var a=null,l=0;l<r.length&&null===a;l++){var s=r[l];i===s.options.relationid&&(a=s)}return null===a?this:a.getNodeByPath(e,t+2,o,n)}return this}return this}},getID:function(){return this.options.resourceid},getRelationID:function(){return!0===this.isRelationsObjectNode?null:this.options.relationid},getNodesById:function(e){var t={listOfFoundNodes:[]};return this._getNodesById(e,t),t.listOfFoundNodes},getChildByIds:function(e,t){var o,n=this.getChildren();if(n)for(var i=0;i<n.length;i++)if(void 0===e){if(n[i].getID()===t){o=n[i];break}}else if(n[i].getRelationID()===e){o=n[i];break}function r(o){var n;return void 0===e?o.getID()===t&&(n=o):o.getRelationID()===e&&(n=o),n}if(void 0===o&&void 0!==this.options._childrenFilterInfo&&this.options._childrenFilterInfo.filteredOutChildren&&this.options._childrenFilterInfo.filteredOutChildren.length>0)for(var a=this.options._childrenFilterInfo.filteredOutChildren,l=0;l<a.length;l++){var s=a[l];if(o=r(s))break;var d=s.getChildren();if(d)for(var c=0;c<d.length&&!(o=r(d[c]));c++);}return o},_removeFilterInfo:function(){delete this.options._filterInfo},_removeChildrenFilterInfo:function(){delete this.options._childrenFilterInfo},_getFilterInfo:function(e){return!this.options._filterInfo&&Boolean(e)&&(this.options._filterInfo={}),this.options._filterInfo},_getChildrenFilterInfo:function(e){return!this.options._childrenFilterInfo&&Boolean(e)&&(this.options._childrenFilterInfo={}),this.options._childrenFilterInfo},filterOut:function(){var e=this.isRoot()?this.getTreeDocument():this.getParent();null!==e&&(n(e),e.filterOutChild(this))},filterIn:function(e){var t=this._getFilterInfo();if(t&&t.parentBeforeFiltering){var o=t.parentBeforeFiltering;n(o),o.filterInChild(this)}if(Boolean(e)){var i,r=this._getChildrenFilterInfo();(i=r&&r.childrenBeforeFiltering?r.childrenBeforeFiltering:this.getChildren())&&i.forEach(function(t){t.filterIn(e)})}},filterOutChild:function(e){var t=this.getChildren();if(t.indexOf(e)<0)throw"Not a child";var o=this._getChildrenFilterInfo(!0);if(!o.childrenBeforeFiltering){o.childrenBeforeFiltering=t&&t.length>0?t.slice(0):[];UWA.is(this._expandState)&&(o.expandStateBeforeFiltering={noExpandState:"noChildren",expandingState:"expanding",partiallyExpandedState:"partiallyExpanded",collapseState:"expanded",expandState:"collapsed"}[this._expandState])}e._getFilterInfo(!0).parentBeforeFiltering=this,UWA.is(this.removeChild,"function")?this.removeChild(e):this.removeRoot(e,!0,!0),UWA.is(this.setState,"function")&&this.setState({state:o.expandStateBeforeFiltering}),o.filteredOutChildren||(o.filteredOutChildren=[]),o.filteredOutChildren.push(e)},filterInChild:function(e){var t=this._getChildrenFilterInfo();if(t){var o=t.childrenBeforeFiltering;if(o){var n=o.indexOf(e);if(n>=0){var i=e._getFilterInfo();if(i&&i.parentBeforeFiltering===this){var r,a=this.getChildren();if(a)for(var l=0;l<a.length;l++){var s=a[l];if(o.indexOf(s)>n){r=s;break}}delete i.parentBeforeFiltering,this.insertBefore(e,r),UWA.is(this.setState,"function")&&this.setState({state:t.expandStateBeforeFiltering}),e._removeFilterInfo();var d=t.filteredOutChildren.indexOf(e);t.filteredOutChildren.splice(d,1),0===t.filteredOutChildren.length&&this._removeChildrenFilterInfo()}}}}},_getNodesById:function(e,t){var o=!1;if(this.getID()===e)t.listOfFoundNodes.push(this),o=!0;else{var n=this.getChildren();if(n)for(var i=0;n&&i<n.length;i++)o=n[i]._getNodesById(e,t)||o}return o},updateAttributes:function(e,t){if(!UWA.is(e,"array")||!UWA.is(t,"array"))throw new Error("Invalid argument(s)");var n=t,i=t.tree?t.tree:o.getTreeColumn(),r={};e.forEach(function(e){UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\\n/g," ")),"ds6w:type"===e.name&&(r.type=e.value,this.plmType=e.value),e.name===i?r.label=e.value:"type_icon_url"===e.name?(r.icons=[],r.icons.push(e.value)):"preview_url"===e.name||"thumbnail_2d"===e.name?(r.thumbnail=e.value,r.grid=r.grid?r.grid:{},r.grid.thumbnail="url("+e.value+")"):-1!==n.indexOf(e.name)&&(r.grid||(r.grid={}),r.grid[e.name]=e.value)}),this.updateOptions(r)},isDescendantOf:function(e){var t;if(t=e instanceof r?e.getID():e,this.getID()===t)return!0;if(!this.isRoot()){var o=this.getParent();if(o)return o.isDescendantOf(t)}return!1},getDepth:function(){for(var e=this,t=0;!e.isRoot();)e=e.getParent(),t++;return t},getLeaves:function(){var e=[];return this.processDescendants({processNode:function(){!1===this.hasChildren()&&e.push(this)}}),e},getAttribute:function(e){var t;return this.options.grid[e]&&(t=this.options.grid[e]),t},updateOptions:function(o){o.grid&&(this.options.thumbnail||o.thumbnail||(o.thumbnail=t.getWebappsAssetUrl("PADUtils","icons/32/I_DefaultThumbnail.png")),o.subLabel=o.grid["ds6w:responsible"]?o.grid["ds6w:responsible"]:this.options.grid&&this.options.grid["ds6w:responsible"]?this.options.grid["ds6w:responsible"]:"",o.description=o.grid["ds6w:identifier"]?o.grid["ds6w:identifier"]:this.options.grid&&this.options.grid["ds6w:identifier"]?this.options.grid["ds6w:identifier"]:""),e.prototype.updateOptions.call(this,o)},childValidationChecker:function(){if(void 0===this.childValidationCheckerToken){this.childValidationCheckerToken=null;var e=this;this.childValidationCheckerToken=this.addEventListener("expandStateChange",function(t){"expanded"===t.data.state&&(e.removeEventListener(e.childValidationCheckerToken),e.withTransactionUpdate(function(){var t=e.getChildren().filter(function(e){return!0===e.options.waiting4validation});if(t.length>0)for(var o=0;o<t.length;o++)console.warn("NavNodeModel# Remove node to the unvalidated child "+JSON.stringify(t[o].getOccurencePath())),e.removeChild(t[o])}))})}}};for(var l in a)r.prototype[l]=a[l];return r}),define("DS/TerminologyEditor/utils/TerminologyEditorManageSecurityContextCustomization",["UWA/Core","UWA/Class","DS/Logger/Logger"],function(e,t,o){"use strict";var n=o.getLogger("DS/TerminologyEditor/utils/TerminologyEditorManageSecurityContextCustomization");return t.singleton({name:"TerminologyEditorManageSecurityContextCustomization",init:function(e){this._parent(e),this._isSecurityContextComputedByOpening=" "},adaptSecurityContextToCurrentTerminology:function(e){if(e&&this._isSecurityContextComputedByOpening){var t=[],o=widget.getPreference("xPref_CREDENTIAL");if(o){var i=o.options;Array.isArray(i)?i.forEach(function(e){e.value&&t.push(e.value)}):n.warn("The widget has no options for xPref_CREDENTIAL preference")}else n.warn("The widget has no xPref_CREDENTIAL preference");t.length>0&&console.log("tests removing T.E.Openness"),n.warn('SecurityContext "undefined" returned by TerminologyEditorOpenness is not valid')}}})}),define("DS/TerminologyEditor/views/TerminologyWebInWinTaggerProxy",["DS/SNResultUX/webinwin/WebInWinTaggerProxy","UWA/Core","DS/Core/ModelEvents"],function(e,t,o){"use strict";return e.extend(o,{init:function(e){e.proxyId=e.widgetId+"LibraryEditor_WebInWin",this._parent.call(this,e)},_dispatchEvent:function(e){if(!t.is(e,"object")||!t.is(e.notif_name)||void 0===e.notif_parameters)throw console.log("E_INVALIDARG, expect to have parameters.notif_name arg & parameters.notif_parameters in _dispathTowin !!!"),"No parameters.notif_name arg & parameters.notif_parameters given to _dispathTowin method !";console.log("ResultWebInWin._dispathTowin for "+e.notif_name);var o=t.is(e.notif_parameters,"string")?e.notif_parameters:JSON.stringify(e.notif_parameters);"undefined"!=typeof dscef&&dscef.sendString(e.notif_name+"="+o)}})}),define("DS/TerminologyEditor/utils/TerminologyEditorcontrol",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/bsd_utils/BSDSettingsMgt","UWA/Controls/Abstract","DS/IPClassifyUXUtil/PlatformCredSelector","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r){return n.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_isDebugMode:!1,_treeFilter:null,_actionBar:null,_findInCtx:null,_onWidgetRefresh:null,init:function(){this.checkRolesAvailability()},getContent:function(){return this._Content},getTreeCont:function(){return this._TreeCont},getIdCardCont:function(){return this._IdCardCont},getTrashCont:function(){return this._TrashCont},getTreeFilter:function(){return this._treeFilter},getActionBar:function(){return this._actionBar},getFindInCtx:function(){return this._findInCtx},getWidgetRefresh:function(){return this._onWidgetRefresh},setContent:function(e){this._Content=e},setTreeCont:function(e){this._TreeCont=e},setIdCardCont:function(e){this._IdCardCont=e},setTrashCont:function(e){this._TrashCont=e},setTreeFilter:function(e){this._treeFilter=e},setActionBar:function(e){this._actionBar=e},setFindInCtx:function(e){this._findInCtx=e},setWidgetRefresh:function(e){this._onWidgetRefresh=e},getActiveTerminology:function(){return{origin:widget.id,id:void 0!==this._activeTerminologyId?this._activeTerminologyId:null,label:this._activeTerminologyLabel,sc:this._activeTerminologySc,disabledId:this._activeTerminologyDisabledId}},setActiveTerminology:function(e,t,o,n){this._activeTerminologyId=e,this._activeTerminologyLabel=t,this._activeTerminologySc=o,this._activeTerminologyDisabledId=n},isDebugMode:function(){return this._isDebugMode},setDebugMode:function(e){this._isDebugMode=e},isCustomizedEnv:function(){return void 0===this._isCustomizedEnv&&(this._isCustomizedEnv=!1),this._isCustomizedEnv},isActiveTerminologyActivated:function(){return void 0===this._isActiveTerminologyActivated&&(this._isActiveTerminologyActivated=!1),this._isActiveTerminologyActivated},isImportCSVActivated:function(){return void 0===this._isImportCSVActivated&&(this._isImportCSVActivated=!1),this._isImportCSVActivated},checkRolesAvailability:function(t){var o=this;void 0===o._isPAUroleAvailable||void 0===o._isPARroleAvailable||void 0===o._isCSVroleAvailable?e.getGrantedRoles(function(e){o._isPAUroleAvailable=!1,o._isPARroleAvailable=!1,o._isCSVroleAvailable=!1;for(var n=0;n<e.length;n++){var i=e[n]?e[n].id:"";"CSV"===i?o._isCSVroleAvailable=!0:"PAU"===i||"CDR"===i||"EXL"===i||"InternalDS"===i?(o._isPAUroleAvailable=!0,o._isCSVroleAvailable=!0):"PAR"===i&&(o._isPARroleAvailable=!0,o._isCSVroleAvailable=!0)}t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)}):t&&t(o._isPAUroleAvailable,o._isPARroleAvailable,o._isCSVroleAvailable)},checkSecurityCTXandTenantInitialization:function(e,n){var r=this;require(["DS/IPClassifyUXUtil/CredentialsView"],function(a){if("function"==typeof e){function l(){r._isSecurityCTXInitialized&&(!0===n||r._isTenantInitialized)&&e.call()}if(void 0===r._isSecurityCTXInitialized){var s=a.getCredential();r._isSecurityCTXInitialized=!!s||void 0,r._isSecurityCTXInitialized||o.addEventOnce("onPad_security_ctx",function(e){r._isSecurityCTXInitialized=!!e,l()})}if(!0!==n&&void 0===r._isTenantInitialized){var d=t.getTenantID();let e=!1;if(e="OnPremise"!==d&&e){r.onTenantSecurityCTXPopup();let t={};t.onRefresh=r.getWidgetRefresh(),i.render(e,t)}r._isTenantInitialized=!!d,r._isTenantInitialized||widget.addEventOnce("onTenantChange",function(e){r._isTenantInitialized=!!e||void 0,l()})}l()}})},onTenantSecurityCTXPopup:function(){r.removeComponentToLoad("global","widget")},getPlaceholder:function(){return new Promise(function(e){require(["DS/TerminologyEditor/views/TerminologyPlaceHolder"],function(t){e(new t)})})},getMapforPreferenceRefresh:function(){return new Map([["activateBIFilter",1],["useIndexAcceleration",1],["activateTXO",1],["activateDGV",1],["drag-and-drop",0]])}})}),define("DS/TerminologyEditor/commands/tools/ColumnCustomization",["UWA/Core","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","text!DS/TerminologyEditor/assets/TerminologyEditorColumns.json"],function(e,t,o,n,i){"use strict";var r=JSON.parse(i).allowedIndexAttributes,a=null;return{execute:function(){require(["DS/IPClassifyColumnCusto/IPClassifyColumnCusto","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/IPClassifyUtil/bsd_utils/BSDDictionaryMgt","DS/TerminologyEditor/utils/TerminologyEditorUtil"],function(i,l,s,d,c,g){for(var u=l.getModelEvents(),m=[],p=d.getContent().getPADTreeListView(),h=p.options.dgvLayout.getOrderedColumnsIndexes(),f=0;f<h.length;f++){var y=p.options.dgv.getColumnOrGroup(h[f]);"defaultSort"!==y.dataIndex&&(y.attrDBName||y.customisation&&y.customisation.layout&&(y.customisation.layout.removable=!1),m.push(y))}var v=p?p.options.viewMode:parameters.tree.options.viewMode,T=!!p,_=p?p.options.dgvLayout.rowsHeader:void 0;p&&(p.columnOrdering=!0),a=new i({modelEvents:u,viewMode:v,appColumns:m,manageAttrFromInstance:!1,baseInstanceTypes:[],selectedTypes:s.getSelectedTypes(),selectedExtensions:s.getSelectedExtensions(),withDgv:T,dgvInfo:p,rowHeaderActivated:_,dbOnlyAttributes:!0,classificationAttributes:!0,allowedIndexAttributes:r,defaultAttributes:r,supportedIndexAttrs:["ds6w:docExtension"]});var C=[];C.push(u.subscribe({event:"ENOTerm/AttributesCustomization/columnSwitchDone"},function(){a.options.dgvInfo.columnOrdering=!0})),C.push(u.subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(i){switch(i.what){case"addRemoveColumns":if(i.removedColumns&&p&&p.removeColumnCB(i.removedColumns),i.addedColumns){var r=e.clone(g.filterDBOnlyAttrs(i.addedColumns)),a=r.filter(function(e){return p.options.dgv.getColumnOrGroup(e.dataIndex)});p&&a.length>0&&p.changeDBAttributeCB(a),r=r.filter(function(e){return!p.options.dgv.getColumnOrGroup(e.dataIndex)}),p&&r.length>0&&p.addColumnCB(r)}break;case"visibilityColumn":p&&p.changeVisibilityCB(i.modifiedColumn,i.visibilityFlag);break;case"moveColumn":p&&p.moveColumnCB(i);break;case"changeTitle":if(p){for(var l=[],d=0;d<i.newTitle.length;d++)i.newTitle.charCodeAt(d)>255&&l.indexOf(i.newTitle[d])<0&&l.push(i.newTitle[d]);0===l.length?p.changeTitleCB(i.modifiedColumn,i.newTitle):o.displayNotification({title:n.msg_error_forbiddenChar.Title,subtitle:n.replace(n.msg_error_forbiddenChar.Advice,{badChars:l.join(", ")}),className:"error"})}break;case"pinChange":p.changePinCB(i.modifiedColumn,i.pin);break;case"rowsHeaderModification":p.changeDgvLayout({rowsHeader:i.rowsHeader});break;case"exportColumn":p.changeExportCB(i.modifiedColumn,i.exportFlag);break;case"changeViewMode":p&&p.compactMode(i);var c=t.getTreeCont();c&&c.modeChange(i);break;case"close":i.selectedExtensions&&i.selectedTypes&&s.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),p&&p.saveCustoView(i.applyOnlyToThisApp),C.forEach(function(e){u.unsubscribe(e)});break;case"reset":s.resetSelectedParams(),p.reset(i.parameters),C.forEach(function(e){u.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+i.what)}}))})},endExecute:function(){},_getColumnCusto:function(){return a}}}),define("DS/TerminologyEditor/utils/TerminologySearch",["UWA/Class","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/IPClassifyUtil/IPClassifyModelEvents","DS/WidgetServices/WidgetServices","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r){"use strict";var a={tree:"ds6w:label"};return e.singleton({init:function(e){this._parent(e),this._currentSearch=null,this._searchInfo=null,this._indexInfo=null,this._lListener=[],this._lListenerResult=[],this._refine=null,this._originTerminology=null,this._previousViewCommand=null,this._3DSearchUrl=null,this._defaultPredicates=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:identifier","ds6w:classification","icon_2ddefaultthb.subtype","relcount","taxonomies","ds6w:kind","ds6w:contentStructure","ds6w:cadMaster"],this._attrPredicateMap=new Map,this._predAttrMapDefault=[["ds6w:label",null],["physicalid",null],["mxid",null],["ds6w:type",null],["ds6w:identifier",null],["ds6w:classification",null],["icon_2ddefaultthb.subtype",null],["relcount",null],["taxonomies",null]],this._predAttrMap=new Map(this._predAttrMapDefault);this._searchInfo={with_indexing_date:!0,select_predicate:UWA.clone(this._defaultPredicates),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25},this.get3DSearchUrl(),this._facets=null,this._refine=null,o.getModelEvents().subscribe({event:"search_cleared"},this.clearSearch.bind(this))},setNumberResults:function(e){this._searchInfo.nresults=e},setPreviousView:function(e){this._previousViewCommand=e},getPreviousView:function(){return this._previousViewCommand},get3DSearchUrl:function(){if(null!=this._3DSearchUrl)return this._3DSearchUrl;var e=this;n.get3DSearchUrlAsync({onComplete:function(t){if(""!=t)return"OnPremise"!==widget.getValue("x3dPlatformId")&&(t=t.replace("ifwe","fedsearch").replace("3DSearch","federated")),e._3DSearchUrl=t,e._3DSearchUrl}})},setPredicates:function(e){var t=this;t._attrPredicateMap.clear(),this._predAttrMap=new Map(this._predAttrMapDefault),Array.isArray(e)&&e.forEach(function(e){var o=e.ds6w;o||(o=e.dataIndex);var n=null;if(e.attrDBName)for(var i in n=e.attrDBName)t._attrPredicateMap.set(n[i],o);t._predAttrMap.set(o,n)}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},addPredicates:function(e){var t=this;Array.isArray(e)&&e.forEach(function(e){var o=null;if(e.attrDBName)for(var n in o=e.attrDBName)t._attrPredicateMap.set(o[n],e.dataIndex);t._predAttrMap.set(e.dataIndex,o)}),this._searchInfo.select_predicate=Array.from(t._predAttrMap.keys())},removePredicates:function(e){for(var t=0;t<e.length;++t)if(this._predAttrMap.delete(e[t].dataIndex),e[t].attrDBName){var o=e[t].attrDBName;for(var n in o)this._attrPredicateMap.delete(o[n])}this._searchInfo.select_predicate=Array.from(this._predAttrMap.keys())},getAuthAttributes:function(){var e=Array.from(this._predAttrMap.values());return e=e.filter(function(e){return null!=e}),[].concat.apply([],e)},getIndexPredicates:function(){return Array.from(this._searchInfo.select_predicate)},getAttrPredicateMap:function(){return this._attrPredicateMap},onSearchChange:function(e){"function"==typeof e&&this._lListener.push(e)},onSearchResult:function(e){"function"==typeof e&&this._lListenerResult.push(e)},_notifyChange:function(e){if(this.isSearchActive()||e){var t=this;e||(e=t._currentSearch),this._lListener.forEach(function(e){e.call(null,t._currentSearch)})}},changeSortField:function(e,t){var o=this._getDS6WFromColumnIndex(e),n=this._getColumnPredicate(o);if(!n||!n.startsWith("ds6w"))return{message:i.get("msg_info_SortNonAvailable"),className:"primary"};this._searchInfo.order_field!==n&&(this._searchInfo.order_field=n,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeOrderSort:function(e,t){null!=e&&this._searchInfo.order_by!=e&&(this._searchInfo.order_by=e,this.setInfoIndex(null,!1)),t&&this._notifyChange()},changeSearch:function(e){if(""===e&&(e=null),this._currentSearch!==e||!e){this.setInfoIndex(null,!e);var t=this._currentSearch;this._currentSearch=e,this._notifyChange(t),e&&r.sendTrackerPageEvent("TerminologyWidget_iconBar","Search")}},columnIsAvailable:function(e){return null!=this._getColumnPredicate(e)},_getColumnPredicate:function(e){var t=this._getDS6WFromColumnIndex(e),o=this.getSearchInfo().select_predicate.indexOf(t)>=0?t:null;return o=!o&&this.getSearchInfo().select_predicate.indexOf(t)>=0?t.toLowerCase():o},_getDS6WFromColumnIndex:function(e){var t=a[e];return t||(t=e),t},getSearchInfo:function(){return this._searchInfo},setInfoIndex:function(e,t){var n=this;if(this._indexInfo=e,!1!==t){if(this._lListenerResult.forEach(function(t){t.call(n,e)}),e){var i=require("DS/TerminologyEditor/Terminology_CSO").getCurrentTerminology().getLabel();e.objectName=i;var r=this.getDateLastIndexation();e.lastIndexation=r}o.getModelEvents().publish({event:"searchUpdated",data:e})}},resetInfoIndex:function(){this._indexInfo=null},getOrderFieldForTree:function(){var e=this.getOrderField();for(var t in a)a[t]===e&&(e=t);return e},getOrderField:function(){return this.getSearchInfo()?this.getSearchInfo().order_field:null},getOrderBy:function(){return this.getSearchInfo()?this.getSearchInfo().order_by:null},getInfoIndex:function(){return this._indexInfo},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},getNumberHits:function(){return this._indexInfo?this._indexInfo.nhits:0},getDateLastIndexation:function(){var e=null,t=this.getInfoIndex();if(t&&t.sources){var o=null;t.sources.forEach(function(e){if(e.indexingDate)var t=e.indexingDate;for(var n in t)t[n]&&-1!==t[n]&&(o?t[n]<o&&(o=t[n]):o=t[n])}),o&&(e=new Date(1e3*o))}return e},setRefine:function(e){var t=this.getRefine();JSON.stringify(t)!==JSON.stringify(e)&&(this._searchInfo.refine=e,this.setInfoIndex(null,!1),this._notifyChange())},getRefine:function(){return this._searchInfo.refine},clearRefine:function(){delete this._searchInfo.refine},isSearchActive:function(){return!!this.getSearchValue()},isSearchInProgress:function(){return!!this._indexInfo&&!!this._currentSearch},getSearchValue:function(){return this._currentSearch},getOriginTerminology:function(){return this._originTerminology},setOriginTerminology:function(e){this._originTerminology=e},clearSearch:function(){this.changeSearch("",!0)},getResultsCount:function(){let e=t.getContent();if(e){let t=e.getGridViewRowHeight(),o=e.getContentHeight();if(t&&o)return Math.ceil(o/t)+10}return 0},getSearchTags:function(){return this._facets},setSearchTags:function(e){this._facets=e},setRefineTags:function(e){this._refine=e},getRefineTags:function(){return this._refine}})}),define("DS/TerminologyEditor/utils/TerminologyEditorEvents",["UWA/Class","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyCommunication","DS/TerminologyEditor/service/TerminologyTypeService"],function(e,t,o,n){return e.singleton({EVT_CURRENT_FOLDER_CHANGE:"/FOLDER_EDITOR/CURRENTFOLDER_CHANGE",EVT_NODEMODEL_MODIFY:"/FOLDER_EDITOR/NODEMODEL_MODIFY",EVT_TREEFILTER_CHANGE:"/FOLDER_EDITOR/EVT_TREEFILTER_CHANGE",EVT_TAGGER_STATUS_CHANGE:"/FOLDER_EDITOR/EVT_TAGGER_STATUS_CHANGE",EVT_CURRENT_FOLDER_COLUMN_CHANGE:"/LIBRARY_EDITOR/CURRENT_LIBRARY_COLUMN_CHANGE",EVT_FOLDER_EDIOTR_READY:"onTerminologyEditorReady",_modelEvents:null,init:function(e){this._parent(e),this._modelEvents=t.getModelEvents()},createTerminologyForPublication:function(e,t){var o=e,i={From:"TerminologyEditor",TerminologyID:null,TerminologyLabel:null,TerminologyType:null,IsInDeletedItems:!1,Timestamp:Date.now()};return o&&(n.inFamilyTerminology(o.plmType)||t)&&(i.TerminologyID=o.getID(),i.TerminologyLabel=o.getLabel(),i.TerminologyType=o.getType()),o&&"TerminologySection_Trash"===o.plmType&&(i.IsInDeletedItems=!0),i},notifyTerminologyRename:function(e){if(!UWA.is(e,"array"))throw new Error("input parameter should be array");var t=this;e.forEach(function(e){var n=t.createTerminologyForPublication(e);o.publish("TerminologyEditor.TerminologyUpdated",JSON.stringify(n),!0),t._modelEvents.publish({event:t.EVT_NODEMODEL_MODIFY,context:e,data:e})})},notifyTerminologyLoadingEnd:function(e){if(!UWA.is(e))throw new Error("input parameter should be a TreeNodeModel");this._modelEvents.publish({event:this.EVT_FOLDER_LOADINGEND,context:e,data:e})},onTerminologyLoadingEnd:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_LOADINGEND},e)},onTerminologyRename:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_NODEMODEL_MODIFY},e)},notifyCurrentTerminologyChange:function(e){if(!UWA.is(e,"object"))throw new Error("input parameter should be object");if(!e.currentNode)throw new Error("input object should have currentNode");this._modelEvents.publish({event:this.EVT_CURRENT_FOLDER_CHANGE,context:e.currentNode,data:e})},onCurrentTerminologyChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_FOLDER_CHANGE},e)},notifyCurrentTerminologyColumnChange:function(){this._modelEvents.publish({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE})},onCurrentTerminologyColumnChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_CURRENT_FOLDER_COLUMN_CHANGE},e)},notifyTerminologyEditorReady:function(){this._modelEvents.publish({event:this.EVT_FOLDER_EDIOTR_READY})},onTerminologyEditorReadyforWenInWin:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_FOLDER_EDIOTR_READY},e)},notifyTreeFilterChange:function(e){this._modelEvents.publish({event:this.EVT_TREEFILTER_CHANGE,data:e})},onTreeFilterChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_TREEFILTER_CHANGE},e)},notifyTaggerStatusChange:function(){this._modelEvents.publish({event:this.EVT_TAGGER_STATUS_CHANGE})},onTaggerStatusChange:function(e){if(!UWA.is(e,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:this.EVT_TAGGER_STATUS_CHANGE},e)},subscribeEvents:function(){var e=this;return this._modelEvents.subscribe({event:"welcome-panel-collapse"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"left"})}),this._modelEvents.subscribe({event:"welcome-panel-expand"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"left"})}),this._modelEvents.subscribe({event:"information-panel-close"},function(){e._modelEvents.publish({event:"triptych-hide-panel",data:"right"})}),this._modelEvents.subscribe({event:"information-panel-open"},function(){e._modelEvents.publish({event:"triptych-show-panel",data:"right"})}),this._modelEvents},subEvent:function(e,t){if(!UWA.is(t,"function"))throw new Error("input parameter should be function");this._modelEvents.subscribe({event:e},t)},leftPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},leftPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},rightPanelOpen:function(e){this.subEvent("triptych-show-panel",e)},rightPanelClose:function(e){this.subEvent("triptych-hide-panel",e)},unsubscribeAll:function(){this._modelEvents.unsubscribeAll()}})}),define("DS/TerminologyEditor/Terminology_CSO",["UWA/Core","DS/Selection/XSO","DS/Logger/Logger","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorManageSecurityContextCustomization"],function(e,t,o,n,i,r,a,l){"use strict";var s=function(e){var t="";if(e){var o=e.plmType;t="Term"==o?"Term":"Terminology"==o?"Terminology":o}return t},d=t.singleton({name:"terminology_cso",_logger:null,_currentTerminology:null,init:function(e){var t={areEquals:function(e,t){return e===t}};UWA.extend(t,e),this._parent(t),this._logger=o.getLogger(d);var n=this;this.onPostAdd(function(e){var t="CONTENT";UWA.is(e,"array")&&(e=e[0]),e&&UWA.is(e.getID,"function")&&e.getID()==n.getCurrentTerminologyID()&&(t="TREE"),UWA.is(e)&&n._modelEvents.publish({event:"FOLDER_CSO/SELECT",data:{context:t,selectedNode:e}})}),r.onTerminologyRename(function(e){if(n._currentTerminologyPath){var t=e.getID(),o=e.getLabel(),i=n.getCurrentTerminologyID();n._currentTerminologyPath.forEach(function(e){e.id===t&&(e.label=o)}),t===i&&a.getIdCardCont().setCurrentLocation()}})},addInTerminologyCSO:function(e,t){if(!UWA.is(e))throw new Error("No terminologyNode specified");if(!UWA.is(t))throw new Error("No context specified");if("TREE"==(t=t.toUpperCase())){var o=this;this.empty(!1);var d=this._currentTerminology;this._currentTerminology=e;var c=function(e,t){n.inFamilyTerminology(t.plmType)&&t.id&&a.isCustomizedEnv()&&l.adaptSecurityContextToCurrentTerminology(t.id),r.notifyCurrentTerminologyChange({previousNode:e,currentNode:t}),o.add(t)};this._currentTerminologyPath=[{id:e.id,type:s(e),label:e.getLabel(),mxid:e.options.mxid}];var g=!1;if(n.inFamilyTerminology(e.plmType)){if(e.isVisible&&e.isVisible()&&e.getPath){var u=e.getPath();if(Array.isArray(u)&&u.length>=2&&u[0]&&"TerminologySection_AllTerminologies"===u[0].plmType){this._currentTerminologyPath=[];for(var m=1;m<u.length;m++){var p=u[m];this._currentTerminologyPath.push({id:p.id,type:s(p),label:p.getLabel(),mxid:p.options.mxid})}g=!0}}}else g=!0;g?c(d,e):i.getTerminologyPath({pids:[e.id],onComplete:function(t){var n=(t=JSON.parse(t))[e.id],i=n?n.length:0;!n&&t.error&&(o._logger.warn("Unable to retrieve TerminologyPath using WebService"),c(d,o._currentTerminology)),i>=1&&n[i-1]?o._currentTerminology&&n[i-1].id==o._currentTerminology.id?(o._currentTerminologyPath=[],n.forEach(function(e){o._currentTerminologyPath.push({id:e.id,type:e.type,label:e.label,mxid:e.mxid})}),c(d,o._currentTerminology)):o._logger.log("TerminologyPath returned by WebService do not corresponds to the current Terminology"):o._logger.warn("Empty TerminologyPath returned by WebService")},onFailure:function(e){o._logger.warn("Unable to retrieve TerminologyPath using WebService"),c(d,o._currentTerminology)}})}else{this.empty(!1);var h=null;0===(h="array"==UWA.typeOf(e)?e:[e]).length?this.add(this._currentTerminology):this.add(h)}},removeFromTerminologyCSO:function(e){if(!UWA.is(e))throw new Error("No terminologyNode specified");this.remove(e),0===this.getSelectedNodes().length&&e!=this._currentTerminology&&this.add(this._currentTerminology)},removeAllFromTerminologyCSO:function(){this.empty(!0)},getCurrentTerminology:function(){return this._currentTerminology},updateLabelCurrentTerminologyPath:function(){if(this._currentTerminologyPath){var e=this._currentTerminologyPath.length,t=this._currentTerminology.getLabel();this._currentTerminologyPath[e-1].label!==t&&(this._currentTerminologyPath[e-1].label=t)}},getCurrentTerminologyID:function(){var e=null;return this._currentTerminology&&this._currentTerminology.getID&&(e=this._currentTerminology.getID()),e},getCurrentTerminologyPath:function(){var e=[];return this._currentTerminologyPath&&this._currentTerminologyPath.forEach(function(t){e.push({id:t.id,type:t.type,label:t.label,mxid:t.mxid})}),e},getSelectedNodes:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t)}),e},getCurrentSelection:function(){var e=a.getContent().getSelectedNodes(),t=d.getCurrentTerminology();return e=null!=e&&e.length>0?e:t?[t]:[]},getSelectedNodesID:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t.getID())}),e},onTerminologySelected:function(e){return this._modelEvents.subscribe({event:"FOLDER_CSO/SELECT"},e)},isRelationsGroupNodeSelected:function(){let e=!1;var t=this.getCurrentSelection();if(t&&t.length>0)for(let o=0;o<t.length;++o)if(!0===t[o].isRelationsObjectGroupingNode){e=!0;break}return e}});return d}),define("DS/TerminologyEditor/views/TerminologyMode",["UWA/Controls/Abstract","DS/Controls/TooltipModel","DS/TerminologyEditor/Terminology_CSO","DS/Utilities/Dom","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologySearch","DS/IPClassifyUtil/IPClassifyAlert","DS/Core/ModelEvents","DS/IPClassifyUtil/bsd_utils/BSDSession","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m){"use strict";var p=null,h=null;function f(){return{icon:{iconName:widget.getValue("useIndexAcceleration")?isNaN(widget.getValue("autoSwitch"))?"database hoverGlass":"database-hourglass":"database hoverGlass",fontIconFamily:1,className:"check-active"},disabled:!widget.getValue("useIndexAcceleration")}}var y=e.singleton({_currentModeType:"read",_instantTime:null,_lastRefreshMode:null,_modelEvents:null,init:function(e){this._parent(e),this._tooltip=new t,g.getModelEvents().subscribe({event:"switch_to_author"},this.switchtoAuthoringMode.bind(this)),setInterval(()=>{this.updateToolTip()},1e4),this._modelEvents=new d},getToolbarEntry:function(){var e="read"==y.getCurrentModeType()?{icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1}:f(),t={id:"indexMode",dataElements:{typeRepresentation:"functionIcon",tooltip:this._tooltip,label:i.indexMode.Label,action:{module:"DS/TerminologyEditor/views/TerminologyMode",func:"switchModeButtonUI"},visibleFlag:1!=widget.launchWithReadMode}};for(var o in e)t[o]=e[o];return t},switchModeButtonUI:function(){m.sendTrackerPageEvent("TerminologyWidget_iconBar","Active Mode");var e;e=300,clearTimeout(h),h=setTimeout(function(){l.isSearchActive()&&(l.clearSearch(),r.getIdCardCont().switchSearch(!1)),u.addComponentsToLoad("global",{tree:""}),"read"==y.getCurrentModeType()?(y.setCurrentMode("authoring"),y.updateIconAndSettings()):(y.setCurrentMode("read"),y.updateIconAndSettings());try{r.getTreeCont().refreshTerminologyTreeAndContent()}catch(e){console.log("Error in tree mode"),u.removeComponentToLoad("global","tree")}},e)},updateIconAndSettings:function(e){var t=e||!0;if(widget.refreshDuetoChangeInPreference){var o=widget.changeInPreference;o.hasOwnProperty("useIndexAcceleration")&&(o.useIndexAcceleration?this.setCurrentMode("read"):this.setCurrentMode("authoring"),this._modelEvents.publish({event:"changeInContentFilterType"}))}(t&&this._registerTimeandModeOfRefresh(this.getCurrentModeType()),"read"==this.getCurrentModeType())&&(this._enableIndexModeSwitch(),r.getContent().RefreshProductStructure=!0,y.stopRefresh(),(!widget.refreshDuetoChangeInPreference||Object.keys(o).length>0)&&r.getContent().getSpecficMode("read").resetInfoIndex());if("authoring"==this.getCurrentModeType())if(widget.getValue("useIndexAcceleration")){var n=widget.getValue("autoSwitch");this._enableAuthoringMode(),y.setIndexModeAfterTimeInterval(n)}else this._enableAuthoringMode();this.updateToolTip()},_enableAuthoringMode:function(){if(r.getIdCardCont()){var e=f();r.getIdCardCont().updateCommand("indexMode",e)}},_enableIndexModeSwitch:function(){if(r.getIdCardCont()){var e={icon:{iconName:"database-refresh",fontIconFamily:1,className:""},disabled:!1};r.getIdCardCont().updateCommand("indexMode",e)}},getCurrentModeType:function(){return this._currentModeType},setCurrentModeType:function(e){this._currentModeType=e,"read"==e?(c.setAuthoringState(!1),c.setUseIndexPreference(!0)):(c.setAuthoringState(!0),c.setUseIndexPreference(!1))},onGlobalModeChange:function(e){this._modelEvents.subscribe({event:"changeInTerminologyGlobalMode"},e)},onSpecificPreferenceChange:function(e){this._modelEvents.subscribe({event:"onSpecificPreferenceChange"},e)},_registerTimeandModeOfRefresh:function(e){this._instantTime=(new Date).getTime(),this._lastRefreshMode=e},updateToolTip:function(){var e=this._instantTime,t=Math.floor(((new Date).getTime()-e)/1e3);t=t<60?t+" "+i.indexMode.seconds:t/60<60?Math.floor(t/60)+" "+i.indexMode.minutes:Math.floor(t/3600)+" "+i.indexMode.hours;var o="read"==this._currentModeType?i.indexMode.Index:i.indexMode.Authoring,n=i.replace(i.indexMode.activeMode,{mode:o})+"\n"+i.replace(i.indexMode.lastRefresh,{timeElapsed:t}),a=widget.getValue("useIndexAcceleration")&&"authoring"==this._currentModeType&&!isNaN(widget.getValue("autoSwitch"))?n+"\n"+i.replace(i.indexMode.reactIndexMode,{autoSwitch:widget.getValue("autoSwitch")}):n;this._tooltip.shortHelp=a,r.getIdCardCont()&&r.getIdCardCont().updateCommand("indexMode",{tooltip:this._tooltip})},setIndexModeAfterTimeInterval:function(e){var t=this;if(this.stopRefresh(),!isNaN(e)){var o=parseInt(e);p=setTimeout(function(){widget.getPreference("useIndexAcceleration").value&&(t.setCurrentMode("read"),t.updateIconAndSettings(),s.displayNotification({message:i.indexMode.info_msg_DataNotUptoDate,className:"info"}))},60*o*1e3)}},stopRefresh:function(){p&&clearTimeout(p)},setCurrentMode:function(e){var t=this._currentModeType!==e;this.setCurrentModeType(e),!l.isSearchActive()&&r.getContent()&&r.getContent().setCurrentMode(e),t&&this._modelEvents.publish({event:"changeInTerminologyGlobalMode"})},switchtoAuthoringMode:function(){"read"==y.getCurrentModeType()&&(l.isSearchActive()&&(l.clearSearch(),r.getIdCardCont().switchSearch(!1)),y.setCurrentMode("authoring"),s.displayNotification({message:i.indexMode.msg_Authoring,className:"info"})),y.updateIconAndSettings()},isTerminologyProxyToBeUsed:function(){var e=r.getContent(),t=e?e.getCurrentModeType():widget.getValue("useIndexAcceleration")?"read":"authoring",n=o.getCurrentTerminology(),i=!!n&&"TerminologySection_AllTerminologies"==n.getID();return"read"==t&&i}});return y}),define("DS/TerminologyEditor/views/TerminologyPlaceHolder",["UWA/Controls/Abstract","DS/Controls/Button","DS/Controls/TooltipModel","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/ApplicationFrame/CommandsManager","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/views/TerminologyMode"],function(e,t,o,n,i,r,a,l,s,d){"use strict";return e.extend({init:function(e){this._parent(e),this._buttonComponents=null,this.text={},this.buildSkeleton()},buildSkeleton:function(){var e=this,t="TerminologySection_AllTerminologies";function o(t){e._getComponentToReplace(t).inject(e.elements.container)}r.getCurrentTerminology()&&(t=r.getCurrentTerminology().plmType),this.elements.container=UWA.createElement("div",{class:"content-placeholder"}),this.elements.icon=UWA.createElement("div",{class:"content-placeholder-icon"}).inject(this.elements.container),this.elements.description=UWA.createElement("div",{class:"content-placeholder-description"}).inject(this.elements.container),n.onCurrentTerminologyChange(function(t){e._removeButtonComponent(),o(t.currentNode.plmType)}),s.onSearchChange(function(){s.isSearchActive()?(e._removeButtonComponent(),o()):(t=r.getCurrentTerminology().plmType,e._removeButtonComponent(),o(t))}),o(t)},_buildButtonComponents:function(e){var o=[];function n(e,o){var n=e.commands[o].callback,i={label:e.commands[o].name,emphasize:e.commands[o].emphasize,icon:e.commands[o].icon},r=new t(i);return r.getContent().addEventListener("buttonclick",function(){n()}),r}function i(e,t){if(e.commands)for(var o=0;o<e.commands.length;o++){n(e,o).inject(t)}}for(var r in e){var a=this.commonCommand=UWA.createElement("div",{class:"content-placeholder-common-command"});i(e[r],a),o[r]=a,this.text[r]=e[r].text}return o},_getComponentToReplace:function(e){var t=this._getButtonComponents();if(null===t){var o=this._getOptions();t=this._buttonComponents=this._buildButtonComponents(o)}return s.isSearchActive()?(this._getText(this.text.search),t.search):"TerminologySection_AllTerminologies"===e?widget.launchWithReadMode?(this._getText(this.text.terminologySection_Read),t.terminologySection_Read):(this._getText(this.text.terminologySection),t.terminologySection):widget.launchWithReadMode?(this._getText(this.text.terminology_Read),t.terminology_Read):(this._getText(this.text.terminology),t.terminology)},_getOptions:function(){return{terminologySection:{text:l.get("placeholder_msg_section"),commands:[{name:" "+l.get("placeholder_CreateTerminology"),emphasize:"primary",callback:function(){var e=i.getCommand("ActionBar_NewTerminologyCmd",a.getContent());d.switchtoAuthoringMode(),e&&e.begin()}}]},terminologySection_Read:{text:l.get("placeholder_msg_terminology")},terminology:{text:l.get("placeholder_msg_terms"),commands:[{name:" "+l.get("placeholder_CreateTerm"),emphasize:"primary",callback:function(){var e=i.getCommand("ActionBar_NewTermCmd",a.getContent());d.switchtoAuthoringMode(),e&&e.begin()}}]},terminology_Read:{text:l.get("placeholder_msg_terminology")},search:{text:l.get("placeholder_msg_search")}}},_removeButtonComponent:function(){this.getContent().getElementsByClassName("content-placeholder-common-command")[0].remove(),this.elements.icon.getChildren().forEach(function(e){e.remove()})},_getText:function(e){this.getContent().getElementsByClassName("content-placeholder-description")[0].innerText=e},_getButtonComponents:function(){return this._buttonComponents}})}),define("DS/TerminologyEditor/utils/TerminologyEditorUtil",["UWA/Utils","UWA/Core","DS/WebappsUtils/WebappsUtils","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/service/TerminologyTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyCommunication","DS/TerminologyEditor/Terminology_CSO","DS/IPClassifyActive/utils/EventsManager","DS/IPClassifyActive/utils/WidgetDataProvider","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","UWA/Utils/Client","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/views/TerminologyMode","DS/ZipJS/deflate","DS/ZipJS/inflate"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v,T){var _=null,C={iconName:"browsing-structure-node",fontIconFamily:1},S={iconName:"browsing-structure-root",fontIconFamily:1};function b(e){var t=D.jsonUnzip(e),o=null;try{o=JSON.parse(t)}catch(e){o=null}return o}function E(e){return D.jsonZip(JSON.stringify(e))}getStatusPref=function(){if(!_){var e=widget.getValue("view_status");_={},e&&(_=b(e))}return _||{}},saveStatus=function(e,t){var o=getStatusPref();o[e]=t,widget.setValue("view_status",E(o))},getStatus=function(e){return getStatusPref()[e]},getTreeListSort=function(e){var t=getStatus("treeSort");return t||e};var D={nameRules:{maxLength:127},jsonZip:function(t){if(t.length>0&&"{"!==t[0]&&"["!==t[0])return t;for(var o=new ArrayBuffer(t.length),n=new Uint8Array(o),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);var r=new Deflater;r.append(n);var a=r.flush(),l=String.fromCharCode.apply(null,a);return e.base64Encode(l)},jsonUnzip:function(t){if(t.length>0&&("{"===t[0]||"["===t[0]))return t;if(t.length>0&&0===t.indexOf("root,"))return"{}";var o=t;try{o=e.base64Decode(t)}catch(e){}for(var n=new ArrayBuffer(o.length),i=new Uint8Array(n),r=0;r<o.length;r++)i[r]=o.charCodeAt(r);var a=new Inflater,l=a.append(i);return a.flush(),String.fromCharCode.apply(null,l)},_getManipulationColumns:function(){let e=l.getContent().getPADTreeListView(),t=[];if(e){let n=e.getManipulationUnitColumns();for(var o=0;o<n.length;++o)t.push(n[o].dataIndex)}return t},convertToExaleadDataFormatFederated:function(e){var t={children:null},n=e.attributes,i={"ds6w:type":"type","ds6w:label":"label"},r={};let a=l.getContent().getPADTreeListView(),s=this._getManipulationColumns();if(n.forEach(function(e){if("resourceid"==e.name||"physicalid"==e.name)t.resourceid=e.value;else if("type_icon_url"===e.name||"icon"==e.name)t.icons=[e.value];else if("preview_url"===e.name||"thumbnail_2d"==e.name)t.thumbnail=e.value;else if("taxonomies"===e.name)e.value.contains("types/DOCUMENTS/Document")&&(t.checkout=!0);else if(e.name.startsWith("ds6w")){var o=e.name.split("/"),n=o[o.length-1],l=e.object?e.object:e.value;l=l||e.dispValue;var d=e.dispValue?e.dispValue:e.value;d||(d=l);let u=null,m=null;if(a){-1!==s.indexOf(n)&&(u=n+"_SortKey",m=d);let e=a.getColumnUnitNls(n,!0);e&&(d=d+" "+e)}var c=r[n];if(c&&!Array.isArray(c)&&(c=[c]),Array.isArray(c)&&c.push(d),Array.isArray(c)?r[n]=c:r[n]=d,u){let e=r[u];e&&!Array.isArray(e)&&(e=[e]),Array.isArray(e)&&e.push(m),Array.isArray(e)?r[u]=e:r[u]=m}n!=e.name&&(r[e.name]=l);var g=i[n];g&&(t[g]=l,r[g]=l)}else"relcount"===e.name?"0"!==e.value&&(t.children=[]):"taxonomies"===e.name?0===e.value.indexOf("types/DOCUMENTS")&&(t.isDownloadable=!0):r[(u=e.name,m=u.toLowerCase(),p=f.getAvailableColumns(),h=null,Array.isArray(p)&&p.every(function(e){return m==e.toLowerCase()&&(h=e),null===h}),h=h||u)]=e.value;var u,m,p,h}),e.id||(e.id=t.resourceid),t.isSearchWithinData=!0,t.grid=r,t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"},"read"==l.getContent().getCurrentModeType()){if(["VPMReference","CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"].indexOf(t.type)>-1&&(t.grid.expandable="TRUE",t.children=[]),["Terminology","Term"].includes(t.type))if(t.grid.hasOwnProperty("icon_2ddefaultthb.subtype")&&"shared"==t.grid["icon_2ddefaultthb.subtype"].toLowerCase()){var d=o.getWebappsAssetUrl("TerminologyEditor","icons/I_TerminologyInherit_v2.png");t.icons=[d],t.grid["ds6w:classification"]="Shared"}else t.icons=[S],t.grid["ds6w:classification"]="Terminology"}return t},convertToExaleadDataFormat:function(e){if(Array.isArray(e.attributes))return this.convertToExaleadDataFormatFederated(e);var o={};o.resourceid=e.id,o.label=void 0!==e.label?e.label:e.title,o.type=e.type,o.isDownloadable=e.isDownloadable||l.isCustomizedEnv()&&i.inFamilyTerminology(e.type),o.checkout=e.checkout,t.is(e.mxid)&&(o.mxid=e.mxid),t.is(e.publishOnConnect)&&(o.publishOnConnect=e.publishOnConnect);var n=e.icon,r=e.largeicon,a=e.thumbnail?e.thumbnail:null;for(var s in i.isTerminology(e.type)?(n=S,r=S):i.isTerm(e.type)&&(n=C,r=C),o.icons=n?[n]:[],o.thumbnail=null!==a?a:null!==r?r:n,t.is(e.description)&&t.is(e.description.replace,"function")&&(e.description=e.description.replace(/\\n/g," ")),o.grid={},o.padgrid={},o.grid["ds6w:identifier"]=e.name,o.grid["ds6w:description"]=e.description?e.description:"",o.grid["ds6w:modified"]=e.modified,o.grid["ds6w:created"]=e.created,o.grid["ds6w:responsible"]=e.owner,o.grid["ds6w:type"]=e.displayType?e.displayType:e.type,o.grid["ds6w:policy"]=e.policy?e.policy:"",o.grid["ds6w:organizationResponsible"]=e.organizationResponsible?e.organizationResponsible:e.organization?e.organization:"",o.grid["ds6w:project"]=e.project?e.project:e.collabspace?e.collabspace:"",o.grid["ds6w:status"]=e.status?e.status:e.state?e.state:"",e)"string"==typeof e[s]?e[s].length>0&&(o.grid[s]=e[s]):o.grid[s]=e[s];t.is(e.isDuplicated)&&(o.grid.isDuplicated=e.isDuplicated),o.padgrid["ds6w:leaf"]="False",o.padgrid["ds6w:root"]="True";let d=l.getContent().getPADTreeListView(),c=this._getManipulationColumns();var g=v.getAttrPredicateMap();return Object.keys(e).forEach(function(n){var i=g.get(n);if(i&&e[n].length>0){o.grid[i]=e[n];let r=null;if(-1!==c.indexOf(i)&&(r=i+"_SortKey",o.grid[r]=e[n]),d){let r=d.getColumnUnitNls(i,!0);if(r)if(t.is(e[n],"array")){let t=[];for(let o=0;o<e[n].length;++o){let i=e[n][o]+" "+r;t.push(i)}o.grid[i]=t}else o.grid[i]=e[n]+" "+r}}}),t.is(e.logicalDeleteBy)&&(o.grid.logicalDeleteBy=e.logicalDeleteBy),t.is(e.logicalDeleteStamp)&&(o.grid.logicalDeleteStamp=e.logicalDeleteStamp),t.is(o.thumbnail)&&(o.grid.thumbnail=o.thumbnail),t.is(e.expandable)&&"TRUE"===e.expandable?o.children=[]:(o.children=null,o.isNotManagedByPS=!0),o},convertToArray:function(e){return[{name:"ds6w:description",value:e.grid["ds6w:description"]},{name:"ds6w:modified",value:e.grid["ds6w:modified"]},{name:"ds6w:created",value:e.grid["ds6w:created"]},{name:"ds6w:type",value:e.grid["ds6w:type"]},{name:"ds6w:policy",value:e.grid["ds6w:policy"]},{name:"ds6w:organizationResponsible",value:e.grid["ds6w:organizationResponsible"]},{name:"ds6w:project",value:e.grid["ds6w:project"]},{name:"isDuplicated",value:e.grid.isDuplicated},{name:"ds6w:leaf",value:e.padgrid["ds6w:leaf"]},{name:"ds6w:root",value:e.padgrid["ds6w:root"]},{name:"ds6w:responsible",value:e.grid["ds6w:responsible"]},{name:"ds6w:status",value:e.grid["ds6w:status"]}]},generateJSON:function(e){var t,o,n,i=e.length,r={};for(t=0;t<i;++t)o={label:(n=e[t]).title,type:n.type,icon:n.icon,id:n.id,mxid:n.mxid,terminologyClassification:n.type},r[n.id]=o;return r},shouldBeEditable:function(e){return i.inFamilyTerminology(this.plmType)},onNodeModelUpdate:function(e){var t=e.data.nodeModel;if(i.inFamilyTerminology(t.plmType)){var o=t._lastUpdateTime?t._lastUpdateTime:0,d=Date.now()-o;if(t._lastUpdateTime=Date.now(),!(0!==o&&d<300))if(t._resetting)t._resetting=!1;else{var c=t.getID(),g=t.options.label,u=t.options.oldLabel;if(void 0===u&&(u=""),g!==u){g&&g.trim&&(g=g.trim());var m=!0;if(g.length>D.nameRules.maxLength){var p=g.substring(0,D.nameRules.maxLength);g.length>D.nameRules.maxLength&&(p+="..."),r.displayNotification({message:a.replace(a.get("msg_error_name_maxlength"),{name:p,maxLength:D.nameRules.maxLength}),className:"error"}),m=!1}0==g.trim().length&&(r.displayNotification({message:a.get("msg_error_name_empty"),className:"error"}),m=!1),m?(T.switchtoAuthoringMode(),n.setTerminologyProperties({pid:c,type:t.plmType,properties:{title:g},onComplete:function(){t.options.oldLabel=g,s.notifyTerminologyRename([t]),r.displayNotification({message:a.replace(a.get("msg_info_rename"),{name1:u,name2:g}),className:"success"}),l.getContent().getPADTreeListView().escape(),l.getTreeCont().escape()},onFailure:function(e){let o=a.get("msg_error_rename");r.displayNotification({title:a.replace(o.Title,{name:u}),subtitle:o.Advice,message:o.Details,className:"error"}),t._resetting=!0,setTimeout(function(){t.withTransactionUpdate(function(){this.setLabel(u)}),t._resetting=!1}),l.getContent().getPADTreeListView().escape(),l.getTreeCont().escape()}})):setTimeout(function(){t.withTransactionUpdate(function(){this.setLabel(u)});var e=require("DS/TerminologyEditor/commands/TerminologyCommands");t.hasOwnProperty("pathId")?e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"TREE"):e._cellToRename&&e.RenameCmd(e._cellToRename.cellInfos,"CONTENT")})}}}},checkMoveOrCopyAcrossSharedAndPersonal:function(e,t,o){return!0},getTenant:function(){var e=p.getTenantID(),t=null;return e&&null===t&&(t={label:e,value:e}),t},getCurrentSecurityContextAndTerminologyData:function(e){var t=c.getCurrentTerminology(),o="ctx::"+widget.getValue("xPref_CREDENTIAL"),n=this.getTenant(),i=s.createTerminologyForPublication(t,e);return i.Tenant=n,i.SecurityContext=o,i},objectSelectionProvider:{widgetEventsProvider:{selection:"TerminologyEditor.Public.Terminology"},widgetDataProvider:{getObjectForPublication:function(e){return e&&i.inFamilyTerminology(e.getType())?{TerminologyID:e.getID(),TerminologyLabel:e.getLabel()}:null}}},dipatchSecurityContextAndTerminology:function(){var e={current:null,active:null,origin:widget.id},t=this.getCurrentSecurityContextAndTerminologyData();e.current=t;var o=JSON.stringify(t);d.publish("TerminologyEditor.CurrentTerminology",o);var n=!1;if(m.getEnforceFolderLinkSettingAsync(function(e,t){e||(n=t)}),n||l.isCustomizedEnv()||l.isActiveTerminologyActivated()){var i=l.getActiveTerminology();e.active={origin:widget.id,id:"!"!==i.id?i.id:null,label:i.label,sc:i.sc},d.publish("TerminologyEditor.ActiveTerminology",e.active)}d.publish("TerminologyEditor.Terminology",e);var r=c.getCurrentTerminology();u.setDataProvider(this.objectSelectionProvider),g.notifyObjectSelection(r)},_sortTreeColumn:function(e,t){var o=i.inFamilyTerminology(e.plmType),n=i.inFamilyTerminology(t.plmType);return o&&!n?"asc"===this.sortOrder?-1:1:!o&&n?"asc"===this.sortOrder?1:-1:D.compareLabels(e.options.label,t.options.label)},sortingNodes:function(e){var t=this;return e.columns&&e.columns.forEach(function(e){var o=e.dataIndex;"tree"===o?e.sortFunction=t._sortTreeColumn:"ds6w:created"===o||"ds6w:modified"===o||"logicalDeleteStamp"===o||e.xnav_options&&"date"===e.xnav_options.kind?e.sortFunction=function(e,t){var n,r=i.inFamilyTerminology(e.plmType),a=i.inFamilyTerminology(t.plmType);if(r&&!a)return"asc"===this.sortOrder?-1:1;if(!r&&a)return"asc"===this.sortOrder?1:-1;try{n=new Date(e.options.grid[o])>new Date(t.options.grid[o])?1:new Date(e.options.grid[o])<new Date(t.options.grid[o])?-1:0}catch(i){n=e.options.grid[o]<t.options.grid[o]?-1:1}finally{return n}}:e.sortFunction=function(e,t){var n=i.inFamilyTerminology(e.plmType),r=i.inFamilyTerminology(t.plmType);if(n&&!r)return"asc"===this.sortOrder?-1:1;if(!n&&r)return"asc"===this.sortOrder?1:-1;var a=e.options.grid[o]?e.options.grid[o]:"",l=t.options.grid[o]?t.options.grid[o]:"";return D.compareLabels(a,l)}}),e},downloadFcs:function(o){if(t.is(o,"string")){var n=e.parseUrl(o),i=e.parseQuery(n.query);i.__fcs__attachment=!0,delete n.query;var r=e.composeUrl(n),a=document.createElement("form");a.style.display="none",a.method="POST",a.action=r,Object.keys(i).map(function(e){var t=document.createElement("input");t.setAttribute("name",e),t.setAttribute("value",i[e]),a.appendChild(t)}),document.body.appendChild(a),a.submit(),document.body.removeChild(a)}},downloadForTouchDevices:function(e){if(t.is(e,"string")){e+="&__fcs__attachment=true";var o=l.getContent();t.createElement("a",{href:e,styles:{display:"hidden"}}).inject(o.elements.container).click()}},isTouchDevice:function(){return"ontouchstart"in document.documentElement},compareLabels:function(e,o){return e||(e=""),o||(o=""),t.is(e,"array")&&(e=e.length>0?e[0]:""),t.is(o,"array")&&(o=o.length>0?o[0]:""),p.compareValue(o,e)},setBadge:function(e,t,o){var n={};n[t]=o,this.setBadges(e,n)},setBadges:function(e,t){var o=e.getBadges();for(var n in o=o||{},t){var i=t[n];o[n]=i?"string"==typeof i?{iconPath:i,iconSize:{width:"16px",height:"16px"}}:i:"none"}e.setBadges(o)},copyTexttoCLipboard:function(e){var t=document.createElement("textarea");if(t.classList.add("bookmark-txt-link"),t.value=e,document.body.appendChild(t),y.Platform.hasOwnProperty("ios")&&!0===y.Platform.ios){t.contentEditable=!0,t.readOnly=!0;var o=document.createRange();o.selectNodeContents(t);var n=window.getSelection();n.removeAllRanges(),n.addRange(o),t.setSelectionRange(0,t.value.length)}else t.select();try{var i=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),!!i},getDefaultView:function(){var e=getStatus("default_view");return e&&"treelistview"!==e?e:"datagridview"},getContentSortmodel:function(){var e=getTreeListSort(),t=[{sort:"asc",dataIndex:"tree"}];return e&&(e.id?t=[{sort:e.param?e.param.sortOrder:"asc",dataIndex:e.id}]:Array.isArray(e)&&(t=e)),t},getRightPanelStatus:function(){var e=getStatus("rightPanel");return e||{rightPanelState:!1,size:300}},getLeftPanelStatus:function(){var e=getStatus("leftPanel");return e||{leftPanelState:!0,isWelcomePanelCollapsed:!1}},getTreeViewScrollerPosition:function(){var e=getStatus("TreeViewScrollerPosition");return e||{x:0,y:0}},setDefaultView:function(e){saveStatus("default_view",e)},setContentSortmodel:function(e){saveStatus("treeSort",e)},setRightPanelStatus:function(e){saveStatus("rightPanel",e)},setLeftPanelStatus:function(e){saveStatus("leftPanel",e)},setTreeViewScrollerPosition:function(e){saveStatus("TreeViewScrollerPosition",e)},getContentViewPreference:function(){return new Promise(function(e,t){var o=widget.getValue("TerminologyCusto_treelistview");if(o)e({preference:b(o)});else{new Promise(function(e){require(["DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess"],function(t){e(t)})}),new Promise(function(e){m.app_initialization(e)});e({preference:null})}})},setContentViewPreference:function(e,t,o){return new Promise(function(n){try{e.selectedTypes=f.getSelectedTypes(),e.selectedExtensions=f.getSelectedExtensions()}catch(e){}e.version=o||widget.getValue("vMigration"),e.hasOwnProperty("columnsOptimized")&&e.columnsOptimized.forEach(function(e){e.hasOwnProperty("label")&&delete e.label}),"only"!==t&&widget.setValue("TerminologyCusto_treelistview",E(e)),t?require(["DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess"],function(t){t.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"_template",value:E(e),onComplete:function(e){console.log("Saved as template"),n()},onFailure:function(e){console.warn("Cannot save customization template"),n()}})}):n()})},getAddMovePopupResults:function(e,t){new(require("DS/TerminologyEditor/popup/AddMovePopup"))({callback:e,objectValues:t})},setTreeTaggerPreference:function(e,t){t=JSON.stringify(t),t=D.jsonZip(t),widget.setValue(e,t)},getTreeTaggerPreference:function(e){return function(e){if(e)try{e=D.jsonUnzip(e),e=JSON.parse(e)}catch(t){e={}}else e={};return e}(widget.getValue(e))},isTreeTaggerActive:function(){return!0===p.getWidgetPreferenceValue("activateTreeFilter")},isContentTaggerActive:function(){var e=p.getWidgetPreferenceValue("activateBIFilter"),t=p.getWidgetPreferenceValue("activateTreeFilter");return!0===e&&!1===t},filterDBOnlyAttrs:function(e){for(var t=[],o=0;o<e.length;++o)(!e[o].attrDBName||e[o].attrDBName.length>0)&&t.push(e[o]);return t},isRelationsColumnsActive:function(){let e=!0===p.getWidgetPreferenceValue("activateRelationsColumns"),t=!0===p.getWidgetPreferenceValue("Activate_relationsColumns"),o=!(!window||!0!==window.isReplayRelatedObjectsODT);return t&&e||o}};return D}),define("DS/TerminologyEditor/views/TerminologyLeftSidePanelView",["UWA/Core","UWA/Controls/Abstract","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r){"use strict";return t.extend({_context:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get(),this.addCallback()},updatePanelVisibility:function(e,t){"left"===t&&(this.setPreferences(),r.getIdCardCont().updateLeftPanelIcon(e))},addCallback:function(){var e=this,t=r.getTreeCont()?r.getTreeCont()._terminologies_TreeView:null;t._getScroller()&&t._getScroller().onScrollEnd(function(){o.setTreeViewScrollerPosition(t.getScrollerPosition())}),!1===this._callbackAdd&&this._context.elements.padshell&&this._context.elements.padshell._modelEvents&&(this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1)),this._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),i.leftPanelOpen(function(t){"left"===t&&(!e._context.elements.padshell.getLeftOpen()&&widget.body.getSize().width,e._context.togglePanel("left"),e.setPreferences())}),i.leftPanelClose(function(t){"left"===t&&(e._context.elements.padshell.getLeftOpen()&&(e._context.togglePanel("left"),e.setPreferences()))}),this._callbackAdd=!0)},setPreferences:function(){var e=this._context.elements.padshell.getLeftOpen(),t={leftPanelState:e,isWelcomePanelCollapsed:!e};o.setLeftPanelStatus(t),e?i._modelEvents.publish({event:"welcome-panel-expanded"}):i._modelEvents.publish({event:"welcome-panel-collapsed"})},isLeftPanelOpen:function(){return this._context.elements.padshell.getLeftOpen()}})}),define("DS/TerminologyEditor/views/TerminologyRightSidePanelView",["UWA/Core","UWA/Controls/Abstract","UWA/Promise","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/WidgetServices/commandProxy/CommandProxy","DS/TerminologyEditor/Terminology_CSO","UWA/Class/Model","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,o,n,i,r,a,l,s,d,c,g){"use strict";var u=[];return t.extend({_context:null,_propertiesWdg:null,_callbackAdd:!1,init:function(e){this._parent(e,{}),this._context=n.get();var t=this;if(this._propertiesWdg=null,this._context.elements.padshell){var i=new o(function(e){null==t._propertiesWdg?require(["DS/EditPropWidget/EditPropWidget","DS/EditPropWidget/constants/EditPropConstants","DS/EditPropWidget/utils/EditPropUtils"],function(o,n,i){if(t.EditPropUtils=i,null==t._propertiesWdg){t._propertiesWdg=new o({className:"enxpropertiestab",setEditButton:!0,readOnly:1==widget.launchWithReadMode,typeOfDisplay:n.ALL,selectionType:n.NO_SELECTION,multiselection:!1,collapseTabs:!1,context:t._context,actions:[{name:"action_close_panel",text:l.button_close,icon:"close",handler:function(){t._context.elements.padshell.getRightOpen()&&(t._context.togglePanel("right"),t._selectionChange(),t.setPreferences())}}]}),t._propertiesWdg.removeFacets([n.FACET_VIEWS]);var r=t._context.elements.padshell.getRightPanelContent();t._propertiesWdg.inject(r),t._propertiesWdg.elements.container.getContent().addEvent("resize",function(){t.size=t._context.elements.padshell._currentRight;var e={rightPanelState:t._context.elements.padshell.getRightOpen(),size:t.size};s.setRightPanelStatus(e)});var a=s.getRightPanelStatus();a.rightPanelState?(t.size=t._context.elements.padshell._currentRight=a.size,t._context.togglePanel("right"),t.setPreferences(),t._selectionChange(),c._modelEvents.publish({event:"information-panel-visible"})):(t.size=t._context.elements.padshell._currentRight=a.size,t.setPreferences())}e()}):e()});i.then(function(e){t.addCallback()}),u.push(i)}},updatePanelVisibility:function(e,t){"right"===t&&(this.setPreferences(),d.getIdCardCont().updateRightPanelIcon(e),!0===e&&g.sendTrackerPageEvent("TerminologyWidget_iconBar","Information"))},addCallback:function(){var e=this;!1===e._callbackAdd&&(i.create({events:{onSelect:e._selectionChange.bind(e)}}),e._context.elements.padshell&&e._context.elements.padshell._modelEvents&&(e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-hidden"},e.updatePanelVisibility.bind(this,!1)),e._context.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},e.updatePanelVisibility.bind(this,!0)),c.rightPanelOpen(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()||(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),c.rightPanelClose(function(t){"right"===t&&(e._context.elements.padshell.getRightOpen()&&(e._context.togglePanel("right"),e._selectionChange(),e.setPreferences()))}),e._callbackAdd=!0))},_selectionChange:function(e,t){if(this._context.elements.padshell.getRightOpen()&&this.EditPropUtils&&(!t||t.metadata&&t.metadata.originWidgetId===widget.id&&"ENORIPE_Relations"!==t.metadata.origin)){var n=this,i=r.getCurrentSelection(),a=[];i.length&&i.forEach(function(e){var t=n.EditPropUtils.getModelFromSelectedNode(e);t&&a.push(t)});n=this;var l=new o(function(e){o.all(u).then(function(){n._propertiesWdg.initDatas(a),e()})});u.push(l)}},setPreferences:function(){var e=this._context.elements.padshell.getRightOpen(),t={rightPanelState:e,size:this.size};s.setRightPanelStatus(t),e?c._modelEvents.publish({event:"information-panel-visible"}):c._modelEvents.publish({event:"information-panel-hidden"})},_getAppContext:function(e){return{getPlatformUrls:function(){return e.platformUrls},getSecurityContext:function(){return widget.getValue("xPref_CREDENTIAL")}}}})}),define("DS/TerminologyEditor/service/TerminologyServices",["UWA/Core","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/service/TerminologyTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/TerminologyEditor/views/TerminologyMode","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,a,l,s,d){"use strict";e.createElement("iframe",{name:"bookmarkdownloaderFrame",styles:{display:"none"}}),e.createElement("form",{method:"POST",enctype:"application/x-www-form-urlencoded",target:"bookmarkdownloaderFrame",html:[{tag:"input",value:"true",name:"attachment"}],styles:{display:"none"}});return{AddContent:function(e){if(s.switchtoAuthoringMode(),e.IDs.length>0){var n,r=e.terminology,a=(n=r||t.getCurrentTerminology())?n.id||n.getID():"";a&&a.length?o.addcontent({pid:a,IDs:e.IDs,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("AddContent WebService Err : "+n),n.length>200&&(n=null),o.information&&i.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},RemoveContent:function(e){if(s.switchtoAuthoringMode(),e.IDs.length>0){var n,i=e.terminology,r=(n=i||t.getCurrentTerminology())?n.id||n.getID():"";r&&r.length?o.removecontent({pid:r,IDs:e.IDs,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("Remove WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},RemoveContentSearchWithin:function(e){null!=e.objectID&&null!=e.objectID&&e.terminologyIDs.length>0?o.removecontentsearchwithin({objectID:e.objectID,terminologyIDs:e.terminologyIDs,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("Remove WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},MoveContent:function(e){if(s.switchtoAuthoringMode(),e.IDs.length>0){var n,i=e.targetterminology,r=e.sourceterminology;n=r||t.getCurrentTerminology();var a=i?i.id||i.getID():"",l=n?n.id||i.getID():"";a&&a.length&&l&&l.length?o.movecontent({pid:a,IDs:e.IDs,SourceTerminologyId:l,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("MoveContent WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},MoveTerminology:function(e){s.switchtoAuthoringMode();var t=e.targetterminology,n=e.sourceterminology,i=t?t.id:"",r=n?n.id:"";i.length&&e.IDs.length?o.moveterminology({SourcePhysicalId:r,PhysicalId:e.IDs,TargetPhysicalId:i,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("MoveTerminology WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},CheckCopyTerminology:function(e){var t="ctx::"+widget.getValue("xPref_CREDENTIAL");e.IDs.length?o.checkCopyterminology({PhysicalId:e.IDs,SecurityContext:t,onComplete:function(t){parseInt(t)>200?e.callbacks.onFailure(t):e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},isSourceAndTargetTypeSame:function(t,o){let n=!0;if(!t||!o)return n;if(e.is(t,"array")){if(!(t.length>0))return n;t=t[0]}return"Term"===t.getType()&&"TerminologySection_AllTerminologies"===o.getType()?n=!1:"Terminology"===t.getType()&&"TerminologySection_AllTerminologies"!==o.getType()&&(n=!1),n},CopyTerminology:function(e){s.switchtoAuthoringMode();var t=e.targetPhysicalId,n=t?t.getID():"";n&&"TerminologySection_AllTerminologies"!==t.plmType||(n="Root");var i="ctx::"+widget.getValue("xPref_CREDENTIAL");n.length&&e.physicalIds.length?o.copyterminology({PhysicalId:e.physicalIds,TargetPhysicalId:n,SecurityContext:i,withContent:e.withContent,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("CopyTerminology WebService Err : "+n),n.length>200&&(n=null),e.callbacks.onFailure(o.advice?o:n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)},downloadFiles:function(e){console.log("download files")},previewFile:function(e){},EditFile:function(e){console.log("Edit file")},UpdateFile:function(e){console.log("update file")},UndoEditFile:function(e){console.log("undo edit files")},replaceContent:function(e){var n=e.IDsRemoved.length;if(n===e.IDsAdded.length&&n>0){var r,a=e.terminology,l=(r=a||t.getCurrentTerminology())?r.id||r.getID():"";l&&l.length?o.replaceContent({pid:l,IDsRemoved:e.IDsRemoved,IDsAdded:e.IDsAdded,onComplete:function(t){var o=t?JSON.parse(t):void 0;if(o&&o.error){var n=o.error;console.log("ReplaceContent WebService Err : "+n),n.length>200&&(n=null),o.information&&i.displayNotification({message:o.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure}):e.callbacks.onFailure(e)}else e.callbacks.onFailure(e)},activateTerminologyEditorItem:function(e,t,o){if(n.isTerm(t)?t="Term":n.isTerminology(t)&&(t="Terminology"),e&&n.inFamilyTerminology(t)){var a=r.getTreeCont();a&&a.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e],type:t,name:o},partiallyExpandPath:!0,onComplete:function(e){console.log(" expandTreeAndSelectTerminology:onComplete")},onGiveUp:function(e){console.log(" expandTreeAndSelectTerminology:onGiveUp")},onFailure:function(e){i.displayNotification({message:d.replace(d.get("msg_error_TerminologyActivate"),{name1:o}),className:"error"})}})}else console.log("Selected (Double Clicked) object is not terminology")}}}),define("DS/TerminologyEditor/views/TerminologyTileView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/TerminologyEditor/service/TerminologyServices","DS/ApplicationFrame/CommandsManager","DS/CollectionView/ResponsiveTilesCollectionView","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,a,l,s){"use strict";return e.extend(o,n,{name:"xTermResponsiveTileView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=new a(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){r.getCommand("Copy").begin()}),o.onCellsPaste(function(e){r.getCommand("Paste").begin()}),o.onCellsCut(function(e){r.getCommand("Cut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")}),o.onInfiniteScroll(function(e){l.getContent().processForInfiniteScroll(e,o)}),o.getCustomTooltip=function(e){return s.ViewTooltip["ds6w:label"]+": "+e.options.grid.label+"\n"+s.ViewTooltip["ds6w:type"]+": "+e.options.grid["ds6w:type"]+"\n"+s.ViewTooltip["ds6w:status"]+": "+e.options.grid["ds6w:status"]+"\n"+s.ViewTooltip["ds6w:responsible"]+": "+e.options.grid["ds6w:responsible"]+"\n"+s.ViewTooltip["ds6w:modified"]+": "+e.options.grid["ds6w:modified"]+"\n"+s.ViewTooltip["ds6w:project"]+": "+e.options.grid["ds6w:project"]+"\n"+s.ViewTooltip["ds6w:identifier"]+": "+e.options.grid["ds6w:identifier"]},UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick(function(e){var t=e.nodeModel;i.activateTerminologyEditorItem(t.options.resourceid,t.options.type,t.options.label)})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})}})}),define("DS/TerminologyEditor/views/TerminologyThumbnailView",["UWA/Controls/Abstract","UWA/Core","UWA/Class/Options","UWA/Class/Events","DS/CollectionView/ResponsiveThumbnailsCollectionView","DS/ApplicationFrame/CommandsManager","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,a,l,s){"use strict";return e.extend(o,n,{name:"xTermResponsiveThumbnailView",defaultOptions:{grid:null,model:null},init:function(e){this._parent(e),this.options=UWA.extend(this.options,e,!0),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var t=UWA.extend(e,{height:"inherit",displayedOptionalCellProperties:["contextualMenu","statusbarIcons","activeFlag"],useDragAndDrop:!0,allowUnsafeHTMLContent:!1},!0);t.onDelayedModelDataRequest=this.options.context.updateAttributesDelayed.bind(this.options.context);var o=this.options.grid=new i(t);e.onContextualEvent&&(o.onContextualEvent=e.onContextualEvent),this._originalApplyAttributes=o._applyAttributesOnCell.bind(o),o._applyAttributesOnCell=this._applyAttributesOnCell.bind(this),o.getContent().inject(this.elements.container),this.getOption("renderTo")&&!0===e.isActiveView&&this.elements.container.inject(this.getOption("renderTo")),o.onCellsCopy(function(e){r.getCommand("Copy").begin()}),o.onCellsPaste(function(e){r.getCommand("Paste").begin()}),o.onCellsCut(function(e){r.getCommand("Cut").begin()}),o.selectionBehavior=UWA.extend({enableFeedbackForActiveCell:!0},o.selectionBehavior),o.onPostCellRequest(function(e){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut")}),o.onInfiniteScroll(function(e){l.getContent().processForInfiniteScroll(e,o)}),o.getCustomTooltip=function(e){return s.ViewTooltip["ds6w:label"]+": "+e.options.grid.label+"\n"+s.ViewTooltip["ds6w:type"]+": "+e.options.grid["ds6w:type"]+"\n"+s.ViewTooltip["ds6w:status"]+": "+e.options.grid["ds6w:status"]+"\n"+s.ViewTooltip["ds6w:responsible"]+": "+e.options.grid["ds6w:responsible"]+"\n"+s.ViewTooltip["ds6w:modified"]+": "+e.options.grid["ds6w:modified"]+"\n"+s.ViewTooltip["ds6w:project"]+": "+e.options.grid["ds6w:project"]+"\n"+s.ViewTooltip["ds6w:identifier"]+": "+e.options.grid["ds6w:identifier"]},UWA.is(this.options.grid.onCellDoubleClick,"function")&&this.options.grid.onCellDoubleClick(function(e){var t=e.nodeModel;a.activateTerminologyEditorItem(t.options.resourceid,t.options.type,t.options.label)})},setModel:function(e){this.options.model=e,this.options.grid.loadGridViewModel(e),this.elements.container.inject(this.getOption("renderTo")),this.options.isActiveView=!0,this.options.grid.layout.invalidate(),null!==e.options.viewport.thumbnails&&void 0!==e.options.viewport.thumbnails&&this.options.grid.setScrollerPosition(e.options.viewport.thumbnails)},unsetModel:function(){this.getScrollerPosition&&(this.options.model.options.viewport.thumbnails=this.getScrollerPosition()),this.getOption("renderTo").removeChild(this.elements.container),this.options.isActiveView=!1,this.options.grid.unloadGridViewModel()},updateView:function(){this.options.grid.layout.invalidate({updateCellContent:!0})},_applyAttributesOnCell:function(e){var t=e;void 0===e.nodeModel&&(t.nodeModel=this.options.grid._getModelAt(e.cellID),t.cellView=this.options.grid._getViewAt(e.cellID)),t.nodeModel.options.isBeingCut?t.cellView.getContent().addClassName("pad-state-is-being-cut"):t.cellView.getContent().removeClassName("pad-state-is-being-cut"),this._originalApplyAttributes(e)}})}),define("DS/TerminologyEditor/ActionBar/TerminologyCommandManager",["UWA/Class","DS/WidgetServices/WidgetServices","DS/ApplicationFrame/CommandsManager","DS/IPClassifyUtil/IPClassifyUtility","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/LifecycleServices/LifecycleServicesSettings","DS/TerminologyEditor/Terminology_Clipboard","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","text!DS/TerminologyEditor/assets/TerminologyProbesCommandMapping.json","text!DS/TerminologyEditor/assets/TerminologyEditorCmds.json"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f){"use strict";var y=JSON.parse(h);t.isCatiaV5Environment()||t.isSolidworksEnvironment();var v={SubscribeHdr:{TREE:!1},UnSubscribeHdr:{TREE:!1},EditSubscribeHdr:{TREE:!1},MySubscriptionsHdr:!0,TerminologyLocation:{search:!0,multisel:!1,CONTENT:!0},openWith:{CATIAV6:!1,multisel:!1,CONTENT:!0},RenameCmd:{multisel:!1,TREE:{Sections:!1},CONTENT:{Terminologies:!0}},ActionBar_FindInCtxCmd:{views:["datagridview"],search:!1,TREE:{ctxMenu:!1,Sections:!1},CONTENT:{check:e=>"VPMReference"==e.options.type&&!!e.getChildren()}},ActionBar_ActiveTerminologyCmd:{TREE:!0},SelectChildren:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},SelectParent:{TREE:!1,CONTENT:{check:function(e){return e.getDepth()>0}}},SelectAll:!0,SelectInversion:{TREE:!1,CONTENT:!0},SelectSiblings:{TREE:!1,CONTENT:!0},SelectLeaves:{TREE:!1,CONTENT:{check:function(e){return null!==e.getChildren()}}},Copy:{TREE:{FavSection:!1,Sections:!1},CONTENT:!0},Paste:{author:!0,search:!1,white_click:!0,clipboard:!0,TREE:{FavSection:!1},CONTENT:{Terminologies:!0,rootInClipboard:!1}},ActionBar_Attributes:{TREE:{Sections:!1},CONTENT:!0},ActionBar_AccessRightCmd:{TREE:{Sections:!1},CONTENT:!0},CompareHdr:{CATIAV6:!1,CONTENT:!0},ActionBar_TransferOwnership:{TREE:{Sections:!1},CONTENT:!0},MaturityHdr:{TREE:{Sections:!1,Root:!0},CONTENT:{Root:!0}},ActionBar_ChangeOwner:{TREE:{Sections:!1},CONTENT:!0},ActionBar_NewTerminologyCmd:{author:!0,white_click:!0,search:!1,TREE:{Sections:!0,Terminologies:!1},CONTENT:{check:e=>"Section"===e.options.type}},ActionBar_NewTermCmd:{author:!0,white_click:!0,search:!1,TREE:{Sections:!1,Terminologies:!0},CONTENT:{check:function(e){return"Section"!==e.options.type}}},DeleteHdr:{TREE:{Sections:!1,Terminologies:!0},CONTENT:{check:e=>!0}},treeview:!0,tileview:{search:!1},thumbnailview:{search:!1},ExpandAll:{TREE:{Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},ExpandN:{TREE:{FavSection:!1,Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},CollapseAll:{TREE:{Favorites:!1},CONTENT:{check:function(e){return null!==e.getChildren()}}},Print:{search:!1,ios:!1,views:["datagridview"]},PrintOptions:{search:!1,ios:!1},ExportCSV:{search:!1,ios:!1},ExportCSVOptions:{search:!1,ios:!1},ImportCSVTerminology:{search:!1,TREE:{FavSection:!1}},ImportCSV:{search:!1,TREE:{FavSection:!1}},ActiveTerminology:{search:!1,check:function(){var e=!1;return r.getEnforceFolderLinkSettingAsync(function(t,o){t||(e=o)}),e||i.isCustomizedEnv()||i.isActiveTerminologyActivated()},TREE:{Sections:!1}},WhereUsed:!0,DuplicateHdr:{TREE:!1,CONTENT:{Terminologies:!1}},NewBranchHdr:{TREE:!1,CONTENT:{Terminologies:!1}},HistoryHdr:{TREE:!1,multisel:!1,CONTENT:{Terminologies:!1}},ActionBar_ShareTerminologyLink:{multisel:!1,TREE:{Sections:!1},CONTENT:{search:!1,childProduct:!1}}};return e.singleton(g,{noSizeToFit:["TerminologyLocation"],initialize:function(){s.onTerminologySelected(()=>{this.updateCommands()}),s.onEmpty(()=>{this.enableAllCommands(!1)}),o.onCommandStart(e=>{var t=v[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})});var e=new Promise(e=>{new Promise(e=>{e(f)}).then(e)});return new Promise(t=>{e.then(e=>{var o={};if(e)for(var n in(o=JSON.parse(e)).headers){var i=o.headers[n],r=v[n];i.ID=n,r&&"CATAfrHeaderCheck"===i.Behavior&&(r.type="check")}t(o)})})},launchCommand:function(e,t,o,i){let r=e;y&&y[e]&&(r=y[e]),"ContextualMenu"===i?n.sendTrackerPageEvent("TerminologyWidget_contextual",r):n.sendTrackerPageEvent("TerminologyWidget_iconBar",r),this._parent.apply(this,arguments)},getHeaderCtxMenu:function(e){e.defaultColumnManagement=!0;var t=this._parent.apply(this,arguments),o=e.cellInfos;return t.push({ID:"clearSort",title:p.CMDClearSort,type:"PushItem",icon:"clear",state:o.manager&&o.manager.sortModel&&o.manager.sortModel.length>0&&(o.manager.sortModel.length>1||"defaultSort"!==o.manager.sortModel[0].dataIndex)?"enabled":"disabled",action:{callback:function(){var e;(e=o).manager.prepareUpdateView(),e.manager.sortModel=[{dataIndex:"defaultSort",sort:"asc"}],e.manager.layout.saveColumnSortModelInPreferences(),e.manager.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)}}}),t},_manageSwitchOfCommands:function(e,o,n,r){var s=n&&!!o&&0===o.length,g=!1,u=!1,m=!1,p=!1,h=!1,f=a.IsEmpty(),y=!1;f||a.getSelectedNodes().every(e=>!(y=y||l.isTerminology(e.plmType)));var T=!1,_=!1,C=!1;e&&(C="TerminologySection_AllTerminologies"==e.plmType,T=l.isTerminology(e.plmType),_=l.isTerm(e.plmType));var S=C,b=!1,E=c.isRelationsColumnsActive();o&&o.every(function(e){return g=g||l.isTerminology(e.plmType),u=u||l.isTerm(e.plmType),b=b||"Busy"===e.plmType,m=0!==e.getParents().length,p=p||E&&!0===e.isRelationsObjectNode,h=h||E&&!0===e.isRelationsObjectGroupingNode,!g||!u||!b||E&&(!p||!h)});var D=!0;if((b||(C||!e)&&o&&0===o.length)&&(D=!1),n||this.enableAllCommands(D),!b){var w={},A=Object.keys(v);return r&&(A=r),A.forEach(r=>{var a=v[r];if(a){var l=!!o&&o.length>0,c=!!e&&!l,C=!0,b=!o||o.length<=1;if("object"==typeof a){if(C&&E&&h&&(C=!1),(C&&!1===a.TREE&&c||!1===a.CONTENT&&l)&&(C=!1),C&&s&&!0!==a.white_click&&(C=!1),C&&void 0!==a.clipboard&&(C=!f),C&&void 0!==a.multisel&&(C=b),C&&void 0!==a.search&&(C=a.search===d.isSearchActive()),C&&0==a.multiselSearch&&(C=!(!b&&d.isSearchActive())),C&&void 0!==a.custo&&(C=i.isCustomizedEnv()),C&&void 0!==a.setting&&(C=!0===t.getWidgetPreferenceValue(a.setting)),C&&a.check&&(C=a.check({oneIsRoot:g,oneIsTerminology:u,treeIsRoot:T,treeIsTerminology:_})),C&&a.views&&(C=a.views.indexOf(i.getContent().getActiveView())>=0),C&&!1===a.dashboard&&(C=t.isWebInWinEnvironment()),C&&!1===a.webInWin&&(C=!t.isWebInWinEnvironment()),C&&!1===a.ios&&(C=!UWA.Utils.Client.Platform.ios),C&&!1===a.CATIAV6&&(C=!0!==widget.getValue("noCompass")),c=null,C&&a.TREE&&(c=!(!e||l&&void 0!==a.CONTENT))&&(!0===a.TREE?c=!0:(c&&a.TREE.custo&&(c=i.isCustomizedEnv()),s||c&&n&&!1===a.TREE.ctxMenu&&(c=!1),!1!==c&&(!0===a.TREE.Root?c=T:!1===a.TREE.Root&&(c=!T)),!1!==c&&(!0===a.TREE.Terminology?c=_:!1===a.TREE.Terminology&&(c=!_)),!1!==c&&(!0===a.TREE.Terminologies?c=_||T:!1===a.TREE.Terminologies&&(c=!_&&!T)),!1!==c&&(!0===a.TREE.Sections?c=S:!1===a.TREE.Sections&&(c=!S)),!1!==c&&(!0===a.TREE.FavSection?c=!1:!1===a.TREE.FavSection&&(c=!0)),!1!==c&&a.TREE.check&&(c=a.TREE.check(e)))),l=null,C&&a.CONTENT&&(l=!!o&&o.length>0))if(!0!==a.CONTENT||E&&p){if(l&&a.CONTENT.custo&&(l=i.isCustomizedEnv()),!1!==l&&(!0===a.CONTENT.Root?l=g:!1===a.CONTENT.Root&&(l=!g)),!1!==l&&(!0===a.CONTENT.Terminology?l=u:!1===a.CONTENT.Terminology&&(l=!u)),!1!==l&&(!0===a.CONTENT.Terminologies?l=u||g:!1===a.CONTENT.Terminologies&&(l=!u&&!g)),!1!==l&&(!0===a.CONTENT.FavContent?l=o[0].isFavorite:!1===a.CONTENT.FavContent&&(l=!o[0].isFavorite)),!1!==l&&!1===a.CONTENT.rootInClipboard&&(l=!y),!1!==l&&void 0!==a.CONTENT.search&&(l=a.CONTENT.search===d.isSearchActive()),!1!==l&&!1===a.CONTENT.childProduct&&(C=l=!m),!1!==l&&(a.CONTENT.check||a.CONTENT.types)){var D=a.CONTENT.types,A=a.CONTENT.check,I=!1;o.every(function(e){return I=(I=D&&e.options&&e.options.type?D.indexOf(e.options.type)>=0:!D)&&(!A||A(e))}),l=I}}else l=!0;C=C&&(!0===l||!0===c||null===l&&null===c)}w[r]=C,n||this._switchCommand(r,C,a.type)}}),w}},isCommandAvailable:function(e,t,o,n){var r=!0,a=v[e];r&&void 0!==a.search&&d.isSearchActive()&&(r=a.search),r&&void 0!==a.custo&&(r=i.isCustomizedEnv()),r&&a.views&&(r=a.views.indexOf(i.getContent().getActiveView())>=0),r=r||this._parent.apply(this,arguments)},enableAllCommands:function(e){var t=o.getCommands();for(var n in t){var i=o.getCommand(n);UWA.is(i)&&i.enable&&(e?this._switchCommand(n,!0):"ListSnapshotsHdr"!==n&&this._switchCommand(n,!1))}},getModelEvents:function(){return m.getModelEvents()},updateCommands:function(e,t){if(t||(t=s.getCurrentTerminology()),i.getContent()){var o=i.getContent().getSelectedNodes();o=o||(e?[e]:[]),this._parent(t,o)}}})}),define("DS/TerminologyEditor/commands/TerminologyCommands",["UWA/Core","UWA/Utils","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUXUtil/IPClassifyConfirmationWthCheckBx","DS/TerminologyEditor/Terminology_CSO","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/UIKIT/Mask","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/views/TerminologyCreationDialog","DS/ApplicationFrame/CommandsManager","DS/TerminologyEditor/Terminology_Clipboard","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/WidgetServices/WidgetServices","DS/UIKIT/Native/Dropdown","DS/IPClassifyUtil/IPClassifyCommunication","DS/TerminologyEditor/ActionBar/TerminologyCommandManager"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v,T){"use strict";function _(e,t,n){var i=t;n&&n.advice?(console.error(e,n.error),o.displayNotification({title:i,subtitle:n.advice,message:n.error,className:"error"})):(console.error(e,n),!UWA.is(n)||n instanceof Error||(i+="<br>"+n),o.displayNotification({message:i,className:"error"}))}var C=null;return{_nbItemsNotNull:function(e){var t,o=e.length,n=0;for(t=0;t<o;++t)e&&n++;return n},_activeCuttingNodes:!1,_setStateCuttingNodes:function(e){var t=0,o=e.length;if(this._activeCuttingNodes&&this._setStaUncuttingNodes(),0===o)return null;for(t=0;t<o;++t)e[t].updateOptions({isBeingCut:!0});this._activeCuttingNodes=!0},_setStaUncuttingNodes:function(){var e,t,o,n=0;if(this._activeCuttingNodes){if(0===(t=(e=m.getSelectedNodes()).length))return null;for(n=0;n<t;++n)(o=e[n]).options.isBeingCut&&o.updateOptions({isBeingCut:!1});this._activeCuttingNodes=!1}},escapCmd:function(){this._activeCuttingNodes&&(this._setStaUncuttingNodes(),m.ClearClipboard()),c.getContent().getPADTreeListView().escape(),c.getTreeCont().escape()},RenameCmd:function(e,t){if(t)var o=c.getTreeCont()._terminologies_TreeView;else o=c.getContent().getPADTreeListView().getManager();var n=o.layout.getColumnIndex("tree"),i=o.layout.getCellIDFromCoordinates({rowID:e.rowID,columnID:n});o.setCellInEdition(i)},CopyCmd:function(){var e=[];e=c.getContent().getSelectedNodes();var t=r.getCurrentTerminology();e=e.length>0?e:[t],this._setStaUncuttingNodes(),m.addInTerminologyClipboard(e,t,"COPY")},CutCmd:function(){var e=[];e=c.getContent().getSelectedNodes();var t=r.getCurrentTerminology();1===(e=e.length>0?e:[t]).length&&e[0].getID()===t.getID()?c.getTreeCont()._terminologies_TreeView:e.length>0&&c.getContent().getPADTreeListView(),this._setStateCuttingNodes(e),m.addInTerminologyClipboard(e,t,"CUT")},PasteCmd:function(e){var t=r.getCurrentTerminology(),n=m.getTreeNode(),d=m.getSelectedNodes(),g=m.getMode(),u=e&&s.inFamilyTerminology(e.plmType)?e:null;if(u||(u=r.getCurrentTerminology()),d){if(this._setStaUncuttingNodes(),s.inFamilyTerminology(u.plmType))for(var h=0;h<d.length;h++)if(s.inFamilyTerminology(d[h].plmType)&&!1===p.checkMoveOrCopyAcrossSharedAndPersonal(d[h],u,"COPY"==g))return;u.getParent();var f=[],y=[],v=[],T=[],C=d.length;C>0?d.forEach(function(e){f.push(UWA.is(e.id)?e.id:e.options.resourceid),s.isTerm(e.plmType)?(y.push(UWA.is(e.id)?e.id:e.options.resourceid),v.push(e)):s.isTerminology(e.plmType)?"Terminology"===e.plmType&&y.push(UWA.is(e.id)?e.id:e.options.resourceid):T.push(UWA.is(e.id)?e.id:e.options.resourceid)}):(f.push(d),"Terminology"==node.plmType?(y.push(d.id),v.push(d)):s.isTerminology(node.plmType)||T.push(d.id));var S=y.length;T.length;if(u){if("COPY"==g){if(y.length>0){var b=function(e){l.CopyTerminology({physicalIds:y,targetPhysicalId:u,withContent:e,callbacks:{onComplete:function(e){c.getContent().loadContentAndSelect(t),o.displayNotification({message:a.replace(a.msg_info_terminologycopied,{number:S,terminologyname:u.options.label}),className:"success"}),null!==t&&t.isExpanded()&&UWA.is(c.getTreeCont())&&c.getTreeCont().updateTreeWithNewTerminology(t)},onFailure:function(e){e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500")?o.displayNotification({title:a.msg_error_objectNoLongerAccessible.Title,subtitle:a.msg_error_objectNoLongerAccessible.Advice,message:a.msg_error_objectNoLongerAccessible.Details,className:"error"}):_("PasteCmd",a.msg_error_CopyTerminology,e)}}})};!function(e){let t=a.replace(a.confirmation_info,{From:"TerminologySection_AllTerminologies"===u.getType()?a.name_Term_type:a.name_Terminology_type,To:"TerminologySection_AllTerminologies"===u.getType()?a.name_Terminology_type:a.name_Term_type});i.launch({title:a.replace(a.confirmation_copyMassive_title,{source:1===y.length?d[0].getLabel():a.name_Section_AllTerminologies,target:u.getLabel()}),confirmLabel:a.confirmation_copy,infoTitle:l.isSourceAndTargetTypeSame(d,u)?null:t,mainDivContent:{divHeaderShow:e,checkBoxParams:{label:a.confirmation_copyMassive_checkBox}}},function(){i.getChkBoxCheckedFlag()?b(!0):b(!1)},function(){})}()}T.length>0&&(!function(e,t,o,n){if(o.id===t.id){if(UWA.is(n,"array"))for(var i=0;i<n.length;i++)if("CUT"!==e){var r=c.getContent().getPADTreeDocument().searchRootById(n[i].getID());if(UWA.is(r))return!1}else if(n[i].plmType)return!1}else if("CUT"===e&&!s.isTerminology(t.getType())&&UWA.is(n,"array")&&1===n.length&&n[0]===t){var a=t.getParent();if(a&&a.id===o.id)return!1}return!0}(g,n,u,d)?o.displayNotification({message:a.msg_error_MoveInSameterminology,className:"error"}):l.AddContent({IDs:T,terminology:u,callbacks:{onComplete:function(e){var t,n,i="";if(e){var l=JSON.parse(e);t=l.objectsAlreadyPresent,n=l.objectsAdded,i=l.information?" ("+l.information+")":i}0!==t?o.displayNotification({message:a.replace(a.msg_info_Addinterminology,{objectsAlreadyPresent:t,objectsAdded:n,targetterminology:u.options.label})+i,className:"success"}):o.displayNotification({message:a.replace(a.msg_info_Addinterminology_1,{objectsAdded:n,targetterminology:u.options.label})+i,className:"success"});var s=r.getCurrentTerminology();s.id===u.id&&c.getContent().loadContentAndSelect(s,f[C-1])},onFailure:function(e){e&&e.message&&e.message.contains("NetworkError")&&e.message.contains("500")?o.displayNotification({title:a.msg_error_objectNoLongerAccessible.Title,subtitle:a.msg_error_objectNoLongerAccessible.Advice,message:a.msg_error_objectNoLongerAccessible.Details,className:"error"}):_("PasteCmd",a.msg_error_Addinterminology,e)}}}))}}else o.displayNotification({message:a.msg_warning_nocurrentterminology,className:"warning"})}},ExpandAllCmd:function(e,t){e.plmType;var n=[];"TREE"===t&&e?n.push(e):n=r.getCurrentSelection();var i=null;i=r.getCurrentTerminology(),n.length?n.forEach(function(e){null===e.options.children||("TREE"===t||"Terminology"===e.plmType||"TerminologySection_AllTerminologies"===e.plmType?e.expand({expandLevel:0}):e.expandAll())}):null===i?o.displayNotification({message:a.msg_warning_nocurrentterminology,className:"warning"}):i.expandAll()},CollapseAllCmd:function(e,t){e.plmType;var n=[],i=r.getCurrentTerminology();"TREE"===t&&e?n.push(e):n=r.getCurrentSelection(),n.length?n.forEach(function(e){e.collapseAll()}):null===i?o.displayNotification({message:a.msg_warning_noselection,className:"warning"}):i.collapseAll()},AccessRightCmd:function(e){T.launchCommand("ActionBar_AccessRightCmd",e)},GetContextualMenu:function(e,t,o){var n,i=!!e.white_Click&&e.white_Click,a=o?c.getContent().getSelectedNodes():[];return void 0===(n=!0===i?n=r.getCurrentTerminology():a&&a.length>0?a:e.nodeModel)&&(n=e),Array.isArray(n)||(n=[n]),o||(o={cellInfos:e,data:{event:{pageX:0,pageY:0}}}),T.getContextualMenu(n,"TREE"===t,o)},showWebInWinCtxMenu:function(e,t){var o=t;if(o&&o.actions){var n=[];o.actions.forEach(function(e,t){e.actions&&e.actions.forEach(function(e){if(e.items){var t=[];e.items.forEach(function(e){"DS/ResultWebInWin/ResultWebInWinAction"==e.sourcejs&&t.push({text:e.title,icon:e.image,items:e.items,handler:function(t){var o=[r.getCurrentSelection()[0].getID()];v.publish("onActionContextualMenu",{header:e.id,ids:o})}})}),"DS/ResultWebInWin/ResultWebInWinAction"==e.sourcejs&&n.push({text:e.title,icon:e.image,items:t,handler:function(t){var o=[r.getCurrentSelection()[0].getID()];v.publish("onActionContextualMenu",{header:e.id,ids:o})}})}else"DS/ResultWebInWin/ResultWebInWinAction"==e.sourcejs&&n.push({text:e.title,icon:e.image,handler:function(t){var o=[r.getCurrentSelection()[0].getID()];v.publish("onActionContextualMenu",{header:e.id,ids:o})}})})}),this._initDropDown(n)}},_initDropDown:function(e){if(C){this.dropDown&&(this.dropDown.destroy(),this.dropDown=null);var t={items:e,target:C,contextual:!1,bound:!1};this.dropDown=new y(t),this.dropDown&&this.dropDown.show()}},getCtxMenu:function(e){var t=this;return new Promise(function(o,n){var i=null,a=null;C=e.infos?e.infos.target:void 0,i=e.graphview?(a=e.graphview).node:e.treeview?(a=e.treeview).nodeModel?a.nodeModel:a.cellModel:(a=e.cellInfos)?a.nodeModel?a.nodeModel:a.cellModel:null;var l=!0===widget.getValue("noCompass"),s=!0===widget.getValue("standalone"),d=f.isSolidworksEnvironment();if(l&&null!==i&&"object"==typeof i&&(!d&&!s))return v.publish("Create_ContextMenu",{ids:i?[i.id]:[]}),i&&!1===i.isSelected()&&i.select(!0),void o(void 0);null==a&&(a=r.getCurrentTerminology());var c=a.rowID<0;if(a.cellView||({},e.graphview&&i||(a.white_Click=!0)),i&&"Busy"===i.plmType)o(void 0);else{var g=null;a.white_Click||1==c?g=a:i&&(!1===i.isSelected()&&i.select(!0),!0===i.isSelected()&&(g=e.graphview?i:a)),t.GetContextualMenu(g,"CONTENT",e).then(o).catch(n)}})},_createLink:function(e,t){var n=null,i=null,l=null,s="";if(e){if("Terminology"==e.getType()||"Term"==e.getType())i=e.getID(),l=e.getLabel();else if("Content"==e.getType()){s=e.getID();var d=r.getCurrentTerminology();i=d.getID(),l=d.getLabel(),c[0].getLabel()}}else{var c=r.getCurrentSelection();if(1==c.length){var g="function"==typeof c[0].getType?c[0].getType():c[0].plmType;"Terminology"!=g&&"Term"!=g||(i=c[0].getID(),l=c[0].getLabel())}}null!=i&&f.getSourceUrlAsync({platformId:f.getTenantID(),source:"3DDashboard",onComplete:function(e){var t={data:{items:[{objectId:i,contentId:s,envId:widget.getValue("x3dPlatformId")}]}};n=e+"#app:ENOTERME_AP/content:X3DContentId="+encodeURIComponent(JSON.stringify(t)),!p.copyTexttoCLipboard(n)||"Term"!=g&&"Terminology"!=g?o.displayNotification({message:a.msg_error_copyLink,className:"error"}):o.displayNotification({message:a.replace(a.msg_success_copyLink_terminology,{terminologyname:l}),className:"success"})}})},_createTerm:function(e,t){return new Promise(t=>{var n={onClose:t,onYesCallback:function(t){return new Promise(function(n,i){var l="",d=[];if(e)d=e;else{d=c.getContent().getSelectedNodes();var g=r.getCurrentTerminology();d=d.length>0?d:[g]}if(1!=d.length)i({err:"error",serverErr:"invalid Selection"});else{var u=d[0];(s.isTerminology(u.getType())||s.isTerm(u.getType()))&&(l=u.getID())}var m={parentID:l,title:t.title,description:t.description,name:"Term"+Math.floor(100*Math.random()),onComplete:function(e){o.displayNotification({message:a.replace(a.msg_success_createTerm,{termName:m.title}),className:"success"}),UWA.is(c.getTreeCont())&&UWA.is(c.getContent())&&(c.getTreeCont().updateTreeWithNewTerminology(d[0]),e=UWA.is(e,"string")?JSON.parse(e):e,c.getContent().loadContentAndSelect(g,e.member[0].id)),n(e)},onFailure:function(e,t){var n="string"==typeof t?JSON.parse(t):t,r=n.hasOwnProperty("message")?"\n"+n.message:"";o.displayNotification({message:a.replace(a.msg_error_createTerm,{termName:m.title})+r,className:"error"}),i({err:e,serverErr:t})}};h.createTerm(m)})}},i={type:"Term",container:widget.body,callbacks:n};new g(i)})},_createTerminology:function(e,t){return new Promise(t=>{var n={onClose:t,onYesCallback:function(t){var n=[];if(e)n=e;else{n=c.getContent().getSelectedNodes();var i=r.getCurrentTerminology();n=n.length>0?n:[i]}var l={title:t.title,description:t.description,name:"Terminology"+Math.floor(100*Math.random())};return new Promise(function(e,t){l.onComplete=function(t){o.displayNotification({message:a.replace(a.msg_success_createTerminology,{terminologyName:l.title}),className:"success"}),UWA.is(c.getTreeCont())&&UWA.is(c.getContent())&&(c.getTreeCont().updateTreeWithNewTerminology(n[0]),t=UWA.is(t,"string")?JSON.parse(t):t,c.getContent().loadContentAndSelect(i,t.member[0].id)),e(t)},l.onFailure=function(e,n){var i="string"==typeof n?JSON.parse(n):n,r=i.hasOwnProperty("message")?"\n"+i.message:"";o.displayNotification({message:a.replace(a.msg_error_createTerminology,{terminologyName:l.title})+r,className:"error"}),t({err:e,serverErr:n})},h.createTerminologie(l)})}},i={type:"Terminology",container:widget.body,callbacks:n};new g(i)})}}}),define("DS/TerminologyEditor/commands/ActionBar_CopyCmd",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n.CopyCmd()},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getCurrentSelection();if(!e.length||!e[0]||e[0].plmType&&"Content"!==e[0].plmType){var t=n.getCurrentTerminology();o.ExpandAllCmd(t,"TREE")}else{var i=e[0];o.ExpandAllCmd(i,"CONTENT")}},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_NewTerminologyCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Create Terminology"),isInsert:!0,datas:{type:"Terminology"},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){},execute:function(){o._createTerminology().then(this.end())},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_PasteCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/bsd_utils/BSDContext","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o,n,i){"use strict";return t.extend({labelTopBar:e.i18n("Copy"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=void 0,t=o.get().getSelectedNodes();1===t.length&&n.inFamilyTerminology(t[0].plmType)&&(e=t[0]),i.PasteCmd(e)},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_NewTermCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o){"use strict";return t.extend({labelTopBar:e.i18n("Create Term"),isInsert:!0,datas:{type:"Term"},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!0})},beginExecute:function(){},execute:function(){o._createTerm().then(this.end()),console.log("ExecuteTermCreation")},endExecute:function(){this._parent()}})}),define("DS/TerminologyEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/Terminology_CSO"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Collapse All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=n.getCurrentSelection();if(!e.length||!e[0]||e[0].plmType&&"Content"!==e[0].plmType){var t=n.getCurrentTerminology();o.CollapseAllCmd(t,"TREE")}else{var i=e[0];o.CollapseAllCmd(i,"CONTENT")}},endExecute:function(){}})}),define("DS/TerminologyEditor/commands/ActionBar_ShareTerminologyLink",["UWA/Core","DS/ApplicationFrame/Command","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/commands/TerminologyCommands"],function(e,t,o,n){"use strict";return t.extend({labelTopBar:e.i18n("Share Terminology Link"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){n._createLink()},endExecute:function(){}})}),define("DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode",["DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyEditorWebService","UWA/Core"],function(e,t,o,n,i){"use strict";var r=function(e){var t="TREE"==e?o.getTreeCont():o.getContent();if(t){var n=t.getGridViewRowHeight(),i=t.getContentHeight();if(n&&i)return Math.ceil(i/n)+10}return 25};return i.extend(n,{getContentReadMode:function(o){var n={};i.extend(n,o);var a=t.get3DSearchUrl()+"/search";n.payload={},n.payload.select_predicate=t.getIndexPredicates(),n.payload.query=-1==o.content?"NOT(physicalid:"+o.pid+")":"NOT(physicalid:"+o.pid+') AND NOT(type == "Term")';var l=new Date,s=Math.random().toString(36).substring(2,11);n.payload.label=("Terminology_getContentReadMode"+s+"_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var d=widget.lang?widget.lang:widget.getValue("lang");null!==o.next_start?n.payload.next_start=o.next_start:n.payload.start=0,n.filters&&(n.payload.refine=n.filters),n.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0},search_in_context:{expand:{root_physicalid:o.pid,expand_iter:"1"}}}},n.payload.nresults=r(),n.payload.locale=d,n.payload.tenant=e.getTenantID(),n.payload.select_file=["icon","thumbnail_2d"],n.payload.source=["3dspace"],n.payload.with_Idx_Search="true",n.payload.with_indexing_date="false",!0!==n.synthesis&&(n.payload.with_synthesis="false");var c=require("DS/TerminologyEditor/utils/TerminologyEditorUtil").getContentSortmodel();return c&&c.length>0&&(n.payload.order_by=c[0].sort,n.payload.order_field="tree"==c[0].dataIndex?"ds6w:label":c[0].dataIndex),n.payload.login={"3dspace":{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")}},n.headers={"content-type":"application/json"},n.data=i.Json.encode(n.payload),n.method="POST",n.timeout=12e4,this._executeRequest(a,n,"getContentReadMode")},getRoots:function(n){var a={};i.extend(a,n);var l=t.get3DSearchUrl()+"/search";if(a.payload={},a.payload.select_predicate=["ds6w:label","physicalid","mxid","ds6w:type","ds6w:classification","icon_2ddefaultthb.subtype","ds6w:status","ds6w:description","ds6w:responsible","ds6w:modified","ds6w:created","ds6w:identifier","flattenedtaxonomies"],n.contentView){var s=require("DS/TerminologyEditor/utils/TerminologyEditorUtil").getContentSortmodel();!0!==a.synthesis&&(a.payload.with_synthesis="false"),s&&s.length>0&&(a.payload.order_by=s[0].sort,a.payload.order_field="tree"==s[0].dataIndex?"ds6w:label":s[0].dataIndex),a.payload.select_predicate=t.getIndexPredicates(),n.next_start?a.payload.next_start=n.next_start:a.payload.start=0,a.payload.nresults=r()}else{var d=o.getTreeCont()._terminologies_SortElmt;a.payload.order_by=d.sortOrder,a.payload.order_field="alpha"==d.sortMode?"ds6w:label":"ds6w:modified";var c=o.getTreeCont()._indexModeforReadData.getNextStart();a.payload.start=c,a.payload.nresults=r("TREE")}a.filters&&(a.payload.refine=a.filters),a.payload.query='flattenedtaxonomies:"types/Terminology"';var g=new Date,u=Math.random().toString(36).substring(2,11);a.payload.label=("Terminology_read_getRoots"+u+"_"+g.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-");var m=widget.lang?widget.lang:widget.getValue("lang");return a.payload.locale=m,a.payload.tenant=e.getTenantID(),a.payload.select_file=["icon","thumbnail_2d"],a.payload.source=["3dspace"],a.payload.indexmode="true",a.payload.login={"3dspace":{SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL")}},a.headers={"content-type":"application/json"},a.data=i.Json.encode(a.payload),a.method="POST",a.timeout=12e4,this._executeRequest(l,a,"Terminology_read_getRoots")},expandTerminology:function(n){var r={},a=this.get3DSpaceUrl()+"/cvservlet/expand?SecurityContext=ctx::"+widget.getValue("xPref_CREDENTIAL");r={};i.extend(r,n);var l=new Date,s=Math.random().toString(36).substring(2,11);r.payload={},r.payload.label=("TerminologyWidgetSearch_"+s+"_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),r.payload.select_bo=t.getIndexPredicates(),r.payload.expand_iter=r.level.toString(),r.payload["3dspace"]=["3dspace"];var d=o.getTreeCont()._terminologies_SortElmt;r.payload.order_by=d.sortOrder,r.payload.order_field="alpha"==d.sortMode?"ds6w:label":"ds6w:modified",r.payload.multi_root_physicalid=r.multi_root_physicalid,r.payload["q.iterative_filter_query_bo"]='flattenedtaxonomies:"types/Terminology" OR flattenedtaxonomies:"types/Term" ';var c=widget.lang?widget.lang:widget.getValue("lang");return r.payload.locale=c,r.payload.tenant=e.getTenantID(),r.headers={"content-type":"application/json"},r.headers={SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),"content-type":"application/json"},r.data=i.Json.encode(r.payload),r.method="POST",r.timeout=12e4,this._executeRequest(a,r,"getRoots")},getTerminologyPathsforItems:function(o){var n={};if(i.extend(n,o),!i.is(n,"object"))throw new Error("Invalid inputs for TerminologyEditorWebService.getTerminologyPathsforItems");var r=this.get3DSpaceUrl()+"/cvservlet/navigate",a=widget.lang?widget.lang:widget.getValue("lang");n.payload={},n.payload.locale=a,n.payload.tenant=e.getTenantID(),n.query={SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),tenant:e.getTenantID()},n.payload.input_physical_ids=o.ids,n.payload.attributes=t.getIndexPredicates(),n.payload.version=3,n.payload.primitives=[{navigate_from_rel:{id:1,filter:{bo_type:["Terminology","Term"]}}}],n.payload.patterns={GET_PARENT:[{id:1,iter:-1}]},n.payload.patternFlags={GET_PARENT:{flags:["returnPaths"]}},n.payload.source=["3dspace"];var l=new Date;return n.payload.label=("terminologyWidgetNavigate_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),n.timeout=12e4,n.payload.start=0,n.method="POST",n.headers={Accept:"application/json","content-type":"application/json","Accept-Language":a},n.type="json",n.data=i.Json.encode(n.payload),this._executeRequest(r,n,"getTerminologyPathsforItems")},listContent_ExpandLevel_1:function(o){var n={},r=this.get3DSpaceUrl()+"/cvservlet/expand?SecurityContext=ctx::"+widget.getValue("xPref_CREDENTIAL");n={};i.extend(n,o);var a=new Date,l=Math.random().toString(36).substring(2,11);n.payload={},n.payload.label=("listContent_ExpandLevel_1"+l+"_"+a.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),n.payload.select_bo=t.getIndexPredicates(),n.payload.compute_select_bo=["icon","thumbnail_2d"],o.content||(n.payload.no_type_filter_bo=["Terminology","Term"]),n.payload.expand_iter="1",n.payload["3dspace"]=["3dspace"];var s=require("DS/TerminologyEditor/utils/TerminologyEditorUtil").getContentSortmodel();s&&s.length>0&&(n.payload.order_by=s[0].sort,n.payload.order_field="tree"==s[0].dataIndex?"ds6w:label":s[0].dataIndex),n.payload.root_physicalid=n.pid;var d=widget.lang?widget.lang:widget.getValue("lang");return n.payload.locale=d,n.payload.tenant=e.getTenantID(),n.headers={SecurityContext:"ctx::"+widget.getValue("xPref_CREDENTIAL"),"content-type":"application/json"},n.data=i.Json.encode(n.payload),n.method="POST",n.timeout=12e4,this._executeRequest(r,n,"getRoots")},filterTerminology:function(e){if(!i.is(e,"object"))throw new Error("Invalid inputs for TerminologyEditorWebService.content");var t={};i.extend(t,e);var o,n=this.get3DSpaceUrl()+"/resources/v1/TerminologyManagement/Terminology/"+t.pid+"/filterTerminology";return t.data={IDs:(o=t.prd,i.is(o,"array")?o.toString():o)},t.headers={"content-type":"application/json"},t.data=i.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(n,t,"filterTerminology")}})}),define("DS/TerminologyEditor/controllers/CommonMode",["UWA/Controls/Abstract","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t){var o=[];return e.extend({init:function(e){this._parent(e),this._contentHandleRequest=null},cancelQuery:function(){this._contentHandleRequest&&this._contentHandleRequest.cancel(),this._contentHandleRequest=null},loadContents:function(){o.forEach(e=>{e.cancelQuery()}),o=[]},loadContent:function(){var e=this.loadContents.apply(this,arguments);return e&&e.finally(()=>{this._contentHandleRequest=null}),o.push(this),e},disable:function(){this.cancelQuery()}})}),define("DS/TerminologyEditor/service/TerminologyDnDServices",["DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/TerminologyEditor/Terminology_CSO","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/UIKIT/Mask","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologySearch","DS/WidgetServices/WidgetServices","DS/PlatformAPI/PlatformAPI"],function(e,t,o,n,i,r,a,l,s,d,c,g,u){"use strict";var m=!1,p="";return{setStartDrag:function(e){m=!0===e},isDragging:function(){return m},setDragFrom:function(e){p=e},getDragFrom:function(e){return p},shouldAcceptDrag:function(){return!d.isRelationsColumnsActive()||!o.isRelationsGroupNodeSelected()},retrieveDroppedDataFromDropEvent:function(e){for(var t,o=UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",n="",i=["text/searchitems","text/plain","Text"],r=0;r<i.length&&""===n;r++){var a=e.dataTransfer.types[o](i[r]);(UWA.is(a,"number")&&a>=0||UWA.is(a,"boolean")&&!0===a)&&(n=i[r])}if(""===n)throw new Error("Unknown type in DnD");return t=e.dataTransfer.getData(n),JSON.parse(t)},hasFilesInEvent:function(e){var t=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null;if(t){if(t.items||!t.types||!t.types[0]||"application/x-moz-file"!==t.types[0]&&"Files"!==t.types[0]){var o=e.dataTransfer.types[UWA.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains"]("Files");return!!(UWA.is(o,"number")&&o>=0||UWA.is(o,"boolean")&&!0===o)}return!0}return!1},isExternalDroppedDataOnTerminologyEditor:function(e){var t=!0;return e&&e.widget_id&&e.widget_id==this.getWidgetId()&&(t=!1),t},isExternalDroppedDataFromSameSource:function(e){var t=!1;return e&&e.source&&"ENOTERME_AP"==e.source&&(t=!0),t},getSortedDroppedDataByType:function(e,t){var o=[],n=[],i=[];if(e&&e.data&&e.data.items&&Array.isArray(e.data.items)){for(var a=0;a<e.data.items.length;a++){var l=e.data.items[a],s=l.objectId,d=l.objectType_Internal;if(d||(d=l.objectType),Array.isArray(d)){for(var c=d.length,g=c>0?d[c-1]:void 0,u=0;u<c;++u)if(r.inFamilyTerminology(d[u])){g=d[u];break}d=g}var m=l.displayName;m||(m=d),m||(m=s);var p=l.terminologyId,h=l.envId,f={droppedItem_id:s,droppedItem_type:d,droppedItem_name:m,droppedSourceTerminology_id:p,droppedItem_serviceId:l.serviceId,droppedItem_tenantId:h,droppedItem_terminologyClassification:l.terminologyClassification};r.isTerminology(d)?o.push(f):r.isTerm(d)?n.push(f):i.push(f)}t.RootTerminology_itemList=o,t.Terminology_itemList=n,t.Content_itemList=i}},getWidgetId:function(){return self.widget.id},isMoveDnDSetting:function(){return"Move"===self.widget.getValue("drag-and-drop")&&!c.isSearchActive()},getDragDataForSelectedNodesInCurrentTerminologyContent:function(e){var t=null,n=o.getCurrentTerminology();n&&!n.isRoot()&&r.inFamilyTerminology(n.plmType)&&(t=n.getID());for(var i=o.getCurrentTerminologyPath(),a=[],s=Array.isArray(i)?i.length:0,d=0;d<s;d++){var c=i[d];if(!r.inFamilyTerminology(c.type))break;a.push({resourceid:c.id,type:c.type})}var u=[];return(e&&e.draggedNodes?e.draggedNodes:l.getContent().getSelectedNodes()).forEach(function(e){if(e){var o=e.options.type,n={envId:g.getTenantID(),serviceId:"3DSpace",contextId:(widget.getValue("xPref_CREDENTIAL"),"ctx::"+widget.getValue("xPref_CREDENTIAL")),objectId:e.getID(),objectType:o,displayName:e.getLabel(),displayType:e.options.grid["ds6w:type"],terminologyClassification:e.options.grid.terminologyClassification,terminologyId:t};if(!r.inFamilyTerminology(o)){var i=e.getOccurencePathWithType?e.getOccurencePathWithType():void 0;e.isRelationsObjectNode?n.path=[i[i.length-1]]:n.path=i}u.push(n)}}),{protocol:"3DXContent",version:"1.1",source:"ENOTERME_AP",widget_id:this.getWidgetId(),data:{items:u}}},uploadTerminologiesInTerminology:function(e,t){},addContentInTerminology:function(t,d,c,g,u){var m=this;return s._startProgressBar(n.Paste_content_loading),new Promise(function(p,h){if(t&&t.plmType&&r.inFamilyTerminology(t.plmType)&&c){if(t.id===d)return s._offProgressBar(),e.displayNotification({message:n.msg_error_MoveInSameterminology,className:"error"}),void h();var f=c,y=f.length;if(y<1)return console.log("  Error in TerminologyDnDServices.addContentInTerminology, lContentId list is empty"),void h();var v=!1,T=null;if((!0===m.isMoveDnDSetting()&&!0!==g||u)&&d)if(u)T={id:d},v=!0;else{var _=o.getCurrentTerminology();_&&_.id===d&&(T=_,v=!0)}v&&T?i.MoveContent({IDs:f,targetterminology:t,sourceterminology:T,callbacks:{onComplete:function(i){p();var r=l.getContent(),c=o.getCurrentTerminology();if(r&&c){var g;if(s._endProgressBarListener(),c.id===d)(g=r.getPADTreeDocument())&&g.keepExpandedState(),r.loadContentAndSelect(c);if(c.id===t.id)(g=r.getPADTreeDocument())&&g.keepExpandedState(),r.loadContentAndSelect(c,f[y-1]),a.unmask(r._contentDiv)}var u=JSON.parse(i),m=u.objectsAlreadyPresent,h=u.objectsMoved;0!==m?e.displayNotification({message:n.replace(n.msg_info_objetmoved,{objectsAlreadyPresent:m,objectsMoved:h,targetterminology:t.options.label}),className:"success"}):e.displayNotification({message:n.replace(n.msg_info_objetmoved_1,{objectsMoved:h,targetterminology:t.options.label}),className:"success"})},onFailure:function(i){h();var r=l.getContent(),d=o.getCurrentTerminology();s._offProgressBar(),r&&d&&d.id===t.id&&a.unmask(r._contentDiv),i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500")?e.displayNotification({title:n.msg_error_objectNoLongerAccessible.Title,subtitle:n.msg_error_objectNoLongerAccessible.Advice,message:n.msg_error_objectNoLongerAccessible.Details,className:"error"}):e.displayNotification({message:i?n.msg_error_MoveInterminology+"<br>"+i:n.msg_error_MoveInterminology,className:"error"})}}}):i.AddContent({IDs:f,terminology:t,callbacks:{onComplete:function(i){h();var r=l.getContent(),d=o.getCurrentTerminology();if(r&&d)if(d.id===t.id){s._endProgressBarListener();var c=r.getPADTreeDocument();c&&c.keepExpandedState(),r.loadContentAndSelect(d,f[y-1]),a.unmask(r._contentDiv)}else s._offProgressBar();else s._offProgressBar();var g,u,m="";if(i){var p=JSON.parse(i);g=p.objectsAlreadyPresent,u=p.objectsAdded,m=p.information?" ("+p.information+")":m}0!==g?e.displayNotification({message:n.replace(n.msg_info_Addinterminology,{objectsAlreadyPresent:g,objectsAdded:u,targetterminology:t.options.label})+m,className:"success"}):e.displayNotification({message:n.replace(n.msg_info_Addinterminology_1,{objectsAdded:u,targetterminology:t.options.label})+m,className:"success"})},onFailure:function(i){h();var r=l.getContent(),d=o.getCurrentTerminology();s._offProgressBar(),r&&d&&d.id===t.id&&a.unmask(r._contentDiv),i&&i.advice?e.displayNotification({title:n.msg_error_Addinterminology,subtitle:i.advice,message:i.error,className:"error"}):i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500")?e.displayNotification({title:n.msg_error_objectNoLongerAccessible.Title,subtitle:n.msg_error_objectNoLongerAccessible.Advice,message:n.msg_error_objectNoLongerAccessible.Details,className:"error"}):e.displayNotification({message:i?n.msg_error_Addinterminology+"<br>"+i:n.msg_error_Addinterminology,className:"error"})}}})}else s._offProgressBar(),console.log("  Error in TerminologyDnDServices.addContentInTerminology, dropTarget_TerminologyNodeModel is not a Terminology"),h()})},addTerminologiesInTerminology:function(t,d,c,g,u){var m=this;return new Promise(function(p,h){if(t&&t.plmType&&r.inFamilyTerminology(t.plmType)&&c){s._startProgressBar(n.Paste_content_loading);var f=c,y=f.length;if(y<1)return console.warn("  Error in TerminologyDnDServices.addTerminologiesInTerminology, lContentId list is empty"),void h();var v=!1;if((!0===m.isMoveDnDSetting()&&!0!==g||u)&&(v=!0),v){if(t.id===d)return s._offProgressBar(),e.displayNotification({message:n.msg_error_MoveInSameterminology,className:"error"}),void h();for(var T=0;T<f.length;T++){var _,C=f[T];if(t.id===C)return s._offProgressBar(),e.displayNotification({message:n.msg_error_MoveInSameterminology,className:"error"}),void h();var S=l.getTreeCont();if(S&&(_=S._getVisibleNodeById(C,null)),_&&_.isAscendantOf(t))return s._offProgressBar(),e.displayNotification({message:n.msg_error_MoveTerminology,className:"error"}),void h()}i.MoveTerminology({IDs:f,targetterminology:t,selectedIds:f,callbacks:{onComplete:function(i){p();var r=o.getCurrentTerminology(),c=!1,g=!1;r&&(-1!=f.indexOf(r.id)&&(c=!0,g=!0));var u=l.getTreeCont();if(u){var m=u._getVisibleNodeById(d,null);f.forEach(function(e){var t=u._getVisibleNodeById(e,m);t&&l.getTreeCont().removeFromTree(t)});var h=u._getVisibleNodeById(t.id,null);if(h&&h.isExpanded())c&&g&&r.id,h.collapse(),h.expand(),null&&(g=!1)}var v=l.getContent();if(v&&r)if(r.id===d)s._endProgressBarListener(),(T=v.getPADTreeDocument())&&T.keepExpandedState(),v.loadContentAndSelect(r);else if(r.id===t.id){var T;s._endProgressBarListener(),(T=v.getPADTreeDocument())&&T.keepExpandedState(),v.loadContentAndSelect(r,f[y-1]),a.unmask(v._contentDiv)}else s._offProgressBar(),c&&g&&(r.unselect(),t.select(),r=null,g=!1);else s._offProgressBar();e.displayNotification({message:n.replace(n.msg_info_terminologymoved,{number:f.length,terminologyname:t.options.label}),className:"success"})},onFailure:function(i){h();var r=l.getContent(),d=o.getCurrentTerminology();r&&d&&d.id===t.id&&a.unmask(r._contentDiv),s._offProgressBar(),i&&i.advice?e.displayNotification({title:n.msg_error_MoveTerminology,subtitle:i.advice,message:i.error,className:"error"}):i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500")?e.displayNotification({title:n.msg_error_objectNoLongerAccessible.Title,subtitle:n.msg_error_objectNoLongerAccessible.Advice,message:n.msg_error_objectNoLongerAccessible.Details,className:"error"}):e.displayNotification({message:i?n.msg_error_MoveTerminology+"<br>"+i:n.msg_error_MoveTerminology,className:"error"})}}})}else i.CopyTerminology({IDs:f,targetterminology:t,selectedIds:f,callbacks:{onComplete:function(i){h();var r=l.getTreeCont();if(r){var d=r._getVisibleNodeById(t.id,null);d&&d.isExpanded()&&r.updateTreeWithNewTerminology(d)}var c=l.getContent(),g=o.getCurrentTerminology();if(c&&g)if(g.id===t.id){s._endProgressBarListener();var u=c.getPADTreeDocument();u&&u.keepExpandedState(),c.loadContentAndSelect(g,f[y-1]),a.unmask(c._contentDiv)}else s._offProgressBar();else s._offProgressBar();e.displayNotification({message:n.replace(n.msg_info_terminologycopied,{number:f.length,terminologyname:t.options.label}),className:"success"})},onFailure:function(i){h();var r=l.getContent(),d=o.getCurrentTerminology();s._offProgressBar(),r&&d&&d.id===t.id&&a.unmask(r._contentDiv),i&&i.advice?e.displayNotification({title:n.msg_error_CopyTerminology,subtitle:i.advice,message:i.error,className:"error"}):i&&i.message&&i.message.contains("NetworkError")&&i.message.contains("500")?e.displayNotification({title:n.msg_error_objectNoLongerAccessible.Title,subtitle:n.msg_error_objectNoLongerAccessible.Advice,message:n.msg_error_objectNoLongerAccessible.Details,className:"error"}):e.displayNotification({message:i?n.msg_error_CopyTerminology+"<br>"+i:n.msg_error_CopyTerminology,className:"error"})}}})}else console.warn("  Error in TerminologyDnDServices.addTerminologiesInTerminology, dropTarget_TerminologyNodeModel is not a Terminology or Term"),h()})},processDroppedDataOnTerminologyEditorNode:function(t,o){var i=this;function a(e){if(Array.isArray(e)&&e.length>0)for(var t=g.getTenantID(),o=e.length-1;o>=0;o--){var n=e[o];if(n&&n.droppedItem_tenantId!==t)return!1}return!0}if(o&&t){var l=i.isExternalDroppedDataOnTerminologyEditor(o),s=!1;l&&(s=this.isExternalDroppedDataFromSameSource(o));var c={};i.getSortedDroppedDataByType(o,c);var m=c.RootTerminology_itemList,p=c.Terminology_itemList,h=c.Content_itemList;if(!a(m)||!a(p)||!a(h))return void e.displayNotification({message:n.msg_warning_dndnotsupported_from_different_tenant,className:"warning"});if(!function(e){if(Array.isArray(e)&&e.length>0)for(var t=e.length-1;t>=0;t--){var o=e[t];if(o&&"3DSpace"!==o.droppedItem_serviceId)return!1}return!0}(h))return void e.displayNotification({message:n.msg_warning_dndnotsupported_from_different_source,className:"warning"});r.inFamilyTerminology(t.plmType)?(Array.isArray(m)&&m.length>0&&e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"}),new Promise(function(e,o){var n=p.length+h.length;if(s&&n>0){var i={targetTerminology:t.options.label,noOfObjects:n};d.getAddMovePopupResults(function(t){var n=t;"move"==n?e({isMoveExpectedfromExternalDrop:!0}):"copy"==n?e({isMoveExpectedfromExternalDrop:!1}):o()},i)}else e({isMoveExpectedfromExternalDrop:!1})}).then(function(e){var n=e.isMoveExpectedfromExternalDrop,r=[];if(Array.isArray(p)&&p.length>0)for(;p.length>0&&p[0];){for(var a=p[0].droppedSourceTerminology_id,s=[],c=p.length-1;c>=0;c--){(m=p[c])?m.droppedSourceTerminology_id===a&&(s.push(m.droppedItem_id),p.splice(c,1)):p.splice(c,1)}if(!l&&!d.checkMoveOrCopyAcrossSharedAndPersonal({},t,!i.isMoveDnDSetting()))return;r.push(i.addTerminologiesInTerminology(t,a,s,l,n))}if(Array.isArray(h)&&h.length>0)for(;h.length>0&&h[0];){for(a=h[0].droppedSourceTerminology_id,s=[],c=h.length-1;c>=0;c--){var m;(m=h[c])?m.droppedSourceTerminology_id===a&&(s.push(m.droppedItem_id),h.splice(c,1)):h.splice(c,1)}r.push(i.addContentInTerminology(t,a,s,l,n))}Promise.allSettled(r).then(function(e){if(n){for(var t=!1,i=0;i<e.length;i++)if("fulfilled"==e[i].status){t=!0;break}if(t){var r=o.widget_id+g.getTenantID()+"ENOTERME_AP";u.publish(r)}}}).catch(function(e){})})):console.warn("  TerminologyDnDServices processDroppedDataOnTerminologyEditorNode dropTarget_NodeModel type is not in Terminology family")}else console.warn("  TerminologyDnDServices processDroppedDataOnTerminologyEditorNode invalid argument(s)")},performDropOnTerminologyEditorNode:function(i,a){var l=this,s=!0;i||console.log("  Error in TerminologyDnDServices.performDropOnTerminologyEditorNode, dropTarget_NodeModel is undefined");var d=g.getTenantID(),c=l.hasFilesInEvent(a),u=u||(i?null:n.msg_warning_dndnotsupported);if(u)e.displayNotification({message:u,className:"warning"}),s=!1;else if(r.inFamilyTerminology(i.plmType)){if(c){var m=function(e){for(var t=!1,o=e.dataTransfer.items,n=0;n<o.length;n++){if(o[n].webkitGetAsEntry().isDirectory){t=!0;break}}return t};0!=d.localeCompare("OnPremise")?m(a)&&console.log("dropped Browsing structure / node"):m(a)&&e.displayNotification({message:n.msg_warning_dndWindowsTerminologynotsupported,className:"warning"}),s=!1}}else if(c&&0!=d.localeCompare("OnPremise")){if(c){for(var p=a.dataTransfer.items,h=0;h<p.length;h++){p[h].webkitGetAsEntry().isDirectory&&!0}"TerminologySection_AllTerminologies"==i.plmType&&(s=!1)}}else e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"}),s=!1;var f=null;if(s)try{f=l.retrieveDroppedDataFromDropEvent(a)}catch(t){f=null,s=!1,e.displayNotification({message:n.msg_warning_dndnotsupported,className:"warning"})}if(self.widget&&this.isMoveDnDSetting()&&s&&f&&i&&"bookmark"===this.getDragFrom()&&o.getCurrentTerminology()!==i){var y=o.getCurrentTerminology().getLabel(),v=n.replace(n.confirmation_move_message,{source:y,target:i._options.label});f.hasOwnProperty("data")&&f.data.hasOwnProperty("items")&&(f.data.items.length>1?v=n.replace(n.confirmation_move_message_multisel,{nth:f.data.items.length,source:y,target:i._options.label}):f.data.items[0].hasOwnProperty("displayName")&&(v=f.data.items[0].objectId!==o.getCurrentTerminology().id?n.replace(n.confirmation_move_message_monosel,{selection:f.data.items[0].displayName,source:y,target:i._options.label}):n.replace(n.confirmation_move_message_mono_from_tree,{source:y,target:i._options.label}))),t.launch({title:n.confirmation_move_title,confirmLabel:n.confirmation_move_button,content:v},function(){l.processDroppedDataOnTerminologyEditorNode(i,f)}),l.setDragFrom("")}else s&&f&&i&&l.processDroppedDataOnTerminologyEditorNode(i,f)}}}),define("DS/TerminologyEditor/views/TerminologyGlobalActiveTerminology",["UWA/Core","UWA/Class","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/Controls/TooltipModel","DS/TerminologyEditor/models/xTermNodeModel","DS/Menu/ContextualMenu","DS/TerminologyEditor/commands/TerminologyCommands","DS/WebappsUtils/WebappsUtils","DS/IPClassifyUtil/IPClassifyAlert","DS/Logger/Logger","DS/TerminologyEditor/utils/TerminologyCommunication","DS/PlatformAPI/PlatformAPI","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/WAFData/WAFData","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/WidgetServices/WidgetServices"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f){"use strict";var y={iconName:"pin",fontIconSize:"1x"},v={iconName:"pin-off",fontIconSize:"1x"},T=t.singleton({name:"ActiveTerminology",ICON_ACTIVE:y,ICON_ACTIVE_DISABLED:v,ACTIVE_FOLDER_PREFERENCE:"ActiveTerminology_TerminologyID",DEFAULT_VALUE:"!",_logger:null,_isInitialized:!1,_container:null,_cellElement:null,_nameElement:null,_activeTerminology:{id:null,label:"",node:null,sc:""},_disabledActiveTerminology:{id:null,label:"",node:null,sc:""},_tooltipDisplayButton:null,_tooltipTextSwitch:"",_labelSwitch:null,init:function(e){var t=this;return t._logger=c.getLogger(T),t._logger.log("init"),t._parent(e),t.activeTerminologyCallBack(),this.retrieveActiveTerminologyFromPreference().then(function(e){t._buildSkeleton(),t._isInitialized=!0}),t},_buildSkeleton:function(){var t=this,r=o.getTreeCont().getCommonToolSection().getElement(".findinTree_findcontainer");new e.createElement("div",{class:"div_for_margin"}).inject(r,"before"),this._container=new e.createElement("div",{id:"active_terminology_container"}).inject(r,"before"),this._cellElement=e.createElement("div",{id:"active_terminology_cell",class:"wux-tweakers"}).inject(this._container,"top"),this._activeTerminologyIcon=e.createElement("div",{id:"active_terminology_icon",class:"wux-ui-3ds wux-ui-3ds-bookmark-pin"}).inject(t._cellElement,"bottom"),this._nameElement=e.createElement("div",{id:"active_terminology_label",class:"wux-tweakers wux-tweakers-string wux-tweakers-string-label",events:{click:function(){t.centerTreeToActiveTerminology(null!==t._disabledActiveTerminology.id?t._disabledActiveTerminology.id:t._activeTerminology.id)}}}).inject(t._cellElement,"bottom"),this._nameElement.tooltipInfos=this._tooltipDisplayButton=new i({shortHelp:n.tooltip_noDefaultLocation,initialDelay:0,mouseRelativePosition:!1}),this._dropDownMenu=e.createElement("div",{id:"active_terminology_down_button",class:"fonticon fonticon-down-open",events:{click:function(){var e=new Event("contextmenu");e.pageX=(this.getBoundingClientRect().left+this.getBoundingClientRect().right)/2,e.pageY=(this.getBoundingClientRect().top+this.getBoundingClientRect().bottom)/2,this.dispatchEvent(e)}}}).inject(t._cellElement,"bottom");var a=null!==this._disabledActiveTerminology.id?this._disabledActiveTerminology.label:this._activeTerminology.label;this._updateUI(a),this._buildContextualMenu()},_getNodeModel:function(){var e=null!==this._disabledActiveTerminology.id?this._disabledActiveTerminology:this._activeTerminology,t=new r({resourceid:e.id,label:e.label});return t.getType=(()=>"Terminology"),t},_buildContextualMenu:function(){var e=this;a.addEventListener(this._dropDownMenu,{callback:function(){var t=[],o={type:"PushItem",title:n.CMDUnsetGlobalActiveTerminology,icon:"bookmark-pin",action:{callback:function(){m.addComponentsToLoad("global",{unsetActiveTerminology:n.UnsetActiveTerminology_Loading}),e.unsetActiveTerminology().then(function(){d.displayNotification({message:n.replace(n.msg_info_inactive_successfully,{terminologyLabel:e._activeTerminology.label}),className:"success"}),m.removeComponentToLoad("global","unsetActiveTerminology")},function(e){m.removeComponentToLoad("global","unsetActiveTerminology")})}}},i={type:"PushItem",title:n.CMDShowInTerminologies,icon:"bookmark",action:{callback:function(){var t=null!==e._disabledActiveTerminology.id?e._disabledActiveTerminology.id:e._activeTerminology.id;e.centerTreeToActiveTerminology(t)}}},r={type:"PushItem",title:n.CMDAccessRightCmd,icon:"forward",action:{callback:function(){var t=e._getNodeModel();l.AccessRightCmd(t)}}},a={type:"PushItem",title:n.CMDShareTerminologyLink,icon:"link",action:{callback:function(){var t=e._getNodeModel();l._createLink(t)}}},s=null!==e._disabledActiveTerminology.id?"play":"pause",c={type:"PushItem",title:e._labelSwitch,fonticon:{family:"DSFontIcon",content:"wux-ui-3ds wux-ui-3ds-"+s},tooltip:e._tooltipTextSwitch,action:{callback:function(){e.switchActiveTerminologyState()}}};return t.push(o),t.push(i),t.push(r),t.push(a),f.isReplayedODT()&&t.push(c),t}})},_updateUI:function(e){null!=this._container&&(this._nameElement.setHTML("<p id='active_terminology_label_text'>"+e+"</p>"),this._tooltipDisplayButton.shortHelp=n.replace(n.tooltip_defaultLocation,{terminologyLabel:e}),null==this._disabledActiveTerminology.id?(this._tooltipTextSwitch=n.replace(n.tooltip_disableDefaultLocation,{terminologyLabel:e}),this._labelSwitch=n.CMDDisableGlobalActiveTerminology,this._nameElement.setStyle("color","#368ec4"),this._activeTerminologyIcon.setStyle("color","#368ec4"),this._updateTreeIcons(this._activeTerminology.id,y)):(this._tooltipTextSwitch=n.replace(n.tooltip_enableDefaultLocation,{terminologyLabel:e}),this._labelSwitch=n.CMDEnableGlobalActiveTerminology,this._nameElement.setStyle("color","#b4b6ba"),this._activeTerminologyIcon.setStyle("color","#b4b6ba"),this._updateTreeIcons(this._activeTerminology.id,null),this._updateTreeIcons(this._disabledActiveTerminology.id,v)))},_updateTreeIcons:function(e,t){var n=o.getTreeCont(),i=n._getVisibleNodeById(e,n._rootNodeTerminologies);null!==i&&i.setBadges({topRight:t});var r=o.getContent();r&&r.updateActiveTerminologyNode(null,null===t)},centerTreeToActiveTerminology:function(e){var t=this;if(!t._isExpanding)return t._isExpanding=!0,new Promise(function(n,i){o.getTreeCont().expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e]},onComplete:function(r){!function r(){o.getTreeCont()._getVisibleNodeById(e,null)?(o.getTreeCont().expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e]}}),t._isExpanding=!1,n()):(setTimeout(function(){r()},200),i())}()},onGiveUp:function(e){t._isExpanding=!1,t._unsetAfterError(),i()},onFailure:function(e){t._isExpanding=!1,t._unsetAfterError(),i()}})})},switchActiveTerminologyState:function(){var e=this;null!==this._disabledActiveTerminology.id?(m.addComponentsToLoad("global",{enableActiveTerminology:n.EnableActiveTerminology_Loading}),this._checkTerminologyStatus(this._disabledActiveTerminology.id).then(function(){return e.setActiveTerminology(e._disabledActiveTerminology)}).then(function(){m.removeComponentToLoad("global","enableActiveTerminology"),d.displayNotification({message:n.replace(n.msg_info_enable_successfully,{terminologyLabel:e._activeTerminology.label}),className:"success"})},function(t){e._unsetAfterError(),m.removeComponentToLoad("global","enableActiveTerminology")})):(m.addComponentsToLoad("global",{disableActiveTerminology:n.DisableActiveTerminology_Loading}),this._disabledActiveTerminology=this._activeTerminology,this._checkTerminologyStatus(this._activeTerminology.id).then(function(){return e.unsetActiveTerminology()}).then(function(){return e.services.setUserPreferences(e.ACTIVE_FOLDER_PREFERENCE,e.DEFAULT_VALUE+e._disabledActiveTerminology.id)}).then(function(){m.removeComponentToLoad("global","disableActiveTerminology"),d.displayNotification({message:n.replace(n.msg_info_disable_successfully,{terminologyLabel:e._disabledActiveTerminology.label}),className:"success"})},function(t){e._unsetAfterError(),m.removeComponentToLoad("global","disableActiveTerminology")}))},activeTerminologyCommand:function(e){var t=this,o=t._activeTerminology,i=t._disabledActiveTerminology,r={id:e.getID(),label:e.getLabel(),node:e},a=o.id!==r.id,l=!(i.id===r.id)&&a;l?m.addComponentsToLoad("global",{setActiveTerminology:n.SetActiveTerminology_Loading}):m.addComponentsToLoad("global",{unsetActiveTerminology:n.UnsetActiveTerminology_Loading}),this.unsetActiveTerminology().then(function(){if(!l)return m.removeComponentToLoad("global","unsetActiveTerminology"),d.displayNotification({message:n.replace(n.msg_info_inactive_successfully,{terminologyLabel:r.label}),className:"success"}),!1;t.setActiveTerminology(r).then(function(e){m.removeComponentToLoad("global","setActiveTerminology"),d.displayNotification({message:n.replace(n.msg_info_active_successfully,{terminologyLabel:t._activeTerminology.label}),className:"success"})})})},setActiveTerminology:function(e){var t=this;return t.services.setUserPreferences(t.ACTIVE_FOLDER_PREFERENCE,e.id).then(function(n){return t._activeTerminology=e,null!=t._disabledActiveTerminology.id&&(t._updateTreeIcons(t._disabledActiveTerminology.id,null),t._disabledActiveTerminology={id:null,label:"",node:null,sc:""}),o.setActiveTerminology(t._activeTerminology.id,t._activeTerminology.label,t._activeTerminology.sc,null),t._updateUI(t._activeTerminology.label),null!=t._container&&t._container.show(),t._setCustomSecurityContext(),u.publish("TerminologyEditor.ActiveTerminology",{id:t._activeTerminology.id!==t.DEFAULT_VALUE?t._activeTerminology.id:null,label:t._activeTerminology.label,sc:t._activeTerminology.sc}),n})},unsetActiveTerminology:function(e){var t=this;return t.services.setUserPreferences(t.ACTIVE_FOLDER_PREFERENCE,t.DEFAULT_VALUE).then(function(e){var n=t._activeTerminology.id!=t.DEFAULT_VALUE&&null!=t._activeTerminology.id,i=null!=t._disabledActiveTerminology.id,r=n?t._activeTerminology:i?t._disabledActiveTerminology:null;return null!=r&&t._updateTreeIcons(r.id,null),t._activeTerminology={id:t.DEFAULT_VALUE,label:"",node:null,sc:""},n||(t._disabledActiveTerminology={id:null,label:"",node:null,sc:""}),o.setActiveTerminology(t.DEFAULT_VALUE,"","",t._disabledActiveTerminology.id),n&&t._updateUI(t._disabledActiveTerminology.label),null==t._disabledActiveTerminology.id&&null!=t._container&&t._container.hide(),u.publish("TerminologyEditor.ActiveTerminology",{id:null,label:"",sc:""}),e})},_unsetAfterError:function(e){this._disabledActiveTerminology={id:null,label:"",node:null,sc:""},this.unsetActiveTerminology().then(function(){0!=e&&d.displayNotification({message:n.msg_error_rest_GetActiveTerminology,className:"warning"})})},retrieveActiveTerminologyFromPreference:function(){var e=this;return e._getUserPreference().then(function(t){return t===e.DEFAULT_VALUE&&t.length===e.DEFAULT_VALUE.length?Promise.reject():(t.indexOf(e.DEFAULT_VALUE)>=0&&(t=t.slice(1,t.length),e._disabledActiveTerminology={id:t,label:"",node:null,sc:""}),e._checkTerminologyStatus(t))}).then(function(t){return null!==e._disabledActiveTerminology.id?(e._disabledActiveTerminology.label=t.label,o.setActiveTerminology(e.DEFAULT_VALUE,e._disabledActiveTerminology.label,"",e._disabledActiveTerminology.id),Promise.resolve(t)):(e._activeTerminology=t,e._setCustomSecurityContext(),o.setActiveTerminology(e._activeTerminology.id,e._activeTerminology.label,e._activeTerminology.sc,e._disabledActiveTerminology.id),g.publish("TerminologyEditor.ActiveTerminology",Object.assign({},t,{node:""})),Promise.resolve(t))},function(t){e._unsetAfterError(!1)})},_getUserPreference:function(){var e=this;return e.services.getUserPreferences(e.ACTIVE_FOLDER_PREFERENCE).then(function(e){return e.value}).catch(function(t){return d.displayNotification({message:n.msg_error_rest,className:"error"}),e.DEFAULT_VALUE})},_checkTerminologyStatus:function(e){var t=this;return new Promise(function(o,n){null!==e&&""!==e&&e!==t.DEFAULT_VALUE?t.services.getProperties({terminologyid:e,onComplete:function(e){void 0===e.id?n():o({id:e.id,label:e.label})},onFailure:function(e){n()}}):n()})},_setCustomSecurityContext:function(){this._activeTerminology.sc=""},activeTerminologyCallBack:function(e){var t=this;u.subscribe("TerminologyEditor.ActiveTerminologyCallBack",function(e){null!==e?d.displayNotification({message:n.replace(n.msg_info_defaultLocation,{terminologyLabel:e.label}),className:"info"}):u.publish("TerminologyEditor.ActiveTerminology",{id:t._activeTerminology.id!==t.DEFAULT_VALUE?t._activeTerminology.id:null,label:t._activeTerminology.label,sc:t._activeTerminology.sc})}),u.subscribe("TerminologyEditor.ActiveTerminologyCheck",function(e){t._checkTerminologyStatus(t._activeTerminology.id).then(function(){},function(e){null!==t._disabledActiveTerminology.id?t._checkTerminologyStatus(t._disabledActiveTerminology.id).then(function(){},function(e){t._unsetAfterError()}):t._unsetAfterError()})})},services:{getUserPreferences:function(e){return new Promise(function(t,o){h.getUserPreferences({name:e,onComplete:function(o){t({keyname:e,value:o,message:null})},onFailure:function(t){o({keyname:e,value:null,message:n.msg_error_rest})}})})},setUserPreferences:function(e,t){return new Promise(function(o,i){h.setUserPreferences({name:e,value:t,onComplete:function(n){o({keyname:e,value:t,message:null})},onFailure:function(o){i({keyname:e,value:t,message:n.msg_error_rest})}})})},getProperties:function(e){var t=f.get3DSpaceUrl();"OnPremise"!==widget.getValue("x3dPlatformId")&&(t=t.replace("ifwe","space").replace("3DSpace","enovia"));var o=t+"/resources/v1/TerminologyManagement/Terminology/"+e.terminologyid+"/properties",n={method:"GET",type:"json",headers:{"Content-Type":"application/json",SecurityContext:widget.getPreference("xPref_CREDENTIAL").value},proxy:"passport",timeout:12e4};n.onComplete=e.onComplete,n.onFailure=e.onFailure,p.authenticatedRequest(o,n)}}});return T}),define("DS/TerminologyEditor/models/_xTermCVParser",["DS/TerminologyEditor/models/xTermNodeModel","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/WebappsUtils/WebappsUtils","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/bsd_utils/BSDPredicateNls","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/IPClassifyModelEvents"],function(e,t,o,n,i,r,a,l,s,d){"use strict";var c={COLLAPSED:{state:"collapsed"},NO_CHILDREN:{state:"noChildren"},PARTIALLY_EXPANDED:{state:"partiallyExpanded"},EXPANDED:{state:"expanded"}};Object.freeze(c);var g={},u={};function m(e,t){var o=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var n=0,i=t.length,r=e.getID();do{r===t[n].getID()&&(o=!0),n++}while(!1===o&&n<i)}return o}function p(e,t){for(var o={},n=e||{},i=Object.getOwnPropertyNames(n),r=0;r<i.length;r++)t[i[r]]?t[i[r]]!==e[i[r]]&&(o[i[r]]=e[i[r]]):o[i[r]]=e[i[r]];return o}function h(e,t,o){var r=!1,a=null,l={};t.label!==e.options.label&&(l.label=t.label,!0===n.getWidgetPreferenceValue("tree_order_in_label")&&(l.label+="(treeorder="+t.relationOrder+")"),r=!0),function(e,t){var o=!1;if(e instanceof Array&&t instanceof Array){var n=e.length;if(n===t.length){for(var i=0;i<n;i++)if(e[i]!==t[i])return!1;o=!0}}return o}(t.icons,e.options.icons)||(l.icons=t.icons,r=!0),t.thumbnail!==e.options.thumbnail&&(l.thumbnail=t.thumbnail,r=!0),t.display!==e.options.display&&(l.display=t.display,r=!0),t.type!==e.options.type&&(l.type=t.type,r=!0),null!==a||"expanding"!==e.getState()||o&&!1===o.changeState||(a=c.EXPANDED),e.isRoot()&&(t.grid=t.grid?t.grid:{},t.grid.instanceName||(t.grid.instanceName=""));var s=p(t.grid,e.options.grid);if(UWA.equals(s,{})||(l.grid=s,r=!0),t.padgrid){var d=p(t.padgrid,e.options.padgrid);UWA.equals(d,{})||(l.padgrid=d,r=!0)}r&&(o&&!0===o.deleteTempOptions&&(delete e.options.waiting4validation,delete e.options.alternText),e.updateOptions(l),e._manageNLS=!0,o&&o.needRequestNls&&e.isVisible()&&i.updateNLS(e)),a&&e.setState(a)}return g.buildStructure=function(e){var t={nodes:{},did_to_resourceid:{},structure:{}},o=[],n=[],i=[];e.results.forEach(function(e){if(e.attributes){var r={};e.attributes.forEach(function(e){"resourceid"===e.name||"physicalid"===e.name?r.resourceid=e.value:"did"===e.name&&(r.did=e.value)}),t.nodes[r.resourceid]=r,r.did&&(t.did_to_resourceid[r.did]=r.resourceid)}if(e.path){var a=e.path,l=a.length,s=a[0];if(3===l){a[1];var d=a[2];-1===n.indexOf(d)&&n.push(d)}-1===i.indexOf(s)&&i.push(s),o.push(a)}});var r=[],a=[],l={};try{i.forEach(function(e){0===n.length||-1===n.indexOf(e)?r.push(e):a.push(e),l[e]={children:[]},o.forEach(function(t){3===t.length&&e===t[0]&&l[e].children.push(t)})})}catch(e){console.error(e)}var s={};try{var d=function(e,o){var n=o[1],i=o[2],r=t.did_to_resourceid[n],a=t.did_to_resourceid[i];if(e&&void 0===e[r]&&(e[r]={},e[r][a]={},l[i])){var s=l[i].children;s&&s.forEach(function(t){d(e[r][a],t)})}};r.forEach(function(e){var o=t.did_to_resourceid[e],n={};l[e].children.forEach(function(e){d(n,e)}),s[o]=n})}catch(e){console.error(e)}return s},g.parse_expand=function(e,t,o,n,i){var r={nodes:{},did_to_resourceid:{},structure:{}};return e.forEach(function(e){if(e.attributes){var a=u.parse_attributes(e.attributes,t,o);r.nodes[a.resourceid]=a,UWA.is(a.did)&&(r.did_to_resourceid[a.did]=a.resourceid)}else if(e.path){var l;if(!1===n){l=e.path.length;var s=function(e){if(e){for(var t=Object.getOwnPropertyNames(e),o=0;o<t.length;o++)r.nodes[t[o]]&&(e[r.nodes[t[o]].did]=e[t[o]],delete e[t[o]],UWA.is(e[r.nodes[t[o]].did],"object")&&s(e[r.nodes[t[o]].did]),void 0===e.order&&(e.order=[]),e.order.push(r.nodes[t[o]].did));void 0===e.order&&(e.order=[])}};s(i),r.structure=i}else{var d=r.structure;l=e.path.length,1===Math.abs(l%2)?e.path.forEach(function(e,t){d.hasOwnProperty(e)||(d[e]={},l===t+1&&(d[e].pathLeaf=!0),0===Math.abs(t%2)&&(d[e].order=[])),d.order&&-1===d.order.indexOf(e)&&d.order.push(e),d=d[e]}):!0}}else e.icon__default_thumbnail_2d?e.icon__default_thumbnail_2d.forEach(function(e){e.did.forEach(function(t){var o=r.did_to_resourceid[t],n=r.nodes[o];n.icons&&0!==n.icons.length||(n.icons||(n.icons=[]),n.icons.push(e.icon)),n.thumbnail&&0!==n.thumbnail.length||(n.thumbnail=e.thumbnail_2d,n.grid||(n.grid={}),n.grid.thumbnail=e.thumbnail_2d)})}):e.status&&"EXPAND_WAS_CUT_MAX_OUTPUT_PATHS"===e.status&&(r.status={expandTooLarge:!0})}),r},u.parse_attributes=function(e,t,o){var n={};let i=l.getContent().getPADTreeListView(),r=s._getManipulationColumns();return e.forEach(function(e){if("type"===e.name)e.name="ds6w:type";else if("owner"===e.name)e.name="ds6w:responsible";else{var a=e.name.split("/");e.name=a[a.length-1]}if(UWA.is(e.value)&&UWA.is(e.value.replace,"function")&&(e.value=e.value.replace(/\n/g," ")),"ds6w:type"===e.name&&(n.type=e.value),"resourceid"===e.name||"physicalid"===e.name)n.resourceid=e.value;else if("did"===e.name)n.did=e.value;else if("TreeOrder"===e.name||"ro.plminstance.V_treeorder"===e.name)n.relationOrder=parseFloat(e.value),n.relationOrder=isNaN(n.relationOrder)?-1:n.relationOrder;else if("type_icon_url"===e.name)n.icons||(n.icons=[]),n.icons.push(e.value);else if("preview_url"===e.name||"thumbnail_2d"===e.name)n.thumbnail=e.value,n.grid||(n.grid={}),n.grid.thumbnail=e.value;else if("relcount"===e.name)n.relcount=parseInt(e.value),0===n.relcount&&(n.children=null);else if(o&&e.name===o)n.label=e.value,n.display=n.label;else{var l=e.value;"string"==typeof l&&-1!==l.indexOf("[")&&-1!==l.indexOf("]")&&-1!==(l=(l=l.replace("[","")).replace("]","")).indexOf('"')&&(l=l.replaceAll('"',"")),n.grid||(n.grid={});let o=null,a=null;if(i){-1!==r.indexOf(e.name)&&(o=e.name+"_SortKey",a=l);let t=i.getColumnUnitNls(e.name,!0);t&&(l=l+" "+t)}var s=n.grid[e.name];if(s&&!Array.isArray(s)&&(s=[s]),Array.isArray(s)&&s.push(l),Array.isArray(s)?n.grid[e.name]=s:n.grid[e.name]=l,o){let e=n.grid[o];e&&!Array.isArray(e)&&(e=[e]),Array.isArray(e)&&e.push(a),Array.isArray(e)?n.grid[o]=e:n.grid[o]=a}t&&-1!==t.indexOf(e.name)||(n.padgrid||(n.padgrid={}),l=e.dispValue?e.dispValue:e.value,n.padgrid[e.name]=l)}}),n.relationOrder||(n.relationOrder=-1),n.grid||(n.grid={}),n},u.process={expand:function(o){if(!UWA.is(o.treedocument,"object")||!UWA.is(o.root_nodes,"array")&&!0!==o.root2Create||!UWA.is(o.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(o.response.results,"array"))throw new Error("Invalid response format - results should be an array");o.starting_from_root=void 0===o.starting_from_root||o.starting_from_root;var r=[],l=[],s=n.getWidgetPreferenceValue("activateFUN085903")&&(-1===o.expand_level||o.expand_level>1),c=!0===n.getWidgetPreferenceValue("alwaysExpandPath"),u=o.selectPathLeaf;o.treedocument.prepareBroadcastSelect(),o.treedocument.withTransactionUpdate(function(){var p=null;if("refresh"===o.mode&&!1===o.response.full_path)if(o.needNewStructure)p=g.buildStructure(o.response);else{p={};for(var f=function(e,t){if(void 0===e[t.getRelationID()]){e[t.getRelationID()]={},e[t.getRelationID()][t.getID()]={};for(var o=t.getChildren(),n=0;o&&n<o.length;n++)f(e[t.getRelationID()][t.getID()],o[n])}},y=o.treedocument.getRoots(),v=0;v<y.length;v++){p[y[v].getID()]={};for(var T=y[v].getChildren(),_=0;T&&_<T.length;_++)f(p[y[v].getID()],T[_])}}var C,S=g.parse_expand(o.response.results,t.getAvailableColumns(),t.getTreeColumn(),o.response.full_path,p),b="expanded",E=!1,D=!1,w=o.expand_level;"find_in_ctx"===o.mode?(b="partiallyExpanded",E=!0,w=-1,C=[],s=!1):"refresh"===o.mode&&(w=-1,D=!0,s=!1);S.status&&(d.publish({event:"TerminologyEditor/expandStatus",data:{mode:o.mode,status:S.status}}),!0===S.status.expandTooLarge&&(!0,b="partiallyExpanded","function"==typeof o.setExpandStatus&&o.setExpandStatus({expandTooLarge:!0})));var A=function(e){for(var t=[],n=0;o.root_nodes&&n<o.root_nodes.length;n++)if(o.root_nodes[n].getID()===e){t=[o.root_nodes[n]];break}return t},I=function(e,t){var o=!1;t&&t.length>0&&(t=(t=t.trim().split("*").join("")).toLowerCase());try{var n=[];n.push(e.options.label),n.push(e.options.subLabel),n.push(e.options.description),n.push(e.options.type),n.push(e.options.grid["ds6w:cadMaster"]),e.options.grid["ds6w:status"]&&(-1!==e.options.grid["ds6w:status"].toLowerCase().indexOf("work")?(n.push("In Work"),n.push("IN_WORK")):n.push(e.options.grid["ds6w:status"])),n.push(e.options.grid.globaltype),e.options.grid["ds6w:description"]&&n.push(e.options.grid["ds6w:description"]),e.options.relationtype&&n.push(e.options.relationtype);var i=a.getAttrPredicateMap();i.size>0&&i.forEach(function(t){t&&e.options.grid[t]&&n.push(e.options.grid[t])});for(var r=0;r<n.length;r++)if(n[r]&&n[r].length>0&&-1!==n[r].trim().toLowerCase().indexOf(t)){o=!0;break}}catch(e){console.error(e)}return o},x=o.findInCtx_query,P=function(t,i,r,a){var d=i.getChildren(),g=D&&null!==d?[].concat(d):void 0,p=[],f=!1;!0===t.pathLeaf&&(x&&0!==x.length?(I(i,x)&&i.select(),UWA.is(o.addedPaths,"function")&&C.push(i.getOccurencePath())):(u&&i.select(),UWA.is(o.addedPaths,"function")&&C.push(i.getOccurencePath())));var y,v,T,_=t.order;if(_.length>0){var w,A=-1,N=[];if(d&&d.length>0)for(w=0;w<d.length;w++)N.push(d[w].options.relationOrder),d[w].options.relationOrder>A&&(A=d[w].options.relationOrder);-1===A&&(f=!0);var O=i.hasChildren()||i.options._childrenFilterInfo&&i.options._childrenFilterInfo.filteredOutChildren.length;for(w=0;w<_.length;w++){var R=_[w];if(void 0!==S.did_to_resourceid[R]){var M=S.did_to_resourceid[R],U=S.nodes[M].type,F=S.nodes[M].relationOrder,L=S.nodes[M],W=Object.getOwnPropertyNames(t[R])[0],V=S.did_to_resourceid[W],k=O?i.getChildByIds(M,V):null,B=!1;if(UWA.is(k,"object")){if(!0===D||!0===k.options.waiting4validation){var j=UWA.clone(S.nodes[V]);j.relationOrder=F,j.grid.instanceName=L.label,j.grid.instanceMatrix=void 0,L.instanceMatrix&&(j.grid.instanceMatrix=L.instanceMatrix),delete k.options.waiting4validation,delete k.options.alternText;var z={};!0===D&&(z.needRequestNls=!0),!0===c&&m(k,o.realExpandedNodes)&&(z.changeState=!1),h(k,j,z),p.push(k),("noChildren"===k.getState()||"expanded"===k.getState()&&(k.options.children&&0===k.options.children.length||null===k.options.children))&&(k.setState({state:"collapsed"}),k.options.children=[])}g&&(v=k,T=void 0,-1!==(T=(y=g).indexOf(v))&&y.splice(T,1))}else{B=!0;var G=UWA.clone(S.nodes[V]);if(G.relationid=M,G.relationtype=U,G.relationOrder=F,G.grid.instanceName=L.label,L.instanceMatrix&&(G.grid.instanceMatrix=L.instanceMatrix),!0===n.getWidgetPreferenceValue("tree_order_in_label")&&(G.label+="(treeorder="+F+")"),k=new e(G),F>=A)i.addChild(k),A=F,N.push(F);else{var H=null,q=i.getChildren();if(q)for(var J=0,X=q.length;J<X;J++)if(N[J]>F){H=q[J],N.splice(J,0,F);break}i.insertBefore(k,H)}!0===f&&p.push(k),k._manageNLS=!0}s&&"ds6w:Document"===k.options.grid.globaltype&&l.push(i);var K=-1===a?a:a-1;(K>0||-1===K)&&(B||k.getTreeDocument())&&P(t[R][W],k,r,K)}}var Y=m(i,o.realExpandedNodes),Q=function(e,t,o){var n=!1;if(UWA.is(e,"object")&&UWA.is(t,"array")){var i=0,r=t.length,a=!1;do{if(e.isDescendantOf(t[i])){if(n=!0,-1!==o){n=!1;var l=e.getOccurencePath(),s=l.indexOf(t[i].getID());(l.length-s)%2<=o&&(n=!0)}a=!0}i++}while(!1===a&&i<r)}return n}(i,o.realExpandedNodes,r);i.childComputed=!0,!0!==D&&!0===c&&(Y||Q||E)&&(i.setState({state:b}),i.options.padstate=b)}else if(!0!==D){var Z=i.getDepth();r&&(-1===r||r>Z)?E?(i.childComputed=!1,x&&0!==x.length?i.isSelected()||I(i,x)&&i.select():i.select()):!0===c?-1===r?(i.childComputed=!0,i.options.children=null,i.setState({state:"noChildren"}),i.options.padstate="noChildren",i._expandState="noExpandState"):_.length&&(i.setState({state:b}),i.options.padstate=b):(i.childComputed=!0,i.options.children=null,i.setState({state:"noChildren"}),i.options.padstate="noChildren",0!==Z&&-1!==r||(i._expandState="noExpandState")):null!==i.options.relcount&&0===i.options.relcount&&(i.setState({state:"noChildren"}),i.options.padstate="noChildren",i.childComputed=!0,i.options.children=null,E&&(x&&0!==x.length?i.isSelected()||I(i,x)&&i.select():i.select()))}null!=g&&g.length>0&&g.forEach(function(e){null!==e&&i.removeChild(e)})},N=Object.getOwnPropertyNames(S.structure),O=UWA.clone(o.root_nodes?o.root_nodes:[],!1);if(N.length>0)for(var R=0;R<N.length;R++){var M=N[R];if(S.did_to_resourceid.hasOwnProperty(M)){var U=A(S.did_to_resourceid[M]);0!==U.length?(U.forEach(function(e){if(void 0!==e){var t=O.indexOf(e);t>-1&&O.splice(t,1);var n,r=S.nodes[S.did_to_resourceid[M]],a=S.structure[M];P(a,e,w,w),!0===c&&m(e,o.realExpandedNodes)&&(n={changeState:!1}),h(e,r,n),delete e._manageNLS,i.updateNLS(e)}}),UWA.is(o.addedPaths,"function")&&o.addedPaths(C),UWA.is(o.hideToggleNodes,"function")&&o.hideToggleNodes(r)):console.error("Invalid root id: "+M)}}o.treedocument.pushBroadcastSelect()})},insert_temporary_branches:function(t){if(!UWA.is(t.treedocument,"object")||!UWA.is(t.branches,"array"))throw new Error("Invalid input parameters");var n=[],i=[],a=[],l=[],s=[],d=t.treedocument,c=t.node_state?t.node_state:"partiallyExpanded",g=t.branches;return d.withTransactionUpdate(function(){g.forEach(function(d){var g,u=null,m=t.treedocument.getRoots(),p=0;for(g=0;g<m.length&&null===u;g++)if(d[0]===m[g].getID()){l.push(d[0]);var h=(u=m[g]).getNodeByPath(d,void 0,void 0,!0);h&&(u=h,p=d.indexOf(u.getID()))}if(u&&u.getID()!==d[d.length-1])for(var f=p+1;f<d.length;f+=2){var y=d[f],v=d[f+1],T={resourceid:v,relationid:y,label:r.loadingText,icons:[o.getWebappsAssetUrl("ENXNav","icons/32/loading22x22.gif")],thumbnail:o.getWebappsAssetUrl("ENXNav","icons/32/loading.gif"),alternText:r.loadingText,waiting4validation:!0},_=new e(T),C=u.getState();u.addChild(_),"collapsed"===C?(c!==C&&(u.setState({state:c}),u.options.padstate=c),u.childValidationChecker()):"partiallyExpanded"===C&&(u.setState({state:C}),u.options.padstate=C,-1===i.indexOf(v)&&i.push(v),-1===a.indexOf(y)&&a.push(y)),u=_,-1===n.indexOf(v)&&n.push(v),-1===s.indexOf(y)&&s.push(y)}})}),{ids_to_fetch:n,relationids:s,rootsAlreadyLoaded:l,visibleNodesIds:i,visibleNodesRelIds:a}},refresh_nodes:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object")||!UWA.is(e.refresh_parameters,"object"))throw new Error("Invalid input parameters");var o=[],n=function(e,o){var n=u.parse_attributes(o.attributes,t.getAvailableColumns(),t.getTreeColumn());return n&&0===n.relcount&&(n.children=null),n};return e.treedocument.withTransactionUpdate(function(){e.response.results.forEach(function(t){for(var r="",a=0;a<t.attributes.length;a++){var l=t.attributes[a];if("resourceid"===l.name){r=l.value;break}}if(""===r)throw new Error("Resourceid not found in fetch result for "+JSON.stringify(t));if(e.refresh_parameters.modified&&(-1!==e.refresh_parameters.modified.indexOf(r)||-1!==e.ids_modified.indexOf(r))){e.treedocument.getRoots().forEach(function(e){e.getNodesById(r).forEach(function(e){e.updateOptions(n(0,t)),i.updateNLS(e),null===e.options.children&&e.setState({state:"noChildren"}),o.push(e)})});var s=e.treedocument.searchRootById(r);s&&(s.updateOptions(n(0,t)),i.updateNLS(s),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:e.treedocument.getRoots().length,added_node:s}}),o.push(s))}})}),[]},validateAndUpdateBranches:function(e){if(!UWA.is(e.treedocument,"object")||!UWA.is(e.response,"object"))throw new Error("Invalid input parameters");if(!UWA.is(e.response.results,"array"))throw new Error("Invalid response format - results should be an array");var o=e.forcePartiallyExpanded;e.treedocument.withTransactionUpdate(function(){var r=g.parse_expand(e.response.results,t.getAvailableColumns(),t.getTreeColumn(),e.response.full_path),a=function(t){for(var o=null,n=e.treedocument.getRoots(),i=0;i<n.length;i++)if(n[i].getID()===t){o=[n[i]];break}return o},l=function(e,t){var a=t.getChildren(),s=e.order;if(s.length>0){for(var d=-1,c=[],g=0;null!==a&&g<a.length;g++)c.push(a[g].options.relationOrder),a[g].options.relationOrder>d&&(d=a[g].options.relationOrder);for(var u=0;u<s.length;u++){var m=s[u];if(r.did_to_resourceid.hasOwnProperty(m)){var p=r.did_to_resourceid[m],f=r.nodes[p].relationOrder,y=r.nodes[p],v=Object.getOwnPropertyNames(e[m])[0],T=r.did_to_resourceid[v],_=t.getChildByIds(p,T);if(!UWA.is(_,"object")){console.error("All nodes should have been created");break}var C=UWA.clone(r.nodes[T]);C.grid.instanceName=y.label,y.instanceMatrix&&(C.grid.instanceMatrix=y.instanceMatrix),h(_,C,{deleteTempOptions:!0}),_.isVisible()&&i.updateNLS(_),!0===o&&"expanded"===_.getState()&&_.setState({state:"partiallyExpanded"});var S=_.getLabel();!0===n.getWidgetPreferenceValue("tree_order_in_label")&&(S+="(treeorder="+opts_2_modified.relationOrder+")"),_.updateOptions({label:S,relationOrder:f});var b=_.getParent(),E=_.getBrothers(),D=b.getChildren();if(D.length>1)for(var w=0;w<E.length;w++)if(E[w].options.relationOrder>_.options.relationOrder){var A=D.indexOf(_);if(D.indexOf(E[w])<A){var I=b.removeChild(_);b.insertBefore(I,E[w]);break}}l(e[m][v],_,-1)}else console.error("Invalid CV id ["+m+"]")}}},s=Object.getOwnPropertyNames(r.structure);if(s.length>0)for(var d=0;d<s.length;d++){var c=s[d];if(r.did_to_resourceid.hasOwnProperty(c)){var u=a(r.did_to_resourceid[c]);void 0!==u?u.forEach(function(t){if(void 0!==t){h(t,r.nodes[r.did_to_resourceid[c]],{deleteTempOptions:!0}),i.updateNLS(t),!0===o&&"expanded"===t.getState()&&t.setState({state:"partiallyExpanded"});var n=e.treedocument.getRoots().length;UWA.is(e.treedocument.detachedRoots,"array")&&(n+=e.treedocument.detachedRoots.length),e.treedocument.getModelEvents().publish({event:"onRootAdded",data:{nb_root:n,added_node:t}});var a=r.structure[c];l(a,t,-1)}}):console.error("Invalid root id: "+c)}}})}},u}),define("DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyTypeService","DS/Logger/Logger"],function(e,t,o,n,i,r,a,l,s){var d=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};launchCommandForKey=function(e,t){var o=r.getCommand(t),n=null;return o&&o.isEnabled()?d()?n="Info : '"+e+"' key pressed in INPUT field, no command launched":o.begin():n="Info : '"+e+"' key pressed, but command '"+t+"' is disabled",n};var c=t.extend({name:"TerminologyEditorKeyboardListener",init:function(e){this._parent(e),this._logger=s.getLogger(c)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown.bind(this))},_onKeyDown:function(e){var t=o.whichKey(e),n=this.launchKeyAction(t);n&&!0===n.stopPropagation&&o.stop(e)},launchKeyAction:function(e){var t=this,o={stopPropagation:!1};switch(_launchCommandForKey=function(e,n,i){var r=launchCommandForKey(e,n);o.stopPropagation=!1!==i,r&&(t._logger.log(r),o.stopPropagation=!1)},e){case"ctrl+a":_launchCommandForKey(e,"SelectAll");break;case"del":_launchCommandForKey(e,"DeleteHdr");break;case"ctrl+c":_launchCommandForKey(e,"Copy",!1);break;case"ctrl+x":_launchCommandForKey(e,"Cut");break;case"ctrl+v":_launchCommandForKey(e,"Paste");break;case"ctrl+f":var r=n.getIdCardCont();r.isSearchAvailable()&&(r.switchSearch(!0),o.stopPropagation=!0);break;case"alt+return":_launchCommandForKey(e,"ActionBar_Attributes");break;case"f2":if(d())this._logger.log("Info : '"+e+"' key pressed in INPUT field, no command launched");else{var s=a.getSelectedNodes(),c=a.getCurrentTerminology();if((Array.isArray(s)?s.length:0)>=1){var g=s[0];if(g&&l.inFamilyTerminology(g.plmType))if(c.getID()==g.getID()){var u=n.getTreeCont();u&&u.switchTerminologyTreeNodeLabelToWriteView&&u.switchTerminologyTreeNodeLabelToWriteView(c)}else{var m=n.getContent();m&&m.switchTerminologyTreeNodeLabelToWriteView&&m.switchTerminologyTreeNodeLabelToWriteView(g)}else this._logger.log("Info : '"+e+"' key pressed but selected element is not a Terminology, no command launched")}else this._logger.log("Info : '"+e+"' key pressed when no element selected, no command launched")}break;case"esc":i.escapCmd()}return o}});return c}),define("DS/TerminologyEditor/controllers/SearchMode",["DS/TerminologyEditor/controllers/CommonMode","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorDataConversion"],function(e,t,o,n,i,r,a,l,s){return e.extend({supportClientSort:!1,init:function(e){this._parent(e),l.onSearchChange(function(){var e=i.getCurrentTerminology();e&&n.updateCommands(e,e),r.getContent()&&r.getContent().switchMode(l.isSearchActive()?"search":null,!0)})},enable:function(){r.getIdCardCont().switchSearch(!0);var e=r.getContent().getActiveView();e="datagridview"===e?"treeview":e,l.setPreviousView(e),n.getCommand("treeview").begin()},disable:function(){this._parent(),t.getModelEvents().publish({event:"search_cleared"});var e=l.getPreviousView();e&&(n.getCommand(e).begin(),l.setPreviousView(null))},convertData:function(e){return o.convertToExaleadDataFormat(e)},manageError:function(e){if(l.isSearchActive()&&e&&"object"==typeof e&&e.error&&e.error.errorCode)return e.error.errorMessage},loadContents:function(e){this._parent();var t=this,o=l.getSearchValue();e.searchQuery=o;let n=!1,i=r.getContent();if(i){let r=i.getPADTreeListView();if(r)return n=!0,new Promise(function(n,i){r.enrichSearchValue(o).then(function(o){e.searchQuery=o,t._loadContents(e).then(function(e){n(e)},function(e){i(e)}).catch(i)}).catch(i)})}if(!n)return t._loadContents(e)},_loadContents:function(e){var t=this;e.filters=l.getRefineTags(),this.cancelQuery();var o=Promise.resolve();i.getCurrentTerminology()&&(currentTerminologyId=i.getCurrentTerminology().getID());let n=null,d=null,c=r.getContent().getPADTreeListView(),g=c?c.getManager().sortModel:null;return g&&g.length>0&&("tree"===(n=g[0].dataIndex)?n="ds6w:label":"defaultSort"===n&&(n="ds6w:modified"),d=g[0].sort,e.order_field=n,e.order_by=d),"TerminologySection_AllTerminologies"===e.pid&&(o=new Promise((e,o)=>{var n=r.getTreeFilter();n.isFilterSet()?e(n.getFilteredTerminologies()):t._contentHandleRequest=a.allTerminologies({select_predicate:["physicalid"],onComplete:function(t){l.isSearchInProgress()||l.setSearchTags(t.facets),e(s.getObjectIdsFromSearchRes(t.results))},onFailure:o})})),new Promise(function(n,r){e.onComplete=function(t){var o=t.infos,r=l.isSearchInProgress();r||l.setSearchTags(t.facets),e.searchQuery&&l.setInfoIndex(o);var a=null;if(i.getCurrentTerminology()&&(a=i.getCurrentTerminology().getID()),a===e.pid||"TerminologySection_AllTerminologies"===a){var s=t.results;n({contents:s=s||[],inProgress:r,sorted:!0})}},e.onFailure=function(e,t){r({err:e,serverErr:t})},o.then(o=>{o&&(e.pid=o),t._contentHandleRequest=a.content(e)}).catch(r)})},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return l.getNumberHits()},onFilterFilteringEvent:function(){},onInfiniteScrollAsync:function(){var e=l.getNumberLastResult();l.getSearchValue()&&e>0&&r.getContent().loadContentAndSelect()},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return l.getNumberLastResult()},getModeType:function(){return"search"}})}),define("DS/TerminologyEditor/dataProvider/TerminologyFindInDataProvider",["UWA/Class","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologySearch","DS/ApplicationFrame/CommandsManager","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/service/TerminologyTypeService","i18n!DS/TerminologyEditor/assets/nls/TerminologyFindInTree","i18n!DS/TerminologyEditor/assets/nls/TerminologyFindInCtx"],function(e,t,o,n,i,r,a,l,s,d){"use strict";return e.singleton({NlsTree:s,autoCompleteKey:"BM_FindInTree_savedQueries",supportedSection:l.TYPE_FOLDERS_SECTION,unSupportedSection:l.TYPE_FAVORITES_SECTION,getSupportedTypesForDrop:function(){return["Terminology","Term"]},getTreeGridView:function(){return o.getTreeCont()._terminologies_TreeView},getTreeVisibleNodesyId:function(e){return o.getTreeCont()._getVisibleNodeById(e)},getTreeSectionNodeForFind:function(){return o.getTreeCont()._terminologies_TreeDocument.getRoots()[1]},getTreeElementToAddCommand:function(){var e=o.getTreeCont().getContent(),t=null;return e&&(t=e.getElement(".TerminologyTree_Cont-root_treeview_container")),t},getTreeSelectedNode:function(){return t.getCurrentTerminology()},expandTreeAndSelectNode:function(e){o.getTreeCont().expandTreeAndSelectTerminology(e)},findTreeNodes:function(e){a._findTerminologiesInTerminology(e)},onTreeFilterChange:function(e){return n.onTreeFilterChange(e)},onCurrentSelectionChange:function(e){return n.onCurrentTerminologyChange(e)},NlsContent:d,getContentFilter:function(){return o.getContent().getProxy()._biFilter},getContentGridView:function(){return o.getContent().getPADTreeListView().options.dgv},getTreeWidth:function(){var e=null;return o.getContent().terminologyLeftPanel.isLeftPanelOpen()&&(e=o.getTreeCont().getContent().offsetWidth),e},getContentTreeDocument:function(){return o.getContent().getPADTreeDocument()},findContentNodes:function(e){o.getContent().getPADTreeDocument()._findInCtx(e)},onContentFindClose:function(){r.getCommandCheckHeader("ActionBar_FindInCtxCmd").setState(!1,!1)},onContentSearchChange:function(e){return i.onSearchChange(e)},getContentColumnsToIgnore:function(){return["ContextualMenuColumn","bookmarkLocation"]}})}),define("DS/TerminologyEditor/utils/TerminologyNavigateUtil_Read",["UWA/Utils","DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode"],function(e,t){return{getNavigateDataforTerminology:function(e){var o=this;t.getTerminologyPathsforItems({ids:e.pids,onComplete:function(t){var n=o.createTerminologyPathData(t);e.onComplete(JSON.stringify(n))},onFailure:function(t){e.onFailure(t)}})},createTerminologyPathData:function(e){var t=this;if(!(e.result&&e.result.length>0))return{error:"No valid paths found"};var o=e.result,n={};return o.forEach(function(e){var o=e.input_object.physicalid,i="Workspace"==e.input_object["ds6w:type"],r=!!(e.outputs.GET_PARENT&&e.outputs.GET_PARENT.length>0);if(i||r){var a=i?e.input_object:e.outputs.GET_PARENT[0],l={},s=[],d=[];for(var c in a){var g=t.getMappingforProperties_Navigate().get(c);if(g&&(l[g]=a[c]),"paths"==c&&a.paths.length>0){var u=a.paths[0];d=t._getArrayofSubPaths(u)}}s.push(l);for(var m=d.length-1;m>=0;m--){var p=d[m];s.push(p)}n[o]=s}}),Object.keys(n).length>0?n:void 0},_getArrayofSubPaths:function(e){var t=this,o=[];return e.forEach(function(e){var n={};for(var i in e){var r=t.getMappingforProperties_Navigate().get(i);r&&(n[r]=e[i])}o.push(n)}),o},getMappingforProperties_Navigate:function(){return new Map([["physicalid","id"],["did","did"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:originator","owner"],["ds6w:status","status"],["ds6w:project","project"],["mxid","mxid"]])}}}),define("DS/TerminologyEditor/xTermDocument",["UWA/Core","DS/Logger/Logger","DS/i3DXCompassServices/i3DXCompassPubSub","DS/IPClassifyUXUtil/CredentialsView","DS/IPClassifyUtil/bsd_utils/BSDSettingsMgt","DS/WidgetServices/WidgetServices","DS/Tree/TreeDocument","DS/TerminologyEditor/models/xTermNodeModel","DS/TerminologyEditor/models/_xTermCVParser","DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess","DS/IPClassifyUtil/bsd_utils/BSDPredicateNls","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/IPClassifyUtil/bsd_utils/BSDTransactionManager","DS/ApplicationFrame/CommandsManager","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyLoaderGlobal"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v){"use strict";return a.extend(m,{_broadcastSelect:!0,_selected_paths:[],id:"mainNodeModel",_insertFlag:!1,_selection:[],_selectedIdx:null,_focusOn:!1,_reframeFocus:!1,_currentApp:null,_emptyFromProxy:!1,_isVolumeFilter:!1,init:function(o){var n=o||{},i=this;if(this._logger=t.getLogger("DS/TerminologyEditor/xTermDocument"),i.renderTo=o.renderTo?o.renderTo:document.body,n.nodeModelClass=l,this._parent(n),this.options.viewport={graph:null,tree:null},this.onPreExpand(this.xnav_expand.bind(this)),this.forceSyncModel4TreeListView=function(){},this.addEvent("onTransactionEnd",function(e,t){t||(i.getModelEvents().publish({event:"setPathTags",context:i}),i.fromTransactionEnd=!0)}),!e.is(n.remove_broadcast)||!0===n.remove_broadcast){i._commandProxy=u.create({events:{onSelect:function(t,o){if(!i._insertFlag&&(r.isReplayedODT()||o.originWidgetId!==widget.id)&&!0!==t.searchDone){if(1==t.focusOn&&t.sharedID&&t.sharedID!==r.getWidgetValue("x3dAppId"))return;var n=t.paths;i._selected_paths=e.clone(n);!function(){try{i._doNotBroadcastSelect=!0,i._selected_paths.length?i._selectOccurence("",!0,!0):o.appid===u.appId()&&(i._emptyFromProxy=!0,i.unselectAll(),i._directSelection=!1);for(var e=[],t=0;t<i._selected_paths.length;t++)i.getNodeByOccurencePath(i._selected_paths[t])&&e.push(i._selected_paths[t]);e.length===n.length&&e.length>0&&e.forEach(function(e){var t=e.length;if(t>2){var o=i.getNodesById(e[t-3]);o&&o.length>0&&!0}}),i._selected_paths=e}finally{setTimeout(function(){i._doNotBroadcastSelect=!1},500)}}()}}}});var a=function(){i._doNotBroadcastSelect||(i._directSelection=!0,i._selected_paths=[],!0!==i.searchProgress&&i._commandProxy.select(i._buildSelectData()),i.broadcastSelect(i.getXSO().get())),0===i.getSelectedNodes().length&&!0!==i._focusOn&&!0!==i._reframeFocus&&(i._reframeFocus=!1,i._commandProxy.closePager({sharedID:r.getWidgetValue("x3dAppId")}))};this.getXSO().onPostAdd(function(){a(),i._focusOn=!1}),this.getXSO().onPostRemove?this.getXSO().onPostRemove(a):this.getXSO().onRemove(a),this.getXSO().onEmpty(function(){!1===i._emptyFromProxy?i._doNotBroadcastSelect=!1:i._emptyFromProxy=!1,a()}),this.getXSO().onPreEmpty(function(){!1===i._emptyFromProxy&&(i._doNotBroadcastSelect=!0)}),document.addEventListener("keyup",function(e){27===e.keyCode&&i.getXSO().empty()})}},_getLastViewpoint:function(e){e(null)},broadcastSelect:function(e){if(e&&e.length>0){var t={objectId:e[0].getID(),envId:r.getTenantID(),contextId:n.getCredential(),serviceId:"3DSpace"};o.publish("setObject",t)}},prepareBroadcastSelect:function(){this._doNotBroadcastSelect=!0},pushBroadcastSelect:function(){!0!==this.searchProgress&&this._commandProxy.select(this._buildSelectData()),this.broadcastSelect(),this._doNotBroadcastSelect=!1},_findInCtx:function(t){var o=this;require(["DS/IPClassifyUtil/bsd_utils/BSDWSAccess","DS/IPClassifyUtil/bsd_utils/BSDPlatformUrl"],function(n,r){o.searchProgress=!0,o.prepareUpdate(),o.prepareBroadcastSelect(),o._selection=[],o.getXSO().empty();var a;i.getWebAPI_Options("navigate");o._flatNodes=[],a=n.findInCtx?Promise.resolve():r.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0});var l=t.highLightNodes;a.then(function(){var n=[];if(null==v.container.contentView){var i=y.getContent().getContent(),r=null;i&&(r=i.getElement(".xbook_viewmain")),widget.body.contentViewLoaderContainer=e.createElement("div",{class:"TerminologyEditor_contentView_loader"}).inject(r),v.setContainer("contentView",widget.body.contentViewLoaderContainer)}v.addComponentsToLoad("contentView",{content:""}),t.findFlatInTerminology&&n.push(new Promise(function(e,n){if(t.query)o._flatNodes=o.getRoots();else for(var i=o.getRoots(),r=0;r<i.length;r++){var a=i[r];if(a.id===t.rscIdToSearch){o._flatNodes.push(a);break}}e()})),Promise.all(n).then(function(){o.pushUpdate(),o.pushBroadcastSelect(),o.searchProgress=!1,o._doNotBroadcastSelect=!0,l(o.getRoots(),o._selection,o._flatNodes),v.removeComponentToLoad("contentView","content")}).catch(function(){l(o.getRoots(),[],[]),v.removeComponentToLoad("contentView","content"),console.log("Find in Context finished with error"),o.searchProgress=!1})})})},withBroadcastSelect:function(e){this.prepareBroadcastSelect(),e(),this.pushBroadcastSelect()},xnav_expand:function(e){},invalidateViewPort:function(){this.options.viewport={graph:null,tree:null,tiles:null,thumbnails:null,datagrid:null}},getNodesById:function(e){var t=[];return this.getRoots().forEach(function(o){var n=o.getNodesById(e);t=t.concat(n)}),t},getNodeByOccurencePath:function(e){for(var t=this.getRoots(),o=0;o<t.length;o++){var n=t[o].getNodeByPath(e,void 0,void 0,!0);if(n)return n}},getRoots:function(t){var o=this._parent();if(Boolean(t)&&e.is(this._getChildrenFilterInfo,"function")){var n=this._getChildrenFilterInfo();n&&e.is(n.childrenBeforeFiltering,"array")&&(o=n.childrenBeforeFiltering.slice(0))}return o},removeRoot:function(t,o,n){var i=this;if(this.wrapInTransaction(function(){i._doNotBroadcastSelect=!0,i.invalidateViewPort(),i.getRoots().indexOf(t)>=0&&i._parent(t),i._doNotBroadcastSelect=!1}),!e.is(o,"boolean")||!o){var r=this.getRoots().length;this.getModelEvents().publish({event:"onRemoveRoot",data:{pid:t.getID(),remainingRoots:r}});var a=null;this.getRoots().length>0&&(a=this.getRoots()[0]),this.getModelEvents().publish({event:"onRootAdded",data:{isremove:!0,added_node:a,nb_root:r}})}},searchRootById:function(e){for(var t,o=this.getRoots(!0),n=0;n<o.length;n++)if(o[n].options.resourceid===e){t=o[n];break}return t},insertBranches:function(e,t){var o;(o=s.process.insert_temporary_branches({treedocument:this,branches:e,node_state:t.node_state,forceCollapsed:t.forceCollapsed,novalidation:t.novalidation})).ids_to_fetch.length>0||o.relationids.length>0?this.validateBranches_with_Expand(e,t):t.onComplete&&t.onComplete.call(null)},refreshNodeById:function(t){var o=[],n=this,a=[],l=[],u=function(){o.forEach(function(t){var o=n.getNodesById(t);e.is(o,"array")&&o.forEach(function(e){var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])})});var t=h.cannot_insert_branch;0!==l.length&&(t=h.cannot_access_after_changeowner),g.displayNotification({message:t,className:"error"})};if(o=e.is(t.created)?o.concat(t.created):o,e.is(t.modified)&&e.is(t.modified,"array")&&this.withTransactionUpdate(function(){t.modified.forEach(function(t){if(e.is(t,"object")){var i=t.physicalid;if(e.is(t.attributes,"array")){var r=require("DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt");n.getNodesById(i).forEach(function(e){e.updateAttributes(t.attributes,r.getAvailableColumns()),c.updateNLS(e)})}else{if(-1===o.indexOf(i))(s=n.getNodesById(i))&&s.length>0&&(o.push(i),a.push(i));"ownerChanged"===t.key&&l.push(i)}}else{var s;if(-1===o.indexOf(t))(s=n.getNodesById(t))&&s.length>0&&(o.push(t),a.push(t))}})}),o.length>0){var m=i.getWebAPI_Options("fetch");m.include_param_Attributes=!1,d.fetch({enopad_webapis:r.getWidgetPreferenceValue("enopad_webapis"),data:m,pids:o,onComplete:function(i){n.invalidateViewPort();var r=e.is(i,"string"),l=r?i.replace(/\\u0007/g,";"):i,d=r?JSON.parse(l):l;d.results.length!==o.length&&(console.error("Inconsistent number of results"),u()),n.wrapInTransaction(function(){s.process.refresh_nodes({treedocument:n,response:d,refresh_parameters:t,ids_modified:a})}),void 0!==t.onComplete&&t.onComplete()},onFailure:function(){u()}})}},getNodesByIDPath:function(e){var t=[];return this.getRoots().forEach(function(o){!function e(t,o,n,i){if(t.getID()===o[n])if(n===o.length-1)i.push(t);else{var r=t.getChildren();r&&r.length>0&&(n+=1,r.forEach(function(t){e(t,o,n,i)}))}}(o,e,0,t)}),t},deleteNodes:function(e){var t=this;this.wrapInTransaction(function(){t.withTransactionUpdate(function(){e.forEach(function(e){e.isRoot()&&t.removeRoot(e)})})})},_selectOccurence:function(e,t,o){var n=this.getRoots(),i=this._selected_paths;if(i.length>0){var r=!1;"FocusOn"!==e&&(this._doNotBroadcastSelect=!0),this.prepareUpdate();var a=[];n.forEach(function(e){for(var t=0;t<i.length;t++){var o=e.getNodeByPath(i[t]);if(o&&(r=!0,a.push(o),!o.isVisible())){for(var n=o.getParent();!n.isVisible();)n=n.getParent();n&&-1===a.indexOf(n)&&a.push(n)}}});var l=!1;if(!0!==t||!0===r)for(var s=this.getSelectedNodes(),d=0;d<s.length;d++){var c=s[d];a.indexOf(c)<0&&(c.unselect(),l=!0)}a.forEach(function(e){e.isSelected()||(e.select(),l=!0)}),!0===o&&l&&(this._directSelection=!1),this.pushUpdate(),this._doNotBroadcastSelect=!1}},_buildSelectData:function(){var e=[];this._selected_paths;e=this.getXSO().get();var t,o={paths:[],tenant:r.getTenantID()};o.attributes={},o.version="1.1";return t=function(e){var t=e.getID();this.attributes.hasOwnProperty(t)||(this.attributes[t]={type:e.options.type,label:e.options.label})}.bind(o),o.paths=e.map(function(e){return e.getOccurencePath(t)}),this._currentApp=r.getWidgetValue("x3dAppId"),o.sharedID=this._currentApp,o.focusOn=!1,o},applyActiveView:function(e){this.options.active_view=e},validateBranches_with_Expand:function(t,o){var n=e.extend({root_path_physicalid:e.clone(t),expand_iter:"0",intent:"explore_2D"},i.getWebAPI_Options("navigate"),!0),a=this;function l(){for(var n=0;n<t.length;n++)for(var i=0;i<t[n].length;i+=2){var r=t[n][i],l=a.getNodesById(r);e.is(l,"array")&&l.forEach(function(e){if(!0===e.options.waiting4validation)if(!0===e.isRoot())a.removeRoot(e);else{var t=e.getParent();e.remove(),!1===t.hasChildren()&&(t.setState({state:"collapsed"}),t.options.children=[])}})}g.displayNotification({message:h.cannot_insert_branch,className:"error"}),o.onFailure&&o.onFailure()}d.navigate({enopad_webapis:r.getWidgetPreferenceValue("enopad_webapis"),data:n,onComplete:function(t){var n;try{n=a.startTransaction("expand");var i=e.is(t,"string")?JSON.parse(t):t;s.process.validateAndUpdateBranches({treedocument:a,response:i}),o.onComplete&&o.onComplete()}catch(e){l()}finally{n&&n.end()}},onFailure:function(e){l()}})},multiselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.add(e),this.pushUpdate()},multiunselect:function(e){var t=this.getXSO();this.prepareUpdate(),t.remove(e),this.pushUpdate()},fillAttributesAsync4VisibleNodes:function(t,o){this.options.additionalColumnsModules=o;var n=this;function i(e,t){for(var o=0;o<n.options.additionalColumnsModules.length;o++){for(var i=n.options.additionalColumnsModules[o],r=i.getManagedColumnNames(),a={},l=0;l<r.length;l++)a[r[l]]=e.options.grid[r[l]];if(!0===i.toBeUpdated(a,e)){var s=i.getName(),d=t[s];d||(d={pids:[]},t[s]=d);var c=e.getID();d.pids.push(c)}}}if(this.options.additionalColumnsModules&&this.options.additionalColumnsModules.length){var r=this.getVisibleAdditionalColumns();r.length&&require(["UWA/Promise"],function(o){for(var a={},l=0;l<t.length;l++)i(t[l],a);for(var s=[],d=0;d<r.length;d++){var c=r[d],g=c.module.getName();if(a[g]){var u=new o(function(t){c.module.updateAttributes(a[g],function(o){var n=e.is(o,"string")?JSON.parse(o):o;t(n)})});s.push(u)}}s.length&&o.all(s).then(function(o){n.withTransactionUpdate(function(){t.forEach(t=>{var i=t.getID(),r={grid:{}},a=!1;o.forEach(e=>{if(e&&e.pids){var t=e.pids[i];if(t){a=!0;var o=t._root;if(o){for(var n in o)r[n]=o[n];delete t._root}for(var n in t)r.grid[n]=t[n]}}}),a&&t.updateOptions(function(t,o){var i=o;return e.is(n.filterAttributesForUpdate,"function")&&(i=n.filterAttributesForUpdate({node:t,node_opts:i})),i}(t,r))})})})})}}})}),define("DS/TerminologyEditor/mixins/_xTermBIFilter",["UWA/Class","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/ColorUtil","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/Terminology_CSO","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TagNavigatorProxy/TagNavigatorProxy","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/views/TerminologyMode","DS/IPClassifyUtil/IPClassifyUtility","DS/TerminologyEditor/views/TerminologyWebInWinTaggerProxy"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m){"use strict";var p=null,h=null,f=!0===widget.getValue("noCompass");class y{constructor(e,t){this._filter=null,this._model=e,this._component=t,this._isActive=!1}activate(e){this._filter&&null!=e&&(e?this._filter.activate():this._filter.deactivate(),this._isActive=e)}cleanProxy(){this._filter&&this._filter.cleanProxy&&this._filter.cleanProxy()}unsetTags(){this._filter&&this._filter.unsetTags&&this._filter.unsetTags()}onFilterBIColorize(e){if(o.setActive(!0),o.isActive()){for(var t={},n=0;n<e.length;++n){var i=e[n];t[i.id]=i.color}o.setMapColor(t),this._component.getPADTreeListView().getManager().invalidateLayout({updateCellContent:!0,updateCellLayout:!0})}}onFilterBIUnColorize(){this._isActive&&(o.setActive(!1),this._component&&this._component.getPADTreeListView()&&this._component.getPADTreeListView().getManager().invalidateLayout({updateCellContent:!0,updateCellLayout:!0}))}_onFilterChange(e){s.getTreeFilter()._onFilterChange(e)}getProxy(){return this._filter}}class v extends y{constructor(e,t){super(e,t);var o=this;if(f){window.widgetId||(window.widgetId="LibraryEditor"+Math.random().toString(36).substring(2,11)),(n=i(window.widgetId)).events.addFilterChangeListener=o._onFilterChange.bind(o),n.events.addCriteriaChangeListener=o._onFilterChange.bind(o),this._filter=o.taggerProxy=new m(n)}else{var n=i(widget.id);this._filter=o.taggerProxy=d.createProxy(n)}function i(e){return{widgetId:e,filteringMode:"FilteringOnServer",colorize:!0,events:{addColorizeListener:o.filterBIColorize.bind(o),addUnColorizeListener:o.onFilterBIUnColorize.bind(o)}}}this._filterAlreadyApplied=!1}activate(e){if(!0===e)p&&p.allfilters&&0!==Object.keys(p.allfilters).length&&(this.onFilterBIFilteringEvent(p),this._filterAlreadyApplied=!0),p&&p.localfilters&&0!==Object.keys(p.localfilters).length?this._filter.setLocalFilter(p.localfilters):this._filterAlreadyApplied=!1;else if(!1===e){this._filter.clearLocalFilter();var t=s.getContent();t&&t.getSpecficMode("read").setRefineTags(null),l.setRefineTags(null)}super.activate(e)}onSetTags(){var e=this;if(e._filter){if("search"==s.getContent().getCurrentModeType())var t=l.getSearchTags();else if(g.isTerminologyProxyToBeUsed()){var o=s.getContent().getCurrentMode();o.isTagSet||o.addEventOnce("searchTagisSet",function(){i(o.getSearchTags())});t=o.getSearchTags()}i(t)}function i(t){t?n.isContentTaggerActive()&&e._filter.setTags(null,t):e._filter.setTags(null,[])}}filterBIColorize(e){let t=this;if(!e||!e.tagColors||e.tagColors.length<=0||!e.tagColors[0].predicate||!this._isActive)return void(e&&Array.isArray(e)&&t.onFilterBIColorize(e));let o={};for(let t=0;t<e.tagColors.length;++t){let n=e.tagColors[t].object,i=e.tagColors[t].color;o[n]=i}var n=[];this._model.getRoots().forEach(function(e){e.isHidden()||n.push(e.getID())}),c.fetch({ids:n,select_predicate:e.tagColors[0].predicate,onComplete:n=>{let i=[];n=n.results;for(let t=0;t<n.length;++t){let r=n[t].attributes,a={};for(let t=0;t<r.length;++t)"resourceid"===r[t].name?a.id=r[t].value:-1!==e.tagColors[0].predicate.indexOf(r[t].name)&&(a.color=o[r[t].value]);i.push(a)}t.onFilterBIColorize(i)},onFailure:function(){console.log("Failure during fetch of ID's for colorize")}})}onFilterBIFilteringEvent(e){if(this._filterAlreadyApplied)return void(this._filterAlreadyApplied=!1);let t={};if(e.allfilters&&0!==Object.keys(e.allfilters).length?(t=e.allfilters,h=null,u.isWidgetMaximized()||(h=e)):e.localfilters&&0!==Object.keys(e.localfilters).length&&(t=e.localfilters),l.isSearchActive())l.resetInfoIndex(),l.setRefineTags(t),s.getContent().switchMode("search",!0);else if(g.isTerminologyProxyToBeUsed()){var o=s.getContent().getSpecficMode("read");o.resetInfoIndex(),o.setRefineTags(t),s.getContent().switchMode("read",!0)}}handleEvents(e){this._filter&&(e?(this._filter.addEvent("onFilterChange",this.onFilterBIFilteringEvent,this),this.pathTagsToken=this._model.addEventListener("setPathTags",this.onSetTags.bind(this))):(this._filter.removeEvent("onFilterChange",this.onFilterBIFilteringEvent,this),this.pathTagsToken&&this.pathTagsToken>=0&&this._model.removeEventListener(this.pathTagsToken)))}}class T extends y{constructor(e,o){super(e,o);var i={tenant:t.getTenantID(),processingMode:"appProcessing",colorize:!0,widgetId:t.getWidgetId(),appId:t.getWidgetValue("x3dAppId"),volumeFilterAvailable:0,ExpandSynthesisON:!1,appQueryParam:{"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency","Reference Document"],no_type_filter_bo:["3DShape"]},synthesis_priority:1};this._filter=new a(i),this._currentTerminologyID=r.getCurrentTerminologyID(),widget.addEvent("onTenantChange",()=>{n.getTenant()&&this._filter.updateTenant(n.getTenant().value)})}onSetTags(){if(this._filter)if(this._isTransactionActive)this._isTransactionActive=!1;else if(n.isContentTaggerActive()){var e=[];this._model.getRoots().forEach(function t(o){if(!o.isHidden()){e.push(o.getID());var n=o.getChildren();n&&n.forEach(t)}}),this._currentTerminologyID!=r.getCurrentTerminologyID()&&(this._filter._biFilter._aRootsInSession=[],this._currentTerminologyID=r.getCurrentTerminologyID()),this._filter.setTagsWithFetchSynthesis(e);let t=this._filter._biFilter.getCurrentFilter();if(!u.isWidgetMaximized()&&h&&t.allfilters&&0===Object.keys(t.allfilters).length)return this._filter._biFilter.filterBIFilter(h),void(h=null)}}onFilterBIFilteringEvent(e){var t=this;if(!u.isWidgetMaximized()&&h)return t._filter._biFilter.filterBIFilter(h),t.filterToBackPropagate=h,void(h=null);if(u.isWidgetMaximized()||!t.filterToBackPropagate||Object.keys(e.allfilters).length===Object.keys(t.filterToBackPropagate.allfilters).length){p={allfilters:e.allfilters,localfilters:e.localfilters},this._isTransactionActive=!0;var o=t._model;o.wrapInTransaction(function(){o.withTransactionUpdate(function(){var n=e.matchingIDs,i=new Set(n),r=0!==Object.keys(e.allfilters).length||0!==Object.keys(e.localfilters).length;e.filteredPathIDList&&(r=!0);var a=o.getRoots(!0).slice(0);a.forEach(function(e){e.filterIn(!0)});var l=function(e){(i&&i.has(e.getID())||!r||e.isRelationsObjectNode)&&(e._filterStatus="IN",!0!==e.isRelationsObjectNode&&e.getParents().forEach(function(e){e._filterStatus="IN"}));var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){l(e)})},s=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){s(e)})}else e.filterOut();delete e._filterStatus};a.forEach(function(e){l(e)}),a.forEach(function(t){s(t);var o=!1;if(t.options._childrenFilterInfo){var n=t.options._childrenFilterInfo.filteredOutChildren;n&&n.length>0&&(o=!0)}o&&0!==Object.keys(e.allfilters).length&&(t.setState({state:"partiallyExpanded"}),t.options.padstate="partiallyExpanded")}),t.filterToBackPropagate=null})})}else t.filterToBackPropagate=null}handleEvents(e){this._filter&&(e?(this._filter.addEvent("fetchFilterBIColorizeEvent",this.onFilterBIColorize,this),this._filter.addEvent("FilterBIUnColorize",this.onFilterBIUnColorize,this),this._filter.addEvent("fetchFilterBIFilteringEvent",this.onFilterBIFilteringEvent,this),this.pathTagsToken=this._model.addEventListener("setPathTags",this.onSetTags.bind(this))):(this._filter.removeEvent("fetchFilterBIColorizeEvent",this.onFilterBIColorize,this),this._filter.removeEvent("FilterBIUnColorize",this.onFilterBIUnColorize,this),this._filter.removeEvent("fetchFilterBIFilteringEvent",this.onFilterBIFilteringEvent,this),this.pathTagsToken&&this.pathTagsToken>=0&&this._model.removeEventListener(this.pathTagsToken)))}}var _={_prdExpandProxy:null,_terminologyServerProxy:null,get:function(e,t){var o=s.getContent(),n=o?o.getCurrentModeType():null,i=g.isTerminologyProxyToBeUsed();return"search"==n||i||f?(!this._terminologyServerProxy&&e&&t&&(this._terminologyServerProxy=new v(e,t)),this._terminologyServerProxy):(!this._prdExpandProxy&&e&&t&&(this._prdExpandProxy=new T(e,t)),this._prdExpandProxy)}};return e.extend({_model:null,_isSeachActivePrev:!1,_activateSearchProxy:!1,initializeBI:function(e){var t=this;t._model=this.options.model,widget.addEvent("onActivateBIFilter",t.onModifyPreferences.bind(t)),t.onModifyPreferences(n.isContentTaggerActive()),i.onTaggerStatusChange(function(){t.onModifyPreferences(n.isContentTaggerActive())}),l.onSearchChange(function(){t._isSeachActivePrev!==l.isSearchActive()&&(t._isSeachActivePrev=l.isSearchActive(),t._currProxyObj.unsetTags(),t._currProxyObj.handleEvents(!1),t._currProxyObj.activate(!1),t._currProxyObj.onFilterBIUnColorize(),t._currProxyObj=_.get(t._model,t),t._currProxyObj.handleEvents(!0),t._isSeachActivePrev?t._activateSearchProxy=!0:o.isTerminologyProxyToBeUsed()?t._activateReadProxy=!0:t._currProxyObj.activate(!0))}),l.onSearchResult(function(){t._activateSearchProxy&&(t._currProxyObj.activate(!0),t._activateSearchProxy=!1)});var o=require("DS/TerminologyEditor/views/TerminologyMode"),r=function(){var e=s.getContent();"search"!=(e?e.getCurrentModeType():null)&&(t._currProxyObj.unsetTags(),t._currProxyObj.handleEvents(!1),t._currProxyObj.activate(!1),t._currProxyObj.onFilterBIUnColorize(),t._currProxyObj=_.get(t._model,t),t._currProxyObj.handleEvents(!0),o.isTerminologyProxyToBeUsed()?t._activateReadProxy=!0:t._currProxyObj.activate(!0))};o.onGlobalModeChange(r),o.onSpecificPreferenceChange(r),widget.addEvent("onTerminologyComponentReady",function(){s.getContent().getSpecficMode("read").onreadResult(function(){t._activateReadProxy&&(t._currProxyObj.activate(!0),t._activateReadProxy=!1)})})},onModifyPreferences:function(e){this._currProxyObj=_.get(this._model,this),this._currProxyObj.handleEvents(e),0==e&&this._currProxyObj.onFilterBIUnColorize(),this._currProxyObj.activate(e)},cleanProxy:function(){this._currProxyObj.cleanProxy()},getProxy:function(){return this._currProxyObj.getProxy()}})}),define("DS/TerminologyEditor/utils/TerminologyListContent_Read",["UWA/Utils","DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode"],function(e,t){return{listContent:function(e){return"TerminologySection_AllTerminologies"==e.pid?(e.contentView=!0,t.getRoots(e)):"Yes"==e.filterChildren?this.getContentFilterOn(e):t.getContentReadMode({content:e.content,filterChildren:e.filterChildren,next_start:e.next_start,pid:e.pid,filters:e.filters,onComplete:function(t){e.onComplete(t)},onFailure:function(e){}})},getContentFilterOn:function(e){var o=this,n=t.listContent_ExpandLevel_1({pid:e.pid,content:e.content,onComplete:function(t){var i=JSON.parse(t);n=o._getFilteredData(e.pid,i).then(function(t){var n=o._getResultantData(i,t);e.onComplete(JSON.stringify(n))})},onFailure:function(){}});return n},_generateIconMap:function(e){var t=new Map;e.results;if(e.results[e.results.length-1].hasOwnProperty("icon__default_thumbnail_2d"))for(var o=e.results[e.results.length-1].icon__default_thumbnail_2d,n=0;n<o.length;n++){var i=o[n],r=new Map;i.hasOwnProperty("icon")&&r.set("icon",i.icon),i.hasOwnProperty("thumbnail_2d")&&r.set("thumbnail_2d",i.thumbnail_2d),i.did.forEach(function(e){t.set(e,r)})}return t},_getResultantData:function(e,t){for(var o={},n=[],i=e.results,r=0;r<i.length;r++){var a=i[r].attributes;if(a)for(var l=0;l<a.length;l++){var s=a[l];if("physicalid"==s.name&&t.indexOf(s.value)>-1){n.push({attributes:a});break}}}return o.results=n,o},_getFilteredData:function(e,o){var n=[],i=[],r=[],a=this._generateIconMap(o);return new Promise(function(l,s){for(var d=o.results,c=0;c<d.length;c++){var g=d[c].attributes,u=!1;if(g){for(var m=0;m<g.length;m++){if("did"==(T=g[m]).name){var p=T.value,h=a.get(p),f={};h&&h.has("icon")&&(f.name="icon",f.value=h.get("icon"),g.push(f));var y={};h&&h.has("thumbnail_2d")&&(y.name="thumbnail_2d",y.value=h.get("thumbnail_2d"),g.push(y))}"ds6w:type"==T.name&&("Terminology"!=T.value&&"Term"!=T.value||(u=!0))}for(var v=0;v<g.length;v++){var T;if("physicalid"==(T=g[v]).name&&T.value&&T.value!==e){if(u){r.push(T.value);break}i.push(T.value);break}}}}i.length>0?t.filterTerminology({pid:e,prd:i,onComplete:function(e){var t=JSON.parse(e),o=(t.physicalId?t.physicalId:[]).concat(r);l(o)},onFailure:function(e){console.log(e)}}):(n=i.concat(r),l(n))})}}}),define("DS/TerminologyEditor/utils/TerminologyExpandUtil_Read",["DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyTypeService","DS/WebappsUtils/WebappsUtils","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,o,n,i,r){var a=n.getWebappsAssetUrl("TerminologyEditor","icons/I_TerminologyInherit_v2.png"),l=n.getWebappsAssetUrl("TerminologyEditor","icons/22/I_Browsing_Structure_22.png"),s={iconName:"browsing-structure-node",fontIconFamily:1},d={iconName:"browsing-structure-root",fontIconFamily:1};return{listTerminology:function(n){var i=this,l=n.pid,c=null==n.level?"UI":"All"==n.level?0:n.level,g=(n.expandList,n.partialExpandedChildren,n.isRoot),u=n.onComplete,m=[],p=t.getTreeCont(),h=!1,f=p._tagNavigator.getLocalFilter();f&&(h=Object.keys(f).length>0),"UI"==c&&(!h||!g)?(n.Read=!0,n.nextStart=p._indexModeforReadData.getNextStart(),n.onComplete=function(e){var t=JSON.parse(e);if(g&&t.infos){var i=t.infos;p._indexModeforReadData.setInfoIndex(i),p._indexModeforReadData.setNextStart(i.nresults+n.nextStart)}if(t.member&&(t.member.forEach(function(e){var t=e.type;"shared"==t.toLowerCase()?e.icon=a:o.isTerminology(t)?e.icon=d:o.isTerm(t)&&(e.icon=s)}),u(JSON.stringify(t))),t.error){var l=t.error.message;n.onFailure(l),r.displayNotification({message:l,className:"error"})}},e.terminologyTree(n)):(g?m.push(new Promise(function(e,t){var o=p._tagNavigator.getLocalFilter(),n=o?{filters:o}:{};i._getRootTerminologies(n).then(function(t){e(t)}).catch(function(e){t(e)})})):m.push(Promise.resolve()),Promise.all(m).then(function(e){if(g){var t={};h&&isNaN(c)&&(c=1);var o=e[0];if(1!==c)t.level=c,i._expandRoot(t,o,u);else{var n=i.dataConversionToJson(o);n={terminologies:n},u(JSON.stringify(n))}}else{t={};h&&isNaN(c)&&(c=1),t.level=c,i._expandSubTerminology(t,l,u)}}).catch(function(e){e&&r.displayNotification({message:e,className:"error"}),u(JSON.stringify({terminologies:[]}))}))},_expandSubTerminology:function(e,t,o){var n=this,i=[];i.push(t),e.multi_root_physicalid=i,n._getExpandedTerminologies(e).then(function(e){var t=n.dataConversionToJson(e);t.shift(),t.forEach(function(e){e.level=e.level-1}),t={terminologies:t},o(JSON.stringify(t))})},_expandRoot:function(e,t,o){var n=this;if(e.level=-1==e.level?e.level:e.level-1,0===t.size)return{terminologies:[]};var i=n._expandAllonRoot(e,t);Promise.all(i).then(function(){var e=n.dataConversionToJson(t);e={terminologies:e},o(JSON.stringify(e))})},_expandAllonRoot:function(e,t){var o=this,n=[];for(var i of t.keys()){var r=[];r.push(i),(e={level:e.level,isExpandDoneOnRoot:!0}).multi_root_physicalid=r,n.push(new Promise(function(n,i){o._getExpandedTerminologies(e).then(function(e){if(e.size>0){var o=e.keys().next().value;t.set(o,e.get(o))}n()})}))}return n},_getRootTerminologies:function(o){var n=this;return new Promise(function(r,a){var l=o;l||(l={}),Object.assign(l,{onComplete:function(e){var o=JSON.parse(e),i=t.getTreeCont(),l=o.infos;i._indexModeforReadData.setInfoIndex(l);var s=i._indexModeforReadData.getNextStart()+l.nresults;i._indexModeforReadData.setNextStart(s);var d=o.results;if(d&&d.length>0){var c=n._createMapWithSearchResult(d);r(c)}else a()},onFailure:function(){a(i.errorMessageTerminologyRoot)}}),e.getRoots(l)})},_getExpandedTerminologies:function(t){var o=this;return new Promise(function(n,r){e.expandTerminology({level:t.level,multi_root_physicalid:t.multi_root_physicalid,"q.query":t["q.query"],onComplete:function(e){var i=JSON.parse(e),r=o._createMapWithExpandResult(i);if(t.isExpandDoneOnRoot){var a=new Map;if(r.length>0){var l=r[0].id;a.set(l,r)}r=a}n(r)},onFailure:function(){r(i.errorMessageTerminologyExpand)}})})},_createMapWithSearchResult:function(e){var t=this.getMappingforProperties_Search(),o=new Map;return e.forEach(function(e){var n=e.attributes,i={},r=null;n.forEach(function(e){if(t.has(e.name)){var o=t.get(e.name);i[o]=e.value,"id"==o&&(r=e.value),"terminologyClassification"==o&&("shared"==e.value.toLowerCase()?(i.icon=a,i[o]="Shared"):(i.icon=l,i[o]="Terminology"))}}),i.hasOwnProperty("terminologyClassification")||(i.icon=l,i.terminologyClassification="Terminology"),i.level=1,o.set(r,i)}),o},_createMapWithExpandResult:function(e){var t=e.results,o=this.getMappingforProperties_Expand(),n=[],i=[];t.forEach(function(e){if(e.hasOwnProperty("path")&&3==e.path.length&&n.push(e.path),e.hasOwnProperty("path")&&e.path.length>3)for(var t=[],o=0;o+3<=e.path.length;){for(m=o;m<o+3;m++)t.push(e.path[m]);o=m-1,n.push(t),t=[]}});var r=[];n.forEach(function(e){var t=e.length;if(t>1){for(var o=[],n=0;n<t;n+=2)o.push(e[n]);-1==r.indexOf(o[1])&&(r.push(o[1]),i.push(o))}});var s=new Map;path_treat_DUP=JSON.parse(JSON.stringify(i));for(var d=[];i.length>0;){for(var c=[],g=[],u=null,m=0;m<i.length;m++)if(0==m){for(var p=i[m],h=0;h<p.length;h++)c.push(p[h]),h==p.length-1&&(u=p[h]);g.push(p)}else{if(-1!==(p=i[m]).indexOf(u)){for(h=(y=p.indexOf(u))+1;h<p.length;h++)c.push(p[h]),h==p.length-1&&(u=p[h]);g.push(p)}}g.forEach(function(e){var t=i.indexOf(e);i.splice(t,1)});for(var f=null,y=0;y<c.length;y++){var v=c[y];-1!==d.indexOf(v)&&(f=d.indexOf(v),c.shift())}null!==f&&c.length>0?d.splice(f+1,0,...c):d=d.concat(c)}var T=d[0];s.set(T,1),function e(t,o){newarrs=[],pathToBeDeleted=[],t.forEach(function(e){for(var t=o.get(e),n=0;n<path_treat_DUP.length;n++){var i=path_treat_DUP[n];e==i[0]&&(o.set(i[1],t+1),newarrs.push(i[1]),pathToBeDeleted.push(n))}}),newarrs.length>0&&path_treat_DUP.length>0&&e(newarrs,o)}([T],s);var _=new Map;t.forEach(function(e){if(e.hasOwnProperty("attributes")&&e.attributes.length>1){var t={},n=null;e.attributes.forEach(function(e){if("did"==e.name){var i=s.get(parseInt(e.value));t.level=i;var r=o.get(e.name);n=t[r]=e.value}else if(o.has(e.name)){r=o.get(e.name);t[r]=e.value,"terminologyClassification"==r&&("shared"==e.value.toLowerCase()?(t.icon=a,t[r]="Shared"):(t.icon=l,t[r]="Terminology"))}}),t.hasOwnProperty("terminologyClassification")||(t.icon=l,t.terminologyClassification="Terminology"),_.set(n,t)}});var C=[];return d.forEach(function(e){C.push(_.get(e.toString()))}),C},getMappingforProperties_Search:function(){return new Map([["physicalid","id"],["ds6w:when/ds6w:created","created"],["ds6w:when/ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:what/ds6w:type","type"],["ds6w:what/ds6w:policy","policy"],["ds6w:who/ds6w:responsible/ds6w:organizationResponsible","organizationResponsible"],["ds6w:who/ds6w:responsible","responsible"],["ds6w:who/ds6w:responsible/ds6w:originator","owner"],["ds6w:what/ds6w:status","status"],["ds6w:where/ds6w:context/ds6w:project","project"],["icon_2ddefaultthb.subtype","terminologyClassification"],["mxid","mxid"]])},getMappingforProperties_Expand:function(){return new Map([["physicalid","id"],["did","did"],["ds6w:created","created"],["ds6w:modified","modified"],["ds6w:label","label"],["ds6w:identifier","name"],["ds6w:type","type"],["ds6w:policy","policy"],["ds6w:organizationResponsible","organizationResponsible"],["ds6w:responsible","responsible"],["ds6w:originator","owner"],["ds6w:status","status"],["ds6w:project","project"],["icon_2ddefaultthb.subtype","terminologyClassification"],["mxid","mxid"]])},dataConversionToJson:function(e){var t=[];for(let o of e.values()){Array.isArray(o)?o.forEach(function(e){t.push(e)}):t.push(o)}return t}}}),define("DS/TerminologyEditor/infra/xTermComponent",["i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json","UWA/Core","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/UIKIT/Mask","DS/Utilities/Utils","DS/TerminologyEditor/mixins/_xTermBIFilter","DS/IPClassifyUtil/IPClassifyAlert","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p){"use strict";function h(){var e=this,o={},n=new r(function(n){require([e.options.amd_custo.TreeDocument],function(i){o.authorize_setStructure=e.options.authorize_setStructure,o.insert_replace=e.options.insert_replace,o.renderTo=e.options.renderTo,o=function(){var e=this,o={};return["doDnDDragStart","shouldAcceptDnDDrop","doDnDDrop"].forEach(function(n){t.is(e[n],"function")&&(o[n]=e[n].bind(e))}),o}.call(e),e.options.model=new i(o),e.options.model.getModelEvents().subscribe({event:"onRootAdded"},function(t){if(t.data.added_node&&!1===e.options.layout.withWelcomePanel){var o=t.data.added_node.getID();e.dispatchEvent("onAddPaths",{addedPaths:[[o]]})}}),e.options.model.getModelEvents().subscribe({event:"onCenterGraph"},function(t){e.options.views.treelistview?e.options.views.treelistview.getManager().scrollToNode(t.data,void 0,!1):e.options.views.datagridview.options.dgv.ensureNodeModelVisible(t.data),e.options.views.graphview&&e.options.views.graphview.reframeOn()}),e.options.model.addEventListener("beginBlockingTransaction",function(t){e.beginBlockingTransaction(t.data)}),e.options.model.addEventListener("endBlockingTransaction",function(){e.endBlockingTransaction()}),e.initializeBI(),e.options.isReady.model=!0,n()})});return n.name="build",n}function f(){var e=this;e.elements.container.empty(),t.createElement("div",{class:"xnav_hdr"}).inject(e.elements.container),t.createElement("div",{class:"xnav_body"}).inject(e.elements.container),t.createElement("div",{class:"xnav_footer"}).inject(e.elements.container);var o=new r(function(o,n){var i=[],a=e.elements.container.querySelector(".xnav_body"),l=new r(function(o,n){require(["DS/ENOXTriptych/js/ENOXTriptych"],function(n){var i=t.createElement("div",{class:"xterm_viewmain"}),r=t.clone(e.options.layout.triptychOpts);r.container=e.elements.container.querySelector(".xnav_body");var a=t.createElement("div",{class:"xterm_viewright rightSidePanel"});e.elements.padshell=new n,e.elements.padshell.init(r,e.createRootListSlidder2(),i,a),e.elements.padshell.togglePanel=function(t){"left"===t?e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"left"}):(e.elements.padshell._modelEvents.publish({event:"triptych-toggle-panel",data:"right"}),e.elements.padshell._modelEvents.subscribe({event:"triptych-clicked-overlay"},function(e){e&&"right"===e&&u.publish({event:"onOverlayClick"})}))},u.publish({event:"on2DTriptychReady"}),require(["DS/ApplicationFrame/CommandsManager"],function(e){var t=e.getCommandCheckHeader("RootPanel");t&&t.addCallback()}),function(e,t){var o=this;require(["DS/TerminologyEditor/views/ViewLoader"],function(n){var i={component:o,x3dAppId:o.options.x3dAppId,renderTo:e.renderTo,amd:{datagridview:o.options.amd_custo.DataGridView,treelistview:o.options.amd_custo.TreeListView,tileview:o.options.amd_custo.TileGridView,thumbnailview:o.options.amd_custo.ThumbnailGridView}};o.loader=new n(i),o.loader.loadView(o.options.active_view,function(){t()})})}.call(e,{renderTo:i},o)})});l.name="slidder",i.push(l),r.all(i).then(function(t){e.elements.padstatus&&(!0===e.options.layout.padshell?e.elements.padstatus.inject(e.elements.padshell.getMainPanelContainer()):e.elements.padstatus.inject(a)),o()})});return o.name="buildSkeleton",o}return o.extend(n,i,s,{_dispatchReady_NotDone:!0,defaultOptions:{widget:null,elements:null,active_view:"treelistview",toolbar_opts:null,layout:{padshell:!1,title_update:!0,view_customization:null,store_roots_in_pref:!0,drop_invite:"dynamic",keyboard_inputs:!0,withWelcomePanel:!1,triptychOpts:{left:{resizable:!0,originalState:"close",overMobile:!0,minWidth:300,withClose:!0},withtransition:!0,withoverflowhidden:!0,right:{resizable:!0,originalState:"close",overMobile:!0,minWidth:250,withClose:!1}},amdTreeView:"treelistview"},amd_custo:{TreeDocument:"DS/TerminologyEditor/TermTreeDocument",TreeListView:null,TileGridView:null,ThumbnailGridView:null,DataGridView:null},views:{treelistview:null,graphview:null,tileview:null,thumbnailview:null,datagridview:null},views_cb:{},isReady:{model:!1,actionbar:!1,treelistview:!1,graphview:!1,tileview:!1,thumbnailview:!1}},setDnD_onGraph:function(){},init:function(o){this._parent(o),this.options=t.extend(this.options,o,!0),this.elements.container=t.createElement("div",{class:"xterm_component"}),this.options.flags={};var n=this;c.app_initialization(function(o){var i=h.call(n),a=f.call(n);r.all([i,a]).then(function(){n.options.model.getVisibleAdditionalColumns=function(){var e=[];if(n.options.views.treelistview)var o=n.getPADTreeListView().getManager();else o=n.options.views.datagridview;if(n.options.additionalColumnsModules&&n.options.additionalColumnsModules.length)for(var i=0;i<n.options.additionalColumnsModules.length;i++){for(var r=[],a=n.options.additionalColumnsModules[i],l=a.getManagedColumnNames(),s=0;s<l.length;s++)(a.allViewsSupported||o&&t.is(o.isColumnHidden,"function")&&!o.isColumnHidden(l[s]))&&r.push(l[s]);r.length&&e.push({module:a,columns:r})}return e},n._dispatchReady(!1),u.subscribe({event:"TerminologyEditor/expandStatus"},function(t){t.status&&!0===t.status.expandTooLarge&&("find_in_ctx"===t.mode?d.displayNotification({message:e.replace(e.notifications.tooManyResultFound,{maxResult:g.getWidgetPreferenceValue("maxPathsForSearch")}),className:"warning"}):d.displayNotification({message:e.notifications.expandTooLarge,className:"warning"}))})})})},render:function(){return this.elements.container},toggleView:function(e){if(e!==this.options.active_view){var t=this;"treeview"===e&&(e=this.options.layout.amdTreeView),this.loader.loadView(e,function(){t.options.views[t.options.active_view].unsetModel(),t.options.active_view=e,t.options.model.applyActiveView(t.options.active_view),t.options.views[t.options.active_view].setModel(t.options.model),"graphview"===t.options.active_view&&t.options.views.graphview.reframeOn(),t.dispatchEvent("onToggleView",t.options.active_view)})}},togglePanel:function(e,t){(this.elements.padshell?this.elements.padshell:this.elements.padinfo).togglePanel(e,t)},beginBlockingTransaction:function(e){a.mask(this.elements.container,e)},endBlockingTransaction:function(){a.unmask(this.elements.container)},onResize:function(){this.options.model.invalidateViewPort(),"graphview"===this.options.active_view&&this.options.views.graphview.setSize();var e=widget.getView().type;if(this.getProxy()){var t="minimized"===e?"deactivate":"activate";this.getProxy()[t]()}this.dispatchEvent("onParentResize")},getPADTreeDocument:function(){return this.options.model},getRoots:function(){return this.options.model.getRoots()},getPADTreeListView:function(){return this.options.views.datagridview},displayNotification:function(e){require(["DS/IPClassifyUtil/IPClassifyAlert"],function(t){t.displayNotification(e)})},_initialize_failure:function(t){var o=this;require(["DS/TerminologyEditor/views/xTermInitError"],function(n){var i=e.notifications.initialization_error;o.elements.bigerror=new n({msg:i}),o._just_error_content(),o.displayNotification({message:i,className:"error"}),t()})},_just_error_content:function(){this.elements.bigerror&&this.elements.container.setContent(this.elements.bigerror)},compactMode:function(e){this.getPADTreeListView().compactMode(e),this.dispatchEvent("onCompactMode",e)},updateAttributesDelayed:function(e){var t=this;this._debounceMethod=this._debounceMethod?this._debounceMethod:l.debounce(function(e){var o=e.displayNodesArray;if(void 0===o&&e&&e.collectionView&&e.collectionView.model){var n=e.collectionView;o=e.endNodeIndex>=0?n.model.slice(e.startNodeIndex,e.endNodeIndex+1):n.model.slice(e.startNodeIndex,e.endNodeIndex)}if(o.length){for(var i=[],r=0;r<o.length;r++)o[r]._canBeGrouped()&&!0!==o[r].isRelationsObjectGroupingNode&&i.push(o[r]);t.options.additionalColumnsModules&&t.options.additionalColumnsModules.length&&t.options.model.fillAttributesAsync4VisibleNodes(i,t.options.additionalColumnsModules);for(var a=require("DS/IPClassifyUtil/bsd_utils/BSDPredicateNls"),l=0,s=o.length;l<s;l++)!0===o[l]._manageNLS&&(delete o[l]._manageNLS,a.updateNLS(o[l]));"datagridview"===t.getActiveView()&&m.isRelationsColumnsActive()&&require(["DS/ENORIPE_Columns/RelationsColumns","DS/IPClassifyUtil/bsd_utils/BSDPlatformUrl","DS/TerminologyEditor/utils/TerminologySearch"],(e,n,i)=>{i.isSearchActive()||n.retrievePlatformUrl().then(()=>{e.setHardcodedConfiguration("BME");var n=new Set;if(o.forEach(function(e){e.isRelationsObjectNode||e._isProcessedForRelationsColumns||(n.add(e.getID()),e._isProcessedForRelationsColumns=!0)}),n.size>0){var i=p.getContent().getSelectedNodes();e.updateAttributes({pids:[...n]},()=>{i.forEach(function(e){e.select()})},t.options.model)}})})}},200);let o=!0;e&&e.collectionView&&e.collectionView.getRowModelLength&&0===e.collectionView.getRowModelLength()&&(o=!1),o&&this._debounceMethod(e)}})}),define("DS/TerminologyEditor/controllers/ReadMode",["DS/TerminologyEditor/controllers/CommonMode","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyEditorWebServiceReadMode","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyListContent_Read","DS/TerminologyEditor/views/TerminologyMode"],function(e,t,o,n,i,r,a,l){return e.extend({supportClientSort:!1,init:function(e){this._parent(e);var t=this;this._indexInfo=null,this._currentFldId=null,this._isPageRefreshed=!1,this._methodsTobeExecutedAfterFirstScroll=[],r.onSearchChange(function(){t.resetInfoIndex()})},convertData:function(e){return t.convertToExaleadDataFormat(e)},manageError:function(e){return(e=JSON.parse(e)).error.errorMessage},loadContents:function(e){var t=this;return this.isTagSet=!1,this.cancelQuery(),new Promise(function(o,n){e.next_start=null;var i=t.getInfoIndex();null!==i?e.next_start=i.next_start:t.isInfiniteScrollingTobeDone()&&t.setSearchTags(e),e.filters=t.getRefineTagsTobeApplied(),e.onComplete=function(e){null==t._indexInfo&&(t._isPageRefreshed=!0),e=JSON.parse(e),t.setInfoIndex(e.infos);var n=e.results,i={contents:n=n||[],sorted:!0,inProgress:t.isInfiniteScrollingTobeDone()};o(i)},e.onFailure=function(e,t){n({err:e,serverErr:t})},t._contentHandleRequest=a.listContent(e)})},onSetPathTags:function(e){this.unColorizeChildren(e)},getObjectsInTree:function(){return n.getContent().getPADTreeDocument().getAllDescendants().length},onFilterFilteringEvent:function(){},unColorizeChildren:function(e){e.options.model.withTransactionUpdate(function(){e.options.model.getRoots().forEach(function(e){var t={grid:{bi_color:"rgba(0, 0, 0, 0)"}};e.getAllDescendants().forEach(function(e){delete e.options.color,e.updateOptions(t)})})})},getNumberLastResult:function(){return this._indexInfo?this._indexInfo.nresults:0},setInfoIndex:function(e){var t=this._infoIndex;this._indexInfo=e||null,this.isInfiniteScrollingTobeDone()&&null==t&&this._indexInfo&&this._methodsTobeExecutedAfterFirstScroll.forEach(function(e){e()})},onreadResult:function(e){this._methodsTobeExecutedAfterFirstScroll.push(e)},getInfoIndex:function(){return this._indexInfo},resetInfoIndex:function(){this._isPageRefreshed=!0,this._indexInfo=null},getModeType:function(){return"read"},getSearchTags:function(){return this._facets},setSearchTags:function(e){var t=this;e.next_start=null,e.synthesis=!0,e.onComplete=function(e){e=JSON.parse(e),t._facets=e.facets,t.isTagSet=!0,t.dispatchEvent("searchTagisSet")},e.filters=this.getRefineTagsTobeApplied(),this.isItTerminologySection()?i.getRoots(e):i.getContentReadMode(e)},setRefineTags:function(e){this._refine=e},getRefineTags:function(){return this._refine},isInfiniteScrollingTobeDone:function(){var e=this.isItTerminologySection();return"read"==l.getCurrentModeType()&&e},getRefineTagsTobeApplied:function(){if("TerminologySection_AllTerminologies"==o.getCurrentTerminology().getType()){var e=n.getTreeCont()._tagNavigator;return{...e.getLocalFilter()?e.getLocalFilter():{},...this.getRefineTags()?this.getRefineTags():{}}}return this.getRefineTags()?this.getRefineTags():{}},isItTerminologySection:function(){return"TerminologySection_AllTerminologies"==o.getCurrentTerminology().getID()}})}),define("DS/TerminologyEditor/models/TerminologyInfo",["UWA/Controls/Abstract","UWA/Class/Options","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/service/TerminologyEditorWebService"],function(e,t,o,n){"use strict";var i=e.extend(t,{_id:null,_type:null,_label:null,init:function(e){this._parent(e),this._id=e.id,this._type=e.type,this._label=e.label},getID:function(){return this._id},getType:function(){return this._type},getLabel:function(){return this._label},getChildrenInfos:function(e){var t,r=[];(t=o.getTreeCont()._getVisibleNodeById(this._id))?(t.getChildren().forEach(function(e){r.push(new i({id:e.getID(),type:e.plmType||"Terminology",label:e.getLabel()}))}),e.onComplete(r)):n.terminologies({pid:this._id,onComplete:function(t){(t=JSON.parse(t)).terminologies.forEach(function(e){r.push(new i({id:e.id,type:e.type||"Terminology",label:e.label}))}),e.onComplete(r)},onFailure:function(t){console.warn("WebService terminologies Err : "+t),e.onFailure(t)}})}});return i}),define("DS/TerminologyEditor/TerminologyIdCardCont",["UWA/Core","DS/IPClassifyUXUtil/ActionBar/IPToolbar","UWA/Class/Options","DS/Utilities/TouchUtils","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/models/TerminologyInfo","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/IPClassifyModelEvents"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h){"use strict";function f(e){console.log(e)}return t.extend(o,{name:"enoTerminologyIdCard_Container",_currentPathNodes:null,_dropTerminology:null,_dropPartIDs:null,_counter:0,getCommandManager:function(){return s},createPathInfo:e=>new u({id:e.id,mxid:e.mxid,type:e.type,label:e.label}),getEntryForCommand:e=>{var t=null;return"IndexMode"===e&&(t=i.getToolbarEntry()),t},init:function(e){l.setIdCardCont(this);var t=this,o=p.getLeftPanelStatus(),n=p.getRightPanelStatus();widget.addEvent("ontoolbarReady",()=>{var t=p.getDefaultView(),o=s.getCommand(t);o&&o.options.icon&&e.modelEvents.publish({event:"toolbar_update_command",data:{commandID:"display",data:{icon:{iconName:o.options.icon,fontIconFamily:1}}}})}),e.leftOpened=o&&o.leftPanelState,e.rightOpened=n&&n.rightPanelState,e.modelEvents=h.getModelEvents(),e.searchInCurrentTab=!0,this._parent(e),this._buildSkeleton(),e.modelEvents.subscribe({event:"searchValueSet"},m.changeSearch.bind(m)),a.onCurrentTerminologyChange(function(e){t.setCurrentLocation()}),this.noSearchConfiguration(),this.dispatchEvent.call(this,"onReady")},inject:function(){this._parent.apply(this,arguments),this.setCurrentLocation()},setCurrentLocation:function(){var e=g.getCurrentTerminologyPath();this._parent({objectPath:e})},isSearchAvailable:function(e){return!1},showSearch:function(e){this._parent(!1),this.noSearchConfiguration()},noSearchConfiguration:function(){var e=n.getTouchMode()?"150px":"101px";this.elements.elementStableCommands.setStyle("flex-basis",e)},render:function(){return this},_buildSkeleton:function(){this.topRightSideDiv=document.getElementsByClassName("TerminologyEditor_top_right_side_div"),a.subscribeEvents(),this.topRightSideDiv[0].addEventListener("dragover",this._onDragOver,!0),this.topRightSideDiv[0].addEventListener("drop",this._onDrop,!0),this.topRightSideDiv[0].addEventListener("dragenter",this._onDragEnter,!0),this.topRightSideDiv[0].addEventListener("dragleave",this._onDragLeave,!0),this.topRightSideDiv[0].addEventListener("contextmenu",this._rightClick)},_rightClick:function(e){var t=e?e.target:null;return(!t||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName)&&(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()),!1},_onDragOver:function(e,t,o,n){return e.preventDefault&&e.preventDefault(),!1},_onDragEnter:function(e,t,o,n){l.getIdCardCont();e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var i=e.target?e.target:e.detail.target;return l.getIdCardCont()._updateBorderDnD(i,!0),!0},_onDragLeave:function(e,t,o,n){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),l.getIdCardCont()._updateBorderDnD(e.target,!1),!0},_onDrop:function(e,t,o,n){var i,r=!1,a=l.getIdCardCont();return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),l.getIdCardCont()._updateBorderDnD(e.target,!1),g.getCurrentTerminology()&&"TerminologySection_Trash"===g.getCurrentTerminology().plmType?(c.displayNotification({message:d.msg_warning_dndnotsupported,className:"error"}),!1):(m.isSearchActive()||(i=a._getSerializedData(e))&&(r=a._performDropAction(i)),r)},_updateBorderDnD:function(e,t){var o=this.elements.titleIdCard_container;e&&(t?(this._counter=this._counter+1,o.addClassName("dropallowed_elem")):(this._counter=this._counter-1,0===this._counter&&o.removeClassName("dropallowed_elem")))},_performDropAction:function(e){var t,o,n=null;return(n=1===(t=e.data.items.length)?(o=e.data.items[t-1]).path?this._expandDroppedPath(o):this._expandDroppedItem(o):{isDropped:!1,msg:t>1?d.msg_warning_MultipleSelection:d.msg_warning_dndnotsupported}).isDropped||c.displayNotification({message:n.msg,className:"error"}),n.isDropped},_expandDroppedItem:function(e){var t,o,n,i,r=!1,a=null;(t=e.objectId,n=e.displayName||"",o=this._getObjectDroppedType(e),t&&o)?(i=l.getTreeCont(),r=!0,t!==g.getCurrentTerminologyID()&&i.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[t],type:o,name:n},onComplete:f.bind(null," expandTreeAndSelectTerminology:onComplete"),onGiveUp:f.bind(null," expandTreeAndSelectTerminology:onGiveUp"),onFailure:function(e){c.displayNotification({message:d.replace(d.get("msg_error_TerminologyActivate"),{name1:n}),className:"error"})}})):(r=!1,a=d.msg_warning_notProductRoot);return{isDropped:r,msg:a}},_getObjectDroppedType:function(e){var t,o,n,i=null;if(t=e.objectType_Internal||e.objectType,Array.isArray(t)&&t.length>0){for(o=t.length,n=0;n<o;++n)if(r.inFamilyTerminology(t[n])){i=t[n];break}}else r.inFamilyTerminology(t)&&(i=t);return i},_expandDroppedPath:function(e){var t,o,n,i,r,a,s=!1,c=null,u=0,m=!1;if(this._dropTerminology=null,this._dropPartIDs=[],(t=e.path)&&t.length>0){if(n=t.length,a=this._getLastIndexOfTerminology(t),i=g.getCurrentTerminology(),r=g.getCurrentTerminologyID(),o=this._getObjectDroppedType(e),-1===a&&!i&&!o)return{isDropped:!1,msg:d.msg_warning_nocurrentterminology};if(a>=0?(this._dropTerminology={id:t[a].resourceid,type:t[a].type,displayName:t[a].displayName||""},a+1<n&&(u="Vaulted Objects"===t[a+1].type?a+2:a+1,this._setProductsIDsPath(u,t)),m=r!==this._dropTerminology.id):(this._dropTerminology=o?{id:e.objectId,type:o,displayName:e.displayName||""}:{id:r,type:i.getType(),displayName:i.getLabel()||""},m=r!==this._dropTerminology.id,this._setProductsIDsPath(u,t)),s=!0,m)this._expandNodeOfPath(this._dropTerminology);else if(this._dropPartIDs.length>0){l.getContent().expandBranches(this._dropPartIDs)}}else s=!1,c=d.msg_warning_dndnotsupported;return{isDropped:s,msg:c}},_getLastIndexOfTerminology:function(e){var t,o=-1,n=e.length;for(t=0;t<n;++t)r.inFamilyTerminology(e[t].type)&&(o=t);return o},_setProductsIDsPath:function(e,t){var o,n=t.length;for(o=e=e>-1?e:0;o<n;++o)this._dropPartIDs.push(t[o].resourceid)},_getSerializedData:function(e){var t,o,n,i,r,a="";for(o=e.dataTransfer?e.dataTransfer:e.detail?e.detail:null,n=UWA.is(o.types.indexOf,"function")?"indexOf":"contains",i=["text/searchitems","text/plain","Text"],t=0;t<i.length&&""===a;t++){var l=o.types[n](i[t]);(UWA.is(l,"number")&&l>=0||UWA.is(l,"boolean")&&!0===l)&&(a=i[t])}return""!==a&&(r=o.getData(a)),r&&r.length?JSON.parse(r):null},_expandNodeOfPath:function(e){var t,o=this;return!(!(t=l.getTreeCont())||!e)&&(t.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e.id],type:e.type,name:e.displayName},onComplete:function(e){var t=l.getContent();o._dropPartIDs.length>0&&t.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),o._dropTerminology.id===e&&this.expandBranches(o._dropPartIDs)})},onGiveUp:function(e){console.log("expandTreeAndSelectTerminology: onGiveUp")},onFailure:function(t){c.displayNotification({message:d.replace(d.get("msg_error_TerminologyActivate"),{name1:e.displayName}),className:"error"})}}),!0)}})}),define("DS/TerminologyEditor/TermXNavComponent",["DS/TerminologyEditor/infra/xTermComponent","DS/WidgetServices/WidgetServices"],function(e,t){"use strict";return e.extend({name:"pad_component",init:function(e){var t,o,n=(t=e,(o={x3dAppId:"ENOPAD",widget:widget,amd_custo:{TreeDocument:"DS/TerminologyEditor/TerminologyTreeDocument",TreeListView:"DS/TerminologyEditor/views/TerminologyTreeListView",TileGridView:"DS/TerminologyEditor/views/TerminologyTileView",ThumbnailGridView:"DS/TerminologyEditor/views/TerminologyThumbnailView"},layout:{}}).layout=UWA.clone(t.layout_opts),delete(o=UWA.extend(o,t,!0)).layout_opts,o),i=this._parent.bind(this);this.setTerminologyCommunicationChannel(),require(["UWA/Utils/Client"],function(e){i(n)})},render:function(){return this},getPADTileGridView:function(){return this.options.views.tileview},getPADThumbnailGridView:function(){return this.options.views.thumbnailview},getEditMode:function(){return t.getWidgetPreferenceValue("EditModeActivated")},addRootNodes:function(e){if(!UWA.is(e,"array"))throw new Error("nodes parameter must be an array");var t=[],o=this.options.model;o&&o.wrapInTransaction(function(){o.withTransactionUpdate(function(){o.addRoot(e);for(var n=0;n<e.length;n++)t.push(e[n].getID());o.getRoots().length;UWA.is(o.detachedRoots,"array")&&o.detachedRoots.length,o.getModelEvents().publish({event:"onRootAdded",data:{nb_root:o.getRoots().length,added_node:e[o.getRoots().length-1]}})})})},getSelectedNodes:function(){return this.options.model.getSelectedNodes()},getActiveView:function(){return this.options?this.options.active_view:"datagridview"},_dispatchReady:function(){!0===this.options.isReady.model&&!0!==this.options.isReady.PADmodel&&(this.options.isReady.PADmodel=!0),!0===this._dispatchReady_NotDone&&!0===this.options.isReady.model&&!0===this.options.isReady[this.options.active_view]&&(this.dispatchEvent.call(this,"onReady"),this.dispatchEvent("onActionBarReadyToBuild"),this._dispatchReady_NotDone=!1)}})}),define("DS/TerminologyEditor/views/TerminologyTagger",["UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologyEditorDataConversion","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/views/TerminologyWebInWinTaggerProxy","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i,r,a,l,s,d,c){"use strict";var g={},u={};return e.extend({init:function(e){var o=this;if(o.favDataProvider=e.favDataProvider,!0===widget.getValue("noCompass")){window.widgetId||(window.widgetId="LibraryEditor"+Math.random().toString(36).substr(2,9)),(n=i(window.widgetId)).events.addFilterChangeListener=o._onFilterChange.bind(o),n.events.addCriteriaChangeListener=o._onFilterChange.bind(o),o.taggerProxy=new s(n)}else{var n=i(widget.id);(o.taggerProxy=t.createProxy(n)).addEvent("onFilterChange",o._onFilterChange.bind(o))}function i(e){return{widgetId:e,filteringMode:"FilteringOnServer",colorize:!1,events:{addOpenTaggerListener:o._onOpenTagger.bind(o),addCloseTaggerListener:o._onCloseTagger.bind(o)}}}o._isFilterSet=!1,o._filterObjs=null,o.taggerProxy.deactivate(),o._retriveFiltersFromPref(),o._isFirstView=!0},_setSubjectTags:function(e){if(e&&this.taggerProxy){var t={};for(var o in e){var n=e[o];if(t[n.sixw])t[n.sixw][n.object]=n;else{var i={};i[n.object]=n,t[n.sixw]=i}}var r=[];for(var a in t)for(var l in g[a]||(u[a]=t[a]),u[a])r.push(u[a][l]);this.taggerProxy.setTags(null,r)}else this.taggerProxy.setTags(null,[])},_unsetTags:function(){var e=this.taggerProxy;e&&e.unsetTags()},_onFilterChange:function(e){if(d.getTreeCont()&&d.getTreeCont()._indexModeforReadData.resetInfoIndex(),d.getContent()&&d.getContent().getSpecficMode("read").resetInfoIndex(),e){var t=this;for(var o in g={},e.localfilters||(e.localfilters={}),e.localfilters)g[o]=[];this.setLocaFilter(e.localfilters);var n=t._fetchTerminologyIDs(e.localfilters);if(t._isFilterSet=0!==Object.keys(e.localfilters).length,!t._isFilterSet)return i.notifyTreeFilterChange(t._isFilterSet),void t._saveSelectedFiltersInPref();Promise.all([n]).then(function(e){var o=e[0];t._filterObjs=new Set(o),i.notifyTreeFilterChange(t._isFilterSet)}),t._saveSelectedFiltersInPref()}},_fetchTerminologyIDs:function(e){var t=this;return new Promise(function(i){o.allTerminologies({filters:e,select_predicate:["physicalid"],onComplete:function(e){t._setSubjectTags(e.facets),i(n.getObjectIdsFromSearchRes(e.results))},onFailure:function(){i([])}})})},_onOpenTagger:function(){a.isTreeTaggerActive()&&this.populateData()},populateData:function(){var e=this,t=e.taggerProxy.getCurrentFilter();o.allTerminologies({filters:t&&t.localfilters?t.localfilters:{},select_predicate:["physicalid"],onComplete:function(t){e._setSubjectTags(t.facets)},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})},setSelectedFiltersFromPref:function(){this.taggerProxy&&this._localFilters&&this._isFirstView&&(this._isFirstView=!1,this.taggerProxy.setLocalFilter(this._localFilters))},_retriveFiltersFromPref:function(){this._localFilters=a.getTreeTaggerPreference("tree_filter_v1")},_saveSelectedFiltersInPref:function(){if(this.taggerProxy){var e=this.taggerProxy.getCurrentFilter();a.setTreeTaggerPreference("tree_filter_v1",e.localfilters?e.localfilters:{})}},removeFilters:function(){if(this.taggerProxy){var e=this.taggerProxy.getCurrentFilter();e&&e.localfilters&&Object.keys(e.localfilters).length>0&&(this.taggerProxy.clearLocalFilter(),this.taggerProxy.dispatchEvent("onFilterChange",{localfilters:{}}),l.displayNotification({message:c.msg_info_treeFilterRemove,className:"primary"}))}},activateTaggerProxy:function(){this.taggerProxy&&(this.taggerProxy.activate(),this.populateData())},deactivateTaggerProxy:function(){this.taggerProxy&&this.taggerProxy.deactivate()},_onCloseTagger:function(){a.isTreeTaggerActive()&&this._unsetTags()},isObjectVisible:function(e){var t=!1;return!this._filterObjs||!this.isFilterSet()||(this._filterObjs.has(e)&&(t=!0),t)},getFilteredTerminologies:function(){var e=[];return this._filterObjs.forEach(t=>e.push(t)),e},isFilterSet:function(){return!0===this._isFilterSet},setLocaFilter:function(e){this._localFilters=e},getLocalFilter:function(){return this._localFilters}})}),define("DS/TerminologyEditor/views/TerminologyOrderCmd",["UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","DS/TerminologyEditor/utils/TerminologyEditorUtil","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/Controls/TooltipModel","DS/Menu/Menu","DS/TerminologyEditor/views/TerminologyMode"],function(e,t,o,n,i,r,a,l,s){"use strict";return e.extend(t,o,{_name:"terminology_orderTools",_defaultOptions:{sortMode:"alpha",sortOrder:"asc"},init:function(e){this._parent(e),this.sortMode=widget.getValue("sortMode")||this._defaultOptions.sortMode,this.sortOrder=widget.getValue("order")||this._defaultOptions.sortOrder,this.oldSelected=null,this._buildSkeleton()},_buildSkeleton:function(){var e=this;this.elements.container=UWA.createElement("div",{id:"terminology_orderTools"}),this._filterFonticon=UWA.createElement("i",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-filter terminology_fonticon_filter",title:i.fonticon_filter}).inject(this.elements.container),this._filterFonticon.hide(),this._dropDownMenu=UWA.createElement("i",{id:"bsd_orderby_menu_icon",class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-alpha-sorting-a-z terminology_fonticon_orderby sprite",title:i.alpha_sorting}).inject(this.elements.container),this._dropDownMenu.show(),this._dropDownMenu.addEventListener("click",function(t){var o=e._getMenuItems();l.show(o,{position:{x:t.target.getBoundingClientRect().left,y:t.target.getBoundingClientRect().bottom}})})},_getMenuItems:function(){var e="wux-ui-3ds wux-ui-3ds-1x ";e+="alpha"===this.sortMode&&"asc"===this.sortOrder&&null!=this.oldSelected?"wux-ui-3ds-alpha-sorting-z-a":"wux-ui-3ds-alpha-sorting-a-z";var t="wux-ui-3ds wux-ui-3ds-1x ";return t+="date"===this.sortMode&&"asc"===this.sortOrder?"wux-ui-3ds-date-sorting-31-1":"wux-ui-3ds-date-sorting-1-31",[{title:i.alpha_sort_label,type:"PushItem",fonticon:{content:e},tooltip:i.alpha_sorting,action:{this:this,callback:this.toggleButton,context:{sortMode:"alpha"}}},{title:i.date_sort_label,type:"PushItem",fonticon:{content:t},tooltip:i.date_sorting,action:{this:this,callback:this.toggleButton,context:{sortMode:"date"}}}]},_getMenuIcon:function(e,t){return"alpha"===e?"asc"===t?"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-alpha-sorting-a-z":"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-alpha-sorting-z-a":"asc"===t?"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-date-sorting-1-31":"wux-ui-3ds wux-ui-3ds-1x terminology_fonticon_orderby sprite wux-ui-3ds-date-sorting-31-1"},toggleButton:function(e){var t=e.context.sortMode;if(this.sortOrder=this.oldSelected===t?"desc"===this.sortOrder?"asc":"desc":this._defaultOptions.sortOrder,this.oldSelected=t,this.sortMode=t,this._dropDownMenu.className=this._getMenuIcon(this.sortMode,this.sortOrder),"read"==s.getCurrentModeType()){var o=r.getTreeCont();o._indexModeforReadData.resetInfoIndex(),o._rootNodeTerminologies.collapse({updateView:!0}),o._rootNodeTerminologies.expand({updateView:!0})}else this.sortingNodesUnsensitiveCase();widget.setValue("sortMode",this.sortMode),widget.setValue("order",this.sortOrder)},getSortMode:function(){return this.sortMode},sortingNodesUnsensitiveCase:function(){var e=r.getTreeCont();e&&e._terminologies_TreeView&&(e._terminologies_TreeView.sortModel=[{dataIndex:"tree",sort:this.sortOrder}],e._terminologies_TreeView.reapplySortModel())},sortingChildrenNodes:function(e){var t=this,o=r.getTreeCont()._terminologies_TreeView;o.prepareUpdateView(),e.sortChildren({isRecursive:!0,sortFunction:function(e,o){return("asc"===t.sortOrder?1:-1)*t.mySortFunction(e,o)}}),o.pushUpdateView()},mySortFunction:function(e,t){var o;this.sortOrder;if(e.isRoot()&&t.isRoot())return null;if("date"!==this.sortMode)return n.compareLabels(e.options.label,t.options.label);try{o=new Date(e.options.modified)>new Date(t.options.modified)?1:new Date(e.options.modified)<new Date(t.options.modified)?-1:0}catch(n){o=e.options.modified<t.options.modified?-1:1}finally{return o}},setOrderToolAreaSelectable:function(e){e?this.elements.container.style.setProperty("cursor","pointer"):this.elements.container.style.setProperty("cursor","default")}})}),define("DS/TerminologyEditor/TerminologyTreeCont",["UWA/Core","UWA/Utils","UWA/Controls/Abstract","UWA/Class/Options","UWA/Class/Events","UWA/Promise","DS/Logger/Logger","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/WebappsUtils/WebappsUtils","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/views/TerminologyGlobalActiveTerminology","DS/TerminologyEditor/Terminology_CSO","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/IPClassifyUtil/IPClassifyAlert","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/TerminologyEditor/service/TerminologyDnDServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/Terminology_Clipboard","DS/IPClassifyUtil/IPClassifyModelEvents","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/utils/TerminologyCommunication","DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener","DS/TerminologyEditor/views/TerminologyOrderCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/TerminologyEditor/views/TerminologyTagger","DS/DataGridView/DataGridView","DS/Core/PointerEvents","DS/IPClassifyUtil/bsd_utils/BSDConfiguration","DS/DataGridView/DataGridViewLayout","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/IPClassifyFindInContext/FindInTree","i18n!DS/TerminologyEditor/assets/nls/TerminologyFindInTree","DS/TerminologyEditor/utils/TerminologyExpandUtil_Read","DS/TerminologyEditor/utils/TerminologyNavigateUtil_Read","DS/TerminologyEditor/views/TerminologyMode","text!DS/TerminologyEditor/assets/TerminologyEditorConf.json","DS/TerminologyEditor/dataProvider/TerminologyFindInDataProvider"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v,T,_,C,S,b,E,D,w,A,I,x,P,N,O,R,M,U,F,L,W,V,k,B){"use strict";var j=new D,z=d.getWebappsAssetUrl("TerminologyEditor","icons/22/I_Browsing_Structure_22.png"),G={iconName:"browsing-structure-node",fontIconFamily:1},H={iconName:"browsing-structure-root",fontIconFamily:1};function q(e){return e._modelEvents}var J=o.extend(n,i,{name:"TerminologyTree_Cont",time_to_expand_node:1500,_terminologies_TreeDocument:null,_terminologies_TreeView:null,_logger:null,_terminologyContentView:null,_commandProxy:null,_rootNodeTerminologies:null,_rootNodeTrash:null,_terminologies_SortElmt:null,_currentDragEnterTerminology:null,_timerDragEnter:null,propIDCard:"not initialized!",defaultOptions:{limitExpand:2e3},init:function(e){var t=this;this._parent(e),this._terminologyStructurePreference.options=this.options,this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"});var o=widget.getValue("useIndexAcceleration")?V.getCurrentModeType():"authoring";V.setCurrentModeType(o),this.refreshMap=b.getMapforPreferenceRefresh(),this._donNotApplyFilterForRead=!1,A.app_initialization(function(){t._buildUI()}),S.getModelEvents().subscribe({event:"select_breadcrumb_object"},({id:e,type:t,name:o})=>{this.expandTreeAndSelectTerminology({terminologyToFindAndSelect:{ids:[e],type:t,name:o},onComplete:function(e){console.log(" expandTreeAndSelectTerminology:onComplete")},onGiveUp:function(e){console.log(" expandTreeAndSelectTerminology:onGiveUp")},onFailure:function(e){p.displayNotification({message:y.replace(y.get("msg_error_TerminologyActivate"),{name1:o}),className:"error"})}})})},_buildUI:function(){this._rootServiceHandler=null,this._logger=a.getLogger(J);var e=this;this._commandProxy=m.create({events:{onRefresh:e._onRefresh.bind(e)}}),f.onTerminologyRename(function(t){var o=t.getID(),n=t.getLabel();e.updateNodeLabel(o,n)}),E.subscribe("TerminologyEditor.RequestCurrentTerminology",function(){h.dipatchSecurityContextAndTerminology()}),f.onCurrentTerminologyChange(function(t){if(e._terminologyStructurePreference.select(this.pathId),this.id&&""!==this.id&&T.inFamilyTerminology(this.plmType)){for(var o=u.getCurrentTerminologyPath(),n=[],i=Array.isArray(o)?o.length:0,r=0;r<i-1;r++)n.push({resourceid:o[r].id,type:o[r].type});var a={};if(i>=1){var l=i-1;o[l].id&&(a[o[l].id]={type:o[l].type,label:o[l].label})}t.currentNode&&!T.isSection(t.currentNode.getType())&&[t.currentNode],e._commandProxy.select({paths:[[this.id]],attributes:a,terminologyPath:n,doNotSetOnCompass:!0}),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var o={id:t.currentNode.getID(),label:t.currentNode.getLabel(),type:t.currentNode.options.type};e.publish("selectedTerminologyInTree",o)}})}else"TerminologySection_Trash"!==this.plmType&&"TerminologySection_AllTerminologies"!==this.plmType||e._commandProxy.select({paths:[],attributes:{},terminologyPath:[],doNotSetOnCompass:!0});e._scrollOnPostUpdateView(t.currentNode),h.dipatchSecurityContextAndTerminology()}),e._buildSkeleton(),e._terminologies_SortElmt=new w,e._terminologies_FindInTree=new U({dataProvider:B}),e._commonToolSection=UWA.createElement("div",{class:"terminology-common-tool-Section",id:"terminology-common-tool-Section"}),R.isTouchDevice()&&e._commonToolSection.setAttributeNode(document.createAttribute("touch-mode")),e.getSortingContainer().inject(e._commonToolSection),e.getFindInTreeIcon().inject(e._commonToolSection),e._terminologies_FindInTree.getUI().inject(e._commonToolSection);var t=this._terminologies_TreeView?this._terminologies_TreeView.getTreeDocument():void 0;this._terminologies_TreeDocument=t,t&&(t.options.shouldBeEditable=h.shouldBeEditable,t.onNodeModelUpdate(h.onNodeModelUpdate),t.options.shouldAcceptDrag=this._shouldAcceptDrag.bind(this),t.options.shouldAcceptDrop=this._shouldAcceptDrop.bind(this),t._getTrueRoot().onPreExpand(this._onPreExpandTreeNode.bind(this)),t.getXSO().onChange(function(t){var o=e._terminologies_TreeDocument.getXSO().get();if(o&&o.length>0){var n=o[o.length-1];n.getID=n.getID?n.getID:function(){return this.id},n.getType||(n.getType=function(){return this.plmType});var i=u.getCurrentTerminology();if(i!==n){u.addInTerminologyCSO(n,"TREE")}}})),b.checkSecurityCTXandTenantInitialization(function(){A.app_initialization(function(){A.getEnforceFolderLinkSettingAsync(function(t,o){M.addComponentsToLoad("global",{tree:""}),M.removeComponentToLoad("global","widget");var n=d.getWebappsAssetUrl("TerminologyEditor","icons/32/I_Browsing_Structure_32.png"),i={useAsyncPreExpand:!0};i.label=y.name_Section_AllTerminologies,i.icons=[n],i.children=[],i.id="",i.plmType="TerminologySection_AllTerminologies",e._rootNodeTerminologies=e._createTreeNodeModel(i,e._terminologies_TreeDocument),e.dispatchEvent.call(e,"onReady"),e._terminologyStructurePreference.isExpanded(e._rootNodeTerminologies.pathId,e=>{e||M.removeComponentToLoad("global","tree")})})})}),e._tagNavigator=new I({favDataProvider:null}),e._tagNavigator.setSelectedFiltersFromPref(),b.setTreeFilter(e._tagNavigator),f.onTreeFilterChange(function(t){e._applyFilterOnTerminologies(),e._updateFilterIconOnToolbox(t)}),f.onTaggerStatusChange(function(){e.manageTreeTaggerVisibility()})},manageTreeTaggerVisibility:function(){h.isTreeTaggerActive()?this._tagNavigator.activateTaggerProxy():this._tagNavigator.deactivateTaggerProxy()},_applyFilterOnTerminologies:function(e){if(this._tagNavigator)if(e)this._tagNavigator.isObjectVisible(e.getID())?e.show():e.hide();else if(this._terminologies_TreeDocument){if("read"==V.getCurrentModeType())return this._donNotApplyFilterForRead?(this._indexModeforReadData.resetInfoIndex(),this._terminologies_TreeDocument.getRoots()[1].removeChildren(),void this._populateRootTerminology()):void(this._donNotApplyFilterForRead=!0);for(var t=this._terminologies_TreeDocument.getRoots(),o=u.getCurrentTerminology(),n=[],i=null,r=0;r<t.length;++r)t[r]&&(n=n.concat(t[r].getChildren()),o&&-1!==o.pathId.indexOf(t[r].plmType)&&(i=t[r]));o&&!this._tagNavigator.isObjectVisible(o.getID())&&i&&i.select({onlyUI:!0})}},_getIcon:function(e){var t=e.icon,o=e.type;return T.isTerminology(o)?t=H:T.isTerm(o)&&(t=G),t||z},_refreshNodes:function(e){for(var t=0;t<e.length;t++)this.updateNodeLabel(e[t])},_getAllRoots:function(){var e=this._terminologies_TreeDocument.getRoots(),t=[];return e.forEach(function(e){"TerminologySection_AllTerminologies"===e.plmType&&(t=e.getChildren())}),t},_onRefresh:function(e){if(e&&e.authored&&(e.authored.modified&&UWA.is(e.authored.modified,"array")&&this._refreshNodes(e.authored.modified),e.authored.deleted&&UWA.is(e.authored.deleted,"array")&&e.authored.deleted.length>0)){var t=this._getAllRoots(),o=!1;t.every(function(t){return!(o=!!t&&e.authored.deleted.indexOf(t.id)>=0)}),o?this.refreshTerminologyTreeAndContent(e.authored.deleted):this._refreshNodes(e.authored.deleted)}},render:function(){return this},destroy:function(){this._logger.log("destroy"),this._parent()},_onContextualEvent:function(e){var t=this;return e&&e.cellInfos&&e.cellInfos.nodeModel.select(),new r(function(o){t.__onContextualMenuReady(e).then(function(e){o(e)})})},_buildSkeleton:function(){var e=this;this.elements.container=UWA.createElement("div",{class:this.getClassNames()+"_container"}),this.getOption("css_view_class")&&this.elements.container.addClassName(this.getOption("css_view_class")),this.elements.terminologyTreeView_container=UWA.createElement("div",{class:this.getClassNames()+"_treeview_container"}).inject(this.elements.container);var t=UWA.clone(N.getConfig("dgvOptions")),o=t&&t.dgv?t.dgv:{};o.selectionBehavior.toggle=R.isTouchDevice(),o.selectionBehavior.unselectAllOnEmptyArea=!1,o.infiniteScrolling=!0,o.onContextualEvent=e._onContextualEvent.bind(e),o.rowSelection="single",o.showRowBorderFlag=!1,o.columns=[{dataIndex:"tree",sortableFlag:!1,typeRepresentation:"string",getCellEditableState:function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&T.inFamilyTerminology(e.nodeModel.plmType))},editionPolicy:"DelayedEditionOnClick",setCellValue:function(e,t){if(e.nodeModel){var o=e.nodeModel;require("DS/TerminologyEditor/commands/TerminologyCommands")._cellToRename={cellInfos:e,context:"TREE"},o.getTreeDocument().withTransactionUpdate(function(){var e={};e.label=t,e.display=t,e.oldLabel=o.options.label,o.updateOptions(e)})}},compareFunction:function(t,o,n,i,r){return e._terminologies_SortElmt.mySortFunction(n,i)},onCellRequest:function(e){e.isHeader||(e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("terminology-state-is-being-cut"):e.cellView.getContent().removeClassName("terminology-state-is-being-cut")),this.defaultOnCellRequest(e)}}];var n=UWA.extend({identifier:"DataGridView-"+e.name+"-"+widget.id},o),i=UWA.clone(t.dgvLayout);n.layout=new O(i),n.layout.useLastColumnWidthAutoFlag=!0,n.layout.columnsHeader=!1;var r=new l;n.treeDocument=r,n.rowReorderEnabledFlag=!0,n.useAsyncPreExpand=!0;var a=new x(n).inject(this.elements.terminologyTreeView_container);this._terminologies_TreeView=a;["esc","del","ctrl+f","alt+return","f2","ctrl+x","ctrl+v"].forEach(function(e){a._keymapManager.registerKeymap(e,void 0)}),a.setUseClipboardFlag(!1),a.onCopy=j.launchKeyAction.bind(j,"ctrl+c"),a.onCut=j.launchKeyAction.bind(j,"ctrl+x"),a.onPaste=j.launchKeyAction.bind(j,"ctrl+v"),a.showAlternateBackgroundFlag=!1,a.treeNodeCellOptions.depthIncrement=14,a.treeNodeCellOptions.buildLinks=!0,a.treeNodeCellOptions.expanderStyle="triangle",a.selectNextCellOnEnterFlag=!1,a.onDragStartCell=this._onDragStartCell.bind(this),a.onDragEndCell=this._onDragEndCell.bind(this),a.onDragLeaveCell=this._onDragLeaveCell.bind(this),a.onDragOverCell=this._onDragOverCell.bind(this),a.onDropCell=this._onDropCell.bind(this),a.onDragEnterBlank=this._onDragEnterBlank.bind(this),a.onDragOverBlank=this._onDragOverBlank.bind(this),a.onDropBlank=this._onDropBlank.bind(this),a.onDragLeaveBlank=this._onDragLeaveBlank.bind(this),a.addEventListener(P.POINTERDOWN,function(t,o){2===t.multipleHitCount&&o&&-1!==o.rowID&&e._switchExpandStatus(o)}),a.onInfiniteScroll(function(t){e._processForInfiniteScroll(t,a)})},_processForInfiniteScroll:function(e,t){var o=this;if(e.reachBottom){var n=!1;if("read"==V.getCurrentModeType()){var i=this._indexModeforReadData.getInfoIndex(),r=this._indexModeforReadData.getNextStart(),a=i?i.nhits:null;isNaN(a)||(n=r<a)}n&&!this._indexModeforReadData.isInfiniteScrollingInProcess()&&(this._indexModeforReadData.setInfiniteScrollingStatus(!0),this._populateRootTerminology(function(){o._indexModeforReadData.setInfiniteScrollingStatus(!1)},!0))}t.infiniteScrollProcessDone()},_populateRootTerminology:function(e,t){t="boolean"==typeof t&&t,M.addComponentsToLoad("global",{tree:""}),this._rootNodeTerminologies.expand({updateView:!0,doNotRemoveNodes:t,explicitMethodToBeExecuted:e})},escape:function(){this._terminologies_TreeView.commands.escape.bind(this._terminologies_TreeView)()},_switchExpandStatus:function(e){!0===e.nodeModel._isExpanded?e.nodeModel.collapse():e.nodeModel.expand()},_cancelRootServiceHandler:function(){this._rootServiceHandler&&this._rootServiceHandler.cancel(),this._rootServiceHandler=null},_preExpandDone:function(e){let t="partiallyExpanded"===e.getState();e.preExpandDone(),t?e.setState({state:"partiallyExpanded"}):"expanded"===e.getState()&&e.setState({state:"expanded"})},_onPreExpandTreeNode:function(e){setTimeout(this.__onPreExpandTreeNode.bind(this,e))},__onPreExpandTreeNode:function(e,t,o){var n=e.data.nodeModel;if(e.data.onlyUI)this._preExpandDone(n);else{var i,r,a=this;b.isCustomizedEnv(),a._terminologyStructurePreference.getExpandedChildren(e.parent.pathId,function(e){i=e}),a._terminologyStructurePreference.getExpandedChildren(e.parent.pathId,function(e){r=e},!0,e.data&&!0===e.data.updateView);var l="TerminologySection_AllTerminologies"===n.plmType;l&&(this._cancelRootServiceHandler(),!0!==e.data.doNotRemoveNodes&&this._indexModeforReadData.resetInfoIndex());var s=n.getNodeDepth(),d={pid:n.id,level:e.data.expandLevel,expandList:i,partialExpandList:r,isRoot:l,isTerminology:"Terminology"===n.plmType,onComplete:function(t){if((t=JSON.parse(t)).error)return p.displayNotification({message:t.error.message,className:"error"}),n.loadHasFailed=!0,a._preExpandDone(n),void n.collapse();!0!==e.data.doNotRemoveNodes&&n.removeChildren();var o=void 0!==t.terminologies?t.terminologies:t.member,d={0:n},c=[],g=[].concat.apply([],r),m=l?"root":n.getID();if(g.indexOf(m)>=0&&c.push(n),o.forEach(function(t){var o={useAsyncPreExpand:!0};o.label=void 0!==t.label?t.label:t.title,o.icons=[a._getIcon(t)],o.children=[],o.id=t.id,o.mxid=t.mxid,o.created=t.created,o.modified=t.modified,o.plmType=t.type,o.type=t.type,UWA.is(t.publishOnConnect)&&(o.publishOnConnect=t.publishOnConnect),o.terminologyClassification=t.terminologyClassification;var l=t&&t.level?parseInt(t.level):1;if(1===l&&"TerminologySection_AllTerminologies"==n.plmType){var s=a._getIcon(t);o.icons=[s],o.plmType="Terminology",UWA.is(t.publishOnConnect)&&(o.publishOnConnect=t.publishOnConnect)}if(d[l]=a._createTreeNodeModel(o,d[l-1]),"Terminology"===o.plmType&&a._applyFilterOnTerminologies(d[l]),!e.data.expandLevel)if(-1!==i.indexOf(o.id))d[l].expand({onlyUI:!0});else if(-1!==g.indexOf(o.id))for(var u in r)if(-1!==r[u].indexOf(o.id)){r[u].indexOf(o.id)!==r[u].length-1&&(d[l].expand({onlyUI:!0}),c.push(d[l]));break}}),n.loadHasFailed=!1,a._preExpandDone(n),e.data.expandLevel>=0&&o.length>0){var h={onlyUI:!0,initialLevel:s,expandLevel:e.data.expandLevel,clearLast:e.data.clearLast};0===e.data.expandLevel?(h.expandAll=!0,n.expandNLevels(h)):(h.numberOfLevelsToExpand=e.data.expandLevel,n.expandNLevels(h))}if(c.forEach(function(e){e.setState({state:"partiallyExpanded"})}),a._terminologies_SortElmt.sortingNodesUnsensitiveCase(),n.options.children=null===n.options.children?[]:n.options.children,e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),!a.isInitialized&&(a.isInitialized=!0,a._terminologies_TreeDocument.getXSO().isEmpty()&&"read"==V.getCurrentModeType()))if(b.getTreeFilter().isFilterSet())a._rootNodeTerminologies.select();else if(a._terminologyStructurePreference.getSelection().length>0){var f=a._terminologyStructurePreference.getSelection().split(","),v=f[f.length-1];W.getNavigateDataforTerminology({pids:[v],onComplete:function(e){var t=JSON.parse(e);if(t.error)a._rootNodeTerminologies.select();else{for(var o=t[v],n=a._rootNodeTerminologies,i=null,r=0;r<o.length;r++){var l=o[r],s={useAsyncPreExpand:!0};s.label=l.label,s.children=[],s.id=l.id,s.mxid=l.mxid,s.plmType=l.type,s.created=l.created,n=a._createTreeNodeModel(s,n),0==r&&(i=n)}u.addInTerminologyCSO(n,"TREE"),i.remove(),a._terminologyStructurePreference.add(i.pathId),p.displayNotification({message:y.replace(y.get("msg_warning_TerminologyNotVisisbleinTree"),{name:n.getLabel()}),className:"warning"})}},onFailure:function(e){a._rootNodeTerminologies.select()}})}M.removeComponentToLoad("global","tree")},onFailure:function(t){e.data.explicitMethodToBeExecuted&&e.data.explicitMethodToBeExecuted(),n.loadHasFailed=!0,a._preExpandDone(n),a._logger.log("WebService terminologies Err : "+t),M.removeComponentToLoad("global","tree")}};"read"==V.getCurrentModeType()?L.listTerminology(d):(c.terminologyTree(d),a._indexModeforReadData.resetInfoIndex())}},_onDragStartCell:function(e,t){C.SetAsExternalDrop(!1);var o=t.nodeModel,n=o.getID(),i=o.plmType,r="";r="Term"==i?"Term":"Terminology"==i?"Terminology":i;var a=null,l=o.getParent();l&&!l.isRoot()&&T.inFamilyTerminology(l.plmType)&&(a=l.getID());for(var s=[];l&&!l.isRoot();){var d=l.plmType;"Terminology"==d?d="Term":"RootTerminology"==d&&(d="Terminology"),T.inFamilyTerminology(d)?(s.push({resourceid:l.getID(),type:d}),l=l.getParent()):l=null}s.reverse();var c={envId:R.getTenantID(),serviceId:"3DSpace",contextId:(widget.getValue("xPref_CREDENTIAL"),"ctx::"+widget.getValue("xPref_CREDENTIAL")),objectId:n,objectType:r,terminologyClassification:o.options?o.options.terminologyClassification:void 0,displayName:o.getLabel(),terminologyId:a};s&&(c.terminologyPath=s);var g={protocol:"3DXContent",version:"1.1",source:"ENOTERME_AP",widget_id:v.getWidgetId(),data:{items:[c]}};try{e.dataTransfer.setData("text/searchitems",JSON.stringify(g))}catch(e){}return e.dataTransfer.setData("Text",JSON.stringify(g)),e.dataTransfer.effectAllowed="copyMove",v.setStartDrag(!0),v.setDragFrom("bookmark"),e.stopPropagation(),!1},_onDragEndCell:function(e,t){v.setStartDrag(!1),v.setDragFrom("")},_onDragLeaveCell:function(e,t){return this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterTerminology=null,!0},_onDragOverCell:function(e,t){if(e.preventDefault(),1!=widget.launchWithReadMode){var o=t.nodeModel;return e&&e.dataTransfer&&("TerminologySection_Trash"===o.plmType?e.dataTransfer.dropEffect="none":e.dataTransfer.dropEffect=v.isDragging()&&v.isMoveDnDSetting()&&!v.hasFilesInEvent(e)?"move":"copy"),t&&(t.dropPosition="middle"),this._dndDropPosition=t.dropPosition,this._currentDragEnterTerminology&&this._timerDragEnter&&this._currentDragEnterTerminology!==t.nodeModel.getID()&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterTerminology===t.nodeModel.getID()||t.nodeModel.isExpanded()||"expanding"===t.nodeModel.getState()||(this._timerDragEnter=setTimeout(function(){t.nodeModel.expand()},this.time_to_expand_node)),this._currentDragEnterTerminology=t.nodeModel.getID(),!0}},_onDropCell:function(e,t){if(e.preventDefault(),1!=widget.launchWithReadMode){if("middle"!==t.dropPosition)return!0;C.SetAsExternalDrop(!0),this._timerDragEnter&&(clearTimeout(this._timerDragEnter),this._timerDragEnter=null),this._currentDragEnterTerminology=null;var o=t.nodeModel;v.performDropOnTerminologyEditorNode(o,e),v.setDragFrom("")}else p.displayNotification({message:y.msg_warning_DndNotSupported,className:"warning"})},_onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none")},_onDragLeaveBlank:function(e,t){var o=b.getTreeCont();o._timerDragEnter&&(clearTimeout(o._timerDragEnter),o._timerDragEnter=null),o._currentDragEnterTerminology=null},_onDragOverBlank:function(e,t){},_onDropBlank:function(e,t){v.setDragFrom("")},_shouldAcceptDrag:function(e){var t=u.getCurrentTerminology();return!(!t||!T.isTerm(t.getType()))},_shouldAcceptDrop:function(e){return!0},isTerminologyActiveDefined:function(e){var t=b.getActiveTerminology();return t.id===e||t.disabledId===e},updateTreeWithNewTerminology:function(e){var t,o=this,n=this._rootNodeTerminologies;n&&n.isAscendantOf(e)?e.isVisible()&&(t=e):t=n===e?e:o._getVisibleNodeById(e.id,null),t&&c.terminologyTree({isRoot:"TerminologySection_AllTerminologies"==t.plmType,pid:t.id,onComplete:function(e){e=JSON.parse(e),"TerminologySection_AllTerminologies"==t.plmType?(o.refreshTreeWithServerData(e.member,"Terminology",t),o._tagNavigator.removeFilters()):o.refreshTreeWithServerData(e.member,"Term",t)},onFailure:function(e){o._logger.log("WebService terminologies Err : "+e)}})},refreshTreeWithServerData:function(e,t,o){var n,i,r=h.generateJSON(e),a=o.getChildren().slice(0),l=0;for(UWA.is(a)&&(l=a.length),n=0;n<l;++n)r[(i=a[n]).id]||this.removeFromTree(i),delete r[i.id];for(var s in r){i=r[s];var d={useAsyncPreExpand:!0},c=this._getIcon(i);d.label=i.label,d.icons=[c],d.children=[],d.id=s,d.mxid=i.mxid,d.plmType=t,d.created=i.created,d.terminologyClassification=i.terminologyClassification,this._createTreeNodeModel(d,o)}this._terminologies_SortElmt.sortingNodesUnsensitiveCase()},removeFromTree:function(e){if(e){var t,o,n=this._rootNodeTerminologies;n&&n.isAscendantOf(e)?e.isVisible()&&(t=e,o=e.getParent()):(t=this._getVisibleNodeById(e.id,null),o=t?t.getParent():null),o&&t&&(!0===o.hasChildren()&&o.removeChild(t),!1===o.hasChildren()&&(o.withTransactionUpdate(function(){o.setState({state:"collapsed"})}),o.options.children=[]))}},updateNodeLabel:function(e,t){var o=this,n=[],i=UWA.is(e,"string")?e:e.physicalid?e.physicalid:null;n=i?this._getNodesById(i):[e];var r=function(e){var t=u.getCurrentTerminologyID();n.forEach(function(o){if(o.getLabel()!==e){o._lastUpdateTime=Date.now();var i=UWA.extend(o.options,{label:e,oldLabel:e},!0);o.withTransactionUpdate(function(){o.updateOptions(i)})}1===n.length&&t===n[0].getID()&&(u.updateLabelCurrentTerminologyPath(),b.getIdCardCont().setCurrentLocation(),UWA.is(widget)&&widget.setTitle(o.getLabel()))})};if(n.length>0)if(t)r(t),this._terminologies_SortElmt.sortingChildrenNodes(n[0].getParent());else if(UWA.is(n[0].getID,"function")){let e=n[0];var a=e.getID();c.getTerminologyProperties({pid:a,onComplete:function(t){if(UWA.is(t,"string")&&(t=JSON.parse(t)),t.id){var i=t.label;r(i),function(e){if(1===n.length){var t=n[0],o="TRUE"===e?d.getWebappsAssetUrl("TerminologyEditor","icons/terminologyPublishBadge.png"):"";t.setBadges({bottomRight:o})}}(t.publishOnConnect),o._terminologies_SortElmt&&o._terminologies_SortElmt.sortingChildrenNodes(e.getParent())}else e.isSelected()&&e.getParent().select(),e.remove()},onFailure:function(){console.error("Unable to update Tree Label, Error in getting terminology Properties")}})}},_updateFilterIconOnToolbox:function(e){e?this._terminologies_SortElmt._filterFonticon.show():this._terminologies_SortElmt._filterFonticon.hide()},expandTreeAndSelectTerminology:function(e){var t=this,o=e&&e.terminologyToFindAndSelect?e.terminologyToFindAndSelect.ids:void 0,n=[],i=!0;if(e.findInTree&&i&&(this.findInTree=!0,e.findInTreeLoader.setMessage(F.loader.formulatingPaths),e.findInTreeLoader.loader.addEventListener(P.POINTERHIT,function(t){if(i=!1,e.onComplete){var o={terminologyToFindAndSelect:e.terminologyToFindAndSelect};e.onComplete(o)}})),o&&i){n=JSON.parse(JSON.stringify(o));for(var a=0;a<o.length;a++){var l=t._getVisibleNodeById(o[a],null);if(l){const r=n.indexOf(o[a]);r>-1&&n.splice(r,1);u.getCurrentTerminology();if(e.doNotSelectInTree?this.findInTree||u.addInTerminologyCSO(l,"TREE"):(t._scrollToVisibleNode(l),l.select(!0)),!i)break}}if(n.length>0&&i){var s=[],d=u.getCurrentTerminology(),g={pids:o,onComplete:function(o){if(!(o=JSON.parse(o)).error&&i){var n=Object.keys(o),a=function(l){r.allSettled(s).then(function(){var c=o[n[l]];if(e.findInTree){var g=l/n.length*100;e.findInTreeLoader.updateLoader(g.toString())}if(!c&&o.error&&(t._logger.warn("Unable to retrieve TerminologyPath using WebService"),e.onFailure))return e.onFailure(o.error);if(!function(e){var t=!1;if(u.getCurrentTerminology()!==d&&(t=!0,e.onGiveUp)){var o={terminologyToFindAndSelect:e.terminologyToFindAndSelect};e.onGiveUp(o)}return t}(e))if(t._rootNodeTerminologies){for(var m=null,p=null,h=t._rootNodeTerminologies,f=h.pathId,v=0;v<c.length;v++){var _=c[v],C=_.id;if(T.isTerm(_.type)?"Term":T.isTerminology(_.type)&&("Terminology",p=C),C){if(!m){var S=t._getVisibleNodeById(C,h);S&&S.isVisible()?(h=S,f=S.pathId):m=h}if(m){var b=f;t._terminologyStructurePreference.add(b,null,null,e.partiallyExpandPath),h=null,f=f+","+C}}else t._logger.log("unexpected undefined parentObjectId")}if(p)if(m){var E=b+","+n[l];e.doNotSelectInTree?(t._terminologyStructurePreference.select(""),t._terminologyStructurePreference.scrollAfterSelect(""),t._TreeNodeToBeAddedtoTerminologyCSOWithoutSelection_pathId=E):(t._terminologyStructurePreference.select(E),t._terminologyStructurePreference.scrollAfterSelect(n[l])),e.partiallyExpandPath?(t._terminologyStructurePreference.add(E),t._terminologyStructurePreference.remove(E)):t._terminologyStructurePreference.remove(E),"expanding"!==m.getState()&&i&&s.push(new r(function(e,t){try{m.expand({updateView:!0,postExpandResolvePromise:function(){e()}})}catch(e){console.log(e),t()}}))}else console.log("   Damnation, no firstUnexpandedTreeNodeModelParentFound");else e.onFailure&&e.onFailure(new Error(y.msg_error_NoVisibleRootTerminology))}else t._logger.log("  No TerminologySection_AllTerminologies to start expandTreeAndSelectTerminology"),e.onFailure&&e.onFailure(new Error(y.msg_error_TreeExpandCancelledNotReady));l!==Object.keys(o).length-1&&i?a(l+=1):r.allSettled(s).then(function(){if(e.onComplete&&i){var t={terminologyToFindAndSelect:e.terminologyToFindAndSelect};e.onComplete(t)}})})};i&&a(0)}else if(t._logger.warn("Unable to retrieve TerminologyPath using WebService"),e.onFailure&&o.error)return e.onFailure(o.error)},onFailure:function(e){b.checkRolesAvailability(function(e,t,o){1==e||1==t||1==o?p.displayNotification({message:y.msg_error_terminologyPath,className:"error"}):p.displayNotification({message:y.msg_error_terminologyPath_roles,className:"error"})})}};"read"==V.getCurrentModeType()?W.getNavigateDataforTerminology(g):c.getTerminologyPath(g)}else if(e.onComplete){var m={terminologyToFindAndSelect:e.terminologyToFindAndSelect};e.onComplete(m)}}else t._logger.log("expandTreeAndSelectTerminology error : terminologyToFindAndSelect is undefined"),e.onFailure&&e.onFailure(new Error("Tree exploration stopped, terminologyToFindAndSelect is undefined"))},_getNodesById:function(e,t){var o=[],n=[],i=this;t?o=[t]:i._terminologies_TreeDocument.getRoots().forEach(function(e){e&&o.push(e)});return o.forEach(function(t){t.getID()==e&&n.push(t);var o=t.getChildren();UWA.is(o,"array")&&o.forEach(function(t){i._getNodesById(e,t).forEach(function(e){n.push(e)})})}),n},_getVisibleNodeById:function(e,t){var o=t||this._rootNodeTerminologies,n=null;if(o&&o.isVisible())if(o.getID()===e)n=o;else if(o.isExpanded()){var i=o.getChildren();if(Array.isArray(i)&&i.length>=1)for(var r=0;r<i.length;r++){var a=i[r];if(a){if(a.id==e){n=a;break}var l=this._getVisibleNodeById(e,a);if(l&&l.isVisible()){n=l;break}}}}return n},_terminologyStructurePreference:{_prefixes:["_X_","_P_"],_partialExpandPrefix:"_P_",_getID:function(e,t){if(e[t])return e[t];for(var o=0;o<this._prefixes.length;++o){var n=e[this._prefixes[o]+t];if(n)return n}return null},_getPreferenceID:function(e,t){if(e[t])return t;for(var o=0;o<this._prefixes.length;++o)if(e[this._prefixes[o]+t])return this._prefixes[o]+t;return t},_scrollToNode:function(){return"scrollToNode - "+R.getTenantID()},_getPreferenceTree:function(e){return e||(e={}),e},_getStoredTerminologyTreeStructure:function(){var e=widget.getValue("terminologyTreeStructure");try{e=e?JSON.parse(h.jsonUnzip(e)):{}}catch(t){e={}}return this._getPreferenceTree(e)},add:function(e,t,o,n){var i=this;function r(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return e[t]=e[i._prefixes[o]+t],void delete e[i._prefixes[o]+t]}if(!o||!0!==o.isFailure){var a=this._getStoredTerminologyTreeStructure(),l=e.split(","),s=a;l.forEach(function(e,o){s[e]||s[i._partialExpandPrefix+e]?!1===t&&(r(s,e),o==l.length-1&&(s[e]={})):n?s["_X_"+e]?(s[i._partialExpandPrefix+e]=s["_X_"+e],delete s["_X_"+e]):s[i._partialExpandPrefix+e]={}:!function(e,t){for(var o=0;o<i._prefixes.length;++o)if(e[i._prefixes[o]+t])return!0;return!1}(s,e)?s[e]={}:r(s,e),o!=l.length-1||n||r(s,e),s=s[e]?s[e]:s[i._partialExpandPrefix+e]}),i.saveTerminologyStruture(a)}},remove:function(e,t){var o=this,n=this._getStoredTerminologyTreeStructure(),i=e.split(","),r=n,a=!1;i.forEach(function(e,n){r&&(n<i.length-1?(n==i.length-2&&r[o._partialExpandPrefix+e]&&(a=!0),r=o._getID(r,e)):(!t&&(r[e]&&Object.keys(r[e]).length>0||r[o._partialExpandPrefix+e]&&Object.keys(r[o._partialExpandPrefix+e]).length>0||a)&&(r["_X_"+e]=r[e]?r[e]:r[o._partialExpandPrefix+e]),t&&r["_X_"+e]?delete r["_X_"+e]:r[e]?delete r[e]:delete r[o._partialExpandPrefix+e]))}),o.saveTerminologyStruture(n)},isExpanded:function(e,t){var o=this,n=this._getStoredTerminologyTreeStructure(),i=e.split(","),r=!1,a=n;i.forEach(function(e,t){a&&t<i.length-1?a=o._getID(a,e):a&&(r=void 0!==a[e]||void 0!==a["_P_"+e])}),t.call(window,r)},recursive:function(e,t,o,n){var i=this;function r(e){return e.replace(i._partialExpandPrefix,"")}var a=null,l=e?Object.keys(e).length:0,s=0===o.length?[]:o[o.length-1];function d(e,t){var n=!!a?a:s;l>1&&!t&&(a=n.slice()),n=t?[]:n,o.indexOf(n)<0&&o.push(n),n.push(e)}for(var c in e){var g=-1!==c.indexOf(i._partialExpandPrefix),u=-1!==c.indexOf("_X_");if(e[c])if(n){var m=-1!==t.indexOf(i._partialExpandPrefix);u?m&&d(c.replace("_X_","")):(g?d(r(c),!m):m&&d(c),this.recursive(e[c],c,o,n))}else u||(g||o.push(r(c)),this.recursive(e[c],c,o,n))}},getExpandedChildren:function(e,t,o,n){var i=this,r=this._getStoredTerminologyTreeStructure(),a=e.split(","),l=[],s=r;a.forEach(function(e,t){if(s&&t<a.length-1)s=i._getID(s,e);else if(s){var r=i._getID(s,e),d=i._getPreferenceID(s,e),c=-1!==d.indexOf(i._partialExpandPrefix);if(o&&c&&n){var g=d.replace(i._partialExpandPrefix,"");g="TerminologySection_AllTerminologies"===g?"root":g,l.push([g])}i.recursive(r,d,l,o)}}),t.call(window,l)},saveTerminologyStruture:function(e){if(e&&e.root&&e.root.e&&(e={}),e=JSON.stringify(e),e=h.jsonZip(e),!1!==widget.getValue("expandSaveLimitation")&&e.length>this.options.limitExpand){let e=y.get("msg_warning_expandSaveLimitation");p.displayNotification({title:e.Title,subtitle:e.Advice,message:e.Details,className:"warning",id:"expandLimitation",debounce:!0})}else widget.setValue("terminologyTreeStructure",e)},select:function(e){var t=h.jsonUnzip(widget.getValue("terminologyTreeSelectedNode")||"{}");(t=JSON.parse(t))[R.getTenantID()]=e,t=JSON.stringify(t),widget.setValue("terminologyTreeSelectedNode",h.jsonZip(t))},isSelected:function(e){return this.getSelection()==e},isSelectValuated:function(){return!!this.getSelection()},getSelection:function(){var e=h.jsonUnzip(widget.getValue("terminologyTreeSelectedNode")||"{}");return(e=JSON.parse(e))[R.getTenantID()]},scrollAfterSelect:function(e){widget.setValue(this._scrollToNode(),e)},doScrollAfterSelect:function(e){return widget.getValue(this._scrollToNode())===e}},_indexModeforReadData:{_indexInfo:null,_nextStart:0,_infinteScrollinginProcess:!1,isInfiniteScrollingInProcess:function(){return this._infinteScrollinginProcess},setInfiniteScrollingStatus:function(e){this._infinteScrollinginProcess=e},getInfoIndex:function(){return this._indexInfo},getNextStart:function(){return this._nextStart},setNextStart:function(e){this._nextStart=e},resetInfoIndex:function(){this._indexInfo=null,this._nextStart=0,this._infinteScrollinginProcess=!1},setInfoIndex:function(e){this._indexInfo=e||null}},_scrollOnPostUpdateView:function(e){var t=this,o=this._terminologies_TreeView?this._terminologies_TreeView:null;o&&o.onPostUpdateViewOnce(function(){t._terminologyStructurePreference.doScrollAfterSelect(e.getID())&&(t._scrollToVisibleNode(e),t._terminologyStructurePreference.scrollAfterSelect(""))})},_doScrolltotheSavedPosition:function(){var e=this._terminologies_TreeView;if(e._getScroller()){var t=h.getTreeViewScrollerPosition();void 0!==t.x&&null!==t.x&&void 0!==t.y&&null!==t.y&&e.setScrollerPosition(t)}},_createTreeNodeModel:function(e,t,o){var n=this,i=t instanceof l,r=e.publishOnConnect;e.terminologyClassification;delete e.publishOnConnect;var a=new s(e);if(a.id=e.id,a.plmType=e.plmType,e.created&&(a.created=e.created),a._instanceType="TerminologyEditor/TreeNodeModel",a._loadingcounter=0,a.getID=function(){var e=this.id;return e&&""!==e||(e=this.plmType),e},a.getType=function(){return this.plmType},a.options.oldLabel=e.label,a.pathId=(i?"root":t.pathId)+","+a.getID(),"TRUE"===r){var c=d.getWebappsAssetUrl("TerminologyEditor","icons/terminologyPublishBadge.png");a.setBadges({bottomRight:c})}var m=!1;if(A.getEnforceFolderLinkSettingAsync(function(e,t){e||(m=t)}),m||b.isCustomizedEnv()||b.isActiveTerminologyActivated()){var p=b.getActiveTerminology(),h=p.id,f=p.disabledId;h===a.id?a.setBadges({topRight:g.ICON_ACTIVE}):f===a.id&&a.setBadges({topRight:g.ICON_ACTIVE_DISABLED})}a.onPostExpand(function(e){if(!e||!e.data||!0!==e.data.updateView&&!e.data.onlyUI||e.data.expandLevel){var t=!1;!1!==e.data.clearLast&&e.data.nodeModel.getNodeDepth()-e.data.initialLevel==e.data.expandLevel-1||(t=!0),n._terminologyStructurePreference.add(this.pathId,t,{isFailure:!0===this.loadHasFailed})}else e.data.postExpandResolvePromise&&e.data.postExpandResolvePromise()}),a.addEventListener("preCollapseAll",function(){n.deactivatePostCollapse=!0}),a.addEventListener("postCollapseAll",function(){n.deactivatePostCollapse=!1,n._terminologyStructurePreference.remove(this.pathId,!0)}),a.onPostCollapse(function(e){!0===n.deactivatePostCollapse||e.data.updateView||n._terminologyStructurePreference.remove(this.pathId)}),q(a).subscribe({event:"removeChild"},function(e){if(a.isExpanded()&&a.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&n._terminologyStructurePreference.remove(t.pathId)}}),q(a).subscribe({event:"addChild"},function(e){if(a.isExpanded()&&a.isVisible()){var t=e.nodeModel;!t&&e.data&&(t=e.data.nodeModel),t&&t._isExpanded&&n._terminologyStructurePreference.add(t.pathId)}}),i?t.addRoot(a):("partiallyExpanded"===t.getState()&&(n._terminologyStructurePreference.add(a.pathId),n._terminologyStructurePreference.remove(a.pathId),n._terminologyStructurePreference.add(t.pathId)),t.addChild(a,o));if(n._terminologyStructurePreference.isExpanded(a.pathId,function(e){var o;e&&(o="expand",i?a[o]({updateView:!0}):t.isExpanded()?("expand"!==o||!a.isExpanded()&&"expanding"!==a.getState())&&a[o]({onlyUI:!0}):q(t).subscribeOnce({event:"postExpand"},function(e){"expanding"!==a.getState()&&("partiallyExpanded"===a.getState()&&"expand"===o||a[o]({onlyUI:!0}))}))}),"TerminologySection_AllTerminologies"==e.plmType&&(n._terminologyStructurePreference.isSelectValuated()||n._terminologyStructurePreference.select(a.pathId)),n._terminologyStructurePreference.isSelected(a.pathId)){for(var y=a;null!=y&&!y.isVisible();)y=y.getParent();y===a?a.select():q(y).subscribeOnce({event:"postExpand"},function(e){n._terminologies_TreeDocument.getXSO().empty(),a.select()})}else a.pathId===n._TreeNodeToBeAddedtoTerminologyCSOWithoutSelection_pathId&&(this.findInTree||(u.addInTerminologyCSO(a,"TREE"),n._TreeNodeToBeAddedtoTerminologyCSOWithoutSelection_pathId=void 0));return a},__onContextualMenuReady:function(e){return new r(function(t){var o=e.cellInfos;o.cellView;if(o.cellModel){var n=u.getSelectedNodes(),i=[];n.length&&n.forEach(function(e){i.push(e)}),i.length&&i.forEach(function(e){e.unselect()});var r=!1;if(o.nodeModel)if(!1===o.nodeModel._isSelected&&(o.nodeModel._isSelected=!0,o.nodeModel.select(!0)),!0===o.nodeModel._isSelected)(o.nodeModel?o.nodeModel:o.cellModel)&&(r=!0);r?_.GetContextualMenu(o,"TREE",e).then(function(e){e&&t(e)}):t([])}else t([])})},refreshTerminologyTreeAndContent:function(e){var t=this.changeInPreference(),o=null;if(t.isPreferenceChangeCauseOfRefresh&&Object.keys(t.change).length>0)for(var n in t.change){if(!this.refreshMap.has(n)){o="allRefresh";break}1!==this.refreshMap.get(n)||(o="contentRefresh")}if(!t.isPreferenceChangeCauseOfRefresh||o){var i=b.getContent().getPADTreeListView(),r=i?i.getManager():null;r&&(b.getContent()._componentScrollerPosition=r.getScrollerPosition());var a=b.getContent().getPADTreeDocument();a&&a.keepExpandedState();var l=u.getCurrentTerminology();l.getType();if(!this._terminologyStructurePreference.isSelectValuated()||l&&e&&e.indexOf(l.id)>=0){l&&l.unselect(),this._terminologyStructurePreference.select("root,TerminologySection_AllTerminologies"),this._rootNodeTerminologies.select()}return this._rootNodeTerminologies.isExpanded()?t.isPreferenceChangeCauseOfRefresh&&"contentRefresh"===o?void(l.pathId.contains("TerminologySection_AllTerminologies")&&b.getContent().loadContentAndSelect(l)):(("TerminologySection_AllTerminologies"==l.plmType||!l.isVisible()&&l.pathId.contains("TerminologySection_AllTerminologies"))&&b.getContent().loadContentAndSelect(l),this._rootNodeTerminologies.collapse({updateView:!0}),void this._rootNodeTerminologies.expand({updateView:!0})):void(("TerminologySection_AllTerminologies"==l.plmType||!l.isVisible()&&l.pathId.contains("TerminologySection_AllTerminologies"))&&b.getContent().loadContentAndSelect(l))}},switchTerminologyTreeNodeLabelToWriteView:function(e){try{var t=!1;if(e instanceof s&&T.inFamilyTerminology(e.plmType)&&e.getTreeDocument()===this._terminologies_TreeDocument&&this._terminologies_TreeView){var o=this._terminologies_TreeView;if(o){var n=o.layout.getColumnIndex("tree"),i=o.layout.getCellsFromNodeModel(e)[n];o.setCellInEdition(i),t=!0}}return t}catch(e){}},getSortingContainer:function(){return this._terminologies_SortElmt.elements.container},getFindInTreeIcon:function(){return this._terminologies_FindInTree.elements.container},_scrollToVisibleNode:function(e){var t=this._terminologies_TreeView,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},modeChange:function(e){if(!1!==widget.getValue("compactModeForLeftSidebar")){var t=this._terminologies_TreeView.layout.cellHeight,o=t;if("comfortable"===e.viewMode)o=38;else{if("compact"!==e.viewMode)return;o=26}var n=o!==t;this._terminologies_TreeView.layout.cellHeight=o,n&&this._terminologies_TreeView.updateView(!0)}},toUpdateView:function(){var e=this._terminologies_TreeView&&this._terminologies_TreeView.getManager();if(e){var t=e.getDocument(),o=e._isPreparingView,n=e._updateCounter;e.unloadDocument(),e._syncRowIndexes(!0),e.loadDocument(t),e._isPreparingView=o,e._updateCounter=n,e.updateView(!0)}},changeInPreference:function(){return{change:widget.changeInPreference,isPreferenceChangeCauseOfRefresh:widget.refreshDuetoChangeInPreference}},activateTreeFilter:function(e){if(e!=R.getWidgetPreferenceValue("activateTreeFilter")){R.setWidgetPreferences({name:"activateTreeFilter",type:"hidden",value:e});var t=b.getContent();e?(UWA.extendElement(t.elements.padshell._leftPanel).addClassName("TerminologyEditor_LeftView_Select"),UWA.extendElement(this._commonToolSection).addClassName("terminology-common-tool-Section_Select")):(UWA.extendElement(t.elements.padshell._leftPanel).removeClassName("TerminologyEditor_LeftView_Select"),UWA.extendElement(this._commonToolSection).removeClassName("terminology-common-tool-Section_Select")),f.notifyTaggerStatusChange()}},setOrderToolAreaSelectable:function(e){this._terminologies_SortElmt.setOrderToolAreaSelectable(e)},getCommonToolSection(){return this._commonToolSection},getGridViewRowHeight:function(){let e=JSON.parse(k).settings.dgvOptions.value.dgvLayout.cellHeight,t=this._terminologies_TreeView.layout;return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("TerminologyTree_Cont-root_treeview_container");if(t&&t.length>0){e=t[0].clientHeight}}return e}});return J}),define("DS/TerminologyEditor/models/xTermDocumentRefresh",["UWA/Class","UWA/Class/Promise","DS/TerminologyEditor/models/_xTermCVParser","DS/IPClassifyUtil/bsd_utils/BSDSession","DS/IPClassifyUtil/bsd_utils/BSDPUWSAccess","DS/WidgetServices/WidgetServices","DS/TerminologyEditor/utils/TerminologyEditorcontrol","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json"],function(e,t,o,n,i,r,a,l){"use strict";function s(e){e.options.isNotManagedByPS||e.hasChildren()||(e.setState({state:"collapsed"}),e.childComputed=!1)}var d=e.extend({});return!0!==r.getWidgetPreferenceValue("refresh_v2")&&(d.prototype.refresh=function(e){var d=this,c=[],g=function(t){t&&0!==t.length||(t=[{msg:l.refresh_ok}]);for(var o=0;o<t.length;o++){var n=t[o];e.cb&&e.cb(n)}},u=(l.refresh_ongoing,(e=e||{}).roots||this.getRoots());if(u.length>0){var m=[],p=[];if(null!=u&&u.forEach(function(e){for(var t=[],o=[e];o.length;){var n=o.pop();if(null!=n)t.push(n.getOccurencePath()),n.getOccurencePath().forEach(function(e){p.indexOf(e)<0&&p.push(e)}),o=o.concat(n.getChildren())}m.push(t)}),0===m.length&&0===[].length)g();else{var h=[];if(m.length>0){var f=new t(function(e,t){var c,g={session:m,intent:"explore_2D",debug:r.getWidgetPreferenceValue("enopad_webapis_debug"),type_filter_bo:r.getWidgetPreferenceValue("type_filter_bo")};i.refresh({data:g,onComplete:function(t){var i=UWA.is(t,"string")?JSON.parse(t):t;if(void 0!==i){c=d.startTransaction("refresh");var r=n.determineAuthoredFlag(),l=!1;r&&(l=!0),o.process.expand({treedocument:d,root_nodes:u,starting_from_root:i.full_path,response:i,mode:"refresh",needNewStructure:l,expand_level:r?1:-1,security_counts_HTML:null}),r&&function(e){for(var t=e.getRoots(),o=0;o<t.length;o++){var n=t[o];s(n),n.processDescendants({processNode:function(e){s(this)}})}}(d);var g=a.getContent().getPADTreeListView();if(g)g.getManager().reapplySortModel();d.invalidateViewPort(),c&&c.end()}e()},onFailure:t.bind(this,l.generic_service_failure)})});h.push(f)}t.all(h).catch(function(e,t,o){t=t||"Exception thrown during the process of the refresh answer "+(o?o.toString():""),e.push({msg:t,eventID:"error"})}.bind(this,c)).finally(function(){g(c)})}this.withTransactionUpdate(function(){for(var e=UWA.clone(u,!1);e.length;){var t=e.pop();null!=t&&(t.isSelected()&&t.unselect(),e=e.concat(t.getChildren()))}})}}),d}),define("DS/TerminologyEditor/TerminologyTreeDocument",["DS/Logger/Logger","DS/TerminologyEditor/xTermDocument","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/service/TerminologyDnDServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/models/xTermDocumentRefresh","DS/LifecycleServices/LifecycleServicesSettings","DS/WebappsUtils/WebappsUtils","DS/Utilities/Utils","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r,a,l,s,d,c,g){"use strict";var u=t.extend(l,{name:"TerminologyTreeDocument",_doNotAddTerminology:!1,init:function(t){t.shouldAcceptDrag=this.shouldAcceptDrag.bind(this),t.shouldAcceptDrop=this.shouldAcceptDrop.bind(this),t.allowUnsafeHTMLContent=!1,t.insert=this.insert.bind(this),t.authorize_setStructure=!0,t.shouldBeEditable=a.shouldBeEditable,this._parent(t),this.onNodeModelUpdate(a.onNodeModelUpdate);var n=this;this._commandProxy&&this._commandProxy.addProxyEvents({events:{onRefresh:function(e){if((UWA.is(e.authored.created,"array")||UWA.is(e.authored.modified,"array"))&&n.refreshNodeById({created:e.authored.created,modified:e.authored.modified}),UWA.is(e.authored.deleted,"array")){var t=[];e.authored.deleted.forEach(function(e){t=t.concat(n.getNodesById(e))}),n.deleteNodes(t,!0)}}}}),this._logger=e.getLogger(u),this._logger.log("init");n=this;this.selection_broadcast_fn=c.debounce(function(){var e=g.getIdCardCont();if(e&&e.updateSelectionCount(n.getSelectedNodes().length),!n._doNotAddTerminology){var t=n.getXSO().get();if(t&&t.length>0){var i=t[0];i.getID||(i.getID=function(){return this.id}),i.getType||(i.getType=function(){return this.plmType})}o.addInTerminologyCSO(t,"CONTENT")}},100),this.getXSO().onChange(n.selection_broadcast_fn),this.getXSO().onEmpty(function(){n._doNotAddTerminology=!1,n.selection_broadcast_fn()}),this.getXSO().onPreEmpty(function(){n._doNotAddTerminology=!0})},_buildSelectData:function(){var e=this._parent();if(e){var t=o.getCurrentTerminology();if(Array.isArray(e.paths)&&e.paths.length>=1){if(t&&i.inFamilyTerminology(t.plmType)){for(var n=o.getCurrentTerminologyPath(),r=[],a=Array.isArray(n)?n.length:0,l=0;l<a;l++)r.push({resourceid:n[l].id,type:n[l].type});e.terminologyPath=r}}else if(t&&i.inFamilyTerminology(t.plmType)){n=o.getCurrentTerminologyPath();var s=[];for(a=Array.isArray(n)?n.length:0,l=0;l<a-1;l++)s.push({resourceid:n[l].id,type:n[l].type});var d={};if(a>=1){var c=a-1;n[c].id&&(d[n[c].id]={type:n[c].type,label:n[c].label})}e.paths=[[t.id]],e.attributes=d,e.terminologyPath=s}}return e},prepareBroadcastSelect:function(){this._doNotAddTerminology=!0,this._parent()},pushBroadcastSelect:function(){this._doNotAddTerminology=!1,this.selection_broadcast_fn(),this._parent()},shouldAcceptDrag:function(e){var t=[];if((t=o.getSelectedNodes()).length>0){var n=t[0].getType();if(i.isTerminology(n)||"Busy"==n)return!1}return!0},shouldAcceptDrop:function(e){return!(e&&e.parentTreeNodeModel&&e.draggedTreeNodeModel)||i.isTerm(e.parentTreeNodeModel.plmType)},insert:function(e,t,o){if(e&&t){var i=n.getDragDataForSelectedNodesInCurrentTerminologyContent();n.processDroppedDataOnTerminologyEditorNode(t,i)}return!1},keepExpandedState:function(){var e=g.getContent().getPADTreeDocument();if(e){var t=e.getRoots(),o=0,n=t.length;for(o=0;o<n;o++){t[o].options.type;if(t[o].isExpanded()){g.getContent().RefreshProductStructure=!0;break}}}},deleteNodes:function(e){var t,n=e.length,i=!1;for(t=0;t<n;++t){if("noExpandState"!==e[t]._expandState){i=!0;break}}if(i){var r=o.getSelectedNodesID(),a=o.getCurrentTerminology();g.getContent().RefreshProductStructure=!0,g.getContent().loadContentAndSelect(a,r)}else{this._parent(e),0===g.getContent().getObjectsInTree()&&g.getContent()._addPlaceHolder()}},refreshNodeById:function(e){var t,n,l,c=this,u=e.modified,m=[],p=[],h=!1,f=this.getRoots(),y=f.length;for(t=0;t<y;++t){var v=f[t],T=v.getID();if(i.inFamilyTerminology(v.plmType))if(-1!==(_=u.indexOf(T)))u.splice(_,1),m.push(T);else e.modified.forEach(function(e){console.log("  modified :",e);var t=e.physicalid;e.operation;if(t===T){var o=e.key;o&&"ownerChanged"===o&&(h=!0),m.push(T);var n=u.indexOf(e);-1!==n&&u.splice(n,1)}});else if(l=void 0,l=!1,1==(n=v).options.isSearchWithinData&&(h=!0),n.options.isNotManagedByPS&&(l=n.options.isNotManagedByPS),l){var _;if(-1!==(_=u.indexOf(T)))u.splice(_,1),p.push(T);else e.modified.forEach(function(e){var t=e.physicalid;e.operation;if(t===T){var o=e.key;o&&"ownerChanged"===o&&(h=!0),p.push(T);var n=u.indexOf(e);-1!==n&&u.splice(n,1)}})}}if(e.modified=u,h){var C=o.getCurrentTerminology();this.keepExpandedState();var S=o.getSelectedNodes(),b=[];S.forEach(function(e){b.push(e.getID())}),g.getContent().loadContentAndSelect(C,b)}else m.length>0&&m.forEach(function(e){r.getTerminologyProperties({pid:e,onComplete:function(t){UWA.is(t,"string")&&(t=JSON.parse(t));var o=a.convertToExaleadDataFormat(t),n=c.searchRootById(e);if(n){if(n._resetting=!0,n.options.oldLabel=o.label,n.options.publishOnConnect!==t.publishOnConnect){var i="TRUE"===t.publishOnConnect?d.getWebappsAssetUrl("TerminologyEditor","icons/terminologyPublishBadge.png"):"";n.setBadges({bottomRight:i})}s.getEnforceFolderLinkSettingAsync(function(e,t){e||t}),c.wrapInTransaction(function(){n.updateOptions(o)})}},onFailure:function(){console.error("Unable to update Tree Label, Error in getting terminology Properties")}})}),p.length>0&&p.forEach(function(e){r.getContentProperties({pid:e,onComplete:function(t){if(UWA.is(t,"string")){t=JSON.parse(t);var o=a.convertToExaleadDataFormat(t),n=c.searchRootById(e);if(n){var i=null;n._ischeckout="TRUE"===t.Documentlocked||"[TRUE]"===t.Documentlocked?"TRUE":"FALSE",c.wrapInTransaction(function(){let e=n.getChildren();e&&e.length>0&&delete o.children,n.updateOptions(o),"TRUE"===n._ischeckout&&(i=d.getWebappsAssetUrl("TerminologyEditor","icons/22/I_CheckOutDocument.png"),a.setBadge(n,"bottomRight",i))})}}},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties")}})}),this._parent(e)}});return u}),define("DS/TerminologyEditor/controllers/AuthoringMode",["DS/TerminologyEditor/controllers/CommonMode","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/utils/TerminologyEditorUtil","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor"],function(e,t,o,n,i){return e.extend({init:function(e){this._parent(e)},convertData:function(e){return n.convertToExaleadDataFormat(e)},loadContents:function(e){this._parent();var n=this;return new Promise(function(r,a){e.onComplete=function(t){var n=null;if(o.getCurrentTerminology()&&(n=o.getCurrentTerminology().getID()),n===e.pid)if(void 0!==t){var l=(t="string"==typeof t?JSON.parse(t):t).member;void 0!==l?(t.contents=l,r(t)):(t.contents=[],r(t))}else a({message:i.msg_error_contentnotavailable,className:"error"})},e.onFailure=function(e,t){a({err:e,serverErr:t})},n._contentHandleRequest="TerminologySection_AllTerminologies"===e.type?t.roots(e):t.content(e)})},getModeType:function(){return"authoring"}})}),define("DS/TerminologyEditor/TerminologyComponent",["UWA/Core","DS/Logger/Logger","DS/WebappsUtils/WebappsUtils","DS/TerminologyEditor/models/xTermNodeModel","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/controllers/AuthoringMode","DS/TerminologyEditor/controllers/SearchMode","DS/TerminologyEditor/controllers/ReadMode","DS/TerminologyEditor/views/TerminologyGlobalActiveTerminology","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/service/TerminologyDnDServices","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/Terminology_Clipboard","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/TerminologyEditor/TermXNavComponent","DS/IPClassifyUtil/IPClassifyModelEvents","i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor","DS/Tree/TreeNodeModel","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyCommunication","DS/IPClassifyUX/service/PlatformServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WidgetServices/UIInfra/UIInfra","DS/WidgetServices/WidgetServices","text!DS/TerminologyEditor/assets/TerminologyEditorConf.json","i18n!DS/TerminologyEditor/assets/nls/TerminologyLocationPopup"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v,T,_,C,S,b,E,D,w,A,I,x,P,N,O){"use strict";var R=function(t,o){var n=t.dataelements[o];return e.is(n,"array")&&(n=n[0]),n};function M(e,t,o){d.setBadge(e,t,o)}var U={authoring:new r,search:new a,read:new l},F=T.extend({name:"TerminologyComponent",defaultOptions:{x3dAppId:"TerminologyEditor",amd_custo:{TreeDocument:"DS/TerminologyEditor/TerminologyTreeDocument",DataGridView:"DS/TerminologyEditor/views/TerminologyDataGridView",TileGridView:"DS/TerminologyEditor/views/TerminologyTileView",ThumbnailGridView:"DS/TerminologyEditor/views/TerminologyThumbnailView"},active_view:d.getDefaultView(),layout:{keyboard_inputs:!1,root_panel:!1,action_bar:!1,statusInfo:!1,slidder:!1,title_update:!1,drop_invite:"none",triptychOpts:{borderLeft:!0,withtransition:!P.isReplayedODT(),left:{resizable:!0}},amdTreeView:"datagridview"},insert_replace:!0},_contentDiv:null,init:function(e,o){var n=this;this._contentDiv=e.renderTo;var i=y.getCurrentModeType();this._currentMode=U[i],this._handlerThumbnails=null,this._treeCont=o,this.setOptions(e),this._parent(this.options),this.elements||(this.elements={}),this.elements.tempLeftContent=null,this._logger=t.getLogger(F),m.getPlaceholder().then(function(e){n._placeHolder=e}),h.onTerminologyRename(function(e){n._sortingNodesContent(e)});var r=UWA.createElement("div",{class:"containerTools"});_.getModelEvents().subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},function(e){e.html?(r.empty(),e.html.inject(r),r.inject(widget.body)):!0===e.restore&&r.remove()}),e.layout&&e.layout.view_customization&&Array.isArray(e.layout.view_customization.selectedExtensions)&&Array.isArray(e.layout.view_customization.selectedTypes)&&b.updateSelectedParams({selectedExtensions:e.layout.view_customization.selectedExtensions,selectedTypes:e.layout.view_customization.selectedTypes})},createRootListSlidder2:function(){return this._treeCont.elements.container},switchMode:function(e,t){if(e=e&&U[e]?e:widget.getValue("useIndexAcceleration")?y.getCurrentModeType():"authoring",U[e]!==this._currentMode&&(this._currentMode.disable&&this._currentMode.disable(),this._currentMode=U[e],this._currentMode.enable&&this._currentMode.enable(),t=!0),"read"!=e&&"authoring"!=e||y.getCurrentModeType()!==e&&(y.setCurrentModeType(e),y.updateIconAndSettings()),t)var o=widget.getValue("x3dSelectedContentId");null==o||""==o?this.loadContentAndSelect():(widget.setValue("x3dSelectedContentId",""),this.loadContentAndSelect(void 0,[o]))},getObjectsInTree:function(){return this._currentMode.getObjectsInTree?this._currentMode.getObjectsInTree(this):this.options.model.getAllDescendants().length},_addStyleOnTreeCont:function(e){var t=this.elements.padshell._getLeftWidth();t=e&&e>t?e:t,P.addNewStyles("treeContResize",{".TerminologyTree_Cont-root_container":{overflow:"hidden"},".TerminologyTree_Cont-root_treeview_container":{width:t+"px !important"}},!0)},_OnPADComponentReady:function(){var e=this;this.addEvent("onToggleView",d.setDefaultView),require(["DS/TerminologyEditor/views/TerminologyLeftSidePanelView","DS/TerminologyEditor/views/TerminologyRightSidePanelView"],function(t,o){e.terminologyLeftPanel=new t,(new A).initializePlatform({onComplete:function(t){e.terminologyRightPanel=new o({platformUrls:t.platformurls})}})}),d.getLeftPanelStatus().leftPanelState&&this.elements.padshell.togglePanel("left"),this.addEvent("onToggleView",function(){0===m.getContent().getObjectsInTree()&&e._addPlaceHolder(),e._filterRelatedNodes()});var t=widget.getValue("customLeftWidth");this._addStyleOnTreeCont(t),this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-show-started"},function(t){"left"===t&&e._addStyleOnTreeCont()}),this.elements.padshell._modelEvents.subscribe({event:"triptych-panel-visible"},function(e){"left"===e&&P.clearJSStylesheet("treeContResize")}),null!=t&&this.elements.padshell._modelEvents.publish({event:"triptych-set-size",data:{side:"left",size:t}}),this.elements.padshell._modelEvents.subscribe({event:"triptych-resized"},function(e){"left"===e.side&&widget.setValue("customLeftWidth",e.width)}),this.elements.padshell._leftPanelContent.addEventListener("click",function(e){if(e&&e.target&&e.target.id&&"terminology-common-tool-Section"===e.target.id&&D.isWidgetMaximized()){var t=P.getWidgetPreferenceValue("activateTreeFilter");m.getTreeCont().activateTreeFilter(!t)}}),m.setContent(this),f.setPredicates(b.getAvailableColumnsOpts()),h.onCurrentTerminologyChange(function(t){e.getSpecficMode("read").resetInfoIndex(),e.switchMode(null,!0)}),h.onTreeFilterChange(function(){if("TerminologySection_AllTerminologies"==i.getCurrentTerminologyID()){var t=i.getCurrentTerminology();t&&e.loadContentAndSelect(t)}}),h.onTaggerStatusChange(function(){e.loadContentAndSelect()}),h.onCurrentTerminologyColumnChange(function(){f.isSearchInProgress()&&f.resetInfoIndex(),e.getSpecficMode("read").resetInfoIndex(),e.loadContentAndSelect(null,null)});var o=i.getCurrentTerminology();if(o){var n=widget.getValue("x3dSelectedContentId");null==n?this.loadContentAndSelect(o):this.loadContentAndSelect(o,[n],{copylink:!0})}require("DS/TerminologyEditor/views/TerminologyMode").updateIconAndSettings()},_filterRelatedNodes:function(){var e=this.getPADTreeDocument();let t="datagridview"===this.getActiveView()?"IN":"OUT";if(e){var o=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var e,n=o.length;for(e=0;e<n;++e)o[e].filterIn(!0);var i=function(e){e.isRelationsObjectNode?e._filterStatus=t:e._filterStatus="IN";var o=e.getChildren();o&&o.length>0&&o.slice(0).forEach(function(e){i(e)})},r=function(e){if("IN"===e._filterStatus){var t=e.getChildren();t&&t.length>0&&t.slice(0).forEach(function(e){r(e)})}else e.filterOut(),e.__treeGraphRoot__&&delete e.__treeGraphRoot__;delete e._filterStatus};o.forEach(function(e){i(e)}),o.forEach(function(e){r(e)})})})}},_isTreeTaggerContentVisible:function(e){var t=m.getTreeFilter();return!t||!t.isFilterSet()||("TerminologySection_AllTerminologies"!==i.getCurrentTerminologyID()||t.isObjectVisible(e))},setTerminologyCommunicationChannel:function(){},onDragStartCell:function(e,t){if(!c.shouldAcceptDrag())return e.preventDefault(),void e.stopPropagation();p.SetAsExternalDrop(!1);var o=c.getDragDataForSelectedNodesInCurrentTerminologyContent(t);try{e.dataTransfer.setData("text/searchitems",JSON.stringify(o))}catch(e){}if(e.dataTransfer.setData("Text",JSON.stringify(o)),"graphview"!==this.getActiveView()&&x.createGhostDnD(e,{number:o.data.items.length}),e.dataTransfer.effectAllowed="copyMove",c.setStartDrag(!0),c.setDragFrom("bookmark"),!0===widget.getValue("noCompass")){var n=o.data.items,i=[];n.forEach(function(e){i.push(e.objectId)}),w.publish("setDragData",{ids:i})}e.stopPropagation()},onDragEndCell:function(){c.setStartDrag(!1)},onDragEnterCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=c.isDragging()&&c.isMoveDnDSetting()&&!c.hasFilesInEvent(e)?"move":"copy");var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return!!g.inFamilyTerminology(n)||(this.onDragEnterBlank(e,t),!1)},onDragLeaveCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return g.inFamilyTerminology(n)?"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager._hideDndFeedbacks():(this.onDragLeaveBlank(e,t),!1)},onDragOverCell:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=c.isDragging()&&c.isMoveDnDSetting()&&!c.hasFilesInEvent(e)?"move":"copy"),e.preventDefault();var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;return g.inFamilyTerminology(n)?(t&&(t.dropPosition="middle"),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||void t.manager.onDragOverCellDefault(e,t)):(this.onDragOverBlank(e,t),!1)},onDropCell:function(e,t){if(1!=widget.launchWithReadMode){p.SetAsExternalDrop(!1);var o=t.nodeModel,n=o&&o.options?o.options.type:void 0;g.inFamilyTerminology(n)?(c.performDropOnTerminologyEditorNode(o,e),e.preventDefault()):this.onDropBlank(e,t),c.setDragFrom(""),"tileview"!=this.getActiveView()&&"thumbnailview"!=this.getActiveView()||t.manager.onDropCellDefault(e,t)}else E.displayNotification({message:C.msg_warning_DndNotSupported,className:"warning"})},onDragEnterBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect=c.isDragging()&&c.isMoveDnDSetting()&&!c.hasFilesInEvent(e)?"move":"copy");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragEnterBlankDefault&&n.options.onDragEnterBlankDefault(e,t),!0},onDragLeaveBlank:function(e,t){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="none");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragLeaveBlankDefault&&n.options.onDragLeaveBlankDefault(e,t),!0},onDragOverBlank:function(e,t){e.preventDefault(),e&&e.dataTransfer&&(e.dataTransfer.dropEffect=c.isDragging()&&c.isMoveDnDSetting()&&!c.hasFilesInEvent(e)?"move":"copy");var o=this.getActiveView(),n=this.getOption("views")[o];return n&&n.options&&n.options.onDragOverBlankDefault&&n.options.onDragOverBlankDefault(e,t),!0},onDropBlank:function(e){if(1!=widget.launchWithReadMode){p.SetAsExternalDrop(!1);var t=i.getCurrentTerminology();c.performDropOnTerminologyEditorNode(t,e),e.preventDefault(),c.setDragFrom("")}else E.displayNotification({message:C.msg_warning_DndNotSupported,className:"warning"})},onDropColumnHeader:function(){return c.setDragFrom(""),!0},doDnDDragStart:function(e,t,o){return this.onDragStartCell(this._createSimulatedEvent(e)),!0},doDnDDrop:function(e,t,o,n){var i={nodeModel:t};this.onDropCell(this._createSimulatedEvent(e),i)},shouldAcceptDnDDrop:function(e,t,o,n){return null==t.plmType||g.inFamilyTerminology(t.plmType)},getOnContextualEvent:function(){return{this:this,callback:function(e){return new Promise(function(t){u.getCtxMenu(e).then(function(e){t(e)}).catch(e=>console.log(e))})}}},_createSimulatedEvent:function(e){function t(){}return{dataTransfer:e,preventDefault:t,stopPropagation:t}},getActiveView:function(){return this._parent()},removeNodesInContent:function(){var e=this.getPADTreeDocument();if(e){var t=e.getRoots(!0).slice(0);e.wrapInTransaction(function(){e.withTransactionUpdate(function(){var o,n=t.length;for(o=0;o<n;++o)t[o].filterIn(!0);for(e.unselectAll(),o=0;o<n;++o)e.removeRoot(t[o],!0,!1)})})}},_loadContent:function(e,t,i){var r=this;if(null==v.container.contentView){var a=this._contentDiv,l=null;a&&(l=a.getElement(".xterm_viewmain")),widget.body.contentViewLoaderContainer=UWA.createElement("div",{class:"TerminologyEditor_contentView_loader"}).inject(l),v.setContainer("contentView",widget.body.contentViewLoaderContainer)}v.removeComponentToLoad("global","tree"),v.addComponentsToLoad("contentView",{content:""});var s=null;s=!0===widget.getValue("standalone")?Promise.resolve({isCSVroleAvailable:!0}):new Promise(function(e){m.checkRolesAvailability(function(t,o,n){e({isPAUroleAvailable:t,isPARroleAvailable:o,isCSVroleAvailable:n})})});var d=e.getID?e.getID():"",c=e.getType?e.getType():"",u=this._currentMode.loadContent({pid:d,type:c,content:-1,filterChildren:""}),p=new Promise(function(e){I.getEnforceFolderLinkSettingAsync(function(t,o){e(!t&&o)})});Promise.all([s,u,p]).then(function(a){var l=a[0].isPAUroleAvailable,s=a[0].isPARroleAvailable,d=a[0].isCSVroleAvailable,c=a[1];r.getPADTreeDocument().wrapInTransaction(function(){e.options.contentAvailable=!0;var a=c.contents;if(r._placeHolder&&r._placeHolder.getContent().remove(),0===c.contents.length&&r._addPlaceHolder(),void 0!==a){var u=[];r.RefreshProductStructure;var m=[],p="read"==y.getCurrentModeType()&&1==r.getCurrentMode()._isPageRefreshed;(!0!==c.inProgress||p)&&(r.removeNodesInContent(),p&&(r.getCurrentMode()._isPageRefreshed=!1));var h=[],T=[];a.forEach(function(e){if(f.isSearchActive()||"read"===r.getCurrentModeType()||r._isTreeTaggerContentVisible(e.id)){var i=r._currentMode.convertData(e);!0!==s&&!0!==l&&!0!==d&&(i.children=null);var a=null;if(u.forEach(function(e){(e.id||e.getID())===i.resourceid&&(a=e)}),null==a){i.grid&&(i.grid.bi_color="rgba(0, 0, 0, 0)");var c=i.icons&&i.icons.length>0?i.icons[0]:"";i.icons="object"==typeof c?[c]:[{iconPath:"url("+c+")"}];var p=new n(i);if(i.nodeAttrs)for(var y in i.nodeAttrs)p[y]=i.nodeAttrs[y];if(p.options.grid.thumbnail=i.thumbnail?i.thumbnail:"",!p.plmType){var v=i.grid.type?i.grid.type:i.grid["ds6w:type"];g.isTerminology(v)?p.plmType="Terminology":g.isTerm(v)&&(p.plmType="Term")}if(p.id=i.resourceid,p._ischeckout="read"==r.getCurrentModeType()?i.Documentlocked:e.Documentlocked,"TRUE"===p._ischeckout)M(p,"bottomRight",o.getWebappsAssetUrl("TerminologyEditor","icons/22/I_CheckOutDocument.png"));if("TRUE"===i.publishOnConnect)M(p,"bottomRight",o.getWebappsAssetUrl("TerminologyEditor","icons/terminologyPublishBadge.png"));p.options.oldLabel=i.label,r.updateActiveTerminologyNode(p),p._manageNLS=!0,(UWA.is(t,"array")?t.indexOf(i.resourceid)>=0:i.resourceid===t)&&T.push(p),h.push(p)}else{h.push(a);var _=!1;if(Array.isArray(a.getChildren())&&a.getChildren().length>0){var C=a.getChildren()[0];C.hasOwnProperty("isRelationsObjectGroupingNode")&&(_=C.isRelationsObjectGroupingNode)}_||m.push(a);var S=a.id||a.getID();(UWA.is(t,"array")?t.indexOf(S)>=0:S===t)&&T.push(a)}}}),h&&!0!==c.sorted&&h.sort(r._ascendingSortingRootNodeByTitle);var _="datagridview"===r.getActiveView()&&null!==r.getPADTreeListView();_&&r._listenEndUIRefreshEvent(h),r.addRootNodes(h),_||r._endRefreshView();var S=r.getPADTreeListView();if(S&&!f.isSearchActive())if("read"!==r.getCurrentModeType()||"read"==r.getCurrentModeType())S.getManager().reapplySortModel();if(r.RefreshProductStructure&&u.length>0){r.RefreshProductStructure=!1;var b=r.getPADTreeListView();r.getPADTreeDocument().refresh({treelist:b,roots:m,cb:function(e){"error"===e.eventID&&E.displayNotification({message:C.refreshError,className:"error"}),r._logger.log("Refresh PS : "+e.msg)}})}T.length>0&&(T.forEach(function(e){e.select()}),i&&"add"===i.insertMode&&r._defaultEnableNameEdit(T[T.length-1]),1===T.length&&"datagridview"===r.getActiveView()&&r.getPADTreeListView().scrollToVisibleNode(T[0])),null!=i&&i.copylink&&0==T.length&&E.displayNotification({message:C.msg_warning_contentnotavailable,className:"warning"})}v.removeComponentToLoad("global","tree"),r._endLoadAndSelect(),r._endContentSelect()})}).catch(this._manageException.bind(this,e))},updateActiveTerminologyNode:function(e,t){if(m.isCustomizedEnv()||m.isActiveTerminologyActivated()){var o=m.getActiveTerminology(),n=o.id,i=o.disabledId;if(!e){var r=this.getPADTreeDocument().getNodesById(i||n);r.length>0&&(e=r[0])}e&&(n===e.id?M(e,"topRight",t?null:s.ICON_ACTIVE):i===e.id&&M(e,"topRight",t?null:s.ICON_ACTIVE_DISABLED))}},_manageException:function(e,t){if(this._logger.log("WebService content, Err : "+(t&&t.stack?t.stack:"unknown")),this._endContentSelect(),this.removeNodesInContent(),t){if(!t.message){var o,n,i,r=t.err,a=t.serverErr,l="error";"timeout"===r.type?o=C.msg_error_timeout:(this._currentMode.manageError&&(o=this._currentMode.manageError(a),l="warning"),o||e&&(e.options.contentAvailable=!1,n=C.msg_error_contentnotavailable.Title,i=C.msg_error_contentnotavailable.Advice,o=C.msg_error_contentnotavailable.Details)),t={title:n,subtitle:i,message:o,className:l}}E.displayNotification(t)}this._endLoadAndSelect()},_switchNameToEdit:function(e){try{if("datagridview"===this.getActiveView()){var t=this.getPADTreeListView().getManager(),o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n});var i=t.getCellInfosAt(n);u._cellToRename={cellInfos:i,context:"CONTENT"},t.setCellInEdition(n)}}catch(e){}},_defaultEnableNameEdit:function(e){setTimeout(function(){this._switchNameToEdit(e)}.bind(this),1e3)},_manageSortForMultiColumns:function(){let e=this.getPADTreeListView();if(e){let o=e.getManager().sortModel;if(f.isSearchActive()&&o&&o.length>1){let t=[];return t.push(o[0]),e.getManager().sortModel=t,!0}var t=d.getContentSortmodel();f.isSearchActive()||o.length===t.length||(e.getManager().sortModel=t)}return!1},loadContentAndSelect:function(e,t,o){if(D.setPCSEntry(widget.id+"_TerminologyContentLoad",!0),!this._manageSortForMultiColumns()){void 0===t&&(t=void 0!==this.nodeToSelectID?this.nodeToSelectID:t),this._handlerThumbnails&&this._handlerThumbnails.cancel(),this._handlerThumbnails=null;var n,r;e||(e=i.getCurrentTerminology()),e&&(e.getType&&(n=e.getType()),e.getID&&(r=e.getID()));var a=f.isSearchActive();g.inFamilyTerminology(n)&&r||"TerminologySection_AllTerminologies"==n&&!a||"TerminologySection_AllTerminologies"==n&&"TerminologySection_AllTerminologies"==r?this._loadContent(e,t,o):(a&&f.clearSearch(),this.removeNodesInContent(),this._endLoadAndSelect())}},_endLoadAndSelect:function(){v.removeComponentToLoad("contentView","content"),widget.dispatchEvent("onLoadReady");var e=this.getPADTreeListView(),t=e?e.getManager():null;if(t&&(f.isSearchActive()||"read"===this.getCurrentModeType()||(this._componentScrollerPosition?t.setScrollerPosition(this._componentScrollerPosition):t.setScrollerPosition({x:0,y:0},!1)),this._componentScrollerPosition=null),void 0!==this.nodeToSelectID){var o=m.getContent().getPADTreeDocument().getNodesById(this.nodeToSelectID)[0];if(null==o)E.displayNotification({message:O.msg_error_BM_LOC_InValid_Object,className:"error"});else{var n=t.layout.getCellsFromNodeModel(o)[0];t.scrollToCellAt({cellID:n}),delete this.nodeToSelectID}}},_endContentSelect:function(){var e=this.getPADTreeListView(),t=e?e.getManager():null;t&&t.infiniteScrollProcessDone(),D.setPCSEntry(widget.id+"_TerminologyContentLoad",!1),D.sendPCSTracketPageEvent("TerminologyWidget_Performance","TerminologyContentLoad",widget.id+"_TerminologyContentLoad")},_listenEndUIRefreshEvent:function(e){var t=this,o=this.getPADTreeListView();new Promise(function(n,i){if("datagridview"!==t.getActiveView()||0===e.length)n();else{var r=function(){t.removeEvent("onToggleView",r),n()};t.addEvent("onToggleView",r),o&&o.getManager().onPostUpdateViewOnce(function(){if(t._currentMode.supportClientSort&&this.sortModel&&this.sortModel.length>0){var e=this.sortModel[0];e&&(this.sortModel=[{sort:e.sort,dataIndex:e.dataIndex}])}r()})}}).then(function(){t._endRefreshView()})},_endRefreshView:function(){this.dispatchEvent("onCompleteRefreshNodes",i.getCurrentTerminology().getID())},removeNodeInContent:function(e){var t=this.getPADTreeDocument();t.getRoots().forEach(function(o){(o.id||o.getID())===e&&t.removeRoot(o)})},addDummyRootNodes:function(e){for(var t=[],i=0;i<e.length;i++){var r,a=e[i];if(a instanceof n){a.options.display=a.options.label,M(r=a,"topRight",o.getWebappsAssetUrl("TerminologyEditor","icons/spinnerBadge.gif"))}else{(r=new n({})).setState({state:"noChildren"}),r.childComputed=!0,r.options.children=null,r.options.label=a.label,r.options.oldLabel=a.label,r.options.display=a.label,r.options.resourceid=a.tempId,r.options.id=a.tempId,r.options.isNotManagedByPS=!0,r.id=a.tempId,r.options.tempId=a.tempId;var l=o.getWebappsAssetUrl("TerminologyEditor","icons/spinnerBadge.gif");r.options.icons=[{iconPath:"url("+l+")"}]}if(r.plmType="Busy",a instanceof n){r.updateAttributes([],b.getAvailableColumns())}else t.push(r)}this.addRootNodes(t)},updateRootNode:function(e,t){var o=this.getPADTreeDocument();if(e instanceof n){e.plmType="Content",M(e,"topRight",""),e.options.label=e.options.display;e.updateAttributes([],b.getAvailableColumns()),!0===e._isSelected&&i.addInTerminologyCSO(e,"CONTENT")}else{var r,a=[];o.getRoots().forEach(function(o){o.options.label.indexOf(R(e,"title"))>-1&&o.id===e.tempId&&"Busy"===o.plmType?r=a.concat(o):o.id===e.id&&"Busy"===o.plmType?r=a.concat(o):o.tempId===t&&"Busy"===o.plmType&&(r=a.concat(o))}),r&&r.forEach(function(t){var o={id:e.id,label:R(e,"title"),type:"Document",description:R(e,"description"),modified:R(e,"modified"),created:R(e,"originated"),policy:"",organizationResponsible:"",project:"",responsible:""};t.id=e.id;var n=d.convertToExaleadDataFormat(o),r=d.convertToArray(n);e.isDownloadable&&(t.options.isDownloadable=!0),e.checkout&&(t.options.checkout=!0),t.options.label=R(e,"title");var a=P.get3DSpaceUrl();"OnPremise"!==widget.getValue("x3dPlatformId")&&(a=a.replace("ifwe","space").replace("3DSpace","enovia")),t.options.icons=[{iconPath:"url("+a+"/snresources/images/icons/small/I_CDM_Document.png)"}],t.options.thumbnail=a+"/snresources/images/icons/large/I_CDM_Document108x144.png",t.plmType="Content",t.options.resourceid=e.id,t._ischeckout="FALSE",function(e){e.options.icons="string"==typeof e.options.icons[0]?[{iconPath:e.options.icons[0]}]:e.options.icons,e.options.icons[0].badges={},e.updateOptions({icons:e.options.icons})}(t),t.updateAttributes(r,b.getAvailableColumns()),!0===t._isSelected&&i.addInTerminologyCSO(t,"CONTENT")})}},expandBranches:function(e){if(e<=0)return null;var t=this.getPADTreeDocument(),o={onComplete:function(){if(e.length){var o=e[e.length-1],n=t.getNodesById(o);n&&1===n.length&&n[0].select(!0)}}};if(t.searchRootById(e[0]))t.insertBranches([e],o);else{var n=C.msg_warning_notProductRoot;E.displayNotification({message:n,className:"warning"})}},switchTerminologyTreeNodeLabelToWriteView:function(e){var t=!1;return e instanceof S&&g.inFamilyTerminology(e.plmType)&&this.getPADTreeDocument()&&e.getTreeDocument()===this.getPADTreeDocument()&&(this._switchNameToEdit(e),t=!0),t},_sortingNodesContent:function(e){var t=this.getPADTreeListView();if(t&&e){var o=t.getManager(),n=o.sortModel;n&&n.length>0?o.reapplySortModel():o.sortModel=[{sort:"asc",dataIndex:"tree"}];var i=o.layout.getCellsFromNodeModel(e)[0];o.scrollToCellAt({cellID:i})}},_ascendingSortingRootNodeByTitle:function(e,t){var o=g.inFamilyTerminology(e.plmType),n=g.inFamilyTerminology(t.plmType);return o&&!n?-1:!o&&n?1:d.compareLabels(e.options.label,t.options.label)},_addPlaceHolder:function(){var e=this.getActiveView();if("datagridview"!==e){if("tileview"===e){var t=(o=this.getPADTileGridView().options.grid.elements.scroller)?o.getContent():null;t&&this._placeHolder.elements.container.inject(t)}if("thumbnailview"===e){var o,n=(o=this.getPADThumbnailGridView().options.grid.elements.scroller)?o.getContent():null;n&&this._placeHolder.elements.container.inject(n)}}},getGridViewRowHeight:function(){let e=JSON.parse(N).settings.dgvOptions.value.dgvLayout.cellHeight,t=this.getPADTreeListView();return t&&(e=t.getRowHeight()),e},getContentHeight:function(){let e=0;if(document){let t=document.getElementsByClassName("xterm_viewmain");if(t&&t.length>0){let o=t[0].getElementsByClassName("wux-layouts-left-scroller-container");if(o&&o.length>0&&(e=o[0].clientHeight),!e){let o=t[0].getElementsByClassName("wux-layouts-body");o&&o.length>0&&(e=o[0].clientHeight)}}}return e},getComponentWidth:function(){let e=0;if(document){let t=document.getElementsByClassName("xterm_component");t&&t.length>0&&(e=t[0].clientWidth)}return e},getCurrentMode:function(){return this._currentMode},setCurrentMode:function(e){this._currentMode=U[e]},getCurrentModeType:function(){return this._currentMode.getModeType()},getSpecficMode:function(e){return U[e]},processForInfiniteScroll:function(e,t){if(e.reachBottom){var o=this.getCurrentModeType(),n=0;if("read"==o&&this._currentMode.isInfiniteScrollingTobeDone()){var i,r=(i=this.getCurrentMode()).getInfoIndex().next_start.split(" ")[0];n=i.getInfoIndex().nhits==r?0:i.getNumberLastResult()}if("search"==o)n=(i=this.getCurrentMode()).getNumberLastResult();n>0&&this.loadContentAndSelect()}t.infiniteScrollProcessDone()}});return F}),define("DS/TerminologyEditor/utils/xTermCustoStorageOptim",["UWA/Core","DS/TerminologyEditor/utils/TerminologyEditorUtil"],function(e,t){"use strict";var o={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:!0,isHidden:!1,isSortable:void 0,type:void 0,isAdditionalColumn:void 0,xnav_options:{name:void 0,dataIndex:void 0,tree:void 0,hardcoded:void 0,exportable:{lock:!1,value:!0},layout:{removable:void 0,hidden:void 0,width:150,minWidth:void 0,maxWidth:void 0},kind:void 0}},n={dataIndex:void 0,text:void 0,isDraggable:!0,visibleFlag:void 0,sortableFlag:void 0,pinned:void 0,kind:void 0,isAdditionalColumn:void 0,customisation:{layout:{width:200,minWidth:50,maxWidth:300,removable:!0,pinEditable:!0},exportable:{lock:!1,value:!0},titleModified:void 0}};function i(e,t){var o={};if(void 0===t)o=e;else for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++)if(UWA.is(e[n[r]],"object")){var a=i(e[n[r]],t[n[r]]);Object.getOwnPropertyNames(a).length>0&&(o[n[r]]=a)}else e[n[r]]!==t[n[r]]&&"text"!==n[r]&&(o[n[r]]=e[n[r]]);return o}function r(e,t,o){var n={};if(void 0===e)n=t;else{for(var i=Object.getOwnPropertyNames(t),a=Object.getOwnPropertyNames(e),l=0;l<i.length;l++)if(UWA.is(t[i[l]],"object")){if("bi_color"!==o){var s=r(e[i[l]],t[i[l]],o);Object.getOwnPropertyNames(s).length>0&&(n[i[l]]=s)}}else void 0===e[i[l]]?n[i[l]]=t[i[l]]:n[i[l]]=e[i[l]];for(var d=0;d<a.length;d++)void 0===n[a[d]]&&(n[a[d]]=e[a[d]])}return n}return{convertCusto4Preference:function(e,r,a){var l={custoOptimized:!0,viewMode:e.viewMode,defaultCellHeight:e.defaultCellHeight,rowsHeader:e.rowsHeader,selectedTypes:e.selectedTypes,selectedExtensions:e.selectedExtensions,columnsOptimized:[],lang:widget.getValue("lang")};t.setContentSortmodel(e.sortModel),e.custoFromTree&&(l.custoFromTree=e.custoFromTree);for(var s=0;s<e.columns.length;s++){var d=e.columns[s],c=o;"datagridview"===a&&(c=n);var g=i(d,c);r[d.dataIndex]&&(g.text=d.text),l.columnsOptimized.push(g)}return l},convertPreference2Custo:function(i,a){var l={viewMode:i.viewMode,defaultCellHeight:i.defaultCellHeight,rowsHeader:i.rowsHeader,selectedTypes:i.selectedTypes,selectedExtensions:i.selectedExtensions,columns:[]},s=t.getContentSortmodel();l.sortModel=s,i.custoFromTree&&(l.custoFromTree=i.custoFromTree),i.lang&&i.lang!==widget.getValue("lang")&&function(e){for(var t=0;t<e.columnsOptimized.length;t++){var o=e.columnsOptimized[t];o.xnav_options&&o.xnav_options.titleModified&&(delete o.text,delete o.xnav_options.titleModified)}}(i);for(var d=0;d<i.columnsOptimized.length;d++){var c=i.columnsOptimized[d],g=o;"datagridview"===a&&(g=n);var u=r(c,e.clone(g),c.dataIndex);l.columns.push(u)}return l}}}),define("DS/TerminologyEditor/popup/TerminologyLocationPopup",["UWA/Controls/Abstract","DS/Controls/Toggle","DS/Controls/ButtonGroup","DS/Controls/Button","DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/Terminology_CSO","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologyEditor/assets/nls/TerminologyLocationPopup","DS/Controls/TooltipModel","DS/TerminologyEditor/views/TerminologyMode","DS/Tree/TreeListView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h){return e.extend({modal:null,onResize:function(){null!=this.ARWidget&&this.ARWidget.onResize()},init:function(e,s,d){this.elementsList=[],d=null!=d?d:{};var u=l.getCurrentSelection()[0].getLabel(),m=l.getCurrentTerminology().getID(),p=widget.body,h=null,f=new r,y=UWA.createElement("div",{class:"bookmark_Open_Location-common-command"}),v=UWA.createElement("div",{class:"bookmark_Open_Location-common-command-div"});if(v.innerText=d.message,v.inject(y),d.radio)var T=new o({type:"radio"}),_=!0;else var C=UWA.createElement("ul",{class:"list-location-popup"});for(var S=null,b=null,E=0;E<e.length;E++)if(b=s(S=e[E].fullPath.join(" > ")),d.radio){_=!1,0===E&&(_=!0,h=e[0].idToNavigate);var D=new t({type:"radio",value:e[E].idToNavigate,checkFlag:_});b.inject(D.getContent()),D.tooltipInfos=new g({longHelp:S}),T.addChild(D),T.addEventListener("change",function(e){var t=e.dsModel.value;h=t[0]}),T.inject(y)}else{var w=UWA.createElement("div",{class:""}),A=UWA.createElement("li",{class:"list-element-location-popup"});A.tooltipInfos=new g({longHelp:S}),b.inject(w),w.inject(A),this.elementsList.push(w),A.inject(C),C.inject(y)}var I=d.title?d.title:c.OpenLocation+" : "+u;this.dialog=new i({title:I,content:y,immersiveFrame:f,minHeight:150,minWidth:400,width:a.getContent().getComponentWidth()-130,resizableFlag:!0,buttons:{Ok:new n({label:d.okButtonLabel?d.okButtonLabel:"",disabled:!1,emphasize:"primary",onClick:function(t){t.dsModel.dialog.buttons.Ok.disabled=!0,d.onOkClick&&d.onOkClick({selectPathIDToNav:h,currNodeID:m,data:e})}}),Cancel:new n({emphasize:"secondary",onClick:function(e){var t=e.dsModel.dialog;t.immersiveFrame.getContent().destroy(),t.destroy()}})}}),this.dialog.getContent().addClassName("bookmark_Open_Location"),this.dialog.addEventListener("close",function(e){console.log("Close on dialog : "+e.dsModel.title);e.dsModel.immersiveFrame.getContent().destroy();e.dsModel=null}),f.inject(p)},_selectTerminologyInTree:function(e,t){u.switchtoAuthoringMode();var o=a.getTreeCont();a.getContent().nodeToSelectID=l.getCurrentSelection()[0].getID(),o.expandTreeAndSelectTerminology({doNotSelectInTree:t,terminologyToFindAndSelect:{ids:[e.id],type:e.type,name:e.name},onComplete:function(e){console.log(" expandTreeAndSelectTerminology:onComplete")},onFailure:function(t){d.displayNotification({message:c.replace(c.get("msg_error_TerminologyLocation"),{name1:e.name}),className:"error"})}})},pushNotif:function(e){e.length!=this.elementsList.length&&console.log("/!\\ nb of notifs and nb of elements not equal.");for(var t=null,o=null,n=null,i=0;i<this.elementsList.length;i++)null!=e[i]&&(n=UWA.createElement("div"),"success"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup green-notif",text:c.removeFromSearchNotif.success}),o=UWA.createElement("i",{class:"wux-ui-3ds-check wux-ui-3ds icon-notif-element-location-popup green-notif"})),"noChangeAllowed"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:c.removeFromSearchNotif.failNotAllowed}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),"noRelationFound"==e[i]&&(t=UWA.createElement("span",{class:"notif-element-location-popup red-notif",text:c.removeFromSearchNotif.failNoRelationFound}),o=UWA.createElement("i",{class:"wux-ui-3ds-alert wux-ui-3ds icon-notif-element-location-popup red-notif"})),o.inject(t,"top"),t.inject(n),n.inject(this.elementsList[i]))}})}),define("DS/TerminologyEditor/views/customize_views/TerminologyDGVParametrization",["UWA/Class","UWA/Promise","DS/Utilities/Utils","DS/Core/PointerEvents","DS/TerminologyEditor/utils/xTermCustoStorageOptim","DS/IPClassifyUtil/bsd_utils/BSDConfiguration","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/bsd_utils/BSDDictionaryAccess","DS/TerminologyEditor/service/TerminologyServices","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/service/TerminologyTypeService","DS/TerminologyEditor/utils/ColorUtil","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/TerminologyEditor/utils/TerminologyEditorcontrol"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m){"use strict";function p(e,t,o,n,i){var r=c.inFamilyTerminology(o.plmType),a=c.inFamilyTerminology(n.plmType);if(r&&!a)return-1*this.reverseFactor;if(!r&&a)return 1*this.reverseFactor;var l=0;return"defaultSort"===i&&(l=(o.options.relationOrder?o.options.relationOrder:0)-(n.options.relationOrder?n.options.relationOrder:0),e=o.getAttribute("label"),t=n.getAttribute("label")),o&&o.options&&o.options.grid&&o.options.grid[i+"_SortKey"]&&(e=o.options.grid[i+"_SortKey"]),n&&n.options&&n.options.grid&&n.options.grid[i+"_SortKey"]&&(t=n.options.grid[i+"_SortKey"]),0==l?u.compareLabels(e,t):l}return e.extend({buildDGVOpts:function(e){var o=this;return e=e||{},new t(function(t){var n,s=function(e){var n=UWA.clone(r.getConfig("dgvOptions")),i=n&&n.dgv?n.dgv:{};if(e=UWA.extend(i,e),o.options.additionalColumnsModules){for(var s=[],d=0;d<o.options.additionalColumnsModules.length;d++)UWA.is(o.options.additionalColumnsModules[d].getAdditionalColumnsUXDGV,"function")&&(o.options.additionalColumnsModules[d].getAdditionalColumnsUXDGV(e.columns),s=s.concat(o.options.additionalColumnsModules[d].getManagedColumnNames()));var c=function(e){for(var t={},o=0;o<e.length;o++){var n=e[o];t[n.dataIndex]=void 0!==n.visibleFlag&&!n.visibleFlag}return t}(e.columns);s.length&&(function(e,t,o){for(var n=0;n<e.length;n++){var i=e[n];-1!==t.indexOf(i.dataIndex)&&(i.isAdditionalColumn=!0),void 0!==o[i.dataIndex]&&(i.visibleFlag=!o[i.dataIndex])}}(e.columns,s,c),function(e){for(var t=0;t<e.length;t++){var o=e[t],n=o.customisation;n&&n.layout&&o.visibleFlag!==!n.layout.hidden&&(n.layout.hidden=!o.visibleFlag)}}(e.columns))}else o.options.additionalColumnsModules=[];if(e.selectionBehavior.toggle=!1,e.infiniteScrolling=!0,e.onContextualEvent=o._onContextualEvent.bind(o),e.onDelayedModelDataRequest=o.options.context.updateAttributesDelayed.bind(o.options.context),o.options.callbacks){var u=Object.keys(o.options.callbacks);for(d=0;d<u.length;d++)e[u[d]]=o.options.callbacks[u[d]]}e.columns.push({dataIndex:"defaultSort",visibleFlag:!1,customisation:{exportable:{lock:!0,value:!1},layout:{removable:!1}}}),e.columns.forEach(function(e){"tree"===e.dataIndex&&(e.getCellKPIColor=g.getCellKPIColor.bind(g)),e.compareFunction=p,e.onCellRequest=function(e){if(!e.isHeader){e.nodeModel&&e.nodeModel.options.isBeingCut?e.cellView.getContent().addClassName("pad-state-is-being-cut"):e.cellView.getContent().removeClassName("pad-state-is-being-cut");var t=this.getColumnOrGroup(e.columnID);let n=o.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.columnID)>=0)for(let n=0;n<o.options.additionalColumnsModules.length;++n)if(o.options.additionalColumnsModules[n]._columnDataIndex&&o.options.additionalColumnsModules[n]._columnDataIndex[0]===t.dataIndex&&o.options.additionalColumnsModules[n].onCellRequest&&o.options.additionalColumnsModules[n].onCellRequest(e))return;t&&"boolean"===t.typeRepresentation&&(e.cellModel="string"==typeof e.cellModel?"TRUE"===e.cellModel:e.cellModel)}if(e.nodeModel){var n=e.nodeModel.options.icons;n&&n.length>0&&("string"==typeof n[0]?e.nodeModel.options.icons=[{iconPath:"url("+n[0]+")"}]:"object"==typeof n[0]&&(e.nodeModel.options.icons=[n[0]]))}this.defaultOnCellRequest(e)}}),l.updateColumnsWithNLS(e.columns,function(n){"success"===n.status&&(e.columns=n.columns),a.updateAttributesList(e.columns),o.completeDGVOptions(e).then(t)})};o.options.view_customization&&!0!==e.reset&&!0!==o.options.view_customization.custoFromTree?(!0===o.options.view_customization.custoOptimized&&(o.options.view_customization=i.convertPreference2Custo(o.options.view_customization,"datagridview")),(n=o.options.view_customization).columns=o.buildColumnsFromStorage(n.columns).then(function(e){n.columns=e,s(n)})):(n={},o.buildColumns("datagridview").then(function(e){n.columns=e.columns,s(n)}))})},completeDGVOptions:function(e){return t.resolve(e)},completeCB:function(){return t.resolve()},addColumnCB:function(e){var o=this;this.options.dgv.prepareUpdateView();var n=[];e.forEach(function(e){e&&e.convertInfos&&e.convertInfos.dimension&&(e.kind="string"),n.push(new t(function(t){a.addAvailableColumn(e.dataIndex,e).then(function(e){var n=o.buildColumnFromSetting(e);n&&(n.compareFunction=p,o.options.dgv.addColumnOrGroup(n),"thumbnail"===n.dataIndex&&(o.options.dgvLayout.cellHeight=80)),t()})}))}),t.all(n).then(function(){this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}.bind(this))},removeColumnCB:function(e){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=UWA.is(e,"string")?JSON.parse(e):e,n=t.options.dgv.getColumnOrGroup(o.dataIndex);n&&void 0!==n.dataIndex&&(t.options.dgv.removeColumnOrGroup(o.dataIndex),"thumbnail"===o.dataIndex&&(t.options.dgvLayout.cellHeight=38,"compact"===t.options.viewMode&&(t.options.dgvLayout.cellHeight=26)),a.removeAvailableColumn(o.dataIndex))}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)},changeTitleCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(this.options.dgv.prepareUpdateView(),o.text=t,o.customisation.titleModified=!0,this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0))},changeDBAttributeCB:function(e){if(e&&0!=e.length){var t=this;this.options.dgv.prepareUpdateView(),e.forEach(function(e){var o=t.options.dgv.getColumnOrGroup(e.dataIndex);o&&void 0!==o.dataIndex&&(o.attrDBName=e.attrDBName)}),this.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!0},!0)}},changeVisibilityCB:function(e,t){this.options.dgvLayout.setColumnVisibleFlag(e,t,{isUserInteraction:!0})},changePinCB:function(e,t){this.options.dgvLayout.setColumnPinned(e,t,{isUserInteraction:!0})},moveColumnCB:function(e){if(e.move2perform){let t=e.move2perform.fromIndex?e.move2perform.fromIndex:e.move2perform.fromID,o=e.move2perform.toIndex?e.move2perform.toIndex:e.move2perform.toID;this.options.dgvLayout.moveColumn(t,o,{isUserInteraction:!0})}},changeDgvLayout:function(e){void 0!==typeof e.rowsHeader&&(this.options.dgvLayout.rowsHeader=e.rowsHeader)},changeExportCB:function(e,t){var o=this.options.dgv.getColumnOrGroup(e);o&&(o.customisation.exportable={lock:!1,value:t})},compactMode:function(e){"comfortable"===e.viewMode?(this.options.dgvLayout.cellHeight=38,this.options.viewMode="comfortable"):"compact"===e.viewMode&&(this.options.dgvLayout.cellHeight=26,this.options.viewMode="compact")},saveCustoView:function(e){var t=this;this._prepareOptsToStore({onComplete:function(o){var n=e?"onCustoViewChange":"onSaveAsTemplate";t.options.context.dispatchEvent(n,o)}})},reset:function(e){return new t(function(t){var o=this;delete o.options.view_customization,this.buildDGVOpts({reset:!0}).then(function(n){var i=r.getConfig("dgvOptions")?r.getConfig("dgvOptions"):{};o.options.dgv.prepareUpdateView(),i.dgvLayout&&(o.options.dgvLayout.cellHeight=i.dgvLayout.cellHeight),o.changePinCB(o.ctxColOpts.dataIndex,"right"),n.columns.push(o.ctxColOpts),o.ctxColOpts.visibleFlag=!0,o.options.dgvLayout.columns=n.columns,o.options.dgv.columns=n.columns,o.options.dgvLayout.deleteDataGridViewPreferences(),o.options.viewMode=i.viewMode;var a=m.getTreeCont();a&&a.modeChange({viewMode:o.options.viewMode}),o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!0,updateCellAttributes:!1},!0),o.options.dgvLayout.applyColumns(),o.saveCustoView(e),t()})}.bind(this))},_onContextualEvent:function(e){return new t(function(t){d.getCtxMenu(e).then(function(e){t(e)})})},eventHandlerOnGridView:function(e){var o=this;return new t(function(t){e.addEventListener("click",function(e,t){if(void 0!==t&&-1!==t.rowID){var n=e.dsModel.layout.getDataIndexFromColumnIndex(t.columnID);if(o.options.clickEvent[n])o.options.clickEvent[n](t);else if(o.options.additionalColumnsModules&&!0===e.dsModel.layout.getColumnOptionValue(t.columnID,"isAdditionalColumn"))for(var i=0;i<o.options.additionalColumnsModules.length;i++){if(o.options.additionalColumnsModules[i].getOnCellClickCB){var r=o.options.additionalColumnsModules[i].getOnCellClickCB(n,e);if(r){r(t);break}}}}}),e.addEventListener("userPreferencesChange",function(e){o.saveCustoView(!0)}),e.addEventListener("columnWidthChange",function(e){if(e&&e.dsModel&&e.dsModel.layout&&o.options&&o.options.dgv&&o.options.dgv.layout&&o.options.dgv.model){let t=e.dsModel.layout.getDataIndexFromColumnIndex(e.options.columnID),n=o.options.dgv.layout.getDisplayedColumnsIndexes();if(n&&n.indexOf(e.options.columnID)>=0)for(let n=0;n<o.options.additionalColumnsModules.length;++n)if(o.options.additionalColumnsModules[n]._columnDataIndex&&o.options.additionalColumnsModules[n]._columnDataIndex[0]===t&&o.options.additionalColumnsModules[n].updateAttributesOnResize){let t=o.options.dgv.layout.getMinMaxVisibleRowIDs(),i=t.minRowID,r=t.maxRowID,a=[];(a=r>=0?o.options.dgv.model.slice(i,r+1):o.options.dgv.model.slice(i,r)).length>0&&o.options.additionalColumnsModules[n].updateAttributesOnResize(a,e.options.columnID);break}}}),e.addEventListener(n.POINTERHIT,function(e,t){if(2===e.multipleHitCount&&t&&-1!==t.rowID){var o=t.nodeModel;o&&s.activateTerminologyEditorItem(o.id,o.getType(),o.getLabel()),require(["DS/IPClassifyUtil/IPClassifyCommunication"],function(e){if(!0===widget.getValue("noCompass")){var t={id:o.getID(),label:o.getLabel(),type:o.options.type,cadMaster:o.options.grid["ds6w:cadMaster"],kind:o.options.grid["ds6w:kind"],contentStructure:o.options.grid["ds6w:contentStructure"]};e.publish("doubleClickonContentInTerminology",t)}})}}),o.completeCB(e).then(t)})},_prepareOptsToStore:function(e){var t=this;o.debounce(function(e){for(var o=t.options.dgvLayout.getOrderedColumnsIndexes(),n=[],r=[],a={},l=0;l<o.length;l++){var s=t.options.dgv.getColumnOrGroup(o[l]);"defaultSort"===s.dataIndex?r.push(s):"ContextualMenuColumn"!==s.dataIndex?(n.push(s),!0===s.customisation.titleModified&&(a[s.dataIndex]=!0)):t.ctxColOpts&&n.push(t.ctxColOpts)}var d={viewMode:t.options.viewMode,defaultCellHeight:t.options.dgvLayout.cellHeight,rowsHeader:t.options.dgvLayout.rowsHeader,columns:n,sortModel:t.options.dgv.sortModel},c=i.convertCusto4Preference(d,a,"datagridview");r.forEach(e=>n.push(e)),t.options.dgv.columns=n,e.onComplete(c)},500)(e)}})}),define("DS/TerminologyEditor/utils/TerminologyLocationUtil",["UWA/Core","UWA/Utils","UWA/Class","DS/TerminologyEditor/service/TerminologyEditorWebService","DS/TerminologyEditor/Terminology_CSO","DS/TerminologyEditor/popup/TerminologyLocationPopup","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/TerminologyEditor/assets/nls/TerminologyLocationPopup","DS/Utilities/Dom","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyLoaderGlobal","DS/TerminologyEditor/views/TerminologyMode"],function(e,t,o,n,i,r,a,l,s,d,c,g,u){"use strict";return o.singleton({getTerminologyPathsforItem:function(e){var t=this;return new Promise(function(o,a){n.getTerminologyPathsforItem({id:[e.id],onComplete:function(e){if(e.result.length>0){var n=i.getCurrentTerminology().getID();if(e.result[0].outputs.GET_PARENT){var a=e.result[0].outputs.GET_PARENT,d=e.result[0].outputs.GET_PARENT[0].paths[0][1];if(1===a.length)if(1===a[0].paths.length){var g=t._CalculatePath(e,n),u=g[0].ids.length;if(1==g.length)if(u>2){var m={id:d.physicalid,type:d["ds6w:type"],name:d["ds6w:label"]},p=!1;n===g[0].idToNavigate&&(p=!0),t._selectTerminologyInTree(m,p)}else{m={id:a[0].physicalid,type:a[0]["ds6w:type"],name:a[0]["ds6w:label"]},p=!1;n===g[0].idToNavigate&&(p=!0),t._selectTerminologyInTree(m,p);var h=c.isSearchActive();console.log("statue of search: "+h)}}else{var f=t._CalculatePath(e,n);if(1==f.length){m={id:f[0].idToNavigate,type:f[0].type,name:f[0].name},p=!1;n===f[0].idToNavigate&&(p=!0),t._selectTerminologyInTree(m,p)}else{var y={message:s.OpenLocationPopupLable,radio:!0,okButtonLabel:s.Open,onOkClick:function(e){t.locationPopop.dialog.close();for(var o={id:null,type:null,name:null},n=0;n<e.data.length;n++)if(e.selectPathIDToNav===e.data[n].idToNavigate){o.id=e.data[n].idToNavigate,o.name=e.data[n].name,o.type=e.data[n].type;break}var i=!1;e.selectPathIDToNav===e.currNodeID&&(i=!0),t._selectTerminologyInTree(o,i)}},v=new r(f,t.getHtmlElemFromPath.bind(t),y);t.locationPopop=v}}else{var T=t._CalculatePath(e,n);if(1===T.length){m={id:T[0].idToNavigate,type:T[0].type,name:T[0].name},p=!1;n===T[0].idToNavigate&&(p=!0),t._selectTerminologyInTree(m,p)}else{y={message:s.OpenLocationPopupLable,radio:!0,okButtonLabel:s.Open,onOkClick:function(e){t.locationPopop.dialog.close();for(var o={id:null,type:null,name:null},n=0;n<e.data.length;n++)if(e.selectPathIDToNav===e.data[n].idToNavigate){o.id=e.data[n].idToNavigate,o.name=e.data[n].name,o.type=e.data[n].type;break}var i=!1;e.selectPathIDToNav===e.currNodeID&&(i=!0),t._selectTerminologyInTree(o,i)}},v=new r(T,t.getHtmlElemFromPath.bind(t),y);t.locationPopop=v}}}else if("Workspace"===e.result[0].input_object["ds6w:type"]){var _=e.result[0].input_object;if("TerminologySection_AllTerminologies"===n||_.physicalid===n){var C={id:_.physicalid,type:_["ds6w:type"],name:_["ds6w:label"]};p=n===_.physicalid;t._selectRootTerminologyInTree(C,p)}}else l.displayNotification({message:s.msg_error_BM_LOC_InValid_Object,className:"error"})}else l.displayNotification({message:s.msg_error_BM_LOC_InValid_Object,className:"error"});o()},onFailure:function(e,t,o){a(e,t,o)}})})},getResizedText:function(e,t,o,n){function i(e,t){if(e>=t.length)return t;e-="...".length;let o=t.split(">"),n=-1,i=(o=o.filter(e=>"..."!==e)).length-1,r=0;for(;n<i;){if(!(r+o[i].length+">".length<e)){++i;break}if(r+=o[i].length+">".length,--i,!(r+o[n+1].length+">".length<e)){++i;break}r+=o[++n].length+">".length}let a="";for(let e=0;e<=n;++e)a+=o[e]+">";if(a+="...",o.length-i<=1&&n<0)(a+=">"+o[o.length-1]).length>e&&(a=a.substring(0,e-"...".length)+"...");else for(let e=i;e<o.length;++e)a+=">"+o[e];return a}let r=e/t,a=Math.floor(n.length*r);if(o.indexOf(":")>=0){if(a>o.length)return o;let e="...";return e+o.substring(o.length+e.length-a,o.length)}if(-1===o.indexOf(">")){if(a>o.length)return o;let e="...";return o.substring(0,a-e.length)+e}return i(a,e>=t?o:n)},getHtmlElemFromPath:function(e,t){var o=this,n=UWA.createElement("span",{class:"bk-ellipsys-root",titlex:e}),i=UWA.createElement("span",{class:"bk-ellipsys-child"});return i.innerText=e,i.inject(n),!0!==t?(n._prevWidth=0,n.addEvent("resize",function(e){let t=this.getDimensions().width;this._prevWidth!=t&&(this._prevWidth=t,this.childNodes&&this.childNodes.length>0&&this.childNodes[0].getDimensions&&(this.childNodes[0].innerText=o.getResizedText(e.target.clientWidth,this.childNodes[0].getDimensions().width,this.getAttribute("titlex"),this.childNodes[0].innerText)))})):n.computeContentSize=function(){let e=0,t=a.getContent();if(t&&t.getPADTreeListView()){var o=t.getPADTreeListView().getFontDetails();if(o){var n=o.fontSize,i=o.fontSytle;e=Math.ceil(d.computeStringWidth(this.title,n,i,!1,!1))}}return e},n.setData=function(e){this.setAttribute("titlex",e),this.childNodes&&this.childNodes.length>0&&(this.childNodes[0].innerText=e)},n},_CalculatePath:function(e,t){for(var o=e.result[0].outputs.GET_PARENT,n=[],i={lable:null,physicalid:null,type:null},r=0;r<o.length;r++){var a=o[r].paths;i.lable=o[r]["ds6w:label"],i.physicalid=o[r].physicalid,i.type=o[r]["ds6w:type"];for(var l=0;l<a.length;l++){var s=a[l],d={type:null,name:null,idToNavigate:null,fullPath:[],ids:[]};d.fullPath.push(i.lable),d.ids.push(i.physicalid);for(var c=s.length-1;c>=0;c--){var g=s[c];"Terminology"!==g["ds6w:type"]&&"Term"!==g["ds6w:type"]||(d.idToNavigate=g.physicalid,d.type=g["ds6w:type"],d.name=g["ds6w:label"],d.fullPath.push(g["ds6w:label"])),d.ids.push(g.physicalid)}null===d.idToNavigate&&(d.idToNavigate=i.physicalid,d.type=i.type,d.name=i.label),("TerminologySection_AllTerminologies"===t||d.ids.includes(t))&&n.push(d)}}return n},getImmediateParents:function(e){for(var t,o,n=[],i={},r=0;r<e.length;r++)t=e[r].idToNavigate,o=e[r].name,n.push(t),i[t]=o;return[n,i]},_selectTerminologyInTree:function(e,t){var o=a.getTreeCont();o._rootNodeTerminologies;a.getContent().nodeToSelectID=i.getCurrentSelection()[0].getID(),i.getCurrentTerminology().getID()!==e.id?(u.switchtoAuthoringMode(),g.addComponentsToLoad("global",{content:""}),o.expandTreeAndSelectTerminology({doNotSelectInTree:t,terminologyToFindAndSelect:{ids:[e.id],type:e.type,name:e.name},onComplete:function(e){g.removeComponentToLoad("global","content"),console.log(" expandTreeAndSelectTerminology:onComplete"),g.removeComponentToLoad("contentView","content")},onFailure:function(t){l.displayNotification({message:s.replace(s.get("msg_error_TerminologyActivate"),{name1:e.name}),className:"error"})}})):c.isSearchActive()&&c.clearSearch()},_selectRootTerminologyInTree:function(e,t){u.switchtoAuthoringMode();a.getTreeCont();a.getContent().nodeToSelectID=i.getCurrentSelection()[0].getID(),c.isSearchActive()&&c.clearSearch(),g.removeComponentToLoad("contentView","content"),a.getContent().loadContentAndSelect(void 0,[e.id])}})}),define("DS/TerminologyEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/utils/TerminologyLocationUtil","DS/IPClassifyUtil/bsd_utils/BSDContext"],function(e,t,o,n){"use strict";return e.extend({execute:function(){var e=n.get().ctxInfo;switch(this.options.ID){case"RenameCmd":!function(e){var o=e.options.cellInfos,n=e.options.isTree;t.RenameCmd(o,n)}(e);break;case"TerminologyLocation":!function(e){var t=e.nodes;t.length>0&&o.getTerminologyPathsforItem(t[0])}(e)}}})}),define("DS/TerminologyEditor/views/customize_views/_TerminologyDGVUtils",["i18n!DS/TerminologyEditor/assets/nls/TerminologyEditor.json","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/IPClassifyUtil/bsd_utils/BSDDictionaryAccess","DS/TerminologyEditor/service/TerminologyTypeService","DS/WebappsUtils/WebappsUtils"],function(e,t,o,n,i){"use strict";function r(e){}return r.prototype.buildColumns=function(e){return new Promise(function(e,n){var i=[],r=0,a=t.getColumnsOrder(void 0);t.updateAttributesWithKind(void 0).then(function(){for(r=0;r<a.length;r++){var n=t.getColumn(a[r],void 0);n&&i.push(this.buildColumnFromSetting(n))}var l=UWA.clone(i);o.updateColumnsWithNLS(l,function(t){var o={};o.columns=l,"success"===t.status&&(o.columns=t.columns),e(o)})}.bind(this)).catch(n)}.bind(this))},r.prototype.buildColumnFromSetting=function(t){var o=Object.assign({editableFlag:!1,customisation:{exportable:{lock:!1,value:!0}}},t);if(!UWA.is(o.dataIndex)){if(!UWA.is(o.ds6w))throw new Error("Wrong column definition for ["+JSON.stringify(t)+"]");o.dataIndex=o.ds6w}switch(o.kind){case"string":o.typeRepresentation="string";break;case"timestamp":case"dateTime":o.typeRepresentation="datetime",o.getCellValueForExport=function(e){var t=new Date(e.cellModel),o=e.cellModel;return"Invalid Date"!=t&&(o=t.toLocaleString()),o};break;case"boolean":o.typeRepresentation="boolean";break;case"image":o.typeRepresentation="image";break;case"icon":o.typeRepresentation="icon";break;case"functionIcon":o.typeRepresentation="functionIcon";break;default:o.typeRepresentation||(o.typeRepresentation="string")}switch(o.dataIndex){case"thumbnail":o.ds6w=void 0,o.typeRepresentation="image",o.text=e.column_Thumbnail,o.sortableFlag=!1;break;case"tree":o.getCellEditableState=function(e){return 1!=widget.launchWithReadMode&&(e&&e.nodeModel&&n.inFamilyTerminology(e.nodeModel.plmType))},o.editionPolicy="DelayedEditionOnClick",o.setCellValue=function(e,t){e.nodeModel&&(require("DS/TerminologyEditor/commands/TerminologyCommands")._cellToRename={cellInfos:e,context:"CONTENT"},function(e,t,o){e.getTreeDocument().withTransactionUpdate(function(){if("tree"===t){var n={};n.label=o,n.display=o,n.oldLabel=e.options.label,e.updateOptions(n)}})}(e.nodeModel,"tree",t))}}return o},r.prototype.buildColumnsFromStorage=function(e){var o=this;return new Promise(function(n,i){var r=[],a=0;t.updateAttributesWithKind(void 0,e).then(function(e){t.updateAttributesWithKind().then(function(){var i=[];if(e)for(a=0;a<e.length;a++)i.push(new Promise(function(n){var i=e[a].dataIndex;t.addAvailableColumn(i,e[a]).then(function(e){var t=o.buildColumnFromSetting(e);t&&r.push(t),n()})}));Promise.all(i).then(function(){var e=UWA.clone(r);n(e)})})})})},r}),define("DS/TerminologyEditor/views/TerminologyDataGridView",["UWA/Core","UWA/Promise","UWA/Class","UWA/Class/Options","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/IPClassifyUtil/bsd_utils/BSDCommandProxy","DS/TerminologyEditor/views/customize_views/TerminologyDGVParametrization","DS/TerminologyEditor/views/customize_views/_TerminologyDGVUtils","DS/IPClassifyUtil/bsd_utils/BSDConfiguration","DS/TerminologyEditor/utils/TerminologySearch","DS/TerminologyEditor/utils/TerminologyEditorcontrol","DS/TerminologyEditor/commands/TerminologyCommands","DS/TerminologyEditor/utils/TerminologyEditorKeyboardListener","DS/TerminologyEditor/ActionBar/TerminologyCommandManager","DS/TerminologyEditor/utils/TerminologyEditorUtil","DS/CollectionView/commands/CollectionViewCommands","DS/Controls/Button","DS/IPClassifyUtil/IPClassifyModelEvents","DS/IPClassifyUtil/bsd_utils/BSDAttributeMgt","DS/TerminologyEditor/utils/TerminologyEditorEvents","DS/TerminologyEditor/views/TerminologyMode","DS/TerminologyEditor/Terminology_CSO","DS/IPClassifyUtil/DimensionUtils","DS/ApplicationFrame/CommandsManager"],function(e,t,o,n,i,r,a,l,s,d,c,g,u,m,p,h,f,y,v,T,_,C,S,b,E){"use strict";var D=new m;return o.extend(n,l,s,{name:"TerminologyTreeListView",defaultOptions:{renderTo:null,context:null,modelEvents:null,subscribeTokens:[],columnsManagement:!0,dgv:null,dgvLayout:null,viewMode:"",clickEvent:{},doubleClickEvent:{}},init:function(e){this._parent(e),this.setOptions(e)},initialize:function(){var o=this;return new t(function(n){var l=e.clone(d.getConfig("dgvOptions"));o.options.viewMode=l.viewMode;var s=g.getPlaceholder(),u=o.buildDGVOpts();t.all([s,u]).then(function(t){var s=t[1],d=t[0],u=!1!==o.options.context.options.settings.view_settings.sortPersistence;u||(s.sortModel=[{dataIndex:"defaultSort",sort:"asc"}]);var m=e.extend({identifier:"DataGridView-"+o.name+"-"+widget.id},s);if("undefined"!==l.dgvLayout){var p=e.clone(l.dgvLayout);void 0!==s.defaultCellHeight&&(p.cellHeight=s.defaultCellHeight,delete s.defaultCellHeight),!window.__karma__&&navigator.webdriver&&(s.rowsHeader=!0),void 0!==s.rowsHeader&&(p.rowsHeader=s.rowsHeader,delete s.rowsHeader),s.columns.forEach(function(e){e.minWidth=50}),m.layout=o.options.dgvLayout=new r(p),m.layout.useLastColumnWidthAutoFlag=!0}m.placeholder=d.getContent();var f=null,y=!0;m.columns.forEach(function(e,t){"ContextualMenuColumn"===e.dataIndex&&(f=t,y=e.visibleFlag)}),null!==f&&m.columns.splice(f,1),m.showContextualMenuColumnFlag=!0,m.useAsyncPreExpand=!0,o.options.dataGridPlaceHolder=m.placeholder,o.options.viewMode=s.viewMode?s.viewMode:"comfortable";var T=g.getTreeCont();T&&T.modeChange({viewMode:o.options.viewMode});var _=o.options.dgv=new i(m);_.selectNextCellOnEnterFlag=!1,_.setUseClipboardFlag(!1),o.ctxColOpts=_.getColumnOrGroup("ContextualMenuColumn"),o.ctxColOpts&&(o.options.dgv.prepareUpdateView(),o.ctxColOpts.visibleFlag=y,o.ctxColOpts.customisation={exportable:{lock:!0,value:!1},layout:{pinEditable:!0,removable:!0}},o.options.dgv.pushUpdateView({updateCellContent:!0,updateCellLayout:!1,updateCellAttributes:!0},!0));var S=h.getContentSortmodel();s.sortModel=!u||s.sortModel?s.sortModel:S,s.sortModel&&(o.options.dgv.prepareUpdateView(),o.options.dgv.sortModel=s.sortModel,o.options.dgv.layout.saveColumnSortModelInPreferences(),o.options.dgv.pushUpdateView({updateCellContent:!1,updateCellLayout:!0,updateCellAttributes:!1},!0)),_.onCopy=D.launchKeyAction.bind(D,"ctrl+c"),_.onCut=D.launchKeyAction.bind(D,"ctrl+x"),_.onPaste=D.launchKeyAction.bind(D,"ctrl+v");["esc","del","ctrl+f","alt+return","f2"].forEach(function(e){_._keymapManager.registerKeymap(e,void 0)}),c.onSearchChange(function(){}),_.addEventListener("sortModelChange",function(){(c.isSearchActive()||"read"==C.getCurrentModeType())&&g.getContent().loadContentAndSelect()}),_.onInfiniteScroll(function(e){g.getContent().processForInfiniteScroll(e,_)}),o._commandProxy=a.create(),o.eventHandlerOnGridView(_).then(function(){_.getContent().addClassName(o.name),o.options.renderTo&&!0===o.options.isActiveView&&_.inject(o.options.renderTo),n()}),v.getModelEvents().subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":t.removedColumns&&t.removedColumns.length>0&&o.removeColumn(t.removedColumns),t.addedColumns&&t.addedColumns.length>0&&o.addColumn(e.clone(h.filterDBOnlyAttrs(t.addedColumns)));break;case"reset":o.resetColumn()}})})})},escape:function(){this.options.dgv.commands.escape.bind(this.options.dgv)()},getManager:function(){return this.options.dgv},addColumn:function(e){e.length>0&&(c.addPredicates(e),_.notifyCurrentTerminologyColumnChange())},removeColumn:function(e){c.removePredicates(e)},resetColumn:function(){c.setPredicates(T.getAvailableColumnsOpts()),_.notifyCurrentTerminologyColumnChange()},setModel:function(e){this.options.dgv.getContent().inject(this.options.renderTo),this.options.isActiveView=!0,this.options.dgv.treeDocument=e},unsetModel:function(){this.options.isActiveView&&(this.options.renderTo.removeChild(this.options.dgv.getContent()),this.options.isActiveView=!1,this.options.dgv.treeDocument=null)},isColumnHidden:function(e){return!this.options.dgv.layout.getColumnVisibleState(e)},showColumn:function(e){this.changeVisibilityCB(e,!0)},hideColumn:function(e){this.changeVisibilityCB(e,!1)},changeColumnTitle:function(e,t){this.changeTitleCB(e,t)},getDatagridPlaceHolder:function(){return this.options.dataGridPlaceHolder},getFontDetails:function(){var e=this.options.dgv,t=12,o=10;e&&e.layout&&e.layout.collectionView&&e.layout.collectionView._getCurrentTouchMode()&&(t=14,o=20);var n="Ariel";if(e&&e.layout&&e.layout.collectionView){let o=e.layout.collectionView.elements.leftPoolContainer;if(o){let e=o.getElementsByClassName("wux-tweakers-string-label");if(e&&e.length>0){let o=e[0];t=(t=o.getStyle("font-size"))?parseInt(t.replace("px","")):12,n=o.getStyle("font-family")}}}return{fontSize:t,fontMargin:o,fontSytle:n}},getColumnWidth:function(e){var t=0,o=this.options.dgv;return o&&o.layout&&o.layout.getColumnWidth&&(t=o.layout.getColumnWidth(e)),t},getRowHeight:function(){var e=0,t=this.options.dgv;return t&&t.layout&&t.layout.getRowHeight&&(e=t.layout.getRowHeight()),e},scrollToVisibleNode:function(e){var t=this.options.dgv,o=t.layout.getColumnIndex("tree"),n=t.layout.getCellsFromNodeModel(e)[o];t.scrollToCellAt({cellID:n})},getColumnUnitNls:function(e,t){let o=null;var n=this.options.dgv;if(n&&n.layout&&n.layout.getLeafColumns){let r=n.layout.getLeafColumns();for(var i=0;i<r.length;++i)if(r[i].dataIndex===e){r[i].convertInfos&&(o=r[i].convertInfos.nls),r[i].convertInfos&&r[i].convertInfos.manipulationUnit&&r[i].convertInfos.manipulationUnit!==r[i].convertInfos.unit&&(o=!0===t?null:r[i].convertInfos.manipulationNls);break}}return o},getManipulationUnitColumns:function(){let e=[];var t=this.options.dgv;if(t&&t.layout&&t.layout.getLeafColumns){let n=t.layout.getLeafColumns();for(var o=0;o<n.length;++o)n[o].convertInfos&&n[o].convertInfos.manipulationUnit&&n[o].convertInfos.manipulationUnit!==n[o].convertInfos.unit&&e.push(n[o])}return e},getManipulationUnitVisibleValues:function(t,o){let n=[];var i=this.options.dgv;if(i&&i.model&&i.layout){var r=i.layout.getMinMaxVisibleRowIDs();if(r&&r.hasOwnProperty("minRowID")&&r.hasOwnProperty("maxRowID"))for(var a=r.minRowID;a<=r.maxRowID;++a){let r=i.model[a];if(o&&r.getID()!==o)continue;let l=(r.grid||r.options.grid)[t];if(e.is(l,"array")?n=n.concat(l):l&&n.push(l),o&&r.getID()===o)break}}return n},enrichSearchValue:function(e){let o=this;return new t(function(t){var n=o.options.dgv;e&&n&&n.layout&&n.layout.getLeafColumns||t(e);let i=e;if(-1!==e.indexOf(":")){let o=e.substring(0,e.indexOf(":")),a=o,l=e.substring(e.indexOf(":")+1,e.length),s=n.layout.getLeafColumns(),d=null;for(var r=0;r<s.length;++r)if(s[r].text===o){if(a="["+s[r].dataIndex+"]",s[r].convertInfos&&s[r].convertInfos.manipulationUnit&&s[r].convertInfos.manipulationUnit!==s[r].convertInfos.unit){(d={}).Data=[];let e={};e.Dimension=s[r].convertInfos.dimension,e.UnitFrom=s[r].convertInfos.manipulationUnit,e.UnitTo=s[r].convertInfos.unit,e.Values=l,d.Data.push(e)}break}i=i.replace(o,a),d?b.convertToPreferdUnits(d).then(function(e){e&&0!==e.length||t(i),t(a+":"+e[0].ConvertedValues)}):t(i)}else t(i)})}})});