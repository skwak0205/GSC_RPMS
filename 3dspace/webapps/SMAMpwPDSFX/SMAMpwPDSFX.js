/*!  Copyright 2019 Dassault Systemes. All rights reserved. */
define("DS/SMAMpwPDSFX/SMAMpwNodesAbstract",["UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t){"use strict";return e.extend({_processParameters:function(e){e.parameters.ContourMap1D.map.wrapS=t.ClampToEdgeWrapping,e.parameters.ContourMap1D.map.wrapT=t.ClampToEdgeWrapping,e.parameters.ContourMap2D.map.wrapS=t.ClampToEdgeWrapping,e.parameters.ContourMap2D.map.wrapT=t.ClampToEdgeWrapping,e.parameters.ContourMap1D.map.minFilter=t.NearestFilter,e.parameters.ContourMap1D.map.magFilter=t.NearestFilter,e.parameters.ContourMap2D.map.minFilter=t.NearestFilter,e.parameters.ContourMap2D.map.magFilter=t.NearestFilter},_getUniforms:function(e){return{ContourMap1D:{type:"t2",value:e.parameters.ContourMap1D.map},ContourMap2D:{type:"t2",value:e.parameters.ContourMap2D.map},NoResultScale:{type:"f",value:e.parameters.NoResultScale},PointSpriteSize:{type:"f",value:e.parameters.PointSpriteSize},PointSymbol:{type:"f",value:e.parameters.PointSymbol},ResultScale:{type:"f",value:e.parameters.ResultScale},ResultShift:{type:"f",value:e.parameters.ResultShift},ResultsDim:{type:"f",value:e.parameters.ResultsDim},RetexturingScale:{type:"f",value:1},RetexturingShift:{type:"f",value:0}}},_getVSComputePointSize:function(){return["float ComputePointSize() {","  f_Size = PointSpriteSize;","  if( 14.0 == PointSymbol )","    f_Size = 3.0;","  else if( 15.0 == PointSymbol )","    f_Size = 1.0;","  else if( f_Size < 0.55 )","\t   f_Size = 0.55;","  return f_Size;","}"].join("\n")},_getFSComputeDiscard:function(){return["bool ComputeDiscard() {","  vec2 v2PC = vGetPointCoord();","  vec3 n;","  n.xy = v2PC * 2.0 - 1.0;","  n.z = dot(n.xy, n.xy);","  if (n.z > 1.0)","    return true;","  n.z = sqrt(1.0 - n.z);","  gv3_Normal = normalize(n);","  return false;","}"].join("\n")},_getFSComputeViewNormal:function(){return["vec3 ComputeViewNormal() {","  return gv3_Normal;","}"].join("\n")},_getFSProcessFinalColor:function(){return["void ProcessFinalColor(inout vec4 ioFinalColor) {","  ioFinalColor.rgb = ioFinalColor.rgb * gv3_Normal.z;","}"].join("\n")},init:function(){this._parent(),this._MaterialOptions={size:4,color:new t.Color(65535),sizeAttenuation:!1,useBlending:!0}},initMaterial:function(e){if(e){e.material=new t.ParticleBasicMaterial(this._MaterialOptions),e.material.activatePDSFX(),e.material.lights=!0;e.material.setPDSFXGlobalShaderCode("","vec3 gv3_Normal;");e.material.setPDSFXVaryings({v4_color:{type:"v4"},v4_WorldViewPosition:{type:"v4"},f_Size:{type:"f"}}),this._processParameters(e),e.material.setPDSFXUniforms(this._getUniforms(e));var o={ComputeVaryingValues:["void ComputeVaryingValues() {","  vec4 v4Col = vec4(1.0,1.0,1.0,1.0);","  float fDim = ResultsDim;","  if( 0.0 != fDim ) {","    // Get texture coordinate for the result value","    vec2 v2TexCoord = vGetAttribTangent().xy;","    float fResX = v2TexCoord.x * ResultScale + ResultShift;","    if( 4.0 > fDim )","\t\t   v2TexCoord.x = clamp(fResX, 0.0, 1.0);","\t   else","\t     v2TexCoord.x = fract(fResX);","    v2TexCoord.x = v2TexCoord.x * RetexturingScale + RetexturingShift;","\t   if( 1.0 == fDim || 5.0 == fDim ) {","\t\t   v2TexCoord.y = 0.0;","\t\t   v4Col.xyz *= texture2D(ContourMap1D, v2TexCoord).xyz;","    }","\t   else { //if( 2.0 == ResultsDim )","\t\t   v2TexCoord.y *= NoResultScale; // = clamp(v2TexCoord.y,0.0,1.0);","      v4Col.xyz *= texture2D(ContourMap2D, v2TexCoord).xyz;","\t   }","  }","  v4_color = v4Col * 0.9;","  v4_WorldViewPosition = vGetWorldViewMatrix() * vec4(vGetAttribPosition(), 1.0);","}"].join("\n"),ComputePointSize:this._getVSComputePointSize()},r={ComputeDiscard:this._getFSComputeDiscard(),ComputeAlbedo:["vec3 ComputeAlbedo() {","  return v4_color.rgb;","}"].join("\n"),ComputeEmissive:["vec3 ComputeEmissive() {","  return vec3(0.0);","}"].join("\n"),ComputeOpacity:["float ComputeOpacity() {","  return v4_color.a;","}"].join("\n"),ComputeSpecularColor:["vec3 ComputeSpecularColor() {","  return v4_color.rgb;","}"].join("\n"),ComputeViewNormal:this._getFSComputeViewNormal()};this._getFSProcessFinalColor()&&(r.ProcessFinalColor=this._getFSProcessFinalColor()),e.material.setPDSFXOverridableFunctions(o,r)}}})}),define("DS/SMAMpwPDSFX/SMAMpwFrontBackTranslucent",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t,o){"use strict";var r=t.singleton({init:function(){this._parent()},initMaterial:function(e){if(e){e.material=new o.MeshPhongMaterial({opacity:.01}),e.material.activatePDSFX();e.material.setPDSFXGlobalShaderCode("","vec4 gv4_color;"),e.material.setPDSFXVaryings({v2_Tex:{type:"v2"}}),e.material.setPDSFXUniforms({ColorMap:{type:"t2",value:e.parameters.TextureName.map},HasTexture:{type:"f",value:e.parameters.HasTexture},BackColor:{type:"v4",value:new o.Vector4(e.parameters.BackColor[0],e.parameters.BackColor[1],e.parameters.BackColor[2],e.parameters.BackColor[3])},FrontColor:{type:"v4",value:new o.Vector4(e.parameters.FrontColor[0],e.parameters.FrontColor[1],e.parameters.FrontColor[2],e.parameters.FrontColor[3])},ShowBackColor:{type:"f",value:e.parameters.ShowBackColor}});var t={ComputeVaryingValues:["void ComputeVaryingValues() {","  vec2 v2TexCoord = vec2(0.0);","  // Save texture coordinate for the result value","  float fDim = HasTexture;","  if (0.0 != fDim)","    v2TexCoord = vGetAttribTexCoord0().xy;","  v2_Tex = v2TexCoord;","}"].join("\n")},r={ComputeCommonValues:["void ComputeCommonValues() {","  if (vIsFrontFacing())","    gv4_color = FrontColor;","  else","    gv4_color = BackColor;","  if (HasTexture != 0.0)","    gv4_color = texture2D(ColorMap, v2_Tex);","}"].join("\n"),ComputeAlbedo:["vec3 ComputeAlbedo() {","  return gv4_color.rgb;","}"].join("\n"),ComputeEmissive:["vec3 ComputeEmissive() {","  return vec3(0.0);","}"].join("\n"),ComputeOpacity:["float ComputeOpacity() {","  return gv4_color.a;","}"].join("\n"),ComputeSpecularReflectance:["vec3 ComputeSpecularReflectance() {","  return vec3(0.04) * gv4_color.rgb;","}"].join("\n"),ComputeDiscard:["bool ComputeDiscard() {","  float showBckC = ShowBackColor;","  return (!vIsFrontFacing() && showBckC == 0.0);","}"].join("\n")};e.material.setPDSFXOverridableFunctions(t,r)}}});return e.namespace("DS/SMAMpwPDSFX/SMAMpwFrontBackTranslucent",r)}),define("DS/SMAMpwPDSFX/SMAMpwFrontBack",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS"],function(e,t,o){"use strict";var r=t.singleton({init:function(){this._parent()},initMaterial:function(e){if(e){null===e.material&&(e.material=new o.MeshPhongMaterial),e.material.activatePDSFX();e.material.setPDSFXGlobalShaderCode("","vec4 gv4_color;"),e.material.setPDSFXVaryings({v2_tex:{type:"v2"},v2_texBack:{type:"v2"},f_alpha:{type:"f"}}),e.parameters.ContourMap1D.map.wrapS=o.ClampToEdgeWrapping,e.parameters.ContourMap1D.map.wrapT=o.ClampToEdgeWrapping,e.parameters.ContourMap2D.map.wrapS=o.ClampToEdgeWrapping,e.parameters.ContourMap2D.map.wrapT=o.ClampToEdgeWrapping,e.parameters.ContourMap1D.map.minFilter=o.NearestFilter,e.parameters.ContourMap1D.map.magFilter=o.NearestFilter,e.parameters.ContourMap2D.map.minFilter=o.NearestFilter,e.parameters.ContourMap2D.map.magFilter=o.NearestFilter,e.material.setPDSFXUniforms({ContourMap1D:{type:"t2",value:e.parameters.ContourMap1D.map},ContourMap2D:{type:"t2",value:e.parameters.ContourMap2D.map},NoResultScale:{type:"f",value:e.parameters.NoResultScale},ResultScale:{type:"f",value:e.parameters.ResultScale},ResultShift:{type:"f",value:e.parameters.ResultShift},ResultsDim:{type:"f",value:e.parameters.ResultsDim},FrontBack:{type:"f",value:e.parameters.FrontBack}});var t={ComputeVaryingValues:["void ComputeVaryingValues() {","  vec2 v2TexCoord = vec2(0.0);","  vec2 v2TexCoordBack = vec2(0.0);","  // Save texture coordinate for the result value","  float fDim = ResultsDim;","  if (0.0 != fDim) {","    v2TexCoord = vGetAttribTexCoord0().xy;","    v2TexCoord.x = v2TexCoord.x * ResultScale + ResultShift;","    if ( 4.0 <= fDim )","       v2TexCoord.x = fract(v2TexCoord.x);","    v2TexCoord.y *= NoResultScale; // = clamp(v2TexCoord.y, 0.0, 1.0);","    v2TexCoordBack = v2TexCoord;","    if( 0.0 < FrontBack ) {","       v2TexCoordBack = vGetAttribTexCoord1().xy;","       v2TexCoordBack.x = v2TexCoordBack.x * ResultScale + ResultShift;","       if ( 4.0 <= fDim )","   \t    v2TexCoordBack.x = fract(v2TexCoordBack.x);","       v2TexCoordBack.y *= NoResultScale; // = clamp(v2TexCoordBack.y, 0.0, 1.0);","    }","  }","  v2_tex     = v2TexCoord;","  v2_texBack = v2TexCoordBack;","  f_alpha    = 1.0 - vGetAttribTangent().x;","}"].join("\n")},r={ComputeCommonValues:["void ComputeCommonValues() {","  vec2 v2_texVal = v2_tex;","  if ( ! vIsFrontFacing() )","    v2_texVal = v2_texBack;","  v2_texVal.x = clamp(v2_texVal.x, 0.0, 1.0);","  gv4_color = vec4(1.0);","  if ( 1.0 == ResultsDim || 5.0 == ResultsDim )","    gv4_color = texture2D(ContourMap1D, vec2(v2_texVal.x, 0.0) );","  else if ( 2.0 == ResultsDim || 6.0 == ResultsDim )","    gv4_color = texture2D(ContourMap2D, v2_texVal);","  gv4_color.a *= f_alpha;","}"].join("\n"),ComputeAlbedo:["vec3 ComputeAlbedo() {","  return gv4_color.rgb;","}"].join("\n"),ComputeOpacity:["float ComputeOpacity() {","  return gv4_color.a;","}"].join("\n"),ComputeSpecularReflectance:["vec3 ComputeSpecularReflectance() {","  return gv4_color.rgb * 0.4;","}"].join("\n")};e.material.setPDSFXOverridableFunctions(t,r)}}});return e.namespace("DS/SMAMpwPDSFX/SMAMpwFrontBack",r)}),define("DS/SMAMpwPDSFX/SMAMpwNodes",["DS/SMAMpwPDSFX/SMAMpwNodesAbstract"],function(e){"use strict";return e.singleton({init:function(){this._parent()}})}),define("DS/SMAMpwPDSFX/SMAMpwNodesDepth",["DS/SMAMpwPDSFX/SMAMpwNodesAbstract"],function(e){"use strict";return e.singleton({_getVSComputePointSize:function(){return["float ComputePointSize() {","  vec4 v4ProjectedPosition = vGetViewProjectionMatrix() * v4_WorldViewPosition;","  f_Size = PointSpriteSize / ((vGetViewProjectionMatrix()[0][0] / v4ProjectedPosition.w) * float(vGetViewportSize().x));","  return PointSpriteSize;","}"].join("\n")},_getFSProcessFinalColor:function(){return["void ProcessFinalColor(inout vec4 ioFinalColor) {","  vec3 v3SpherePosition = v4_WorldViewPosition.xyz + gv3_Normal * f_Size;","  vec4 v4ProjSpherePosition = vGetProjectionMatrix() * vec4(v3SpherePosition, 1.0);","  v4ProjSpherePosition /= v4ProjSpherePosition.w;","  vSetFragDepth(v4ProjSpherePosition.z*0.5 + 0.5);","  ioFinalColor.rgb = ioFinalColor.rgb * gv3_Normal.z;","}"].join("\n")},init:function(){this._parent()}})}),define("DS/SMAMpwPDSFX/SMAMpwPtSym",["DS/SMAMpwPDSFX/SMAMpwNodesAbstract"],function(e){"use strict";return e.singleton({_getUniforms:function(e){var t=this._parent(e);return t.PointLineWidth={type:"f",value:e.parameters.PointLineWidth},t},_getFSComputeDiscard:function(){return["bool ComputeDiscard() {","  bool toDiscard = false;","  vec2 n = vGetPointCoord() * 2.0 - 1.0;","  if (PointSymbol == 3.0 || PointSymbol == 4.0 || PointSymbol == 10.0 || PointSymbol == 12.0) {","\t   float fMag = dot(n, n);","    toDiscard = ( (PointSymbol == 3.0)\t/*CONCENTRIC*/ &&","                (abs(fMag - 0.7) >= 0.35) )","           || ( (PointSymbol == 4.0)  /*COINCIDENT*/ &&","                (abs(fMag - 0.75) >= PointLineWidth) && (abs(fMag - 0.2) >= 0.10) )","           || ( (PointSymbol == 10.0) /*FULLCIRCLE*/ &&","\t\t             (fMag > 0.65) )","           || ( (PointSymbol == 12.0) /*FULLCIRCLE2*/ &&","\t\t             (fMag > 1.0) );","  } else {","    toDiscard = ( (PointSymbol == 1.0 ) /*CROSS*/ &&","                (abs(n.x - n.y) >= PointLineWidth) && (abs(n.x + n.y) >= PointLineWidth) )","           || ( (PointSymbol == 2.0) /*PLUS*/ &&","                (abs(n.x) >= PointLineWidth) && (abs(n.y) >= PointLineWidth) )","           || ( (PointSymbol == 7.0) /*STAR*/ &&","                (abs(n.x - n.y) >= PointLineWidth) &&","                (abs(n.x + n.y) >= PointLineWidth) &&","                (abs(n.x) >= 0.18) && (abs(n.y) >= 0.18) )","           || ( (PointSymbol == 11.0) /*FULLSQUARE*/ &&","                ( abs(n.x) > 0.7 || abs(n.y) > 0.7 ) );","  }","  return toDiscard;","}"].join("\n")},_getFSComputeViewNormal:function(){return["vec3 ComputeViewNormal() {","  return vec3(0.0, 1.0, 0.0);","}"].join("\n")},_getFSProcessFinalColor:function(){},init:function(){this._parent(),this._MaterialOptions.lights=!1}})}),define("DS/SMAMpwPDSFX/SMAMpwShaderFactory",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/MaterialManager","DS/SMAMpwPDSFX/SMAMpwFrontBack","DS/SMAMpwPDSFX/SMAMpwFrontBackTranslucent","DS/SMAMpwPDSFX/SMAMpwNodes","DS/SMAMpwPDSFX/SMAMpwNodesDepth","DS/SMAMpwPDSFX/SMAMpwPtSym"],function(e,t,o,r,a,i,n,l,s){"use strict";var p=t.singleton({init:function(){this._parent()},registerOnPDSFXMaterial:function(){(new r).onPDSFXMaterial(function(e){var t;switch(e.name){case"SMAHvcFrontBack":t=a;break;case"SMAMpaFrontBackTranslucent":t=i;break;case"SMAHvcPtSym":t=s;break;case"SMAHvcNodes":t=n;break;case"SMAHvcNodesDepth":t=l;break;default:0===e.name.indexOf("SMAHvc")&&(e.material=new o.MeshPhongMaterial({color:16777215}))}t&&t.initMaterial(e)})}});return e.namespace("DS/SMAMpwPDSFX/SMAMpwShaderFactory",p)});