define("DS/VCXWebModifiables/VCXModifiableServer",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._HashTableModifiable={},this._maxID=0},unInitialize:function(){this._HashTableModifiable={},this._maxID=0},GetHashTable:function(){return this._HashTableModifiable},AddModifiable:function(e){var t=e.GetHashing();if(t){if(this._HashTableModifiable[t])return;var r=parseInt(t,16);r&&r>this._maxID&&(console.log("HASHING : update max ID, we should not go here anymore"),this._maxID=r)}else t=(this._maxID+1).toString(16),e.SetHashing(t),this._maxID++;this._HashTableModifiable[t]=e},RemoveModifiable:function(e){delete this._HashTableModifiable[e]},GetModifiableFromHashing:function(e){var t=this._HashTableModifiable[e];return void 0===t?null:t}})}),define("DS/VCXWebModifiables/VCXIModifiableView",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXIModifiableView",required:{getPropertyGroups:function(){},getGroupPropertiesOrders:function(){},getCollapsedGroupsNames:function(){},getTranslatedProperty:function(){}},getAdditionalPropertySettings:function(){},optional:{}})}),define("DS/VCXWebModifiables/VCXAModifiableFormatPainter",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._parent()},getPropertiesFormatPainter:function(){return[]}})}),define("DS/VCXWebModifiables/VCXLinkedPropertyManager",["DS/CoreEvents/Events","UWA/Class","DS/VCXWebProperties/VCXColor"],function(e,t,r){"use strict";var i=t.extend({init:function(){this._links={},this._invertedlinks={},this._isInFollow=!1},initialize:function(){},unInitialize:function(){this._links={},this._invertedlinks={},this._isInFollow=!1},AddLink:function(t,r,i,n,o){var a=this._links[t];a||(this._links[t]=a={});var s=a[r];s||(a[r]=s={});var l=s[i];l||(s[i]=l={});var p=l[n];p||(l[n]=p={}),l[n]=p=o;var f=this._invertedlinks[i];f||(this._invertedlinks[i]=f={}),f[n]=!0,e.publish({event:"VCX_LINKS_ADDED"})},RemoveLink:function(e,t,r,i){var n,o=this._links[e];if(o){var a=o[t];if(a){var s=a[r];if(s&&void 0!==(n=s[i])){delete s[i],0==Object.keys(a[r]).length&&(delete a[r],0==Object.keys(o[t]).length&&(delete o[t],0==Object.keys(this._links[e]).length&&delete this._links[e]));var l=this._invertedlinks[r];l&&l[i]&&(delete l[i],0==Object.keys(this._invertedlinks[r]).length&&delete this._invertedlinks[r])}}}return n},RemoveLinks:function(t){for(var r=0;r<t.length;r++)this.RemoveLink(t[r].inID,t[r].inProp,t[r].outID,t[r].outProp);e.publish({event:"VCX_LINKS_REMOVED"})},GetLinksFromPropertyName:function(e,t){var r=[];for(var i in this._links)if(this._links.hasOwnProperty(i)){var n=this._links[i];if(n)for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];if(a)for(var s=0;s<t.length;s++){var l=t[s];if(a.hasOwnProperty(l))if(a[l].hasOwnProperty(e)){var p={inID:i,inProp:o,outID:l,outProp:e};r.push(p)}}}}return r},IsLinkedAndNotInFollow:function(e,t){if(!0===this._isInFollow)return!1;var r=this._invertedlinks[e];return!(!r||!r[t])},Follow:function(e,t,i){var n=this._experienceBase.ComponentsMap,o=this._isInFollow;this._isInFollow=!0;var a=this._links[e];if(a){var s=a[t];if(s)for(var l in s)if(s.hasOwnProperty(l)){var p=n.GetComponentFromID(l);if(p){var f=p.QueryInterface("VCXIModifiable");if(f){var u=s[l];for(var d in u)if(u.hasOwnProperty(d)){var y=f.GetProperty(d);if(y){var c=y.GetPropertyValue().GetType();if(i.GetType()===c)f.OnChangeProperty(d,i);else if("VCXPropertyValueInt"!==i.GetType()&&"VCXPropertyValueFloat"!==i.GetType()||"VCXPropertyValueColor"!==c){var h=i.ToString();y.GetPropertyValue().FromString(h),f.OnChangeProperty(d,y.GetPropertyValue())}else{var b,P,G=100-100*i.GetValue()/100;G<0&&(G=0),G>99?(b=255,P=0):G<50?(b=Math.floor(G/50*255),P=255):(b=255,P=Math.floor((50-G%50)/50*255)),0;var M=new r;M.SetRGBA(b/255,P/255,0,1),y.GetPropertyValue().SetValue(M),f.OnChangeProperty(d,y.GetPropertyValue())}f.OnChangePropertiesEnd()}}}}}}this._isInFollow=o},UpdateProperties:function(){var e=this._experienceBase.ComponentsMap;for(var t in this._links){var r=e.GetComponentFromID(t);if(r){var i=r.QueryInterface("VCXIModifiable");if(i&&this._links.hasOwnProperty(t)){var n=this._links[t];if(n)for(var o in n){var a=i.GetProperty(o).GetPropertyValue();this.Follow(t,o,a)}}}}}});return Object.defineProperty(i.prototype,"componentType",{enumerable:!0,get:function(){return"VCXLinkedPropertyManager"}}),i}),define("DS/VCXWebModifiables/VCXMetaPropertyDef",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e,t){this._propertyInfo=e,this._strType=t,this._strDefaultLabel=null},SetDefaultLabel:function(e){e&&(this._strDefaultLabel=e)},GetDefaultLabel:function(){return this._strDefaultLabel},SetPropertyInfo:function(e){this._propertyInfo=e},GetPropertyInfo:function(){return this._propertyInfo},SetType:function(e){this._strType=e},GetType:function(){return this._strType}})}),define("DS/VCXWebModifiables/VCXIModifiableFormatPainter",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXIModifiableFormatPainter",required:{getPropertiesFormatPainter:function(){}},optional:{}})}),define("DS/VCXWebModifiables/VCXAModifiableView",["UWA/Class","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t){"use strict";return e.extend({init:function(){},getTranslatedProperty:function(e){let r={},i=e.group;i||(i=e.groupName&&this.getPropertyGroups()[e.groupName]);let n=e.propertyName;if(!n||"string"==typeof n){let t=this.QueryInterface("VCXIModifiable");n=e.propertyName&&t.GetProperty(e.propertyName)}let o,a,s,l=n&&n.GetPropertyInfo();if(i&&i.i18nGroup&&(o=i.i18nGroup),l&&l.Geti18n()&&(a=l.Geti18n()),l&&"Modifiable.Style"===l.GetPropertyName()&&(s=t),i&&(r.groupName=o&&o[i.getName()],r.groupName||(l&&l.Geti18n()?r.groupName=l.Geti18n()[i.getName()]:(console.warn("Group '"+i.getName()+"' 's translation not found in "),r.groupName=null))),n){o&&a&&o===a&&(r.propertyName=o[n.GetPropertyInfo().GetNLSID()]),o&&a&&o!==a&&(r.propertyName=a[n.GetPropertyInfo().GetNLSID()]),o&&o[n.GetPropertyInfo().GetNLSID()]&&(r.propertyName=o[n.GetPropertyInfo().GetNLSID()]),a&&a[n.GetPropertyInfo().GetNLSID()]&&(r.propertyName=a[n.GetPropertyInfo().GetNLSID()]),r.propertyName||(console.warn("Property '"+n.GetPropertyInfo().GetNLSID()+"' 's translation not found in "),r.propertyName=n.GetPropertyInfo().GetNLSID());let e=l&&l.GetMapChoiceEnum&&l.GetMapChoiceEnum();if(e){r.choice={};for(let t in e)a&&a[e[t]]&&(r.choice[t]=a[e[t]]),!r.choice[t]&&o&&o[e[t]]&&(r.choice[t]=o[e[t]]),!r.choice[t]&&s&&s[e[t]]&&(r.choice[t]=s[e[t]]),r.choice||console.warn(e[t]+" 's translation not found in i18nGroup file "+o+", neither in i18nProperty file "+a)}}return r},getAdditionalPropertySettings:function(){return this._parent()||{}}})}),define("DS/VCXWebModifiables/VCXEnumTools",["UWA/Class"],function(e){"use strict";var t=e.singleton({init:function(){}});return t.generateMapChoiceFromEnumAndId=function(e,t,r){var i={},n=Array.isArray(r)&&r;for(var o in e)if(e.hasOwnProperty(o)){if(n&&n.includes(o))continue;var a=t?t+".":"";i[e[o]]=a+o}return i},t}),define("DS/VCXWebModifiables/VCXMetaPropertyManager",["UWA/Class"],function(e){"use strict";var t=e.extend({init:function(){this._MetaPropertyDef={}},initialize:function(){},unInitialize:function(){this._MetaPropertyDef={}},AddMetaPropertyDef:function(e){var t=e.GetPropertyInfo().GetPropertyName();this._MetaPropertyDef[t]=e},GetMetaPropertyDef:function(e){return this._MetaPropertyDef[e]}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXMetaPropertyManager"}}),t}),define("DS/VCXWebModifiables/VCXIModifiable",["DS/WebComponentModeler/CATWebInterface"],function(e){"use strict";return e.singleton({interfaceName:"VCXIModifiable",required:{SetHashing:function(e){},GetHashing:function(){},OnChangeProperty:function(e,t){},OnChangePropertiesEnd:function(){},GetInterpolator:function(e){},GetProperty:function(e){},GetProperties:function(e){},GetModifiedProperties:function(){},RequestModification:function(e){},GetRequiredPropertiesForTransition:function(){},IsLiving:function(){}},optional:{}})}),define("DS/VCXWebModifiables/VCXModelChangeListener",["UWA/Class"],function(e){"use strict";var t=e.extend({initialize:function(){this._changesFlag=-1},unInitialize:function(){},hasChanged:function(e,t){return t&&(this._changesFlag|=e),this._changesFlag&e},postUpdate:function(e){this._parent(e),this._changesFlag=0}});return Object.defineProperty(t.prototype,"componentType",{enumerable:!0,get:function(){return"VCXModelChangeListener"}}),t.FChangeFlag={BomID:1,Visibility:2,DressupVisibility:4},t}),define("DS/VCXWebModifiables/VCXModifiableView",["DS/VCXWebModifiables/VCXAModifiableView","DS/VCXWebProperties/VCXPropertyGroup","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r){"use strict";return e.extend({init:function(){},getPropertyGroups:function(e){e||(e={});var i=this.getGroupPropertiesOrders();e["Group.Essentials"]||(e["Group.Essentials"]=new t({groupID:"Group.Essentials"}),e["Group.Essentials"].i18nGroup=r),e["Group.Essentials"].setPropertiesOrder(i["Group.Essentials"]),e["Group.Essentials"].priority=0;var n=this.GetObject().GetType();if("VCXComponentStyle"!==n){var o=this.GetObject()._experienceBase.getManager("VCXStylesManager");if(o){var a=o.stylesForType[n];Array.isArray(a)&&a.length>0&&e["Group.Essentials"].addProperty({propertyName:"Modifiable.Style",i18n:r})}}if(this.GetObject()._experienceBase.ModifiablesAdvancedProperties&&(e["Group.Introspection"]||(e["Group.Introspection"]=new t({groupID:"Group.Introspection"}),e["Group.Introspection"].i18nGroup=r),e["Group.Introspection"].setPropertiesOrder(i["Group.Introspection"]),e["Group.Introspection"].priority=90,e["Group.Introspection"].addProperties([{propertyName:"Modifiable.ID",i18n:r},{propertyName:"Modifiable.Type",i18n:r},{propertyName:"Modifiable.Hashing",i18n:r},{propertyName:"Modifiable.Level",i18n:r},{propertyName:"Modifiable.HasChildren",i18n:r}])),this.GetObject().QueryInterface("VCXIModifiable")._metaPropSet){var s=[];if(this.GetObject().QueryInterface("VCXIModifiable")._metaPropSet.GetListPropertyNames(s),0!==s.length){var l=this.GetObject().QueryInterface("VCXIModifiable")._metaPropSet.GetProperty(s[0]);l||console.log("Missing first of the meta properties...");var p=l.GetPropertyInfo();let r=p.Geti18nGroup();e["Group.UserProperties"]||(e["Group.UserProperties"]=new t({groupID:"Group.UserProperties"}),e["Group.UserProperties"].i18nGroup=r,e["Group.UserProperties"].priority=5);for(var f=0;f<s.length;++f){var u=s[f];let t=(p=(l=this.GetObject().QueryInterface("VCXIModifiable")._metaPropSet.GetProperty(u)).GetPropertyInfo()).Geti18n();e["Group.UserProperties"].addProperty({propertyName:u,i18n:t})}}}return e},getGroupPropertiesOrders:function(){return{"Group.Essentials":["Modifiable.Style"],"Group.Introspection":["Modifiable.ID","Modifiable.Type","Modifiable.Hashing","Modifiable.Level","Modifiable.HasChildren"]}},getCollapsedGroupsNames:function(){return[]}})}),define("DS/VCXWebModifiables/VCXModifiable",["UWA/Class","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyGroup","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXPropertyGroupSet","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebVisibility/VCXIVisibility","DS/VCXWebProperties/VCXPropertyInfoEnum","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebModifiables/VCXEnumTools","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r,i,n,o,a,s,l,p,f,u,d,y){"use strict";var c=e.extend({init:function(){this._metaPropSet=null,this._scenarioManager=null,this._linkedPropertyManager=null,this._styleID=""},GetMetaProperties:function(e){this._metaPropSet&&e.Merge(this._metaPropSet)},Build:function(){var e=this.GetObject();e._experienceBase&&e._experienceBase.getManager("VCXScenarioManager")&&e._experienceBase.getManager("VCXScenarioManager").ModifiableServer.AddModifiable(this)},GetType:function(){return"VCXModifiable"},SetHashing:function(e){this._hashing=e},GetHashing:function(){return this._hashing},SetStyle:function(e){if(!0!==c.prototype.bInCriticalSectionOnChangePropertyStyle){if(c.prototype.bInCriticalSectionOnChangePropertyStyle=!0,"VCXComponentStyle"!==this.GetObject().GetType()){var t=this.GetObject()._experienceBase.getManager("VCXStylesManager");return t?e!=this._styleID&&(t.UnSubscribe(this,this._styleID),this._styleID=e,t.Subscribe(this,this._styleID)):this._styleID="",c.prototype.bInCriticalSectionOnChangePropertyStyle=!1,!0}c.prototype.bInCriticalSectionOnChangePropertyStyle=!1}return!1},OnChangeProperty:function(e,r){if("Modifiable.StyleID"===e){var i=r.GetValue();return this.SetStyle(i)}if("Modifiable.Style"===e)return!0;if("Meta."===e.slice(0,5)){null===this._metaPropSet&&(this._metaPropSet=new n);var o=this._metaPropSet.GetProperty(e);if(o)return o.SetPropertyValue(r.Clone()),!0;var a=this.GetObject()._experienceBase.getManager("VCXMetaPropertyManager").GetMetaPropertyDef(e);if(a){var s=new t(a.GetPropertyInfo().Clone(),r.Clone());return this._metaPropSet.AddOrModifyProperty(s),!0}return!1}return!1},OnChangePropertiesEnd:function(){},GetInterpolator:function(e){return null},GetProperty:function(e){var r=null;if("Modifiable."===e.slice(0,11)){if("Modifiable.ID"===e)(P=new a).SetValue(this.GetObject().GetID()),(C=new i(e,1,!1,y)).SetGroupId("Group.Introspection"),r=new t(C,P);else if("Modifiable.Type"===e){(P=new a).SetValue(this.GetObject().GetType()),(C=new i(e,1,!1,y)).SetGroupId("Group.Introspection"),r=new t(C,P)}else if("Modifiable.Hashing"===e){(P=new a).SetValue(this.GetHashing()),(C=new i(e,1,!1,y)).SetGroupId("Group.Introspection"),r=new t(C,P)}else if("Modifiable.Level"===e){var n=-1;if((d=this.GetObject()).IsKindOf("VCXWebComponentOccurrence")&&!d.IsDressup)do{if(n++,!(c=d.QueryInterface("VCXIModelNavigable")))break;var o=c.getParent();if(!o)break;d=o.GetObject()}while(null!==d);var p=new s;p.SetValue(n),(C=new i(e,1,!1,y)).SetGroupId("Group.Introspection"),r=new t(C,p)}else if("Modifiable.HasChildren"===e){var d,c,h=!1;if((d=this.GetObject()).IsKindOf("VCXWebComponentOccurrence")&&!d.IsDressup)(c=d.QueryInterface("VCXIModelNavigable"))&&(h=c.getChildren().length>0);var b=new l;b.SetValue(h),(C=new i(e,1,!1,y)).SetGroupId("Group.Introspection"),r=new t(C,b)}else if("Modifiable.StyleID"===e){var P;if("VCXComponentStyle"!==this.GetObject().GetType())(P=new a).SetValue(this._styleID),(C=new i(e,i.EBehaviorType.NotAnimable,!0,y)).SetVisible(!1),r=new t(C,P)}else if("Modifiable.Style"===e){var G=this.GetObject().GetType();if("VCXComponentStyle"!==G){var M=new u,C=new f(e,i.EBehaviorType.Singleton,!1,y),I=0,g=this.GetObject();if(g._experienceBase){var V=g._experienceBase.getManager("VCXStylesManager");if(V){var S=0;C.AddOrModifyChoice(0,"styleID_NoStyle");var _=V.stylesForType[G];if(_){for(var v=0;v<_.length;v++){var m=_[v];(this._styleID==m||V._stylesVisibility[m])&&(S=V._stylesIntegerID[m],C.AddOrModifyChoice(S,m),I++)}S=""!=this._styleID?V._stylesIntegerID[this._styleID]:0}M.SetValue(S)}}0===I&&C.SetVisible(!1),r=new t(C,M)}}}else if("Meta."===e.slice(0,5)&&this._metaPropSet){var D=this._metaPropSet.GetProperty(e);D&&(r=D.Clone())}return r},GetProperties:function(e){var t=new n;return this.GetMetaProperties(t),this.GetObject()._experienceBase.ModifiablesAdvancedProperties&&(t.AddOrModifyProperty(this.GetProperty("Modifiable.ID")),t.AddOrModifyProperty(this.GetProperty("Modifiable.Type")),t.AddOrModifyProperty(this.GetProperty("Modifiable.Hashing")),t.AddOrModifyProperty(this.GetProperty("Modifiable.Level")),t.AddOrModifyProperty(this.GetProperty("Modifiable.HasChildren"))),"VCXComponentStyle"!==this.GetObject().GetType()&&(t.AddOrModifyProperty(this.GetProperty("Modifiable.StyleID")),t.AddOrModifyProperty(this.GetProperty("Modifiable.Style"))),t},RequestModification:function(e){var r=new n;if(e)if("Modifiable.Style"===e.GetPropertyInfo().GetPropertyName()){var o=e.GetPropertyValue().GetValue(),s=this.GetObject()._experienceBase.getManager("VCXStylesManager");if(s){var l="";0===o?l="":s._styles[o]&&(l=s._styles[o].GetID());var p=new a;p.SetValue(l);var f=new i("Modifiable.StyleID",i.EBehaviorType.NotAnimable,!0,y),u=new t(f,p);r.AddOrModifyProperty(u)}}else r.AddOrModifyProperty(e);return r},GetRequiredPropertiesForTransition:function(){return null},GetModifiedProperties:function(){return this._modifiedProperties},OnChangePropertyBegin:function(e,t){var r=this.GetObject(),i=this.GetHashing();if(this._scenarioManager||(this._scenarioManager=r._experienceBase.getManager("VCXScenarioManager")),this._scenarioManager.AddPropertyToRestoreSet(i,e),this._modifiedProperties||(this._modifiedProperties={}),this._modifiedProperties[e]=!0,this._linkedPropertyManager||(this._linkedPropertyManager=r._experienceBase.getManager("VCXLinkedPropertyManager")),this._linkedPropertyManager){if(this._linkedPropertyManager.IsLinkedAndNotInFollow(r.GetID(),e)){var n=r.QueryInterface("VCXIPulseBehavior");return!n||!n.GetIsPulsing()}this._linkedPropertyManager.Follow(r.GetID(),e,t)}return!1},IsLiving:function(){return!0},_generateMapChoiceFromEnumAndId:function(e,t,r){return d.generateMapChoiceFromEnumAndId(e,t,r)}});return c});