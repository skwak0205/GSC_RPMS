define("DS/MPFModel/ModelValidator",["UWA/Core","UWA/Class","UWA/Class/Model","DS/MPFServices/ObjectService","DS/MPFError/BadArgumentError","DS/MPFConstraintModel/ConstraintModel","DS/MPFDataProxy/NoDataProxy"],function(e,t,r,i,n,s,o){"use strict";var a,c={};return c.REQUIRED="required",c.INVALID="invalid",(a=t.extend({init:function(e){i.requiredOfPrototype(e.model,r,"options.model must be a UWA/Model"),this.model=e.model,this.keyAttribute=e.keyAttribute,e.model.constraints&&e.model.constraints.size&&e.model.constraints.size()>0&&(this.keyAttribute||this.model.constraints.first().idAttribute?this.constraints=this.model.constraints:console.warn("No idAttribute for model found and no keyAttribute defined - constraints cannot be used!")),this.validations={},e.validations&&this._registerValidations(e.validations)},validate:function(t){this.constraints&&this._updateConstraints(t);var r=[];if(e.is(t,"string"))this._validateAttribute(t,this.model.get(t),r);else if(Array.isArray(t))for(var i=0;i<t.length;i++)e.is(t[i],"string")&&this._validateAttribute(t[i],this.model.get(t[i]),r);else if(e.is(t,"object"))for(var n=Object.keys(t),s=0;s<n.length;s++)this._validateAttribute(n[s],t[n[s]],r);else for(var o=Object.keys(this.validations),a=0;a<o.length;++a)this._validateAttribute(o[a],this.model.get(o[a]),r);if(r.length>0)return r},_validateAttribute:function(t,r,i){var n=this.validations[t];if(Array.isArray(n))for(var s=0;s<n.length;s++){var o=n[s];if(this._checkConditions(o.getConditions())){var a=e.is(r,"string")&&""===r.trim();o.isRequired()&&(!e.is(r)||o.isString()&&a)?i.push(this._getValidationError(c.REQUIRED,o)):!e.is(r)||a||o.isCorrectType(r)&&o.patternIsFoundIn(r)||i.push(this._getValidationError(c.INVALID,o))}}},_checkConditions:function(e){for(var t=0;t<e.length;t++){var r=e[t];if(Array.isArray(r)&&r.length>=2)if(r.length>2&&!0===r[2]){if(this.model.get(r[0])===r[1])return!1}else if(this.model.get(r[0])!==r[1])return!1}return!0},_getValidationError:function(t,r){var i={field:r.getAttribute(),errorType:t};if(t===c.REQUIRED){var n=r.getRequiredError();e.is(n)?i.message=n:(console.warn('No "required" error message defined for attribute "'+i.field+'"!'),i.message=i.field+" is required")}else if(t===c.INVALID){var s=r.getInvalidError();e.is(s)?i.message=s:(console.warn('No "invalid" error message defined for attribute "'+i.field+'"!'),i.message=i.field+" is invalid")}return i},_updateConstraints:function(t){var r,i=this.keyAttribute||this.constraints.first().idAttribute;if(e.is(t,"object")&&t[i]?r=this.constraints.get(t[i])?this.constraints.get(t[i]):this.constraints.get("DEFAULT"):this.model.has(i)?r=this.constraints.get(this.model.get(i))?this.constraints.get(this.model.get(i)):this.constraints.get("DEFAULT"):(r=this.constraints.get("DEFAULT"),console.warn("Model does not have the key attribute corresponding to the idAttribute defined in the constraints -> default used for validation")),this._deleteReplaceableConstraints(),e.is(r,"object"))for(var n=r.keys(),s=0;s<n.length;s++){var o=n[s],a=r.get(o);if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addConstraintModel(a[c],!0);else this._addConstraintModel(a,!0)}},_deleteReplaceableConstraints:function(){for(var e=Object.keys(this.validations),t=0;t<e.length;t++){var r=e[t],i=this.validations[r];if(Array.isArray(i)&&i.length>0)for(var n=i.length-1;n>=0;n--)i[n].isReplaceable&&i.splice(n,1)}},_addConstraintModel:function(e,t){if(s.prototype.isPrototypeOf(e)){e.isReplaceable=!0===t;var r=e.getAttribute();Array.isArray(this.validations[r])?this.validations[r].push(e):this.validations[r]=[e]}},_registerValidations:function(t){for(var r=0;r<t.length;r++){var i=t[r];if(e.is(i[s.Fields.ATTRIBUTE])){var n=new s(i,{dataProxy:o.getInstance()});this._addConstraintModel(n)}}}})).ErrorTypes=Object.freeze(c),a}),define("DS/MPFModel/CollectionFetchOptions",[],()=>{"use strict";return Object.freeze({START:"start",SIZE:"size",SEARCH:"search",COMPANY:"company",ONLINEINSTANCE:"online-instance"})}),define("DS/MPFModel/ModelChangeTracker",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({init:function(){this.changes={}},track:function(t){if(!e.is(t,"object"))throw new Error("change must be an object");e.extend(this.changes,t)},getChanges:function(){return e.clone(this.changes)},isEmpty:function(){var e;for(e in this.changes)if(this.changes.hasOwnProperty(e))return!1;return!0},reset:function(){this.changes={}}})}),define("DS/MPFModel/ModelCache",["UWA/Class"],function(e){"use strict";return e.singleton({init:function(){this._cache={}},has:function(e){var t,r;return!1,"string"===(t=typeof e)||"number"===t?r=e:"object"===t&&(r=e.id),this._cache.hasOwnProperty(r)},add:function(e){var t,r,i,n;return t=!1,i=e._type||"global",this._cache.hasOwnProperty(i)||(this._cache[i]={}),r=this._cache[i],(n=e.id)&&(r.hasOwnProperty(n)?r[n].lastAccess=(new Date).toISOString():(r[n]=this._createCacheEntry(e),t=!0)),t},get:function(e,t){var r,i;return e||(e="global"),this._cache.hasOwnProperty(e)&&(i=this._cache[e]).hasOwnProperty(t)&&(r=i[t].model),r},remove:function(e,t){var r,i;return e||(e="global"),this._cache.hasOwnProperty(e)&&(i=this._cache[e],r=this.get(e,t),delete i[t]),r},clear:function(){this._cache={}},_createCacheEntry:function(e){var t;return{created:t=(new Date).toISOString(),lastAccess:t,model:e}}})}),define("DS/MPFModel/MPFCollection",["UWA/Core","UWA/Promise","UWA/Class/Collection","DS/MPFError/BadArgumentError","DS/MPFUtils/MPFUtils"],(e,t,r,i,n)=>{"use strict";return r.extend({setup(t,r){if(!e.is(r))throw new Error("options object param is required");if(!e.is(r.dataProxy))throw new Error("options.dataProxy param is required");this._parent(t,r),this.dataProxy=r.dataProxy,this.modelDataProxy=r.modelDataProxy||r.dataProxy,this.parentResourceId=r.parentResourceId||null,this.cache=r.cache,this.isFetching=!1,this.lastOptionsHash=0},sync(e,t,r){return(r=r||{}).url=this.dataProxy.url(t,e,r),r.ajax=this.dataProxy.request.bind(this.dataProxy),r.isCollectionSyncOperation=!0,this._parent(e,t,r)},fetch(e={}){e.dataProxy=this.dataProxy;const t=e.onComplete;return e.onComplete=function(e,r,i){const n=i&&i.responseHeaders&&i.responseHeaders["MP-Total-Model-Count"];n&&(this.totalModelCount=n),e.forEach(function(e){e.changeTracker.reset()}),t(e,r,i)},this._parent(e)},fetchPromise(e={}){const r=this,i=n.objectHashCode(e);return this.isFetching&&i===this.lastOptionsHash||(this.isFetching=!0,this.lastOptionsHash=i,this.deferredFetch=t.deferred(),e.onComplete=function(){r.isFetching=!1,r.deferredFetch.resolve(r)},e.onFailure=function(e,t,i){r.isFetching=!1,r.deferredFetch.reject({collection:e,response:t,options:i})},this.fetch(e)),this.deferredFetch.promise},getTotalModelCount(){return this.totalModelCount},create(e,t){return(t=t||{}).dataProxy=this.dataProxy,t.cache=this.cache,this._parent(e,t)},setParentResourceId(e){if(!e)throw new i("resourceId must be defined");this.parentResourceId=e},_prepareModel(e,t){let r=!1;return this.cache&&(r=this.cache.get(this.model._type,e.id)),r||(r=this._parent(e,t),this.cache&&this.cache.add(r)),r}})}),define("DS/MPFModel/MPFModel",["UWA/Core","UWA/Promise","UWA/Class/Model","DS/MPFModel/ModelChangeTracker","DS/MPFUtils/MPFUtils","DS/MPFError/BadArgumentError","DS/MPFError/ValidationError"],function(e,t,r,i,n,s,o){"use strict";var a;function c(e,t,r){var i,n,s;for(n in r=!0===r,i={},e)e.hasOwnProperty(n)&&((s=t.get(n))?i[s]=e[n]:r&&(i[n]=e[n]));return i}function h(e){var t,r;for(r in t={},e)e.hasOwnProperty(r)&&null!==e[r]&&(t[r]=e[r]);return t}return(a=r.extend({init:function(t,r){if(!e.is(r))throw new Error("options object param is required");if(!e.is(r.dataProxy))throw new Error("options.dataProxy param is required");return this.cache=r.cache,this.dataProxy=r.dataProxy,this.changeTracker=new i,this._parent(t,r)},setup:function(e,t){var r=this;this._parent(e,t),this.mapper=t.mapper,this.parentResourceId=t.parentResourceId||null,this.listenTo(this,"onSync",function(){r.changeTracker.reset()})},sync:function(e,t,r){var i;return r||(r={}),i=r.dataProxy||this.dataProxy,r.url=i.url(t,e,r),r.ajax=i.request.bind(i),this._parent(e,t,r)},fetch:function(e){var t,r,i,n=this;return e||(e={}),this.cache&&!1!==e.cache?(r=this.cache.get(this.id))?(e&&"function"==typeof e.onComplete&&e.onComplete(r,null,e),t={cancel(){}}):(i=e.onComplete,e.onComplete=function(e,t,r){"function"==typeof i&&(n.cache.add(e,t,r),i(e))},t=this._parent(e)):t=this._parent(e),t},fetchPromise:function(e){var r,i=this;return r=t.deferred(),e||(e={}),e.onComplete=function(){r.resolve(i)},e.onFailure=function(e,t,i){r.reject({model:e,response:t,options:i})},this.fetch(e),r.promise},save:function(t,r,i){var n,s,o=this;return e.is(t)&&"object"!==e.typeOf(t)||(i=r),n=(i=i||{}).onComplete,i.onComplete=function(e,t,r){return o.cache&&!1!==r.cache&&(o.cache.has(e)||o.cache.add(e)),n&&n(e,t,r),o.dispatchEvent("onSave",{ok:!0,model:e,message:"model succesfully saved"})},s=i.onFailure,i.onFailure=function(e,t,r){return s&&s(e,t,r),o.dispatchEvent("onSave",{ok:!1,model:e,message:"unable to save model"})},e.is(r)||(r=i),this._parent(t,r,i)},savePromise:function(r,i,n){var s,a=this;return e.is(r)&&"object"!==e.typeOf(r)||(n=i),s=t.deferred(),n||(n={}),n.onComplete=function(){s.resolve(a)},n.onFailure=function(e,t,r){s.reject({model:e,response:t,options:r})},e.is(i)||(i=n),!1!==this.save(r,i,n)||s.reject({model:this,response:new o("Validation before save failed"),options:n}),s.promise},set:function(t,r,i){var n;return e.is(t,"object")?(n=t,i=r||{}):((n={})[t]=r,i||(i={})),!0!==i.isCollectionSyncOperation&&this.changeTracker.track(n),this._parent(n,i)},getPendingChanges:function(){return this.changeTracker.getChanges()},hasPendingChanges:function(){return!this.changeTracker.isEmpty()},clearPendingChanges:function(){return this.changeTracker.reset()},toJSON:function(e){var t;return t=this._parent(e),h(this.mapper?c(t,this.mapper,!1):this._parent(t))},parse:function(e){return(this.mapper?c(e,this.mapper.inverse(),!0):e)||{}},clone:function(){return new this.constructor(this._attributes,{dataProxy:this.dataProxy,cache:this.cache,mapper:this.mapper})},setParentResourceId:function(e){if(!e)throw new s("resourceId must be defined");this.parentResourceId=e},destroyPromise:function(e){var r,i=this;return r=t.deferred(),e||(e={}),e.onComplete=function(){r.resolve(i)},e.onFailure=r.reject,this.destroy(e),r.promise},validate:n.doNothing})).mapObjectKey=c,a.removeNullAttributes=h,a});