define("DS/MPFContentPublishing/CategoryInput",["UWA/Class/View","DS/UIKIT/Input/Text","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i){"use strict";const s={SAVE:"save",CANCEL:"cancel"},a=t.extend({className:"mpf-category-input",setup(t={}){this.value=t.value||"",this.input=this._createInput()},render(){return this.container.setContent([this.input,{tag:"div",class:"mpf-edit-icons-container",html:[{tag:"span",class:"fonticon fonticon-check mpf-apply-icon",events:{click:this._onConfirm.bind(this)}},{tag:"span",class:"fonticon fonticon-wrong mpf-cancel-icon",events:{click:this._onCancel.bind(this,s.CANCEL)}}]}]),this},setValue(t){return this.input.setValue(t)},getValue(){return this.input.getValue()},destroy(){this._parent(),this.container=null},_onConfirm(){const t=this.input.getValue();t?(this.container.removeClassName("mpf-invalid"),this.dispatchEvent(s.SAVE,t)):this.container.addClassName("mpf-invalid")},_onCancel(){this.container.removeClassName("mpf-invalid"),this.dispatchEvent(s.CANCEL)},_createInput(){return new e({value:this.value,placeholder:i.get("typeACategoryName")})}});return a.Events=Object.freeze(s),a}),define("DS/MPFContentPublishing/MediaHelper",["DS/MPFServices/ObjectService","DS/MPFCmsModel/CmsMediaFactory","DS/MPFCmsModel/CmsMediaModel","DS/MPFCmsModel/ArticleModel"],(t,e,i,s)=>{"use strict";return class{constructor({cmsMediaFactory:i}={}){t.requiredOfPrototype(i,e,"options.cmsMediaModel must be a CmsMediaFactory"),this.cmsMediaFactory=i}filterFiles(t,e){const i=[];for(let s=0;s<t.length;++s){const a=t[s];a.type.includes(e)&&i.push(a)}return i}uploadMedia({article:t,file:s}){const a=new FormData;a.append([i.Fields.COMMUNITY_ID],t.getCommunityId()),a.append([i.Fields.TITLE],s.name),a.append([i.Fields.PUBLISHED],t.isPublished()),a.append([i.Fields.IS_ILLUSTRATION],s.type.includes("image")),a.append([i.Fields.USER_FILE],s,s.name);const n=this.cmsMediaFactory.createModel(e.Types.SWYM);return n.savePromise(null,{data:a}).then(()=>n.fetchPromise())}adjustThumbnailImage(t,e){const i=e.querySelector("img");if(i){const e=i.getAttribute("data-media-id");e&&e!==t.get(s.Fields.THUMBNAIL_ID)&&t.set(s.Fields.THUMBNAIL_ID,e)}}}}),define("DS/MPFContentPublishing/ThumbnailComponent",["UWA/Class/View","DS/UIKIT/Spinner","DS/MPFServices/ObjectService","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/CmsMediaFactory"],function(t,e,i,s,a){"use strict";const n={INITAL:"inital",LOADING:"loading",LOADED:"loaded",LOADING_ERROR:"loadingError"};return t.extend({className:"mpf-thumbnail",setup(t={}){i.requiredOfPrototype(t.article,s,"options.article must be an ArticleModel"),i.requiredOfPrototype(t.cmsMediaFactory,a,"options.cmsMediaFactory must be a CmsMediaFactory"),this.article=t.article,this.cmsMediaFactory=t.cmsMediaFactory,this.isOperatorView=!0===t.isOperatorView,this.cmsMediaModel=this.cmsMediaFactory.createModel(this.isOperatorView?a.Types.SWYM:a.Types.PUBLIC,{id:this.article.get(s.Fields.THUMBNAIL_ID)})},render(){return this.container.setStyle("background-image",`url(${this.cmsMediaModel.getPublicSrcUrl()})`),this.container.setContent([]),this},destroy(){this.article=null,this.cmsMediaFactory=null,this._parent(),this.container=null},_loadMedia(){const t=this.article.get(s.Fields.THUMBNAIL_ID);t?(this.cmsMediaModel=this.cmsMediaFactory.createModel(this.isOperatorView?a.Types.SWYM:a.Types.PUBLIC,{id:t}),this.state=n.LOADING,this.cmsMediaModel.fetchPromise().then(()=>{this.state=n.LOADED}).catch(t=>{console.error(t),this.state=n.LOADING_ERROR}).finally(()=>{this.container&&this.render()})):(this.state=n.LOADED,this.render())}})}),define("DS/MPFContentPublishing/MetaTagHandler",[],function(){"use strict";const t={KEYWORDS:"keywords",DESCRIPTION:"description"};class e{constructor(){this._originalContent={},this._addedTags=[],Object.values(t).forEach(t=>{const e=document.querySelector(`meta[name="${t}"]`);e&&(this._originalContent[t]=e.getAttribute("content"))})}restoreTags(){Object.keys(this._originalContent).forEach(t=>{document.querySelector(`meta[name="${t}"]`).setAttribute("content",this._originalContent[t])}),this._addedTags.forEach(t=>{const e=document.querySelector(`meta[name="${t}"]`);e&&e.remove()}),this._addedTags=[]}setTag(t,e){const i=document.querySelector(`meta[name="${t}"]`);if(i)i.setAttribute("content",e);else{const i=document.createElement("meta");i.setAttribute("name",t),i.setAttribute("content",e),document.querySelector("head").append(i),this._addedTags.push(t)}}destroy(){this._originalContent=null,this._addedTags=null}}return e.TagNames=Object.freeze(t),e}),define("DS/MPFContentPublishing/SimpleTextInput",["UWA/Class/View","DS/UIKIT/Input/Text","DS/MPFServices/ObjectService","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s){"use strict";return t.extend({className:"mpf-simple-text-input",setup({name:t,label:e,placeholder:s,rows:a,isRequired:n=!1}){i.requiredOfType(t,"string","options.name must be a string"),i.requiredOfType(e,"string","options.label must be a string"),this.name=t,this.label=e,this.isRequired=n,this.input=this._createInput({placeholder:s,rows:a})},render({model:t}){return this.input.setValue(t.get(this.name)||""),this.container.setContent([{tag:"div",class:"mpf-label",text:this.label},this.input,{tag:"div",class:"mpf-error-container"}]),this._hideRequiredError(),this},getValue(){return this.input.getValue()},destroy(){this._parent(),this.container=null},validate(){return this.isRequired&&!this.getValue()?(this._showRequiredError(),!1):(this._hideRequiredError(),!0)},_showRequiredError(){this.container.addClassName("mpf-invalid"),this.container.getElement(".mpf-error-container").setText(s.get("requiredErrorMessage",{valueName:this.label}))},_hideRequiredError(){this.container.removeClassName("mpf-invalid"),this.container.getElement(".mpf-error-container").empty()},_createInput({placeholder:t,rows:i}){return new e({placeholder:t,name:this.name,rows:i,multiline:i>1,events:{onChange:this.validate.bind(this)}})}})}),define("DS/MPFContentPublishing/ArticleLanguageSelector",["UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s){"use strict";const a=["en","fr","de","ja","ko","ru","zh"];return t.extend({setup:function(){this._buttonGroup=this._createButtonGroup()},render:function(){return this.container.setContent(this._buttonGroup),this},destroy:function(){this._buttonGroup=null,this._parent()},_createButtonGroup:function(){return new i({type:"radio",buttons:this._createButtons()})},_createButtons:function(){return a.map(t=>new e({value:s.get(t)}))}})}),define("DS/MPFContentPublishing/CmsTaggerInput",["UWA/Class/View","DS/MPFView/TaggerInput","DS/MPFServices/ObjectService"],function(t,e,i){"use strict";return t.extend({className:"mpf-cms-tagger-input",setup({name:t,label:e,placeholder:s}){i.requiredOfType(t,"string","options.name must be a string"),i.requiredOfType(e,"string","options.label must be a string"),this.name=t,this.label=e,this.placeholder=s},render({model:t}){return this.input&&this.input.destroy(),this.input=this._createTaggerInput({model:t}),this.container.setContent([{tag:"div",class:"mpf-label",text:this.label},this.input.render(),this.input]),this},getValues(){return this.input&&this.input.getValues()},destroy(){this.input&&this.input.destroy(),this.model=null,this._parent(),this.container=null},_createTaggerInput({model:t}){return new e({placeholder:this.placeholder,items:t.get(this.name)||[]})}})}),define("DS/MPFContentPublishing/CmsStateMachine",["UWA/Class","UWA/Class/Events","DS/MPFServices/ObjectService","DS/MPFCmsModel/ArticleCollection","DS/MPFCmsModel/ArticleModel","DS/MPFContentPublishing/MetaTagHandler","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a,n,r){"use strict";const o=Object.freeze({VIEW_ARTICLE:"viewArticle",EDIT_ARTICLE:"editArticle",VIEW_LIST:"viewList"}),c=Object.freeze({STATE:"onStateChange",ARTICLE:"onArticleChange",ARTICLE_LANGUAGE:"onArticleLanguageChange",ARTICLE_CATEGORY:"onArticleCategoryChange",LIST_LANGUAGE:"onListLanguageChange",LIST_CATEGORY:"onListCategoryChange"}),l=Object.freeze({NEW_ARTICLE:"new-article",EDIT_ARTICLE:"edit-article"}),h=t.extend(e,{init({rootPath:t,articles:e,state:a,article:c,listLanguage:l,articleLanguage:h,listCategory:d,articleCategory:u,isOperatorView:g,omitUrlChanges:m}){this.omitUrlChanges=!0===m,!this.omitUrlChanges&&i.requiredOfType(t,"string","options.rootPath must be a string"),i.requiredOfPrototype(e,s,"options.articles must be an ArticleCollection"),this.rootPath=t,this.articles=e,this.article=c,this.state=a||o.VIEW_LIST,this.listLanguage=l||"any",this.listCategory=d||r.get("any"),this.articleLanguage=h||this.article&&this.article.getFirstAvailableLanguage(),this.articleCategory=u||this.article&&this.article.getCategory(),this.isOperatorView=!0===g,this.metaTagHandler=new n},getState(){return this.state},isArticleEditionMode(){return this.state===o.EDIT_ARTICLE},isViewArticleMode(){return this.state===o.VIEW_ARTICLE},isViewListMode(){return this.state===o.VIEW_LIST},getStateData(){return{state:this.state,article:this.article,listLanguage:this.listLanguage,articleLanguage:this.articleLanguage,listCategory:this.listCategory,articleCategory:this.articleCategory,isArticleEditionView:this.isArticleEditionMode()}},setStateData({article:t,articleCategory:e,articleLanguage:i,listCategory:s,listLanguage:a}){!t&&null!==t||t===this.article||(this.article=t,this.dispatchEvent(c.ARTICLE)),!e&&null!==e||e===this.articleCategory||(this.articleCategory=e,this.dispatchEvent(c.ARTICLE_CATEGORY)),!i&&null!==i||i===this.articleLanguage||(this.articleLanguage=i,this.dispatchEvent(c.ARTICLE_LANGUAGE)),!s&&null!==s||s===this.listCategory||(this.listCategory=s,this.dispatchEvent(c.LIST_CATEGORY)),!a&&null!==a||a===this.listLanguage||(this.listLanguage=a,this.dispatchEvent(c.LIST_LANGUAGE))},changeState(t,{article:e,listLanguage:s,articleLanguage:n,listCategory:r,articleCategory:h}={}){i.requiredOfType(t,"string","First argument must be a string");let d,u=Promise.resolve();if(t===o.EDIT_ARTICLE&&!this.isOperatorView)throw new Error("Article edition reserved for operator role");return this.state===o.VIEW_LIST?t===o.VIEW_ARTICLE?(i.requiredOfPrototype(e,a,"options.article must be an ArticleModel"),this.article=e,u=this.article.fetchPromise().then(()=>{d=this.article.getUrl(),this.articleLanguage="any"!==this.listLanguage&&this.article.hasLanguage(this.listLanguage)?this.listLanguage:this.article.getFirstAvailableLanguage(),this.articleCategory=this.article.getCategory()})):t===o.EDIT_ARTICLE&&(i.requiredOfPrototype(e,a,"options.article must be an ArticleModel"),this.article=e,this.article.isNew()?d=l.NEW_ARTICLE:(d=this.article.getUrl()+"/"+l.EDIT_ARTICLE,u=this.article.fetchPromise()),u=u.then(()=>{this.articleLanguage="any"!==this.listLanguage&&this.article.hasLanguage(this.listLanguage)?this.listLanguage:this.article.getFirstAvailableLanguage(),this.articleCategory=e.getCategory()})):this.state===o.VIEW_ARTICLE?t===o.VIEW_LIST?(this.article=null,this.articleLanguage=null,this.articleCategory=null,this.listCategory=r||this.listCategory,d="",u=this.articles.fetchPromise()):t===o.EDIT_ARTICLE&&(this.articleCategory=this.article.getCategory(),this.articleLanguage=this.articleLanguage||this.article.getFirstAvailableLanguage(),d=`${this.article.getUrl()}/${l.EDIT_ARTICLE}`):this.state===o.EDIT_ARTICLE&&(t===o.VIEW_LIST?(this.article=null,this.articleLanguage=null,this.articleCategory=null,d="",u=this.articles.fetchPromise()):t===o.VIEW_ARTICLE&&(u=this.article.fetchPromise().then(()=>{d=this.article.getUrl(),this.articleLanguage=this.article.hasLanguage(this.articleLanguage)?this.articleLanguage:this.article.getFirstAvailableLanguage(),this.articleCategory=null}))),u.then(()=>{this.state=t,this._setMetaTags(),this._setUrl(d),this.dispatchEvent(c.STATE)})},destroy(){this.metaTagHandler.destroy(),this.metaTagHandler=null,this.communityInfo=null,this.articles=null,this.article=null},_setUrl(t){this.omitUrlChanges||!t&&""!==t||window.history.pushState(this.getState(),document.title,"/"+this.rootPath+(""===t?"":"/"+t))},_setMetaTags(){if(this.state===o.VIEW_ARTICLE){const t=this.article.get(a.Fields.META_KEYWORDS),e=this.article.get(a.Fields.META_DESCRIPTION);Array.isArray(t)&&t.length>0&&this.metaTagHandler.setTag(n.TagNames.KEYWORDS,t.join(",")),e&&this.metaTagHandler.setTag(n.TagNames.DESCRIPTION,e)}else this.metaTagHandler.restoreTags()}});return h.getStateFromUrl=function(t){let e,i;let s=window.location.pathname.split("/");const a=s.indexOf(t);if(a>-1)return 1===(s=s.slice(a)).length?e=o.VIEW_LIST:2===s.length?s[1]===l.NEW_ARTICLE||s[1]===l.EDIT_ARTICLE?e=o.EDIT_ARTICLE:(e=o.VIEW_ARTICLE,i=s[1]):3===s.length&&(e=o.EDIT_ARTICLE,i=s[1]),{state:e,articleUrl:i};throw new Error("Unable to get state from URL - root path not found")},h.States=o,h.Changes=c,h.Urls=l,h}),define("DS/MPFContentPublishing/AddCategoryMenuItem",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCmsModel/CommunityInfoModel","DS/MPFContentPublishing/CategoryInput","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a){"use strict";const n={READ:"read",WRITE:"write"},r={CONFIRMED:"confirmed",CANCELED:"canceled",SAVED:"saved"},o=t.extend({className:"mpf-add-category-menu-item",setup(t={}){e.requiredOfPrototype(t.communityInfo,i,"options.communityInfo must be a CommunityInfoModel"),this.communityInfo=t.communityInfo,this.state=t.state||n.READ,t.additionalClassName&&this.container.addClassName(t.additionalClassName),this.input=this._createInput()},render(){let t,e,i;return this.state===n.WRITE?(t=[this.alert,this.input.render()],e=n.WRITE,i=n.READ):(t=this._renderReadMode(),e=n.READ,i=n.WRITE),this.container.setContent(t),this.container.removeClassName(i),this.container.addClassName(e),this},toReadMode(){this.state===n.WRITE&&(this.state=n.READ,this.render())},_toWriteMode(){this.state===n.READ&&(this.state=n.WRITE,this.input.setValue(""),this.render())},_confirm(t){this.toReadMode(),this.dispatchEvent(r.CONFIRMED,t)},_cancel(){this.toReadMode(),this.dispatchEvent(r.CANCELED)},_renderReadMode(){return[{tag:"div",class:"mpf-read-container",html:[{tag:"span",class:"fonticon fonticon-plus"},{tag:"span",text:a.get("newCategory")}],events:{click:this._toWriteMode.bind(this)}},this.alert]},_createInput(){const t=new s;return this.listenTo(t,s.Events.SAVE,this._confirm.bind(this)),this.listenTo(t,s.Events.CANCEL,this._cancel.bind(this)),t},destroy(){this.categories=null,this.categoryFactory=null,this._parent(),this.container=null}});return o.Events=Object.freeze(r),o}),define("DS/MPFContentPublishing/ManageCategoriesModal",["UWA/Class/View","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/ArticleCollection","DS/MPFCmsModel/CommunityInfoModel","DS/MPFContentPublishing/CmsStateMachine","DS/MPFView/SortByDragList","DS/MPFContentPublishing/AddCategoryMenuItem","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a,n,r,o,c,l,h,d,u){"use strict";return t.extend({className:"mpf-manage-categories-modal",setup(t={}){n.requiredOfPrototype(t.cmsStateMachine,l,"options.cmsStateMachine must be a CmsStateMachine"),n.requiredOfPrototype(t.communityInfo,c,"options.communityInfo must be a CommunityInfoModel"),n.requiredOfPrototype(t.articles,o,"options.articles must be an ArticleCollection"),this.cmsStateMachine=t.cmsStateMachine,this.communityInfo=t.communityInfo,this.articles=t.articles,this.alert=this._createAlert(),this.saveButton=this._createSaveButton(),this.addCategoryItem=this._createAddCategoryItem(),this.modal=this._createModal(this.saveButton)},render(){return this.container.setContent(this.modal),this},show(){this.categories=this.communityInfo.getCategories().map((t,e)=>({label:t,id:e,index:e,isRemovable:this._isEmptyCategory(t)})),this.sortCategoriesList=new h({items:this.categories}),this.listenTo(this.sortCategoriesList,h.Events.CHANGE,this._enableSaveButton.bind(this)),this.saveButton.disable(),this.modal.setBody([this.alert,this.sortCategoriesList.render(),this.addCategoryItem.render()]),this.modal.show()},hide(){this.modal.hide(),this.stopListening(this.sortCategoriesList),this.sortCategoriesList.destroy(),this.sortCategoriesList=null,this.categories=null},destroy(){this.stopListening(),this.alert.destroy(),this.sortCategoriesList&&this.sortCategoriesList.destroy(),this.modal.destroy(),this.sortCategoriesList=null,this.communityInfo=null,this.articles=null,this.categories=null,this._parent(),this.container=null},_enableSaveButton(t){this.saveButton.setDisabled(!t)},_addCategory(t){this.sortCategoriesList.contains(t)?this.alert.add({className:"error",message:u.get("categoryAlreadyExists")}).show():this.sortCategoriesList.add({label:t,isRemovable:!0}).render()},_save(){if(this.sortCategoriesList.wasModified()){const t=[],e=this.sortCategoriesList.getModifedArray();this.communityInfo.setCategories(e.map(t=>t.label));const{listCategory:i}=this.cmsStateMachine.getStateData();let s;return e.forEach(e=>{e.label!==e.originalLabel&&(this.articles.where({[r.Fields.CATEGORY]:e.originalLabel}).forEach(i=>{i.set(r.Fields.CATEGORY,e.label),t.push(i)}),e.originalLabel===i&&(s=e.label))}),this._setLoadingState(!0),Promise.all([this.communityInfo.savePromise(),...t.map(t=>t.savePromise())]).then(()=>{this._setLoadingState(!1),s&&this.cmsStateMachine.setStateData({listCategory:s}),this.hide()}).catch(t=>{this._setLoadingState(!1),console.error(t),this.alert.add({className:"error",message:u.get("failedToSaveModifications")}).show()})}},_setLoadingState(t=!0){t?s.mask(this.modal.getBody()):s.unmask(this.modal.getBody()),this.saveButton.load(t)},_isEmptyCategory(t){return!this.articles.findWhere({[r.Fields.CATEGORY]:t})},_createSaveButton(){return new i({value:u.get("save"),className:"primary",events:{onClick:this._save.bind(this)}})},_createAlert:()=>new a({visible:!1,autoHide:!0}),_createModal(t){return new e({header:u.get("manageYourCategories"),footer:[t,new i({value:u.get("cancel"),events:{onClick:this.hide.bind(this)}})]})},_createAddCategoryItem(){const t=new d({communityInfo:this.communityInfo});return this.listenTo(t,d.Events.CONFIRMED,this._addCategory.bind(this)),t}})}),define("DS/MPFContentPublishing/ArticleInfoLine",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCmsModel/ArticleModel","DS/MPFContentPublishing/CmsStateMachine","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a){"use strict";const n={CATEGORY_CLICKED:"categoryClicked"},r=t.extend({className:"mpf-article-info-line",setup({cmsStateMachine:t}){e.requiredOfPrototype(t,s,"options.cmsStateMachine must be a CmsStateMachine"),this.cmsStateMachine=t},render(t){const e=(t=t||this.cmsStateMachine.getStateData()).article;return this.container.setContent([{tag:"span",class:"mpf-category-tag",html:[{tag:"span",text:a.get("in")},{class:"mpf-category-link",text:e.get(i.Fields.CATEGORY),events:{click:()=>{this.cmsStateMachine.getState()===s.States.VIEW_LIST?this.cmsStateMachine.setStateData({listCategory:e.get(i.Fields.CATEGORY)}):this.cmsStateMachine.changeState(s.States.VIEW_LIST,{listCategory:e.get(i.Fields.CATEGORY)})}}}]},{tag:"span",class:"mpf-publishing-info",text:a.get("publishedOnX",{date:this._renderPublishingDate(e)})},{tag:"span",class:"mpf-available-languages",text:this._renderLanguages(e)}]),this},destroy(){this._parent(),this.container=null},_renderPublishingDate(t){return new Date(t.get(i.Fields.PUB_DATE)).toLocaleDateString(this.locale,{year:"numeric",month:"short",day:"numeric"})},_renderLanguages(t){let e="";const i=t.getLanguages();if(Array.isArray(i)){let t="";i.forEach((e,s)=>{t+=a.get(e),s<i.length-2?t+=", ":s===i.length-2&&(t+=" & ")}),e+="- "+a.get("availableInX",{languages:t})}return e}});return r.Events=Object.freeze(n),r}),define("DS/MPFContentPublishing/LanguageMenu",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/ArticleCollection","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a,n){"use strict";const r={LANGUAGE_SELECTED:"languageSelected"},o=t.extend({className:"mpf-side-bar-menu mpf-language-menu mpf-collapsed",setup(t={}){e.requiredOfPrototype(t.cmsStateMachine,i,"options.cmsStateMachine must be a CmsStateMachine"),e.requiredOfPrototype(t.articles,a,"options.articles must be an ArticleCollection"),this.cmsStateMachine=t.cmsStateMachine,this.articles=t.articles,this.isArticleEditionView=!0===t.isArticleEditionView,this.listenTo(this.cmsStateMachine,i.Changes.ARTICLE_LANGUAGE,this.render.bind(this)),this.listenTo(this.cmsStateMachine,i.Changes.LIST_LANGUAGE,this.render.bind(this))},render(){const{article:t,listLanguage:e,articleLanguage:i,isArticleEditionView:s}=this.cmsStateMachine.getStateData();return this.container.setContent([{tag:"div",class:"mpf-title-container",html:[{tag:"span",class:"fonticon fonticon-expand-down mpf-expand-icon"},{tag:"div",class:"mpf-title",text:n.get("language").toUpperCase()}],events:{click:this._toggleItemList.bind(this)}},{tag:"div",class:"mpf-item-list",html:this._renderItems(e,i,t,s)}]),this},destroy(){this.stopListening(),this.cmsStateMachine=null,this.articles=null,this._parent(),this.container=null},_onItemSelection(t){this.cmsStateMachine.isViewListMode()?this.cmsStateMachine.setStateData({listLanguage:t}):this.cmsStateMachine.setStateData({articleLanguage:t})},_toggleItemList(){this.container.toggleClassName("mpf-collapsed")},_renderItems(t,e,i,a){let n;const r=this._getAvailableLanguages(i);return n=a?s.Languages.map(t=>this._renderItem({language:t,selectedLanguage:e,addTick:r.includes(t)})):r.map(s=>this._renderItem({language:s,selectedLanguage:(i?e:t)||r[0],selectedArticle:i}))},_renderItem({language:t,selectedLanguage:e,addTick:i}){const s=[{tag:"span",text:n.get(t)}];return i&&s.push({tag:"span",class:"fonticon fonticon-check mpf-tick"}),{tag:"div",class:"mpf-menu-item"+(t===e?" mpf-selected":""),html:s,events:{click:this._onItemSelection.bind(this,t)}}},_getAvailableLanguages(t){if(t)return t.getLanguages();{const t=this.articles.reduce((t,e)=>t.concat(e.getLanguages()),[]);return["any",...new Set(t)]}}});return o.Events=Object.freeze(r),o}),define("DS/MPFContentPublishing/TopBar",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine"],function(t,e,i){"use strict";const s={GO_BACK:"goBack",EDIT_ARTICLE:"editArticle",LANGUAGE_SELECTED:"languageSelected"},a=t.extend({className:"mpf-top-bar",setup(t={}){e.requiredOfPrototype(t.cmsStateMachine,i,"options.cmsStateMachine must be a CmsStateMachine"),this.cmsStateMachine=t.cmsStateMachine,this.isOperatorView=!0===t.isOperatorView},render(){const{article:t,articleLanguage:e}=this.cmsStateMachine.getStateData(),s=[{tag:"span",class:"fonticon fonticon-chevron-left mpf-icon",events:{click:this.cmsStateMachine.changeState.bind(this.cmsStateMachine,i.States.VIEW_LIST)}},{tag:"span",class:"mpf-title",text:t.getTitle(e)}];return this.isOperatorView&&s.push({tag:"span",class:"fonticon fonticon-pencil mpf-icon",events:{click:this.cmsStateMachine.changeState.bind(this.cmsStateMachine,i.States.EDIT_ARTICLE,{article:t})}}),s.push({tag:"span",class:"fonticon fonticon-wrong mpf-icon",events:{click:this.cmsStateMachine.changeState.bind(this.cmsStateMachine,i.States.VIEW_LIST)}}),this.container.setContent(s),this},destroy(){this.cmsStateMachine=null,this._parent(),this.container=null}});return a.Events=Object.freeze(s),a}),define("DS/MPFContentPublishing/ArticleView",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFContentPublishing/ArticleInfoLine","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a){"use strict";const n={CATEGORY_CLICKED:"categoryClicked"},r=t.extend({className:"mpf-page-content mpf-article-view",setup({cmsStateMachine:t}){e.requiredOfPrototype(t,i,"options.cmsStateMachine must be a CmsStateMachine"),this.cmsStateMachine=t,this.infoLine=this._createInfoLine(),this.listenTo(this.cmsStateMachine,i.Changes.ARTICLE_LANGUAGE,this.render.bind(this))},render(){const{article:t,articleLanguage:e}=this.cmsStateMachine.getStateData();return this.container.setContent([this.infoLine.render(),{tag:"div",class:"mpf-article-container",html:t.getMessage(e)},this._renderRelatedArticleLinks(t)]),this},destroy(){this.stopListening(),this.infoLine.destroy(),this.cmsStateMachine=null,this._parent(),this.container=null},_createInfoLine(){return new s({cmsStateMachine:this.cmsStateMachine})},_renderRelatedArticleLinks(t){const e=t.getLinks();if(e.length>0)return{tag:"div",class:"mpf-related-article-section",html:[{tag:"div",class:"mpf-related-article-section-header",text:a.get("seeAlso")},{tag:"div",html:e.map(t=>({tag:"a",class:"mpf-related-article-link",attributes:{href:t,target:"_blank"},html:[{tag:"span",class:"fonticon fonticon-link"},{tag:"span",text:t}]}))}]}}});return r.Events=Object.freeze(n),r}),define("DS/MPFContentPublishing/ArticlePreview",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/CmsMediaFactory","DS/MPFContentPublishing/ArticleInfoLine","DS/MPFContentPublishing/ThumbnailComponent"],function(t,e,i,s,a,n,r,o){"use strict";const c={ON_CLICK:"onClick",CATEGORY_CLICKED:"categoryClicked"},l=e.extend({className:"mpf-article-preview",domEvents:{"click .mpf-article-preview-header":"_onPreviewClicked","click .mpf-content-container":"_onPreviewClicked"},setup(t={}){i.requiredOfPrototype(t.cmsStateMachine,s,"options.cmsStateMachine must be a CmsStateMachine"),i.requiredOfPrototype(t.article,a,"options.article must be an ArticleModel"),i.requiredOfPrototype(t.cmsMediaFactory,n,"options.cmsMediaFactory must be a CmsMediaFactory"),this.cmsStateMachine=t.cmsStateMachine,this.article=t.article,this.cmsMediaFactory=t.cmsMediaFactory,this.locale=t.locale||"en-US",this.isOperatorView=!0===t.isOperatorView,this.articleInfoLine=this._createArticleInfoLine(),this.thumbnail=!!this.article.get(a.Fields.THUMBNAIL_ID)&&this._createThumbnail(),this.listenTo(this.article,"onSync",this.render.bind(this))},render({listLanguage:t}){return"any"===t&&(t=this.article.getFirstAvailableLanguage()),this.container.setContent([this._renderHeader(t),{tag:"div",class:"mpf-article-preview-body",html:[this.articleInfoLine.render({article:this.article}),this._renderArticleContent(t)]}]),this},destroy(){this.stopListening(),this.thumbnail&&this.thumbnail.destroy(),this.article=null,this.cmsMediaFactory=null,this.cmsMediaModel=null,this._parent(),this.container=null},_onPreviewClicked(){this.cmsStateMachine.changeState(s.States.VIEW_ARTICLE,{article:this.article})},_renderHeader(t){return{tag:"div",class:"mpf-article-preview-header",html:[{tag:"span",class:"fonticon fonticon-newspaper mpf-article-logo"},{tag:"span",class:"mpf-preview-title",text:this.article.getTitle(t)}]}},_createArticleInfoLine(){return new r({cmsStateMachine:this.cmsStateMachine,article:this.article})},_renderArticleContent(t){return{tag:"div",class:"mpf-content-container",html:[this.thumbnail&&this.thumbnail.render(),{tag:"div",class:"mpf-text-preview",html:[{tag:"div",class:"mpf-text-container",html:[{tag:"div",text:this._extractTextFromHtmlString(this.article.getMessage(t)).substring(0,500)}]},{tag:"div",class:"mpf-blend-overlay"}]}]}},_createThumbnail(){return new o({article:this.article,cmsMediaFactory:this.cmsMediaFactory,isOperatorView:this.isOperatorView})},_extractTextFromHtmlString:e=>t.createElement("span",{html:e}).getText()});return l.Events=Object.freeze(c),l}),define("DS/MPFContentPublishing/CategoryMenu",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFCmsModel/ArticleCollection","DS/MPFCmsModel/CommunityInfoModel","DS/MPFContentPublishing/AddCategoryMenuItem","DS/MPFAmdLazyLoader/AmdLazyLoader","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a,n,r,o,c,l){"use strict";const h={CATEGORY_SELECTED:"categorySelected",CATEGORIES_SAVED:"categoriesSaved"},d=t.extend({className:"mpf-side-bar-menu mpf-category-menu mpf-collapsed",setup(t={}){s.requiredOfPrototype(t.cmsStateMachine,a,"options.cmsStateMachine must be a CmsStateMachine"),s.requiredOfPrototype(t.communityInfo,r,"options.communityInfo must be a CommunityInfoModel"),s.requiredOfPrototype(t.articles,n,"options.articles must be an ArticleCollection"),this.cmsStateMachine=t.cmsStateMachine,this.communityInfo=t.communityInfo,this.articles=t.articles,this.isOperatorView=!0===t.isOperatorView,this.addCategoryItem=this._createAddCategoryItem(),this.alert=this._createAlert(),this.listenTo(this.cmsStateMachine,a.Changes.ARTICLE_CATEGORY,this.render.bind(this)),this.listenTo(this.cmsStateMachine,a.Changes.LIST_CATEGORY,this.render.bind(this)),this.listenTo(this.communityInfo,"onSync",this.render.bind(this))},render(){const{listLanguage:t,listCategory:e,articleCategory:i,isArticleEditionView:s}=this.cmsStateMachine.getStateData(),a=this._getAvailableCategories({listLanguage:t,isArticleEditionView:s}),n=s?i:e;return this.container.setContent([{tag:"div",class:"mpf-title-container",html:this._renderTitle(s)},{tag:"div",class:"mpf-item-list",html:[this.alert,this.manageCategoriesModal?this.manageCategoriesModal.render():"",this._renderItems(a,n,t,s),this.isOperatorView&&this.addCategoryItem.render()]}]),this},destroy(){this.stopListening(),this.addCategoryItem.destroy(),this.manageCategoriesModal&&this.manageCategoriesModal.destroy(),this.addCategoryItem=null,this.manageCategoriesModal=null,this.cmsStateMachine=null,this.articles=null,this.communityInfo=null,this._parent(),this.container=null},_getAvailableCategories({listLanguage:t,isArticleEditionView:e}){const i=[...this.communityInfo.getCategories()],s=this.isOperatorView?i:i.filter(e=>this._countArticlesInCategory(e,t)>0);return e||s.unshift(l.get("any")),s},_onCategorySelection(t){this.cmsStateMachine.isArticleEditionMode()?this.cmsStateMachine.setStateData({articleCategory:t}):this.cmsStateMachine.setStateData({listCategory:t})},_renderTitle(t){const e=[{tag:"span",class:"fonticon fonticon-expand-down mpf-expand-icon",events:{click:this._toggleItemList.bind(this)}},{tag:"div",class:"mpf-title",text:l.get("category").toUpperCase(),events:{click:this._toggleItemList.bind(this)}}];return this.isOperatorView&&!t&&e.push({tag:"span",class:"fonticon fonticon-cog mpf-edit-categories-icon",events:{click:this._openManageCategoriesModal.bind(this)}}),e},_renderItems(t,e,i,s){return t.map(t=>({tag:"div",class:"mpf-menu-item"+(t===e?" mpf-selected":""),text:this._renderLabel(t,i,s),events:{click:this._onCategorySelection.bind(this,t)}}))},_renderLabel(t,e,i){return i?t:`${t} (${this._countArticlesInCategory(t,e)})`},_countArticlesInCategory(t,e){const i=this.isOperatorView?this.articles.toArray():this.articles.filter(t=>t.isPublished()),s=t===l.get("any")?i:i.filter(e=>e.getCategory()===t);return e&&"any"!==e?s.filter(t=>t.getLanguages().includes(e)).length:s.length},_toggleItemList(){this.container.toggleClassName("mpf-collapsed")},_openManageCategoriesModal(){this.manageCategoriesModal?this.manageCategoriesModal.show():(e.mask(this.container),c.getInstance().get(["DS/MPFContentPublishing/ManageCategoriesModal"]).then(([t])=>{e.unmask(this.container),this.manageCategoriesModal=new t({cmsStateMachine:this.cmsStateMachine,communityInfo:this.communityInfo,articles:this.articles}),this.manageCategoriesModal.render().inject(this.container),this.manageCategoriesModal.show()}).catch(t=>{e.unmask(this.container),console.log(t)}))},_save(t){this.communityInfo.hasCategory(t)?this.alert.add({className:"error",message:l.get("categoryAlreadyExists")}).show():(e.mask(this.container),this.communityInfo.addCategory(t),this.communityInfo.savePromise().then(()=>{e.unmask(this.container),this.render(),this.dispatchEvent(h.CATEGORIES_SAVED)}).catch(t=>{e.unmask(this.container),console.error(t),this.alert.add({className:"error",message:l.get("failedToAddCategory")}).show()}))},_createAddCategoryItem(){const t=new o({communityInfo:this.communityInfo,additionalClassName:"mpf-menu-item"});return this.listenTo(t,o.Events.CONFIRMED,this._save.bind(this)),t},_createAlert:()=>new i({visible:!1,autoHide:!0})});return d.Events=Object.freeze(h),d}),define("DS/MPFContentPublishing/ArticleList",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFCmsModel/ArticleCollection","DS/MPFCmsModel/CmsMediaFactory","DS/MPFContentPublishing/ArticlePreview","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing","css!DS/MPFContentPublishing/MPFContentPublishing"],function(t,e,i,s,a,n,r){"use strict";const o={SHOW_ARTICLE:"showArticle",ADD_ARTICLE:"addArticle",SHOW_CATEGORY:"showCategory"},c=t.extend({className:"mpf-page-content mpf-article-list",setup(t={}){e.requiredOfPrototype(t.cmsStateMachine,i,"options.cmsStateMachine must be a CmsStateMachine"),e.requiredOfPrototype(t.articles,s,"options.articles must be an ArticleCollection"),e.requiredOfPrototype(t.cmsMediaFactory,a,"options.cmsMediaFactory must be a CmsMediaFactory"),this.cmsStateMachine=t.cmsStateMachine,this.articles=t.articles,this.cmsMediaFactory=t.cmsMediaFactory,this.isOperatorView=!0===t.isOperatorView,this.listenTo(this.cmsStateMachine,i.Changes.LIST_CATEGORY,this.render.bind(this)),this.listenTo(this.cmsStateMachine,i.Changes.LIST_LANGUAGE,this.render.bind(this))},render(){const{listCategory:t,listLanguage:e}=this.cmsStateMachine.getStateData(),i=[];return this.isOperatorView&&i.push(this._createAddArticlePanel()),this.previews&&this.previews.length>0&&this._destroyPreviews(),this.previews=this._createPreviews({listCategory:t,listLanguage:e}),this.previews.forEach(t=>{i.push(t.render({listLanguage:e}))}),this.container.setContent(i),this},destroy(){this.stopListening(),this.previews&&this._destroyPreviews(),this.previews=null,this.cmsStateMachine=null,this.articles=null,this._parent(),this.container=null},_createAddArticlePanel(){return{tag:"div",class:"mpf-add-article-panel",html:[{tag:"div",class:"fonticon fonticon-plus mpf-add-article-icon"},{tag:"div",class:"mpf-add-article-title",text:r.get("addAnArticle")}],events:{click:this.dispatchEvent.bind(this,o.ADD_ARTICLE)}}},_createPreviews({listCategory:t,listLanguage:e}){return this.articles.filter(i=>(!t||t===r.get("any")||i.getCategory()===t)&&(!(e&&"any"!==e&&!i.getLanguages().includes(e))&&!(!this.isOperatorView&&!i.isPublished()))).map(t=>this._createPreview(t))},_destroyPreviews(){this.previews.forEach(t=>{this.stopListening(t),t.destroy()})},_createPreview(t){return new n({article:t,cmsStateMachine:this.cmsStateMachine,cmsMediaFactory:this.cmsMediaFactory,isOperatorView:this.isOperatorView})}});return c.Events=Object.freeze(o),c}),define("DS/MPFContentPublishing/ArticleFileInput",["UWA/Class/View","DS/UIKIT/Input/File","DS/MPFServices/ObjectService","DS/MPFCmsModel/CmsMediaFactory","DS/MPFContentPublishing/MediaHelper"],function(t,e,i,s,a){"use strict";const n={ON_UPLOAD:"onUpload"},r=t.extend({className:"mpf-article-file-input",setup(t={}){i.requiredOfPrototype(t.cmsMediaFactory,s,"options.cmsMediaFactory must be a CmsMediaFactory"),this.cmsMediaFactory=t.cmsMediaFactory,this.mediaHelper=new a({cmsMediaFactory:this.cmsMediaFactory}),this.fileInput=this._createFileInput()},render({article:t,articleLanguage:e}){return this.container.setContent([{tag:"span",class:"fonticon fonticon-attach",events:{click:this._attachFile.bind(this,{article:t,articleLanguage:e})}},this.fileInput]),this},destroy(){this._parent(),this.container=null},_attachFile({article:t,articleLanguage:e}){this.fileInput.removeEvents(),this.fileInput.addEvent("onChange",this._uploadFile.bind(this,{article:t,articleLanguage:e})),this.fileInput.elements.input.click()},_uploadFile({article:t,articleLanguage:e},i){if(i.target&&i.target.files&&i.target.files.length>0){const s=i.target.files[0];return this.mediaHelper.uploadMedia({article:t,articleLanguage:e,file:s}).then(i=>{this.dispatchEvent(n.ON_UPLOAD,{article:t,articleLanguage:e,media:i})}).catch(t=>{console.error(t)})}},_createFileInput:()=>new e({input:!1})});return r.Events=Object.freeze(n),r}),define("DS/MPFContentPublishing/ArticleTextEditor",["UWA/Core","UWA/String","UWA/Class/View","DS/CKEditor/CKEditor","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/CmsMediaFactory","DS/MPFCmsModel/CmsMediaModel","DS/MPFContentPublishing/CmsStateMachine","DS/MPFContentPublishing/MediaHelper","DS/MPFContentPublishing/ArticleFileInput","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a,n,r,o,c,l,h,d,u){"use strict";return i.extend({className:"mpf-article-text-editor",setup(t={}){n.requiredOfPrototype(t.cmsStateMachine,l,"options.cmsStateMachine must be a CmsStateMachine"),n.requiredOfPrototype(t.cmsMediaFactory,o,"options.cmsMediaFactory must be a CmsMediaFactory"),this.cmsStateMachine=t.cmsStateMachine,this.cmsMediaFactory=t.cmsMediaFactory,this.mediaHelper=new h({cmsMediaFactory:this.cmsMediaFactory}),this.titleInput=this._createTitleInput(),this.textInput=this._createTextInput(),this.fileInput=this._createFileInput(),this.textEditor=s.inline(this.textInput,this._getCkEditorOptions())},render(){const{article:t,articleLanguage:e}=this.cmsStateMachine.getStateData();return n.requiredOfPrototype(t,r,"options.article must be an ArticleModel"),n.requiredOfType(e,"string","options.articleLanguage must be a string"),this.titleInput.setText(t.getTitle(e)||u.get("enterTitleHere")),this.textEditor.setData(t.getMessage(e)||u.get("editContentHere")),this.container.setContent([{tag:"div",class:"mpf-article-text-editor-input",html:[{tag:"div",class:"mpf-text-editor-header",html:[{tag:"span",class:"fonticon fonticon-newspaper mpf-editor-icon"},this.titleInput]},{tag:"div",class:"mpf-text-editor-main",html:[{tag:"div",class:"mpf-left-text-editor-column",html:[this.fileInput.render({article:t,articleLanguage:e})]},this.textInput]}]},{tag:"div",class:"mpf-error-container"}]),this},getTitle(){return this.titleInput.getText()},getText(){return this.textInput.getHTML()},validate(){return this._validateText()&&this._validateTitle()},destroy(){this._parent(),this.container=null},_validateTitle(){const t=this._getPureTextContent(this.getTitle());return t&&t!==u.get("enterTitleHere")?(this._removeError(),!0):(this._showError(u.get("requiredErrorMessage",{valueName:e.ucfirst(u.get("title"))})),!1)},_validateText(){const t=this._getPureTextContent(this.getText());return t&&t!==u.get("editContentHere")?(this._removeError(),!0):(this._showError(u.get("requiredErrorMessage",{valueName:e.ucfirst(u.get("articleContent"))})),!1)},_getPureTextContent:t=>(new window.DOMParser).parseFromString(t,"text/html").documentElement.textContent,_showError(t){this.container.getElement(".mpf-article-text-editor-input").addClassName("mpf-invalid"),this.container.getElement(".mpf-error-container").setText(t)},_removeError(){this.container.getElement(".mpf-article-text-editor-input").removeClassName("mpf-invalid"),this.container.getElement(".mpf-error-container").empty()},_onFileUpload({media:e,article:i}){const s=e.getPublicSrcUrl(),a=t.createElement("p",{class:"mpf-image-container",html:[{tag:"img",attributes:{src:s,"data-media-type":e.get(c.Fields.MEDIA_TYPE),"data-media-id":e.get("id"),loading:"lazy"}}]});this._insertAtCursonPosition(this.textEditor,a.outerHTML),this.mediaHelper.adjustThumbnailImage(i,this.textInput)},_insertAtCursonPosition(t,e){const i=s.dom.element.createFromHtml(e),a=t.getSelection(),n=a.getStartElement();if(n){a.selectElement(n);const t=a.getRanges();t&&t.length>0&&(t[0].setStart(n.getFirst(),0),t[0].setEnd(n.getFirst(),0))}t.insertElement(i)},_createTitleInput(){return t.createElement("div",{class:"mpf-article-title-input",attributes:{contenteditable:!0},events:{blur:this._validateTitle.bind(this)}})},_createTextInput(){return t.createElement("div",{class:"mpf-article-text-input",attributes:{contenteditable:!0},events:{blur:this._validateText.bind(this),paste:this._onPaste.bind(this)}})},_onPaste(t){const e=this.mediaHelper.filterFiles(t.clipboardData.files,"image");if(e.length>0){const t=e[0],{article:i,articleLanguage:s}=this.cmsStateMachine.getStateData();a.mask(this.container,u.get("uploadingImage")),this.mediaHelper.uploadMedia({file:t,article:i,articleLanguage:s}).then(t=>{this._onFileUpload({media:t,article:i}),a.unmask(this.container)}).catch(t=>{a.unmask(this.container),console.error(t)})}},_createFileInput(){const t=new d({cmsMediaFactory:this.cmsMediaFactory});return this.listenTo(t,d.Events.ON_UPLOAD,this._onFileUpload.bind(this)),t},_getCkEditorOptions:()=>({allowedContent:!0,disallowedContent:"script; *[on*]",toolbarGroups:[{name:"basicstyles"},{name:"links",groups:["links"]},{name:"paragraph",groups:["list","indent","blocks","align","bidi"]},{name:"styles"},{name:"colors"}]})})}),define("DS/MPFContentPublishing/ArticleEditor",["UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFCmsModel/CmsMediaFactory","DS/MPFCmsModel/ArticleModel","DS/MPFView/ConfirmationModal","DS/MPFContentPublishing/ArticleTextEditor","DS/MPFContentPublishing/SimpleTextInput","DS/MPFContentPublishing/CmsTaggerInput","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing"],function(t,e,i,s,a,n,r,o,c,l,h){"use strict";const d={CANCEL:"cancel",SAVE:"save",PUBLISH:"publish",DELETE:"delete"},u=t.extend({className:"mpf-page-content mpf-article-editor",setup:function(t={}){i.requiredOfPrototype(t.cmsStateMachine,s,"options.cmsStateMachine must be a CmsStateMachine"),i.requiredOfPrototype(t.cmsMediaFactory,a,"options.cmsMediaFactory must be a CmsMediaFactory"),this.cmsStateMachine=t.cmsStateMachine,this.cmsMediaFactory=t.cmsMediaFactory,this.textEditor=this._createTextEditor(),this.urlInput=this._createUrlInput(),this.linkInput=this._createLinkInput(),this.descriptionInput=this._createMetaDescriptionInput(),this.keywordsInput=this._createKeywordsInput(),this.confirmationModal=this._createConfirmationModal(),this.listenTo(this.cmsStateMachine,s.Changes.ARTICLE_LANGUAGE,this._onLanguageChange.bind(this))},render:function(){const{article:t,articleLanguage:i}=this.cmsStateMachine.getStateData();return this.container.setContent([this.confirmationModal.render(),this.textEditor.render(),this.urlInput.render({model:t}),this.linkInput.render({model:t}),this.descriptionInput.render({model:t}),this.keywordsInput.render({model:t}),{tag:"div",class:"mpf-footer",html:[new e({icon:"doc-delete",value:h.get("deleteLanguage"),disabled:!t.hasLanguage(i),events:{onClick:()=>{this.confirmationModal.setBody(h.get("doYouWantToDeleteLanguage")),this.stopListening(this.confirmationModal),this.listenTo(this.confirmationModal,r.Events.CONFIRM,this._deleteLanguage.bind(this,{article:t,articleLanguage:i})),this.confirmationModal.show()}}}),new e({icon:"docs-delete",value:h.get("deleteArticle"),disabled:t.isNew(),events:{onClick:()=>{this.confirmationModal.setBody(h.get("doYouWantToDeleteArticle")),this.stopListening(this.confirmationModal),this.listenTo(this.confirmationModal,r.Events.CONFIRM,this._deleteArticle.bind(this,{article:t})),this.confirmationModal.show()}}}),new e({value:h.get("back"),icon:"back",events:{onClick:()=>{t.isNew()?this.cmsStateMachine.changeState(s.States.VIEW_LIST):this.cmsStateMachine.changeState(s.States.VIEW_ARTICLE)}}}),new e({className:"primary",icon:t.isNew()?"share-alt":"floppy",value:t.isNew()?h.get("publish"):h.get("save"),events:{onClick:()=>{this._validate()&&(this._setModelValues(),t.setPublished(!0),this.dispatchEvent(t.isNew()?d.PUBLISH:d.SAVE,t))}}})]}]),this},destroy:function(){this.stopListening(),this.textEditor.destroy(),this.urlInput.destroy(),this.linkInput.destroy(),this.keywordsInput.destroy(),this.textEditor=null,this.urlInput=null,this.linkInput=null,this.keywordsInput=null,this.cmsStateMachine=null,this.cmsMediaFactory=null,this._parent(),this.container=null},_validate(){const t=this.urlInput.validate(),e=this.textEditor.validate();return t&&e},_setModelValues(){const{article:t,articleCategory:e,articleLanguage:i}=this.cmsStateMachine.getStateData();t.setTitle(i,this.textEditor.getTitle()),t.setMessage(i,this.textEditor.getText()),t.setCategory(e),t.setUrl(this.urlInput.getValue()),t.set(n.Fields.LINKS,this.linkInput.getValues()),t.set(n.Fields.META_DESCRIPTION,this.descriptionInput.getValue()),t.set(n.Fields.META_KEYWORDS,this.keywordsInput.getValues())},_onLanguageChange(){const{article:t}=this.cmsStateMachine.getStateData();t.isNew()||this.render()},_deleteLanguage({article:t,articleLanguage:e}){t.eraseMessage(e),this.confirmationModal.hide(),this.dispatchEvent(t.getLanguages().length>0?d.SAVE:d.DELETE,t)},_deleteArticle({article:t}){this.confirmationModal.hide(),this.dispatchEvent(d.DELETE,t)},_createConfirmationModal:()=>new r({header:h.get("confirmDeletion"),confirmButtonLabel:h.get("delete")}),_createTextEditor(){return new o({cmsStateMachine:this.cmsStateMachine,cmsMediaFactory:this.cmsMediaFactory})},_createUrlInput:()=>new c({name:n.Fields.URL,label:h.get("relativePageUrl"),placeholder:h.get("pleaseEnterARelativeUrl"),isRequired:!0}),_createLinkInput:()=>new l({name:n.Fields.LINKS,label:h.get("related3dSwymPosts"),placeholder:h.get("enterLinks")}),_createMetaDescriptionInput:()=>new c({name:n.Fields.META_DESCRIPTION,label:h.get("metaDescription"),placeholder:h.get("enterDescription"),rows:5}),_createKeywordsInput:()=>new l({name:n.Fields.META_KEYWORDS,label:h.get("metaKeywords"),placeholder:h.get("enterKeywords")})});return u.Events=Object.freeze(d),u}),define("DS/MPFContentPublishing/ContentPublishingPage",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFContentPublishing/CmsStateMachine","DS/MPFCmsModel/CommunityInfoModel","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/ArticleCollection","DS/MPFCmsModel/ArticleFactory","DS/MPFCmsModel/CmsMediaFactory","DS/MPFContentPublishing/TopBar","DS/MPFContentPublishing/CategoryMenu","DS/MPFContentPublishing/LanguageMenu","DS/MPFContentPublishing/ArticleList","DS/MPFContentPublishing/ArticleEditor","DS/MPFContentPublishing/ArticleView","i18n!DS/MPFContentPublishing/assets/nls/ContentPublishing","css!DS/MPFContentPublishing/MPFContentPublishing"],function(t,e,i,s,a,n,r,o,c,l,h,d,u,g,m,p,C,M){"use strict";const S={VIEW_ARTICLE:"viewArticle",EDIT_ARTICLE:"editArticle",VIEW_LIST:"viewList"},f=e.extend({className:"mpf-content-publishing",setup(t={}){a.requiredOfPrototype(t.cmsStateMachine,n,"options.cmsStateMachine must be a CmsStateMachine"),a.requiredOfPrototype(t.communityInfo,r,"options.communityInfo must be a CommunityInfoModel"),a.requiredOfPrototype(t.articles,c,"options.articles must be an ArticleCollection"),a.requiredOfPrototype(t.articleFactory,l,"options.articleFactory must be an ArticleFactory"),a.requiredOfPrototype(t.cmsMediaFactory,h,"options.cmsMediaFactory must be a CmsMediaFactory"),this.cmsStateMachine=t.cmsStateMachine,this.communityInfo=t.communityInfo,this.articles=t.articles,this.articleFactory=t.articleFactory,this.cmsMediaFactory=t.cmsMediaFactory,this.isOperatorView=!0===t.isOperatorView,this.isDebugMode=!0===t.isDebugMode,this.topBar=this._createTopBar(),this.categoryMenu=this._createCategoryMenu(),this.languageMenu=this._createLanguageMenu(),this.articleView=this._createArticleView(),this.articleEditor=this._createArticleEditor(),this.articleList=this._createArticleList(),this.leftColumn=this._createLeftColumn(),this.mainPanel=this._createMainPanel(),this.alert=this._createAlert(),this.listenTo(this.cmsStateMachine,n.Changes.STATE,this.render.bind(this))},render(){let t;const{state:e,article:i}=this.cmsStateMachine.getStateData();return e===S.VIEW_LIST?(this.leftColumn.setContent([this.categoryMenu.render(),this.languageMenu.render()]),this.mainPanel.setContent([this.leftColumn,this.articleList.render()]),t=[this.mainPanel]):e===S.VIEW_ARTICLE?(i.getLanguages().length>1?(this.leftColumn.setContent(this.languageMenu.render()),this.articleView.container.removeClassName("mpf-full-width")):(this.leftColumn.empty(),this.articleView.container.addClassName("mpf-full-width")),this.mainPanel.setContent([this.leftColumn,this.articleView.render()]),t=[this.topBar.render(),this.mainPanel]):e===S.EDIT_ARTICLE&&(this.leftColumn.setContent([this.categoryMenu.render(),this.languageMenu.render()]),this.mainPanel.setContent([this.leftColumn,this.articleEditor.render()]),t=[this.mainPanel]),this.container.setContent([this.alert,t]),this.isDebugMode&&this.dispatchEvent("rendered"),this},refresh(){return Promise.all([this.communityInfo.fetchPromise(),this.articles.fetchPromise()]).then(()=>{this.render()})},destroy(){this.stopListening(),this.topBar.destroy(),this.categoryMenu.destroy(),this.languageMenu.destroy(),this.articleView.destroy(),this.articleEditor.destroy(),this.articleList.destroy(),this.cmsStateMachine.destroy(),this.cmsStateMachine=null,this.articles=null,this.communityInfo=null,this._parent(),this.container=null},_saveArticle(t){i.mask(this.container);const e=t.isNew();return t.savePromise().then(()=>e?this.articles.fetchPromise():Promise.resolve()).then(()=>{i.unmask(this.container),this.alert.add({className:"success",message:M.get("savedChanges")})}).catch(t=>{console.log(t),i.unmask(this.container),this.alert.add({className:"error",message:M.get("failedToSaveModifications")}).show()})},_createTopBar(){return new d({cmsStateMachine:this.cmsStateMachine,isOperatorView:this.isOperatorView})},_createCategoryMenu(){return new u({cmsStateMachine:this.cmsStateMachine,communityInfo:this.communityInfo,articles:this.articles,isOperatorView:this.isOperatorView})},_createLanguageMenu(){return new g({cmsStateMachine:this.cmsStateMachine,articles:this.articles,isOperatorView:this.isOperatorView})},_createArticleView(){return new C({cmsStateMachine:this.cmsStateMachine})},_createArticleEditor(){const t=new p({cmsStateMachine:this.cmsStateMachine,cmsMediaFactory:this.cmsMediaFactory});return this.listenTo(t,p.Events.SAVE,t=>this._saveArticle(t).then(()=>this.render())),this.listenTo(t,p.Events.DELETE,t=>{i.mask(this.container),t.destroyPromise().then(this.articles.fetchPromise.bind(this.articles)).then(()=>{i.unmask(this.container),this.cmsStateMachine.changeState(n.States.VIEW_LIST)}).catch(t=>{i.unmask(this.container),console.error(t)})}),this.listenTo(t,p.Events.PUBLISH,t=>{this._saveArticle(t).then(this.articles.fetchPromise()).then(()=>{this.cmsStateMachine.changeState(n.States.VIEW_LIST)})}),t},_createArticleList(){const t=new m({cmsStateMachine:this.cmsStateMachine,articles:this.articles,cmsMediaFactory:this.cmsMediaFactory,isOperatorView:this.isOperatorView});return this.listenTo(t,m.Events.ADD_ARTICLE,()=>{const t=this.articleFactory.createModel(this.isOperatorView?l.Types.SWYM:l.Types.ARTICLE,{[o.Fields.COMMUNITY_ID]:this.communityInfo.get(r.Fields.COMMUNITY_ID)});this.cmsStateMachine.changeState(n.States.EDIT_ARTICLE,{article:t})}),t},_createLeftColumn:()=>t.createElement("div",{class:"mpf-left-column"}),_createMainPanel:()=>t.createElement("div",{class:"mpf-main-panel"}),_createAlert:()=>new s({autoHide:!0,visible:!1})});return f.States=Object.freeze(S),f}),define("DS/MPFContentPublishing/ContentPublishingFactory",["DS/MPFConnector/MarketplaceConnector","DS/MPFConnector/ConnectorBackend","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCmsModel/CommunityInfoFactory","DS/MPFCmsModel/CmsMediaFactory","DS/MPFCmsModel/ArticleFactory","DS/MPFCmsModel/ArticleModel","DS/MPFCmsModel/CommunityInfoModel","DS/MPFContentPublishing/CmsStateMachine","DS/MPFContentPublishing/ContentPublishingPage"],function(t,e,i,s,a,n,r,o,c,l,h){"use strict";return class{static createPage({rootPath:t,communityId:e,user:s="3dprint_operator",isOperatorView:a=!1,service:n=i.MAKE}){return this._fetchConnectors({service:n}).then(this._getFactories.bind(this,{isOperatorView:a})).then(this._initAndFetchModels.bind(this,{rootPath:t,communityId:e,user:s,isOperatorView:a})).then(this._initContentPublishingPage.bind(this,{isOperatorView:a,rootPath:t})).catch(t=>{console.error("Cannot initiate ContentPublishingComponent!"),console.error(t)})}static _fetchConnectors({service:s}){return Promise.all([t.fetchPromise({service:s}),t.fetchPromise({service:i.NONE,backend:e.SWYM})])}static _getFactories({isOperatorView:t},[e,i]){const a=s.getInstance(e),r=s.getInstance(i);return Promise.all([a.getFactory(s.Types.COMMUNITY_INFO),t?r.getFactory(s.Types.ARTICLE):a.getFactory(s.Types.ARTICLE),new n({swymConnector:i,marketplaceConnector:e})])}static _initAndFetchModels({communityId:t,user:e,isOperatorView:i,rootPath:s},[n,h,d]){const u=n.createModel(i?a.Types.OPERATOR:a.Types.PUBLIC,{[c.Fields.USER]:e});return u.fetchPromise().then(()=>{if(i&&t&&!u.getCommunityId())return u.set([c.Fields.COMMUNITY_ID],t),u.savePromise()}).then(()=>{const t=h.createCollection(i?r.Types.SWYM:r.Types.PUBLIC),e=u.getCommunityId();return e&&t.setParentResourceId(e),t.fetchPromise({parse:!0})}).then(t=>{const{state:e,articleUrl:a}=l.getStateFromUrl(s);let n;return e!==l.States.VIEW_ARTICLE&&e!==l.States.EDIT_ARTICLE||(n=t.findWhere({[o.Fields.URL]:a}),i&&!n&&(n=h.createModel(r.Types.SWYM,{[o.Fields.COMMUNITY_ID]:u.getCommunityId()}))),[u,e,t,n,h,d]})}static _initContentPublishingPage({isOperatorView:t,rootPath:e},[i,s,a,n,r,o]){const c=new l({rootPath:e,state:s,isOperatorView:t,articles:a,article:n});return new h({cmsStateMachine:c,communityInfo:i,articles:a,article:n,articleFactory:r,cmsMediaFactory:o,isOperatorView:t})}}});