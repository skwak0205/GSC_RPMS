define("DS/FlyWalkCommand/BrowserInfos",[],function(){"use strict";var e=!!(navigator.userAgent.match(/(Android|iPhone)/i)||(/iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream);return{isMobile:function(){return e}}}),define("DS/FlyWalkCommand/l_FlyWalkCmd",["DS/ApplicationFrame/Command","css!DS/FlyWalkCommand/FlyWalkCmd","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Selection/PSOManager","DS/Controls/Slider","DS/FlyWalkUI/FlyWalkContextualBarManager","DS/FlyWalkNavigation/NavigationService","DS/CoreEvents/Events","DS/ApplicationFrame/CommandCheckHeader","DS/ApplicationFrame/CommandsManager","DS/Utilities/Dom","DS/CoreEvents/Events","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/RuntimeView/NLSManager","DS/FlyWalkCommand/BrowserInfos","DS/FlyWalkUI/CollisionSettingsPanel","DS/FlyWalkUI/CollisionAssistanceUI","DS/FlyWalkInfra/CollisionPrefStorageCtlr","DS/Visualization/ThreeJS_DS","DS/Utilities/TouchUtils","DS/FlyWalkInfra/VisNavigationContext","UWA/Class","DS/Usage/TrackerAPI","i18n!DS/FlyWalkCommand/assets/nls/translation"],function(e,t,i,n,o,a,s,l,r,d,c,h,u,v,C,_,g,p,S,m,k,y,W,f,F,M){"use strict";localStorage.getItem("WalkCollisionON");var w,x=!1;if(void 0!==typeof window.top.require)try{window.top.require(["DS/UWPClientCode/PublicAPI"],function(e){x="true"===e.getApplicationConfiguration("app.build.isCloud")})}catch(e){}const A={Default:0,FlyWalkCommand_Start:1,FlyWalkCommand_End:2,FlyWalkCollision_Start:3,FlyWalkCollision_End:4,FlyWalkLoadBox_Request:5};return f.extend({init:function(e){this._previousProjection=-1,this.panelValue=!1,this.navigationCtx=e.navigCtx,this._onExitUserCB=e.onExitCB,this._isCmdActive=!1,this._forceUIHideRequests=0;var t=this;this.onOverrideChangeID=u.subscribe({event:"/VISU/onFlyWalkStateOverride"},function(e){t._onStateOverride(e)}),this.startHelpContainer=null,this.StartHelpText="Hold left mouse button to fly",this.DontShowText="Don't show again",this.navigationCmdList=["VisuZoomView","VisuPanView","VisuRotateView","VisuReframeView"],this.projectionCmdList=["VisuPerspectiveView","VisuOrthographicView"],this.sliderInChange=!1,this.currentSliderval=0,this.isOnCloud=!1,this._isPodAuthorized=!0,this._cmdStartTime=0,this._collisionOnStartTime=0},_onFlyWalkCommandStart:function(){x&&(this.isOnCloud=!0),this._setPerspectiveMode(),this.navigationCtx.isWAFR_V2||this._disableProjectionCmds(),this._beginExecute(),this._isCmdActive=!0},_onFlyWalkCommandExit:function(){!1!==this._isCmdActive&&(this._isCmdActive=!1,this.endExecute(),this._enableProjectionCmds(),this._restoreProjectionType())},_beginExecute:function(){var e=this;w=this,this.collisionPrefPanel&&this.collisionPrefPanel.destroy(),this.collisionPrefPanel=null,this.viewpointEndMoveCBToken=null,i.empty(),n.empty(),o.empty(),this.navgationService=new l({navigCtx:this.navigationCtx,setSelectionCallBack:this._updateButtonState,speedSliderCB:this.speedSliderCB,updateHeightSlider:this.updateHeightSlider,isOnCloud:this.isOnCloud,turnOfCollisionCB:function(){e._turnOffCollision(!0)},updateTopMsgCB:function(t){e._updateTopMsg(t)},sendUsageEvtCB:function(){e._sendUsageEvents(A.FlyWalkLoadBox_Request)}});var t=!1;"ontouchstart"in document.documentElement&&(t=!0),this._collisionAssistanceTopUI=new S(this.navigationCtx.UIFrame_V1),this._collisionAssistanceTopUI.buildSelf(),this.navgationService.beginNavigation({touchMode:t}),"Fly"===e.navgationService.NAVIGATION_MODE?this.navgationService.levelViewpointWithVerticalAxis():"Walk"===e.navgationService.NAVIGATION_MODE&&(this.navgationService.centerToObject(),this.navgationService.levelViewpointWithVerticalAxis(),this._testForAuthorization()),this.displayStartHelp(),!0===m.getValue("InitialPositionMode")&&this._repositionAvatarOnPick(),this._displayRightContextualMenu(!0,t),this._cmdStartTime=(new Date).getTime(),this._sendUsageEvents(A.FlyWalkCommand_Start)},endExecute:function(){if(this.navgationService.getCollisionState()){var e=((new Date).getTime()-this._collisionOnStartTime)/1e3;this._sendUsageEvents(A.FlyWalkCollision_End,e)}var t=((new Date).getTime()-this._cmdStartTime)/1e3;if(this._sendUsageEvents(A.FlyWalkCommand_End,t),this._cmdStartTime=0,this._collisionOnStartTime=0,this.currentSliderval=0,this.sliderInChange=!1,this.navgationService.endNavigation(),this.navgationService=void 0,this._destroyWalkHeightSlider(),this._destroySpeedSlider(),this._displayRightContextualMenu(!1),this.destroyStartHelp(),this.viewpointEndMoveCBToken=null,this._collisionAssistanceTopUI&&(this._collisionAssistanceTopUI.destroy(),this._collisionAssistanceTopUI=null),this.collisionPrefPanel&&this.collisionPrefPanel.destroy(),this.collisionPrefPanel=null,this.navigationCtx.isWAFR_V2||this._enableNavigationCmds(),!this.navigationCtx.isWAFR_V2){var i=this.navigationCtx.frameWindow.getActionBar();i.open(),i.MAB&&i.MAB.showFlyout(0)}},_displayRightContextualMenu:function(e,t){var i=this;if(e){function n(){i.collisionPrefPanelButton&&i.collisionPrefPanelButton.uncheck(),i.collisionPrefPanel=null}function o(){i.navgationService.applyCollisionPref()}function a(e){i._verifyPickedPoint(e)}function l(e){i.navgationService&&(e?i.navgationService.unhideNodesAfterCollision():i.navgationService.hideNodesForCollision())}this._contextualMenu=new s({navigCtx:this.navigationCtx,custompanelValue:this.panelValue});var r=!1;y&&y.getTouchMode()&&(r=!0);var d=[{type:i._contextualMenu.Button.Master,onclickCB:function(){i._onFlyWalkCommandExit(),i._onExitUserCB&&i._onExitUserCB()},id:"ExitNavigation",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"},{type:i._contextualMenu.Button.MasterCheck,onclickCB:function(e){"Walk"===i.navgationService.NAVIGATION_MODE&&i.reloadWalkMode(),!1===e.state?(i.navgationService.endTouchModeNavigation(),i.navgationService.beginMouseModeNavigation()):(i.navgationService.endMouseModeNavigation(),i.navgationService.beginTouchModeNavigation())},id:"TouchMode",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu",selected:!0===t},{type:i._contextualMenu.Button.Radio,onclickCB:function(e){if("Fly"===e.id&&"Fly"!=i.navgationService.NAVIGATION_MODE)m.setValue("NavigationMode","Fly"),m.setValue("CollisionMode",!1),m.commit(),i.navgationService.setNavigationMode("Fly"),i._displayWalkHeightSlider(!1),i._displaySpeedSlider(!1),i._updateButtonState("SpeedSettings",!1),i.isOnCloud&&(i._updateButtonState("CollisionToggle",!1),i._contextualMenu.setButtonVisibility("CollisionToggle",!1)),i.isOnCloud&&r&&(i._contextualMenu.setButtonVisibility("StepBack",!1),i._contextualMenu.setButtonVisibility("AvatarCrouch",!1)),i.navgationService.getCollisionState()&&i._setCollisionMode(!1),i.navgationService.levelViewpointWithVerticalAxis(),i.destroyStartHelp(),i.displayStartHelp();else if("Walk"===e.id&&"Walk"!=i.navgationService.NAVIGATION_MODE){if(m.setValue("NavigationMode","Walk"),m.setValue("CollisionMode",!1),m.commit(),i.navgationService.NAVIGATION_MODE="Walk",i._displaySpeedSlider(!1),i._displayWalkHeightSlider(!0),i._updateButtonState("SpeedSettings",!1),!0===i.isOnCloud){var t=m.getValue("CollisionMode"),n=m.getValue("InitialPositionMode");i._contextualMenu.setButtonVisibility("CollisionToggle",!0),i._updateButtonState("CollisionToggle",t),r&&(i._contextualMenu.setButtonVisibility("StepBack",!0),i._contextualMenu.setButtonVisibility("AvatarCrouch",!0)),i._setCollisionModeWithInit(t,n)}i.navgationService.centerToObject(),i.navgationService.levelViewpointWithVerticalAxis(),i.destroyStartHelp(),i.displayStartHelp(),i._testForAuthorization()}},content:[{id:"Fly",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu",selected:"Fly"===i.navgationService.NAVIGATION_MODE},{id:"Walk",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu",selected:"Walk"===i.navgationService.NAVIGATION_MODE}]},{type:i._contextualMenu.Button.Check,onclickCB:function(e){e.state?(i._displaySpeedSlider(!1),i.navgationService&&"Walk"===i.navgationService.NAVIGATION_MODE&&i._displayWalkHeightSlider(!0),i._updateButtonState("SpeedSettings",!1),i.navgationService.levelViewpointWithGround(),i.uncheck=e.uncheck,setTimeout(function(){i.uncheck()},1e3)):e.uncheck()},id:"GroundLevel",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"},{type:i._contextualMenu.Button.Check,onclickCB:function(e){e.state?(i._displaySpeedSlider(!0),i._displayWalkHeightSlider(!1)):(i._displaySpeedSlider(!1),i.navgationService&&"Walk"===i.navgationService.NAVIGATION_MODE&&i._displayWalkHeightSlider(!0))},id:"SpeedSettings",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"},this.isOnCloud?{type:i._contextualMenu.Button.Check,onclickCB:function(e){!0===e.state?m.setValue("CollisionMode",!0):!1===e.state&&m.setValue("CollisionMode",!1),m.commit();var t=m.getValue("InitialPositionMode");i._setCollisionModeWithInit(e.state,t)},id:"CollisionToggle",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"}:{},
/*!this.collisionUIShow ? {} :
          {
            // Check button for collision toggle with init position
            type: _this._contextualMenu.Button.Check,
            onclickCB: function (e) {
              _this._updateButtonState("CollisionToggle", false);
              _this._collisionWithInitToggleCB(e);
            },
            id: 'CollisionWithInitToggle', // init position, feet on ground, collision check & activation
            rsc: 'FlyWalkCommand/FlyWalkCmdMenu',
            nls: 'FlyWalkCommand/FlyWalkCmdMenu'
          },*/
{type:i._contextualMenu.Button.Check,onclickCB:function(e){if(i.collisionPrefPanelButton=e,!0===e.state){var t={navigCtx:i.navigationCtx,userCloseCB:n,applyCB:o,verifyPickedPointCB:a,setNodesVisibilityCB:l,isOnCloud:i.isOnCloud&&i._isPodAuthorized,isPointCloudMode:i.navgationService._isPointCloud()};i.collisionPrefPanel=new p(t),i.collisionPrefPanel.buildSelf()}else i.collisionPrefPanel&&(i.collisionPrefPanel.destroy(),i.collisionPrefPanel=null)},id:"CollisionSettings",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"},this.isOnCloud&&r?{type:i._contextualMenu.Button.Check,onclickCB:function(e){i.navgationService&&i.navgationService.stepBack(),e.uncheck()},id:"StepBack",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"}:{},this.isOnCloud&&r?{type:i._contextualMenu.Button.Check,onclickCB:function(e){i.navgationService&&i.navgationService.crouch(),e.uncheck()},id:"AvatarCrouch",rsc:"FlyWalkCommand/FlyWalkCmdMenu",nls:"FlyWalkCommand/FlyWalkCmdMenu"}:{}];if(d=d.filter(function(e){if(0!==Object.keys(e).length)return e}),this._contextualMenuToken=this._contextualMenu.addButtons(d,{barType:this._contextualMenu.Toolbar.New,showContextBarBackground:!0}),"Fly"===this.navgationService.NAVIGATION_MODE)this._contextualMenu.setButtonVisibility("CollisionToggle",!1),this.isOnCloud&&r&&(this._contextualMenu.setButtonVisibility("StepBack",!1),this._contextualMenu.setButtonVisibility("AvatarCrouch",!1));else if("Walk"===this.navgationService.NAVIGATION_MODE&&(this._updateButtonState("Walk",!0),this._displayWalkHeightSlider(!0),!0===i.isOnCloud)){if(this._contextualMenu.setButtonVisibility("CollisionToggle",!0),this.navgationService.getCollisionState()){this._updateButtonState("CollisionToggle",!0);var c=m.getValue("InitialPositionMode");i._setCollisionModeWithInit(!0,c)}this._testForAuthorization(),r&&(i._contextualMenu.setButtonVisibility("StepBack",!0),i._contextualMenu.setButtonVisibility("AvatarCrouch",!0))}}else this._contextualMenu.removeButtons(this._contextualMenuToken),this._contextualMenu.dispose(),this._contextualMenu=void 0},_createWalkHeightSlider:function(){var e=this;if(!this._walkHeightSliderContainer){var t=void 0;this.navigationCtx.isWAFR_V2||(t=this.navigationCtx.frameWindow.getActionBar()),t&&t.MAB&&t.MAB.state&&1==t.MAB.state.visible?this._walkHeightSliderContainer=UWA.createElement("div",{id:"PlayWeb-slider-container_MAB","pointer-events":"none"}).inject(this.navigationCtx.UIFrame_V1):(this._walkHeightSliderContainer=UWA.createElement("div",{id:"PlayWeb-slider-container","pointer-events":"none"}).inject(this.navigationCtx.UIFrame_V1),this.panelValue&&this.addToPanelContainer(this._walkHeightSliderContainer)),this._walkHeightSliderContainer&&(h.addEventOnElement(this,this._walkHeightSliderContainer,"keydown",function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},!0),h.addEventOnElement(this,this._walkHeightSliderContainer,"keyup",function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},!0)),this._walkSlider=new a({minValue:-100,maxValue:100,stepValue:1,value:e.navgationService._heightConstraint,displayStyle:"vertical"}).inject(this._walkHeightSliderContainer),this._walkSlider.addEventListener("change",function(t){if(!e.sliderInChange){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0;var i=t.dsModel;e.navgationService._heightConstraint=i.value,e.navgationService.updateHeightNew(i.value,e.currentSliderval),e.currentSliderval=i.value}})}},_displayWalkHeightSlider:function(e){var t=this;e?(this._createWalkHeightSlider(),this._walkHeightSliderContainer.show(),this._walkSlider.addEventListener("endEdit",function(e){t._onSliderUp()})):this._walkHeightSliderContainer&&this._walkHeightSliderContainer.hide()},_destroyWalkHeightSlider:function(){this._displaySpeedSlider(!1),this._walkHeightSliderContainer&&this._walkHeightSliderContainer.destroy(),this._walkHeightSliderContainer=void 0,this._walkSlider&&this._walkSlider.destroy(),this._walkSlider=void 0},reloadWalkMode:function(){this._displaySpeedSlider(!1),this._displayWalkHeightSlider(!0),this.navgationService.centerToObject(),this.navgationService.levelViewpointWithGround(),this.navgationService.testForAuthorization()},addToPanelContainer:function(e){var t=this._contextualMenu.customWindowsPanel;if(t&&e){var i=t.content;i&&i.addContent(e)}else console.log("Error log!! No cuatom windpws panel or No HTML content to add ")},_createSpeedSlider:function(){var e=this;if(!this._speedSliderContainer){var t=void 0;this.navigationCtx.isWAFR_V2||(t=this.navigationCtx.frameWindow.getActionBar()),t&&t.MAB&&t.MAB.state&&1==t.MAB.state.visible?this._speedSliderContainer=UWA.createElement("div",{id:"PlayWeb-speed-slider-container_MAB","pointer-events":"none"}).inject(this.navigationCtx.UIFrame_V1):(this._speedSliderContainer=UWA.createElement("div",{id:"PlayWeb-speed-slider-container","pointer-events":"none"}).inject(this.navigationCtx.UIFrame_V1),this.panelValue&&this.addToPanelContainer(this._speedSliderContainer)),this._speedSliderContainer&&(h.addEventOnElement(this,this._speedSliderContainer,"keydown",function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},!0),h.addEventOnElement(this,this._speedSliderContainer,"keyup",function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},!0)),this._speedSlider=new a({minValue:1,maxValue:100,stepValue:1,value:e.navgationService.getNavigationSpeed(),displayStyle:"vertical"}).inject(this._speedSliderContainer),this._speedSlider.addEventListener("change",function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0;var i=t.dsModel;e.navgationService.setNavigationSpeed(i.value)})}},_displaySpeedSlider:function(e){e?(this._createSpeedSlider(),this._speedSliderContainer.show()):this._speedSliderContainer&&this._speedSliderContainer.hide()},_destroySpeedSlider:function(){this._displaySpeedSlider(!1),this._speedSliderContainer&&this._speedSliderContainer.destroy(),this._speedSliderContainer=void 0,this._speedSlider&&this._speedSlider.destroy(),this._speedSlider=void 0},speedSliderCB:function(e){w._speedSlider&&(w._speedSlider.value=e)},updateHeightSlider:function(e){w._walkSlider&&(w._walkSlider.value=w._walkSlider.value+e)},_disableProjectionCmds:function(){for(let t=0;t<this.projectionCmdList.length;t++){var e=c.getCommand(this.projectionCmdList[t],"Default");e&&e.disable()}},_enableProjectionCmds:function(){for(let t=0;t<this.projectionCmdList.length;t++){var e=c.getCommand(this.projectionCmdList[t],"Default");e&&e.enable()}},_disableNavigationCmds:function(){for(let t=0;t<this.navigationCmdList.length;t++){var e=c.getCommand(this.navigationCmdList[t],"Default");e&&e.disable()}},_enableNavigationCmds:function(){for(let t=0;t<this.navigationCmdList.length;t++){var e=c.getCommand(this.navigationCmdList[t],"Default");e&&e.enable()}},_setPerspectiveMode:function(){if(this.navigationCtx.visViewer){var e=this.navigationCtx.visViewer.currentViewpoint.getProjectionType();1===e&&(this._previousProjection=e,this.navigationCtx.visViewer.currentViewpoint.setProjectionType(0))}},_restoreProjectionType:function(){this.navigationCtx.visViewer&&-1!=this._previousProjection&&this.navigationCtx.visViewer.currentViewpoint.setProjectionType(this._previousProjection),this._previousProjection=-1},_onStateOverride:function(e){e&&"@onFlyWalkStateOverride"===e.eventType&&e.viewer===this.navigationCtx.visViewer&&void 0!==e.forceHideUI&&null!==e.forceHideUI&&(!0===e.forceHideUI?(this._forceUIHideRequests=this._forceUIHideRequests+1,this._isCmdActive&&this._hideUI()):!1===e.forceHideUI&&(this._forceUIHideRequests=this._forceUIHideRequests-1,0===this._forceUIHideRequests&&this._isCmdActive&&this._showUI()))},_hideUI:function(){this._contextualMenu&&this._contextualMenu.panel&&this._contextualMenu.panel.container&&this._contextualMenu.panel.container.setStyles({display:"none"}),void 0!==this._speedSliderContainer&&null!==this._speedSliderContainer&&void 0!==this._speedSlider&&null!==this._speedSlider&&(this._speedSliderContainer.hide(),this._speedSlider.hide()),void 0!==this._walkHeightSliderContainer&&null!==this._walkHeightSliderContainer&&void 0!==this._walkSlider&&null!==this._walkSlider&&(this._walkHeightSliderContainer.hide(),this._walkSlider.hide()),this.destroyStartHelp()},_showUI:function(){this._contextualMenu&&this._contextualMenu.panel&&this._contextualMenu.panel.container&&this._contextualMenu.panel.container.setStyles({display:"block"}),void 0!==this._speedSlider&&null!==this._speedSlider&&void 0!==this._speedSliderContainer&&null!==this._speedSliderContainer?(this._speedSliderContainer.show(),this._speedSlider.show()):void 0!==this._walkHeightSliderContainer&&null!==this._walkHeightSliderContainer&&void 0!==this._walkSlider&&null!==this._walkSlider&&(this._walkHeightSliderContainer.show(),this._walkSlider.show())},displayStartHelp:function(){if(!1===g.isMobile()&&(window.innerHeight>=1024||window.innerWidth>=1024)&&(window.innerHeight>=768||window.innerWidth>=768)&&!localStorage.getItem("VisuFlyNoHelp",!0)){var e=!1;"ontouchstart"in document.documentElement&&(e=!0),this.StartHelpText=e?M.StartHelp_Touch:M.StartHelp,"Fly"===this.navgationService.getNavigationMode()?this.StartHelpText=this.StartHelpText+" "+M.FlyText:this.StartHelpText=this.StartHelpText+" "+M.WalkText,this.DontShowText=M.DontShow,this.StartHelpText&&this.StartHelpText.length>0&&this.DontShowText&&this.DontShowText.length>0&&this.showStartingHelp(e)}},showStartingHelp:function(e){var t=C.getWebappsBaseUrl();this.startHelpContainer=UWA.createElement("div",{class:"wux-container"}).inject(this.navigationCtx.UIFrame_V1),this.startHelpContainer.setStyles({height:"30px",top:"0px",backgroundColor:"#FFFFFF","text-align":"center"}),e&&this.startHelpContainer.setStyles({height:"40px"});new UWA.Element("img",{src:t+"FlyWalkCommand/assets/icons/32/I_VisuFlyHelp.png"}).inject(this.startHelpContainer);new UWA.Element("label",{class:"wux-container",text:this.StartHelpText}).inject(this.startHelpContainer).setStyles({fontSize:"small",margin:"0% 0% 0% 0.6%"});var i=new v({label:this.DontShowText}).inject(this.startHelpContainer);i.getContent().setStyles({position:"absolute",right:"4%"});var n=new v({displayStyle:"lite",icon:{iconName:"close",fontIconFamily:WUXManagedFontIcons.Font3DS}}).inject(this.startHelpContainer);n.getContent().setStyles({position:"absolute",right:"1%"});var o=this;i.addEventListener("buttonclick",function(){localStorage&&(localStorage.setItem("VisuFlyNoHelp",!0),o.destroyStartHelp())}),n.addEventListener("buttonclick",function(){o.destroyStartHelp()})},destroyStartHelp:function(){this.startHelpContainer&&(this.startHelpContainer.remove(),this.startHelpContainer=null)},_repositionAvatarOnPick:function(){var e=m.getValue("SavedPosition"),t=new k.Vector3;t.x=e[0],t.y=e[1],t.z=e[2],this.navgationService.repositionAvatar(t)},_repositionAvatarOnGround:function(){let e=this.navgationService.getGroundDistanceFromAvatar();return e?(this.navgationService.repositionAvatarOnGround(e),e):null},_turnOffCollision:function(e){this.navgationService.getCollisionState()&&(this._updateButtonState("CollisionToggle",!1),this._setCollisionMode(!1))},_updateButtonState:function(e,t){var i={id:e,state:t};this._contextualMenu&&this._contextualMenu.setSelected(i)},_updateTopMsg:function(e){this._collisionAssistanceTopUI&&e&&("Unauthorized_Pod"===e?(this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Unauthorized_Pod),this._collisionAssistanceTopUI.show()):"Server_Error"==e?(this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Server_Error),this._collisionAssistanceTopUI.show()):e&&(e.blockedByPit||e.insideMesh||e.blockedByCorner)?(e.insideMesh?this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Stuck):e.blockedByPit?this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.No_Floor):e.blockedByHead?this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Crouch):e.blockedByCorner&&this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Stopped_Ahead),this._collisionAssistanceTopUI.show()):e&&null!=e.boxLoading?e.boxLoading?(this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Wait_For_Loading),this._collisionAssistanceTopUI.show()):this._collisionAssistanceTopUI.getCurrentMode()==S.AssistanceMsg.Wait_For_Loading&&this._collisionAssistanceTopUI.hide():this._collisionAssistanceTopUI.getCurrentMode()!=S.AssistanceMsg.Wait_For_Loading&&this._collisionAssistanceTopUI.hide())},_setCollisionModeWithInit:function(e,t){e?(t&&this._repositionAvatarOnPick(),this._repositionAvatarOnGround()?this._setCollisionMode(!0):(this._setCollisionMode(!0),this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.No_Floor_Collision_Activated),this._collisionAssistanceTopUI.show())):this._setCollisionMode(!1)},_setCollisionMode:function(e){if(e){let e=this;this.navgationService.setCollisionState(!0),this._disableNavigationCmds(),this._collisionOnStartTime=(new Date).getTime(),this._sendUsageEvents(A.FlyWalkCollision_Start);let t=function(t){e._collisionAssistanceTopUI&&(t.blocked?e._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Completely_Collided):t.status?e._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Partially_Collided,t):e._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.All_OK),e._collisionAssistanceTopUI.show())};this.navgationService.checkCollisionAround(t).waiting&&(e._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Wait_For_Loading),e._collisionAssistanceTopUI.show())}else{this.navgationService.setCollisionState(!1),this._enableNavigationCmds();var t=((new Date).getTime()-this._collisionOnStartTime)/1e3;this._sendUsageEvents(A.FlyWalkCollision_End,t),this._collisionOnStartTime=0,this._collisionAssistanceTopUI&&(this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Turned_Off),this._collisionAssistanceTopUI.show())}},_verifyPickedPoint:function(e){if(e){var t=this.navgationService.getGravityVector().multiplyScalar(-1),i=e.normal.clone();t.angleTo(i)>.6981&&this._collisionAssistanceTopUI&&(this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.Select_Correct_Surface),this._collisionAssistanceTopUI.show())}},_onSliderUp:function(){this.navgationService.getCollisionState()&&(this.navgationService.setCollisionState(!1),this._repositionAvatarOnGround()?this._setCollisionMode(!0):(this._collisionAssistanceTopUI.updateMessage(S.AssistanceMsg.No_Floor_No_Collision),this._collisionAssistanceTopUI.show()));this.sliderInChange=!0,this._walkSlider.value=0,this.currentSliderval=0,this.sliderInChange=!1},_testForAuthorization:function(){if(this.isOnCloud){this._isPodAuthorized=!0;var e=this;let t=function(t){e._contextualMenu.setButtonVisibility("CollisionToggle",!1),e._setCollisionModeWithInit(!1),e._isPodAuthorized=!1,e._updateTopMsg("Unauthorized_Pod")};this.navgationService.testForAuthorization(t)}},_sendUsageEvents:function(e,t){if(F)switch(e){case A.FlyWalkCommand_Start:F.trackPageEvent({eventCategory:"WebNavigationFlyWalkCommand",eventAction:"FlyWalkCommand_Start",eventLabel:"FlyWalkCommandStart",appID:"WebNavigationCommands"});break;case A.FlyWalkCommand_End:F.trackPageEvent({eventCategory:"WebNavigationFlyWalkCommand",eventAction:"FlyWalkCommand_End",eventValue:t,eventLabel:"FlyWalkCommandEnd",appID:"WebNavigationCommands"});break;case A.FlyWalkCollision_Start:F.trackPageEvent({eventCategory:"WebNavigationFlyWalkCommand",eventAction:"FlyWalkCollision_Start",eventLabel:"FlyWalkCollisionStart",appID:"WebNavigationCommands"});break;case A.FlyWalkCollision_End:F.trackPageEvent({eventCategory:"WebNavigationFlyWalkCommand",eventAction:"FlyWalkCollision_End",eventValue:t,eventLabel:"FlyWalkCollisionEnd",appID:"WebNavigationCommands"});break;case A.FlyWalkLoadBox_Request:F.trackPageEvent({eventCategory:"WebNavigationFlyWalkCommand",eventAction:"FlyWalkLoadBox_Request",eventLabel:"FlyWalkLoadBoxRequest",appID:"WebNavigationCommands"})}}})}),define("DS/FlyWalkCommand/FlyWalkCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/FlyWalkCommand/l_FlyWalkCmd","DS/FlyWalkInfra/VisNavigationContext"],function(e,t,i){"use strict";return e.extend({init:function(e){this._parent(e,{}),this.options=e,this.onStateChange(function(){this.getState()?(this._onFlyWalkCommandStart(),this._forceUIHideRequests>0&&this._hideUI()):this._onFlyWalkCommandExit()}),this.navigationCtx=null,this._l_FlyWalkCmd=null,this._initializeLetter()},_initializeLetter:function(){if(!this._l_FlyWalkCmd){this._initializeParamters(),this.options.navigCtx=this.navigationCtx;var e=this;this.options.onExitCB=function(){!1!==e.getState()&&e.setState(!1,!1)},this._l_FlyWalkCmd=new t(this.options)}},_initializeParamters:function(){this.navigationCtx=new i,this.navigationCtx.frameWindow=this.getFrameWindow(),this.navigationCtx.UIFrame_V1=this.getFrameWindow().getUIFrame(),this.navigationCtx.visViewer=this.getFrameWindow().getViewer(),this.navigationCtx.immersiveFrame=this.navigationCtx.frameWindow.getImmersiveFrame(),this.navigationCtx.visViewerFrame=this.navigationCtx.frameWindow.getViewerFrame(),this.navigationCtx.currentViewpoint=null,this.navigationCtx.visViewerFrameBox=this.navigationCtx.visViewerFrame.getBoundingClientRect(),this.navigationCtx.viewerCanvas=null},_onFlyWalkCommandStart:function(){this._initializeLetter(),this._l_FlyWalkCmd&&(!0!==this.getState()&&this.setState(!0,!1),this._l_FlyWalkCmd._onFlyWalkCommandStart())},_onFlyWalkCommandExit:function(){this._l_FlyWalkCmd&&(!1!==this.getState()&&this.setState(!1,!1),this._l_FlyWalkCmd._onFlyWalkCommandExit())}})}),define("DS/FlyWalkCommand/VisFlyWalkActions",["UWA/Core","DS/FlyWalkCommand/l_FlyWalkCmd","DS/FlyWalkInfra/VisNavigationContext"],function(e,t,i){"use strict";var n=function(e,t,i){var n={method:e,done:t,parameters:i,token:null},o=i.executionContext.getComponent(WAfrStandardComponentKey.ModelEvents);n.token=o.subscribe({event:"onDidContextualComponentsUpdate"},function(){!function(e){var t=a[e.method],i=e.parameters.executionContext,n=i.getComponent(WAfrStandardComponentKey.ModelEvents);i.getComponent("Viewer")&&i.getComponent("Viewer").get3DViewer()&&(t(e.done,e.parameters),n.unsubscribe(e.token))}(n)})},o=function(){a.handlerComponent.setCheckState({id:"VisFlyWalkActions_1",state:!1})},a=Object.create(null);return a._l_FlyWalkCmd=null,a.handlerComponent=null,a.checked=function(e,t){a._checked(e,t)},a._checked=function(e,s){if(null!==function(e,t,i){var o=!!i.executionContext.getComponent("Viewer")&&i.executionContext.getComponent("Viewer").get3DViewer();return o||(n(e,t,i),t(),null)}("_checked",e,s)){var l={},r=function(e){var t=e.executionContext.getComponent("AFR_UIFrameManager");e.executionContext.getComponent("Afr_UIComponent");a.handlerComponent=e.executionContext.getComponent(WAfrStandardComponentKey.HandlerComponent);var n=new i;return n.frameWindow=t.getUIFrame(),n.UIFrame_V1=t.getUIFrame(),n.visViewer=e.executionContext.getComponent("Viewer").get3DViewer(),n.immersiveFrame=t.getImmersiveFrame(),n.visViewerFrame=t.getViewerLayout(),n.currentViewpoint=null,n.isWAFR_V2=!0,n.visViewerFrameBox=n.visViewerFrame.getBoundingClientRect(),n.viewerCanvas=null,n}(s);l.navigCtx=r,l.onExitCB=o,a._l_FlyWalkCmd=new t(l),a._l_FlyWalkCmd._onFlyWalkCommandStart(),e()}},a.unchecked=function(e,t){a._l_FlyWalkCmd&&a._l_FlyWalkCmd._onFlyWalkCommandExit(),a._l_FlyWalkCmd=null,a.handlerComponent=null,e()},e.namespace("FlyWalkCommand/VisFlyWalkActions",a)});