define("DS/CompareCommon/Cycle",[],function(){"function"!=typeof JSON.decycle&&(JSON.decycle=function(e,t,i){"use strict";var n=new WeakMap;return i=(i=i||[])instanceof String?[i]:i,function e(r,o){var a,l;return null!=t&&(r=t(r)),"object"!=typeof r||null===r||r instanceof Boolean||r instanceof Date||r instanceof Number||r instanceof RegExp||r instanceof String?r:void 0!==(a=n.get(r))?{$ref:a}:(n.set(r,o),Array.isArray(r)?(l=[],r.forEach(function(t,i){l[i]=e(t,o+"["+i+"]")})):(l={},Object.keys(r).forEach(function(t){-1===i.indexOf(t)&&(l[t]=e(r[t],o+"["+JSON.stringify(t)+"]"))})),l)}(e,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\(?:[\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"==typeof value&&(Array.isArray(value)?value.forEach(function(element,i){if("object"==typeof element&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}}):Object.keys(value).forEach(function(name){var item=value[name];if("object"==typeof item&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}}))}($),$})}),define("DS/CompareCommon/DBG_Stopwatch_impl",["UWA/Core"],function(e){var t=-1,i={};"undefined"!=typeof widget&&null==widget._timingEventList&&(widget._timingEventList=[]);var n=function(){};function r(){return(new Date).getTime()}function o(e,t,i){var n=[""," ","  ","   ","    ","     ","      ","       "],r=e-i.toString().length;return r>7&&(r=7),ret="l"==t?n[r]+i:i+n[r],ret}function a(){var e="";if(-1==t)e+="\n>CW>TM>    << no stats to report  >>>";else{var n=function(){var e;e="\n>CW>TM>******************************************************",e+="\n>CW>TM>*            T I M I N G   E V E N T S               *",e+="\n>CW>TM>vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv",i={};for(var n=0;n<=t;n++){var r=widget._timingEventList[n].msStart,a=widget._timingEventList[n].markList.length;if(0!=a){var l=widget._timingEventList[n].markList[a-1].msTime-r;e+="\n>CW>TM> <<<<<<<<<------------------------------------------------\x3e>>>>>>>>\n",e+=">CW>TM> <<<<<<<< --------- Iteration #"+n+", total: "+l+" ms -------- >>>>>>>>\n",e+=">CW>TM> <<<<<<<<<------------------------------------------------\x3e>>>>>>>>\n",widget._timingEventList[n].msElapsed=l;for(var s=0;s<a;s++){var u=widget._timingEventList[n].markList[s],c=u.msTime-r,d="\n>CW>TM> ("+u.msTime+" ms) @ "+o(6,"l",c)+" ms /"+o(4,"l",Math.round(c/l*100))+"% into iter ",p=null;if(null!=u.id)for(var f=0;f<s;f++){var h=widget._timingEventList[n].markList[f];if(h.id==u.id){var m=u.msTime-h.msTime,g=Math.round(m/l*100);null==i[u.str+"    "+u.comment]?i[u.str+"    "+u.comment]=g:i[u.str+"    "+u.comment]+=g,p=" :: from '"+h.str+"'\n                                                                   ----\x3e"+o(6,"l",m)+"ms elapsed, "+o(3,"l",g)+"% of entire op          "+u.comment;break}}var v=null!=p?p:u.comment;e+=d+":: "+u.str+v}}else e+="\n>CW>TM> <<<<<<<<<------------------------------------------------\x3e>>>>>>>>>",e+="\nCW>TM>  <<<<<<<<<----Iteration # "+n+" has no entries... skipping-----\x3e>>>>>>>>",e+="\n>CW>TM> <<<<<<<<<------------------------------------------------\x3e>>>>>>>>>\n"}return e+="\n"}(),r=function(){var e="\n>CW>TM>******************************************************";e+="\n>CW>TM>*    C O M P R E H E N S I V E   D A T A             *",e+="\n>CW>TM>vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv";for(var n=0,r=0;r<widget._timingEventList.length;r++)n+=widget._timingEventList[r].msElapsed;var a=t+1;return e+=">\n>CW>TM>    ITER COUNT: "+a,e+="\n>CW>TM> AVG ITER TIME: "+n/a+" ms",jQuery.each(i,function(t,i){e+="\n>CW>TM>"+o(4,"l",Math.round(i/a*100/100))+"% - "+t.replace("[END]","")}),e}();e+=r+n}return e+=function(){var e="\n>CW>TM>******************************************************";return e+="\n>CW>TM>*              T I M E S T A M P S                   *",e+="\n>CW>TM>vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv\n",null!=widget&&null!=widget.cw_debugtxt?e+=widget.cw_debugtxt:e+=" << No Timestamps >>",e}()}return{iterStart:function(e){t++;var i=new n;i.msStart=r(),i.comment="Start Iteration #"+t+(e?" / "+e:""),i.markList=[],widget._timingEventList.push(i)},mark:function(e){var i=null,n=null,o="";"string"==typeof e?i=e:(i=e.str,n=e.id,o=null!=e.comment?e.comment:""),-1==t?this.dbglog("CANNOT log message, because iteration has not started:"+i):widget._timingEventList[t].markList.push({msTime:r(),id:n,str:i,comment:o})},dump:function(){var e=a();console.log(e)},getTimingOutput:a,dbglog:function(e){null==widget.cw_debugtxt&&(widget.cw_debugtxt="");var t=r();return widget.cw_debugtxt+=">CW>TM> DBGLOG (@"+t+" ms ),'"+e+"'\n",t},reset:function(){t=-1,i={},widget._timingEventList=[]}}}),define("DS/CompareCommon/CompareInputFilterCmd",["DS/ENONextGenFilterCmd/commands/ENONextGenFilterCmd"],function(e){"use strict";return e.extend({init:function(e){this._parent(e),this.root=e.root,this.NGFUXId=e.NGFUXId},setRoot:function(e){this.root=e},_getRootId:function(){return this.root.objId},_getRootLabel:function(){return this.root.displayName},_getNGFUXId:function(){return this.NGFUXId},getAppParams:function(){return{widgetId:widget.id,appId:widget.getValue("appId"),NGFUXId:this.NGFUXId}},getSelectorManager:function(){return null},getRoots:function(){return[{id:this._getRootId(),label:this._getRootLabel(),filtered:0}]},getSelection:function(){return{path:[[this._getRootId()]],label:[[this._getRootLabel()]],directSelection:!0}}})}),define("DS/CompareCommon/CompareIdData",["UWA/Core"],function(e){"use strict";return function(e,t,i){var n=this;this.listType=e||"modelIDList",this.items=t||[],null!=t&&t.length>=2&&null==i?this.areCompared=!0:this.areCompared=i||!1,n.getLeftID=function(){var e=n.items[0];return null!=e?e.objectId:null},n.getRightID=function(){var e=n.items[1];return null!=e?e.objectId:null},n.get_nonNullCount=function(){var e=0;return n.items.forEach(function(t){null!=t&&e++}),e},n.get_objIDList=function(){for(var e=[],t=0,i=0;i<n.items.length;i++){var r=n.items[i];null!=r&&(e[t]=r.objectId,t++)}return e},n.get_objServices=function(e){var t=[];if("left"===e||"right"===e){t[0]=null;let i=n.items["left"===e?0:1];null!=i&&null!=i&&(t[0]=i.objectServices)}else for(var i=0,r=0;r<n.items.length;r++){let e=n.items[r];null!=e&&void 0!==e.objectServices&&null!==e.objectServices&&(t[i]=e.objectServices,i++)}return t},n.get_objFilterData=function(){for(var e=[],t=0;t<n.items.length;++t){e[t]=null;var i=n.items[t];null!=i&&void 0!==i.filterData&&null!==i.filterData&&(e[t]=i.filterData)}return e},n.get_allIDList=function(){for(var e=[],t=[],i=0;i<n.items.length;i++){var r=n.items[i];if(null!=r){e.push(r.objectId);var o=r.commands;if(null!=o)for(var a=o.length,l=0;l<a;l++){var s=o[l].inNode;null!=s&&t.push(s)}}}return t.forEach(function(t){e.push(t)}),e},n.areItemsIdentical=function(e,t){var i=!1,r="number"==typeof e?n.items[e]:e,o="number"==typeof t?n.items[t]:t;return null!=r&&null!=o&&r.objectId===o.objectId&&(void 0!==r.filterData&&null!==r.filterData||void 0!==o.filterData&&null!==o.filterData?void 0!==r.filterData&&null!==r.filterData&&void 0!==o.filterData&&null!==o.filterData&&(void 0!==r.filterData.filterTitle&&null!==r.filterData.filterTitle&&""!==r.filterData.filterTitle&&void 0!==o.filterData.filterTitle&&null!==o.filterData.filterTitle&&""!==o.filterData.filterTitle&&r.filterData.filterTitle===o.filterData.filterTitle?i=!0:void 0!==r.filterData.CVQuery&&null!==r.filterData.CVQuery&&void 0!==o.filterData.CVQuery&&null!==o.filterData.CVQuery?JSON.stringify(r.filterData.CVQuery)===JSON.stringify(o.filterData.CVQuery)&&(i=!0):void 0!==r.filterData.CVQuery3D&&null!==r.filterData.CVQuery3D&&void 0!==o.filterData.CVQuery3D&&null!==o.filterData.CVQuery3D&&JSON.stringify(r.filterData.CVQuery3D)===JSON.stringify(o.filterData.CVQuery3D)&&(i=!0)):i=!0),i}}}),define("DS/CompareCommon/RevisionsManager",["UWA/Core","i18n!DS/CompareCommon/assets/nls/CompareInput"],function(e,t){"use strict";function i(e,i,n){require(["DS/CompareCommon/CompareAlert"],function(r){var o=null==e?t["MISSING ALERT MESSAGE"]:null!=t[e]?t[e]:e,a=null!=n&&""!==n?o.replace("{msgData}",n):o;r.doAlert({msg:a,alertStyle:i})},function(t){console.log("%%%% CompareWidget:: Failed to show "+i+": '"+e+"', error:"+t)})}return{displayHistoryGraph:function(e,t,n){var r=this;require(["DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/LifecycleServices/LifecycleServices","DS/Utilities/TouchUtils","css!DS/CompareCommon/CompareInputRevisionsModal.css"],function(t,o,a,l,s){r.revisionsExplorer=new t({versionGraphContainer:null,widget:widget,autoUpdate:!1,useGlobalStorage:!0,globalStorageName:"historyUserSettings"}),r.revisionsExplorer.setSingleSelectionMode(),r.revisionsExplorer.disableCommands();var u=s.getTouchMode();r.revisionsExplorer.showDialog({className:"CompareInputRevisionsModal"+(u?"_Touch":""),maximizable:!0,showMaximized:u},void 0,!0);var c={displayLegend:!1};l.getHistoryConfigPromise().then(function(e){a.historyConfig=e,a.historyConfig&&a.historyConfig.settings&&(a.historyConfig.settings.defaultView&&(c.displayMode=o.DISPLAY_MODES[a.historyConfig.settings.defaultView]),a.historyConfig.settings.thumbnailGraph&&(a.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout&&(c.thumbnailGraphLayout=a.historyConfig.settings.thumbnailGraph.thumbnailGraphLayout),a.historyConfig.settings.thumbnailGraph.displayThumbnailOverview&&(c.displayThumbnailOverview="true"===a.historyConfig.settings.thumbnailGraph.displayThumbnailOverview)),a.historyConfig.settings.subwayGraph&&(a.historyConfig.settings.subwayGraph.subwaySort&&(c.subwaySortAscending="asc"===a.historyConfig.settings.subwayGraph.subwaySort),"SUBWAY_COMPACT_VIEW"!==a.historyConfig.settings.subwayGraph.viewMode&&"SUBWAY_COMFORTABLE_VIEW"!==a.historyConfig.settings.subwayGraph.viewMode||(c.subwayViewMode=a.historyConfig.settings.subwayGraph.viewMode)))},function(){}).finally(function(){a.loadUserSettingsPromise(c,!1,!0,"historyUserSettings").then(function(){r.revisionsExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:e.objId,type:e.objType,tenantId:e.tenant,securityContext:e.securityContext,dataModelType:o.DATA_MODEL_TYPES.MODEL_HISTORY,onComplete:function(){r.revisionsExplorer.publishEvent("ENOXVersionExplorerSetActiveVersion",{id:e.objId}),r.revisionsExplorer.select(e.objId)}})})}),r.revisionsExplorer.subscribeEvent("ENOXVersionExplorerModalOK",function(e){var t=r.revisionsExplorer.getSelectedNodes(),o=t.length;if(o>0){for(var a,l=0;l<o;++l)void 0===a&&(a=t[l].options.data);void 0!==a?n(a):i("rootRevisionGraphSel","compare-alert-warning")}else i("noRevisionGraphSel","compare-alert-warning");r.revisionsExplorer.cleanup(),r.revisionsExplorer=null},!1),r.revisionsExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",function(e){i("noRevisionGraphSel","compare-alert-warning"),r.revisionsExplorer.cleanup(),r.revisionsExplorer=null},!1)})},closeHistoryGraphDialog:function(){null!==this.revisionsExplorer&&this.revisionsExplorer.hideDialog(),this.revisionsExplorer=null}}}),define("DS/CompareCommon/DragAndDrop",["DS/ENO6WPlugins/jQuery","DS/DataDragAndDrop/DataDragAndDrop"],function(e,t){this._processingCB=null,this._processingCBThis=null;var i=function(e,i,n,r,o,a){var l=this;l._target=e,l._dragInVizCB=n,l._dragOutVizCB=r,l._dragOverVizCB=a,l._dragDropCB=o,l._dragCBThis=i,l._dragInCount=0,l.getDropSide=function(e){var t=e.currentTarget.id,i=null;return"drop-target-right"===t||"drop-target-right-iconlabel"===t||"drop-target-right-icon"===t||"compare-tree-to-1"===t||"compare-tree-right"===t||"compare-list-right"===t?i="drop-right":"drop-target-left"===t||"drop-target-left-iconlabel"===t||"drop-target-left-icon"===t||"compare-tree-base"===t||"compare-tree-left"===t||"compare-list-left"===t?i="drop-left":t.startsWith("compare-input-")?t.endsWith("-left")?i="drop-left":t.endsWith("-right")?i="drop-right":console.log("DnD.getDropSide undefined"):console.log("DnD.getDropSide undefined"),i},l.getObjs=function(e){var t=e.originalEvent&&e.originalEvent.dataTransfer||e.dataTransfer,i={objArray:[]},n=null;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){n=("function"==typeof t.types.indexOf?t.types.indexOf("text/searchitems")>=0:t.types.contains("text/searchitems"))?t.getData("text/searchitems"):t.getData("text/plain")}else{for(var r=UWA.is(t.types.indexOf,"function")?"indexOf":"contains",o="",a=["text/searchitems","text/plain","Text"],l=0;l<a.length&&""===o;l++){var s=t.types[r](a[l]);(UWA.is(s,"number")&&s>=0||UWA.is(s,"boolean")&&!0===s)&&(o=a[l])}""!=o&&(n=t.getData(o))}if(n&&""!=n){for(var u=JSON.parse(n),c=u.data,d=0;d<c.items.length;d++){var p=c.items[d];p.objectType&&"3DShape"===p.objectType&&null!=u.biProxyCtx||i.objArray.push(p)}i.filterProxy=u.biProxyCtx}return i},l.handleDragEnter=function(e){if(e.preventDefault(),l._dragInCount++,1==l._dragInCount){var t=l.getObjs(e);l._dragInVizCB.call(l._dragCBThis,e,t.objArray.length)}return!0},l.handleDragOver=function(e){e.preventDefault(),null!=l._dragOverVizCB&&l._dragOverVizCB(e)},l.handleDragLeave=function(e){return e.preventDefault(),l._dragInCount--,0==l._dragInCount&&l._dragOutVizCB.call(l._dragCBThis,e),!0},l.handleDragDropped=function(e){l._dragInCount=0,e.preventDefault(),l._dragOutVizCB.call(l._dragCBThis,e);var t=l.getObjs(e);if(t.objArray.length>0){var i=l.getDropSide(e);null!=l._dragDropCB?l._dragDropCB.call(l._dragCBThis,e,t,i):null!=_processingCB&&_processingCB.call(_processingCBThis,t.objArray,i,e)}return!0},l.reset=function(){l._dragInCount=0};var s=jQuery("#"+e);t.on([],s,{enter:(e,t)=>l.handleDragEnter(t),over:(e,t)=>l.handleDragOver(t),leave:(e,t)=>l.handleDragLeave(t),drop:(e,t,i)=>l.handleDragDropped(i)})};return{_attachedObjects:[],setProcessingCB:function(e,t){_processingCBThis=e,_processingCB=t},attachObject:function(e,t,n,r,o,a){this._attachedObjects.push(new i(e,t,n,r,o,a))},reset:function(){for(const e of this._attachedObjects)e.reset()}}}),define("DS/CompareCommon/CompareStructOpenWith",["DS/i3DXCompassPlatformServices/OpenWith"],function(e){"use strict";return e.extend({_buildItems:function(){var e=this,t=[],i=this._getCompatibleApps();return i.length>0&&i.forEach(function(i){t.push({name:i.get("id"),text:i.get("title"),fonticon:"play",handler:function(){e._launchApp(i)}})}),t}})}),define("DS/CompareCommon/launchTree",[],function(){var e=1e3,t=function(e,t,i){var n={id:e,phid:t};return i&&(n.CADOrigin=i),n},i=function(n,r,o){var a=e++;this.id=a.toString(),this.physID=n,this.show=!0,this.isObj=o,r&&(this.select=!0),this.children=[];var l=this;l.addChild=function(e,t,n){var r=new i(e,t,n);return l.children.push(r),r},l.getChild=function(e){var t=null;return e<l.children.length&&(t=l.children(e)),t},l.cleanse=function(){delete this.physID,delete this.isObj;for(var e=0;e<this.children.length;e++)this.children[e].cleanse()},l.makeResult=function(e){var i=l.isObj?"CATIAV5":null;e.push(new t(l.id,l.physID,i));l.children;for(var n=0;n<l.children.length;n++)l.children[n].makeResult(e)},l.findChild=function(e){for(var t=null,i=0;i<l.children.length;i++){var n=l.children[i];if(e==n.physID){t=n;break}}return t}},n=function(){var e=this;e.insert=function(t,n){if(null==e.root){var r=!1;0==t.length&&(r=!0),e.root=new i(t[0],r,!0)}for(var o=e.root,a=1;a<t.length;a++){var l=t[a],s=o.findChild(l);if(null==s){var u=a==t.length-1,c=a%2==0;o=o.addChild(l,u&&n,c)}else o=s}},e.cleanse=function(){e.root.cleanse()}};function r(e,t,i){for(var r=new n,o=function(e,t){var i=e.length,n=t.length,r=new Array(i);for(r.fill(0),j=0;j<i;j++)for(var o=e[j],a=0;a<n;a++){var l=t[a];if(l.contains("_LEFT")&&(l=l.replace(/_LEFT/g,"")),l.contains("_RIGHT")&&(l=l.replace(/_RIGHT/g,"")),o==l){r[j]=2;break}if(o.startsWith(l)){r[j]=1;break}}return r}(t,i),a=o.length,l=0;l<a;l++)if(o[l]>0){var s=2==o[l];r.insert(e[l],s)}return r}var o=function(e){this._pathWithArray=function(e){for(var t=[],i=e.length,n=0;n<i;n++){var r=e[n].pathWith;t.push(r)}return t}(e),this._pathWithStrArray=[];for(var t=0;t<this._pathWithArray.length;t++)this._pathWithStrArray.push(this._pathWithArray[t].join())};return o.prototype.buildLaunchJSON=function(e){for(var t=null,i=[],n=0;n<e.length;n++){for(var o=[],a=e[n],l=0;l<a.length;l++)o.push(a[l].resourceid);i[n]=o.join()}var s=function(e,t,i){var n=null,o=r(e,t,i);return null!=o.root&&((n={version:"2.1",viewpoint:[],workUnder:{version:"1.0",AuthoringContextHeader:null,change:{id:"",name:"",context:[],title:"",description:"",severity:""},evolution:{id:"",displayExpression:"",expression:""}}}).results=function(e){var t=[];return e.root.makeResult(t),t}(o),n.structures=[function(e){return e.cleanse(),{structure:[e.root]}}(o)]),n}(this._pathWithArray,this._pathWithStrArray,i);return null!=s&&(t=JSON.stringify(s)),t},o}),define("DS/CompareCommon/SearchManager",["UWA/Core","UWA/Utils/InterCom","text!DS/CompareCommon/assets/search_config/search_config.json"],function(e,t,i){"use strict";return{initialize:function(){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var e=this.options();return this.socket.dispatchEvent("RegisterContext",e),this},options:function(e,t,i,n,r,o,a,l){var s={};return s.title=e,s.mode="furtive",s.app_socket_id=this.socketName,null!==widget&&void 0!==widget?s.widget_id=widget.id:s.widget_id="",s.default_with_precond=!0,s.show_precond=!1,s.idcard_activated=!1,s.multiSel=!0,s.role=i,t&&(s.precond="",(t=t.split(",")).forEach(function(e,t){0!==t&&(s.precond+=" OR "),s.precond+='flattenedtaxonomies:"types/'+e+'"'}),s.precond+=' OR type:"dsxpfl:PortfolioVersion"',s.precond+=' OR type:"dsxpfl:ProductLine"',s.precond+=' OR type:"dscpfl:SellableItem"'),o&&(s.precond?s.precond="( "+s.precond+") AND "+o:s.precond=o),a&&a.length>0&&(s.columns=a),s.tenant=l,s},destroy:function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("unregisterSearchContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.disconnect(),delete this.socket},activate:function(e,t,i,n,r,o,a,l,s){var u=this.options(e,t,i,n,r,a,l,s);this.callback=o,this.socket.dispatchEvent("InContextSearch",u)},isAvailable:function(){return e.is(this.socket)},configureSearch:function(e){this.isAvailable()||this.initialize(e)},displaySearchPanel:function(e,t){var n=JSON.parse(i),r=Object.values(n).join(",");this.launchSearch({tenant:e,allowedTypes:r,role:"",criteria:i.type_act_physical,additionalQuery:"",bMultiSel:!0,in_apps_callback:t})},launchSearch:function(e){var t=this;this._searchInProgress=!0,t.initialize(),t.activate("Compare Search",e.allowedTypes,e.role||"",e.criteria,e.bMultiSel,function(i){t._searchInProgress&&(t._searchInProgress=!1,e.in_apps_callback(i))},e.additionalQuery,e.selectable,e.tenant)},destroySearch:function(){this._searchInProgress&&(this._searchInProgress=!1,this.destroy())},objectsSelected:function(e){var t,i,n=[];if(this.callback){for(t=0,i=e.length;t<i;t++)n.push(e[t]);this.callback(n)}}}}),define("DS/CompareCommon/CompareImgSrc",[],function(){var e={VPMReference:"I_VPMNavProduct.png","3DShape":"I_Part.png",CATPart:"I_DECPrtCV5.png",CATProduct:"I_DECAsmCV5.png","CATIA Embedded Component":"I_DECAsmCV5.png",Drawing:"I_VPMNavDrawing.png",ENOStrRefinementSpecification:"I_AdvancedFilter32.png",Workspace:"I_TeamWorkspace.png"},t={ENOStrRefinementSpecification:"I_AdvancedFilter144.png",Workspace:"I_TeamWorkspace108x144.png"},i={Default:"iconSmallDefault.gif",CATShape:"iconSmallCATShape.gif","CATIA CGR":"iconSmallCATIACGR.gif",CATProcess:"iconSmallCATProcess.gif",CATDrawing:"iconSmallCATDrawing.gif","CATIA Design Table":"iconSmallCATIADesignTable.gif","CATIA V4 Model":"iconSmallCATIAV4Model.gif",CATAnalysis:"iconSmallCATAnalysis.gif",CATAnalysisResults:"iconSmallCATAnalysisResults.gif",CATAnalysisComputations:"iconSmallCATAnalysisComputations.gif",Missing:"utilUploadStop.gif"};return{getObjTypeIconPath:function(t){return void 0!==e[t]?"snresources/images/icons/small/"+e[t]:void 0!==i[t]?"common/images/"+i[t]:"common/images/"+i.Default},getObjTypeLargeIconPath:function(e){var i=null;return null!=t[e]&&(i="snresources/images/icons/large/"+t[e]),i},defaultThumbnailPath:"/webapps/W3DSpace/assets/img/big/I_DefaultThumbnail.png",thumbnailUrlPath:"/resources/compare/thumbnailUrl/",iconUrlPath:"/resources/compare/icon/"}}),define("DS/CompareCommon/CompareMetaData",["UWA/Class"],function(e){return e.singleton({typeInfo:{}})}),define("DS/CompareCommon/DBG_Stopwatch",["UWA/Core"],function(e){return{iterStart:function(){},mark:function(){},dump:function(){},getTimingOutput:function(){},dbglog:function(){},reset:function(){},enable:function(){var e=this;require(["DS/CompareCommon/DBG_Stopwatch_impl"],function(t){e.iterStart=t.iterStart,e.mark=t.mark,e.getTimingOutput=t.getTimingOutput,e.dump=t.dump,e.dbglog=t.dbglog,e.reset=t.reset})}}}),define("DS/CompareCommon/CompareAlert",["DS/MessageBus/MessageBus","DS/PADUtils/views/PADAlert","css!DS/CompareCommon/CompareAlert.css"],function(e,t){"use strict";return{doAlert:function(e){if(null!=e&&e.clearExistingFirst){var i=jQuery(".wux-notification-close"),n=document.createEvent("Event");n.initEvent("DSpointerup",!0,!0);for(var r=0;r<i.length;++r)i[r].dispatchEvent(n)}var o="(empty)",a="warning";try{o=e?e.msg:null;e.alertStyle&&(a="compare-alert-error"==e.alertStyle?"error":"compare-alert-success"==e.alertStyle?"success":"compare-alert-info"==e.alertStyle?"info":"warning"),null==o?console.log("%%%% CompareWidget: Blank alert "+a+" sent %%%%"):("error"==a&&console.error("%%%% CompareWidget "+a+": "+o),t.displayNotification({msg:e.msg,eventID:a}))}catch(e){console.log("%%%% CompareWidget: Failed to display alert "+a+" '"+o+"' %%%%")}}}}),define("DS/CompareCommon/CompareIdDataListItem",["UWA/Core"],function(e){"use strict";return function(e,t){this.objectId=e,this.idType=t&&t.idType?t.idType:"modelID",this.commands=t&&t.commands?t.commands:[],this.objectServices=t||null,this.filterData=null}}),define("DS/CompareCommon/Utils",["UWA/Core","UWA/Class","DS/WAFData/WAFData","UWA/Promise","DS/FedDictionaryAccess/FedDictionaryAccessAPI","DS/WidgetServices/WidgetServices","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/CompareCommon/CompareAlert","DS/CompareCommon/CompareMetaData","DS/CompareCommon/CompareIdData","DS/CompareCommon/CompareIdDataListItem","DS/ENO6WPlugins/jQuery","UWA/Json","i18n!DS/CompareCommon/assets/nls/CompareCommon"],function(e,t,i,n,r,o,a,l,s,u,c,d,p,f,h){"use strict";function m(e,t,n,r,a,l,s){var u=-1!=e.indexOf("?")?"&":"?",c=r.tenant?r.tenant:"OnPremise",d=r.url3DSpace+e+u+"tenant="+c,p={headers:{Accept:"application/json","Accept-Language":o.getLanguage(),"Content-Type":"application/json",SecurityContext:encodeURIComponent(r.securityContext)},method:1==t?"POST":"GET",type:"json",timeout:a,proxy:"passport",onComplete:l,onFailure:s};t&&(p.data=n),i.authenticatedRequest(d,p)}function g(e,t,i,n,r,o){var a=-1!=e.indexOf("?")?"&":"?",l=e;for(var s in t)l+=a+s+"="+t[s],a="&";m(l,!1,null,i,n,r,o)}function v(t,i,n,r,o,a){m(t,!0,e.Json.encode(i),n,r,o,a)}function y(e,t,i,n){g("/resources/compare/revisions2",{objectId:e},t,12e4,function(t){for(var r=null,o=t.results,a=0;a<o.length;a++){var l=o[a];if(l.physicalid==e){r=l;break}}null==r&&null!=n&&n(),i(r)},n)}function C(e,t,i,n){y(e.physicalid,t,function(r){for(var o in r)e[o]=r[o];!function(e,t,i,n,r){v("/resources/FilterBIAPI/Filter/retrieveFilters",Array.isArray(e)?filtername:[e],i,12e4,function(e){var i=null;if(null!=e.success)for(var o=0;o<e.success.length;o++){var a=e.success[o];if(t==a.filterPhysicalid){i=a;break}}null==i&&null!=r&&r(),n(i)},r)}(e.name,e.physicalid,t,function(r){e.filter=r,y(r.rootPhysicalId,t,function(t){r.rootObj=t,e.revision=t.name+" "+t.revision,i()},n)},n)},n)}function I(e,t,i){require(["DS/CompareCommon/CompareAlert"],function(n){var r=null==e?h["MISSING ALERT MESSAGE"]:null!=h[e]?h[e]:e,o=null!=i&&""!==i?r.replace("{msgData}",i):r;n.doAlert({msg:o,alertStyle:t})},function(i){console.log("%%%% CompareWidget2:: Failed to show "+t+": '"+e+"', error:"+i)})}var D=t.singleton({init:function(){this._parent({})},jQueryTriggerAsync:function(e,t,i){setTimeout(function(){p(e).trigger(t,i)},0)},augDroppedObject:function(e,t,i,n){e.isFilter?function(e,t,i,n){var r=e.filter;null==r?C(e,t,i,n):null==r.rootObj?y(r.rootPhysicalId,t,function(e){r.rootObj=e,filterObj.revision=e.name+" "+e.revision,i()},n):i()}(e,t,function(){i(e.filter.rootObj)},n):this._augNonFilterAsNeeded(e,t,function(){i(e)},n)},_augNonFilterAsNeeded:function(e,t,i,n){var r=this;null==e.type?"3dportfolio"===e.serviceId?(t.tenant=widget.getValue("x3dPlatformId"),t.url3DSpace=e.attributesUrl.url,g("/"+e.attributesUrl.attributes.url,{objectIds:e.physicalid},t,12e4,function(n){var o=[];if(void 0!==n.results&&null!==n.results){if(1==(o=n.results).length)for(var a=0;a<o[0].data.length;++a)"Title"==o[0].data[a].displayName&&(e.Title=o[0].data[a].value),"Version"==o[0].data[a].displayName&&(e.revision=o[0].data[a].value);r.getFederatedAttributesPromise({objectIds:[e.physicalid],serviceIds:[e.serviceId],tenant:t.tenant,securityContext:t.securityContext}).then(function(t){if(void 0!==t.results&&null!==t.results&&t.results.length>0)e.preview_url=t.results[0].preview_url,e.type_icon_url=t.results[0].type_icon_url,e.type=t.results[0].data.find(function(e){return-1!==e.name.search(/ds6w:type$/)}).value;else{let t=h.federated_attributes_failed;void 0!==e.displayName&&null!==e.displayName&&""!==e.displayName&&(t=t+": "+e.displayName),s.doAlert({msg:t,alertStyle:"compare-alert-warning"})}i()},function(){let t=h.federated_attributes_failed;void 0!==e.displayName&&null!==e.displayName&&""!==e.displayName&&(t=t+": "+e.displayName),s.doAlert({msg:t,alertStyle:"compare-alert-warning"})})}},function(e){console.log("COMPARE: failed getting object info")})):y(e.physicalid,t,function(t){for(var n in t)e[n]=t[n];i()},n):i()},loadFilter:function(e,t,i,n){C(e,t,i,n)},getFederatedAttributesPromise:function(t){var a=l.getPlatformWSUrl("3DSearch",t.tenant,"/search");return new n(function(n,l){for(var s={with_indexing_date:!0,with_synthesis:!0,with_nls:!0,label:"ENOCompare-"+("compareWidgetOdtId"!==widget.id?Date.now().toString():"ODTFakeSearch"),select_predicate:[],with_synthesis_hierarchical:!0,select_file:["icon","thumbnail_2d"],query:"",nresults:40,start:"0",tenant:t.tenant},u=0;u<t.objectIds.length;u++)s.query+=(0===u?"":" OR ")+'[ds6w:resourceUid]:"'+t.objectIds[u]+'"';i.authenticatedRequest(a,{method:"POST",type:"json",proxy:"passport",timeout:3e4,data:e.Json.encode(s),headers:{Accept:"application/json",SecurityContext:encodeURIComponent(t.securityContext),"content-type":"application/json","Accept-Language":widget.lang},onComplete:function(e){var t=[],i={results:[]};if(void 0!==e.results)for(var a=0;a<e.results.length;a++){for(var u=e.results[a].attributes,c={data:[]},d=0;d<u.length;d++)if("type_icon_url"===u[d].name)c.type_icon_url=u[d].value;else if("preview_url"===u[d].name)c.preview_url=u[d].value;else if("resourceid"===u[d].name)c.physicalID=u[d].value;else if("sourceid"===u[d].name)c.sourceID=u[d].value;else{var p=u[d].name.split("/"),f=p[p.length-1];c.data.push({nls:f,value:u[d].value,name:u[d].name});for(var h=!1,m=0;!h&&m<t.length;++m)f===t[m]&&(h=!0);h||t.push(f)}i.results.push(c)}if(t.length>0){var g=t.join(",");r.getResourcesInfo(g,{tenantId:s.tenant,lang:o.getLanguage(),apiVersion:"R2018x",onComplete:function(e){for(var t=0;t<i.results.length;++t)for(var r=0;r<i.results[t].data.length;++r)for(var o=i.results[t].data[r],a=0;a<e.vocabularyElementNLSInfo.length;++a){var l=e.vocabularyElementNLSInfo[a].uri,s=e.vocabularyElementNLSInfo[a].nlsName;o.nls===l&&(o.nls=s)}n(i)},onFailure:function(e){console.log(" --\x3e> Can't get ElementsNls "+e);l(i)}})}else n(i)},onFailure:function(e){l(t)}})})},getPropertiesPromise:function(e,t,i,r){return new n(function(n,o){("GET"==r?g:v)(e,i,t,864e5,n,o)})},getPropertiesTabsToDisplayPromise:function(e,t){var i=[],n=[0];function r(e,t){return e.length&&e.every(function(e){return"rejected"!==e.status&&e.value.facets[t]&&!0===e.value.facets[t].available})}return Array.isArray(e)&&e.length?(e.forEach(function(e){if(e){var n=[{name:"properties"},{name:"instance"}];widget.propertiesCompareDisplayEffectivity&&(n=n.concat({name:"Effectivity"})),i.push(new Promise(function(i,r){v("/resources/v1/collabServices/attributes/op/facets/available",{id:e,facets:n},t,12e4,i,r)}))}}),i.length?Promise.allSettled(i).then(function(e){return n=[],r(e,"properties")&&n.push(0),r(e,"instance")&&n.push(1),widget.propertiesCompareDisplayEffectivity&&r(e,"Effectivity")&&n.push(2),Promise.resolve(n)},function(){return Promise.resolve(n)}):Promise.resolve(n)):Promise.resolve(n)},getEffectivityPromise:function(e){return new n(t=>{this.loadEffectivities(e,e=>{var i=this.formatEffectivities(e);t(i)})})},formatEffectivities:function(e){var t=[];if(null==e)return console.log("unexpected effectivity"),t;var i=e.expressions;if(null==i)return console.log("unexpected effectivity"),t;for(var n=Object.keys(i),r=n.length,o=0;o<r;o++){var a=n[o],l=i[a],s=l.hasEffectivity;if("ERROR"!=s){var u=[],c={metatype:"effectivity",physicalID:a,data:u};t.push(c);var d="YES"==s?h.Yes:h.No;if(u.push({name:"Effectivity",nls:h.Effectivity,type:"string",value:[d]}),"NO"!=s){var p=l.content;if(null!=p){var f=p.Variant;null!=f&&u.push({name:"VariantOption",nls:h.VariantOption,type:"string",value:f});var m="",g="",v=p.Evolution;null!=v&&(m=null==v.Current?"":v.Current,g=null==v.Projected?"":v.Projected,u.push({name:"CurrentEvolution",nls:h.CurrentEvolution,type:"string",value:[m]}),u.push({name:"ProjectedEvolution",nls:["ProjectedEvolution"],type:"string",value:[g]}))}else console.log("unexpected effectivity")}}}return{results:t}},loadEffectivities:function(e,t){var i="/resources/modeler/configuration/navigationServices/getMultipleFilterableObjectInfo?timestamp="+(new Date).getTime().toString(),n={version:"1.0",output:{targetFormat:"TXT",withDescription:"YES",view:"ALL",domains:"ALL"},pidList:"["+e.join(",")+"]"};D.doPost(i,n,widget.getValue("x3dPlatformId"),widget.securityContext,function(e){t(e)}.bind(this),function(e){t({expressions:{}})}.bind(this))},loadAttrs2:function(e,t,i,n,r){var o=widget.getValue("x3dPlatformId");a.loadAttrs(e,t,i,n,o,r,this.getFederatedAttributesPromise,u,void 0)},loadAttrs:function(e,t,i,n,r){for(var o=widget.getValue("x3dPlatformId"),a=null,s=[],c=[],d=[],p=[],f=[],h=[],m=[],g={objectIds:[],serviceIds:[],tenant:widget.getValue("x3dPlatformId"),securityContext:widget.securityContext},v=0;v<e.length;v++)"3DSpace"===t[v]?f.push(e[v]):"3dportfolio"===t[v]?p.push(e[v]):(g.objectIds.push(e[v]),g.serviceIds.push(t[v]));if(n.indexOf(1)>=0)for(v=0;v<i.length;v++)h.push(i[v]);if(n.indexOf(2)>=0)for(v=0;v<i.length;v++)m.push(i[v]);p.length?s.push(this.getPropertiesPromise("/"+u.typeInfo["3dportfolio"].attributes.url,{securityContext:widget.securityContext,tenant:o,url3DSpace:u.typeInfo["3dportfolio"].url},{objectIds:p.join(",")},"GET")):f.length?(a={debug_properties:"",readonly:"false",navigateToMain:"true",attributes:"true",plmparameters:"true",busIDs:f,relIDs:[],lIds:[]},s.push(this.getPropertiesPromise("/resources/v1/collabServices/attributes/op/read",{tenant:o,securityContext:widget.securityContext,url3DSpace:l.get3DSpaceBaseUrl(o)},a,"POST"))):g.objectIds.length&&s.push(this.getFederatedAttributesPromise(g)),h.length&&(a={debug_properties:"",readonly:"false",navigateToMain:"false",attributes:"true",plmparameters:"true",busIDs:[],relIDs:h,lIds:[]},c.push(this.getPropertiesPromise("/resources/v1/collabServices/attributes/op/read",{tenant:o,securityContext:widget.securityContext,url3DSpace:l.get3DSpaceBaseUrl(o)},a,"POST"))),m.length&&d.push(this.getEffectivityPromise(m));var y=s.concat(c).concat(d);Promise.allSettled(y).then(function(e){for(var t=[],i=0;i<e.length;i++)if("rejected"!==e[i].status){var n=e[i].value;void 0!==n.results&&null!==n.results&&(t=t.concat(n.results))}r(t)})},isTitleAttr:function(e,t){var i=e.name,n=e.value,r=this.getTitleAttrNames();return(!1!==t||"PLM_ExternalID"!==i&&"PLM_ExternalID"!==n)&&(-1!=r.indexOf(i)||-1!=r.indexOf(n))},getTitleAttrNames:function(){return["attribute[PLMEntity.V_Name]","V_Name","PLM_ExternalID","attribute[PLMInstance.PLM_ExternalID]","attribute[Title]","Title","dskern:nlsLabel","Synopsis"]},accessRightsPromise:function(e,t,r,o){for(var a="",s=0;s<e.length;++s){var u=e[s];0==u.isSupportedType&&(""!==a&&(a+=","),a+='{"objectID":"'+u.physID+'","accessRight":[{"access":{"physical":"read"}}]}')}if(""!==a){var c=l.get3DSpaceWSUrl(t,"/resources/pno/ownership/checkaccess"),d='{"boAccessRights":['+a+"]}";return new n(function(e,t){i.authenticatedRequest(c,{method:"POST",type:"json",proxy:"passport",timeout:5e3,data:d,headers:{Accept:"application/json",SecurityContext:encodeURIComponent(r),"content-type":"application/json","Accept-Language":widget.lang},onComplete:function(e){o(e.success)},onFailure:function(e){o(e.success)}})})}o(!0)},_PROP_COMP_FACETS:["","_INST","_EFF"],compPropFacetsReduceFn:e=>D._PROP_COMP_FACETS.reduce((t,i)=>(t[i]=e(i),t),{}),loadPref:function(e,t,n){o.getCompassUrlAsync({onComplete:function(r){var o=r+"/resources/AppsMngt/user/getPreferences?name="+encodeURI(e);i.authenticatedRequest(o,{method:"GET",timeout:5e3,headers:{Accept:"application/json",SecurityContext:void 0},onComplete:function(e){t(e)},onFailure:function(e){"function"==typeof n?n(e):t("")},cache:!1})}})},savePref:function(e,t,n,r){o.getCompassUrlAsync({onComplete:function(o){var a=o+"/resources/AppsMngt/user/setPreferences?name="+encodeURI(e)+"&value="+encodeURI(t);i.authenticatedRequest(a,{method:"GET",timeout:5e3,headers:{Accept:"application/json",SecurityContext:void 0},cache:!1,onComplete:function(e){"function"==typeof n&&n(e)},onFailure:function(e){"function"==typeof r?r(e):onLoad("error")}})}})},saveUserPreferencesPromise:function(e,t){return new Promise(function(i,n){D.savePref(e,encodeURIComponent(f.encode(t)),i,n)})},getUserPreferencesPromise:function(e){return new Promise(function(t,i){D.loadPref(e,e=>{let i="";try{i=f.decode(decodeURIComponent(e))}catch{i=decodeURIComponent(e)}t(i)},i)})},setPreferencesToWidget:function(e,t,i){let n,r,o=[];"string"==typeof e?(n=[e],r=[t]):Array.isArray(e)&&Array.isArray(t)&&(n=e,r=t),Promise.allSettled(n.map(e=>D.getUserPreferencesPromise(e))).then(e=>{e.forEach((e,t)=>{"rejected"!==e.status&&e.value?"string"==typeof r[t]&&r[t].length&&null!=e.value&&""!=e.value&&(widget.setValue(r[t],e.value),o.push({[n[t]]:e.value})):console.info(" Compare Utils.setPreferencesToWidget: Failed to get preference and save to widget "+n[t])}),"function"==typeof i&&i(1===o.length?Object.values(o)[0]:o)})},doPost:function(e,t,i,n,r,o){v(e,t,{url3DSpace:l.get3DSpaceBaseUrl(i),tenant:i,securityContext:n},864e5,r,o)},getExpressionPromise:function(e,t){return new n(function(i,n){g("/resources/compare/getExpressionValue",{expressionName:e},t,864e5,i,n)})},mergeArrays:function(e){for(var t={},i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)t[n[r]]=!0;return Object.keys(t)},determineListType:function(e){for(var t="unknown",i=!1,n=!1,r=!1,o=e.items,a=0;a<o.length;a++){var l=o[a];"snapshotID"==l.idType?r=!0:"modelID"==l.idType?i=!0:"IDPlusCommands"==l.idType?n=!0:null==l.idType?i=!0:console.error("COMPARE>> Unknown idtype in input")}return r?t="snapshotIDList":n?t="IDPlusCommandsList":i?t="modelIDList":console.error("COMPARE>> Unknown idType in input"),t},persistIDs:function(e){widget.setValue("persistedIDs",JSON.stringify(e))},fetchPersistedIDs:function(){var e=null,t=widget.getValue("persistedIDs");if(t){var i=JSON.parse(t);e=new c(i.listType,i.items,i.areCompared)}return e},clear_persistedIDs:function(){widget.setValue("persistedIDs",null)},getX3DContent:function(){return widget.getValue("X3DContentId")},fetchContentFromCompass:function(){var e=this.getX3DContent();return null!=e&&e.constructor==String&&(e=JSON.parse(e)),e},setCredentialsToWidget:function(e){var t=e.replace("ctx::","");widget.setValue("xPref_CREDENTIAL",t)},isRevBranchRevPattern:function(e,t){var i=!1,n="",r=e.match(/_/g);if(null!=r&&r.length>0?n="_":null!=(r=e.match(/\x2e/g))&&r.length>0&&(n="."),""!==n){t.separator=n,t.branches=[];var o=e.split(n);if(o.length>2){i=!0;for(var a=o.length-1;a>=0;a-=2)0===a?t.branches.push({branchId:"",revisionId:o[a]}):1===a?t.branches.push({branchId:"",revisionId:o[a-1]+n+o[a]}):t.branches.push({branchId:o[a-1],revisionId:o[a]})}}return i},compareRevBranchRev:function(e,t){var i="revision";if(void 0===e.branches||void 0===t.branches||e.branches.length!==t.branches.length)i="branch";else for(var n=0;n<e.branches.length&&"revision"===i;++n)n<e.branches.length-1?e.branches[n].branchId===t.branches[n].branchId&&e.branches[n].revisionId===t.branches[n].revisionId||(i="branch"):e.branches[n].branchId!==t.branches[n].branchId&&(i="branch");return i},getAttrValueFromAttrData:function(e){var t="";if(null!=e&&void 0!==e.value&&null!==e.value){var i="timestamp"===e.type||"modified"===e.name||"originated"===e.name;if(e.value.constructor==Array)if(!0===e.multivalue)for(var n=0;n<e.value.length;++n){var r;if(i){var a=new Date(e.value[n]);r=o.formatDate(a,!0)}else r=e.value[n];t+=r,n!==e.value.length-1&&(t+=", ")}else if(i){a=new Date(e.value[0]);t=o.formatDate(a,!0)}else t=e.value[0];else if(i){a=new Date(e.value);t=o.formatDate(a,!0)}else t=e.value}return t},forceRequireIndex:function(e){!0===widget.compareV1?widget.getBool("useIndex")||(e||I("INDEX_REQ_ENABLING","compare-alert-warning"),widget.setValue("useIndex",!0)):(widget.setValue("useIndex",!0),require(["DS/CompareWidget2/userSettings/UserSettingsManager"],t=>{setTimeout(()=>{!0!==t.get("compareSettings.dataSource.useIndex")&&(t.set("compareSettings.dataSource.useIndex",!0),e||I("INDEX_REQ_ENABLING","compare-alert-warning"))},0)}))},intersectionDifference:function(e,t,i,n){if(null==e&&(e=[]),null==t&&(t=[]),!Array.isArray(e)&&!Array.isArray(t))throw Error("ArrayUtils.setDifference: both inputs should be an array");for(var r=e.slice(),o=t.slice(),a={intersection:[],difference:void 0},l={intersection:[],difference:void 0},s=!0===n?r.length-1:0;!0===n?s>=0:s<r.length;s=!0===n?s-1:s+1)for(var u=!0===n?o.length-1:0;!0===n?u>=0:u<o.length;u=!0===n?u-1:u+1)if(i(r[s],o[u])){a.intersection.unshift(r.splice(s,1)[0]),l.intersection.unshift(o.splice(u,1)[0]),!n&&(s-=1);break}return a.difference=r,l.difference=o,[a,l]}});return D}),define("DS/CompareCommon/CompareInput",["UWA/Core","DS/WAFData/WAFData","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Mask","DS/Controls/ResponsiveTileView","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/ENOXEmptyContent/js/ENOXEmptyContent","DS/LifecycleServices/LifecycleServicesSettings","DS/LifecycleServices/LifecycleServices","DS/CompareCommon/CompareImgSrc","DS/CompareCommon/CompareMetaData","DS/CompareCommon/DBG_Stopwatch","DS/CompareCommon/DragAndDrop","DS/CompareCommon/SearchManager","DS/CompareCommon/CompareInputFilterCmd","DS/CompareCommon/Utils","DS/CompareCommon/CompareIdData","DS/CompareCommon/CompareIdDataListItem","DS/CompareCommon/RevisionsManager","i18n!DS/UIKIT/assets/nls/UIKIT","i18n!DS/CompareCommon/assets/nls/CompareInput","css!DS/PADServices/PADServices.css","css!DS/CompareCommon/CompareInput.css"],function(e,t,i,n,r,o,a,l,s,u,c,d,p,f,h,m,g,v,y,C,I,D){"use strict";var b=c.defaultThumbnailPath,S=c.getObjTypeIconPath("Default"),O=c.thumbnailUrlPath,_=c.iconUrlPath,j="",w="",T="";const L="compare-input-empty",x=L+"-left",A=L+"-right",E="compare-input-dropzone",P="compare-input-panel",F=P+"-root",R=P+"-dropArea",N="addObjects",V="addObjRev",M="addObjFilter",W=P+"-"+N,B=W+"-left",k=W+"-right",U=P+"-"+V,G=U+"-left",Q=U+"-right",z=P+"-"+M,H=z+"-left",q=z+"-right",X="compare-input-tile",J=X+"-left",K=X+"-right",Y="compare-input-search",$=Y+"-left",Z=Y+"-right",ee="compare-input-filterOf",te=ee+"-left",ie=ee+"-right",ne="compare-input-revsOf",re=ne+"-left",oe=ne+"-right";var ae=function(e){};function le(e,t){null!==e&&(jQuery("#"+L+"-"+t).addClass("compare-input-while-dragging"),jQuery("#"+E+"-"+t).show(),jQuery("#"+X+"-"+t).addClass("compare-input-while-dragging"))}function se(e,t,i){var n=t+"-"+i;j=n,jQuery("#"+n).children().addClass("zoneHighlighted")}function ue(e,t,i){var n=t+"-"+i;jQuery("#"+n).children().removeClass("zoneHighlighted"),n===j&&(jQuery("#"+L+"-"+i).removeClass("compare-input-while-dragging"),jQuery("#"+E+"-"+i).hide(),jQuery("#"+X+"-"+i).removeClass("compare-input-while-dragging"),j="")}function ce(e,t){var i=e["PLMEntity.V_Name"];return null!=i&&""!==i||(i=e.Title),null!=i&&""!==i||(i=e.displayName),null!=i&&""!==i||(i=e.name),1==t&&(i+=" "+e.revision),i}function de(e,t,i){require(["DS/CompareCommon/CompareAlert"],function(n){var r=null==e?D["MISSING ALERT MESSAGE"]:null!=D[e]?D[e]:e,o=null!=i&&""!==i?r.replace("{msgData}",i):r;n.doAlert({msg:o,alertStyle:t})},function(i){console.log("%%%% CompareWidget:: Failed to show "+t+": '"+e+"', error:"+i)})}function pe(t,i,n,r,o){require(["DS/UIKIT/SuperModal"],function(a){var l=new a({events:{onHide:function(){}},renderTo:document.body}),s=document.createElement("div");s.innerHTML=t;var u=document.createElement("div");u.className="compare_popup_warning";var c=e.createElement("span",{class:"compare_warning_icon fonticon fonticon-attention fonticon-2x"});u.appendChild(c);var d=document.createElement("div");d.appendChild(u),d.appendChild(s),l.dialog({title:D.get("CompareDialogHeader"),body:d,buttons:[{className:"primary compare-input-Ok",value:null!==i&&""!==i?i:null,action:function(e){e.hide(),null!=r&&"function"==typeof r&&r()}},{className:"default compare-input-Cancel",value:null!==n&&""!==n?n:null,action:function(e){e.hide(),null!=o&&"function"==typeof o&&o()}}]})})}var fe=function(e){this.proxyType=e.proxyType||"passport",this.rootServiceURL=e.rootServiceURL||"",this.tenant="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null,null!=this.tenant&&""!=this.tenant||(this.tenant="OnPremise"),this.securityContext="uninitialized",this._filterCmd=null,this._filterProxy={left:null,right:null},this.runOptions={},this.loadFromCompassOK=!0,this.init(e)};function he(t,i,n,r){return e.createElement("div",{id:P+"-"+t+"-"+r,class:"enx-welcome-panel-dropZoneGlobal "+t,html:[{tag:"div",class:"enx-welcome-panel-dropZone "+t,html:[{tag:"div",class:"enx-welcome-panel-dropIconAndText "+t,html:[{tag:"i",styles:{"margin-left":"inherit"},class:"enx-welcome-panel_img wux-ui-3ds wux-ui-3ds-4x wux-ui-3ds-"+i,html:[]},{tag:"h5",class:"enx-welcome-panel_txt "+t,html:n}]}]}]})}function me(e,t){var i=!0;return null!=e&&void 0!==e.serviceId&&null!==e.serviceId&&""!==e.serviceId&&"3dspace"!==e.serviceId.toLowerCase()&&(i=!1),!0===t&&(i=!1),i}function ge(e,t){var i=document.createElement("div");i.title=D.get("FilterBadgeTip"),"filter"===t.type&&void 0!==t.title&&null!==t.title&&""!==t.title&&(i.title=D.get("FilterBadgeTip")+" ("+t.title+")"),i.className="wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-genereatedicon-badge-bottom-right wux-ui-3ds","filter"===t.type&&(i.className+=" wux-ui-3ds-filter"),i.style="font-size: 2em; color: #aaa",e.elements.picture.appendChild(i)}return fe.prototype.init=function(){var e=this;function t(e,t){var i=new t({appId:widget.getValue("appId"),widgetId:widget.id,NGFUXId:e,tenant:widget.getValue("x3dPlatformId"),ExpandSynthesisON:!0,selectionFilterAvailable:!1,volumeFilterAvailable:!1,shareFilterSpec:!0});return null!==i&&i.setNGFilterOptions({appID:widget.getValue("appId")}),i}require(["DS/ENOFilterBIUX/FilterBIComponentProxy"],function(i){null===e._filterProxy.left&&(e._filterProxy.left=t("ComparePanel_Left",i),null!==e._filterProxy.left&&e._filterProxy.left.addEvent("ApplyNGFilter",e.onApplyNGFilterLeft,e)),null===e._filterProxy.right&&(e._filterProxy.right=t("ComparePanel_Right",i),null!==e._filterProxy.right&&e._filterProxy.right.addEvent("ApplyNGFilter",e.onApplyNGFilterRight,e))},function(e){console.log("CompareInput: failure loading Filter module")}),j="",this.idDataList=null,this.validateObj_stateData={},this.leftTile=null,this.rightTile=null},fe.prototype.doInput=function(e,t,i){this.init(),this.buildSkeleton(e,i),this.setupDragAndDropHandling(),this.initializeData(t)},fe.prototype.buildSkeleton=function(t,i){this.doCompareCB=i,this.displayOrientation=this.computeOrientation(t);var n="side-by-side"===this.displayOrientation?"row":"column",r=g.fetchContentFromCompass();null!=r&&void 0!==r.runOptions&&null!==r.runOptions&&"MERGE"===r.runOptions.app&&(this.runOptions={ImmediateCompare:!0,AllowCompareOfIdentical:!1,ImmediateRevisionOf:!0,input:[{NoFilterOf:!0},{NoFilterOf:!0,NoOpenContent:!0}]}),this.inputRoot=e.createElement("div",{id:"compare-input-root",html:[]}),this.inputRoot.inject(t),this.inputRoot.hide(),this.buildSkeleton_Header(this.inputRoot),this.buildSkeleton_Body(this.inputRoot,n),this.buildSkeleton_Footer(this.inputRoot),window.addEventListener("resize",this.updateDisplayOrientation.bind(this))},fe.prototype.buildSkeleton_Header=function(e){},fe.prototype.buildSkeleton_Body=function(t,i){var n=this,r=this.buildSkeleton_Body_Input("left"),o=this.buildSkeleton_Body_Input("right");e.createElement("div",{id:"compare-input-body",html:[{tag:"div",id:"compare-input-drop",html:[{tag:"div",id:"compare-input-drop-targets",styles:{height:"100%","flex-direction":i},html:[r.outerHTML,o.outerHTML]}]}]}).inject(t);jQuery("#"+$).click(function(){n.searchButtonPressed("left")}),jQuery("#"+re).click(function(){n.revisionsOfButtonPressed("left")}),jQuery("#"+te).click(function(){n.filtersOfButtonPressed("left")}),jQuery("#"+Z).click(function(){n.searchButtonPressed("right")}),jQuery("#"+oe).click(function(){n.revisionsOfButtonPressed("right")}),jQuery("#"+ie).click(function(){n.filtersOfButtonPressed("right")})},fe.prototype._supportsRevisions=function(e,t){var i=!0;if(null!==e){var n=this.validateObj_stateData[e];null==n||me(n)||(i=!1)}var r=!0;return void 0!==this.runOptions.input&&null!==this.runOptions.input&&this.runOptions.input.length>0&&("left"===t||0===t?this.runOptions.input.length>0&&!0===this.runOptions.input[0].NoRevisionOf&&(r=!1):this.runOptions.input.length>1&&!0===this.runOptions.input[1].NoRevisionOf&&(r=!1)),i&&r},fe.prototype._supportsFilters=function(e,t){var i=!0;if(null!==e){var n=this.validateObj_stateData[e];null!=n&&(i=!!n.isFilterSupported)}var r=!0;return void 0!==this.runOptions.input&&null!==this.runOptions.input&&this.runOptions.input.length>0&&("left"===t||0===t?this.runOptions.input.length>0&&!0===this.runOptions.input[0].NoFilterOf&&(r=!1):this.runOptions.input.length>1&&!0===this.runOptions.input[1].NoFilterOf&&(r=!1)),i&&r},fe.prototype._supportsOpenContent=function(e){var t=!0;return void 0!==this.runOptions.input&&null!==this.runOptions.input&&this.runOptions.input.length>0&&("left"===e||0===e?this.runOptions.input.length>0&&!0===this.runOptions.input[0].NoOpenContent&&(t=!1):this.runOptions.input.length>1&&!0===this.runOptions.input[1].NoOpenContent&&(t=!1)),t},fe.prototype.buildSkeleton_Body_Input=function(t){var n=function(t,n){var r=e.createElement("div",{id:"drop-target-iconlabel-"+t,class:"compare-input-drop-icon-label"}),o=new i({id:Y+"-"+t,icon:"open",value:D.get("left"===t?"addObjectsDZ":"searchButtonLabel"),className:"primary"});o.getContent().title=D.get("searchButtonTip"),null!=n&&!0===n.noOpenContent&&(o.getContent().style.display="none");var a=new i({id:ne+"-"+t,icon:"flow-branch-list",value:D.get("revisionOfButtonLabel")});a.getContent().title=D.get("revisionOfButtonTip"),null!=n&&!0===n.noRevisionOf&&(a.getContent().style.display="none");var s=new i({id:ee+"-"+t,icon:"filter-open",value:D.get("filterOfButtonLabel")});s.getContent().title=D.get("filterOfButtonTip"),null!=n&&!0===n.noFilterOf&&(s.getContent().style.display="none");var u=[];u.push({type:"drop",text:D.get("dropHere"),DOMelement:r}),u.push({type:"dom",DOMelement:a.getContent()}),u.push({type:"dom",DOMelement:s.getContent()}),u.push({type:"dom",DOMelement:o.getContent()});var c=new l({sentences:u});return e.createElement("div",{id:L+"-"+t,class:"compare-input-empty",html:c._containerEmptyContent.outerHTML})}(t,{noFilterOf:"left"===t||!this._supportsFilters(null,t),noRevisionOf:"left"===t||!this._supportsRevisions(null,t),noOpenContent:!this._supportsOpenContent(t)});n.childNodes[0].childNodes[0].style.width="100%";for(var r=n.childNodes[0].childNodes[0].childNodes[0].childNodes,o=1;o<r.length-1;++o){r[o].childNodes[0].childNodes[1].style.display="none"}var a=function(t){var i=he(N,"drag-drop",D.get("addObjectsDZ"),t),n=he(V,"flow-branch-list",D.get("revisionOfObjectDZ"),t),r=he(M,"filter",D.get("filterOfObjectDZ"),t),o=[];return o.push(n),o.push(i),o.push(r),e.createElement("div",{id:E+"-"+t,class:"compare-input-dropzone",styles:{display:"none"},html:[{tag:"div",id:F+"-"+t,class:"enx-welcome-panel enx-welcome-panel-root",html:[{tag:"div",id:R+"-"+t,class:"enx-welcome-panel-dropArea",html:o}]}]})}(t),s=function(t){return e.createElement("div",{id:X+"-"+t,class:"compare-input-tile-container",styles:{display:"none"},html:[]})}(t);return e.createElement("div",{id:"compare-input-container-"+t,styles:"left"!==t?{display:"none"}:{},html:[{tag:"div",id:"compare-input-drop-target-"+t,class:"compare-input-drop-target",styles:"left"===t?{"min-width":"100px","overflow-x":"overlay",border:"none"}:{"overflow-y":"overlay","overflow-x":"overlay"},html:[n.outerHTML,a.outerHTML,s.outerHTML]}]})},fe.prototype.buildSkeleton_Footer=function(t){var r=this;this.inputFooter=e.createElement("div",{id:"compare-input-footer",html:[]}).inject(t);var o=new n({buttons:[this.compareBtn=new i({value:D.get("CompareStructures"),className:"primary",id:"compare-input-button-compare",events:{onClick:function(e,t){console.log("CompareInput Compare button was clicked"),r.doCompare()}}}),this.removeAllBtn=new i({value:D.get("RemoveAll"),id:"compare-input-button-cancel",events:{onClick:function(e,t){console.log("CompareInput Remove All button was clicked"),r.clearItem("all")}}})]}).inject(this.inputFooter);this.compareBtn.getContent().title=D.get("CompareButtonTip"),this.removeAllBtn.getContent().title=D.get("CancelButtonTip"),this.inputFooter.hide(),o.elements.container.addClassName("compare-input-buttongroup"),this.compareBtn.elements.container.setStyles({"margin-right":"10px","border-radius":"4px"}),this.removeAllBtn.elements.container.setStyles({"border-radius":"4px"})},fe.prototype.setupDragAndDropHandling=function(){f.attachObject("compare-input-drop-target-left",this,this.dragEnterPanelLeft,this.dragLeavePanelLeft,this.dropHandler),f.attachObject("compare-input-drop-target-right",this,this.dragEnterPanelRight,this.dragLeavePanelRight,this.dropHandler),f.attachObject(B,this,this.dragEnterAddObjectsLeft,this.dragLeaveAddObjectsLeft,this.dropHandler),f.attachObject(G,this,this.dragEnterAddObjRevLeft,this.dragLeaveAddObjRevLeft,this.dropHandler),f.attachObject(H,this,this.dragEnterAddObjFilterLeft,this.dragLeaveAddObjFilterLeft,this.dropHandler),f.attachObject(k,this,this.dragEnterAddObjectsRight,this.dragLeaveAddObjectsRight,this.dropHandler),f.attachObject(Q,this,this.dragEnterAddObjRevRight,this.dragLeaveAddObjRevRight,this.dropHandler),f.attachObject(q,this,this.dragEnterAddObjFilterRight,this.dragLeaveAddObjFilterRight,this.dropHandler)},fe.prototype.dropHandler=function(e,t,i){f.reset();var n=e.currentTarget.id;"drop-left"===i?this.clearFiltering("left",!0):"drop-right"===i&&this.clearFiltering("right",!0),n.startsWith("compare-input-panel-addObjects-")?(console.log("CompareInput handle dropped object "+i),this.validateAndProcessObjDrop(t,i)):n.startsWith("compare-input-panel-addObjRev-")?(console.log("CompareInput handle Revisions of dropped object "+i),this.validateAndProcessRevisionOfDrop(t,i)):n.startsWith("compare-input-panel-addObjFilter-")&&(console.log("CompareInput handle Filters of dropped object "+i),this.validateAndProcessFilterOfDrop(t,i))},fe.prototype.dragEnterPanelLeft=function(e){le(e,"left")},fe.prototype.dragEnterPanelRight=function(e){le(e,"right")},fe.prototype.dragEnterAddObjectsLeft=function(e){se(0,W,"left")},fe.prototype.dragEnterAddObjRevLeft=function(e){se(0,U,"left")},fe.prototype.dragEnterAddObjFilterLeft=function(e){se(0,z,"left")},fe.prototype.dragEnterAddObjectsRight=function(e){se(0,W,"right")},fe.prototype.dragEnterAddObjRevRight=function(e){se(0,U,"right")},fe.prototype.dragEnterAddObjFilterRight=function(e){se(0,z,"right")},fe.prototype.dragLeavePanelLeft=function(e){},fe.prototype.dragLeavePanelRight=function(e){},fe.prototype.dragLeaveAddObjectsLeft=function(e){ue(0,W,"left")},fe.prototype.dragLeaveAddObjRevLeft=function(e){ue(0,U,"left")},fe.prototype.dragLeaveAddObjFilterLeft=function(e){ue(0,z,"left")},fe.prototype.dragLeaveAddObjectsRight=function(e){ue(0,W,"right")},fe.prototype.dragLeaveAddObjRevRight=function(e){ue(0,U,"right")},fe.prototype.dragLeaveAddObjFilterRight=function(e){ue(0,z,"right")},fe.prototype.initializeData=function(e){var t=this;this.tenant=widget.getValue("x3dPlatformId");var i=null==this.tenant?null:this.tenant,n=null==this.securityContext?null:this.securityContext;s.app_initialization(function(){u.getSecurityContextPromise(i,n).then(function(i){t.securityContext=i,t.initData(e)})})},fe.prototype.initData=function(e){var t=this,i=null!=e?e.idDataList:null;if(null==i&&null!=(i=g.fetchPersistedIDs())){var n=i.get_nonNullCount();n>0&&console.log("CompareInput: initializing with "+n+" persisted ids")}if(null!=i)if("modelIDList"===i.listType||"IDPlusCommandsList"===i.listType){let e="IDPlusCommandsList"===i.listType?i.get_allIDList():i.get_objIDList(),n=i.get_objServices();t.validateIdsThenCall(e,n,function(){if(Array.isArray(n)&&n.length){for(var r of i.items)null!=r&&(r.objectServices.envId||(r.objectServices.envId=t.tenant),r.objectServices.contextId||(r.objectServices.contextId=t.securityContext));t.idDataList=i}else{t.idDataList=new v(i.listType);for(let i=0,n=e.length;i<n;i++){let n=e[i],r={serviceId:t.validateObj_stateData[n].serviceId,envId:t.tenant,objectId:n,objectType:t.validateObj_stateData[n].objectType,contextId:t.securityContext};t.idDataList.items.push(new y(n,r))}}t.processValidatedIDs()})}else console.log("CompareInput: failure initializing with an unknown type of id list"),this.inputRoot.show();else if(!this.loadFromCompassOK||null!=e&&void 0!==e.noCompassContent&&null!==e.noCompassContent&&!0===e.noCompassContent)t.inputRoot.show();else{var r=g.fetchContentFromCompass();if(null!=r){null!=r.useIndex&&widget.setValue("useIndex",r.useIndex);var o=r.envId;if(null==o&&null!=r.data&&null!=r.data.items&&r.data.items.length>0&&(o=r.data.items[0].envId),null!=o&&0!=o.length&&(t.tenant=o,widget.setValue("x3dPlatformId",t.tenant),ae("CompareInput: compass data indicates tenant is now '"+t.tenant+"'")),void 0!==r.data&&null!==r.data)if(console.log("CompareInput: initializing with "+r.data.items.length+" from compass"),r.data.items.length>5)t.inputRoot.show(),de("selectFiveOrFewer","compare-alert-error");else{void 0!==t.runOptions.ImmediateCompare&&null!==t.runOptions.ImmediateCompare||(t.runOptions.ImmediateCompare=r.data.immediateCompare);var a=r.listType;if(null==a&&(a=g.determineListType(r.data)),"modelIDList"===a||"IDPlusCommandsList"===a){let e=[],i=[];r.data.items.forEach(function(n){if(null!=n){var r=n.contextId,o=null!=r&&r.constructor===String&&0!==r.length?r:t.securityContext;e.push(n.objectId),i.push({serviceId:n.serviceId,envId:n.envId,objectId:n.objectId,objectType:n.objectType,contextId:o,displayName:n.displayName,displayType:n.displayType,idType:n.idType,commands:n.commands,queryDef:n.filterQuery})}}),t.validateIdsThenCall(e,i,function(){null==t.idDataList&&(t.idDataList=new v(a));for(var n=0;n<e.length;++n){null==i[n].objectType&&(i[n].objectType=t.validateObj_stateData[e[n]].objectType);var o=new y(e[n],i[n]);void 0!==i[n].queryDef&&null!==i[n].queryDef&&(o.queryDef=i[n].queryDef),t.idDataList.items.push(o)}var l=r.biProxyCtx;if(null!=l){var s=r.data.items.map(function(e){return e.objectId});t.processIdsContainingFilters(s,l,!1,"left")}t.processValidatedIDs()})}}else t.inputRoot.show()}else t.inputRoot.show()}},fe.prototype.searchButtonPressed=function(e){console.log("CompareInput: "+e+" Search button press handler");var t=this;h.displaySearchPanel(this.tenant,function(i){t.onSelectedFromSearch(e,i)})},fe.prototype.revisionsOfButtonPressed=function(e){console.log("CompareInput: Revisions of  "+e+" button press handler");var t=this;if("left"===e||"right"===e){var i=this.idDataList.get_objServices("left"===e?"right":"left");if(null!=i&&i.length>0){var n=t.validateObj_stateData[i[0].objectId],r={objId:n.isFilter?n.filter.rootObj.physicalid:i[0].objectId,objType:n.isFilter?n.filter.rootObj.internalType:i[0].objectType,tenant:this.tenant,securityContext:this.securityContext};C.displayHistoryGraph(r,null,function(n){var r=[],o=n.physicalid;r.push(o);var a=[],l=void 0;null!=i&&i.length>0&&void 0!==i[0]&&null!==i[0]&&(l={envId:i[0].envId,objectId:o,objectType:n.type,serviceId:i[0].serviceId,contextId:i[0].contextId,displayName:n.displayName}),a.push(l),t.validateIdsThenCall(r,a,function(){var i=new y(r[0],a[0]);"left"===e?t.idDataList.items[0]=i:t.idDataList.items.length>1?t.idDataList.items[1]=i:t.idDataList.items.push(i),"left"!==e&&"right"!==e||t.clearFiltering(e,!0),t.processValidatedIDs()})})}else console.log("CompareInput: revisionsOfButtonPressed failure")}else console.log("CompareInput: revisionsOfButtonPressed failure")},fe.prototype.filtersOfButtonPressed=function(e){console.log("CompareInput: Filters of  "+e+" button press handler");if("left"===e||"right"===e){var t=this.idDataList.get_objServices("left"===e?"right":"left");if(null!=t&&t.length>0){var i=this.validateObj_stateData[t[0].objectId],n={objId:i.isFilter?i.filter.rootObj.physicalid:t[0].objectId,objType:i.isFilter?i.filter.rootObj.internalType:t[0].objectType,tenant:this.tenant,securityContext:this.securityContext,displayName:ce(i.isFilter?i.filter.rootObj:i,!0)};this.displayFilterPanel(e,n)}else console.log("CompareInput: filtersOfButtonPressed failure")}else console.log("CompareInput: filtersOfButtonPressed failure")},fe.prototype.replaceWithRevisionOf=function(e){console.log("CompareInput Revision context menu handler reached");var t=this;if("left"===e||"right"===e){var i=this.idDataList.get_objServices(e);if(null!=i&&i.length>0){var n=t.validateObj_stateData[i[0].objectId],r={objId:n.isFilter?n.filter.rootObj.physicalid:i[0].objectId,objType:n.isFilter?n.filter.rootObj.internalType:i[0].objectType,tenant:this.tenant,securityContext:this.securityContext};C.displayHistoryGraph(r,null,function(n){var r=[],o=n.physicalid;r.push(o);var a=[],l={envId:i[0].envId,objectId:o,objectType:i[0].objectType,serviceId:i[0].serviceId,contextId:i[0].contextId,displayName:n.displayName};a.push(l),t.validateIdsThenCall(r,a,function(){var i=new y(r[0],a[0]);t.idDataList.items["left"===e?0:1]=i,"left"!==e&&"right"!==e||t.clearFiltering(e,!0),t.processValidatedIDs()})})}else console.log("CompareInput: replaceWithRevisionOf failure")}else console.log("CompareInput: replaceWithRevisionOf failure")},fe.prototype.replaceWithFilterOf=function(e){console.log("CompareInput Filter context menu handler reached");if("left"===e||"right"===e){var t=this.idDataList.get_objServices(e);if(null!=t&&t.length>0){var i=this.validateObj_stateData[t[0].objectId],n={objId:i.isFilter?i.filter.rootObj.physicalid:t[0].objectId,objType:i.isFilter?i.filter.rootObj.internalType:t[0].objectType,tenant:this.tenant,securityContext:this.securityContext,displayName:ce(i.isFilter?i.filter.rootObj:i,!0)};this.displayFilterPanel(e,n)}else console.log("CompareInput: replaceWithFilterOf failure")}else console.log("CompareInput: replaceWithFilterOf failure")},fe.prototype.replaceWithSearch=function(e){console.log("CompareInput: "+e+" Open context menu handler reached");var t=this;h.displaySearchPanel(this.tenant,function(i){t.onSelectedFromSearch(e,i)})},fe.prototype.swapColumns=function(){if(console.log("CompareInput Swap Columns context menu handler reached"),w=null,T=null,void 0!==this.idDataList&&null!==this.idDataList){var e=this.idDataList.items[0];this.idDataList.items[0]=this.idDataList.items.length>1?this.idDataList.items[1]:null,this.idDataList.items[1]=e;var t={idDataList:this.idDataList};this.initData(t)}},fe.prototype.validateAndProcessObjDrop=function(e,t){this.validateAndProcessDrop(e,t)},fe.prototype.validateAndProcessDrop=function(e,t,i){var n=this,r=e.objArray;p.reset(),widget.addEventOnce("ENOLCM/CompareWidget/entireCompareDone",function(){p.dump()});var o=r.map(function(e){return e.objectId}),a=o.length,l=null!=i&&i.forRevisionOf,s=null!=i&&i.forFilterOf;if(l){if(1!==a)return void de("onlyOneObjForRevOf","compare-alert-warning")}else if(s){if(1!==a)return void de("onlyOneObjForFilterOf","compare-alert-warning")}else{if(a>5)return void de("selectFiveOrFewer","compare-alert-error");if(a<1)return void console.warn("WARNING: unexpected drop count... no processing to be done")}var u=r[0].envId;null!=u&&0!=u.length||(u=null);var c=widget.getValue("x3dPlatformId");if(null!=u){if(!this.checkAdjustTenant(a,t,c,u))return}else ae("Dropped ID has no tenant info / value not changed, value remains "+c);var d=r.map(function(e){var t={};for(var i in e)t[i]=e[i];return t});this.validateIdsThenCall(o,d,function(){l?n.processValidatedId_RevisionOf(o,d,t):n.processValidatedIds_Drop(o,d,t,e.filterProxy,i,function(e){s&&-1!==t.indexOf(e)&&(n._supportsFilters(o[0],e)?n.processValidatedId_FilterOf(o,d,e):de("filtersNotSupported","compare-alert-warning"))})})},fe.prototype.processValidatedIds_Drop=function(e,t,i,n,r,o){null==this.idDataList&&(this.idDataList=new v("modelIDList"));for(var a=0;a<e.length;++a){var l=new y(e[a],t[a]);1===e.length?"drop-left"===i?this.idDataList.items[0]=l:"drop-right"===i&&(this.idDataList.items[1]=l):this.idDataList.items.push(l)}if(null!=n){var s=null!=r&&r.forFilterOf,u="drop-left"===i?"left":"right";this.processIdsContainingFilters(e,n,s,u)}this.processValidatedIDs(o)},fe.prototype.processIdsContainingFilters=function(e,t,i,n){var r=this;let o=e.length;if(1===o){let r="left"===n?this._filterProxy.left:this._filterProxy.right;this.processIdContainingFilters(e[0],r,t,i,n)}else 2===o&&"left"===n&&r.processIdContainingFilters(e[0],r._filterProxy.left,t,i,"left").then(()=>{r.processIdContainingFilters(e[1],r._filterProxy.right,t,i,"right")}).catch(e=>{console.log("CompareInput processIdContainingFilters failure")})},fe.prototype.processIdContainingFilters=function(e,t,i,n,r){var o=this;return new Promise(function(a,l){if(null==t)console.log("CompareInput processIdContainingFilters: filter proxy not initialized"),l();else{t.activate();var s=[e];console.log("CompareInput processIdContainingFilters: "+r+": before areRootsSharable()?"),t.areRootsSharable(s,i).then(function(e){console.log("CompareInput processIdContainingFilters: "+r+": after areRootsSharable()?"),null!=e?(console.log("CompareInput processIdContainingFilters: "+r+": "+e.length+" rootsSharable"),e.forEach(function(e){!0===e.hasFilter?(console.log("CompareInput processIdContainingFilters: "+r+": rootsSharable and hasFilter, calling shareFilterSpec: "+e.rootId),t.shareFilterSpec({fromRootId:e.rootId,fromSourceCtx:i,fromDropOnFilter:n,callback:function(e){console.log("CompareInput processIdContainingFilters: "+r+": reached shareFilterSpec callback");var t=e.success;if(null!=t&&t.length>0)if(void 0!==t[0].filter&&null!==t[0].filter){console.log("CompareInput processIdContainingFilters: "+r+": shareFilter success, applied filter definition retrieved OK");var i=null;"left"===r?t[0].rootId===o.idDataList.items[0].objectId&&null==o.idDataList.items[0].filterData?(o.idDataList.items[0].filterData=t[0].filter,i=o.leftTile,console.log("CompareInput processIdContainingFilters: "+r+": SUCCESS applying applied filter")):console.log("CompareInput processIdContainingFilters: "+r+": error applying applied filter"):t[0].rootId===o.idDataList.items[1].objectId&&null==o.idDataList.items[1].filterData?(o.idDataList.items[1].filterData=t[0].filter,i=o.rightTile,console.log("CompareInput processIdContainingFilters: "+r+": SUCCESS applying applied filter")):console.log("CompareInput processIdContainingFilters: "+r+": error applying applied filter"),g.persistIDs(o.idDataList),null!=i&&ge(i,{type:"filter",title:t[0].filter.filterTitle})}else void 0!==t[0].filterId&&null!==t[0].filterId&&t[0].filterId.length>0&&void 0!==t[0].filterId[0]&&null!==t[0].filterId[0]&&""!==t[0].filterId[0]?(console.log("CompareInput processIdContainingFilters: "+r+": filter definition FAIL, using filterId to retrieve definition instead"),("left"===r&&t[0].rootId===o.idDataList.items[0].objectId||"right"===r&&t[0].rootId===o.idDataList.items[1].objectId)&&(o.replaceIdWithFilterId(r,t[0].filterId[0]),console.log("CompareInput processIdContainingFilters: "+r+": shareFilter success, filter definition FAIL, filterId SUCCESS"))):console.log("CompareInput processIdContainingFilters: "+r+": shareFilter success, filter definition FAIL, filterId FAIL");else console.log("CompareInput processIdContainingFilters: "+r+": shareFilter NO success");a()}}),a()):a()})):a()})}})},fe.prototype.replaceIdWithFilterId=function(e,t){var i=this,n=[t],r=[{envId:null,objectId:t,objectType:"ENOStrRefinementSpecification",serviceId:null}];i.validateIdsThenCall(n,r,function(){var t=new y(n[0],r[0]);"left"===e?i.idDataList.items[0]=t:i.idDataList.items.length>1?i.idDataList.items[1]=t:i.idDataList.items.push(t),"left"!==e&&"right"!==e||i.clearFiltering(e,!0),i.processValidatedIDs()})},fe.prototype.validateIdsThenCall=function(e,i,n){var o=this;if(e.length>0)if(null!=i&&i.length>0&&void 0!==i[0]&&null!==i[0]&&!me(i[0])){void 0===d.typeInfo||null===d.typeInfo||void 0===d.typeInfo[i[0].objectType]||null===d.typeInfo[i[0].objectType]?(r.mask(this.inputRoot.parentElement),a.getPlatformServices({onComplete:function(e){for(var r=-1,a=0;a<e.length&&-1===r;++a)e[a].platformId===i[0].envId&&(r=a);if(r>-1){var l=e[r][i[0].serviceId]+"/"+i[0].serviceId,s=l+"/compareMetaData/"+i[0].objectType;d.typeInfo[i[0].objectType]={serviceId:i[0].serviceId,url:l,b3DViewerSupported:!1};try{t.authenticatedRequest(s,{proxy:o.proxyType,method:"GET",onComplete:function(e){try{var t=JSON.parse(e);d.typeInfo[i[0].objectType].structure=t.structure,d.typeInfo[i[0].objectType].attributes=t.attributes,void 0!==d.typeInfo[i[0].serviceId]&&null!==d.typeInfo[i[0].serviceId]||(d.typeInfo[i[0].serviceId]={serviceId:i[0].serviceId,url:l,b3DViewerSupported:!1},d.typeInfo[i[0].serviceId].structure=t.structure,d.typeInfo[i[0].serviceId].attributes=t.attributes),i.forEach(function(e){let t={physicalid:e.objectId,objectId:e.objectId,objectType:e.objectType,serviceId:e.serviceId,attributesUrl:{url:d.typeInfo[e.objectType].url,attributes:d.typeInfo[e.objectType].attributes}};o.updateValidatedObj_StateData(t)}),n()}catch(e){console.log("COMPARE compareMetaData invalid syntax"),n()}},onFailure:function(e){console.log("COMPARE CONTENT: failed getting compare metadata")}})}catch(e){console.log("COMPARE failure calling compareMetaData service '"+s+"'")}}else console.log("COMPARE failure identifying compareMetaData service URL for "+i[0].envId+" "+i[0].serviceId)},onFailure:function(){console.log("COMPARE failure retrieving compareMetaData service URL for "+i[0].envId+" "+i[0].serviceId)}})):(i.forEach(function(e){let t={physicalid:e.objectId,objectId:e.objectId,objectType:e.objectType,serviceId:e.serviceId,attributesUrl:{url:d.typeInfo[e.objectType].url,attributes:d.typeInfo[e.objectType].attributes}};o.updateValidatedObj_StateData(t)}),n())}else{var l=e.join(",");if(l.includes("cid:"))for(var u of i)u.objectId.includes("cid:")&&de("OBJ_TYPE_UNSUPPORTED","compare-alert-warning",u.displayName);else{r.mask(this.inputRoot.parentElement);var c=s.get3DSpaceWSUrl(this.tenant,"/resources/compare/getObjState","objectIds="+l);let e={};i[0].contextId&&(e.securityContext=i[0].contextId);try{t.authenticatedRequest(c,{proxy:this.proxyType,method:"GET",headers:e,onComplete:function(e){var t=JSON.parse(e).results;null==t||"number"!=typeof t.length?de("BAD_OBJDATA","compare-alert-error"):g.accessRightsPromise(t,o.tenant,o.securityContext,function(e){var i=!1;for(var r of t)!1===r.exists&&(i=!0),e||(r.notAccessible=!0,i=!0);if(!i)for(r of t)r.requiresIndex&&g.forceRequireIndex(!1),r.serviceId="3DSpace",o.updateValidatedObj_StateData(r);for(r of t){if(!1===r.exists){de("OBJ_NOT_FOUND","compare-alert-error"),widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_leftSideDone","CompareInput left side done"),widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_rightSideDone","CompareInput right side done");break}if(!0===r.notAccessible){de("OBJ_INACCESSIBLE","compare-alert-error"),widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_leftSideDone","CompareInput left side done"),widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_rightSideDone","CompareInput right side done");break}}i||n()})}})}catch(e){console.log("Exception on '"+c+"'")}}}},fe.prototype.checkAdjustTenant=function(e,t,i,n){var r=!0;return i===n?ae("Tenant info for dropped ID same as current tenant / no change ("+i+", "+n+")"):1===e&&(null!=this.idDataList&&null!=this.idDataList.getLeftID()&&"drop-right"===t||null!=this.idDataList&&null!=this.idDataList.getRightID()&&"drop-left"===t)?(de("tenantMismatch","compare-alert-error"),ae("Both objects' tenants must match // "+i+" != "+n+"... rejecting dropped object"),r=!1):(de("tenantChanged","compare-alert-success"),ae("Changing tenant, based upon dropped ID, from '"+i+"' to '"+n+"'"),widget.setValue("x3dPlatformId",n),this.tenant=n),r},fe.prototype.updateValidatedObj_StateData=function(e){var t=e.physID||e.physicalid;if(e.physicalid=t,null==this.validateObj_stateData[t])this.validateObj_stateData[t]=e;else for(var i in e)this.validateObj_stateData[t][i]=e[i]},fe.prototype.processValidatedIDs=function(e){var t=this,i=0;if(null!=t.idDataList&&(i=t.idDataList.get_nonNullCount()),0!==i)if(g.persistIDs(this.idDataList),this.loadFromCompassOK=!1,r.unmask(this.inputRoot.parentElement),this.idDataList.areCompared||i>2||2===i&&this.runOptions.ImmediateCompare||"IDPlusCommandsList"===this.idDataList.listType)console.log("CompareInput Starting an immediate comparison"),this.doCompare();else{var n=s.get3DSpaceBaseUrl(this.tenant),o=null==this.tenant?null:this.tenant,a=null==this.securityContext?null:this.securityContext;s.app_initialization(function(){u.getSecurityContextPromise(o,a).then(function(i){t.inputRoot.show();var a=t.inputRoot.getElement("#"+J),l=t.inputRoot.getElement("#"+x),s=t.idDataList.getLeftID();if(null!=s){var u=t.validateObj_stateData[s];let c=t.idDataList.get_objServices("left");null!=c&&c.length>0&&void 0!==c[0]&&null!==c[0]&&(void 0!==c[0].preview_url&&null!==c[0].preview_url&&""!==c[0].preview_url&&(u.preview_url=c[0].preview_url),void 0!==c[0].type_icon_url&&null!==c[0].type_icon_url&&""!==c[0].type_icon_url&&(u.type_icon_url=c[0].type_icon_url),void 0!==c[0].displayName&&null!==c[0].displayName&&""!==c[0].displayName&&(u.displayName=c[0].displayName),void 0!==c[0].displayType&&null!==c[0].displayType&&""!==c[0].displayType&&(u.displayType=c[0].displayType)),l.hide(),a.show();let d=t.inputRoot.getElement("div#"+a.parentElement.id);r.mask(d),g.augDroppedObject(u,{tenant:o,securityContext:i,url3DSpace:n},function(i){let o="",l=void 0!==t.idDataList.items[0].filterData&&null!==t.idDataList.items[0].filterData;l&&(o=t.idDataList.items[0].filterData.filterTitle);let s=void 0!==u.filter&&null!==u.filter,c=null;s&&(c=u.filter.rootObj,o=u.filter.filterTitle);let p=void 0!==t.idDataList.items[0].queryDef&&null!==t.idDataList.items[0].queryDef;t.createOrigTile(a,s&&null!==c?c:u,n,"passport",{applyBadgeToImage:l||s||p?{type:"filter",title:o}:null}),t.updateUIforIdList(),r.unmask(d),null!=e&&"function"==typeof e&&e("left"),widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_leftSideDone","CompareInput left side done")},function(e){console.log("augDroppedObject error: "+e)})}else l.show(),a.hide();var c=t.inputRoot.getElement("#"+K),d=t.inputRoot.getElement("#"+A),p=s;if(null!=(s=t.idDataList.getRightID())){var f=t.validateObj_stateData[s];let a=t.idDataList.get_objServices("right");null!=a&&a.length>0&&void 0!==a[0]&&null!==a[0]&&(void 0!==a[0].preview_url&&null!==a[0].preview_url&&""!==a[0].preview_url&&(f.preview_url=a[0].preview_url),void 0!==a[0].type_icon_url&&null!==a[0].type_icon_url&&""!==a[0].type_icon_url&&(f.type_icon_url=a[0].type_icon_url),void 0!==a[0].displayName&&null!==a[0].displayName&&""!==a[0].displayName&&(f.displayName=a[0].displayName),void 0!==a[0].displayType&&null!==a[0].displayType&&""!==a[0].displayType&&(f.displayType=a[0].displayType)),d.hide(),c.show();let l=t.inputRoot.getElement("#"+c.parentElement.id);r.mask(l),g.augDroppedObject(f,{tenant:o,securityContext:i,url3DSpace:n},function(i){let o="",a=void 0!==t.idDataList.items[1].filterData&&null!==t.idDataList.items[1].filterData;a&&(o=t.idDataList.items[1].filterData.filterTitle);let s=void 0!==f.filter&&null!==f.filter,u=null;s&&(u=f.filter.rootObj,o=f.filter.filterTitle);let d=void 0!==t.idDataList.items[1].queryDef&&null!==t.idDataList.items[1].queryDef;t.createOrigTile(c,s&&null!==u?u:f,n,"passport",{applyBadgeToImage:a||s||d?{type:"filter",title:o}:null}),t.updateUIforIdList(),r.unmask(l),null!=e&&"function"==typeof e&&e("right"),widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_rightSideDone","CompareInput right side done")},function(e){console.log("augDroppedObject error: "+e)})}else d.show(),c.hide(),""!==p&&!0===t.runOptions.ImmediateRevisionOf&&t.revisionsOfButtonPressed("right")})})}else console.error("CompareInput failed sanity check in processValidatedIDs")},fe.prototype.validateAndProcessRevisionOfDrop=function(e,t){var i=this;!function(e,t){var i=!1;return void 0!==e.filterProxy&&null!==e.filterProxy?i=!0:null!=e&&void 0!==e.objArray&&null!==e.objArray&&e.objArray.length>0&&"ENOStrRefinementSpecification"===e.objArray[0].objectType&&(i=!0),i}(e)?!function(e,t){var i=!0;return null!=e&&void 0!==e.objArray&&null!==e.objArray&&e.objArray.length>0&&!me(e.objArray[0])&&(i=!1,e.objArray[0].serviceId),i}(e)?pe(D.get("RevisionsNotSupported"),I.ok,I.ko,function(){i.validateAndProcessDrop(e,t)},function(){}):this.validateAndProcessDrop(e,t,{forRevisionOf:!0}):pe(D.get("CantDropFilterOnRevisions"),I.ok,I.ko,function(){i.validateAndProcessDrop(e,t)},function(){})},fe.prototype.processValidatedId_RevisionOf=function(e,t,i){console.log("CompareInput: Revisions of "+i+" dropped item handler");var n=this;if("drop-left"===i||"drop-right"===i){var o={objId:t[0].objectId,objType:t[0].objectType,tenant:this.tenant,securityContext:this.securityContext};r.unmask(this.inputRoot.parentElement),C.displayHistoryGraph(o,null,function(e){var r=[],o=e.physicalid;r.push(o);var a=[],l={envId:t[0].envId,objectId:o,objectType:t[0].objectType,serviceId:t[0].serviceId,contextId:t[0].contextId,displayName:e.displayName};a.push(l),n.validateIdsThenCall(r,a,function(){null==n.idDataList&&(n.idDataList=new v("modelIDList"));var e=new y(r[0],a[0]);"drop-left"===i?n.idDataList.items[0]=e:n.idDataList.items.length>1?n.idDataList.items[1]=e:n.idDataList.items.push(e),"drop-left"===i?n.clearFiltering("left",!0):"drop-right"===i&&n.clearFiltering("right",!0),n.processValidatedIDs()})})}else console.log("CompareInput: RevisionsOf Dropped Item failure")},fe.prototype.validateAndProcessFilterOfDrop=function(e,t){this.validateAndProcessDrop(e,t,{forFilterOf:!0})},fe.prototype.processValidatedId_FilterOf=function(e,t,i){console.log("CompareInput: Filters of "+i+" item handler");if("left"===i||"right"===i){var n=this.validateObj_stateData[t[0].objectId],r={objId:n.isFilter?n.filter.rootObj.physicalid:t[0].objectId,objType:n.isFilter?n.filter.rootObj.internalType:t[0].objectType,tenant:this.tenant,securityContext:this.securityContext,displayName:ce(n.isFilter?n.filter.rootObj:n,!0)};this.displayFilterPanel(i,r)}else console.log("CompareInput:FilterOf Dropped Item failure");widget.dispatchEvent("ENOLCM/CompareCommon/CompareInput_FilterDisplayDone","CompareInput filter display done")},fe.prototype.onSelectedFromSearch=function(e,t){var i=this;if(null!=t){if("left"===e&&t.length>5||"right"===e&&t.length>4)return void de("selectFiveOrFewer","compare-alert-error");var n=[],r=[];for(const e of t)if(null!=e){var o=e.id;n.push(o);var a=e.sourceid_value.split(":"),l={contextId:i.securityContext,displayName:e["ds6w:label_value"],displayType:e["ds6w:type"],envId:a.length>1?a[1]:i.tenant,objectId:e.id,objectType:e["ds6w:type_value"],serviceId:a[0],preview_url:e.preview_url_value,type_icon_url:e.type_icon_url_value};r.push(l)}i.validateIdsThenCall(n,r,function(){null==i.idDataList&&(i.idDataList=new v("modelIDList"));let t="left"===e?0:1;for(var o=0;o<n.length;++o,++t)i.idDataList.items[t]=new y(n[o],r[o]);"left"!==e&&"right"!==e||i.clearFiltering(e,!0),i.processValidatedIDs()})}},fe.prototype.displayFilterPanel=function(e,t){"left"===e?null!==this._filterProxy.left&&this._filterProxy.left.activate():null!==this._filterProxy.right&&this._filterProxy.right.activate();var i="left"===e?"ComparePanel_Left":"ComparePanel_Right";null!==this._filterCmd&&this._filterCmd.NGFUXId===i?this._filterCmd.setRoot(t):this._filterCmd=new m({ID:"DefineFilter",root:t,NGFUXId:i}),this._filterCmd.execute()},fe.prototype.onFetchFilterBIFilteringEvent=function(e){},fe.prototype.onApplyNGFilterLeft=function(e){this.onApplyNGFilter("left",e)},fe.prototype.onApplyNGFilterRight=function(e){this.onApplyNGFilter("right",e)},fe.prototype.onApplyNGFilter=function(t,i){var n=i||null;n=e.is(n,"string")?JSON.parse(n):n;var r="left"===t?this.leftTile:this.rightTile,o=n.filterRootIds[0],a=this.validateObj_stateData[o],l=this.inputRoot.getElement("#"+X+"-"+t);if(this.inputRoot.getElement("#"+L+"-"+t).hide(),l.show(),null==r){var u=s.get3DSpaceBaseUrl(this.tenant);this.createOrigTile(l,a,u,"passport",{applyBadgeToImage:{type:"filter",title:n.filterTitle},highlight:!0})}else ge(r,{type:"filter",title:n.filterTitle}),"left"===t?w=a.physicalid:"right"===t&&(T=a.physicalid);const c="left"===t?0:1,d="left"===t?1:0;if(o!==("left"===t?this.idDataList.getLeftID():this.idDataList.getRightID()))for(var p in void 0!==this.idDataList.items[c]&&null!==this.idDataList.items[c]||(this.idDataList.items[c]={}),this.idDataList.items[d])this.idDataList.items[c][p]=this.idDataList.items[d][p];this.idDataList.items[c].filterData=n,this.idDataList.items[c].requiresIndex=!0,g.forceRequireIndex(!1),this.updateUIforIdList(),g.persistIDs(this.idDataList)},fe.prototype.createOrigTile=function(e,i,n,r,a){var l=this,s="";if(e.id.endsWith("-left")?s="left":e.id.endsWith("-right")?s="right":console.log("CompareInput createOrigTile failure"),void 0!==e.children&&null!==e.children&&e.children.length>0)for(;e.children.length>0;){var u=e.children[e.children.length-1];e.removeChild(u)}var d=n+b,p=n+S,f=(e.id,ce(i,!1)),h=function(e){var t=e.displayType;return null!=t&&""!==t||(t=e.type),t}(i),m=i.revision;null!=a&&(void 0!==a.customTitle&&null!==a.customTitle&&""!==a.customTitle&&(f=a.customTitle),void 0!==a.customSubtitle&&null!==a.customSubtitle&&""!==a.customSubtitle&&(h=a.customSubtitle),void 0!==a.prependToSubtitle&&null!==a.prependToSubtitle&&""!==a.prependToSubtitle&&(h=a.prependToSubtitle+h),void 0!==a.customDescription&&null!==a.customDescription&&""!==a.customDescription&&(m=a.customDescription));var g=[],v=[],y=[];this._supportsRevisions(i.physicalid,s)&&(g.push(D.get("revisionCM")),v.push("revision"),y.push("flow-branch-list")),this._supportsFilters(i.physicalid,s)&&(g.push(D.get("filterCM")),v.push("filter"),y.push("filter")),this._supportsOpenContent(s)&&(g.push(D.get("openCM")),v.push("open"),y.push("open")),g.push(D.get("swapColumnsCM")),v.push("swap"),y.push("exchange"),g.push(D.get("removeCM")),v.push("remove"),y.push("remove");var C=new o({picture:d,icon:p,title:f,multipleTitleLineNumber:!1,subtitle:h,description:m,statusbarIcons:[],contextualMenu:g,onContextMenuBuildCallback:function(e){var t=[];if(null!=e)for(var i=0;i<e.length;i++)t.push({type:"PushItem",title:e[i],icon:y[i],action:{context:v[i]+"-"+s,callback:function(e){var t=e.context.indexOf("-"),i=e.context.substring(t+1);""!==i?e.context.startsWith("revision-")?l.replaceWithRevisionOf(i):e.context.startsWith("filter-")?l.replaceWithFilterOf(i):e.context.startsWith("open-")?l.replaceWithSearch(i):e.context.startsWith("swap-")?l.swapColumns():e.context.startsWith("remove-")?l.clearItem(i):console.log("CompareInput context menu callback UNKNOWN reached"):console.log("CompareInput context menu callback id failure")}}});return t}}).inject(e);C.getContent().setStyle("width","100%"),null!=a&&(!0===a.highlight&&C.highlight(),void 0!==a.applyBadgeToImage&&null!==a.applyBadgeToImage&&ge(C,a.applyBadgeToImage)),function(e,i,n,r,o,a){if(void 0===n.serviceId||null===n.serviceId||""===n.serviceId||"3dspace"===n.serviceId.toLowerCase())if(void 0!==n.preview_url&&null!==n.preview_url&&""!==n.preview_url)r.picture=n.preview_url;else{var l=n.physicalid,s="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=s&&""!=s||(s="OnPremise");var u=e+O+l+"/?tenant="+s+"&root3DSpaceUrl="+e;if("Workspace"==a){var d=c.getObjTypeLargeIconPath(a);null!=d&&(r.picture=e+"/"+d)}else t.authenticatedRequest(u,{ndx:0,proxy:i,onComplete:function(t){if(console.log("CompareInput getImage success"),t.endsWith("iconLargeDefault.png")){var i=c.getObjTypeLargeIconPath(a);null!=i&&(t=e+"/"+i)}r.picture=t},onFailure:function(){console.log("CompareInput getImage failed")}})}else r.picture=n.preview_url}(n,r,i,C,0,i.internalType),function(e,i,n,r,o,a){if(void 0===n.serviceId||null===n.serviceId||""===n.serviceId||"3dspace"===n.serviceId.toLowerCase())if(void 0!==n.type_icon_url&&null!==n.type_icon_url&&""!==n.type_icon_url)r.icon=n.type_icon_url;else{var l=n.physicalid,s="undefined"!=typeof widget&&widget?widget.getValue("x3dPlatformId"):null;null!=s&&""!=s||(s="OnPremise");var u=e+_+l+"/?tenant="+s+"&root3DSpaceUrl="+e;if("Workspace"==a){var d=c.getObjTypeIconPath(a);null!=d&&(r.icon=e+"/"+d)}else t.authenticatedRequest(u,{ndx:0,proxy:i,onComplete:function(t){if(console.log("CompareInput getIcon success"),t.endsWith("iconLargeDefault.png")){var i=c.getObjTypeIconPath(a);null!=i&&(t=e+"/"+i)}r.icon=t},onFailure:function(){console.log("CompareInput getIcon failed")}})}else r.icon=n.type_icon_url}(n,r,i,C,0,i.internalType);var I=null,j=null;if("left"===s?(I=jQuery("#"+oe),j=jQuery("#"+ie)):"right"===s&&(I=jQuery("#"+re),j=jQuery("#"+te)),null!==I&&I.length>0){I[0].children[0].nextSibling.nodeValue=D.get("revisionOfButtonLabel").replace("{objname}",f)}if(null!==j&&j.length>0){j[0].children[0].nextSibling.nodeValue=D.get("filterOfButtonLabel").replace("{objname}",f)}"left"===s?(w=i.physicalid,this.leftTile=C):"right"===s&&(T=i.physicalid,this.rightTile=C)},fe.prototype.updateUIforIdList=function(){var e=null!=this.idDataList?this.idDataList.get_nonNullCount():0;if(e<2?this.compareBtn.disable():this.compareBtn.enable(),this.inputFooter[0===e?"hide":"show"](),e>0?jQuery("#compare-input-container-right").show():jQuery("#compare-input-container-right").hide(),jQuery("#compare-input-drop-target-left").css("border",e>0?"":"none"),jQuery("#"+$)[0].children[0].nextSibling.nodeValue=D.get(e>0?"searchButtonLabel":"addObjectsDZ"),null===this.idDataList||null===this.idDataList.getLeftID()){let t=e>0&&this._supportsRevisions(this.idDataList.getRightID(),"left"),i=e>0&&this._supportsFilters(this.idDataList.getRightID(),"left"),n=this._supportsOpenContent("left"),r=jQuery("#"+re);r[0].style.display=t?"":"none",(r=jQuery("#"+te))[0].style.display=i?"":"none",(r=jQuery("#"+$))[0].style.display=n?"":"none"}if(null!==this.idDataList&&null!==this.idDataList.getLeftID()&&null===this.idDataList.getRightID()){let e=this._supportsRevisions(this.idDataList.getLeftID(),"right"),t=this._supportsFilters(this.idDataList.getLeftID(),"right"),i=this._supportsOpenContent("right"),n=jQuery("#"+oe);n[0].style.display=e?"":"none",(n=jQuery("#"+ie))[0].style.display=t?"":"none",(n=jQuery("#"+Z))[0].style.display=i?"":"none"}},fe.prototype.computeOrientation=function(e){var t="";if(null!=e){var i=e.clientWidth,n=e.clientHeight;t=i<480&&n>i?"over-under":"side-by-side"}return t},fe.prototype.updateDisplayOrientation=function(){var e=jQuery("#compare-input-root"),t=this.computeOrientation(e[0]);if(t!==this.displayOrientation){this.displayOrientation=t;var i="side-by-side"===this.displayOrientation?"row":"column";jQuery("#compare-input-drop-targets").css("flex-direction",i)}},fe.prototype.updateTenant=function(e,t){var i=this;null!=this.idDataList&&this.idDataList.get_nonNullCount()>0?pe(D.get("PlatformChange"),D.get("ChangeButton"),D.get("CancelButton"),function(){i.clearItem("all"),i.tenant=e,de("tenantChanged","compare-alert-success"),t(!0)},function(){t(!1)}):(this.tenant=e,de("tenantChanged","compare-alert-success"),t(!0))},fe.prototype.clearItem=function(e){"left"==e?(this.idDataList.items.length>0&&(this.idDataList.items[0]=null),this.idDataList.get_nonNullCount()>0?(this.idDataList.areCompared=!1,g.persistIDs(this.idDataList)):(this.idDataList=null,g.clear_persistedIDs()),this.clearTileItem(e),this.clearFiltering(e,!0),w=""):"right"==e?(this.idDataList.items.length>1&&(this.idDataList.items[1]=null),this.idDataList.get_nonNullCount()>0?(this.idDataList.areCompared=!1,g.persistIDs(this.idDataList)):(this.idDataList=null,g.clear_persistedIDs()),this.clearTileItem(e),this.clearFiltering(e,!0),T=""):(this.idDataList=null,g.clear_persistedIDs(),this.clearTileItem("left"),this.clearTileItem("right"),this.clearFiltering("",!0),w="",T="",this.inputRoot.show()),this.updateUIforIdList()},fe.prototype.clearFiltering=function(e,t){"left"!==e&&""!==e||null===this._filterProxy.left||this._filterProxy.left.removeRoot(w),"right"!==e&&""!==e||null===this._filterProxy.right||this._filterProxy.right.removeRoot(T)},fe.prototype.clearTileItem=function(e){var t=jQuery("#"+X+"-"+e);for(t.hide();t[0].children.length>0;){var i=t[0].children[t[0].children.length-1];t[0].removeChild(i)}jQuery("#"+L+"-"+e).show(),"left"===e?this.leftTile=null:"right"===e&&(this.rightTile=null)},fe.prototype.doCompare=function(){var e=this;function t(){if(h.destroySearch(),e.clearTileItem("left"),e.clearTileItem("right"),e.clearFiltering("",!1),e.idDataList.areCompared=!0,g.persistIDs(e.idDataList),"function"==typeof e.doCompareCB){var t={idDataList:e.idDataList,validateObj_stateData:e.validateObj_stateData};e.doCompareCB(t)}}!0===this.idDataList.areCompared||"IDPlusCommandsList"===this.idDataList.listType||!0===this.runOptions.ImmediateCompare&&!1!==this.runOptions.AllowCompareOfIdentical||!this.idDataList.areItemsIdentical(0,1)?t():!1!==this.runOptions.AllowCompareOfIdentical?pe(D.get("CompareWithItself"),D.get("YesButton"),D.get("NoButton"),function(){t()},function(){}):(de("CompareWithItselfNotAllowed","compare-alert-error"),this.clearItem("right"))},fe}),define("DS/CompareCommon/WidgetPreferences",["UWA/Core","UWA/Class","DS/Controls/Toggle","DS/Controls/ComboBox","UWA/Json","DS/CompareCommon/Utils","i18n!DS/CompareWidget/assets/nls/CompareWidget"],function(e,t,i,n,r,o,a,l){"use strict";return t.singleton({init:function(){this._parent({}),this.PREF_NAME="compare_widget_pref_webinwin",this.defaults={vizOverview:!0,vizLegend:!0,openness_revisions:!1,openness_duplicates:!1,useIndex:!0,viewer_display_mode:"select"}},loadDefaults:function(e,t){o.loadPref(e,function(e){if(""!=e)try{for(var i=r.decode(e),n=0;n<widget.preferences.length;n++){var o=widget.preferences[n].name,a=i[o];null!=a&&widget.setValue(o,a)}}catch(e){console.log(e)}t()})},saveAsDefaults:function(e,t){for(var i={},n=0;n<widget.preferences.length;n++){var a=widget.preferences[n].name,l=widget.getValue(a);null!=l&&(i[a]=l)}o.savePref(e,r.encode(i),function(){t()})},setDefaults:function(e){for(var t in e)this.defaults[t]=e[t]},load:function(e){var t=this.defaults,i={};o.loadPref(this.PREF_NAME,function(n){if(""!=n)try{i=r.decode(n)}catch(e){console.log(e)}for(var o=Object.keys(t),a=0;a<o.length;a++){var l=o[a],s=i[l];null==s&&(s=t[l]),widget.setValue(l,s)}e()})},edit:function(t){var l=e.createElement("div",{styles:{position:"absolute",overflow:"auto",width:"100%",height:"100%",left:"0px",top:"0px","z-index":4e4,"background-color":"white"}});l.inject(document.body);var s=e.createElement("div",{styles:{position:"relative",width:"70%",margin:"auto"}});s.inject(l),new e.Element("h4",{text:a.editPref}).inject(s);for(var u=[],c=[],d=0;d<widget.preferences.length;d++){var p=widget.preferences[d],f=p.type;if("boolean"==f){var h=new i({label:p.label,value:p.name,visibleFlag:!0,checkFlag:widget.getBool(p.name)});h.pref=p,h.inject(s),u.push(h)}else if("list"==f){new e.Element("h5",{text:p.label}).inject(s);for(var m=[],g=[],v=p.options,y=0;y<v.length;y++){var C=v[y];m.push(C.label),g.push(C.value)}var I=new n({enableSearchFlag:!1,elementsList:m,selectedIndex:g.indexOf(widget.getValue(p.name))});I.pref=p,I.getContent().setStyles({width:"100%",height:"30px"}),I.inject(s),c.push(I)}}var D=e.createElement("div",{styles:{"margin-top":"20px"}}).inject(s),b={"margin-left":"10px",float:"right"},S=e.createElement("button",{type:"button",class:"btn-default btn btn-root",styles:b,html:a.cancel}).inject(D),O=e.createElement("button",{type:"button",class:"btn-primary btn btn-root",styles:b,html:a.save}).inject(D);S.addEventListener("click",function(){l.destroy()});var _=this;O.addEventListener("click",function(){for(var e={},i=0;i<u.length;i++){var n=u[i],a=n.pref.name,s=n.checkFlag;e[a]=s,widget.setValue(a,s)}for(i=0;i<c.length;i++){var d=c[i];a=d.pref.name,s=d.pref.options[d.selectedIndex].value;e[a]=s,widget.setValue(a,s)}o.savePref(_.PREF_NAME,r.encode(e),function(){l.destroy(),t()})})},addWidgetPrefs:function(e){var t=[{name:"credentialPrefName",type:"hidden",V1:!0,V2:!0},{name:"serverTimingVerbose",type:"hidden",defaultValue:"_serverTimingVerbose",V1:!0,V2:!0},{name:"vizStructPanel",type:"hidden",defaultValue:!0,V1:!0},{name:"vizAttrTable",type:"hidden",defaultValue:!1,V1:!0},{name:"vizViewerPanel",type:"hidden",defaultValue:!0,V1:!0},{name:"ratioStructPanel",type:"hidden",defaultValue:-1,V1:!0},{name:"ratioAttrTable",type:"hidden",defaultValue:-1,V1:!0},{name:"ratioViewerPanel",type:"hidden",defaultValue:-1,V1:!0},{name:"vizOverview",type:"boolean",label:a.showOverviewBar,defaultValue:!0,V1:!0},{name:"vizLegend",type:"boolean",label:a.showCompareStatusLegend,defaultValue:!0,V1:!0},{name:"openness_revisions",type:"boolean",label:a.opennessRevision,defaultValue:!1,V1:!0,V2Migrate:!0},{name:"openness_duplicates",type:"boolean",label:a.opennessDuplicates,defaultValue:!1,V1:!0,V2Migrate:!0},{name:"useIndex",type:"boolean",label:a.useIndex,defaultValue:!0,V1:!0,V2Migrate:!0},{name:"showDocs",type:"boolean",label:a.showDocs,defaultValue:!1,V1:!0,V2Migrate:!0},{name:"showOtherRels",type:"boolean",label:a.showOtherRels,defaultValue:!1,V1:!0,V2Migrate:!0},{name:"viewer_display_mode",type:"list",label:a.viewerDisplayMode,defaultValue:"V1"===e?"isolate":"select",options:[{label:a.selectInTreeIsolateInViewer,value:"isolate"},{label:a.selectInTreeSelectInViewer,value:"select"}],V1:!0,V2Migrate:!0},{name:"attributes_not_shown",type:"hidden",defaultValue:"",V1:!0,V2Migrate:!0},{name:"attributes_not_shown_INST",type:"hidden",defaultValue:"",V1:!0,V2Migrate:!0},{name:"attributes_not_shown_EFF",type:"hidden",defaultValue:"",V1:!0,V2Migrate:!0}];if(!e)throw Error("WidgetPreferences.addWidgetPreferences: need param name to set widget preferences");t.filter(t=>!0===t[e]).forEach(t=>{"V2Migrate"===e&&(t.type="hidden"),widget.addPreference(t)})},addWidgetPreference:function(t,i,n){widget.addPreference(e.extend(i,{name:t})),null!=n&&widget.setValue(t,n)},isV1ToV2PrefMigrationComplete:function(e,t,i){o.getUserPreferencesPromise(e+"[migratedToV2]").then(function(e){"true"===e||!0===e?t():i()},i)},setV1ToV2PrefMigrationCompletedFlag:function(e,t){return o.saveUserPreferencesPromise(e+"[migratedToV2]","boolean"!=typeof t||t)}})});