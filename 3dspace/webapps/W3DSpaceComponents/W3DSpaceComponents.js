define("DS/W3DSpaceComponents/Utils/Helpers",[],function(){"use strict";return{filterXSS:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}}),define("DS/W3DSpaceComponents/Utils/SecurityContext",[],function(){"use strict";return{getPreferred:function(e){var t,r=e.get("contexts"),n=["VPLMProjectLeader","VPLMCreator","VPLMExperimenter","VPLMViewer","VPLMProjectAdministrator","3DSRestrictedLeader","3DSRestrictedAuthor","3DSRestrictedContributor","3DSRestrictedReader","3DSRestrictedOwner","VPLMSecuredCrossAccess"];if(r&&!r[0].role){var a=[];r.map(function(e){a.push({name:e,role:e.split(".")[0]})}),r=a}var i=r.map(function(e){for(var t=e.role?e.role:e.split(".")[0],r=0;r<n.length;r++)if(t===n[r])return r;return n.length});return(t=r.filter(function(e){return e.role===n[Math.min.apply(null,i)]}))&&t[0]?t[0].name:r[0].name},getNominalContext:function(e){var t,r,n=e&&e.get("contexts")?e.get("contexts"):[];for(t=0;t<n.length&&("VPLMProjectAdministrator"===(r=n[t]).role||"3DSRestrictedOwner"===r.role);t++);return r&&r.name?r.name:null}}}),define("DS/W3DSpaceComponents/Actions/Share/shareFactory",["UWA/Core","UWA/String","DS/UIKIT/Input/Toggle"],function(e,t,r){"use strict";return{createCheckboxWithContent:function(e){var t=n(),i=e.content,o=!!e.isChecked;!0!==o&&i.hide();var s=e.checkboxOptions,c=new r(Object.assign({checked:o,events:{onChange:function(){c.isChecked()?i.show():(window.CheckboxOrgSelect=!1,i.hide())}}},s));return[c,i].reduce(a,t),t},makeElement:n,onEmailAddress:function(e){return{resourceid:e,label:e,email:e}},createCheckboxAndContent:function(e){var t=n(),i=e.normalView,o=e.restrictedView,s=e.checkboxOptions,c=new r(Object.assign({events:{onChange:function(){c.isChecked()?(i.hide(),o.show()):(o.hide(),i.show())}}},s));return[c,o,i].reduce(a,t),t}};function n(e){var t=e||{},r=t.element||"div";"string"==typeof t&&(r=t);var n=t.classes||[],a=document.createElement(r);if("string"==typeof n)return a.classList.add(n),a;for(var i=0;i<n.length;i+=1)a.classList.add(n[i]);return a}function a(e,t){return t.nodeName||(t=t.getContent()),e.appendChild(t),e}}),define("DS/W3DSpaceComponents/Views/SuperModal",["DS/UIKIT/SuperModal","css!DS/UIKIT/UIKIT.css"],function(e){"use strict";var t=new e({className:"w3ddrive",closable:!0,renderTo:document.body}),r=t.modalFactory,n=function(e){e.stopPropagation()};return t.modalFactory=function(){var e=r.apply(this,arguments),a=e.elements.container;return e.onShowModal=function(){t.next(),a.addEventListener("click",n)},e.onHide=function(){setTimeout(function(){a.removeEventListener("click",n)})},e},t}),define("DS/W3DSpaceComponents/Utils/errors",[],function(){"use strict";return function(){return{xmlhttprequestCodes:{BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,CONFLICT:409,PRECONDITION_FAILED:410,INTERNAL_SERVER_ERROR:500}}}}),define("DS/W3DSpaceComponents/Utils/Alert",["DS/UIKIT/Alert","DS/W3DSpaceComponents/Utils/Helpers","css!DS/UIKIT/UIKIT.css"],function(e,t){"use strict";var r,n=(r=new e({className:"w3dspace",autoHide:!0,closable:!0,visible:!0,renderTo:document.body})).add;return r.add=function(e){return"error"!==e.className&&"warning"!==e.className||(r.options.hideDelay=1e4),e.message=t.filterXSS(e.message),n.call(r,e)},r}),define("DS/W3DSpaceComponents/Utils/RequestHelper",["UWA/Data","UWA/String","UWA/Services/Auth","DS/WAFData/WAFData","DS/W3DSpaceComponents/Utils/errors","DS/W3DSpaceComponents/Utils/Alert","i18n!DS/W3DSpaceComponents/assets/nls/W3DSpaceComponents"],function(e,t,r,n,a,i,o){"use strict";const s=a().xmlhttprequestCodes;let c;const d={_tenant:null,_baseUrl:null,hasTenant:function(){return Boolean(this._tenant)},manageFailure:function(e,t,r,n){if(r&&"function"==typeof r)r(e,t,n);else switch(e){case s.CONFLICT:i.add({message:o.replace(o.duplicationError,{msg:t.error.message,fileName:t.error.filename}),className:"error"});break;default:i.add({message:o.unexpectedError,className:"error"})}},performRequestWithOptions:function(e,t={}){let a;e=d.addQueryStrings({url:e,queryStrings:{tenant:t.auth.platformId}}),!t.auth||t.auth instanceof r||(t.headers||(t.headers={}),t.headers["X-DS-CSRFTOKEN"]=c||"",a=t.onComplete,t.onComplete=function(e,t,r){var n=Object.keys(t).filter(function(e){return-1!==e.search(/x-ds-csrftoken/i)});c=n.length>0?t[n[0]]:c,"function"==typeof a&&a(e,t,r)}),t.type||(t.type="json");var i=null;let o;return t.onFailure&&(i=t.onFailure),t.onFailure=function(e,t){d.manageFailure(o.xhr.status,t,i,{xhr:o.xhr})},o=n.authenticatedRequest(e,t)},addQueryStrings:function(e={}){if(!e.url)return"";let t=e.url.includes("?")?e.url:e.url+"?";const r=e.queryStrings;return r&&Object.keys(r).forEach(e=>{let n="&"+e;const a=r[e];void 0!==a&&(n+="string"==typeof a?"="+a:"","?"===t[t.length-1]&&(n=n.substring(1,n.length)),t+=n)}),t}};return d}),define("DS/W3DSpaceComponents/Views/shareCollaborativeSpace",["UWA/String","UWA/Class/View","UWA/Class/Promise","DS/UIKIT/Autocomplete","DS/W3DXComponents/Views/Item/PanelAddMemberView","DS/W3DSpaceComponents/Views/SuperModal","DS/W3DSpaceComponents/Utils/Alert","DS/W3DSpaceComponents/Actions/Share/shareFactory","DS/W3DSpaceComponents/Utils/RequestHelper","DS/W3DSpaceComponents/Utils/SecurityContext","i18n!DS/W3DSpaceComponents/assets/nls/W3DSpaceComponents","css!DS/W3DSpaceComponents/W3DSpaceComponents.css"],function(e,t,r,n,a,i,o,s,c,d,u){"use strict";return function(l){if(!l)throw new Error("Missing input");i.dialog({title:u.replace(u.addMembersTitle,{name:l.get("title")}),body:[{tag:"div",class:"shareview__description",html:u.get("addMembersToCS")}]}),function(l){return new r(function(m){var p,f,h=new t,g={},w=l.drive.get("availableRoles")||[],O=w.some(function(e){return-1!==e.indexOf("restricted")});g.view=h,g.inode=l;var b=function(t,n){if(!Array.isArray(t))throw new Error("You should provide a categories array input");var i,l=function(t){h&&(h.cancel(),h=null);var a=n.inode,i=a.get("owners").login,o=a._auth.platformId,s=a.drive.get("user").id,l=Date.now(),m="3DSpace".concat("-",s,"-",l),p=e.format("{0}/search",a._auth.platform.urls3DSearch),f={order_by:"desc",order_field:"relevance",nresults:8,label:m,with_synthesis:!1,with_synthesis_attribute:!1,tenant:o};if("OnPremise"===a.drive.id)f=Object.assign(f,{source:["3dspace"],select_predicate:["name","current","emailaddress","personsyncstate","ds6w:type","ds6w:label","ds6w:resourceUid","assigned_security_context"],query:'[ds6w:type]:(Person OR Group) AND ([ds6w:label]:"'+t.trim()+'" OR [ds6w:label]:(*'+t.trim()+"*) OR [emailaddress]:("+t.trim()+"*) OR [name]:("+t.trim()+"*)) AND ([current]:Active OR [personsyncstate]:0)",login:{"3dspace":{SecurityContext:d.getPreferred(a)}}});else{f=Object.assign(f,{source:["3dspace","usersgroup"],select_predicate:["name","current","emailaddress","personsyncstate","ds6w:type","ds6w:label","ds6w:resourceUid","dsaccess:groupMemberCount","assigned_security_context"],query:'[ds6w:type]:("foaf:Group" OR Person)',specific_source_parameter:{usersgroup:{additional_query:'AND ([ds6w:label]:"'+t.trim()+'" OR [ds6w:label]:('+t.trim()+"*))"},"3dspace":{additional_query:'AND ([ds6w:label]:"*'+t.trim()+'*" OR [ds6w:label]:(*'+t.trim()+"*) OR [emailaddress]:("+t.trim()+"*) OR [name]:("+t.trim()+"*)) AND ([current]:Active OR [personsyncstate]:0)"}},login:{"3dspace":{SecurityContext:d.getPreferred(a)}}});var g=a._auth.getStorage().urlUsersGroup;g||(f=Object.assign(f,{source:["3dspace"],query:"[ds6w:type]:(Person)",specific_source_parameter:{"3dspace":{additional_query:'AND ([ds6w:label]:"*'+t.trim()+'*" OR [ds6w:label]:(*'+t.trim()+"*) OR [emailaddress]:("+t.trim()+"*) OR [name]:("+t.trim()+"*)) AND ([current]:Active OR [personsyncstate]:0)"}},login:{"3dspace":{SecurityContext:d.getPreferred(a)}}}))}return new r(function(e,t){h=c.performRequestWithOptions(p,{type:"json",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},auth:a._auth,data:JSON.stringify(f),onComplete:function(t){var r=[];t.hasOwnProperty("results")&&(r=t.results.filter(function(e){return e.hasOwnProperty("attributes")}).map(function(e){return e.attributes.filter(function(e){return e.hasOwnProperty("name")&&e.hasOwnProperty("value")}).filter(function(e){return"dsbase:TemplateInstance"!==e.value}).map(function(e){return-1!==e.name.indexOf("ds6w:")&&(e.name=e.name.split("ds6w:")[e.name.split("ds6w:").length-1]),-1!==e.name.indexOf("dsaccess:")&&(e.name=e.name.split("dsaccess:")[e.name.split("dsaccess:").length-1]),"type"===e.name&&-1!==e.value.indexOf("foaf:")&&(e.value=e.value.split("foaf:")[e.value.split("foaf:").length-1]),e}).filter(function(e){return-1!==["name","resourceid","resourceUid","label","type","groupMemberCount","assigned_security_context","emailaddress","personsyncstate"].indexOf(e.name)})}).map(function(e){var t={security_contexts:[]},r=!1;return e.forEach(function(e){"assigned_security_context"===e.name?t.security_contexts.push(e.value):"personsyncstate"===e.name&&"0"===e.value||"label"===e.name&&-1!==e.value.indexOf("Unknown Unknown")?r=!0:"label"===e.name&&-1!==e.value.indexOf("Unknown Unknown")?(r=!0,t[e.name]=e.value):t[e.name]=e.value}),r&&t.emailaddress&&(t.label!==t.name&&-1===t.label.indexOf("Unknown Unknown")||(t.label=t.emailaddress)),"OnPremise"!==a._auth.platformId&&"Group"===t.type&&(t.label+=" "+u.replace(u.groupMembersCount,{total:t.groupMemberCount||0})),t}).filter(function(e){return e.resourceid!==s&&e.resourceid!==i})),e(r)},onFailure:t})})},m=n.inode,p=[],f=[];var h;t.forEach(function(e){e.id.contains("restricted")?f.push(e):p.push(e)});var g,w,O,b=[{id:"PublicReader",name:u.get("publicReader")},{id:"Reader",name:u.get("reader")},{id:"Contributor",name:u.get("contributor")},{id:"Author",name:u.get("author")},{id:"Leader",name:u.get("leader")},{id:"Owner",name:u.get("owner")},{id:"LeaderOwner",name:u.get("leaderOwner")},{id:"Readerrestricted",name:u.get("reader")},{id:"Contributorrestricted",name:u.get("contributor")},{id:"Authorrestricted",name:u.get("author")},{id:"Leaderrestricted",name:u.get("leader")},{id:"Ownerrestricted",name:u.get("owner")},{id:"LeaderOwnerrestricted",name:u.get("leaderOwner")}],v=[];g={suggestFormat:"{label}",suggestKey:"resourceid",labelFormat:"{label}",placeholder:u.get("enterName"),typeDelay:500,minLength:2,getSuggestions:function(e,t,r){if(i=function(){Object.keys(t).map(function(e){delete t[e]})},e)return t[e]?r(t[e]):void l(e).then(r,function(){console.warn("requestSuggestion call has failed")})},suggestDistinction:function(e){if(e.security_contexts){var t=(n=e.security_contexts,a=m,o=[{id:"PublicReader",context:"VPLMSecuredCrossAccess"},{id:"Reader",context:"VPLMViewer"},{id:"Contributor",context:"VPLMExperimenter"},{id:"Author",context:"VPLMCreator"},{id:"Leader",context:"VPLMProjectLeader"},{id:"Owner",context:"VPLMProjectAdministrator"},{id:"LeaderOwner",context:["VPLMProjectLeader","VPLMProjectAdministrator"]},{id:"Readerrestricted",context:"3DSRestrictedReader"},{id:"Contributorrestricted",context:"3DSRestrictedContributor"},{id:"Authorrestricted",context:"3DSRestrictedAuthor"},{id:"Leaderrestricted",context:"3DSRestrictedLeader"},{id:"Ownerrestricted",context:"3DSRestrictedOwner"},{id:"LeaderOwnerrestricted",context:["3DSRestrictedLeader","3DSRestrictedOwner"]}],s=[],(n=n.filter(function(e){return e.split(".")[2]===a.get("id")})).forEach(function(e){s.push(e.split(".")[0])}),1===s.length?o.forEach(function(e){e.context===s[0]&&(i=e.id)}):o.forEach(function(e){var t=!1;s.forEach(function(r){t=-1!==e.context.indexOf(r)}),t&&(i=e.id)}),i);for(var r in b)if(b[r].id===t)return b[r].name}var n,a,i,o,s},saveProcess:function(t){var n=t.map(function(t){var r,n=t.item,a=(r=t.categoryId)?"PublicReader"===r?{value:"PublicReader",admin:!1}:"Reader"===r?{value:"Reader",admin:!1}:"Contributor"===r?{value:"Contributor",admin:!1}:"Author"===r?{value:"Author",admin:!1}:"Owner"===r?{value:"Owner",admin:!0}:"Leader"===r?{value:"Leader",admin:!1}:"LeaderOwner"===r?{value:"Leader",admin:!0}:"Readerrestricted"===r?{value:"Reader",admin:!1,restricted:!0}:"Contributorrestricted"===r?{value:"Contributor",admin:!1,restricted:!0}:"Authorrestricted"===r?{value:"Author",admin:!1,restricted:!0}:"Leaderrestricted"===r?{value:"Leader",admin:!1,restricted:!0}:"Ownerrestricted"===r?{value:"Owner",admin:!1,restricted:!0}:"LeaderOwnerrestricted"===r?{value:"Leader",admin:!0,restricted:!0}:void 0:{},i=window.selectedOrg;return{id:"Group"===n.type?n.resourceUid:"Person"===n.type?n.name:n.resourceid,type:e.isEmail(t.selection)?"Person":n.type,role:a,collabspace:m.id,company:i}});window.selectedOrg=void 0,r.all(n.map(function(e){return new r(function(t,r){m.permissions.create(e,{wait:!0,onComplete:t,onFailure:function(e,t){"alreadyAdded"===t.errorCode&&o.add({message:u.replace(u.get("memberAlreadyAddedToCS"),{groupName:e.get("collabspace")}),className:"warning"})},onTimeout:function(e){var t=new Error(e.message);t.name="Timeout",r(t)}})})})).then(function(){window.orgOperatorController&&window.orgOperatorController.onAddUsersEnd(),o.add({message:u.sharesSuccessCS,className:"success"})},function(e){Array.isArray(e)||(e=[e]),"RangeError"===e[0].name?o.add({message:e[0].message,className:"error"}):"Timeout"===e[0].name?o.add({message:u.replace(u.addCSMembersTimeout,{name:m.get("title")}),className:"warning"}):e.map(function(e){var t=e.inode?e.inode.get("title"):e.collection._parentInode.get("title");o.add({message:u.replace(u.shareErrorCS,{name:t}),className:"error"})})})}},m.drive.get("shareWithinvitation")&&(g.onEmailAddress=s.onEmailAddress);if(p.length>0){var S=new a(Object.assign(g,{categories:p}));S.elements.buttons.classList.add("shareview__footer");var y=S.render,C=S.destroy;w=Object.assign(S,{render:function(){var e=y.apply(S,arguments);return S.show(),e},destroy:function(){return"function"==typeof i&&i(),C.apply(this,arguments)}})}if(f.length>0){var D=new a(Object.assign(g,{categories:f}));D.elements.buttons.classList.add("shareview__footer");var x=D.render,R=D.destroy;O=Object.assign(D,{render:function(){var e=x.apply(D,arguments);return D.show(),e},destroy:function(){return"function"==typeof i&&i(),R.apply(this,arguments)}})}if(w){var A=w.container.querySelector("button.btn-primary");A.textContent=u.addMembers,v.push(w)}if(O){var L=O.container.querySelector("button.btn-primary");L.textContent=u.addMembers,v.push(O)}return v}(function(e){if(!e)throw new Error("Missing inode");var t=function(e){var t=[];e&&(-1!==e.indexOf("PublicReader")&&(t=t.concat("PublicReader")),-1!==e.indexOf("Reader")&&(t=t.concat("Reader")),-1!==e.indexOf("Contributor")&&(t=t.concat("Contributor")),-1!==e.indexOf("Author")&&(t=t.concat("Author")),-1!==e.indexOf("Leader")&&(t=t.concat("Leader")),-1!==e.indexOf("LeaderOwner")&&(t=t.concat("LeaderOwner")),-1!==e.indexOf("Owner")&&(t=t.concat("Owner")),-1!==e.indexOf("Readerrestricted")&&(t=t.concat("Readerrestricted")),-1!==e.indexOf("Contributorrestricted")&&(t=t.concat("Contributorrestricted")),-1!==e.indexOf("Authorrestricted")&&(t=t.concat("Authorrestricted")),-1!==e.indexOf("Leaderrestricted")&&(t=t.concat("Leaderrestricted")),-1!==e.indexOf("LeaderOwnerrestricted")&&(t=t.concat("LeaderOwnerrestricted")),-1!==e.indexOf("Ownerrestricted")&&(t=t.concat("Ownerrestricted")));return t}(e.drive.get("availableRoles")),r=[];-1===e.get("actions").indexOf("add.members.restricted")?r=t:t.forEach(function(e){e.contains("restricted")&&r.push(e)});return r.map(function(e){return function(e){var t;"PublicReader"===e?t=u.publicReader:"Reader"===e?t=u.reader:"Contributor"===e?t=u.contributor:"Author"===e?t=u.author:"Leader"===e?t=u.leader:"Owner"===e?t=u.owner:"LeaderOwner"===e?t=u.leaderOwner:"Readerrestricted"===e?t=u.restrictedReader:"Contributorrestricted"===e?t=u.restrictedContributor:"Authorrestricted"===e?t=u.restrictedAuthor:"Leaderrestricted"===e?t=u.restrictedLeader:"Ownerrestricted"===e?t=u.restrictedOwner:"LeaderOwnerrestricted"===e&&(t=u.restrictedLeaderOwner);return{id:e,name:t}}(e)})}(l),g,window.selectedOrg);-1===l.get("actions").indexOf("add.members.restricted")&&O&&(p=s.createCheckboxAndContent({normalView:b[0],restrictedView:b[1],id:"checkbox-enable-restricted",checkboxOptions:{type:"checkbox",id:"checkbox-enable-restricted",value:u.enableRestrictedRoles}})).classList.add("shareview__options"),window.selectedOrg=void 0;var v=UWA.createElement("div",{id:"searchAutoCompleteInput"}),S={remoteSearchEngine:function(t,n){var a,i;if(!n)return!1;i&&(i.cancel(),i=null);var o=g.inode,s=o.drive.get("user").id,u=e.format("{0}/search",o._auth.platform.urls3DSearch),l={tenant:o._auth.platformId,label:"3DSpace".concat("-",s,"-",Date.now())};return l=Object.assign(l,{source:["3dspace"],query:'[ds6w:type]: (Company OR Department OR Business Unit OR Plant) AND ([ds6w:label]:"'+n.trim()+'" OR [ds6w:label]:(*'+n.trim()+"*))",login:{"3dspace":{SecurityContext:d.getPreferred(o)}}}),new r(function(e,r){i=c.performRequestWithOptions(u,{type:"json",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:d.getPreferred(o)},auth:o._auth,data:JSON.stringify(l),onComplete:function(r){var n=[];r.hasOwnProperty("results")&&r.results.filter(function(e){return e.hasOwnProperty("attributes")}).map(function(e){return e.attributes.filter(function(e){return e.hasOwnProperty("name")&&"ds6w:label"===e.name||e.hasOwnProperty("name")&&"ds6w:identifier"===e.name})}).map(function(e){var t=[];return e.forEach(function(e){"ds6w:label"===e.name&&(t.label=e.value),"ds6w:identifier"===e.name&&(t.value=e.value)}),n.push(t),n}),(a={}).dataset=t,a.matchingItems=n,e(a)},onFailure:r})})}},y=new n({multiSelect:!1,id:"searchAutoCompleteInput","data-category":"searchAutoCompleteInput",showSuggestsOnFocus:!0,noResultsMessage:u.noResultsMessage,allowFreeInput:!1,placeholder:u.placeHolderMsg,minLengthBeforeSearch:3,events:{onSelect:function(e){window.selectedOrg=e.value,window.CheckboxOrgSelect=!0}}}).inject(v);y.addDataset([],S),(f=s.createCheckboxWithContent({content:v,id:"checkbox-select-organization",isChecked:window.CheckboxOrgSelect,checkboxOptions:{type:"checkbox",id:"checkbox-select-organization",value:u.orgAssignment}})).classList.add("shareview__options1"),h.render=function(){for(;h.container.firstChild;)h.container.removeChild(h.container.firstChild);return b[0].show(),(p?[p,f,b[0].container,b[1].container]:[f,b[0].container]).reduce(function(e,t){return e.appendChild(t),e},h.container),h},h.elements.panelAddMemberView=b[0],b[1]&&(h.elements.panelAddMemberRestrictedView=b[1]),b.forEach(function(e){var t=e.destroy;e.destroy=function(){e=null,t.apply(this,arguments)}});var C=i.modals.current,D=C.onHide;C.onHide=function(){D.call(C),h.destroy()},b.forEach(function(e){e.onClose=function(){C.hide()}}),h.render(),m(h.container)})}(l).then(function(e){var t=i.modals.current.getBody();t.className="shareview",t.appendChild(e);var r=e.querySelector("input.temp-autocomplete-input");r&&r.focus()})}});