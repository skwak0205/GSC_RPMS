define("DS/ENOXCADNonPSConnector/ENOXCADNonPSConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/VisuDataAccess/Ox4PLMDataHelper","DS/VisuDataAccess/Ox4XHRWithProxyAbstraction","DS/VisuDataAccess/Ox4TicketGeneratorTask"],function(e,t,n,r){"use strict";var a=null,o=null,i=null,s=null,m=function(e,t,n,r,a,o,m){return{mqlCmd:function(e,t,n){var r='<?xml version="1.0" encoding="utf-8"?>\n';return r+='<executeSequence xmlns="http://www.3ds.com/xmql/query">\n',r+="\t<execute>\n",r+="\t\t<function>query_bus</function>\n",r+="\t\t<version>2.0.0</version>\n",r+="\t\t<params>\n",r+='\t\t\t<param name="type">'+t+"</param>\n",r+='\t\t\t<param name="name">*</param>\n',r+='\t\t\t<param name="revision">*</param>\n',r+='\t\t\t<param name="vault">*</param>\n',r+='\t\t\t<param name="where">physicalid=='+e+"</param>\n",r+='\t\t\t<param name="select">'+JSON.stringify(n)+"</param>\n",r+='\t\t\t<param name="dump">,</param>\n',r+="\t\t</params>\n",r+="\t</execute>\n",r+="</executeSequence>\n"}(e,t,["attribute[StreamDescriptors]","format.file.name","format.file.store"]),parseTCLRow:function(t){for(var l=/{{.*} {.*} {.*} {{(.*)}} {({.*})} {({.*})}}/.exec(t),c=l[1],p=l[2],u=l[3],f=c.split(":"),d=[],v=0;v<f.length;v++){var y=/SDv2\((.*),'(.*)',(.*),.*,.*,'(.*)','(.*)'\)/.exec(f[v]);d.push({format:y[1],role:y[2],lateType:y[3],persistancyType:y[4],persistancyName:y[5]})}for(var x=/{([^{}]*)}/g,S=null,h=[];null!==(S=x.exec(p));)h.push(S[1]);for(var T=[];null!==(S=x.exec(u));)T.push(S[1]);var D={name:"",store:""};for(v=0;v<d.length;v++){var N=d[v];void 0!==n&&n!==N.format||void 0!==r&&r!==N.role||void 0!==a&&a!==N.lateType||void 0!==o&&o!==N.persistancyType||void 0!==m&&m!==N.persistancyName||(i=N.persistancyType,s=N.persistancyName,""===D.name?(D.name=e+"_'"+N.role+"'."+N.format,N.persistancyName&&(D.name+="="+N.persistancyName),D.format=N.format):(D.tooManyFilesError=!0,D.name=""))}if(""!==D.name)for(v=0;""===D.store&&v<h.length;v++)D.name===h[v]&&(D.store=T[v]);return""!==D.name&&""!==D.store||(D.noStreamRetrieved=!0,D.name="",D.store=""),D}}},l=function(e){var l,c;null!==a&&null!==o&&o.url===e.serverUrl||(o={rawmode:!1,url:e.serverUrl},c=(l=o).url,l.xmqlServiceUri=function(){return c+"/i3dx/services/xmql"},l.threedexpServiceUri=function(){return c},n.useUWAProxy({proxymode:"passport"}),a=new t(o)),function(e,t,r){var a=m(e.physicalid,e.boType);(new n).executePostHttpRequest(o.xmqlServiceUri(),"application/xml",a.mqlCmd,function(n){var o=a.parseTCLRow(n);o.tooManyFilesError?r("Too many streams retrieved"):o.noStreamRetrieved?r("No stream retrieved"):(o.physicalid=e.physicalid,void 0===o.format&&void 0!==e.format&&(o.format=e.format),void 0!==o.format?t(o):r("Stream format has to be specified"))})}(e,function(t){var m,l,c,p;m=t,l=function(t){!function(e,t,n,r){if("posthttp"==e.slice(0,8)){var a=e.indexOf(":postparams:"),o=e.slice(9,a),m=e.slice(a+12,e.length);void 0!==s||null===s||void 0!==i||null===i?n({URLToFCS:o+"?"+m,FileName:s+"."+i}):r("Unable to correcty get the required information from the NonPSRepRef Object")}}(t,e.streamType,e.onInformationReceived,e.onInformationFailed)},e.onInformationFailed,c=a.transformSelectedFileIntoTicketRequest(m.physicalid,m.format,m.store,m.name),p=new r(c,o),(new n).asyncTransformFCSUrlIntoRealUrl(p.generateRequest(),!1,function(e,t){l(t)})},e.onInformationFailed)};return e.extend({init:function(e){this._parent(e)},open:function(e,t,n){var r=e,a={serverUrl:r.serverurl,physicalid:r.physicalid,boType:r.type,format:"1",onInformationReceived:function(n){var r=n.URLToFCS,a=n.FileName,o={dtype:e.dtype,provider:"FILE",url:r,filename:a,requestsOptions:{authentication:"passport",proxy:"none",method:"POST"}};console.log("Calling 3DPlay for loading the experience"),t(o)},onInformationFailed:function(e){console.log("Non PS Representation Reference document:"+e);n({NLS_File:"3DPlay/Core",NLS_ID:"LoadingError_LOAD_ENTRY"})}};l(a)}})});