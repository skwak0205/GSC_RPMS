define("DS/IPClassifyColumnCusto/WizardSteps",["text!DS/IPClassifyColumnCusto/assets/templates/WizardSteps.html","css!DS/IPClassifyColumnCusto/IPClassifyColumnCusto.css","i18n!DS/IPClassifyColumnCusto/assets/nls/IPClassifyColumnCusto","UWA/Core","UWA/Controls/Abstract","DS/Handlebars/Handlebars","DS/Core/Core","css!DS/UIKIT/UIKIT.css"],function(e,t,o,n,i,s,a,l){"use strict";var r=s.compile(e);return s.registerHelper("getlabel",function(e){for(var t=require("i18n!"+this.label.file),o=this.label.key.split("."),n=t,i=0;i<o.length;i++)n=n[o[i]];return n}),i.extend({name:"ip-enx-wizard-container",defaultOptions:{subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeStep:null},init:function(e){this._parent(e),this.elements.container=n.createElement("div",{class:this.getClassNames()}),this.options.steps&&this.elements.container.setContent(r(this.options.steps)),this.options.renderTo&&this.elements.container.inject(this.options.renderTo),this.options.rope=this.elements.container.getElement("div.ip-enx-wizard-rope"),this.options.navigator=this.elements.container.getElement("nav.ip-enx-view-navigator");var t=this.elements.container.getElement("a.nav-item.active");if(t){var o=t.id;this._render2ActiveStep(o)}for(var i=this,s=this.options.navigator.getElements("a"),a=0;a<s.length;a++)s[a].addEventListener("click",function(e){var t=e.currentTarget.id;i.changeStep(t)});this.options.subscribeTokens.push(this.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/WizardSteps/changeStep"},function(e){var t=e.stepId;i.changeStep(t)}))},changeStep:function(e){this._render2ActiveStep(e),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/WizardSteps/stepChanged",data:{stepId:e}})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this._parent()},_render2ActiveStep:function(e){for(var t,o=this.options.navigator.getElements("a"),n=!1,i=0;i<o.length;i++){var s=o[i];if(!1===n?s.removeClassName("filled").addClassName("filled"):s.removeClassName("filled"),s.id===this.options.activeView&&s.removeClassName("active"),s.id===e){s.addClassName("active");s.getElement(".view-icon.enx-icon");var a="100%";i<o.length-1&&(a=Math.floor(100/(o.length+1))*(i+1)+"%"),this.options.rope.setStyles({width:a,height:"2px"}),t=s.id,n=!0}}this.options.activeView=t}})}),define("DS/IPClassifyColumnCusto/IPClassifyColumnCusto",["css!DS/IPClassifyColumnCusto/IPClassifyColumnCusto.css","i18n!DS/IPClassifyColumnCusto/assets/nls/IPClassifyColumnCusto","DS/PADServices/views/private/Iconbar","DS/PADServices/views/private/ComboSelector","DS/PADServices/utils/GlobalUtils","css!DS/UIKIT/UIKIT","UWA/Core","UWA/Controls/Abstract","DS/Controls/Button","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/TreeModel/DataModelSet","DS/Controls/Toggle","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/PADServices/utils/PlatformURL","DS/Utilities/Dom","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,o,n,i,s,a,l,r,d,c,u,p,m,f,h,b,g,v){"use strict";var C=["selection","hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],y=["bi_color","selection","hide_show","thumbnail"],w=!1,I=!0;function x(e){var t=!0;return-1!==y.indexOf(e)?t=!1:!1===w&&-1!==["ds6w:label-Instance","positionMatrix-Instance"].indexOf(e)&&(t=!1),t}var M={properties:[function(){return{property:"label",value:this.options.grid.attrTitle}},function(){var e={property:"text",value:void 0};return(void 0===this.options.grid.hasTitle||this.options.grid.hasTitle)&&(e.value=this.options.grid.attrTitle),e},function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){var e;switch(this.options.grid.attrName){case"positionMatrix-Instance":e="matrixtxt";break;default:e=this.options.grid.attrName}return{property:"ds6w",value:e}},function(){return{property:"hasNLS",value:void 0===this.options.grid.hasTitle||this.options.grid.hasTitle}},function(){return{property:"noTitleColumn",value:void 0!==this.options.grid.hasTitle&&!this.options.grid.hasTitle}},function(){return{property:"kind",value:this.options.kind}},function(){return{property:"ds6wFrom",value:"Instance"===this.options.grid.attrInstRef?"rel":this.options.grid.attrDBName?this.options.grid.attrInstRef:void 0}},function(){return{property:"convertInfos",value:this.options.grid.convertInfos}}]};function A(e,t){for(var o=0;o<e.length;o++){var n=e[o];if(n.dataIndex===t)return n;if(n.xnav_options&&n.xnav_options.name===t)return n}}return l.extend({name:"ip-attr-customization",columnOrdering:!0,defaultOptions:{renderTo:null,modelEvents:null,subscribeTokens:[],modelSubscribeTokens:[],compactMode:!1,applyOnlyToThisApp:!1,baseTypes:[],selectedTypes:[],selectedExtensions:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],supportedIndexAttrs:[],rowHeaderActivated:!0,thumbnailsActivated:!1,pinModel:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowIndexFlag:!1,showRowBorderFlag:!0,showAlternateBackgroundFlag:!1,rowSelection:"multiple",cellSelection:"none",selectionBehavior:{canInteractiveMultiselectWithCheckboxClick:!0,canMultiSelect:!0,enableFeedbackForActiveCell:!0,enableShiftSelection:!0,toggle:!1,unselectAllOnEmptyArea:!0},columns:[{icon:{iconName:"eye",fontIconFamily:1},tooltip:t.attributesCustomization.attrVisible,dataIndex:"attrVisible",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.removableFromView?t=e.nodeModel.options.grid.layout.removableFromView:!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"}},{dataIndex:"tree",text:t.attributesCustomization.attrTitle,typeRepresentation:"string",editableFlag:!1,editionPolicy:"EditionOnDoubleClick",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel?!0===w?-1===y.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):-1===C.indexOf(e.nodeModel.options.columnIndex)&&!0!==e.nodeModel.options.pinColumn&&!0!==e.nodeModel.options.grid.isAdditionalColumn||(t=!1):t=!1,t}},{icon:{iconName:"pin",fontIconFamily:1},dataIndex:"pinContent",typeRepresentation:"pin",alignmentValue:"center",alwaysVisibleFlag:!0,width:100,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=!0;return e.nodeModel.options.grid.layout&&void 0!==e.nodeModel.options.grid.layout.pinEditable?t=e.nodeModel.options.grid.layout.pinEditable:!0===e.nodeModel.options.pinColumn&&(t=!1),t}},{icon:{iconName:"export",fontIconFamily:1},dataIndex:"exportContent",typeRepresentation:"boolean",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!0,editionPolicy:"EditionInPlace",sortableFlag:!1,resizableFlag:!1,getCellEditableState:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&!e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!1),t},getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":"boolean"},getCellSemantics:function(e){var t=void 0!==e.nodeModel.options.grid.exportLock&&e.nodeModel.options.grid.exportLock;return!0===e.nodeModel.options.pinColumn&&(t=!0),{disabled:t}}},{icon:{iconName:"palette",fontIconFamily:1},dataIndex:"columnColor",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,editableFlag:!1,sortableFlag:!1,resizableFlag:!1,typeRepresentation:"colorChange",getCellClassName:function(e){var t=[];if(e.nodeModel){var o="#ffffff",n="#000000";if(e.nodeModel.options.grid&&e.nodeModel.options.grid.columnColor){if(o=(o=e.nodeModel.options.grid.columnColor["background-color"]?e.nodeModel.options.grid.columnColor["background-color"]:"#ffffff").replace(/;/g,""),n=(n=e.nodeModel.options.grid.columnColor.color?e.nodeModel.options.grid.columnColor.color:"#0000").replace(/;/g,""),"#ffffff"!==o){var s="enx-background-color-"+o.replace(/\#/g,""),a="{background-color:"+o+";}";i.createCSSClass(s,a),t.push(s)}if("#000000"!==n){var l="enx-color-"+n.replace(/\#/g,"");a="{color:"+n+";}";i.createCSSClass(l,a),t.push(l)}}}return t.join(" ")},getCellEditableState:function(e){var t=!0;return!0===e.nodeModel.options.pinColumn&&(t=!1),t}},{icon:{iconName:"trash",fontIconFamily:1},dataIndex:"attrRemove",alignmentValue:"center",alwaysVisibleFlag:!0,width:30,sortableFlag:!1,resizableFlag:!1,editableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&!0===e.nodeModel.options.pinColumn?"string":e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable)?"actionNotRemove":"actionRemove"},getCellSemantics:function(e){if(e.nodeModel&&(!0===e.nodeModel.options.grid.isAdditionalColumn||e.nodeModel.options.grid.layout&&!1===e.nodeModel.options.grid.layout.removable))return{disabled:!0}}}]},dgvLayoutOptions:{cellHeight:28,columnHeaderHeight:38,rowsHeader:!0}},init:function(e){this._parent(e);var o=this,n=i.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";o.elements.container=a.createElement("div",{class:o.getClassNames(n)}),h.retrievePlatformUrl({addDefaults:!0,initWSAcess:!0}).then(function(){w=!!(o.options.baseInstanceTypes&&o.options.baseInstanceTypes.length>0),o.options.allowedIndexAttributes=new Set(o.options.allowedIndexAttributes),I=o.options.manageAttrFromInstance,o._buildBody(),o._buildFooter(),o.elements.panel2small=a.createElement("div",{class:o.getClassNames("-panel2small"),text:t.attributesCustomization.panel2small}).inject(o.elements.container),o.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{idView:"customize",title:t.attributesCustomization.apptitle,html:o.elements.container}})})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy(),this.options.grid.destroy(),this.options.grid=null,this._parent()},_buildBody:function(){this._buildIconBar(),this.elements.dgv=a.createElement("div",{class:this.getClassNames("-dgv")}).inject(this.elements.container);var e=this.options.dgvOptions;!0!==this.options.withDgv?e.columns.splice(2,1):e.columns.splice(4,1);var o=a.extend({identifier:"DataGridView-attrCusto-"+i.uid()},this.options.dgvOptions);o.layout=new f(this.options.dgvLayoutOptions);var s=this.options.grid=new m(o);s.onContextualEvent=function(){return[]},s.getCellTooltip=function(e){var o=this.options.grid.getColumnOrGroup(e.columnID).dataIndex;return e.dataIndex=o,-1===e.rowID?{shortHelp:t.attributesCustomization[o],updateModel:!1}:"tree"===o&&e.nodeModel&&!0!==e.nodeModel.getReferenceValue("isAdditionalColumn")?!0===h.instanceMgtActivated?{shortHelp:t.replace(t.attributesCustomization.tooltipColName,{label:e.nodeModel.getLabel(),instRef:t.attributesCustomization[e.nodeModel.getReferenceValue("attrInstRef")]}),updateModel:!1}:{shortHelp:e.nodeModel.getLabel(),updateModel:!1}:void 0}.bind(this);var l={actionRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"trash",fontIconFamily:WUXManagedFontIcons.Font3DS}}},actionNotRemove:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"block",fontIconFamily:WUXManagedFontIcons.Font3DS}}}},r={};r[t.attributesCustomization.pinLeft]="left",r[t.attributesCustomization.pinRight]="right",r[t.attributesCustomization.unpinned]="unpinned";var u={pin:{stdTemplate:"enumCombo",semantics:{possibleValues:r,valueType:"enumCustom"}}};s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(u)),!0!==this.options.withDgv&&(l.colorChange={stdTemplate:"functionIcon",semantics:{icon:{iconName:"text",fontIconFamily:WUXManagedFontIcons.Font3DS}}},s.registerReusableCellContent({id:"colorChooser",buildContent:function(){var e=b.createElement("div",{class:"enxCommand"}),o=b.createElement("div",{class:"enxColorLauncher",styles:{"background-color":"#ffffff",color:"#000000","font-size":"18px"},title:t.attributesCustomization.changeColor});return o.innerHTML=t.attributesCustomization.colorContent,e.appendChild(o),e}})),s.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(l));var h=this;this.options.attrModel=new d({shouldBeSelected:function(e){return!0!==e.options.pinColumn}}),s.treeDocument=this.options.attrModel,s.getContent().addClassName("enxdatagridview"),s.getContent().inject(this.elements.dgv);h=this;s.onReady(function(){s.addEventListener("change",h._cellModified.bind(h)),s.addEventListener("click",h._cellClicked.bind(h)),h.options.toolbar.show()}),this._addColumns(),this.options.attrModel.getXSO().onPostAdd(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onPostRemove(this._manageAttrSelection.bind(this)),this.options.attrModel.getXSO().onEmpty(this._manageAttrSelection.bind(this)),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"addChild"},function(e){!0!==h._isMoving&&!0!==h._globalUpdate&&h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",addedColumns:[e.data.nodeModel.dump(M)]}})})),this.options.modelSubscribeTokens.push(this.options.attrModel.getModelEvents().subscribe({event:"removeChild"},function(e){if(!0!==h._isMoving&&!0!==h._globalUpdate){var t=e.data.nodeModel.getReferenceValue("attrName");if(-1!==C.indexOf(t)){if(!1===h.options.withDgv){var o=h.options.toolbar.getItem("specificColumns"),n=o.content.component;if(n)n.isSelected(t)&&n.toggleSelection(n.getItem(t));else{var i=o.content.options.items,s=!1,a=0,l=i.length;do{i[a].id===t?(i[a].selected=!1,s=!0):a++}while(!1===s&&a<l);h.options.toolbar.menu.updateItem(o)}}"thumbnail"!==t||g.isTouchDevice()||h.elements.comboCompact.disabled(!1)}h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",removedColumns:[e.data.nodeModel.dump(M)]}})}})),this.elements.behavior=a.createElement("div",{class:this.getClassNames("-behavior")}).inject(this.elements.container);var v=new d,y=new c({viewMode:"comfortable",label:t.attributesCustomization.comfortable,subLabel:t.attributesCustomization.comfortableExplanation,children:null,icons:[{iconName:"view-big-tile",fontIconFamily:WUXManagedFontIcons.Font3DS}]});v.addRoot(y);var w=new c({viewMode:"compact",label:t.attributesCustomization.compact,subLabel:t.attributesCustomization.compactExplanation,children:null,icons:[{iconName:"view-list",fontIconFamily:WUXManagedFontIcons.Font3DS}]});v.addRoot(w);var I=1===this.options.attrModel.getRoots().filter(function(e){return"thumbnail"===e.getReferenceValue("attrName")}).length;"compact"!==this.options.viewMode||!1!==I||g.isTouchDevice()?y.select(!0):w.select(!0);var x=I||g.isTouchDevice();this.elements.comboCompact=new n({className:this.getClassNames("-compactmode-selector"),treedocument:v,disabled:x,events:{onSelectionChange:function(){var e=v.getSelectedNodes()[0].options.viewMode;h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:e}})}}});var A=a.createElement("div",{class:this.getClassNames("-compactmode-global")});a.createElement("div",{class:this.getClassNames("-compactmode-label"),text:t.attributesCustomization.density}).inject(A),this.elements.comboCompact.inject(A),A.inject(this.elements.behavior),this.elements.applyToggle=new p({label:t.attributesCustomization.apply_to_this_app});var T=a.createElement("div",{class:this.getClassNames("-applytothisapp"),content:this.elements.applyToggle});if(this.elements.applyToggle.addEventListener("change",function(e){var t=e.dsModel;h.options.applyOnlyToThisApp=t.checkFlag,h.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/applyOnlyToThisApp",data:{applyOnlyToThisApp:h.options.applyOnlyToThisApp}})}),T.inject(this.elements.behavior),this.options.enableDynamicAttributesPos){this.elements.applydynamicAttributesToggle=new p({label:this.options.dynamicAttrCheckBoxName,checkFlag:this.options.dynamicAttrCheckBoxValue});var S=a.createElement("div",{class:this.getClassNames("-dynamicCheckBox"),content:this.elements.applydynamicAttributesToggle});this.elements.applydynamicAttributesToggle.addEventListener("change",function(e){var t=e.dsModel.checkFlag;h.options.dynamicAttributesTop=t;var o=h.options.attrModel.getRoots().filter(function(e){return e.options.grid.isDynamic});if(t)for(let e=0;e<o.length;++e)h._moveColumn("moveFirst",[o[e]]);else for(let e=o.length-1;e>=0;--e)h._moveColumn("moveLast",[o[e]])}),S.inject(this.elements.behavior),this.elements.behavior.setStyle("grid-template-columns","50% auto auto auto")}},_buildFooter:function(){var e=this,o=a.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container),n=new r({label:t.attributesCustomization.close,emphasize:"primary",touchMode:!0});n.addEventListener("click",function(){e._closePanel(),e.destroy()}),n.inject(o);var i=new r({label:t.attributesCustomization.reset,touchMode:!0});i.addEventListener("click",function(){e.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"reset",applyOnlyToThisApp:e.options.applyOnlyToThisApp}}),e.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{restore:!0}}),e.destroy()}),i.inject(o)},_closePanel:function(){var e=[];this.options.attrModel.getRoots().forEach(function(t){e.push(t.dump(M))});let t={what:"close",selectedTypes:this.options.selectedTypes,selectedExtensions:this.options.selectedExtensions,selectedAttributes:e,applyOnlyToThisApp:this.options.applyOnlyToThisApp};this.options.enableDynamicAttributesPos&&(t.dynamicAttributesTop=this.options.dynamicAttributesTop),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:t}),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{restore:!0}})},_addColumns:function(){var e=this;void 0===this.options.appColumns?console.error("AttributesCustomization## Invalid input. Missing property appColumns"):e.options.attrModel.withTransactionUpdate(function(){for(var t=0;t<e.options.appColumns.length;t++){var o=e.options.appColumns[t];if("bi_color"!==o.dataIndex){var n=a.is(o.text,"string")&&o.text.length>0?o.text:e._retrieveColumnName(o.dataIndex),i=!o.customisation||!o.customisation.exportable||o.customisation.exportable.value,s=!(!o.customisation||!o.customisation.exportable)&&o.customisation.exportable.lock,l=o.customisation&&o.customisation.styles?o.customisation.styles:{"background-color":"#ffffff",color:"#000000"},r=o.customisation&&o.customisation.layout?o.customisation.layout:{},d=o.pinned?o.pinned:"unpinned",u=void 0!==o.visibleFlag?o.visibleFlag:!o.isHidden;!0!==e.options.withDgv&&(u=!o.isHidden);var p,m=o.ds6wFrom&&"rel"===o.ds6wFrom?"Instance":o.attrDBName?o.ds6wFrom:"Reference";o.isAdditionalColumn&&(m="AdditionalColumn"),!0===w?"Reference"===m?p=[{iconName:"product"}]:"Instance"===m?p=[{iconName:"flow-cascade"}]:"AdditionalColumn"===m&&(p=[{iconName:"attributes-add"}]):p=void 0;var f=o.ds6w&&"rel"!==o.ds6wFrom?o.ds6w:o.dataIndex,h=new c({columnIndex:o.dataIndex,label:n,icons:p,grid:{attrTitle:n,attrVisible:u,exportContent:i,exportLock:s,columnColor:l,attrName:f,attrDBName:o.attrDBName,isAdditionalColumn:o.isAdditionalColumn,layout:r,pinContent:d,attrRemove:!0,attrInstRef:m,attrAlert:null,isDynamic:!!o.isDynamic},children:null});e.options.attrModel.addChild(h)}}e.options.attrModel.expandAll()})},_cellModified:function(e,o){if(o&&o.nodeModel&&o.nodeModel.options.grid)switch(this.options.grid.layout.getDataIndexFromColumnIndex(o.columnID)){case"attrVisible":this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"visibilityColumn",modifiedColumn:o.nodeModel.options.columnIndex,visibilityFlag:o.nodeModel.getReferenceValue("attrVisible")}});break;case"tree":0==o.nodeModel.getLabel().length?(o.nodeModel.options.label=o.nodeModel.options.grid.attrTitle,v.displayNotification({title:t.msg_warning_BlankHeaderNotAllowed.Title,subtitle:t.replace(t.msg_warning_BlankHeaderNotAllowed.Advice),className:"warning"})):this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeTitle",modifiedColumn:o.nodeModel.options.columnIndex,newTitle:o.nodeModel.getLabel()}});break;case"exportContent":this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"exportColumn",modifiedColumn:o.nodeModel.options.columnIndex,exportFlag:o.nodeModel.getReferenceValue("exportContent")}});break;case"pinContent":var n=this,i=o.nodeModel.getReferenceValue("pinContent"),s=o.nodeModel.options.columnIndex;n.options.attrModel.withTransactionUpdate(()=>{n._globalUpdate=!0,this.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"pinChange",modifiedColumn:s,pin:i}}),this._refreshColumnsList(),o.nodeModel.select(),delete n._globalUpdate})}},_refreshColumnsList:function(){var e=this.options.attrModel.getRoots(),t={};e.forEach(e=>{t[e.options.columnIndex]=e});for(var o=this.options.dgvInfo,n=o.options.dgvLayout.getOrderedColumnsIndexes(),i=n.length-1;i>=0;i--){var s=o.options.dgv.getColumnOrGroup(n[i]);if(s){var a=t[s.dataIndex];a&&this.options.attrModel.addChild(a,0)}}},_cellClicked:function(e,o){if(o&&o.nodeModel&&o.nodeModel.options.grid){if(!0===o.nodeModel.options.pinColumn)return;switch(this.options.grid.layout.getDataIndexFromColumnIndex(o.columnID)){case"columnColor":this._changeColor([o.nodeModel]);break;case"attrRemove":if(o.nodeModel){if(o.nodeModel.options.grid.layout&&!1===o.nodeModel.options.grid.layout.removable||o.nodeModel.options.grid.isAdditionalColumn&&!0===o.nodeModel.options.grid.isAdditionalColumn)break;if(this.options.attrModel.removeRoot(o.nodeModel),"thumbnail"===o.nodeModel.options.columnIndex){this.options.thumbnailsActivated=!1;var n={id:this.options.toolbar.getItem("thumbnail").id,tile:t.attributesCustomization.activateThumbnails};this.options.toolbar.menu.updateItem(n),this.options.toolbar.select("thumbnail",!1)}}}}},_retrieveColumnName:function(e){return t.attributesCustomization[e]?t.attributesCustomization[e]:e},_buildIconBar:function(){this.elements.toolbar=a.createElement("div",{class:this.getClassNames("-toolbar")}).inject(this.elements.container);var e=(this.options.appColumns?this.options.appColumns:[]).filter(function(e){return!e.isHidden}).map(function(e){return e.dataIndex}),n=this,i={renderTo:this.elements.toolbar,multiSelect:!0,items:[{fonticon:"cog",title:t.attributesCustomization.moreAttributes,name:"moreAttributes",handler:function(e,o){require(["DS/IPClassifyColumnCusto/MoreAttributesWizard"],function(e){for(var o=n.options.attrModel.getRoots(),i=[],s=0;s<o.length;s++)!0===x(o[s].getReferenceValue("attrName"))&&i.push({name:o[s].getReferenceValue("attrName"),instRef:o[s].getReferenceValue("attrInstRef"),attrDBName:o[s].getReferenceValue("attrDBName")});var a=n.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/MoreAttributesWizard/selectedAttributes"},function(e){n.options.modelEvents.unsubscribe(a);for(var o=n.options.attrModel.getRoots(),i=new Map,s=0;s<o.length;s++)!0===x(o[s].getReferenceValue("attrName"))&&i.set(o[s].getReferenceValue("attrName"),o[s].getReferenceValue("attrDBName"));n.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:t.attributesCustomization.apptitle}}),n.options.selectedExtensions=e.selectedExtensions,n.options.selectedTypes=e.selectedTypes,n._globalUpdate=!0;var l=e.selectedAttributes.filter(function(e){return i.has(e.dataIndex)}).map(function(e){return e.dataIndex}),r=Array.from(i.keys()).filter(function(e){return-1===l.indexOf(e)}),d=e.selectedAttributes.filter(function(e){var t=!i.has(e.dataIndex)||i.get(e.dataIndex)&&!g.arrayEquals(i.get(e.dataIndex),e.attrDBName);return t&&-1!==n.options.defaultAttributes.indexOf(e.dataIndex)&&(t=!1),t}),u=[],p=[],m=0;for(m=0;m<r.length;m++){var f=n.options.attrModel.search({match:function(e){var t=!1;return e.nodeModel.options.columnIndex===r[m]&&!0!==e.nodeModel.options.grid.isAdditionalColumn&&!0!==e.nodeModel.options.grid.isDynamic&&"ds6w:type"!==r[m]&&(t=!0,n.options.dbOnlyAttributes&&n.options.allowedIndexAttributes.has(r[m])&&(t=!1)),t}});n.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<f.length;e++)n.options.attrModel.removeRoot(f[e]),u.push(f[e].dump(M))})}var h=[];for(m=0;m<d.length;m++){var b,v=A(n.options.appColumns,d[m].dataIndex),C=!1;if(v){var y=v.xnav_options;y||(y=v.customisation),y&&(C=!!y.exportable&&y.exportable.lock)}!0===w&&("Reference"===d[m].attrParent?b=[{iconName:"product"}]:"Instance"===d[m].attrParent&&(b=[{iconName:"flow-cascade"}]));var I={attrTitle:d[m].label,attrVisible:!0,exportContent:!0,exportLock:C,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:d[m].dataIndex,attrDBName:d[m].attrDBName,attrRemove:!0,pinContent:"unpinned",attrInstRef:d[m].attrParent,attrAlert:null};d[m].convertInfos&&(I.convertInfos=d[m].convertInfos);var T=new c({label:d[m].label,columnIndex:d[m].dataIndex,icons:b,grid:I,kind:d[m].kind,children:null});if(v){let e=n.options.attrModel.search({match:function(e){return d[m].dataIndex===e.nodeModel.options.columnIndex}});if(e&&1==e.length){let t=e[0].getAttributeValue("attrDBName"),o=d[m].attrDBName,i=!1;if(t)for(let e=0;e<o.length;++e)-1===t.indexOf(o[e])&&(t.push(o[e]),i=!0);i&&(n.options.attrModel.withTransactionUpdate(function(){e[0].setAttribute("attrDBName",t)}),h.push(e[0]),e[0].select())}}else{var S=n.__locateFirstAndLastPin("right");let e=null,t=!0===n.options.dynamicAttrCheckBoxValue;if(!0===n.options.dynamicAttributesTop&&(t=n.options.dynamicAttributesTop),n.options.enableDynamicAttributesPos&&!t){var D=n.options.attrModel.getRoots();for(let t=0;t<D.length;++t){let o=D[t];if(o.options.grid.isDynamic){e=o._getLocalID?o._getLocalID():o._localID;break}}}e?n.options.attrModel.addChild(T,e):S.first?n.options.attrModel.insertBefore(T,S.first):n.options.attrModel.addChild(T),T.select(),h.push(T)}}for(m=0;m<h.length;m++)p.push(h[m].dump(M));(u.length||p.length)&&n.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"addRemoveColumns",selectedTypes:n.options.selectedTypes,selectedExtensions:n.options.selectedExtensions,removedColumns:u,addedColumns:p}}),delete n._globalUpdate}),l=n.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/MoreAttributesWizard/closeWizard"},function(){n.options.modelEvents.unsubscribe(l),n.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{idView:"customize",html:n.elements.container,title:t.attributesCustomization.apptitle}})});n.attributeWizard=new e({dgv:n.options.withDgv,modelEvents:n.options.modelEvents,baseTypes:n.options.baseTypes,baseInstanceTypes:n.options.baseInstanceTypes,selectedTypes:n.options.selectedTypes,selectedExtensions:n.options.selectedExtensions,selectedAttributes:i,defaultTypes:n.options.defaultTypes,defaultExtensions:n.options.defaultExtensions,defaultAttributes:n.options.defaultAttributes,supportedIndexAttrs:n.options.supportedIndexAttrs,fetchTypesFromDictionary:n.options.fetchTypesFromDictionary,dbOnlyAttributes:n.options.dbOnlyAttributes,showNonDBAttributesAsWell:n.options.showNonDBAttributesAsWell,classificationAttributes:n.options.classificationAttributes,addValueInAuthoringColumn:n.options.addValueInAuthoringColumn,preMappedAttriForAuthoring:n.options.preMappedAttriForAuthoring})})}},{className:"divider"},{fonticon:"up",title:t.attributesCustomization.moveUp,name:"moveUp",disabled:!0,handler:function(e,t){!0!==t.disabled&&n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{fonticon:"down",title:t.attributesCustomization.moveDown,name:"moveDown",disabled:!0,handler:function(e,t){!0!==t.disabled&&n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-top",title:t.attributesCustomization.moveFirst,name:"moveFirst",disabled:!0,handler:function(e,t){!0!==t.disabled&&n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{fonticon:"move-to-bottom",title:t.attributesCustomization.moveLast,name:"moveLast",disabled:!0,handler:function(e,t){!0!==t.disabled&&n._moveColumn(t.name,n.options.attrModel.getSelectedNodes())}},{className:"divider"},{fonticon:"trash",title:t.attributesCustomization.remove,name:"remove",disabled:!0,handler:function(e,t){n._removeSelectedColumn()}}]};if(!0===this.options.withDgv){this.options.thumbnailsActivated=-1!==e.indexOf("thumbnail");var s=[{fonticon:this.options.rowHeaderActivated?"checkbox-on":"checkbox-off",title:this.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,name:"checkBoxes",handler:function(e,o){n.options.rowHeaderActivated=!n.options.rowHeaderActivated;var i=n.options.rowHeaderActivated?"checkbox-on":"checkbox-off",s=n.options.rowHeaderActivated?t.attributesCustomization.deactivateSelectionBoxes:t.attributesCustomization.activateSelectionBoxes,a={id:n.options.toolbar.getItem("checkBoxes").id,title:s,fonticon:i};n.options.toolbar.menu.updateItem(a),n.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"rowsHeaderModification",rowsHeader:n.options.rowHeaderActivated}})}},{fonticon:"picture",title:this.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,name:"thumbnail",selectable:!0,selected:this.options.thumbnailsActivated,handler:function(e,o){n.options.thumbnailsActivated=!n.options.thumbnailsActivated;var i=n.options.thumbnailsActivated?t.attributesCustomization.deactivateThumbnails:t.attributesCustomization.activateThumbnails,s={id:n.options.toolbar.getItem("thumbnail").id,title:i,selected:n.options.thumbnailsActivated};n.options.toolbar.menu.updateItem(s),n._manageThumbnailAttribute(o.name,o.selected)}},{className:"divider"}];if(!0!==w&&I){var l={fonticon:"list-add",title:t.attributesCustomization.instanceAtt,name:"instanceAttributes",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")}],events:{onClick:function(e,t){n._manageInstanceAttributes(t.name,t.selected)}}}}};s.splice(1,0,l)}i.items.splice.apply(i.items,[2,0].concat(s))}else{var r=[{fonticon:"list-add",title:t.attributesCustomization.specificColumn,name:"specificColumns",id:"specificColumns",content:{type:"dropdownmenu",options:{multiSelect:!0,items:[{fonticon:"checkbox-on",text:t.attributesCustomization.selection,name:"selection",id:"selection",selectable:!0,selected:-1!==e.indexOf("selection")},{fonticon:"eye",text:t.attributesCustomization.hide_show,name:"hide_show",id:"hide_show",selectable:!0,selected:-1!==e.indexOf("hide_show")},{text:t.attributesCustomization.instanceName,name:"ds6w:label-Instance",id:"ds6w:label-Instance",selectable:!0,selected:-1!==e.indexOf("ds6w:label-Instance")},{text:t.attributesCustomization.instanceMatrix,name:"positionMatrix-Instance",id:"positionMatrix-Instance",selectable:!0,selected:-1!==e.indexOf("positionMatrix-Instance")},{fonticon:"picture",text:t.attributesCustomization.thumbnail,name:"thumbnail",id:"thumbnail",selectable:!0,selected:-1!==e.indexOf("thumbnail")}],events:{onClick:function(e,t){n._manageSpecificColumn(t.name,t.selected)}}}}},{className:"divider"}];i.items.splice.apply(i.items,[2,0].concat(r));var d=[{fonticon:"palette",title:t.attributesCustomization.changeColor,name:"changeColor",disabled:!0,handler:function(e,t){n._changeColor(n.options.attrModel.getSelectedNodes())}}];i.items.splice.apply(i.items,[9,0].concat(d))}!1===this.options.moreAttributes&&(i.items.forEach(function(e,t){"moreAttributes"===e.name&&i.items.splice(t,1)}),"divider"===i.items[0].className&&i.items.splice(0,1)),this.options.toolbar=new o(i),this.options.toolbar.elements.container.setStyle("display",void 0)},_manageAttrSelection:function(){var e=this.options.attrModel.getSelectedNodes(),t=["moveUp","moveDown","moveFirst","moveLast"],o=["remove","changeColor"],n=e.length,i=!1;let s=!1;var a=0;for(a=0;a<n;a++)!0===e[a].options.grid.isAdditionalColumn||e[a].options.grid.layout&&!1===e[a].options.grid.layout.removable||(i=!0),e[a].options.grid.layout&&!1===e[a].options.grid.layout.movable&&(s=!0);if(0===n){for(a=0;a<t.length;a++)this.options.toolbar.disableItem(t[a]);for(a=0;a<o.length;a++)this.options.toolbar.disableItem(o[a])}else if(1===n){for(a=0;a<t.length;a++)s?this.options.toolbar.disableItem(t[a]):this.options.toolbar.enableItem(t[a]);for(a=0;a<o.length;a++)"remove"===o[a]&&!1===i?this.options.toolbar.disableItem(o[a]):this.options.toolbar.enableItem(o[a])}else if(n>=1){for(a=0;a<t.length;a++)this.options.toolbar.disableItem(t[a]);for(a=0;a<o.length;a++)"remove"===o[a]&&!1===i?this.options.toolbar.disableItem(o[a]):this.options.toolbar.enableItem(o[a])}},_moveColumn:function(e,t){!0===this.options.withDgv?this.__dgvMoveColumn(e,t):this.__treeMoveColumn(e,t)},__dgvMoveColumn:function(e,t){var o=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var n,i=t[0],s=i.getReferenceValue("pinContent"),a=i._getLocalID?i._getLocalID():i._localID,l=o.__locateFirstAndLastPin(s),r=l.first._getLocalID?l.first._getLocalID():l.first._localID,d=l.last?l.last._getLocalID?l.last._getLocalID():l.last._localID:o.options.getRoots().length-1;switch(e){case"moveFirst":n=r;break;case"moveUp":n=r<=a-1?a-1:a;break;case"moveDown":n=d>=a+1?a+1:a;break;case"moveLast":n=d}if(a!==n&&o.options.dgvInfo&&!0===o.options.dgvInfo.columnOrdering){o.options.dgvInfo.columnOrdering=!1;let e=a,t=n,s=o.options.attrModel.getChildren();s&&s.length>0&&s.length>e&&s.length>t&&(e=s[e].options.columnIndex,t=s[t].options.columnIndex);var c={fromID:a,fromIndex:e,toID:n,toIndex:t};o._isMoving=!0,o.options.attrModel.addChild(i,c.toID),i.select(),o._isMoving=!1;let l={what:"moveColumn",move2perform:c};o.options.enableDynamicAttributesPos&&(l.dynamicAttributesTop=o.options.dynamicAttributesTop),o.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:l})}})},__treeMoveColumn:function(e,t){var o=this;1===t.length&&this.options.attrModel.withTransactionUpdate(function(){var n=t[0],i=n._getLocalID?n._getLocalID():n._localID,s={fromID:i,toID:-1};switch(e){case"moveFirst":s.toID=0;break;case"moveUp":s.toID=i-1;break;case"moveDown":s.toID=i+1;break;case"moveLast":s.toID=o.options.attrModel.getRoots().length-1}-1!==s.toID&&i!==s.toID&&s.toID<o.options.attrModel.getRoots().length&&(o._isMoving=!0,o.options.attrModel.addChild(n,s.toID),n.select(),o._isMoving=!1,o.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"moveColumn",move2perform:s}}))})},_manageSpecificColumn:function(e,o){var n=this,i=!1,s=!0;"ds6w:label-Instance"===e&&(i=!0,s=!1);var a=["hide_show","ds6w:label-Instance","positionMatrix-Instance","thumbnail"],l="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,r=t.attributesCustomization[l]?t.attributesCustomization[l]:e;if(!0===o){if("thumbnail"===e)this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0),this.elements.comboCompact.disabled(!0);this.options.attrModel.withTransactionUpdate(function(){var t=-1!==a.indexOf(e),o=new c({columnIndex:e,label:r,grid:{attrTitle:r,attrVisible:!0,exportContent:i,exportLock:s,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},attrName:e,hasTitle:t},modelEvents:n.options.modelEvents});n.options.attrModel.addChild(o)})}else{"thumbnail"===e&&this.elements.comboCompact.disabled(!1);var d=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<d.length;e++)n.options.attrModel.removeRoot(d[e])})}},_manageInstanceAttributes:function(e,o){var n=this;if(!0===o)this.options.attrModel.withTransactionUpdate(function(){var o="ds6w:label-Instance"===e?"instanceName":"positionMatrix-Instance"===e?"instanceMatrix":e,i=t.attributesCustomization[o]?t.attributesCustomization[o]:e;switch(e){case"ds6w:label-Instance":var s=new c({columnIndex:e,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"left",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:n.options.modelEvents});(a=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(s,a.first):n.options.attrModel.addChild(s);break;case"positionMatrix-Instance":var a,l=new c({columnIndex:e,label:i,grid:{attrTitle:i,attrVisible:!0,exportContent:!0,exportLock:!1,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:e,hasTitle:!0,attrInstRef:"Instance"},modelEvents:n.options.modelEvents});(a=n.__locateFirstAndLastPin("right")).first?n.options.attrModel.insertBefore(l,a.first):n.options.attrModel.addChild(l)}});else{var i=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<i.length;e++)n.options.attrModel.removeRoot(i[e])})}},_manageThumbnailAttribute:function(e,o){var n=this;if(!0===o){this.elements.comboCompact.options.treedocument.getRoots()[0].select(!0),n.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeViewMode",viewMode:"comfortable"}}),g.isTouchDevice()||this.elements.comboCompact.disabled(!0),this.options.attrModel.withTransactionUpdate(function(){var o=t.attributesCustomization[e]?t.attributesCustomization[e]:e,i=new c({columnIndex:e,label:o,grid:{attrTitle:o,attrVisible:!0,exportContent:!1,exportLock:!0,attrRemove:!0,columnColor:{background_color:"#ffffff",color:"#000000"},pinContent:"unpinned",attrName:e,hasTitle:!0},modelEvents:n.options.modelEvents}),s=n.__locateFirstAndLastPin("right");s.first?n.options.attrModel.insertBefore(i,s.first):n.options.attrModel.addChild(i)})}else{g.isTouchDevice()||this.elements.comboCompact.disabled(!1);var i=this.options.attrModel.search({match:function(t){return t.nodeModel.options.label===e||t.nodeModel.options.columnIndex===e}});this.options.attrModel.withTransactionUpdate(function(){for(var e=0;e<i.length;e++)n.options.attrModel.removeRoot(i[e])})}},_removeSelectedColumn:function(){var e=this.options.attrModel.getSelectedNodes(),o=this;this.options.attrModel.withTransactionUpdate(function(){for(var n=0;n<e.length;n++)!0===e[n].options.grid.isAdditionalColumn||e[n].options.grid.layout&&!1===e[n].options.grid.layout.removable?(e[n].unselect(),i.displayNotif({level:"warning",message:t.replace(t.attributesCustomization.cannotRemove,{attr:e[n].getReferenceValue("attrTitle")})})):o.options.attrModel.removeRoot(e[n])})},_changeColor:function(e){var t=this;require(["DS/PADServices/views/private/ColorPicker"],function(o){t.elements.container.disabled=!0;var n={background_color:"#ffffff",color:"#000000"};if(1===e.length&&e[0].getReferenceValue("columnColor")){var i=e[0].getReferenceValue("columnColor");n={background_color:i["background-color"],color:i.color}}new o({selected_color:n,renderTo:document.body,events:{onColorOK:function(o){t.elements.container.disabled=!1;for(var n=[],i=0;i<e.length;i++){var s=e[i],a={};"#ffffff"===o.background_color?a["background-color"]=void 0:a["background-color"]=o.background_color,"#000000"===o.color?a.color=void 0:a.color=o.color,s.updateOptions({grid:{columnColor:a}}),n.push(s.options.columnIndex)}t.options.modelEvents.publish({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification",data:{what:"changeColor",modifiedColumns:n,"background-color":a["background-color"]+";",color:a.color+";"}})},onClose:function(){t.elements.container.disabled=!1}}})})},__locateFirstAndLastPin:function(e,t){var o,n=this,i=this.options.attrModel.getRoots(),s=null,a=[],l=null,r=null,d=null;i.forEach((o,i)=>{if(o._tempIndex=i,o.getReferenceValue("pinContent")===e){var c=!0;"unpinned"==e&&n.options.enableDynamicAttributesPos&&(c=c&&!o.options.grid.isDynamic),c&&a.push(o)}if(t&&o.options.columnIndex===t)s=i;else switch(o.getReferenceValue("pinContent")){case"left":l=o;break;case"right":d=d||o;break;default:r=o}}),t&&(a[0].options.columnIndex===t?a.shift():a[a.length-1].options.columnIndex===t&&a.pop()),o=a[0];var c=a.length-1;return{first:o,last:a[c],current:s,left:l,right:d,middle:r}}})}),define("DS/IPClassifyColumnCusto/MoreAttributesWizard",["css!DS/IPClassifyColumnCusto/IPClassifyColumnCusto.css","i18n!DS/IPClassifyColumnCusto/assets/nls/IPClassifyColumnCusto","UWA/Core","UWA/Controls/Abstract","UWA/Class/Promise","DS/PADServices/utils/GlobalUtils","DS/IPClassifyColumnCusto/WizardSteps","text!DS/IPClassifyColumnCusto/assets/MoreAttrWizardSteps.json","DS/PADServices/views/private/SearchInput","DS/PADServices/views/private/Iconbar","DS/PADServices/utils/DictionaryMgt","DS/Controls/Button","DS/Controls/Loader","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","DS/DataGridView/DataGridView","DS/DataGridView/DataGridViewLayout","DS/Utilities/Utils","DS/PADServices/utils/DictionaryAccess","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert","DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/ClassificationUtil/ClassificationUtil","DS/Controls/Toggle","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/DimensionUtils"],function(e,t,o,n,i,s,a,l,r,d,c,u,p,m,f,h,b,g,v,C,y,w,I,x,M,A){"use strict";var T=JSON.parse(l),S={properties:[function(){return{property:"dataIndex",value:this.options.grid.attrName}},function(){return{property:"attrDBName",value:this.options.grid.attrDBName}},function(){return{property:"attrParent",value:this.options.grid.attrParent}},function(){return{property:"label",value:this.options.label}},function(){return{property:"kind",value:this.options.grid.attrKind}},function(){return{property:"description",value:this.options.grid.attrDesc}},function(){return{property:"convertInfos",value:this.options.grid.convertInfos}}]},D={"ds6wg:XCADExtension.V_CADOrigin":"ds6w:cadMaster"},N=["ds6w:globalType"];return n.extend({name:"ip-more-attr",defaultOptions:{baseTypes:[],baseInstanceTypes:[],selectedTypes:[],automaticExtensions:[],selectedExtensions:[],selectedAttributes:[],defaultTypes:[],defaultExtensions:[],defaultAttributes:[],supportedIndexAttrs:[],subscribeTokens:[],modelEvents:null,renderTo:null,steps:null,activeView:null,maps:{referenceTypes:[],instanceTypes:[]},views:{typesView:null,extensionsView:null,attributesView:null},toolbar:null,grids:{},models:{},dgvOptions:{defaultColumnDef:{width:"auto",typeRepresentation:"string"},showRowBorderFlag:!0,alternateBackgroundFlag:!1,columns:[{icon:{iconName:"check",fontIconFamily:1},dataIndex:"attrSel",typeRepresentation:"boolean",alwaysVisibleFlag:!0,width:40,resizableFlag:!1,editableFlag:!0,editionPolicy:"EditionInPlace",getCellEditableState:function(e){var t=!0;return e.nodeModel&&(this.mandatorySelected&&-1!==this.mandatorySelected.indexOf(e.nodeModel.getReferenceValue("attrName"))?t=!1:this.mandatorySelectedWithParent&&this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent]&&-1!==this.mandatorySelectedWithParent[e.nodeModel.options.grid.attrParent].indexOf(e.nodeModel.getReferenceValue("attrName"))&&(t=!1)),t}},{dataIndex:"attrParent",editableFlag:!1,width:30,sortableFlag:!0,resizableFlag:!1,getCellTypeRepresentation:function(e){return e.nodeModel&&e.nodeModel.options.grid.attrParent?e.nodeModel.options.grid.attrParent:"Unknown"},getCellSemantics:function(e){if(e.nodeModel)return{disabled:!0}}},{dataIndex:"tree",text:t.moreAttributesWizard.attrTitle}]},dgvLayoutOptions:{cellHeight:26,columnHeaderHeight:38,rowsHeader:!1}},init:function(e){this._parent(e),this._realInit(e),this._addValueShownInAuthoringModeColumn=e.dbOnlyAttributes&&e.showNonDBAttributesAsWell&&e.addValueInAuthoringColumn},_realInit:function(){var e=this,t=s.isWebInWinContext()?"-immersivePanelWebInWin":"-immersivePanel";e.elements.container=o.createElement("div",{class:e.getClassNames(t)}),e.instanceMgt=e.options.baseInstanceTypes&&e.options.baseInstanceTypes.length>0,e._buildBody().then(e._buildFooter.bind(e)).done(function(){e.switchView(T.activeStep),e.options.subscribeTokens.push(e.options.modelEvents.subscribe({event:"IPClassifyColumnCusto/WizardSteps/stepChanged"},function(t){var o=t.stepId;e.switchView(o)})),e.options.modelEvents.publish({event:"IPClassifyColumnCusto/Views/showInWidgetBody",data:{html:e.elements.container}}),A.getDimensions()})},destroy:function(){for(var e=0;e<this.options.subscribeTokens.length;e++)this.options.modelEvents.unsubscribe(this.options.subscribeTokens[e]);this.options.toolbar.destroy();var t=this;Object.keys(t.options.grids).forEach(function(e){t.options.grids[e].destroy(),t.options.grids[e]=null}),this._parent()},_buildBody:function(){var e=this;return new i(function(t,n){e.elements.wizard=o.createElement("div",{class:e.getClassNames("-wizard")}).inject(e.elements.container),e.options.wizard=new a({modelEvents:e.options.modelEvents,renderTo:e.elements.wizard,steps:T});var i=o.createElement("div",{class:e.getClassNames("-toolbar-container")}).inject(e.elements.container);e.elements.content=o.createElement("div",{class:e.getClassNames("-content")}).inject(e.elements.container),e._generateToolbar({renderTo:i}),t()})},_buildFooter:function(){var e=this;return new i(function(n,i){e.elements.footer=o.createElement("div",{class:e.getClassNames("-footer")}).inject(e.elements.container);var s=e.elements.nextButton=new u({label:t.moreAttributesWizard.next,value:"next",emphasize:"primary",touchMode:!0});s.addEventListener("click",function(){if("typesView"===e.options.activeView)e.options.modelEvents.publish({event:"IPClassifyColumnCusto/WizardSteps/changeStep",data:{stepId:"extensionsView"}});else if("extensionsView"===e.options.activeView)e.options.modelEvents.publish({event:"IPClassifyColumnCusto/WizardSteps/changeStep",data:{stepId:"attributesView"}});else if("attributesView"===e.options.activeView){var t=e.options.models.attributesView.search({match:function(e){return!0===e.nodeModel.options.grid.attrSel||void 0===e.nodeModel.options.grid.attrSel}}).map(function(t){let o=t.dump(S);if(void 0===t.options.grid.attrSel){var n=e.options.selectedAttributes.filter(function(e){return e.name===o.dataIndex});1===n.length&&(o.attrDBName=n[0].attrDBName)}return o}),o=[].concat(e.options.selectedExtensions);e.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/selectedAttributes",data:{selectedAttributes:t,selectedTypes:e.options.selectedTypes,selectedExtensions:o}}),e.destroy()}}),s.inject(e.elements.footer);var a=e.elements.closeButton=new u({label:t.moreAttributesWizard.cancel,emphasize:"secondary",touchMode:!0});a.addEventListener("click",function(){e.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/closeWizard"}),e.destroy()}),a.inject(e.elements.footer),n()})},switchView:function(e){if(this.options.activeView!==e){if(this.elements.toolbarSearch.clear(),this.__setToolbarCmds(e),this.options.previousView=this.options.activeView,this.options.activeView=e,null===this.options.views[e]){(u=this.elements.content.getElement("div.ip-more-attr-chooser-view"))&&this.elements.content.removeChild(u),o.is(this.elements.loader)||(this.elements.loaderDiv=o.createElement("div",{class:this.getClassNames("-loader")}).inject(this.elements.content),this.elements.loader=(new p).inject(this.elements.loaderDiv),this.elements.loader.getContent().addClassName("enx-loader")),this.elements.loaderDiv.removeClassName("hidden"),this.elements.nextButton.disabled=!0,this.options.wizard.getContent().addClassName("disabled"),this.elements.loader.on();var n=this,s=[],a=null,l=0,r=T.steps.length;do{T.steps[l].id===e&&(a=T.steps[l]),l++}while(l<r||null===a);var d=!1;if(a.prerequisiteViews)for(var c=0;c<a.prerequisiteViews.length;c++)null===this.options.views[a.prerequisiteViews[c]]&&(s.push(this["_build"+a.prerequisiteViews[c]](!0)),d=!0);i.all(s).then(function(){if(!0===d){var t=this.elements.content.getElement("div.ip-more-attr-chooser-view");t&&this.elements.content.removeChild(t)}this["_build"+e]().then(function(e){n.elements.loaderDiv.addClassName("hidden"),n.elements.loader.off(),n.elements.nextButton.disabled=!1,n.options.wizard.getContent().removeClassName("disabled"),n.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:n.options.activeView}})})}.bind(this))}else{var u;(u=this.elements.content.getElement("div.ip-more-attr-chooser-view"))&&this.elements.content.removeChild(u),this.options.views[e].inject(this.elements.content);n=this;!0===this.typesUpdated&&"extensionsView"===this.options.activeView?this.__updateExtensionsView().then(function(){delete n.typesUpdated,n.extensionsUpdated=!0,n.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:n.options.activeView}})}):!0!==this.typesUpdated&&!0!==this.extensionsUpdated||"attributesView"!==this.options.activeView?("attributesView"===this.options.activeView&&n.elements.classificationAttributesToggle&&n.elements.classificationAttributesToggle.show(),this.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:this.options.activeView}})):(n.elements.classificationAttributesToggle&&(n.elements.classificationAttributesToggle.show(),n.elements.classificationAttributesToggle.disabled=!0),this.__updateAttributesView().then(function(){delete n.typesUpdated,delete n.extensionsUpdated,n.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/viewReady",data:{activeView:n.options.activeView}})}))}"attributesView"===this.options.activeView?this.elements.nextButton.label=t.moreAttributesWizard.done:(this.elements.nextButton.label=t.moreAttributesWizard.next,n.elements.classificationAttributesToggle&&n.elements.classificationAttributesToggle.hide())}},_buildtypesView:function(){var e=this;return new i(function(n,i){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;e.options.wizard.getContent().addClassName("disabled"),e.options.views.typesView=o.createElement("div",{class:e.getClassNames("-typesView ip-more-attr-chooser-view")});var a=o.createElement("div",{class:e.getClassNames("-typesViewDgv ip-more-attr-dgv-container")}).inject(e.options.views.typesView),l=o.extend({identifier:"MoreAttrWizard-"+s.uid()},o.clone(e.options.dgvOptions));!0!==e.instanceMgt&&l.columns.splice(1,1),l.layout=new b(e.options.dgvLayoutOptions);var r=e.options.grids.typesView=new h(l);!0===e.instanceMgt&&e._declareInstRefTypeReps(r),r.onContextualEvent=function(){return[]},r.getCellTooltip=function(o){var n=e.options.grids.typesView.getColumnOrGroup(o.columnID).dataIndex;if(o.dataIndex=n,-1===o.rowID)return{shortHelp:t.moreAttributesWizard[n],updateModel:!1}}.bind(this),r.mandatorySelected=e.options.defaultTypes,e.options.models.typesView=new m({}),r.treeDocument=e.options.models.typesView,r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(a),e.options.views.typesView.inject(e.elements.content),r.onReady(function(){e.__updateTypesViewModel().finally(function(){r.getContent().removeClassName("loading"),n()}),r.addEventListener("change",e._changeType.bind(e))})})},_changeType:function(e,t){var o=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===o.layout.getDataIndexFromColumnIndex(t.columnID)){var n=t.nodeModel.getReferenceValue("attrName"),i=this.options.selectedTypes.indexOf(n);!0===t.nodeModel.options.grid.attrSel?-1===i&&this.options.selectedTypes.push(n):-1!==i&&this.options.selectedTypes.splice(i,1),this.typesUpdated=!0}},_buildextensionsView:function(){var e=this;return new i(function(n,i){e.elements.nextButton.label=t.moreAttributesWizard.next,e.elements.nextButton.disabled=!0;e.options.wizard.getContent().addClassName("disabled"),e.options.views.extensionsView=o.createElement("div",{class:e.getClassNames("-extensionsView ip-more-attr-chooser-view")});var a=o.createElement("div",{class:e.getClassNames("-extensionsView-Dgv ip-more-attr-dgv-container")}).inject(e.options.views.extensionsView),l=o.extend({identifier:"MoreAttrWizard-"+s.uid()},o.clone(e.options.dgvOptions));!0!==e.instanceMgt&&(l.columns.splice(1,1),!0!==e.options.dgv&&l.columns.push({icon:{iconName:"where-used",fontIconFamily:1},dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),l.layout=new b(e.options.dgvLayoutOptions);var r=e.options.grids.extensionsView=new h(l);if(!0===e.instanceMgt)e._declareInstRefTypeReps(r);else if(!0!==e.options.dgv){var d={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};r.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(d))}r.onContextualEvent=function(){return[]},r.getCellTooltip=function(o){var n=e.options.grids.extensionsView.getColumnOrGroup(o.columnID).dataIndex;return o.dataIndex=n,-1===o.rowID?{shortHelp:t.moreAttributesWizard[n],updateModel:!1}:!0===e.instanceMgt&&o.nodeModel?{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:o.nodeModel.getReferenceValue("attrInTypeNLS").join("\n")}),updateModel:!1}:void 0}.bind(this),r.mandatorySelected=e.options.defaultExtensions,e.options.models.extensionsView=new m({}),r.treeDocument=e.options.models.extensionsView,r.getContent().addClassName("enxdatagridview loading"),r.getContent().inject(a),e.options.views.extensionsView.inject(e.elements.content),r.onReady(function(){e.__updateExtensionsViewModel(!0).finally(function(){r.getContent().removeClassName("loading"),n({})}),r.addEventListener("change",e._changeExtension.bind(e))})})},_changeExtension:function(e,t){var o=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===o.layout.getDataIndexFromColumnIndex(t.columnID)){var n=t.nodeModel.getReferenceValue("attrName"),i=this.options.selectedExtensions.indexOf(n);!0===t.nodeModel.options.grid.attrSel?-1===i&&this.options.selectedExtensions.push(n):-1!==i&&this.options.selectedExtensions.splice(i),this.extensionsUpdated=!0}},_buildattributesView:function(){var e=this;return e.elements.classificationAttributesToggle&&(e.elements.classificationAttributesToggle.show(),e.elements.classificationAttributesToggle.disabled=!0),new i(function(n){e.elements.nextButton.label=t.moreAttributesWizard.done,e.elements.nextButton.disabled=!0;e.options.wizard.getContent().addClassName("disabled"),e.options.views.attributesView=o.createElement("div",{class:e.getClassNames("-attributesView ip-more-attr-chooser-view")});var i=o.createElement("div",{class:e.getClassNames("-attributesView-Dgv ip-more-attr-dgv-container")}).inject(e.options.views.attributesView),a=o.extend({identifier:"MoreAttrWizard-"+s.uid()},o.clone(e.options.dgvOptions));e.instanceMgt||(a.columns.splice(1,1),!0!==e.options.dgv&&a.columns.push({text:t.moreAttributesWizard.declaredIn,dataIndex:"declaredIn",typeRepresentation:"declaredInRepresentation",editableFlag:!1,width:75,sortableFlag:!1,resizableFlag:!1})),e._addValueShownInAuthoringModeColumn&&a.columns.push({text:t.moreAttributesWizard.valueInAuthoring,dataIndex:"valueInAuthoring",editableFlag:!1,typeRepresentation:"boolean"}),a.layout=new b(e.options.dgvLayoutOptions);var l=e.options.grids.attributesView=new h(a);if(!e.instanceMgt&&!0!==e.options.dgv){var r={declaredInRepresentation:{stdTemplate:"functionMenuIcon",semantics:{icon:{iconName:"where-used",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};l.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(r))}l.onContextualEvent=function(){return[]},l.getCellTooltip=function(o){var n=e.options.grids.attributesView.getColumnOrGroup(o.columnID).dataIndex;if(o.dataIndex=n,-1===o.rowID)return{shortHelp:t.moreAttributesWizard[n],updateModel:!1};if(o.nodeModel){var i=o.nodeModel.getReferenceValue("attrInTypeNLS");if(i)return{shortHelp:t.replace(t.moreAttributesWizard.declaredInWithTypes,{types:i.join("\n")}),updateModel:!1}}}.bind(this),e.options.defaultAttributes.length<=0&&(e.options.defaultAttributes=["ds6w:label","ds6w:type","ds6w:modified"]),l.mandatorySelectedWithParent={Reference:e.options.defaultAttributes},l.mandatorySelected=e.options.defaultAttributes,e.options.models.attributesView=new m({}),l.treeDocument=e.options.models.attributesView,l.getContent().addClassName("enxdatagridview loading"),l.getContent().inject(i),e.options.views.attributesView.inject(e.elements.content),l.onReady(function(){e.__updateAttributesViewModel().then(function(){l.getContent().removeClassName("loading"),e.elements.classificationAttributesToggle&&(e.elements.classificationAttributesToggle.disabled=!1),n()}),l.addEventListener("change",e._changeAttributes.bind(e))})})},_changeAttributes:function(e,t){var o=this.options.grids[this.options.activeView];if(t&&t.nodeModel&&t.nodeModel.options.grid&&"attrSel"===o.layout.getDataIndexFromColumnIndex(t.columnID)){for(var n=-1,i=0,s=this.options.selectedAttributes.length;-1===n&&i<s;)this.options.selectedAttributes[i].name===t.nodeModel.getReferenceValue("attrName")&&this.options.selectedAttributes[i].instRef===t.nodeModel.getReferenceValue("attrParent")&&(n=i),i++;!0===t.nodeModel.options.grid.attrSel?-1===n&&this.options.selectedAttributes.push({name:t.nodeModel.getReferenceValue("attrName"),instRef:t.nodeModel.getReferenceValue("attrParent")}):-1!==n&&this.options.selectedAttributes.splice(n)}},_generateToolbar:function(e){var n=this,i=g.debounce(function(e){n.options.models[n.options.activeView]&&(n.options.models[n.options.activeView].withTransactionUpdate(function(){var t=e.searchStr,o=!0;n.options.filterInProgress=!0,n.options.models[n.options.activeView].search({match:function(e){!function(e,t){var o=!1,n=new RegExp(e,"i");return(n.test(t.nodeModel.options.grid.attrTitle)||n.test(t.nodeModel.getLabel()))&&(o=!0),o}(t,e)?(e.nodeModel.unmatchSearch(),e.nodeModel.unselect(),e.nodeModel.hide()):(e.nodeModel.show(),t.length>0&&o?(e.nodeModel.select(!0),e.nodeModel.matchSearch(),o=!1):(e.nodeModel.unmatchSearch(),e.nodeModel.unselect()))}}),n.options.filterInProgress=!1}),n.options.models[n.options.activeView].getXSO().onPostAdd(function(){}),n.options.models[n.options.activeView].getXSO().onPostRemove(function(){}))},500);this.elements.toolbar=o.createElement("div",{class:this.getClassNames("-toolbar")}).inject(e.renderTo);var s=o.createElement("div",{class:this.getClassNames("-toolbar-input")}).inject(this.elements.toolbar);this.elements.toolbarIconbar=o.createElement("div",{class:this.getClassNames("-toolbar-iconbar")}).inject(this.elements.toolbar);this.elements.toolbarIconbarIcons=o.createElement("div",{class:this.getClassNames("-toolbar-iconbar-icons")}).inject(this.elements.toolbarIconbar),this.elements.toolbarSearch=new r({events:{onSearch:i}}).inject(s),this.options.classificationAttributes&&M.get("classificationCheckBox",function(e){let i=!1;e&&e.value&&(i=e.value),n.elements.classificationAttributesToggle=new x({label:t.moreAttributesWizard.classificationAttrCheckBox,checkFlag:i});var s=o.createElement("div",{class:n.getClassNames("-classificationCheckBox"),content:n.elements.classificationAttributesToggle});n.elements.classificationAttributesToggle.addEventListener("change",function(e){let t=e.dsModel;M.set("classificationCheckBox",{value:t.checkFlag}),n.elements.classificationAttributesToggle.disabled=!0,n.__updateAttributesView()}),n.elements.classificationAttributesToggle.hide(),s.inject(n.elements.toolbarIconbar)})},__setToolbarCmds:function(e){var o,n=this,i="none",s="none",a=function(){n.options.models[n.options.activeView].withTransactionUpdate(function(){for(var e=n.options.models[n.options.activeView].getRoots(),t=i+"-"+s,o=0;o<e.length;o++)switch(t){case"none-none":e[o].show();break;case"selected-none":!0===e[o].getReferenceValue("attrSel")||void 0===e[o].getReferenceValue("attrSel")?e[o].show():e[o].hide();break;case"unselected-none":!1===e[o].getReferenceValue("attrSel")?e[o].show():e[o].hide();break;case"none-reference":"Instance"!==e[o].getReferenceValue("attrParent")?e[o].show():e[o].hide();break;case"none-instance":"Reference"!==e[o].getReferenceValue("attrParent")?e[o].show():e[o].hide();break;case"selected-reference":!0===e[o].getReferenceValue("attrSel")&&"Instance"!==e[o].getReferenceValue("attrParent")?e[o].show():e[o].hide();break;case"selected-instance":!0===e[o].getReferenceValue("attrSel")&&"Reference"!==e[o].getReferenceValue("attrParent")?e[o].show():e[o].hide();break;case"unselected-reference":!1===e[o].getReferenceValue("attrSel")&&"Instance"!==e[o].getReferenceValue("attrParent")?e[o].show():e[o].hide();break;case"unselected-instance":!1===e[o].getReferenceValue("attrSel")&&"Reference"!==e[o].getReferenceValue("attrParent")?e[o].show():e[o].hide()}}),n.options.models[n.options.activeView].getXSO().onPostAdd(function(){}),n.options.models[n.options.activeView].getXSO().onPostRemove(function(){})},l={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableTypes}),name:"reload",handler:function(e,t){n.elements.loader.on(),n.elements.loaderDiv.removeClassName("hidden"),n.options.grids.typesView.getContent().addClassName("loading"),n.elements.nextButton.disabled=!0,n.options.wizard.getContent().addClassName("disabled"),n.options.models.typesView.removeRoots(),n.__updateTypesViewModel(!0).finally(function(){n.elements.loader.off(),n.options.grids.typesView.getContent().removeClassName("loading"),n.elements.nextButton.disabled=!1,n.options.wizard.getContent().removeClassName("disabled")})}},r={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableExtensions}),name:"reload",handler:function(e,t){n.__updateExtensionsView()}},c={fonticon:"reload",text:t.replace(t.moreAttributesWizard.reload,{what:t.moreAttributesWizard.availableAttributes}),name:"reload",handler:function(e,t){n.__updateAttributesView()}},u={fonticon:"list-filter",text:t.moreAttributesWizard.filterRowsKind,name:"filter-kind",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"product",text:t.moreAttributesWizard.filterreference,name:"reference",selectable:!0},{fonticon:"flow-cascade",text:t.moreAttributesWizard.filterinstance,name:"instance",selectable:!0}],events:{onClick:function(e,t){var o;o=t.name,s=o,a()}}}}},p={fonticon:"filter",text:t.moreAttributesWizard.filterRows,name:"filter",content:{type:"dropdownmenu",options:{items:[{fonticon:"block",text:t.moreAttributesWizard.none,name:"none",selectable:!0,selected:!0},{fonticon:"checkbox-on",text:t.moreAttributesWizard.selected,name:"selected",selectable:!0},{fonticon:"checkbox-off",text:t.moreAttributesWizard.unselected,name:"unselected",selectable:!0}],events:{onClick:function(e,t){var o;o=t.name,i=o,a()}}}}},m={className:"divider"};if(!this.options.toolbar||this.options.toolbar.currentView!==e){if(!0===this.instanceMgt)switch(e){case"typesView":o=[l,m,u,p];break;case"extensionsView":o=[r,m,u,p];break;case"attributesView":o=[c,m,u,p]}else o=[m,p];var f={renderTo:this.elements.toolbarIconbarIcons,items:o};this.options.toolbar&&(this.options.toolbar.destroy(),this.options.toolbar=null),this.options.toolbar=new d(f),this.options.toolbar.elements.container.setStyle("display",void 0)}},_declareInstRefTypeReps:function(e){var t={Reference:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"product",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Instance:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"flow-cascade",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Both:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-replace",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Extension:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"part-add",fontIconFamily:WUXManagedFontIcons.Font3DS}}},Unknown:{stdTemplate:"functionIcon",semantics:{icon:{iconName:"i-question",fontIconFamily:WUXManagedFontIcons.Font3DS}}}};e.getTypeRepresentationFactory().registerTypeRepresentations(JSON.stringify(t))},_checkSelected:function(e,t,o){var n=this,i=this.options.selectedAttributes.filter(function(o){return o.name===e&&(o.instRef===t||-1!==n.options.defaultAttributes.indexOf(o.name))});i.length>1&&console.warn("Several attributes found "+JSON.stringify(i));var s=!1;return 1===i.length&&(s=!0,o&&i[0].attrDBName&&!C.arrayEquals(i[0].attrDBName,o)&&(s=void 0)),s},getAllTypes:function(){var e=this,t=e.options.fetchTypesFromDictionary;return void 0===t||t?c.getAllTypes():new i(function(t,o){function n(e,t){var o=e.name,n=t.name;return o.localeCompare(n)}w.fetchTypesInfo({onComplete:function(o){var i=JSON.parse(o),s=[];Object.keys(i).forEach(function(e){s.push({type:e,name:i[e].displayName})}),s.sort(n),e.options.nlsTypesInfo=i,t({res:i,types:function(e){for(var t=[],o=0,n=e.length;o<n;++o)t.push(e[o].type);return t}(s)})},onFailure:function(e,t,n){console.log("ERROR:: web service call to fetch types has failed!!"),o()}})})},getNLSForTypes:function(e){var t=this.options.fetchTypesFromDictionary;if(void 0===t||t)return c.getNLSForTypes(e);var o=e.replace("ds6wg:","");return this.options.nlsTypesInfo[o]?this.options.nlsTypesInfo[o].displayName:o},__updateTypesViewModel:function(e){var o=this;return new i(function(n){var i=function(e,t){t||(t=Object.getOwnPropertyNames(e)),o.options.models.typesView.withTransactionUpdate(function(){for(var n=0;n<t.length;n++){var i=t[n],s=e[i],a=-1!==o.options.selectedTypes.indexOf(i),l=s.parent?s.parent:i,r=-1!==o.options.baseTypes.indexOf(l)?"Reference":-1!==o.options.baseInstanceTypes.indexOf(l)?"Instance":"Unknown",d=new f({label:s.displayName,grid:{attrName:i,attrTitle:s.displayName,attrSel:a,attrParent:r},icons:[s.iconUrl]});o.options.models.typesView.addRoot(d,a?0:void 0),"Reference"===r&&-1===o.options.maps.referenceTypes.indexOf(i)&&o.options.maps.referenceTypes.push(i),"Instance"===r&&-1===o.options.maps.instanceTypes.indexOf(i)&&o.options.maps.instanceTypes.push(i)}}),n({})};if(0==o.options.baseTypes.length)o.getAllTypes().then(function(e){o.options.baseTypes=e.types,i(e.res,e.types)},function(){o.options.modelEvents.publish({event:"IPClassifyColumnCusto/MoreAttributesWizard/closeWizard"}),o.destroy(),y.displayNotification({message:t.msg_error_timeout,className:"error"})});else{var s=o.options.baseInstanceTypes.length?o.options.baseTypes.concat(o.options.baseInstanceTypes):o.options.baseTypes;c.getTypesInfo({baseTypes:s},e).then(i)}})},__updateExtensionsView:function(){var e=this;return new i(function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.extensionsView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.extensionsView.removeRoots(),e.__updateExtensionsViewModel(!0).finally(function(){e.elements.loader.off(),e.options.grids.extensionsView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),t()})})},__updateExtensionsViewModel:function(e){var t=this;return new i(function(o){c.interfaces({classes:t.options.selectedTypes},e).then(function(e){for(var n=Object.getOwnPropertyNames(e.extensions),i=0;i<n.length;i++){for(var s=n[i],a=e.extensions[s],l=-1!==t.options.selectedExtensions.indexOf(s),r={menu:[]},d="",c=!1,u=!1,p=[],m=0;m<a.declareIn.length;m++)-1!==t.options.baseTypes.indexOf(a.declareIn[m])?c=!0:-1!==t.options.baseInstanceTypes.indexOf(a.declareIn[m])&&(u=!0),t.instanceMgt||r.menu.push({type:"PushItem",title:t.getNLSForTypes(a.declareIn[m])}),-1===p.indexOf(a.declareIn[m])&&p.push(t.getNLSForTypes(a.declareIn[m]));d=!0===c&&!0===u?"Both":!0===c?"Reference":!0===u?"Instance":"Unknown";var h=new f({label:a.nlsName,grid:{attrName:a.name,attrTitle:a.nlsName,attrSel:l,declaredIn:r,attrInType:a.declareIn,attrInTypeNLS:p,attrParent:d}});t.options.models.extensionsView.addRoot(h,l?0:void 0)}var b=Object.getOwnPropertyNames(e.automaticExtensions);for(i=0;i<b.length;i++)t.options.automaticExtensions.push(b[i]);o({})})})},__updateAttributesView:function(){var e=this;return new i(function(t){e.elements.loader.on(),e.elements.loaderDiv.removeClassName("hidden"),e.options.grids.attributesView.getContent().addClassName("loading"),e.elements.nextButton.disabled=!0,e.options.wizard.getContent().addClassName("disabled"),e.options.models.attributesView.removeRoots(),e.__updateAttributesViewModel(!0).finally(function(){e.elements.loader.off(),e.options.grids.attributesView.getContent().removeClassName("loading"),e.elements.nextButton.disabled=!1,e.options.wizard.getContent().removeClassName("disabled"),e.elements.classificationAttributesToggle&&(e.elements.classificationAttributesToggle.disabled=!1),t()})})},getPropertiesForClass:function(e,t,n,s){var a=this;return new i(function(l,r){var d=[v.getPropertiesForClass(e)];if(!0===s){var c=I.classificationAttributesPromise({apiVersion:"R2019x"});d.push(c)}i.all(d).then(function(r){var d=r[0];if(!0===s){let e=r[1];e&&e.length>0&&(d=d.concat(e))}for(var c={},u=0;u<d.length;u++)for(var p=d[u],m=0;m<p.properties.length;m++){var f=p.properties[m];if("attribute"==f.nature)f.dbAttrName=["attribute["+f.selectable+"]"];else if("basic"==f.nature)f.dbAttrName=[f.selectable];else if(n)f.dbAttrName=[];else if(a.options.supportedIndexAttrs.indexOf(f.curi)>=0)f.dbAttrName=[f.curi];else if(t)continue;if(void 0===c[f.curi])c[f.curi]=f,c[f.curi].inTypes=[p.classInfo.curi];else{c[f.curi].inTypes.push(p.classInfo.curi);var h=f.dbAttrName;for(var b in h){var g=h[b];-1===c[f.curi].dbAttrName.indexOf(g)&&c[f.curi].dbAttrName.push(g)}}}var C=[];if((void 0===e.queryTypeNLS||!0===e.queryTypeNLS)&&void 0===c["ds6w:type"]){c["ds6w:type"]={curi:"ds6w:type",label:"ds6w:type",dataType:"string"};var y=new i(function(e){v.getResourcesInfo(["ds6w:type"]).then(function(t){o.is(t,"array")&&1===t.length&&(c["ds6w:type"]=o.merge(t[0],c["ds6w:type"])),e()})});C.push(y)}i.all(C).then(function(){l({availaibleAttributes:c})})})})},__updateAttributesViewModel:function(e){var n=this;return new i(function(e){for(var i=o.clone(n.options.selectedTypes.concat(n.options.automaticExtensions).concat(n.options.selectedExtensions)),s=0;s<i.length;s++)i[s]="ds6wg:"+i[s];var a=i.join("\n");let l=!1;n.elements.classificationAttributesToggle&&!0===n.elements.classificationAttributesToggle.checkFlag&&(l=!0),n.getPropertiesForClass({classURIs:a,types:o.clone(n.options.selectedTypes),interfaces:o.clone(n.options.automaticExtensions.concat(n.options.selectedExtensions))},n.options.dbOnlyAttributes,n.options.showNonDBAttributesAsWell,l).then(function(o){for(var s=Object.getOwnPropertyNames(o.availaibleAttributes),a=[],l=[],r=0;r<s.length;r++){var d=s[r],c=o.availaibleAttributes[d],u=D[d]?D[d]:d;if(-1===N.indexOf(u)){var p={menu:[]},m="",h=!1,b=!1,g=!1,v=[],C=[],y=[],w=[],I=c.dbAttrName;"ds6w:cadMaster"===u&&(I=["attribute[XCADAssembly.V_CADOrigin]","attribute[XCADExtension.V_CADOrigin]","attribute[XCADAssembly.V_CADFileOrigin]","attribute[XCADRepExtension.V_CADFileOrigin]"]);var x=!1;if(n._addValueShownInAuthoringModeColumn&&(x=I&&I.length>0||n.options.preMappedAttriForAuthoring&&!0===n.options.preMappedAttriForAuthoring[d]),c.inTypes)for(var M=0;M<c.inTypes.length;M++){var T=c.inTypes[M].substring(c.inTypes[M].indexOf(":")+1,c.inTypes[M].length);if(-1!==n.options.baseTypes.indexOf(T))h=!0;else if(-1!==n.options.baseInstanceTypes.indexOf(T))b=!0;else if(-1!==n.options.selectedExtensions.indexOf(T)||-1!==n.options.automaticExtensions.indexOf(T)){g=!0;var S=n.options.models.extensionsView.search({match:function(e){return e.nodeModel.getReferenceValue("attrName")===T}});if(S.length){var V=S[0].getReferenceValue("attrParent");"Reference"===V?h=!0:"Instance"===V?b=!0:"Both"===V&&(h=!0,b=!0)}}n.instanceMgt||-1===i.indexOf(c.inTypes[M])||p.menu.push({type:"PushItem",title:n.getNLSForTypes(c.inTypes[M])}),-1===n.options.maps.referenceTypes.indexOf(T)&&!h||-1!==v.indexOf(T)||(v.push(T),C.push(n.getNLSForTypes(c.inTypes[M])),h=!0),-1===n.options.maps.instanceTypes.indexOf(T)&&!b||-1!==y.indexOf(T)||(y.push(T),w.push(n.getNLSForTypes(c.inTypes[M])),b=!0)}if("Instance"===(m=!0===h&&!0===b?"Both":!0===h?"Reference":!0===b?"Instance":!0===g?"Extension":"Unknown")&&(u+="-Instance"),-1===l.indexOf(u)){var _={};if("real"==c.dataType.substring(c.dataType.indexOf("#")+1)&&c.dimension&&c.dimension.length>0){_.dimension=c.dimension,c.manipulationUnit&&(_.manipulationUnit=c.manipulationUnit);let e=A.getUnitAndNLS(c.dimension,c.manipulationUnit);e&&(e.unit&&(_.unit=e.unit),e.nls&&(_.nls=e.nls),e.manipulationNls&&(_.manipulationNls=e.manipulationNls))}if("Both"===m){a.push(u);var R=u+"-Instance",E=n._checkSelected(R,"Instance",I),z={attrName:R,attrDBName:I,valueInAuthoring:x,attrTitle:c.label,attrDesc:c.description,attrKind:c.dataType.substring(c.dataType.indexOf("#")+1),attrInType:y,attrInTypeNLS:w,declaredIn:p,attrSel:E,attrParent:"Instance"};_.dimension&&(z.convertInfos=_,z.attrKind=void 0,z.typeRepresentation="string");var P=new f({label:c.label,grid:z});n.options.models.attributesView.addRoot(P,E?0:void 0),l.push(R);var F=n._checkSelected(u,"Reference",I),k={attrName:u,attrDBName:I,valueInAuthoring:x,attrTitle:c.label,attrDesc:c.description,attrKind:c.dataType.substring(c.dataType.indexOf("#")+1),attrInType:v,attrInTypeNLS:C,declaredIn:p,attrSel:F,attrParent:"Reference"};_.dimension&&(k.convertInfos=_,k.attrKind=void 0,k.typeRepresentation="string");var O=new f({label:c.label,grid:k});n.options.models.attributesView.addRoot(O,F?0:void 0),l.push(u)}else{var W,U;if("Reference"===m)W=v,U=C;else if("Instance"===m)W=y,U=w;else if("Unknown"===m&&c.inTypes&&c.inTypes.length>0&&"ds6wg:ClassificationAttributes"===c.inTypes[0]){let e=[t.moreAttributesWizard.classificationAttrTooltip];W=e,U=e}var B=n._checkSelected(u,m,I),L={attrName:u,attrDBName:I,valueInAuthoring:x,attrTitle:c.label,attrDesc:c.description,attrKind:c.dataType.substring(c.dataType.indexOf("#")+1),attrInType:W,attrInTypeNLS:U,declaredIn:p,attrSel:B,attrParent:m};_.dimension&&(L.convertInfos=_,L.attrKind=void 0,L.typeRepresentation="string");var j=new f({label:c.label,grid:L});n.options.models.attributesView.addRoot(j,B?0:void 0),l.push(u)}}}}if(!0===n.instanceMgt){u="positionMatrix-Instance",B=n._checkSelected(u,"Instance"),j=new f({label:t.attributesCustomization.instanceMatrix,grid:{attrName:u,attrTitle:t.attributesCustomization.instanceMatrix,attrDesc:"",attrKind:"string",attrInType:["VPMInstance"],attrInTypeNLS:[n.getNLSForTypes("VPMInstance")],attrSel:B,attrParent:"Instance"}});n.options.models.attributesView.addRoot(j,B?0:void 0),l.push(u)}e({})})})}})});