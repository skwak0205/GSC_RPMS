define("DS/MMPrint/MMPrintCmd",["DS/Windows/Dialog","DS/Windows/ImmersiveFrame","DS/Controls/Button","DS/ApplicationFrame/Command","i18n!DS/MMPrint/assets/nls/MMPrint","DS/Visualization/ThreeJS_DS"],function(e,t,n,i,r,a){"use strict";function o(e){try{!1===e.contentWindow.document.execCommand("print",!1,null)&&e.contentWindow.print()}catch(t){e.contentWindow.print()}}return i.extend({init:function(e){this._parent(e,{isAsynchronous:!1,mode:"exclusive"})},beginExecute:function(){var t=this.getFrameWindow(),i=t.experience,d=t.getImmersiveFrame();if(t&&i){var s=i.args.input.asset;if("svg"===s.type||"Drawing"===s.type){var c=document.createElement("iframe");document.body.appendChild(c);var l=i.getSource(),m=i.getCurrentSheetIndex(),u=l;if(1===i.getNumberOfSheets()){var g=l.search("<svg");u=l.substring(g,u.length)}else u=function(e,t){var n=t.indexOf("<svg",t.search("<svg")+4),i=t.lastIndexOf("</svg>"),r=t.substring(n,i),a=r.split("<svg");return r="<svg"+a[e+1]}(m,l);c.contentDocument.write(u),c.contentDocument.documentElement.getElementsByTagName("body")[0].style.margin="0",c.position="fixed",c.top="0",c.left="100%",c.width="100%",c.height="100%",o(c),document.body.removeChild(c),c=null}else if("udl"===s.type){var h={GenerateCanvasSheet:function(e,t,n,i){e.currentViewpoint.reframe();var r,o,d,s,c=window.devicePixelRatio||1;r=e.currentViewpoint,o=e.SCREEN_HEIGHT*c/(r.camera.top-r.camera.bottom),d=i/o,s=r.getTargetDistance()/d,r.setTargetDistance(s);var l,m,u=n.width,g=n.height,h=new a.Vector3(e.SCREEN_WIDTH*c/i,0,0),v=new a.Vector3(0,e.SCREEN_HEIGHT*c/i,0),w=((m=new a.Vector3(0,n.height,0)).add(new a.Vector3(e.SCREEN_WIDTH*c/(2*i),-e.SCREEN_HEIGHT*c/(2*i),0)),m),p=0,E=0,f=0,S=0,D=0;t.set({height:g*i,width:u*i});for(var C=t.getContext("2d"),y=C.getImageData(0,0,t.width,t.height);E<=g;){for(p=0,S=0,l=w.clone();p<=u;){e.currentViewpoint.setEyePosition(l);var T,b,x={data:null,width:Math.floor(e.SCREEN_WIDTH*c),height:Math.floor(e.SCREEN_HEIGHT*c)};e.renderToTarget(x,e.currentViewpoint);for(var H=f*y.width*x.height*4,I=0;I<x.height;I++){b=H+I*y.width*4+S*x.width*4,T=(x.height-I-1)*x.width*4;for(var M=0;M<4*x.width;M+=4)x.width*S+M/4<=y.width&&(y.data[b+M]=x.data[T+M],y.data[b+M+1]=x.data[T+M+1],y.data[b+M+2]=x.data[T+M+2],y.data[b+M+3]=x.data[T+M+3])}x.data=null,x=null,l.add(h),p+=h.x,D=++S>D?S:D}w.sub(v),E+=v.y,f++}C.putImageData(y,0,0)}};c=document.createElement("iframe");document.body.appendChild(c);var v=t.getViewer(),w=UWA.createElement("canvas"),p=i.getCurrentSheet().id,E=i._UDLLoader.getSheetSize(p);v.setReferenceAxisSystem(!1),h.GenerateCanvasSheet(v,w,E,5.5),v.setReferenceAxisSystem(!0);var f=w.toDataURL("image/png"),S=UWA.createElement("img");S.src=f,c.contentDocument.write(S.outerHTML),c.contentDocument.documentElement.getElementsByTagName("body")[0].style.margin="0",c.position="fixed",c.top="0",c.left="100%",c.width="100%",c.height="100%",S.addEventListener("load",function(){o(c),document.body.removeChild(c),c=null,S=null},!0)}else{(C=document.createElement("div")).innerHTML="<p>"+r.printRealSizeError+"</p>",d.visibleFlag=!0;var D=new e({title:r.printErrorTitle,content:C,immersiveFrame:d,buttons:{Ok:new n({onClick:function(e){D.destroy(),d.visibleFlag=!1,d=null}})}})}}else{var C;(C=document.createElement("div")).innerHTML="<p>"+r.printRealSizeError+"</p>",d.visibleFlag=!0;D=new e({title:r.printErrorTitle,content:C,immersiveFrame:d,buttons:{Ok:new n({onClick:function(e){D.destroy(),d.visibleFlag=!1,d=null}})}})}}})});