define("DS/MPFMyCartSummary/MyCartSummaryFactory",["UWA/Core","UWA/Promise","DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFilters","DS/MPFCountryModel/CountryFactory","DS/MPFClickAndBuyComponent/ClickAndBuyComponent"],(t,r,e,a,s,i,o,c,n,h)=>{"use strict";class C{constructor(){this.options=null,this.connector=null,this.factories=null,this.carts=null,this.draftCart=null}static createMyCartSummary(t){return(new C).create(t)}create(r){return r||(r={}),this.options=t.merge(r,{service:e.CLICK_AND_BUY}),a.fetchPromise(this.options).then(this.getFactories.bind(this)).then(this.getCart.bind(this)).then(this.getOpenedCountries.bind(this)).then(this.createComponent.bind(this))}getFactories(t){return this.factories=s.getInstance(t),r.all([this.factories.getFactory(s.Types.CART),this.factories.getFactory(s.Types.TENANT),this.factories.getFactory(s.Types.COUNTRY)]).then(t=>{this.cartFactory=t[0],this.tenantFactory=t[1],this.countryFactory=t[2]})}getOpenedCountries(){return this.countries=this.countryFactory.createCollection(n.Types.SP_PUBLIC_OPENED_COUNTRIES),this.countries.fetchPromise()}getCart(){const t=this.getCartFormLocalStorage();if(t)return this.draftCart=t,this.draftCart;{const t={};return t[c.FILTER_BY_STATE]=c.STATE_DRAFT,this.carts=this.cartFactory.createCollection(i.Types.ME_V2),this.carts.fetchPromise(t).then(this.getOrCreateDraftCart.bind(this))}}getCartFormLocalStorage(){let t;const r=window.localStorage.getItem(o.LOCAL_STORAGE_KEY);if(r){const e=(t=this.cartFactory.createModel(i.Types.ME)).parse(JSON.parse(r));t.set(e)}return t}getOrCreateDraftCart(){let t;if(this.carts.isEmpty())this.draftCart=this.cartFactory.createModel(i.Types.ME);else{const r=this.carts.first();this.draftCart=this.cartFactory.createModel(i.Types.CART,{id:r.id}),t=this.draftCart.fetchPromise({expand:[o.Expands.CART_ITEMS]})}return t}createComponent(){return new h({service:this.options.service,cart:this.draftCart,displayCartOnly:!0,tenantFactory:this.tenantFactory,cartFactory:this.cartFactory,countries:this.countries})}}return C});