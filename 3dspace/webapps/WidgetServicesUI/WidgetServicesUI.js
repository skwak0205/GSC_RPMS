define("DS/WidgetServicesUI/tweakers/TweakerWUXButton",["DS/Controls/Button"],function(e){"use strict";return function(t){var{emphasize:n,label:i}=t;if(t.icon)var a=t.icon;var s=new e({emphasize:n,label:i,icon:a});if(t.className&&s.getContent().addClassName(t.className),t.id?s.domId=t.id:s.domId=`ENOPROP_BTN_${i}`,t.setAttribute)for(var r in t.setAttribute)s.getContent().setAttribute(r,t.setAttribute[r]);return t.clickCallback&&s.getContent().addEventListener("buttonclick",t.clickCallback),s}}),define("DS/WidgetServicesUI/helpers/Constants",[],function(){return{TYPES:{BOOLEAN:"boolean",STRING:"string",HTML:"html",DATE:"date",DATETIME:"datetime",PERSON:"person",NUMBER:"number",INTEGER:"integer",ENUM:"enum",DROPDOWN:"dropdown",OUTPUT:"ouputText",BUTTONWEB:"buttonweb",IMAGE:"image",MULTIPLE:"multiple",REPLACEMENT:"replacement",RELATION:"relation",BOOLEAN_WUX:"boolean_wux",STRING_WUX:"string_wux",NUMBER_WUX:"number_wux",INTEGER_WUX:"integer_wux",DATE_WUX:"date_wux",DATETIME_WUX:"datetime_wux",PERSON_WUX:"person_wux",ENUM_WUX:"enum_wux",MULTIPLE_WUX:"multiple_wux",REPLACEMENT_WUX:"replacement_wux",DUMMY_BOOKMARK:"DummyBookmark"},SPE_TYPES:{MVA:"mva",ENUM:"spe_enum",MULTISEL:"multisel",MVA_WUX:"mva_wux"}}}),define("DS/WidgetServicesUI/infra/TweakerBase",["UWA/Controls/Abstract","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","css!DS/WidgetServicesUI/WidgetServicesUI","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a){"use strict";return e.extend({type:null,value:null,multiple:null,underEdition:null,_tooltip:null,defaultOptions:{postBuild:!0},init:function(e){this._parent(e),this.value=null,this.underEdition=null,this._tooltip=null,this.data={},this.UIelements={},this.UIelements.lTooltip=[],this.type=this.type?this.type:e.tw_type,this._setValue(e.value),this.elements.container=UWA.createElement("div",{class:"tw_container "+this._getClassName(e)}),this.elements.elementsContainer=UWA.createElement("div",{class:"tw_elementsContainer"}).inject(this.elements.container),this._postInit(),this.__switchMode(!0===e.editable)},showSpinner:function(){this.elements.spinner||(this.elements.spinner=new n,this.elements.spinner.inject(this.elements.container)),this.elements.elementsContainer.hide(),this.elements.spinner.show()},hideSpinner:function(){this.elements.spinner&&this.elements.spinner.hide(),this.elements.elementsContainer.show()},setValue:function(e,t){var n=this._getValueOrDefault(e);this.areEquals(n,this.getValue())||(this._setValue(n),this.getElement()&&this._changeRW(n,t)),this.getROElement()&&this._changeRO(n)},setTooltip:function(e){this._tooltip=e,this._updateTooltip()},getROElement:function(){return this.elements.elementROUI},getContainerElement:function(){var e=this.getElement();return e.tw_parent&&(e=e.tw_parent),e},getElement:function(){return this.elements.elementUI},getHTMLElement:function(){var e=this.getElement();return(e=e||this.getROElement())&&e.elements&&(e=e.elements.container),e},switchMode:function(e){this.__switchMode(e)},focus:function(){var e=this.getHTMLElement();e&&e.focus&&e.focus()},getValue:function(){return this.data.value},getDisplayValues:function(e,t){var n=this,i=[],a=!1,s=void 0!==e?e:this.data.value;void 0!==s&&((a=Array.isArray(s))?s:[s]).forEach(function(e){i.push(n._computeValueForRO(e,t))});return a||(i=i.length>0?i[0]:""),i},getType:function(){return this.type},getDisplayValue:function(e,t){return this.__computeValueForRO(void 0!==e?e:this.data.value,t)},areEquals:function(e,t){return e===t},checkValue:function(e){return null},destroy:function(){this.UIelements.lTooltip.forEach(function(e){e.destroy()}),this.UIelements.lTooltip=[],this._parent()},_dispatchChange:function(e,t){this.setValue(e,t),this.__dispatchEvent("change",e),this.__dispatchAChange(e),!0===t&&this._dispatchValidation(e)},_dispatchLiveChange:function(e,t){this._setValue(e),this.__dispatchEvent("liveChange",e),this.__dispatchAChange(e),t&&13===t.keyCode&&this._dispatchValidation(e)},_dispatchValidation:function(e){this._setValue(e),this.__dispatchEvent("valid",e)},_dispatchNotification:function(e,t){this._dispatchNotificationObj({eventID:e,message:t})},_dispatchNotificationObj:function(e){this.dispatchEvent("notification",e)},_getMinValue:function(){var e=this.options.stepValue;e=e||0;var t=null;return this.options.minValue&&(t=this.options.minValue,!1===this.options.minValueIncluded&&(t+=e)),t},_getMaxValue:function(){var e=null;if(this.options.maxValue){var t=this.options.stepValue;if(t=t||0,e=this.options.maxValue,t){var n=this.__getNumberOfDecimal(t),i=Math.pow(10,n),a=this._getMinValue(),s=parseInt((e-a)*i)%parseInt(t*i);e=(parseInt(e*i)-s)/i}!1===this.options.maxValueIncluded&&(e-=t)}return e},_setError:function(e){console.log("error: "+e.message)},_postInit:function(){},_getValueOrDefault:function(e){return null==e?"":e},_changeRO:function(e){var t=this.elements.elementROUI.getElement(".tw_ROValue_content");if(t){if(this.options&&this.options.forClickable)var n=this.__computeValueForRO(e,{forClickable:!0});else n=this.__computeValueForRO(e);t.setHTML(n)}},_setElement:function(e){this.elements.elementUI=e},_setElementRO:function(e){this.elements.elementROUI=e},_computeValueForRO:function(e,t){return"string"==typeof e&&(t&&!1===t.escapeChar||(e=e.escapeHTML())),e},_buildRO:function(e,t){var n=e.value,i=this.__computeValueForRO(n,e),a=this._createROContainer(i);t.call(this,a)},_createROContainer:function(e){var t=new UWA.createElement("div",{class:"tw_ROValue"}),n={class:"tw_ROValue_content"},i="function"==typeof e.inject;i||(n.html=e);var a=new UWA.createElement("span",n);return i&&e.inject(a),this.options.icon&&UWA.createElement("img",{class:"editProp_iconAttribute",src:this.options.icon}).inject(t),a.inject(t),t},_changeRW:function(e,t){},_build:function(e,t){this.__switchMode(!1),t.call(this,null)},_setValue:function(e){e=this._getValueOrDefault(e);this.data.value=e,this._updateTooltip()},_updateTooltip:function(){var e=this;e.UIelements.lTooltip.forEach(function(t){var n=e.__getTooltip();e._setValueForTooltip(t,n)})},_setValueForTooltip:function(e,t){var n=e.getContent();""===t.textContent?n.addClassName("tw_hideTooltip"):n.removeClassName("tw_hideTooltip"),e.setBody(this.__getTooltip())},__computeValueForRO:function(e,t){var n=this;void 0===e&&(e=this.data.value);var i=Array.isArray(e)?e:null!=e&&""!==e?[e]:[],a=this.options.units;a=a||"";var s="",r="";return i.forEach(function(e){e=n._computeValueForRO(e,t),s+=r+n._addDimensionToValue(e,a),r=", "}),this.options.readOnly&&""===s&&!0===this.options.parameter&&(s="",null!=this.options.minValue&&(s+=this.options.minValue+a,s+=this.options.minValueIncluded?" ≤ ":" < "),s+="…",null!=this.options.maxValue&&(s+=this.options.maxValueIncluded?" ≤ ":" < ",s+=this.options.maxValue+a)),s},__getTooltip:function(e){var t=!1,n=this.options.units;n=n||"";var i=new UWA.createElement("span");if(!e){var s=this._tooltip?this._tooltip:this.__computeValueForRO();new UWA.createElement("span",{html:s}).inject(i)}var r=this._getMinValue();r&&(new UWA.createElement("br").inject(i),new UWA.createElement("span",{text:a.get("minval")+" : "+r+n}).inject(i),t=!0);var l=this._getMaxValue();l&&(new UWA.createElement("br").inject(i),new UWA.createElement("span",{text:a.get("maxval")+" : "+l+n}).inject(i),t=!0);return t||!e?i:null},postBuildUI:function(){this.elements.elementUI&&this._postBuildUI(this.elements.elementUI),this.elements.elementROUI&&this._postBuildUI(this.elements.elementROUI),this.options.postBuild=!0},_postBuildUI:function(e){if(!0!==this.options.nested){var n=this.__getTooltip();if(n){for(var i=e;"function"==typeof i.getContent;)i=i.getContent();var a=new t({position:"top left",delay:{show:400},target:i,trigger:"hover",body:""});this._setValueForTooltip(a,n),this.UIelements.lTooltip.push(a)}}},__getNumberOfDecimal:function(e){var t=e+"",n=0,i=t.indexOf(".");return i<0&&(i=t.indexOf(",")),i>=0&&(n=t.length-i-1),n},__switchMode:function(e){var t=this,n=e&&!t.options.readOnly;n!==this.underEdition&&(this.underEdition=n,this.elements.elementsContainer.empty(),this.options.value=this.getValue(),!0===n?this.getElement()?this.getContainerElement().inject(this.elements.elementsContainer):this._build(t.options,function(e){e&&t.elements.elementsContainer&&(t.getElement()||(!0===t.options.postBuild&&t._postBuildUI(e),t._setElement(e)),t.underEdition&&t.getContainerElement().inject(t.elements.elementsContainer))}):this.getROElement()?this.getROElement().inject(this.elements.elementsContainer):this._buildRO(t.options,function(e){e&&t.elements.elementsContainer&&(t.getROElement()||(!0===t.options.postBuild&&t._postBuildUI(e),t._setElementRO(e)),t.underEdition||t.getROElement().inject(t.elements.elementsContainer))}))},_addDimensionToValue:function(e,t){var n=e||!1===e?e+"":"";return t&&("function"==typeof e.endsWith&&e.endsWith(t)||(n=n+=" "+t)),n},__dispatchAChange:function(e){this.__dispatchEvent("changes",e)},__dispatchEvent:function(e,t){this.dispatchEvent(e,[t])},_getClassName:function(e){return e.className?e.className:""}})}),define("DS/WidgetServicesUI/infra/TweakerBaseWebUX",["UWA/Controls/Abstract","DS/UIKIT/Tooltip","DS/UIKIT/Spinner","DS/Controls/TooltipModel","DS/Controls/Label","css!DS/WidgetServicesUI/WidgetServicesUI","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a,s,r){"use strict";return e.extend({type:null,value:null,multiple:null,underEdition:null,_tooltip:null,defaultOptions:{postBuild:!0},init:function(e){this._parent(e),this.value=null,this.underEdition=null,this._tooltip=null,this.data={},this.UIelements={},this.UIelements.lTooltip=[],this.type=this.type?this.type:e.tw_type,this._setValue(e.value),this.elements.container=UWA.createElement("div",{class:"tw_container "+this._getClassName(e)}),this.elements.elementsContainer=UWA.createElement("div",{class:"tw_elementsContainer"}).inject(this.elements.container),this._postInit(),this.__switchMode(!0===e.editable)},showSpinner:function(){this.elements.spinner||(this.elements.spinner=new n,this.elements.spinner.inject(this.elements.container)),this.elements.elementsContainer.hide(),this.elements.spinner.show()},hideSpinner:function(){this.elements.spinner&&this.elements.spinner.hide(),this.elements.elementsContainer.show()},setValue:function(e,t){var n=this._getValueOrDefault(e);this.areEquals(n,this.getValue())||(this._setValue(n),this.getElement()&&this._changeRW(n,t)),this.getROElement()&&this._changeRO(n)},setTooltip:function(e){this._tooltip=e,this._updateTooltip()},getROElement:function(){return this.elements.elementROUI},getContainerElement:function(){var e=this.getElement();return e.tw_parent&&(e=e.tw_parent),e},getElement:function(){return this.elements.elementUI},getHTMLElement:function(){var e=this.getElement();return(e=e||this.getROElement())&&e.elements&&(e=e.elements.container),e},switchMode:function(e){this.__switchMode(e)},focus:function(){var e=this.getHTMLElement();e&&e.focus&&e.focus()},getValue:function(){return this.data.value},getDisplayValues:function(e,t){var n=this,i=[],a=!1,s=void 0!==e?e:this.data.value;void 0!==s&&((a=Array.isArray(s))?s:[s]).forEach(function(e){i.push(n._computeValueForRO(e,t))});return a||(i=i.length>0?i[0]:""),i},getType:function(){return this.type},getDisplayValue:function(e,t){return this.__computeValueForRO(void 0!==e?e:this.data.value,t)},areEquals:function(e,t){return e===t},checkValue:function(e){return null},destroy:function(){this.UIelements.lTooltip.forEach(function(e){e.destroy()}),this.UIelements.lTooltip=[],this._parent()},_dispatchChange:function(e,t){this.setValue(e,t),this.__dispatchEvent("change",e),this.__dispatchAChange(e),!0===t&&this._dispatchValidation(e)},_dispatchLiveChange:function(e,t){this._setValue(e),this.__dispatchEvent("liveChange",e),this.__dispatchAChange(e),t&&13===t.keyCode&&this._dispatchValidation(e)},_dispatchValidation:function(e){this._setValue(e),this.__dispatchEvent("valid",e)},_dispatchNotification:function(e,t){this._dispatchNotificationObj({eventID:e,message:t})},_dispatchNotificationObj:function(e){this.dispatchEvent("notification",e)},_getMinValue:function(){var e=this.options.stepValue;e=e||0;var t=null;return this.options.minValue&&(t=this.options.minValue,!1===this.options.minValueIncluded&&(t+=e)),t},_getMaxValue:function(){var e=null;if(this.options.maxValue){var t=this.options.stepValue;if(t=t||0,e=this.options.maxValue,t){var n=this.__getNumberOfDecimal(t),i=Math.pow(10,n),a=this._getMinValue(),s=parseInt((e-a)*i)%parseInt(t*i);e=(parseInt(e*i)-s)/i}!1===this.options.maxValueIncluded&&(e-=t)}return e},_setError:function(e){console.log("error: "+e.message)},_postInit:function(){},_getValueOrDefault:function(e){return null==e?"":e},_changeRO:function(e){var t=this.elements.elementROUI.getElement(".tw_ROValue_content");if(t){if(this.options&&this.options.forClickable)var n=this.__computeValueForRO(e,{forClickable:!0});else n=this.__computeValueForRO(e);t.setHTML(n)}},_setElement:function(e){this.elements.elementUI=e},_setElementRO:function(e){this.elements.elementROUI=e},_computeValueForRO:function(e,t){return"string"==typeof e&&(t&&!1===t.escapeChar||(e=e.escapeHTML())),e},_buildRO:function(e,t){var n=e.value,i=this.__computeValueForRO(n,e),a=this._createROContainer(i);t.call(this,a)},_createROContainer:function(e){var t=new UWA.createElement("div",{class:"tw_ROValue"}),n={class:"tw_ROValue_content"},i="function"==typeof e.inject;i||(n.html=e);var a=new UWA.createElement("span",n);return i&&e.inject(a),this.options.icon&&UWA.createElement("img",{class:"editProp_iconAttribute",src:this.options.icon}).inject(t),a.inject(t),t},_changeRW:function(e,t){},_build:function(e,t){this.__switchMode(!1),t.call(this,null)},_setValue:function(e){e=this._getValueOrDefault(e);this.data.value=e,this._updateTooltip()},_updateTooltip:function(){var e=this;e.UIelements.lTooltip.forEach(function(t){var n=e.__getTooltip();e._setValueForTooltip(t,n)})},_setValueForTooltip:function(e,t){t.textContent.length>0?e.tooltipInfos.shortHelp=t:e.tooltipInfos.shortHelp=""},__computeValueForRO:function(e,t,n){var i=this;void 0===e&&(e=this.data.value);var a=Array.isArray(e)?e:null!=e&&""!==e?[e]:[],s=this.options.units;s=s||"";var r="",l="";return a.forEach(function(e){e=i._computeValueForRO(e,t),r+=l+i._addDimensionToValue(e,s),l=" , "}),this.options.readOnly&&""===r&&!0===this.options.parameter&&(r="",null!=this.options.minValue&&(r+=this.options.minValue+s,r+=this.options.minValueIncluded?" ≤ ":" < "),r+="…",null!=this.options.maxValue&&(r+=this.options.maxValueIncluded?" ≤ ":" < ",r+=this.options.maxValue+s)),r},__getTooltip:function(e){var t=!1,n=this.options.units;n=n||"";var i=new UWA.createElement("span");if(!e){var a=this._tooltip?this._tooltip:this.__computeValueForRO();new UWA.createElement("span",{html:a}).inject(i)}var s=this._getMinValue();s&&(new UWA.createElement("br").inject(i),new UWA.createElement("span",{text:r.get("minval")+" : "+s+n}).inject(i),t=!0);var l=this._getMaxValue();l&&(new UWA.createElement("br").inject(i),new UWA.createElement("span",{text:r.get("maxval")+" : "+l+n}).inject(i),t=!0);return t||!e?i:null},postBuildUI:function(){this.elements.elementUI&&this._postBuildUI(this.elements.elementUI),this.elements.elementROUI&&this._postBuildUI(this.elements.elementROUI),this.options.postBuild=!0},_postBuildUI:function(e){if(!0!==this.options.nested){var t=this.__getTooltip();if(t){var n=e.container?e.container:e;"person_wux"===this.options.tw_type&&e.container&&e.container.searchInput&&(n=e.container.searchInput),n.tooltipInfos=new i({allowUnsafeHTMLShortHelp:!0,shortHelp:"",mouseRelativePosition:!0}),this._setValueForTooltip(n,t),this.UIelements.lTooltip.push(n)}}},__getNumberOfDecimal:function(e){var t=e+"",n=0,i=t.indexOf(".");return i<0&&(i=t.indexOf(",")),i>=0&&(n=t.length-i-1),n},__switchMode:function(e){var t=this,n=e&&!t.options.readOnly;n!==this.underEdition&&(this.underEdition=n,this.elements.elementsContainer.empty(),this.options.value=this.getValue(),!0===n?this.getElement()?this.getContainerElement().inject(this.elements.elementsContainer):this._build(t.options,function(e){e&&t.elements.elementsContainer&&(t.getElement()||(!0===t.options.postBuild&&t._postBuildUI(e),t._setElement(e)),t.underEdition&&t.getContainerElement().inject(t.elements.elementsContainer))}):this.getROElement()?this.getROElement().inject(this.elements.elementsContainer):this._buildRO(t.options,function(e){e&&t.elements.elementsContainer&&(t.getROElement()||(!0===t.options.postBuild&&t._postBuildUI(e),t._setElementRO(e)),t.underEdition||t.getROElement().inject(t.elements.elementsContainer))}))},_addDimensionToValue:function(e,t){var n=e||!1===e?e+"":"";return t&&("function"==typeof e.endsWith&&e.endsWith(t)||(n=n+=" "+t)),n},__dispatchAChange:function(e){this.__dispatchEvent("changes",e)},__dispatchEvent:function(e,t){this.dispatchEvent(e,[t])},_getClassName:function(e){return e.className?e.className:""},setClassNameForWebUXComponent:function(e,t){e.getContent().addClassName(t)},setIdForWebUXComponent:function(e,t){e.domId=t},setStyleForWuxComponent:function(e,t,n){UWA.is(e.getContent,"function")?e.getContent().setStyle(t,n):e.setStyle(t,n)}})}),define("DS/WidgetServicesUI/tweakers/TweakerHTML",["DS/WidgetServicesUI/infra/TweakerBase"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)},_buildRO:function(e,t){var n=e.value;n=n||"";var i=this._createROContainer(n);t.call(this,i)},_computeValueForRO:function(e){return"object"==typeof e?e.textContent:e}})}),define("DS/WidgetServicesUI/tweakers/TweakerMVA",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase"],function(e,t){"use strict";return t.extend({tweakerInput:null,init:function(t){this.type=e.SPE_TYPES.MVA,this.tweakerInput=t.tweaker,this._parent(t);var n=this;this.tweakerInput.addEvent("notification",function(e){n._dispatchNotificationObj(e)})},setValue:function(e,t){var n=this._parent,i=this;this.completeData(e,function(){n.apply(i,[e,t])})},focus:function(){var e=this;setTimeout(function(){e.elements.elementUI&&e.elements.elementUI.textInput.getElement().focus()},0)},_setValue:function(e){this._parent(e)},completeData:function(e,t){this.tweakerInput.completeData?this.tweakerInput.completeData(e,t):t()},_buildRO:function(e,t){var n=this,i=this._parent;n.showSpinner(),this.completeData(e.value,function(){i.apply(n,[e,t]),n.hideSpinner()})},_build:function(e,t){var n=this;n.showSpinner(),this.completeData(e.value,function(){n.__build(e,t),n.hideSpinner()})},__build:function(t,n){var i=this;this.tweakerInput.__switchMode(!0),require(["DS/WidgetServicesUI/infra/TweakerMVABase"],function(a){var s=!1,r=!0;i.tweakerInput.getType()===e.TYPES.RELATION&&(s=!0,r=!1);var l=new a(i.tweakerInput,{value:t.value,uniqueValue:s,reorder:r,events:{onChange:function(){var e=this.getValue(),t=[];e.forEach(function(e){t.push(e.value)}),i._dispatchChange(t)},onError:function(e){i._dispatchNotification("error",e.message)}}});n.call(this,l)})},areEquals:function(e,t){var n=e===t||e&&t&&e.length===t.length;if(e&&n)for(var i=e.length,a=0;a<i&&(n=this.tweakerInput.areEquals(e[a],t[a]));a++);return n},_computeValueForRO:function(e,t){return t&&t.forClickable?this.tweakerInput.getDisplayValue(e,{forClickable:t.forClickable}):this.tweakerInput.getDisplayValue(e)},_getValueOrDefault:function(e){return e},_changeRW:function(e){this.getElement().setValue(e)}})}),define("DS/WidgetServicesUI/tweakers/TweakerButtonWeb",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Button","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a){"use strict";return n.extend({WidgetServices:null,SecurityContextServices:null,init:function(e){e.value=e.value?e.value:{},this.handleRequest={},this._parent(e)},_securityContextDispatcher:function(e,t,n){var i=this;if(n.SecurityContext)i.__callWebService.call(this,e,t,n);else{var a=this.SecurityContextServices.getInstance({tenant:n.tenant}).getSecurityContext({onSuccess:function(a){n.SecurityContext=a.SecurityContext,i.__callWebService.call(i,e,t,n)},onFailure:function(e){i._onFailure(null,{error:e},null,n)}});this._setCancelHandler(a)}},_setCancelHandler:function(e){e&&(this.handleRequest.handler=e)},__callWebService:function(t,n,i){var a=this,s=this.options.data,r=s&&s.headers?s.headers:{};r.Accept=r.Accept?r.Accept:"application/json",r["content-type"]=r["content-type"]?r["content-type"]:"application/json",r["Accept-Language"]=r["Accept-Language"]?r["Accept-Language"]:e.getLanguage(),r.SecurityContext=i.SecurityContext?encodeURIComponent(i.SecurityContext):null;var l={type:"json",method:s&&s.method?s.method:"GET",timeout:36e5,proxy:"passport",headers:r,onComplete:function(e){a._onComplete(e)},onFailure:function(e,t,n){a._onFailure(e,t,n)},onTimeout:function(e){a._onTimeout()}};this.getValue().data&&(l.data=UWA.Json.encode(this.getValue().data));var o=this.getValue().parameters,u=(o=o||{}).tenant?o.tenant:i.tenant;if(u&&(o.tenant=u),o){var c=n.indexOf("?"),h=c>0&&c<n.length-1?"&":"";for(var p in c<0&&(n+="?"),o){var d=o[p];Array.isArray(d)?d.forEach(function(e){n+=h+p+"="+e,h="&"}):n+=h+p+"="+d,h="&"}}try{var v=t.handleRequest(n,l);this._setCancelHandler(v)}catch(e){this._onFailure(null,e,null)}},_callWebService:function(e,t){var n=this.options.data,i={};n.headers&&(i.SecurityContext=n.headers.SecurityContext),i.tenant=n.tenant?n.tenant:this.WidgetServices.getTenantID(),this._securityContextDispatcher(e,t,i)},_launch:function(){var e=this;e.handleRequest||(e.handleRequest={}),this._setCancelHandler({toCancel:!1,cancel:function(){this.toCancel=!0}}),require(["DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","DS/WAFData/WAFData"],function(t,n,i){if(e.WidgetServices=t,e.SecurityContextServices=n,e.handleRequest.handler&&!1===e.handleRequest.handler.toCancel){var a=e.options.data.url;if(a)if(a.startsWith("http"))e._callWebService(i,a);else{var s=t.get3DSpaceUrlAsync({onComplete:function(t){e._callWebService(i,t+e.options.data.url)}});e._setCancelHandler(s)}}})},_onComplete:function(e){if(e&&!1===e.success)this._onFailure(null,e);else{this._clearHandle(),this._changeStatus("completed","success");var t=this.getValue();t.value=e,this._dispatchChange(t,!0)}},_onFailure:function(e,t,n,i){if(null!=t&&t.hasOwnProperty("error")){var a=t.error;"object"==typeof a&&(a=a.message),this._dispatchNotification("error",a)}this._clearHandle(),this._changeStatus("failed","error")},_onTimeout:function(){this._clearHandle(),this._changeStatus("timeout","warning")},_changeStatus:function(e,t){this.getElement().setClassName("twButton_"+e+(t?" "+t:"")),this.getElement().setValue(a["tw_status_"+e])},_getDefaultLabel:function(){return this.options.data.label?this.options.data.label:a.tw_launch},_build:function(e,t){var n=this,a=(e.value,new i({value:this._getDefaultLabel(),className:"primary",events:{onClick:function(){n._requestIsActive()?(n._changeStatus("cancelled","warning"),n._clearHandle()):(n._changeStatus("loading","info"),n._launch())}}}));t.call(this,a)},_requestIsActive:function(){return!!this.handleRequest.handler},_computeValueForRO:function(e){return this._getDefaultLabel()},_clearHandle:function(){this.handleRequest.handler&&(this.handleRequest.handler.cancel(),this.handleRequest.handler=null)}})}),define("DS/WidgetServicesUI/tweakers/TweakerDummyBookmark",["DS/WidgetServicesUI/infra/TweakerBase"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,t){var n=this;require(["DS/IPClassifyActive/InputFieldAbstract"],function(e){var i=new e({panelRequire:"DS/FolderActive/FolderActive"});i.addEvent("change",function(){var e=this.getValues();if(e){var t=[];for(var i in e)t.push(e[i].id),""+e[i].label;n._dispatchChange(t,!0),n._tooltip=e[0].label}}),t.call(this,i)})}})}),define("DS/WidgetServicesUI/tweakers/TweakerRelation",["DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Autocomplete","DS/WidgetServices/WidgetServices","DS/WAFData/WAFData","DS/DataDragAndDrop/DataDragAndDrop","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a,s){"use strict";var r=function(e,t,n){!0!==e.firstToggle?e._dispatchChange(t?n:null,t):e.firstToggle=!1},l=function(e,t){var n=[];if(e&&e.results){var i={};t.predicates&&t.predicates.forEach(function(e){i[e]=e}),i.resourceid="id",i["ds6w:label"]="label";var a=Object.keys(i).length;e.results.forEach(function(e){var t={},s=a;e.attributes&&e.attributes.every(function(e){var n=i[e.name];return n&&(s--,t[n]=e.value),0!==s}),0===s&&n.push({value:t,id:t.id,label:t.label})})}t.onComplete(n)},o=function(e){var t=this,a=e;this.handler={handle:null};var r={dataParser:function(e,t){return t},onError:function(e){a._onFailure.apply(a,[e.error])},remoteSearchEngine:function(e,o){t.handler.handle&&t.handler.handle.cancel(),t.handler.handle=n._getCancelObject();var u=o,c=a.options.data;if(c&&c.rules){u+=" ";var h=!1;for(var p in c.rules){h&&(u+=" AND "),u+="(";var d=c.rules[p],v=!1;d.forEach(function(e){v&&(u+=" OR "),u+=p+':"'+e+'"',v=!0}),u+=")",h=!0}}return new Promise(function(a,o){var c,h,p;c=u,h={handleRequest:t.handler,onComplete:function(t){var n={};n.dataset=e,n.matchingItems=r.dataParser(e,t),a(n)},onFailure:function(t){var n={type:"error"};n.error=t,n.dataset=e,o(n)}},p=n.getTenantID(),h.handleRequest.handle=n.get3DSearchUrlAsync({platformId:p,onComplete:function(e){var t=e+"/search?tenant="+p,a=n.getLanguage();h.predicates=["ds6w:label"];var r="PropertiesPanel-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime(),o={with_indexing_date:!1,with_synthesis:!1,with_synthesis_attribute:!1,with_nls:!1,nresults:10,locale:a,query:c,tenant:p,start:0,sources:["3dspace"],label:r,select_predicate:h.predicates},u={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage()},d={type:"json",method:"POST",timeout:24e4,data:UWA.Json.encode(o),proxy:"passport",headers:u,cache:-1,onComplete:function(e){l(e,h)},onFailure:function(){h.onFailure(s.searchFromIndexFailure)},onTimeout:function(){h.onFailure(s.timeout)}};n.getWidgetValue("isStandalone")||(d.authentication="passport"),h.handleRequest.handle=i.handleRequest(t,d)}})})}};this.getConfig=function(){return r}};return e.extend({init:function(e){this.handlerLoad={handle:null},this.components={},this._parent(e)},destroy:function(){this._parent.apply(this,arguments);var e=this;setTimeout(function(){for(var t in e.components)try{e.components[t].destroy()}catch(e){}})},setValue:function(e,t){var n=this._parent,i=this;this.completeData([e],function(){n.apply(i,[e,t])})},completeData:function(e,t){if(e.length>0&&(!e[0]||e[0].label))t();else{var a=[],r={};e.forEach(function(e){a.push(e.id),r[e.id]=e,e.label=s["Not indexed"]}),this.handlerLoad.handle=n._getCancelObject(),function(e,t){if(0!=e.length){var a=n.getTenantID();t.handleRequest.handle=n.get3DSpaceUrlAsync({platformId:a,onComplete:function(r){var o=r+"/cvservlet/fetch/v2?tenant="+a,u=n.getLanguage();t.predicates=["ds6w:label"];var c="TweakerRelation-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime(),h={locale:u,tenant:a,label:c,physicalid:e,select_predicate:t.predicates},p={Accept:"application/json","content-type":"application/json","Accept-Language":n.getLanguage()},d={type:"json",method:"POST",timeout:24e4,data:UWA.Json.encode(h),proxy:"passport",headers:p,cache:-1,onComplete:function(e){l(e,t)},onFailure:function(){t.onFailure(s.dataFromIndexFailure),t.onComplete([])},onTimeout:function(){t.onFailure(s.timeout),t.onComplete([])}};n.getWidgetValue("isStandalone")||(d.authentication="passport"),t.handleRequest.handle=i.handleRequest(o,d)}})}else t.onComplete([])}(a,{handleRequest:this.handlerLoad,onComplete:function(e){e.forEach(function(e){var t=r[e.id];t&&(t.label=e.label)}),t()},onFailure:this._onFailure.bind(this)})}},_onFailure:function(e){this._dispatchNotification("error",e)},_buildRO:function(e,t){var n=this,i=this._parent;n.showSpinner(),this.completeData([e.value],function(){i.apply(n,[e,t]),n.hideSpinner()})},_build:function(e,t){var n=this;n.showSpinner(),this.completeData([e.value],function(){n.__build(e,t),n.hideSpinner()})},_manageDrop:function(e){if(e){var t=this,n=JSON.parse(e);if(n.data&&n.data.items){var i=null;n.data.items.forEach(function(e){e.objectId&&e.displayName?!t.options.data||!t.options.data.rules||!t.options.data.rules.type||t.options.data.rules.type.indexOf(e.objectType)>=0?t.setValue({id:e.objectId,label:e.displayName}):i="mismatchType":i="wrongFormat",i&&t._dispatchNotification("warning",s[i])})}}},__build:function(e,n){this.components.autocompleteWithRemoteData=new t({showSuggestsOnFocus:!0}),this.components.autocompleteWithRemoteData.addEvents({onSelect:r.bind(this.components.autocompleteWithRemoteData,this,!0),onUnselect:r.bind(this.components.autocompleteWithRemoteData,this,!1)});var i=e.value?[e.value]:[],l=new o(this);this.components.autocompleteWithRemoteData.addDataset({name:s.ObjectsList,displayName:!0,items:i},l.getConfig()),e.value&&(this.firstToggle=!0,this.components.autocompleteWithRemoteData.toggleSelect(e.value));var u=this.components.autocompleteWithRemoteData;a.droppable(this.components.autocompleteWithRemoteData.elements.container,{drop:this._manageDrop.bind(this)}),n.call(this,u)},_computeValueForRO:function(e,t){return e?e.label:""},_changeRW:function(e,t){if(e){var n={id:e.id,label:e.label,selected:!0},i=this.components.autocompleteWithRemoteData.selectedItems;0!=i.length&&i[0].id===n.id||this.components.autocompleteWithRemoteData.toggleSelect(n,null,!0)}else this.components.autocompleteWithRemoteData.resetInput()},areEquals:function(e,t){return e===t||!!e&&!!t&&e.id===t.id},_getValueOrDefault:function(e){return e&&e.id?e:null}})}),define("DS/WidgetServicesUI/tweakers/TweakerImage",["DS/WidgetServicesUI/infra/TweakerBase","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","DS/WidgetServices/WidgetServices","DS/WidgetServices/securityContextServices/SecurityContextServices","css!DS/WidgetServicesUI/WidgetServicesUI"],function(e,t,n,i){"use strict";return e.extend({_initComponents:function(){var e=this;this.addIcon=UWA.createElement("i",{class:"fonticon fonticon-plus",id:"add_image_icon"}),this.removeIcon=UWA.createElement("i",{class:"fonticon fonticon-wrong",id:"remove_image_icon",events:{click:function(t){e.preview.src=e.input.value=this.style.display=e.addIcon.style.display=e.label.style.display=e.previewDiv.style.display=e.labelContainer.style.padding=""}}}),this.label=UWA.createElement("label",{id:"label-dropper",for:"dropper",text:t["Drop an image here"]}),this.container=UWA.createElement("div",{id:"image_tweaker_container"}),this.labelContainer=UWA.createElement("div",{id:"image_tweaker_label_container"}),this.previewDiv=UWA.createElement("div",{id:"image_tweaker_div_preview"}),this.preview=UWA.createElement("img",{id:"image_tweaker_preview"}),this.input=UWA.createElement("input",{id:"dropper",type:"file",events:{dragenter:function(){e.container.style.backgroundColor="#e4f0f5",e.container.style.border="dashed #005686 1px"},dragleave:function(){e.container.style.backgroundColor="",e.container.style.border=""},change:function(t){e._onChange(t)}}})},init:function(e){this._parent(e),this._initComponents()},_checkImageType:function(e){if(e)return"image"===new RegExp(/^[A-z]*/).exec(e.type)[0];this._dispatchNotification("error",t["Unexpected file error"])},_onChange:function(e){var a=this;this.container=document.getElementById("image_tweaker_container"),this.container.style.backgroundColor="",this.container.style.border="";var s=e.target.files[0];if(this._checkImageType(s)){var r=new FileReader;s&&r.readAsDataURL(s),r.addEventListener("load",function(){a.previewDiv.style.display="block",a.preview.src=r.result,a.labelContainer.style.padding="10px",a.label.style.display="none",a.addIcon.style.display="none",a.removeIcon.style.display="block";n.get3DSpaceUrlAsync({onComplete:function(e){var t={onComplete:function(t){a.documentUrl=e+t}};t.onFailure;t.onFailure=function(e,t){console.error("failure")};i.getInstance().getSecurityContext({alwaysUpdate:!0,onFailure:function(e){console.error("no security error"),a._dispatchNotification("error","no security context")},onSuccess:function(e){t.securityContext=e.securityContext}})}})},!1)}else this.input.value="",this._dispatchNotification("error",t["Drop an image here"])},_build:function(e,t){this.that=this,this.preview.inject(this.previewDiv),this.removeIcon.inject(this.previewDiv),this.addIcon.inject(this.labelContainer),this.label.inject(this.labelContainer),this.previewDiv.inject(this.labelContainer),this.input.inject(this.container),this.labelContainer.inject(this.container),t.call(this,this.container)}})}),define("DS/WidgetServicesUI/infra/TweakerMVABase",["DS/MVAInput/MVAInput","DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants"],function(e,t,n){"use strict";return e.extend({internalOption:{useDropDown:!1},defaultOptions:{options:[]},init:function(e,i){var a=this;i.options||(i.options=[]);var s=!1;e.getType()!==n.TYPES.STRING&&e.getType()!==n.TYPES.NUMBER&&e.getType()!==n.TYPES.BOOLEAN&&e.getType()!==n.TYPES.INTEGER||(s=!0),this.internalOption.useDropDown=s;t.isReplayedODT(),e.addEvent("valid",function(){a._onValidValue()}),e.addEvent("multivaluedBooleanChange",function(){a._onValidValue()}),s&&e.addEvent("liveChange",function(){a._updateDropDown()}),this.textInput=e,this._parent(i)},_checkValue:function(e){this.textInput.getType()!==n.TYPES.DATE&&this.textInput.getType()!==n.TYPES.DATETIME||e.value instanceof Date||(e.value=new Date(e.value));var t=this.textInput.checkValue(e.value);return t||this._parent(e)},_actionOnValid:function(){this.textInput.setValue(null)},_isEqual:function(e,t){return this._parent(e,t)||this.textInput.areEquals(e,t)},_formatItem:function(e){return this.textInput.getDisplayValue(e.value)},_getTooltipForItem:function(e){return this.textInput.getDisplayValue(e.value,{detailed:!0})},_getValueOfInput:function(){return this.textInput.getValue()},_getDisplayInputValue:function(){return this.textInput.getDisplayValue()},_focus:function(){var e=this.textInput.getElement();e&&"function"==typeof e&&e.focus()},_getItemOfInput:function(){var e=this._getValueOfInput(),t=this.textInput.getDisplayValue();return""===e?e:{value:e,displayValue:t}}})}),define("DS/WidgetServicesUI/tweakers/TweakerString",["DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Text","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,i){var a=this,s=this._transformString(e.value),r=e.multiline,l=null;e.placeholder?l=e.placeholder:(l=n["Enter a value"],r&&(l=n["Enter a text"]));var o=!1,u={value:s,className:"input-text-label",multiline:r,placeholder:l,fixIframedIosScroll:!0,events:{onChange:function(){if(!o){var e=this.getValue().replace(/\s+$/,"");a._dispatchChange(e,!0)}},onKeyDown:function(e){if(13===e.keyCode){o=!0;var t=this;setTimeout(function(){o=!1;var n=t.getValue().replace(/\s+$/,"");a._dispatchLiveChange(n,e),t.options&&!t.options.multiline&&a.__dispatchEvent("enterKeyDown",t)})}}}};e.placeholder&&(u.placeholder=e.placeholder);var c=new t(u);r&&c.elements.container.setStyle("min-height","38px");var h={input:function(){setTimeout(function(){if(c.elements.input){var e=c.getValue().replace(/\s+$/,"");a._dispatchLiveChange(e)}})}};c.elements.input.addEvents(h),i.call(this,c)},_transformString:function(e){return e},_computeValueForRO:function(e,t){t&&!1!==t.forHTML&&t.maxCharacters&&e.length>t.maxCharacters&&(e=e.substring(0,t.maxCharacters)+"...");var n,i=!1;if(t&&t.forClickable&&(i=!0),i){var a=(n=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)}));e=e.replace(/:\/\//g,a),arguments[0]=e}if(e=this._parent.apply(this,arguments),i){var s=new RegExp(a,"g");e=(e=e.replace(s,"://")).makeClickable()}return e},_changeRW:function(e,t){null!==e&&""!==e||this.getElement().setValue(""),(t||document.activeElement!==this.getElement().elements.input)&&this.getElement().setValue(this._transformString(e))},focus:function(){var e=this.getHTMLElement();e&&e.select()}})}),define("DS/WidgetServicesUI/tweakers/TweakerReplacement",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/WidgetServicesUI/tweakers/TweakerString","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i){"use strict";return t.extend({_initValues:{},_currentValue:null,init:function(e){this._initValues={},this._currentValue=null,this._parent(e)},_postInit:function(){this._copyValueToInit()},_copyValueToInit:function(){var e=this.getValue();if(e!==this._currentValue&&(this._currentValue=e,this._initValues={},e))for(var t in e)this._initValues[t]=e[t]},_build:function(e,t){var a=this,s=UWA.createElement("div",{class:"tw_replaceContainer"});this.elements.inputRegex=new n({placeholder:i["Enter a regex"],className:"tw_regexField",editable:!0,nested:!0,events:{change:function(e){a._applyResult()}}}),this.elements.inputResult=new n({placeholder:i["Enter a replace expression"],className:"tw_replaceField",editable:!0,nested:!0,events:{change:function(e){a._applyResult()}}}),this.elements.inputRegex.inject(s),this.elements.inputResult.inject(s),t.call(this,s)},_applyResult:function(){var e=!1,t=this.elements.inputRegex.getValue();if(""!==t&&null!==t){var n=this.elements.inputResult.getValue();if(""!==n&&null!==n)try{var a=new RegExp(t,"g"),s=this._initValues,r={};for(var l in s)r[l]=s[l].replace(a,n);this._currentValue=r,this._dispatchChange(r),e=!0}catch(e){var o=e.message?e.message:i["Wrong regexp"];this._dispatchNotification("warning",o)}}e||this.areEquals(this._initValues,this._currentValue)||this._dispatchChange(UWA.clone(this._initValues))},areEquals:function(e,t){var n=Object.keys(e),i=Object.keys(t),a=e===t||e&&t&&n.length===i.length;if(e&&a)for(var s in e){if(!(a=e[s]===t[s]))break}return a},_computeValueForRO:function(e){if("object"==typeof e){var t="";for(var n in e){""!==t&&(t+=", "),t+=e[n]}return t}},_setValue:function(e){this._parent(e),this._copyValueToInit()},_changeRW:function(e){e!==this._currentValue&&this._applyResult()}})}),define("DS/WidgetServicesUI/tweakers/TweakerStringWebUX",["DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/UIKIT/Input/Text","DS/Controls/LineEditor","DS/Controls/Editor","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],function(e,t,n,i,a){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,t){var s=this,r=this._transformString(e.value),l=e.multiline,o=null;e.placeholder?o=e.placeholder:(o=a["Enter a value"],l&&(o=a["Enter a text"]));var u=!1,c={value:r,placeholder:o};if(e.placeholder&&(c.placeholder=e.placeholder),l){c.nbRows=3;h=new i(c);s.setStyleForWuxComponent(h._myInput,"width","100%")}else{var h=new n(c);s.setStyleForWuxComponent(h,"width","100%")}h.addEventListener("change",function(){if(!u){var e=h.value.replace(/\s+$/,"");s._dispatchChange(e,!0)}}),h.addEventListener("keydown",function(e){if(13===e.keyCode){u=!0;var t=s;setTimeout(function(){u=!1;var n=h.value.replace(/\s+$/,"");s._dispatchLiveChange(n,e),t.options&&!t.options.multiline&&s.__dispatchEvent("enterKeyDown",t)})}});var p="input-text-label ";s.options.multivalued&&(p+="multivaluedAttribute"),s.setClassNameForWebUXComponent(h,p);var d={input:function(e){setTimeout(function(){if(h.elements.inputField||l&&h.elements.container){var t=e.target.value.replace(/\s+$/,"");s._dispatchLiveChange(t)}})}};h._myInput.addEvents(d),t.call(this,h)},_transformString:function(e){return e},_computeValueForRO:function(e,t){t&&!1!==t.forHTML&&t.maxCharacters&&e.length>t.maxCharacters&&(e=e.substring(0,t.maxCharacters)+"...");var n,i=!1;if(t&&t.forClickable&&(i=!0),i){var a=(n=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)}));e&&"string"==typeof e&&(e=e.replace(/:\/\//g,a)),arguments[0]=e}if(e=this._parent.apply(this,arguments),i){var s=new RegExp(a,"g");e&&"string"==typeof e&&(e=(e=e.replace(s,"://")).makeClickable())}return e},_changeRW:function(e,t){null!==e&&""!==e||(this.getElement().value=""),(t||document.activeElement!==this.getElement().elements.input)&&(this.getElement().value=this._transformString(e))},focus:function(){var e=this.getHTMLElement();e&&(e.getElement("input").focus(),e.getElement("input").select())}})}),define("DS/WidgetServicesUI/tweakers/TweakerReplacementWebUX",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/WidgetServicesUI/tweakers/TweakerStringWebUX","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i){"use strict";return t.extend({_initValues:{},_currentValue:null,init:function(e){this._initValues={},this._currentValue=null,this._parent(e)},_postInit:function(){this._copyValueToInit()},_copyValueToInit:function(){var e=this.getValue();if(e!==this._currentValue&&(this._currentValue=e,this._initValues={},e))for(var t in e)this._initValues[t]=e[t]},_build:function(e,t){var a=this,s=UWA.createElement("div",{class:"tw_replaceContainer"});this.elements.inputRegex=new n({placeholder:i["Enter a regex"],className:"tw_regexField",editable:!0,nested:!0,events:{change:function(e){a._applyResult()}}}),this.elements.inputResult=new n({placeholder:i["Enter a replace expression"],className:"tw_replaceField",editable:!0,nested:!0,events:{change:function(e){a._applyResult()}}}),this.elements.inputRegex.inject(s),this.elements.inputResult.inject(s),t.call(this,s)},_applyResult:function(){var e=!1,t=this.elements.inputRegex.getValue();if(""!==t&&null!==t){var n=this.elements.inputResult.getValue();if(""!==n&&null!==n)try{var a=new RegExp(t,"g"),s=this._initValues,r={};for(var l in s)r[l]=s[l].replace(a,n);this._currentValue=r,this._dispatchChange(r),e=!0}catch(e){var o=e.message?e.message:i["Wrong regexp"];this._dispatchNotification("warning",o)}}e||this.areEquals(this._initValues,this._currentValue)||this._dispatchChange(UWA.clone(this._initValues))},areEquals:function(e,t){var n=Object.keys(e),i=Object.keys(t),a=e===t||e&&t&&n.length===i.length;if(e&&a)for(var s in e){if(!(a=e[s]===t[s]))break}return a},_computeValueForRO:function(e){if("object"==typeof e){var t="";for(var n in e){""!==t&&(t+=", "),t+=e[n]}return t}},_setValue:function(e){this._parent(e),this._copyValueToInit()},_changeRW:function(e){e!==this._currentValue&&this._applyResult()}})}),define("DS/WidgetServicesUI/infra/TweakerEnumBase",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i){"use strict";return t.extend({_withEmptyValue:!1,init:function(e){this._withEmptyValue=!1,this.tweakerInput=e.tweaker,this.mapOptions={},this._parent(e)},_postInit:function(){var e=this,t=this.options.data.list;this._translateOptions(t);var n=0;t.forEach(function(t){null!==t.value&&""!==t.value&&void 0!==t.value||(e._withEmptyValue=!0,t.value="_DS_ENUM_NULL_",t.label=i.get("tw_enum_null"));var a="string"==typeof t.value?t.value:n+"_No_change";e.mapOptions[a]=t.value,t.valueObj=t.value,t.value=a,n++})},_translateOptions:function(e){var t=this;this.tweakerInput&&e.forEach(function(e){null===e.label&&(e.label=t.getDisplayValue(e.value,{forHTML:!1,escapeChar:!1}),e.html=t.getDisplayValue(e.value,{forHTML:!1}),e.htmlClickable=t.getDisplayValue(e.value,{forHTML:!1,forClickable:!0})),e.html||(e.html=e.label)})},_computeValueForRO:function(e,t){var n=this,i="";if(null!=e){var a=!1;this.options.data.list.every(function(s){var r=n._getEnumValue(s.value);return(a=void 0!==r&&n.areEquals(r,e))&&(i=t&&t.forClickable?s.htmlClickable?s.htmlClickable:s.label:s.html?s.html:s.label),!a}),!a&&this.tweakerInput&&(i=this.tweakerInput.getDisplayValue(e,t))}return i||e},areEquals:function(e,t){return this._parent(e,t)||this.tweakerInput&&this.tweakerInput.areEquals(e,t)},_getEnumValue:function(e){return this.mapOptions[e]},_getIdFromValue:function(e){return this.__getIdFromValue(e)},__getIdFromValue:function(e){var t=null;if(null!=e)for(var n in!1===this.options.multivalued&&""===e&&(e="_DS_ENUM_NULL_"),this.mapOptions)if(this.areEquals(e,this.mapOptions[n])){t=n;break}return t}})}),define("DS/WidgetServicesUI/tweakers/TweakerDropdown",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerEnumBase","DS/UIKIT/Dropdown","DS/UIKIT/Input/Button","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a,s){"use strict";var r=function(e){return"tw_key_"+e.replace(/\W/g,"_")};return t.extend({_build:function(t,a){var s=this,l=this.tweakerInput;l.__switchMode(!0);var o=!1;l.getType()!==e.TYPES.STRING&&l.getType()!==e.TYPES.NUMBER&&l.getType()!==e.TYPES.INTEGER||(o=!0);var u=[],c=this.elements.bodyDD=UWA.createElement("div",{class:"tw_dropdown_content"});t.data.list.forEach(function(e){var t=UWA.createElement("div",{class:"tw_dropdown_element "+r(e.value),text:e.label,events:{click:function(){var t=e.valueObj;s._dispatchChange(t,!0),s._removeAllSelection(),this.addClassName("tw_dd_selected")}}}).inject(c);UWA.createElement("span",{class:"tw_dropdown_select"}).inject(t),u.push({value:e,UI:t})}),this.elements.dropDown=new n({className:"tw_dropdown",body:c,target:l.elements.container}),l.addEvent("changes",function(e){s._dispatchChange(e,!0),s._selectFromValue(e)});var h=UWA.createElement("div");l.inject(h),o||(this.elements.dropButton=new i({icon:"expand-down",className:"default"}).inject(h)),this._selectFromValue(this.getValue()),a.call(this,h)},_removeAllSelection:function(){if(this.elements.bodyDD){var e=this.elements.bodyDD.getElements(".tw_dd_selected");e&&e.forEach(function(e){e.removeClassName("tw_dd_selected")})}},_selectFromValue:function(e){if(this.elements.bodyDD){var t=this._getIdFromValue(e);if(this._removeAllSelection(),t){var n="."+r(t),i=this.elements.bodyDD.getElement(n);i&&i.addClassName("tw_dd_selected")}}},_changeRW:function(e){this.tweakerInput.setValue(e)}})}),define("DS/WidgetServicesUI/tweakers/TweakerEnum",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerEnumBase","DS/UIKIT/Input/Select","DS/UIKIT/Autocomplete","DS/WidgetServices/WidgetServices","DS/Controls/ComboBox","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a,s,r){"use strict";return t.extend({_build:function(e,t){var l,o=this,u=this.__getIdFromValue(e.value),c=e.data.list,h=!0===e.data.placeholder?r.SelectOption:!!e.data.placeholder&&e.data.placeholder,p=this.options.multisel;if(void 0===p&&(p=this.options.data.list[0].valueObj._ismultisel),"_DS_ENUM_NULL_"!=c[0].value&&!1===p)for(var d=0;d<c.length;d++){if("_DS_ENUM_NULL_"===c[d].value){l=d;break}}if("_DS_ENUM_NULL_"!=c[0].value&&null!=l&&!1===p){for(var v=c[l],_=l;_>0;_--)c[_]=c[_-1];c[0]=v}var f=!0===e.customSelect,m=!0===e.sortedOptions,g=!0===e.autocomplete;if(m){var S="en";widget&&widget.lang&&(S=widget.lang),c.sort(function(e,t){return e.label.localeCompare(t.label,S,{numeric:!0})})}if(f&&c.forEach(function(e){var t=e.icon;if(t){var n="background-image: url("+t+");background-repeat: no-repeat;background-position-y: center;white-space: pre;background-size: 20px;background-origin: content-box;";e.attributes={style:n},e.label="        "+e.label}}),g){var w=[];c.forEach(function(e){var t={label:e.label,value:e.value};e.value===u&&(t.selected=!0),w.push(t)});var E=function(){var e=this.getValue();if(U||e.length>0&&e[0]!==u){var t=o._getEnumValue(e);"_DS_ENUM_NULL_"!==t&&void 0!==t||(t=""),o._dispatchChange(t,!0)}U=!0},I={className:"input-AuthorizedValuesboolean-label",datasets:{name:"itemsSearch",items:w,displayName:!1},value:u,placeholder:r["Enter a value"],showSuggestsOnFocus:!0,events:{onSelect:E,onUnselect:E}},T=new i(I);t.call(this,T)}else{null===u&&(this.data.value=c.length>0?this._getEnumValue(c[0].value):null);var U=!1;if(e.prop){var D={value:u,elementsList:e.applySort?o.sortDropdownOptions(c,e.isMultiSel,e.type):c,enableSearchFlag:!0,placeholder:h,className:"input-AuthorizedValuesboolean-label"};e.nested&&0===e.defaultValue&&(D.selectedIndex=e.defaultValue),a.isReplayedODT()&&(f=!0),D.custom=f,e.placeholder&&(h=D.placeholder=e.placeholder),!0===e.customSelect&&(D.renderTo=document.body),(W=new s(D)).touchMode=!0,W.elements.container.setStyle("width","100%"),W.addEventListener("change",function(){var e=W.value;if(U||e!==u){var t=o._getEnumValue(e);"_DS_ENUM_NULL_"!==t&&void 0!==t||(t=""),o._dispatchChange(t,!0)}U=!0}),t.call(this,W)}else{U=!1,D={value:u,options:c,nativeSelect:f,placeholder:h,className:"input-AuthorizedValuesboolean-label",events:{onChange:function(){var e=this.getValue();(U||e.length>0&&e[0]!==u)&&e.forEach(function(e){var t=o._getEnumValue(e);"_DS_ENUM_NULL_"!==t&&void 0!==t||(t=""),o._dispatchChange(t,!0)}),U=!0}}};a.isReplayedODT()&&(f=!0),D.custom=f,e.placeholder&&(h=D.placeholder=e.placeholder),!0===e.customSelect&&(D.renderTo=document.body);var W=new n(D);t.call(this,W)}var k=this.getValue();!0===e.nested||h||u||null==k||o._dispatchChange(k,!0)}},getValue:function(){return"_DS_ENUM_NULL_"===this.data.value||void 0===this.data.value?"":this.data.value},_changeRW:function(e){var t=this._getIdFromValue(e),n=this.getElement();UWA.is(n.setValue,"function")&&n.setValue(t)},focus:function(){var e=this.getElement();setTimeout(function(){e&&e.focus()},0)},sortDropdownOptions:function(e,t,n){var i=!1,a=[],s=null,r=null;return e.forEach(function(e){"_DS_ENUM_NULL_"===e.value?(s=e,i=!0):"0_No_change"===e.value?r=e:a.push(e)}),"string"===n||"boolean"===n?a=this._sortOptionsForWebUXComboBox(a,!1):"integer"===n||"real"===n?a=this._sortOptionsForWebUXComboBox(a,!0):"timestamp"!==n&&"date"!==n||(a=this._sortOptionsForWebUXComboBoxTypeDate(a)),e=[],t&&e.push(r),i&&e.push(s),a.forEach(function(t){e.push(t)}),e},_sortOptionsForWebUXComboBox:function(e,t){return e.sort((e,n)=>e.label.localeCompare(n.label,widget&&widget.lang||"en",{caseFirst:"lower",numeric:t,sensitivity:"case"}))},_sortOptionsForWebUXComboBoxTypeDate:function(e){return e.sort(function(e,t){return new Date(e.label)-new Date(t.label)})}})}),define("DS/WidgetServicesUI/tweakers/TweakerBoolean",["DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Toggle","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,n){var i=this,a=e.value,s=new t({type:"switch",checked:!0===a,value:"",className:"input-boolean-label",events:{onChange:function(){var e=this.isChecked();i._dispatchChange(e)}}});n.call(this,s)},_computeValueForRO:function(e){return!0===e?n.true:n.false},_changeRW:function(e){this.getElement().setCheck(!0===e)},focus:function(){var e=this.getElement();setTimeout(function(){e.elements.input&&e.elements.input.focus()},0)}})}),define("DS/WidgetServicesUI/infra/TweakerEnumBaseWebUX",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/WidgetServices/WidgetServices","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i){"use strict";return t.extend({_withEmptyValue:!1,init:function(e){this._withEmptyValue=!1,this.tweakerInput=e.tweaker,this.mapOptions={},this._parent(e)},_postInit:function(){var e=this,t=this.options.data.list;this._translateOptions(t);var n=0;t.forEach(function(t){null!==t.value&&""!==t.value&&void 0!==t.value||(e._withEmptyValue=!0,t.value="_DS_ENUM_NULL_",t.label=i.get("tw_enum_null"));var a="string"==typeof t.value?t.value:n+"_No_change";e.mapOptions[a]=t.value,t.valueObj=t.value,t.value=a,n++})},_translateOptions:function(e){var t=this;this.tweakerInput&&e.forEach(function(e){null===e.label&&(e.label=t.getDisplayValue(e.value,{forHTML:!1,escapeChar:!1}),e.html=t.getDisplayValue(e.value,{forHTML:!1}),e.htmlClickable=t.getDisplayValue(e.value,{forHTML:!1,forClickable:!0})),e.html||(e.html=e.label)})},_computeValueForRO:function(e,t){var n=this,i="";if(null!=e){var a=!1;this.options.data.list.every(function(s){var r=n._getEnumValue(s.value);return(a=void 0!==r&&n.areEquals(r,e))&&(i=t&&t.forClickable?s.htmlClickable?s.htmlClickable:s.label:s.html?s.html:s.label),!a}),!a&&this.tweakerInput&&(i=this.tweakerInput.getDisplayValue(e,t))}return i||e},areEquals:function(e,t){return this._parent(e,t)||this.tweakerInput&&this.tweakerInput.areEquals(e,t)},_getEnumValue:function(e){return this.mapOptions[e]},_getIdFromValue:function(e){return this.__getIdFromValue(e)},__getIdFromValue:function(e){var t=null;if(null!=e)for(var n in!1===this.options.multivalued&&""===e&&(e="_DS_ENUM_NULL_"),this.mapOptions)if(this.areEquals(e,this.mapOptions[n])){t=n;break}return t}})}),define("DS/WidgetServicesUI/tweakers/TweakerOutput",["DS/WidgetServicesUI/infra/TweakerBase"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e)}})}),define("DS/WidgetServicesUI/tweakers/TweakerMVAWebUX",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX"],function(e,t){"use strict";return t.extend({tweakerInput:null,init:function(t){this.type=e.SPE_TYPES.MVA_WUX,this.tweakerInput=t.tweaker,this._parent(t);var n=this;this.tweakerInput.addEvent("notification",function(e){n._dispatchNotificationObj(e)})},setValue:function(e,t){var n=this._parent,i=this;this.completeData(e,function(){n.apply(i,[e,t])})},focus:function(){var e=this;setTimeout(function(){e.elements.elementUI&&e.elements.elementUI.textInput.getElement().focus()},0)},_setValue:function(e){this._parent(e)},completeData:function(e,t){this.tweakerInput.completeData?this.tweakerInput.completeData(e,t):t()},_buildRO:function(e,t){var n=this,i=this._parent;n.showSpinner(),this.completeData(e.value,function(){i.apply(n,[e,t]),n.hideSpinner()})},_build:function(e,t){var n=this;n.showSpinner(),this.completeData(e.value,function(){n.__build(e,t),n.hideSpinner()})},__build:function(t,n){var i=this;this.tweakerInput.__switchMode(!0),require(["DS/WidgetServicesUI/infra/TweakerMVABase"],function(a){var s=!1,r=!0;i.tweakerInput.getType()===e.TYPES.RELATION&&(s=!0,r=!1);var l=new a(i.tweakerInput,{value:t.value,uniqueValue:s,reorder:r,events:{onChange:function(){var e=this.getValue(),t=[];e.forEach(function(e){t.push(e.value)}),i._dispatchChange(t)},onError:function(e){i._dispatchNotification("error",e.message)}}});n.call(this,l)})},areEquals:function(e,t){var n=e===t||e&&t&&e.length===t.length;if(e&&n)for(var i=e.length,a=0;a<i&&(n=this.tweakerInput.areEquals(e[a],t[a]));a++);return n},_computeValueForRO:function(e,t){return t&&t.forClickable?this.tweakerInput.getDisplayValue(e,{forClickable:t.forClickable}):this.tweakerInput.getDisplayValue(e)},_getValueOrDefault:function(e){return e},_changeRW:function(e){this.getElement().setValue(e),"person_wux"===this.tweakerInput.type&&this.tweakerInput.getElement().searchWidgetUI&&this.tweakerInput.getElement().searchWidgetUI.searchInput&&(this.tweakerInput.getElement().searchWidgetUI.searchInput.value=void 0,this.tweakerInput.getElement().searchWidgetUI.searchInput._editor._myInput.hasClassName("error-field")&&this.tweakerInput.getElement().searchWidgetUI.searchInput._editor._myInput.removeClassName("error-field"))}})}),define("DS/WidgetServicesUI/tweakers/TweakerDateWebUX",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/Controls/DatePicker","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a){"use strict";return n.extend({init:function(e){this._parent(e)},_build:function(e,t){var n=this,s=e.value,r=(e.mandatory,new i({value:s||void 0,timePickerFlag:!0,timePickerPrecision:"sec",placeholder:a.selectADate}));n.setClassNameForWebUXComponent(r,"input-date-label"),n.setIdForWebUXComponent(r,`tweakerDateWUX_attribute__${n.options.label}`),n.setStyleForWuxComponent(r,"width","100%"),r.addEventListener("change",function(e){var t=e.dsModel.value;n._dispatchChange(t,!0)}),r.addEventListener("livechange",function(e){var t=e.dsModel.value;n._dispatchChange(t,!0)}),t.call(n,r)},areEquals:function(e,t){var n=this._methodForDisplay();return e&&t?e[n]()===t[n]():e===t},_methodForDisplay:function(){return this.type===t.TYPES.DATE?"toLocaleDateString":"toLocaleString"},_computeValueForRO:function(t){var n=this._methodForDisplay();return t?t[n](e.getLanguage()):""},_changeRW:function(e){var t=this.getElement();this.getElement().value=t instanceof i?e||"":e}})}),define("DS/WidgetServicesUI/tweakers/TweakerNumber",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Text","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a){"use strict";return n.extend({init:function(e){this._parent(e)},_postInit:function(){this.getType()===t.TYPES.INTEGER&&(this.options.stepValue=this.options.stepValue?parseInt(this.options.stepValue):1)},_build:function(n,s){var r=this,l=""===n.value?n.value:parseFloat(n.value),o=null;if(n.placeholder)o=n.placeholder;else switch(o=a["Enter a value"],this.getType()){case t.TYPES.INTEGER:o=a["Enter an integer"];break;case t.TYPES.NUMBER:o=a["Enter a number"]}var u=new i({value:l,className:"input-number-label",placeholder:o,events:{onKeyDown:function(e){if(13===e.keyCode){var t=this;setTimeout(function(){var i=t.getValue();i=r._checkAndAdaptValue(i),n.multivalued&&(i=i.toString()),r._dispatchLiveChange(i,e)})}}}});u.elements.input.addEventListener("blur",function(){var e=u.getValue();e=r._checkAndAdaptValue(e);n.multivalued&&(e=e.toString()),r._dispatchChange(e,!0)});var c={input:function(){setTimeout(function(){var e=u.getValue();n.multivalued&&(e=e.toString()),r._dispatchLiveChange(e)})}};u.elements.input.addEvents(c);var h=n.units;if(h){var p=UWA.createElement("div",{class:"input-group"});UWA.createElement("span",{class:"input-group-addon",text:h}).inject(p),u.inject(p),u.tw_parent=p}var d=u.elements.container,v=e.getLanguage();if(d.setAttribute("type","number"),d.setAttribute("step",this.options.stepValue?this.options.stepValue:"any"),d.setAttribute("lang",v),this.options.minValue){var _=this._getMinValue();d.setAttribute("min",_)}if(this.options.maxValue){var f=this._getMaxValue();d.setAttribute("max",f)}s.call(this,u)},_computeValueForRO:function(t,n){var i=null,a=Math.pow(10,6),s=Math.pow(10,-5);if(isNaN(t)||""===t)i=this._parent(t);else{var r=parseFloat(t),l=!n||!0!==n.detailed;i=r;var o=Math.abs(r);o>0&&(o>=a||o<s)?i=r.toExponential():l&&(i=r.toString()),i=this._removeTrailingZeros(i+"");var u=e.getLanguage(),c=.1.toLocaleString(u)[1];i=i.replace(".",c)}return i},_removeTrailingZeros:function(e){return e.replace(/((\.[0-9]*[1-9])|\.)0*(([eE])|[^eE]?.?\d*$)/,"$2$4")},_checkAndAdaptValue:function(e){if(""===e)return e;var t=parseFloat(e),n=1;if(this.options.stepValue){var i=this.options.minValue?this.options.minValue:0,a=(n=this.options.stepValue)+"",s=0,r=a.indexOf(".");r<0&&(r=a.indexOf(",")),r>=0&&(s=a.length-r-1);var l=Math.pow(10,s),o=parseInt(n*l),u=parseInt((t-i)*l);t=(u-u%o+i*l)/l}if(this.options.minValue){var c=this._getMinValue();t=Math.max(t,c)}if(this.options.maxValue){var h=this._getMaxValue();t=Math.min(t,h)}return t},areEquals:function(e,t){return this._parent(e,t)||parseFloat(e)===parseFloat(t)},checkValue:function(e){var t=isNaN(e)?a["Please enter a correct value"]:null,n=null;return t&&(n={message:t}),n},_changeRW:function(e,t){null===e||""===e?this.getElement().setValue(""):(t||document.activeElement!==this.getElement().elements.input)&&this.getElement().setValue(parseFloat(e))},focus:function(){var e=this.getHTMLElement();e&&e.select()}})}),define("DS/WidgetServicesUI/tweakers/TweakerBooleanWebUX",["DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/Controls/Toggle","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,n){var i=this,a=e.value,s=new t({type:"switch",checkFlag:!0===a});i.setClassNameForWebUXComponent(s,"input-boolean-label"),s.addEventListener("change",function(e){var t=e.dsModel.checkFlag;i._dispatchChange(t),!i.options.multivalued||!0!==t&&!1!==t||i.__dispatchEvent("multivaluedBooleanChange")}),n.call(this,s)},_computeValueForRO:function(e){return!0===e?n.true:n.false},_changeRW:function(e){this.options.multivalued||(this.getElement().checkFlag=!0===e)},focus:function(){var e=this.getElement();setTimeout(function(){e.elements.input&&e.elements.input.focus()},0)}})}),define("DS/WidgetServicesUI/tweakers/TweakerEnumWebUX",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerEnumBaseWebUX","DS/UIKIT/Input/Select","DS/UIKIT/Autocomplete","DS/WidgetServices/WidgetServices","DS/Controls/ComboBox","DS/TreeModel/TreeDocument","DS/TreeModel/TreeNodeModel","DS/WUXAutoComplete/AutoComplete","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a,s,r,l,o,u){"use strict";return t.extend({_build:function(e,t){var n,i=this,l=this.__getIdFromValue(e.value),c=e.data.list,h=!0===e.data.placeholder?u.SelectOption:!!e.data.placeholder&&e.data.placeholder,p=this.options.multisel;if(void 0===p&&(p=this.options.data.list[0].valueObj._ismultisel),"_DS_ENUM_NULL_"!=c[0].value&&!1===p)for(var d=0;d<c.length;d++){if("_DS_ENUM_NULL_"===c[d].value){n=d;break}}if("_DS_ENUM_NULL_"!=c[0].value&&null!=n&&!1===p){for(var v=c[n],_=n;_>0;_--)c[_]=c[_-1];c[0]=v}var f=!0===e.customSelect,m=!0===e.sortedOptions,g=!0===e.autocomplete;if(m){var S="en";widget&&widget.lang&&(S=widget.lang),c.sort(function(e,t){return e.label.localeCompare(t.label,S,{numeric:!0})})}if(g){var w=[];for(_=0;_<c.length;_++){var E=c[_].label,I=c[_].value;w.push({label:E,value:I})}var T={elementsTree:w,multiSearchMode:!1,placeholder:u["Enter a value"],value:l},U=new o(T);U.addEventListener("change",function(e){var t=e.dsModel.value;if(D||t&&t.length>0&&t!==l){var n=i._getEnumValue(t);"_DS_ENUM_NULL_"!==n&&void 0!==n||(n=""),i._dispatchChange(n,!0)}D=!0,t||i._dispatchChange(void 0,!0)}),t.call(this,U)}else{null===l&&(this.data.value=c.length>0?this._getEnumValue(c[0].value):null);var D=!1;c=e.applySort?i.sortDropdownOptions(c,e.isMultiSel,e.type):c;for(var W=!1,k=0;k<c.length;k++)if(c[k].hasOwnProperty("group")&&c[k].group){W=!0;break}var V={};if(W){for(k=0;k<c.length;k++){var b=c[k].label,C=c[k].value,y=c[k].group,x={label:b,value:C,icon:{iconPath:c[k].icon,iconSize:{width:"16px",height:"16px"}}};V[y]=y in V?[...V[y],x]:[x]}var R=new r({shouldBeSelected:function(e){return"group"!==e.options.sectionName}});for(var k in R.prepareUpdate(),V){var O=i.createTreeNodeModel(k,void 0,void 0,"group");R.addRoot(O);for(_=0;_<V[k].length;_++){var N=V[k][_].label,M=V[k][_].value,A=V[k][_].icon,P=i.createTreeNodeModel(N,M,A,"subGroup");O.addChild(P)}}R.pushUpdate(),R.expandAll(),c=R}var F={value:l,enableSearchFlag:"click"!==e.dropdownMode,placeholder:h};W?(F.enableSearchFlag=!1,F.elementsTree=c,F.selectedIndex=1):F.elementsList=c,e.nested&&0===e.defaultValue&&(F.selectedIndex=e.defaultValue),a.isReplayedODT()&&(f=!0),F.custom=f,e.placeholder&&(h=F.placeholder=e.placeholder),!0===e.customSelect&&(F.renderTo=document.body);var L=new s(F);i.options.multivalued&&(L.displayStyle="lite"),i.setClassNameForWebUXComponent(L,"input-AuthorizedValuesboolean-label"),i.setStyleForWuxComponent(L,"width","100%"),L.addEventListener("change",function(t){var n=L.value;if(D||n!==l){var a=i._getEnumValue(n);"_DS_ENUM_NULL_"!==a&&void 0!==a||(a=""),i._dispatchChange(a,!0)}D=!0,e.multivalued&&(L.value=void 0)}),t.call(this,L);var B=this.getValue();!0===e.nested||h||l||null==B||i._dispatchChange(B,!0)}},getValue:function(){return"_DS_ENUM_NULL_"===this.data.value||void 0===this.data.value?"":this.data.value},_changeRW:function(e){var t=this._getIdFromValue(e),n=this.getElement();UWA.is(n.setValue,"function")?n.setValue(t):n.value=t},focus:function(){var e=this.getElement();setTimeout(function(){e&&e.focus()},0)},sortDropdownOptions:function(e,t,n){var i=!1,a=[],s=null,r=null;return e.forEach(function(e){"_DS_ENUM_NULL_"===e.value?(s=e,i=!0):"0_No_change"===e.value?r=e:a.push(e)}),"string"===n||"boolean"===n?a=this._sortOptionsForWebUXComboBox(a,!1):"integer"===n||"real"===n?a=this._sortOptionsForWebUXComboBox(a,!0):"timestamp"!==n&&"date"!==n||(a=this._sortOptionsForWebUXComboBoxTypeDate(a)),e=[],t&&e.push(r),i&&e.push(s),a.forEach(function(t){e.push(t)}),e},_sortOptionsForWebUXComboBox:function(e,t){return e.sort((e,n)=>e.label.localeCompare(n.label,widget&&widget.lang||"en",{caseFirst:"lower",numeric:t,sensitivity:"case"}))},_sortOptionsForWebUXComboBoxTypeDate:function(e){return e.sort(function(e,t){return new Date(e.label)-new Date(t.label)})},createTreeNodeModel:function(e,t,n,i){var a={};return e&&(a.label=e),t&&(a.grid={valueItem:t}),n&&(a.icons=[n]),i&&(a.sectionName=i),new l(a)}})}),define("DS/WidgetServicesUI/tweakers/TweakerDate",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/UIKIT/Input/Date","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService"],function(e,t,n,i,a){"use strict";return n.extend({init:function(e){this._parent(e)},_build:function(e,n){var s=this,r=e.value,l=!0!==e.mandatory;if(this.type===t.TYPES.DATE){var o=new i({value:r,showClearIcon:l,className:"input-date-label",placeholder:a.selectADate,events:{onChange:function(){if(this.elements.picker){var e=this.getDate();e?(e.setHours(12),e.setUTCHours(12)):e="",s._dispatchChange(e,!0)}}}});n.call(this,o)}else require(["DS/Controls/DatePicker"],function(e){var t=new e({value:r,timePickerFlag:!0,timePickerPrecision:"sec"});t.addEventListener("change",function(e){var t=e.dsModel.value;s._dispatchChange(t,!0)}),t.addEventListener("livechange",function(e){e.dsModel.value}),n.call(s,t)})},areEquals:function(e,t){var n=this._methodForDisplay();return e&&t?e[n]()===t[n]():e===t},_methodForDisplay:function(){return this.type===t.TYPES.DATE?"toLocaleDateString":"toLocaleString"},_computeValueForRO:function(t){var n=this._methodForDisplay();return t?t[n](e.getLanguage()):""},_changeRW:function(e){this.getElement()instanceof i?e?this.getElement().setDate(e):this.getElement().setValue(""):this.getElement().value=e}})}),define("DS/WidgetServicesUI/tweakers/TweakerPerson",["DS/WidgetServicesUI/infra/TweakerBase"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,t){var n=this;require(["DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant"],function(i,a){var s=e.value,r=a.TYPE_PERSON,l=i.getSearchWidget(i.FULL,{className:"EPP_searchPeople",MaxNumber:"3",MaxSize:"300",showEmptyCategory:!1,setBorderColor:!0,acceptEmpty:!n.options.mandatory,type:r,events:{onValid:function(){var e=l.getNewOwner();if(e.person.personFullName){var t=e.person.personFullName,i=e.person.personID;t={fullName:t,personID:i=i?i.replace(/_PRJ$/,""):i};n._dispatchChange(t,!0)}},onUnvalid:function(){var e={fullName:e=l.getDisplayedResult(),personID:null};n._dispatchChange(e)},onError:function(e){n._setError(e)}}}),o=[];e.data&&e.data.objectIDs&&e.data.objectIDs.forEach(function(e){o.push({objectID:e})}),l.setSelectedItemList(o),s&&l.setValue(s.fullName),t.call(this,l)})},actionOnScroll:function(){this.getElement()&&this.getElement().actionOnScroll()},_computeValueForRO:function(e){return e?e.fullName:""},areEquals:function(e,t){return e.personID===t.personID},_changeRW:function(e){this.getElement().setValue(e?e.fullName:"")},_getValueOrDefault:function(e){return e||{personID:"",fullName:""}}})}),define("DS/WidgetServicesUI/tweakers/TweakerNumberWebUX",["DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/UIKIT/Input/Text","DS/Controls/SpinBox","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],function(e,t,n,i,a,s){"use strict";return n.extend({init:function(e){this._parent(e)},_postInit:function(){this.getType()===t.TYPES.INTEGER_WUX&&(this.options.stepValue=this.options.stepValue?parseInt(this.options.stepValue):1)},_build:function(n,i){var r=this,l=""===n.value?n.value:parseFloat(n.value),o=null;if(n.placeholder)o=n.placeholder;else switch(o=s["Enter a value"],this.getType()){case t.TYPES.INTEGER_WUX:o=s["Enter an integer"];break;case t.TYPES.NUMBER_WUX:o=s["Enter a number"]}var u={value:l||0===l&&""!==l?l:void 0,units:n.units?n.units:"",minValue:r.options.minValue?r._getMinValue():void 0,maxValue:r.options.maxValue?r._getMaxValue():void 0,stepValue:r.options.stepValue?r.options.stepValue:1,placeholder:o,allowUndefinedFlag:!0,decimals:null,useScientificNotationFlag:!1,highExponentProperty:void 0,lowExponentProperty:void 0};"integer"===this.options.type&&(u.typingFilter=!0);var c=new a(u),h=c._myInput;h.addEventListener("blur",function(e){var t=e.target.value;t=r._checkAndAdaptValue(t);n.multivalued&&(t=t.toString()),r._dispatchChange(t,!0)}),c.addEventListener("keydown",function(e){13===e.keyCode&&setTimeout(function(){var t=c.value;t=r._checkAndAdaptValue(t),n.multivalued&&(t=t.toString()),r._dispatchLiveChange(t,e)})}),c.addEventListener("change",function(e){var t=e.dsModel.value;t=r._checkAndAdaptValue(t);r._dispatchLiveChange(t.toString())});var p="input-number-label ";r.options.multivalued&&(p+="multivaluedAttribute MVANumber"),r.setClassNameForWebUXComponent(c,p),r.setStyleForWuxComponent(c,"width","100%");var d=e.getLanguage();h.setAttribute("lang",d);var v={input:function(e){setTimeout(function(){var e=c.valueToCommit;n.multivalued&&(e=e.toString()),r._dispatchLiveChange(e)})}};c.elements.inputField.addEvents(v),i.call(this,c)},_computeValueForRO:function(t,n){var i=null,a=Math.pow(10,6),s=Math.pow(10,-5);if(isNaN(t)||""===t)i=this._parent(t);else{var r=parseFloat(t),l=!n||!0!==n.detailed;i=r;var o=Math.abs(r);o>0&&(o>=a||o<s)?i=r.toExponential():l&&(i=r.toString()),i=this._removeTrailingZeros(i+"");var u=e.getLanguage(),c=.1.toLocaleString(u)[1];i=i.replace(".",c)}return i},_removeTrailingZeros:function(e){return e.replace(/((\.[0-9]*[1-9])|\.)0*(([eE])|[^eE]?.?\d*$)/,"$2$4")},_checkAndAdaptValue:function(e){if(""===e)return e;var t=parseFloat(e),n=1;if(this.options.stepValue){var i=this.options.minValue?this.options.minValue:0,a=(n=this.options.stepValue)+"",s=0,r=a.indexOf(".");r<0&&(r=a.indexOf(",")),r>=0&&(s=a.length-r-1);var l=Math.pow(10,s),o=parseInt(n*l),u=parseInt((t-i)*l);t=(u-u%o+i*l)/l}if(this.options.minValue){var c=this._getMinValue();t=Math.max(t,c)}if(this.options.maxValue){var h=this._getMaxValue();t=Math.min(t,h)}return t},areEquals:function(e,t){return this._parent(e,t)||parseFloat(e)===parseFloat(t)},checkValue:function(e){var t=isNaN(e)?s["Please enter a correct value"]:null,n=null;return t&&(n={message:t}),n},_changeRW:function(e,t){null===e||""===e?this.getElement().value=void 0:(t||document.activeElement!==this.getElement().elements.input)&&(this.getElement().value=parseFloat(e))},focus:function(){var e=this.getHTMLElement();e&&e.select()}})}),define("DS/WidgetServicesUI/tweakers/TweakerPersonWebUX",["DS/WidgetServicesUI/infra/TweakerBaseWebUX"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)},_build:function(e,t){var n=this;require(["DS/SearchWidget/SearchWidget","DS/SearchWidget/SearchWidgetConstant"],function(i,a){var s=e.value,r=a.TYPE_PERSON,l=i.getSearchWidget(i.FULL,{className:"EPP_searchPeople",MaxNumber:"3",MaxSize:"300",showEmptyCategory:!1,setBorderColor:!0,acceptEmpty:!n.options.mandatory,type:r,tw_type:n.options.tw_type,events:{onValid:function(){var e=l.getNewOwner();if(e&&e.person&&e.person.personFullName){var t=e.person.personFullName,i=e.person.personID;t={fullName:t,personID:i=i?i.replace(/_PRJ$/,""):i};n._dispatchChange(t,!0)}},onUnvalid:function(){var e={fullName:e=l.getDisplayedResult(),personID:null};n._dispatchChange(e)},onError:function(e){n._setError(e)}}}),o=[];e.data&&e.data.objectIDs&&e.data.objectIDs.forEach(function(e){o.push({objectID:e})}),l.setSelectedItemList(o),s&&l.setValue(s.fullName),t.call(this,l)})},actionOnScroll:function(){this.getElement()&&this.getElement().actionOnScroll()},_computeValueForRO:function(e){return e?e.fullName:""},areEquals:function(e,t){return e.personID===t.personID},_changeRW:function(e){},_getValueOrDefault:function(e){return e||{personID:"",fullName:""}}})}),define("DS/WidgetServicesUI/helpers/Helpers",["DS/WidgetServices/MultipleAsynchronousRequests","DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/tweakers/TweakerPerson","DS/WidgetServicesUI/tweakers/TweakerString","DS/WidgetServicesUI/tweakers/TweakerNumber","DS/WidgetServicesUI/tweakers/TweakerDate","DS/WidgetServicesUI/tweakers/TweakerBoolean","DS/WidgetServicesUI/tweakers/TweakerOutput","DS/WidgetServicesUI/tweakers/TweakerNumberWebUX","DS/WidgetServicesUI/tweakers/TweakerStringWebUX","DS/WidgetServicesUI/tweakers/TweakerDateWebUX","DS/WidgetServicesUI/tweakers/TweakerBooleanWebUX","DS/WidgetServicesUI/tweakers/TweakerPersonWebUX","DS/WidgetServicesUI/tweakers/TweakerEnumWebUX","DS/WidgetServicesUI/tweakers/TweakerMVAWebUX"],function(e,t,n,i,a,s,r,l,o,u,c,h,p,d,v){var _={},f={};f[t.TYPES.BOOLEAN]={req:"DS/WidgetServicesUI/tweakers/TweakerBoolean"},f[t.TYPES.STRING]={req:"DS/WidgetServicesUI/tweakers/TweakerString"},f[t.TYPES.NUMBER]={req:"DS/WidgetServicesUI/tweakers/TweakerNumber"},f[t.TYPES.INTEGER]={req:"DS/WidgetServicesUI/tweakers/TweakerNumber"},f[t.TYPES.ENUM]={req:"DS/WidgetServicesUI/tweakers/TweakerEnum"},f[t.TYPES.PERSON]={req:"DS/WidgetServicesUI/tweakers/TweakerPerson"},f[t.TYPES.DATE]={req:"DS/WidgetServicesUI/tweakers/TweakerDate"},f[t.TYPES.DATETIME]={req:"DS/WidgetServicesUI/tweakers/TweakerDate"},f[t.TYPES.HTML]={req:"DS/WidgetServicesUI/tweakers/TweakerHTML"},f[t.TYPES.OUTPUT]={req:"DS/WidgetServicesUI/tweakers/TweakerOutput"},f[t.TYPES.BUTTONWEB]={req:"DS/WidgetServicesUI/tweakers/TweakerButtonWeb"},f[t.TYPES.DROPDOWN]={req:"DS/WidgetServicesUI/tweakers/TweakerDropdown"},f[t.TYPES.REPLACEMENT]={req:"DS/WidgetServicesUI/tweakers/TweakerReplacement"},f[t.SPE_TYPES.MVA]={req:"DS/WidgetServicesUI/tweakers/TweakerMVA"},f[t.TYPES.IMAGE]={req:"DS/WidgetServicesUI/tweakers/TweakerImage"},f[t.TYPES.MULTIPLE]={req:"DS/WidgetServicesUI/tweakers/TweakerMultiple"},f[t.TYPES.RELATION]={req:"DS/WidgetServicesUI/tweakers/TweakerRelation"},f[t.TYPES.BOOLEAN_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerBooleanWebUX"},f[t.TYPES.NUMBER_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerNumberWebUX"},f[t.TYPES.INTEGER_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerNumberWebUX"},f[t.TYPES.STRING_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerStringWebUX"},f[t.TYPES.DATE_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerDateWebUX"},f[t.TYPES.DATETIME_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerDateWebUX"},f[t.TYPES.PERSON_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerPersonWebUX"},f[t.TYPES.ENUM_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerEnumWebUX"},f[t.SPE_TYPES.MVA_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerMVAWebUX"},f[t.TYPES.MULTIPLE_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerMultipleWebUX"},f[t.TYPES.REPLACEMENT_WUX]={req:"DS/WidgetServicesUI/tweakers/TweakerReplacementWebUX"},f[t.TYPES.DUMMY_BOOKMARK]={req:"DS/WidgetServicesUI/tweakers/TweakerDummyBookmark"};var m=function(e,t,n){_[e]={element:n,requireStr:t}},g=function(e,t,n){var i=_[e];if(i&&i.requireStr===t)n.call(null,i.element);else require([t],function(i){m(e,t,i),n.call(null,i)})};return m(t.TYPES.STRING,f[t.TYPES.STRING].req,i),m(t.TYPES.PERSON,f[t.TYPES.PERSON].req,n),m(t.TYPES.NUMBER,f[t.TYPES.NUMBER].req,a),m(t.TYPES.INTEGER,f[t.TYPES.INTEGER].req,a),m(t.TYPES.DATETIME,f[t.TYPES.DATETIME].req,s),m(t.TYPES.DATE,f[t.TYPES.DATE].req,s),m(t.TYPES.OUTPUT,f[t.TYPES.OUTPUT].req,l),m(t.TYPES.STRING_WUX,f[t.TYPES.STRING_WUX].req,u),m(t.TYPES.NUMBER_WUX,f[t.TYPES.NUMBER_WUX].req,o),m(t.TYPES.INTEGER_WUX,f[t.TYPES.INTEGER_WUX].req,o),m(t.TYPES.DATETIME_WUX,f[t.TYPES.DATETIME_WUX].req,c),m(t.TYPES.DATE_WUX,f[t.TYPES.DATE_WUX].req,c),m(t.TYPES.PERSON_WUX,f[t.TYPES.PERSON_WUX].req,p),{getTweaker:function(n,i,a){var s,r=this,l=!0===i.multivalued,o=n!==t.TYPES.ENUM&&n!==t.TYPES.ENUM_WUX&&i.data&&void 0!==i.data.list,u=o&&i.data&&!1!==i.data.range_required,c=!0===i.multisel,h=["A"];l&&h.push("B"),o&&h.push("C"),c&&h.push("D");var p=new e(h,function(){var e=this.getAnswer("A"),s=this.getAnswer("B"),l=this.getAnswer("C"),o=this.getAnswer("D");s&&(l||n===t.TYPES.ENUM)&&(i.data=i.data?i.data:{},i.data.placeholder=!i.data.placeholder||i.data.placeholder);var u=UWA.clone(i);u.tw_type=n,s||o?(u.value=null,u.nested=null!=s||null!=o,u.events={}):l||(u.value=i.value);var c=new e(u);if(l){var h=null!=s||null!=o,p=s?UWA.clone(u):UWA.clone(i);p.tweaker=c,p.nested=null!=s||null!=o,p.value=h?null:i.value,c=new l(p)}if(s){h=null!=o;var d=UWA.clone(i);d.tweaker=c,d.nested=null!=o,d.value=h?[]:i.value,d.events=h?{}:d.events,c=new s(d)}if(o){var v=UWA.clone(i);v.tweaker=c,v.value=i.value,c=new o(v)}a.call(r,c)});if(l&&!r.isTwTypeIsWUX(n)?g(t.SPE_TYPES.MVA,"DS/WidgetServicesUI/tweakers/TweakerMVA",function(e){p.setAnswer("B",e)}):l&&r.isTwTypeIsWUX(n)&&g(t.SPE_TYPES.MVA_WUX,f[t.SPE_TYPES.MVA_WUX].req,function(e){p.setAnswer("B",e)}),o&&!r.isTwTypeIsWUX(n)){var d=u?t.TYPES.ENUM:t.TYPES.DROPDOWN;g(t.SPE_TYPES.ENUM,f[d].req,function(e){p.setAnswer("C",e)})}else if(o&&r.isTwTypeIsWUX(n)){d=u?t.TYPES.ENUM_WUX:t.TYPES.DROPDOWN;g(t.SPE_TYPES.ENUM,f[d].req,function(e){p.setAnswer("C",e)})}c&&!r.isTwTypeIsWUX(n)?g(t.TYPES.MULTIPLE,f[t.TYPES.MULTIPLE].req,function(e){p.setAnswer("D",e)}):c&&r.isTwTypeIsWUX(n)&&g(t.TYPES.MULTIPLE_WUX,f[t.TYPES.MULTIPLE_WUX].req,function(e){p.setAnswer("D",e)});var v=f[n];v||(v=!0===i.readOnly?f[t.TYPES.OUTPUT]:f[t.TYPES.STRING]),s=v.req,!0===window.top.isDebug&&console.log("Load Tweaker "+n+" : "+window.top.performance.now()),g(n,s,function(e){!0===window.top.isDebug&&console.log("Tweaker Loaded "+n+" : "+window.top.performance.now()),p.setAnswer("A",e)})},getAdvTweaker:function(e,n,i){var a=this,s=null;switch(n.touchMode=!0,e){case t.TYPES.BOOLEAN:s="DS/Tweakers/TweakerBoolean";break;case t.TYPES.NUMBER:s="DS/Tweakers/TweakerNumber";break;default:s=null}null!==s?g(e,s,function(e){var t=new e(n);if(n.events)for(var s in n.events)t.addEventListener(s,n.events[s]);i.call(a,t)}):this.getTweaker(e,n.value,n,i)},isTwTypeIsWUX:function(e){return e===t.TYPES.BOOLEAN_WUX||e===t.TYPES.STRING_WUX||e===t.TYPES.NUMBER_WUX||e===t.TYPES.INTEGER_WUX||e===t.TYPES.DATE_WUX||e===t.TYPES.DATETIME_WUX||e===t.TYPES.PERSON_WUX||e===t.TYPES.ENUM_WUX}}}),define("DS/WidgetServicesUI/tweakers/TweakerMultipleWebUX",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBaseWebUX","DS/WidgetServicesUI/helpers/Helpers","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/Controls/TooltipModel","DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/tweakers/TweakerStringWebUX","DS/WidgetServicesUI/tweakers/TweakerWUXButton","UWA/Core","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],function(e,t,n,i,a,s,r,l,o,u,c){"use strict";return t.extend({_tweakerInput:null,_tweakerBuilt:!1,_editorStatus:"single",_multipleChoices:!1,_nbSelectCreated:0,_selectValueList:null,init:function(t){this._tweakerBuilt=!1,this._multipleChoices=!1,this._editorStatus="replace",this._nbSelectCreated=0,this.type=e.SPE_TYPES.MULTISEL,this._tweakerInput=t.tweaker,this._parent(t)},getDisplayValues:function(e,t){if(t&&!0===t.singleLine)return this._parent(e,t);var n={},i=this.getValue();for(var a in i)n[a]=this._tweakerInput.getDisplayValues(i[a],{forHTML:!1});return n},_generateValueForSelectTweaker:function(e,t,n){var i=this,a=null;if(t.length>1&&(!this.elements.replacementContainer||this.elements.replacementContainer.getValue()!==n)){var s=u.clone(n);s._ismultisel=!0;a=[{value:s,label:u.i18n("tw_multiple_noChange")}];e.forEach(function(e){var t=i._tweakerInput.getDisplayValue(e,{escapeChar:!1,forHTML:!1});a.push({value:e,label:t})})}return a},_build:function(e,t){this.elements.twMulticontainer=u.createElement("div",{class:"tweaker_multiSelContainer"}),this.elements.inputContainer=u.createElement("div",{class:"tweaker_inputContainer"});var n=this._getSingleValues(this.getValue()),i=this._limitValForRange(n);this._selectValueList=u.clone(i);var a=this._generateValueForSelectTweaker(i,n,this.getValue());a&&a.length>1?this._buildSelect(a):i.length>0&&(i.length>1?this._tweakerInput.setValue(i):this._tweakerInput.setValue(i[0])),this._switchToTweaker(),this.elements.inputContainer.inject(this.elements.twMulticontainer),t.call(this,this.elements.twMulticontainer)},_setValueOnData:function(e){var t=null!==e&&void 0!==e._ismultisel,n=u.clone(this.getValue());for(var i in n)n[i]=t?e[i]:e;return n},_computeValueForRO:function(e,t){if("object"==typeof e){var n=[];for(var i in e){var a=e[i];if(t&&t.forClickable)var s=this._tweakerInput.getDisplayValue(a,{forClickable:!0});else s=this._tweakerInput.getDisplayValue(a);n.indexOf(s)<0&&n.push(s)}var r=n.length>1?"("+c.get("tw_multiple_prefix")+") ":"";return r+=n.join(", ")}return t&&t.forClickable?this._tweakerInput.getDisplayValue(e,{forClickable:!0}):this._tweakerInput.getDisplayValue(e)},_buildButton:function(){var e=this;if(!this.elements.addButton){var t={className:"tw_multiple_switch",icon:"plus",clickCallback:function(){e._switchToTweaker()}};this.elements.addButton=new o(t),this.elements.addButton.tooltipInfos=new s({shortHelp:c.get("Define for all"),mouseRelativePosition:!0}),this.elements.addButton.inject(this.elements.twMulticontainer)}},_buildReplacement:function(t){var i=this;if(!this.elements.replacementContainer){var a={value:u.clone(t),readOnly:!1,editable:!0,nested:!0,events:{change:function(e){i.__dispatchValueFromTweaker(this,e)},notification:this._dispatchNotificationObj.bind(this)},isMultiSel:!0};i.options.prop&&(a.prop=!0,a.defaultValue=0),i.options.applySort&&(a.applySort=i.options.applySort),i.options.type&&(a.type=i.options.type),n.getTweaker(e.TYPES.REPLACEMENT_WUX,a,function(e){i.elements.replacementContainer||(i.elements.replacementContainer=e),"replace"===i._editorStatus&&(i.elements.replacementContainer.inject(i.elements.inputContainer),i.__dispatchValueFromTweaker(i.elements.replacementContainer))})}},_buildSelect:function(t){var i=this;this._buildButton(),this._tweakerInput instanceof l&&this._buildReplacement(this.getValue()),this._multipleChoices=!0,this.elements.select&&(this.elements.select.destroy(),delete this.elements.select);var a={data:{list:t},readOnly:!1,editable:!0,nested:!0,events:{change:function(e){i.__dispatchValueFromTweaker(this,e)}},isMultiSel:!0};i.options.prop&&(a.prop=!0,a.defaultValue=0),i.options.applySort&&(a.applySort=i.options.applySort),i.options.type&&(a.type=i.options.type),this._nbSelectCreated++;var s=this._nbSelectCreated;n.getTweaker(e.TYPES.ENUM_WUX,a,function(e){s===i._nbSelectCreated&&(i.elements.select=e,"multiple"===i._editorStatus&&(i.elements.select.inject(i.elements.inputContainer),i.__dispatchValueFromTweaker(i.elements.select)))})},_switchToTweaker:function(){var e=this._tweakerInput instanceof l;"multiple"!==this._editorStatus&&this._multipleChoices?"single"===this._editorStatus&&e?this._editorStatus="replace":this._editorStatus="multiple":this._editorStatus="single";var t=null;this.elements.inputContainer.empty();var n=null;"single"===this._editorStatus?(this._tweakerBuilt||this._buildTweaker(),t=e?"replace":"close",this.elements.addButton&&(this.elements.addButton.icon={iconName:t,fontIconFamily:WUXManagedFontIcons.Font3DS}),n=this._tweakerInput):"multiple"===this._editorStatus?(t="plus",this.elements.addButton.icon={iconName:t,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},n=this.elements.select):"replace"===this._editorStatus&&(t="close",this.elements.addButton.icon={iconName:t,fontIconFamily:WUXManagedFontIcons.Font3DS,fontIconSize:"1x"},n=this.elements.replacementContainer),this.elements&&this.elements.addButton&&this.elements.addButton.tooltipInfos&&("plus"===t&&(this.elements.addButton.tooltipInfos.shortHelp=c.get("Define for all")),"close"===t&&(this.elements.addButton.tooltipInfos.shortHelp=c.get("Set existing")),"replace"===t&&(this.elements.addButton.tooltipInfos.shortHelp=c.get("Replace with RegExp"))),null!=n&&(n.inject(this.elements.inputContainer),this.__dispatchValueFromTweaker(n))},__dispatchValueFromTweaker:function(e,t,n){null==t&&(t=e.getValue());var i=t;"replace"!==this._editorStatus&&(i=this._setValueOnData(t)),!0===n?this._dispatchLiveChange(i):this._dispatchChange(i)},_buildTweaker:function(){var e=this;this._tweakerBuilt=!0,this._tweakerInput.__switchMode(!0),this._tweakerInput.addEvent("change",function(){var t=this.getValue();e.__dispatchValueFromTweaker(this,t)}),this._tweakerInput.addEvent("liveChange",function(){var t=this.getValue();e.__dispatchValueFromTweaker(this,t,!0)})},areEquals:function(e,t){var n=Object.keys(e),i=Object.keys(t),a=e===t||e&&t&&n.length===i.length;if(e&&a)for(var s in e){var r=e[s],l=t[s];if(!(a=this._tweakerInput.areEquals(r,l)))break}return a},_getSingleValues:function(e){var t=this,n=[];for(var i in e){var a=e[i];r.arrayContains2(n,a,function(e,n){return t._tweakerInput.areEquals(e,n)})<0&&n.push(a)}return n},_limitValForRange:function(e){if(this.options&&this.options.data&&this.options.data.range_required&&this.options.data.list){var t=[],n=[],i=new Map;for(var a in this.options.data.list)t.push(this.options.data.list[a].value),n.push(this.options.data.list[a].label),i.set(this.options.data.list[a].label,this.options.data.list[a].value);var s=[];e.forEach(function(e){Array.isArray(e)?e.forEach(function(e){s.push(e)}):s.push(e)});var r=s.filter(function(e,n,i){return t.indexOf(e)>-1});if(this.options.multivalued&&this.options.trueEnum&&!r.length){r=s.filter(function(e,t,i){return n.indexOf(e)>-1});for(a=0;a<r.length;a++)r[a]&&i.has(r[a])&&(r[a]=i.get(r[a]))}return r}return e},_getValueOrDefault:function(e){return e},_changeRW:function(e){var t=this._getSingleValues(e),n=this._limitValForRange(t),i=this._generateValueForSelectTweaker(n,t,e),a=n&&1==n.length?n[0]:null;1==this.options.multivalued&&n&&1==n.length&&(a=n),null!=a&&this._tweakerInput.setValue(a),i&&i.length>1&&!this.areEquals(this._selectValueList,e)&&(this._selectValueList=u.clone(e),this._buildSelect(i))}})}),define("DS/WidgetServicesUI/tweakers/TweakerMultiple",["DS/WidgetServicesUI/helpers/Constants","DS/WidgetServicesUI/infra/TweakerBase","DS/WidgetServicesUI/helpers/Helpers","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/WidgetServices/WidgetServices","DS/WidgetServicesUI/tweakers/TweakerString","UWA/Core","i18n!DS/WidgetServicesUI/assets/nls/i18nWidgetService","css!DS/WidgetServicesUI/WidgetServicesUI"],function(e,t,n,i,a,s,r,l,o,u){"use strict";return t.extend({_tweakerInput:null,_tweakerBuilt:!1,_editorStatus:"single",_multipleChoices:!1,_nbSelectCreated:0,_selectValueList:null,init:function(t){this._tweakerBuilt=!1,this._multipleChoices=!1,this._editorStatus="replace",this._nbSelectCreated=0,this.type=e.SPE_TYPES.MULTISEL,this._tweakerInput=t.tweaker,this._parent(t)},getDisplayValues:function(e,t){if(t&&!0===t.singleLine)return this._parent(e,t);var n={},i=this.getValue();for(var a in i)n[a]=this._tweakerInput.getDisplayValues(i[a],{forHTML:!1});return n},_generateValueForSelectTweaker:function(e,t,n){var i=this,a=null;if(t.length>1&&(!this.elements.replacementContainer||this.elements.replacementContainer.getValue()!==n)){var s=o.clone(n);s._ismultisel=!0;a=[{value:s,label:o.i18n("tw_multiple_noChange")}];e.forEach(function(e){var t=i._tweakerInput.getDisplayValue(e,{escapeChar:!1,forHTML:!1});a.push({value:e,label:t})})}return a},_build:function(e,t){this.elements.twMulticontainer=o.createElement("div",{class:"tweaker_multiSelContainer"}),this.elements.inputContainer=o.createElement("div",{class:"tweaker_inputContainer"});var n=this._getSingleValues(this.getValue()),i=this._limitValForRange(n);this._selectValueList=o.clone(i);var a=this._generateValueForSelectTweaker(i,n,this.getValue());a&&a.length>1?this._buildSelect(a):i.length>0&&(i.length>1?this._tweakerInput.setValue(i):this._tweakerInput.setValue(i[0])),this._switchToTweaker(),this.elements.inputContainer.inject(this.elements.twMulticontainer),t.call(this,this.elements.twMulticontainer)},_setValueOnData:function(e){var t=null!==e&&void 0!==e._ismultisel,n=o.clone(this.getValue());for(var i in n)n[i]=t?e[i]:e;return n},_computeValueForRO:function(e,t){if("object"==typeof e){var n=[];for(var i in e){var a=e[i];if(t&&t.forClickable)var s=this._tweakerInput.getDisplayValue(a,{forClickable:!0});else s=this._tweakerInput.getDisplayValue(a);n.indexOf(s)<0&&n.push(s)}var r=n.length>1?"("+u.get("tw_multiple_prefix")+") ":"";return r+=n.join(", ")}return t&&t.forClickable?this._tweakerInput.getDisplayValue(e,{forClickable:!0}):this._tweakerInput.getDisplayValue(e)},_buildButton:function(){var e=this;this.elements.addButton||(this.elements.addButton=new a({className:"tw_multiple_switch",icon:"plus",events:{onClick:function(){e._switchToTweaker()}}}),this.elements.tooltipButton=new s({target:this.elements.addButton.getContent(),body:u.get("Define for all")}),this.elements.addButton.inject(this.elements.twMulticontainer))},_buildReplacement:function(t){var i=this;if(!this.elements.replacementContainer){var a={value:o.clone(t),readOnly:!1,editable:!0,nested:!0,events:{change:function(e){i.__dispatchValueFromTweaker(this,e)},notification:this._dispatchNotificationObj.bind(this)},isMultiSel:!0};i.options.prop&&(a.prop=!0,a.defaultValue=0),i.options.applySort&&(a.applySort=i.options.applySort),i.options.type&&(a.type=i.options.type),n.getTweaker(e.TYPES.REPLACEMENT,a,function(e){i.elements.replacementContainer||(i.elements.replacementContainer=e),"replace"===i._editorStatus&&(i.elements.replacementContainer.inject(i.elements.inputContainer),i.__dispatchValueFromTweaker(i.elements.replacementContainer))})}},_buildSelect:function(t){var i=this;this._buildButton(),this._tweakerInput instanceof l&&this._buildReplacement(this.getValue()),this._multipleChoices=!0,this.elements.select&&(this.elements.select.destroy(),delete this.elements.select);var a={data:{list:t},readOnly:!1,editable:!0,nested:!0,events:{change:function(e){i.__dispatchValueFromTweaker(this,e)}},isMultiSel:!0};i.options.prop&&(a.prop=!0,a.defaultValue=0),i.options.applySort&&(a.applySort=i.options.applySort),i.options.type&&(a.type=i.options.type),this._nbSelectCreated++;var s=this._nbSelectCreated;n.getTweaker(e.TYPES.ENUM,a,function(e){s===i._nbSelectCreated&&(i.elements.select=e,"multiple"===i._editorStatus&&(i.elements.select.inject(i.elements.inputContainer),i.__dispatchValueFromTweaker(i.elements.select)))})},_switchToTweaker:function(){var e=this._tweakerInput instanceof l;"multiple"!==this._editorStatus&&this._multipleChoices?"single"===this._editorStatus&&e?this._editorStatus="replace":this._editorStatus="multiple":this._editorStatus="single";var t=null;this.elements.inputContainer.empty();var n=null;"single"===this._editorStatus?(this._tweakerBuilt||this._buildTweaker(),t=e?"replace":"close",this.elements.addButton&&this.elements.addButton.setIcon(t),n=this._tweakerInput):"multiple"===this._editorStatus?(t="plus",this.elements.addButton.setIcon(t),n=this.elements.select):"replace"===this._editorStatus&&(t="close",this.elements.addButton.setIcon(t),n=this.elements.replacementContainer),this.elements.tooltipButton&&("plus"===t&&this.elements.tooltipButton.setBody(u.get("Define for all")),"close"===t&&this.elements.tooltipButton.setBody(u.get("Set existing")),"replace"===t&&this.elements.tooltipButton.setBody(u.get("Replace with RegExp"))),null!=n&&(n.inject(this.elements.inputContainer),this.__dispatchValueFromTweaker(n))},__dispatchValueFromTweaker:function(e,t,n){null==t&&(t=e.getValue());var i=t;"replace"!==this._editorStatus&&(i=this._setValueOnData(t)),!0===n?this._dispatchLiveChange(i):this._dispatchChange(i)},_buildTweaker:function(){var e=this;this._tweakerBuilt=!0,this._tweakerInput.__switchMode(!0),this._tweakerInput.addEvent("change",function(){var t=this.getValue();e.__dispatchValueFromTweaker(this,t)}),this._tweakerInput.addEvent("liveChange",function(){var t=this.getValue();e.__dispatchValueFromTweaker(this,t,!0)})},areEquals:function(e,t){var n=Object.keys(e),i=Object.keys(t),a=e===t||e&&t&&n.length===i.length;if(e&&a)for(var s in e){var r=e[s],l=t[s];if(!(a=this._tweakerInput.areEquals(r,l)))break}return a},_getSingleValues:function(e){var t=this,n=[];for(var i in e){var a=e[i];r.arrayContains2(n,a,function(e,n){return t._tweakerInput.areEquals(e,n)})<0&&n.push(a)}return n},_limitValForRange:function(e){if(this.options&&this.options.data&&this.options.data.range_required&&this.options.data.list){var t=[],n=[],i=new Map;for(var a in this.options.data.list)t.push(this.options.data.list[a].value),n.push(this.options.data.list[a].label),i.set(this.options.data.list[a].label,this.options.data.list[a].value);var s=[];e.forEach(function(e){Array.isArray(e)?e.forEach(function(e){s.push(e)}):s.push(e)});var r=s.filter(function(e,n,i){return t.indexOf(e)>-1});if(this.options.multivalued&&this.options.trueEnum&&!r.length){r=s.filter(function(e,t,i){return n.indexOf(e)>-1});for(a=0;a<r.length;a++)r[a]&&i.has(r[a])&&(r[a]=i.get(r[a]))}return r}return e},_getValueOrDefault:function(e){return e},_changeRW:function(e){var t=this._getSingleValues(e),n=this._limitValForRange(t),i=this._generateValueForSelectTweaker(n,t,e),a=n&&1==n.length?n[0]:null;1==this.options.multivalued&&n&&1==n.length&&(a=n),null!=a&&this._tweakerInput.setValue(a),i&&i.length>1&&!this.areEquals(this._selectValueList,e)&&(this._selectValueList=o.clone(e),this._buildSelect(i))}})});