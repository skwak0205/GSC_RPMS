define("DS/XSRCommonComponents/components/XSpecDnD/DragDropUtil",["UWA/Core","UWA/Class","DS/DataDragAndDrop/DataDragAndDrop","DS/XSRCommonComponents/components/XSpecDnD/DnDInvite","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/TypeUtils","DS/XSRCommonComponents/utils/TypeServicesUtil","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,o,a,n,i,r,s,d,p,l){"use strict";return t.extend({init:function(e){this.modelEvents=e?e.modelEvents:void 0},makeDragable:function(e,t){var a={data:this.prepareDragData(t),start:function(e,t){console.log("##drag start"),i.dragStartedInXSR=!0},stop:function(e){i.dragStartedInXSR=!1,console.log("###drag end")}};o.draggable(e,a)},_makeDropable:function(t){var a={enter:function(o,a){"function"===e.typeOf(t.onDragEnter)&&t.onDragEnter.apply(t.context,[o,a])},leave:function(o,a){"function"===e.typeOf(t.onDragLeave)&&t.onDragLeave.apply(t.context,[o,a])},over:function(o,a){"function"===e.typeOf(t.onDragOver)&&t.onDragOver.apply(t.context,[o,a])},drop:function(o,a,n){"function"===e.typeOf(t.onDrop)&&t.onDrop.apply(t.context,[o,a,n])}};o.droppable(t.element,a)},makeDroppable:function(e,t){var o=this,r=e,c=new a({renderTo:r});c.hide(),this._makeDropable({element:e,context:this,onDragEnter:function(){!0!==i.dragStartedInXSR?(console.log("On drag Enter"),c.addBorder(),c.show(t),r.hasClassName("dragging")||r.addClassName("dragging")):r.removeClassName("dragging")},onDragLeave:function(){console.log("On drag leave"),c.hide(),r.hasClassName("dragging")&&r.removeClassName("dragging")},onDragOver:function(){console.log("On drag over"),!0!==i.dragStartedInXSR&&(c.show(t),r.hasClassName("dragging")||r.addClassName("dragging"))},onDrop:function(e,a){if(console.log("On drop"),!0!==i.dragStartedInXSR){var g;if(c.hide(),r.removeClassName("dragging"),e)if((g=JSON.parse(e)).data.items||g.data.DataGridView_Row_Options){console.log("Droppedddddddd"),console.log(g);var m,D=g.data.DataGridView_Row_Options;m=D?1:g.data.items.length;var u=g.data.items||o.getDataFromGrid(D);if(!(u.length<=0))if("insert"===t||"insertMultiGrid"===t||"insertMbmfFacets"===t){for(var v=[],y=[],f=0;f<u.length;f++){var I=u[f];if(d.isPhysicalProduct(I.objectType))v.push({id:I.objectId});else{var C=l.replace(l.get("CannotInsert"),{Name:I.displayName});y.push(C),s.displayNotification({eventID:"error",msg:C})}}"insert"===t?o.modelEvents.publish({event:"xsr-add-item-on-drop",data:v}):"insertMultiGrid"===t?o.modelEvents.publish({event:"attr-multigrid-item-on-drop",data:{items:v,fromWidget:g.widgetId,src:g.source}}):"insertMbmfFacets"===t&&o.modelEvents.publish({event:"xsr-add-item-on-drop-MakeFrom",data:v})}else"drop"===t&&(m>1?s.displayNotification({eventID:"error",msg:l.NoMultipleDrop}):i.isValidItemOnOpen(u[0].objectType)?o.modelEvents.publish({event:n.OPEN_SPECIFICATION_VIEW,data:{itemPid:u[0].objectId,typeActual:u[0].objectType}}):(new p).isValidItemToOpen(u[0].objectType).then(t=>{t.isValidType?(e={objectType:u[0].objectType,displayType:u[0].displayType},t.isRawM?d.addToRawMaterial([e]):d.addToPhysicalProduct([e]),o.modelEvents.publish({event:n.OPEN_SPECIFICATION_VIEW,data:{itemPid:u[0].objectId,typeActual:u[0].objectType}})):s.displayNotification({eventID:"error",msg:l.UnsupportedDrop})}))}else s.displayNotification({eventID:"error",msg:l.Invalidcontent});else s.displayNotification({eventID:"error",msg:l.Invalidcontent})}}})},cleanDroppable:function(e){o.clean(e)},getDataFromGrid:function(e){var t=e["dswebux/x-datagridview.row.options.grid+json"];if(t){var o={protocol:"3DXContent",version:"1.1",source:"ENOSPEC_AP",widgetId:widget.id,data:{items:[]}},a=[];if(Array.isArray(t))t.forEach(function(e){var t={envId:r.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:"",objectId:e.physicalId,objectType:e["ds6w:type_value"],displayName:e["ds6w:label"],displayType:e["ds6w:type"]};a.push(t)});else{var i={envId:r.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:"",objectId:t.physicalId,objectType:t["ds6w:type_value"],displayName:t["ds6w:label"],displayType:t["ds6w:type"]};a.push(i)}return o.data.items=a,a}},prepareDragData:function(e){var t={protocol:"3DXContent",version:"1.1",source:"ENOSPEC_AP",widgetId:widget.id,data:{items:[]}},o=[];return e.forEach(function(e){var t={envId:r.getPlatformId(),serviceId:n.SERVICE_3DSPACE_NAME,contextId:"",objectId:e.getID?e.getID():e.options.grid.id,objectType:e.getTypeActualName?e.getTypeActualName():e.options.grid.typeDBName,displayName:e.getLabel?e.getLabel():e.options.grid.label,displayType:e.getType?e.getType():e.options.grid.type};o.push(t)}),t.data.items=o,JSON.stringify(t)}})});