define("DS/XSRCommonComponents/components/XSpecFilter/XSpecTagger",["UWA/Class","DS/ENOFilterBIUX/FilterBIComponentProxy","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/XSRMask","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/Notification","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(t,e,n,o,i,s,r,a){"use strict";var l=null;return t.extend({init:function(t){this.initFilterBIProxy()},initFilterBIProxy:function(t,o){var i={tenant:s.getPlatformId(),processingMode:"appProcessing",colorize:!0,appId:n.XSR_APP_ID,widgetId:widget.id,appQueryParam:{"q.iterative_filter_query_bo":'[ds6w:globalType]:"ds6w:Document" OR [ds6w:globalType]:"ds6w:Part"',no_type_filter_rel:["XCADBaseDependency"]}};this.contextItemNodes=[],this.contextItemIds=[],l=new e(i);var r={expandServices:"expand",appID:n.XSR_APP_ID};return l.setNGFilterOptions(r),this.addEvents(),this.taggerProxy=l,l},addEvents:function(){l.addEvent("fetchFilterBIFilteringEvent",this.onFilterBIFilteringEvent.bind(this)),l.addEvent("fetchFilterBIColorizeEvent",this.onFilterBIColorize.bind(this)),l.addEvent("FilterBIUnColorize",this.onFilterBIUnColorize.bind(this))},onFilterBIFilteringEvent:function(t){Object.keys(t.allfilters).length>0&&(i.maskLoader(this.container,"Filtering..."),i.loader.getContent().style.opacity=1,this.getContextItems().forEach(function(e){t.matchingIDs&&-1===t.matchingIDs.indexOf(e.getID())?e.setTaggerFilterState(!1):e.setTaggerFilterState(!0),e.applyFilters()})),this._updateFilterProxy(t)},_updateFilterProxy:function(t){var e=!1,n=[],o=[];if(t)if(Object.keys(t.allfilters).length>0&&(e=!0),e){for(var s=0;s<t.matchingIDs.length;s++)"_"!==t.matchingIDs[s].slice(-2,-1)&&(n.push(t.matchingIDs[s]),o.push([s]));var r={nodes:n,paths:o};l.setPathTags(r,this.taggerCallBack)}else this.nodePathsJson=this.createNodePathFromExistingArray(this.getContextItems()),l.setPathTags(this.nodePathsJson,this.taggerCallBack),this.getContextItems().forEach(function(e){e.getID&&(-1===t.matchingIDs.indexOf(e.getID())?e.setTaggerFilterState(!1):e.setTaggerFilterState(!0),e.applyFilters())});i.unmaskLoader(this.container)},onFilterBIColorize:function(t){var e=this.getTaggerColorMap(t);Object.keys(e).length>0&&(i.maskLoader(this.container,"Updating node colors..."),i.loader.getContent().style.opacity=1,this.getContextItems().forEach(function(t){t.getID&&e[t.getID()]&&t.setColor(e[t.getID()])})),i.unmaskLoader(this.container),this._colorizeState=!0},getTaggerColorMap:function(t){var e={};return t.map(function(t){e[t.id]=t.color}),e},onFilterBIUnColorize:function(){i.maskLoader(this.container,"Removing node colors..."),i.loader.getContent().style.opacity=1,this.getContextItems().forEach(function(t){t.setColor(null)}),this._colorizeState=!1,i.unmaskLoader(this.container)},setWorkingContainer:function(t){this.container=t},taggerCallBack:function(){var t=l._biFilter._facetsToFeedTagger;if(UWA.is(t,"array")&&t.length>0)for(var e=0;e<t.length;e++){let i=t[e];if(i.sixw&&i.object&&"ds6w:what/ds6w:status"==i.sixw){var n=i.object;if(UWA.is(n,"string")){let i=n.split(".")[0];if(UWA.is(i))for(var o=0;o<t.length;o++){let n=t[o];if("ds6w:what/ds6w:policy"==n.sixw&&i==n.object){l._biFilter._facetsToFeedTagger[e].dispValue+=" ("+n.dispValue+")";break}}}}}l._biFilter._setTags(null,l._biFilter._facetsToFeedTagger)},addItemsToTagger:function(t){if(t){var e=Array.isArray(t)?t:[t];this.nodePathsJson=this.createNodePathJsonFromArray(e),l.setTagsWithFetchSynthesis(this.contextItemIds)}},removeItemsOnTagger:function(t){if(t){var e=Array.isArray(t)?t:[t];this.removeRootfromTagger(e)}},getContextItems:function(){return this.contextItemNodes},getContextIDs:function(){return this.contextItemIds},createNodePathJsonFromArray:function(t){var e={nodes:[],paths:[]},n=this;return t.forEach(function(t,o){if(t.getID){e.nodes.push(t.getID()),n.contextItemNodes.push(t),n.contextItemIds.push(t.getID());var i=[];i.push(o),e.paths.push(i)}}),e},createNodePathFromExistingArray:function(t){var e={nodes:[],paths:[]};return t.forEach(function(t,n){if(t.getID){e.nodes.push(t.getID());var o=[];o.push(n),e.paths.push(o)}}),e},removeRootfromTagger:function(t){},resetFilterData:function(){l.resetNGFilterUI({widgetId:widget.id,rootIds:this.getContextIDs()}),l.cleanProxy(),l.setPathTags({nodes:[],paths:[]}),this.contextItemNodes=[],this.contextItemIds=[]}})});