define("DS/XSRCommonComponents/fileupload/FileUploader",["UWA/Class/View","UWA/Core","DS/Tweakers/TweakerBlob","DS/Controls/TooltipModel","DS/Controls/Button","DS/XSRCommonComponents/utils/Utils","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/DocumentServiceProvider","DS/XSRCommonComponents/createform/view/NewForm","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents","css!DS/XSRCommonComponents/fileupload/FileUpload.css"],function(e,t,i,n,o,s,r,a,l,d){"use strict";return e.extend({_rootcontainer:null,_warning:null,removebutton:null,files:null,hasDirtyField:!0,setup:function(e){this._parent(e),this.parentContext=e.parentContext},render:function(e){return this.drawField(e),this},drawField:function(e){var i=!!e&&e.drawIcon;this.parentContainer=new t.createElement("div",{class:"xsr-file-field-input"}),this._rootcontainer=new t.createElement("div",{class:"xsr-field-input-attachment-all"}).inject(this.parentContainer),this.drawUploaderField(),this.drawCommentBox(),i&&(i.icon&&i.addClassName("xsr-file-icons"),i.inject(this._rootcontainer)),this.removeButton(),this._warning.inject(this._rootcontainer),this.renderTo=this.parentContainer},drawUploaderField:function(){var e=new t.createElement("div",{class:"xsr-field-uploader"}).inject(this._rootcontainer);this.uploader=new i({placeholder:d.FileDropZone}),this.uploader.inject(e),this._warning=new t.createElement("span",{class:"file-warning-message"}),this._warning.setStyle("display","none");this.uploader.addEventListener("change",function(e){var t=this;t.files&&(t.files=null),e.dsModel.blob&&(t.files=e.dsModel,t.fileName=t.files._blobName,t._isInvalidFormat.call(t,e.dsModel._blobName)?(t._warning.setStyle("display","inline-block"),t.dispatchEvent("VALIDATE_FIELD_VALUE")):(t._warning.setStyle("display","none"),t.dispatchEvent("VALIDATE_FIELD_VALUE")))}.bind(this)),this.uploader.addEventListener("dragover",function(e){s.dragStartedInXSR=!0}),this.uploader.addEventListener("dragleave",function(e){s.dragStartedInXSR=!1})},drawCommentBox:function(){var e={name:"CheckinReason",placeholder:d.placeholder_Comments,disabled:!1,type:"textarea",nbRows:2},i=new t.createElement("div",{class:"file-action-comment-box"});i.inject(this._rootcontainer);var n=new l;this.cBox=n.buildEditerCtrl(e),this.cBox.inject(i)},removeButton:function(){this.removebutton=new o({label:d.Clear,emphasize:"secondary",domId:"xsr-file-remove",minHeight:34,preferredHeight:35}).inject(this._rootcontainer);var e=function(){this.uploader&&(this.uploader.value=void 0,this.hasDirtyField=!0,this.files=null,this._warning.setStyle("display","none")),this.cBox&&(this.cBox.value=void 0),this.dispatchEvent("VALIDATE_FIELD_VALUE")};this.listenTo(this,"CLEAR_FIELD_VALUES",e.bind(this)),this.removebutton.addEventListener("click",e.bind(this))},_isInvalidFormat:function(e){var t=s.restrictedFormats(),i=s.supportedFormats(),n=e.lastIndexOf("."),o=(n<1?"":e.substr(n+1)).toLowerCase();return void 0!==t&&-1!==t.indexOf(o)?(this.hasDirtyField=!0,this._warning.addClassName("error_file_format"),this._warning.textContent=d.RestrictedFileFormat,!0):(this.hasDirtyField=!1,this._warning.removeClassName("error_file_format"),void 0!==i&&-1===i.indexOf(o)?(this.hasDirtyField=!1,this._warning.textContent=d.UnsupportedFile,!0):(this.hasDirtyField=!1,!1))},getFiles:function(){if(this.files)return this.files.blob.lastModifiedDate=new Date,this.files.blob.name=this.files._blobName,this.files.blob},getComments:function(){return this.cBox.value?this.cBox.value.trim():""}})});