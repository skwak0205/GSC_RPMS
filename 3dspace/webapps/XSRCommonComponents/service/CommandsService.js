define("DS/XSRCommonComponents/service/CommandsService",["UWA/Class","UWA/Class/Promise","DS/ApplicationFrame/CommandsManager","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/alternate/services/XSpecsAlternateCtxManager","DS/XSRCommonComponents/utils/Notification","text!DS/XSRCommonComponents/assets/config/Commands.json","DS/XSRCommonComponents/utils/ContextManager","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,a,n,o,i,m,s,r){"use strict";return e.singleton({init:function(e){this._commandConfig=JSON.parse(m)},initialize:function(e){var t=this;t.modelEvents=e.modelEvents,t.modelEvents.subscribe({event:n.EVENT_LAUNCH_COMMAND},function(e){t._commandsListener(e)}),t._loadAllCommands()},_commandsListener:function(e){var t=this;if(!e.commandId)throw new Error("commandId is a mandatory parameter");if(!t._commandConfig[e.commandId])throw new Error("command doesn't existing");var o=t._commandConfig[e.commandId];t.commandLoaderStatus.then(function(i){var m;UWA.is(i,"array")&&i.length>0&&i.forEach(function(e){e&&e.value&&e.value._id===o.commandHdr&&(m=e.value._ctx)});var s=t.prepareCmdInput(e.context,e.commandId);e.commandId!==n.SUBSCRIBE_CMD&&e.commandId!==n.UNSUBSCRIBE_CMD&&e.commandId!==n.EDIT_SUBSCRIBE_CMD&&e.commandId!==n.MY_SUBSCRIPTIONS_CMD||(s._selectedItems[0].options.type=s._selectedItems[0].getTypeActualName());var r=a.getCommand(o.commandHdr,m),c=function(){r.execute(s)};t.modelEvents&&t.modelEvents.getEventByName(n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN)?t.modelEvents.publish({event:n.EVENT_SPEC_OTHER_ACTION_CLICK_SLIDEIN_OPEN,data:{callBackFunc:c,cmdId:e.commandId,selNodes:s._selectedItems}}):c()}).catch(function(e){console.log(e)})},_loadAllCommands:function(){var e=this,a=[];for(var n in e._commandConfig)if(e._commandConfig.hasOwnProperty(n)){var o=e._commandConfig[n],i=new t(function(t,a){e.loadCommand(o,t,a)});a.push(i)}return e.commandLoaderStatus=t.allSettled(a),e.commandLoaderStatus},loadCommand:function(e,t,a){if(!e||!e.commandHdr||!e.AmdLoader)return console.error("Oups ! no valid command description"),void a("Oups ! no valid command description");var n=this;return require([e.AmdLoader],function(a){var o={context:s.getContext(),ID:e.commandHdr,modelEvents:n.modelEvents};a&&t(new a(o))},function(e){a(e)})},_getObjectAdditionnalData:function(e){return{type:e.getTypeActualName(),name:e.getTitle(),displayName:e.getTitle(),revision:e.getRevision(),physicalid:e.getID()}},prepareCmdInput:function(e,t){var a={},i=[];if(e.item){var m=[],r=e.item.data||e.item;if(r)if(Array.isArray(r))for(var c=0;c<r.length;c++)i.push(this._getObjectAdditionnalData(r[c])),m.push(r[c]);else r=[e.item.data||e.item],m.push(e.item.data||e.item);var d=m.length>1;if(e.item.nodeModels){let t=e.item.nodeModels;s.setGridChildNodes(t)}s.addSelection(m);let p=e.item.selectFacet?e.item.selectFacet:void 0;if(a={_selectedItems:r},t)switch(t){case n.ENGINEERING_ITEM_REVISE:case n.DUPLICATE_CMD:case n.CHANGE_OWNER_CMD:case n.MULTI_OWNERSHIP_CMD:a.type=r[0].getTypeActualName(),a.typeDisplayName=r[0].getType(),a.name=r[0].getTitle(),a.displayName=r[0].getTitle(),a.revision=r[0].getRevision(),a.physicalid=r[0].getID();break;case n.MATURITY_GRAPH_CMD:d?(a=i)._selectedItems=r:(a.physicalid=r[0].getID(),a.type=r[0].getTypeActualName?r[0].getTypeActualName():r[0].getType(),a.typeDisplayName=r[0].getType(),a.name=r[0].getTitle?r[0].getTitle():r[0].getLabel(),a.displayName=r[0].getTitle?r[0].getTitle():r[0].getLabel(),a.revision=r[0].getRevision?r[0].getRevision():r[0].getReferenceVersion());break;case n.INFORMATION_CMD:if(a.physicalid=r[0].getID(),a.propWidth=e.item.propWidth,a.selectFacet=p,r[0].appCore){r[0].appCore.contextManager=o.getContext();let e=null;(e=r[0].getParent()&&r[0].getParent().getID?r[0].getParent():r[0].appCore.specRouteManager.getActiveSpecItem())?r[0].appCore.contextManager.setActiveEngItem(e):r[0].appCore.contextManager.setActiveEngItem(r[0]),r[0].appCore.contextManager.setSelectedNodes([r[0]])}break;case n.FILTER_CMD:a.commandId=t,a.appCore=e.item.appCore;break;case n.SUBSCRIBE_CMD:case n.UNSUBSCRIBE_CMD:case n.EDIT_SUBSCRIBE_CMD:case n.MY_SUBSCRIPTIONS_CMD:a.type=r[0].getTypeActualName();break;case n.OPEN_ALTERNATES:if(a.physicalid=r[0].getID(),r[0].appCore){r[0].appCore.orgContextManager=r[0].appCore.contextManager,r[0].appCore.contextManager=o.getContext();let e=null;e=void 0===r[0].appCore.specRouteManager?r[0].parentNode:r[0].appCore.specRouteManager.getActiveSpecItem(),r[0].appCore.contextManager.setActiveEngItem(e),r[0].appCore.contextManager.setSelectedNodes([r[0]])}a.commandId=n.OPEN_ALTERNATES;break;case n.OPEN_INFO_WIDGET:if(a.physicalid=r[0].getID(),r[0].appCore){r[0].appCore.orgContextManager=r[0].appCore.contextManager,r[0].appCore.contextManager=o.getContext();let e=null;e=void 0===r[0].appCore.specRouteManager?r[0].parentNode:r[0].appCore.specRouteManager.getActiveSpecItem(),r[0].appCore.contextManager.setActiveEngItem(e),r[0].appCore.contextManager.setSelectedNodes([r[0]])}a.commandId=n.OPEN_INFO_WIDGET;break;default:a.physicalid=r?r[0].getID():e.item.physicalid}return a}}})});