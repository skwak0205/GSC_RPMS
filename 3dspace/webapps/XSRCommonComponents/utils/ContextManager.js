define("DS/XSRCommonComponents/utils/ContextManager",["UWA/Class","DS/XSRCommonComponents/utils/Notification","DS/XSRCommonComponents/utils/RequestUtil","DS/XSRCommonComponents/utils/XSRSearch","DS/ENO6WPlugins/jQuery","DS/XSRCommonComponents/utils/Constants","DS/XSRCommonComponents/utils/XSRMask","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,n,i,o,r,s,a){"use strict";return e.singleton({_selectedItems:[],init:function(e){this._parent(e),this.contextId=null,this.contextTitle=void 0,this.gridNodeModels=void 0},setBOMTabOptions:function(e){this.appCore=e.appCore,this.maskContainer=e.maskContainer,this.gridView=e.gridView},getSelectedNodes:function(){return this._selectedItems},setContextItemId:function(e){this.contextId=e},setContextItemTitle:function(e){this.contextTitle=e},setGridChildNodes:function(e){this.gridNodeModels=e},resetSelection:function(){this._selectedItems=[]},addSelection:function(e,t){this._selectedItems=[];var n=this;UWA.is(e,"array")?e.forEach(function(e){n._selectedItems.push(e)}):this._selectedItems.push(e)},getSecurityContext:function(){return{SecurityContext:n.getSecurityContext(),tenant:n.getPlatformId()}},getContext:function(){return this},getInstanceName:function(e){return!1===widget.getValue(r.PERSISTENCY_BOM_VIEW)?e.getInstanceName():e.getTitle()},getName:function(e){return e.getTitle()},get:function(){return this},getEditMode:function(){return!0},displayNotification:function(e){e.eventID="primary"===e.eventID?"success":e.eventID,t.displayNotification(e)},beginBlockingTransaction:function(e){this.maskContainer&&s.maskLoader(this.maskContainer,e)},endBlockingTransaction:function(){this.maskContainer&&s.unmaskLoader(this.maskContainer)},modalChooser:function(e){var t={allowedTypes:["VPMReference"],role:"",criteria:"VPMReference",precondition:'(latestrevision=="TRUE") AND NOT [current]:"OBSOLETE"',in_apps_callback:e.in_apps_callback};new i(t).launchSearch(t)},isThereARootSelected:function(){var e=this.getSelectedNodes();return!!(e&&e.length>0)},getParent:function(e){return e.parentNodeModel},getRelationID:function(e){return"function"==typeof e.getParentInstanceIds?e.getParentInstanceIds()[0]:""},getType:function(e){return e.getTypeActualName()},getReference:function(e){return e.getID()},getName:function(e){return e?e.getLabel():null},author:function(e){return!0},getNodesById:function(e){if(!this.contextTreeDocument)return"";this.contextTreeDocument.filter(function(t){return t.getID()===e})},getSetting:function(e){var t=null;switch(e){case"tenant":t=n.getPlatformId();break;case"lang":t=n.getLanguage();break;case"securityContext":t=n.getSecurityContext()}return t},canInstantiate:function(e,n,i,o,r,s){for(var c=0;c<n.length;c++)if(n[c]===e){var u=a.replace(s,{name:o});return t.displayNotification({eventID:"error",msg:u}),!1}return!0},getChildren:function(e){let t=widget.getValue(r.PERSISTENCY_BOM_VIEW);if(e.getID){if(e.getID()==this.contextId&&this.gridNodeModels){if(t){var n=[];return this.gridNodeModels.forEach(function(e){var t=e.getParentInstanceIds();if(t&&t.length>1)for(var i=0;i<t.length;i++){let r=t[i],s={};(s=o.extend(!0,{},e)).options.grid.instanceIds=[],s.options.grid.instanceIds.push(r),n.push(s)}else n.push(e)}),n}return this.gridNodeModels}var i=e.getChildren();return Array.isArray(i)?i.filter(function(e){return!!e.getID}):[]}return[]},addRoot:function(e,t,n){},refresh:function(e){if(e)if("unparent"===e.action)this.appCore.specViewerModelEvents.publish({event:"grid-list-unparent-node-successful-bom",data:e.instances});else if("insert"===e.action){for(var t=[],n=0;n<e.instances.length;n++)t.push({fromId:e.parent,instanceId:e.instances[n],id:e.references[n]});this.appCore.specViewerModelEvents.publish({event:"grid-list-addInst-node-successful-bom",data:t})}},isPartiallyExpanded:function(e,t){return t?t(!1):null},getPADDGVView:function(){return null},getRoots:function(){return this.gridView?this.gridView.model.getSelectedNodes().length>0?this.gridView.model.getRoots():[this.gridView._parentView.parentModel]:[]},getNodesByIdForSpecTreeModel:function(){return[this.gridView.model._getTrueRoot()]},getChildrenOfTrueRoot:function(){return this.gridView.model._getTrueRoot().getChildren()}})});