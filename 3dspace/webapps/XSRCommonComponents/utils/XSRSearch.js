define("DS/XSRCommonComponents/utils/XSRSearch",["UWA/Core","UWA/Utils/InterCom","DS/XSRCommonComponents/utils/RequestUtil","DS/Controls/LineEditor","DS/Controls/Button","DS/Controls/ComboBox","DS/Windows/Dialog","DS/XSRCommonComponents/utils/Notification","css!DS/XSRCommonComponents/SearchCriteria.css","i18n!DS/XSRCommonComponents/assets/nls/XSRCommonComponents"],function(e,t,i,o,n,s,r,c,a,l){"use strict";var d=function(i){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new t.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.objectsSelected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener),this.defaultOptions=i,this.defaultOptions={multiSel:!0,source:["3dspace"]},e.extend(this.defaultOptions,i||{})};return d.prototype.options=function(e,t,o,n,s,r,c,a){var l={};if(l.title=e,l.mode="furtive",l.app_socket_id=this.socketName,l.widget_id=widget.id,l.default_with_precond=!0,l.multiSel=s,l.source=this.defaultOptions.source||[],l.tenant=i.getPlatformId(),l.role=o,a&&(l.columns=a),Array.isArray(t)&&(l.precond="",t.forEach(function(e,t){0!==t&&(l.precond+=" OR "),l.precond+='flattenedtaxonomies:"types/'+e.trim()+'"'})),l.precond&&""!==l.precond&&(l.precond="("+l.precond+")"),(r||c&&c.length>0)&&l.precond){l.precond="("+l.precond,r&&(l.precond=l.precond+" AND "+r);var d="";const e="NOT physicalid:";if(c&&c.length>0){for(var h="",u=0;u<c.length;u++)h+=0===u?e:" AND "+e,h+=c[u];d=" AND ("+h+")",l.precond+=d}l.precond+=")"}n&&""!==n.trim()&&(l.default_search_criteria=n);return l.advanced_search={showByDefault:!1,searchOnInit:!1},l},d.prototype.destroy=function(){var e={};e.widget_id=widget.id,this.socket.dispatchEvent("unregisterSearchContext",e),this.socket.unsubscribeServer("SearchComServer"),this.socket.removeListener("Selected_Objects_search",this.listener),this.socket.disconnect(),delete this.socket},d.prototype.activate=function(e,t,i,o,n,s,r,c,a){var l=this.options(e,t,i,o,n,s,r,c);UWA.is(a,"function")||(l.mode="default"),this.callback=a,this.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),this.socket.dispatchEvent("RegisterContext",l),this.socket.dispatchEvent("InContextSearch",l)},d.prototype.isAvailable=function(){return UWA.is(this.socket)},d.prototype.launchSearch=function(e){this.isAvailable()&&(void 0!==e.multiSel&&null!==e.multiSel||(e.multiSel=this.defaultOptions.multiSel||!0),this.activate("Specification Management ",e.allowedTypes,e.role||"",this.getAugmenttedQueryForSearch(e.criteria),e.multiSel,e.precondition,e.excludeList,e.columns,function(t){e.in_apps_callback(t)}))},d.prototype.getAugmenttedQueryForSearch=function(t){if(e.is(t,"string")&&t.trim().length>0){var i=t;return"*"!==t.charAt(0)&&(i="*"+t),"*"!==t.charAt(t.length-1)&&(i+="*"),i}return null},d.prototype.objectsSelected=function(e){this.callback&&this.callback(e)},d._getSearchCriteria=function(e,t){if(e&&e.elements.container.getDocument().getElementById("xsr-input-search-dialog"))throw new Error("Dialog Box is already open");return new Promise(function(i,s){let a,d,h;var u=UWA.createElement("div",{class:"xsr-search-editor-content-container"}),p=new n({displayStyle:"lite",label:"proceed",icon:{iconName:"search",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1,onClick:function(e){(d=a.value).length<3?c.displayNotification({eventID:"info",msg:l.query_is_short}):(h.close(),i(d))}});p.getContent().addClassName("xsr-search-icon-button"),(a=new o({placeholder:l.label_Search,value:"",displayClearFieldButtonFlag:!0,sizeInCharNumber:30})).inject(u),p.inject(u),h=new r({domId:"xsr-input-search-dialog",identifier:"xsr-search-dialog",title:l.label_Search_Criteria,showTitleFlag:!1,content:u,activeFlag:!0,modalFlag:!0,position:{my:"right",at:"right",of:t||e,offsetX:0,offsetY:50},buttons:{Ok:new n({onClick:function(e){(d=a.value).length<3?c.displayNotification({eventID:"info",msg:l.query_is_short}):(h.close(),i(d))}})}})})},d});