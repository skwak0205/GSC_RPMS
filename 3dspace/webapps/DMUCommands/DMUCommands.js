define("DS/DMUCommands/DMU3DCompareCmd",["UWA/Utils","DS/DMUBaseCommands/EXPStateCommand","DS/DMUPlayCompare/DMUCompare3D","DS/DMUPlayCompare/DMUCompare2D","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/PADServices/utils/SearchUtils","DS/DMUControls/EXPNotify","DS/CATWebUXComponents/CATWebUXNotifBar","DS/Selection/CSOManager","DS/Selection/PSOManager","DS/Visualization/PathElement","DS/ApplicationFrame/CommandsManager","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a,r,l,s,d,c,g,u,m,p,v){"use strict";return t.extend({init:function(t){var D="DMU2DCompareCmdHdr"===t.ID?"2D":"3D";this._parent(t,"exclusive",!0);let f,h,C=r.getContextViewer({viewer:this.getFrameWindow().getViewer()}),w=this;this._parentEndExecute=this.endExecute,this.endExecute=function(){h&&h(),this._parentEndExecute()},this.buildGraph=function(){let t=r.giveEventsController({viewer:C.getViewer()});t&&t.fireEvent("onTransientCompareRemoved");let S,M,b,x,O,U,E,I,P,A,y,R,F,V,T,N,W,_=[],L=null,k=!1,B={},j={},q=a.createSceneGraphOverrideSet(w.getFrameWindow().getViewer()),H=!1,G=null,X=null;"2D"===D&&(N=l.getManager({name:"DMU2DSheetManager",context:C.getFrameWindow()}));let J=r.getReviewContext({viewer:w.getFrameWindow().getViewer()});if(J||(J=o.createReviewContext({context:C})),!J)return;let z=!1;J.getCurrentSessionMarkup()&&J.getCurrentSessionMarkup().isVisible()&&(z=!0,J.getUIManager().setMarkupVisualizationActiveState(!1));let K=J.getTransientReviewBag();if(!K)return;if(k=!1,E=J.getReviewCtxInformation()?J.getReviewCtxInformation().contextId:null,C.getApplicativeData()&&C.getApplicativeData().getLoadedItfData&&C.getApplicativeData().getLoadedItfData()&&C.getApplicativeData().getLoadedItfData().data&&C.getApplicativeData().getLoadedItfData().data.length)E=C.getApplicativeData().getLoadedItfData().data[0].prd[0]?C.getApplicativeData().getLoadedItfData().data[0].prd[0]:E;else if(E){let e=C.getRootBagPath().getChildrenPathes();for(let t=0;t<e.length;t++){let n=a.getNodeID(e[t].getLastElement(!0));if(C.getController().isFiltered(n)&&E===C.getController().isFiltered(n).filterId){E=n;break}}}function Z(){T&&(T.removeAll(),T.destroy()),T=new c({className:"DMU3DCompareCommand"}).inject(w.getFrameWindow().getUIFrame());let e="3D"===D?v.notifySecondProduct:v.notifySecondDocument;T.add({msgType:"primary",message:e,closable:!1,buttons:[{className:"default",label:v.compareCancel,onClick:function(){w.publish({event:"DMU3DCompareCmdCancelled"})}}]}),w.getFrameWindow().getViewer().render()}function Q(){let e=a.getOverrides(q,{idPaths:[[x]]});e&&e.length&&e.forEach(e=>{e.setOpacity(.5),e.setPickability("IGNORED")}),Z()}function Y(e,t,n){f&&(f.destroy(),f=null),f=new d({body:w.getFrameWindow().getUIFrame(),type:e,notificationType:n,message:t})}function $(){let e=u.get(),t=[],n=[];e.forEach(e=>{e.pathElement.externalPath.length>2&&(t.push(e),n.push({pathElement:new m([e.pathElement.externalPath[0],e.pathElement.externalPath[1]])}))}),t.length&&u.remove(t),n.length&&u.add(n),w.getFrameWindow().getViewer().render()}function ee(){let t=S?K.getOccurence({pathElement:S},!0):b?K.getOccurence({idPath:[b]},!0):null,o=M?K.getOccurence({pathElement:M},!0):P?K.getOccurence({idPath:[P]},!0):null;if(o&&t&&o.id!==t.id&&("3D"===D||G&&X)){"2D"===D&&C.getViewpoint().reframe();let a="3D"===D?new n(w.getFrameWindow().getViewer(),K):new i(w.getFrameWindow().getViewer(),K);a.setAttributes([{name:"sID",value:K.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:K.computeNewName({object:a,prefix:D+"Compare"})},{name:"bVisible",value:!0},{name:"fBalance",value:50},{name:"bLocalAxis",value:!0},{name:"oSelections",value:[{id:t.id},{id:o.id}]}]),"2D"===D&&a.setAttributes([{name:"oSheetIDs",value:[{id:G||null},{id:X||null}]}]),K.addDMUObject(a),require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command","DMU3DCompare")}),a.fireEvent("onDMUObjectInitialized",{dmuObject:a}),w.publish({event:"DMU3DCompareCmdEvent"})}else o&&t&&o.id===t.id?w.publish({event:"DMU3DCompareSameObjError"}):w.publish({event:"DMU3DCompareCmdError"})}function te(){if(b&&(O||U)){let e=!1;s.inAppsSearch({mode:"furtive",app_socket_id:"DMU3DCompareCmd",fts_value:O?"(logicalid:"+O+") AND NOT (physicalid:"+b+")":"(versionid:"+U+") AND NOT (physicalid:"+b+")",callback:function(e){if(F&&clearTimeout(F),F=null,w.isRunning()&&e.length>=0){if((P=e[0].resourceid)===b)return void w.publish({event:"DMU3DCompareSameObjError"});"2D"===D&&P?C.getController().getAttributes({ids:[P],attributes:["ds6w:type"],callbacks:{onComplete:function(e){if(e)if(b!==P){let n=e[P]&&e[P]["ds6w:type"];I===n||"DIFLayout"===I&&"DIFSheet"===n||"DIFSheet"===I&&"DIFLayout"===n?(K.fireEvent("onComparisonStarted",{is2DCompare:!0}),K.fireEvent("onDMUAdd2DCompareRoot",{compare2DSecondRoot:P,documentType:n}),t=r.giveEventsController({viewer:C.getViewer()}),A=t.addEvent("on2DDocumentLoadSuccess",function(){t.removeEvent(A),A=null;let e=C.getRoots();if(N&&e.length>1){let e=N.getDocumentData(P);e&&e.sheetIDList&&e.sheetIDList.length?(-1!==e.sheetIDList.indexOf(G)?W=e.sheetIDList.indexOf(G):void 0!==W&&-1!==W&&W>=e.sheetIDList.length&&(W=0),(X=e.sheetIDList[W])||(X=P),X?ee():(P&&C.removeRoots({pids:[P]}),w.publish({event:"DMU3DCompareCmdError"}))):(P&&C.removeRoots({pids:[P]}),w.publish({event:"DMU3DCompareCmdError"}))}else P&&C.removeRoots({pids:[P]}),w.publish({event:"DMU3DCompareCmdError"})}),R=t.addEvent("onEmptyDocument",function(){t.removeEvent(R),R=null;let e=C.getRoots(),n=[],i=!1;for(let t=0;t<e.length;t++)n.push(a.getNodeID(e[t]))===P&&(C.removeRoots({pids:[P]}),i=!0);i||(y=C.subscribe({event:"onRootAdded"},function(){C.unsubscribe(y),y=null,setTimeout(function(){C.removeRoots({pids:[P]}),C.getViewpoint().reframe(),w.publish({event:"DMU3DCompareCmdError"})})}))})):w.publish({event:"DMU3DCompareCmdError"})}else w.publish({event:"DMU3DCompareSameObjError"});else w.publish({event:"DMU3DCompareCmdError"})},onFailure:function(){f&&(f.destroy(),f=null),w.isRunning()&&(f=w.sendNotify("info",v.errorFetchingPrdData))}}}):ee()}},cancel:function(){e?null!==F&&(F&&clearTimeout(F),F=setTimeout(()=>{w.publish({event:"DMU3DCompareCmdCancelled"}),F=null},500)):e=!0}})}}function ne(){let e=g.get();if(e&&e.length&&a.isAModelPath(e[0].pathElement)){let t=a.getFirstReference(e[0].pathElement);x?(M=t,x===a.getNodeID(M.externalPath[0])?w.publish({event:"DMU3DCompareSameObjError"}):setTimeout(ee)):(S=t,b=a.getNodeID(S.externalPath[0]),x=b,O=V[b]?V[b].logicalid:null,U=V[b]?V[b].versionid:null,Q(),w.emptyCSO(),w.emptyHSO(),te())}else w.publish({event:"DMU3DCompareCmdError"})}function ie(){let e=p.getCommandCheckHeader("RootPanel",C.getCommandContext());e&&!e.getState()&&(e.setState(!0),H=!0)}h=function(){if(w.emptyCSO(),w.emptyHSO(),w.getFrameWindow().getViewer().render(),H){let e=p.getCommandCheckHeader("RootPanel",C.getCommandContext());e&&e.getState()&&e.setState(!1)}t&&(R&&(t.removeEvent(R),R=null),A&&(t.removeEvent(A),A=null)),C.unsubscribe(y),y=null,S=M=null,L&&L.destroy(),B&&B.onAdd&&g.unsubscribe(B.onAdd),j&&j.onAdd&&u.unsubscribe(j.onAdd),q&&a.removeSceneGraphOverrideSet(w.getFrameWindow().getViewer(),q),T&&(T.removeAll(),T.destroy()),T=null,B={},j={},E=b=P=O=U=L=null};let oe=this.createInitialState("initialState"),ae=this.getFinalState();this.setEnterStateAction(oe,function(){let e=C.getRoots();if(!e||!e.length)return void w.publish({event:"DMU3DCompareCmdError"});_=g.get();let t=[];if("3D"===D&&_.length){if(_[0].pathElement||(k=!0),!k){let e=a.getLastReference(_[0].pathElement);e&&E&&a.getNodeID(e.externalPath[1])!==E&&(k=!0)}if(k)return;{S=_[0].pathElement.clone();let e=a.getLastReference(S);e&&(b=a.getNodeID(e.getLastElement(!0))),b&&t.push(b)}}if(!t.length)for(let n=0;n<e.length;n++){let i=a.getNodeID(e[n]);i&&t.push(i)}t.length?(w.emptyCSO(),w.emptyHSO(),C.getController().getAttributes({ids:t,attributes:["ds6wg:revision","logicalid","versionid","ds6w:type"],callbacks:{onComplete:function(e){if((V=e)&&w.isRunning())if(!S&&t.length>1&&!E&&"3D"===D)(T=new c({className:"DMU3DCompareCommand"}).inject(w.getFrameWindow().getUIFrame())).add({msgType:"primary",message:v.notifyFirstProduct,closable:!1,buttons:[{className:"default",label:v.compareCancel,onClick:function(){w.publish({event:"DMU3DCompareCmdCancelled"})}}]}),B.onAdd=g.onAdd(ne),j.onAdd=u.onAdd($),ie();else{if(b)"3D"===D&&S&&S.externalPath.length&&S.externalPath[1]&&(x=a.getNodeID(S.externalPath[1]));else{if(E)b=E;else{let e=a.getRootReferences(w.getFrameWindow().getViewer())[0];e&&(b=a.getNodeID(e))}x=b}if(N&&"2D"===D&&b&&("Drawing"===(I=V[b]?V[b]["ds6w:type"]:null)||"DIFLayout"===I||"DIFSheet"===I)){let e=N.getDocumentData(b);(G=e.activatedSheetID)||(G=x),e.sheetIDList&&(W=e.sheetIDList.indexOf(G))}O=V[b]?V[b].logicalid:null,U=V[b]?V[b].versionid:null,"3D"===D?(B.onAdd=g.onAdd(ne),j.onAdd=u.onAdd($),Q()):Z(),te(),"3D"===D&&ie()}},onFailure:function(){f&&(f.destroy(),f=null),w.isRunning()&&(f=w.sendNotify("info",v.errorFetchingPrdData))}}})):w.publish({event:"DMU3DCompareCmdError"})}),this.addTransition({iSender:this,iEvent:"DMU3DCompareCmdEvent",iInitialState:oe,iFinalState:ae}),this.addTransition({iSender:this,iEvent:"DMU3DCompareCmdCancelled",iInitialState:oe,iFinalState:ae,iAction:function(e){Y("info",v.compareCancelled),J.getCurrentSessionMarkup()&&z&&J.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),e()}}),this.addTransition({iSender:this,iInitialState:oe,iFinalState:ae,iCondition:function(){return k},iAction:function(e){Y("error",v.notifyFirstProductError),J.getCurrentSessionMarkup()&&z&&J.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),e()}}),this.addTransition({iSender:this,iEvent:"DMU3DCompareSameObjError",iInitialState:oe,iFinalState:ae,iAction:function(e){Y("error",v.sameObjectsCompared),J.getCurrentSessionMarkup()&&z&&J.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),e()}}),this.addTransition({iSender:this,iEvent:"DMU3DCompareCmdError",iInitialState:oe,iFinalState:ae,iAction:function(e){Y("error",v.compareCmdFailed),J.getCurrentSessionMarkup()&&z&&J.getUIManager().setMarkupVisualizationActiveState(!0),w.emptyCSO(),w.emptyHSO(),e()}})}}})}),define("DS/DMUCommands/DMUColorOpacityOverloadCmd",["DS/ApplicationFrame/Command","DS/DMUControls/EXPColorPicker","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/ThreeJS_DS","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){e.mode="shared",this._parent(e)},beginExecute:function(e){this._parent(e);var r,l=i.getReviewContext({viewer:this.getFrameWindow().getViewer()}),s=l&&!l.isReadOnly()?l.getCurrentSessionMarkup():null;if(s&&!s.isReadOnly()){var d,c,g=n.get().slice(),u=[];for(d=0;d<g.length;d++)(c=s.getOrCreateOccurrenceOverloader(g[d]))?u.push({color:c.getAttribute("cColor"),opacity:c.getAttribute("fOpacity")}):u.push({color:null,opacity:null});var m,p,v,D=!0,f=!0;for(d=0;d<u.length;d++)f&&(void 0===m?m=u[d].color:(null!==m&&null!==u[d].color&&!m.equals(u[d].color)||null===m&&null!==u[d].color||null!==m&&null===u[d].color)&&(m=null,v=!1,f=!1)),D&&(void 0===p?p=u[d].opacity:p!==u[d].opacity&&(p=null,v=!1,D=!1));void 0===v&&(v=null===p&&null===m);var h=!1,C=i.giveEventsController({viewer:this.getFrameWindow().getViewer()});r||(r=new t({frameWindow:this.getFrameWindow(),onDestroyCB:function(){h&&C.fireEvent("onSaveRequested",{}),r=null,h=!1}})).build({displayColorSlider:!0,displayOpacitySlider:!0,displayResetButton:!0,defaultColor:m,onColorChangedCB:function(e){for(var t=[],n=0;n<g.length;n++)(c=s.getOrCreateOccurrenceOverloader(g[n],!0))&&(h=!0,c.setAttribute("cColor",new o.Color(e.color)),t.push({state:{cColor:new o.Color(e.color)},target:c}));t.length&&(C.fireEvent("onDMUOverloadPropertiesChanged",{overloads:t}),C.fireEvent("onSaveRequested",{}))},defaultOpacity:p,minOpacity:0,maxOpacity:1,onOpacityChangedCB:function(e){for(var t=[],n=0;n<g.length;n++)(c=s.getOrCreateOccurrenceOverloader(g[n],!0))&&(h=!0,c.setAttribute("fOpacity",e.opacity),t.push({state:{fOpacity:e.opacity},target:c}));t.length&&(C.fireEvent("onDMUOverloadPropertiesChanged",{overloads:t}),C.fireEvent("onSaveRequested",{}))},defaultResetState:v,resetButtonLabel:a.resetLabel,onResetButtonPressedCB:function(){for(var e=[],t=0;t<g.length;t++)(c=s.getOrCreateOccurrenceOverloader(g[t]))&&(h=!0,c.setAttribute("cColor",null),c.setAttribute("fOpacity",null),e.push({state:{cColor:null,fOpacity:null},target:c}));e.length&&(C.fireEvent("onDMUOverloadPropertiesChanged",{overloads:e}),C.fireEvent("onSaveRequested",{}))}})}this.end()}})}),define("DS/DMUCommands/DMUEditPropertiesCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend(t,{init:function(e){e.mode="shared",e.isAsynchronous=!0,this._parent(e),this.setRepeatMode(!1)},beginExecute:function(){var e=this,t=n.getReviewContext({viewer:e.getFrameWindow().getViewer()});if(t){var o=t.getReviewCtxInformation(),a=i.get();let n;if(1===a.length&&a[0].pathElement.getLastElement(!0).getDMUType&&"DMUMarkup"===a[0].pathElement.getLastElement(!0).getDMUType()){let e=t.getValidation();e&&e.getMarkups().some(e=>{let t=e.getRepRef();if(t.getMarkupContent()&&t.getMarkupContent().getNode()===a[0].pathElement.getLastElement(!0))return n=e.getPlmID(),!0})}var r=this._objectId?this._objectId:n||o.reviewId;if(r){require(["DS/PADUtils/PADSettingsMgt"],function(t){e.launchProperties({getSecurityContext:function(){return{SecurityContext:t.getSetting("pad_security_ctx"),tenant:t.getSetting("x3dPlatformId")}},getSelectedNodes:function(){return[{id:r,getID:function(){return this.id},source:"3DSpace",tenant:t.getSetting("x3dPlatformId")}]}}),e.end(),e._objectId=void 0})}}},setObject:function(e){this._objectId=e}})}),define("DS/DMUCommands/DMURemoveAllcmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager"],function(e,t){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);let n=(e.frameWindow||this.getFrameWindow()).getViewer();this.beginExecute=(()=>{const e=t.getContextViewer({viewer:n});t.getReviewContext({context:e})&&t.removeReviewContext({context:e})})}})}),define("DS/DMUCommands/DMUGenerateTICCmd",["DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/FrameWindowsManager","DS/CATWebUXTIC/CATWebUXTICCmdAdapt","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUCommands/assets/nls/DMUCommands","DS/DMUReadPersistence/DMULoadingContextController"],function(e,t,n,i,o,a,r,l,s,d,c){"use strict";return n.extend({init:function(n){var g=e.getContextViewer({viewer:t.getFrameWindow(n.context).getViewer()});function u(){var e=[];return o.get().forEach(function(t){for(var n=0;t.pathElement,n<t.pathElement.getLength();n++){var i=t.pathElement.getElement(n);i&&"function"==typeof i.getDMUType&&"DMUValidationExposedPresentation"===i.getDMUType()&&e.push(i)}}),e}function m(e){var t=[];if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var n=u();if(n.length>0)for(var i=0;i<n.length;i++)t.push(n[i].getOwner().getPlmID());else t.push(e.getValidation().getPlmID())}else t.push(e.getReviewCtxInformation().reviewId);return t}function p(e,t,n){return new Promise(function(i){if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId)if(u().length||e.getValidation().getHighlights().length)i(t);else{var o=r.createElement("div"),a="Issue"===n.cmdType?d.issueOnReview:d.caOnReview;r.createElement("label",{text:a,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(o);var c=new l({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Issue"===n.cmdType?d.issueTitle:d.caTitle,immersiveFrame:g.getFrameWindow().getImmersiveFrame(),content:o,closeButtonFlag:!0,buttons:{Ok:new s({label:d.yes,onClick:function(){c.destroy(),i(t)}}),Cancel:new s({label:d.no,emphasize:"primary",onClick:function(){c.destroy(),i()}})}});c.addEventListener("close",function(){c.destroy(),i()})}else t.fromIssue=e.getReviewCtxInformation().fromIssue,i(t)}).then(function(e){e?n.onComplete(e):n.onCancel()})}n.pad3DViewer=g,this._parent(n),this.getParameters=function(t){var n=e.getReviewContext({context:g}),l=n.getReviewCtxInformation();if(!l||l.reviewId){var s=i.giveDMUApplicativeContextManager({context:g});s&&s.getApplicativeContainersTICInfo(t.cmdType,function(e){if(e.length)e[0]&&e[0].status&&"ticCancel"===e[0].status?t.onCancel():(e[0].attachments&&e[0].attachments.push(m(n)),e[0].fromIssue=l.fromIssue,t.onComplete(e[0]));else{var i={reportedAgainst:[],contexts:[],assignees:[],attachments:[]};i.title=function(e){let t;if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var n=u();t=n.length>0?n[0].getOwner().getName():e.getValidation().getName()}else t=e.getReviewCtxInformation().reviewName;return t}(n),i.attachments=m(n),i.reportedAgainst=function(e){var t=[];if(o.get().forEach(function(e){var n=e.pathElement;if(n){for(;n&&!a.isReference(n.getLastElement());)n=n.getParentPath();if(n){var i=n.getLastElement(),o=a.getNodeID(i);t||(t=[]),-1===t.indexOf(o)&&t.push(o)}}}),!t.length&&("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId))for(var n=e.getValidation().getValidated().getPathElements(),i=0;i<n.length;i++)n[i]&&n[i].pathElement.length&&t.push(n[i].pathElement[n[i].pathElement.length-1]);return t}(n),(s=n,d="ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId?{ids:s.getValidation().getContext().getJsonContextIDs(),type:s.getValidation().getContext().getJsonContextTypes()[0]}:{ids:[s.getReviewCtxInformation().contextId],type:s.getReviewCtxInformation().contextType},new Promise(e=>{if("DesignSight"===d.type||"MSR"===d.type){var t=require("DS/PADUtils/PADUtilsServices").get3DSpaceUrl(),n=require("DS/PADUtils/PADUtilsServices").getPlatformId(),i=require("DS/PADUtils/PADUtilsServices").getWidgetId(),o=t+"/resources/enorelnav/navigate/setpreferences?tenant="+n;require("DS/WAFData/WAFData").authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify({widgetId:i,relations:["use-auto-by-type-relations"],countmanagement:!1}),onComplete:function(){var a={widgetId:i,ecoSystemWithDetail:!0,debug:!1};a.id=d.ids[0],o=t+"/resources/enorelnav/navigate/getecosystem?tenant="+n,require("DS/WAFData/WAFData").authenticatedRequest(o,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",data:JSON.stringify(a),onComplete:function(t){(t=JSON.parse(t)).newstructure.simulation_to&&t.newstructure.simulation_to[0]?e([t.newstructure.simulation_to[0].id]):e([])},onFailure:function(){e()},onTimeout:function(){e()}})},onFailure:function(){e()},onTimeout:function(){e()}})}else e(d.ids)})).then(e=>{e&&(0===i.reportedAgainst.length&&(i.reportedAgainst=e),i.contexts=e,"R2V_FeatureState"===c.getLoadingContextController({context:g}).getLoadMarkupCtxType()?i.description=function(e,t){let n;return new Promise((i,o)=>{var a=require("DS/PADUtils/PADUtilsServices").getPlatformURL("r2vsurvey"),r=require("DS/PADUtils/PADSettingsMgt").getSetting("lang");require("DS/WAFData/WAFData").authenticatedRequest(a+"/enovia/resources/r2v/v1/modeler/featurestate/fetch",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":r},data:JSON.stringify({ids:t}),timeout:6e4,onComplete:function(t){let o=JSON.parse(t);if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var a=u();a.length>0&&a[0].getOwner()&&a[0].getOwner().getDescription?(n=a[0].getOwner().getDescription())||(n=e.getValidation().getContext().getJsonContextNames()[0]):n=void 0!==e.getReviewCtxInformation().reviewDescription?e.getReviewCtxInformation().reviewDescription:e.getValidation().getContext().getJsonContextNames()[0]}else n=void 0!==e.getReviewCtxInformation().reviewDescription?e.getReviewCtxInformation().reviewDescription:o.result[0]["ds6w:label"];i(n)},onFailure:o,onTimeout:o})})}(n,e).then(e=>{i.description=e,i.reportedAgainst=i.contexts=[],p(n,i,t)}):function(e,t){return new Promise(function(n){let i,o=r.clone(t);if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var a=e.getValidation().getContext().getJsonContextTypes()[0];"DesignSight"!==a&&"MSR"!==a||o.push(e.getValidation().getPlmID()),new Promise(function(e){g.getController().getAttributes({ids:o,attributes:["owner","ds6w:description"],callbacks:{onComplete:t=>e(t),onFailure:()=>e}})}).then(function(t){var o=u();o.length>0&&o[0].getOwner()&&o[0].getOwner().getDescription?(i=o[0].getOwner().getDescription())||(i=e.getValidation().getContext().getJsonContextNames()[0]):(t&&t[e.getValidation().getPlmID()]&&(i=t[e.getValidation().getPlmID()]["ds6w:description"]),i||(i=e.getValidation().getContext().getJsonContextNames()[0])),n(i)})}else{i=e.getReviewCtxInformation().reviewDescription?e.getReviewCtxInformation().reviewDescription:"";let o,a=[],r=e.getReviewCtxInformation().contextId;if(!i){a.push(e.getReviewCtxInformation().contextId);let t=require("DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices"),n=t.getRoots(g).map(function(e){return t.getNodeID(e)});-1===n.indexOf(r)&&n.some(function(e){var t=g.getController().isFiltered(e);if(t&&t.hasFilter&&t.filterId===r)return a.push(o=e)})}new Promise(function(e){g.getController().getAttributes({ids:[].concat(t,a),attributes:["ds6w:label"],callbacks:{onComplete:function(t){i||(t[r]&&(i=t[r]["ds6w:label"]),o&&t[o]&&(i+=" ("+t[o]["ds6w:label"]+")")),e(i)},onFailure:()=>e}})}).then(function(e){n(e)})}})}(n,i.reportedAgainst).then(e=>{i.description=e,function(e,t,n){return new Promise(function(i){if("ENOR3V_AP"===window.widget.data.appId||"ENOR3R_AP"===window.widget.data.appId){var o=e.getValidation().getContext().getJsonContextTypes()[0],a=r.clone(t);"DesignSight"!==o&&"MSR"!==o||a.push(e.getValidation().getPlmID()),new Promise(function(e){g.getController().getAttributes({ids:a,attributes:["owner","ds6w:description"],callbacks:{onComplete:t=>e(t),onFailure:()=>e}})}).then(function(e){for(var o=0;o<t.length;o++)e&&e[t[o]].owner&&-1===n.indexOf(e[t[o]].owner)&&n.push(e[t[o]].owner);i()})}else{let o=[];o.push(e.getReviewCtxInformation().contextId),new Promise(function(e){g.getController().getAttributes({ids:[].concat(t,o),attributes:["ds6w:responsibleuid"],callbacks:{onComplete:function(i){t.forEach(e=>{let t=i[e]["ds6w:responsibleuid"];t&&(n||(n=[]),-1===n.indexOf(t)&&n.push(t))}),e()},onFailure:()=>e}})}).then(function(){i()})}})}(n,i.reportedAgainst,i.assignees).then(()=>{p(n,i,t)})}))})}var s,d})}else t.onFailure("No Markup is available")},this._destroy=function(){var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/DMUCommands/DMUNormalViewCmd",["DS/DMUBaseCommands/EXPGenericCmdOneSelThenOperation","DS/DMUBaseCommands/EXPToolsWUX","DS/DMUMeasurable/DMUToolsMaths","DS/DMUBaseExperience/EXPToolsVisualization","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){this._parent(e,this._applyViewpoint,o.normalViewTargetLabel,{engWithPSOHSO:!0,multiAcquisition:!1,multiAcquisitionCtrl:!1,valuedFromCSO:!0,pickingMode:"primHybrid",prePickingMode:"primHybrid"},!0)},beginExecute:function(){t.emptyCSO(),t.emptyHSO(),this._parent()},_applyViewpoint:function(e){var o=e[0].normal,a=e[0].position;if(null!=o&&null!=a){var r=i.getViewpointInfo(this.getFrameWindow().getViewer().currentViewpoint),l=o.angleTo(r.sight);l>Math.PI/2&&l<Math.PI/2*3&&o.negate();var s=n.computeTransformationBetweenTwoLines(r.position,r.sight,a,o);i.moveViewpoint({freeZoneSize:this.getFrameWindow().getImmersiveFrame().getFreeZone().getBoundingClientRect(),viewerSize:{width:this.getFrameWindow().getViewer().SCREEN_WIDTH,height:this.getFrameWindow().getViewer().SCREEN_HEIGHT},viewpoint:this.getFrameWindow().getViewer().currentViewpoint,target:r.position.applyMatrix4(s.transformation),sightDirection:r.sight.transformDirection(s.transformation),upDirection:r.up.transformDirection(s.transformation),targetDistance:r.distance,duration:400})}t.emptyCSO()}})}),define("DS/DMUCommands/DMUPositionOverloadCmd",["DS/Visualization/ThreeJS_DS","DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/Selection/CSOManager","DS/CATW3DBoxes/CATW3DBoxController","DS/CATW3DRobot/CATW3DRobot","DS/CATW3DMoveManager/CATW3DMoveManager","DS/CATW3DCommands/CATW3DMoveBarUX","DS/ApplicationFrame/CommandsManager","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a,r,l,s,d,c,g,u){"use strict";return t.extend({init:function(t){this._parent(t,{mode:"exclusive",isAsynchronous:!0}),this.setRepeatMode(!1);var m,p,v,D,f,h,C,w,S=this,M=!1,b=[];function x(){M=!1,S.end()}function O(){M=!0,S.end()}function U(e){"Enter"!==e.key&&13!==e.keyCode||!1===e.ctrlKey&&!1===e.altKey&&!1===e.shiftKey&&!1===e.metaKey&&O()}function E(t){var i,o=n.getReviewContext({viewer:S.getFrameWindow().getViewer()}),a=o&&!o.isReadOnly()?o.getCurrentSessionMarkup():null,r=[];if(t&&t.objectsMoved&&t.objectsMoved.length&&a){for(var l=0;l<t.objectsMoved.length;l++)if(i=a.getOrCreateOccurrenceOverloader(t.objectsMoved[l],!0)){var s=i.getOccurrencePathElement(),d=s?s.getParentPath().getWorldMatrix():null;if(d){var c=(new e.Matrix4).getInverse(d);i.setAttribute("mTransfoMatrix",(new e.Matrix4).multiplyMatrices(c,t.objectsMoved[l].worldMatrix)),r.push({target:i,state:{mTransfoMatrix:(new e.Matrix4).multiplyMatrices(c,t.objectsMoved[l].worldMatrix)}})}}S.getFrameWindow().getViewer().render();var g=n.giveEventsController({viewer:S.getFrameWindow().getViewer()});g&&r.length&&(g.fireEvent("onDMUOverloadPropertiesChanged",{overloads:r}),g.fireEvent("onSaveRequested",{}))}}function I(){if(C&&C.length)for(var e=0;e<C.length;e++)void 0!==C[e].minimalFlag&&(C[e].ctx.setMinimalUIFlag(C[e].minimalFlag),C[e].ctx.setAnnotationUIVisibleFlag&&C[e].ctx.setAnnotationUIVisibleFlag(!C[e].minimalFlag));C=null,document.removeEventListener("keydown",U),p&&p.destroy(),p=null,D&&D.unreference(),D=null,v&&b.forEach(v.unsubscribe,v),b=[],l.unreferenceMoveManager({context:m}),v=null,a.unregisterBoxController({context:m}),m&&m.getFrameWindow().getContextualUIManager().unregister("DMUMoveCmdCtxBarID")}this.beginExecute=function(){if(!(m=n.getContextViewer({viewer:this.getFrameWindow().getViewer()})))return window.console.log("No PAD3DViewer available!!"),void this.end();var e=g.giveSelectionManager({context:m});e&&e.getActiveState()&&(e.setActiveState(!1),w=!0);var t=m.getViewer();h={primitive:t.picking.primitive,trapSelection:t.picking.trapSelection,trapPrimitive:t.picking.trapPrimitive,trapGPU:t.picking.trapGPU},f=t.pPicking.primitive,t.setPicking({primitive:0,trapSelection:!0,trapPrimitive:!1,trapGPU:!0}),t.setPrePicking({primitive:0}),C=[];for(var S=i.giveDMUApplicativeContextManager({context:m}),I=S?S.getApplicativeControllers():[],P=0;P<I.length;P++)I[P].setMinimalUIFlag&&(C.push({ctx:I[P],minimalFlag:I[P].getMinimalUIFlag()}),I[P].setMinimalUIFlag(!0),I[P].setAnnotationUIVisibleFlag&&I[P].setAnnotationUIVisibleFlag(!1));d.getCommand("DMULevelSelectorHdr",m.getCommandContext()).showReferentLevel(!0),M=!1,l.unreferenceMoveManager({context:m}),v=l.getMoveManager({context:m}),b.push(v.subscribe("onValidateMove",E)),b.push(v.subscribe("MoveEnd",function(){m.getController().forceRefresh()})),D=r.getMove3DRobot({context:m});var A,y=o.get();y.length&&(y[y.length-1].event&&(A=t.pick(t.getMousePosition(y[y.length-1].event.getCurrentPosition(t.canvas)),"mesh",!0).position),D.modifyTargetAndPosition({pathElement:y[0].pathElement,robotPosition:A}));(p=new s({uiFrame:m.getFrameWindow().getUIFrame(),onSave:O,onCancel:x,nlsModifLbl:u.movePartsOrPrdLabel})).show();var R=v.subscribe("Move",function(){p.showSave(),v.unsubscribe(R)}),F=a.getBoxController({context:m});F&&F.setActiveState(!0),document.addEventListener("keydown",U),m.getFrameWindow().getContextualUIManager().register({subscriberId:"DMUMoveCmdCtxBarID",workbenchName:"CATW3DCommands",context:m.getCommandContext(),module:"CATW3DCommands",cmdPrefix:"",directory:"assets/afr/",merge:!0,onContextualBarReady:function(){var e=o.get();if(1===e.length)for(var t=e[0].pathElement;t;){if(c.isPLMNode(t.getLastElement(!0)))return{cmdList:[{name:"LevelSelectorStr",line:1,hdr_list:["LevelSelectorHdr"]}]};t=t.getParentPath()}}})},this.endExecute=function(){v.terminateMove({save:M}),require(["DS/DMUBaseExperience/EXPUtils"],function(e){e._sendUsageProbe("command",M?"MoveOK":"MoveCancel")}),d.getCommand("DMULevelSelectorHdr",m.getCommandContext()).showReferentLevel(!1),I(),m.getFrameWindow().getContextualUIManager().hideContextualMenus();var e=g.giveSelectionManager({context:m});e&&w&&e.setActiveState(!0),w=null;var t=m.getViewer();t.setPicking(h),t.setPrePicking({primitive:f})},this.pauseExecute=function(){a.getBoxController({context:m}).setActiveState(!1),D.setVisibility(!1),p.hide(),document.removeEventListener("keydown",U)},this.resumeExecute=function(){a.getBoxController({context:m}).setActiveState(!0),D.setVisibility(!0),p.show(),document.addEventListener("keydown",U)},this.getRequestedCommandMode=function(e){return"Measure"===e.cmd||"Section"===e.cmd?"shared":void 0},this.allowManipulation=function(e){return"Measure"===e.object||"Section"===e.object||void 0},this._destroy=function(){I(),Object.getPrototypeOf(this)._destroy.apply(this,arguments),m=v=p=D=S=null}}})}),define("DS/DMUCommands/DMUFLEditPropertiesCmd",["UWA/Class","DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend(t,{init:async function(e){let t=this;t._parent(e,{mode:"shared",isAsynchronous:!1}),t.getSelect=function(){return new Promise(e=>{require(["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADContext"],function(t,o){var a,r,l=i.get();if(l.length&&l.some(function(e){return t.isAModelPath(e.pathElement)})){for(var s=l[0].pathElement.externalPath.length-1;s>=0&&((r=l[0].pathElement.externalPath[s])&&!t.isPLMNode(r));--s){if(r.getDibInfo){var d=s>0?l[0].pathElement.externalPath[s-1]:null;e([{dibInfo:r.getDibInfo(),parentDibInfo:d&&d.getDibInfo?d.getDibInfo():null}])}r.getReqInfo&&e([{reqInfo:r.getReqInfo(),parentDocInfo:null}])}e(l)}var c=n.getReviewContext({context:o.get()}),g=c?c.getReviewCtxInformation():{};g&&g.reviewId&&(a=[{mkpID:g.reviewId}]),e(a||[])})})},i.onPostAdd(function(){if(window&&window.__karma__&&window.editPropertiesCmdDoNotListenToCSOEvents)return;require(["DS/TransientWidget/TransientWidget"],function(e){t.getSelect().then(n=>{n&&n.length>0?(e.isOpen&&t.execute(),t.enable()):t.disable()})})}),i.onEmpty(function(){window&&window.__karma__&&window.editPropertiesCmdDoNotListenToCSOEvents||t.disable()}),i.onRemove(async function(){if(window&&window.__karma__&&window.editPropertiesCmdDoNotListenToCSOEvents)return;const e=await t.getSelect();e&&e.length>0?t.enable():t.disable()});const o=await t.getSelect();o&&o.length>0?t.enable():t.disable()},execute:async function(){const e=require("DS/PADUtils/PADSettingsMgt");var t=await this.getSelect(),n=[],i=[];if(t.length){if(t[0].dibInfo)i.push({refID:t[0].dibInfo.id});else if(t[0].reqInfo)i.push({refID:t[0].reqInfo.id});else{for(var o=0;o<t.length;o++)n.push(t[o].pathElement);n.forEach(function(e){require(["DS/ENOPAD3DViewer/utils/PAD3DViewerModelServices","DS/PADUtils/PADContext"],function(t,n){for(;e&&!t.isPLMNode(e.getLastElement(!0));)e=e.getParentPath();if(!e&&n.get().isSelectiveLoadingActivated()){var o=n.get().getController().getOOCSelectedReferenceID();o&&i.push({refID:o,instID:null})}else{var a=e.getLastElement(!0),r=e.getParentPath().getLastElement(!0);i.push({refID:t.getNodeID(a),instID:t.getNodeID(r)})}})})}var a={getSelectedNodes:function(){var t=[];return i.forEach(function(n){var i={id:n.refID,tenant:e.getSetting("x3dPlatformId"),source:"3DSpace",getID:function(){return n.refID},getRelationID:function(){return n.instID}};t.push(i)}),t},getSecurityContext:function(){return{SecurityContext:e.getSetting("pad_security_ctx"),tenant:e.getSetting("x3dPlatformId")}}};this.launchProperties(a)}else this.endExecute()},setObject:function(e){this._objectId=e}})}),define("DS/DMUCommands/DMURemoveOverloadCmd",["DS/ApplicationFrame/Command","DS/Selection/CSOManager","DS/DMUBaseExperience/DMUContextManager","DS/DMUControls/DMUOptionsPanel","DS/DMUMeasurable/DMUToolsSceneGraph","i18n!DS/DMUCommands/assets/nls/DMUCommands"],function(e,t,n,i,o,a){"use strict";return e.extend({init:function(e){var t=e||{};t.mode="shared",this._parent(t)},beginExecute:function(e){this._parent(e);var r=this,l=[],s=function(){var e=n.giveEventsController({viewer:r.getFrameWindow().getViewer()});e&&e.fireEvent("onDMUOccOverloadRemoved",l)},d=n.getReviewContext({viewer:this.getFrameWindow().getViewer()}),c=d?d.getCurrentSessionMarkup():null;if(c&&!c.isReadOnly()){var g,u,m,p=t.get(),v=[];for(u=0;u<p.length;u++)!(g=p[u].pathElement.getLastElement(!0)).getDMUType||"DMUSlide"!==g.getDMUType()&&"DMUFormat"!==g.getDMUType()||v.push(c.getDMUObjectFromPathElement(p[u].pathElement));var D=!1;if(v.length||(D=!0,v.push(c.getCurrentSlide())),v.length){var f=[],h=!1,C=!1;if(D)for(u=0;u<p.length;u++){var w,S=c.getOrCreateOccurrenceOverloader(p[u]);S&&(w=v[0].getOverloadForTarget(S))&&w.state&&(f.push({slide:v[0],slideOverload:w,overload:S}),(w.state.mPosition||w.state.mTransfoMatrix)&&(h=!0),(void 0!==w.state.bVisible&&null!==w.state.bVisible||void 0!==w.state.cColor&&null!==w.state.cColor||void 0!==w.state.fOpacity&&null!==w.state.fOpacity)&&(C=!0));var M=p[u].pathElement.clone();o.isInstance(M.getParentPath().getLastElement(!0))&&(S=c.getOrCreateOccurrenceOverloader({pathElement:M.getParentPath()}))&&(w=v[0].getOverloadForTarget(S))&&w.state&&(f.push({slide:v[0],slideOverload:w,overload:S}),(w.state.mPosition||w.state.mTransfoMatrix)&&(h=!0),(void 0!==w.state.bVisible&&null!==w.state.bVisible||void 0!==w.state.cColor&&null!==w.state.cColor||void 0!==w.state.fOpacity&&null!==w.state.fOpacity)&&(C=!0))}else for(u=0;u<v.length;u++){var b=v[u].getObjectOverloads();for(m=0;m<b.length;m++)b[m].state&&(f.push({slide:v[u],slideOverload:b[m],overload:b[m].target}),(b[m].state.mPosition||b[m].state.mTransfoMatrix)&&(h=!0),(void 0!==b[m].state.bVisible&&null!==b[m].state.bVisible||void 0!==b[m].state.cColor&&null!==b[m].state.cColor||void 0!==b[m].state.fOpacity&&null!==b[m].state.fOpacity)&&(C=!0))}var x=function(){f.forEach(function(e){e.slide.removeObjectOverload(e.slideOverload),l.push({target:e.overload})}),r.getFrameWindow().getViewer().render(),s()};if(C&&h)new i({frmWindow:r.getFrameWindow(),panelTitle:a.removeObjectOverloadPanelTitle,options:[{nls:a.graphicOverloads,id:"DMURemoveGraphicOverloads",value:"false"!==localStorage.getItem("DMURemoveGraphicOverloads")},{nls:a.positionOverloads,id:"DMURemovePositionOverloads",value:"false"!==localStorage.getItem("DMURemovePositionOverloads")}],cb:function(e){if(e){var t;if(e.DMURemoveGraphicOverloads&&e.DMURemovePositionOverloads)x();else e.DMURemoveGraphicOverloads?(f.forEach(function(e){e.slideOverload.state.mPosition||e.slideOverload.state.mTransfoMatrix?(t={},null!==e.overload.getAttribute("bVisible")&&(e.overload.setAttribute("bVisible",null),t.bVisible=null),null!==e.overload.getAttribute("cColor")&&(e.overload.setAttribute("cColor",null),t.cColor=null),null!==e.overload.getAttribute("fOpacity")&&(e.overload.setAttribute("fOpacity",null),t.fOpacity=null),l.push({target:e.overload,state:t})):(e.slide.removeObjectOverload(e.slideOverload),l.push({target:e.overload}))}),s(),localStorage.removeItem("DMURemoveGraphicOverloads")):localStorage.setItem("DMURemoveGraphicOverloads","false"),e.DMURemovePositionOverloads?(f.forEach(function(e){void 0!==e.slideOverload.state.bVisible&&null!==e.slideOverload.state.bVisible||void 0!==e.slideOverload.state.cColor&&null!==e.slideOverload.state.cColor||void 0!==e.slideOverload.state.fOpacity&&null!==e.slideOverload.state.fOpacity?(t={},null!==e.overload.getAttribute("mPosition")&&(e.overload.setAttribute("mPosition",null),t.mPosition=null),null!==e.overload.getAttribute("mTransfoMatrix")&&(e.overload.setAttribute("mTransfoMatrix",null),t.mTransfoMatrix=null),l.push({target:e.overload,state:t})):(e.slide.removeObjectOverload(e.slideOverload),l.push({target:e.overload}))}),s(),localStorage.removeItem("DMURemovePositionOverloads")):localStorage.setItem("DMURemovePositionOverloads","false");r.getFrameWindow().getViewer().render()}}});else x()}}this.end()}})});