define("DS/MobileAppProxy/MobileAppProxy",["DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(o){"use strict";var e=function(){console.log("MobileAppProxy :: onWidgetRefresh")};return function(t){var n=t.widget;n.addEvent("onLoad",function(e){console.log("MobileAppProxy :: onWidgetLoad");var t=new Promise(function(o,e){top.require(["DS/i3DXCompass/Data","DS/i3DXCompass/X3DContent"],function(t,n){t.getCasTgc({onComplete:function(e){o({CASTGC:e,myAppsBaseUrl:t.myAppsBaseUrl,content:n.getX3DContent()})},onFailure:function(o,t,n){var s="CompassData.getCasTgc():  onFailure";o&&o.message&&(s+="==>  "+o.message),console.error(s),e(s)}})})}),n=new Promise(function(e,t){o.getPlatformServices({onComplete:function(o){e(o)}})});Promise.all([t,n]).then(function(o){var e="threedshare://",t=o[0],n=o[1],s=t.myAppsBaseUrl,a=t.CASTGC,r=(C=t.content)&&C.data&&C.data.items[0],l=n[0];if(r)for(var c of n)if(r.envId===c.platformId){l=c;break}var i,p,d,f,g,m,C,v=l["3DPassport"],u=l.platformId;(r=(C=t.content)&&C.data&&C.data.items[0])&&(u=r.envId,i=r.objectId,p=r.objectType,g="&-object&"+i+"&-serviceId&"+(d=r.serviceId)+"&-objectType&%22"+p+"%22",(f=l[d])&&(g+="&-Url="+f),(m=r.contextId)&&(g+="&-Ctx&%22"+m+"%22")),console.log("myAppsUrl",s),console.log("CASTGC",a),console.log("passportURL",v),console.log("tenant :",u),console.log("objectId :",i),console.log("objectType :",p),console.log("serviceId :",d),console.log("Url :",f),console.log("Ctx :",m),e+="?-passportURL="+v+"&-Cas=%22CASTGC="+a+"%22&-tenant="+u+"&-MyAppsURL="+s,g&&(e+=g),console.log("App Url to load :",e),window.location=e})}()),n.addEvent("onRefresh",e)}});