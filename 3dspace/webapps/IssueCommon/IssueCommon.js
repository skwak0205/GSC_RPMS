define("DS/IssueCommon/commands/Open",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{execute:function(){require(["DS/IssueComponents/open/Open"],function(e){e.openWith()})}})}),define("DS/IssueCommon/utils/Selector",["UWA/Core","DS/IssueServices/Contexts"],function(e,t){"use strict";var n="Issue",s="ENXISSU_AP",a="ENX3DIR_AP",i=function(s){for(var a={physicalIds:[],issueNames:[],map:{}},i=s&&e.is(s.type,"string")?s.type:"all",o=t.get("component").getSelectedNodes(),r=0;r<o.length;r++){var c=o[r];"issue"!==i&&"all"!==i||c.options.type!==n&&c.options.baseType!==n||(a.physicalIds.push(c.options.physicalId),a.issueNames.push(c.options.name),a.map[c.options.physicalId]={id:c.options.physicalId,physicalId:c.options.physicalId,type:c.options.type,name:c.options.name,title:c.options.title,description:c.options.description,owner:c.options.owner,coOwners:c.options.coOwners,assignees:c.options.assignees,contributors:c.options.contributors,contexts:c.options.contexts,reportedAgainst:c.options.reportedAgainst,resolvedBy:c.options.resolvedBy,resolvedItems:c.options.resolvedItems}),"object"!==i&&"all"!==i||c.options.baseType===n||(a.physicalIds.push(c.options.physicalId),a.issueNames.push(c.options.name),a.map[c.options.physicalId]={id:c.options.physicalId,physicalId:c.options.physicalId,type:c.options.type,name:c.options.name,title:c.options.title})}return a},o=function(s){var a={physicalIds:[],issueNames:[],map:{}},i=s&&e.is(s.type,"string")?s.type:"all",o=t.get("component").getManager();if(null===o)return a;for(var r=t.get("component").getSelectedIssues(),c=o.getIssues().map,l=0;l<r.length;l++){var d=c[r[l].id].model;"issue"!==i&&"all"!==i||d.get("type")!==n&&d.get("baseType")!==n||(a.physicalIds.push(d.get("physicalId")),a.issueNames.push(d.get("name")),a.map[d.get("physicalId")]={id:d.get("physicalId"),physicalId:d.get("physicalId"),type:d.get("type"),name:d.get("name"),title:d.get("title"),description:d.get("description"),owner:d.get("owner"),coOwners:d.get("coOwners"),assignees:d.get("assignees"),contributors:d.get("contributors"),contexts:d.get("contexts"),reportedAgainst:d.get("reportedAgainst"),resolvedBy:d.get("resolvedBy"),resolvedItems:d.get("resolvedItems")}),"object"!==i&&"all"!==i||d.type===n&&d.get("baseType")===n||(a.physicalIds.push(d.id),a.issueNames.push(d.name),a.map[d.id]={id:d.id,physicalId:d.id,type:d.type,name:d.name,title:d.title})}return a};return{getSelection:function(e){var n=t.get("widget")||window.widget;return n.name===s?i(e):n.name===a?o(e):{physicalIds:[],issueNames:[],map:{}}}}}),define("DS/IssueCommon/commands/Delete",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e)},execute:function(){require(["DS/IssueComponents/delete/Delete","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(e,t,n){var s=n.get("widget")||window.widget,a=t.getSelection({type:"issue"});s.body.getElement(".delete-issues-dialog")||new e({physicalIds:a.physicalIds}).render()})}})}),define("DS/IssueCommon/utils/TaskManager",["UWA/Core","UWA/Class","UWA/Class/Events","DS/PlatformAPI/PlatformAPI","DS/IssueServices/Contexts","css!DS/IssueCommon/IssueCommon.css"],function(e,t,n,s,a){"use strict";var i={ISU_TASK_MANAGER:"ISU_TASK_MANAGER"},o={FILTER:"FILTER",SELECT_IN_3D:"SELECT_IN_3D",PREFERENCES:"PREFERENCES",ADD_OBJECTS:"ADD_OBJECTS",TAKE_SCREENSHOT:"TAKE_SCREENSHOT",GET_FILTERED_ISSUES:"GET_FILTERED_ISSUES"},r={NEW:"NEW",PROCESSING:"PROCESSING"},c=0;return t.singleton(n,{_counter:0,_taskList:[],_subscriber:[],_metadataOpts:{},init:function(){this._counter=0,this._taskList=[],this._subscriber=[],this._metadataOpts={},this._metadataOpts[i.ISU_TASK_MANAGER]=i.ISU_TASK_MANAGER,this._subscriber.push(s.subscribe("DS/IssueManagementTask/ready",this._ready.bind(this))),this._subscriber.push(s.subscribe("DS/IssueManagementTask/done",this._end.bind(this)))},destroy:function(){},add:function(t,n,i,c){if(!e.is(t,"string"))throw new Error('Invalid arguments[0] "type". Expected a String');if(-1===Object.keys(o).indexOf(t))throw new Error('Task type "'+t+'" is not supported');if(!e.is(n,"array"))throw new Error('Invalid arguments[1] "args". Expected an Array');if(!e.is(i,"function"))throw new Error('Invalid arguments[2] "callback". Expected a Function');if(e.is(c)&&!e.is(c,"function"))throw new Error('Invalid arguments[3] "cancelCallback". Expected a Function');var l=a.get("widget")||window.widget;this._counter+=1;var d={taskType:t,taskId:"id-"+this._counter,state:r.NEW,widgetIdIM:l.id,widgetId3D:"",args:n,callback:i,cancelCallback:c||null};this._taskList.push(d);var u=[],m={};return u.push([d.taskId]),m[d.taskId]={taskType:d.taskType,widgetIdIM:d.widgetIdIM},s.publish("DS/IssueManagementTask/add",{metadata:{appId:l.id,appName:l.name,timestamp:Math.floor(Date.now()),options:e.clone(this._metadataOpts)},data:{paths:u,attributes:m},version:"1.0"}),d},cancelAll:function(){for(var e=this._taskList.slice(),t=0;t<e.length;t++)this.cancel(e[t].taskId)},getTaskList:function(){return this._taskList},_searchTask:function(e){for(var t=0;t<this._taskList.length;t++)if(this._taskList[t].taskId===e)return this._taskList[t];return null},_removeTask:function(e){for(var t=0;t<this._taskList.length;t++)if(this._taskList[t].taskId===e){this._taskList.splice(t,1);break}},_end:function(t){var n,s,i=a.get("widget")||window.widget;if(t.data.paths.length>0){var o=t.data.paths[c][c],r=t.data.attributes[o],l=this._searchTask(o);n=i.body.getDimensions().height,s=window.getComputedStyle(i.body),0!==n&&"none"!==s.display&&l&&l.widgetIdIM===r.widgetIdIM&&l.widgetId3D===r.widgetId3D&&(this._removeTask(l.taskId),t.metadata.options.canceled?e.is(l.cancelCallback,"function")&&l.cancelCallback():l.callback(r.response))}},cancel:function(t){var n=this._searchTask(t);n&&(""!==n.widgetId3D?this.publish(n,"cancel"):(this._removeTask(n.taskId),e.is(n.cancelCallback,"function")&&n.cancelCallback()))},publish:function(t,n){var i=a.get("widget")||window.widget,o=[],r={};o.push([t.taskId]),r[t.taskId]={taskId:t.taskId,taskType:t.taskType,widgetIdIM:t.widgetIdIM,widgetId3D:t.widgetId3D},s.publish("DS/IssueManagementTask/"+n,{metadata:{appId:i.id,appName:i.name,timestamp:Math.floor(Date.now()),options:e.clone(this._metadataOpts)},data:{paths:o,attributes:r},version:"1.0"})},addSelectIn3DTask:function(e,t,n){return this.add(o.SELECT_IN_3D,[n],e,t)},addFilterTask:function(t,n){if(!e.is(t,"array"))throw new Error('Invalid arguments[0] "ids". Expected an Array');if(!e.is(n,"function"))throw new Error('Invalid arguments[1] "callback". Expected a Function');var s=[t];return this.add(o.FILTER,s,n,null)},addPreferencesTask:function(t){if(!e.is(t,"function"))throw new Error('Invalid arguments[1] "callback". Expected a Function');return this.add(o.PREFERENCES,[],t,null)},addGetFilteredIssuesTask:function(t){if(!e.is(t,"function"))throw new Error('Invalid arguments[1] "callback". Expected a Function');return this.add(o.GET_FILTERED_ISSUES,[],t,null)},addObjectsTask:function(e,t){return this.add(o.ADD_OBJECTS,[],e,t)},addTakeScreenshotTask:function(e,t){return this.add(o.TAKE_SCREENSHOT,[],e,t)},_isMasked:function(e){return e.hasClassName("masked")},_ready:function(t){var n=a.get("widget")||window.widget;if(t.data.paths.length>0){var i=t.data.paths[c][c],o=t.data.attributes[i],l=this._searchTask(i);if(l&&l.widgetIdIM===o.widgetIdIM&&l.state===r.NEW){l.state=r.PROCESSING,l.widgetId3D=o.widgetId3D;var d=[],u={};d.push([l.taskId]),u[l.taskId]={taskId:l.taskId,taskType:l.taskType,widgetIdIM:l.widgetIdIM,widgetId3D:l.widgetId3D,args:l.args},s.publish("DS/IssueManagementTask/exec",{metadata:{appId:n.id,appName:n.name,timestamp:Math.floor(Date.now()),options:e.clone(this._metadataOpts)},data:{paths:d,attributes:u},version:"1.0"})}}}})}),define("DS/IssueCommon/utils/DocumentUtils",["UWA/Promise","DS/IssueServices/services/PlatformServices","DS/PADUtils/views/PADAlert","DS/DocumentManagement/DocumentManagement"],function(e,t,n,s){"use strict";return{init:function(){},preview:function(e){this._loadCommands(e,"Preview")},edit:function(e){this._loadCommands(e,"Edit")},undoEdit:function(e){this._loadCommands(e,"UndoEdit")},update:function(e){this._loadCommands(e,"Update")},download:function(e){this._loadCommands(e,"Download")},getDocumentsData:function(n){return new e(function(e,a){s.getDocuments(n,{tenant:t.getTenant(),securityContext:"ctx::"+decodeURIComponent(t.getSecurityContext()),tenantUrl:t.get3DSpaceUrl(),additionalURLParams:"$fields=indexedTypeicon",onComplete:function(t){t.success&&Array.isArray(t.data)?e(t):a()},onFailure:function(e){console.log(e),a()}})})},_loadCommands:function(e,n){var s=this;require(["DS/DocumentCommands/ENOXDocumentCommands","DS/DocumentCommands/DocumentCommandsV2","DS/CoreEvents/ModelEvents","DS/IssueCommon/utils/Utils"],function(a,i,o,r){var c=decodeURIComponent(t.getSecurityContext()),l=t.getTenant(),d=t.get3DSpaceUrl(),u=t.get3DDashboardUrl(),m=(t.get3DSwymUrl(),t.getPlatformUrl()),p={};if("Download"===n||"Preview"===n){var g=e.selected.map(function(e){return e.id});s.getDocumentsData(g).then(function(e){var a=e.data,c=new o;c.subscribe({event:"docv2-show-notification"},function(e){r.displayErrorMessage(e,e.level)}),c.subscribe({event:"docv2-undoedit-complete"},function(e){s.getDocumentsData(g).then(function(t){a=t.data,c.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:e.nodeModel}})})}),c.subscribe({event:"docv2-edit-complete"},function(e){s.getDocumentsData(g).then(function(t){a=t.data,c.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:e.nodeModel}})})}),c.subscribe({event:"docv2-update-complete"},function(e){s.getDocumentsData(g).then(function(t){a=t.data,c.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:e.nodeModel}}),c.publish({event:"docv2-preview-reload-viewer",data:{nodeModel:e.nodeModel}})})}),new i(p={fetchSecurityContext:function(){return decodeURIComponent(t.getSecurityContext())},getSelectedNodes:function(){return a},getDocumentFromNodeModel:function(e){return e},platformUrls:m,events:c}).commands[n].execute()})}else{p={document:{id:e.data.id,contextId:c,serviceId:"3DSpace",envId:l,index:1,data:e.data,type:"Document"},platformUrls:{"3DSpace":d,"3DDashboard":u},onComplete:function(t){console.log("success"),"Update"===t.action&&"attachments"===e.from&&e.menu.dispatchEvent("request:updateFile",{item:e.selected,lock:!0})}};var h=new a;h.init(p),s.cmds=h.render(),s.cmds[n].handler()}})}}}),define("DS/IssueCommon/commands/Compare",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({execute:function(){var e=this;require(["DS/IssueCommon/utils/Selector","DS/IssueComponents/external/Compare"],function(t,n){e.selection=t.getSelection({type:"all"});var s=[];Object.keys(e.selection.map).forEach(function(t){s.push({physicalId:e.selection.map[t].physicalId,type:e.selection.map[t].type})}),n.execute(s)})}})}),define("DS/IssueCommon/commands/CollaborativeLifecycle",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({execute:function(){require(["DS/IssueCommon/utils/Selector","DS/IssueComponents/external/CollaborativeLifecycle"],function(e,t){var n=e.getSelection({type:"all"}),s=[];n.physicalIds.forEach(function(e){var t=e.split(","),n=t[t.length-1];s.push(n)}),t.execute(s)})}})}),define("DS/IssueCommon/commands/CommandsManager",["DS/ApplicationFrame/CommandsManager"],function(e){"use strict";var t={disabled:!1,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}},n="Default";return{setContext:function(e){n=e},disableAll:function(){if(!0!==t.disabled){var s=n,a=e.getCommands(s),i=a?Object.keys(a):[],o=e.getCommandCheckHeaders(s),r=o?Object.keys(o):[];t={disabled:!0,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}};for(var c=0;c<i.length;c++)"function"==typeof a[i[c]].isEnabled&&(a[i[c]].isEnabled()?t.commands.toEnable.push(i[c]):t.commands.toDisable.push(i[c]));for(var l=0;l<r.length;l++)"function"==typeof o[r[l]].isEnabled&&(o[r[l]].isEnabled()?t.commandCheckHeaders.toEnable.push(r[l]):t.commandCheckHeaders.toDisable.push(r[l]));(t&&(t.commands.toEnable.length||t.commands.toDisable.length)||t&&(t.commandCheckHeaders.toEnable.length||t.commandCheckHeaders.toDisable.length))&&e.disableAll(s)}},enableAll:function(){if(!1!==t.disabled){var s=n;(t&&(t.commands.toEnable.length||t.commands.toDisable.length)||t&&(t.commandCheckHeaders.toEnable.length||t.commandCheckHeaders.toDisable.length))&&e.enableAll(s);var a=e.getCommands(s);if(t&&t.commands){for(var i=0;i<t.commands.toEnable.length;i++)a[t.commands.toEnable[i]].enable();for(var o=0;o<t.commands.toDisable.length;o++)a[t.commands.toDisable[o]].disable()}var r=e.getCommandCheckHeaders(s);if(t&&t.commandCheckHeaders){for(var c=0;c<t.commandCheckHeaders.toEnable.length;c++)r[t.commandCheckHeaders.toEnable[c]].enable();for(var l=0;l<t.commandCheckHeaders.toDisable.length;l++)r[t.commandCheckHeaders.toDisable[l]].disable()}t={disabled:!1,commands:{toEnable:[],toDisable:[]},commandCheckHeaders:{toEnable:[],toDisable:[]}}}},getCommand:function(t){var s=n;return e.getCommand(t,s)},getCommandCheckHeader:function(t){var s=n;return e.getCommandCheckHeader(t,s)},clean:function(t){t||(t="Default"),e._commandsState[t]={lastCommand:[],currentCommand:null,defaultCommand:null},e.resetDefaultCommand(t),e._isCommandEnding=!1,e._ignoreCommandBeginWhileEndingCommand=!1,["_commands","_cmdCheckHeader"].forEach(function(n){var s=t&&e[n][t]?e[n][t]:e[n];Object.keys(s).forEach(function(e){var t=s[e];t&&t._destroy&&t._destroy(),delete s[e]})})}}}),define("DS/IssueCommon/commands/Move",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";var n=200;return t.extend({init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var t=this;require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_ChangeOwnerCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(s,a,i,o,r,c,l){var d=c.get("widget")||window.widget,u=o.getCommand("ActionBar_ChangeOwnerCmd_"+d.id);e.is(u,"object")||a.app_initialization(function(){var a=r.getSelection({type:"issue"}),o=[];a.physicalIds.forEach(function(e){var t={getID:function(){return a.map[e].id},getLabel:function(){return a.map[e].title}};o.push(t)});var c={securityContext:{SecurityContext:"ctx::"+decodeURIComponent(l.getSecurityContext())},getSecurityContext:function(){return this.securityContext},getSelectedNodes:function(){return o}};e.is(u,"object")||(u=new s({ID:"ActionBar_ChangeOwnerCmd_"+d.id,context:c})),u.onEnd(function(){t.end();var e=setInterval(function(){u.transferOwnershipPanel&&u.transferOwnershipPanel.addEvent&&(clearInterval(e),u.transferOwnershipPanel.addEvent("onClose",function(){for(var e=[],t={},n=r.getSelection({type:"issue"}),s=n.physicalIds,a=0;a<s.length;a++)e.push([n.map[s[a]].id]),t[n.map[s[a]].id]={id:n.map[s[a]].id,type:n.map[s[a]].type,name:n.map[s[a]].name,title:n.map[s[a]].title,modifiedAttributes:["owner"]};i.publish("DS/Object/update",{metadata:{appId:d.id,appName:d.name,timestamp:Math.floor(Date.now())},data:{paths:e,attributes:t},version:"1.0"})}))},n)})}),e.is(u,"object")&&u.begin()})}})}),define("DS/IssueCommon/commands/RelationalExplorer",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({execute:function(){require(["DS/IssueCommon/utils/Selector","DS/IssueComponents/external/RelationalExplorer"],function(e,t){var n=e.getSelection({type:"all"}),s=[];n.physicalIds.forEach(function(e){var t=e.split(","),n=t[t.length-1];s.push(n)}),t.execute(s)})}})}),define("DS/IssueCommon/commands/Duplicate",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e)},execute:function(){require(["DS/IssueComponents/duplicate/Duplicate","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(e,t,n){var s=n.get("widget")||window.widget,a=t.getSelection({type:"issue"});s.body.getElement(".duplicate-issues-dialog")||new e({physicalIds:a.physicalIds}).render()})}})}),define("DS/IssueCommon/commands/3DMarkup",["DS/ApplicationFrame/Command"],function(e){"use strict";return e.extend({execute:function(){require(["DS/IssueCommon/utils/Selector","DS/IssueComponents/external/3DMarkup"],function(e,t){var n=e.getSelection({type:"all"});t.execute(n.physicalIds)})}})}),define("DS/IssueCommon/commands/AttachmentManager",["UWA/Class","UWA/Core","UWA/Class/Listener","DS/ApplicationFrame/Command"],function(e,t,n,s){"use strict";var a="ENXISSU_AP",i="ENX3DIR_AP",o=100,r=!0;return e.extend(s,n,{_instances:[],init:function(e){this._parent(e,{isAsynchronous:!0}),this.authoring=null,this.selectedObject=null},execute:function(){var e=this;require(["DS/ENOFloatingPanel/ENOFloatingPanel","DS/PlatformAPI/PlatformAPI","DS/IssueAttachmentManager/IssueAttachmentManager","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/utils/LocalStorage","UWA/Class/Promise","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(n,s,c,l,d,u,m,p){var g=d.get("widget"),h=d.get("component"),f=d.get("eventsHandler");new m(function(n){var s="",o="",r="";if(t.is(e.selectedObject)&&t.is(e.selectedObject.physicalId,"string")&&t.is(e.selectedObject.title,"string")&&t.is(e.selectedObject.name,"string"))n({id:e.selectedObject.physicalId,title:e.selectedObject.title,name:e.selectedObject.name});else if(g.name===a){var c=h.getSelectedNodes();c.length>0&&(s=c[c.length-1].options.id,o=c[c.length-1].options.title,r=c[c.length-1].options.name),n({id:s,title:o,name:r})}else if(g.name===i){var l=h.getSelectedIssues();l.length>0&&(s=l[l.length-1].id,o=l[l.length-1].title,r=l[l.length-1].name),n({id:s,title:o,name:r})}}).then(function(a){var u=a.id,m=a.title,S=a.name,I=Date.now(),E=g.body.getDimensions(),C={mode:1,catalogLayout:2,catalogVisibility:!0,sliderVisibility:!1,height:E.height-100,width:E.width-100,top:"20px",left:"50px",annotationPreLaunchCallback:function(){if(e._instances.hasOwnProperty(I)&&l.Mask.mask(e._instances[I].elements.container),g.name===i)try{this.annotationCanvasTarget=t.Element.getElement.call(h.get3DContext().root.getFrameWindow().elements.viewerFrame,"canvas")}catch(e){}else this.annotationCanvasDefaultDimensions={width:E.width-50,height:E.height-50}},annotationSaveCallback:function(){e._instances.hasOwnProperty(I)&&l.Mask.unmask(e._instances[I].elements.container)},annotationExitCallback:function(){e._instances.hasOwnProperty(I)&&l.Mask.unmask(e._instances[I].elements.container)}},v=t.clone(g.getValue("attachmentManagerModalPreferences")),y=t.clone(g.getValue("attachmentManagerPreferences")),D=t.merge(v||{},C);(D=t.merge(y||{},D)).id=u,D.authoring=t.is(e.authoring,"boolean")?e.authoring:r;var A=new c(D),b=e._instances[I]=new n({animate:!0,autocenter:!0,closable:!0,limitParent:!1,overlay:!1,resizable:!0,visible:!0,className:"isu-am-modal",title:p.replace(p.attachments.title,{title:m,name:S}),header:null,body:A,events:{onShow:function(){var t=this;t.attachmentManager=A,t.instanceId=I,t._subscriberId=Math.random().toString(36).substr(2,9),t.attachmentManager.render(),t.attachmentManager.isLoaded.then(function(){e._utils._addCustomCommands.apply(t),t.attachmentManager.container.setAttribute("tabindex","0"),t.attachmentManager.container.focus(),t.attachmentManager.resize();var n=l.throttle(function(){t.attachmentManager.resize()},o);e.listenTo(t,"onResizeFloating",n),e.listenTo(t.attachmentManager,"onRefresh",e._utils._addCustomCommands.bind(t)),e.listenTo(t.attachmentManager,"onUpdate",function(e){for(var n=[],a={},i=Object.keys(e.objects),o=0;o<i.length;o++)n.push([e.objects[i[o]].physicalId]),a[e.objects[i[o]].physicalId]={id:e.objects[i[o]].physicalId,type:e.objects[i[o]].type||"Issue",modifiedAttributes:["attachments"]};var r="DS/Object/update",c={metadata:{appId:d.get("widget").id,appName:d.get("widget").name,timestamp:Math.floor(Date.now()),options:{}},data:{paths:n,attributes:a},version:"1.0"};null!==f?f.publish(t._subscriberId,r,c):s.publish(r,c)}),t._eventListeners=[{event:"DS/Object/update",listener:function(e){t.attachmentManager&&t.attachmentManager.id&&(e.data.paths.some(function(e){return t.attachmentManager.id===e[0]})&&t.attachmentManager.refresh())},conditions:{type:"issue",attributes:["attachments"]}},{event:"DS/Object/select",listener:function(n){if(!t._holdIssueFlg){var s="";if(1===n.data.paths.length&&(s=n.data.paths.pop().pop()),""!==s&&s!==t.attachmentManager.collection.id){var a="",i="";if(n.data.attributes.hasOwnProperty(s)){var o=n.data.attributes[s];a=o.title,i=o.name}t.setTitle(p.replace(p.attachments.title,{title:a,name:i})),t.attachmentManager.refresh(s).then(function(){e._utils._addCustomCommands.apply(t)})}}},conditions:{type:"issue"}}];for(var a=0;a<t._eventListeners.length;a++){var i=t._eventListeners[a];i.token=null!==f?f.subscribe(t._subscriberId,i.event,i.listener.bind(t),i.conditions):s.subscribe(i.event,i.listener.bind(t))}e.authoring=null,e.selectedObject=null,e.end()}).catch(function(e){if(e.internalError&&e.internalError.includes("ErrorCode:1500127")){var t=l.getErrorMessage("0");l.displayErrorMessage(t,"error"),b.destroy()}else PADAlert.displayNotification({msg:p.notifications.Init.failure,eventID:"error"})})},onClose:function(){if(g.setValue("attachmentManagerModalPreferences",{width:this.elements.container.clientWidth,height:this.elements.container.clientHeight,top:this.elements.container.offsetTop,left:this.elements.container.offsetLeft}),e.stopListening(this,"onResizeFloating"),e.stopListening(this.attachmentManager,"onUpdate"),Array.isArray(this._eventListeners))for(var t=0;t<this._eventListeners.length;t++){var n=this._eventListeners[t];null!==f?f.unsubscribe(n.token):s.unsubscribe(n.token)}this._eventListeners=[],this.attachmentManager.resetPADAlert(),this.attachmentManager.destroy(),this.attachmentManager=null,delete e._instances[this.instanceId],this.destroy()}}});b.inject(g.body),b.elements.container.setStyle("height",D.height),b.elements.container.setStyle("width",D.width),b.elements.container.setStyle("zIndex","25")})})},_utils:{_addCustomCommands:function(){var e=this;require(["i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(t){var n=function(){e._holdIssueFlg=!e._holdIssueFlg,e.attachmentManager.views.header.iconBarFix.getItem("hold").elements.container.toggleClassName("active",e._holdIssueFlg),e.attachmentManager.contextualMenu.customCommands.forEach(function(t){"hold"===t.name&&(t.state=e._holdIssueFlg?"selected":"unselected")})};(e._holdIssueFlg=!1,e.attachmentManager.views.header.iconBarFix.addItem({id:"hold",fonticon:"pin",text:t.attachments.holdIssue,selectable:!0,handler:n}),e.attachmentManager&&e.attachmentManager.contextualMenu&&e.attachmentManager.contextualMenu.customCommands)&&(e.attachmentManager.contextualMenu.customCommands.some(function(e){return"hold"===e.name})||e.attachmentManager.contextualMenu.customCommands.push({name:"hold",title:t.attachments.holdIssue,type:"RadioItem",fonticon:{content:"wux-ui-3ds wux-ui-3ds-1x fonticon-pin"},data:null,state:e._holdIssueFlg?"selected":"unselected",action:{callback:n}}))})}}})}),define("DS/IssueCommon/commands/Close",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e)},execute:function(){require(["DS/IssueComponents/close/Close","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(e,t,n){var s=n.get("widget")||window.widget,a=t.getSelection({type:"issue"});s.body.getElement(".isu-close-dialog")||new e({physicalIds:a.physicalIds}).render()})}})}),define("DS/IssueCommon/commands/Reopen",["UWA/Class","DS/ApplicationFrame/Command"],function(e,t){"use strict";return e.extend(t,{init:function(e){this._parent(e)},execute:function(){require(["DS/IssueComponents/reopen/Reopen","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts"],function(e,t,n){var s=n.get("widget"),a=t.getSelection({type:"issue"});s.body.getElement(".isu-reopen-dialog")||new e({physicalIds:a.physicalIds}).render()})}})}),define("DS/IssueCommon/commands/ChangeOwner",["UWA/Core","UWA/Class/Promise","DS/ApplicationFrame/Command"],function(e,t,n){"use strict";var s=200;return n.extend({init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var t=this;require(["DS/ENOCollabSharingCmds/commands/TransferOwnershipCmd/ActionBar_TransferOwnershipCmd","DS/LifecycleServices/LifecycleServicesSettings","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/commands/CommandsManager","DS/IssueCommon/utils/Selector","DS/IssueServices/Contexts","DS/IssueServices/services/PlatformServices"],function(n,a,i,o,r,c,l){var d=c.get("widget")||window.widget,u=o.getCommand("ActionBar_TransferOwnershipCmd_"+d.id);e.is(u,"object")||a.app_initialization(function(){var e=r.getSelection({type:"issue"}),a=[];e.physicalIds.forEach(function(t){var n={getID:function(){return e.map[t].id},getLabel:function(){return e.map[t].title}};a.push(n)});var o={securityContext:{SecurityContext:"ctx::"+decodeURIComponent(l.getSecurityContext())},getSecurityContext:function(){return this.securityContext},getSelectedNodes:function(){return a}};(u=new n({ID:"ActionBar_TransferOwnershipCmd_"+d.id,context:o})).onEnd(function(){t.end();var e=setInterval(function(){u.transferOwnershipPanel&&u.transferOwnershipPanel.addEvent&&(clearInterval(e),u.transferOwnershipPanel.addEvent("onClose",function(){for(var e=[],t={},n=r.getSelection({type:"issue"}),s=n.physicalIds,a=0;a<s.length;a++)e.push([n.map[s[a]].id]),t[n.map[s[a]].id]={id:n.map[s[a]].id,type:n.map[s[a]].type,name:n.map[s[a]].name,title:n.map[s[a]].title,modifiedAttributes:["owner"]};i.publish("DS/Object/update",{metadata:{appId:d.id,appName:d.name,timestamp:Math.floor(Date.now())},data:{paths:e,attributes:t},version:"1.0"})}))},s)})}),e.is(u,"object")&&u.begin()})}})}),define("DS/IssueCommon/utils/Utils",["UWA/Class/Promise","UWA/Controls/Input","UWA/Core","DS/UIKIT/Mask","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/WebappsUtils/WebappsUtils","DS/IssueServices/services/PlatformServices","DS/Notifications/NotificationsManagerUXMessages","DS/Notifications/NotificationsManagerViewOnScreen","DS/TransientWidget/TransientWidget","DS/IssueServices/Contexts","DS/ApplicationFrame/ActionBar","DS/IssueCommon/commands/CommandsManager","DS/IssueTracker/IssueTracker","DS/IssueTracker/IssueDimension","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,s,a,i,o,r,c,l,d,u,m,p,g,h,f){"use strict";var S="Issue",I="Create",E="Assign",C="Active",v="Review",y="Closed",D=["created","modified","estimatedStartDate","estimatedEndDate","actualStartDate","actualEndDate","resolutionDate"],A=10,b="#dashboard:/tab:/app:ENXISSU_AP/content:XSharedContentId=";return{getIconByState:function(e,t,n){var s="";if(u.get("ISU_LISTVIEW"))if(t!=S&&""!=n)s=n.indexOf("http")>=0?n:r.get3DSpaceUrl()+"/"+n;else switch(e){case I:s=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconCreateState.png");break;case E:s=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconAssignState.png");break;case C:s=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconActiveState.png");break;case v:s=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconReviewState.png");break;case y:s=o.getWebappsAssetUrl("IssueCommon","icons/32/states/iconClosedState.png")}else s=n.indexOf("http")>=0?n:n.indexOf("http")<0||n.indexOf("common/images")?n.indexOf("http")>=0?n:r.get3DSpaceUrl()+"/"+n:""==n||n.indexOf("http")<0?(n="common/images/iconSmallIssue.png").indexOf("http")>=0?n:r.get3DSpaceUrl()+"/"+n:n;return s},getColorByState:function(e){var t="";switch(e){case I:t="#9B2C98";break;case E:t="#E03400";break;case C:t="#007DA3";break;case v:t="#018308";break;case y:t="#757575"}return t},getFormattedDate:function(e,t){for(var n=window.widget.lang,s=D,a=0;a<s.length;a++)isNaN(Date.parse(e[s[a]]))?e[s[a]]="":e[s[a]]=new Date(e[s[a]]).toLocaleString(n,t);return e},getTextFromHTML:function(e){var t=n.createElement("div",{html:n.String.escapeHTML(e)});return t.textContent||t.innerText||""},timeSince:function(e){var t=Math.floor((new Date-e)/1e3),n=Math.floor(t/31536e3);return n>1?f.replace(f.dates.years,{number:n}):(n=Math.floor(t/2592e3))>1?f.replace(f.dates.months,{number:n}):(n=Math.floor(t/86400))>1?f.replace(f.dates.days,{number:n}):(n=Math.floor(t/3600))>1?f.replace(f.dates.hours,{number:n}):(n=Math.floor(t/60))>1?f.replace(f.dates.minutes,{number:n}):f.replace(f.dates.seconds,{number:Math.floor(t>=0?t:0)})},getFilesFromDrop:function(e){var t=[];if(e.dataTransfer.items)for(var n=0;n<e.dataTransfer.items.length;n++)"file"===e.dataTransfer.items[n].kind&&t.push(e.dataTransfer.items[n].getAsFile());else for(var s=0;s<e.dataTransfer.files.length;s++)t.push(e.dataTransfer.files[s]);return t},uploadImages:function(n){var s=this;return new e(function(e){var s=new t.File("Input.File",{visibility:"hidden",styles:{display:"none"}});s.elements.container.setStyle("display","none"),s.elements.input.multiple=void 0===n||n,s.elements.input.accept="image/png, image/jpeg",s.elements.input.addEventListener("change",function(t){s.destroy(),s=null,e(t.target.files)},!1),s.elements.input.addEventListener("click",function(e){e.stopPropagation()}),s.elements.input.click()}).then(function(t){if(0===(t=Array.from(t)).length)return e.reject(new Error("No selected files to be uploaded"));var n=[];return t.forEach(function(e){n.push(s.isImage(e))}),e.all(n)}).then(function(t){return 0===(t=t.reduce(function(e,t){return"success"===t.status?e.push(t.file):i.displayNotification({msg:f.replace(f.images.errorUpload,{name:t.file.name}),eventID:"error"}),e},[])).length?e.reject(new Error("No valid files to be uploaded")):e.resolve(t)})},isImage:function(t){var n=new FileReader;return new e(function(e){n.onload=function(n){var s=n.target.result,a=new Uint8Array(s);255===a[0]&&216===a[1]&&255===a[a.byteLength-2]&&217===a[a.byteLength-1]?e({status:"success",file:t}):137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?e({status:"success",file:t}):71===a[0]&&73===a[1]&&70===a[2]&&56===a[3]?e({status:"error",file:t}):(66===a[0]&&a[1],e({status:"error",file:t}))},n.readAsArrayBuffer(t)})},readImageURI:function(t){var n=new FileReader;return new e(function(e){n.onload=function(t){e(t.target.result)},n.readAsDataURL(t)})},getDroppableData:function(e){for(var t={},s=n.is(e.dataTransfer.types.indexOf,"function")?"indexOf":"contains",a="",i=["text/searchitems","text/plain","Text"],o=0;o<i.length&&""===a;o++){var r=e.dataTransfer.types[s](i[o]);(n.is(r,"number")&&r>=0||n.is(r,"boolean")&&!0===r)&&(a=i[o])}var c={};if(""===a)throw new Error("Unknown type in DnD");c=e.dataTransfer.getData(a);try{t=JSON.parse(c)}catch(e){t={data:{items:[]}}}return t},showRevisionModal:function(e){new m({context:{},file:"IssueRevision.xml",module:"IssueCommon"});!1===e.nodeModel.isSelected()&&e.nodeModel.select();r.get3DSpaceUrl(),r.get3DDashboardUrl(),u.get("widget")||window.widget;var t=[];"object"==typeof e.nodeModel.options.icons[0]&&e.nodeModel.options.icons.shift(),t.push(e.nodeModel);var n=function(){return t}().map(function(e){var t=e,n=t.options.id.split(",");return t.options.id=n[n.length-1],t.options.physicalId&&0!=t.options.physicalId.length||(t.options.physicalId=t.options.data.id),t.getID||(t.getID=function(){return physicalID}),t}),s={getSelectedNodes:()=>n};if(e.nodeModel){var a=p.getCommand("HistoryHdr");a.context=s,a&&a.begin()}},_debounceTimeouts:[],debounce:function(e,t,n){var s,a=this;return function(){var i=this,o=arguments,r=n&&!s;clearTimeout(s);var c=a._debounceTimeouts.indexOf(s);-1!==c&&a._debounceTimeouts.splice(c,1),s=setTimeout(function(){s=null,n||e.apply(i,o)},t),a._debounceTimeouts.push(s),r&&e.apply(i,o)}},throttle:function(e,t,n){var s,a,i,o=null,r=0;n||(n={});var c=function(){r=!1===n.leading?0:Date.now(),o=null,i=e.apply(s,a),o||(s=a=null)};return function(){var l=Date.now();r||!1!==n.leading||(r=l);var d=t-(l-r);return s=this,a=arguments,d<=0||d>t?(o&&(clearTimeout(o),o=null),r=l,i=e.apply(s,a),o||(s=a=null)):o||!1===n.trailing||(o=setTimeout(c,d)),i}},isValid3DXContent:function(e){if(n.equals(e,null)||n.equals(e,void 0))return!1;if(!e.hasOwnProperty("protocol")||!n.equals(e.protocol,"3DXContent"))return!1;if(!e.hasOwnProperty("version")||!n.is(e.version,"string"))return!1;if(!e.hasOwnProperty("source")||!n.is(e.source,"string"))return!1;if(e.hasOwnProperty("widgetId")&&!n.is(e.widgetId,"string"))return!1;if(!e.hasOwnProperty("data")||!n.is(e.data,"object"))return!1;if(!e.data.hasOwnProperty("items")||!n.is(e.data.items,"array"))return!1;if(e.data.items.length>0&&!e.data.items.every(function(e){if(!e.hasOwnProperty("envId")||!n.is(e.envId,"string"))return!1;if(!e.hasOwnProperty("objectId")||!n.is(e.objectId,"string"))return!1;if(!e.hasOwnProperty("serviceId")||!n.is(e.serviceId,"string")||"3DSpace"!==e.serviceId)return!1;if(!e.hasOwnProperty("objectType")||!n.is(e.objectType,"string"))return!1;if(e.hasOwnProperty("displayName")&&!n.is(e.displayName,"string"))return!1;if(e.hasOwnProperty("contextId")&&!n.is(e.contextId,"string"))return!1;if(e.hasOwnProperty("displayPreview")&&!n.is(e.displayPreview,"string"))return!1;if(e.hasOwnProperty("displayIcon")&&!n.is(e.displayIcon,"string"))return!1;if(e.hasOwnProperty("path")){if(!n.is(e.path,"array"))return!1;if(!e.path.every(function(e){return!(!e.hasOwnProperty("resourceid")||!n.is(e.resourceid,"string"))&&!(e.hasOwnProperty("type")&&!n.is(e.type,"string"))}))return!1}return!0}))return!1;return!0},computeSharedIssuesURL:function(e){var t=r.get3DDashboardUrl()+b;return t+=encodeURIComponent(JSON.stringify({issues:n.clone(e)}))},copyTextToClipboard:function(e){var t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{document.execCommand("copy")}catch(e){}document.body.removeChild(t)},isJson:function(e){try{JSON.parse(e)}catch(e){return!1}return!0},isInteger:function(e){return Number.isInteger?Number.isInteger(e):"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},Mask:{_timeouts:[],mask:function(e,t){var a=n.merge({},t);if(!0===this._timeouts.every(function(t){return t.element!==e})){var i=setTimeout(function(){s.mask(e,a.message)},a.delay||A);Array.isArray(this._timeouts)||(this._timeouts=[]),this._timeouts.push({element:e,timeout:i})}},unmask:function(e){var t=-1;this._timeouts.some(function(n,s){return n.element===e&&(t=s,!0)}),t>-1&&(clearInterval(this._timeouts[t].timeout),this._timeouts.splice(t,1)),s.isMasked(e)&&s.unmask(e)}},get3DSwymUrl:function(){return r.get3DSwymUrl()},getErrorMessage:function(e){var t={};return t.title=f.error[e].title,t.subtitle=f.error[e].subtitle,t.message=f.error[e].message,t},displayErrorMessage:function(e,t){e.level=t,e.sticky=!1,e.allowUnsafeHTML=!1,void 0===this._notif_manager&&(this._notif_manager=c,l.setNotificationManager(this._notif_manager),l.setStackingPolicy(5)),this._notif_manager.addNotif(e)},viewProperties:function(e){var t=u.get("widget"),n=[];n.push({envId:r.getTenant(),serviceId:"3DSpace",contextId:t.id,objectId:e,objectType:"",displayName:""});var s={protocol:"3DXContent",version:"1.1",source:u.get("widget").name,data:{items:n}};d.showWidget("ENOLCMT_AP","",{X3DContentId:JSON.stringify(s),x3dPlatformId:r.getTenant()},{mode:"panel",height:800,width:700})},removeErrorNotification:function(){l.removeNotifications(null,"error")},cloudProbeUtils:{sendCreateIssueTrackerEvent:function(e){var t,n=(u.get("widget")||window.widget).data.appId,s=g.Availability.FALSE,a=g.Availability.FALSE,i=g.Availability.FALSE,o=g.Availability.FALSE,c=g.Availability.FALSE,l=g.Availability.FALSE,d=g.Availability.FALSE,m=g.Availability.FALSE,p=g.Availability.FALSE,f=g.Availability.FALSE,S="",I="",E=g.Availability.FALSE,C=e.createData;if(null==e.options.escapeToClose||e.options.escapeToClose||(s=g.IssueCreation.TOOLBAR),"CreateFrom3D"==e.options.issueCreationType&&(s=g.IssueCreation.GEOMETRY),"InlineIssue"==e.options.issueCreationType&&(s=g.IssueCreation.INLINE,I=g.IssueCreationStatus.SAVEASDRAFT),"IFB"==e.options.issueCreationType&&e.options.escapeToClose&&(s=g.IssueCreation.NEWISSUE),"IFT"==e.options.issueCreationType&&e.options.escapeToClose&&(s=g.IssueCreation.NEWFROMTEMPLATE),null!=e.options.advancedDuplicate){s=e.options.advancedDuplicate?g.IssueCreation.ADVANCEDUPLICATE:g.IssueCreation.DUPLICATE,I=g.IssueCreationStatus.SAVEASDRAFT;var v=r.getSecurityContexts();v.cspaces.forEach(e=>{e.value.includes(v.securityContext)&&(S=e.roleNls)})}C&&(C.waitingOn&&"Analyst"==C.waitingOn&&(a=g.Availability.TRUE),C.classification&&C.classification.length>0&&(i=g.Availability.TRUE),C.contexts&&C.contexts.length>0&&(o=g.Availability.TRUE),C.reportedAgainst&&C.reportedAgainst.length>0&&(c=g.Availability.TRUE),e.views&&e.views.attachments.view.collection.length>0&&(l=g.Availability.TRUE),C.coOwners&&C.coOwners.length>0&&(d=g.Availability.TRUE),C.assignees&&C.assignees.length>0&&(m=g.Availability.TRUE),C.type&&"Issue"!=C.type&&(p=g.Availability.TRUE),C.contributors&&C.contributors.length>0&&(f=g.Availability.TRUE),C.securityContexts&&r.getSecurityContexts().cspaces.forEach(e=>{e.value.includes(C.securityContexts)&&(S=e.roleNls)}),C.state&&"Create"==C.state?I=g.IssueCreationStatus.SAVEASDRAFT:C.state&&"Assign"==C.state&&(I=g.IssueCreationStatus.START),C.informedUsers&&C.informedUsers.length>0&&(E=g.Availability.TRUE)),t=g.getDeviceUsedForOperation(),g.createEventBuilder({category:g.Category.USAGE,action:g.Events.CLICK,tenant:r.getTenant()}).setLabel(g.Labels.ISSUEMANAGEMENT_CREATE_ISSUE).setAppId(n).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE,s).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_APPROVAL_ACTIVATE,a).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CLASSIFICATION,i).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_CONTEXTS,o).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_AFFECTEDITEMS,c).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_ATTACHMENTS,l).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_COOWNER,d).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_ASSIGNEE,m).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUE_CUSTOM_TYPE_OOTB,p).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_CONTRIBUTORS,f).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATION_ROLE,S).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_STATUS_AT_CREATION,I).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_MEDIA,t).addDimension(h.ISSUEMANAGEMENT_CREATE_ISSUE.ISSUEMANAGEMENT_CREATEISSUE_CONTAINS_INFORMEDUSERS,E).send()}}}}),define("DS/IssueCommon/commands/Templates",["UWA/Class","DS/ApplicationFrame/Command","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts"],function(e,t,n,s){"use strict";return e.extend(t,{init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;!0!==e.utils.isAlreadyRunning()&&require(["DS/IssueComponents/templates/Templates"],function(t){var n=s.get("widget")||window.widget;e.component=new t(n.body,{editMode:!0,onClose:function(){},onEnd:function(){}}),e.component.render(),e.component.isLoaded.finally(function(){e.end()})})},beginExecute:function(){if(!0!==this.utils.isAlreadyRunning()){var e=s.get("widget")||window.widget;n.Mask.mask(e.body)}},endExecute:function(){var e=s.get("widget")||window.widget;n.Mask.unmask(e.body)},utils:{isAlreadyRunning:function(){var e=s.get("widget")||window.widget;return null!==e.body.getElement(".create-template-chooser-dialog")||null!==e.body.getElement(".create-view-dialog")}}})}),define("DS/IssueCommon/commands/Create",["UWA/Core","UWA/Class","UWA/Class/Listener","UWA/Class/Promise","DS/ApplicationFrame/Command","DS/IssueCommon/utils/Utils","DS/IssueCommon/commands/CommandsManager","DS/IssueServices/Contexts","DS/UIKIT/Mask"],function(e,t,n,s,a,i,o,r,c){"use strict";var l="ENXISSU_AP",d="ENX3DIR_AP";return t.extend(a,n,{mode:"",component:null,init:function(e){this._parent(e,{isAsynchronous:!0})},execute:function(){var e=this;if(!0===e.utils.isAlreadyRunning())return e._reset(),void e.end();var t=r.get("widget"),n=r.get("component");new s(function(s){t.name===d&&!0!==n.isDisplayed()?require(["DS/UIKIT/Mask"],function(a){a.mask(t.body),e.listenTo(n,"onDisplay",function(){e.stopListening(n,"onDisplay"),a.unmask(t.body),s()}),o.getCommandCheckHeader("Display").toggleState()}):s()}).then(function(){var t=e.getArguments();t&&t.length>0&&(e.mode=t[t.length-1].Value),void 0!==e.utils[e.mode]?e.utils[e.mode].apply(e):e.utils.IFB.apply(e)})},beginExecute:function(){if(!0!==this.utils.isAlreadyRunning()){var e=r.get("widget")||window.widget;i.Mask.mask(e.body)}},endExecute:function(){var e=r.get("widget")||window.widget;i.Mask.unmask(e.body),this.mode=null},_reset:function(){this.autoFillData=null,this.template=null,this.mode=null},utils:{isAlreadyRunning:function(){var e=r.get("widget")||window.widget;return null!==e.body.getElement(".create-template-chooser-dialog")||null!==e.body.getElement(".create-view-dialog")},IFB:function(){var t=this;require(["DS/IssueComponents/create/Create"],function(n){var a=r.get("widget")||window.widget,i=a.name===d;t.component=new n(a.body,{escapeToClose:!i,issueCreationType:t.mode}),t.component.render(),t.component.isLoaded.then(function(){var n=r.get("widget")||window.widget;if(n.name!==l&&n.name!==d||o.disableAll(),t.listenTo(t.component,"onCreateDialogClose",function(){var e=r.get("widget")||window.widget;t.stopListening(t.component,"onCreateDialogClose"),e.name!==l&&e.name!==d||o.enableAll()}),e.is(t.autoFillData,"object")){var a={id:"template-"+n.id+"-"+Date.now(),info:{description:null,name:null},ui:{},data:e.clone(t.autoFillData),hidden:{}};return t.component.applyTemplate(a)}return s.resolve()}).finally(function(){t._reset(),t.end()})})},_openCreateAndApplyTemplate:function(t){var n=this;require(["DS/PADUtils/views/PADAlert","DS/IssueComponents/create/Create","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(s,a,i){var u=r.get("widget")||window.widget,m=u.name===d;if(null!==t){var p=new a(u.body,{escapeToClose:!m,issueCreationType:n.mode});p.render(),p.isLoaded.then(function(){var s=r.get("widget")||window.widget;s.name!==l&&s.name!==d||o.disableAll(),n.listenTo(p,"onCreateDialogClose",function(){var e=r.get("widget")||window.widget;n.stopListening(n.component,"onCreateDialogClose"),e.name!==l&&e.name!==d||o.enableAll()});var a=e.clone(t);e.is(n.autoFillData,"object")&&(a=e.extend(a,{data:e.clone(n.autoFillData)},!0));return p.applyTemplate(a)}).catch(function(e){p._logger.error(e),c.unmask(p.elements.dialog.getBody()),p.dispatchEvent("onCreateDialogClose"),p.elements.dialog.destroy(),p.destroy(),s.displayNotification({msg:i.replace(i.create.templateApplyError,{name:t.info.name}),eventID:"error"})}).finally(function(){n._reset(),n.end()})}else n._reset(),n.end()})},IFT:function(){var t=this;if(e.is(t.template,"object")){var n=e.clone(t.template);t.utils._openCreateAndApplyTemplate.call(t,n)}else require(["DS/IssueComponents/templates/Templates"],function(e){var n=r.get("widget")||window.widget;t.component=new e(n.body,{editMode:!1,onClose:function(){t._reset(),t.end()},onEnd:t.utils._openCreateAndApplyTemplate.bind(t)}),t.component.render(),t.component.isLoaded.finally(function(){})})}}})}),define("DS/IssueCommon/commands/ChangeAction",["UWA/Class","UWA/Core","DS/ApplicationFrame/Command","DS/Logger/Logger","DS/PADUtils/views/PADAlert","DS/PlatformAPI/PlatformAPI","DS/IssueCommon/utils/Utils","DS/IssueServices/Contexts","DS/IssueServices/services/IssueServices"],function(e,t,n,s,a,i,o,r,c){"use strict";var l={TREE_TYPE_RESOLVED_BY:"resolvedBy"},d="Issue";return e.extend(n,{init:function(e){this._logger=s.getLogger("DS/IssueCommon/components/IssueTreeListView"),this._parent(e)},execute:function(){var e=this,n=r.get("widget");o.Mask.mask(n.body),require(["DS/IssueAttachmentManager/services/AttachmentServices","DS/IssueCommon/utils/Selector","DS/ENOChgActionCMDs/scripts/CAActionBarController","DS/ENOChgActionCMDs/scripts/Commands/AddToNewCA","DS/IssueServices/services/PlatformServices"],function(s,a,i,r,c){var l=a.getSelection({type:"issue"});if(1===l.physicalIds.length){var d=l.physicalIds[l.physicalIds.length-1];s.getDocumentsFrom(d).then(function(e){var t=e.attachments,n=[];return t.forEach(function(e){n.push(e.id)}),n}).then(function(s){var a=decodeURIComponent(c.getSecurityContext());i.setSecurityContext(a);var u=c.getTenant();i.setTenant(u),i.addContext(l.map[d].contexts.map(function(e){return e.physicalId})),i.addProposed(l.map[d].reportedAgainst.map(function(e){return e.physicalId})),i.addReferential(s),i.addAssignee(l.map[d].assignees.filter(e=>"person"===e.type).map(e=>e.user)),i.addFollower([l.map[d].owner.user]),i.addTitle(l.map[d].title),i.addDescription(l.map[d].description),o.Mask.unmask(n.body),r.prototype.execute(function(n){t.is(n,"string")&&(n=JSON.parse(n));var s=n.changeaction.id.replace("pid:","");e.addAsResolvedBy(s,d)},function(){})}).catch(function(e){if(o.Mask.unmask(n.body),e.internalError&&e.internalError.includes("ErrorCode:1500127")){var t=o.getErrorMessage("0");o.displayErrorMessage(t,"error")}})}})},addAsResolvedBy:function(e,t){var n=this,s=r.get("widget");o.Mask.mask(s.body);var u={physicalId:t};u[l.TREE_TYPE_RESOLVED_BY]=[{physicalId:e}],c.related.update({data:{objects:[u]}}).then(function(){var e=[],n={};e.push([t]),n[t]={id:t,type:d,modifiedAttributes:["resolvedBy"]};var s=r.get("widget");i.publish("DS/Object/update",{metadata:{appId:s.id,appName:s.name,timestamp:Math.floor(Date.now())},data:{paths:e,attributes:n},version:"1.0"}),o.Mask.unmask(s.body)},function(e){if(o.Mask.unmask(s.body),n._logger.error(e),e.error.internal.includes("2005")){var t=o.getErrorMessage("2005");o.displayErrorMessage(t,"error")}else a.displayNotification({msg:e.error.message,eventID:"error"})})}})}),define("DS/IssueCommon/commands/Share",["UWA/Class","DS/ApplicationFrame/Command","DS/PADUtils/views/PADAlert","DS/IssueCommon/utils/Selector","DS/IssueCommon/utils/Utils","DS/IssueServices/services/PlatformServices","i18n!DS/IssueCommon/assets/nls/IssueCommon"],function(e,t,n,s,a,i,o){"use strict";var r=100;return e.extend(t,{init:function(e){this._parent(e)},execute:function(){var e=s.getSelection({type:"issue"}).physicalIds,t=s.getSelection({type:"issue"}).issueNames,i=a.computeSharedIssuesURL(e);a.copyTextToClipboard(i),e.length>=r?n.displayNotification({msg:o.replace(o.share.info,{number:r}),eventID:"info"}):1==t.length?n.displayNotification({msg:o.replace(o.share.successSingle,{name:t}),eventID:"success"}):n.displayNotification({msg:o.replace(o.share.successMultiple,{number:e.length}),eventID:"success"})}})});