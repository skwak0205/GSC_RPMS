define("DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices",[],function(){"use strict";var t=function(){var t={};return function(e,n){if(t[e])t[e]&&n(t[e]);else if(function(){var t;try{top.document,t=!0}catch(e){t=!1}return t}())try{top.require([e],function(o){t[e]=o,n(o)})}catch(o){try{require([e],function(o){t[e]=o,n(o)})}catch(t){n(null)}}else try{require([e],function(o){t[e]=o,n(o)})}catch(t){n(null)}}}(),e=function(e){t("DS/i3DXCompass/i3DXCompassServices",e)},n=function(e){t("DS/i3DXCompass/i3DXCompass",e)},o=function(e){t("DS/i3DXCompass/ServiceApi/PortfolioApi",e)};return{getPlatformServices:function(t){e(function(e){e?e.getPlatformServices(t):t.onFailure&&t.onFailure()})},getServiceUrl:function(t){e(function(e){e?e.getServiceUrl(t):t.onFailure&&t.onFailure()})},getGrantedRoles:function(e){t("DS/i3DXCompass/ServiceApi/GrantedRolesApi",function(t){t.getGrantedRoles(e)})},getPortfolioRole:function(t,e){o(function(n){n.getPortolioRole(t,e)})},getPortolioRole:function(t,e){o(function(n){n.getPortolioRole(t,e)})},getPlatformConfig:function(t){e(function(e){e?e.getPlatformConfig(t):t.onFailure&&t.onFailure()})},getUser:function(t){e(function(e){e?e.getUser(t):t.onFailure&&t.onFailure()})},getAppInfo:function(t){n(function(e){e?e.getAppInfo(t):t.onComplete&&t.onComplete()})},getAppsInfo:function(t){n(function(e){e?e.getAppsInfo(t):t.onComplete&&t.onComplete()})},getBusinessMethodApps:function(t){n(function(e){e?e.getBusinessMethodApps(t):t.onComplete&&t.onComplete()})},getBusinessExperiences:function(t){n(function(e){e?e.getBusinessExperiences(t):t.onComplete&&t.onComplete()})},searchApplication:function(t){n(function(e){e?e.searchApplication(t):t.onComplete&&t.onComplete()})},_private:{getParentAPI:t}}}),define("DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient",["UWA/Core","DS/WAFData/WAFData"],function(t,e){"use strict";var n=!1,o={},i={},s=function(t){var e=t.config.url;return e?e+"/api/v1/platform/service/instance":null},r=function(){return"caches"in window&&!n},a=function(t,e){var n=t.data||t.urlParams;return r()?caches.open("3DCompass-service").then(function(e){var o=t.url+JSON.stringify(n);return e.match(o)}).then(function(t){return!(!c(t)&&!e)&&(t&&t.json())}):new Promise(function(t,e){t(null)})},c=function(t){if(!t)return!1;var e=t.headers.get("x-fetched-on");return!!(e&&parseFloat(e)+72e5>(new Date).getTime())},p=function(t,e,n){var o=e.serviceId+e.platformId;i[o].forEach(function(e){e[t]&&setTimeout(e[t],0,n)}),i[o].length=0},u=function(t,n){var i=s(t),c=window.ds&&"MOBILE"===window.ds.env?e.proxifiedRequest:e.request;if(!i)throw new Error("No url found for registryUrl");o[JSON.stringify(n.data)]=!0,c(i,{timeout:15e3,method:"GET",type:"json",headers:{Accept:"application/json","x-requested-with":"registry-client-js-1.0.0"},data:n.data,onComplete:function(t,e){var i,s,a;t&&e&&(i=n,s=t,a=e,r()?caches.open("3DCompass-service").then(function(t){var e=i.url+JSON.stringify(i.data),n=new Headers(a);return n.append("x-fetched-on",(new Date).getTime()),s&&0===s.length?new Promise(function(t,e){t()}):t.put(e,new Response(JSON.stringify(s),{headers:n}))}):new Promise(function(t,e){t()})).then(function(){p("onComplete",n.data,t),o[JSON.stringify(n.data)]=!1})},onFailure:function(){a(n,!0).then(function(t){t?p("onComplete",n.data,t):p("onFailure",n.data),o[JSON.stringify(n.data)]=!1})}})},l=function(t){var e={url:s(t),data:{serviceId:t.serviceId.join(","),platformId:t.platformId.join(",")}},n=t.serviceId.join(",")+t.platformId.join(",");a(e).then(function(s){s?t.onComplete(s):(i[n]||(i[n]=[]),i[n].push({onComplete:t.onComplete,onFailure:t.onFailure}),o[JSON.stringify(e.data)]||u(t,e))})};return{getServicesByPlatform:function(t){return new Promise(function(e,o){r()?caches.open("3DCompass-service").catch(function(){n=!0}).then(function(){l({platformId:t.platforms,serviceId:t.services,config:t.config,onComplete:e,onFailure:o})}):l({platformId:t.platforms,serviceId:t.services,config:t.config,onComplete:e,onFailure:o})})}}}),define("DS/i3DXCompassPlatformServices/OpenWith",["UWA/Core","UWA/Class","UWA/Utils","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompass/Tools","DS/i3DXCompass/Data","DS/i3DXCompass/CacheManager","DS/i3DXCompass/Collection/AppList","i18n!DS/i3DXCompassPlatformServices/assets/nls/openWith","css!DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices.css"],function(t,e,n,o,i,s,r,a,c){"use strict";var p=null,u=[],l=!1,f=function(){var t={};return function(e,n){if(!t[e]&&function(){var t;try{top.document,t=!0}catch(e){t=!1}return t}())try{top.require([e],function(o){t[e]=o,n(o)})}catch(o){try{require([e],function(o){t[e]=o,n(o)})}catch(t){n(null)}}else t[e]&&n(t[e])}}(),m=function(t){f("DS/i3DXCompass/i3DXCompass",t)};return e.extend({DROPDOWN_CONF:null,init:function(){this._UID="open-with"+n.getUUID().substr(0,6),this._content=null,this._type=!1,this.DROPDOWN_CONF={name:this._UID,fonticon:"open-menu-dot",text:c.OpenWith}},set3DXContent:function(t,e){return this._check3DXContentFormat(t),this._content=t,this._type=!!e,this},setIndex:function(t){return this._index=t,this},render:function(t){var e=this;return t&&(this._dropdown=t),this._index&&(this.DROPDOWN_CONF.index=this._index),this._fetchCompatibleApps(function(t){e._appsList=t,e._addSubMenu()}),this},retrieveCompatibleApps:function(t){var e,n=this;this._fetchCompatibleApps(function(o){n.removeParentItemId=!0,n._appsList=o,e=n._buildItems(),t(e)})},_fetchCompatibleApps:function(e){var n=this;m(function(o){"undefined"==typeof COMPASS_CONFIG||!COMPASS_CONFIG.myAppsBaseUrl||p||l?l?u.push(e):e(p||o._private._getAppList()):(l=!0,s.myAppsBaseUrl||(s.initialize(COMPASS_CONFIG),r.setup(COMPASS_CONFIG.userId,COMPASS_CONFIG.lang)),o._private._getMyAppsView()||(t.createElement("div",{class:"hidden",id:"compass-id"}).inject(document.body),o.initialize(t.merge(COMPASS_CONFIG,{compassTarget:"compass-id"}))),(p=new a).fetch({onComplete:function(){l=!1,e(p),n._fireCallbacks(p)},onFailure:function(){l=!1,t.log("AppList: onFailure")}}))})},_buildItems:function(){var e=this,n=[],i=this._getCompatibleApps(),s=i.length>4;return i.length>0&&((i=i.slice(0,4)).forEach(function(t){var o=t.get("icon");t.get("icon")&&t.get("icon").indexOf(".svg")!==t.get("icon").length-4&&(o+=".svg"),n.push({className:"Widget"===t.get("type")?"app-widget":null,name:t.get("id"),text:t.get("title"),icon:t.get("icon")?o:null,fonticon:t.get("icon")?null:"play",handler:function(){e._launchApp(t)}})}),s&&n.push({name:"more-apps",text:c.moreApps,fonticon:"plus",handler:function(){m(function(n){var i;n.showAccordion(!0),e._content&&e._content.data&&e._content.data.items&&e._content.data.items.length>0&&(i=t.clone(e._content.data.items[0]),e._setObjectEvents(i),!0===e._type&&o.publish("setTypes",e._content))})}})),n},_fireCallbacks:function(t){u.forEach(function(e){e&&setTimeout(e,0,t)}),u.length=0},_addSubMenu:function(){var e=this,n=this._getCompatibleApps();this._dropdown.removeItem(this._dropdown.getItem(e._UID).id),n.length>0&&(this._dropdown.addItem(t.merge(this.DROPDOWN_CONF,{items:[]})),this._buildItems().forEach(function(t,n){t.parentItemId=e._dropdown.getItem(e._UID).id,e._dropdown.addItem(t)}))},_launchApp:function(e){var n,o=t.clone(this._content.data.items[0]);t.log("_launchApp:"+e.id),t.log("_launchApp:"+this._content),this._content&&(t.is(o.objectType,"array")&&(n=o.objectType.detect(function(t){return e.get("compatibility").indexOf(t)>-1}),o.objectType=n),this._setObjectEvents(o)),this._launchAppEvent(e.id)},_setObjectEvents:function(e){o.publish("setObject",e),o.publish("setX3DContent",t.clone(this._content))},_launchAppEvent:function(e){var n=this,i=n._appsList.get(e);!0===n._type&&i&&i.isNative()?(o.publish("setTypes",n._content),o.publish("setTypesCallback",t.merge({appId:e},n._content)),n._type=!1):o.publish("launchApp",{appId:e,origin:"openWith"},function(e){var o=n._appsList.get(e.appId);t.log(e),e.error&&o&&m(function(t){t._private._setQuadrant(o.get("quadrant")),t.showAccordion(!0),f("DS/i3DXCompass/EventManager",function(t){t.dispatchEvent("onShowMessage",c.no_install_compatible),t.dispatchEvent("onHideMessage",5e3)})})})},_getCompatibleMap:function(){var t=this,e=[];return this._appsList.forEach(function(n){n.get("compatibility")&&n.get("compatibility").forEach(function(o){var i=t._removeFirstDot(o.toLowerCase());e[i]||(e[i]=[]),e[i].push(n)})}),e},_check3DXContentFormat:function(t){if(!(t.data||t.data.items||t.data||t.data.items[0]||t.data.items[0].objectType))throw new Error("Not good format for 3DXContent")},_getContentType:function(){var e,n=this,o=[];if(!this._content)throw new Error("A 3DXContent need to be set");return this._check3DXContentFormat(this._content),e=this._content.data.items[0].objectType,t.is(this._content.data.items[0].objectTaxonomies,"array")?this._content.data.items[0].objectTaxonomies.forEach(function(t){o.push(n._removeFirstDot(t.toLowerCase()))}):"string"==typeof e?o.push(this._removeFirstDot(e.toLowerCase())):t.is(this._content.data.items[0].objectType,"array")&&(t.log("Usage of objectType as array is deprecated!, use objectTaxonomies instead"),e.forEach(function(t){o.push(n._removeFirstDot(t.toLowerCase()))})),o},_isAvailableAppOnPlatform:function(t){var e=this._content.data.items[0].envId;return!(e&&t.get("platforms")&&t.get("platforms").length>0)||t.get("platforms").detect(function(t){return t.id&&t.id.toLowerCase()===e.toLowerCase()})},_getCompatibleApps:function(){var t=this._getCompatibleMap(),e=this,n=[];return this._getContentType().forEach(function(o){t[o]&&t[o].forEach(function(t){e._isAvailableAppOnPlatform(t)&&i.pushUnique(n,t)})}),n.sort(function(t,e){var n=(!0===t.get("isFavorite")?"#":"")+t.get("lowerCaseTitle"),o=(!0===e.get("isFavorite")?"#":"")+e.get("lowerCaseTitle"),i=0;return n<o?i=-1:n>o&&(i=1),i}),n},_removeFirstDot:function(t){return t.length&&"."===t[0]?t.slice(1):t}})});