define("DS/FolderActive/commands/FolderCommands",["i18n!DS/FolderActive/assets/nls/FolderActive","DS/WidgetServices/WidgetServices","DS/WebappsUtils/WebappsUtils"],function(e,t,o){"use strict";return{ExpandAllCmd:function(e,t){e.plmType;var o=[];"TREE"===t&&e&&o.push(e),o.length&&o.forEach(function(e){null===e.options.children||("TREE"===t||"Folder"===e.plmType||"FolderSection_AllFolders"===e.plmType?e.expand({expandLevel:"All"}):e.expandAll())})},CollapseAllCmd:function(e,t){e.plmType;var o=[];"TREE"===t&&e&&o.push(e),o.length&&o.forEach(function(e){e.collapseAll(),e.removeChildren()})},_addCtxCmd:function(e,o,i,r){var n=!1;"separator"===i.type?n=!0:!1!==i.spaceAvailability&&(n=!0),n&&(t.isWebInWinEnvironment()&&!1===i.webInWinAvailability&&(n=!1),t.isWebInWinEnvironment()||!1!==i.dashboardAvailability||(n=!1)),n&&(r&&("separator"!==r.type||o.length>0)&&o.push(r),o.push(i))},GetContextualMenuForActiveBookmark:function(t,i){var r,n=this,a=[],s=!!t.white_Click&&t.white_Click;if(void 0===(r=!0===s?r=Folder_CSO.getCurrentFolder():t.nodeModel)&&(r=t),r.isFavorite)return a;var l={label:e.CMDExpandAll,icon:"url("+o.getWebappsAssetUrl("IPClassifyNav","icons/32/I_ExpandAll.png")+")",callback:function(){n.ExpandAllCmd(r,i)},searchAvailability:!0},c={label:e.CMDCollapseAll,icon:"url("+o.getWebappsAssetUrl("IPClassifyNav","icons/32/I_CollapseAll.png")+")",callback:function(){n.CollapseAllCmd(r,i)},searchAvailability:!0};return this._addCtxCmd(i,a,l,{type:"separator"}),this._addCtxCmd(i,a,c),a}}}),define("DS/FolderActive/service/FolderActiveWebServices",["DS/IPClassifyActive/service/IPClassifyActiveWebService","text!DS/FolderActive/assets/FolderActive_setting.json","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices"],function(e,t,o,i,r){"use strict";var n=Object.assign({},e);return n.getSearchQuery=function(){return'type: "Workspace"'},n.getType_filter_bo=function(){return["Workspace","Workspace Vault"]},n.generateSearchQuery=function(e,t){return'(type: "Workspace" OR type: "Workspace Vault") AND (label: *'+e+"*)"+(t?' AND NOT physicalid: "'+t+'"':"")},n.getLabel=function(e){return"ActiveBookmark-"+(window.top.dsUserLogin?window.top.dsUserLogin:"unknown")+"-"+(new Date).getTime()},n.getSpecific_source_parameter=function(e,t){return{"3dspace":{search_in_context:{expand:{root_physicalid:e,expand_iter:t?"-1":"1",type_filter_bo:["Workspace Vault","Workspace"]}}}}},n.generateLabelQuery=function(e){return'(type: "Workspace" OR type: "Workspace Vault") AND (physicalid:'+e+")"},n.getSetting=function(){return JSON.parse(t)},n.getFolderProperties=function(e){var t=e;this.get3DSpaceUrl().then(e=>{var o=e+"/resources/v1/FolderManagement/Folder/"+t.pid+"/properties";t.method="GET",this._executeRequest(o,t,"getFolderProperties")})},n.roots=function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for FolderActiveWebService.roots");var o=this;o.get3DSpaceUrl().then(function(e){var i=e+"/resources/v1/FolderManagement/Folder/roots";return t.query={Type:t.type,CollabSpace:t.collabSpace},t.method="GET",o._executeRequest(i,t,"roots")})},n.setUserPreferences=function(e){var t=this,o=e;if(!UWA.is(o,"object"))throw new Error("Invalid inputs for FolderEditorWebService.saveUserPreferences");this._lastPrefToSave||(this._lastPrefToSave={}),this._lastPrefToSave[e.name]=e,this._lastRequests||(this._lastRequests={}),this._lastRequests[e.name]&&this._lastRequests[e.name].cancel(),this._lastRequests[e.name]=null,r.getCompassUrlAsync({onComplete:function(i){var r=t._lastPrefToSave[e.name];if(r){var n=i+"/resources/AppsMngt/user/preference";o.method="PUT",o.headers={Accept:"application/json",SecurityContext:void 0,"Content-Type":"application/x-www-form-urlencoded"},o.data={name:r.name,value:r.value},o.withoutTenant=!0,t._lastRequests[e.name]&&t._lastRequests[e.name].cancel(),t._lastRequests[e.name]=t._executeRequest(n,o,"saveUserPreferences"),delete t._lastPrefToSave[e.name]}}})},n.fetchObjectsForFindInTree=function(e){var t=[];if(t.push(new Promise(function(e,t){r.get3DSearchUrlAsync({onComplete:function(t){e(t)},onFailure:function(e){t(e)}})})),this.getSecurityContext()||t.push(this.initSecurityContext()),!UWA.is(e,"object"))throw new Error("Invalid inputs for FolderActiveWebService.fetchObjectsForFindInTree");var n=this,a={};UWA.extend(a,e),Promise.allSettled(t).then(function(t){var r=t[0].value+"/search",s=widget.lang?widget.lang:widget.getValue("lang");a.payload={},a.payload.locale=s,e.searchFTSquery&&(a.payload.query="[ds6w:label]: *"+e.searchFTSquery+"*"),e.rscIdToSearch&&(a.payload.query="physicalid:"+e.rscIdToSearch),a.payload.select_bo=["physicalid","ds6w:type","ds6w:globalType","ds6w:label"],"FolderSection_AllFolders"===e.type?a.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_path_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults"]}}}}:a.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,type_filter_rel:["Data Vaults","Sub Vaults"]}}}},a.payload.nresults=100,a.payload.source=["3dspace"],a.payload.login={"3dspace":{SecurityContext:n._securityContext}};var l=new Date,c=window.top.dsUserLogin?window.top.dsUserLogin:"unknown";return a.payload.label=("FolderActiveFetchObjectsForFindInTree_"+c+"_"+l.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),a.timeout=12e4,a.method="POST",a.payload.tenant=i.getPlatformId()||o.getSetting("x3dPlatformId"),a.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s,SecurityContext:o.getSetting("pad_security_ctx")},a.type="json",a.data=UWA.Json.encode(a.payload),n._executeRequest(r,a,"_fetchObjectsForFindInTree")})},n.create=function(e){var t=this,o=e;this.get3DSpaceUrl().then(e=>{var i=e;t.createCSRFTokens({onComplete:function(i){var r=JSON.parse(i).csrf.value,n=e+"/resources/v1/modeler/dsbks/dsbks:Bookmark?$mask=dsbks:BksMask.Details";o.data={},o.headers={Accept:"application/json","content-type":"application/json","Accept-Language":"en-US",SecurityContext:o.ctx,ENO_CSRF_TOKEN:r};var a={items:[{attributes:{title:o.title,description:o.title}}]};"FolderSection_AllFolders"!==o.nodeId&&(a.parentId=o.nodeId),o.data=JSON.stringify(a),o.method="POST",t._executeRequest(n,o,"FolderActive-createCSRFToken")},onFailure:function(e){}},i)})},n.createCSRFTokens=function(e,t){var o=e,i=t+"/resources/v1/application/CSRF";o.method="GET",this._executeRequest(i,o,"FolderActive-createCSRFToken")},n}),define("DS/FolderActive/service/FolderTypeService",["UWA/Controls/Abstract"],function(e){return e.singleton({TYPE_ROOT_FOLDER_1:"Workspace",TYPE_ROOT_FOLDER_2:"RootFolder",TYPE_FOLDER_1:"Workspace Vault",TYPE_FOLDER_2:"Folder",TYPE_FOLDER_3:"Workspace Folder",TYPE_PERSONAL_FOLDER_1:"Personal Workspace",TYPE_FOLDERS_SECTION:"FolderSection_AllFolders",TYPE_FAVORITES_SECTION:"FolderSection_favorite",init:function(){},isRootFolder:function(e){return e===this.TYPE_ROOT_FOLDER_1||e===this.TYPE_ROOT_FOLDER_2},isFolder:function(e){return e===this.TYPE_FOLDER_1||e===this.TYPE_FOLDER_2||e===this.TYPE_FOLDER_3},isPersonalFolder:function(e){return e===this.TYPE_PERSONAL_FOLDER_1},inFamilyFolder:function(e){return this.isRootFolder(e)||this.isFolder(e)||this.isPersonalFolder(e)},isSection:function(e){return e===this.TYPE_FOLDERS_SECTION||e===this.TYPE_FAVORITES_SECTION}})}),define("DS/FolderActive/utils/PreferencesUtils",["DS/PlatformAPI/PlatformAPI","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/FolderActive/service/FolderActiveWebServices"],function(e,t,o){var i=null;function r(e){var t=null;try{t=JSON.parse(e)}catch(e){}return t}function n(e){var o=function(e,o){var i=widget.getValue(e);i&&(i=r(i=t.jsonUnzip(i)));return i||o}(e);return o&&o.id?o:null}function a(e,o){var i=JSON.stringify(o);i=t.jsonZip(i),widget.setValue(e,i)}return e.subscribe("FolderEditor.Bookmark",function(e){e.origin===widget.id&&(i=e.current)}),e.publish("FolderEditor.RequestCurrentFolder"),{getWidgetPreference:function(){return n("activeBookmark_"+widget.id)},getPausePreference:function(){return n("activeBookmark_pause_"+widget.id)},getCurrentWidgetBookmark:function(){return new Promise(e=>{setTimeout(()=>{e(i)})})},setWidgetPreference:function(e){a("activeBookmark_"+widget.id,e)},setPausePreference:function(e){a("activeBookmark_pause_"+widget.id,e)},parseJsonExt:r,getUserPreferences:function(){return new Promise(function(e,t){o.getUserPreferences({name:"ActiveFolder_FolderID",onComplete:e,onFailure:t})})}}}),define("DS/FolderActive/BookmarkInput",["DS/IPClassifyActive/InputFieldAbstract","DS/FolderActive/utils/PreferencesUtils","DS/FolderActive/service/FolderActiveWebServices","i18n!DS/FolderActive/assets/nls/FolderActive"],function(e,t,o,i){function r(){return new Promise(function(e,o){var i=t.getCurrentWidgetBookmark(),r=t.getWidgetPreference();i.then(i=>{i&&i.FolderID&&(r={id:i.FolderID,label:i.FolderLabel}),r?e(r):t.getUserPreferences().then(t=>{e(t.startsWith("!")?null:{id:t})}).catch(o)})})}return e.extend({init:function(e){(e=e||{}).panelRequire="DS/FolderActive/FolderActive",this._parent(e),e.value?this._firstPromise=Promise.resolve(e.value):this._firstPromise=r(),this._firstPromise.then(e=>{if(e&&e.id){var i=e.id;this._setValue([{id:i,label:e.label?e.label:"..."}]),e.label||o.getFolderProperties({pid:i,onComplete:e=>{var o=t.parseJsonExt(e),r="unknown";o&&(r=o.label),this._setValue([{id:i,label:r}])},onFailure:()=>{this._setValue([]),console.log("can't retrieve the current bookmark")}})}}),this._firstPromise.catch(e=>{console.log("Issue retrieving bookmark preferences"),console.log(e)})},getOriginalValue:function(){return this._firstPromise},getActiveBookmark:r,getLabel:function(){return i.InputLabel}})}),define("DS/FolderActive/FolderActive",["DS/IPClassifyActive/IPClassifyActive","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/FolderActive/service/FolderActiveWebServices","i18n!DS/FolderActive/assets/nls/FolderActive","DS/WebappsUtils/WebappsUtils","DS/FolderActive/commands/FolderCommands","DS/FolderActive/service/FolderTypeService","DS/FolderActive/utils/PersonalFolderManager","DS/PADUtils/PADUtilsServices","DS/WidgetServices/WidgetServices","UWA/Utils","text!DS/FolderActive/assets/FolderActive_setting.json"],function(e,t,o,i,r,n,a,s,l,c,d,u){"use strict";r.getWebappsAssetUrl("FolderEditor","icons/I_Bookmark_v2.png");var p={iconName:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-bookmark-flash "},v=r.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png"),f={iconName:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-bookmark "};return e.extend({name:"FolderActive",_rootNodeFavorite:null,_rootNodeFolders:null,_rootNodeTrash:null,_requestInfo:{},_searchKeys:{},_pathInfo:{},_subBookmarkExpand:{},_favoriteSection:"FolderSection_favorite",_allSection:"FolderSection_AllFolders",_findInTreeNLS:i,init:function(e){if(e.dataProvider={},e.dataProvider.widgetEventsProvider={set:"FolderActive.onSet",cancel:"FolderActive.onCancel",selection:"FolderEditor.Public.Bookmark",classify:"FolderActive.SelectIds",selectionChange:"FolderActive.selectionChange"},e.multiSelectionComponent&&!e.multiSelectionComponent.NLS&&(e.multiSelectionComponent.NLS=i.multiSelectionComponent),e.dataProvider.widgetDataProvider={isValidType:function(e){return a.inFamilyFolder(e)},getObjectForPublication:function(e){return e&&a.inFamilyFolder(e.getType())?{FolderID:e.getID(),FolderLabel:e.getLabel()}:null},getBadge:function(e){var t=null;"TRUE"===e.publishOnConnect&&(t={bottomRight:r.getWebappsAssetUrl("FolderEditor","icons/folderPublishBadge.png")});widget.getValue("CandABookmark")&&"SHARED"===e.folderClassification&&(t={topRight:r.getWebappsAssetUrl("FolderEditor","icons/approvals.png")});return t},onFavoriteSectionRefresh:function(){s.resetToPreInitializedState()},getWidgetName:function(){return e.widgetName?e.widgetName:i.bookmark_defaultTitle},getWidgetIcon:function(){return"bookmark"},getSettings:function(){return JSON.parse(u)}},this._parent(e),c.isReplayedODT()&&!1!==window.isPopOverRequired){var t=this.nestedMenuInContext.popover.getContent().id;window[t]=this}},_getWebServiceRef:function(){return o},onSetActive:function(e){e&&"function"==typeof e&&(this.onSetActive=e)},_getPlmType:function(e){return-1===["Workspace","Workspace Vault","Bookmark","Bookmark Root"].indexOf(e)&&e?"Content":"Folder"},_getRootIcon:function(){return r.getWebappsAssetUrl("FolderEditor","icons/foldersectionall.png")},_getFavoritesIcon:function(){return r.getWebappsAssetUrl("FolderEditor","icons/starBlue_v2.png")},_getRootName:function(){return i.name_Section_AllFolders},_getFavoritesName:function(){return i.name_Section_FavoriteFolders},_getActiveIcon:function(e){return e?"wux-ui-3ds wux-ui-3ds-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-bookmark":"bookmark"},_getFocusBtnTooltip:function(){return i.activeBookmark_btn_focus},_showMessageWhileEmpty:function(e){return e?i.activeBookmark_msg_empty:i.activeBookmark_msg_noBookmark},_getIcon:function(e,t){var o="subFolders"!==t&&!1,i=f;return e&&e.type&&a.isPersonalFolder(e.type)?o||!i?v:i:"favorites"===t?e.inherit?p:i:o||e.iconType&&"SHARED"===e.iconType.toUpperCase()?p:i},_getRootVisbility:function(e){return e[0].outputs&&e[0].outputs.GET_PARENT?"Workspace"===e[0].outputs.GET_PARENT[0]["ds6w:type"]:"Workspace"===e[0].input_object["ds6w:type"]},couldBeExpand:function(e){return"Folder"===e.plmType||"RootFolder"===e.plmType},couldBeValid:function(e){var t=e&&e.getID&&e.getID();return t&&t!==this._favoriteSection&&t!==this._allSection},getFavoriteKey:function(){return"FolderEditorFavoriteFolderList"},getCreationCommandName:function(){return"NewFolder"},executeServiceToCreate:function(e,t,i){o.create({nodeId:e.nodeId,ctx:e.ctx,title:e.title,onComplete:function(e){var o=JSON.parse(e).member[0];t(o)},onFailure:function(e){i(e)}})},getAppSpecificFavJson:function(){return{protocol:"3DXContent",version:"1.0",source:"ENOFOL3_AP",data:{favorite_folders:[]}}},_getContextualMenu:function(e,t){return n.GetContextualMenuForActiveBookmark(e,t)}})}),define("DS/FolderActive/commands/ActionBar_ActiveBookmarkCmd",["DS/ApplicationFrame/CommandCheckHeader","i18n!DS/FolderActive/assets/nls/FolderActive","DS/IPClassifyActive/utils/IPClassifyActiveCommunication","DS/IPClassifyActive/utils/IPClassifyActiveUtil","DS/FolderActive/FolderActive","DS/FolderActive/utils/PreferencesUtils","DS/FolderActive/service/FolderActiveWebServices"],function(e,t,o,i,r,n,a){"use strict";return e.extend({labelTopBar:t.activeBookmark_cmd,isInsert:!0,datas:{},_activeBookmarkId:"",_activeBookmark:{},init:function(e){var i=this;this._parent(e,{mode:"exclusive",isAsynchronous:!1});var s=n.getWidgetPreference(),l=n.getPausePreference();function c(){i.onStateChange(function(){i.popover?!1!==this._userClick&&i.popover.togglePopover():(i.popover=new r({container:widget.body,widgetName:t.activeBookmark_cmd}),s&&s.id?i.popover.nestedMenuInContext.setActiveNode(s.id,s.label):l&&l.id&&i.popover.nestedMenuInContext.setActiveNode_pause(l.id,l.label),i.popover.showPopover(),i._checkAndUpdateState(),i.popover.addEvent("updateActiveInfo",function(e){var t={id:e.getID?e.getID():"",label:e.getLabel?e.getLabel():""};i.updateActiveBookmark(t)}),i.popover.addEvent("onSetActive",function(e){i._activeBookmarkId=e.getID?e.getID():"",i.setState(e,!1);var t=e.getID?e.getID():"",o=e.getLabel?e.getLabel():"";i.dispatchEvent(t,o);var r={id:t,label:o};n.setWidgetPreference(r),n.setPausePreference(e.isPause?e.isPause:{id:"",label:""})})),i._checkAndUpdateState(),i._userClick=null})}s&&s.id?(this._activeBookmarkId=s.id,new Promise(function(e,t){a.searchInActiveBookmark({bookmarkID:s.id,onComplete:function(o){var i=o.results||[],r={"ds6w:label":"label"};if(i.length>0){for(var n=0;n<i.length;n++)for(var a=i[n].attributes,l=0;l<a.length;l++){if(r[a[l].name]){s.label=a[l].value;break}}e()}else t("No Bookmark found with specific ID, the bookmark is deleted or is not available")},onFailure:function(e,o,i){console.log(e),t(e)}})}).then(function(){i.dispatchEvent(s.id,s.label),i.setState(!0,!1),c()}).catch(function(e){console.log(e),s=void 0,i.setState(!1,!1),c()})):c(),o.subscribe("FolderEditor.ActiveFolderCallBack",function(e){null!==e||i.dispatchEvent(i._activeBookmark.id,i._activeBookmark.label)})},updateActiveBookmark:function(e){var t=e.id,o=n.getWidgetPreference();o&&o.id===t&&n.setWidgetPreference(e)},dispatchEvent:function(e,t){this._activeBookmark={origin:widget.id,id:e,label:t,sc:widget.getPreference("pad_security_ctx")&&widget.getPreference("pad_security_ctx").value},o.publish("FolderEditor.ActiveFolder",this._activeBookmark)},_checkAndUpdateState:function(){var e=this;this._activeBookmarkId&&!0!==this.getState()?setTimeout(function(){e._userClick=!1,e.setState(!0,!1)},0):this._activeBookmarkId||!1===this.getState()||setTimeout(function(){e._userClick=!1,e.setState(!1,!1)},0)}})}),define("DS/FolderActive/utils/PersonalFolderManager",["DS/FolderActive/FolderActive","DS/WebappsUtils/WebappsUtils","DS/FolderActive/service/FolderTypeService"],function(e,t,o){"use strict";var i=void 0,r=!1;function n(e){void 0!==e&&(i=e)}return{getPersonalFolder:function(){return i},isInitialized:function(){return!0===r},resetToPreInitializedState:function(){i=void 0,r=!1},getPersonalRootFolderInFavoriteFormat:function(){return(e=i)?{id:e.id,name:e.name,type:e.type,isPersonal:e.isPersonal}:void 0;var e},isPersonalFolderToBeKept:function(e){var t=!1;return e&&(o.isPersonalFolder(e.type)||o.isRootFolder(e.type)&&e.isPersonal)&&(t=!0),t},setupPersonalFolder:function(){return new UWA.Class.Promise(function(i,a){!0===r?a():e.FolderActiveWebService.roots({type:"Personal",collabSpace:"All",onComplete:function(e){var a=(e=JSON.parse(e)).folders;n(null);for(var s=a?a.length:0,l=0;l<s;l++){var c=a[l];if(o.isPersonalFolder(c.type)){var d={useAsyncPreExpand:!0},u=t.getWebappsAssetUrl("FolderEditor","icons/folder_perso.png");d.label=c.label,d.icons=[u],d.children=[],d.id=c.id,d.plmType="RootFolder",d.type=c.type,d.name=d.label,d.isPersonal=!0,n(d),r=!0;break}}i()},onFailure:function(e){n(null),r=!0,a(e)}})})}}});