define("DS/MPFSubscriptionsComponent/roleList/RoleCardBody",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFProductModel/ProductModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c)=>{"use strict";const l=Object.freeze({MANAGE:"manage"}),h=e.extend({className:"mpf-role-card-body",setup(t={}){this._parent(t),r.requiredOfPrototype(t.product,a,"options.product must be a ProductModel"),this.product=t.product,this.portfolioRoleInfo=t.portfolioRoleInfo||{},this.title=this._createTitleContainer(),this.description=this._createDescriptionContainer(),this.manageButton=this.product.isRenewable()&&this._createManageButton()},render(){const e=t.createElement("div",{class:"mpf-role-info-container",html:[this.title,this.description]}),s=t.createElement("div",{class:"mpf-role-management-container",html:[this._createManageButton()]});return this.container.setContent([e,s]),this},_onManageButtonClicked(){this.dispatchEvent(l.MANAGE)},_createMarketingModal(){return o.getInstance().get(["DS/MPFSubscriptionsComponent/roleList/MarketingModal"]).then(([t])=>new t({product:this.product}))},_createTitleContainer(){const e=t.createElement("span",{class:"fonticon fonticon-info",events:{click:()=>(i.mask(this.container),this._createMarketingModal().then(t=>{i.unmask(this.container),this.container.addContent(t),t.render().show()}))}});return t.createElement("div",{class:"mpf-role-title",html:[e,this.product.getDisplayName()]})},_createDescriptionContainer(){let e="";this.product.isMarketplaceOffer()?e=this.product.getDescription():this.portfolioRoleInfo.tagLine&&(e=this.portfolioRoleInfo.tagLine);const i=t.createElement("div",{class:"mpf-role-description-content",html:e}),n=t.createElement("div",{class:"mpf-role-description",html:i});try{new s({element:i}).inject(n)}catch(t){console.warn(t)}return n},_createManageButton(){return new n({value:c.get("manage")+`(${this.product.getTotalQuantity()})`,icon:"fonticon-cog",events:{onClick:this._onManageButtonClicked.bind(this)}})}});return h.Events=l,h}),define("DS/MPFSubscriptionsComponent/closa/ClosaComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemCollection","DS/MPFPersonModel/PersonModel","DS/MPFTCContractModel/TCContractFactory","DS/MPFTCContractModel/SoftwareAgreementModel","DS/MPFModalConfiguratorComponent/OrderAgreementsSection","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],function(t,e,s,i,n,r,o,a,c,l,h,d,p,u){"use strict";var m={CLOSA_SAVED:"closaSaved"},S=t.extend({setup:function(t){t||(t={}),this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.cartItems=t.cartItems,this.me=t.me,this.tcContractFactory=t.tcContractFactory,this.softwareAgreement=t.softwareAgreement,this.closaComponent=this._createClosaComponent(),this.closeButton=this._createCloseButton(),this.saveButton=this._createSaveButton(),this.modal=this._createModal(),this._initListeners()},render:function(){return this.closaComponent.render(),this},show:function(){this.modal.inject(document.body),this.modal.show()},_saveClosa:function(){var t=this;return n.mask(this.modal.getBody()),this.closaComponent.save().then(function(){t.dispatchEvent(m.CLOSA_SAVED),t.modal.hide(),t.modal.destroy()}).catch(function(){new r({className:"error",messageClassName:"error",closable:!0,visible:!0,messages:u.get("errorOccured")}).inject(t.modal.getBody(),"top")}).finally(n.unmask.bind(n,this.modal.getBody()))},_createModal:function(){var t;return t=new s({className:"mpf-subscriptions-closa-modal",header:e.createElement("h4",{text:u.get("closa")}),body:this.closaComponent,footer:[this.closeButton,this.saveButton]}),n.mask(t.getBody()),t},_createSaveButton:function(){return new i({className:"primary",value:u.get("save"),disabled:!0,events:{onClick:this._saveClosa.bind(this)}})},_createCloseButton:function(){var t=this;return new i({value:u.get("close"),events:{onClick:function(){t.modal.hide()}}})},_createClosaComponent:function(){return new p({cart:this.cart,cartItems:this.cartItems,buyer:this.me,tcContractFactory:this.tcContractFactory,softwareAgreement:this.softwareAgreement})},_initListeners:function(){this.listenTo(this.closaComponent,p.Events.ON_RENDER,n.unmask.bind(n,this.modal.getBody())),this.listenTo(this.closaComponent,p.Events.VALID_SECTION,this.saveButton.enable.bind(this.saveButton)),this.listenTo(this.closaComponent,p.Events.INVALID_SECTION,this.saveButton.disable.bind(this.saveButton))},_checkPrototypes:function(t){o.requiredOfPrototype(t.cart,a,"options.cart must be a CartModel"),o.requiredOfPrototype(t.cartItems,c,"options.cartItems must be a CartItemCollection"),o.requiredOfPrototype(t.me,l,"options.me must be a PersonModel"),o.requiredOfPrototype(t.tcContractFactory,h,"options.tcContractFactory must be a TcContractFactory"),o.requiredOfPrototype(t.softwareAgreement,d,"options.softwareAgreement must be a SoftwareAgreementModel")},destroy:function(){this.cart=null,this.cartItems=null,this.me=null,this.tcContractFactory=null,this.softwareAgreement=null,this._parent(),this.container=null}});return S.Events=Object.freeze(m),S}),define("DS/MPFSubscriptionsComponent/offerList/OfferFilters",["UWA/Core","UWA/String","UWA/Class/View","DS/UIKIT/Input/Select","DS/MPFPortfolioModel/PortfolioModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],function(t,e,s,i,n,r){"use strict";var o={},a={};o.NEW_FILTER_VALUE="newFilterValue",a.PERIODICITY="periodicity";var c=s.extend({className:"mpf-subs-filters",setup:function(t){t||(t={}),this._parent(t),this.periodicityFilterLabel=this._createPeriodicityFilterLabel(),this.periodicityFilterSelect=this._createPeriodicityFilterSelect()},render:function(){var e;return e=t.createElement("div",{class:"mpf-filter-block",html:[this.periodicityFilterLabel,this.periodicityFilterSelect]}),this.container.setContent(e),this},_onNewFilterValue:function(t){this[t.filterType]=t.value,this.dispatchEvent(o.NEW_FILTER_VALUE,t)},setPeriodicityFilterValue:function(t){this.periodicityFilterSelect.select(t,!0,!0)},getPeriodicityValue:function(){return this.periodicityFilterSelect.getValue()[0]},disablePeriodicityFilter:function(){this.periodicityFilterSelect.setDisabled()},enablePeriodicityFilter:function(){this.periodicityFilterSelect.setDisabled(!1)},_createPeriodicityFilterLabel:function(){return t.createElement("div",{class:"mpf-filter-label",text:r.get("subscription")+":"})},_createPeriodicityFilterOptions:function(){return Object.values(n.RevTypes).filter(t=>t!==n.RevTypes.QRC).map(t=>({label:e.ucfirst(r.get(t)),value:t}))},_createPeriodicityFilterSelect:function(){var t=this,e=this._createPeriodicityFilterOptions();return new i({placeholder:!1,value:e[1],options:e,events:{onChange:function(){t._onNewFilterValue({filterType:a.PERIODICITY,value:this.getValue()[0]})}}})}});return c.Events=Object.freeze(o),c.FilterTypes=Object.freeze(a),c}),define("DS/MPFSubscriptionsComponent/quoteList/ProductListTile",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/LicensingSchemeMapping","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d)=>{"use strict";const p=Object.freeze({SHOW_MORE_ACTIVATED:"showMoreActivated",SHOW_MORE_DESACTIVATED:"showMoreDesactivated"});return e.extend({className:"mpf-product-details table-responsive",setup(t={}){this._parent(t),this._checkPrototypes(t),this.locale=t.locale||"fr-FR",this.cart=t.cart,this.stateMachine=this._createStateMachine(),this.showMoreButton=this._createShowMoreButton()},render(){const t=[];return t.push(this._createTable()),this.cart.getItems().length>5&&t.push(this.showMoreButton),this.container.setContent(t),this},_onClickButton(){this.stateMachine.getState()===p.SHOW_MORE_DESACTIVATED?(this.stateMachine.changeState(p.SHOW_MORE_ACTIVATED),this.showMoreButton.setValue(d.get("showLess"))):this.stateMachine.getState()===p.SHOW_MORE_ACTIVATED&&(this.stateMachine.changeState(p.SHOW_MORE_DESACTIVATED),this.showMoreButton.setValue(d.get("showMore"))),this.render()},_createShowMoreButton(){return new s({value:d.get("showMore"),className:"link",events:{onClick:this._onClickButton.bind(this)}})},_createTable(){return t.createElement("table",{class:"table table-condensed",html:[this._createHeader(),this._createBody()]})},_formatPrice(t){return t.toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})},_displayMarketingModal(t){return n.mask(this.container),this._createMarketingModal(t).then(t=>{n.unmask(this.container),this.container.addContent(t),t.render().show()})},_createMarketingModal:t=>r.getInstance().get(["DS/MPFSubscriptionsComponent/quoteList/MarketingModal"]).then(([e])=>new e({item:t})),_getTotalPrice(e){return t.createElement("td",{class:"mpf-total-price-cell",text:this._formatPrice(e.getTotalNetAmount())})},_getUnitCell(e){return t.createElement("td",{class:"mpf-unit-price-cell",text:this._formatPrice(e.getUnitNetAmount())})},_getQuantityCell:e=>t.createElement("td",{class:"mpf-quantity-cell",text:parseInt(e.getQuantity())}),_getLicensingSchemeCell(e){const s=l.getLicensingLabel(e.getLicensing());return t.createElement("td",{class:"mpf-licensing-cell",text:t.is(s)?s:""})},_getPeriodicityCell(e){const s=e.getLicensingScheme()===c.RevTypes.QRC?c.RevTypes.QSC:e.getLicensingScheme(),i=s===c.RevTypes.YSC?d.get("yearly"):s===c.RevTypes.MSC?d.get("monthly"):d.get("quarterly");return t.createElement("td",{class:"mpf-periodicity-cell",html:[t.createElement("div",{class:"mpf-periodicity-label",text:i}),t.createElement("div",{class:"mpf-periodicity-trigram",text:"("+s+")"})]})},_getProductCell(e){const s=t.createElement("span",{class:"fonticon fonticon-info",events:{click:this._displayMarketingModal.bind(this,e)}}),i=t.createElement("div",{class:"mpf-product-info",html:[t.createElement("div",{class:"mpf-product-number-label",text:e.getProductDisplayName()}),t.createElement("div",{class:"mpf-product-number-value",html:[t.createElement("span",{text:d.get("productNumber")}),e.get("ProductNumber")]})]});return t.createElement("td",{class:"mpf-product-cell",html:[s,i]})},_getProductDetails(e){return t.createElement("tr",{html:[this._getProductCell(e),this._getLicensingSchemeCell(e),this._getPeriodicityCell(e),this._getQuantityCell(e),this._getUnitCell(e),this._getTotalPrice(e)]})},_createBody(){return t.createElement("tbody",{html:this.cart.getItems().map((t,e)=>{if(e<5||this.stateMachine.getState()===p.SHOW_MORE_ACTIVATED)return this._getProductDetails(t)})})},_createHeader:()=>t.createElement("thead",{html:t.createElement("tr",{html:[t.createElement("th",{text:d.get("products")}),t.createElement("th",{text:d.get("licensingScheme")}),t.createElement("th",{text:d.get("subscription")}),t.createElement("th",{text:d.get("quantity")}),t.createElement("th",{text:d.get("unitPrice")}),t.createElement("th",{text:d.get("totalPrice")})]})}),_createStateMachine:()=>new h({state:p.SHOW_MORE_DESACTIVATED,states:[p.SHOW_MORE_ACTIVATED,p.SHOW_MORE_DESACTIVATED],transitions:[{from:p.SHOW_MORE_ACTIVATED,to:p.SHOW_MORE_DESACTIVATED},{from:p.SHOW_MORE_DESACTIVATED,to:p.SHOW_MORE_ACTIVATED}]}),_checkPrototypes(t){o.requiredOfPrototype(t.cart,a,"options.cart must be a CartModel")}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteIdTile",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i)=>{"use strict";return t.extend({className:"mpf-quote-id-tile",setup(t={}){this._parent(t),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel"),this.cart=t.cart},render(){return this.container.setContent(this.cart.getName()),this}})}),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCustomerInformation",["UWA/Core","UWA/Class/View","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s)=>{"use strict";return e.extend({className:"mpf-customer-info",setup(t={}){this.buyer=t.buyer,this.onlineInstanceId=t.onlineInstanceId,this.companyInformation=t.companyInformation,this.customerName=this._createCustomerName(),this.reference=this._createReference()},render(){return this.container.setContent([this.customerName,this.reference]),this},destroy(){this.buyer=null,this.onlineInstanceId=null,this.customerName=null,this.reference=null,this._parent(),this.container=null},_createCustomerName(){return t.createElement("dl",{html:[{tag:"dt",text:s.get("customer")},{tag:"dd",text:this.buyer.getName()}]})},_createReference(){return t.createElement("dl",{html:[{tag:"dt",text:s.get("reference")},{tag:"dd",text:this.companyInformation?this.companyInformation.getSiteId():this.onlineInstanceId}]})}})}),define("DS/MPFSubscriptionsComponent/quoteList/StatusQuoteTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n)=>{"use strict";const r=Object.freeze({CANCELLED:"CANCELLED",SUBMITTED:"SUBMITTED",WAITING_PAYMENT:"WAITING_PAYMENT",PROCESSING_PAYMENT:"PROCESSING_PAYMENT",PAID:"PAID",PROCESSING:"PROCESSING",READY:"READY",DELIVERED:"DELIVERED"}),o=Object.freeze({CANCELLED:"0",SUBMITTED:"14",WAITING_PAYMENT:"29",PROCESSING_PAYMENT:"43",PAID:"58",PROCESSING:"72",READY:"86",DELIVERED:"100"});return e.extend({className:"mpf-status-quote-tile",setup(t={}){this._parent(t),s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel"),this.cart=t.cart},render(){return this.container.setContent([this._getOrderStatusContainer(),this._getProgressBarContainer()]),this},_getProgressBarContainer(){const e=this.cart.getGlobalState(),s=o[e],i=t.createElement("div",{class:"mpf-progress-bar",html:t.createElement("div",{class:"mpf-step-bar",styles:{width:s+"%"}})});return e===r.DELIVERED&&i.addClassName("complete"),i},_getOrderStatusContainer(){const e=this._getIcon(),s=n.get(this.cart.getGlobalState().toLowerCase());return t.createElement("div",{class:"mpf-status",html:[e,s]})},_getIcon(){let e;const s=this.cart.getGlobalState();return s===r.SUBMITTED?e="fonticon fonticon-right":s===r.WAITING_PAYMENT?e="fonticon fonticon-survey":s===r.PROCESSING_PAYMENT?e="fonticon fonticon-hourglass":s===r.PAID?e="fonticon fonticon-check":s===r.PROCESSING?e="fonticon fonticon-clock":s===r.READY?e="fonticon fonticon-parcel-ok":s===r.DELIVERED?e="fonticon fonticon-status-ok":s===r.CANCELLED&&(e="fonticon fonticon-wrong"),t.createElement("span",{class:e})}})}),define("DS/MPFSubscriptionsComponent/roleList/MarketingModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h)=>{"use strict";return t.extend({className:"mpf-marketing-modal mpf-click-and-buy",setup(t={}){e.is(t.product)?(r.requiredOfPrototype(t.product,o,"options.product must be a ProductModel"),this.product=t.product,this.isProductModel=!0):e.is(t.offer)&&(r.requiredOfPrototype(t.offer,a,"options.offer must be a PortfolioModel"),this.offer=t.offer,this.isProductModel=!1),this.modal=this._createModal()},render(){return this.container.setContent([this.modal]),this._setModalBody(),this},show(){this.modal.show()},destroy(){this.modal.destroy(),this.product=null,this.offer=null,this._parent(),this.container=null},_createModal(){return new s({className:"mpf-marketing-offer",header:{tag:"h4",text:this.isProductModel?this.product.getDisplayName():this.offer.getProductName()},events:{onHide:this.destroy.bind(this)},visible:!1})},_setModalBody(){if(i.mask(this.modal.getBody()),!this.isProductModel||!this.product.isMarketplaceOffer()){const t=this.isProductModel?this.product.getProductTrigram():this.offer.getProductTrigram();return c.getPortfolioRoleFromCompass(t.split("-")[0]).then(s=>{if(e.is(s.description)){const t=new l({portfolioInfo:s});i.unmask(this.modal.getBody()),this.modal.setBody(t.render())}else{const s=e.createElement("iframe",{src:"https://www.3ds.com/role/inapp/"+t+"/"});this.modal.setBody(s)}}).catch(()=>{i.unmask(this.modal.getBody())})}Promise.all(Object.keys(this.product.getIncludedProducts()).map(t=>c.getPortfolioRoleFromCompass(t.split("-")[0]))).then(t=>{i.unmask(this.modal.getBody()),this.modal.setBody([{tag:"div",class:"mpf-roles-title",text:h.get("rolesIncludedInOffer")},{tag:"div",class:"mpf-roles-container",html:t.map(t=>this._renderRoleTile(t))}])}).catch(()=>{i.unmask(this.modal.getBody())})},_renderRoleTile:t=>({tag:"div",class:"mpf-role-tile",html:[{tag:"img",src:n.getWebappsAssetUrl("i3DXCompass","v3.1/images/role")+"/"+t.brand+"_Role.png"},{tag:"span",class:"mpf-role-name",text:t.title}]})})}),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsVirtualIbanEntry",["UWA/Core","UWA/Class/View","DS/MPFVirtualIbanModel/VirtualIbanModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i)=>{"use strict";const n={"3DS-EUR":{accountName:s.Fields.ACCOUNT_NAME,bic:s.Fields.BIC,bankName:s.Fields.BANK_NAME,iban:s.Fields.IBAN},"3DS-GBP":{accountName:s.Fields.ACCOUNT_NAME,bic:s.Fields.BIC,bankName:s.Fields.BANK_NAME,iban:s.Fields.IBAN},"3DS-USD":{accountName:s.Fields.ACCOUNT_NAME,swift:s.Fields.BIC,bankName:s.Fields.BANK_NAME,accountNumber:s.Fields.ACCOUNT_NUMBER,routingNumber:s.Fields.ROUTING_NUMBER},"3DS-AUD":{accountName:s.Fields.ACCOUNT_NAME,swift:s.Fields.BIC,bankName:s.Fields.BANK_NAME,accountNumber:s.Fields.ACCOUNT_NUMBER,bsb:s.Fields.BSB_NUMBER},"3DS-JPY":{accountName:s.Fields.ACCOUNT_NAME,bankName:s.Fields.BANK_NAME,swift:s.Fields.BIC,accountNumber:s.Fields.ACCOUNT_NUMBER}};return e.extend({tagName:"dl",className:"mpf-virtual-iban",setup(t){this.virtualIban=t.virtualIban,this.keyValueList=this._createKeyValueList()},render(){return this.container.setContent(this.keyValueList),this},_createKeyValueList(){const t=n[this.virtualIban.getExternalReference()]||[];return Object.keys(t).map(e=>this._createKeyValueEntry(i.get(e),this.virtualIban.get(t[e])))},_createKeyValueEntry:(e,s)=>t.createElement("div",{class:"mpf-entry",html:[{tag:"dt",class:"mpf-key",text:e},{tag:"dd",class:"mpf-value",text:s}]}),destroy(){this.virtualIban=null,this._parent()}})}),define("DS/MPFSubscriptionsComponent/roleList/RoleCardFooter",["UWA/Class/View","DS/UIKIT/Input/Button","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],function(t,e,s){"use strict";var i,n={BUY_MORE:"buyMore"};return(i=t.extend({className:"mpf-role-card-footer",setup:function(t){t||(t={}),this._parent(t),this.buyMoreButton=this._createBuyMoreButton()},render:function(){return this.container.setContent(this.buyMoreButton),this},_onBuyMoreButtonClicked:function(){this.dispatchEvent(n.BUY_MORE)},_createBuyMoreButton:function(){return new e({className:"primary",value:s.get("buyMoreSubs"),icon:"shopping-cart",events:{onClick:this._onBuyMoreButtonClicked.bind(this)}})}})).Events=Object.freeze(n),i}),define("DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTileElement",["UWA/Core","UWA/Class/View"],(t,e)=>{"use strict";const s=Object.freeze({SELECTED:"selected"}),i=e.extend({className:"mpf-status-selector-tile-element",domEvents:{click:"onClick"},setup(t){this.title=t.title,this.count=t.count||0,this.setIsSelected(t.isSelected),this.titleElement=this._createTitleElement(),this.countElement=this._createCountElement(),this.container.addClassName(t.cssClass)},render(){return this.container.setContent([this.titleElement,this.countElement]),this},setIsSelected(t){this.isSelected=!0===t,this.isSelected?this.container.addClassName("mpf-selected"):this.container.removeClassName("mpf-selected")},onClick(){this.dispatchEvent(s.SELECTED),this.setIsSelected(!0)},updateCount(t){this.countElement.setText(t)},_createTitleElement(){return t.createElement("p",{class:"mpf-title",text:this.title})},_createCountElement:function(){return t.createElement("p",{class:"mpf-count",text:"("+this.count+")"})}});return i.Events=Object.freeze(s),i}),define("DS/MPFSubscriptionsComponent/quoteList/DownloadQuoteTile",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/DropdownMenu","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFAddressModel/AddressModel","DS/MPFCompanyModel/CompanyModel","DS/MPFCartModel/CartModel","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFFiniteStateMachine/FiniteStateMachine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u,m,S,C,y)=>{"use strict";const M=Object.freeze({ACTIVE:"active",LOADING:"loading"}),f=Object.freeze({CANCELLED:"CANCELLED",PENDING_CONFIRMATION:"WAITING_PAYMENT",PROCESSING:"PROCESSING",DELIVERED:"DELIVERED"});return e.extend({className:"mpf-quote-download-tile",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.cartQuoteFactory=t.cartQuoteFactory,this.companyFactory=t.companyFactory,this.invoiceFactory=t.invoiceFactory,this.quote=this.cartQuoteFactory.createModel(u.Types.CART_QUOTE),this.quote.setParentResourceId(this.cart.id),this.invoice=this.invoiceFactory.createModel(m.Types.INVOICE),this.stateMachine=this._createStateMachine(),this.downloadLink=this._createDownloadLink(),this.spinner=new i},render(){return this.stateMachine.getState()===M.LOADING?(this.container.setContent(this.spinner),this.spinner.show()):this.container.setContent(this.downloadLink),this},_createDownloadLink(){const e=this.cart.getGlobalState(),s=t.createElement("div",{class:"fonticon fonticon-download"});if(e===f.PENDING_CONFIRMATION||e===f.PROCESSING||e===f.CANCELLED||e===f.DELIVERED&&!t.is(this.cart.getInvoiceId())){const t=this._handleFetchAddressesAndDownloadQuote.bind(this);s.addEvent("click",t)}else e===f.DELIVERED&&t.is(this.cart.getInvoiceId())&&this._createDownloadMenu(s);return s},_handleFetchAddressesAndDownloadQuote(){if(this.cart.getCompanyID()){const t=this.companyFactory.createModel(S.Types.COMPANY);return t.id=this.cart.getCompanyID(),t.fetchPromise({expand:[d.Expands.ADDRESSES]}).then(this._handleDownloadQuote.bind(this))}return this._handleDownloadQuote()},_handleDownloadQuote(e){let s;const i=t.is(e)?e.addresses:[],n=i.filter(t=>t.isBillTo());return""!==this.cart.get("billTo")||t.is(this.cart.get(p.Fields.BILL_TO))&&""!==this.cart.get(p.Fields.BILL_TO)||1!==n.length?this.cart.getState()===f.PROCESSING||this.cart.getState()===f.DELIVERED?this._downloadQuote():((s=new r({header:y.get("downloadQuote"),events:{onHide:function(){s.destroy()}}})).setBody(this._createModalBody(s,i)),s.setFooter(this._createModalFooter(s)),s.inject(document.body),void s.show()):this._patchBillingAddressOnCart(n[0].id).then(this._downloadQuote.bind(this))},_patchBillingAddressOnCart(t){return this.stateMachine.changeState(M.LOADING),this.render(),this.cart.dataProxy=this.cart.collection.modelDataProxy,this.cart.savePromise({BillTo:t},{patch:!0}).finally(()=>{this.stateMachine.changeState(M.ACTIVE),this.render()})},_downloadQuote(e){return this.stateMachine.changeState(M.LOADING),this.render(),t.is(e)&&s.mask(e.getBody()),this.quote.fetchPromise().then(()=>{window.open(this.quote.getUrl()),t.is(e)&&e.hide()}).finally(()=>{this.stateMachine.changeState(M.ACTIVE),this.render()})},_downloadInvoice(){this.invoice.id=this.cart.getInvoiceId(),window.open(this.invoice.dataProxy.urlGet(this.invoice))},_onChangeBillingAddress(t,e){""!==e&&(s.mask(t.getBody()),this._patchBillingAddressOnCart(e).catch(()=>{new c({visible:!0,messageClassName:"error",messages:y.get("errorOccured")}).inject(t.getBody(),"top")}).finally(()=>{s.unmask(t.getBody())}))},_getAddressOptions(t){return t.filter(t=>t.isBillTo()).map(t=>({value:t.id,label:this._getAddressLabel(t)}))},_getAddressLabel:t=>[h.Fields.LINE1,h.Fields.LINE2,h.Fields.LINE3,h.Fields.LINE4,h.Fields.CITY,h.Fields.COUNTY,h.Fields.STATE,h.Fields.POSTAL_CODE,h.Fields.COUNTRY].map(e=>t.get(e)).filter(t=>t&&t.length>0).join(", "),_createModalBody(e,s){const i=this;return[t.createElement("div",{text:y.get("selectBillingAddress")}),new a({placeholder:y.get("selectBillingAddress"),options:this._getAddressOptions(s),events:{onChange:()=>{i._onChangeBillingAddress(e,this.getValue()[0])}}})]},_createModalFooter(t){return[new o({className:"primary",value:y.get("downloadQuote"),events:{onClick:this._downloadQuote.bind(this,t)}}),new o({value:y.get("cancel"),events:{onClick:()=>{t.hide()}}})]},_createDownloadMenu(t){return new n({target:t,items:[{text:y.get("downloadQuote"),handler:this._handleFetchAddressesAndDownloadQuote.bind(this)},{text:y.get("downloadInvoice"),handler:this._downloadInvoice.bind(this)}]})},_createStateMachine:()=>new C({state:M.ACTIVE,states:[M.ACTIVE,M.LOADING],transitions:[{from:M.ACTIVE,to:M.LOADING},{from:M.LOADING,to:M.ACTIVE}]}),_checkPrototypes(t){l.requiredOfPrototype(t.invoiceFactory,m,"options.invoiceFactory must be an InvoiceFactory"),l.requiredOfPrototype(t.cartQuoteFactory,u,"options.cartQuoteFactory must be a CartQuoteFactory"),l.requiredOfPrototype(t.cart,p,"options.cart must be a CartModel"),l.requiredOfPrototype(t.companyFactory,S,"options.companyFactory must be a CompanyFactory")}})}),define("DS/MPFSubscriptionsComponent/roleList/ActiveSubscriptionLine",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFSubscriptionModel/SubscriptionModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r)=>{"use strict";const o=Object.freeze({STOP_SUBSCRIPTION:"stopSubscription"}),a=e.extend({className:"mpf-active-subscription-line",setup(t={}){i.requiredOfPrototype(t.subscription,n,"options.subscription must be a SubscriptionModel"),this.subscription=t.subscription,this.stopButton=this._createStopButton()},render(){return this.container.setContent([{tag:"span",class:"mpf-end-date",text:this.subscription.has(n.Fields.END_DATE)?this.subscription.getEndDate():""},{tag:"span",class:"mpf-number-subscriptions",text:r.get("nActive",{number:this.subscription.getActiveQuantity()})},this.stopButton]),this},destroy(){this.stopButton=null,this.cancelButton=null,this.subscription=null,this._parent(),this.container=null},_createStopButton(){return new s({className:"primary",value:r.get("stopRenewal"),disabled:0===this.subscription.getActiveQuantity(),events:{onClick:this.dispatchEvent.bind(this,o.STOP_SUBSCRIPTION,this.subscription)}})}});return a.Events=o,a}),define("DS/MPFSubscriptionsComponent/roleList/StopSubscriptionsComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/MPFServices/ObjectService","DS/MPFSubscriptionModel/SubscriptionModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c)=>{"use strict";const l=Object.freeze({CANCEL:"cancel",SUBS_STOPPED:"subsStopped"}),h=e.extend({className:"mpf-stop-subscriptions",setup(t={}){this._parent(t),this._checkPrototypes(t),this.subscription=t.subscription,this.message=this._createMessageContainer(),this.quantityInput=this._createQuantityInput(),this.stopButton=this._createStopButton(),this.cancelButton=this._createCancelButton()},render(){return this.container.setContent([{tag:"div",class:"mpf-subscrpition-info",html:[{tag:"span",class:"mpf-end-date",text:this.subscription.getEndDate()},{tag:"span",class:"mpf-number-subscriptions",text:c.get("nActive",{number:this.subscription.getActiveQuantity()})}]},{tag:"div",class:"mpf-stop-subscriptions-buttons",html:[this.stopButton,this.cancelButton]}]),this},_stopSubscriptions(){const t=parseInt(this.quantityInput.getValue());return n.mask(this.container),this.subscription.savePromise({[a.Fields.ONLINE_INSTANCE]:this.subscription.onlineInstanceId,[a.Fields.QUANTITY]:t}).then(()=>{n.unmask(this.container),this.dispatchEvent(l.SUBS_STOPPED,this.subscription)}).catch(t=>{n.unmask(this.container),t.response.errorCode===a.ErrorCodes.STOP_AFTER_DEADLINE&&new r({className:"error",messageClassName:"error",messages:c.get("errorStopAfterDeadline"),closable:!0,visible:!0,autoHide:!1}).inject(this.container,"top"),console.error(t)})},_createMessageContainer:()=>t.createElement("div",{class:"mpf-stop-subscriptions-message",text:c.get("stopSubsMessage")}),_createQuantityInput(){return new i({min:1,max:this.subscription.getActiveQuantity(),disabled:!0,value:this.subscription.getActiveQuantity()})},_createStopButton(){return new s({className:"primary",value:c.get("stop"),events:{onClick:this._stopSubscriptions.bind(this)}})},_createCancelButton(){return new s({value:c.get("cancel"),events:{onClick:()=>{this.dispatchEvent(l.CANCEL)}}})},_checkPrototypes(t){o.requiredOfPrototype(t.subscription,a,"options.subscription must be a SubscriptionModel")}});return h.Events=l,h}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents",[],()=>{"use strict";return Object.freeze({FILTER_BY_STATE:"filterByState",FILTER_BY_DATE:"filterByDate",SORT:"sort",CLEAR_DATE_FILTER:"clearFilter"})}),define("DS/MPFSubscriptionsComponent/quoteList/SentQuoteTile",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r)=>{"use strict";return e.extend({className:"mpf-sent-quote-tile",setup(t={}){this._parent(t),s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel"),this.cart=t.cart},render(){const e=t.createElement("div",{class:"mpf-sent-time",text:r.get("timeAgo",{time:n.getElapsedTime(this.cart.getCreated())})}),s=r.get("sentAgo",{timeAgo:e.outerHTML});return this.container.setContent(s),this}})}),define("DS/MPFSubscriptionsComponent/CartHelper",["UWA/Promise","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartModel/CartPatchArray","DS/MPFCartModel/CartPatchOperation"],function(t,e,s,i,n){"use strict";var r={createQuote:function(t,s,i,n){return t.unset("id"),t.set(e.Fields.ONLINE_INSTANCE,""),t.set(e.Fields.CURRENCY,s),t.set("legalEntityId",n),t.set(e.Fields.STATE,"Draft"),t.set("type",e.Types.SOFTWARE_REQUEST),t.set("licensorId",i),t.set("isSelfOrder",!0),t.savePromise()},addItemsToQuote:function(t,r,o,a){var c,l,h={};return h[s.Fields.SKU_ID]=r.getSkuId(),h[s.Fields.LICENSING]=r.getLicensingScheme(),h[s.Fields.LICENSING_SCHEME]=r.getRevType(),h[s.Fields.PRODUCT_DISPLAY_NAME]=r.getProductName(),h[s.Fields.PRODUCT_TRIGRAM]=r.getProductTrigram(),h[s.Fields.PRODUCT_NUMBER]=r.getProductNumber(),h[s.Fields.ACTION]=t.getActionType()||e.ActionTypes.START,h[s.Fields.UNIT_NET_AMOUNT]=r.getListedPrice(),h[s.Fields.TYPE]=t.get(e.Fields.TYPE)||e.Types.SOFTWARE_REQUEST,h[s.Fields.QUANTITY]=a,h[s.Fields.ONLINE_INSTANCE]=r.onlineInstanceId,c=new i,l=new n(n.Operations.add,"/cart-items",h),c.add(l),t.megaPatch(c)},addSubscriptionsItemsToQuote:function(t,r,o,a){var c,l,h={};return h[s.Fields.ONLINE_INSTANCE]=r.onlineInstanceId,h[s.Fields.SKU_ID]=o.getOfferId(),h[s.Fields.LICENSING]=r.getLicensingScheme(),h[s.Fields.LICENSING_SCHEME]=o.getLicensingScheme(),h[s.Fields.PRODUCT_DISPLAY_NAME]=r.getDisplayName(),h[s.Fields.PRODUCT_TRIGRAM]=r.getProductTrigram(),h[s.Fields.PRODUCT_NUMBER]=r.getProductNumber(),h[s.Fields.ACTION]=t.getActionType()||e.ActionTypes.START,h[s.Fields.UNIT_NET_AMOUNT]=o.getPrice().toString(),h[s.Fields.TYPE]=t.get(e.Fields.TYPE)||e.Types.SOFTWARE_REQUEST,h[s.Fields.QUANTITY]=a,c=new i,l=new n(n.Operations.add,"/cart-items",h),c.add(l),t.megaPatch(c)},deleteItemsFromQuote:function(e,s){var r,o,a;return o=e.getItems().filter(function(t){return t.getSkuId()===s}),r=new i,a=o.map(function(t){return new n(n.Operations.REMOVE,"/cart-items/"+t.id)}),r.addAll(a),a.length>0?e.megaPatch(r):t.resolve()},modifyQuantitiesItemsOnQuote:function(e,s){var r,o;return r=new i,o=s.map(function(t){return new n(n.Operations.MODIFY,"/cart-items/"+t.id,{Quantity:parseInt(t.quantity)})}),r.addAll(o),o.length>0?e.megaPatch(r):t.resolve()}};return r}),define("DS/MPFSubscriptionsComponent/quoteList/MarketingModal",["UWA/Class/View","UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCartModel/CartItemModel","DS/MPFPortfolioModel/PortfolioHelper","DS/MPFClickAndBuyComponent/MarketingPortfolioPage","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c)=>{"use strict";return t.extend({className:"mpf-marketing-modal mpf-click-and-buy",setup(t={}){n.requiredOfPrototype(t.item,r,"options.item must be a CartItemModel"),this.item=t.item,this.modal=this._createModal()},render(){return this.container.setContent(this.modal),this._setModalBody(),this},show(){this.modal.show()},destroy(){this.modal.destroy(),this.item=null,this._parent(),this.container=null},_createModal(){return new s({className:"mpf-marketing-offer",header:{tag:"h4",text:this.item.getProductDisplayName()},events:{onHide:this.destroy.bind(this)},visible:!1})},_setModalBody(){i.mask(this.modal.getBody());const t=this.item.getProductTrigram();return o.getPortfolioRoleFromCompass(t.split("-")[0]).then(s=>{if(e.is(s.description)){const t=new a({portfolioInfo:s});i.unmask(this.modal.getBody()),this.modal.setBody(t.render())}else{const s=e.createElement("iframe",{src:"https://www.3ds.com/role/inapp/"+t+"/"});this.modal.setBody(s)}}).catch(()=>{i.unmask(this.modal.getBody())})}})}),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentCardForm",["UWA/Promise","UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodModel","DS/MPFPaymentCardTokenModel/PaymentCardTokenModel","DS/MPFPspModel/PspModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p)=>{"use strict";const u=Object.freeze({PAYMENT_INFO_UPDATED:"paymentInfoUpdated",CANCEL:"cancel"}),m=s.extend({className:"mpf-payment-method-form",setup(t={}){this._checkPrototypes(t),this.title=t.title,this.psp=t.psp,this.card=t.card,this.stripe=Stripe(this.psp.getPublicKey()),this.elements=this.stripe.elements(),this.onlineInstanceId=t.onlineInstanceId,this.formTitle=this._createFormTitle(),this.cardNameHolderInput=this._createCardNameHolderInput(),this.cardNumberInput=this._createCardNumberInput(),this.cardExpiryDateInput=this._createCardExpiryDateInput(),this.expiryMonthInput=this._createExpiryMonthInput(),this.expiryYearInput=this._createExpiryYearInput(),this.cardVerificationCodeInput=this._createCardVerificationCodeInput(),this.saveButton=this._createSaveButton(),this.cancelButton=this._createCancelButton(),this.formCommands=this._createFormCommands()},render(){const t=[e.createElement("div",{class:"mpf-stripe-card-inline",html:[this._createCardNameHolderContainer(),this._createCardNumberInputContainer()]}),e.createElement("div",{class:"mpf-stripe-card-inline",html:this.card.isNew()?[this._createCardExpiryDateInputContainer(),this._createCardCvcInputContainer()]:[this._createExpiryMonthInputContainer(),this._createExpiryYearInputContainer()]}),this.formCommands];return this.formTitle&&t.unshift(this.formTitle),this.container.setContent(t),this},_onSave(){return this.card.isNew()?this.psp.isScaEnabled()?this._createStripeTokenCardWithSca():this._createStripeTokenCard():this._updateCardInfo()},_onCancel(){this.hide(),this.dispatchEvent(u.CANCEL)},_updateCardInfo(){const t={[h.Fields.CARD_NAME]:this.cardNameHolderInput.getValue(),[h.Fields.CARD_EXP_MONTH]:this.expiryMonthInput.getValue()[0],[h.Fields.CARD_EXP_YEAR]:this.expiryYearInput.getValue()[0]};return i.mask(this.container),this.card.setParentResourceId(this.onlineInstanceId),this.card.savePromise(t,{patch:!0}).then(this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)).catch(this._displayErrorMessage.bind(this,p.get("cardNotUpdated"))).finally(i.unmask.bind(i,this.container))},_createFormTitle(){return this.title?e.createElement("h1",{class:"mpf-title",text:this.title}):null},_createStripeTokenCardWithSca(){const e={[l.Fields.IS_DEFAULT_PAYMENT_METHOD]:!0};return this.card.set(e),this.card.setParentResourceId(this.onlineInstanceId),i.mask(this.container),this.card.savePromise().then(()=>{const t={name:this.cardNameHolderInput.getValue()};return this.stripe.confirmCardSetup(this.card.getClientSecret(),{payment_method:{card:this.cardNumberInput,billing_details:t}})}).then(e=>e.error?(this._displayErrorMessage(e.error),t.resolve(e.error)):(this.dispatchEvent(u.PAYMENT_INFO_UPDATED),t.resolve())).catch(t=>{console.error(t),this._displayErrorMessage(p.get("cardNotSaved"))}).finally(i.unmask.bind(i,this.container))},_createStripeTokenCard(){const t={name:this.cardNameHolderInput.getValue()};return i.mask(this.container),this.stripe.createToken(this.cardNumberInput,t).then(t=>{if(t.token){const e={[l.Fields.IS_DEFAULT_PAYMENT_METHOD]:!0,[l.Fields.PAYMENT_TOKEN]:t.token.id};return this.card.set(e),this.card.setParentResourceId(this.onlineInstanceId),this.card.savePromise()}this._displayErrorMessage(t.error)}).then(this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)).catch(this._displayErrorMessage.bind(this,p.get("cardNotSaved"))).finally(i.unmask.bind(i,this.container))},_displayErrorMessage(t){new n({className:"error",messageClassName:"error",messages:t,closable:!0,visible:!0,closeOnClick:!0}).inject(this.container,"top")},_validateExipiryDateInput(t){const e=""===this.expiryYearInput.getValue()[0],s=""===this.expiryMonthInput.getValue()[0],i=this.container.getElement(".mpf-expiry-year"),n=this.container.getElement(".mpf-expiry-month");return e&&"year"===t?(i.addClassName("invalid"),i.getElement("#mpf-stripe-card-expiration-errors").setText(p.get("invalidExpiryYear"))):(i.removeClassName("invalid"),i.getElement("#mpf-stripe-card-expiration-errors").setText("")),s&&"month"===t?(n.addClassName("invalid"),n.getElement("#mpf-stripe-card-expiration-errors").setText(p.get("invalidExpiryMonth"))):(n.removeClassName("invalid"),n.getElement("#mpf-stripe-card-expiration-errors").setText("")),e||s?this.saveButton.disable():this.saveButton.enable()},_createExpiryYearInput(){const t=new Date(Date.now()),e=parseInt(t.getFullYear());return new o({placeholder:"YYYY",events:{onChange:this._validateExipiryDateInput.bind(this,"year")},options:[{value:e},{value:e+1},{value:e+2},{value:e+3},{value:e+4},{value:e+5},{value:e+6},{value:e+7}]})},_createExpiryYearInputContainer(){const t=e.createElement("div",{class:"mpf-expiry-year-input",html:[e.createElement("label",{text:p.get("expiryYear")}),this.expiryYearInput]}),s=e.createElement("div",{id:"mpf-stripe-card-expiration-errors"});return e.createElement("div",{class:"mpf-expiry-year",html:[t,s]})},_createExpiryMonthInput(){return new o({placeholder:"MM",events:{onChange:this._validateExipiryDateInput.bind(this,"month")},options:[{value:"01"},{value:"02"},{value:"03"},{value:"04"},{value:"05"},{value:"06"},{value:"07"},{value:"08"},{value:"09"},{value:"10"},{value:"11"},{value:"12"}]})},_createExpiryMonthInputContainer(){const t=e.createElement("div",{class:"mpf-expiry-month-input",html:[e.createElement("label",{text:p.get("expiryMonth")}),this.expiryMonthInput]}),s=e.createElement("div",{id:"mpf-stripe-card-expiration-errors"});return e.createElement("div",{class:"mpf-expiry-month",html:[t,s]})},_validateCardNameHolderInput(){""===this.cardNameHolderInput.getValue().trim()?(this.saveButton.disable(),this.cardNameHolderInput.setClassName("invalid"),this.container.getElement("#mpf-stripe-card-holder-errors").setText(p.get("cardHolderEmpty"))):this.saveButton.enable()},_createCardNameHolderInput(){return new r({placeholder:p.get("cardHolder"),value:this.card.isNew()?"":this.card.getCardName(),events:{onChange:this._validateCardNameHolderInput.bind(this),onKeyDown:()=>{this.cardNameHolderInput.setClassName(""),this.container.getElement("#mpf-stripe-card-holder-errors").setText("")}}})},_createCardNumberInput(){if(this.card.isNew()){const t=this.elements.create("cardNumber",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",t=>{t.error?this.container.getElement("#mpf-stripe-card-number-errors").setContent(t.error.message):this.container.getElement("#mpf-stripe-card-number-errors").setContent("")}),t}return new r({value:"**** - "+this.card.getCardNumber(),disabled:!0})},_createCardExpiryDateInput(){const t=this.elements.create("cardExpiry",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",t=>{t.error?this.container.getElement("#mpf-stripe-card-expiration-errors").setContent(t.error.message):this.container.getElement("#mpf-stripe-card-expiration-errors").setContent("")}),t},_createCardVerificationCodeInput(){const t=this.elements.create("cardCvc",{classes:{base:"StripeCardElement",focus:"StripeCardElement--focus",invalid:"StripeCardElement--invalid"}});return t.addEventListener("change",t=>{t.error?this.container.getElement("#mpf-stripe-card-cvc-errors").setContent(t.error.message):this.container.getElement("#mpf-stripe-card-cvc-errors").setContent("")}),t},_createSaveButton(){return new a({className:"primary",value:p.get("save"),disabled:!0,events:{onClick:this._onSave.bind(this)}})},_createFormCommands(){return e.createElement("div",{class:"mpf-stripe-payment-commands",html:[this.saveButton,this.cancelButton]})},_createCancelButton(){return new a({className:"default",value:p.get("cancel"),events:{onClick:this._onCancel.bind(this)}})},_createCardNameHolderContainer(){const t=e.createElement("span",{text:p.get("cardHolder")}),s=e.createElement("div",{id:"mpf-stripe-card-holder-errors"});return e.createElement("div",{class:"mpf-stripe-payment-card-holder",html:[e.createElement("label",{html:[t,this.cardNameHolderInput]}),s]})},_createCardCvcInputContainer(){const t=e.createElement("span",{text:"CVC"}),s=e.createElement("div",{id:"mpf-stripe-card-cvc-element"}),i=e.createElement("div",{id:"mpf-stripe-card-cvc-errors"});return this.cardVerificationCodeInput.mount(s),e.createElement("div",{class:"mpf-stripe-card-cvc-element-container",html:[e.createElement("label",{html:[t,s]}),i]})},_createCardExpiryDateInputContainer(){const t=e.createElement("span",{text:p.get("expiryDate")}),s=e.createElement("div",{id:"mpf-stripe-card-expiration-element"}),i=e.createElement("div",{id:"mpf-stripe-card-expiration-errors"});return this.cardExpiryDateInput.mount(s),e.createElement("div",{class:"mpf-stripe-card-expiration-element-container",html:[e.createElement("label",{html:[t,s]}),i]})},_createCardNumberInputContainer(){let t;const s=e.createElement("span",{text:p.get("cardNumber")}),i=e.createElement("div",{id:"mpf-stripe-card-number-errors"});return this.card.isNew()&&(t=e.createElement("div",{id:"mpf-stripe-card-number-element"}),this.cardNumberInput.mount(t)),e.createElement("div",{class:"mpf-stripe-card-number-element-container",html:[e.createElement("label",{html:[s,this.card.isNew()?t:this.cardNumberInput]}),i]})},_checkPrototypes(t){c.requiredOfPrototype(t.psp,d,"options.psp must be a PspModel"),c.requiredAsOneOf(t.card,[l,h],"options.card must be a PaymentMethodModel or a PaymentCardTokenModel")},destroy(){this._parent(),this.container=null}});return m.Events=u,m}),define("DS/MPFSubscriptionsComponent/roleList/RoleCardHeader",["UWA/Core","UWA/Class/View","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e)=>{"use strict";return e.extend({className:"mpf-role-card-header",setup(t={}){this._parent(t),this.portfolioRoleInfo=t.portfolioRoleInfo||{}},render(){const e=this.portfolioRoleInfo.descriptionMedias;if(e){const s=t=>"png"===t.split(".").pop(),i=e.filter(s).shift(),n=this.portfolioRoleInfo.title,r=t.createElement("img",{src:t.is(i)?i:"",width:"250px",height:"120px",loading:"lazy",alt:t.is(n)?n:""});r.addEventListener("error",this._onError.bind(this)),this.container.setContent(r)}return this},_onError(t){t.target.style.display="none"},destroy(){this.stopListening(),this._parent(),this.container=null}})}),define("DS/MPFSubscriptionsComponent/offerList/OfferCardHeader",["UWA/Core","UWA/Class/View","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e)=>{"use strict";return e.extend({className:"mpf-offer-card-header",setup(t={}){this._parent(t),this.portfolioRoleInfo=t.portfolioRoleInfo||{}},render(){const e=this.portfolioRoleInfo.descriptionMedias;if(e){const s=t=>"png"===t.split(".").pop(),i=e.filter(s).shift(),n=this.portfolioRoleInfo.title,r=t.createElement("img",{src:t.is(i)?i:"",width:"250px",height:"120px",loading:"lazy",alt:t.is(n)?n:""});r.addEventListener("error",this._onError.bind(this)),this.container.setContent(r)}return this},_onError(t){t.target.style.display="none"},destroy(){this.stopListening(),this._parent(),this.container=null}})}),define("DS/MPFSubscriptionsComponent/offerList/OfferCardBody",["UWA/Core","UWA/Class/View","DS/UIKIT/Scroller","DS/UIKIT/Modal","DS/MPFServices/ObjectService","DS/MPFAmdLazyLoader/AmdLazyLoader","DS/MPFPortfolioModel/PortfolioModel","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a)=>{"use strict";return e.extend({className:"mpf-offer-card-body",setup(t={}){this._parent(t),n.requiredOfPrototype(t.offer,o,"options.offers must be a PortfolioModel"),this.portfolioRoleInfo=t.portfolioRoleInfo||{},this.offer=t.offer,this.title=this._createTitleContainer(),this.description=this._createDescriptionContainer(),this.price=this._createPriceContainer(),this.revType=this._createRevTypeContainer()},render(){const e=t.createElement("div",{class:"mpf-info-container",html:[this.title,this.description]}),s=t.createElement("div",{class:"mpf-price-container",html:[this.price,this.revType]});return this.container.setContent([e,s]),this},_createTitleContainer(){const e=t.createElement("span",{class:"fonticon fonticon-info",events:{click:this._displayMarketingInfo.bind(this)}});return t.createElement("div",{class:"mpf-offer-title",html:[e,this.offer.getProductName()]})},_createDescriptionContainer(){let e="";t.is(this.portfolioRoleInfo.tagLine)&&(e=this.portfolioRoleInfo.tagLine);const i=t.createElement("div",{class:"mpf-offer-description-content",html:e}),n=t.createElement("div",{class:"mpf-offer-description",html:i});try{new s({element:i}).inject(n)}catch(t){console.warn(t)}return n},_createPriceContainer(){const e=this.offer.getLicensingScheme(),s="NAM"===e||"CON"===e||"CAS"===e,i=this.offer.getPrice();let n=parseFloat(i).toLocaleString("fr-FR",{style:"currency",currency:this.offer.getCurrency()});return n=s?n+" / "+a.get("user")+" / "+a.get("month"):n+" / "+a.get("month"),t.createElement("div",{class:"mpf-offer-price",text:n})},_createRevTypeContainer(){let e;const s=this.offer.getRevType();return s===o.RevTypes.YSC?e=a.get("yearly"):s!==o.RevTypes.QRC&&s!==o.RevTypes.QSC||(e=a.get("quarterly")),t.createElement("div",{class:"mpf-offer-rev-type",text:e})},_displayMarketingInfo(){return this._createMarketingModal().then(t=>{t.inject(document.body),t.render().show()})},_createMarketingModal(){return r.getInstance().get(["DS/MPFSubscriptionsComponent/roleList/MarketingModal"]).then(([t])=>new t({offer:this.offer}))},destroy(){this.stopListening(),this._parent(),this.container=null}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCardHeader",["UWA/Core","UWA/Class/View","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartItemModel","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFSubscriptionsComponent/quoteList/QuoteIdTile","DS/MPFSubscriptionsComponent/quoteList/SentQuoteTile","DS/MPFSubscriptionsComponent/quoteList/StatusQuoteTile","DS/MPFSubscriptionsComponent/quoteList/DownloadQuoteTile","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u)=>{"use strict";return e.extend({className:"mpf-quote-card-header",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.cartQuoteFactory=t.cartQuoteFactory,this.companyFactory=t.companyFactory,this.invoiceFactory=t.invoiceFactory,this.quoteIdTile=this._createQuoteIdTile(),this.sentQuoteTile=this._createSentQuoteTile(),this.statusQuoteTile=this._createStatusQuoteTile(),this.downloadQuoteTile=this._createDownloadQuoteTile()},render(){const e=t.createElement("div",{class:"mpf-header-left-content",html:[this.quoteIdTile.render(),this.sentQuoteTile.render()]}),s=t.createElement("div",{class:"mpf-header-right-content",html:[this.statusQuoteTile.render(),this.downloadQuoteTile.render()]}),i=t.createElement("div",{class:"mpf-quote-card-header-content",html:[e,s]});return this.container.setContent(i),this},_createDownloadQuoteTile(){return this.cart.getItems().some(t=>t.getLicensingScheme()===r.RevTypes.ELC)?s.getInstance():new p({cart:this.cart,cartQuoteFactory:this.cartQuoteFactory,companyFactory:this.companyFactory,invoiceFactory:this.invoiceFactory})},_createStatusQuoteTile(){return new d({cart:this.cart})},_createSentQuoteTile(){return new h({cart:this.cart})},_createQuoteIdTile(){return new l({cart:this.cart})},_checkPrototypes(t){i.requiredOfPrototype(t.invoiceFactory,a,"options.invoiceFactory must be an InvoiceFactory"),i.requiredOfPrototype(t.cartQuoteFactory,o,"options.cartQuoteFactory must be a CartQuoteFactory"),i.requiredOfPrototype(t.cart,n,"options.cart must be a CartModel"),i.requiredOfPrototype(t.companyFactory,c,"options.companyFactory must be a CompanyFactory")}})}),define("DS/MPFSubscriptionsComponent/closa/ClosaComponentFactory",["UWA/Class","UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartItemFactory","DS/MPFPersonModel/PersonFactory","DS/MPFCartModel/CartModel","DS/MPFSubscriptionsComponent/closa/ClosaComponent"],function(t,e,s,i,n,r,o,a,c,l){"use strict";return t.extend({init:function(t){this.cartId=t.cart.get("id")},openClosa:function(){return this._getConnector().then(this._initFactories.bind(this)).then(this._loadData.bind(this)).then(this._initComponent.bind(this))},_getConnector:function(){return s.fetchPromise({service:i.SUBSCRIPTIONS})},_initFactories:function(t){var s=this,i=n.getInstance(t);return e.all([i.getFactory(n.Types.CART),i.getFactory(n.Types.CART_ITEM),i.getFactory(n.Types.PERSON),i.getFactory(n.Types.TC_CONTRACT),i.getFactory(n.Types.SOFTWARE_AGREEMENT)]).then(function(t){s.cartFactory=t[0],s.cartItemFactory=t[1],s.personFactory=t[2],s.tcContractFactory=t[3],s.softwareAgreementFactory=t[4]})},_loadData:function(){return this.me=this.personFactory.createModel(a.Types.ME),this.cart=this.cartFactory.createModel(r.Types.CART,{id:this.cartId}),this.softwareAgreement=this.softwareAgreementFactory.createModel(),e.all([this.me.fetchPromise(),this.cart.fetchPromise({expand:[c.Expands.CART_ITEMS]})])},_initComponent:function(){var t=this.cartItemFactory.createCollection(o.Types.CART_ITEM,this.cart.getItems());return new l({cart:this.cart,cartItems:t,me:this.me,tcContractFactory:this.tcContractFactory,softwareAgreement:this.softwareAgreement})}})}),define("DS/MPFSubscriptionsComponent/roleList/SchemeActiveSubscriptionList",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionsComponent/roleList/ActiveSubscriptionLine","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n)=>{"use strict";const r=Object.freeze({STOP:"stopSubscription"}),o=Object.freeze({YSC:"yearly",QRC:"quarterly",QSC:"quarterly",MSC:"monthly"}),a=t.extend({className:"mpf-scheme-active-subscription-list",setup(t={}){e.requiredOfPrototype(t.product,s,"options.product must be a ProductModel"),e.requiredOfType(t.licensingScheme,"string","options.licensingScheme must be a string"),this.product=t.product,this.licensingScheme=t.licensingScheme,this.activeSubscriptionLines=[]},render(){const t=[];return this._destroyActiveSubscriptionLines(),this.activeSubscriptionLines=this._createActiveSubscriptionLines(),this.activeSubscriptionLines.forEach(e=>{e&&t.push({tag:"div",class:"mpf-scheme-list-title",text:n.get(`${o[this.licensingScheme]}Subscriptions`).toUpperCase()},{tag:"div",class:"mpf-subscription-list",html:e.render()})}),this.container.setContent(t),this},destroy(){this._destroyActiveSubscriptionLines(),this.activeSubscriptionLines=null,this.product=null,this._parent(),this.container=null},_createActiveSubscriptionLines(){return this.product.getSubscriptions().filter(t=>t.getLicensingScheme()===this.licensingScheme).filter(t=>t.getActiveQuantity()>0).map(t=>{const e=new i({subscription:t});return this.listenTo(e,i.Events.STOP_SUBSCRIPTION,this.dispatchEvent.bind(this,r.STOP,t)),e})},_destroyActiveSubscriptionLines(){this.activeSubscriptionLines.forEach(t=>{this.stopListening(t),t.destroy()}),this.activeSubscriptionLines=[]}});return a.Events=r,a}),define("DS/MPFSubscriptionsComponent/offerList/OfferCardFooter",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFSubscriptionsComponent/CartHelper","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c)=>{"use strict";const l=Object.freeze({READY_TO_ADD:"readyToAdd",ITEM_ADDED:"itemsAdded"});return t.extend({className:"mpf-offer-card-footer",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offer=t.offer,this.cart=t.cart,this.state=this._getQuantityOfferInCart()>0?l.ITEM_ADDED:l.READY_TO_ADD,this.quantityInput=this._createQuantityInput(),this.addButton=this._createAddButton(),this.listenTo(this.cart,"onChange:"+r.Fields.CART_ITEMS,this._updateInfoDisplayed.bind(this)),this.listenTo(this.cart,"onRequest",this._avoidMultiCartCreation.bind(this))},render(){return this.container.setContent([this.quantityInput,this.addButton]),this},_updateInfoDisplayed(){const t=this._getQuantityOfferInCart();this.state=t>0?l.ITEM_ADDED:l.READY_TO_ADD,this.addButton.enable(),this._renderButton(),this.quantityInput.enable(),this.quantityInput.setValue(t>0?t:1),this.quantityInput.setDisabled(t>0)},_avoidMultiCartCreation(){this.cart.isNew()&&this.addButton.disable()},_renderButton(){const t=this.state===l.READY_TO_ADD?"primary":"error",e=this.state===l.READY_TO_ADD?c.get("add"):c.get("remove"),s=this.state===l.READY_TO_ADD?"plus":"trash";this.addButton.setClassName(t),this.addButton.setValue(e),this.addButton.setIcon(s)},_addToQuote(){return this.cart.isNew()?this._createQuote():(e.mask(this.container),this._addItemsToQuote().finally(e.unmask.bind(e,this.container)))},_deleteFromQuote(){return e.mask(this.container),a.deleteItemsFromQuote(this.cart,this.offer.getSkuId()).finally(e.unmask.bind(e,this.container))},_addItemsToQuote(){return a.addItemsToQuote(this.cart,this.offer,this.contact,parseInt(this.quantityInput.getValue(),10))},_createQuote(){return e.mask(this.container),a.createQuote(this.cart,this.offer.getCurrency(),this.offer.getLicensorId(),this.legalEntityId).then(()=>{this.cart.dataProxy=this.cart.dataProxy.delegate}).then(this._addToQuote.bind(this))},_onButtonClicked(){return this.state===l.READY_TO_ADD?this._addToQuote():this._deleteFromQuote()},_getQuantityOfferInCart(){const t=this.cart.getItems(),e=this.offer.getSkuId();return t.reduce((t,s)=>(s.getSkuId()===e&&(t+=parseInt(s.getQuantity(),10)),t),0)},_createAddButton(){return new s({className:"primary",icon:"plus",value:c.get("add"),events:{onClick:this._onButtonClicked.bind(this)}})},_createQuantityInput:()=>new i({min:1,max:99,step:1,value:1}),_checkPrototypes(t){n.requiredOfPrototype(t.offer,o,"options.offers must be a PortfolioModel"),n.requiredOfPrototype(t.cart,r,"options.cart must be a CartModel")},destroy(){this.stopListening(),this._parent(),this.container=null}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCardFooter",["UWA/Core","UWA/Class/View","UWA/Promise","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartModelHelper","DS/MPFAddressModel/AddressCollection","DS/MPFCompanyModel/CompanyModel","DS/MPFModalConfiguratorComponent/CheckoutLauncherFactory","DS/MPFSubscriptionsComponent/closa/ClosaComponentFactory","DS/MPFSubscriptionsComponent/closa/ClosaComponent","DS/MPFServices/MarketplaceServices","DS/MPFConnector/MarketplaceConnector","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFCartModel/CartFactory","DS/MPFCompanyModel/CompanyFactory","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u,m,S,C,y,M,f)=>{"use strict";const _=Object.freeze({REFRESH_CARTS:"refreshCarts"}),P=e.extend({className:"mpf-quote-card-footer",setup(t={}){this._parent(t),this._checkPrototypes(t),this.locale=t.locale||"fr-FR",this.cart=t.cart},render(){const e=[this._getTotalPriceQuote(),this._getButton()],s=t.createElement("div",{class:"mpf-quote-card-footer-right",html:e});return this.container.setContent(s),this},_dispatchCartUpdate(t){this.dispatchEvent(_.REFRESH_CARTS,t)},_changeCartOwnerAndProceedToPayment(){return this._getConnector().then(this._initFactories.bind(this)).then(this._changeCartOwner.bind(this)).then(this._proceedToPayement.bind(this))},_getConnector:()=>m.fetchPromise({service:u.SUBSCRIPTIONS}),_initFactories(t){const e=S.getInstance(t);return s.all([e.getFactory(S.Types.CART),e.getFactory(S.Types.PERSON),e.getFactory(S.Types.COMPANY),e.getFactory(S.Types.ADDRESS)]).then(t=>{this.cartFactory=t[0],this.personFactory=t[1],this.companyFactory=t[2],this.addressFactory=t[3],this.companyFactory.addressFactory=this.addressFactory})},_changeCartOwner(){const t=this.personFactory.createModel(C.Types.ME),e=this.cartFactory.createModel(y.Types.OWNER,{id:this.cart.id});return n.mask(this.container),t.fetchPromise().then(()=>e.dataProxy.requestPromise(e.dataProxy.urlPatch(e),{method:"PATCH",data:JSON.stringify({id:t.id})})).finally(n.unmask.bind(n,this.container))},_proceedToPayement(){return this.cart.getNetAmountTotal()>0?this._confirmQuote():this._displayClosa()},_confirmQuote(){n.mask(this.container);const t=new h({serviceRequest:u.SUBSCRIPTIONS,idCart:this.cart.id});return t.whenReady().then(()=>{this.listenTo(t,h.Events.PAYMENT_COMPLETED,this._dispatchCartUpdate.bind(this)),this.listenTo(t,h.Events.PURCHASE_ORDER_UPLOADED,this._dispatchCartUpdate.bind(this)),t.show()}).finally(n.unmask.bind(n,this.container))},_displayClosa(){n.mask(this.container),new d({cart:this.cart}).openClosa().then(t=>{this.listenTo(t,p.Events.CLOSA_SAVED,this._confirmQuoteWithoutPayment.bind(this)),t.render(document.body).show()}).finally(n.unmask.bind(n,this.container))},_confirmQuoteWithoutPayment(){const t={};return n.mask(this.container),t[o.Fields.STATE]=o.States.PENDING_PAYMENT,this.cart.dataProxy=this.cart.collection.modelDataProxy,this._fetchAddresses().then(this._patchBillingAddressOnCart.bind(this)).then(this.cart.savePromise.bind(this.cart,t,{patch:!0})).finally(()=>{this._dispatchCartUpdate(),n.unmask(this.container)})},_fetchAddresses(){const t=this.companyFactory.createModel(M.Types.COMPANY);return t.id=this.cart.getCompanyID()||this.cart.getOwnerData().id,t.fetchPromise({expand:[l.Expands.ADDRESSES]})},_patchBillingAddressOnCart(e){const i=e.addresses;if(t.is(this.cart.get(o.Fields.BILL_TO))&&""!==this.cart.get(o.Fields.BILL_TO))return s.resolve();{const t=i.filter(function(t){return t.isBillTo()});return this.cart.savePromise({BillTo:t[0].id},{patch:!0})}},_getButton(){const t={},e=this.cart.getState()===o.States.SUBMITTED||this.cart.getState()===o.States.PENDING_PAYMENT||this.cart.getState()===o.States.PAYMENT_INITIATED,s=this.cart.getGlobalState()===o.GlobalStates.WAITING_PAYMENT;if(e&&s)return t.value=this.cart.getNetAmountTotal()>0?f.get("confirmOrder"):f.get("confirm"),t.icon="",t.className="primary",t.events={onClick:this._changeCartOwnerAndProceedToPayment.bind(this)},new i(t)},_getTotalPriceQuote(){return t.createElement("div",{class:"mpf-quote-price",html:[f.get("totalPriceTaxExcl"),t.createElement("span",{text:this.cart.getNetAmountTotal().toLocaleString(this.locale,{style:"currency",currency:this.cart.getCurrency()})})]})},_checkPrototypes(t){r.requiredOfPrototype(t.cart,o,"options.cart must be a CartModel")}});return P.Events=Object.freeze(_),P}),define("DS/MPFSubscriptionsComponent/roleList/RolePresentation",["UWA/Class/View","UWA/Promise","DS/MPFServices/ObjectService","DS/MPFCompassPlatformServices/CompassPlatformServices","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionsComponent/roleList/RoleCardHeader","DS/MPFSubscriptionsComponent/roleList/RoleCardBody","DS/MPFSubscriptionsComponent/roleList/RoleCardFooter","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c)=>{"use strict";const l=Object.freeze({BUY_MORE:"buyMore",MANAGE:"manage"}),h=t.extend({className:"mpf-role-presentation",setup(t={}){this._parent(t),s.requiredOfPrototype(t.product,n,"options.product must be a ProductModel"),this.product=t.product,this.product.isMarketplaceOffer()&&this.container.addClassName("mpf-marketplace-offer")},render(){const t=this.product.isMarketplaceOffer(),e=this.product.isEdu(),s=this.product.isBuyable(),i=!t&&!e&&s;return this.container.setContent([this._createHeader().render(),this._createBody().render(),i&&this._createFooter().render()]),this},destroy(){this.stopListening(),this.product=null,this._parent(),this.container=null},whenReady(){const t=e.deferred();if(this.product.has(n.Fields.PRODUCT_TRIGRAM))try{i.getPortolioRole(this.product.getProductTrigram().split("-")[0],e=>{this.portfolioRoleInfo=e,t.resolve()})}catch(e){t.reject(e)}else t.resolve();return t.promise},_onManage(){this.dispatchEvent(l.MANAGE)},_onBuyMore(){this.dispatchEvent(l.BUY_MORE)},_createHeader(){return new r({portfolioRoleInfo:this.portfolioRoleInfo})},_createBody(){const t=new o({portfolioRoleInfo:this.portfolioRoleInfo,product:this.product});return this.listenTo(t,o.Events.MANAGE,this._onManage.bind(this)),t},_createFooter(){const t=new a;return this.listenTo(t,a.Events.BUY_MORE,this._onBuyMore.bind(this)),t}});return h.Events=l,h}),define("DS/MPFSubscriptionsComponent/offerList/OfferCardComponent",["UWA/Class/View","UWA/Promise","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCompassPlatformServices/CompassPlatformServices","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFSubscriptionsComponent/offerList/OfferCardHeader","DS/MPFSubscriptionsComponent/offerList/OfferCardBody","DS/MPFSubscriptionsComponent/offerList/OfferCardFooter","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h)=>{"use strict";return t.extend({className:"mpf-offer-card",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offer=t.offer,this.cart=t.cart,this.promise=this._fetchPortfolioInfo(),this.footer=this._createFooter()},render(){return s.mask(this.container),this.promise.then(t=>{this.portfolioRoleInfo=t}).finally(()=>{this.header=this._createHeader(),this.body=this._createBody(),this.container.setContent([this.header.render(),this.body.render(),this.footer.render()]),s.unmask(this.container)}),this.container.setData(o.Fields.SKU_ID,this.offer.getSkuId()),this},_fetchPortfolioInfo(){const t=e.deferred();try{n.getPortolioRole(this.offer.getProductTrigram().split("-")[0],t.resolve)}catch(e){t.reject(e)}return t.promise},_createHeader(){return new a({portfolioRoleInfo:this.portfolioRoleInfo})},_createBody(){return new c({portfolioRoleInfo:this.portfolioRoleInfo,offer:this.offer})},_createFooter(){return new l({offer:this.offer,cart:this.cart,legalEntityId:this.legalEntityId})},_checkPrototypes(t){i.requiredOfPrototype(t.offer,o,"options.offer must be a PortfolioModel"),i.requiredOfPrototype(t.cart,r,"options.cart must be a CartModel")},destroy(){this.cart=null,this.offer=null,this.stopListening(),this._parent()}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandSort",["UWA/Class/View","DS/MPFCartModel/CartSorts","DS/MPFSort/SortOrder","DS/MPFSort/SortDirection","DS/MPFSortSelector/SortSelector","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o)=>{"use strict";return t.extend({className:"mpf-quote-list-command-sort",setup(t={}){this.sortSelector=this._createSortSelector(),this.listenTo(this.sortSelector,n.Events.SORT,this._onSortSelected.bind(this))},render(){return this.container.setContent(this.sortSelector.render()),this},_createSortSelector(){return new n({entries:this._createSortOptions()})},_onSortSelected(t){let s;s=t.direction===i.DESCENDING?e.desc(t.sort):t.sort,this.dispatchEvent(r.SORT,{sort:s})},_createSortOptions:()=>[{label:o.get("modificationDate"),name:e.MODIFICATION_DATE,order:s.NUMERICAL,selected:i.DESCENDING},{label:o.get("creationDate"),name:e.CREATION_DATE,order:s.NUMERICAL}],destroy(){this.stopListening(this.sortSelector),this.sortSelector.destroy(),this.sortSelector=null,this._parent(),this.container=null}})}),define("DS/MPFSubscriptionsComponent/offerList/OfferCardListComponent",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFSubscriptionsComponent/offerList/OfferCardComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o)=>{"use strict";return t.extend({className:"mpf-offer-card-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offers=t.offers,this.cart=t.cart,this.cards=this._createCards()},render(){const t=this.cards.map(t=>t.render());return this.container.setContent(t),this},filterOnPeriodicity(t){const e=t===i.RevTypes.YSC,s=t===i.RevTypes.QRC+","+i.RevTypes.QSC||t===i.RevTypes.QRC||t===i.RevTypes.QSC;this.cards.forEach(t=>{const n=t.offer.getRevType();e&&n===i.RevTypes.YSC?t.show():!s||n!==i.RevTypes.QSC&&n!==i.RevTypes.QRC?t.hide():t.show()})},_createCards(){return this.offers.map(t=>(t.onlineInstanceId=this.offers.onlineInstanceId,new r({legalEntityId:this.legalEntityId,offer:t,cart:this.cart})))},_checkPrototypes(t){e.requiredOfPrototype(t.offers,n,"options.offers must be an PortfolioCollection"),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel")},destroy(){this.cart=null,this.offers=null,this.stopListening(),this._parent()}})}),define("DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTile",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCollection","DS/MPFCartModel/CartFilters","DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTileElement","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o)=>{"use strict";return t.extend({className:"mpf-status-selector-tile",setup(t={}){e.requiredOfPrototype(t.carts,s,"options.carts must be a CartCollection"),this.carts=t.carts,this.pendingSelector=this._createPendingSelector(),this.deliveredSelector=this._createDeliveredSelector(),this.canceledSelector=this._createCanceledSelector(),this.allSelector=this._createAllSelector(),this.listenTo(this.pendingSelector,n.Events.SELECTED,this._onPendingSelected.bind(this)),this.listenTo(this.deliveredSelector,n.Events.SELECTED,this._onDeliveredSelected.bind(this)),this.listenTo(this.canceledSelector,n.Events.SELECTED,this._onCanceledSelected.bind(this)),this.listenTo(this.allSelector,n.Events.SELECTED,this._onAllSelected.bind(this)),this.listenTo(this.carts,"onReset",this._updateSelectorCounts.bind(this))},render(){return this.container.setContent([this.pendingSelector.render(),this.deliveredSelector.render(),this.canceledSelector.render(),this.allSelector.render()]),this},destroy(){this.stopListening(this.pendingSelector),this.stopListening(this.deliveredSelector),this.stopListening(this.canceledSelector),this.stopListening(this.allSelector),this.stopListening(this.carts),this._parent()},_updateSelectorCounts(){this.pendingSelector.updateCount(this.carts.pending),this.deliveredSelector.updateCount(this.carts.delivered),this.canceledSelector.updateCount(this.carts.cancelled),this.allSelector.updateCount(this.carts.all),this.render()},_createPendingSelector(){return new n({title:o.get("pending"),isSelected:!0,cssClass:"pending",count:this.carts.pending})},_createDeliveredSelector(){return new n({title:o.get("delivered"),isSelected:!1,cssClass:"delivered",count:this.carts.delivered})},_createCanceledSelector(){return new n({title:o.get("cancelled"),isSelected:!1,cssClass:"canceled",count:this.carts.cancelled})},_createAllSelector(){return new n({title:o.get("all"),isSelected:!1,cssClass:"all",count:this.carts.all})},_onPendingSelected(){const t={};this.deliveredSelector.setIsSelected(!1),this.canceledSelector.setIsSelected(!1),this.allSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_PENDING_FILTER,this.dispatchEvent(r.FILTER_BY_STATE,t)},_onDeliveredSelected(){const t={};this.pendingSelector.setIsSelected(!1),this.canceledSelector.setIsSelected(!1),this.allSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_DELIVERED_FILTER,this.dispatchEvent(r.FILTER_BY_STATE,t)},_onCanceledSelected(){const t={};this.pendingSelector.setIsSelected(!1),this.deliveredSelector.setIsSelected(!1),this.allSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_CANCELED_FILTER,this.dispatchEvent(r.FILTER_BY_STATE,t)},_onAllSelected(){const t={};this.pendingSelector.setIsSelected(!1),this.deliveredSelector.setIsSelected(!1),this.canceledSelector.setIsSelected(!1),t[i.FILTER_BY_STATE]=i.STATE_ALL_FILTER,this.dispatchEvent(r.FILTER_BY_STATE,t)}})}),define("DS/MPFSubscriptionsComponent/offerList/OfferListComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFactory","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFSubscriptionsComponent/offerList/OfferFilters","DS/MPFSubscriptionsComponent/offerList/OfferCardListComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l)=>{"use strict";const h=Object.freeze({GO_TO_MY_ORDERS:"goToMyOrders"}),d=e.extend({className:"mpf-offer-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offers=t.offers,this.cart=t.cart,this.paymentCompleted=!1,this.offerFilters=this._createOfferFilters(),this.offerCardsList=this._createOfferCardsList()},render(){const e=t.createElement("div",{class:"mpf-subs-title",html:l.get("moreRoles")});this.filterOnPeriodicity(this.offerFilters.getPeriodicityValue());const s=t.createElement("div",{class:"mpf-portfolio",html:0===this.offers.size()?this._getNoOfferMessage():this.offerCardsList.render()}),i=0===this.offers.size()?[e,s]:[e,this.offerFilters.render(),s];return this.container.setContent(i),this},filterOnPeriodicity(t){return this.offerCardsList.filterOnPeriodicity(t)},setPeriodicityFilterValue(t){return this.offerFilters.setPeriodicityFilterValue(t)},disablePeriodicityFilter(){return this.offerFilters.disablePeriodicityFilter()},enablePeriodicityFilter(){return this.offerFilters.enablePeriodicityFilter()},_getNoOfferMessage:()=>t.createElement("div",{class:"mpf-message",html:[t.createElement("div",{class:"fonticon fonticon-3x fonticon-search"}),t.createElement("h4",{text:l.get("portfolioEmpty")}),t.createElement("div",{text:l.get("noOffersSearch")})]}),_createOfferFilters(){const t=new a;return this.listenTo(t,a.Events.NEW_FILTER_VALUE,this._newFilterSelected.bind(this)),t},_newFilterSelected(t){t.filterType===a.FilterTypes.PERIODICITY&&this.offerCardsList.filterOnPeriodicity(t.value)},_createOfferCardsList(e){return new c({offers:t.is(e)?e:this.offers,cart:this.cart,legalEntityId:this.legalEntityId})},_onPaymentCompleted(){this.paymentCompleted=!0},_onPaymentModalClosed(){!0===this.paymentCompleted&&this.dispatchEvent(h.GO_TO_MY_ORDERS)},_checkPrototypes(t){i.requiredOfPrototype(t.cart,n,"options.cart must be a CartModel"),i.requiredOfPrototype(t.offers,o,"options.offers must be an PortfolioCollection")},destroy(){this.stopListening(),this._parent(),this.container=null}});return d.Events=h,d}),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCardEntry",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/WebappsUtils/WebappsUtils","DS/MPFServices/ObjectService","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFPaymentCardTokenModel/PaymentCardTokenModel","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentCardForm","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p)=>{"use strict";const u=Object.freeze({CARD_SELECTED:"cardSelected",PAYMENT_INFO_UPDATED:"paymentInfoUpdated"}),m=Object.freeze({STANDARD_VIEW:"standardView",MSG_DISPLAYED:"msgDisplayed",CARD_FORM_DISPLAYED:"cardFormDisplayed"}),S=e.extend({className:"mpf-card-entry",setup(t={}){this._checkPrototypes(t),this.card=t.card,this.psp=t.psp,this.onlineInstanceId=t.onlineInstanceId,this.stateMachine=this._createStateMachine(),this.toggle=this._createToggleEntry(),this.typeEntry=this._createTypeEntry(),this.numberEntry=this._createNumberEntry(),this.expirationEntry=this._createExpirationDateEntry(),this.ownerEntry=this._createOwnerEntry(),this.selectedCardEntry=this._createSelectedEntry(),this.optionsEntry=this._createOptionsEntry(),this.cardForm=this._createCardForm()},render(){const e=[],s=t.createElement("div",{class:"mpf-card-entry-content",html:[this.toggle,this.typeEntry,this.numberEntry,this.expirationEntry,this.ownerEntry,this.selectedCardEntry,this.optionsEntry]});return e.push(s),this.stateMachine.getState()===m.CARD_FORM_DISPLAYED?(e.push(this.cardForm.render()),this.cardForm.show()):this.cardForm.hide(),this.stateMachine.getState()===m.MSG_DISPLAYED&&(this.importantMessage=this._createImportantMessage(),e.push(this.importantMessage)),this.container.setContent(e),this},uncheck(){this.toggle.uncheck(),this.toggle.setDisabled(this.card.isExpired()),this.selectedCardEntry.setText(this.card.isExpired()?p.get("expired"):""),this.card.setAsDefaultPaymentMethod(!1)},_deleteCard(){return n.mask(this.container),this.card.setParentResourceId(this.onlineInstanceId),this.card.destroyPromise().then(this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)).catch(this._displayErrorMessage.bind(this,p.get("cardNotDeleted"))).finally(n.unmask.bind(n,this.container))},_displayErrorMessage(t){new r({className:"error",messageClassName:"error",messages:t,closable:!0,visible:!0,closeOnClick:!0}).inject(this.container,"top")},_setCardAsDefaultPaymentMethod(){const t={};return t[l.Fields.IS_DEFAULT_PAYMENT_METHOD]=!0,this.card.setParentResourceId(this.onlineInstanceId),this.card.savePromise(t,{patch:!0}).then(()=>{this.selectedCardEntry.setText(this.card.isExpired()?p.get("expired"):p.get("defaultPaymentMethod")),this.dispatchEvent(u.CARD_SELECTED,this)}).catch(this.uncheck.bind(this))},_createCardForm(){const t=new d({title:p.get("updateCard"),card:this.card,psp:this.psp,onlineInstanceId:this.onlineInstanceId});return this.listenTo(t,d.Events.PAYMENT_INFO_UPDATED,this.dispatchEvent.bind(this,u.PAYMENT_INFO_UPDATED)),this.listenTo(t,d.Events.CANCEL,()=>{this.stateMachine.changeState(m.STANDARD_VIEW),this.render()}),t},_createImportantMessage(){const e=new s({className:"primary",value:p.get("gotIt"),events:{onClick:()=>{this.card.isDefaultPaymentMethod()?(this.importantMessage.destroy(),this.stateMachine.changeState(m.STANDARD_VIEW)):this._deleteCard()}}}),i=new s({value:p.get("cancel"),events:{onClick:()=>{this.importantMessage.destroy(),this.stateMachine.changeState(m.STANDARD_VIEW)}}}),n=t.createElement("div",{class:"mpf-card-entry-msg-header",html:[{tag:"div",text:p.get("importantMessage")},{tag:"div",html:this.card.isDefaultPaymentMethod()?e:[e,i]}]}),r=t.createElement("div",{class:"mpf-card-entry-msg-content",html:[{tag:"div",class:"fonticon fonticon-alert"},{tag:"div",text:this.card.isDefaultPaymentMethod()?p.get("addPaymentMethod"):p.get("warningCardDeleted")}]});return t.createElement("div",{class:"mpf-card-entry-msg",html:[n,r]})},_createToggleEntry(){return new i({type:"radio",value:" ",checked:this.card.isDefaultPaymentMethod(),className:"primary",id:this.card.getCardId(),disabled:this.card.isExpired()&&!this.card.isDefaultPaymentMethod(),events:{onChange:this._setCardAsDefaultPaymentMethod.bind(this)}})},_createOptionsEntry(){const e=new s({className:"link",value:p.get("delete"),events:{onClick:()=>{this.stateMachine.changeState(m.MSG_DISPLAYED),this.render()}}}),i=new s({className:"link",value:p.get("update"),events:{onClick:()=>{this.stateMachine.changeState(m.CARD_FORM_DISPLAYED),this.render()}}});return t.createElement("div",{class:"mpf-card-options",html:[e,i]})},_createSelectedEntry(){const e=this.card.isExpired()?p.get("expired"):this.card.isDefaultPaymentMethod()?p.get("defaultPaymentMethod"):"";return t.createElement("div",{class:"mpf-card-selected",text:e})},_createOwnerEntry(){return t.createElement("div",{class:"mpf-card-owner",text:this.card.getCardName()})},_createExpirationDateEntry(){return t.createElement("div",{class:"mpf-card-expiration",text:p.get("expire")+" "+this.card.getCardExpMonth()+"/"+this.card.getCardExpYear()})},_createNumberEntry(){return t.createElement("div",{class:"mpf-card-number",text:"****-"+this.card.getCardNumber()})},_createTypeEntry(){const e=this.card.getCardType(),s=o.getWebappsAssetUrl("MPFSubscriptionsComponent","graphics/pictures/")+e.toLowerCase()+".png",i=t.createElement("img",{src:s});return t.createElement("div",{class:"mpf-card-type",html:[i,e]})},_createStateMachine:()=>new c({state:m.STANDARD_VIEW,states:[m.STANDARD_VIEW,m.MSG_DISPLAYED,m.CARD_FORM_DISPLAYED],transitions:[{from:m.STANDARD_VIEW,to:m.MSG_DISPLAYED},{from:m.MSG_DISPLAYED,to:m.STANDARD_VIEW},{from:m.STANDARD_VIEW,to:m.CARD_FORM_DISPLAYED},{from:m.CARD_FORM_DISPLAYED,to:m.STANDARD_VIEW},{from:m.MSG_DISPLAYED,to:m.CARD_FORM_DISPLAYED},{from:m.CARD_FORM_DISPLAYED,to:m.MSG_DISPLAYED}]}),_checkPrototypes(t){a.requiredOfPrototype(t.card,l,"options.card must be a PaymentCardTokenModel"),a.requiredOfPrototype(t.psp,h,"options.psp must be a PspModel")},destroy(){this.card=null,this._parent()}});return S.Events=u,S}),define("DS/MPFSubscriptionsComponent/roleList/ManageSubscriptionsComponent",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFSubscriptionsComponent/roleList/SchemeActiveSubscriptionList","DS/MPFSubscriptionsComponent/roleList/StopSubscriptionsComponent"],(t,e,s,i,n,r,o)=>{"use strict";const a=Object.freeze({LIST:"subscriptionList",STOP:"stopSubscription"}),c=Object.freeze({ON_BACK:"onBack",ON_SUBSCRIPTION_STOPPED:"onSubscriptionStopped"}),l=e.extend({className:"mpf-manage-subscriptions-component",setup(t={}){i.requiredOfPrototype(t.product,n,"options.product must be a ProductModel"),this.product=t.product,this.state=t.state||a.LIST,this.subscriptionLists=[]},render(){const t=[{class:"mpf-manage-header",html:[{class:"fonticon fonticon-chevron-left"},this.product.getDisplayName()],events:{click:this._onBack.bind(this)}}];return this.state===a.STOP&&this.subscription?(this._destroyStopSubscriptionComponent(),this.stopSubscriptionsComponent=this._createStopSubscriptionsComponent(),t.push(this.stopSubscriptionsComponent.render())):(this._destroyActiveSubscriptionLists(),this.subscriptionLists=this._createActiveSubscriptionLists(),t.push({tag:"div",class:"mpf-list-container",html:this.subscriptionLists.map(t=>t.render())})),this.container.setContent(t),this},destroy(){this.stopListening(),this._destroyStopSubscriptionComponent(),this._destroyActiveSubscriptionLists(),this.product=null,this.subscription=null,this._parent(),this.container=null},_onBack(){this.state===a.LIST?this.dispatchEvent(c.ON_BACK):this._showActiveSubscriptionList()},_createActiveSubscriptionLists(){return this.product.getAvailableLicensingSchemes().filter(t=>this.product.hasSubscriptionsForLicensingScheme(t)).map(t=>{const e=new r({product:this.product,licensingScheme:t});return this.listenTo(e,r.Events.STOP,this._showStopSubscriptionComponent.bind(this)),e})},_createStopSubscriptionsComponent(){const t=new o({subscription:this.subscription});return this.listenTo(t,o.Events.CANCEL,this._showActiveSubscriptionList.bind(this)),this.listenTo(t,o.Events.SUBS_STOPPED,this._showActiveSubscriptionList.bind(this)),t},_destroyStopSubscriptionComponent(){this.stopSubscriptionComponent&&(this.stopListening(this.stopSubscriptionComponent),this.stopSubscriptionComponent.destroy(),this.stopSubscriptionComponent=null)},_destroyActiveSubscriptionLists(){this.subscriptionLists.forEach(t=>{this.stopListening(t),t.destroy()})},_showActiveSubscriptionList(){this.state=a.LIST,this.subscription=null,this.render()},_showStopSubscriptionComponent(t){this.state=a.STOP,this.subscription=t,this.subscription.onlineInstanceId=this.product.onlineInstanceId,this.render()}});return l.Events=c,l}),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCards",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCardEntry","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentCardForm","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a)=>{"use strict";const c=Object.freeze({CARD_SELECTED:"cardSelected",PAYMENT_INFO_UPDATED:"paymentInfoUpdated"}),l=e.extend({className:"mpf-payment-methods-cards",setup(t={}){s.requiredOfPrototype(t.psp,n,"options.psp must be a PspModel"),s.requiredOfPrototype(t.paymentMethodFactory,i,"options.paymentMethodFactory must be a PaymentMethodFactory"),this.onlineInstanceId=t.onlineInstanceId,this.paymentMethodFactory=t.paymentMethodFactory,this.paymentCardTokens=t.paymentCardTokens||[],this.psp=t.psp,this.paymentCardEntries=this._createPaymentCardEntries(),this.newCardButton=this._createNewCardButton(),this.newCardFormComponent=this._createNewCardFormComponent()},render(){const e=this.paymentCardEntries.map(t=>t.render());return e.unshift(t.createElement("div",{class:"mpf-payment-methods-cards-title mpf-title",text:a.get("yourCreditCards")})),e.push(this.newCardButton),e.push(this.newCardFormComponent.render()),this.container.setContent(e),this},uncheckDefaultCard(){this.paymentCardEntries.forEach(t=>t.uncheck())},_updateDefaultCard(t){this.paymentCardEntries.forEach(e=>{if(e!==t)return e.uncheck()}),this.dispatchEvent(c.CARD_SELECTED)},_createNewCardButton(){return t.createElement("button",{class:"btn btn-primary",text:a.get("addCard"),events:{click:this._onAddCard.bind(this)}})},_onAddCard(){this.newCardFormComponent.show(),this.newCardButton.hide()},_createNewCardFormComponent(){const t=this.paymentMethodFactory.createModel(i.Types.ME_ONLINE_INSTANCE),e=new o({title:a.get("addCard"),onlineInstanceId:this.onlineInstanceId,card:t,psp:this.psp});return e.hide(),this.listenTo(e,o.Events.PAYMENT_INFO_UPDATED,this.dispatchEvent.bind(this,c.PAYMENT_INFO_UPDATED)),this.listenTo(e,o.Events.CANCEL,this.newCardButton.show.bind(this.newCardButton)),e},destroy(){this.stopListening(this.newCardFormComponent),this.newCardFormComponent.destroy(),this.newCardFormComponent=null,this.paymentCardEntries.forEach(t=>t.destroy()),this.paymentCardEntries=null,this.paymentCardTokens=null,this._parent(),this.container=null},_createPaymentCardEntries(){return this.paymentCardTokens.map(t=>{const e=new r({onlineInstanceId:this.onlineInstanceId,psp:this.psp,card:t});return this.listenTo(e,r.Events.CARD_SELECTED,this._updateDefaultCard.bind(this)),this.listenTo(e,r.Events.PAYMENT_INFO_UPDATED,this.dispatchEvent.bind(this,c.PAYMENT_INFO_UPDATED)),e})}});return l.Events=c,l}),define("DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsBankTransfer",["UWA/Class/View","UWA/Core","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsVirtualIbanEntry","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c)=>{"use strict";const l=Object.freeze({BANK_TRANSFER_SELECTED:"bankTransferSelected"}),h=Object.freeze({MSG_DISPLAYED:"msgDisplayed",MSG_NOT_DISPLAYED:"msgNotDisplayed"}),d=t.extend({className:"mpf-payment-methods-bank-transfer",setup(t={}){this._checkPrototypes(t),this.onlineInstanceId=t.onlineInstanceId,this.paymentMethodModel=t.paymentMethodModel,this.virtualIbans=t.virtualIbans,this.stateMachine=this._createStateMachine(),this.toggle=this._createToggleEntry(),this.selectedEntry=this._createSelectedEntry(),this.virtualIbanCards=this._createVirtualIbanCards(),this.displayButton=this._createDisplayButton(),this.bankAccount=this._getBankAccount()},render(){const t=e.createElement("div",{class:"mpf-payment-methods-bt-title mpf-title",text:c.get("deferredPaymentOnInvoice")}),s=e.createElement("div",{class:"mpf-bt-entry-right",html:[this.selectedEntry,this.displayButton]}),i=[t,e.createElement("div",{class:"mpf-bt-entry",html:[this.toggle,s]})];return this.stateMachine.getState()===h.MSG_DISPLAYED&&i.push(this.bankAccount),this.container.setContent(i),this},uncheck(){return this.selectedEntry.setText(""),this.toggle.uncheck()},_setBankTransferAsDefaultPaymentMethod(){const t={};return t[o.Fields.PAYMENT_METHOD_TYPE]=o.PaymentMethodTypes.DBT,this.paymentMethodModel.setParentResourceId(this.onlineInstanceId),this.paymentMethodModel.savePromise(t,{patch:!0}).then(()=>{this.selectedEntry.setText(c.get("defaultPaymentMethod")),this.dispatchEvent(l.BANK_TRANSFER_SELECTED,this)}).catch(this.uncheck.bind(this))},_getBankAccount(){const t=new i({className:"primary",value:c.get("gotIt"),events:{onClick:()=>{this.stateMachine.changeState(h.MSG_NOT_DISPLAYED),this.render()}}}),s=e.createElement("div",{class:"mpf-bt-entry-msg-header",html:[{tag:"div",text:c.get("importantMessage")},t]}),n=e.createElement("div",{class:"mpf-virtual-ibans",html:this.virtualIbanCards.map(t=>t.render())}),r=e.createElement("div",{class:"mpf-bt-entry-msg-content",html:[{tag:"div",class:"fonticon fonticon-alert"},{tag:"div",text:c.get("selectDeferredPayment")}]});return e.createElement("div",{class:"mpf-bt-entry-msg",html:[s,n,r]})},_createVirtualIbanCards(){return this.virtualIbans.map(t=>new a({virtualIban:t}))},_createSelectedEntry(){const t=this.paymentMethodModel.isDefaultPaymentMethod()?c.get("defaultPaymentMethod"):"";return e.createElement("div",{class:"mpf-bt-selected",text:t})},_createDisplayButton(){return new i({className:"link",value:c.get("displayBankAccount"),events:{onClick:()=>{this.stateMachine.changeState(h.MSG_DISPLAYED),this.render()}}})},_createToggleEntry(){return new s({type:"radio",value:c.get("deferredPayment"),checked:this.paymentMethodModel.isDefaultPaymentMethod(),className:"primary",id:"bankTransfer",events:{onChange:this._setBankTransferAsDefaultPaymentMethod.bind(this)}})},_createStateMachine:()=>new n({state:h.MSG_NOT_DISPLAYED,states:[h.MSG_DISPLAYED,h.MSG_NOT_DISPLAYED],transitions:[{from:h.MSG_NOT_DISPLAYED,to:h.MSG_DISPLAYED},{from:h.MSG_DISPLAYED,to:h.MSG_NOT_DISPLAYED}]}),_checkPrototypes(t){r.requiredOfPrototype(t.paymentMethodModel,o,"options.paymentMethodModel must be a PaymentMethodModel")},destroy(){this._parent(),this.container=null}});return d.Events=l,d}),define("DS/MPFSubscriptionsComponent/roleList/BuyMoreFooter",["UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Number","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFCartModel/CartModel","DS/MPFSubscriptionModel/SubscriptionModel","DS/MPFSubscriptionsComponent/CartHelper","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],function(t,e,s,i,n,r,o,a,c,l){"use strict";var h={READY_TO_ADD:"readyToAdd",ITEM_ADDED:"itemsAdded"};return t.extend({className:"mpf-buy-more-footer",setup:function(t){t||(t={}),this._parent(t),this._checkPrototypes(t),this.product=t.product,this.subscription=t.subscription,this.cart=t.cart,this.legalEntityId=t.legalEntityId,this.state=this._getQuantityItemInCart()>0?h.ITEM_ADDED:h.READY_TO_ADD,this.quantityInput=this._createQuantityInput(),this.addButton=this._createAddButton(),this.listenTo(this.cart,"onChange:"+o.Fields.CART_ITEMS,this._updateInfoDisplayed.bind(this)),this.listenTo(this.cart,"onRequest",this._avoidMultiCartCreation.bind(this))},render:function(){return this.container.setContent([this.quantityInput,this.addButton]),this},_updateInfoDisplayed:function(){var t;t=this._getQuantityItemInCart(),this.state=t>0?h.ITEM_ADDED:h.READY_TO_ADD,this.addButton.enable(),this._renderButton(),this.quantityInput.enable(),this.quantityInput.setValue(t>0?t:1),this.quantityInput.setDisabled(t>0)},_avoidMultiCartCreation:function(){this.cart.isNew()&&this.addButton.disable()},_renderButton:function(){var t=this.state===h.READY_TO_ADD?"primary":"error",e=this.state===h.READY_TO_ADD?l.get("add"):l.get("remove"),s=this.state===h.READY_TO_ADD?"plus":"trash";this.addButton.setClassName(t),this.addButton.setValue(e),this.addButton.setIcon(s)},_getQuantityItemInCart:function(){var t=this.cart.getItems(),e=this.subscription.getOfferId();return t.reduce(function(t,s){return s.getSkuId()===e&&(t+=parseInt(s.getQuantity(),10)),t},0)},_onButtonClicked:function(){return this.state===h.READY_TO_ADD?this._addToQuote():this._deleteFromQuote()},_addToQuote:function(){return this.cart.isNew()?this._createQuote():(e.mask(this.container),this._addItemsToQuote().finally(e.unmask.bind(e,this.container)))},_deleteFromQuote:function(){return e.mask(this.container),c.deleteItemsFromQuote(this.cart,this.subscription.getOfferId()).finally(e.unmask.bind(e,this.container))},_addItemsToQuote:function(){return c.addSubscriptionsItemsToQuote(this.cart,this.product,this.subscription,parseInt(this.quantityInput.getValue(),10))},_createQuote:function(){var t=this;return e.mask(this.container),c.createQuote(this.cart,this.subscription.getCurrency(),this.product.getLicensorId(),this.legalEntityId).then(function(){t.cart.dataProxy=t.cart.dataProxy.delegate}).then(this._addToQuote.bind(this))},_createAddButton:function(){return new s({className:"primary",icon:"plus",value:l.get("add"),events:{onClick:this._onButtonClicked.bind(this)}})},_createQuantityInput:function(){return new i({min:1,max:99,step:1,value:1})},_checkPrototypes:function(t){n.requiredOfPrototype(t.product,r,"options.product must be a ProductModel"),n.requiredOfPrototype(t.subscription,a,"options.subscription must be a SubscriptionModel"),n.requiredOfPrototype(t.cart,o,"options.cart must be a CartModel")}})}),define("DS/MPFSubscriptionsComponent/PaymentMethodsTab",["UWA/Class/View","UWA/Core","DS/UIKIT/Scroller","DS/UIKIT/Mask","DS/MPFView/EmptyView","DS/MPFServices/ObjectService","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFPaymentMethodModel/PaymentMethodCollection","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCustomerInformation","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsCards","DS/MPFSubscriptionsComponent/paymentMethodsList/PaymentMethodsBankTransfer","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p)=>{"use strict";return t.extend({className:"mpf-payments-tab",setup(t={}){this._checkPrototypes(t),this.paymentMethodFactory=t.paymentMethodFactory,this.buyer=t.buyer,this.onlineInstanceId=t.onlineInstanceId,this.paymentMethods=t.paymentMethods,this.psp=t.psp,this.companyInformation=t.companyInformation,this.virtualIbans=t.virtualIbans,this.choosePaymentMethodTitle=this._createChoosePaymentMethodTitle(),this.customerInformations=this._createCustomerInformation(),this.paymentCardList=this._createPaymentCardList(),this.bankTransferList=this._createBankTransferList(),this.renewalNoticeMessage=this._createRenewalNoticeMessage()},render(){const t=e.createElement("div",{class:"mpf-payments-tab-content",html:[this.customerInformations.render(),this.choosePaymentMethodTitle,this.paymentCardList.render(),this.bankTransferList.render(),this.renewalNoticeMessage]});this.container.setContent(t);try{new s({element:t}).inject(this.container)}catch(t){console.warn(t)}return this},destroy(){this.customerInformations.destroy(),this.paymentCardList.destroy(),this.bankTransferList.destroy(),this._parent(),this.container=null},_refresh(){i.mask(this.container),setTimeout(()=>this.paymentMethods.fetchPromise().then(()=>{this.paymentCardList=this._createPaymentCardList(),this.bankTransferList=this._createBankTransferList(),this.render()}).finally(i.unmask.bind(i,this.container)),2e3)},_createChoosePaymentMethodTitle:()=>e.createElement("h3",{class:"mpf-title",text:p.get("chooseYourPaymentMethod")}),_createRenewalNoticeMessage(){const t=e.createElement("div",{class:"mpf-notice-renewal-title",text:p.get("defaultPaymentAndRenewal")}),s=e.createElement("div",{class:"mpf-notice-renewal-content",html:[{tag:"p",text:p.get("defaultPaymentAndRenewalContentPart1")},{tag:"p",text:p.get("defaultPaymentAndRenewalContentPart2")}]});return e.createElement("div",{class:"mpf-notice-renewal",html:[t,s]})},_createCustomerInformation(){return new l({buyer:this.buyer,onlineInstanceId:this.onlineInstanceId,companyInformation:this.companyInformation})},_createPaymentCardList(){const t=new h({onlineInstanceId:this.onlineInstanceId,paymentMethodFactory:this.paymentMethodFactory,paymentCardTokens:this.paymentMethods.getPaymentCardTokenModels(),psp:this.psp});return this.listenTo(t,h.Events.CARD_SELECTED,()=>{this.bankTransferList.uncheck()}),this.listenTo(t,h.Events.PAYMENT_INFO_UPDATED,this._refresh.bind(this)),t},_createBankTransferList(){const t=this.paymentMethods.getDbtPaymentMethodModel();if(e.is(t)){const t=new d({onlineInstanceId:this.onlineInstanceId,paymentMethodModel:this.paymentMethods.getDbtPaymentMethodModel(),virtualIbans:this.virtualIbans});return this.listenTo(t,d.Events.BANK_TRANSFER_SELECTED,this.paymentCardList.uncheckDefaultCard.bind(this.paymentCardList)),t}return n.getInstance()},_checkPrototypes(t){r.requiredOfPrototype(t.paymentMethodFactory,o,"options.paymentMethodFactory must be a PaymentMethodFactory"),r.requiredOfPrototype(t.paymentMethods,a,"options.paymentMethods must be a PaymentMethodCollection"),r.requiredOfPrototype(t.psp,c,"options.psp must be a PspModel")}})}),define("DS/MPFSubscriptionsComponent/roleList/BuyMoreComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFProductModel/ProductModel","DS/MPFCartModel/CartModel","DS/MPFSubscriptionsComponent/roleList/BuyMoreFooter","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o)=>{"use strict";const a={ON_BACK:"onBack"},c=e.extend({className:"mpf-buy-more",setup(t){t||(t={}),this._parent(t),this._checkPrototypes(t),this.product=t.product,this.cart=t.cart,this.legalEntityId=t.legalEntityId,this.header=this._createrHeader(),this.yearlyContainer=this._createYearlyContainer(),this.quarterlyContainer=this._createQuarterlyContainer()},render(){return this.container.setContent([this.header,this.yearlyContainer,this.quarterlyContainer]),this},disablePeriodicity(t){const e=t===i.RevTypes.YSC,s=t===i.RevTypes.QRC||t===i.RevTypes.QSC;e?this.quarterlyContainer&&this.quarterlyContainer.hide():s&&this.yearlyContainer&&this.yearlyContainer.hide()},enableAllPeriodicities(){this.quarterlyContainer&&this.quarterlyContainer.show(),this.yearlyContainer&&this.yearlyContainer.show()},_createFooter(t){return new r({product:this.product,subscription:t,cart:this.cart,legalEntityId:this.legalEntityId})},_createYearlyContainer(){if(this.product.hasYearlySubscription()){const e=this.product.getYearlySubscription(),s=t.createElement("div",{class:"mpf-buy-more-details-title",text:o.get("yearlySubscriptions").toUpperCase()});return t.createElement("div",{class:"mpf-buy-more-details",html:[s,this._createPriceContainer(e),this._createFooter(e).render()]})}},_createQuarterlyContainer(){if(this.product.hasQuarterlySubscription()){const e=this.product.getQuarterlySubscription(),s=t.createElement("div",{class:"mpf-buy-more-details-title",text:o.get("quarterlySubscriptions").toUpperCase()});return t.createElement("div",{class:"mpf-buy-more-details",html:[s,this._createPriceContainer(e),this._createFooter(e).render()]})}},_createPriceContainer(e){const s=e.getMonthlyPrice(),i=parseFloat(s).toLocaleString("fr-FR",{style:"currency",currency:e.getCurrency()})+" / user / month";return t.createElement("div",{class:"mpf-buy-more-price",text:i})},_createrHeader(){var e=this;return t.createElement("div",{class:"mpf-buy-more-header",html:[{class:"fonticon fonticon-chevron-left"},this.product.getDisplayName()],events:{click:function(){e.dispatchEvent(a.ON_BACK)}}})},_checkPrototypes(t){s.requiredOfPrototype(t.product,i,"options.product must be a ProductModel"),s.requiredOfPrototype(t.cart,n,"options.cart must be a CartModel")}});return c.Events=Object.freeze(a),c}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCardBody",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFSubscriptionsComponent/quoteList/ProductListTile","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n)=>{"use strict";return t.extend({className:"mpf-quote-card-body",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.productDetailsTile=this._createProductListTile()},render(){return this.container.setContent(this.productDetailsTile.render()),this},_createProductListTile(){return new i({cart:this.cart})},_checkPrototypes(t){e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel")}})}),define("DS/MPFSubscriptionsComponent/roleList/RoleCardComponent",["UWA/Class/View","DS/UIKIT/Mask","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFProductModel/ProductModel","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFSubscriptionsComponent/roleList/RolePresentation","DS/MPFSubscriptionsComponent/roleList/BuyMoreComponent","DS/MPFSubscriptionsComponent/roleList/ManageSubscriptionsComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l)=>{"use strict";const h=Object.freeze({ROLE_PRESENTATION:"rolePresentation",ON_MANAGE_SUBSCRIPTIONS:"onManageSubscriptions",ON_ADD_SUBSCRIPTIONS:"onAddSubscriptions"});return t.extend({className:"mpf-role-card",setup(t={}){this._parent(t),this._checkPrototypes(t),this.product=t.product,this.cart=t.cart,this.legalEntityId=t.legalEntityId,this.stateMachine=this._createStateMachine(),this.rolePresentationComponent=this._createRolePresentationComponent(),this.buyMoreComponent=!this.product.isMarketplaceOffer()&&this.product.isBuyable()&&this._createBuyMoreComponent(),this.manageComponent=this.product.isRenewable()&&this._createManageComponent()},render(){return this.stateMachine.getState()===h.ROLE_PRESENTATION?(e.mask(this.container),this.rolePresentationComponent.whenReady().finally(()=>{this.container.setContent(this.rolePresentationComponent.render()),e.unmask(this.container)})):this.stateMachine.getState()===h.ON_ADD_SUBSCRIPTIONS?this.container.setContent(this.buyMoreComponent.render()):this.stateMachine.getState()===h.ON_MANAGE_SUBSCRIPTIONS&&this.container.setContent(this.manageComponent.render()),this},disableBuyMorePeriodicity(t){this.buyMoreComponent&&this.buyMoreComponent.disablePeriodicity(t)},enableBuyMoreAllPeriodicities(){this.buyMoreComponent&&this.buyMoreComponent.enableAllPeriodicities()},destroy(){this.stopListening(),this.rolePresentationComponent.destroy(),this.buyMoreComponent&&this.buyMoreComponent.destroy(),this.manageComponent&&this.manageComponent.destroy(),this.rolePresentationComponent=null,this.buyMoreComponent=null,this.manageComponent=null,this.product=null,this.cart=null,this._parent(),this.container=null},_displayManageView(){this.stateMachine.changeState(h.ON_MANAGE_SUBSCRIPTIONS),this.render()},_displayBuyMoreView(){this.stateMachine.changeState(h.ON_ADD_SUBSCRIPTIONS),this.render()},_displayPresentationView(){this.stateMachine.changeState(h.ROLE_PRESENTATION),this.render()},_createManageComponent(){const t=new c({product:this.product});return this.listenTo(t,c.Events.ON_BACK,this._displayPresentationView.bind(this)),t},_createBuyMoreComponent(){const t=new a({product:this.product,cart:this.cart,legalEntityId:this.legalEntityId});return this.listenTo(t,a.Events.ON_BACK,this._displayPresentationView.bind(this)),t},_createRolePresentationComponent(){const t=new o({product:this.product});return this.listenTo(t,o.Events.MANAGE,this._displayManageView.bind(this)),this.listenTo(t,o.Events.BUY_MORE,this._displayBuyMoreView.bind(this)),t},_createStateMachine:()=>new r({state:h.ROLE_PRESENTATION,states:[h.ROLE_PRESENTATION,h.ON_MANAGE_SUBSCRIPTIONS,h.ON_ADD_SUBSCRIPTIONS],transitions:[{from:h.ROLE_PRESENTATION,to:h.ON_MANAGE_SUBSCRIPTIONS},{from:h.ON_MANAGE_SUBSCRIPTIONS,to:h.ROLE_PRESENTATION},{from:h.ROLE_PRESENTATION,to:h.ON_ADD_SUBSCRIPTIONS},{from:h.ON_ADD_SUBSCRIPTIONS,to:h.ROLE_PRESENTATION}]}),_checkPrototypes(t){s.requiredOfPrototype(t.product,n,"options.product must be a ProductModel"),s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel")}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteCard",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFSubscriptionsComponent/quoteList/QuoteCardHeader","DS/MPFSubscriptionsComponent/quoteList/QuoteCardBody","DS/MPFSubscriptionsComponent/quoteList/QuoteCardFooter","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l)=>{"use strict";const h=Object.freeze({REFRESH_CARTS:"refreshCarts"}),d=t.extend({className:"mpf-quote-card",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cart=t.cart,this.invoiceFactory=t.invoiceFactory,this.cartQuoteFactory=t.cartQuoteFactory,this.companyFactory=t.companyFactory,this.header=this._createHeader(),this.body=this._createBody(),this.footer=this._createFooter(),this.listenTo(this.footer,c.Events.REFRESH_CARTS,this._refreshCarts.bind(this))},render(){return this.container.setContent([this.header.render(),this.body.render(),this.footer.render()]),this},_refreshCarts(t){this.dispatchEvent(h.REFRESH_CARTS,t)},_createFooter(){return new c({cart:this.cart})},_createBody(){return new a({cart:this.cart})},_createHeader(){return new o({cart:this.cart,cartQuoteFactory:this.cartQuoteFactory,companyFactory:this.companyFactory,invoiceFactory:this.invoiceFactory})},_checkPrototypes(t){e.requiredOfPrototype(t.invoiceFactory,n,"options.invoiceFactory must be an InvoiceFactory"),e.requiredOfPrototype(t.cartQuoteFactory,i,"options.cartQuoteFactory must be a CartQuoteFactory"),e.requiredOfPrototype(t.cart,s,"options.cart must be a CartModel"),e.requiredOfPrototype(t.companyFactory,r,"options.companyFactory must be a CompanyFactory")}});return d.Events=h,d}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandFilter",["UWA/Core","UWA/Class/View","DS/UIKIT/DropdownMenu","DS/MPFCartModel/CartFilters","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent"],(t,e,s,i,n,r)=>{"use strict";const o=Object.freeze({CLEAR:"clearFilter",CREATION_DATE_TODAY:"creationDateToday",CREATION_DATE_LAST_7_DAYS:"creationDateLast7Days",CREATION_DATE_LAST_30_DAYS:"creationDateLast30Days",CREATION_DATE_LAST_6_MONTHS:"creationDateLast6Monthss",MODIFICATION_DATE_TODAY:"modificationDateToday",MODIFICATION_DATE_LAST_7_DAYS:"modificationDateLast7Days",MODIFICATION_DATE_LAST_30_DAYS:"modificationDateLast30Days",MODIFICATION_DATE_LAST_6_MONTHS:"modificationDateLast6Monthss"});return e.extend({className:"mpf-quote-list-command-filter",setup(t){this.filterIcon=this._createFilterIcon(),this.filterMenu=this._createFilterMenu()},render(){return this.container.setContent([this.filterIcon]),this},setActive(t){!0===t?this.filterIcon.addClassName("mpf-active"):this.filterIcon.removeClassName("mpf-active")},_createFilterIcon:()=>t.createElement("div",{class:"fonticon fonticon-filter"}),_createFilterMenu(){return new s({target:this.container,renderTo:this.container,multiSelect:!1,items:[{text:r.get("creationDate"),items:[{text:r.get("today"),name:o.CREATION_DATE_TODAY,selectable:!0},{text:r.get("lastXDays",{number:7}),name:o.CREATION_DATE_LAST_7_DAYS,selectable:!0},{text:r.get("lastXDays",{number:30}),name:o.CREATION_DATE_LAST_30_DAYS,selectable:!0},{text:r.get("lastXMonths",{number:6}),name:o.CREATION_DATE_LAST_6_MONTHS,selectable:!0}]},{text:r.get("modificationDate"),items:[{text:r.get("today"),name:o.MODIFICATION_DATE_TODAY,selectable:!0},{text:r.get("lastXDays",{number:7}),name:o.MODIFICATION_DATE_LAST_7_DAYS,selectable:!0},{text:r.get("lastXDays",{number:30}),name:o.MODIFICATION_DATE_LAST_30_DAYS,selectable:!0},{text:r.get("lastXMonths",{number:6}),name:o.MODIFICATION_DATE_LAST_6_MONTHS,selectable:!0}]},{text:r.get("clearFilter"),name:o.CLEAR,selectable:!0,fonticon:"trash"}],events:{onClick:this._onFilterSelected.bind(this)}})},_onFilterSelected(t,e){switch(this._updateMenuSelection(e),e.name){case o.CREATION_DATE_TODAY:this._dispatchFilterCreationDateDays(0);break;case o.CREATION_DATE_LAST_7_DAYS:this._dispatchFilterCreationDateDays(7);break;case o.CREATION_DATE_LAST_30_DAYS:this._dispatchFilterCreationDateDays(30);break;case o.CREATION_DATE_LAST_6_MONTHS:this._dispatchFilterCreationDateMonths(6);break;case o.MODIFICATION_DATE_TODAY:this._dispatchFilterModificationDateDays(0);break;case o.MODIFICATION_DATE_LAST_7_DAYS:this._dispatchFilterModificationDateDays(7);break;case o.MODIFICATION_DATE_LAST_30_DAYS:this._dispatchFilterModificationDateDays(30);break;case o.MODIFICATION_DATE_LAST_6_MONTHS:this.dispatchEvent(n.FILTER_BY_DATE,{filter:i.FILTER_BY_MODIFICATION_DATE_MONTHS,months:6});break;case o.CLEAR:this.dispatchEvent(n.FILTER_BY_DATE,{filter:i.CLEAR})}},_updateMenuSelection(t){this.filterMenu.getSelectedItems().forEach(e=>{e!==t&&(e.elements.container.removeClassName("selected"),e.selected=!1)})},_dispatchFilterCreationDateDays(t){this.dispatchEvent(n.FILTER_BY_DATE,{filter:i.FILTER_BY_CREATION_DATE_DAYS,days:t})},_dispatchFilterCreationDateMonths(t){this.dispatchEvent(n.FILTER_BY_DATE,{filter:i.FILTER_BY_CREATION_DATE_MONTHS,months:t})},_dispatchFilterModificationDateDays(t){this.dispatchEvent(n.FILTER_BY_DATE,{filter:i.FILTER_BY_MODIFICATION_DATE_DAYS,days:t})},_dispatchFilterModificationDateMonths(t){this.dispatchEvent(n.FILTER_BY_DATE,{filter:i.FILTER_BY_MODIFICATION_DATE_MONTHS,months:t})}})}),define("DS/MPFSubscriptionsComponent/roleList/RoleListComponent",["UWA/Core","UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartModel","DS/MPFProductModel/ProductCollection","DS/MPFSubscriptionsComponent/roleList/RoleCardComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o)=>{"use strict";return e.extend({className:"mpf-role-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.products=t.products,this.marketplaceOffers=t.marketplaceOffers,this.cart=t.cart,this.legalEntityId=t.legalEntityId,this.cards=this._createCards()},render(){const e=t.createElement("div",{class:"mpf-subs-title",html:o.get("activeSubscriptions")}),s=t.createElement("div",{class:"mpf-roles",html:this.cards.map(t=>t.render())});return this.container.setContent([e,s]),this},disableBuyMorePeriodicity(t){this.cards.forEach(e=>e.disableBuyMorePeriodicity(t))},enableBuyMoreAllPeriodicities(){this.cards.forEach(t=>t.enableBuyMoreAllPeriodicities())},_createCards(){return[...this.products.toArray(),...this.marketplaceOffers.toArray()].map(t=>(t.onlineInstanceId=this.products.onlineInstanceId,new r({product:t,cart:this.cart,legalEntityId:this.legalEntityId})))},_checkPrototypes(t){s.requiredOfPrototype(t.cart,i,"options.cart must be a CartModel"),s.requiredOfPrototype(t.products,n,"options.products must be a ProductCollection"),s.requiredOfPrototype(t.marketplaceOffers,n,"options.marketplaceOffers must be a ProductCollection")}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListCommands",["UWA/Class/View","DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandFilter","DS/MPFSubscriptionsComponent/quoteList/QuoteListCommandSort","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents"],(t,e,s,i)=>{"use strict";return t.extend({className:"mpf-quote-list-commands",setup(t){this.filterCommand=this._createFilterCommand(),this.sortCommand=this._createSortCommand(),this.listenTo(this.filterCommand,i.FILTER_BY_DATE,this._onFilterByDate.bind(this)),this.listenTo(this.sortCommand,i.SORT,this._onSort.bind(this))},render(){return this.container.setContent([this.filterCommand.render(),this.sortCommand.render()]),this},setFilterActive(t){this.filterCommand.setActive(t)},_createFilterCommand:()=>new e,_createSortCommand:()=>new s,_onFilterByDate(t){this.dispatchEvent(i.FILTER_BY_DATE,t)},_onSort(t){this.dispatchEvent(i.SORT,t)},destroy(){this.stopListening(this.filterCommand),this.stopListening(this.sortCommand),this.filterCommand.destroy(),this.filterCommand=null,this.sortCommand.destroy(),this.sortCommand=null,this._parent()}})}),define("DS/MPFSubscriptionsComponent/SubscriptionsTab",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/UIKIT/Input/Button","DS/MPFServices/ObjectService","DS/MPFServices/MarketplaceServices","DS/MPFFiniteStateMachine/FiniteStateMachine","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFPortfolioModel/PortfolioCollection","DS/MPFProductModel/ProductCollection","DS/MPFSubscriptionsComponent/CartHelper","DS/MPFSubscriptionsComponent/roleList/RoleListComponent","DS/MPFSubscriptionsComponent/offerList/OfferListComponent","DS/MPFClickAndBuyComponent/orderList/OrderList","DS/MPFModalConfiguratorComponent/CheckoutLauncherFactory","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u,m,S,C,y)=>{"use strict";const M=Object.freeze({PORTFOLIO:"portfolio",QUOTE:"quote"}),f=Object.freeze({GO_TO_MY_ORDERS:"goToMyOrders"}),_=e.extend({className:"mpf-subs-tab",setup(t={}){this._parent(t),this._checkPrototypes(t),this.legalEntityId=t.legalEntityId,this.offers=t.offers,this.products=t.products,this.marketplaceOffers=t.marketplaceOffers,this.cartFactory=t.cartFactory,this.cart=this.cartFactory.createModel(c.Types.ME),this.paymentCompleted=!1,this.stateMachine=this._createStateMachine(),this.offerListComponent=this._createOfferListComponent(),this.roleListComponent=this._createRoleListComponent(),this.backButton=this._createBackButton(),this.checkoutButton=this._createCheckoutButton(),this.viewQuoteButton=this._createViewQuoteButton(),this.listenTo(this.cart,"onChange:"+l.Fields.CART_ITEMS,this._updateButtonsAndFilter.bind(this))},render(){let e;this.stateMachine.getState()===M.PORTFOLIO?(e=[this.roleListComponent.render(),this.offerListComponent.render()],this.viewQuoteButton.show(),this.backButton.hide(),this.checkoutButton.hide()):this.stateMachine.getState()===M.QUOTE&&(e=this.quoteDetailsComponent.render(),this.viewQuoteButton.hide(),this.backButton.show(),this.checkoutButton.show());const s=t.createElement("div",{class:"mpf-subs-content",html:e}),n=t.createElement("div",{class:"mpf-subs-footer",html:[this.viewQuoteButton,this.backButton,this.checkoutButton]});this.container.setContent([s,n]);try{new i({element:s}).inject(this.container)}catch(t){console.warn(t)}return this},_displayCheckout(){var t;this.checkoutButton.load(),this.backButton.disable(),this._createQuote().then(()=>(t=new C({serviceRequest:o.SUBSCRIPTIONS,idCart:this.cart.id})).whenReady()).then(()=>{this.listenTo(t,C.Events.PAYMENT_COMPLETED,this._onPaymentCompleted.bind(this)),t.show()}).finally(()=>{this.checkoutButton.load(!1),this.backButton.enable()})},_createQuote(){const t={};return t[l.Fields.STATE]=l.States.SUBMITTED,p.modifyQuantitiesItemsOnQuote(this.cart,this.quoteDetailsComponent.getNewQuantities()).then(this.cart.savePromise.bind(this.cart,t,{patch:!0}))},_onPaymentCompleted(){this.dispatchEvent(f.GO_TO_MY_ORDERS)},_onBack(){if(this.cart.getItems().length>0)return this.backButton.load(),this.checkoutButton.disable(),p.modifyQuantitiesItemsOnQuote(this.cart,this.quoteDetailsComponent.getNewQuantities()).then(this.stateMachine.changeState.bind(this.stateMachine,M.PORTFOLIO)).then(this.render.bind(this)).finally(()=>{this.backButton.load(!1),this.checkoutButton.enable()});this.stateMachine.changeState(M.PORTFOLIO),this.render()},_displayQuote(){return this.viewQuoteButton.load(),this.cart.fetchPromise({expand:[l.Expands.CART_ITEMS]}).then(this._createQuoteDetailsComponent.bind(this)).then(this.stateMachine.changeState.bind(this.stateMachine,M.QUOTE)).then(this.render.bind(this)).finally(this.viewQuoteButton.load.bind(this.viewQuoteButton,!1))},_updateButtonsAndFilter(){const t=this.cart.getItems();let e,i;if(s.unmask(this.container),t.length>0){const s=t[0].getLicensingScheme();e=t.reduce(function(t,e){return t+=parseInt(e.getQuantity(),10)},0),this.roleListComponent.disableBuyMorePeriodicity(s),this.offerListComponent.setPeriodicityFilterValue(s),this.offerListComponent.filterOnPeriodicity(s),this.offerListComponent.disablePeriodicityFilter(),i=y.get("viewQuoteNbItems",{nb:e})}else e=0,this.roleListComponent.enableBuyMoreAllPeriodicities(),this.offerListComponent.enablePeriodicityFilter(),i=y.get("viewQuote");this.checkoutButton.setDisabled(0===e),this.viewQuoteButton.setDisabled(0===e),this.viewQuoteButton.setValue(i)},_createQuoteDetailsComponent(){this.quoteDetailsComponent=new S({locale:this._getLocale(),service:o.SUBSCRIPTIONS,cart:this.cart})},_createRoleListComponent(){return new u({cart:this.cart,legalEntityId:this.legalEntityId,products:this.products,marketplaceOffers:this.marketplaceOffers})},_createOfferListComponent(){return new m({cart:this.cart,legalEntityId:this.legalEntityId,offers:this.offers})},_createBackButton(){return new n({value:y.get("back"),events:{onClick:this._onBack.bind(this)}})},_createCheckoutButton(){return new n({className:"primary",value:y.get("checkout"),events:{onClick:this._displayCheckout.bind(this)}})},_createViewQuoteButton(){return new n({className:"primary",value:y.get("viewQuote"),disabled:!0,icon:"shopping-cart",events:{onClick:this._displayQuote.bind(this)}})},_createStateMachine:()=>new a({state:M.PORTFOLIO,states:[M.PORTFOLIO,M.QUOTE],transitions:[{from:M.PORTFOLIO,to:M.QUOTE},{from:M.QUOTE,to:M.PORTFOLIO}]}),_getLocale(){return"EUR"===this.cart.getCurrency()?"fr-FR":"en-US"},_checkPrototypes(t){r.requiredOfPrototype(t.products,d,"options.products must be a ProductCollection"),r.requiredOfPrototype(t.offers,h,"options.offers must be an PortfolioCollection"),r.requiredOfPrototype(t.cartFactory,c,"options.cartFactory must be a CartFactory")}});return _.Events=f,_}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListHeader",["UWA/Class/View","DS/MPFServices/ObjectService","DS/MPFCartModel/CartCollection","DS/MPFSubscriptionsComponent/quoteList/StatusSelectorTile","DS/MPFSubscriptionsComponent/quoteList/QuoteListCommands","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents"],(t,e,s,i,n,r)=>{"use strict";return t.extend({className:"mpf-quote-list-header",setup(t={}){e.requiredOfPrototype(t.carts,s,"options.carts must be a CartCollection"),this.carts=t.carts,this.statusSelectorTile=this._createStatusSelectorTile(t.statusSelectorInitValue),this.commands=this._createCommands(),this.stateFilter="all",this.listenTo(this.statusSelectorTile,r.FILTER_BY_STATE,this._onFilterByState.bind(this)),this.listenTo(this.commands,r.FILTER_BY_DATE,this._onFilterByDate.bind(this)),this.listenTo(this.commands,r.SORT,this._onSort.bind(this))},render(){return this.container.setContent([this.statusSelectorTile.render(),this.commands.render()]),this},setFilterActive(t){this.commands.setFilterActive(t)},_createStatusSelectorTile(){return new i({carts:this.carts})},_createCommands:()=>new n,_onFilterByState(t){this.dispatchEvent(r.FILTER_BY_STATE,t)},_onFilterByDate(t){this.dispatchEvent(r.FILTER_BY_DATE,t)},_onSort(t){this.dispatchEvent(r.SORT,t)},destroy(){this.stopListening(this.statusSelectorTile),this.stopListening(this.commands),this.statusSelectorTile.destroy(),this.statusSelectorTile=null,this.commands.destroy(),this.commands=null,this._parent()}})}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteList",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Scroller","DS/PlatformAPI/PlatformAPI","DS/MPFServices/ObjectService","DS/MPFCartQuoteModel/CartQuoteFactory","DS/MPFInvoiceModel/InvoiceFactory","DS/MPFCompanyModel/CompanyFactory","DS/MPFCartModel/CartCollection","DS/MPFCartModel/CartFilters","DS/MPFCartModel/CartSorts","DS/MPFSubscriptionsComponent/quoteList/QuoteListHeader","DS/MPFSubscriptionsComponent/quoteList/QuoteCard","DS/MPFSubscriptionsComponent/quoteList/QuoteListEvents","DS/MPFPaginationComponent/PaginationComponent","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u,m,S,C)=>{"use strict";const y=Object.freeze({CREATE_QUOTE:"createQuote"}),M=e.extend({className:"mpf-quote-list",setup(t={}){this._parent(t),this._checkPrototypes(t),this.carts=t.carts,this.cartQuoteFactory=t.cartQuoteFactory,this.invoiceFactory=t.invoiceFactory,this.companyFactory=t.companyFactory,this.header=this._createHeader(),this.pagination=this._createPagination(),this.fetchOptions={reset:!0,start:0,size:10,company:this.legalEntityId},this.fetchOptions[h.FILTER_BY_STATE]=h.STATE_PENDING_FILTER,this.listenTo(this.header,m.FILTER_BY_STATE,this._onFilterByState.bind(this)),this.listenTo(this.header,m.FILTER_BY_DATE,this._onFilterByDate.bind(this)),this.listenTo(this.header,m.SORT,this._onSort.bind(this)),this.listenTo(this.pagination,S.Events.CHANGE_PAGE,this._onChangePage.bind(this)),n.subscribe("SearchBar/search",this._onTopBarSearch.bind(this)),n.subscribe("SearchBar/clear",this._onTopBarClear.bind(this))},render(){let e;this.carts.isEmpty()?e=[this._createEmptyListMessage()]:(e=this._createQuoteCards().map(t=>t.render())).push(this.pagination.render()),e.unshift(this.header.render());const s=t.createElement("div",{class:"mpf-quote-list-content",html:e});this.container.setContent(s);try{new i({element:s}).inject(this.container)}catch(t){console.warn(t)}return this},_onChangePage(t={}){const e=t.page||1;this.fetchOptions.start=10*(e-1),this.header.container.scrollIntoView(!1),this._refreshCarts()},_onSort(t){this._resetPage(),t&&t.sort?this.fetchOptions[d.SORT]=t.sort:this.fetchOptions[d.SORT]=null,this._refreshCarts()},_onFilterByState(t){this._resetPage(),this.fetchOptions[h.FILTER_BY_STATE]=t[h.FILTER_BY_STATE],this._refreshCarts()},_onFilterByDate(t){switch(this._resetPage(),t.filter){case h.FILTER_BY_CREATION_DATE_DAYS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_CREATION_DATE_DAYS]=t.days,this.header.setFilterActive(!0);break;case h.FILTER_BY_CREATION_DATE_MONTHS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_CREATION_DATE_MONTHS]=t.months,this.header.setFilterActive(!0);break;case h.FILTER_BY_MODIFICATION_DATE_DAYS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_DAYS]=t.days,this.header.setFilterActive(!0);break;case h.FILTER_BY_MODIFICATION_DATE_MONTHS:this._resetDateFilter(),this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_MONTHS]=t.months,this.header.setFilterActive(!0);break;case h.CLEAR:this._resetDateFilter(),this.header.setFilterActive(!1)}this._refreshCarts()},_resetDateFilter(){this.header.setFilterActive(!1),this.fetchOptions[h.FILTER_BY_CREATION_DATE_MONTHS]=null,this.fetchOptions[h.FILTER_BY_CREATION_DATE_DAYS]=null,this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_DAYS]=null,this.fetchOptions[h.FILTER_BY_MODIFICATION_DATE_MONTHS]=null},_refreshCarts(){return s.mask(this.container),this.carts.fetchPromise(t.clone(this.fetchOptions)).then(this.render.bind(this)).finally(s.unmask.bind(null,this.container))},_resetPage(){this.pagination.changePage(1,{silent:!0}),this.fetchOptions.start=0},_createPagination(){return new S({collection:this.carts,pageSize:10})},_createHeader(){return new p({carts:this.carts})},_createQuoteCards(){return this.carts.map(t=>{const e=new u({cart:t,cartQuoteFactory:this.cartQuoteFactory,companyFactory:this.companyFactory,invoiceFactory:this.invoiceFactory});return this.listenTo(e,u.Events.REFRESH_CARTS,()=>{this._resetPage(),this._refreshCarts()}),e})},_createEmptyListMessage:()=>t.createElement("div",{class:"mpf-message",html:[t.createElement("i",{class:"fonticon fonticon-doc-log"}),t.createElement("h4",{text:C.get("quoteListEmpty")}),t.createElement("p",{text:C.get("noQuotesMatchingSearchCriteria")})]}),_onTopBarSearch(t){document.body.getElementsByClassName("mpf-quote-list").length>0&&(this._resetPage(),this.fetchOptions.search=t,this._refreshCarts())},_onTopBarClear(){document.body.getElementsByClassName("mpf-quote-list").length>0&&(this._resetPage(),this.fetchOptions.search="",this._refreshCarts())},_checkPrototypes(t){r.requiredOfPrototype(t.cartQuoteFactory,o,"options.cartQuoteFactory must be a CartQuoteFactory"),r.requiredOfPrototype(t.invoiceFactory,a,"options.invoiceFactory must be an InvoiceFactory"),r.requiredOfPrototype(t.carts,l,"options.carts must be a CartCollection"),r.requiredOfPrototype(t.companyFactory,c,"options.companyFactory must be a CompanyFactory")}});return M.QUOTES_PER_PAGE=10,M.Events=y,M}),define("DS/MPFSubscriptionsComponent/quoteList/QuoteListFactory",["UWA/Promise","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFCartModel/CartFactory","DS/MPFCartModel/CartModel","DS/MPFCartModel/CartFilters","DS/MPFModel/CollectionFetchOptions","DS/MPFSubscriptionsComponent/quoteList/QuoteList","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l)=>{"use strict";function h(e){const s=i.getInstance(e);return t.all([s.getFactory(i.Types.CART),s.getFactory(i.Types.CART_QUOTE),s.getFactory(i.Types.COMPANY),s.getFactory(i.Types.ADDRESS),s.getFactory(i.Types.INVOICE)])}function d(e,s){const i=s[0],l=s[1],h=s[2],d=s[3],p=s[4];return h.addressFactory=d,function(t,e){const s=t.createCollection(n.Types.ME_V2,[],{modelDataProxy:t.getDataProxy(n.Types.CART)}),i={expand:[r.Expands.CART_ITEMS],start:0,size:c.QUOTES_PER_PAGE};return i[o.FILTER_BY_STATE]=o.STATE_PENDING_FILTER,i[a.ONLINEINSTANCE]=e,s.fetchPromise(i)}(i,e).then(e=>t.all([e,l,p,h]))}return{fromSubscriptions:t=>{return e.fetchPromise({service:s.SUBSCRIPTIONS}).then(h).then(d.bind(null,t)).then(function(t,e){const s=e[0],i=e[1],n=e[2],r=e[3];return new c({carts:s,cartQuoteFactory:i,companyFactory:r,invoiceFactory:n})}.bind(null,{}))}}}),define("DS/MPFSubscriptionsComponent/MyOrdersTab",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/MPFSubscriptionsComponent/quoteList/QuoteListFactory","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n)=>{"use strict";return e.extend({className:"mpf-my-orders-tab",setup(t={}){this._parent(t),this.onlineInstanceId=t.onlineInstanceId},render(){return t.is(this.quoteList)?this.container.setContent(this.quoteList.render()):(s.mask(this.container),i.fromSubscriptions(this.onlineInstanceId).then(t=>{this.quoteList=t,this.container.setContent(this.quoteList.render())}).finally(()=>{s.unmask(this.container)})),this},refresh(){if(t.is(this.quoteList))return this.quoteList._refreshCarts()},destroy(){this._parent(),this.container=null}})}),define("DS/MPFSubscriptionsComponent/SubscriptionsComponent",["UWA/Class/View","UWA/Core","DS/UIKIT/Toggler","DS/MPFUrl/UrlUtils","DS/MPFServices/ObjectService","DS/MPFCartModel/CartFactory","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFCatalogueModel/CatalogueModel","DS/MPFPaymentMethodModel/PaymentMethodCollection","DS/MPFPspModel/PspModel","DS/MPFSubscriptionsComponent/SubscriptionsTab","DS/MPFSubscriptionsComponent/MyOrdersTab","DS/MPFSubscriptionsComponent/PaymentMethodsTab","DS/Usage/TrackerAPI","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/MPFSubscriptionsComponent/MPFSubscriptionsComponent"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u,m)=>{"use strict";const S=Object.freeze({GO_TO_MY_ORDERS:"goToMyOrders"}),C=Object.freeze({PAGE_SUBSCRIPTION:"Subcription",PAGE_MY_ORDERS:"MyOrders",PAGE_PAYMENT_METHODS:"PaymentMethods"}),y=Object.freeze({0:"Subscriptions",1:"MyOrders",2:"PaymentMethods"}),M=Object.freeze({Subscriptions:0,MyOrders:1,PaymentMethods:2}),f=t.extend({className:"mpf-subscriptions",setup(t={}){this._parent(t),this._checkPrototypes(t),this.cartFactory=t.cartFactory,this.paymentMethodFactory=t.paymentMethodFactory,this.me=t.me,this.buyer=t.buyer,this.catalogue=t.catalogue,this.onlineInstanceId=t.onlineInstanceId,this.paymentMethods=t.paymentMethods,this.psp=t.psp,this.paymentMethodsNotAllowed=!0===t.paymentMethodsNotAllowed,this.companyInformation=t.companyInformation,this.virtualIbans=t.virtualIbans,this.offers=this._getOffersFromCatalogue(),this.products=this._getProductsFromCatalogue(),this.marketplaceOffers=this._getMarketplaceOffersFromCatalogue(),this.subscriptionsTab=this._createSubscriptionsTab(),this.myOrdersTab=this._createMyOrdersTab(),this.paymentMethodsTab=this._createPaymentMethodsTab(),this.currentTabContainer=this._createTabDisplayer(),this.tabs=this._initTabs(),this.navTab=this._initNavTab()},render(){return this.container.setContent([this.navTab,this.currentTabContainer]),this},_displayTab(t,e,s){switch(e){case 0:this._sendTrackingView(C.PAGE_SUBSCRIPTION);break;case 1:this._sendTrackingView(C.PAGE_MY_ORDERS);break;case 2:this._sendTrackingView(C.PAGE_PAYMENT_METHODS)}this.currentTabContainer.setContent(this.tabs[e].render()),this._updateHash(e)},_updateHash(t){const e=new URL(window.parent.location.href),s=e.hash.split("/tab:Subscriptions");e.hash=s[0]+"/tab:Subscriptions/"+y[t],window.parent.location.href=e.href},_initTabs(){return this.paymentMethodsNotAllowed?[this.subscriptionsTab,this.myOrdersTab]:[this.subscriptionsTab,this.myOrdersTab,this.paymentMethodsTab]},_createTabDisplayer:()=>e.createElement("div",{class:"mpf-content-tab"}),_initNavTab(){const t=e.createElement("a",{class:"tab-item mpf-link-tab-item",html:[{tag:"span",class:"fonticon fonticon-shopping-cart"},{tag:"span",text:m.get("subscriptions")}]}),i=e.createElement("a",{class:"tab-item mpf-link-tab-item",html:[{tag:"span",class:"fonticon fonticon-task"},{tag:"span",text:m.get("myOrders")}]}),n=e.createElement("a",{class:"tab-item mpf-link-tab-item",html:[{tag:"span",class:"fonticon fonticon-credit-card"},{tag:"span",text:m.get("paymentMethods")}]}),r=this.paymentMethodsNotAllowed?[t,i]:[t,i,n],o=e.createElement("nav",{class:"tab tab-pills mpf-nav",html:r}),a=window.parent.location.hash.split("/tab:Subscriptions/")[1]||"",c=""===a?0:M[a];return this.toggler=new s({container:o,selected:c,events:{onToggle:this._displayTab.bind(this)}}),o},_getProductsFromCatalogue(){const t=this.catalogue.getProducts();return t.onlineInstanceId=this.catalogue.onlineInstanceId,t},_getOffersFromCatalogue(){const t=this.catalogue.getOffers();return t.onlineInstanceId=this.catalogue.onlineInstanceId,t},_getMarketplaceOffersFromCatalogue(){return this.catalogue.getMarketplaceOffers()},_createMyOrdersTab(){return new d({onlineInstanceId:this.onlineInstanceId})},_createSubscriptionsTab(){const t=new h({legalEntityId:this.catalogue.getCompanyID(),cartFactory:this.cartFactory,offers:this.offers,products:this.products,marketplaceOffers:this.marketplaceOffers});return this.listenTo(t,h.Events.GO_TO_MY_ORDERS,this._refreshAndDisplayMyOrdersTab.bind(this)),t},_createPaymentMethodsTab(){if(!this.paymentMethodsNotAllowed)return new p({paymentMethodFactory:this.paymentMethodFactory,buyer:this.buyer,onlineInstanceId:this.onlineInstanceId,paymentMethods:this.paymentMethods,psp:this.psp,companyInformation:this.companyInformation,virtualIbans:this.virtualIbans})},_refreshAndDisplayMyOrdersTab(){this.myOrdersTab.refresh(),this.toggler.toggle(1),this.catalogue.fetchPromise().then(()=>{this.offers=this._getOffersFromCatalogue(),this.products=this._getProductsFromCatalogue(),this.subscriptionsTab=this._createSubscriptionsTab(),this.tabs=this._initTabs()})},_checkPrototypes(t){n.requiredOfPrototype(t.paymentMethodFactory,o,"options.paymentMethodFactory must be a PaymentMethodFactory"),n.requiredOfPrototype(t.cartFactory,r,"options.cartFactory must be a CartFactory"),n.requiredOfPrototype(t.catalogue,a,"options.catalogue must be a CatalogueModel"),n.requiredOfPrototype(t.paymentMethods,c,"options.paymentMethods must be a PaymentMethodCollection"),n.requiredOfPrototype(t.psp,l,"options.psp must be a PspModel")},_sendTrackingView(t){u.trackPageView({pageURL:"/my-subscriptions",pageTitle:t})}});return f.Events=S,f}),define("DS/MPFSubscriptionsComponent/SubscriptionsWidgetWrapper",["UWA/Class/View","UWA/Promise","DS/UIKIT/Mask","DS/MPFConnector/MarketplaceConnector","DS/MPFServices/MarketplaceServices","DS/MPFModelFactory/MPFFactoriesV2","DS/MPFPersonModel/PersonFactory","DS/MPFCatalogueModel/CatalogueFactory","DS/MPFPersonModel/MePersonDataProxy","DS/MPFBuyer/Buyer","DS/MPFPaymentMethodModel/PaymentMethodFactory","DS/MPFPspModel/PspFactory","DS/MPFDataProxy/AppsConnector","DS/MPFAppsPlatform/PublicPlatformsDataProxy","DS/MPFAppsPlatform/PlatformCollection","DS/MPFCompanyInformationModel/CompanyInformationModel","DS/MPFCompanyInformationModel/CompanyInformationFactory","DS/MPFVirtualIbanModel/VirtualIbanFactory","DS/MPFAppsPlatform/ServiceEnum","DS/MPFSubscriptionsComponent/SubscriptionsComponent","DS/MPFClickAndBuyComponent/MaintenancePage","i18n!DS/MPFSubscriptionsComponent/assets/nls/MPFSubscriptionsComponent","css!DS/UIKIT/UIKIT"],(t,e,s,i,n,r,o,a,c,l,h,d,p,u,m,S,C,y,M,f,_,P)=>{"use strict";return t.extend({init(t={}){this._parent(t),this.i3DXCompassPlatformServices=t.i3DXCompassPlatformServices,this.widget=t.widget,this.deferred=e.deferred(),this.promise=this.deferred.promise},inject(){this.widget.setBody(this.widgetComponent.render()),this.deferred=e.deferred(),this.promise=this.deferred.promise},whenReady(){return this._getOnlineInstance(),this.promise},refresh(){return this.onlineInstanceId=this.widget.getPreference("x3dPlatformId").value,this.widget.setTitle(this.onlineInstanceId),this.widget.setBody(""),s.mask(this.widget.body),e.all([this._fetchCatalogue(),this.paymentMethodsNotAllowed?e.resolve():this._fetchPaymentMethods()]).then(this._initWidgetComponent.bind(this)).then(this.inject.bind(this)).catch(t=>{console.error(t);const e=new _;this.widget.setBody(e.render())}).finally(()=>{s.unmask(this.widget.body)})},_initWidget(t){this._setWidgetPreferences(this.platforms),this._initWidgetComponent(),t.resolve()},_initWidgetComponent(){this.widgetComponent=new f({cartFactory:this.cartFactory,paymentMethodFactory:this.paymentMethodFactory,me:this.me,buyer:this.buyer,catalogue:this.catalogue,onlineInstanceId:this.onlineInstanceId,paymentMethods:this.paymentMethods,psp:this.psp,paymentMethodsNotAllowed:this.paymentMethodsNotAllowed,companyInformation:this.companyInformation,virtualIbans:this.virtualIbans}),this.listenTo(this.widgetComponent,f.Events.GO_TO_MY_ORDERS,this._refreshAndDisplayOrders.bind(this))},_refreshAndDisplayOrders(){return this.refresh().then(()=>{this.widgetComponent.displayMyOrdersTab()})},_fetchResources(t){return this._fetchConnector().then(this._initFactories.bind(this)).then(this._fetchMeAllowingCreation.bind(this)).then(this._fetchBuyer.bind(this)).then(this._fetchPsp.bind(this)).then(this._fetchCatalogue.bind(this)).then(this._fetchCompanyInformation.bind(this)).then(this._fetchPaymentMethods.bind(this)).then(this._fetchVirtualIbans.bind(this)).then(this._initWidget.bind(this,t)).catch(e=>{console.error(e);const s=new _;this.widget.setBody(s.render()),t.reject()})},_fetchCatalogue(){return this.catalogue=this.catalogueFactory.createModel(a.Types.CATALOGUE),this.catalogue.onlineInstanceId=this.onlineInstanceId,this.catalogue.fetchPromise().then(t=>10===t.getCode()?e.reject("OEdown"):e.resolve(t))},_initFactories(t){return this.mpConnector=t,this.mpfFactories=r.getInstance(this.mpConnector),this.mpfFactories.getFactory(r.Types.SUBSCRIPTION).then(t=>e.all([this.mpfFactories.getFactory(r.Types.PORTFOLIO),this.mpfFactories.getFactory(r.Types.PRODUCT,{subscriptionFactory:t})])).then(([t,s])=>e.all([this.mpfFactories.getFactory(r.Types.CATALOGUE,{portfolioFactory:t,productFactory:s}),this.mpfFactories.getFactory(r.Types.PERSON),this.mpfFactories.getFactory(r.Types.CART),this.mpfFactories.getFactory(r.Types.PAYMENT_METHOD),this.mpfFactories.getFactory(r.Types.PSP),this.mpfFactories.getFactory(r.Types.COMPANY_INFORMATION),this.mpfFactories.getFactory(r.Types.VIRTUAL_IBAN)])).then(t=>{this.catalogueFactory=t[0],this.personFactory=t[1],this.cartFactory=t[2],this.paymentMethodFactory=t[3],this.pspFactory=t[4],this.companyInformationFactory=t[5],this.virtualIbanFactory=t[6]})},_fetchMeAllowingCreation(){const t={};return this.me=this.personFactory.createModel(o.Types.ME),t[c.Params.ALLOW_CREATION]=!0,this.me.fetchPromise(t)},_fetchBuyer(){return l.fromMe({connector:this.mpConnector}).then(t=>{this.buyer=t})},_fetchPaymentMethods(){return this.paymentMethods=this.paymentMethodFactory.createCollection(h.Types.ME_ONLINE_INSTANCE),this.paymentMethods.setParentResourceId(this.onlineInstanceId),this.paymentMethods.fetchPromise().catch(t=>{return 403===(t&&t.options).request.xhr.status?(this.paymentMethodsNotAllowed=!0,e.resolve()):e.reject(t)})},_fetchVirtualIbans(){return this.virtualIbans=this.virtualIbanFactory.createCollection(y.Types.ME_ONLINE_INSTANCE),this.virtualIbans.setParentResourceId(this.onlineInstanceId),this.virtualIbans.fetchPromise().catch(t=>{console.error(t)})},_fetchCompanyInformation(){return this.companyInformation=this.companyInformationFactory.createModel(C.Types.COMPANY_INFORMATION),this.companyInformation.set(S.Fields.ONLINE_INSTANCE_ID,this.onlineInstanceId),this.companyInformation.fetchPromise().catch(t=>{console.error(t)})},_fetchPsp(){return this.psp=this.pspFactory.createModel(d.Types.ME_ONLINE_INSTANCE),this.psp.setParentResourceId(this.onlineInstanceId),this.psp.fetchPromise()},_getOnlineInstance(){const t=this;this.i3DXCompassPlatformServices.getAppInfo({appId:"X3DOPMR_AP",onComplete:function(e){t.platforms={},e.platforms.length>1&&(t.platforms=e.platforms);let s=e.platformId;t.widget&&t.widget.getValue("x3dPlatformId")?t.widget.getValue("x3dPlatformId")===e.platformId?s=e.platformId:t.platforms&&(s=t.platforms.detect(function(e){return e.id===t.widget.getValue("x3dPlatformId")}).id):!s&&t.platforms&&(s=t.platforms[0].id),t.onlineInstanceId=s,t._fetchResources(t.deferred)}})},_setWidgetPreferences(t){const e=[];t.length>0?t.forEach(t=>{e.push({label:t.name,value:t.id,id:t.id})}):e.push({label:this.onlineInstanceId,value:this.onlineInstanceId,id:this.onlineInstanceId}),this.widget.setTitle(this.onlineInstanceId),this.widget.addPreference({type:"list",id:"x3dPlatformId",name:"x3dPlatformId",defaultValue:this.onlineInstanceId,label:P.get("3DExperiencePlatform"),options:e})},_computeMyAppsUrl(t){const e=t.replace("-ifwe","-apps"),s=e.match(/^https?:\/\/(\w{1,14}-)?(\w+\d-)/)[2];return(["eu1-","euw1-"].includes(s)?e:e.replace(s,"eu1-"))+"/enovia/resources/AppsMngt"},_fetchConnector(){const t=this._computeMyAppsUrl(window.location.origin),e=new p(t),s=new u(e);function r(t){return t.services.get(M.MARKETPLACE.name)}return new m([],{dataProxy:s}).fetchPromise().then(function(t){return t.filter(r).pop()}).then(t=>{const e=t.services.get(M.MARKETPLACE.name).getUrl()+"/resources";return new i(e,t.id,{service:n.SUBSCRIPTIONS})})}})});