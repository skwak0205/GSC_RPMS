define("DS/ENOXBreadcrumb/js/Breadcrumb",["UWA/Class/View","DS/Handlebars/Handlebars","DS/UIKIT/DropdownMenu","UWA/Class/Model","UWA/Class/Collection","DS/CoreEvents/ModelEvents","text!DS/ENOXBreadcrumb/html/Breadcrumb.html","i18n!DS/ENOXBreadcrumb/assets/nls/Breadcrumb","DS/UIKIT/Tooltip","css!DS/ENOXBreadcrumb/css/Breadcrumb.css","css!DS/UIKIT/UIKIT.css"],function(e,i,t,n,o,l,s,r,c){"use strict";var d="ellipsisLink",a=1,f=i.compile(s),m=n.extend({idAttribute:"linkID",defaults:{linkID:"",linkText:"",linkIcon:"right-open",callback:null}}),u=o.extend({model:m});function I(e){var i=e.getSize().width;return e.scrollWidth>i}function p(e){var i=e.collection.at(e.resizeInfo.linkAfterEllipsisIdx),n=e.container.getElement("#"+i.get("linkID"));n.style.display="none",n.previousElementSibling.style.display="none",e.resizeInfo.linkAfterEllipsisIdx++;var o,l,s={text:i.get("linkText"),name:i.get("linkID")};null===e.resizeInfo.ellpsisDropDown?e.resizeInfo.ellpsisDropDown=new t({target:e.container.getElement("#"+d),items:[s],altPosition:(o=e.container.getElement("#"+d),l=o.getPosition(),l.y+=o.getSize().height,l),events:{onClick:function(i,t){e.onClick(i,t.name)}}}):e.resizeInfo.ellpsisDropDown.addItem(s)}function h(e){for(var i=e.collection.at(e.resizeInfo.linkAfterEllipsisIdx);null==i;)e.resizeInfo.linkAfterEllipsisIdx--,i=e.collection.at(e.resizeInfo.linkAfterEllipsisIdx);var t=e.container.getElement("#"+i.get("linkID"));t.style.display="table-cell",t.previousElementSibling.style.display="table-cell",e.resizeInfo.linkAfterEllipsisIdx--,e.resizeInfo.linkAfterEllipsisIdx===a&&function(e,i){i.ellipsis=!1;var t=e.getElement("#"+d);t.hide(),t.previousElementSibling.style.display="none",i.linkAfterEllipsisIdx=a}(e.container,e.resizeInfo),e.resizeInfo.ellpsisDropDown.removeItem(e.resizeInfo.ellpsisDropDown.items.length-1)}function v(e,i,t){t.removeHomeText=!0,e.getElement("#"+i.at(0).get("linkID")).style.display="none"}function b(e){e.resizeInfo.ellipsis=!0,e.resizeInfo.linkAfterEllipsisIdx=a+1;var i=e.container.getElement("#"+d);if(null==i&&(null!==e.resizeInfo.ellpsisDropDown&&e.resizeInfo.ellpsisDropDown.destroy(),e.resizeInfo.ellpsisDropDown=null),null===e.resizeInfo.ellpsisDropDown){var t=e.collection.shift(),n={linkID:d,linkText:"..."},o=e.collection._prepareModel(n,{merge:!0});e.collection.unshift([t,o]),e.render(),!0===e.resizeInfo.removeHomeText&&v(e.container,e.collection,e.resizeInfo)}else i.style.display="table-cell",i.previousElementSibling.style.display="table-cell";p(e)}function k(e,i,t){t.flexMode=!0;var n=i.last(),o=e.getElement("#"+n.get("linkID"));o.style.overflow="hidden",o.style.textOverflow="ellipsis",o.style.whiteSpace="nowrap",o.style.maxWidth="1px",o.style.width="100%"}function z(e,i,t){t.flexMode=!1;var n=i.last();e.getElement("#"+n.get("linkID")).removeAttribute("style")}function g(e){if(!1===e.resizeInfo.inResizing){e.resizeInfo.inResizing=!0;for(var i=e.collection.length-1;!0===I(e.container)&&(!1===e.resizeInfo.flexMode||!1===e.resizeInfo.ellipsis||!1===e.resizeInfo.removeHomeText);)if(!1===e.resizeInfo.removeHomeText)v(e.container,e.collection,e.resizeInfo);else if(!1===e.resizeInfo.ellipsis&&e.resizeInfo.linkAfterEllipsisIdx<i)b(e);else{if(!(e.resizeInfo.linkAfterEllipsisIdx<i)){if(!1===e.resizeInfo.flexMode){k(e.container,e.collection,e.resizeInfo);break}break}p(e)}e.resizeInfo.inResizing=!1}}function E(e){if(!1===e.resizeInfo.inResizing){for(e.resizeInfo.inResizing=!0;!1===I(e.container)&&(!0===e.resizeInfo.flexMode||!0===e.resizeInfo.ellipsis||!0===e.resizeInfo.removeHomeText);)!0===e.resizeInfo.flexMode?z(e.container,e.collection,e.resizeInfo):!0===e.resizeInfo.ellipsis?h(e):!0===e.resizeInfo.removeHomeText&&(i=e.container,t=e.collection,e.resizeInfo.removeHomeText=!1,i.getElement("#"+t.at(0).get("linkID")).style.display="table-cell");e.resizeInfo.inResizing=!1}var i,t;g(e)}return e.extend({name:"breadcrumb",tagName:"div",collection:null,defaultOptions:{rootID:"defaultRootID",rootIcon:"home",dividerIcon:"right-open",toolTip:!1,modelEvents:null},mapping:{linkID:"rootID",linkText:"rootText",callback:"rootCallback",linkIcon:"rootIcon"},resizeInfo:{flexMode:!1,ellipsis:!1,removeHomeText:!1,width:0,linkAfterEllipsisIdx:a,inResizing:!1,ellpsisDropDown:null},domEvents:{"click .breadcrumb-link-text":"onClick","click .breadcrumb-symbol.fonticon:nth-of-type(1)":"onClick","click .breadcrumb-symbol:nth-of-type(1)":"reset","click .breadcrumb-link-text:nth-of-type(1)":"reset"},init:function(e){if(null!=e){for(var i in void 0!==e.rootID&&null!==e.rootID&&""!==e.rootID||(e.rootID=this.defaultOptions.rootID),void 0!==e.rootIcon&&null!==e.rootIcon&&""!==e.rootIcon||(e.rootIcon=this.defaultOptions.rootIcon),void 0===e.dividerIcon||null===e.dividerIcon||""===e.dividerIcon?e.dividerIcon=this.defaultOptions.dividerIcon:m.prototype.defaults.linkIcon=e.dividerIcon,void 0===e.toolTip&&null===e.toolTip&&(e.toolTip=this.defaultOptions.toolTip),void 0!==e.toolTip&&null!==e.toolTip&&!0===e.toolTip&&(e.toolTipText=""!==e.toolTipText&&void 0!==e.toolTipText&&null!==e.toolTipText?e.toolTipText:""!==e.rootText&&void 0!==e.rootText&&null!==e.rootText?e.rootText:""),e)this[i]=e[i];var t=function(e,i){var t,n,o=e;for(t in i)(n=i[t].split(/[\.\[\]]/)).unshift(e),o[t]=n.reduce(function(e,i){return e&&e[i]});return o}(e,this.mapping);this.collection=new u([]),this.collection.add(new m(t)),this._parent(e),Object.getPrototypeOf(this)._context=this}else this._parent(this.defaultOptions),Object.getPrototypeOf(this)._context=this},resize:function(e){var i=e.container.getDimensions().width;e.resizeInfo.width<i?E(e):e.resizeInfo.width>i&&g(e),e.resizeInfo.width=i},setup:function(e){var i=this,t=this;window.addEventListener("resize",function(){t.container.classList.contains("breadcrumb-container")&&t.resize(t)}),e.modelEvents&&e.modelEvents instanceof l&&(e.modelEvents.subscribe({event:"breadcrumb-hide"},function(){i.hide()}),e.modelEvents.subscribe({event:"breadcrumb-show"},function(){i.show()}),e.modelEvents.subscribe({event:"breadcrumb-reset"},function(){i.reset()}),e.modelEvents.subscribe({event:"breadcrumb-add-link"},function(e){i.addLink(e)}),e.modelEvents.subscribe({event:"breadcrumb-remove-link"},function(e){i.removeLink(e)}))},render:function(){this.container.addClassName("breadcrumb-container");var e={links:this.collection.toJSON()};this.container.setHTML(f(e)),this.container._breadCrumb=this,this.resizeInfo.width=this.container.getSize().width,this.resize(this);var i=e.links[0].toolTip,t=e.links[0].toolTipText,n=this.container.getElements(".breadcrumb-symbol")[0];return i&&""!==t&&this.addToolTip(n,t),this},onClick:function(e,i){for(var t=null,n=e.target.getAttribute("id"),o=i||n,s=0;s<this.collection.length&&"ellipsisLink"!==n;s++)if(o===this.collection.at(s).get("linkID")){t=this.collection.at(s).get("callback");var r=this.collection.at(s+1);r&&this.removeLink(r.get("linkID")),"function"==typeof t&&t();break}this.modelEvents&&this.modelEvents instanceof l&&this.modelEvents.publish({event:"breadcrumb-link-clicked",data:{linkID:n||e.target.getAttribute("data-id")}})},show:function(){this.container.show(),this.modelEvents&&this.modelEvents instanceof l&&this.modelEvents.publish({event:"breadcrumb-visible"})},hide:function(){this.container.hide(),this.modelEvents&&this.modelEvents instanceof l&&this.modelEvents.publish({event:"breadcrumb-hidden"})},addLink:function(e){var i=this.collection._prepareModel(e,{merge:!0});this.collection.add(i),this.modelEvents&&this.modelEvents instanceof l&&this.modelEvents.publish({event:"breadcrumb-link-added",data:{linkID:e.linkID}}),function(e,i){e.container.lastElementChild&&e.container.lastElementChild.removeAttribute("style"),e.resizeInfo.flexMode=!1;var t={links:{links:i.toJSON()}};e.container.addContent(f(t)),g(e)}(this,i)},addLinks:function(e){for(var i=0;i<e.length;i++)this.addLink(e[i])},removeLink:function(e){if(this.collection.length>1){var i,t=this.collection.findWhere({linkID:e});if(t){var n=this.collection.indexOf(t),o=this.collection.slice(n,this.collection.length);this.collection.remove(o),i=e}if(null==e)i=this.collection.pop().get("linkID");void 0!==i&&(this.modelEvents&&this.modelEvents instanceof l&&this.modelEvents.publish({event:"breadcrumb-link-removed",data:{linkID:i}}),function(e,i){i=i.replace(/([. ,/:?=&])/g,"\\$1");var t=e.container.getElement("#"+i);if(t&&"none"===t.style.display&&(e.resizeInfo.linkAfterEllipsisIdx=e.collection.length-1),t)for(var n=t.previousElementSibling;null!=n;){var o=n.nextElementSibling;"none"===n.style.display&&e.resizeInfo.ellpsisDropDown.removeItem(n.getAttribute("id")),n.parentNode.removeChild(n),n=o}1===e.collection.length&&(e.resizeInfo.linkAfterEllipsisIdx=a,e.resizeInfo.ellipsis=!1,e.resizeInfo.flexMode=!1),E(e)}(this,i))}},reset:function(){var e=this.collection.at(1);e&&this.removeLink(e.get("linkID")),this.modelEvents&&this.modelEvents instanceof l&&this.modelEvents.publish({event:"breadcrumb-reseted"})},addToolTip:function(e,i){new c({position:"bottom",target:e,body:i})}})});