define("DS/VCXWebInteropSMG/VCXSmgLoaderCrypto",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this.CRYPTO_DELTA=1754008087,this.strKEY="a??????bc??de????????fghi????jklmno????pqrstu??????vwxyzA??????BC??DE????????FGHI????JKLMNO????PQRSTU??VWXYZ0123456789",this.m_pKey=null,this.m_pKey=[0,0,0,0];for(var e=0;e<4;e++)this.m_pKey[e]=0},SetKey:function(e){if(4===e.length)for(var t=0;t<4;t++)this.m_pKey[t]=4294967295&e[t]},TEACodelong_A:function(e){if(2!==e.length)return[];for(var t=e[0],r=e[1],a=0,o=Math.floor(this.CRYPTO_DELTA),n=32;n-- >0;)a+=4294967295&o,r=r+(((t=t+((r<<4&4294967295)+this.m_pKey[0]&4294967295^r+a&4294967295^(r>>5&4294967295)+this.m_pKey[1]&4294967295)&4294967295)<<4&4294967295)+this.m_pKey[2]&4294967295^t+a&4294967295^(t>>5&4294967295)+this.m_pKey[3]&4294967295)&4294967295;return e[0]=t,e[1]=r,e},TEACode:function(e){if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)return this.TEACodelong_A(e);if("string"==typeof e||null===e)return this.TEACodejava_lang_String(e);throw new Error("invalid overload")},TEADecodelong_A:function(e){if(2!==e.length)return[];var t,r=32,a=e[0],o=e[1],n=Math.floor(this.CRYPTO_DELTA);for(t=n<<5&4294967295;r-- >0;)a=a-(((o=o-((a<<4&4294967295)+this.m_pKey[2]&4294967295^a+t&4294967295^((4294967295&a)>>>5)+this.m_pKey[3]&4294967295)&4294967295)<<4&4294967295)+this.m_pKey[0]&4294967295^o+t&4294967295^((4294967295&o)>>>5)+this.m_pKey[1]&4294967295)&4294967295,t-=n,t&=4294967295;return e[0]=a,e[1]=o,e},TEADecode:function(e){if(null!=e&&e instanceof Array&&(0==e.length||null==e[0]||"number"==typeof e[0])||null===e)return this.TEADecodelong_A(e);if("string"==typeof e||null===e)return this.TEADecodejava_lang_String(e);throw new Error("invalid overload")},TEACodejava_lang_String:function(e){var t=e;if(t.split("-").join(""),t.split("_").join(""),t.split(".").join(""),t.split("/").join(""),0===t.length)return"";if(0!==t.length%16)return"";t.toUpperCase();for(var r="";t.length>0;){var a=t.substring(0,Math.min(8,t.length));a=(a=t.substring(0,Math.min(16,t.length))).substring(t.length-8,t.length),this.TEACodelong_A([0,0]);r+=void 0,t.length<=16?t="":(t=a.substring(t.length-16,t.length),t+="-")}return r},TEADecodejava_lang_String:function(e){var t=e;if(t.split("-").join(""),t.split("_").join(""),t.split(".").join(""),t.split("/").join(""),0===t.length)return"";if(0!==t.length%16)return"";t.toUpperCase();for(var r="";t.length>0;){var a=t.substring(0,Math.min(8,t.length));a=(a=t.substring(0,Math.min(16,t.length))).substring(t.length-8,t.length),this.TEADecodelong_A([0,0]);r+=void 0,t.length<=16?t="":(t=a.substring(t.length-16,t.length),t+="-")}return r}})}),define("DS/VCXWebInteropSMG/VCXSmgXmlDataStorage",["UWA/Class"],function(e){"use strict";return e.extend({init:function(){this._bIsModifMapUpdated=!1,this._smgXmlDocument=null,this._smgXmlRelativePath=null,this._components=[],this._mapComponentGuids=new Map},SetSmgXmlDocument:function(e){e&&(this._bIsModifMapUpdated=!1,this._smgXmlDocument=e)},GetSmgXmlDocument:function(){return this._smgXmlDocument},SetSmgXmlRelativePath:function(e){e&&(this._smgXmlRelativePath=e)},GetSmgXmlRelativePath:function(){return this._smgXmlRelativePath},GetSmgXmlServerModifNode:function(){if(this._smgXmlDocument){var e=this._smgXmlDocument.Server;return this.getServerFromType(e,"CLitServerModifiable")[0]}},GetSmgXmlViewsNode:function(){if(this._smgXmlDocument){var e=this._smgXmlDocument.Server;return this.getServerFromType(e,"CLitList")}},GetSmgXmlPropertyDefinitions:function(){if(this._smgXmlDocument){var e=this._smgXmlDocument.Server;return this.getServerFromType(e,"PropertyDefinitions")}},AddComponent:function(e){e&&(this._bIsModifMapUpdated=!1,this._components.push(e))},GetComponents:function(){return this._components},GetComponentsMap:function(){return!1===this._bIsModifMapUpdated&&this.ComputeModifiablesMap(),this._mapComponentGuids},ComputeModifiablesMap:function(){for(var e=0;e<this._components.length;e++){var t=this._components[e];if(t){var r=t.GetGUID();this.GetChildrenAndFillMap(t,r)}}this._bIsModifMapUpdated=!0},GetChildrenAndFillMap:function(e,t){this._mapComponentGuids.set(t,e);for(var r=e.QueryInterface("VCXIModelNavigable").getChildren(),a=0;a<r.length;a++){var o=r[a];if(o){var n=o.QueryInterface("VCXIModifiable");if(n)if(e=n.GetObject()){var i=t+"."+e.GetGUID();this.GetChildrenAndFillMap(e,i)}}}},getServerFromType:function(e,t){for(var r=[],a=0;a<e.length;a++){var o=e[a];o["@attributes"].Type===t&&r.push(o)}return r}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderInflate",["UWA/Class","ZipJS/inflate"],function(e,t){"use strict";return e.extend({Inflate:function(e){var t=gztools.getZstream(),r=new Uint8Array(512),a=!1;t.inflateInit(),t.next_out=r;var o,n,i=[],s=0,l=0;if(0!==e.length){t.next_in_index=0,t.next_in=e,t.avail_in=e.length;do{if(t.next_out_index=0,t.avail_out=512,0!==t.avail_in||a||(t.next_in_index=0,a=!0),o=t.inflate(0),a&&-5===o)return-1;if(0!==o&&1!==o)break;if(t.next_out_index&&(512===t.next_out_index?i.push(new Uint8Array(r)):i.push(new Uint8Array(r.subarray(0,t.next_out_index))),l+=t.next_out_index,1===o))break}while(t.avail_in>0||0===t.avail_out);return n=new Uint8Array(l),i.forEach(function(e){n.set(e,s),s+=e.length}),n}}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderTools",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFrame","DS/VCXWebProperties/VCXPropertyValuePoint2D","DS/VCXWebProperties/VCXPropertyValuePoint","DS/VCXWebProperties/VCXPropertyValueLocation","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueDate","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebInteropSMG/VCXSmgLoaderCrypto","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG"],function(e,t,r,a,o,n,i,s,l,p,u,c,C,d,m,g,V,h,f,y){"use strict";var S=e.singleton({fillMatrix:function(e,r){var a=new t.Matrix4;if(void 0===e)return a;var o=e.Origin,n=e.VX,i=e.VY,s=e.VZ;if(void 0!==o&&void 0!==n&&void 0!==i){var l,p=new t.Vector3(parseFloat(n["@attributes"].X.replace(",",".")),parseFloat(n["@attributes"].Y.replace(",",".")),parseFloat(n["@attributes"].Z.replace(",","."))),u=new t.Vector3(parseFloat(i["@attributes"].X.replace(",",".")),parseFloat(i["@attributes"].Y.replace(",",".")),parseFloat(i["@attributes"].Z.replace(",",".")));!0===r||void 0===s?((l=new t.Vector3).crossVectors(p,u),p.normalize(),l.normalize(),u.crossVectors(l,p)):l=new t.Vector3(parseFloat(s["@attributes"].X.replace(",",".")),parseFloat(s["@attributes"].Y.replace(",",".")),parseFloat(s["@attributes"].Z.replace(",","."))),a.set(p.x,u.x,l.x,parseFloat(o["@attributes"].X.replace(",",".")),p.y,u.y,l.y,parseFloat(o["@attributes"].Y.replace(",",".")),p.z,u.z,l.z,parseFloat(o["@attributes"].Z.replace(",",".")),0,0,0,1)}return a},fillPropertyValue:function(e,f,S){var v=null;switch(f){case"VCXPropertyValueString":var b;if(v=new r,e["@attributes"]&&(b="1"===e["@attributes"].Crypted?y["Property.EncryptedValue"]:e["@attributes"].Value),e.Line)for(var P=0;P<e.Line.length;P++)b?b+="\n":b="",b+=e.Line[P]["@attributes"].Value;var X=b;v.SetValue(X);break;case"VCXPropertyValueColor":var A=e["@attributes"];v=new c;var M=new t.Color;M.setRGB(A.R/255,A.G/255,A.B/255),v.SetValue(M);break;case"VCXPropertyValueVector":v=new C;A=e["@attributes"];var I=new t.Vector3(parseFloat(A.X.replace(",",".")),parseFloat(A.Y.replace(",",".")),parseFloat(A.Z.replace(",",".")));v.SetValue(I);break;case"VCXPropertyValueFloat":v=new a;var D=e["@attributes"].Value;v.SetValue(parseFloat(D));break;case"VCXPropertyValueInt":v=new o;D=e["@attributes"].Value;v.SetValue(parseInt(D));break;case"VCXPropertyValueHyperlinkId":v=D=e["@attributes"].Value;break;case"VCXPropertyValueBoolean":v=new i;var L=!1;("true"===(D=e["@attributes"].Value)||parseInt(D)>0)&&(L=!0),v.SetValue(L);break;case"VCXPropertyValueFrame":var w=this.fillMatrix(e.Frame?e.Frame:e,!1);(v=new s).SetValue(w);break;case"VCXPropertyValuePoint2D":var x=e["@attributes"];(v=new l).SetValue(new t.Vector2(parseFloat(x.X.replace(",",".")),parseFloat(x.Y.replace(",","."))));break;case"VCXPropertyValuePoint":x=e["@attributes"];(v=new p).SetValue(new t.Vector3(parseFloat(x.X.replace(",",".")),parseFloat(x.Y.replace(",",".")),parseFloat(x.Z.replace(",","."))));break;case"VCXPropertyValueLocation":var B=this.fillMatrix(e.Frame,!1),_=this.fillMatrix(e.Pivot,!1);v=new u;var T=new s;T.SetValue(B),v.SetFrame(T);var F=new s;F.SetValue(_),v.SetPivot(F);break;case"VCXPropertyValueAnchor":B=this.fillMatrix(e.Frame,!0),v=new d;var G=new s;if(G.SetValue(B),v.SetValueFrame(G),void 0!==(A=e["@attributes"])){var W=A.AttachId,N=S.ComponentsMap.GetComponentFromID(W);N&&v.SetValueLinkFromComponent(N)}break;case"VCXPropertyValueEnum":v=new n;D=e["@attributes"].Value;v.SetValue(parseInt(D));break;case"VCXPropertyValueDate":x=e["@attributes"];var k=new Date(x.Year,x.Month-1,x.Day,x.Hour,x.Min,x.Sec);v=new m(k);break;case"VCXPropertyValueDocId":(v=new g(k)).SetValue(-1);break;case"VCXPropertyValueMap":v=new V;break;case"VCXPropertyValueFont":if(v=new h,x=e["@attributes"]){if(x.FaceName){var O=x.FaceName;"MS Shell Dlg"===O&&(O="Microsoft Sans Serif"),v.SetFamily(new r(O))}if(x.Height&&v.SetHeight(new a(-parseFloat(x.Height)/1.33333)),x.Weight&&v.SetWeight(new o(parseInt(x.Weight))),x.Italic){L=!1;("true"===x.Italic||parseInt(x.Italic)>0)&&(L=!0),v.SetItalic(new i(L))}if(x.Underline){L=!1;("true"===x.Underline||parseInt(x.Underline)>0)&&(L=!0),v.SetUnderline(new i(L))}if(x.StrikeOut){L=!1;("true"===x.StrikeOut||parseInt(x.StrikeOut)>0)&&(L=!0),v.SetCrossline(new i(L))}}}return v},getPropertiesDicoFromWebComponent:function(e){S._factory&&S._factory._mapComponentConverter||console.warn("Properties dictionary is not set");var t=S._factory._mapComponentConverter.get(e);return t?t.getPropertiesDescription():(console.warn("Can't find any property name translation"),null)},getPropertiesDicoFromWebType:function(e){if(!S._factory)return null;var t=S._factory.getV1Ids();if(!t)return null;for(var r in t)if(t[r]&&t[r].classname===e){var a=new t[r].classFcntName;return a?a.getPropertiesDescription():(console.warn("Can't find any property name translation"),null)}},getPropertiesDicoFromWebTypeWithInheritance:function(e){if(!S._factory||!S._factory._mapComponentConverter)return null;var t=S.getPropertiesDicoFromWebType(e);return S._factory._mapComponentConverter.forEach(function(r,a){a&&a.IsKindOf(e)&&r&&(t=UWA.extend(t,r.getPropertiesDescription()))}),t},getPropertiesDicoFromV1Type:function(e){if(!S._factory)return null;var t=S._factory.getV1Ids();if(!t)return null;var r=new t[e].classFcntName;return r?r.getPropertiesDescription():(console.warn("Can't find any property name translation"),null)},_getAnchorIds:function(e,t){var r=[];t.forEach(function(e,t){var a=e;if("VCXPropertyValueAnchor"===a.GetType()){var o=a.GetValue();o&&o[0].Value&&r.push(o[0].Value)}});var a=e.GetHashing();if(a){var o=e.ExperienceBase.getManager("VCXScenarioManager").GetNeutrals(a);if(o&&o._map)for(var n in o._map)if(o._map.hasOwnProperty(n)){var i=o.GetProperty(n).GetPropertyValue();if(i&&"VCXPropertyValueAnchor"===i.GetType()){var s=i.GetValue();s&&s[0].Value&&r.push(s[0].Value)}}}return r},getLinkedPropertyFromParent:function(e,t,r,a){var o="";if(o="$(#"+(t||"")+"#"+e+")",r.length){var n=a[r[0]];if(t){for(var i=n.QueryInterface("VCXIModelNavigable"),s=0;s<t;++s){if(!i){console.warn("Invalid string");break}i=i.getParent()}n=i.GetObject()}if(n){var l=S.getPropertiesDicoFromWebComponent(n);l&&l[e]&&(o=o.replace(e,l[e].name))}}return o},getNeutralPropertyValue:function(e,t){var r=null;if(!e)return r;var a=e.ExperienceBase.getManager("VCXScenarioManager").GetNeutrals(e.GetHashing());if(a&&a._map.hasOwnProperty(t)){var o=a.GetProperty(t);o&&(r=o.GetPropertyValue().GetValue())}return r},translateLinkedPropertyString:function(e,t,r,a,o,n){if(!e)return o;var i=this.getNeutralPropertyValue(t,"Collab.Text.LinkedProperty"),s=this.getNeutralPropertyValue(t,"Collab.Text.LinkedParentLevel");if(!o&&!r){if(!a)return"";r=i}a||(a=s);var l=e.ComponentsMap.GetComponentTable();if(!l)return o;var p="",u=this._getAnchorIds(t,n);if(u.length>0&&r&&"Text String"!==r)p=this.getLinkedPropertyFromParent(r,a,u,l);else if(o&&a&&u.length>0&&i&&"Text String"!==i)p=this.getLinkedPropertyFromParent(i,a,u,l);else if(o){p=o;var c=o.match(/([^$]|^)\$\(([0-9a-zA-Z.|_#-\s]*)\)+/g);if(c)for(var C=0;C<c.length;++C){var d=c[C];if(d){var m=d.substring(d.indexOf("(")+1,d.lastIndexOf("#")),g=d.substring(d.lastIndexOf("#")+1,d.length-1),V=l[m],h=""!==m&&!isNaN(m);if(V||h){for(var f="",y=0;y<d.length&&"$"!==d[y];)f+=d[y++];if(f+="$(",V?f+=m+"#0":h&&(f+="#"+m),f+="#"+g+")",V||(V=u.length?l[u[0]]:t.GetObject()),V){var v=S.getPropertiesDicoFromWebComponent(V),b=v&&v[g]?v[g].name:null;if(!b){var P=e.getManager("VCXMetaPropertyManager");(P&&P._MetaPropertyDef?P._MetaPropertyDef[g]:null)&&(b=g)}b?(f=f.replace(g,b),p=p.replace(d,f)):(p=p.replace(d," ? "),console.log("Warning : a property referenced by collab string : "+g+" doesn't exist - Check if property is imported"))}}else console.log("VCXSmgLoaderTools.translateLinkedPropertyString : Regex problem")}}}else!o&&r&&"Text String"===r&&(p=" ");return p},_reflectCRC:function(e,t){for(var r=0,a=1;a<t+1;a++)0!=(1&e)&&(r|=1<<t-a),e>>=1,e&=4294967295;return r},calcCRC:function(e){var t=e.length;if(0===e.length||0===t)return 0;for(var r=function(e){for(var t=[];e-- >0;)t.push(0);return t}(256),a=0;a<=255;a++){r[0|a]=this._reflectCRC(a,8)<<24&4294967295;for(var o=0;o<8;o++)r[a]=4294967295&(r[a]<<1&4294967295^(0!=(-2147483648&r[a]&4294967295)?79764919:0));r[a]=this._reflectCRC(r[a],32)}var n=-1,i=e,s=n;for(a=0;t-- >0;){var l=0|s,p=l>>>8,u=255&l,c=i[a++],C=255&(u^c)|0,d=r[C];s=4294967295&(p^d),t-- >0&&(s=4294967295&((p=(l=0|s)>>>8)^(d=r[C=255&((u=255&l)^(c=0))|0])))}var m=4294967295^(n=s);return m<0?m>>>0:m},_ulong:function(e){return e<0?e>>>0:e},decodeOptions:function(e,t){var r=this._ulong(t),a=[];a[0]=305419896,a[1]=591751049|r,a[2]=878082192,a[3]=247375429;for(var o=[],n=0;n<e.length;n++)o[n]=4294967295&e[n];var i=new f;i.SetKey(a);var s=i.TEADecode(o),l=0,p=s[1]&r;return p!==r&&p!==s[1]||(l=s[0]),this._ulong(l)},loadXMLString:function(e){var t;window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e));return t},xmlToJson:function(e){var t={};if(1===e.nodeType){if(e.attributes.length>0){t["@attributes"]={};for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);t["@attributes"][a.nodeName]=a.nodeValue}}}else 3===e.nodeType&&(t=e.nodeValue);if(e.hasChildNodes())for(var o=0;o<e.childNodes.length;o++){var n=e.childNodes.item(o),i=n.nodeName;if(void 0===t[i])t[i]=this.xmlToJson(n);else{if(void 0===t[i].push){var s=t[i];t[i]=[],t[i].push(s)}t[i].push(this.xmlToJson(n))}}return t},RelativeToAbsolute:function(e,t){for(var r=e.split("/"),a=t.split("/"),o=0;o<a.length;o++)"."!=a[o]&&".."!=a[o]&&r.push(a[o]);return r.join("/")}});return S}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueEnum","DS/WebRBTree/WebRBIterator"],function(e,t,r,a,o,n){"use strict";var i={"Actor.Name":{name:"Actor.Name",type:"VCXPropertyValueString"},"Text.StayOnTop":{name:"Actor.IsAlwaysOnTop",type:"VCXPropertyValueBoolean"},"Actor.ToolTip":{name:"Actor.ToolTip",type:"VCXPropertyValueString"},"Actor.LinkedToolTipPropertyName":{name:null,type:"VCXPropertyValueString"},Link:{name:"Actor.Hyperlink",type:"VCXPropertyValueHyperlinkId"},"Actor.Color":{name:"Actor.Color",type:"VCXPropertyValueColor"},"Actor.Alpha":{name:"Actor.Opacity",type:"VCXPropertyValueFloat"},"Actor.Location":{name:"Actor.Position",type:"VCXPropertyValueLocation"},"Actor.Interpolator.Location":{name:"Actor.Interpolation.Type",type:"VCXPropertyValueEnum"},"Actor.BomId":{name:"Actor.BomId",type:"VCXPropertyValueString"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},i)},getPropertiesMap:function(e,o,s,l,p){var u=new Map,c=null,C=null;for(var d in s){var m=s[d],g=i[d];if(g){var V=t.fillPropertyValue(m,g.type,o);switch(d){case"Actor.ToolTip":c=V.Value,V=null;break;case"Actor.LinkedToolTipPropertyName":C=V.Value;break;case"Actor.Color":if(void 0!==m["@attributes"]){var h=new r,f=m["@attributes"].Defined;h.SetValue("0"!==f),u.set("Actor.Color.Defined",h),V._bDefined="0"!==f}break;case"Actor.Alpha":V.Value/=255;break;case"Actor.Interpolator.Location":if(void 0!==m["@attributes"]&&void 0!==m["@attributes"].Value)switch(parseInt(m["@attributes"].Value)){case 0:V.SetValue(0);break;case 2:case 4:V.SetValue(1);break;default:V.SetValue(0)}else V=null;break;case"Actor.BomId":"string"!=typeof V.Value&&(V=null);break;case"Link":var y=t.fillPropertyValue(m,"VCXPropertyValueHyperlinkId",o),S=null;if(y.indexOf("file://")>=0){var v=y.lastIndexOf("\\"),b=y.substring(v+1),P=l[b.toLowerCase()];P&&(S=o.getManager("VCXDocManager").BuildPathFromString(P,b))}else if(y)if(y.indexOf("view://")>=0){var X=y.substring(7);S=o.getManager("VCXDocManager").BuildPathFromLink(X)}else if(y.indexOf("previous://")>=0||y.indexOf("next://")>=0||y.indexOf("first://")>=0||y.indexOf("last://")>=0){v=y.indexOf("ref:");var A=y.substring(v+4);y="scenario://"+A,S=o.getManager("VCXDocManager").BuildPathFromString(y,"")}else if(y.indexOf("http://")>=0||y.indexOf("https://")>=0||y.indexOf("ftp://")>=0)S=o.getManager("VCXDocManager").BuildPathFromString(y,"");else{var M=o.getManager("VCXSequenceManager").GetListSequencesFromType(0)[0].GetListScenariosId()[0],I=o.ComponentsMap.GetComponentFromID(M),D=null,L="";y.indexOf("play://")>=0?(D=2,L=y.substring(7)):y.indexOf("marker://")>=0?(D=3,L=y.substring(9)):y.indexOf("playmarkersequence://")>=0&&(D=4,L=y.substring(21));var w=I.GetTrackMarkers();if(w)for(var x=w._treekeys,B=new n(x),_=B.next();null!==_;){var T=_.GetValue(),F=o.ComponentsMap.GetComponentFromID(T);if(F)if(F.GetName()===L){S=o.getManager("VCXDocManager").BuildPathFromLink(T,D);break}_=B.next()}S||2!==D&&4!==D||(S=o.getManager("VCXDocManager").BuildPathFromLink(M,D))}V=o.getManager("VCXDocManager").AddOrModifyHyperlink(S)}g.name&&V&&u.set(g.name,V)}else if("Meta."===d.slice(0,5)){var G=o.getManager("VCXMetaPropertyManager").GetMetaPropertyDef(d);if(G)(V=t.fillPropertyValue(m,G.GetType(),o))?u.set(d,V):console.log("smgloader : meta fillPropertyValue FAILED");else console.log("smgloader : meta property def NOT FOUND")}}if(C||c){var W;if(C&&"Label String"!==C){var N="";C.startsWith("niveau ")>0?(N=C.substring(7),C="Actor.Name"):C.startsWith("level ")>0&&(N=C.substring(6),C="Actor.Name"),W="$(#"+N+"#"+C+")"}else W=c;if(W){W=W.replace("Actor.Alpha","Actor.Opacity");var k=new a;k.Value=W,u.set("Actor.ToolTip",k)}}return u}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable"],function(e,t,r){"use strict";var a={};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable"],function(e,t,r){"use strict";var a={"Actor.LayerOpacity":{name:"Actor.LayerOpacity",type:"VCXPropertyValueFloat"},"Actor.Rendering":{name:"Actor.Rendering",type:"VCXPropertyValueEnum"},"Actor.Priority":{name:"Actor.Priority",type:"VCXPropertyValueEnum"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);switch(l){case"Actor.LayerOpacity":c.Value/=256}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueBoolean","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG"],function(e,t,r,a,o,n){"use strict";var i=0,s=1,l=2,p=3,u=!1,c={"Actor.Color":{name:"Arrow.Body.Color",type:"VCXPropertyValueColor"},"ActorArrow.Bg.Opacity":{name:"Arrow.Body.Color.Opacity",type:"VCXPropertyValueFloat"},"Actor.Gradient":{name:null,type:"VCXPropertyValueBoolean"},"ActorArrow.Border":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"ActorArrow.Border.Type":{name:"Collab.Border.Line.Type",type:"VCXPropertyValueEnum"},"ActorArrow.Border.Width":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"ActorArrow.Border.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"ActorArrow.Border.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"Actor.Thickness":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"Actor.Thickness2":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"ActorArrow.Thickness":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"ActorArrow.Thickness2":{name:"Arrow.Width.1",type:"VCXPropertyValueFloat"},"ActorArrow.Extremity":{name:null,type:"VCXPropertyValueInt"},"ActorArrow.Extremity.Head":{name:null,type:"VCXPropertyValueFloat"},"ActorArrow.Extremity.x":{name:null,type:"VCXPropertyValueFloat"},"ActorArrow.Extremity.y":{name:null,type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),c)},getPropertiesMap:function(e,r,C,d,m){var g=this._parent(e,r,C,d,m),V=!1,h=!1,f=!1,y=!1,S=!1,v=!1;if(!0===(C["ActorArrow.OldVersion"]&&C["ActorArrow.OldVersion"]["@attributes"]&&"1"===C["ActorArrow.OldVersion"]["@attributes"].Value)&&C["Actor.Thickness"]&&!e.bIsOldVersion&&(g.set("Collab.Is.Paper",new o(!0)),e.bIsOldVersion=!0,!u)){var b={level:"warning",title:n["Notification.ArrowOldVersion.Title"],message:n["Notification.ArrowOldVersion.Msg"]};r.getManager("VCXNotificationManager").addNotification(b),u=!0}for(var P in C){var X=c[P];if(X){var A=C[P],M=t.fillPropertyValue(A,X.type,r);switch(P){case"Actor.Color":v=!0,e.bodyColorPropVal=M.Clone(),g.set("Arrow.Body.2.Color",M);break;case"ActorArrow.Bg.Opacity":v=!0,M.Value/=255,e.bodyOpacity=M.Value,g.set("Arrow.Body.2.Color.Opacity",M);break;case"Actor.Gradient":v=!0,e.gradient=M.Value;break;case"ActorArrow.Border.Color":e.borderColorPropVal=M.Clone(),g.set("Collab.Border.Line.2.Color",M);break;case"ActorArrow.Border.Opacity":M.Value/=255,e.borderOpacity=M.Value,g.set("Collab.Border.Line.2.Color.Opacity",M);break;case"Actor.Thickness":if(!e.bIsOldVersion){M=null;break}M.SetValue(.25*M.GetValue()),g.set("Arrow.Width.2",M),e.smgThickness=M.Value,e.smgExtremityHead=2*e.smgThickness,e.smgExtremityX=0,e.smgPreviousExtremityY=e.smgThickness,S=!0,h=!0,f=!0,y=!0;break;case"Actor.Thickness2":if(e.bIsOldVersion)break;S=!0,e.smgThickness=M.Value,g.set("Arrow.Width.2",M);break;case"ActorArrow.Extremity":v=!0,S=!0,V=!0,e.smgExtremity=M.Value;break;case"ActorArrow.Extremity.Head":if(e.bIsOldVersion)break;S=!0,h=!0,f=!0,e.smgExtremityHead=M.Value;break;case"ActorArrow.Extremity.x":if(e.bIsOldVersion)break;S=!0,f=!0,e.smgExtremityX=M.Value;break;case"ActorArrow.Extremity.y":if(e.bIsOldVersion)break;S=!0,y=!0,e.smgPreviousExtremityY=M.Value}X.name&&M&&g.set(X.name,M)}}if(S){var I=null,D=null,L=null,w=null,x=null,B=null,_=new o,T=new o;"number"==typeof e.smgPreviousExtremityY&&"number"==typeof e.smgThickness&&(e.smgExtremityY=e.smgPreviousExtremityY-.5*e.smgThickness);var F=e.smgExtremityHead,G=e.smgExtremityY,W=-e.smgExtremityHead*e.smgExtremityX;switch(void 0!==e.smgExtremityHead&&(I=new a(F),D=new a(F)),void 0!==e.smgExtremityY&&(L=new a(G),w=new a(G)),void 0!==e.smgExtremityX&&(x=new a(W),B=new a(W)),e.smgExtremity){case i:_.SetValue(!0),T.SetValue(!1);break;case s:_.SetValue(!1),T.SetValue(!0);break;case l:_.SetValue(!0),T.SetValue(!0);break;case p:_.SetValue(!1),T.SetValue(!1)}V&&(g.set("Arrow.Head.ShowMode",_),g.set("Arrow.Head.2.ShowMode",T)),h&&(g.set("Arrow.Head.Length",I),g.set("Arrow.Head.2.Length",D)),y&&(g.set("Arrow.Head.Size",L),g.set("Arrow.Head.2.Size",w)),f&&(g.set("Arrow.Head.Shape",x),g.set("Arrow.Head.2.Shape",B))}if(v&&e.gradient){var N=new a(0);switch(e.smgExtremity){case i:g.set("Arrow.Body.2.Color.Opacity",N),g.set("Collab.Border.Line.2.Color.Opacity",N);break;case s:g.set("Arrow.Body.Color.Opacity",N),g.set("Collab.Border.Line.Color.Opacity",N)}}return g}})}),define("DS/VCXWebInteropSMG/VCXSmgGeomLoader",["UWA/Class","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXWebInteropSMG/VCXSmgLoaderInflate","DS/VCXWebKernelTools/VCXMeshServices","DS/VCXWebKernelTools/VCXLogServices","DS/VCXWebKernel/VCXDRMManager"],function(e,t,r,a,o,n,i,s){"use strict";var l=0,p=8449,u=7681,c=8448,C=260,d=3042,m=34160,g=34683,V=0,h=0,f=3;return e.extend({init:function(e){this._geoms=new Map,this._experienceBase=e,this._materialManager=this._experienceBase?this._experienceBase.getManager("VCXMaterialManager"):null,this.resources=null,this.outlines=null,this.alwaysBuildIndexedTrianglesSets=!0,this.alwaysBuildIndexedLinesSets=!0,this.ignoreGeodeMatrix=!0,this.mergeGeosets=!0,this.positionInBuffer=0,this.bufferSize=0,this.version=0,this.strFileNameAssociate="",this.checksum=0,this.ulOptionsPro=[],this.ulWatermark=[],this.ulHasExpirationDate=[],this.ulStartDate=[],this.ulEndDate=[],this.ulIsRelativeExpirationDate=[],this.bHasNormals=!1,this.cCodage=100,this.ulHasSignature=0,this.strSignaturePicturePath="",this.strAgreement="",this.ulAgreementMode=0,this.ulSignatureCRC=[],this.bHasTexture=!1,this.nTriangles=0},openZStream:function(e){if(!(e.length<=10)&&e instanceof Uint8Array){if(31===e[0]&&139===e[1]){for(var t=new Uint8Array(e.length-10),r=0;r<e.length-10;r++)t[r]=e[r+10];var a=(new o).Inflate(t),n=new ArrayBuffer(a.length),i=new Uint8Array(n);for(r=0;r<a.length;r++)i[r]=a[r];var s=new DataView(n);return this.positionInBuffer=0,this.bufferSize=s.byteLength,s}}else console.log("smgGeom : Invalid bytes")},setIgnoreGeodeMatrix:function(e){this.ignoreGeodeMatrix=e},setResources:function(e){void 0!==e&&(this.resources=e)},setOutlines:function(e){void 0!==e&&(this.outlines=e)},getMapGeodes:function(){return this._geoms},getBool:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=0!==e.getInt8(this.positionInBuffer);return this.positionInBuffer+=1,t}},getChar:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getInt8(this.positionInBuffer);return this.positionInBuffer+=1,t}},getWChar:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getInt16(this.positionInBuffer,!0);return this.positionInBuffer+=2,t}},getWString:function(e){for(var t="",r=this.getWChar(e);0!==r&&10!==r&&void 0!==r;)t+=String.fromCharCode(r),r=this.getWChar(e);return{value:t,byteSize:2*t.length}},getString:function(e){var t="",r=0;if(this.version<6.7){for(var a=this.getChar(e);0!==a&&10!==a&&void 0!==a;)t+=String.fromCharCode(a),a=this.getChar(e);r=t.length}else{for(a=this.getWChar(e);0!==a&&10!==a&&void 0!==a;)t+=String.fromCharCode(a),a=this.getWChar(e);r=2*t.length}return{value:t,byteSize:r}},getUnsignedChar:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getUint8(this.positionInBuffer);return this.positionInBuffer+=1,t}},getCharArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Int8Array(t),a=0;a<t;a++){var o=e.getInt8(this.positionInBuffer);this.positionInBuffer+=1,r[a]=o}return r}},getUnsignedInt8Array:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint8Array(t),a=0;a<t;a++){var o=e.getUint8(this.positionInBuffer);this.positionInBuffer+=1,r[a]=o}return r}},getUnsignedInt16Array:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint16Array(t),a=0;a<t;a++){var o=e.getUint16(this.positionInBuffer,!0);this.positionInBuffer+=2,r[a]=o}return r}},getDouble:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getFloat64(this.positionInBuffer,!0);return this.positionInBuffer+=8,t}},getFloat:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getFloat32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getLong:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getInt32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getUnsignedInt:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getUint32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getUnsignedLong:function(e){if(!(this.positionInBuffer>=this.bufferSize)){var t=e.getUint32(this.positionInBuffer,!0);return this.positionInBuffer+=4,t}},getUnsignedIntArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint32Array(t),a=0;a<t;a++){var o=e.getUint32(this.positionInBuffer,!0);this.positionInBuffer+=4,r[a]=o}return r}},getUnsignedLongArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Uint32Array(t),a=0;a<t;a++){var o=e.getUint32(this.positionInBuffer,!0);this.positionInBuffer+=4,r[a]=o}return r}},getFloatArray:function(e,t){if(!(this.positionInBuffer>=this.bufferSize)){for(var r=new Float32Array(t),a=0;a<t;a++){var o=e.getFloat32(this.positionInBuffer,!0);this.positionInBuffer+=4,r[a]=o}return r}},ReadMat:function(e){var r=this.getFloatArray(e,16),a=new t.Matrix4;return a.set(r[0],r[4],r[8],r[12],r[1],r[5],r[9],r[13],r[2],r[6],r[10],r[14],0,0,0,1),a},ReadMatrix:function(e){var r=this.getChar(e);if(void 0===r||!r)return!1;var a=this.getFloatArray(e,16),o=new t.Matrix4;return o.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],0,0,0,1),{hasTransfo:r,matrix:o}},DecodeFloat8:function(e,t,r){return e*(1-r/255)+t*(r/255)},DecodeFloat16:function(e,t,r){return e*(1-r/65535)+t*(r/65535)},ReadTabSglVec2f:function(e,t,r){var a=this.getChar(e);if(97!==a){var o=this.getFloat(e),n=this.getFloat(e),i=this.getFloat(e),s=this.getFloat(e);if(98===a)for(l=this.getUnsignedInt16Array(e,2*t),p=0;p<t;p++){u=2*p,c=this.DecodeFloat16(o,n,l[u++]),C=this.DecodeFloat16(i,s,l[u++]);r[2*p]=c,r[2*p+1]=C}else if(99===a)for(l=this.getUnsignedInt8Array(e,2*t),p=0;p<t;p++){u=2*p,c=this.DecodeFloat8(o,n,l[u++]),C=this.DecodeFloat8(i,s,l[u++]);r[2*p]=c,r[2*p+1]=C}}else for(var l=this.getFloatArray(e,2*t),p=0;p<t;p++){var u=2*p,c=l[u++],C=l[u++];r[2*p]=c,r[2*p+1]=C}},GetTabVector8:function(e,t,r,a,o,n,i,s,l,p,u,c,C,d,m){var g=0;if(a||o||n)for(V=0;V<t;V++)a?r[g++]=i:(r[g++]=this.DecodeFloat8(p,u,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1),o?r[g++]=s:(r[g++]=this.DecodeFloat8(c,C,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1),n?r[g++]=l:(r[g++]=this.DecodeFloat8(d,m,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1);else for(var V=0;V<t;V++)r[g++]=this.DecodeFloat8(p,u,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1,r[g++]=this.DecodeFloat8(c,C,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1,r[g++]=this.DecodeFloat8(d,m,e.getUint8(this.positionInBuffer,!0)),this.positionInBuffer+=1},GetTabVector16:function(e,t,r,a,o,n,i,s,l,p,u,c,C,d,m){var g=0;if(a||o||n)for(V=0;V<t;V++)a?r[g++]=i:(r[g++]=this.DecodeFloat16(p,u,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2),o?r[g++]=s:(r[g++]=this.DecodeFloat16(c,C,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2),n?r[g++]=l:(r[g++]=this.DecodeFloat16(d,m,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2);else for(var V=0;V<t;V++)r[g++]=this.DecodeFloat16(p,u,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2,r[g++]=this.DecodeFloat16(c,C,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2,r[g++]=this.DecodeFloat16(d,m,e.getUint16(this.positionInBuffer,!0)),this.positionInBuffer+=2},GetTabVector32:function(e,t,r,a,o,n,i,s,l){var p=0;if(a||o||n)for(u=0;u<t;u++)a?r[p++]=i:(r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4),o?r[p++]=s:(r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4),n?r[p++]=l:(r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4);else for(var u=0;u<t;u++)r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4,r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4,r[p++]=e.getFloat32(this.positionInBuffer,!0),this.positionInBuffer+=4},ReadIndex:function(e,t,r){if(r<256){for(var a=this.getUnsignedInt8Array(e,t),o=new Uint16Array(a.length),n=0;n<a.length;++n)o[n]=a[n];return o}return r<65536?this.getUnsignedInt16Array(e,t):this.getUnsignedIntArray(e,t)},ReadTabSglVec3f:function(e,t,r){var a=this.getChar(e),o=this.getBool(e),n=this.getBool(e),i=this.getBool(e),s=0,l=0,p=0;if(o&&(0,s=this.getFloat(e)),n&&(l=this.getFloat(e),0),i&&(p=this.getFloat(e),0),97!==a){var u=0,c=0,C=0,d=0,m=0,g=0;o||(u=this.getFloat(e),c=this.getFloat(e)),n||(C=this.getFloat(e),d=this.getFloat(e)),i||(m=this.getFloat(e),g=this.getFloat(e)),98===a?this.GetTabVector16(e,t,r,o,n,i,s,l,p,u,c,C,d,m,g):99===a&&this.GetTabVector8(e,t,r,o,n,i,s,l,p,u,c,C,d,m,g)}else this.GetTabVector32(e,t,r,o,n,i,s,l,p)},ReadTriangleSet:function(e,t,r,o){var i=this.getUnsignedInt(e),s=3*i,l=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,l);var p=null;if(this.getUnsignedInt(e)!==h&&(p=new Float32Array(3*s),this.ReadTabSglVec3f(e,s,p)),this.version>=6.8)this.getUnsignedInt(e);for(var u=n.allocIndexationArray(s,s),c=0;c<s;c++)u[c]=c;return p||(p=n.computeSmoothNormalsTrianglesSet(l,u)),this.nTriangles+=i,{meshType:a.ConnectivityTypeEnum.TRIANGLES,nTriangles:i,vertexArray:l,normalsArray:p,uvArray:null,vertexIndexArray:u,normalsIndexArray:u,uvIndexArray:null,uniqueIndexation:!0,colorRGBA:new a.Color(t[0],t[1],t[2],r)}},ReadIndexedTriangleSet:function(e,r,o,i){var s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=new Float32Array(3*l);this.ReadTabSglVec3f(e,l,u);var c=this.ReadIndex(e,p,l),C=null,d=null,m=0;if(this.getUnsignedInt(e)!==h){m=this.getUnsignedInt(e);C=new Float32Array(3*m);this.ReadTabSglVec3f(e,m,C),d=this.ReadIndex(e,p,m)}else m=l,C=n.computeSmoothNormalsTrianglesSet(u,c),d=c;var g=[],V=null;if(this.version>=6.8){var y=this.getUnsignedInt(e);if(y){for(var S=this.getUnsignedInt(e),v=0;v<y;++v){if(this.getUnsignedInt(e)===f){var b=new Float32Array(2*l);this.ReadTabSglVec2f(e,l,b),g.push(b)}}V=this.ReadIndex(e,p,S);g.length&&i}}if(l!==m){console.warn("Indexed triangles set geometry should use the same indexation buffer for vertices and normals");for(var P=3*s,X=new Float32Array(3*P),A=new Float32Array(3*P),M=P<65536?new Uint16Array(P):new Uint32Array(P),I=0,D=0;D<P;++D){var L=3*c[D],w=u[L],x=u[L+1],B=u[L+2],_=C[L=3*d[D]],T=C[L+1],F=C[L+2];X[I]=w,X[I+1]=x,X[I+2]=B,A[I]=_,A[I+1]=T,A[I+2]=F,I+=3,M[D]=D}u=X,C=A,c=M,d=M}var G=this.resources&&this.resources.length?this.resources[i[0]]:null;return this.nTriangles+=s,{meshType:a.ConnectivityTypeEnum.TRIANGLES,nTriangles:s,vertexArray:u,normalsArray:C,uvArray:g.length?g[0]:null,vertexIndexArray:c,normalsIndexArray:d,uvIndexArray:g.length?V:null,uniqueIndexation:!1,colorRGBA:new a.Color(r[0],r[1],r[2],o),material:this._materialManager.getMaterialPhong((new t.Color).setRGB(r[0],r[1],r[2]),o,g.length?G:null)}},ReadIndexedTriangleStripSet:function(e,r,o,i){var s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=this.getUnsignedInt(e),c=new Float32Array(3*l);this.ReadTabSglVec3f(e,l,c);var C=this.ReadIndex(e,p,l),d=null,m=null,g=0,V=this.getUnsignedInt(e);if(V!==h){g=this.getUnsignedInt(e);d=new Float32Array(3*g);this.ReadTabSglVec3f(e,g,d),m=this.ReadIndex(e,p,g)}for(var f=this.ReadIndex(e,s,u),y=0,S=0;S<s;S++)y+=f[S]-2;if(V!==h||(g=l,d=n.computeSmoothNormalsStripSet(c,C,f),m=C),this.version>=6.8)this.getUnsignedInt(e);console.warn("[VCXSmgGeomLoader] : Geometry read from smgGeom should use the same indexation buffer for vertices and normals, convert to mono-indexation"),l=3*y;for(var v=n.allocIndexationArray(l,l),b=0;b<l;b++)v[b]=b;for(var P=new Float32Array(3*l),X=new Float32Array(3*l),A=0,M=0,I=0,D=0;D<s;++D){var L=f[D];for(b=0;b<L-2;++b){var w=3*C[M+b],x=3*m[M+b];P[A]=c[w],P[A+1]=c[w+1],P[A+2]=c[w+2],X[A]=d[x],X[A+1]=d[x+1],X[A+2]=d[x+2],A+=3,1&b?(w=3*C[M+b+2],x=3*m[M+b+2],P[A]=c[w],P[A+1]=c[w+1],P[A+2]=c[w+2],X[A]=d[x],X[A+1]=d[x+1],X[A+2]=d[x+2],A+=3,w=3*C[M+b+1],x=3*m[M+b+1],P[A]=c[w],P[A+1]=c[w+1],P[A+2]=c[w+2],X[A]=d[x],X[A+1]=d[x+1],X[A+2]=d[x+2],A+=3):(w=3*C[M+b+1],x=3*m[M+b+1],P[A]=c[w],P[A+1]=c[w+1],P[A+2]=c[w+2],X[A]=d[x],X[A+1]=d[x+1],X[A+2]=d[x+2],A+=3,w=3*C[M+b+2],x=3*m[M+b+2],P[A]=c[w],P[A+1]=c[w+1],P[A+2]=c[w+2],X[A]=d[x],X[A+1]=d[x+1],X[A+2]=d[x+2],A+=3),I++}M+=L}return this.nTriangles+=I,{meshType:a.ConnectivityTypeEnum.TRIANGLES,nTriangles:I,vertexArray:P,normalsArray:X,uvArray:null,vertexIndexArray:v,normalsIndexArray:v,uvIndexArray:null,uniqueIndexation:!0,colorRGBA:new a.Color(r[0],r[1],r[2],o),material:this._materialManager.getMaterialPhong((new t.Color).setRGB(r[0],r[1],r[2]),o,null)}},ReadMonoIndexedTriangleStripSet:function(e,t,r,o){var i=this.getUnsignedInt(e),s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=this.getUnsignedInt(e),u=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,u);var c=this.getUnsignedInt(e),C=null;if(c!==h){C=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,C)}for(var d=this.ReadIndex(e,l,s),m=this.ReadIndex(e,i,p),g=0,V=0;V<i;V++)g+=m[V]-2;c===h&&(C=n.computeSmoothNormalsStripSet(u,d,m));var y=[];if(this.version>=6.8){var S=this.getUnsignedInt(e);if(S&&S>=0&&S<=2){for(var v=0;v<S;++v){if(this.getUnsignedInt(e)===f){var b=new Float32Array(2*s);this.ReadTabSglVec2f(e,s,b),y.push(b)}}y.length&&o}}this.resources&&this.resources.length&&this.resources[o[0]];return this.nTriangles+=g,{meshType:a.ConnectivityTypeEnum.TRIANGLE_STRIP,nStrips:i,vertexArray:u,normalsArray:C,uvArray:y.length?y[0]:null,vertexIndexArray:d,normalsIndexArray:d,uvIndexArray:y.length?d:null,uniqueIndexation:!0,lengthsArray:m,colorRGBA:new a.Color(t[0],t[1],t[2],r)}},ReadLineStripSet:function(e,t,r,o){this.getFloat(e);var i=this.getUnsignedInt(e),s=this.getUnsignedInt(e),l=this.getUnsignedInt(e),p=new Float32Array(3*s);this.ReadTabSglVec3f(e,s,p);var u=this.ReadIndex(e,i,l),c=0;u&&(c=u.length);for(var C=0,d=0;d<c;++d)C+=u[d];var m=n.allocIndexationArray(C,C);for(d=0;d<C;d++)m[d]=d;return{meshType:a.ConnectivityTypeEnum.LINE_STRIP,nStrips:c,vertexArray:p,normalsArray:null,uvArray:null,lengthsArray:u,vertexIndexArray:m,normalsIndexArray:null,uvIndexArray:null,uniqueIndexation:!0,edgeType:o,colorRGBA:new a.Color(t[0],t[1],t[2],r),thickness:1,material:null}},ReadPointSet:function(e,t,r){this.getFloat(e);var o=this.getUnsignedInt(e),i=new Float32Array(3*o);this.ReadTabSglVec3f(e,o,i);for(var s=n.allocIndexationArray(i.size,i.size),l=0;l<i.size;l++)s[l]=l;return{meshType:a.ConnectivityTypeEnum.POINTS,nStrips:o,vertexArray:i,normalsArray:null,uvArray:null,lengthsArray:null,vertexIndexArray:s,normalsIndexArray:null,uvIndexArray:null,uniqueIndexation:!0,colorRGBA:new a.Color(t[0],t[1],t[2],r),thickness:1,material:null}},ReadGeodeUserData:function(e){var t={strId:"",idLayer:-1,strAssemblyName:"",strIssuedFrom:"",volume:-1,area:-1,ucGeometryType:0,fCofG:[],fInertiaAxes:[]};if(this.version<1.1)return t;var r=2;this.version<6.7&&(r=1);var a=this.getUnsignedInt(e),o=0;if(a>o){var n=this.getString(e);t.strId=n.value,this.version<6.7&&n.byteSize>0?o+=n.byteSize*r+r:o+=t.strId.length*r+r}else t.strId="-1";if(a>o&&(t.idLayer=this.getLong(e),o+=4),a>o){n=this.getString(e);t.strAssemblyName=n.value,this.version<6.7&&n.byteSize>0?o+=n.byteSize*r+r:o+=t.strAssemblyName.length*r+r}if(a>o&&(t.volume=this.getFloat(e),o+=4),a>o&&(t.area=this.getFloat(e),o+=4),a>o&&(t.fCofG=this.getFloatArray(e,3),o+=12),a>o&&(t.fInertiaAxes=this.getFloatArray(e,9),o+=36),a>o&&(t.ucGeometryType=this.getUnsignedChar(e),o+=1),a>o){n=this.getString(e);t.strIssuedFrom=n.value,this.version<6.7&&n.byteSize>0?o+=n.byteSize*r+r:o+=t.strIssuedFrom.length*r+r}var i=1;a>o&&(i=this.getUnsignedInt(e),o+=4);var s=a-o;if(s>0)this.getCharArray(e,s);return{userdata:t,nbLOD:i}},ReadFace:function(e,r,o){this.getString(e).value;this.version>=.8&&this.version<.9?this.getLong(e).ToString():this.getString(e).value;var i=this.getFloatArray(e,3),s=(this.getFloatArray(e,3),this.getFloatArray(e,3),this.getFloat(e),this.getFloat(e)),h=0,f=[],y=[],S=[],v=[],b=[],P=[],X=[];if(this.version>=6.8){var A=0,M=this.getUnsignedInt(e);if(M>A&&(h=this.getUnsignedInt(e),A+=4),h<=2){for(var I=0;I<h;I++){var D;if(M>A)A+=2*(D=this.getString(e).value).length+2;f.push(D.replace(/^.*[\\\/]/,""))}for(I=0;I<h;I++){var L=new t.Matrix4;M>A&&(L=this.ReadMat(e),A+=64),y.push(L)}for(I=0;I<h;I++){var w=l;M>A&&(w=this.getChar(e),A+=1),S.push(w)}for(I=0;I<h;I++){var x=!1;M>A&&(x=this.getChar(e),A+=1),v.push(0!==x)}for(I=0;I<h;I++){var B=c;M>A&&(B=this.getUnsignedInt(e),A+=4);var _=B===p;_=(_=(_=(_=(_=(_=_||B===u)||B===c)||B===C)||B===d)||B===m)||B===g,b.push(_?B:c)}for(I=0;I<h;I++){var T=V;M>A&&(T=this.getChar(e),A+=1),P.push(T)}for(I=0;I<h;I++){var F=!1;M>A&&(F=this.getChar(e),A+=1),X.push(0!==F)}}var G=M-A;if(G>0)this.getCharArray(e,G)}var W=null,N=this.getChar(e);switch(N){case 97:W=this.ReadTriangleSet(e,i,s,f);break;case 98:W=this.ReadIndexedTriangleSet(e,i,s,f);break;case 99:W=this.ReadIndexedTriangleStripSet(e,i,s,f);break;case 100:W=this.ReadMonoIndexedTriangleStripSet(e,i,s,f);break;case 101:W=this.ReadLineStripSet(e,i,s,"WIRE_EDGE");break;case 102:W=this.ReadPointSet(e,i,s);break;default:console.log("smgGeom loading : Unknown geometry type")}if(W.meshType===a.ConnectivityTypeEnum.TRIANGLE_STRIP&&this.alwaysBuildIndexedTrianglesSets)W.normalsIndexArray&&W.normalsIndexArray.length!==W.vertexIndexArray.length&&console.error("Normals : Should be always mono - indexed"),W.uvIndexArray&&W.uvIndexArray.length!==W.vertexIndexArray.length&&console.error("(u, v) : Should be always mono - indexed"),(k=n.buildIndexationFromStripSet(W.meshType,W.nStrips,W.vertexIndexArray,W.lengthsArray,W.vertexArray))&&(W.meshType=a.ConnectivityTypeEnum.TRIANGLES,W.vertexIndexArray=W.vertexIndexArray?k:null,W.normalsIndexArray=W.normalsIndexArray?k:null,W.uvIndexArray=W.uvIndexArray?k:null);else if(W.meshType===a.ConnectivityTypeEnum.LINE_STRIP&&this.alwaysBuildIndexedLinesSets){var k;(k=n.buildIndexationFromStripSet(W.meshType,W.nStrips,W.vertexIndexArray,W.lengthsArray,W.vertexArray))&&(W.meshType=a.ConnectivityTypeEnum.LINES,W.vertexIndexArray=W.vertexIndexArray?k:null)}return W},BuildMeshNode:function(e){var t=null;switch(e.meshType){case a.ConnectivityTypeEnum.TRIANGLES:t=n.buildIndexedTriangleSet(e.nbTriangles,e.vertexArray,e.normalsArray,e.uvArray,e.vertexIndexArray,e.normalsIndexArray,e.uvIndexArray,e.colorRGBA,e.material,e.isSolid);break;case a.ConnectivityTypeEnum.TRIANGLE_STRIP:this.alwaysBuildIndexedTrianglesSets&&console.log("Unexpected TRIANGLE_STRIP type"),t=n.buildMonoIndexedTriangleStripSet(e.nStrips,e.vertexArray,e.normalsArray,e.uvArray,e.vertexIndexArray,e.lengthsArray,e.colorRGBA,e.material,e.isSolid);break;case a.ConnectivityTypeEnum.LINES:t=n.buildIndexedLineSet(e.vertexArray,e.vertexIndexArray,e.colorRGBA,e.thickness,e.edgeType,e.material);break;case a.ConnectivityTypeEnum.LINE_STRIP:this.alwaysBuildIndexedLinesSets&&console.log("Unexpected LINE_STRIP type"),t=n.buildLineStripSet(e.vertexArray,e.lengthsArray,e.vertexIndexArray,e.colorRGBA,e.thickness,e.edgeType,e.material);break;case a.ConnectivityTypeEnum.POINTS:t=n.buildPointSet(e.vertexArray,e.vertexIndexArray,e.material);break;case a.ConnectivityTypeEnum.DUMMY:console.log("smgGeom loading : Mesh with 0 triangles");break;default:console.error("smgGeom loading : Unknown geometry type")}return t},ReadGeode:function(e){var t=new r,a=this.ReadMatrix(e),o=a.hasTransfo,i=a.matrix,s=this.getString(e).value,l=this.ReadGeodeUserData(e),p=l.userdata,u=l.nbLOD;for(var c=[],C=0;C<u;C++){var d=this.getUnsignedInt(e);if(0===C){for(var m=0;m<d;m++)c[m]=-1;d}for(var g=[],V=0;V<d;V++){if(118!==this.getChar(e)){console.log("smgGeom loading : Unknown geometry identifier value");break}if(u>1);else{var h=this.ReadFace(e,0,-1);if(null==h)break;h.isSolid=p&&1===p.ucGeometryType;var f=null;!0===this.mergeGeosets?g[g.length]=h:(f=this.BuildMeshNode(h))?(f.setPickParent(!0),t.add(f)):console.error("smgGeom loading : failed to convert geometry"),h=null}}if(null!==this.outlines){var y=this.outlines.get(p.strId);if(null!=y)if(!0===this.mergeGeosets){if(y.broken)for(var S=0;S<y.broken.length;++S)g.push(y.broken[S]);if(y.construction)for(var v=0;v<y.construction.length;++v)g.push(y.construction[v]);if(y.smart)for(var b=0;b<y.smart.length;++b)g.push(y.smart[b])}else{if(y.broken)for(S=0;S<y.broken.length;++S){(P=this.BuildMeshNode(y.broken[S])).setPickParent(!0),t.add(P)}if(y.construction)for(v=0;v<y.construction.length;++v){(P=this.BuildMeshNode(y.construction[v])).setPickParent(!0),t.add(P)}if(y.smart)for(b=0;b<y.smart.length;++b){var P;(P=this.BuildMeshNode(y.smart[b])).setPickParent(!0),t.add(P)}}}!0===this.mergeGeosets&&(t=n.mergeGeosets(g),g=null)}return o&&!this.ignoreGeodeMatrix&&t&&t.setMatrix(i),{userdata:p,matrix:i,name:s,geode:t}},LoadGeometries:function(e){var t=this.openZStream(e);this.version=this.getDouble(t),this.strFileNameAssociate=this.getString(t).value,this.checksum=this.getLong(t);var r=this.getUnsignedInt(t),a=0;if(!(this.version<1.2)){var o=2;if(this.version<6.7&&(o=1),r>a&&(this.ulOptionsPro=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulWatermark=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulHasExpirationDate=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulStartDate=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulEndDate=this.getUnsignedLongArray(t,2),a+=8),r>a&&(this.ulIsRelativeExpirationDate=this.getUnsignedLongArray(t,2),a+=8),r>a?(this.bHasNormals=this.getChar(t),a+=1):this.bHasNormals=!0,r>a?(this.cCodage=this.getChar(t),a+=1):this.cCodage=100,r>a&&(this.ulHasSignature=this.getUnsignedLong(t),a+=4),r>a){var n=this.getString(t);this.strSignaturePicturePath=n.value,this.version<6.7&&n.byteSize>0?a+=n.byteSize*o:a+=this.strSignaturePicturePath.length*o}if(r>a){n=this.getString(t);this.strAgreement=n.value,this.version<6.7&&n.byteSize>0?a+=n.byteSize*o:a+=this.strAgreement.length*o}r>a&&(this.ulAgreementMode=this.getUnsignedLong(t),a+=4),r>a&&(this.ulSignatureCRC=this.getUnsignedLongArray(t,2),a+=8),r>a?(this.bHasTexture=this.getChar(t),a+=1):this.bHasTexture=!1;var i=r-a;if(i>0)this.getCharArray(t,i);var l=this._experienceBase.getManager("VCXGUIManager").getGUIServices();this.ulHasSignature&&this.ulAgreementMode!==s.LitSignatureMode.LIT_SIGNATURE_NO_DISPLAY?l.displaySignature(this._experienceBase,this,t):this.LoadGeometriesBody(t)}},LoadGeometriesBody:function(e){for(;;){var t=this.getChar(e);if(void 0===t)break;if(117===t){var r=this.ReadGeode(e);this._geoms.set(r.userdata.strId,r)}}},LoadOutlines:function(e){var t=this.openZStream(e),r=new Map;this.getUnsignedInt(t),this.getDouble(t);for(this.version=6.8;;){if(71!==this.getChar(t))break;for(var o={broken:[],construction:[],smart:[]},i=this.getWString(t),s=this.getUnsignedInt(t),l=0;l<s;++l){var p=this.getChar(t),u=(this.getChar(t),this.ReadLineStripSet(t,[0,0,0],1,"SHARP_EDGE"));if(u.meshType!==a.ConnectivityTypeEnum.LINE_STRIP&&console.log("Unexpected type"),this.alwaysBuildIndexedLinesSets){var c=n.buildIndexationFromStripSet(u.meshType,u.nStrips,u.vertexIndexArray,u.lengthsArray);c&&(u.meshType=a.ConnectivityTypeEnum.LINES,u.vertexIndexArray=u.vertexIndexArray?c:null)}switch(p){case 66:o.broken.push(u),u.edgeType="SHARP_EDGE";break;case 83:o.construction.push(u),u.edgeType="SMOOTH_EDGE";break;case 70:o.smart.push(u),u.edgeType="BOUNDARY_EDGE"}}r.set(i.value,o)}return r},Load:function(e){var t=n.sharing,r=n.optimized;n.sharing=!0,n.optimized=!0;try{i.memoryLog("Loading smgGeom",!0),this.LoadGeometries(e),i.memoryLog("Loading smgGeom",!1)}catch(e){return e instanceof RangeError?console.error("smgGeom loading : "+e.message):console.error("smgGeom loading error"),!1}return n.sharing=t,n.optimized=r,!0},LoadAsModel:function(e,t,a){var o=this,n=new window.FileReader;n.onloadend=function(){o.setIgnoreGeodeMatrix(!1),o.Load(new Uint8Array(n.result));var e=o.getMapGeodes();t&&e.forEach(function(e,a){var o=e.geode,n=a,i=new r;i.productType="Instance3D",i.name=n,null!==o&&(i.add(o),o.productType="InstanceRep",o.name="rep_"+n),t.add(i)}),a()},n.readAsArrayBuffer(e)}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrenceComposer",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence","DS/VCXWebKernelTools/VCXEnums"],function(e,t,r,a,o,n,i){"use strict";var s={"Texture.Frame.Gen":{name:"Actor.Texture.Frame.Gen",type:"VCXPropertyValueFrame"},"Texture.Map.Path":{name:"Actor.Texture.Map.Path",type:"VCXPropertyValueDocId"},"Texture.Frame.2D":{name:"Actor.Texture.Frame.2D",type:"VCXPropertyValueFrame"},"Texture.Transparency":{name:"Actor.Texture.Transparency",type:"VCXPropertyValueBoolean"},"Texture.Blending.Mode":{name:"Actor.Texture.Blending.Mode",type:"VCXPropertyValueBoolean"},"Texture.Border.Mode":{name:"Actor.Texture.Border.Mode",type:"VCXPropertyValueBoolean"},"Texture.UV.Scale":{name:"Actor.Texture.UV.Scale",type:"VCXPropertyValueInt"},"Texture.UV.Ratio":{name:"Actor.Texture.UV.Ratio",type:"VCXPropertyValueInt"},"Actor.Env.Effect":{name:"Actor.Env.Effect",type:"VCXPropertyValueEnum"},"Actor.Pulse":{name:"Actor.Pulse.Period",type:"VCXPropertyValueEnum"},"Actor.Pulse.Color":{name:"Pulse.Actor.Color",type:"VCXPropertyValueColor"},"Actor.Prop.Area":{name:"Actor.Prop.Area",type:"VCXPropertyValueFloat"},"Actor.Prop.Volume":{name:"Actor.Prop.Volume",type:"VCXPropertyValueFloat"}};return n.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),s)},getPropertiesMap:function(e,n,l,p,u){var c=this._parent(e,n,l,p,u);if(!e.GetObject().IsMesh())return c;for(var C in l){var d=s[C];if(d){var m=l[C],g=t.fillPropertyValue(m,d.type,n);switch(C){case"Texture.Frame.Gen":if(void 0!==m["@attributes"]&&void 0!==m["@attributes"].ProjectionMode){var V=parseInt(m["@attributes"].ProjectionMode),h=new r;switch(V){case 1:h.SetValue(i.TextureMapping.Planar);break;case 4:default:h.SetValue(i.TextureMapping.None)}c.set("Actor.Texture.Projection.Type",h)}break;case"Texture.Map.Path":var f=-1;if(void 0!==m["@attributes"]&&void 0!==m["@attributes"].Value){var y=m["@attributes"].Value.split("\\").pop().split("/").pop().toLowerCase(),S=p[y];if(void 0!==S){var v=n.getManager("VCXDocManager").BuildPathFromString(S,y);f=n.getManager("VCXDocManager").AddOrModifyDoc(v).Value}}g.SetValue(f);break;case"Actor.Pulse":if((h=new r).SetValue(0),c.set("Actor.Pulse.Type",h),g.GetValue()>0){g.SetValue(g.GetValue()-1),h.SetValue(1);var b=new a;b.SetValue(!0),c.set("Actor.Pulse.PauseAnim",b)}if(!l["Actor.Pulse.Color"]){var P=new o;P.GetValue().SetRGB(0,1,0),c.set("Pulse.Actor.Color",P)}}d.name&&g&&c.set(d.name,g)}}return c}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPolyline",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,r,a){"use strict";var o={"ActorCurve.Line.Color":{name:"Collab.Body.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Line.Opacity":{name:"Collab.Body.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Line.Type":{name:"Collab.Body.Line.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Close":{name:"Polyline.Is.Closed",type:"VCXPropertyValueBoolean"},"Actor.CurveLine.FrontStipplingMotif":{name:"Collab.Body.Line.StipplingMotif",type:"VCXPropertyValueString"},"ActorCurve.UseHiddenStyle":{name:"Collab.Body.Line.UseHiddenStyle",type:"VCXPropertyValueBoolean"},"ActorCurve.BackLine.Color":{name:"Collab.Body.Line.Back.Color",type:"VCXPropertyValueColor"},"ActorCurve.BackLine.Opacity":{name:"Collab.Body.Line.Back.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.BackLine.Type":{name:"Collab.Body.Line.Back.Type",type:"VCXPropertyValueEnum"},"ActorCurve.BackLine.Width":{name:"Collab.Body.Line.Back.Width",type:"VCXPropertyValueFloat"},"Actor.CurveLine.BackStipplingMotif":{name:"Collab.Body.Line.Back.StipplingMotif",type:"VCXPropertyValueString"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,a,n,i){var s=this._parent(e,r,a,n,i);for(var l in a){var p=a[l];if("Anchor."===l.substring(0,7)){var u=t.fillPropertyValue(p,"VCXPropertyValueAnchor",r),c="Actor.Anchor."+l.substring(7);s.set(c,u)}else{var C=o[l];if(C){u=t.fillPropertyValue(p,C.type,r);switch(l){case"ActorCurve.Line.Opacity":case"ActorCurve.BackLine.Opacity":u.Value/=255;break;case"ActorCurve.Line.Width":case"ActorCurve.BackLine.Width":u.Value*=2}C.name&&u&&s.set(C.name,u)}}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomManager",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,r){"use strict";var a={"BOM.Sort.PropertyName":{name:"BOM.Sort.PropertyName",type:"VCXPropertyValueString"},"BOM.Filter":{name:"BOM.Filter",type:"VCXPropertyValueInt"},"BOM.Sort.Ascendant":{name:"BOM.Sort.Ascendant",type:"VCXPropertyValueBoolean"},"ColumnTreeList.ColumnList":{name:"ColumnTreeList.ColumnList",type:"VCXPropertyValueMap"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},a)},getPropertiesMap:function(e,o,n,i,s,l){var p=new Map,u=t.getPropertiesDicoFromWebTypeWithInheritance("VCXComponentOccurrenceSMG");for(var c in n){var C=a[c];if(C){var d=n[c],m=t.fillPropertyValue(d,C.type,o);switch(c){case"ColumnTreeList.ColumnList":for(var g=d.ColumnTree,V=0;V<g.length;V++){var h=g[V],f=new r,y=0;for(var S in h)if(h.hasOwnProperty(S)){var v=h[S];switch(S){case"ColumnTree.Name":var b=(X=t.fillPropertyValue(v,"VCXPropertyValueString"))?X.GetValue():null;u&&u[b]&&X.SetValue(u[b].name),f.SetValueAtIndex(y,X),f._value[y++].name=S;break;case"ColumnTree.Width":case"ColumnTree.CommonRoot":var P=t.fillPropertyValue(v,"VCXPropertyValueInt");f.SetValueAtIndex(y,P),f._value[y++].name=S;break;case"ColumnTree.Label":var X=t.fillPropertyValue(v,"VCXPropertyValueString");f.SetValueAtIndex(y,X),f._value[y++].name=S}}m.SetValueAtIndex(V,f)}}C.name&&m&&p.set(C.name,m)}}return p}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomInfo",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueMap"],function(e,t,r){"use strict";var a={GroupInfoPropSet:{name:"GroupInfoPropSet",type:"VCXPropertyValueMap"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},a)},getPropertiesMap:function(e,o,n,i,s,l){var p=new Map,u=t.getPropertiesDicoFromWebTypeWithInheritance("VCXComponentOccurrenceSMG");for(var c in n){var C=a[c];if(C){var d=n[c],m=t.fillPropertyValue(d,C.type,o);switch(c){case"GroupInfoPropSet":var g=d["GroupInfo.List"];if(!g)break;if(!(g=g.GroupInfo))break;for(var V=0;V<g.length;V++){var h=g[V],f=new r,y=0;for(var S in h)if(h.hasOwnProperty(S)){var v=h[S];switch(S){case"Name":var b=t.fillPropertyValue(v,"VCXPropertyValueString"),P=b?b.GetValue():null;u&&u[P]&&b.SetValue(u[P].name),f.SetValueAtIndex(y,b),f._value[y++].name=S;break;case"Id":var X=t.fillPropertyValue(v,"VCXPropertyValueInt");f.SetValueAtIndex(y,X),f._value[y++].name=S}}m.SetValueAtIndex(V,f)}}C.name&&m&&p.set(C.name,m)}}return p}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableGround",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r){"use strict";var a={"Ground.LocalLocation":{name:"Actor.Position",type:"VCXPropertyValueLocation"},"Ground.Color":{name:"Environment.Ground.Color",type:"VCXPropertyValueColor"},"Ground.FallOff":{name:"Environment.Ground.FallOff",type:"VCXPropertyValueFloat"},"Ground.Grid.Show":{name:"Environment.Ground.Grid.Show",type:"VCXPropertyValueBoolean"},"Ground.Grid.Color":{name:"Environment.Ground.Grid.Color",type:"VCXPropertyValueColor"},"Ground.Auto.Size":{name:"Environment.Ground.Diameter.Auto",type:"VCXPropertyValueBoolean"},"Ground.Diameter":{name:"Environment.Ground.Diameter",type:"VCXPropertyValueFloat"},"Ground.Border.Show":{name:"Environment.Ground.Border.Show",type:"VCXPropertyValueBoolean"},"Ground.Border.Color":{name:"Environment.Ground.Border.Color",type:"VCXPropertyValueColor"},"Viewport.Render.GroundShadows":{name:"Environment.Ground.Shadows.Show",type:"VCXPropertyValueBoolean"},"Viewport.Render.GroundReflect":{name:"Environment.Ground.Mirror.Show",type:"VCXPropertyValueBoolean"},"Viewport.Render.GroundReflect.Blur":{name:"Environment.Ground.Mirror.Blurry",type:"VCXPropertyValueBoolean"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);switch(l){case"Ground.FallOff":c.Value*=.01}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPath",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPolyline","DS/VCXWebProperties/VCXPropertyValueString"],function(e,t,r,a){"use strict";var o={"ActorCurvePath.AxeOrder":{name:"Collab.Path.AxesOrder",type:"VCXPropertyValueEnum"},"ActorCurvePath.Full":{name:"Collab.Path.IsFull",type:"VCXPropertyValueBoolean"},"ActorCurvePath.IsFromNeutral":{name:"Collab.Path.IsFromNeutral",type:"VCXPropertyValueBoolean"},"ActorCurvePath.Mode":{name:"Collab.Path.ConstructMode",type:"VCXPropertyValueEnum"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,a,n){var i=this._parent(e,r,a,n);for(var s in a){var l=a[s];if("Anchor."===s.substring(0,7)){var p=t.fillPropertyValue(l,"VCXPropertyValueAnchor",r),u="Actor.Anchor."+s.substring(7);i.set(u,p)}else{var c=o[s];if(c){p=t.fillPropertyValue(l,c.type,r);s,c.name&&p&&i.set(c.name,p)}}}return i}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupSection",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"CuttingPlane.Enable":{name:"Section.Enable",type:"VCXPropertyValueBoolean"},"CuttingPlane.AutoFlip":{name:"Section.AutoFlip",type:"VCXPropertyValueBoolean"},"CuttingPlane.Capping":{name:"Section.Capping",type:"VCXPropertyValueBoolean"},"CuttingPlane.Capping.Color":{name:"Section.Capping.Color",type:"VCXPropertyValueColor"},"CuttingPlane.Capping.ActorColor":{name:"Section.Capping.ActorColor",type:"VCXPropertyValueBoolean"},"CuttingPlane.Hatch":{name:"Section.Hatching.Frequency",type:"VCXPropertyValueInt"},"CuttingPlane.HatchAngle":{name:"Section.Hatching.Angle",type:"VCXPropertyValueFloat"},"CuttingPlane.SpaceBackAlpha":{name:"Section.SpaceBackAlpha",type:"VCXPropertyValueFloat"},"CuttingPlane.SpaceFrontAlpha":{name:"Section.SpaceFrontAlpha",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,n,i,s){var l=this._parent(e,r,n,i,s);for(var p in n){var u=o[p];if(u){var c=n[p],C=t.fillPropertyValue(c,u.type,r);switch(p){case"CuttingPlane.SpaceBackAlpha":case"CuttingPlane.SpaceFrontAlpha":C.Value/=255;break;case"CuttingPlane.Enable":l.set("Section.Plane.Enable",new a(C.Value))}u.name&&C&&l.set(u.name,C)}}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableCurveWire",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence"],function(e,t,r){"use strict";var a={"ActorCurve.Width":{name:"ActorCurve.Width",type:"VCXPropertyValueInt"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowLinear",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Anchor.1":{name:"Actor.Anchor.1",type:"VCXPropertyValueAnchor"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,n,i,s){var l=this._parent(e,r,n,i,s),p=!1,u=!1;for(var c in n){var C=o[c];if(C){var d=n[c],m=t.fillPropertyValue(d,C.type,r);switch(c){case"Anchor.0":p=!0;break;case"Anchor.1":u=!0}C.name&&m&&l.set(C.name,m)}}if(p&&u){var g=new a;g.SetValue(!1),l.set("Collab.Is.Paper",g)}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCompass",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgGeomLoader","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r,a,o){"use strict";var n={"Navigator.Compass.GeomPath":{name:"Compass.GeomPath",type:"VCXPropertyValueDocId"},"Navigator.Compass.AbsoluteSize":{name:"Compass.AbsoluteSize",type:"VCXPropertyValueBoolean"},"Navigator.Compass.Size":{name:"Compass.Size",type:"VCXPropertyValueFloat"},"Navigator.Compass.SizePixel":{name:"Compass.SizePixel",type:"VCXPropertyValueInt"},"Navigator.Compass.Translation":{name:"Compass.Translation",type:"VCXPropertyValuePoint"},"Navigator.Compass.Frame.Alignment":{name:"Compass.Alignment",type:"VCXPropertyValueFrame"}};return o.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),n)},getPropertiesMap:function(e,a,o,i,s){var l=e.QueryInterface("W3AISGNodeHolder");l&&l._sgNode&&l._sgNode.setGeomConverter(function(e,t){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onerror=function(){t&&void 0!==t&&t(new Map)},o.onload=function(e){if(200===this.status){var o=new r(a);o.setIgnoreGeodeMatrix(!1),o.Load(new Uint8Array(this.response)),t&&void 0!==t&&t(o.getMapGeodes())}else t&&void 0!==t&&t(new Map)},o.send()});var p=this._parent(e,a,o,i);for(var u in o){var c=n[u];if(c){var C=o[u],d=t.fillPropertyValue(C,c.type,a);switch(u){case"Navigator.Compass.Visibility":break;case"Navigator.Compass.GeomPath":var m=-1;if(C["@attributes"]&&C["@attributes"].Value){var g=C["@attributes"].Value.split("\\").pop().split("/").pop().toLowerCase(),V=i[g];if(V){var h=a.getManager("VCXDocManager").BuildPathFromString(V,g);m=a.getManager("VCXDocManager").AddOrModifyDoc(h).Value}d.SetValue(m)}}c.name&&d&&p.set(c.name,d)}}return p}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCorner",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Actor.Length2":{name:"Arrow.Corner.Length.1",type:"VCXPropertyValueFloat"},Length:{name:"Arrow.Corner.Length.2",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,n,i,s){var l=this._parent(e,r,n,i,s),p=!1;for(var u in n){var c=o[u];if(c){var C=n[u],d=t.fillPropertyValue(C,c.type,r);switch(u){case"Anchor.0":p=!0}c.name&&d&&l.set(c.name,d)}}if(!e.bIsOldVersion&&p){var m=new a;m.SetValue(!1),l.set("Collab.Is.Paper",m)}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableMeshPrimitive",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrenceComposer"],function(e,t,r){"use strict";var a={"Domain1.DomainType":{name:"ActorMeshPrimitive.Domain1.DomainType",type:"VCXPropertyValueEnum"},"Domain1.Height":{name:"ActorMeshPrimitive.Domain1.Height",type:"VCXPropertyValueFloat"},"Cube.Depth":{name:"ActorMeshPrimitive.Cube.Depth",type:"VCXPropertyValueFloat"},"Cube.Width":{name:"ActorMeshPrimitive.Cube.Width",type:"VCXPropertyValueFloat"},"Domain1.OuterRadius":{name:"ActorMeshPrimitive.Domain1.OuterRadius",type:"VCXPropertyValueFloat"},"Domain1.TopRadius":{name:"ActorMeshPrimitive.Domain1.TopRadius",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableRedLine",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r){"use strict";var a={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Line.Width":{name:"Collab.Body.Line.Width",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCircular",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrow","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a){"use strict";var o={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Actor.Angle":{name:"Arrow.Circular.Angle",type:"VCXPropertyValueFloat"},"Actor.Flat":{name:"Arrow.Circular.Flat",type:"VCXPropertyValueEnum"},"Actor.Radius":{name:"Arrow.Circular.Radius",type:"VCXPropertyValueFloat"},"Actor.Step":{name:"Arrow.Circular.Step",type:"VCXPropertyValueInt"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,n,i,s){var l=this._parent(e,r,n,i,s),p=!1;for(var u in n){var c=o[u];if(c){var C=n[u],d=t.fillPropertyValue(C,c.type,r);switch(u){case"Anchor.0":p=!0}c.name&&d&&l.set(c.name,d)}}if(!e.bIsOldVersion&&p){var m=new a;m.SetValue(!1),l.set("Collab.Is.Paper",m)}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePoint",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence"],function(e,t,r){"use strict";var a={"ActorPoint.Width":{name:"ActorPoint.Width",type:"VCXPropertyValueInt"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCamera",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueAnchor"],function(e,t,r,a){"use strict";var o={"Navigator.Camera.Location":{name:null,type:"VCXPropertyValueLocation"},"Anchor.1":{name:"Actor.Anchor.1",type:"VCXPropertyValueAnchor"},"Anchor.2":{name:"Actor.Anchor.2",type:"VCXPropertyValueAnchor"},"Navigator.Camera.Fov":{name:"Camera.Angle",type:"VCXPropertyValueFloat"},"Navigator.Camera.Height":{name:"Camera.Height",type:"VCXPropertyValueFloat"},"Navigator.Camera.Proj.Persp":{name:"Camera.Ortho",type:"VCXPropertyValueBoolean"},"Navigator.Camera.Arcball":{name:"Camera.Arcball",type:"VCXPropertyValueBoolean"},"Navigator.Camera.Interpolator":{name:"Actor.Interpolation.Type",type:"VCXPropertyValueEnum"},"Camera.Pitch":{name:"Camera.Pitch",type:"VCXPropertyValueBoolean"},"Camera.Roll":{name:"Camera.Roll",type:"VCXPropertyValueBoolean"},"Camera.Yaw":{name:"Camera.Yaw",type:"VCXPropertyValueBoolean"},"Camera.LockDistCOI":{name:"Camera.LockDistCOI",type:"VCXPropertyValueBoolean"},"Camera.DistCOI":{name:"Camera.DistCOI",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),o)},getPropertiesMap:function(e,r,n,i,s){var l=this._parent(e,r,n,i,s);for(var p in n){var u=o[p];if(u){var c=n[p],C=t.fillPropertyValue(c,u.type,r);switch(p){case"Navigator.Camera.Location":var d=new a;d.SetValueFrame(C.GetFrame()),l.set("Actor.Anchor.1",d);var m=new a;m.SetValueFrame(C.GetPivot()),l.set("Actor.Anchor.2",m);break;case"Navigator.Camera.Fov":C.Value=180*C.Value/Math.PI;break;case"Navigator.Camera.Proj.Persp":C.Value=!C.Value}u.name&&C&&l.set(u.name,C)}}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPanel",["UWA/Class","DS/VCXWebDressup/VCXMarkup_Spec","DS/VCXWebDressup/VCXMarkupModifiable","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueAnchor","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueColor","DS/VCXWebProperties/VCXPropertyValueDocId","DS/VCXWebProperties/VCXPropertyValueFont","DS/VCXWebProperties/VCXColor"],function(e,t,r,a,o,n,i,s,l,p,u,c,C,d){"use strict";var m={"Text.Position":{name:"Collab.3D.Paper.3D.Text.Position",type:"VCXPropertyValuePoint"},"Actor.Location":{name:"Actor.Anchor.Location",type:"vcxPropertyValueAnchor"},"Text.PreString":{name:"Collab.Measurement.PreString",type:"VCXPropertyValueString"},"Text.MiddleString":{name:"Collab.Measurement.MiddleString",type:"VCXPropertyValueString"},"Text.PostString":{name:"Collab.Measurement.PostString",type:"VCXPropertyValueString"},"Actor.PreSymbol":{name:"Collab.Measurement.PreSymbol",type:"VCXPropertyValueEnum"},"Actor.MiddleSymbol":{name:"Collab.Measurement.MiddleSymbol",type:"VCXPropertyValueEnum"},"Actor.PostSymbol":{name:"Collab.Measurement.PostSymbol",type:"VCXPropertyValueEnum"},"Actor.DisplayValue":{name:"Collab.Measurement.DisplayValue",type:"VCXPropertyValueBoolean"},"Text.Foreground.Color":{name:"Collab.Text.Color",type:"VCXPropertyValueColor"},"Text.Bk":{name:"Collab.Body.Shape",type:"VCXPropertyValueEnum"},"VectorImage.Shape":{name:"Collab.Body.Shape",type:"VCXPropertyValueEnum"},"Widget.Shape":{name:"Collab.Body.Shape",type:"VCXPropertyValueEnum"},"VectorImage.BackGround.Enable":{name:"Collab.Background.Show",type:"VCXPropertyValueBoolean"},"Widget.Background":{name:"Collab.3D.Paper.Is.Background",type:"VCXPropertyValueBoolean"},"Text.Bk.Opacity":{name:"Collab.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"VectorImage.BackGround.Opacity":{name:"Collab.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorArrow.Bg.Opacity":{name:"Collab.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"VectorImage.Scale":{name:"Collab.Image.Scale",type:"VCXPropertyValueFloat"},"Actor.Color":{name:"Collab.Background.Color",type:"VCXPropertyValueColor"},"VectorImage.BackGround.Color":{name:"Collab.Background.Color",type:"VCXPropertyValueColor"},"ActorCurve.Border":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"Text.Label.Line.Show":{name:"Collab.Border.Show",type:"VCXPropertyValueBoolean"},"Text.Label.Line.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Border.Opacity":{name:"Collab.Border.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"Text.Label.Line.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Border.Color":{name:"Collab.Border.Line.Color",type:"VCXPropertyValueColor"},"Text.LineWidth":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"ActorCurve.Border.Width":{name:"Collab.Border.Line.Width",type:"VCXPropertyValueFloat"},"Text.Attach.Line.Color":{name:"Collab.Attach.Line.Color",type:"VCXPropertyValueColor"},"Text.Attach.Line.Width":{name:"Collab.Attach.Line.Width",type:"VCXPropertyValueFloat"},"Text.Attach.Line.Type":{name:"Collab.Attach.Line.Type",type:"VCXPropertyValueEnum"},"Text.Attach.Line.Curvature":{name:"Collab.Attach.Curvature",type:"VCXPropertyValueFloat"},"Text.String":{name:null,type:"VCXPropertyValueString"},"Text.Alignment":{name:"Collab.Text.HAlignment",type:"VCXPropertyValueEnum"},"Text.LinkedPropertyName":{name:"Collab.Text.LinkedProperty",type:"VCXPropertyValueString"},"Text.LinkedParentLevel":{name:"Collab.Text.LinkedParentLevel",type:"VCXPropertyValueInt"},"Text.Font":{name:"Collab.Text.Font",type:"VCXPropertyValueFont"},"Texture.Map.Path":{name:"Collab.Image.Doc.ID",type:"VCXPropertyValueDocId"},"VectorImage.Filepath":{name:"Collab.Image.Doc.ID",type:"VCXPropertyValueDocId"},"Text.CalloutAlignment":{name:"Collab.3D.Paper.Positioning.Type",type:"VCXPropertyValueEnum"},"Text.DrawAnchor":{name:"Collab.Attach.Preset",type:"VCXPropertyValueEnum"},"Text.Attach.Type":{name:"Collab.Measurement.Attach.Type",type:"VCXPropertyValueFloat"},"Text.ShowEndPoints":{name:"Collab.Measurement.ShowEndPoints",type:"VCXPropertyValueBoolean"},"Text.ShowConstruction":{name:"Collab.Measurement.ShowConstructionLines",type:"VCXPropertyValueBoolean"},"Text.ShowRedline":{name:"Collab.Measurement.ShowRedlines",type:"VCXPropertyValueBoolean"},"Text.ShowPlanes":{name:"Collab.Measurement.ShowPlanes",type:"VCXPropertyValueBoolean"},"Text.Callout2D":{name:null,type:"VCXPropertyValuePoint"},"Widget.Arrow.Origin":{name:"Collab.Attach.Origin",type:"VCXPropertyValuePoint"},"Widget.Top":{name:null,type:"VCXPropertyValueFloat"},"Widget.Left":{name:null,type:"VCXPropertyValueFloat"},"Widget.Depth":{name:"Collab.3D.Paper.Depth",type:"VCXPropertyValueFloat"},"Widget.Width":{name:"Collab.Body.Width",type:"VCXPropertyValueFloat"},"Panel.Width":{name:"Collab.Body.Width",type:"VCXPropertyValueFloat"},"Widget.Height":{name:"Collab.Body.Height",type:"VCXPropertyValueFloat"},"Panel.Height":{name:"Collab.Body.Height",type:"VCXPropertyValueFloat"},"Widget.Autofit":{name:"Collab.Body.FitToText",type:"VCXPropertyValueBoolean"},"ActorComposite.KeepAspectRatio":{name:"Collab.Body.KeepAspectRatio",type:"VCXPropertyValueBoolean"},"Widget.KeepAspectRatio":{name:"Collab.Body.KeepAspectRatio",type:"VCXPropertyValueBoolean"},"Widget.BOM.FilterOnVisibleCallouts":{name:"Collab.BOM.FilterOnVisibleCallouts",type:"VCXPropertyValueBoolean"},"Widget.BOM.TextLabelColor":{name:"Collab.BOM.Header.Text.Color",type:"VCXPropertyValueColor"},"Widget.BOM.TextCellColor":{name:"Collab.Text.Color",type:"VCXPropertyValueColor"},"Widget.BOM.LabelCellColor":{name:"Collab.BOM.Header.Background.Color",type:"VCXPropertyValueColor"},"Widget.BOM.OddCellColor":{name:"Collab.BOM.OddRow.Background.Color",type:"VCXPropertyValueColor"},"Widget.BOM.EvenCellColor":{name:"Collab.BOM.EvenRow.Background.Color",type:"VCXPropertyValueColor"},"Widget.BOM.Position":{name:"Collab.3D.Paper.Positioning.Type",type:"VCXPropertyValueEnum"},"Widget.BOM.Percentage":{name:"Collab.3D.Paper.BOM.Percentage",type:"VCXPropertyValueFloat"},"Widget.ShadowEnable":{name:"Collab.Body.Shadow.Show",type:"VCXPropertyValueBoolean"},"Widget.ShadowDistance":{name:"Collab.Body.Shadow.Distance",type:"VCXPropertyValueFloat"},"Widget.ShadowOrientation":{name:"Collab.Body.Shadow.Orientation",type:"VCXPropertyValueFloat"},"Widget.ShadowOpacity":{name:"Collab.Body.Shadow.Opacity",type:"VCXPropertyValueFloat"},"Widget.ShadowBlur":{name:"Collab.Body.Shadow.Blur",type:"VCXPropertyValueFloat"},"Actor.Radius":{name:"Collab.Measurement.Radius",type:"VCXPropertyValueFloat"},"Actor.Prop.Area":{name:"Collab.Measurement.Area",type:"VCXPropertyValueFloat"},"Actor.Prop.Volume":{name:"Collab.Measurement.Volume",type:"VCXPropertyValueFloat"},Length:{name:"Collab.Measurement.Length",type:"VCXPropertyValueFloat"},"Actor.Length1":{name:"Collab.Measurement.Length1",type:"VCXPropertyValueFloat"},"Actor.Length2":{name:"Collab.Measurement.Length2",type:"VCXPropertyValueFloat"},"Actor.Radius1":{name:"Collab.Measurement.Radius1",type:"VCXPropertyValueFloat"},"Actor.Radius2":{name:"Collab.Measurement.Radius2",type:"VCXPropertyValueFloat"},"Actor.Pulse":{name:"Actor.Pulse.Period",type:"VCXPropertyValueEnum"},"Actor.Pulse.Color":{name:"Pulse.Collab.Image.Color",type:"VCXPropertyValueColor"},"Widget.Freeze":{name:"Actor.Freeze",type:"VCXPropertyValueEnum"},Billboard:{name:"Collab.3D.Paper.Billboard.Type",type:"VCXPropertyValueEnum"}};return o.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),m)},getPropertiesMap:function(e,o,C,g,V){var h=this._parent(e,o,C,g,V),f=null,y=null,S=null,v=null,b=!1,P=null,X=null,A=null;for(var M in C){var I,D=C[M];if("Anchor."===M.substring(0,7)){if(I=a.fillPropertyValue(D,"VCXPropertyValueAnchor",o),parseInt(M.substring(7))<1e3){var L="Actor.Anchor."+M.substring(7);h.set(L,I)}}else{var w=m[M];if(w){switch(I=a.fillPropertyValue(D,w.type,o),M){case"Widget.BOM.Position":switch(I.GetValue()){case 0:I.SetValue(1e3);break;case 1:I.SetValue(3);break;case 2:I.SetValue(7);break;case 3:I.SetValue(10);break;case 4:I.SetValue(12)}break;case"Actor.Location":var x=a.fillPropertyValue(D,"VCXPropertyValueLocation",o);(I=new l).SetValueFrame(x.GetFrame());break;case"Text.Bk":switch(I.GetValue()){case 0:I.SetValue(0);break;case 1:I.SetValue(10);break;case 2:I.SetValue(20);break;case 3:I.SetValue(3);break;case 4:I.SetValue(4);break;case 5:I.SetValue(5);break;case 6:I.SetValue(1)}break;case"VectorImage.Shape":switch(I.GetValue()){case 0:case 1:I.SetValue(1);break;case 2:case 3:I.SetValue(3)}break;case"Widget.Shape":switch(I.GetValue()){case 0:I.SetValue(1);break;case 1:I.SetValue(6);break;case 2:I.SetValue(7);break;case 3:I.SetValue(4);break;case 4:I.SetValue(5)}break;case"Billboard":switch(I.GetValue()){case 0:I.SetValue(0);break;case 1:case 2:I.SetValue(2);break;case 3:I.SetValue(0)}break;case"Text.Bk.Opacity":case"VectorImage.BackGround.Opacity":case"ActorArrow.Bg.Opacity":I.Value/=255;break;case"VectorImage.Scale":I.Value*=.01;break;case"Actor.Color":h.set("Collab.Image.Color",I);break;case"VectorImage.BackGround.Color":h.set("Collab.Image.Color",new u((new d).SetRGBA(1,1,1,1)));break;case"Text.Label.Line.Opacity":case"ActorCurve.Border.Opacity":I.Value/=255;break;case"Text.LineWidth":case"ActorCurve.Border.Width":case"Text.Attach.Line.Width":I.Value*=2;break;case"Text.String":P=I.Value;break;case"Text.Alignment":h.set("Collab.Text.HAlignment",I);break;case"Text.LinkedPropertyName":X=I.Value;break;case"Text.LinkedParentLevel":A=I.Value;break;case"Texture.Map.Path":case"VectorImage.Filepath":var B=a.fillPropertyValue(D,"VCXPropertyValueString",o),_=B.Value.slice(B.Value.lastIndexOf("\\")+1).toLowerCase();if(_){var T=g[_];if(!T)T=g[_.replace(/^.*[\\\/]/,"")];var F=o.getManager("VCXDocManager").BuildPathFromString(T,_);F&&(I=o.getManager("VCXDocManager").AddOrModifyDoc(F))}I||(I=new c);break;case"Text.Position":"CLitText2dPaperSpace"===V&&(y=parseFloat(D["@attributes"].X),f=parseFloat(D["@attributes"].Y)),b=!0;break;case"Text.Callout2D":v=parseFloat(D["@attributes"].X),S=parseFloat(D["@attributes"].Y);break;case"Widget.Arrow.Origin":h.set("Collab.Attach.CenteredOrigin",new i(!1));break;case"Widget.Top":f=I.Value;break;case"Widget.Left":y=I.Value;break;case"Widget.ShadowOpacity":I.Value/=255;break;case"Text.DrawAnchor":if(I.Value){var G=I.Value;9===G&&(G=30),h.set("Collab.Attach.Show",new i(!0));var W,N=r.GetAttachPresets(G);(W=new n).SetValue(N["Collab.Attach.LeadType"]),h.set("Collab.Attach.LeadType",W),(W=new n).SetValue(N["Collab.Attach.ExtremityType"]),h.set("Collab.Attach.ExtremityType",W),(W=new s).SetValue(N["Collab.Attach.Curvature"]),h.set("Collab.Attach.Curvature",W),(W=new i).SetValue(N["Collab.Attach.Background.Gradient"]),h.set("Collab.Attach.Background.Gradient",W),(W=new i).SetValue(N["Collab.Attach.Border.Gradient"]),h.set("Collab.Attach.Border.Gradient",W),(W=new i).SetValue(N["Collab.Attach.BentDot"]),h.set("Collab.Attach.BentDot",W)}else h.set("Collab.Attach.Show",new i(!1));break;case"Actor.Pulse":var k=new n;if(k.SetValue(0),I.GetValue()>0){I.SetValue(I.GetValue()-1),k.SetValue(1);var O=new i;O.SetValue(!0),h.set("Actor.Pulse.PauseAnim",O)}h.set("Actor.Pulse.Type",k);break;case"Actor.Pulse.Color":h.get("Actor.Pulse.Type")?h.set("Pulse.Collab.Background.Color",I):I=null;break;case"ActorCurve.Border":case"Text.Label.Line.Show":"CLit2dWidgetImagePaperSpaceFromCropArea"===V&&(I.Value=!1);break;case"Text.CalloutAlignment":var R=I.Value;for(var E in I.Value=t.EPositionType.Free3D,t.EPositionType)t.EPositionType[E]===R&&(I.Value=R)}w.name&&I&&h.set(w.name,I)}}}var U=a.translateLinkedPropertyString(o,e,X,A,P,h);if(U){var H=new p;H.Value=U,h.set("Collab.Text",H);var z=new i;z.Value=!0,h.set("Collab.Text.Show",z);var K=new s;K.SetValue(1),h.set("Collab.Body.InnerMargin",K)}var Q=!1;if(S&&(f=S*o.getManager("VCXPaperManager").Size.y,Q=!0),v&&(y=v*o.getManager("VCXPaperManager").Size.x,Q=!0),null!==y||null!==f){if(null!==y){var j=new s;j.SetValue(y),h.set("Collab.3D.Paper.Paper.Position.X",j)}if(null!==f){var q=new s;q.SetValue(f),h.set("Collab.3D.Paper.Paper.Position.Y",q)}var Y=new n,Z=new n;"CLitTextMultiplePoints"===V&&null!=P&&(1===P.trim().split(" ").length&&-1===P.indexOf("\n")?Z.SetValue(1):Z.SetValue(0),h.set("Collab.Text.HAlignment",Z)),b?Y.SetValue(2):Q?Y.SetValue(2):Y.SetValue(0),h.set("Collab.Body.VAlignment",Y)}return h}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableViewport",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools"],function(e,t){"use strict";var r={"Viewport.CameraToSeeInterface":{name:"Viewport.ActiveCamera",type:"VCXPropertyValueInt"},"Navigator.Camera.Vertical":{name:"Environment.Vertical",type:"VCXPropertyValueEnum"},"Viewport.Render.BackCulling":{name:"Environment.BackFaceCulling",type:"VCXPropertyValueBoolean"},"Viewport.Render.SSAO":{name:"Environment.SSAO",type:"VCXPropertyValueEnum"},"Viewport.Render.HLGlow":{name:"Environment.Bloom",type:"VCXPropertyValueBoolean"},"Viewport.Render.Mode":{name:"Render.Mode",type:"VCXPropertyValueEnum"},"Viewport.Render.ShowSharedEdges":{name:"Render.OutlineType",type:"VCXPropertyValueEnum"},"Viewport.Bk.Color":{name:"Environment.Background.Color",type:"VCXPropertyValueColor"},"Viewport.Bk.Alpha":{name:"Environment.Background.Color.Opacity",type:"VCXPropertyValueFloat"},"Viewport.BkFoot.Color":{name:"Environment.Background.Foot.Color",type:"VCXPropertyValueColor"},"Viewport.BkGradient":{name:"Environment.Background.Gradient",type:"VCXPropertyValueBoolean"},"Viewport.Bk.Image.Path":{name:"Environment.Background.Image",type:"VCXPropertyValueDocId"},"Viewport.Render.Lighting.Mode":{name:"Render.Lighting.Mode",type:"VCXPropertyValueEnum"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},r)},getPropertiesMap:function(e,a,o,n,i){var s=new Map;for(var l in o){var p=r[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,a);switch(l){case"Viewport.Render.SSAO":c.Value?c.Value=2:c.Value=1;break;case"Viewport.Bk.Alpha":c.Value/=255;break;case"Viewport.Bk.Image.Path":var C=t.fillPropertyValue(u,"VCXPropertyValueString",a),d=C.Value.slice(C.Value.lastIndexOf("\\")+1).toLowerCase();if(d){var m=n[d],g=a.getManager("VCXDocManager").BuildPathFromString(m,d);g&&(c=a.getManager("VCXDocManager").AddOrModifyDoc(g))}}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCircle",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressup"],function(e,t,r){"use strict";var a={"Anchor.0":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Actor.Color":{name:"Collab.Background.Color",type:"VCXPropertyValueColor"},"Actor.Circle.Background":{name:"Circle.Background.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Line.Color":{name:"Collab.Body.Line.Color",type:"VCXPropertyValueColor"},"ActorCurve.Line.Opacity":{name:"Collab.Body.Line.Color.Opacity",type:"VCXPropertyValueFloat"},"ActorCurve.Line.Type":{name:"Collab.Body.Line.Type",type:"VCXPropertyValueEnum"},"ActorCurve.Line.Width":{name:"Collab.Body.Line.Width",type:"VCXPropertyValueFloat"},"Actor.Radius":{name:"Circle.Radius",type:"VCXPropertyValueFloat"},"Actor.Thickness":{name:"Circle.Thickness",type:"VCXPropertyValueFloat"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);switch(l){case"ActorCurve.Line.Opacity":case"ActorCurve.Border.Opacity":c.Value/=255}p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePmi",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrence"],function(e,t,r){"use strict";var a={"ActorCompositePmi.MirroringRepresentation":{name:"ActorCompositePmi.MirroringRepresentation",type:"VCXPropertyValueEnum"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupDigger",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebProperties/VCXPropertyValueFrame"],function(e,t,r){"use strict";var a={"Inspector.Enabled":{name:"Actor.Opacity",type:"VCXPropertyValueFloat"},"Digger.Radius":{name:"Digger.Radius",type:"VCXPropertyValueFloat"},"Digger.Position":{name:"Digger.Position",type:"VCXPropertyValuePoint2D"},"Digger.Renderer":{name:"Digger.Mode",type:"VCXPropertyValueEnum"},"Digger.COIOn":{name:"Digger.Attach",type:"VCXPropertyValueBoolean"},"Digger.COIPos":{name:"Actor.Anchor.0",type:"VCXPropertyValueAnchor"},"Digger.Depth":{name:null,type:"VCXPropertyValueFloat"}};return e.extend({getPropertiesDescription:function(){return UWA.extend({},a)},getPropertiesMap:function(e,o,n,i,s){var l=new Map;for(var p in n){var u=a[p];if(u){var c=n[p],C=t.fillPropertyValue(c,u.type,o);switch(p){case"Digger.Renderer":switch(C.GetValue()){case 0:C.Value=1;break;case 1:C.Value=2;break;case 2:case 3:C.Value=0}break;case"Digger.COIPos":var d=t.fillPropertyValue(c,"VCXPropertyValueVector",o);C.SetValueFrame((new r).SetValueFromVector(d.GetValue()));break;case"Digger.Depth":"DigZoom"===e.loadParentMode?l.set("Digger.ZoomFactor",C):l.set("Digger.DepthFactor",C)}u.name&&C&&l.set(u.name,C)}}return l}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableHotSpot",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable"],function(e,t,r){"use strict";var a={"HotSpot.Show":{name:"Actor.Enable",type:"VCXPropertyValueBoolean"},"HotSpot.Color":{name:"Actor.Color",type:"VCXPropertyValueColor"},"HotSpot.Tooltip":{name:"Actor.ToolTip",type:"VCXPropertyValueString"}};return r.extend({getPropertiesDescription:function(){return UWA.extend(this._parent(),a)},getPropertiesMap:function(e,r,o,n,i){var s=this._parent(e,r,o,n,i);for(var l in o){var p=a[l];if(p){var u=o[l],c=t.fillPropertyValue(u,p.type,r);l,p.name&&c&&s.set(p.name,c)}}return s}})}),define("DS/VCXWebInteropSMG/VCXSmgLoaderModifiableFactory",["UWA/Class","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiable","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableViewport","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableGround","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableOccurrenceComposer","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableMeshPrimitive","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePmi","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableCurveWire","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiablePoint","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableRedLine","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCamera","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPath","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowLinear","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCircular","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupArrowCorner","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCircle","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPolyline","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomManager","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomInfo","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupPanel","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupDigger","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableHotSpot","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupCompass","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableDressupSection","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueBoolean"],function(e,t,r,a,o,n,i,s,l,p,u,c,C,d,m,g,V,h,f,y,S,v,b,P,X,A,M){"use strict";var I={CLitViewport:{classname:"VCXViewport_Spec",classFcntName:a,additionalProperties:{"Environment.Background.Override":new M(!0),"Render.Lighting.Override":new M(!0),"Render.ShowConstructions":new M(!0)}},CLitActorGround:{classname:"VCXComponentGround",classFcntName:o},CLitVectorImageBOM:{classname:"VCXBOM_Spec",classFcntName:S},CLitKBOMManager:{classname:"VCXComponentBomManager",classFcntName:f},CLitBOMInfo:{classname:"VCXBOMInfoComponent",classFcntName:y},CLitActor:{classname:"VCXComponentOccurrenceSMG",classFcntName:r},CLitAssyGroup:{classname:"VCXComponentOccurrenceSMG",classFcntName:n},CLitActorMesh:{classname:"VCXComponentOccurrenceSMG",classFcntName:n},CLitActorPoint:{classname:"VCXComponentPoint",classFcntName:p},CLitActorCurveWire:{classname:"VCXComponentCurveWire",classFcntName:l},CLitActorCompositePmi:{classname:"VCXComponentCompositePmi",classFcntName:s},CLitCameraActor:{classname:"CXPCameraActor_Spec",classFcntName:c},CLitRedline:{classname:"VCXRedLine_Spec",classFcntName:u},CLitActorCurvePolyline:{classname:"VCXPolyline_Spec",classFcntName:h},CLitQuotationArc:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(110)}},CLitQuotationAngle:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(120)}},CLitQuotationLinear:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(130)}},CLitQuotationDiameter:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(140)}},CLitQuotationBetweenAxis:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(160)}},CLitQuotationBetweenCentres:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(170)}},CLitQuotationBetweenPlanes:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(180)}},CLitQuotationPlanePoint:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(190)}},CLitQuotationBetweenPoints:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(200)}},CLitQuotationBetweenObjects:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(210)}},CLitQuotationArea:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(220)}},CLitQuotationVolume:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(230)}},CLitQuotationAreaMultiplePoints:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(250)}},CLitQuotationVolumeMultiplePoints:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(260)}},CLitQuotationBetweenLines:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(280)}},CLitQuotationLinePoint:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(290)}},CLitQuotationRadius:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(300)}},CLitQuotationCoord:{classname:"VCXMeasurement_Spec",classFcntName:S,additionalProperties:{"Collab.Measurement.Type":new A(310)}},CLitRLCircle:{classname:"VCXCircle_Spec",classFcntName:V,additionalProperties:{"Collab.Is.Paper":new M(!1)}},CLitRLArrow:{classname:void 0,classFcntName:void 0},CLitRLArrowLinear:{classname:"VCXLinearArrow_Spec",classFcntName:d,additionalProperties:{"Collab.Is.Paper":new M(!1)}},CLitRLArrowCircular:{classname:"VCXCircularArrow_Spec",classFcntName:m,additionalProperties:{"Collab.Is.Paper":new M(!1)}},CLitRLArrowCorner:{classname:"VCXCornerArrow_Spec",classFcntName:g,additionalProperties:{"Collab.Is.Paper":new M(!1)}},CLit2dWidgetImage:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetImagePaperSpace:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetImageFromDigger:{classname:"VCXDiggerPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetImagePaperSpaceFromDigger:{classname:"VCXDiggerPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetImagePaperSpaceFromCropArea:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetArea:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetText:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Background.Show":new M(!0),"Collab.Text.Availability":new A(1),"Collab.Attach.3DAttach":new M(!1)}},CLit2dWidgetTextPaperSpace:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Background.Show":new M(!0),"Collab.Text.Availability":new A(1),"Collab.Attach.3DAttach":new M(!1)}},CLitVectorImage:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLitVectorImageFromDetailView:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Attach.3DAttach":new M(!1)}},CLitVectorImage3D:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.3D.Paper.Positioning.Type":new A(1001),"Collab.3D.Paper.Billboard.Type":new A(0),"Collab.3D.Paper.Size.Control.Type":new A(0),"Actor.IsAlwaysOnTop":new M(!1)}},CLitPanel:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.3D.Paper.Positioning.Type":new A(1001),"Collab.3D.Paper.Billboard.Type":new A(0),"Collab.3D.Paper.Size.Control.Type":new A(0),"Actor.IsAlwaysOnTop":new M(!1)}},CLitText2d:{classname:"VCXLabel_Spec",classFcntName:S,additionalProperties:{"Collab.Body.HAlignment":new A(0),"Collab.Body.VAlignment":new A(0),"Collab.Text.Availability":new A(1),"Collab.Text.HAlignment":new A(0)}},CLitText2dPaperSpace:{classname:"VCXPanel_Spec",classFcntName:S,additionalProperties:{"Collab.Body.HAlignment":new A(0),"Collab.Body.VAlignment":new A(0),"Collab.Background.Show":new M(!0),"Collab.Text.Availability":new A(1),"Collab.3D.Paper.Positioning.Type":new A(101),"Collab.UseDepthFromAnchor":new M(!0),"Collab.Text.Wordwrap":new M(!1),"Collab.Text.HAlignment":new A(1),"Collab.Text.VAlignment":new A(1)}},CLitTextMultiplePoints:{classname:"VCXLabel_Spec",classFcntName:S,additionalProperties:{"Collab.Body.HAlignment":new A(0),"Collab.Body.VAlignment":new A(1),"Collab.3D.Paper.UsesBarycenter":new M(!1)}},CLitCalloutMP:{classname:"VCXCallout_Spec",classFcntName:S},CLitCallout:{classname:"VCXCallout_Spec",classFcntName:S},CLitActorComposite:{classname:void 0,classFcntName:void 0},CLitActorCompositeIntersect:{classname:void 0,classFcntName:void 0},CLitCS:{classname:void 0,classFcntName:void 0},CLitGrid:{classname:void 0,classFcntName:void 0},CLitLight:{classname:void 0,classFcntName:void 0},CLitActorBBox:{classname:void 0,classFcntName:void 0},CLitActorPrim:{classname:"VCXComponentMeshPrimitive",classFcntName:i},CLitActorCompass:{classname:"VCXCompass_Spec",classFcntName:P},CLitActorAxis:{classname:void 0,classFcntName:void 0},CLitDigger:{classname:"VCXDigger_Spec",classFcntName:v},CLitActorMagnetLine:{classname:void 0,classFcntName:void 0},CLitSelectionHotSpot:{classname:"VCXComponentHotspot",classFcntName:b},CLitTargetObject:{classname:void 0,classFcntName:void 0},CLitCuttingPlane:{classname:"VCXSection_Spec",classFcntName:X},CLitActorCurvePolylinePath:{classname:"VCXComponentPath",classFcntName:C},CLitActorCurvePolylinePathAssociative:{classname:"VCXComponentAssociativePath",classFcntName:C}};return e.extend({init:function(){this._Converters={},this._mapComponentConverter=new Map,t.mapConverters&&console.warn("Converters map should be undefined"),t._factory=this},clear:function(){this._Converters=null,this._mapComponentConverter=null,delete t._factory},getV1Ids:function(){return I},createPropertiesMap:function(e,t,r,a,o){if(e){var n=this._mapComponentConverter.get(e.GetObject());if(!n)for(var i in I)I[i].classname===e.GetObject().GetType()&&(n=new I[i].classFcntName,this._Converters[I[i].classname]=n,this._mapComponentConverter.set(e.GetObject(),n));if(n)return n.getPropertiesMap(e,t,r,a,o);console.warn("Can't find properties set converter")}return console.warn("Can't create properties set"),new Map},create:function(e,t,r,a,o){var n=I[t];if(!n||!n.classname)return null;var i=e.Factory.BuildComponent(n.classname);if(!i)return console.warn("Unable to build component "+n.classname),null;"CLitActorMesh"===t&&i.SetIsMesh(!0);var s=i.QueryInterface("VCXIModifiable");for(var l in n.additionalProperties)n.additionalProperties.hasOwnProperty(l)&&s.OnChangeProperty(l,n.additionalProperties[l]);if(r&&(i.SetID(r),i.IsDressup?e.getManager("VCXDressupManager").AddDressups([i]):i.QueryInterface("W3AISGNodeHolder")&&a&&i.QueryInterface("W3AISGNodeHolder").setPathElement(a),e.ComponentsMap.AddComponent(i)),o&&void 0!==o&&!i.IsDressup){var p=i.QueryInterface("VCXIModelNavigable"),u=o.QueryInterface("VCXIModelNavigable");p&&u&&p.setParent(u)}var c=this._Converters[n.classname];return c||(c=new n.classFcntName,this._Converters[n.classname]=c),this._mapComponentConverter.set(i,c),i}})}),define("DS/VCXWebInteropSMG/VCXSmgXmlLoader",["UWA/Class","DS/CoreEvents/Events","DS/Visualization/PathElement","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Mesh/MeshUtils","DS/VCXKeyFramer/VCXScenario","DS/VCXWebProperties/VCXPropertySet","DS/VCXWebProperties/VCXProperty","DS/VCXWebProperties/VCXPropertyValueFloat","DS/VCXWebProperties/VCXPropertyValueInt","DS/VCXWebProperties/VCXPropertyValueString","DS/VCXWebProperties/VCXPropertyValueLink","DS/VCXWebProperties/VCXPropertyValueBoolean","DS/VCXWebProperties/VCXPropertyInfo","DS/VCXWebProperties/VCXPropertyValueMap","DS/VCXWebProperties/VCXPropertyValueEnum","DS/VCXWebProperties/VCXPropertyValueVector","DS/VCXWebProperties/VCXPropertyValueBin","DS/VCXWebModifiables/VCXMetaPropertyDef","DS/VCXWebInteropSMG/VCXSmgLoaderModifiableFactory","DS/VCXWebInteropSMG/VCXSmgLoaderPropertiesModifiableBomManager","DS/VCXWebKernelCommands/VCXCmdChangeSequence","DS/VCXWebKernelCommands/VCXCmdChangeScenarioSequence","DS/VCXWebKernelCommands/VCXCmdChangeKeys","DS/VCXWebKernelCommands/VCXCmdChangeNeutralProperties","DS/VCXWebKernelCommands/VCXCmdChangePropertiesAutokey","DS/VCXWebKernelCommands/VCXCmdGoToScenario","DS/VCXWebKernel/VCXCmdChangeMarker","DS/VCXWebKernelTools/VCXMeshServices","DS/VCXWebUnits/VCXUnitType","DS/VCXWebKernelTools/VCXLogServices","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebInteropSMG/VCXSmgXmlDataStorage","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG","i18n!DS/VCXWebModifiables/assets/nls/VCXWebModifiables"],function(e,t,r,a,o,n,i,s,l,p,u,c,C,d,m,g,V,h,f,y,S,v,b,P,X,A,M,I,D,L,w,x,B,_,T,F){"use strict";var G=e.extend({init:function(){this._vcxViewport=null,this._vcxCompass=null,this._vcxBom=null,this._vcxBomInfo=null,this._vcxDigger=null,this._vcxScenarioAnimationSmg=null,this._mapGeodes=null,this._mapSequences={},this._resources=null,this._experienceBase=null,this._allPMIs=[],this._allPmisConstructionGeometries=[],this._modifiableFactory=new S,this._materialManager=null,this._documentProperties={},this._v1ComponentType={},this._smgViewFile=null,this._smgSceFile=null,this._smgXmlMasterFile=null,this._smgXmlMap=null,this._smgSceFileParsing=!1,this._listSmgXmlRootNodes=[],this._statNb3DNodes=0},loadXMLDoc:function(e){var t;(t=window.ActiveXObject?new ActiveXObject("Msxml2.XMLHTTP"):new XMLHttpRequest).open("GET",e,!1);try{t.responseType="msxml-document"}catch(e){}return t.send(""),t.responseXML},getNodes:function(e){if(void 0===e)return[];if(e instanceof Array)return e;var t=[];return t.push(e),t},getServerFromType:function(e,t){for(var r=[],a=0;a<e.length;a++){var o=e[a];o["@attributes"].Type===t&&r.push(o)}return r},SetSMGXMLs:function(e){this._smgXmlMap=e},GetSMGXMLs:function(e){this._smgXmlMap=e},SetSMGViewFile:function(e){this._smgViewFile=e},GetSMGViewFile:function(){return this._smgViewFile},SetSMGSceFile:function(e){this._smgSceFile=e},GetSMGSceFile:function(){return this._smgSceFile},SetMasterFileName:function(e){this._smgXmlMasterFile=e},concatArray:function(e){if(e instanceof Array){for(var t="",r=0;r<e.length;r++)t+=e[r];e=t}return e},createGroupSelectionSet:function(e){var t=e["@attributes"],r=t.Name,a=t.Ident,o=this._experienceBase.Factory.BuildComponent("VCXComponentGroupSelectionSet");o.SetID(a),this._experienceBase.ComponentsMap.AddComponent(o);for(var n=[],i=this.getNodes(e.CLitSelection),s=0;s<i.length;s++){var l=this.createSelectionSet(i[s]);l&&(l.GroupID=a,n.push(l.GetID()))}o.SetArrayActors(n),o.SetName(r);var p=o.QueryInterface("VCXIModifiable"),u=new A(this._experienceBase.getManager("VCXScenarioManager"));u.CaptureNeutralProperties(p),this._experienceBase.getManager("VCXCommandManager").Do(u)},createSelectionSet:function(e){var t=e["@attributes"],r=t.Name,a=t.Ident,o=this._experienceBase.Factory.BuildComponent("VCXComponentSelectionSet");o.SetID(a),this._experienceBase.ComponentsMap.AddComponent(o);var n=[],i=e["#text"];if(i){(n=this.concatArray(i).split("#")).pop();var s=n.indexOf("-1");-1!==s&&(n[s]="VCX_RootSMG")}o.SetName(r),o.SetArrayActors(n);var l=o.QueryInterface("VCXIModifiable"),p=new A(this._experienceBase.getManager("VCXScenarioManager"));return p.CaptureNeutralProperties(l),this._experienceBase.getManager("VCXCommandManager").Do(p),o},parseListSelection:function(e){console.log("PARSE SELECTION SETS");for(var t=this.getNodes(e.CLitSelection),r=0;r<t.length;r++){var a=t[r];a.CLitSelection?this.createGroupSelectionSet(a):this.createSelectionSet(a)}},parseDocumentSMGXML:function(e){var r=e["@attributes"].VersionSeemage;if(parseFloat(r)<7){var a={level:"warning",title:"Warning",message:T["Notification.UnsupportedVersion"]};this._experienceBase.getManager("VCXNotificationManager").addNotification(a)}this._mapSequences={},this._allPMIs=[];var o=e.Server,n=this.getServerFromType(o,"CLitIOManager");for(var s in n[0])n[0][s]["@attributes"]&&(this._documentProperties[s]=n[0][s]["@attributes"]);for(var c=this.getServerFromType(o,"PropertyDefinitions"),C=0;C<c.length;C++){var d=c[C];this.parseMetaPropertyDefinitions(d)}var g=this.GetFPSAndInterFrames(o),V=g.fps,h=g.interframeMax,f=this.getServerFromType(o,"CLitKKeyframer")[0];f&&f.Play&&f.Play["@attributes"]&&(f.Play["@attributes"].FPS&&(V=parseFloat(f.Play["@attributes"].FPS)),f.Play["@attributes"].InterFramesMax&&(h=parseInt(f.Play["@attributes"].InterFramesMax)));var y=1e3,S=this.getServerFromType(o,"CLitViewportManager")[0];S&&S.CameraSmoothTime&&S.CameraSmoothTime["@attributes"]&&S.CameraSmoothTime["@attributes"].Value&&(y=2*parseFloat(S.CameraSmoothTime["@attributes"].Value));var v=new u(h),X=new l(new m("ScenarioManager.InterFramesMax",2),v),D=new p(V),L=new l(new m("ScenarioManager.FPS",2),D),x=new p(y),B=new l(new m("ScenarioManager.TransitionTime",2),x),_=this._experienceBase.getManager("VCXScenarioManager"),F=_.QueryInterface("VCXIModifiable"),W=new M(_,this._experienceBase.getManager("VCXCommandManager"),!0);W.ChangeProperty(F,L),W.ChangeProperty(F,X),W.ChangeProperty(F,B),this._experienceBase.getManager("VCXCommandManager").Do(W),_.SetCurrentFrame(0),this._experienceBase.getManager("VCXGUIManager").InitGUI(),this._experienceBase.getManager("VCXExperience").InitImagePanels();var N,k=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence"),O=k.QueryInterface("VCXIModifiable");N=T["Sequence.Animation"],k.SetName(N),k.SetSequenceType(0);var R=new A(this._experienceBase.getManager("VCXScenarioManager"));R.CaptureNeutralProperties(O),this._experienceBase.getManager("VCXCommandManager").Do(R);var E=this._experienceBase.getManager("VCXSequenceManager"),U=new b(E,this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);U.PushSequence(k),this._experienceBase.getManager("VCXCommandManager").Do(U);var H=this._experienceBase.Factory.BuildComponent("VCXScenario"),z=H.QueryInterface("VCXIModifiable");H.SetID("AnimationSmgID"),H.SetName("Animation smg"),H.SetScenarioType(i.EScenarioType.Scenario),this._vcxScenarioAnimationSmg=H;var K=this._resources["image.bmp"],Q=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(K,"image.bmp");if(Q){var j=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(Q);z.OnChangeProperty("Actor.DocID",j)}var q=new P(E,this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);q.PushScenarioInSequence(H,k.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(q);var Y=new I(_,this._experienceBase.getManager("VCXCommandManager"));Y.GoToScenario(H.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(Y);var Z=this.getServerFromType(o,"CLitKKeyframer");this.parseMarkers(Z[0],H);var J=this.getServerFromType(o,"CLitServerModifiable");this._layerAnimation=J[0].CLitViewport?J[0].CLitViewport.CLitView:null,this.parseServerModifiable(J[0],H);var $=this.getServerFromType(o,"CLitKBOMManager");if(this._experienceBase.getManager("VCXComponentBomManager")){var ee=this._experienceBase.getManager("VCXComponentBomManager").QueryInterface("VCXIModifiable");this._modifiableFactory.createPropertiesMap(ee,this._experienceBase,$[0],this._experienceBase.ComponentsMap,this._resources,"CLitKBOMManager").forEach(function(e,t){var r=t,a=e;ee.OnChangeProperty(r,a)})}var te=-1,re=-1,ae=this.getServerFromType(o,"CLitPaperOutputManager");for(C=0;C<ae.length;C++){var oe=ae[C];if(oe["Vectorize.Paper.Width"]&&oe["Vectorize.Paper.Height"]&&oe["Vectorize.Paper.Landscape"]){var ne=parseInt(oe["Vectorize.Paper.Landscape"]["@attributes"].Value),ie=parseFloat(oe["Vectorize.Paper.Width"]["@attributes"].Value),se=parseFloat(oe["Vectorize.Paper.Height"]["@attributes"].Value);1===ne&&se>ie||0===ne&&se<ie?(te=se,re=ie):(te=ie,re=se)}else oe["Vectorize.Paper.Width"]&&(te=parseFloat(oe["Vectorize.Paper.Width"]["@attributes"].Value)),oe["Vectorize.Paper.Height"]&&(re=parseFloat(oe["Vectorize.Paper.Height"]["@attributes"].Value))}var le=this._experienceBase.getManager("VCXContextManager").getActiveViewport();if(le){var pe=le.QueryInterface("VCXIModifiable");pe&&(te>=0&&pe.OnChangeProperty("Paper.Width",new p(te)),re>=0&&pe.OnChangeProperty("Paper.Height",new p(re)))}var ue=this._experienceBase.getManager("VCXUnitManager");if(ue){var ce=this.getServerFromType(o,"CLitUnitManager");for(C=0;C<ce.length;C++){var Ce=ce[C];if(Ce)for(var de in Ce)if("Unit."===de.substring(0,5)){var me=de.substring(5),ge=ue.getUnitType(me);if(ge){var Ve=Ce[de];switch(ge.Precision=parseInt(Ve["@attributes"].Precision),ge.SymbolDisplay=parseInt(Ve["@attributes"].ShowName),ge.DisplayUnit=G.unitsTranslation[me][Ve["@attributes"].Range],ge.InternUnit=G.unitsTranslation[me][Ve["@attributes"].RangeLitToSI],Ve["@attributes"].Separator){case"44":ge.LanguageDisplay=w.ELanguageDisplay.fr;break;case"46":ge.LanguageDisplay=w.ELanguageDisplay.en;break;case"59":ge.LanguageDisplay=w.ELanguageDisplay.local}}}}}for(c=this.getServerFromType(o,"PropertyDefinitions"),C=0;C<c.length;C++){d=c[C];this.parseMetaPropertyDefinitions(d)}if(this.parseSceFileIfExists(),this.GetSMGViewFile()){var he=this.GetSMGViewFile().ViewsSMG.Server,fe=this.getServerFromType(he,"CLitList");for(C=0;C<fe.length;C++){(be=fe[C]).CLitView&&this.parseViews(be)}}for(fe=this.getServerFromType(o,"CLitList"),C=0;C<fe.length;C++){(be=fe[C]).CLitSelection?this.parseListSelection(be):be.CLitView&&this.parseViews(be)}for(C=0;C<this._listSmgXmlRootNodes.length;C++){var ye=this._listSmgXmlRootNodes[C];if(ye)for(var Se=ye.GetSmgXmlViewsNode(),ve=0;ve<Se.length;ve++){var be;(be=Se[ve]).CLitSelection&&(this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot(ye),this.parseListSelection(be),this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot())}}var Pe=this._documentProperties.LaunchAction;Pe&&"1"===Pe.Value&&this._experienceBase.getManager("VCXExperience").SetViewMode(1),this._experienceBase.getManager("VCXHotspotManager")&&this._experienceBase.getManager("VCXHotspotManager").UpdateHotspotsHyperlinks(),this._experienceBase.getManager("SUIManager")&&this._experienceBase.getManager("SUIManager").syncCameraSystemModifiables(),t.publish({event:"VCX_REFRESH_ICON",data:H}),t.publish({event:"VCX_KEYS_CHANGED"})},GetFPSAndInterFrames:function(e){var t=null,r={};if(this.GetSMGSceFile()){var a=this.GetSMGSceFile().ScenarioSMG.Server;t=this.getServerFromType(a,"CLitKKeyframer")}else t=this.getServerFromType(e,"CLitKKeyframer");if(t){var o=t[0];o&&o.Play&&o.Play["@attributes"]&&(o.Play["@attributes"].FPS&&(r.fps=parseFloat(o.Play["@attributes"].FPS)),o.Play["@attributes"].InterFramesMax&&(r.interframeMax=parseInt(o.Play["@attributes"].InterFramesMax)))}return r},parseSceFileIfExists:function(){if(this.GetSMGSceFile()){this._smgSceFileParsing=!0;var e=this.GetSMGSceFile().ScenarioSMG.Server,t=this.getServerFromType(e,"CLitServerModifiable");if(1==t.length){var r=t[0];for(var a in this._modifiableFactory.getV1Ids()){var o=this.getNodes(r[a]);if(o.length)for(var n=0;n<o.length;n++){var i=o[n],s="",l=i["@attributes"];if(l){var p=l.NetGuid,u=l.Ident;p?s=l.NetGuid:u&&(s=l.Ident);var c=this._experienceBase.ComponentsMap.GetComponentFromID(s),C=c?c.QueryInterface("VCXIModifiable"):null;C&&(this.parseNeutrals(i,C,a),this.parseTracks(i,C,a))}}}}this._smgSceFileParsing=!1}},parseMarkers:function(e,t){if(void 0!==e&&void 0!==e.Markers&&e.Markers.CLitMarker){var r=[];e.Markers.CLitMarker.length?r=e.Markers.CLitMarker:r.push(e.Markers.CLitMarker);for(var a=this._experienceBase.getManager("VCXCommandManager"),o=new D(this._experienceBase.getManager("VCXScenarioManager"),a,this._experienceBase.ComponentsMap),n=new M(this._experienceBase.getManager("VCXScenarioManager"),a,!0),i=0;i<r.length;i++){var s=r[i],p=s["@attributes"].Pos,C=s["@attributes"].Label,g=s["@attributes"].Milestone,V=C+"_"+p,h=this._experienceBase.Factory.BuildComponent("VCXComponentMarker");h.SetID(V),o.AddMarkerToScenario(h,t,parseInt(p,10));var f=new u;f.FromString(p);var y=new l(new m("Actor.TimePos",2),f),S=new c(C),v=new l(new m("Actor.Name",2),S),b=new d;b.FromString(g);var P=new l(new m("Actor.IsMilestone",2),b),X=h.QueryInterface("VCXIModifiable");n.ChangeProperty(X,y),n.ChangeProperty(X,v),n.ChangeProperty(X,P)}a.Do(n),a.Do(o);var I=t.QueryInterface("VCXIModifiable"),L=new A(this._experienceBase.getManager("VCXScenarioManager"));L.CaptureNeutralProperties(I),this._experienceBase.getManager("VCXCommandManager").Do(L)}},parseMetaPropertyDefinitions:function(e){for(var t=e.MetaProperties,r=this.getNodes(t.Meta),a=0;a<r.length;a++){var o=r[a],n="VCXPropertyValueString";switch(o["@attributes"].Type){case"String":n="VCXPropertyValueString";break;case"Bool":n="VCXPropertyValueBoolean";break;case"Color":n="VCXPropertyValueColor";break;case"Date":n="VCXPropertyValueDate";break;case"Float":n="VCXPropertyValueFloat";break;case"Int":n="VCXPropertyValueInt";break;default:n="VCXPropertyValueString"}var i=new m(o["@attributes"].Name,0,!0);"1"===o["@attributes"].Bounded&&("VCXPropertyValueInt"===n?i.SetBounds(parseInt(o["@attributes"].MinValue),parseInt(o["@attributes"].MaxValue)):"VCXPropertyValueFloat"===n&&i.SetBounds(parseFloat(o["@attributes"].MinValue),parseFloat(o["@attributes"].MaxValue))),i.SetGroupId("Group.UserProperties"),i.Seti18nGroup(F);var s=new y(i,n);s.SetDefaultLabel(o["@attributes"].DefaultLabel),i.SetMetaPropertyDef(s),this._experienceBase.getManager("VCXMetaPropertyManager").AddMetaPropertyDef(s)}},parseViews:function(e){x.memoryLog("VCXSmgXmlLoader parseViews",!0);for(var t=this.getNodes(e.CLitView),r=0;r<t.length;r++)this.parseView(t[r]);x.memoryLog("VCXSmgXmlLoader parseViews",!1)},parseView:function(e){if("1"!==(W=e["@attributes"]).IsUsedByUpdatableCapture){var t=this._experienceBase.Factory.BuildComponent("VCXScenario"),r=W.Ident;W.Type!==G.ViewType.CadViews&&W.Type!==G.ViewType.CadCaptures||(r+=W.Type),t.SetID(r),"1"===W.AppliedToObject&&"1"===W.AppliedToProperties&&"0"===W.AppliedToSelection||t.SetApplyNeutralAtGoToScenario(!1);var a="1"===W.AppliedZoomFitAll||W.Type===G.ViewType.CadViews;t.SetZoomFitAll(a);var o=W.Type===G.ViewType.CadViews;if(!o&&e.Neutral){var n=e.Neutral["CADView.AppliedToPMIOnly"];if(n){var s=n["@attributes"];s&&(o="1"===s.Value)}}var l="view"+W.Ident+".jpg";l=l.toLowerCase();var p=this._resources[l],u=t.QueryInterface("VCXIModifiable"),c=this._experienceBase.getManager("VCXDocManager").BuildPathFromString(p,l);if(c){var C=this._experienceBase.getManager("VCXDocManager").AddOrModifyDoc(c);u.OnChangeProperty("Actor.DocID",C)}var d=!1,m=W.CollectionName;void 0!==m&&""!==m&&(d=!0);var g="Unknown",V=i.EScenarioType.Scenario;if(d?g=m:(W.Type===G.ViewType.Views?g="Views":W.Type===G.ViewType.Layers?(g="Layers",V=i.EScenarioType.Layer):W.Type===G.ViewType.CadViews?(g="CADViews",V=i.EScenarioType.CADView):W.Type===G.ViewType.CadCaptures&&(g="CADCaptures",V=i.EScenarioType.CADCapture),g=T["Sequence."+g]),t.SetName(W.Name),t.SetScenarioType(V),this.parseViewVisibility(t,e,o),!o&&"1"===W.AppliedToObject&&"1"===W.AppliedToVisibility&&"1"!==W.AppliedToSelection)if(this._documentProperties["View.VisibleBehavior"])switch(this._documentProperties["View.VisibleBehavior"].Value){case G.ViewCompressionV1.VisibleActors:case G.ViewCompressionV1.VisibleAssemblies:t.GetVisibility().SetMode(1),t.GetVisibility().AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());break;case G.ViewCompressionV1.HiddenActors:case G.ViewCompressionV1.HiddenAssemblies:t.GetVisibility().SetMode(2);break;default:t.GetVisibility().SetMode(0)}else t.GetVisibility().SetMode(1),t.GetVisibility().AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());(R=new A(this._experienceBase.getManager("VCXScenarioManager"))).CaptureNeutralProperties(u),this._experienceBase.getManager("VCXCommandManager").Do(R),this._vcxCamera||(this._vcxCamera=this.createCamera(),this._experienceBase.getManager("VCXContextManager").setActiveCamera(this._vcxCamera));var h=e.Camera;if(h)for(var f=this.getNodes(h.CLitModifiable),y=0;y<f.length;y++)this.addModifiableNodeToView(t,f[y],null);else{var S=e.Navigator;if(void 0!==S){var v=this._vcxCamera.QueryInterface("VCXIModifiable");this.addModifiableToView(t,v,S)}}if(void 0!==e.Navigator&&this._vcxCompass){var X=this._vcxCompass.QueryInterface("VCXIModifiable");this.addModifiableToView(t,X,e.Navigator)}var M=e.Viewport;if(M&&this._vcxViewport){var I=this._vcxViewport.QueryInterface("VCXIModifiable");this.addModifiableToView(t,I,M)}var D=e.Configuration;if(D){var L=this.getNodes(D.CLitModifiable);if(void 0!==L)for(var w=0;w<L.length;w++){var x=L[w];this.addModifiableNodeToView(t,x)}}var B=e.BOMInfo;if(void 0!==B){var _=this._vcxBomInfo.QueryInterface("VCXIModifiable");this.addModifiableToView(t,_,B)}var F=e.Digger,W=e["@attributes"];if(void 0!==F&&W&&"1"===W.AppliedToDigger){var N=null,k=this._experienceBase.ComponentsMap.GetComponentFromID("VCX_Digger.-1");if(k||(k=this._modifiableFactory.create(this._experienceBase,"CLitDigger","VCX_Digger.-1",void 0),this._v1ComponentType["VCX_Digger.-1"]="CLitDigger"),k&&(N=k.QueryInterface("VCXIModifiable")),N)if(this.addModifiableToView(t,N,F),N.loadParentMode="DigZoom",this.addModifiableToView(t,N,e.DigZoom),N.loadParentMode="DigOnionSkin",this.addModifiableToView(t,N,e.DigOnionSkin),N.loadParentMode="DigXRay",this.addModifiableToView(t,N,e.DigXRay),F["Inspector.Enabled"])if("1"===F["Inspector.Enabled"]["@attributes"].Value)t.GetVisibility().AddVisibleCollab(k)}var O=this._mapSequences[g];if(!O){var R,E=(O=this._experienceBase.Factory.BuildComponent("VCXScenarioSequence")).QueryInterface("VCXIModifiable");O.SetName(g),O.SetSequenceType(V),(R=new A(this._experienceBase.getManager("VCXScenarioManager"))).CaptureNeutralProperties(E),this._experienceBase.getManager("VCXCommandManager").Do(R);var U=new b(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);U.PushSequence(O),this._experienceBase.getManager("VCXCommandManager").Do(U),this._mapSequences[g]=O}if(O){var H=new P(this._experienceBase.getManager("VCXSequenceManager"),this._experienceBase.getManager("VCXCommandManager"),this._experienceBase.ComponentsMap);H.PushScenarioInSequence(t,O.GetID()),this._experienceBase.getManager("VCXCommandManager").Do(H)}}},parseActorList:function(e){if(void 0!==e){var t=[],r=e["#text"];if(void 0!==r){var a=this.concatArray(r).split("#");a.pop();for(var o=0;o<a.length;o++){var n=a[o];"-1"===n&&(n="VCX_RootSMG");var i=new C(n);t.push(i)}}if(t.length)return new g(t)}return null},parseViewVisibility:function(e,t,r){if(t){var a=e.GetVisibility();if(a){if(r)a.SetMode(0),a.AddInvisibles(this._allPMIs.slice(0).concat(this._allPmisConstructionGeometries.slice(0)));else if(e.GetApplyNeutralAtGoToScenario()){var o=e.QueryInterface("VCXIModifiable"),n=new V;if(this._documentProperties["View.VisibleBehavior"])switch(this._documentProperties["View.VisibleBehavior"].Value){case G.ViewCompressionV1.VisibleActors:case G.ViewCompressionV1.VisibleAssemblies:n.SetValue(1),a.AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());break;case G.ViewCompressionV1.HiddenActors:case G.ViewCompressionV1.HiddenAssemblies:n.SetValue(2);break;default:a.SetMode(0)}else n.SetValue(1),a.AddVisibleToGroups(this._experienceBase.getManager("VCXContextManager").getRootComponent());var i=new A(this._experienceBase.getManager("VCXScenarioManager"));i.ChangeProperty(o,"Scenario.Visibility.Mode",n),this._experienceBase.getManager("VCXCommandManager").Do(i)}else a.SetMode(0);var s=t.Living;if(void 0!==s){var l=s["#text"];if(void 0!==l)for(var p=this.concatArray(l).split("#"),u=0;u<p.length;u++){var c=p[u];"-1"===c&&(c="VCX_RootSMG"),(h=this._experienceBase.ComponentsMap.GetComponentFromID(c))&&(h.IsKindOf("VCXWebComponentOccurrence")&&!h.IsDressup?(r&&a.RemoveInvisible(h),a.AddVisibleToDescendants(h)):a.AddVisibleCollab(h))}}var C=t.Invisible;if(void 0!==C){var d=C["#text"];if(void 0!==d)for(var m=this.concatArray(d).split("#"),g=0;g<m.length;g++){var h,f=m[g];"-1"===f&&(f="VCX_RootSMG"),(h=this._experienceBase.ComponentsMap.GetComponentFromID(f))&&a.AddInvisibleToDescendants(h)}}if(this._vcxCompass){var y=t.Navigator;if(void 0===y&&(y=t),void 0!==y){var S=y["Navigator.Compass.Visibility"];if(void 0!==S){var v=S["@attributes"];void 0!==v&&("0"===v.Value||"false"===v.Value?a.AddInvisible(this._vcxCompass):a.AddVisibleCollab(this._vcxCompass))}}}if(this._vcxDigger){var b=t;void 0!==b&&b.Tracks&&b.Tracks.Track&&a.AddVisibleCollab(this._vcxDigger)}}}},addModifiableToView:function(e,t,r){if(t){var a=t.GetObject().GetID(),o=this._v1ComponentType[a],n=this._modifiableFactory.createPropertiesMap(t,this._experienceBase,r,this._resources,o),i=new X(this._experienceBase.getManager("VCXScenarioManager"));i.SetLockEvents(!0),i.SetLockUpdateProperties(!0),i.SetCloneValues(!1),n.forEach(function(r,a){var o=a,n=r;i.ChangeKey(e,t,o,parseFloat(0),n)}),this._experienceBase.getManager("VCXCommandManager").Do(i)}},addModifiableNodeToView:function(e,t){if(void 0!==t){var r=t["@attributes"].Ident,a=this._experienceBase.ComponentsMap.GetComponentFromID(r);if(a){var o=a.QueryInterface("VCXIModifiable");this.addModifiableToView(e,o,t)}else console.log("Can't find component "+r)}},createNodeForRefrencedXMLGrp:function(e,t,r,a,n,i,s,l){var p=t["@attributes"],u=null,c=null;if(i){this._statNb3DNodes++,(u=new o(p.Ident)).productType="Instance3D",a.add(u),n.addElement(u);var C=r;if(""===r&&(C="VCX_RootSMG"),(c=this._modifiableFactory.create(this._experienceBase,"CLitAssyGroup",C,n,s))&&""===r&&c.SetPersistency(1),c){c.SetGUID(p.Ident);var d=c.QueryInterface("VCXIModifiable");this.parseNeutrals(t,d,"CLitAssyGroup")}l&&l.AddComponent(c)}this.parseReferencedXML(e,r,u,n.clone(),!1,i,c,l)},tryToRetrieveRefXMLPath:function(e,t){var r=null,a=null;if(e=e.toLowerCase(),this._smgXmlMap.has(e))r=e;else if(e.startsWith(".\\")){var o=e.slice(2);this._smgXmlMap.has(o)?r=o:(a=o.replace(/\\/g,"/"),this._smgXmlMap.has(a)&&(r=a))}else a=e.replace(/\\/g,"/"),this._smgXmlMap.has(a)&&(r=a);if(!r&&t){var n=t.GetSmgXmlRelativePath().replace(/\\/g,"/"),i=n.slice(0,n.lastIndexOf("/"));o=null;e.startsWith(".\\")?(o=i+"\\"+(o=e.slice(2)),this._smgXmlMap.has(o)&&(r=o)):(o=i+"\\"+e,this._smgXmlMap.has(o)&&(r=o))}return r},parseReferencedXML:function(e,t,r,a,o,n,i,s){var l=this.tryToRetrieveRefXMLPath(e,s);if(l){var p=this._smgXmlMap.get(l);if(p){var u=B.loadXMLString(p),c=B.xmlToJson(u).DocumentSMG,C=c.Server,d=this.getServerFromType(C,"CLitServerModifiable")[0].CLitAssyRoot,m=new _;if(m.SetSmgXmlDocument(c),m.SetSmgXmlRelativePath(l),n){this._listSmgXmlRootNodes.push(m);for(var g=this.getServerFromType(C,"PropertyDefinitions"),V=0;V<g.length;V++){var h=g[V];this.parseMetaPropertyDefinitions(h)}}this.parseAssyGroup(d,t,r,a,!0,n,i,m)}}},parseServerModifiable:function(e,t){var a=this._experienceBase.getManager("VCXContextManager").getRootNode(),o=this._experienceBase.getManager("VCXContextManager").getRootComponent(),n=e.CLitAssyRoot;void 0===n&&(n=e);var i=o.QueryInterface("W3AISGNodeHolder").getPathElement().clone(),s="";void 0!==n&&(this._experienceBase.getManager("VCXContextManager").setActiveBOM(this._vcxBom),x.memoryLog("VCXSmgXmlLoader Build Actors",!0),s="",this.parseAssyGroup(n,s,a,i,!0,!0,o),x.memoryLog("VCXSmgXmlLoader Build Actors",!1),x.memoryLog("VCXSmgXmlLoader Fill neutrals and tracks",!0),s="",this.parseAssyGroup(n,s,a,i,!0,!1,o),x.memoryLog("VCXSmgXmlLoader Fill neutrals and tracks",!1));var l=e.CLitVectorImageBOM;if(void 0!==l){i=new r;this._vcxBom=this.parseAnnotations("CLitVectorImageBOM",l,"",i,!0),this.parseAnnotations("CLitVectorImageBOM",l,"",i,!1),this._experienceBase.getManager("VCXContextManager").setActiveBOM(this._vcxBom)}var p=e.CLitBOMInfo;if(void 0!==p){i=null;this._vcxBomInfo=this.parseAnnotations("CLitBOMInfo",p,"CLitBOMInfoId",i,!0),this.parseAnnotations("CLitBOMInfo",p,"CLitBOMInfoId",i,!1)}var u=e.CLitActorGround;if(void 0!==u){i=new r;this._vcxGround=this.parseAnnotations("CLitActorGround",u,"",i,!0),this.parseAnnotations("CLitActorGround",u,"",i,!1),this._experienceBase.getManager("VCXContextManager").setActiveGround(this._vcxGround)}if(void 0!==(c=e.CLitViewport)){i=new r;this._vcxViewport=this.parseAnnotations("CLitViewport",c,"",i,!0),this.parseAnnotations("CLitViewport",c,"",i,!1)}if(void 0!==c&&c.CLitNavigator&&void 0!==c.CLitNavigator){i=new r;this._vcxCompass=this.parseAnnotations("CLitActorCompass",c.CLitNavigator,"VCX_Compass",i,!0),this.parseAnnotations("CLitActorCompass",c.CLitNavigator,"VCX_Compass",i,!1)}var c,C=void 0!==c?c.CLitDigger:void 0;if(void 0!==C&&C.Tracks&&C.Tracks.Track){i=new r;this._vcxDigger=this.parseAnnotations("CLitDigger",C,"VCX_Digger",i,!0),this.parseAnnotations("CLitDigger",C,"VCX_Digger",i,!1)}for(var d=this.getNodes(e.CLitCameraActor),m=0;m<d.length;m++){i=new r;this._vcxCamera||(this._vcxCamera=this.parseAnnotations("CLitCameraActor",d[m],"",i,!0)),this.parseAnnotations("CLitCameraActor",d[m],"",i,!1),this._experienceBase.getManager("VCXContextManager").setActiveCamera(this._vcxCamera)}if(void 0!==(c=e.CLitViewport)){if(!this._vcxCamera){var g=c.CLitNavigator;void 0!==g&&this.parseNavigator(g)}var V=c.CLitView;this.parseViewVisibility(t,V,!1),void 0!==c.CLitNavigator&&this.parseViewVisibility(t,c.CLitNavigator.Neutral,!1),this.parseViewVisibility(t,c.CLitDigger,!1)}var h=this.getNodes(e.CLitSelectionHotSpot);this.parseHotSpots(h);for(var f=0;f<this._listSmgXmlRootNodes.length;f++){var y=this._listSmgXmlRootNodes[f];if(y){var S=y.GetSmgXmlServerModifNode(),v=this.getNodes(S.CLitSelectionHotSpot);v.length>0&&(this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot(y),this.parseHotSpots(v),this._experienceBase.getManager("VCXContextManager").setSmgXmlRoot())}}},parseHotSpots:function(e){console.log("PARSE HOTSPOTS");for(var t=0;t<e.length;t++){e[t].CLitSelectionHotSpot?this.createGroupHotspot(e[t]):this.createHotspot(e[t])}},createGroupHotspot:function(e){var t=e["@attributes"],r=t.Ident,a=this._experienceBase.Factory.BuildComponent("VCXComponentGroupHotspot");a.SetID(r),this._experienceBase.ComponentsMap.AddComponent(a);var o=e.CLitSelectionHotSpot;if(o){for(var n=[],i=0;i<o.length;i++){var s=o[i],l=this.createHotspot(s);l.GroupID=r,n.push(l.GetID())}var p=t.Name;a.SetName(p),a.SetArrayActors(n);var u=a.QueryInterface("VCXIModifiable"),c=new A(this._experienceBase.getManager("VCXScenarioManager"));c.CaptureNeutralProperties(u),this._experienceBase.getManager("VCXCommandManager").Do(c)}},createHotspot:function(e){var t=e["@attributes"],r=t.Ident;this.parseAnnotations("CLitSelectionHotSpot",e,"",null,!0);var a=this._experienceBase.ComponentsMap.GetComponentFromID(r);if(a){var o=e.Actors;if(o){var n=o["#text"];if(n){var i=this.concatArray(n).split("#");i.pop();var s=i.indexOf("-1");-1!==s&&(i[s]="VCX_RootSMG")}}var l=t.Name;a.SetName(l),a.SetArrayActors(i);var p=a.QueryInterface("VCXIModifiable"),u=new A(this._experienceBase.getManager("VCXScenarioManager"));u.CaptureNeutralProperties(p),this._experienceBase.getManager("VCXCommandManager").Do(u)}return this.parseAnnotations("CLitSelectionHotSpot",e,"",null,!1),a},parseAssyGroup:function(e,t,r,a,n,i,s,l){var p=e["@attributes"];n||(t=""===t?p.Ident:t+"."+p.Ident);var u=null,C=null;if(i)if(n&&l)u=r,C=s;else{this._statNb3DNodes++,(u=new o(p.Ident)).productType="Instance3D",r.add(u),a.addElement(u);var d=t;""===t&&(d="VCX_RootSMG"),(C=this._modifiableFactory.create(this._experienceBase,"CLitAssyGroup",d,a,s))&&""===t&&C.SetPersistency(1),C&&C.SetGUID(p.Ident),l&&l.AddComponent(C)}else{var m=t;if(""===m&&(m="VCX_RootSMG"),C=this._experienceBase.ComponentsMap.GetComponentFromID(m)){var g=C.QueryInterface("VCXIModifiable");if(this.parseNeutrals(e,g,"CLitAssyGroup"),this.parseTracks(e,g,"CLitAssyGroup"),n&&g){var V=g.GetProperty("Actor.Name");if(V)if("-1"===V.GetPropertyValue().GetValue()){var h=new c;h.SetValue("Root"),g.OnChangeProperty("Actor.Name",h)}}}for(var f=this.getNodes(e.CLitCADView),y=0;y<f.length;y++)this.parseView(f[y])}for(var S in this._modifiableFactory.getV1Ids()){var v=this.getNodes(e[S]);if(v.length)switch(S){case"CLitAssyGroup":for(var b=0;b<v.length;b++){var P=v[b]["@attributes"],X=P.IsInstanceOf;if(X){var A="";A=""===t?P.Ident:t+"."+P.Ident,this.createNodeForRefrencedXMLGrp(X,v[b],A,u,a.clone(),i,C,l)}else this.parseAssyGroup(v[b],t,u,a.clone(),!1,i,C,l)}break;case"CLitActorMesh":case"CLitActor":case"CLitActorCurveWire":case"CLitActorPoint":case"CLitActorPrim":case"CLitActorCompositePmi":case"CLitRedline":for(var M=0;M<v.length;M++)this.parseActor(v[M],S,t,u,a.clone(),i,C,l);break;default:for(M=0;M<v.length;M++)this.parseAnnotations(S,v[M],t,a.clone(),i,l)}}if(i&&("0"===p.NeutralVisibility&&this._vcxScenarioAnimationSmg&&!this._layerAnimation)){var I=this._vcxScenarioAnimationSmg.GetVisibility();I&&I.AddInvisible(C)}},getActorCompositePmiArray:function(e,t){var r=e[t];if(!r)return null;if(void 0===r.Data){if("points"===t){var a=[];for(var o in r){if("@attributes"!==o)(i=r[o]["@attributes"])&&(a.push(parseFloat(i.X)),a.push(parseFloat(i.Y)),a.push(parseFloat(i.Z)))}return a}var n=[];for(var o in r){var i;if("@attributes"!==o)(i=r[o]["@attributes"])&&n.push(parseFloat(i.Value))}return n}var s=r["@attributes"];if(!s)return null;var l=parseInt(s.size),p=r.Data["@attributes"];if(!p)return null;for(var u=atob(p.Value),c=new ArrayBuffer(u.length),C=0;C<u.length;C++)c[C]=u.charCodeAt(C);var d=new DataView(c);for(C=0;C<u.length;C++)d.setUint8(C,u.charCodeAt(C));var m=0;if("points"===t){for(a=new Float32Array(3*l),C=0;C<l;C++){var g=3*C;a[g]=d.getFloat32(4*m++,!0),a[g+1]=d.getFloat32(4*m++,!0),a[g+2]=d.getFloat32(4*m++,!0)}return a}var V=new Uint32Array(l);for(C=0;C<l;C++)V[C]=d.getUint32(4*m++,!0);return V},parseActorCompositePmiRepresentation:function(e){this._statNb3DNodes++;var t=new o,r=this.parseDrawPolyline(e);null!==r&&(t.add(r),r.productType="InstanceRep",r.setPickParent(!0));for(var n=this.getNodes(e.CLitDrawSurface),i=0;i<n.length;i++){for(var s=n[i],l=this.getActorCompositePmiArray(s,"points"),p=this.getActorCompositePmiArray(s,"triangles"),u=this.getActorCompositePmiArray(s,"indices"),c=this.getActorCompositePmiArray(s,"types"),C=new Float32Array(3*l.length),d=0;d<l.length;d++){var m=3*d;C[m]=0,C[m+1]=0,C[m+2]=1}var g=L.buildIndexation(l,p,c,u);g.length%3!=0&&console.log("Invalid indexation");var V=g.length/3;if(V){var h=null;this._materialManager&&(h=this._materialManager.getMaterialBasic(new a.Color(0,0,0),1));var f=L.buildIndexedTriangleSet(V,l,C,null,g,g,null,null,h,!1,!0);t.add(f),f.setPickParent(!0),f.productType="InstanceRep"}}return t},parseDrawPolyline:function(e,t){var r=this.getNodes(e.CLitDrawPolyline);if(t){for(var a=new Uint32Array(r.length),o=[],i=0,s=0;s<r.length;s++){if(void 0!==(m=r[s])){var l=this.getActorCompositePmiArray(m,"points");if(null!==l){for(var p=new ArrayBuffer(4*l.length),u=new Float32Array(p),c=0;c<l.length;++c)u[c]=l[c];var C=new Uint8Array(p).toString();t=window.btoa(C);o.push(t)}}}return o}a=new Uint32Array(r.length);var d=[];for(i=0,s=0;s<r.length;s++){var m;if(void 0!==(m=r[s])){var g=this.getActorCompositePmiArray(m,"points");if(null!==g){for(var V=0;V<g.length;V++)d[i++]=g[V];a[s]=g.length/3}}}for(var h=d.length/3,f=L.allocIndexationArray(h,h),y=0;y<h;y++)f[y]=y;var S=new Float32Array(d.length);for(V=0;V<d.length;++V)S[V]=d[V];return L.buildLineStripSet(S,a,f,new n.Color(0,0,0,1),1,"WIRE_EDGE")},parseActor:function(e,t,r,i,s,l,p,u){var C=e["@attributes"];r=""===r?C.Ident:r+"."+C.Ident;var d=null,m=null;if(l){this._statNb3DNodes++,(m=new o(C.Ident)).productType="Instance3D",i.add(m),s.addElement(m),d=this._modifiableFactory.create(this._experienceBase,t,r,s,p),this._v1ComponentType[r]=t,d||console.error("Failed to build VCX component"),d.SetGUID(C.Ident),u&&u.AddComponent(d);var g=null,V=null;if(C.IdentGeom)(T=this._mapGeodes.get(C.IdentGeom))&&(g=T.geode,V=T.userdata);switch(t){case"CLitActorMesh":case"CLitActor":case"CLitActorCurveWire":g||(m.name=C.Ident+" IdentGeom:"+C.IdentGeom+" not found"),V&&6===V.ucGeometryType&&this._allPmisConstructionGeometries.push(d.GetID());break;case"CLitActorPoint":m.name="VCXPoint",(g=L.buildPoint([0,0,0],new n.Color(1,0,0,1),5,null)).setNoZ(!0);break;case"CLitActorPrim":m.name="VCXPrimitive";break;case"CLitRedline":this.generateAnchorsIdsArray(e),m.name="VCXRedline";for(var h=this.parseDrawPolyline(e,!0),y=(B=d?d.QueryInterface("VCXIModifiable"):null)?B.GetPropertyValue("Collab.VertexBuffers"):[],S=0;S<h.length;++S){var v=new f;v.SetValue(h[S]),y.SetValueAtIndex(S,v)}B.OnChangeProperty("Collab.VertexBuffers",y);break;case"CLitActorCompositePmi":var b=e.Neutral;if(b){var P="0";if(b["ActorCompositePmi.IsFromSW"]&&(P=b["ActorCompositePmi.IsFromSW"]["@attributes"].Value),"1"===P)break}if(m.name="VCXFTA",m.setNoZ(!0),g){g.setMaterial(new a.MeshBasicMaterial({color:"#FFFFFF",side:a.DoubleSide,force:!0,opacity:0})),g.setPickParent(!0);var X=s.clone();X.addElement(g),m.add(g);var A=this._experienceBase.getManager("VCXContextManager").getSharedSceneGraphOverride(X,!0);A&&A.setOpacity(0,!0)}if(x=this.parseActorCompositePmiRepresentation(e)){m.add(x),x.setPickParent(!0);var M=[];M[0]=x;var I=e.MirroringRepresentations;if(I)for(var D=this.getNodes(I.MirroringRepresentation),w=0;w<D.length;w++){var x;(x=this.parseActorCompositePmiRepresentation(D[w]))&&(m.add(x),x.setPickParent(!0),x.setVisibility(!1),M[w+1]=x)}d&&(d._representations=M,this._allPMIs.push(d.GetID()))}}g&&(g.productType="InstanceRep",m.add(g))}else{var B;if((B=(d=this._experienceBase.ComponentsMap.GetComponentFromID(r))?d.QueryInterface("VCXIModifiable"):null)&&(this.parseNeutrals(e,B,t),this.parseTracks(e,B,t),null===B._name)){var _=new c,T=null;C.IdentGeom&&(T=this._mapGeodes.get(C.IdentGeom));var F=T?T.name:"";_.SetValue(F),B.OnChangeProperty("Actor.Name",_)}}for(var t in this._modifiableFactory.getV1Ids()){var G=this.getNodes(e[t]);if(G.length)switch(t){case"CLitAssyGroup":for(var W=0;W<G.length;W++)this.parseAssyGroup(G[W],r,m,s.clone(),!1,l,d);break;case"CLitActorMesh":case"CLitActor":case"CLitActorCurveWire":case"CLitActorPoint":case"CLitActorPrim":case"CLitActorCompositePmi":case"CLitRedline":for(var N=0;N<G.length;N++)this.parseActor(G[N],t,r,m,s.clone(),l,d);break;default:for(N=0;N<G.length;N++)this.parseAnnotations(t,G[N],r,s.clone(),l)}}},parseAnnotations:function(e,t,r,a,o,n){var i=t["@attributes"];if(""===r?r=i.Ident:i&&(r=r+"."+i.Ident),o){var s=this._modifiableFactory.create(this._experienceBase,e,r,void 0);return this._v1ComponentType[r]=e,s&&i&&s.SetGUID(i.Ident),n&&n.AddComponent(s),s}var l=(s=this._experienceBase.ComponentsMap.GetComponentFromID(r))?s.QueryInterface("VCXIModifiable"):null;if(l){var p=null;if(t.ListActors&&(p=this.parseActorList(t.ListActors)),(t.Dynamic||t.ListIdAnchor||t.Neutral&&t.Neutral["Actor.Location"]&&!s.IsKindOf("VCXComponentGround")&&!s.IsKindOf("VCXSection_Spec"))&&this.generateAnchorsIdsArray(t),this.parseNeutrals(t,l,e,p),this.parseTracks(t,l,e),void 0!==t.CLitDigZoom){var u=t.CLitDigZoom;l.loadParentMode="DigZoom",this.parseNeutrals(u,l,e),this.parseTracks(u,l,e)}if(void 0!==t.CLitDigXRay){u=t.CLitDigXRay;l.loadParentMode="DigOnionSkin",this.parseNeutrals(u,l,e),this.parseTracks(u,l,e)}if(void 0!==t.CLitDigOnionSkin){u=t.CLitDigXRay;l.loadParentMode="DigXRay",this.parseNeutrals(u,l,e),this.parseTracks(u,l,e)}}},generateAnchorsIdsArray:function(e){var t=[];if(e.ListIdAnchor&&e.ListIdAnchor.AnchorId)for(var r=e.ListIdAnchor.AnchorId,a=0;a<r.length;++a){var o=e.ListIdAnchor.AnchorId[a]["@attributes"].Id;t.push(parseInt(o))}else if(e.Dynamic&&e.Dynamic.Anchor&&e.Dynamic.Anchor["#text"]){var n=e.Neutral,i=e.Dynamic.Anchor["#text"].split("#");for(a=0;a<i.length;++a){0!==(o=i[a]).length&&parseInt(o)<1e3&&n&&n["Anchor."+o]&&t.push(parseInt(o))}}else e.Neutral["Actor.Location"]&&t.push("Location");e.Neutral.ArrayAnchorsIds=t;var s=[];if(e.Dynamic&&e.Dynamic.Anchor2D&&e.Dynamic.Anchor2D["#text"]){for(n=e.Neutral,i=e.Dynamic.Anchor2D["#text"].split("#"),a=0;a<i.length;++a){0!==(o=i[a]).length&&parseInt(o)<1e3&&n&&n["Anchor."+o]&&s.push(parseInt(o))}e.Neutral.Array2DAnchorsIds=s}},createCamera:function(){var e=this._modifiableFactory.create(this._experienceBase,"CLitCameraActor","CameraActorId",void 0);if(this._v1ComponentType.CameraActorId="CLitCameraActor",null!==e)return e},parseNavigator:function(e){this._vcxCamera=this.createCamera(),this._experienceBase.getManager("VCXContextManager").setActiveCamera(this._vcxCamera);var t=this._vcxCamera.QueryInterface("VCXIModifiable");this.parseNeutrals(e,t,"CLitNavigator"),this.parseTracks(e,t,"CLitNavigator")},parseNeutrals:function(e,t,r,a){var o=e.Neutral;if(void 0!==o){var n;n=Array.isArray(o)&&o.length>0?o[0]:o;var i=this._experienceBase.getManager("VCXScenarioManager"),u=i.GetNeutrals(t.GetHashing());u||(u=new s);e.Dynamic;if(n.ArrayAnchorsIds){var c=new h(n.ArrayAnchorsIds),C=new m("Collab.ListAnchorsIDs",0);u.AddOrModifyProperty(new l(C,c))}if(n.Array2DAnchorsIds){c=new h(n.Array2DAnchorsIds),C=new m("Collab.List2DAnchorsIDs",0);u.AddOrModifyProperty(new l(C,c))}var g=this;if(this._modifiableFactory.createPropertiesMap(t,this._experienceBase,n,this._resources,r).forEach(function(e,t){var r=t,a=e,o=!0,n=g._experienceBase.getManager("VCXContextManager").getOpenSMGXML();if(u.GetProperty(r)&&n&&(o=!1),o){var i=new m(r,0);u.AddOrModifyProperty(new l(i,a))}}),a){C=new m("Actor.ListActors",2);u.AddOrModifyProperty(new l(C,a))}var V=t.GetObject();if(V.IsKindOf("VCXDigger_Spec")){var f=new p;f.SetValue(0);C=new m("Actor.Opacity",0);u.AddOrModifyProperty(new l(C,f))}else if(V.IsKindOf("VCXViewport_Spec")){var y=new d;y.SetValue(!0);C=new m("Environment.BackFaceCulling",1);u.AddOrModifyProperty(new l(C,y))}i.AddNeutrals(t,u)}},parseTracks:function(e,t,r){var a=e.Tracks;if(void 0!==a)for(var o=this.getNodes(a.Track),n=0;n<o.length;n++)this.parseKeys(e,t,this.getNodes(o[n].Key),r)},parseKeys:function(e,t,r,a){if(0!==r.length){var o=new X(this._experienceBase.getManager("VCXScenarioManager"));o.SetLockEvents(!0),o.SetLockUpdateProperties(!0),o.SetCloneValues(!1);for(var n=this._experienceBase.getManager("VCXScenarioManager").GetScenarios()[this._experienceBase.getManager("VCXScenarioManager").GetCurrentScenario()],i=0;i<r.length;i++){if(!this._smgSceFileParsing&&e.Neutral.ArrayAnchorsIds)for(var s=e.Neutral.ArrayAnchorsIds,l=Object.keys(r[i]),u=0;u<l.length;++u){var c=l[u];if(c.startsWith("Anchor.")){var C=c.replace("Anchor.","");s.includes(C)}}this.parseKey(e,t,r[i],o,n,a)}if(t.GetObject().IsKindOf("VCXDigger_Spec")){var d=new p;d.SetValue(0);var m=d,g=o._keysForDo.length;for(i=0;i<g;i++){var V=o._keysForDo[i];if("Actor.Opacity"===V.propertyName){if(null!==m){var h=V.frame-1;h>=0&&o.ChangeKey(n,t,V.propertyName,h,m)}m=V.value}}}this._experienceBase.getManager("VCXCommandManager").Do(o)}},parseKey:function(e,t,r,a,o,n){var i=r["@attributes"].Time;this._modifiableFactory.createPropertiesMap(t,this._experienceBase,r,this._resources,n).forEach(function(e,r){var n=e;if(void 0!==n){var s=r,l=parseFloat(i);a.ChangeKey(o,t,s,l,n)}})},LoadScenarioAndViewFiles:function(e,t,r){var a=this;if(e&&t)(o=new FileReader).onload=function(e){var o=B.loadXMLString(e.target.result),n=B.xmlToJson(o);a.SetSMGViewFile(n);var i=new FileReader;i.onload=function(e){var t=B.loadXMLString(e.target.result),o=B.xmlToJson(t);a.SetSMGSceFile(o),r()},i.readAsText(t)},o.readAsText(e);else if(e||t){var o,n=null;e?n=e:t&&(n=t),(o=new FileReader).onload=function(o){var n=B.loadXMLString(o.target.result),i=B.xmlToJson(n);e?a.SetSMGViewFile(i):t&&a.SetSMGSceFile(i),r()},o.readAsText(n)}else r()},Load:function(e,t,r,a,o,n,i,s,l){var p=this;this.LoadScenarioAndViewFiles(n,i,function(){var t;r.has(p._smgXmlMasterFile)&&(t=r.get(p._smgXmlMasterFile)),p.SetSMGXMLs(r);var n=a?this.loadXMLDoc(window.URL.createObjectURL(t)):B.loadXMLString(t),i=B.xmlToJson(n);n=null,p._mapGeodes=o,p._resources=s,p._experienceBase=e,p._materialManager=e?e.getManager("VCXMaterialManager"):null,x.memoryLog("VCXSmgXmlLoader parseDocumentSMGXML",!0),p.parseDocumentSMGXML(i.DocumentSMG),x.memoryLog("VCXSmgXmlLoader parseDocumentSMGXML",!1),p._mapGeodes=null,p._resources=null,p._experienceBase=null,p._materialManager=null,p._modifiableFactory.clear(),p._modifiableFactory=null,l()})}});return G.ViewType={Views:"1",Layers:"2",CadViews:"3",CadCaptures:"4"},G.ViewCompressionV1={VisibleActors:"0",HiddenActors:"1",VisibleAssemblies:"2",HiddenAssemblies:"3"},G.unitsTranslation={Length:{0:"Micrometers",1:"Millimeters",2:"Centimeters",3:"Decimeters",4:"Meters",5:"Inches",6:"Feet",7:"Yards",8:"Kilometers"},Area:{0:"SquareMicrometers",1:"SquareMillimeters",2:"SquareCentimeters",3:"SquareDecimeters",4:"SquareMeters",5:"SquareInches",6:"SquareFeet",7:"SquareYards"},Volume:{0:"CubicMicrometers",1:"CubicMillimeters",2:"CubicCentimeters",3:"CubicDecimeters",4:"CubicMeters",5:"CubicInches",6:"CubicFeet",7:"CubicYards"},Angle:{0:"Degrees",1:"Radians",2:"Grades"}},G}),define("DS/VCXWebInteropSMG/VCXSmgLoader",["UWA/Class","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebInteropSMG/VCXSmgGeomLoader","DS/VCXWebInteropSMG/VCXSmgXmlLoader","DS/VCXWebInteropSMG/VCXSmgLoaderTools","DS/VCXWebKernelTools/VCXLogServices","DS/VCXWebKernel/VCXDRMManager","i18n!DS/VCXWebInteropSMG/assets/nls/VCXWebInteropSMG"],function(e,t,r,a,o,n,i,s){"use strict";return e.extend({init:function(){this._progressBar=null,this._experienceProgressCB=null,this._mapGeodes=new Map,this._smgXmlMasterFileName=null,this._smgXMLDataResources=null,this._geomSignaturesAwaited=0},hasExtension:function(e,t){return-1!==e.toLowerCase().indexOf(t,e.length-t.length)},sendErrorNotification:function(e,t,r){var a=s[r];e.getManager("VCXNotificationManager").addNotification({level:t,title:t,message:a})},LoadJsonForRightManager:function(e,t){if(e){var r=new FileReader;r.onload=function(){var e=r.result,a=JSON.parse(e);t(a)},r.readAsText(e)}else t(null)},LoadSmgGeomOutlines:function(e,t,a,o,n,i){if(a){var s=new FileReader;s.onload=function(t){var a=new r(e).LoadOutlines(new Uint8Array(t.target.result));i(a)},s.readAsArrayBuffer(a)}else i(null)},LoadMultipleSmgGeom:function(e,t,a,o,n,s){if(a)for(var l=this,p=0,u=[],c=function(t,c){p++;var C=new r(e);C.setResources(n),C.setOutlines(o),C.launchsmgXMLCB=l.SignatureCB,C.smgLoader=l,!1===C.Load(new Uint8Array(c))&&l.sendErrorNotification(e,"error","Notification.GeomLoadingFailed"),l._progressBar?l._progressBar.update("50%"):l._experienceProgressCB&&l._experienceProgressCB({loaded:50,total:100}),C&&C.ulHasSignature&&C.ulAgreementMode!==i.LitSignatureMode.LIT_SIGNATURE_NO_DISPLAY&&(C._pause=!0),u.push(C),C.getMapGeodes().forEach(function(e,t){l._mapGeodes.set(t,e)}),p===a.length&&s(l,u)},C=0;C<a.length;C++){var d=new FileReader;d.onload=function(e){c(e.target.docID,e.target.result)},d.docID=a[C].name,d.readAsArrayBuffer(a[C])}else s(null)},CheckIfSignatureAndRightsFromGeomFiles:function(e,t){for(var r=!0,a=e.getManager("VCXDRMManager"),n=0;n<t.length;n++){var i=t[n];if(!i){r=!1;break}for(var s=0!==o.decodeOptions(i.ulWatermark,i.nTriangles),l=[],p=0;p<i.strFileNameAssociate.length;p++)l.push(i.strFileNameAssociate.charCodeAt(p));var u=o.calcCRC(l),c=o.decodeOptions(i.ulHasExpirationDate,u),C=o.decodeOptions(i.ulStartDate,u),d=o.decodeOptions(i.ulEndDate,u),m=Date.now()/1e3,g=!0;0!==c&&(g=m<d&&m>C);o.decodeOptions(i.ulSignatureCRC,u);for(var V=i.strAgreement,h=i.strSignaturePicturePath,f=i.ulAgreementMode,y=(0!==i.ulHasSignature?"1":"2")+": "+h+" ["+V+"]-"+(f+1),S=[],v=0;v<y.length;v++)S.push(y.charCodeAt(v));o.calcCRC(S);!0;var b=0!=(32&o.decodeOptions(i.ulOptionsPro,i.nTriangles));if(a.SetDisplayWatermark(s),console.log("[DRM MANAGER] Display watermark ? : "+(s?"YES":"NO")),a.SetValidDate(g),console.log("[DRM MANAGER] Has expiration date ? : "+(0!==c?"YES ":"NO ")),0!==c){var P=new Date(1e3*C),X=new Date(1e3*d);console.log("[DRM MANAGER] Date is valid ? : "+(g?"YES ":"NO ")+"- Start : "+P.toUTCString()+" - End : "+X.toUTCString())}if(a.SetDisplayTree(b),console.log("[DRM MANAGER] Show tree allowed ? "+(b?"YES":"NO")),a.SetValidSignature(!0),console.log("[DRM MANAGER] Valid signature ? : YES"),a.GetValidDate()||(this.sendErrorNotification(e,"warning","Notification.SmgExpiration"),r=!1),a.GetValidSignature()||(this.sendErrorNotification(e,"warning","Notification.SmgInvalidSignature"),r=!1),!r)break}return r},LoadSmgXml:function(e,t){if(this._smgXMLDataResources){var r=this._smgXMLDataResources.expBase,o=this._smgXMLDataResources.viewer,i=this._smgXMLDataResources.blobSmgXmls,s=this._smgXMLDataResources.blobViewFile,l=this._smgXMLDataResources.blobSceFile,p=this._smgXMLDataResources.resources;if(i&&e)if(this.CheckIfSignatureAndRightsFromGeomFiles(r,e)){var u=this;n.memoryLog("LoadSmgXml",!0);for(var c=0,C=new Map,d=function(e,d){if(c++,e=e.toLowerCase(),C.set(e,d),i.length===c){var m=new a;u._smgXmlMasterFileName=u._smgXmlMasterFileName.toLowerCase(),m.SetMasterFileName(u._smgXmlMasterFileName),m.Load(r,o,C,!1,u._mapGeodes,s,l,p,function(){var e=n.memoryLog("LoadSmgXml",!1);console.log("[PERFO] "+e.logName+" "+e.time),console.log("[PERFO] Heap "+e.heap),r.getManager("VCXExperience").OnEndLoading(!1),o.render({updateInfinitePlane:!0}),u._progressBar?u._progressBar.update("100%"):u._experienceProgressCB&&u._experienceProgressCB({loaded:100,total:100}),t()})}},m=0;m<i.length;m++){var g=new FileReader;g.onload=function(e){d(e.target.docID,e.target.result)},g.docID=i[m].name,g.readAsText(i[m])}}else t(null);else t(null)}else t(null)},SignatureCB:function(e,t){var r=t._smgXMLDataResources.expBase,a=t._smgXMLDataResources.cbLoadEnd,o=t._smgXMLDataResources.listsmgGeomLoaders;if(e){if(!e._pause){t._geomSignaturesAwaited--,e.getMapGeodes().forEach(function(e,r){t._mapGeodes.set(r,e)}),0===t._geomSignaturesAwaited&&t.LoadSmgXml(o,function(){a(r)})}}else t._progressBar?t._progressBar.off():t._experienceProgressCB&&t._experienceProgressCB({loaded:100,total:100}),a()},ValidateSignatureAndLoadXMLFiles:function(e,t){for(var r=0;r<t.length;r++){var a=t[r];a&&a._pause&&e._geomSignaturesAwaited++}0===e._geomSignaturesAwaited?e.LoadSmgXml(t,function(){var t=e._smgXMLDataResources.expBase;(0,e._smgXMLDataResources.cbLoadEnd)(t)}):e._smgXMLDataResources.listsmgGeomLoaders=t},LoadDataFiles:function(e,t,r,a){var o=this,n=[],i=[],s=null,l=null,p=null,u=null,c=[],C=e.getManager("VCXContextManager");C&&(C.getOpenSMGXML()||(C.setOpenSMG(),o._smgXmlMasterFileName="product.smgxml")),r.forEach(function(e,t){var r=t.slice(t.lastIndexOf(".")+1);r=r.toLowerCase();var a=o._smgXmlMasterFileName.slice(0,o._smgXmlMasterFileName.lastIndexOf("."));a=a.toLowerCase();var d=t.slice(0,t.lastIndexOf("."));if("product.smggeom"===t||"smggeom"===r)i.push(e),c[t]=URL.createObjectURL(e);else if("smgoutlines"===r)s=e;else if(o.hasExtension(t,".json"))l=e;else if(o.hasExtension(t,".smgxml")||o.hasExtension(t,".xml"))C.getOpenSMGXML()||(e.name="product.smgxml"),n.push(e);else if(o.hasExtension(t,".smgview"))C.getOpenSMGXML()?d===a&&(p=e):p=e;else if(o.hasExtension(t,".smgsce"))C.getOpenSMGXML()?d===a&&(u=e):u=e;else if(C.getOpenSMGXML()){var m=t.slice(t.lastIndexOf("."));d=t.slice(t.lastIndexOf("/")+1,t.lastIndexOf("."));c[d+m]=URL.createObjectURL(e)}else c[t]=URL.createObjectURL(e)}),o._progressBar?o._progressBar.update("0%"):o._experienceProgressCB&&o._experienceProgressCB({loaded:0,total:100});var d={};d.expBase=e,d.viewer=t,d.blobSmgXmls=n,d.blobViewFile=p,d.blobSceFile=u,d.resources=c,d.cbLoadEnd=a,this._smgXMLDataResources=d,o.LoadJsonForRightManager(l,function(r){var n=!0;if(r){var l=e.getManager("VCXDRMManager");l.SetDisplayTree("true"===r.RightManagement.ShowTree),l.SetDisplayWatermark("true"===r.DisplayWatermark),l.SetValidDate("true"===r.ExpirationOk),l.SetValidSignature("true"===r.ValidSignatureCRC),l.GetValidDate()||(o.sendErrorNotification(e,"warning","Notification.SmgExpiration"),n=!1),l.GetValidSignature()||(o.sendErrorNotification(e,"warning","Notification.SmgInvalidSignature"),n=!1)}n?o.LoadSmgGeomOutlines(e,t,s,c,r,function(r){i.length<=0&&o.sendErrorNotification(e,"warning","Notification.SmgGeomNotFound"),o.LoadMultipleSmgGeom(e,t,i,r,c,o.ValidateSignatureAndLoadXMLFiles)}):a(e)})},LoadFromArrayBuffer:function(e,r,a,o){var n=this;t.ExtractFromArchiveData(a,function(t){n.LoadDataFiles(e,r,t,o)},function(t){var r="File contains encrypted entry."===t?"Notification.SmgOpenFailedPassword":"Notification.SmgOpenFailed";n.sendErrorNotification(e,"error",r),o()})},Load:function(e,t,r,a){var o=this;n.memoryLog("VCXSmgLoader",!0,!0),this._progressBar?this._progressBar.update("0%"):o._experienceProgressCB&&o._experienceProgressCB({loaded:0,total:100});var i=new FileReader;i.onload=function(r){o.LoadFromArrayBuffer(e,t,r.target.result,a)},i.readAsArrayBuffer(r)}})}),define("DS/VCXWebInteropSMG/VCXSmgXMLExperienceLoader",["DS/VCXWebInteropSMG/VCXSmgLoader","DS/VCXWebKernelTools/VCXFileServices","DS/VCXWebInteropSMG/VCXSmgLoaderTools"],function(e,t,r){"use strict";return e.extend({init:function(){this._progressBar=null,this._experienceProgressCB=null,this._mapGeodes=new Map,this._smgXmlMasterFileName=null,this._smgXMLDataResources=null,this._geomSignaturesAwaited=0,this._filesToTryAgain=[]},StartLoadingExperience:function(e,a,o,n){e.getManager("VCXContextManager").setOpenSMGXML();var i=window.location.origin,s=o;o.indexOf("://")>0||0===o.indexOf("//")||(s=r.RelativeToAbsolute(i,o));var l=s.slice(s.lastIndexOf(".")),p=s.slice(0,s.lastIndexOf("/")),u=s.slice(s.lastIndexOf("/")+1,s.lastIndexOf("."));this._smgXmlMasterFileName=u+l;var c=p+"/Resources.xml",C=new Map,d=this,m=function(){d.sendErrorNotification(e,"warning","Notification.smgXmlResourcesNotFound"),n()},g=function(t){var o=r.loadXMLString(t),i=r.xmlToJson(o).Resources.Resource,s={target:{}};s.target.files=[];var l=!1,u=function(t,r){for(var o=0;o<t.target.files.length;o++){var i=t.target.files[o],s=i.name;s=s.toLowerCase(),C.set(s,i)}d.LoadDataFiles(e,a,C,n),r&&d.sendErrorNotification(e,"warning","Notification.smgXmlSomeResourcesMissing")},c=function(e,t){0!==t.length&&d._filesToTryAgain.length!==t.length||(l=!0),d._filesToTryAgain=t,d.loadResourcesForSmgXml(e,t,p,u,c,l)};d.loadResourcesForSmgXml(s,i,p,u,c,l)};t.BlobURLToText(c,g,function(){c=p+"/"+u+"_Resources.xml",t.BlobURLToText(c,g,m)})},loadResourcesForSmgXml:function(e,r,a,o,n,i){var s=r.length,l=0,p=!1,u=[];if(i)return o(e,!0);for(var c=function(r,a){if(r){var c=t.dataURLToBlob(r);c.lastModifiedDate=new Date,c.name=a,e.target.files.push(c)}else u.push(a),p=!0;++l===s&&(!p||i?o(e,p):n(e,u))},C=0;C<s;C++){var d="";if(void 0!==(d=r[C]["@attributes"]&&r[C]["@attributes"].RelativePath?r[C]["@attributes"].RelativePath:r[C])&&""!==d){var m=a+"/"+d;t.BlobURLToBase64(m,"",c,d,c)}}}})});