define("DS/XCTInfServiceProxy/MaturityStateTypes",["require","exports"],function(e,t){"use strict";var r;return function(e){e.InWork="In Work",e.Released="Released",e.Frozen="Frozen"}(r||(r={})),r}),define("DS/XCTInfServiceProxy/XCTInfServiceProxy",["UWA/Core","UWA/Class/Promise","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData","DS/PlatformAPI/PlatformAPI","DS/XCTInfUtilsWeb/XCTLogger","DS/XCTInfServiceProxy/MaturityStateTypes"],function(e,t,r,n,i,o,s){"use strict";var a,c,l,d,u={},p={};const f=["ds6w:label","ds6w:name","ds6w:title","physicalid","name","ds6w:identifier","ds6w:created","ds6w:modified","ds6w:responsible","ds6w:responsibleUid","ds6w:project","ds6w:dataSource","ds6w:community","ds6wg:revision","ds6w:what/ds6w:status","ds6w:status","ds6w:type","organization","ds6w:isLastRevision","ds6w:collaborativeSpace"];var v=function(t){var r={method:"POST",type:"json",headers:{Accept:"application/json","Content-Type":"application/json"}};return r.data=JSON.stringify(function(t){var r=i.getUser(),n=null!=r&&void 0!==r.login?r.login:"";return{label:t.label||"3DSearch-"+n+"-"+(new Date).getTime(),locale:"en",order_field:t.order_field?t.order_field:"relevance",order_by:t.order_by?t.order_by:"desc",select_file:e.is(t.select_file,"array")?t.select_file:[],select_synthesis:t.select_synthesis?t.select_synthesis:t.select_predicate,select_predicate:t.select_predicate?t.select_predicate:["ds6w:label"],refine:t.refine,nresults:t.numResults||10,start:0,tenant:p.getTenantId(),query:t.query,source:t.sources,specific_source_parameter:t.specific_source_parameter}}(t)),r.onComplete=t.onComplete,r.onFailure=t.onFailure,r};return p.getTenantId=function(){return window.widget?window.widget.getValue("tenantId")||window.widget.getValue("x3dPlatformId"):"OnPremise"},p.getRepositoryType=function(){return"PLM1"},p.isCloudEnv=function(){var e=p.getTenantId();return void 0!==e&&"OnPremise"!==e},p.retrievePlatformUrl=function(){if(!a){var n=t.deferred();r.getServiceUrl({serviceName:"3DSpace",platformId:p.getTenantId(),onComplete:function(t){var r=e.Utils.parseUrl(t),i=r.port;r.port="0";var o=e.Utils.composeUrl(r).replace(":0",":"+i);n.resolve(o)},onFailure:function(){a=void 0,c=void 0,l=void 0,n.reject("Failed to retrieve platform URI")}}),a=n.promise}return a},p.retrieveFederatedSearchUrl=function(){if(!d){var n=t.deferred();r.getServiceUrl({serviceName:"3DSearch",platformId:p.getTenantId(),onComplete:function(t){var r=e.Utils.parseUrl(t),i=r.port;r.port="0";var o=e.Utils.composeUrl(r).replace(":0",":"+i);o+="/search",n.resolve(o)},onFailure:function(){d=void 0,n.reject("Failed to retrieve Search URI")}}),d=n.promise}return d},p.retrieveDashboardUrl=function(){return p.retrieveServiceUrl("3DDashboard")},p.retrieveHypervisorServiceUrl=function(e){return p.retrieveServiceUrl(e).then(function(e){return e?e.replace(/(^\w+:|^)\/\//,"")+"/hypervisor":t.reject(new Error("Warning: Url could not be discovered!"))})},p.retrieveServiceUrl=function(e){var n=u[e];if(!n){var i=t.deferred();n=i.promise,u[e]=i.promise,r.getServiceUrl({serviceName:e,platformId:p.getTenantId(),onComplete:i.resolve,onFailure:function(){u[e]=void 0,i.reject("Failed to retrieve URI for service "+e)}})}return n},p.retrieveDataPrepRunUrl=function(){return p.retrieveHypervisorServiceUrl("datapreprun")},p.retrieveRaaSUrl=function(){return p.retrieveHypervisorServiceUrl("3drendering")},p.retrieveEmUrl=function(){return p.retrieveHypervisorServiceUrl("experiencemodeling")},p.retrieveDataPrepAuthoringUrl=function(){return p.retrieveServiceUrl("dataprepauthoring").then(function(e){return e?"https://"+e.replace(/(^\w+:|^)\/\//,"")+"/3drdfpersist/":t.reject(new Error("Warning: DataPrepAuthoring URL not discovered!"))})},p.retrieveCollabSpaces=function(){return c||(c=p.retrievePlatformUrl().then(function(r){var i=t.deferred(),o=e.Utils.parseUrl(r),s=e.Utils.composeUrl(o)+"/resources/bps/cspaces";return p.isCloudEnv()&&(s+="/?tenant="+encodeURIComponent(p.getTenantId().trim())),n.authenticatedRequest(s,{method:"GET",type:"json",onComplete:function(e){var t=Object.prototype.hasOwnProperty.call(e,"cspaces")?e.cspaces.concat():[];i.resolve(t)},onFailure:function(){i.reject("Failed to retrieve collab spaces.")}}),i.promise})),c},p.addCollabSpacesToWidget=function(e,t,r,n){return l||(e=e||"context",r=r||function(){return!0},n=n||function(e){return e},l=p.retrieveCollabSpaces().then(i=>{const o=i.filter(r),s=n(o),a=s.map(e=>({label:e.displayName,value:e.name}));let c,l;const d=i.find(e=>e.isDefault),u=window.widget.getValue(e);switch(u&&(l=s.find(e=>e.csName===u.substr(u.lastIndexOf(".")+1))),!0){case Boolean(l):c=l.name;break;case Boolean(d):c=d.name;break;case a.length>0:c=a[a.length-1].value}window.widget.setValue(e,c);const p={type:"list",name:e,label:t||"CollabSpace",options:a,defaultValue:c,disabled:!0};window.widget.addPreference(p)})),l},p.getSelectedCollabSpace=function(e){return p.addCollabSpacesToWidget(e).then(function(){return window.widget.getValue(e||"context")})},p.setCollabSpace=function(e,t){return p.addCollabSpacesToWidget(t).then(function(){window.widget.setValue(t||"context",e)})},p.retrieveLoginTicket=function(e){return p.retrievePlatformUrl().then(function(r){var i=t.deferred(),s=r+"/ticket/get?";s+="runasctx="+encodeURIComponent(e.context?e.context.trim():"preferred");var a=r;return a+="/resources/modeler/pno/person?current=true&select=preferredcredentials",p.isCloudEnv()&&(s+="&tenant="+encodeURIComponent(p.getTenantId().trim()),a+="&tenant="+encodeURIComponent(p.getTenantId().trim())),o.log("url :"+s),n.authenticatedRequest(a,{method:"GET",type:"json",proxy:"passport",onComplete:function(e){o.log("onComplete response:"),o.log(e),n.authenticatedRequest(s,{headers:{Accept:"application/json","Accept-Language":null},method:"GET",type:"json",proxy:"passport",onComplete:function(e){o.log("loginTicket: "+e.ticket),i.resolve(e.ticket)},onFailure:function(e){o.log(e),i.reject("Failed to retrieve login ticket")}})}}),i.promise})},p.getUser=function(){return o.log("*** getting user ***"),p.retrievePlatformUrl().then(function(e){var r=t.deferred(),i=e;return i+="/resources/modeler/pno/person?current=true&select=preferredcredentials",p.isCloudEnv()&&(i+="&tenant="+encodeURIComponent(p.getTenantId().trim())),o.log("url :"+i),n.authenticatedRequest(i,{method:"GET",type:"json",proxy:"passport",onComplete:function(e){r.resolve(e)}}),r.promise})},p.getSessionId=function(){if(this.sessionId)return this.sessionId;var e=i.getUser();return e||(e={login:"user"+Date.now()}),this.sessionId=e.login+"_"+p.getTenantId(),this._appSpecificSettings&&this._appSpecificSettings.csiClientName?this.sessionId=this.sessionId+"_"+this._appSpecificSettings.csiClientName:o.warn("CSI client name is not set up. On app initialization phase call setApplicationSpecificSettings method of XCTInfServiceProxy with object containing csiClientName"),this.sessionId},p.getProductIds=function(e){return p.retrievePlatformUrl().then(function(r){var i=t.deferred(),o=p.isCloudEnv(),s=r+(o?"/resources/v1/model/":"/resources/v0/model/")+"bus?"+("type=*"+("&where="+encodeURIComponent("(physicalid=='"+e+"')")))+"&select=name&select=revision&select=type";return o&&(s+="&tenant="+encodeURIComponent(p.getTenantId().trim())),n.authenticatedRequest(s,{method:"GET",type:"json",onComplete:function(e){i.resolve(e.results)},onFailure:function(){i.reject()}}),i.promise})},p.getPhysicalId=function(e,r,i){return p.retrievePlatformUrl().then(function(o){var s=t.deferred(),a="type="+r+"&name="+e+"&revision="+i,c=p.isCloudEnv(),l=o+(c?"/resources/v1/model/":"/resources/v0/model/")+"bus?"+a+"&select=physicalid";return c&&(l+="&tenant="+encodeURIComponent(p.getTenantId().trim())),n.authenticatedRequest(l,{method:"GET",type:"json",onComplete:function(e){s.resolve(e.results)},onFailure:function(){s.reject()}}),s.promise})},p.getMaturityOfPLMObject=function(e,r){return p.retrievePlatformUrl().then(i=>{let o=i+"/resources/v1/collabServices/attributes/op/read";const a=encodeURIComponent(p.getTenantId().trim());return o+="?tenant="+a,new t(function(t,i){const a={method:"POST",type:"json",proxy:"passport",headers:{Accept:"application/json","Content-Type":"application/json",SecurityContext:r},onComplete:function(e){if(!e||!e.results||!e.results[0])return void i(new Error("Invalid Data"));const[r]=e.results;r.basicData?t(r.basicData.find(e=>"current"===e.selectable).value[0]):t(s.InWork)},onFailure:function(e){i(e)},data:JSON.stringify({busIDs:[e]})};n.authenticatedRequest(o,a)})})},p.retrieveTransientToken=function(r){return new t(function(t,o){var s=i.getApplicationConfiguration("app.urls.passport")+"/api/authenticated/cas/transient?service=";s+=encodeURIComponent("https://"+r.serviceUrl),p.isCloudEnv()&&(s+="&tenant="+encodeURIComponent(p.getTenantId().trim())),n.authenticatedRequest(s,{method:"GET",type:"json",onComplete:function(n){t(e.extend({x3ds_service_url:r.serviceUrl},n))},onFailure:o})})},p.getExperienceInfosByPhysicalIds=function(e){return e&&0!==e.length?p.retrieveFederatedSearchUrl().then(r=>new t((t,i)=>{const s={onComplete:e=>{const r=(e=>{let t=[];return e&&e.results&&(t=e.results.map(e=>{let t={};if(e.attributes&&e.attributes.length>0)try{const r=new Map;e.attributes.map(e=>{r.set(e.name,e.value)}),t={thumbnail:r.get("preview_url")||"",label:r.get("ds6w:label")||"",experienceId:r.get("resourceid")||"",experienceName:r.get("name")||r.get("ds6w:label")||"",experienceRevision:r.get("ds6wg:revision")||""}}catch(e){o.error("Error while parsing experience attributes",e)}return t})),t})(e);t(r)},onFailure:e=>{i(e)},select_file:["icon","thumbnail_2d"],select_predicate:f,nresults:1e3,order_field:"ds6w:modified",query:function(e){for(var t="",r=0;r<e.length;r++)0===r?t+="(physicalid:"+e[r]:(t+=" OR ",t+="physicalid:"+e[r]);return t+=")"}(e)};n.authenticatedRequest(r,v(s))})):t.resolve([])},p.setApplicationSpecificSettings=function(t){this._appSpecificSettings||(this._appSpecificSettings={}),this._appSpecificSettings=e.extend({csiClientName:this._appSpecificSettings.csiClientName},t)},p.addTenantIdToWidget=function(){const e=p.getTenantId();window.widget.addPreference({type:"text",name:e,label:"Platform",defaultValue:e,disabled:!0})},p});