define("DS/CfgSolver/CfgSolverServices",["UWA/Core","DS/WAFData/WAFData","UWA/Utils","DS/i3DXCompassServices/i3DXCompassServices","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,n,i,r){"use strict";var a={solverUrlEndPoint:null,serviceUrl:null,method:"POST",_tenant:"OnPremise",_solverServiceAvailable:void 0,getDefaultImage:function(){var e="";return null!==this.serviceUrl&&(e=this.serviceUrl+"/snresources/images/icons/large/iconLargeDefault.png"),e},initSolver:function(t){var n="initialization/context/"+t.modelId;return this._solverURL="/resources/cfg/configurator/solver/",this._computeURL="computeAnswer",this.method="POST",this.receivedTenant=t.tenant,this._handleRequest(n,{type:"json",data:t.data}).then(function(t){return e.log("initialize solver successfull"),t},function(t){return e.log("failed while creating solver: "),e.log(t),null})},hypervisordetails:function(t){var n="hypervisordetails?random="+Math.random();return this.method="GET",this._handleRequest(n,{type:"json",data:null}).then(function(t){return e.log("initialize solver successfull"),t},function(t){return e.log("failed while creating solver: "),e.log(t),null})},getUrlSolverService:function(t){var n=this;return new e.Promise(function(e,i){r.getPlatformServices({platformId:t,onComplete:function(t){void 0!==t.configrulesolver&&null!==t.configrulesolver?(n.serviceUrl="Config Solver Service",n.solverUrlEndPoint=t.configrulesolver,e(t.configrulesolver)):(console.warn("getUrlSolverService no SolverService..."),i(void 0))},onFailure:function(){console.log("getUrlSolverService failed..."),i(void 0)}})})},getUrl3DSpaceService:function(t){var n=this;return n._solverURL="/resources/rulesolver/solver/",new e.Promise(function(r,a){i.getServiceUrl({serviceName:"3DSpace",platformId:t,onComplete:function(t){if("string"==typeof t)n.serviceUrl=t;else if(e.is(t,"array")&&(n.serviceUrl=t[0].url,n._tenant=t[0].platformId,n.receivedTenant&&"OnPremise"!==n.receivedTenant)){var i,a=t||[];for(i=0;i<a.length;i++)n.receivedTenant==a[i].platformId&&(n.serviceUrl=a[i].url,n._tenant=a[i].platformId)}n.solverUrlEndPoint=n.serviceUrl+n._solverURL,r(t[0].url)},onFailure:function(){console.error("getUrl3DSpaceService failed..."),a(void 0)}})})},_handleRequest:function(n,i){i=i||{};var r=this;return new e.Promise(function(a,s){var o=e.extend({method:r.method,timeout:3e5,type:null,onComplete:function(){a.apply(this,arguments)},onFailure:function(e){s.call(this,arguments)}},i);if(r.serviceUrl)t.authenticatedRequest(r.solverUrlEndPoint+n,o);else{var l="";window&&window.widget&&window.widget.getValue("x3dPlatformId")?l=window.widget.getValue("x3dPlatformId"):void 0!==i.tenant&&(l=i.tenant),r.getUrlSolverService(l).then(function(e){r._solverServiceAvailable=!0,t.authenticatedRequest(r.solverUrlEndPoint+"/resources/v1/cfgsolver/session/"+n,o)},function(e){r.getUrl3DSpaceService(l).then(function(e){r._solverServiceAvailable=void 0,t.authenticatedRequest(r.solverUrlEndPoint+n,o)},function(e){console.error("No service available for the solver")})})}})},release:function(e){if(null==e&&(e=""),this._solverServiceAvailable){this.method="DELETE";var t="/resources/v1/cfgsolver/session/"+e;return this._handleRequest(t,{type:"application/ds-json",data:{},headers:{"Content-Type":"application/json"}})}return this._handleRequest("delete",{data:{solverKey:e}}).then(function(e){return e},function(e){console.log("failed while releasing the solver: "+e)})},computeSolverServiceAnswer:function(t,n){var i="/resources/v1/cfgsolver/session/"+n+"/compute";this.method="POST";var r=t||{};e.is(t,"object")?r=JSON.stringify(t):e.is(t,"string")&&(r=t);var a={jsonMsg:r};return this._handleRequest(i,{type:"application/ds-json",data:JSON.stringify(a),headers:{"Content-Type":"application/json"}})},computeAnswer:function(t,n,i,r){if(this._solverServiceAvailable)return this.computeSolverServiceAnswer(t,n);var a=this._computeURL||"compute";this.method="POST";var s=t||{};e.is(t,"object")?s=JSON.stringify(t):e.is(t,"string")&&(s=t);var o={jsonMsg:s,solverKey:n=null==n?"":n};"computeAnswer"===a&&(o={selectedCriteria:s,solverId:n}),i&&(o.rand=i);var l=this;if(r){var c=t&&t._from?t._from:"apps",u={solverKey:n,jsonMsg:JSON.stringify({_from:c,_to:"solver",_request:"abortRequest",_data:""})};return this._handleRequest(a,{type:"application/ds-json",data:JSON.stringify(u),headers:{"Content-Type":"application/json"}}).then(function(){return console.debug("Aborting solver"),l._handleRequest(a,{type:"application/ds-json",data:JSON.stringify(o),headers:{"Content-Type":"application/json"}})},function(){console.error("failed while trying to abort the solver")})}return this._handleRequest(a,{type:"application/ds-json",data:JSON.stringify(o),headers:{"Content-Type":"application/json"}})},create:function(n){var i=this;this.receivedTenant=n&&n.tenant?n.tenant:"OnPremise";return this._computeURL="compute",this.method="POST",n.modelVersionId?new e.Promise(function(r,a){var s='{"modelVersion":"'+n.modelVersionId+'"}',o=e.extend({method:i.method,timeout:3e5,type:null,onComplete:function(){r.apply(this,arguments)},onFailure:function(e){a.apply(this,arguments)}},{type:"json"}),l=e.extend({method:i.method,timeout:3e5,type:null,onComplete:function(){i._solverServiceAvailable=!0,r.apply(this,arguments)},onFailure:function(e){i._solverServiceAvailable=void 0;var r="";window&&window.widget&&window.widget.getValue("x3dPlatformId")?r=window.widget.getValue("x3dPlatformId"):void 0!==n.tenant&&(r=n.tenant),i.getUrl3DSpaceService(r).then(function(e){t.authenticatedRequest(i.solverUrlEndPoint+"create",o)},function(e){console.error("No service available for the solver")})},data:s,headers:{"Content-Type":"application/json",SecurityContext:n.securityContext}},{type:"json"});if(i.serviceUrl)i._solverServiceAvailable?t.authenticatedRequest(i.solverUrlEndPoint+"/resources/v1/cfgsolver/session/",l):"Config Solver Service"===i.serviceUrl?t.authenticatedRequest(i.solverUrlEndPoint+"/resources/v1/cfgsolver/session/",l):void 0!==i.solverUrlEndPoint&&null!==i.solverUrlEndPoint?t.authenticatedRequest(i.solverUrlEndPoint+"create",o):(i._solverURL="/resources/rulesolver/solver/",i.solverUrlEndPoint=i.serviceUrl+i._solverURL,t.authenticatedRequest(i.solverUrlEndPoint+"create",o));else{var c="";window&&window.widget&&window.widget.getValue("x3dPlatformId")?c=window.widget.getValue("x3dPlatformId"):void 0!==n.tenant&&(c=n.tenant),i.getUrlSolverService(c).then(function(e){t.authenticatedRequest(i.solverUrlEndPoint+"/resources/v1/cfgsolver/session/",l)},function(e){i.getUrl3DSpaceService(c).then(function(e){t.authenticatedRequest(i.solverUrlEndPoint+"create",o)},function(e){console.error("No service available for the solver")})})}}):i.getUrl3DSpaceService(platformid).then(function(e){this._handleRequest("create",{type:"json"}).then(function(e){return console.log("create solver successfull"),e},function(e){return console.log("failed while creating solver: "),console.log(e),null})},function(e){console.log("3DSpace is not available")})},initialize:function(t){var n={};n.jsonData=t.jsonData?JSON.stringify(t.jsonData):"{}",n.solverKey=t.solverKey?t.solverKey:null,n=JSON.stringify(t);return this._solverServiceAvailable?new e.Promise(function(e,t){e()}):this._handleRequest("initialize",{type:"json",data:n,headers:{"Content-Type":"application/json"}}).then(function(e){return console.log("initialize solver successfull"),e},function(e){return console.log("failed while creating solver: "),console.log(e),null})},clearSolver:function(e){if(this._solverServiceAvailable){this.method="DELETE";var t="/resources/v1/cfgsolver/session/"+e;return this._handleRequest(t,{type:"application/ds-json",data:{},headers:{"Content-Type":"application/json"}})}return this._handleRequest("clear",{type:"json",data:{solverKey:e}}).then(function(e){return console.log("clear solver successfull"),e},function(e){return console.log("failed while clear solver: "),console.log(e),null})},getWAFdata:function(){return t},setRuleActivation:function(e,t,n,i){var r=this,a={_from:"ruleEditor",_to:"solverRule",_request:"ruleActivation",_data:{ruleId:e,ruleActivation:t}};return this.computeAnswer(a,n).catch(function(e){r._sendErrorMsgOnModelEvent(e,i)})},callSolveForRulesCheckConflict:function(t,n,i,r){var a=this,s={matrixDefinition:{constrainedCriteria:t.constrainedCriteria,constrainedValues:t.constrainedValues,drivingCriteria:t.drivingCriteria,drivingCombinationValues:t.drivingCombinationValues,states:t.states},buildtimeCheckLevel:t.buildtimeCheckLevel?t.buildtimeCheckLevel:"none",runtimeCheckLevel:"statesConflicts",buildtimeCauseComputation:t.buildtimeCauseComputation?t.buildtimeCauseComputation:"no",runtimeCauseComputation:t.runtimeCauseComputation?t.runtimeCauseComputation:"no",conflictWithDefaultCheck:"yes"};t.statesCauses&&(s.matrixDefinition.statesCauses=t.statesCauses,t._clientData.statesCauses=t.statesCauses);var o={_from:"ruleEditor",_to:"solverRule",_version:"3.0",_request:"checkMatrixRuleValidity",_data:s,_clientData:t._clientData||{}};if(r)return this.computeAnswer(o,n).then(function(t){var n=JSON.parse(t),r=n._data;r.version=n._version;var a=e.merge(r,{version:n._version,_clientData:n._clientData});r._clientData&&r._clientData.statesCauses?i.publish({event:"checkMatrixRuleValidity_SolverReason",data:{answerData:a}}):i.publish({event:"checkMatrixRuleValidity_statesConflicts_SolverAnswer",data:{answerData:r}})},function(e){a._sendErrorMsgOnModelEvent(e,i)});this.computeAnswer(o,n).then(function(t){var n=JSON.parse(t),r=n._data;r.version=n._version;var a=e.merge(r,{version:n._version,_clientData:n._clientData});r._clientData&&r._clientData.statesCauses?i.publish({event:"checkMatrixRuleValidity_SolverReason",data:{answerData:a}}):i.publish({event:"checkMatrixRuleValidity_statesConflicts_SolverAnswer",data:{answerData:r}})},function(e){a._sendErrorMsgOnModelEvent(e,i)})},callSolveForRulesCheckSuggestion:function(t,n,i,r){var a=this,s={matrixDefinition:{constrainedCriteria:t.constrainedCriteria,constrainedValues:t.constrainedValues,drivingCriteria:t.drivingCriteria,drivingCombinationValues:t.drivingCombinationValues,states:t.states},buildtimeCheckLevel:"none",runtimeCheckLevel:"statesValidity",buildtimeCauseComputation:"no",runtimeCauseComputation:t.runtimeCauseComputation?t.runtimeCauseComputation:"no"};t.statesCauses&&(s.matrixDefinition.statesCauses=t.statesCauses,t._clientData.statesCauses=t.statesCauses);var o={_from:"ruleEditor",_to:"solverRule",_version:"3.0",_request:"checkMatrixRuleValidity",_data:s,_clientData:t._clientData||{}};if(r)return this.computeAnswer(o,n).then(function(t){var n=JSON.parse(t),r=n._data;r.version=n._version;var a=e.merge(r,{version:n._version,_clientData:n._clientData});r._clientData&&r._clientData.statesCauses?i.publish({event:"checkMatrixRuleValidity_SolverReason",data:{answerData:a}}):i.publish({event:"checkMatrixRuleValidity_SolverAnswer",data:{answerData:r}})},function(e){a._sendErrorMsgOnModelEvent(e,i)});this.computeAnswer(o,n).then(function(t){var n=JSON.parse(t),r=n._data;r.version=n._version;var a=e.merge(r,{version:n._version,_clientData:n._clientData});r._clientData&&r._clientData.statesCauses?i.publish({event:"checkMatrixRuleValidity_SolverReason",data:{answerData:a}}):i.publish({event:"checkMatrixRuleValidity_SolverAnswer",data:{answerData:r}})},function(e){a._sendErrorMsgOnModelEvent(e,i)})},callSolveForCausingDrivingComb:function(t,n,i){var r=this,a={matrixDefinition:{constrainedCriteria:t.constrainedCriteria,constrainedValues:t.constrainedValues,drivingCriteria:t.drivingCriteria,drivingCombinationValues:t.drivingCombinationValues,states:t.states},buildtimeCheckLevel:"statesValidity",runtimeCheckLevel:"none",buildtimeCauseComputation:"yes",runtimeCauseComputation:"no",conflictWithDefaultCheck:"yes"};t.statesCauses&&(a.matrixDefinition.statesCauses=t.statesCauses,t._clientData.statesCauses=t.statesCauses);var s={_from:"ruleEditor",_to:"solverRule",_version:"3.0",_request:"checkMatrixRuleValidity",_data:a,_clientData:t._clientData||{}};return this.computeAnswer(s,n).then(function(t){var n=JSON.parse(t),r=n._data;r.version=n._version;var a=e.merge(r,{version:n._version,_clientData:n._clientData});i.publish({event:"checkInvalidColumnCausingRules",data:{answerData:a}})},function(e){r._sendErrorMsgOnModelEvent(e,i)})},callSolveForRules:function(t,n,i,r){var a=this,s={matrixDefinition:{constrainedCriteria:t.constrainedCriteria,constrainedValues:t.constrainedValues,drivingCriteria:t.drivingCriteria,drivingCombinationValues:t.drivingCombinationValues,states:t.states},buildtimeCheck:t.statesCauses?"validityWithCause":"validity",runtimeCheck:t.statesCauses?"validityWithCause":"validity"};t.statesCauses&&(s.matrixDefinition.statesCauses=t.statesCauses,t._clientData.statesCauses=t.statesCauses);var o={_from:"ruleEditor",_to:"solverRule",_version:"2.0",_request:"checkMatrixRuleValidity",_data:s,_clientData:t._clientData||{}};this.computeAnswer(o,n).then(function(t){var n=JSON.parse(t),r=n._data;r.version=n._version;var a=e.merge(r,{version:n._version,_clientData:n._clientData});r._clientData&&r._clientData.statesCauses?(i.publish({event:"checkMatrixRuleValidity_SolverReason",data:{answerData:a}}),i.publish({event:"checkMatrixRuleValidity_SolverAnswer",data:{answerData:r}})):i.publish({event:"checkMatrixRuleValidity_SolverAnswer",data:{answerData:r}})},function(e){a._sendErrorMsgOnModelEvent(e,i)})},setAlwaysDiagnosed:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"setAlwaysDiagnosed",_data:{alwaysDiagnosedIds:e}};return this.computeAnswer(r,t).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},SetMultiSelectionOnSolver:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"setMultiSelection",_data:e||"false"};return this.computeAnswer(r,t).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},CheckRulesConsistency:function(e,t){var n=this;return this.computeAnswer({_from:"configurator",_to:"solverConfiguration",_request:"checkModelConsistency",_data:""},e).catch(function(e){n._sendErrorMsgOnModelEvent(e,t)})},setSelectionModeOnSolver:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"setSelectionMode",_data:e};return this.computeAnswer(r,t).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},CallSolveMethodOnSolver:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"solveAndDiagnoseAll",_data:e};return this.computeAnswer(r,t).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},CallSolveWithoutDignoseMethodOnSolver:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"solve",_data:e};return this.computeAnswer(r,t,"",!1).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},CallSolverOnSelectedIDsMethodOnSolver:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"solveAndDiagnose",_data:e};return this.computeAnswer(r,t).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},getResultingStatusOriginators:function(e,t,n){var i=this,r={_from:"configurator",_to:"solverConfiguration",_request:"getResultingStatusOriginators",_data:e};return this.computeAnswer(r,t).catch(function(e){i._sendErrorMsgOnModelEvent(e,n)})},abortSolverCall:function(e,t){var n=this;if(this._solverServiceAvailable){var i="/resources/v1/cfgsolver/session/"+e+"/abort";return this._handleRequest(i,{type:"application/ds-json",data:{},headers:{"Content-Type":"application/json"}}).catch(function(e){n._sendErrorMsgOnModelEvent(e,t)})}return this.computeAnswer({_from:"configurator",_to:"solver",_request:"abortRequest",_data:""},e).catch(function(e){n._sendErrorMsgOnModelEvent(e,t)})},setServiceUrl:function(e){this.serviceUrl=e||null},_sendErrorMsgOnModelEvent:function(e,t){t&&t.publish({event:"solver-call-error",data:{errorMsg:e}})},resetService:function(){this.serviceUrl=null,this.solverServiceAvailable=void 0}};return a}),define("DS/CfgSolver/CfgSolverDebug",["DS/CfgSolver/CfgSolverServices","DS/UIKIT/Input/Button","DS/UIKIT/Form","css!DS/CfgSolver/CfgSolverDebug.css","css!DS/UIKIT/UIKIT.css"],function(e,t,n,i,r){"use strict";return function(){var i=null,r=null,a=null,s=null,o=null,l=null,c=null,u=null,v=null,d=function(){l=document.createElement("div"),(c=document.createElement("div")).classList.add("solver-debug-title"),c.innerHTML="Solver Debugger Tool",u=document.createElement("div"),l.classList.add("solver-debug-panel"),l.setAttribute("draggable","true"),l.addEventListener("dragstart",function(e){var t=window.getComputedStyle(e.target,null);e.dataTransfer.setData("text/plain",parseInt(t.getPropertyValue("left"),10)-e.clientX+","+(parseInt(t.getPropertyValue("top"),10)-e.clientY))},!1),document.body.addEventListener("dragover",function(e){return e.preventDefault(),!1},!1),document.body.addEventListener("drop",function(e){var t=e.dataTransfer.getData("text/plain").split(","),n=e.clientX+parseInt(t[0],10),i=Math.max(-20,n),r=l.parentElement.offsetWidth-20;i=Math.min(i,r);var a=l.parentElement.offsetHeight-20,s=e.clientY+parseInt(t[1],10);return s=Math.max(-20,s),s=Math.min(s,a),l.style.left=i+"px",l.style.top=s+"px",e.preventDefault(),!1},!1),f();var e=document.createElement("button");e.setAttribute("type","button"),e.setAttribute("title","close"),e.classList.add("close"),e.classList.add("solver-close"),e.innerHTML="&times;",e.onclick=function(){l.parentNode.removeChild(l)},c.appendChild(e),l.appendChild(c),l.appendChild(u)},f=function(){u.classList.add("solver-debug-body");var l=new t({icon:"record",value:"Record",className:"success solver-start"});l.elements.container.addEventListener("click",function(){v=!0,console.log("send start traces SOLVER");var t={};if(t._from=a,t._to="solver",t._request="tracesActivation",t._data={},t._data.activation="yes",t._data.path=r,t._data.level=1===s?"messagesAndSolver":"messages",i)e.computeAnswer(t,i,Math.random());else{var n=Object.keys(o),u=null,d=0;for(d=0;d<n.length;d+=1){u=n[d];var f=o[u];e.computeAnswer(t,f,Math.random())}}console.log(r),console.log(s),c.elements.container.removeAttribute("disabled"),l.elements.container.setAttribute("disabled",!0)}),l.elements.container.setAttribute("disabled",!0);var c=new t({icon:"stop",value:"Stop",className:"warning solver-stop"});c.addEvent("onClick",function(){v=!1,console.log("send stop stump SOLVER");var t={};if(t._from=a,t._to="solver",t._request="tracesActivation",t._data={},t._data.activation="no",i)e.computeAnswer(t,i,Math.random());else{var n=Object.keys(o),u=null,d=0;for(d=0;d<n.length;d+=1){u=n[d];var f=o[u];e.computeAnswer(t,f,Math.random())}}c.elements.container.setAttribute("disabled",!0),l.elements.container.setAttribute("disabled",!0),""!==r&&s>=0&&l.elements.container.removeAttribute("disabled")}),c.elements.container.setAttribute("disabled",!0);var d=new n({fields:[{type:"text",label:"Folder path",name:"path",placeholder:"Path..."},{type:"select",label:"level",placeholder:"Pick a level of traces...",className:"tracelevel",name:"tracelevel",options:[{label:"Exchanged messages",value:"0"},{label:"Messages with resolution traces",value:"1"}]}],events:{onChange:function(e,t){switch(l.elements.container.setAttribute("disabled",!0),e){case"tracelevel":s=parseInt(t);break;case"path":r=t}""!==r&&s>=0&&!v&&l.elements.container.removeAttribute("disabled")}}});UWA.extendElement(u),d.inject(u),l.inject(u),c.inject(u)};this.init=function(e,t){r="",a=e,s=-1,o=t,v=!1,d()},this.init2=function(e,t){r="",a=e,s=-1,i=t,v=!1,d()},this.setPath=function(e){r=e},this.injectIn=function(e){e.appendChild(l)},this.getSolverServices=function(){return e}}});