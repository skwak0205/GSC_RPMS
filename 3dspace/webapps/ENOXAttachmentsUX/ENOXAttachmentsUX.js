define("DS/ENOXAttachmentsUX/utils/Menus",["UWA/Core","UWA/Utils/InterCom","DS/LifecycleCmd/MaturityCmd","DS/DocumentCommands/DOCMClipboard","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","i18n!DS/DocumentCommands/assets/nls/DocumentCommands"],function(t,e,n,o,a,i){"use strict";return function(t){var a={socket:null,init:function(t){this.ctrl=t},handler:function(t){a.actions[t.menuItem.methodName]&&a.actions[t.menuItem.methodName](a.ctrl,t.nodeModels,t.menuItem,t.target)},actions:{ctxRelations:function(t,n,o,i){var s=a.ctrl.helper.make3DXContent(n);s.appId="ENORIPE_AP";var r=new e.Socket("compassPageSocket");r.subscribeServer("com.ds.compass",window.parent),r.dispatchEvent("onSetX3DContent",s,"compassPageSocket"),r.addListener("launchApp",function(t,e,n){r.unsubscribeServer("com.ds.compass"),r.disconnect()}),r.dispatchEvent("onLaunchApp",s,"compassPageSocket")},ctxCopy:function(t,e,n,i){var s=a.ctrl.helper.make3DXContent(e);o.copy(s)},ctxMaturity:function(t,e,o,a){var i={securitycontext:t.options.connectorOptions.fetchSecurityContext(),context:{}};new n(i).executeAsync(e.map(function(e){return{physicalid:e.options.data.id,serviceurl:t.options.connectorOptions.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/"}}))},ctxShare:function(t,e,n,o){var a=this;require(["DS/ENOCollabSharingCmds/BaseModels/ResultElement","DS/SharePopup/SharePopup"],function(t,n){var o=e.map(function(e){return new t({physicalId:e.options.data.id,name:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})});a.sharePanel?(a.sharePanel.show(o),a.sharePanel.container.centerIt()):(a.sharePanel=new n(widget,widget.body,{removeAtClose:!0,events:{onClose:function(){a.sharePanel=null}}}),a.sharePanel.show(o))})},ctxProperties:function(t,e,n,o){require(["DS/ENOCollabSharingCmds/commands/EditPropCmd/EditPropCmdBase"],function(n){var o=e.map(function(e){return{id:e.options.data.id,tenant:t.options.connectorOptions.platformUrls.platformId,source:"3DSpace",getID:function(){return e.options.data.id}}}),a={getSelectedNodes:function(){return o}};(new n).launchProperties(a)})}}};return a.init(t),a}}),define("DS/ENOXAttachmentsUX/views/GridPane",["UWA/Core","DS/DataGridView/DataGridView","DS/TreeModel/DataModelSet","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,n,o){"use strict";return function(o){var a={build:function(o){this.ctrl=o,a.container=t.createElement("div",{class:o.getClassNames("-gridpane"),styles:{display:"none"}}),a.container.inject(o.elements.panes),o.config.headers.forEach(t=>{"stateNLS"==t.dataIndex&&(t.getCellSemantics=function(t){return{emphasize:o.helper.getStateEmphasisClassname(t.nodeModel.options.data)}})});var i=new n,s="ENOXAttachmentsUX_"+o.options.attachmentsType+"_"+(t.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId);a.datagridview=new e({identifier:s,treeDocument:a.ctrl.controller.attachments,dataModelSet:i,columns:o.config.headers,selectionMode:"row",showSelectionCheckBoxesFlag:!0,showRowIndexFlag:!1,cellDragEnabledFlag:!0,showContextualMenuColumnFlag:!0,rowSelection:"multiple",cellSelection:"none",onDragStartCell:function(t,e){this.onDragStartCellDefault(t,e),t.dataTransfer.effectAllowed="all",t.dataTransfer.setData("Text",JSON.stringify(a.ctrl.helper.make3DXContent(a.datagridview.treeDocument.getSelectedNodes(),a.ctrl.controller.options)))},onContextualEvent:function(t){var e=[];if(t&&t.collectionView){e=t.collectionView.buildDefaultContextualMenu(t,{});var n,o,i="event"in window?event:window.event;if(i)n=i.target,i.clientX&&(o={x:i.clientX,y:i.clientY});else if(t&&t.data&&t.data.windowPosition&&t.data.windowPosition.x&&t.data.windowPosition.y){var s=t.data.windowPosition;o={x:s.x,y:s.y}}else t&&t.data&&t.data.target?n=t.data.target:t.cellInfos&&(n=t.cellInfos.cellView.elements.container);a.datagridview.treeDocument.getSelectedNodes().length>0?a.ctrl.controller.prepareContextMenu(a.datagridview.treeDocument.getSelectedNodes(),n,o):t.cellInfos&&t.cellInfos.nodeModel?a.ctrl.controller.prepareContextMenu([t.cellInfos.nodeModel],n,o):null==t.cellInfos&&a.ctrl.controller.prepareRightClickMenuNoObjectSelection(n,o)}return e}}).inject(a.container),a.datagridview.registerReusableCellContent({id:"actionButton",buildContent:function(){var e=new t.Element("div",{class:"fonticon fonticon-chevron-down",styles:{color:"#b4b6ba",display:"list-item","font-size":"18px",width:"100%"}});return e.addEvent("click",function(t){t.nodeModels=[t.target.cellInfos.nodeModel],a.ctrl.controller.actionMenuHandler(t)}),e}}),a.datagridview.sortModel=[o.topBar.currentSort],o.gridPane=a},show:function(){this.container.show()},hide:function(){this.container.hide()}};return a.build(o),a}}),define("DS/ENOXAttachmentsUX/data/Queues",["UWA/Core"],function(t){"use strict";return function(t){var e={jobs:[],states:{WAIT:1,PROCESSING:2,FINISHED:3},init:function(t){this.ctrl=t},process:function(){var t=this.jobs.filter(function(t){return t.processing==e.states.PROCESSING});if(t.length<3)for(var n=3-t.length,o=this.jobs.filter(function(t){return t.processing==e.states.WAIT}),a=0;a<o.length&&a<n;a++){var i=o[a];i.processing=e.states.PROCESSING,i.process()}},addJob:function(t){t.processing=e.states.WAIT,t.ui&&(e.ctrl.progressPane.addProgress(t),t.update=function(e){t.progress.update(t.title,e.loaded,e.total)}),this.jobs.push(t),this.process()},finishJob:function(t){t.processing=e.states.FINISHED;var n=this.jobs.indexOf(t);-1!=n?this.jobs.splice(n,1):console.error("This wasn't supposed to happen, Unable to splice Q"),this.process(),t.ui&&(t.progress.update(t.title,100,100),setTimeout(function(){t.progress.destroy(),0==e.jobs.length&&e.ctrl.progressPane.hide()},2e3))}};return e.init(t),e}}),define("DS/ENOXAttachmentsUX/views/TilePane",["UWA/Core","DS/CollectionView/ResponsiveLargeTilesCollectionView"],function(t,e){"use strict";return function(n){var o={build:function(n){o.ctrl=n,o.container=t.createElement("div",{class:n.getClassNames("-tilepane"),styles:{display:"none"},events:{contextmenu:function(t){t.preventDefault(),o.ctrl.controller.prepareRightClickMenuNoObjectSelection(t.target,{x:t.clientX,y:t.clientY})}}}),o.container.inject(n.elements.panes),o.rcv=o.container.rcv=new e({model:o.ctrl.controller.attachments,useDragAndDrop:!0,allowUnsafeHTMLContent:!0,displayedOptionalCellProperties:["contextualMenu","description","activeFlag"],onDropBlank:function(t,e){t.preventDefault(),t.stopPropagation(),o.ctrl.dndManager.handleDrop(t),this.onDropBlankDefault(t,e)},onDragStartCell:function(t,e){this.onDragStartCellDefault(t,e),t.dataTransfer.effectAllowed="all",t.dataTransfer.setData("Text",JSON.stringify(o.ctrl.helper.make3DXContent(o.rcv.TreedocModel.getSelectedNodes(),o.ctrl.controller.options)))},onDragEnterBlank:function(t,e){n.options.readonly||this.onDragEnterBlankDefault(t,e)}}).inject(o.container),o.rcv.getContextualMenu=function(t,e,n){return[""]},o.rcv.getLabel=function(e){return t.String.escapeHTML(e.options.label)},o.rcv.onContextualEvent={callback:function(t){if(t&&t.cellInfos){if(t.cellInfos.cellModel){var e,n,a="event"in window?event:window.event;if(a)e=a.target,a.clientX&&(n={x:a.clientX,y:a.clientY});else if(t&&t.data&&t.data.windowPosition&&t.data.windowPosition.x&&t.data.windowPosition.y){var i=t.data.windowPosition;n={x:i.x,y:i.y}}else e=t&&t.data&&t.data.target?t.data.target:t.cellInfos.cellView.elements.container;e&&e.hasClassName&&e.hasClassName("wux-controls-responsivetileview-menu")?o.rcv.TreedocModel.getSelectedNodes().length>1?o.ctrl.controller.prepareContextMenu(o.rcv.TreedocModel.getSelectedNodes(),e,n):o.ctrl.controller.prepareContextMenu([t.cellInfos.nodeModel],e,n):o.ctrl.controller.prepareContextMenu(o.rcv.TreedocModel.getSelectedNodes(),e,n)}}else t.cellCtxMenuRequired;return a.stopPropagation(),[]}},o.rcv.onSelectionAdd(function(t,e){o.ctrl.modelEvents.publish({event:"selection-add",data:t})}),o.rcv.onSelectionRemove(function(t,e){o.ctrl.modelEvents.publish({event:"selection-remove",data:t})}),n.tilePane=o},show:function(){this.container.show()},hide:function(){this.container.hide()},repaintUI:function(){o.rcv._modelEvents.publish({event:"ENDRESIZE",context:o.rcv})},destroy:function(){o.rcv.destroy()}};return o.build(n),o}}),define("DS/ENOXAttachmentsUX/views/UploadPane",["UWA/Core","DS/UIKIT/Input/Button","DS/UIKIT/Input/File","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,n,o){"use strict";return function(a){var i={build:function(a){this.ctrl=a,this.container=t.createElement("div",{class:a.getClassNames("-uploadpane"),events:{contextmenu:function(t){t.preventDefault(),i.ctrl.controller.prepareRightClickMenuNoObjectSelection(t.target,{x:t.clientX,y:t.clientY})}}}),this.container.inject(a.elements.panes);var s=t.createElement("div",{class:a.getClassNames("-uploadpane-center")});s.inject(this.container);var r=t.createElement("div",{class:a.getClassNames("-uploadpane-center-msg")});r.inject(s);var c=t.createElement("div",{class:a.getClassNames("-uploadpane-center-buttons")});a.options.readonly?r.setText(o.get("NO_DOCUMENTS_ATTACHED")):(r.setText(o.get("UPLOAD_OR_ADD_EXISTING")),c.inject(s)),i.uploadButton=this.container.uploadButton=new n({input:!1,multiple:!0,buttonText:o.get("UPLOAD_DOCUMENTS"),attributes:{title:o.get("UPLOAD_DOCUMENTS")},buttonClassName:"primary",events:{onChange:function(t){var e=t.target.files.length>0?t.target.files:t.dataTransfer.files;i.ctrl.modelEvents.publish({event:"user-selects-files-for-upload",data:{cancelled:!1,files:e}})},onClick:function(){event.target.value=""}}}),i.uploadButton.inject(c),i.attachButton=this.container.attachButton=new e({value:o.get("ATTACH_EXISTING"),attributes:{title:o.get("ATTACH_EXISTING")},events:{onClick:function(t){i.ctrl.modelEvents.publish({event:"user-clicks-attach",data:{cancelled:!1}})}}}),i.attachButton.inject(c),a.uploadPane=i},show:function(){this.container.show()},hide:function(){this.container.hide()}};return i.build(a),i}}),define("DS/ENOXAttachmentsUX/data/Constants",[],function(){"use strict";return{ERROR:"error",PRIMARY:"primary",WARNING:"warning",INFO:"info",SUCCESS:"success",PAD_CURRENT_SECURITY_CONTEXT:"pad_security_ctx",PAD_AVAILABLE_SECURITY_CONTEXT:"pad_security_ctx_list",PAD_CSRF_TOKEN:"pad_csrf",PLATFORM_SERVICES:"platformServices",CONTEXT_USER:"context_user",CSRF:"CSRF",OBJECT_ID:"id",PHYSICAL_ID:"physicalid",REL_ID:"id[connection]",REL_NAME:"name[connection]",REL_PHYSICAL_ID:"physicalid[connection]",TYPE:"type",NAME:"name",REVISION:"revision",MODIFIED:"modified",REFERENCE_DOCUMENT:"Reference Document",SPECIFICATION_DOCUMENT:"SpecificationDocument",REL_PLMDOCCONNECTION:"PLMDocConnection",ACCEPT_APPLICATION_JSON:"application/json",SECURITY_CONTEXT_KEY:"SecurityContext",CONTENT_TYPE:"Content-Type",APPLICATION_URL_ENCODED:"application/x-www-form-urlencoded",GET:"GET",POST:"POST",PUT:"PUT",Resources:{GET_SECURITY_CONTEXT:"/resources/pno/person/getsecuritycontext?tenant=",GET_DOCS_BY_PARENT:"/resources/v1/modeler/documents/parentId/"},Query:{REFERENCE_DOCS:"?parentRelName=Reference%20Document&parentDirection=from&$include=versions"}}}),define("DS/ENOXAttachmentsUX/utils/MaturityCache",["UWA/Core","DS/WAFData/WAFData"],function(t,e){"use strict";var n={cachedPolicies:null,setup:function(t){n.options=t,n.load()},fetchPolicies:function(t,o){if(n.cachedPolicies&&n.cachedPolicies[widget.lang]&&t.every(n.hasStateInfoForDoc))o(n.cachedPolicies);else{var a={url:n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId,type:"json",method:"POST",headers:{Accept:"application/json","Accept-Language":widget.lang,"Content-Type":"application/json",securitycontext:n.options.fetchSecurityContext()},data:JSON.stringify({data:t.map(function(t){return{physicalid:t.id}})}),onComplete:function(t){t.status&&null==t.status.errorMsg&&(n.cachedPolicies=n.cachedPolicies||{},n.cachedPolicies[widget.lang]=n.cachedPolicies[widget.lang]||{},t.data.policies.forEach(function(t){n.cachedPolicies[widget.lang][t.name]=n.cachedPolicies[widget.lang][t.name]||{},t.maturityGraph.states.forEach(function(e){n.cachedPolicies[widget.lang][t.name][e.stateSysName]=e})}),localStorage.setItem("DocoMaturityCache:"+n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId,JSON.stringify(n.cachedPolicies)),o(n.cachedPolicies))},onFailure:function(t,e){}};e.authenticatedRequest(a.url,a)}},load:function(){var t=localStorage.getItem("DocoMaturityCache:"+n.options.platformUrls["3DSpace"]+"/resources/lifecycle/maturity/getStateGraph?tenant="+n.options.platformUrls.platformId);null!=t&&null!=(t=JSON.parse(t))&&(n.cachedPolicies=t)},hasStateInfoForDoc:function(t){if(n.cachedPolicies&&n.cachedPolicies[widget.lang]&&(null!=n.cachedPolicies[widget.lang][t.dataelements.policy]&&null!=n.cachedPolicies[widget.lang][t.dataelements.policy][t.dataelements.state]))return!0;return!1}};return n}),define("DS/ENOXAttachmentsUX/views/Topbar",["UWA/Core","DS/UIKIT/Iconbar","DS/DocumentCommands/DOCMClipboard","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,n,o){"use strict";return function(a){var i={ctrl:void 0,build:function(o){this.ctrl=o;var a=[];o.config.actionbar.forEach(function(t){t.content&&t.content.options&&t.content.options.items&&t.content.options.items.length&&(t.content.options.events={onClick:function(t,e,n){i.handleClick(t,e,n)}},"sort"==t.name&&t.content.options.items.forEach(function(t){t.selected&&(i.currentSort={dataIndex:t.dataIndex,sort:t.order})})),a.push(t)}),this.container=t.createElement("div",{class:o.getClassNames("-topbar")}),this.container.inject(o.elements.content),t.createElement("div",{class:o.getClassNames("-topbar-filler")}).inject(this.container),this.actionbar=new e({renderTo:this.container,items:a,className:o.getClassNames("-actionbar"),events:{onClick:function(t,e,n){i.handleClick(t,e,n)}}}),i.selectedItemsMenuButton=i.container.getElement("[name=actions]"),i.setPasteEnabled(),n.events.subscribe({event:"x3dcontent-copied"},function(t){i.setPasteEnabled()}),this.setReadOnly(o.options.readonly),o.topBar=i},handleClick:function(t,e,n,o){e&&(i.actions[e.methodName]?i.actions[e.methodName](t,e,n):e.name.startsWith("viewswitch")?i.actions.SwitchView(t,e,n):e.fonticon.startsWith("sort-")&&i.actions.SwitchSort(t,e,n))},actions:{ActionActions:function(t,e,n){t.nodeModels=i.ctrl.controller.attachments.getSelectedNodes(),i.ctrl.controller.actionMenuHandler(t)},ActionUpload:function(t,e,n){i.ctrl.uploadPane.uploadButton.elements.input.click()},ActionAttach:function(t,e,n){i.ctrl.modelEvents.publish({event:"user-clicks-attach",data:{cancelled:!1}})},ActionDetach:function(t,e,n){i.ctrl.modelEvents.publish({event:"user-clicks-detach",data:{cancelled:!1}})},ActionPaste:function(t,e,o){n.paste(i.pasteX3dContent)},SwitchView:function(t,e,n){i.container.getElement("[name=viewmenu] span").className=e.elements.icon.className,i.actionbar.menu.items.find(t=>"viewmenu"==t.name).tooltip.setBody(o[e.nls]),"view-list"==e.fonticon?i.ctrl.controller.switchView("grid"):i.ctrl.controller.switchView("tile")},SwitchSort:function(t,e,n){e.dataIndex==i.currentSort.dataIndex?(i.currentSort.sort="asc"==i.currentSort.sort?"desc":"asc",e.order=i.currentSort.sort,"tree"==e.dataIndex?e.elements.icon.className="fonticon fonticon-sort-alpha-"+i.currentSort.sort:e.elements.icon.className="fonticon fonticon-sort-num-"+i.currentSort.sort):i.currentSort={dataIndex:e.dataIndex,sort:e.order},i.ctrl.controller.applySortModel(i.currentSort)}},setDetachEnabled:function(t){t?i.container.getElement(".fonticon-remove").getParent().removeClassName("disabled"):i.container.getElement(".fonticon-remove").getParent().addClassName("disabled")},setPasteEnabled:function(){n.contentCopied?i.container.getElement(".fonticon-paste").getParent().removeClassName("disabled"):i.container.getElement(".fonticon-paste").getParent().addClassName("disabled")},pasteX3dContent:function(t){if(t.data){var e=t.data;if(e.data&&e.data.items&&e.data.items.length>0){var n=e.data.items.map(function(t){return t.objectId});i.ctrl.controller.attachAttachments(n)}}else i.ctrl.controller.helper.showNotification("success","Nothing To Paste")},setReadOnly:function(t){t?(i.container.getElement(".fonticon-upload").getParent().addClassName("hidden"),i.container.getElement(".fonticon-plus").getParent().addClassName("hidden"),i.container.getElement(".fonticon-remove").getParent().addClassName("hidden")):(i.container.getElement(".fonticon-upload").getParent().removeClassName("hidden"),i.container.getElement(".fonticon-plus").getParent().removeClassName("hidden"),i.container.getElement(".fonticon-remove").getParent().removeClassName("hidden"))}};return i.build(a),i}}),define("DS/ENOXAttachmentsUX/utils/Search",["UWA/Core","UWA/Utils/InterCom","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,n){"use strict";return function(o){var a={ctrl:o,socketName:void 0,options:void 0,init:function(t){a.socketName&&a.destroy(),a.socketName="ENOXAttachmentsUX_"+(new Date).getTime(),a.setSearchOptions(t)},getdefaultOptions:function(){return{title:n.get("ATTACH_EXISTING"),multiSel:!0,source:["3dspace"],tenant:void 0,role:"",precondition:void 0,defaultSearchCriteria:void 0}},destroy:function(){a.socket&&(a.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),a.socket.unsubscribeServer("SearchComServer"),a.socket.removeListener("Selected_Objects_search",a.objectsSelected),a.socket.disconnect(),delete a.socket),a.socketName=void 0},execute:function(){if(null==a.options.tenant)throw"Needs Actual Tenant ID";a.ctrl.options.parentObject&&a.ctrl.options.parentObject.parentId?a.originalSearchOptions.resourceid_not_in=[a.ctrl.options.parentObject.parentId]:a.originalSearchOptions.resourceid_not_in=[],a.originalSearchOptions.resourceid_not_in.push(a.ctrl.controller.helper.restrict(a.ctrl.controller.attachments.getRoots(),"options.data.id"));var t={cancelled:!1,options:a.originalSearchOptions};a.ctrl.modelEvents.publish({event:"user-clicks-add-existing",data:t}),t.cancelled||(a.setSearchOptions(t.options),a.ctrl.modelEvents.publish({event:"open-3dsearch-for-add-existing",data:a.options}),null==a.socket&&(a.socket=new e.Socket(a.socketName,{dispatchRetryInterval:5}),a.socket.subscribeServer("SearchComServer"),a.socket.addListener("Selected_Objects_search",a.objectsSelected)),a.socket.dispatchEvent("unregisterSearchContext",{widget_id:widget.id}),a.socket.dispatchEvent("RegisterContext",a.options),a.socket.dispatchEvent("InContextSearch",a.options))},objectsSelected:function(t,e,n){var o=t.map(function(t){return t.id});a.ctrl.controller.attachAttachments(o)},setSearchOptions:function(e){t.merge(e,a.getdefaultOptions());var o=a.originalSearchOptions=e;if(a.options={},a.options.title=o.title||n.get("ATTACH_EXISTING"),a.options.mode="furtive",a.options.app_socket_id=a.socketName,a.options.widget_id=widget.id,a.options.default_with_precond=!0,a.options.multiSel=o.multiSel||!0,a.options.source=o.source||["3dspace"],a.options.tenant=o.tenant,a.options.role=o.role||"",a.options.precond=void 0,Array.isArray(o.includedTypes)&&!o.includedTypes.includes("*")&&o.includedTypes.forEach(function(t,e){0!==e&&(a.options.precond+=" OR "),null==a.options.precond&&(a.options.precond=""),a.options.precond+='flattenedtaxonomies:"types/'+t+'"'}),null==a.options.precond&&(a.options.precond=""),a.options.precond&&""!==a.options.precond&&(a.options.precond="("+a.options.precond+")"),Array.isArray(o.excludedTypes)){var i="";o.excludedTypes.forEach(function(t,e){0!==e&&(i+=" OR "),i+='flattenedtaxonomies:"types/'+t+'"'}),""!=i&&(i=" NOT ("+i+")"),""!=a.options.precond&&""!=i?a.options.precond="("+a.options.precond+" AND "+i+")":""!=i&&(a.options.precond="("+i+")")}o.precondition&&a.options.precond?a.options.precond="("+a.options.precond+" AND "+o.precondition+")":o.precondition&&(a.options.precond=o.precondition),o.defaultSearchCriteria&&""!==o.defaultSearchCriteria.trim()&&(a.options.default_search_criteria=o.defaultSearchCriteria),o.resourceid_in&&Array.isArray(o.resourceid_in)&&(a.options.resourceid_in=o.resourceid_in),o.resourceid_not_in&&Array.isArray(o.resourceid_not_in)&&(a.options.resourceid_not_in=o.resourceid_not_in)}};return a}}),define("DS/ENOXAttachmentsUX/utils/Overlay",["UWA/Core"],function(t){"use strict";return{overlay:function(e,n){var o;this.isOverlaid(e)&&this.unoverlay(e),e.addClassName("overlaid"),o=t.createElement("div",{class:"overlay"}),n=t.is(n,"string")?n:"",n=t.createElement("div",{class:"overlay-wrapper",html:{tag:"div",class:"overlay-content",html:[t.createElement("span",{class:"text",text:n})]}}).inject(o),o.inject(e)},unoverlay:function(t){var e=t.getElement(" > .overlay");e&&e.destroy(),t.removeClassName("masked")},isOverlaid:function(t){return t.hasClassName("overlaid")}}}),define("DS/ENOXAttachmentsUX/views/ProgressPane",["UWA/Core","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e){"use strict";return function(n){var o={build:function(n){this.ctrl=n,this.container=t.createElement("div",{class:n.getClassNames("-progresspane")}),this.container.inject(this.ctrl.elements.content);var a=t.createElement("div",{class:"progresspane-titlebar"});a.inject(this.container),t.createElement("div",{class:"progresspane-title",text:e.get("PROGRESS")}).inject(a);var i=t.createElement("button",{class:"close fonticon fonticon-chevron-down",type:"button"});i.inject(a),i.addEvent("click",function(){i.classList.contains("fonticon-chevron-down")?(i.classList.remove("fonticon-chevron-down"),i.classList.add("fonticon-chevron-up"),o.content.hide()):(i.classList.remove("fonticon-chevron-up"),i.classList.add("fonticon-chevron-down"),o.content.show())}),this.content=t.createElement("div",{class:"progresspane-content"}),this.content.inject(this.container),this.hide(),n.progressPane=o},show:function(){this.container.show()},hide:function(){this.container.hide()},addProgress:function(e){o.show();var n=t.createElement("div",{class:"progresspane-job"}),a=t.createElement("div",{class:"progresspane-jobtitle",text:e.title,title:e.title});a.inject(n);var i=t.createElement("progress",{class:"progress progresspane-jobprogress",value:0,max:100});i.inject(n),n.inject(o.content),e.progress=n,e.progress.update=function(t,e,n){a.setText(t),i.setAttributes({value:e,max:n,title:t})}}};return o.build(n),o}}),define("DS/ENOXAttachmentsUX/data/Connector3DSpace",["UWA/Core","DS/ENOXAttachmentsUX/data/Constants","DS/DocumentManagement/DocumentManagement","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX"],function(t,e,n,o,a,i){"use strict";return function(){var o={options:{},init:function(t,e){if(o.controller=t,o.options=e||{},!(o.options&&o.options.fetchSecurityContext&&o.options.platformUrls&&o.options.platformUrls["3DSpace"]&&o.options.platformUrls.platformId))throw new Error("Connector Options incomplete");o.ready=!0,o.controller.connectorReady(o.options)},loadAttachments:function(a){if(!this.ready)throw new Error("Connector not ready");if(a)if(a.noParent&&t.is(a.objectIds,"array"))n.getDocuments(a.objectIds,{tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t){var e=o.controller.ctrl.options.parentObject;if(a.objectIds==e.objectIds){if(t.success){if(!Array.isArray(t.data))return;o.controller.addAttachmentsToUI(t.data)}o.controller.finishLoadingAttachments()}},onFailure:function(t){o.controller.finishLoadingAttachments(),t.error&&o.controller.showNotification("error",i.get("FAILED_TO_LOAD_ATTACHMENTS"),t.error)}});else{var s={relInfo:{parentId:a.parentId,parentRelName:a.relationName||e.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t,n){var a=o.controller.ctrl.options.parentObject;if(n.relInfo.parentId==a.parentId&&n.relInfo.parentRelName==(a.relationName||e.REFERENCE_DOCUMENT)){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=s.relInfo.parentRelName}),o.controller.addAttachmentsToUI(t.data),o.controller.finishLoadingAttachments()}},onFailure:function(t){console.error(t),t.error&&o.controller.showNotification("error",i.get("FAILED_TO_LOAD_ATTACHMENTS"),t.error),o.controller.finishLoadingAttachments()}};n.getDocumentsFromParent(s)}},uploadAttachments:function(t,n,a){require(["DS/DocumentCreateNew/CreateNew","DS/Windows/ImmersiveFrame"],function(s,r){var c=new r;c.inject(widget.body),new s({tenantUrl:o.options.platformUrls["3DSpace"],securityContext:o.options.fetchSecurityContext(),tenant:o.options.platformUrls.platformId,immersiveFrame:c,parentObject:n,parentRelName:n.relationName||e.REFERENCE_DOCUMENT,connector:o,supportedTypes:a,credentialsPrefName:o.options.credentialsPrefName||e.PAD_CURRENT_SECURITY_CONTEXT,onUploadStart:function(){c.destroy()},onCancel:function(){c.destroy()},onError:function(t){o.controller.showNotification("error",i.get("UPLOAD_FAILED"),t.subtitle,t.message||""),c.destroy()}}).create(t)})},attachAttachments:function(s,r){if(s.length>0){for(var c=o.controller.attachments.getRoots(),l=0;l<c.length;l++){var d=c[l];if(s.includes(d.options.data.id)){o.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:d.options.data.dataelements.typeNLS}),i.get("X_IS_ALREADY_ATTACHED",{title:d.options.data.dataelements.title||d.options.data.dataelements.secondaryTitle||d.options.data.dataelements.name}));var p=s.indexOf(d.options.data.id);p>-1&&s.splice(p,1)}}n.getDocuments(s,{tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(n){if(n.success)for(var s=0;s<n.data.length;s++){var c=n.data[s];n.data[s].relName=r.relationName||e.REFERENCE_DOCUMENT;var l=!0;if(r&&r.parentId&&c.id==r.parentId){o.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:c.dataelements.typeNLS}),i.get("CANNOT_ATTACH_X_TO_ITSELF",{title:c.dataelements.title||c.dataelements.secondaryTitle||c.dataelements.name})),l=!1;break}if(l)if(!o.controller.options.supportedTypes.includedTypes.includes("*")&&!o.controller.options.supportedTypes.includedTypes.includes(c.type)||o.controller.options.supportedTypes.excludedTypes.includes(c.type))o.controller.showNotification("error",i.get("DOCUMENT_NOT_ALLOWED",{type:c.dataelements.typeNLS}),i.get("X_CANNOT_BE_ATTACHED",{type:c.type}));else if(r.noParent){var d={onFailure:function(e){console.error(e),t.is(e,"string")&&o.controller.showNotification("error",i.get("FAILED_TO_ATTACH_ATTACHMENT"),e)},onSuccess:function(t){o.controller.addAttachmentsToUI([t]),o.controller.showNotification("success",i.get("DOCUMENT_ATTACHED",{type:t.dataelements.typeNLS}),i.get("X_ATTACHED_SUCCESSFULLY",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}))}};o.controller.events.publish({event:"attach-document-requested",data:{document:c,parentObject:r,callback:d}})}else a(c,r)}},onFailure:function(e){if(e.error)if((e.error.match(/\n/g)||[]).length>2){for(var n=e.error.split("\n"),a=[],s=2;s<n.length;s++)a.push(n[s]);a=a.join("<br/>"),o.controller.showNotification("error",n[0],n[1],a,void 0,!0)}else o.controller.showNotification("error",i.get("DOCUMENT_ATTACH_FAILED"),e.error);else t.is(e,"string")?o.controller.showNotification("error",i.get("DOCUMENT_ATTACH_FAILED"),e):o.controller.showNotification("error",i.get("DOCUMENT_ATTACH_FAILED"))}})}},detachAttachments:function(t,e){if(e.noParent){var n={onSuccess:function(e){t.forEach(function(t){e.forEach(function(e){t.options.data.id==e&&(o.controller.attachments.removeRoot(t),o.controller.showNotification("success",i.get("DOCUMENT_DETACHED",{type:t.options.data.dataelements.typeNLS}),i.get("X_DETACHED_SUCCESSFULLY",{title:t.options.data.dataelements.title||t.options.data.dataelements.secondaryTitle||t.options.data.dataelements.name})))})})}};o.controller.events.publish({event:"detach-attachments-requested",data:{ids:o.controller.helper.restrict(t,"options.data.id"),parentObject:e,callback:n}})}else for(var a=0;a<t.length;a++){s(t[a],e)}},getUpdatedAttachment:function(a,s){n.getDocuments([a.id],{tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;t.data.forEach(function(t){t.relName=a.relName||e.REFERENCE_DOCUMENT}),s(t.data)}},onFailure:function(e){e.error?o.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?o.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):o.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},getUpdatedAttachments:function(e,a,s){n.getDocuments(e.map(function(t){return t.id}),{tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"$fields=indexedImage,indexedTypeicon,isDocumentType,organizationTitle",onComplete:function(t){if(t.success){if(!Array.isArray(t.data))return;a(t.data)}},onFailure:function(e){t.is(s,"function")?s(e):e.error?o.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e.error):t.is(e,"string")?o.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"),e):o.controller.showNotification("error",i.get("FAILED_TO_GET_UPDATED_ATTACHMENT"))}})},ready:!1,uploadAttachment:function(t,e,a){if(o.ready){var s={customDocumentObject:t.custom_attributes?{dataelements:t.custom_attributes}:void 0,tenant:o.options.platformUrls.platformId,securityContext:a,tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"disableOwnershipInheritance=1",onFailure:function(n){if(n.error)if((n.error.match(/\n/g)||[]).length>2){for(var a=n.error.split("\n"),s=[],c=2;c<a.length;c++)s.push(a[c]);s=s.join("<br/>"),o.controller.showNotification("error",a[0],a[1],s,void 0,!0)}else o.controller.showNotification("error",i.get("UPLOAD_FAILED"),n.error);else o.controller.showNotification("error",i.get("UPLOAD_FAILED"),n.error?n.error:i.get("X_UPLOAD_FAILED",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}));o.controller.events.publish({event:"upload-attachment-failure",data:{document:t,parentObject:e}}),o.controller.jobs.finishJob(r)},onProgress:function(n){o.controller.events.publish({event:"upload-attachment-progress",data:{document:t,parentObject:e}}),r.update(n)},onComplete:function(n){n.data&&(n.data[0].dataelements.isDocumentType="TRUE");var a=n.data;a.forEach(function(e){e.delayLoadThumbnails=!0,t.relInfo&&(e.relName=t.relInfo.parentRelName)});var s=function(t){o.controller.addAttachmentsToUI(t),1==t.length?o.controller.showNotification("success",i.get("DOCUMENT_ATTACHED",{type:t[0].dataelements.typeNLS}),i.get("X_ATTACHED_SUCCESSFULLY",{title:t[0].dataelements.title||t[0].dataelements.secondaryTitle||t[0].dataelements.name})):t.length>1&&o.controller.showNotification("success",i.get("DOCUMENTS_ATTACHED"),i.get("X_DOCUMENTS_ATTACHED_SUCCESSFULLY",{num:t.length}))},c={event:"upload-attachment-complete",data:{documents:a,parentObject:e}};e.noParent&&(c.data.callback=s),o.controller.events.publish(c),o.controller.jobs.finishJob(r),e.noParent||s(a)}},r={title:i.get("UPLOADING_X",{title:t.title}),ui:!0,process:function(){n.createDocument(t,s)}};o.controller.jobs.addJob(r)}}};function a(t,a){if(o.ready){var s={relInfo:{parentId:a.parentId,parentRelName:a.relationName||e.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],additionalURLParams:"disableOwnershipInheritance=1",onFailure:function(e){if(e.error)if((e.error.match(/\n/g)||[]).length>2){for(var n=e.error.split("\n"),s=[],c=2;c<n.length;c++)s.push(n[c]);s=s.join("<br/>"),o.controller.showNotification("error",n[0],n[1],s,void 0,!0)}else o.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:t.dataelements.typeNLS}),e.error);else o.controller.showNotification("error",i.get("TYPE_ATTACH_FAILED",{type:t.dataelements.typeNLS}),i.get("X_ATTACH_FAILED",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}));o.controller.events.publish({event:"attach-attachment-failure",data:{document:t,parentObject:a}}),o.controller.jobs.finishJob(r)},onProgress:function(e){o.controller.events.publish({event:"attach-attachment-progress",data:{document:t,parentObject:a}}),r.update(e)},onComplete:function(e){o.controller.events.publish({event:"attach-attachment-complete",data:{document:t,parentObject:a}}),t.relName=s.relInfo.parentRelName,o.controller.jobs.finishJob(r),o.controller.addAttachmentsToUI([t]),o.controller.showNotification("success",i.get("DOCUMENT_ATTACHED",{type:t.dataelements.typeNLS}),i.get("X_ATTACHED_SUCCESSFULLY",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}))}},r={title:i.get("ATTACHING_X",{title:t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name}),ui:!1,process:function(){n.connectDocumentToParent(t.id,s)}};o.controller.jobs.addJob(r)}}function s(a,s){if(o.ready){var r={relInfo:{parentId:s.parentId,parentRelName:a.options.data.relName||e.REFERENCE_DOCUMENT,parentDirection:"from"},tenant:o.options.platformUrls.platformId,securityContext:o.options.fetchSecurityContext(),tenantUrl:o.options.platformUrls["3DSpace"],onFailure:function(e){if(o.controller.events.publish({event:"detach-attachment-failure",data:{id:o.controller.helper.restrict(a,"options.data.id"),parentObject:s}}),o.controller.jobs.finishJob(c),e.error)if((e.error.match(/\n/g)||[]).length>2){for(var n=e.error.split("\n"),r=[],l=2;l<n.length;l++)r.push(n[l]);r=r.join("<br/>"),o.controller.showNotification("error",n[0],n[1],r,void 0,!0)}else o.controller.showNotification("error",i.get("FAILED_TO_DETACH_ATTACHMENT",{type:a.options.data.dataelements.typeNLS}),e.error);else t.is(e,"string")?o.controller.showNotification("error",i.get("FAILED_TO_DETACH_ATTACHMENT",{type:a.options.data.dataelements.typeNLS}),e):o.controller.showNotification("error",i.get("FAILED_TO_DETACH_ATTACHMENT",{type:a.options.data.dataelements.typeNLS}))},onProgress:function(t){o.controller.events.publish({event:"detach-attachment-progress",data:{id:o.controller.helper.restrict(a,"options.data.id"),parentObject:s}}),c.update(t)},onComplete:function(t){o.controller.jobs.finishJob(c),t.success&&o.controller.attachments.getRoots().forEach(function(e){t.data.forEach(function(t){e.options.data.id==t.id&&(o.controller.events.publish({event:"detach-attachment-complete",data:{id:o.controller.helper.restrict(e,"options.data.id"),parentObject:s}}),o.controller.attachments.removeRoot(e),o.controller.showNotification("success",i.get("DOCUMENT_DETACHED",{type:e.options.data.dataelements.typeNLS}),i.get("X_DETACHED_SUCCESSFULLY",{title:e.options.data.dataelements.title||e.options.data.dataelements.secondaryTitle||e.options.data.dataelements.name})))})})}},c={title:i.get("DETACHING_X",{title:a.options.data.dataelements.title||a.options.data.dataelements.secondaryTitle||a.options.data.dataelements.name}),ui:!1,process:function(){n.disconnectDocumentFromParent(a.options.data.id,r)}};o.controller.jobs.addJob(c)}}return o}}),define("DS/ENOXAttachmentsUX/data/Model",["DS/TreeModel/TreeNodeModel","DS/ENOXAttachmentsUX/utils/MaturityCache","DS/Tweakers/TypeRepresentationFactory"],function(t,e,n){"use strict";var o=new n;return function(e,n){function a(t){t.dataelements.originated=new Date(t.dataelements.originated),t.dataelements.modified=new Date(t.dataelements.modified),t.dataelements.type=t.type;var e={data:t,grid:t.dataelements};if(e.label=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,e.title=t.dataelements.title||t.dataelements.secondaryTitle||t.dataelements.name,e.icons=[{iconName:"doc-text"}],e.grid.tree=e.title,e.thumbnail=t.dataelements.indexedImage||t.dataelements.image,e.taxonomies=[t.type],"TRUE"!=t.dataelements.isDocumentType||e.taxonomies.includes("Document")||e.taxonomies.push("Document"),e.thumbnail.endsWith("snresources/images/icons/small/I_CDM_Document.png")&&(e.thumbnail=e.thumbnail.replace("small/I_CDM_Document.png","large/I_TextDoc200x150.png")),e.icons=[t.dataelements.indexedTypeicon||t.dataelements.typeicon],o.generateView(t.dataelements.modified,{readOnly:!0,typePath:"datetime",onViewCreated:function(n){e.subLabel=t.dataelements.typeNLS+" | "+t.dataelements.revision+" | "+n.getContent().getText()}}),e.description=n.helper.getNameAndState(t),t.relateddata&&t.relateddata.files&&t.relateddata.files.length>0){var a=[];t.relateddata.files.forEach(t=>{t.dataelements&&UWA.is(t.dataelements.title,"string")&&a.push(function(t){return t.substring(t.lastIndexOf(".")+1,t.length)||t}(t.dataelements.title))}),t.dataelements.fileExtension=a.join(", ")}return e}var i=a(e);i.reloadFromNewData=function(t){s.updateOptions(a(t))};var s=new t(i);return s}}),define("DS/ENOXAttachmentsUX/utils/Helper",["UWA/Core","DS/LifecycleCmd/MaturityCmd","DS/Notifications/NotificationsManagerViewOnScreen","DS/Notifications/NotificationsManagerUXMessages","DS/ENOXAttachmentsUX/utils/MaturityCache","DS/ENOXAttachmentsUX/data/Constants","DS/WAFData/WAFData","DS/Controls/Label"],function(t,e,n,o,a,i,s,r){"use strict";return function(e){var a={getStateEmphasisClassname:function(t){return"class-name-of-no-use doco-state-badge doco-state-"+t.dataelements.policy.replace(/ /g,"_")+"-"+t.dataelements.state.replace(/ /g,"_")},getNameAndState:function(e,n){var o=t.createElement("span",{class:"NameAndState",styles:{position:"relative"}});return a.getDisplayName(e.relateddata.ownerInfo[0].dataelements.firstname+" "+e.relateddata.ownerInfo[0].dataelements.lastname,e.relateddata.ownerInfo[0]).inject(o),t.createElement("span",{class:"divider",text:"|"}).inject(o),new r({value:e.dataelements.stateNLS,emphasize:a.getStateEmphasisClassname(e)}).inject(o),o},updateStateSpan:function(t,e){},getDisplayName:function(e,n){var o;o=a.ctrl.options.connectorOptions.platformUrls["3DSwym"]?{avatarStr:"",avatarColor:""}:a.getNonSwymAvatarDetails(e);var i=t.createElement("span",{title:e}),s=t.createElement("span",{html:o.avatarStr,class:"avatarIcon"});return a.ctrl.options.connectorOptions.platformUrls["3DSwym"]?s.style.setProperty("background-image","url('"+a.ctrl.options.connectorOptions.platformUrls["3DSwym"]+"/api/user/getpicture/login/"+n.dataelements.name+"/format/mini')"):s.style.setProperty("background",o.avatarColor),s.inject(i),t.createElement("span",{class:"userName",text:e}).inject(i),i},getNonSwymAvatarDetails:function(t){var e,n,o={},a=[[7,139,250],[249,87,83],[111,188,75],[158,132,106],[170,75,178],[26,153,123],[245,100,163],[255,138,46]],i=t.split(" "),s=i[0].toUpperCase(),r=i[i.length-1].toUpperCase(),c=(e=s[0])+(n=r[0]),l=Math.ceil((e.charCodeAt(0)+n.charCodeAt(0))%a.length),d="rgb("+a[l][0]+","+a[l][1]+","+a[l][2]+")";return o.name=t,o.avatarStr=c,o.avatarColor=d,o},showNotification:function(t,e,a,i,s,r){var c={level:t,title:e,subtitle:a,message:i,sticky:s,allowUnsafeHTML:r||!1};window.notifs||(window.notifs=o,n.setNotificationManager(window.notifs),n.setStackingPolicy(5)),window.notifs.addNotif(c)},make3DXContent:function(t,e){var n={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",widgetId:widget.id,data:{items:[]}};return t.forEach(function(t){var o={envId:a.ctrl.options.connectorOptions.platformUrls.platformId,serviceId:"3DSpace",contextId:a.ctrl.options.connectorOptions.fetchSecurityContext(),objectId:t.options.data.id,objectType:t.options.data.type};e&&e.includeObjectTaxonomies&&(o.objectTaxonomies=t.options.taxonomies),n.data.items.push(o)}),n},restrict:function(e,n){if(t.is(e,"array")){if("id"==n)return e.map(function(t){return t.id});if("options.data.id"==n)return e.map(function(t){return t.options.data.id})}else{if("id"==n)return e.id;if("options.data.id"==n)return e.options.data.id}},debounce:function(t,e,n){var o=null,a=[];return function(){if(n){for(var i=[],s=0;s<arguments.length;++s)i.push(arguments[s]);a.push(i)}o&&clearTimeout(o);var r=arguments;o=setTimeout(function(){e.apply(n?{data:a}:null,r),a=[],o=null},t)}},saveViewMode:function(n){var o=localStorage.getItem("ENOXAttachmentsUXViewMode");(o=t.Json.isJson(o)?JSON.parse(o):{})[e.options.attachmentsType+"_"+(t.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)]=n,localStorage.setItem("ENOXAttachmentsUXViewMode",JSON.stringify(o))},loadViewMode:function(){var n=localStorage.getItem("ENOXAttachmentsUXViewMode");if(t.Json.isJson(n)){var o=(n=JSON.parse(n))[e.options.attachmentsType+"_"+(t.is(widget.data.appId)?widget.data.appId:widget.environment.data._data._x_appId)];return"tile"==o||"grid"==o?o:"tile"}return"tile"}};return a.ctrl=e,e.helper=a,a}}),define("DS/ENOXAttachmentsUX/data/Collection",["DS/TreeModel/TreeDocument","DS/ENOXAttachmentsUX/data/Model","DS/DocumentCommonInfra/MaturityColors"],function(t,e,n){"use strict";return function(o){var a=new t({useAsyncPreExpand:!0,shouldAcceptDrag:function(t,e){return!0},shouldAcceptDrop:function(t,e){return!0}});n.setup(o.options.connectorOptions);var i=o.helper.debounce(5e3,function(t){var e=this.data.map(function(t){return t[0].options.data}),n=this.data.map(function(t){return t[0]});o.controller.connector.getUpdatedAttachments(e,function(t){t.forEach(function(t){var e=n.find(function(e){return e.options.data.id==t.id});e&&e.options.reloadFromNewData(t)})})},!0);return a.addAttachments=function(t){a.prepareUpdate();var s=[],r=[];t.forEach(function(t){s.includes(t.dataelements.policy)||(s.push(t.dataelements.policy),r.push(t));var n=new e(t,o);a.addRoot(n),t.delayLoadThumbnails&&i(n)}),a.pushUpdate(),n.fetchPolicies(r,function(t,e,n){})},require(["DS/PlatformAPI/PlatformAPI"],function(t){a.enoRefreshToken&&t.unsubscribe(a.enoRefreshToken),a.enoRefreshToken=t.subscribe("DS/ENO/refresh",function(t){if(t.data&&t.data.authored){if(UWA.is(t.data.authored.modified,"array")&&t.data.authored.modified.length>0){var e=[];a.getRoots().forEach(n=>{t.data.authored.modified.includes(n.options.data.id)&&e.push(n)}),e.length>0&&o.controller.connector.getUpdatedAttachments(e.map(t=>t.options.data),function(t){t.forEach(function(t){var n=e.find(function(e){return e.options.data.id==t.id});n&&n.options.reloadFromNewData(t)})})}UWA.is(t.data.authored.deleted,"array")&&t.data.authored.deleted.length>0&&a.getRoots().forEach(e=>{t.data.authored.deleted.includes(e.options.data.id)&&setTimeout(()=>{e.remove()},1)})}}),a.lifeCycleModificationToken&&t.unsubscribe(a.lifeCycleModificationToken),a.lifeCycleModificationToken=t.subscribe("Lifecycle.Modification",function(t){if("Lifecycle"==(t="string"==typeof t?JSON.parse(t):t).From&&t.Refresh&&t.Refresh.deleted&&Array.isArray(t.Refresh.deleted)){var e=t.Refresh.deleted.map(function(t){return t.physicalid});e.length>0&&a.getRoots().forEach(t=>{e.includes(t.options.data.id)&&setTimeout(()=>{t.remove()},1)})}})}),a}}),define("DS/ENOXAttachmentsUX/data/Controller",["UWA/Core","DS/ENOXAttachmentsUX/data/Constants","DS/ENOXAttachmentsUX/data/Collection","DS/ENOXAttachmentsUX/data/Queues","DS/UIKIT/DropdownMenu","DS/Menu/Menu","DS/ENOXAttachmentsUX/utils/Search","DS/ENOXAttachmentsUX/utils/Helper","DS/ENOXAttachmentsUX/utils/Menus","DS/DocumentCommands/ENOXDocumentCommands","DS/DocumentCommands/DocumentCommandsV2","DS/DocumentCommands/Constants","DS/i3DXCompassPlatformServices/OpenWith","DS/Utilities/Utils","DS/DocumentCommands/TypeDerivativesCache","DS/DocumentCommands/DOCMClipboard","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","text!DS/ENOXAttachmentsUX/assets/searchFilter.json"],function(t,e,n,o,a,i,s,r,c,l,d,p,u,m,h,f,g,v){"use strict";const E=["Document","Quality System Document","Technical Document"];return t.Class.extend({ready:!1,ctrl:void 0,attachments:void 0,init:function(t){this.ready=!1,this.ctrl=t,this.ctrl.controller=this,this.helper=new r(t),this.attachments=new n(t)},initialize:function(e,n){var a=this;h.setup(e.options.connectorOptions.platformUrls),this.attachments.getModelEvents().subscribe({event:"addChild"},function(t){a.switchView(a.view)}),this.attachments.getModelEvents().subscribe({event:"removeChild"},function(t){a.switchView(a.view)}),this._hackRepaint=m.debounce(function(){},500),this.options=e.options,this.initContextMenu(),this.jobs=new o(e),this.events=this.ctrl.modelEvents,this.hookEvents(),this.ctrl.topBar.selectedItemsMenuButton.style.display="none",this.connector=n,this.view=this.helper.loadViewMode(),this.connector.init(this,e.options.connectorOptions),this.options.supportedTypes=this.options.supportedTypes||{};var i={includedTypes:[],excludedTypes:[]};try{this.typesFilter=JSON.parse(v),this.typesFilter[e.options.attachmentsType].includedTypes&&this.typesFilter[e.options.attachmentsType].includedTypes.length>0&&(i.includedTypes=this.typesFilter[e.options.attachmentsType].includedTypes),this.typesFilter[e.options.attachmentsType].excludedTypes&&(i.excludedTypes=this.typesFilter[e.options.attachmentsType].excludedTypes)}catch(t){console.warn("No filter types found")}i.includedTypes&&i.includedTypes.length>0||i.excludedTypes&&i.excludedTypes.length>0?(this.options.supportedTypes=i,0==this.options.supportedTypes.includedTypes.length&&(this.options.supportedTypes.includedTypes=["*"])):t.merge(this.options.supportedTypes,{includedTypes:E,excludedTypes:[]}),this.PLMDMTDocumentTypes=["PLMDMTDocument"],this.options.searchOptions=this.options.searchOptions||{},t.merge(this.options.searchOptions,{tenant:e.options.connectorOptions.platformUrls.platformId}),t.merge(this.options.searchOptions,this.options.supportedTypes),this.search=new s(this.ctrl),this.search.init(this.options.searchOptions),this.menus=new c(this.ctrl);var r=[];this.options.supportedTypes.includedTypes.length>0&&!this.options.supportedTypes.includedTypes.includes("*")&&r.push(...this.options.supportedTypes.includedTypes),this.options.supportedTypes.excludedTypes.length>0&&r.push(...this.options.supportedTypes.excludedTypes),r.push(...this.PLMDMTDocumentTypes),r.push(...E),h.getTypeDerivatives(r,function(t){var e=[],n=[];a.options.supportedTypes.includedTypes.length>0&&!a.options.supportedTypes.includedTypes.includes("*")&&(a.options.supportedTypes.includedTypes.forEach(n=>{t[n]&&t[n].length>0&&e.push(...t[n])}),a.options.supportedTypes.includedTypes=e),a.options.supportedTypes.excludedTypes.length>0&&(a.options.supportedTypes.excludedTypes.forEach(e=>{t[e]&&t[e].length>0&&n.push(...t[e])}),a.options.supportedTypes.excludedTypes=n),t.PLMDMTDocument&&t.PLMDMTDocument.length>0&&a.PLMDMTDocumentTypes.push(...t.PLMDMTDocument)},e.options.connectorOptions.platformUrls["3DSpace"]);var l={fetchSecurityContext:e.options.connectorOptions.fetchSecurityContext,getWorkUnderHeaders:e.options.connectorOptions.getWorkUnderHeaders,getSelectedNodes:function(){return a.attachments.getSelectedNodes()},getDocumentFromNodeModel:function(t){return t.options.data},platformUrls:e.options.connectorOptions.platformUrls,events:a.events,isFromContextMenu:!0};a.documentCommands=new d(l);var p=a.documentCommands.commands;a.activatedCmds=[p.Preview,p.Share,p.Download,p.Edit,p.LockAndDownload,p.UndoEdit,p.Unlock,p.UpdateAndUnlock,p.Update]},loadAttachments:function(){this.connector.loadAttachments(this.ctrl.options.parentObject)},uploadAttachments:function(t){t.length>this.ctrl.config.limits.maxFilesUploadsAtATime?this.showNotification("error",g.get("UPLOAD_FAILED"),g.get("CANNOT_UPLOAD_MORE_THAN_X",{count:this.ctrl.config.limits.maxFilesUploadsAtATime})):this.connector.uploadAttachments(t,this.ctrl.options.parentObject,this.options.supportedTypes)},attachAttachments:function(t){t.length>0&&this.connector.attachAttachments(t,this.ctrl.options.parentObject)},detachAttachments:function(t){var e={cancelled:!1,ids:this.helper.restrict(t,"options.data.id")};this.events.publish({event:"user-clicks-remove",data:e}),e.cancelled||this.connector.detachAttachments(t,this.ctrl.options.parentObject)},selectionChanged:function(t){this.attachments.getSelectedNodes().length>0?(this.ctrl.topBar.setDetachEnabled(!0),this.ctrl.topBar.selectedItemsMenuButton.style.display=""):(this.ctrl.topBar.setDetachEnabled(!1),this.ctrl.topBar.selectedItemsMenuButton.style.display="none"),this._hackRepaint()},switchView:function(t){this.attachments.getRoots().length>0?"grid"==t?(this.ctrl.tilePane.hide(),this.ctrl.uploadPane.hide(),this.ctrl.gridPane.show(),this.view=t,this.helper.saveViewMode(t)):"tile"!=t&&null!=t||(this.ctrl.uploadPane.hide(),this.ctrl.gridPane.hide(),this.ctrl.tilePane.show(),this.view="tile",this.helper.saveViewMode(this.view)):("grid"!=t&&"tile"!=t||(this.view=t,this.helper.saveViewMode(this.view)),this.ctrl.gridPane.hide(),this.ctrl.tilePane.hide(),this.ctrl.uploadPane.show())},actionMenuHandler:function(t){this.prepareContextMenu(t.nodeModels,t.target)},applySortModel:function(t){this.ctrl.gridPane.datagridview.sortModel=[t],this.ctrl.gridPane.datagridview.reapplySortModel()},prepareContextMenu:function(t,e,n){this.contextMenu.hide(),this.manipulateMenuItemsThenShowContextMenu(t,e,n)},prepareRightClickMenuNoObjectSelection:function(t,e){this.contextMenu.hide(),this.manipulateRightClickMenuItemsNoObjectSelection(t),this.showContextMenu(void 0,t,e)},manipulateRightClickMenuItemsNoObjectSelection:function(e){var n=this;this.contextMenu.removeItem(this.contextMenu.items.map(function(t){return t.id}));var o={};o.document={id:n.ctrl.options.parentObject.parentId,contextId:n.connector.options.fetchSecurityContext(),serviceId:"3DSpace",envId:n.connector.options.platformUrls.platformId},o.platformUrls=n.connector.options.platformUrls,o.onComplete=function(t){if("Paste"===t.action)if(t.data){var e=t.data;if(e.data&&e.data.items&&e.data.items.length>0){var o=e.data.items.map(function(t){return t.objectId});n.attachAttachments(o)}}else n.helper.showNotification("success",g.get("Nothing_To_Paste"))};var a=new l;a.init(o);var i=a.render(),s={},r=0;i[p.PASTE]&&(s={index:++r},n.contextMenu.addItem(t.merge(s,i[p.PASTE])))},manipulateMenuItemsThenShowContextMenu:function(e,n,o){var a=this;this.contextMenu.removeItem(this.contextMenu.items.map(function(t){return t.id}));var i,s,r,c,d=-1;this.ctrl.config.contextMenu.forEach(function(t){"OpenWith"==t.name?d=a.options.webinwin&&t.hiddenInWebInWin?-1:0:(t.handler=function(o,i,s){a.menus.handler({nodeModels:e,menuItem:t,target:n})},"Maturity"==t.name?s=t:"Relations"==t.name?i=t:"Share"==t.name?t:"Copy"==t.name?r=t:"Properties"==t.name&&(c=t))});var u={},m=t.clone(e[0].options.data);m=t.merge(m,{parentId:a.ctrl.options.parentObject.parentId,parentDirection:"from",relName:e[0].options.data.relName}),u.getWorkUnderHeaders=a.connector.options.getWorkUnderHeaders,u.document={id:e[0].options.data.id,contextId:a.connector.options.fetchSecurityContext(),serviceId:"3DSpace",envId:a.connector.options.platformUrls.platformId,data:m,type:e[0].options.data.type},u.onComplete=function(t){if("ReplacebyRevision"===t.action||"ReplacebyLatestRevision"===t.action)if(e[0].options.data.id==t.targetDocumentId)console.log("same revision selected. Do nothing. only show notification");else{var n=a.ctrl.controller.attachments.getRoots().find(function(t){return t.options.data.id==e[0].options.data.id});n.remove(),a.ctrl.controller.connector.getUpdatedAttachment({id:t.targetDocumentId},function(e){a.ctrl.controller.attachments.addAttachments(e,n._rowID),a.ctrl.setSelection([t.targetDocumentId])})}else"Update"!==t.action&&"Edit"!==t.action&&"UndoEdit"!==t.action||a.connector.getUpdatedAttachment(e[0].options.data,function(t){1==t.length&&(e[0].options.data.relateddata.files=t[0].relateddata.files)});var o=t.result.message;a.helper.showNotification("info",e[0].options.data.dataelements.title||e[0].options.data.dataelements.secondaryTitle||e[0].options.data.dataelements.name,o,"",!1)},u.onFailure=function(t){console.log(t.action+" failed for "+t.targetDocumentId),a.helper.showNotification("error",t.message?t.message:t.error.message,"","",!1)},u.platformUrls=a.connector.options.platformUrls;var h,f=e.every(t=>"TRUE"==t.options.data.dataelements.isDocumentType),g=[],v=new l;h=f?a.documentCommands.getUIKitItemsForCurrentSelection(a.activatedCmds,!1):new t.Promise(function(t){t([])});var E=v.init(u);t.Promise.all([E,h]).then(function(l){g=l[1];var u=v.render(),m={},h=0;if(-1!=d){h++;var f=a.helper.make3DXContent(e,{includeObjectTaxonomies:!0});a.openWith.set3DXContent(f).render(a.contextMenu)}if(e[0].options.data.type&&!a.PLMDMTDocumentTypes.includes(e[0].options.data.type)){0!=e[0].options.data.relateddata.files.length&&""!=e[0].options.data.relateddata.files[0].dataelements.locker,e[0].options.data.relateddata.files.length>1&&!0,0!=a.contextMenu.items.length?(m={index:++h},a.contextMenu.addItem(t.merge(m,{className:"divider"}))):h=0,a.options.webinwin||g.forEach(e=>{e.name==p.PREVIEW&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e)))}),m={index:++h},a.contextMenu.addItem(t.merge(m,{className:"divider"})),m={index:++h},a.contextMenu.addItem(t.merge(m,r)),g.forEach(e=>{e.name==p.UPDATE&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e))),e.name==p.UPDATE_AND_UNLOCK&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e))),e.name==p.LOCK_AND_DOWNLOAD&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e))),e.name==p.EDIT&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e))),e.name==p.UNDO_EDIT&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e))),e.name==p.UNLOCK&&(m={index:++h},a.contextMenu.addItem(t.merge(m,e)))}),u[p.REPLACE_BY_REVISION]&&(m={index:++h},a.contextMenu.addItem(t.merge(m,u[p.REPLACE_BY_REVISION]))),m={index:++h},a.contextMenu.addItem(t.merge(m,{className:"divider"})),m={index:++h},a.contextMenu.addItem(t.merge(m,s)),m={index:++h},a.contextMenu.addItem(t.merge(m,{className:"divider"})),g.forEach(e=>{e.name==p.SHARE&&(m={index:++h},e.acceptsMultiSelection=!0,a.contextMenu.addItem(t.merge(m,e)))}),u[p.COPY_LINK]&&(m={index:++h},a.contextMenu.addItem(t.merge(m,u[p.COPY_LINK]))),m={index:++h},a.contextMenu.addItem(t.merge(m,{className:"divider"})),m={index:++h},a.contextMenu.addItem(t.merge(m,i)),g.forEach(e=>{e.name==p.DOWNLOAD&&(m={index:++h},e.acceptsMultiSelection=!0,a.contextMenu.addItem(t.merge(m,e)))}),m={index:++h},a.contextMenu.addItem(t.merge(m,c))}a.contextMenu.removeItem(a.contextMenu.items.filter(function(n){return!(!a.options.webinwin||!n.hiddenInWebInWin)||(!(!a.options.readonly||!n.hiddenInReadOnly)||(e.length>1?!n.acceptsMultiSelection:!!t.is(n.supportedTypes,"array")&&!n.supportedTypes.includes(e[0].options.data.type)))}).map(function(t){return t.id})),a.contextMenu.removeItem(a.contextMenu.items.filter(function(t,e,n){return 0!==e&&(t.className&&"divider"===t.className&&"divider"===n[e-1].className)}).map(function(t){return t.id})),a.contextMenu.items.length>0&&a.contextMenu.items[0].className&&"divider"===a.contextMenu.items[0].className&&a.contextMenu.removeItem(a.contextMenu.items[0].id),a.events.publish({event:"context-menu-requested",data:{contextMenu:a.contextMenu,data:e.map(function(t){return t.options.data}),PLMDMTDocumentTypes:a.PLMDMTDocumentTypes}}),a.showContextMenu(e,n,o)})},showContextMenu:function(t,e,n){null==n?delete this.contextMenu.options.altPosition:this.contextMenu.options.altPosition=n,this.contextMenu.nodeModels=t,this.contextMenu.options.target=e;var o=void 0;n?(o={pageX:n.x,pageY:n.y},this.contextMenu.options.contextual=!0,delete this.contextMenu.options.altPosition,this.contextMenu.show(!1,o)):(this.contextMenu.options.contextual=!1,this.contextMenu.show())},attachExistingAttachments:function(){this.search.execute()},clearAll:function(){this.attachments.removeRoots()},addAttachmentsToUI:function(t){this.attachments.addAttachments(t),this.events.publish({event:"on-add-attachments-to-ui",data:{ids:this.helper.restrict(t,"id")}}),this.ctrl.gridPane.datagridview.reapplySortModel()},finishLoadingAttachments:function(){this.ctrl.finishLoading(),this._hackRepaint()},showNotification:function(t,e,n,o,a,i){this.helper.showNotification(t,e,n,o,a,i)},connectorReady:function(t){this.connector.options=t,this.events.publish({event:"on-connector-ready",data:t}),this.loadAttachments()},destroy:function(){this.ctrl.tilePane.destroy(),this.search.destroy()},_hackRepaint:null,initContextMenu:function(){var t=this,e=[],n=-1,o=-1;this.ctrl.config.contextMenu.forEach(function(a){n++,"OpenWith"==a.name?o=t.options.webinwin&&a.hiddenInWebInWin?-1:n:(a.handler=function(e,n,o){t.menus.handler({nodeModels:t.contextMenu.nodeModels,menuItem:a,target:t.contextMenu.options.target})},e.push(a))}),this.contextMenu=new a({items:e,events:{onClickOutside:function(t,e){}}});var i={protocol:"3DXContent",version:"2.0",source:"ENOXATTACHMENTS",data:{items:[{envId:void 0,serviceId:void 0,contextId:void 0,objectId:void 0,objectType:void 0}]}};-1!=o&&(this.openWith=this.openWith||new u,this.openWith.set3DXContent(i).setIndex(o+1).render(this.contextMenu))},hookEvents:function(){var t=this;this.events.subscribe({event:"user-clicks-attach"},function(e){0==e.cancelled&&t.attachExistingAttachments()}),this.events.subscribe({event:"user-clicks-detach"},function(e){0==e.cancelled&&t.detachAttachments(t.attachments.getSelectedNodes())}),this.events.subscribe({event:"user-selects-files-for-upload"},function(e){0==e.cancelled&&t.uploadAttachments(e.files)}),this.events.subscribe({event:"user-dropped-files"},function(e){0==e.cancelled&&t.uploadAttachments(e.files)}),this.events.subscribe({event:"user-dropped-x3dcontent"},function(e){if(0==e.cancelled&&e.x3dcontent.data&&e.x3dcontent.data.items&&e.x3dcontent.data.items.length>0){var n=e.x3dcontent.data.items.map(function(t){return t.objectId});t.attachAttachments(n)}}),this.events.subscribe({event:"selection-add"},function(e){t.selectionChanged(e)}),this.events.subscribe({event:"selection-remove"},function(e){t.selectionChanged(e)}),this.attachments.getModelEvents().subscribe({event:"addChild"},function(e){t.events.publish({event:"attachments-count-changed",data:t.attachments.getRoots().length})}),this.attachments.getModelEvents().subscribe({event:"removeChild"},function(e){t.events.publish({event:"attachments-count-changed",data:t.attachments.getRoots().length})}),this.events.subscribe({event:"docv2-edit-complete"},function(e){t.connector.getUpdatedAttachment(e.nodeModel.options.data,function(n){1==n.length&&(e.nodeModel.options.data.relateddata.files=n[0].relateddata.files,t.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:e.nodeModel}}))})}),this.events.subscribe({event:"docv2-update-complete"},function(e){t.connector.getUpdatedAttachment(e.nodeModel.options.data,function(n){1==n.length&&(e.nodeModel.options.data.relateddata.files=n[0].relateddata.files,t.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:e.nodeModel}}),t.events.publish({event:"docv2-preview-reload-viewer",data:{nodeModel:e.nodeModel}}))})}),this.events.subscribe({event:"docv2-undoedit-complete"},function(e){t.connector.getUpdatedAttachment(e.nodeModel.options.data,function(n){1==n.length&&(e.nodeModel.options.data.relateddata.files=n[0].relateddata.files,t.events.publish({event:"docv2-preview-reload-toolbar",data:{nodeModel:e.nodeModel}}))})}),this.events.subscribe({event:"docv2-show-notification"},function(e){t.helper.showNotification(e.level,e.title,e.subtitle,e.message,e.sticky,e.allowUnsafeHTML)})}})}),define("DS/ENOXAttachmentsUX/data/DnDManager",["UWA/Core","DS/DataDragAndDrop/DataDragAndDrop","DS/ENOXAttachmentsUX/data/Controller"],function(t,e,n){"use strict";return function(t){var n={init:function(t){this.ctrl=t;var o=t.uploadPane.container,a=t.gridPane.container,i=t.getClassNames("-drag-over"),s={drop:function(e,s,r){t.options.readonly||(o.removeClassName(i),a.removeClassName(i),n.handleDrop(r))},enter:function(e,n){t.options.readonly||(o.addClassName(i),a.addClassName(i))},over:function(e,n){t.options.readonly||(o.addClassName(i),a.addClassName(i))},leave:function(e,n){t.options.readonly||(o.removeClassName(i),a.removeClassName(i))}};e.droppable(o,s),e.droppable(a,s),t.dndManager=this},handleDrop:function(e){if(!t.options.readonly)if(e.dataTransfer.files&&e.dataTransfer.files.length>0)n.ctrl.modelEvents.publish({event:"user-dropped-files",data:{cancelled:!1,files:e.dataTransfer.files}});else if(""!=e.dataTransfer.getData("text")){var o=e.dataTransfer.getData("text"),a=JSON.parse(o);null!=a&&"3DXContent"==a.protocol&&n.ctrl.modelEvents.publish({event:"user-dropped-x3dcontent",data:{cancelled:!1,x3dcontent:a}})}}};return n.init(t),n}}),define("DS/ENOXAttachmentsUX/AttachmentsPane",["UWA/Core","DS/ENOXAttachmentsUX/data/Controller","DS/ENOXAttachmentsUX/data/Connector3DSpace","DS/ENOXAttachmentsUX/views/Topbar","DS/ENOXAttachmentsUX/views/UploadPane","DS/ENOXAttachmentsUX/views/GridPane","DS/ENOXAttachmentsUX/views/TilePane","DS/ENOXAttachmentsUX/views/ProgressPane","text!DS/ENOXAttachmentsUX/assets/config.json","DS/ENOXAttachmentsUX/data/DnDManager","DS/CoreEvents/ModelEvents","DS/UIKIT/Mask","DS/ENOXAttachmentsUX/utils/Overlay","i18n!DS/ENOXAttachmentsUX/assets/nls/ENOXAttachmentsUX","css!DS/ENOXAttachmentsUX/ENOXAttachmentsUX.css"],function(t,e,n,o,a,i,s,r,c,l,d,p,u,m,h){"use strict";return(c=JSON.parse(c)).actionbar.forEach(function(t){t.text=m.get(t.nls),t.title=m.get(t.nls),t.content&&t.content.options&&t.content.options.items&&t.content.options.items.forEach(function(t){t.text=m.get(t.nls),t.description=m.get(t.nls)})}),c.headers.forEach(function(t){t.text=m.get(t.nls)}),c.contextMenu.forEach(function(t){t.text=m.get(t.nls),t.title=m.get(t.nls)}),t.Controls.Abstract.extend({name:"enox-attachments",options:{className:""},_options:{},modelEvents:void 0,init:function(e){this.modelEvents=e.events||new d,this.config=t.clone(c),this._parent(e),this._options=e,this.buildSkeleton()},buildSkeleton:function(){this.elements.container=t.createElement("div",{class:this.getClassNames()}),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.elements.content=t.createElement("div",{class:this.getClassNames("-content")}),this.elements.content.inject(this.elements.container),this.options.attachmentsType="attachments",new e(this),new o(this),this.buildContentPanes(),new r(this),new l(this),this._options.delayInitialize?console.log("Waiting for initialize to be called"):this.initialize()},buildContentPanes:function(){this.elements.panes=t.createElement("div",{class:this.getClassNames("-panes")}),this.elements.panes.inject(this.elements.content),new a(this),new i(this),new s(this)},setParentObject:function(t){this.options.parentObject=t,this.finishLoading(),this.options.parentObject?this.startLoading():this.showNoParentSelected(),this.controller.clearAll(),this.controller.loadAttachments()},getParentObject:function(){return this.options.parentObject},setConnectorOptions:function(e){t.merge(this.options.connectorOptions,e)},setSupportedTypes:function(e){t.merge(this.options.supportedTypes,e),t.merge(this.options.searchOptions,this.options.supportedTypes)},initialize:function(){this.controller.initialize(this,this._options.connector||new n)},attachAttachments:function(t){this.controller.attachAttachments(t)},startLoading:function(){p.mask(this.elements.container)},finishLoading:function(){p.unmask(this.elements.container),u.unoverlay(this.elements.container)},showNoParentSelected:function(){u.overlay(this.elements.container,m.get("NOPARENTOBJECT"))},destroy:function(){this.controller.destroy(),this._parent()},onRemoved:function(){this.destroy()},setSelection:function(t){this.controller.attachments.processDescendants({processNode:function(e){t.includes(e.nodeModel.options.data.id)?e.nodeModel.select():e.nodeModel.unselect()},onlyVisibleNodes:!1})},getSelection:function(){return this.controller.helper.restrict(this.controller.attachments.getSelectedNodes(),"options.data.id")}})}),define("DS/ENOXAttachmentsUX/AttachmentsFacet",["UWA/Core","UWA/Class","UWA/Controls/Abstract","DS/EditPropWidget/facets/Common/FacetsBase","DS/ENOXAttachmentsUX/AttachmentsPane"],function(t,e,n,o,a){return e.extend(n,o,{init:function(t){this._parent(t),this.componentRefresh=!1,this.buildView(t)},buildView:function(e){this.elements.container=t.createElement("div",{class:"attachments"});var n={parentObject:{parentId:e.appContext.getDocumentId()},connectorOptions:{fetchSecurityContext:function(){return e.appContext.options.securityContext},platformUrls:e.appContext.options.platformUrls,credentialsPrefName:"credentials"}};this.attachmentsPane=new a(n),this.attachmentsPane.inject(this.elements.container),this.attachmentsPane.modelEvents.subscribe({event:"context-menu-requested"},function(t){var e;if(t.contextMenu.items.forEach(function(t){t.name&&t.name.startsWith("open-with")&&(e=t)}),e){var n=[];t.contextMenu.items.forEach(function(t){t.parentItemId&&t.parentItemId==e.id&&n.push(t)}),n.length>0&&1==n.length&&"ENXWDOC_AP"==n[0].name&&t.contextMenu.removeItem([e.id,n[0].name])}})},updateFacet:function(){this.selectionModified(this.options.appContext.getDocumentId())},selectionModified:function(t){if(t){var e={parentId:t};this.attachmentsPane&&this.attachmentsPane.getParentObject().parentId!==t&&this.attachmentsPane.setParentObject(e),this.componentRefresh=!0}},onResize:function(){},onRefresh:function(){}})});