define("DS/SocialNetworkWdg/Models/Platform",["UWA/Core","UWA/Class/Model","DS/WebappsUtils/WebappsUtils"],function(e,t,i){"use strict";return t.extend({defaults:function(){return{title:"",date:"",content:"",image:"",isAuth:!1,url:"",provider:"",auth:null}},parse:function(e){this.set("items",e),this.dispatchEvent("platformFeedParsed")},url:function(){return!0===this.get("isAuth")?e.Data.proxifyUrl(this.get("url"),{proxy:"ajax",authentication:this.get("auth")}):null}})}),define("DS/SocialNetworkWdg/Views/RootTileView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(e,t){"use strict";return t.extend({select:function(){!0===this.model.get("isAuth")&&this._parent.apply(this,arguments)}})}),define("DS/SocialNetworkWdg/Models/Item",["UWA/Core","UWA/Class/Model","DS/WebappsUtils/WebappsUtils"],function(e,t,i){"use strict";return t.extend({defaults:function(){return{id:"",title:"",author:"",itemContent:null,date:void 0,content:"",image:"",medial:null}},init:function(){if(!e.is(arguments[0].image)){arguments[0].image=i.getWebappsAssetUrl("SocialNetworkWdg","images")+"/default_80x60.png"}this._parent.apply(this,arguments)}})}),define("DS/SocialNetworkWdg/Views/RootView",["UWA/Core","DS/W3DXComponents/Views/Layout/ListView"],function(e,t){"use strict";return t.extend({onItemViewClick:function(){e.log("Coming here")}})}),define("DS/SocialNetworkWdg/Views/DetailItem",["UWA/Core","UWA/Class/View"],function(e,t){"use strict";return t.extend({tagName:"div",className:"generic-detail",render:function(){var t=[],i=[],n=null;return n=this.model.get("content").replace(/&lt;/g,"<").replace(/&gt;/g,">"),n=(n=function(e){return e.replace(/#\w+/g,function(e){return'<span style="color:gray;">'+e+"</span>"})}(n=n.replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'" style="color:blue;">'+e+"</a>"}))).replace(/\r?\n/g,"<br/>"),i=e.is(this.model.get("media"))?[{tag:"div",html:n},{tag:"img",class:"itemviewMedia",src:this.model.get("media")}]:n,t.push({tag:"div",class:"generic-content",html:i}),this.container.setContent(t),this}})}),define("DS/SocialNetworkWdg/Collections/Platforms",["UWA/Core","UWA/Class/Collection","UWA/Services/Auth","UWA/Services/Auth/Adapter/Exposition","DS/SocialNetworkWdg/Models/Platform","DS/WebappsUtils/WebappsUtils","i18n!DS/SocialNetworkWdg/assets/nls/socialNetwork"],function(e,t,i,n,o,s,a){"use strict";function r(e){return new i({adapter:"Exposition",adapterOptions:e})}return t.extend({model:o,fetch:function(){this.reset(this.parse())},parse:function(){var e=[];return e.push({title:"Twitter",content:a.twitterDescription,image:s.getWebappsAssetUrl("SocialNetworkWdg","images")+"/twitter_64x64.png",isAuth:!1,url:"https://api.twitter.com/1.1/statuses/home_timeline.json?count=60",auth:r({provider:"twitter"})}),e.push({title:"LinkedIn",content:a.linkedInDescription,image:s.getWebappsAssetUrl("SocialNetworkWdg","images")+"/linkedin_64x64.png",isAuth:!1,url:"https://api.linkedin.com/v1/people/~:(firstName,lastName)",auth:r({provider:"linkedin2"})}),e.push({title:"Google +",content:a.googlePlusDescription,image:s.getWebappsAssetUrl("SocialNetworkWdg","images")+"/google_64x64.png",isAuth:!1,url:"https://www.googleapis.com/plus/v1/people/me/people/visible",auth:r({provider:"google2",data:{scope:"https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.me"}})}),e}})}),define("DS/SocialNetworkWdg/Collections/Items",["UWA/Core","UWA/Class/Collection","DS/SocialNetworkWdg/Models/Item","i18n!DS/SocialNetworkWdg/assets/nls/socialNetwork"],function(e,t,i,n){"use strict";function o(e,t){return new Date(e).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})}return t.extend({model:i,parentModel:{},setup:function(){var e=arguments[1];this.parentModel=e._modelKey},fetch:function(){this.reset(this.parse(this.parentModel._attributes.items))},parse:function(t){var i=[];return"Twitter"===this.parentModel._attributes.title?i=function(t){var i,s,a,r=[],l=null,u=null,c=null;for(i=0;i<t.length;i++)s=(l=t[i]).retweeted_status,e.is(s)?(c=s.user.name+" "+n.twitterRetweeted+" "+l.user.name,l=s):c=l.user.name,u=e.is(l.entities.media)?l.entities.media[0].media_url:null,a=l.text.replace(/&lt;/g,"<").replace(/&gt;/g,">"),r.push({id:l.id,title:c,date:o(l.created_at,"en"),content:a,htmlContent:a,image:l.user.profile_image_url,media:u});return r}(t):"LinkedIn"===this.parentModel._attributes.title?i=function(t){var i,n=[];for(i=0;i<t.length;i++){var s,a,r="",l=null,u="",c=null;if(a=(s=t[i]).updateContent,"CMPY"===s.updateType)u=a.company.name,e.is(a.companyJobUpdate)?r="New job offer - "+a.companyJobUpdate.job.description:e.is(a.companyStatusUpdate)?(u=a.company.name+" shared "+a.companyStatusUpdate.share.content.title,r=a.companyStatusUpdate.share.comment,l=a.companyStatusUpdate.share.content.thumbnailUrl,c=a.companyStatusUpdate.share.content.submittedImageUrl):r="NEW CASE NEW CASE";else if("CONN"===s.updateType||"PICU"===s.updateType||"VIRL"===s.updateType||"SHAR"===s.updateType){switch(u=a.person.firstName+" "+a.person.lastName,s.updateType){case"CONN":var d=s.updateContent.person.connections.values[0];r="New connection with "+d.firstName+" "+d.lastName;break;case"PICU":r="New profil picture";break;case"VIRL":if("LIKE"===s.updateContent.updateAction.action.code){var p=s.updateContent.updateAction.originalUpdate.updateContent.person;r="Likes "+p.firstName+" "+p.lastName+"'s link"}else r="VIRL - NEW CASE";break;case"SHAR":r="Shares "+a.person.currentShare.comment}l=a.person.pictureUrl}else r="NEW CASE NEW CASE - itemType "+s.updateType;n.push({id:s.updateKey,author:u,title:u,date:o(s.timestamp,"en"),content:r,itemContent:a,htmlContent:r,image:l,media:c})}return n}(t.values):"Google +"===this.parentModel._attributes.title&&(i=function(e){var t,i=[];for(t=0;t<e.length;t++){var n=e[t];i.push({id:n.id,author:n.displayName,title:n.displayName,date:o(n.timestamp,"en"),content:n.url,image:n.image.url,media:n.image.url})}return i}(t.items)),i},onError:function(){e.log("error onError")}})}),define("DS/SocialNetworkWdg/Skeleton",["UWA/Core","UWA/Class","UWA/Class/View","DS/W3DXComponents/Skeleton","DS/SocialNetworkWdg/Collections/Platforms","DS/SocialNetworkWdg/Collections/Items","DS/W3DXComponents/Views/EmptyView","DS/W3DXComponents/Views/Layout/ListView","DS/SocialNetworkWdg/Views/RootView","DS/SocialNetworkWdg/Views/RootTileView","DS/SocialNetworkWdg/Views/DetailItem","i18n!DS/SocialNetworkWdg/assets/nls/socialNetwork"],function(e,t,i,n,o,s,a,r,l,u,c,d){"use strict";var p,m,g;return p=function(){return{itemView:u,itemViewOptions:{mapping:{subtitle:function(){return this.model.get("date")}},events:{onClick:function(){g.dispatchEvent("socialNetworkSelected",this.model)}}},emptyView:a,useInfiniteScroll:!1,usePullToRefresh:!1}},m=function(){return{itemViewOptions:{mapping:{subtitle:function(){return this.model.get("date")}},icon:"rss"},emptyView:a,useInfiniteScroll:!1,usePullToRefresh:!0}},t.extend({createSkeleton:function(t){var i=t.widget;return g=new n({platforms:{collection:o,view:r,viewOptions:p,idCardOptions:{facets:[{text:d.details,icon:"doc-text",handler:n.getRendererHandler("items")}],actions:function(){var t=[];return t.push({text:d.logout,icon:"logout",handler:function(){var t=this.model.get("auth");e.is(t)&&(t.clearIdentity(),i.getElement(".skeleton-ctrl-back").click(),this.model.set("isAuth",!1))}}),t}}},items:{collection:s,view:r,viewOptions:m,idCardOptions:{attributesMapping:{title:"title",date:function(){return this.get("date")},ownerName:function(){var t=this.get("author"),i=this.get("authors");return e.is(t,"string")?t:e.is(i,"array")&&i.length>0?e.is(i[0],"string")?i[0]:"":void 0}},facets:[{text:d.details,icon:"doc-text",handler:n.getRendererHandler(c)}]}}},{root:"platforms",responsiveTrigger:function(){return"maximized"===i.getView().type}})}})}),define("DS/SocialNetworkWdg/SocialNetwork",["UWA/Core","UWA/Class","DS/SocialNetworkWdg/Skeleton"],function(e,t,i){"use strict";return t.extend({loadData:function(){var e=this;e._selectedModel.set("isAuth",!0),e._selectedModel.fetch(),e._selectedModel.listenToOnce(e._selectedModel,"platformFeedParsed",function(){e._skeleton.getViewAt(0).dispatchEvent("onItemViewSelect",e._selectedModel)})},loginFail:function(){this._selectedModel=null,e.log("LOGIN FAIL !!")},createSkeletonView:function(){var t,n=this,o=n._widget;e.is(o.getValue("links"))&&(n._links=e.Json.decode(o.getValue("links"))),n._skeleton=t=(new i).createSkeleton({widget:o}),o.body.empty(),t.render().inject(n._widget.body),t.listenTo(t,"socialNetworkSelected",function(e){n._selectedModel=e;var t=e.get("auth");t.hasIdentity(n.loadData.bind(n),function(){t.authenticate(n.loadData.bind(n),n.loginFail.bind(n))})})},onLoad:function(){this._skeleton&&(this._skeleton.destroy(),this._skeleton=null),this._widget.body.empty(),this.createSkeletonView()},initWidgetEvents:function(){var e=this._widget;e.onDestroy=this.onDestroy,e.addEvents({onLoad:this.onLoad.bind(this)})},onDestroy:function(){this._widget=null,this._skeleton&&this._skeleton.destroy()},init:function(e){this._widget=e,this._skeleton=null,this._auth=[],this._selectedModel=null,this.initWidgetEvents()}})});