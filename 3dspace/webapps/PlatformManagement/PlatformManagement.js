define("DS/PlatformManagement/Model/LegalNoticeModel",["UWA/Core","UWA/Class/Model"],function(e,t){"use strict";return t.extend({defaults:{accepted:!1,acceptedDP:!1,acceptedTOS:!1,displayName:"",dp:"",id:"",manager:!0,tos:""},hasLegal:function(){return this.get("statusDP")||this.get("statusTOS")||this.get("statusCookies")}})}),define("DS/PlatformManagement/Utils/FCSManager",["UWA/Core","UWA/Class","UWA/Utils","UWA/Utils/Client","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t,n,i,o){"use strict";var s=o.extend({url:"environment/ticket"}),a=o.extend({url:"environment/checkoutticket"});return t.singleton({fetchTicket:function(e){return(new s).fetch(e)},fetchCheckoutTicket:function(e){return(new a).fetch(e)},downloadFile:function(e,t){var i=t.fcsJobTicket;this._isChromeAndroid()?this._downloadWithForm(t,e):window.top.location=t.fcsUrl+"?"+n.toQueryString({__fcs__failurePage:t.failurePage,__fcs__jobTicket:i,file_0_name:e,__fcs__attachment:!0})},_isChromeAndroid:function(){return e.is(i.Platform.android)&&e.is(i.Engine.chrome)},_downloadWithForm:function(t,n){var i=e.createElement("form",{class:"form-wrapper",action:t.fcsUrl,method:"POST",enctype:"application/x-www-form-urlencoded",target:"_blank",html:[{tag:"input",type:"hidden",value:n,name:"file_0_name",id:"file_0_name"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"},{tag:"input",type:"hidden",value:t.fcsJobTicket,name:"__fcs__jobTicket",id:"__fcs__jobTicket"}]});i.inject(document.body),i.submit(),setTimeout(function(){i.destroy()},25)}})}),define("DS/PlatformManagement/Views/TileAddView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(e,t){"use strict";return t.extend({tagName:"div",name:"platform-management",render:function(){return this.container.addClassName("grid add-container"),this._parent(),this.container.getElement(".platform-management-header").setContent({tag:"i",class:"tile-header-icon "+this.model.get("fonticon")}),this.container.getElement(".platform-management-body").removeClassName("tile-body").setContent({tag:"div",styles:{height:70,"vertical-align":"middle",display:"table-cell"},text:this.model.get("title")}),this.container.addEvent("click",this.model.get("action")),this}})}),define("DS/PlatformManagement/Controls/Input/Text",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/UIKIT/Tooltip"],function(e,t,n,i){"use strict";var o=["Shift","Control","Alt","AltGraph","ArrowRight","ArrowDown","ArrowLeft","ArrowUp","NumLock","Insert","Home","PageUp","Delete","End","CapsLock","Shift","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Escape","Meta","ContextMenu"," "];return t.extend({defaultOptions:{},init:function(t){var n,o;this.open=t.open||!1,this.minChar=t.minChar||3,this.isCollapsable=!1,t.attributes.value||(t.attributes.value=""),""===t.attributes.value&&(this.isCollapsable=t.isCollapsable||!1),this._parent(t),this.elements.container=this.buildContainer(),n=this.elements.container.getElement(".fonticon-search"),o=this.elements.container.getElement(".fonticon-cancel-squared"),this.tooltip=new i({position:"top",target:n,body:e.i18n("Search")}),this.tooltip=new i({position:"top",target:o,body:e.i18n("Clear")})},openInput:function(){this.isCollapsable&&(this.elements.input.elements.input.removeClassName("hidden"),this.elements.container.addClassName("input-search-open")),this.open=!0,this.elements.input.elements.input.focus(),this.options.attributes&&this.options.attributes.placeholder&&this.elements.input.elements.input.setAttribute("placeholder",this.options.attributes.placeholder)},updateInputClosedAttribute:function(){this.elements.input.elements.input.addClassName("hidden"),this.elements.input.elements.input.setAttribute("placeholder","")},_isAllowedKey:function(e){return-1===o.indexOf(e)},buildContainer:function(){var t=this,i=0;return t.keyUp=e.clone(t.options.attributes.events.keyup),t.options.attributes.events.keyup=function(e){var n=t.elements.input.getValue().length;(n>=t.minChar||0===n)&&t._isAllowedKey(e.key)&&(clearTimeout(i),i=setTimeout(function(){t.keyUp.call(t.elements.input.getContent())},600),t.getContent().getElement(".fonticon-cancel-squared").toggleClassName("hidden",0===n))},this.elements.input=new n(this.options),this.isCollapsable&&(this.elements.input.elements.input.addEvent("click",function(){t.open||t.openInput()}),this.updateInputClosedAttribute()),e.createElement("div",{class:"input-search-center",html:{class:"input-search-wrapper",html:[{tag:"i",class:"fonticon fonticon-cancel-squared pointer"+(""===this.options.attributes.value?" hidden":""),events:{click:function(){t.elements.input.setValue(""),t.elements.input.focus(),t.getContent().getElement(".fonticon-cancel-squared").addClassName("hidden"),t.keyUp.call(t.elements.input.getContent())}}},{tag:"i",class:"fonticon fonticon-search pointer",events:{click:function(e){var n=t.elements.input.getValue().length;e.preventDefault(),e.stopPropagation(),t.open?n>=t.minChar&&t.keyUp.call(t.elements.input.getContent()):t.openInput(),t.options.attributes&&t.options.attributes.events&&t.options.attributes.events.clickSearch&&t.options.attributes.events.clickSearch()}}},this.elements.input]}})}})}),define("DS/PlatformManagement/Utils/SpriteManager",["UWA/Core","UWA/Class"],function(e,t){"use strict";return t.extend({spriteParams:[],spriteCache:[],url:null,init:function(e){this.swymUrl=e.url,this.spriteParams=[],this.spriteCache=[]},addItem:function(e){this.spriteParams.push(e)},addCache:function(e){this.spriteCache.push(e)},spritifyElement:function(e,t){var n=100*this.spriteParams.length,i=100/(this.spriteParams.length-1)*t;e.setStyles({"background-image":'url("'+this.getUrl()+'")',"background-size":"100% "+n+"%","background-position":"0px "+i+"%",height:"100%"})},getUrl:function(){return this.url||(this.url=e.String.format("{0}/api/media/streammediasprite/idList/{1}?{2}",this.swymUrl,this.spriteParams.join("="),this.spriteCache.join(""))),this.url}})}),define("DS/PlatformManagement/Views/HelperText",["UWA/Core","UWA/Class/View"],function(e,t){"use strict";return t.extend({buildContentOnce:function(){return this.elements.content||(this.elements.content=e.createElement("span",{class:"help-text-form"}),this.container.setContent(this.elements.content)),this.elements.content},render:function(e){return this.buildContentOnce().setText(e),this},renderHtml:function(e){return this.buildContentOnce().setHTML(e),this}})}),define("DS/PlatformManagement/Model/UsersBusinessExperienceModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t){"use strict";return t.extend({})}),define("DS/PlatformManagement/Views/CreditAndTokenView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(e,t){"use strict";return t.extend({tagName:"div",name:"platform-management",extendedEvents:!1,render:function(){var e=this.model;return this._parent(),this.container.setAttribute("data-id",e.get("id")),this.container.setAttribute("data-percent",e.getPercent()),this.container.setAttribute("data-type","credits-tokens"),this.container.setAttribute("data-free",e.get("free")),e.isSelfExp()&&this.container.setAttribute("data-trial",""),this.container.addClassName("process grid"),this.container.getElement(".tile-subtitle")&&""===this.container.getElement(".tile-subtitle").getText()&&this.container.getElement(".tile-subtitle").addClassName("hidden"),this},destroy:function(){return this.container&&this.container.getElement(".tile-sub-container")&&this.container.getElement(".tile-sub-container").removeEvent("click"),this._parent()},_isActionElement:function(e){return e.getParent(".actions-inline-container")||e.hasClassName("actions-inline-container")}})}),define("DS/PlatformManagement/Model/InvitationModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t){"use strict";return t.extend({url:"platform/invitation"})}),define("DS/PlatformManagement/UsageTracker",["UWA/Core","DS/Usage/TrackerAPI"],function(e,t){"use strict";return{inc:function(e,t,n,i){},createCustomApp:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"createCustomApp",persDim:{pd1:e.tenant||""}})},createCustomRole:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"createCustomRole",persDim:{pd1:e.tenant||""}})},grantWithGroup:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"grantWithGroup",persDim:{pd1:e.tenant||"",pd2:e.roleId||"",pd3:e.roleName||""}})},unGrantWithGroup:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"unGrantWithGroup",persDim:{pd1:e.tenant||"",pd2:e.roleId||"",pd3:e.roleName||""}})},openMemberDetail:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"openMemberDetail",persDim:{pd1:e.tenant||""}})},openRoleDetail:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"openRoleDetail",persDim:{pd1:e.tenant||"",pd2:e.roleId||"",pd3:e.roleName||""}})},dragAndDropUserToRole:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"dragAndDropUserToRole",persDim:{pd1:e.tenant||"",pd2:e.roleId||"",pd3:e.roleName||""}})},dragAndDropRoleToUser:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"dragAndDropRoleToUser",persDim:{pd1:e.tenant||"",pd2:e.roleId||"",pd3:e.roleName||""}})},multipleGrantWithPlusButton:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"multipleGrantWithPlusButton",persDim:{pd1:e.tenant||"",pd2:e.roleId||"",pd3:e.roleName||""}})},removeGrantedRoleWithPlusButton:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"removeGrantedRoleWithPlusButton",persDim:{pd1:e.tenant||""}})},removeUserWithPlusButton:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"removeMemberWithPlusButton",persDim:{pd1:e.tenant||""}})},inviteMember:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"inviteMember",persDim:{pd1:e.tenant||""}})},activeCrossCompany:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"activeCrossCompany",persDim:{pd1:e.tenant||""}})},desableCrossCompany:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"desableCrossCompany",persDim:{pd1:e.tenant||""}})},openBatchInviteMember:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"openBatchInviteMember",persDim:{pd1:e.tenant||""}})},exportMembers:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"exportMembers",persDim:{pd1:e.tenant||""}})},exportRoles:function(e){this.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"exportRoles",persDim:{pd1:e.tenant||""}})},switchDisplayView:function(e){this.compassInc({eventCategory:e.appId,eventAction:"switchTabView",persDim:{pd1:e.tenant||"",pd4:e.viewType}})},uploadLegalFile:function(){this.compassInc({eventCategory:"LEGAL",eventAction:"uploadLegalFile"})},uploadTOS:function(){this.compassInc({eventCategory:"LEGAL",eventAction:"uploadTOS"})},uploadCookie:function(){this.compassInc({eventCategory:"LEGAL",eventAction:"uploadCookie"})},UploadPrivacyPolicy:function(){this.compassInc({eventCategory:"LEGAL",eventAction:"uploadPrivacyPolicy"})},trackPageView:function(e){this.compassInc({pageURL:window.location.href,pageTitle:e.pageTitle,appID:e.appId,persDim:{pd1:e.tenant||""}},!0)},compassInc:function(e,n){e||(e={}),e.scope="MembersControlCenter-X3DOPMR_AP",n?t.trackPageView(e):t.trackPageEvent(e)}}}),define("DS/PlatformManagement/Model/ExportRoleModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t){"use strict";return t.extend({url:"export/roles"})}),define("DS/PlatformManagement/Model/NotificationModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t){"use strict";return t.extend({url:"role/request",defaults:{type:null,who:null,what:null,date:null,state:null},canAccept:function(){var e=!0,t=this.get("role"),n=t.prereq,i=n.type;return"and"===i?n.process.forEach(function(t){0===t.free&&(e=!1)}):"or"===i&&(e=!1,n.process.forEach(function(t){t.free>0&&(e=!0)})),0===t.free&&(e=!1),e}})}),define("DS/PlatformManagement/Views/ProcessView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(e,t){"use strict";return t.extend({setup:function(e){this._parent()},tagName:"div",name:"platform-management",extendedEvents:!1,render:function(){var e="",t=this.model;if(this._parent(),0!==this.options.selectedCollection.length)for(var n=0;n<this.options.selectedCollection._models.length;n++){if(this.options.selectedCollection._models[n].get("id")===t.get("id")){this.container.addClassName("selected");break}this.container.hasClassName("selected")&&this.container.removeClassName("selected")}return this.container.setAttribute("data-id",t.get("uid")),this.container.setAttribute("data-percent",t.getPercent()),this.container.setAttribute("data-type","process"),t.isCustom()||this.container.setAttribute("data-casual",t.get("casual")),this.container.setAttribute("data-free",t.get("free")),t.isSelfExp()&&this.container.setAttribute("data-trial",""),this.container.setAttribute("data-cross-company",this.model.canCrossCompany()),(!t.hasFree()&&!t.isCustom()||t.isSelfExp())&&(e=" disabled"),this.container.addClassName("process grid"+e),this.container.getElement(".tile-subtitle")&&""===this.container.getElement(".tile-subtitle").getText()&&this.container.getElement(".tile-subtitle").addClassName("hidden"),this.extendedEvents=this._initExtendedEvents(),this},destroy:function(){return this.container&&this.container.getElement(".tile-sub-container")&&this.container.getElement(".tile-sub-container").removeEvent("click"),this._parent()},_initExtendedEvents:function(){var e=this;return this.container.getElement(".tile-sub-container").addEvent("click",function(t){e._isActionElement(t.target)||e.container.hasClassName("disabled")||(e.isSelected()?(e.unSelect(),e.options.selectedCollection.remove(e.model)):(e.select(),e.options.selectedCollection.add(e.model)),e.options.onSelect&&e.options.onSelect(e.getContent(),e.model))}),!0===e.model.get("cancelButton")&&(e.options.selectedCollection.remove(e.model),e.model.set("cancelButton",!1)),!0},_isActionElement:function(e){return e.getParent(".actions-inline-container")||e.hasClassName("actions-inline-container")},updateIcon:function(){}})}),define("DS/PlatformManagement/Views/BusinessExperienceView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(e,t){"use strict";return t.extend({tagName:"div",name:"platform-management",extendedEvents:!1,render:function(){var e=this.model;return this._parent(),this.container.setAttribute("id",e.get("id")),this.container.setAttribute("data-id",e.get("uuid")),this.container.setAttribute("data-title",e.get("title")),this.container.setAttribute("data-type","business-experience"),this.container.addClassName("process grid be-box"),this.container.getElement(".tile-subtitle")&&""===this.container.getElement(".tile-subtitle").getText()&&this.container.getElement(".tile-subtitle").addClassName("hidden"),this},destroy:function(){return this.container&&this.container.getElement(".tile-sub-container")&&this.container.getElement(".tile-sub-container").removeEvent("click"),this._parent()},_initExtendedEvents:function(){var e=this;return this.container.getElement(".tile-sub-container").addEvent("click",function(t){e._isActionElement(t.target)||e.container.hasClassName("disabled")||(e.isSelected()?e.unSelect():e.select(),e.options.onSelect&&e.options.onSelect(e.getContent()))}),!0},_isActionElement:function(e){return e.getParent(".actions-inline-container")||e.hasClassName("actions-inline-container")}})}),define("DS/PlatformManagement/Views/AppsView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView"],function(e,t){"use strict";return t.extend({tagName:"div",name:"platform-management",extendedEvents:!1,render:function(){var e="";return this._parent(),this.model.get("private")||(e=" tp-apps-public",this.container.setAttribute("data-public","true")),this.model.get("brand")&&(e+=" is-"+this.model.get("brand")),this.container.addClassName("process tp-apps grid"+e),this.container.setAttribute("data-id",this.model.get("uid")),this.container.setAttribute("data-type","process"),this.extendedEvents=this._initExtendedEvents(),this},destroy:function(){return this.container&&this.container.getElement(".tile-sub-container")&&this.container.getElement(".tile-sub-container").removeEvent("click"),this._parent()},_initExtendedEvents:function(){var e=this;return this.container.getElement(".tile-sub-container").addEvent("click",function(t){e._isActionElement(t.target)||e.container.hasClassName("disabled")||!e.model.get("private")||(e.isSelected()?e.unSelect():e.select(),e.options.onSelect&&e.options.onSelect(e.getContent()))}),!0},_isActionElement:function(e){return e.getParent(".actions-inline-container")||e.hasClassName("actions-inline-container")}})}),define("DS/PlatformManagement/Utils/DragManager",["UWA/Core","UWA/Class","UWA/Controls/Drag","UWA/Event"],function(e,t,n,i){"use strict";return t.extend({init:function(e){return this.zonesIdentifier=e.zonesIdentifier,this.tileIdentifier=e.tileIdentifier,this.wrapperSelector=e.wrapperSelector,this.container=e.container,this.scrollView=e.scrollView,this.scroller=e.scrollView.scroller,this.cancelZoneLocationSelector=e.cancelZoneLocationSelector,this.currentContext=null,this.isScrolling=!1,this.drop=e.drop,this.collection=e.collection,this.onSelect=e.onSelect,this._initDrag=e.initDrag,this._parent(e)},getScroller:function(){return this.scrollView.scroller},getZones:function(){return this.container.getElements(this.zonesIdentifier)},getCurrentScrollPosition:function(){return-1*this.scroller.getPosition().y},getYPosition:function(e){return e.startOrigin.y+e.currentDelta.y},getContainerHeight:function(){return this.scroller.getContent().getSize().height},needToScrollTop:function(e){return this.getYPosition(e)<150&&0!==this.getCurrentScrollPosition()},needToScrollBottom:function(e){return this.getYPosition(e)>this.getContainerHeight()-50},buildStack:function(){var t,n,i=0,o=0,s="",a=this.container.getElements(this.tileIdentifier+".selected"),l=a.reduce(function(e,l,r){var c=e;return i+=10,r<=1&&(r!==a.length-1&&1!==r||(s='<span class="badge" style="top:'+(i+7)+'px">'+a.length+"</span>"),t="tbody"===l.getParent().getTagName()?'table class="table"':"div",n="tbody"===l.getParent().getTagName()?"background-color:white;":"",o="tbody"===l.getParent().getTagName()?.8*l.getSize().width:l.getSize().width,c=e+"<"+t+' style="width:'+o+"px;height:"+l.getSize().height+"px;position:absolute;top:"+i+"px;left:"+i+"px;"+n+'">'+l.outerHTML+"</"+t+">"),c},"");return e.createElement("div",{class:"drag-stack",styles:{width:o},html:{html:[l,s]}})},getWrapperSize:function(){return this._getZonesWrapper().getSize().height},_createDropZoneCancel:function(){return this._dropZoneCancel=e.createElement("div",{class:"drop-manager-cancel",events:{mouseenter:function(){this.addClassName("hover")},mouseleave:function(){this.removeClassName("hover")}},html:'<div class="center"><span class="fonticon fonticon-cancel"></span><span class="text">'+e.i18n("Drop here to cancel action")+"</span></div>"}),this._dropZoneCancel},_getZonesWrapper:function(){return this._zoneWrapper||(this._zoneWrapper=this.container.getElement(this.wrapperSelector+" .pm-grid-container")),this._zoneWrapper},initDrag:function(){var e=this;return new n.Move({container:this.scrollView.getContent(),zones:this.getZones(),delegate:this.tileIdentifier+" *",centerHandles:!0,handles:function(t){var n=t.target.getClosest(e.tileIdentifier);return e.currentContext=t,n.hasClassName("selected")||(n.addClassName("selected"),e.onSelect(n,e.collection.get(n.getAttribute("data-id")),!0)&&setTimeout(function(){t.cancel(),t.stop(),t.reset(),e._initDrag()},0),t.refreshCache()),t.options.zones=e.getZones(),n.addClassName("isDragging"),e._wrapperSize=e.getWrapperSize(),e._createDropZoneCancel().inject(e.container.getElement(e.cancelZoneLocationSelector),"before"),e._getZonesWrapper().addClassName("smooth-translate-Y-start"),setTimeout(function(){e._getZonesWrapper().addClassName("smooth-translate-Y"),e.scroller.scrollTo(0,0)},1),e.buildStack().inject(t.root)},stop:function(t){e._dropZoneCancel.destroy(),t.target.getClosest(".selected").removeClassName("isDragging"),t.zone&&t.zone.removeClassName("drag-hover"),t.handles.destroy(),setTimeout(function(){e._getZonesWrapper().removeClassName("smooth-translate-Y")},2),setTimeout(function(){e._getZonesWrapper().removeClassName("smooth-translate-Y-start")},301),e.isScrolling&&(window.clearInterval(e.isScrolling),e.isScrolling=!1)},enter:function(e){e.zone.hasClassName("disabled")||e.zone.addClassName("drag-hover")},leave:function(e){e.zone.removeClassName("drag-hover")},move:function(t){e.currentContext.refreshCache(),i.stop(t),e.needToScrollTop(t)?e.isScrolling||(e.isScrolling=window.setInterval(function(){e.getScroller().scrollTo(0,e.getCurrentScrollPosition()-30)},200)):e.needToScrollBottom(t)?e.isScrolling||(e.isScrolling=window.setInterval(function(){e.getScroller().scrollTo(0,e.getCurrentScrollPosition()+30)},200)):e.isScrolling&&(window.clearInterval(e.isScrolling),e.isScrolling=!1)},drop:function(t){t.zone.hasClassName("disabled")||e.drop(t)}})}})}),define("DS/PlatformManagement/Views/StepView",["UWA/Core","UWA/Class/View"],function(e,t){"use strict";return t.extend({tagName:"div",className:"step",setup:function(){this.listenTo(this.model,{"onChange:active":this._setActive,"onChange:validated":this._setValidated});var e=100/this.model.collection.length+"%";return this.getContent().setStyle("width",e),this.getContent().setStyle("z-index",10),this._parent.apply(this,arguments)},_setValidated:function(){this.getContent().getElement(".nav-item-circle").toggleClassName("validated",!0===this.model.get("validated"))},_setActive:function(){this.getContent().getElement(".nav-item-circle").toggleClassName("active",!0===this.model.get("active"))},render:function(){var t=this.model.get("label"),n=[{tag:"div",class:"step-number",html:[{tag:"div",class:"nav-item-icon-indicator",html:[{tag:"i",class:"fonticon fonticon-expand-down"}]},{tag:"div",class:"nav-item-circle",html:[{tag:"i",class:1===this.model.get("id")?"fonticon fonticon-users":2===this.model.get("id")?"fonticon fonticon-role":3===this.model.get("id")&&"Business Experiences"===this.model.get("label")?"fonticon fonticon-briefcase":3===this.model.get("id")&&"Additional Apps"===this.model.get("label")?"fonticon fonticon-app":4===this.model.get("id")&&"Additional Apps"===this.model.get("label")?"fonticon fonticon-app":""}]},{class:this.options.stepIndex===this.options.index?"step-label blue-label":"step-label",text:e.i18n(t),title:e.i18n(t)}]}];return this.container.setContent(n),this.getContent().getElement(".nav-item-icon-indicator").setStyle("visibility",this.options.stepIndex===this.options.index?"visible":"hidden"),this}})}),define("DS/PlatformManagement/Controls/PlatformNotify",["UWA/Core","DS/UIKIT/Alert"],function(e,t){"use strict";return{message:function(e,n){(!this.notifier||document.body.getElement&&!document.body.getElement(".platform-management-notify"))&&(this.notifier=new t({closable:!0,visible:!0,autoHide:!0,hideDelay:3e3,className:"platform-management-notify"}).inject(document.body,"top")),this.notifier.add({className:n,message:e})},success:function(e){this.message(e,"success")},alert:function(e){this.message(e,"error")},warn:function(e){this.message(e,"warning")},info:function(e){this.message(e,"info")}}}),define("DS/PlatformManagement/Model/ExportModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t){"use strict";return t.extend({url:"export/users"})}),define("DS/PlatformManagement/Model/TagModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t){"use strict";return t.extend({url:"user/tag",parse:function(e){return e},setDisptextAllfilters:function(e){return this._filter.allfilters["ds6w:what"][0].disptext=e,this},setDisptextLocalfilters:function(e){return this._filter.localfilters["ds6w:what"][0].disptext=e,this}})}),define("DS/PlatformManagement/Controls/ButtonFab",["UWA/Core","UWA/Class/View","DS/UIKIT/Tooltip"],function(e,t,n){"use strict";var i=[],o="",s="",a="";return t.extend({tagName:"div",className:"btn-fab hidden",domEvents:{click:"_onClick"},setup:function(t){i=[{id:"remove-people",class:"fonticon fonticon-users-times",title:e.i18n("Remove Users")},{id:"remove-roles",class:"fonticon fonticon-role-times",title:e.i18n("Remove granted roles")}],o=e.i18n("Open"),s=e.i18n("Close"),a=e.i18n("Grant selected business experiences/roles/apps to selected members"),this._parent(t)},render:function(){return this.container.setContent(this.createContent()),this.tooltip=new n({position:"left",target:this.container,body:e.i18n("Grant selected business experiences/roles/apps to selected members")}),this},createContent:function(){return{tag:"i",class:"fonticon fonticon-plus"}},showSingle:function(){this._hideSubMenu(),this._cleanIcon(),this.container.getElement("i").addClassName("fonticon-plus"),this.tooltip.setBody(a),this._show()},showMultiple:function(){this._hideSubMenu(),this._cleanIcon(),this.container.getElement("i").addClassName("fonticon-up-open-mini"),this.tooltip.setBody(o),this._show()},hide:function(){this._hideSubMenu(),this.container.addClassName("hidden")},_show:function(){this.container.removeClassName("hidden")},_onClick:function(){var e=this.container,t=e.getElement("i");t.hasClassName("fonticon-plus")?(this.dispatchEvent("onActionClick",["default"]),e.addClassName("hidden")):t.hasClassName("fonticon-cancel")?(t.removeClassName("fonticon-cancel").addClassName("fonticon-up-open-mini"),this.tooltip.setBody(o),this._hideSubMenu()):(t.removeClassName("fonticon-up-open-mini").addClassName("fonticon-cancel"),this.tooltip.setBody(s),this._subMenus?this._showSubMenu():(this._createSubMenu(),this._showSubMenu()))},_cleanIcon:function(){this.container.getElement("i").removeClassName("fonticon-cancel").removeClassName("fonticon-up-open-mini").removeClassName("fonticon-plus")},_createSubMenu:function(){var t=this;t._subMenus=i.map(function(i,o){var s=e.createElement("div",{class:"btn-fab",styles:{bottom:70*(o+1),opacity:0,transition:"opacity ."+15*(o+1)+"s ease-in-out"},html:{"data-action":i.id,tag:"i",class:i.class},events:{click:function(){t.hide(),t.dispatchEvent("onActionClick",[i.id])}}}).inject(t.options.wrapper);return new n({position:"left",target:s,body:i.title}),s})},_showSubMenu:function(){this._subMenus&&this._subMenus.forEach(function(e){e.removeClassName("hidden"),setTimeout(function(){e.setStyle("opacity",1)},0)})},_hideSubMenu:function(){this._subMenus&&this._subMenus.forEach(function(e){e.addClassName("hidden").setStyle("opacity",0)})}})}),define("DS/PlatformManagement/Model/UserRightModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/CacheManager"],function(e,t,n){"use strict";return t.extend({url:"environment/listroles",sync:function(t,i,o){return this._parent(t,i,e.merge(o,{cacheStrategy:"undefined"==typeof DISABLE_LOCAL_CACHE?n.CACHE_STRATEGY_STATIC:null}))}})}),define("DS/PlatformManagement/Utils/SearchManager",["UWA/Core","UWA/Class","UWA/Utils/InterCom"],function(e,t,n){"use strict";return t.extend({_socket:null,_widgetId:null,init:function(e){this._socket=null,this._widgetId=e.id},register:function(){return e.is(this._socket)||(this._socket=new n.Socket(this._widgetId,{dispatchRetryInterval:0}),this._socket.subscribeServer("SearchComServer"),this._socket.dispatchEvent("RegisterContext",{app_socket_id:this._widgetId,widget_id:this._widgetId,search_delegation:"3ddashboard"})),this},unregister:function(){return this._socket.dispatchEvent("UnregisterContext",{widget_id:this._widgetId}),this._socket.disconnect(),delete this._socket,this}})}),define("DS/PlatformManagement/Views/DiskView",["UWA/Core","UWA/Class/View","DS/UIKIT/Spinner","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/Controls/Gauge","DS/i3DXCompassCore/CacheManager"],function(e,t,n,i,o,s){"use strict";var a=i.extend({url:"disk",parse:function(e){return e&&(e.consumptionFormatted=this._bytesFormat(e.consumption),e.quotaFormatted=this._bytesFormat(e.quota)),e},getPercentage:function(){return this.get("quota")&&0!==this.get("quota")?Math.round(100*this.get("consumption"))/this.get("quota"):0},hasError:function(){return e.is(this.get("code"))&&0!==this.get("code")},isEmpty:function(){return!e.is(this.get("quota"))},_bytesFormat:function(e){var t,n,i,o="",s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];for(i=0;i<=s.length;i++)if(t=Math.pow(1e3,i),n=Math.pow(1e3,i+1),e>=t&&e<n){o+=s[i],t>0&&(e/=t);break}return Math.round(10*e)/10+o}});return t.extend({tagName:"div",className:"disk",isRendered:!1,setup:function(e){this.model=new a,this.platform=e.platform,this.listenTo(this.model,"onChange",this._renderTemplate)},render:function(){return this.isRendered||(this._renderTemplate(),this.isRendered=!0),this.model.fetch({data:{platform:this.platform.get("id")},cacheTTL:s.LONG_LIFE_TIME,onFailure:function(e,t){e.isEmpty()&&(t.code?e.set(t):e.set("code",1))}}),this},_renderTemplate:function(){this.container.setContent([{class:"disk-gauge",html:this._createGauge()},{class:"disk-information",html:this._createInformation()}])},_createGauge:function(){return new o({percent:this.model.getPercentage(),reversed:!0})},_createInformation:function(){return this.model.isEmpty()&&!this.model.hasError()?(new n).show():this.model.hasError()?"":e.String.format(e.i18n("Consumption {0} of {1}"),this.model.get("consumptionFormatted"),this.model.get("quotaFormatted"))}})}),define("DS/PlatformManagement/Views/EmptyView",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Button"],function(e,t,n){"use strict";return t.extend({tagName:"empty-view",className:"noResultBody",render:function(){var e=this.options.buttonConfig,t=this.options.fonticon;t&&-1===t.indexOf("fonticon")&&(t="fonticon-"+t);var i=[{tag:"i",class:"noResult fonticon "+t},{tag:"span",text:this.options.text,class:"noResultSpan"}];return e&&i.push(new n(e)),this.container.setContent(i),this}})}),define("DS/PlatformManagement/Utils",["UWA/Core","DS/i3DXCompassCore/Utils","UWA/Utils","UWA/Widget","DS/WebappsUtils/WebappsUtils"],function(e,t,n,i,o){"use strict";var s,a=null;return e.merge(t,{isLightweight:function(){var e=this.getWidget();return null===a&&(a=e&&e.data&&!0===e.data.lightweight),a},setCurrentPlatform:function(e){s=e},isPlatformCrossCompany:function(){return s&&s.canCrossCompany()},getDocument:function(){return this.isFrame()?this.getWidget().body:document.body},getAsset:function(e){return o.getWebappsAssetUrl("PlatformManagement",e)},addUsedColor:function(e,t){e&&""!==e&&(t<25?e.addClassName("role-used-green fonticon fonticon-progress-3"):t<50?e.addClassName("role-used-yellow fonticon fonticon-progress-2"):t<75?e.addClassName("role-used-orange fonticon fonticon-progress-2"):e.addClassName("role-used-red fonticon fonticon-progress-1"))},isMobileDevice:function(){return!(!navigator.userAgent.match(/Mobile|Windows Phone|Lumia|Android|webOS|iPhone|iPod|Blackberry|PlayBook|BB10|Opera Mini|\bCrMo\/|Opera Mobi/i)&&!navigator.userAgent.match(/Tablet|iPad/i))},isOnlyMobileDevice:function(){return!!navigator.userAgent.match(/Mobile|Windows Phone|Lumia|Android|webOS|iPhone|iPod|Blackberry|PlayBook|BB10|Opera Mini|\bCrMo\/|Opera Mobi/i)},debounce:function(e,t,n){var i,o,s,a,l,r=Date.now||function(){return(new Date).getTime()},c=function(){var m=r()-a;m<t&&m>=0?i=setTimeout(c,t-m):(i=null,n||(l=e.apply(s,o),i||(s=o=null)))};return function(){s=this,o=arguments,a=r();var m=n&&!i;return i||(i=setTimeout(c,t)),m&&(l=e.apply(s,o),s=o=null),l}},now:Date.now||function(){return(new Date).getTime()}})}),define("DS/PlatformManagement/Controls/Loader",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Spinner"],function(e,t,n){"use strict";return t.extend({defaultOptions:{},init:function(e){this._parent(e),this.buildContainer()},buildContainer:function(){this.elements.container=e.createElement("div",{class:"mask loading-mask",html:{class:"mask-wrapper",html:{class:"mask-content",html:new n({visible:!0})}}})}})}),define("DS/PlatformManagement/Collection/PaginatedCollection",["UWA/Core","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/PlatformManagement/Utils"],function(e,t,n){"use strict";return t.extend({options:{data:{query:null,platform:null,sort:null,sort_direction:null,offset:null}},count:0,setParams:function(e){return this.options.data=n.merge(e,this.options.data),this},getParams:function(){return this.options.data},setPlatform:function(e){return this.getParams().platform=e,this},setTenant:function(e){this.getParams().tenant=e},setSortField:function(e){return this.getParams().sort=e,this},setSortFieldLog:function(e){return this.getParams().sort_log=e,this},setDisptextAllfilters:function(e){return this._filter.allfilters["ds6w:what"][0].disptext=e,this},setDisptextLocalfilters:function(e){return this._filter.localfilters["ds6w:what"][0].disptext=e,this},setTarget:function(e){return this.getParams().target=e,this},setQuery:function(e){return this.getParams().query=e,this},getOffset:function(){return this.getParams().offset||0},setOffset:function(e){return this.getParams().offset=e,this},setLimit:function(e){return this.getParams().limit=e,this},getQuery:function(){return this.getParams().query},isQueryEmpty:function(){return null===this.getQuery()||""===this.getQuery()},setMaxLimit:function(e){return this.count=e,this},setBEMaxLimit:function(e){return this.total=e,this},setSortDirection:function(e){return this.getParams().sort_direction=e,this},setSortDirectionLog:function(e){return this.getParams().sort_direction_log=e,this},getLimit:function(){return this.getParams().limit||this.size()},getMaxLimit:function(){return this.count},getPreviousOffset:function(){var e=this.getOffset();return this.hasPrevious()&&(e=parseInt(this.getOffset(),10)-parseInt(this.getLimit(),10)),e},getNextOffset:function(){var e=this.getOffset();return this.hasNext()&&(e=parseInt(this.getOffset(),10)+parseInt(this.getLimit(),10)),e},hasNext:function(){return this.getOffset()+this.getLimit()<this.getMaxLimit()},hasPrevious:function(){return this.getOffset()-this.getLimit()>0},hasPagination:function(){return this.getMaxLimit()>this.getLimit()},setCategory:function(e){return this.getParams().category=e,this},setDate:function(e){return this.getParams().date=e,this}})}),define("DS/PlatformManagement/Model/ProcessModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompass/ServiceApi/PortfolioApi","DS/PlatformManagement/Utils","DS/WebappsUtils/WebappsUtils","DS/i3DXCompassCore/Controls/Gauge"],function(e,t,n,i,o,s,a){"use strict";return t.extend({idAttribute:"uid",url:"role",defaults:{processesMaxPerPage:10},updateModel:function(e){e.brand;this.set("brand",e.brand)},hasFree:function(e){return void 0===e&&(e=0),!1===this.get("withLicenses")||this.canCrossCompany()||this.isTPA()||this.isCustom()||0!==this.get("free")&&this.get("free")>=e},isWUWithouLicenseFree:function(){return 0===this.get("free")&&this.isWU()&&this.canCrossCompany()},isOption:function(){return this.get("option")},isCasual:function(){return this.get("casual")>0},isTPA:function(){return e.is(this.get("type"))&&"WA"!==this.get("type")&&"WU"!==this.get("type")},isSelfExp:function(){return!0===this.get("selfexp")},getPercent:function(){var e=100*(this.get("total")-this.get("free"))/this.get("total");return Math.min(e,100)},getType:function(){return this.isTPA()?"apps":this.get("version")?"businessExperiences":"license"},getDisplayType:function(){return this.isTPA()?this.escape("type"):null},isDisabled:function(e,t){var n=!1;return this.isSelfExp()?n=!this.get("granted")||!(!0===this.get("remove")&&""===this.get("expire")):e?n=this.get("granted")?!1===this.get("remove"):!!this.get("withLicenses")||!1===this.get("remove")&&!this.get("withLicenses"):this.isCustom()?n=!1:this.isTPA()?n=!1===this.get("private"):!1===this.get("granted")&&this.get("version")?n=!1:(n=!1===this.get("granted")&&!this.hasFree()||!0===this.get("granted")&&!1===this.get("remove")||!1===this.get("remove")&&!this.get("withLicenses"))||!t||this.hasFree(t)||(n=!0),n},getCasual:function(){return this.isCustom()?null:this.get("casual")},isCustom:function(){var t=e.is(this.get("custom"))?this.get("custom"):this.get("icon");return!this.isTPA()&&t},getIcon:function(){if(this.isTPA())return this.get("icon")||o.getAsset("3DExpPlatform_Default.png");if(this.isCustom()||0===this.get("total"))return this.get("icon")||s.getWebappsAssetUrl("i3DXCompass",e.String.format("v3.1/images/role/DEFAULT_CUSTOM_Role.svg"));if(this.isSelfExp())return o.getAsset("selfexp-logo.png");var t=this.get("brand");return t&&""!==t?s.getWebappsAssetUrl("i3DXCompass",e.String.format("v3.1/images/role/{0}_Role.svg",t)):s.getWebappsAssetUrl("i3DXCompass",e.String.format("v3.1/images/role/{0}_Role.svg","PLATFORM"))},getTileContent:function(t,n){var i,s="";return this.isSelfExp()?s+='<div> <span class= "'+i.className+'"> </span><span class="nowrap title"> '+e.String.format(e.i18n("Used: {0}"),this.get("used"))+"</span></div>":(this.collection.url.indexOf("credits")>-1||!this.isCustom()&&!0===n)&&(i=this.get("total")?e.createElement("span",{class:""}):"",o.addUsedColor(i,100*(this.get("total")-this.get("free"))/this.get("total")),i.addClassName("tile"),this.isToken()?s+='<div class="tile-content-used"> <span class= "'+i.className+'"> </span><span class="nowrap title"> '+e.String.format(e.i18n("Remaining: {0}"),this.get("free"))+" </span> </div>":(this.isCredit(),s+='<div class="tile-content-used"> <span class= "'+i.className+'"> </span><span class="nowrap title"> '+e.String.format(e.i18n("Used: {0}/{1}"),this.get("total")-this.get("free"),this.get("total"))+" </span> </div>"),s+='<div class="tile-content-expire"><span class = "fonticon fonticon-calendar-clock"></span> <span class="nowrap title">'+e.String.format(e.i18n("Expiring on: {0}"),this.get("expire"))+"</span></div>"),s},canCrossCompany:function(){return!0===this.get("crossCompany")&&o.isPlatformCrossCompany()},isWA:function(){return"WA"===this.get("type")},isWU:function(){return"WU"===this.get("type")},isCredit:function(){return"credit"===this.get("type")},isToken:function(){return"token"===this.get("type")},_hasPrereq:function(){return this.get("prereq")&&this.get("prereq").process&&this.get("prereq").process.length>0},isAssignDisabled:function(e,t){var n=!1;return!1===e&&(n=0===this.get("free")),void 0!==t&&(n=this.get("free")<t),this.get("licensedDisabled")||n},isAssignSelected:function(){}})}),define("DS/PlatformManagement/Utils/Data",["UWA/Core","DS/PlatformAPI/PlatformAPI","DS/WebappsUtils/WebappsUtils","DS/i3DXCompassCore/Utils/Ajax","DS/PlatformManagement/Utils"],function(e,t,n,i){"use strict";var o={proxy:{baseUrl:"",baseUrlBackend:"{0}/resources/AppsMngt/",getpreferences:"{0}user/getPreferences",setpreferences:"{0}user/setPreferences",licensesUser:"{0}licenses/user/",businessExperienceUser:"{0}api/v1/business-experience/authorization",baseUrlBe:"",pathUrlBe:"/enovia/resources/BusinessExperienceAccess/admin/v1/model/BusinessExperienceDefinition/",groupRole:"{0}group/role/",removeAllRoles:"{0}/licenses/allroles",faillurePage:"{0}uploadfile/message?error=true",faillurePageImport:"{0}massivesynchro/upload/result?success=false",eServiceError:"{0}/enovia/eServiceError.jsp",removefile:"{0}environment/removefile",platformInvite:"{0}platform/invite",userSupportMode:"{0}user/supportmode",massiveSynchroStart:"{0}massivesynchro/start",massiveSynchroFile:"{0}massivesynchro/file"},formatUrl:function(e){return""===o.proxy.baseUrl&&(o.proxy.baseUrl=t.getApplicationConfiguration("app.urls.myapps"),o.proxy.baseUrl||(t.getAllApplicationConfigurations(!0),o.proxy.baseUrl=t.getApplicationConfiguration("app.urls.myapps")),o.proxy.baseUrlBackend=o.proxy.baseUrlBackend.format(o.proxy.baseUrl)),e.format(o.proxy.baseUrlBackend)}};return{get:function(e){return o.proxy[e]?o.formatUrl(o.proxy[e]):""},getUrl:function(e){return o.proxy[e]?o.formatUrl(o.proxy[e]):""},createLicensesUser:function(e,t){return new i({url:o.formatUrl(o.proxy.licensesUser),params:e,callbacks:t}).create()},updateLicensesUser:function(e,t){return new i({url:o.formatUrl(o.proxy.licensesUser),params:e,callbacks:t}).update()},deleteLicensesUser:function(e){return new i({url:o.formatUrl(o.proxy.licensesUser),params:e.params||{},callbacks:e.callbacks||{}}).doDelete()},removeAllRoles:function(e){return new i({url:o.formatUrl(o.proxy.removeAllRoles),params:e.data||{},callbacks:e.callbacks||{}}).doDelete()},createBusinessExperienceUser:function(e,t){return new i({url:e.url+"/"+e.beId+"/users",params:e,callbacks:t}).create()},createBusinessExperienceUsertoCompass:function(e,t){return new i({url:o.formatUrl(o.proxy.businessExperienceUser),params:e,callbacks:t}).create()},deleteBusinessExperienceUser:function(e){return new i({url:e.params.url+"/"+e.params.beId+"/users/"+e.params.userId,params:e.params||{},callbacks:e.callbacks||{}}).doDelete()},deleteBusinessExperienceUsertoCompass:function(e){return new i({url:o.formatUrl(o.proxy.businessExperienceUser),params:e.params||{},callbacks:e.callbacks||{}}).doDelete()},removeFile:function(e,t){return new i({url:o.formatUrl(o.proxy.removefile),params:e,callbacks:t}).get()},getPreferences:function(t,n){return t=e.merge({responseType:"text"},t),new i({url:o.formatUrl(o.proxy.getpreferences),params:t,callbacks:n}).get()},setSupportMode:function(e){return new i({url:o.formatUrl(o.proxy.userSupportMode),params:e.params,callbacks:e.callbacks}).create()},platformInvite:function(e,t){return new i({url:o.formatUrl(o.proxy.platformInvite),params:e,callbacks:t}).create()},startImport:function(e){return new i({url:o.formatUrl(o.proxy.massiveSynchroStart),params:e.params||{},callbacks:e.callbacks||{}}).post()},getImportFile:function(e){return new i({url:o.formatUrl(o.proxy.massiveSynchroFile),params:e.params||{},callbacks:e.callbacks||{}}).get()},createLicensesGroup:function(e,t){return new i({url:o.formatUrl(o.proxy.groupRole),params:e,callbacks:t}).create()},updateLicensesGroup:function(e,t){return new i({url:o.formatUrl(o.proxy.groupRole),params:e,callbacks:t}).update()},deleteLicensesGroup:function(e){return new i({url:o.formatUrl(o.proxy.groupRole),params:e.params||{},callbacks:e.callbacks||{}}).doDelete()}}}),define("DS/PlatformManagement/Model/PreferencesModel",["UWA/Core","UWA/Class/Model","UWA/Utils","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Utils","DS/i3DXCompassCore/CacheManager"],function(e,t,n,i,o,s,a){"use strict";return new(t.extend({backendModel:new t,defaults:{membersMaxPerPage:"25",membersSortField:"Last Name",membersSortDirection:"asc",membersDisplayPicture:"true",processesMaxPerPage:"25",processesSortDirection:"asc",advancedMode:!1,displayMode:"grid",selectedTab:"0",logsMaxPerPage:"25",logsSort:"date",logsSortDirection:"desc"},getWidgetKey:function(){return"displayMode-"+s.getWidget().id+(s.isLightweight()?"light":"")},getWidgetSelectTabKey:function(){return"selectedTab-"+s.getWidget().id+(s.isLightweight()?"light":"")},isGridLayout:function(){return this._displayMode||(this._displayMode=a.getCache(this.getWidgetKey(),0)||this.get("displayMode")),"grid"===this._displayMode},selectedTabByUser:function(){return this._selectedTab=a.getCache(this.getWidgetSelectTabKey(),0)||this.get("selectedTab"),this._selectedTab},shouldLoadPicture:function(){return!0===this.get("membersDisplayPicture")||"true"===this.get("membersDisplayPicture")},setLayout:function(e){this._displayMode=e,a.setCache(this.getWidgetKey(),e),s.getWidget().setValue("displayMode",e)},storeTab:function(e){a.setCache(this.getWidgetSelectTabKey(),e),s.getWidget().setValue("selectedTab",e)},isFetched:!1,setup:function(){return this.createUid(),this},createUid:function(){return this.id=a._getKeyUID("pm-preferences"),this.id},sync:function(e,t,n){switch(e){case"read":this.isFetched||this.fetchLocal()?(this.isFetched=!0,n.onComplete.call(this)):this.fetchRemote(n.onComplete)}},fetchLocal:function(){var t,n=!1;try{(t=sessionStorage.getItem(this.id))&&(this.set(JSON.parse(t)),n=!0)}catch(t){e.log(t)}return n},fetchRemote:function(e){var t=this;o.getPreferences({name:"pm-preferences"},{onComplete:function(i){var o;""!==i&&(o=JSON.parse(n.base64Decode(i.replace("_","="))))&&(t.set(o),this.isFetched=!1),t.saveLocal(),e.call(t)}})},saveLocal:function(){var t=!1;try{sessionStorage.setItem(this.id,JSON.stringify(this.toJSON())),t=!0}catch(t){e.log(t)}return t},clear:function(){var t=this._parent();try{sessionStorage.removeItem(this.id)}catch(t){e.log(t)}return this.isFetched=!1,this.set(this.defaults),t}}))}),define("DS/PlatformManagement/Views/NoSearchResultView",["UWA/Core","DS/PlatformManagement/Views/EmptyView"],function(e,t){"use strict";return t.extend({setup:function(t){return t||(t={}),this.options.fonticon="search",this.options.text=e.i18n("No result found"),this._parent(t)}})}),define("DS/PlatformManagement/Collection/ProcessCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,n,i){"use strict";return t.extend({url:"role",model:n,parse:function(e){return this.setMaxLimit(e.count),this.updateIcon(e.data||e.roles),e.data||e.roles},toJSONString:function(t){var n=[];return this.forEach(function(i){var o={id:i.get("uid")};e.is(i.get("licensed"))&&(o.licensed=i.get("licensed")),!1===t&&(o.licensed=!1,!1===i.get("licensed")&&(o.restricted=!0)),n.push(o)}),JSON.stringify(n)},updateIcon:function(e){var t=this;e.forEach(function(e){i.getPortfolioRole(e.id,function(n){if(void 0!==n){var i=t.find(function(t){return t._attributes.id===e.id});i?i.set("brand",n.brand):e.brand=n.brand}})})}})}),define("DS/PlatformManagement/Model/MemberDetailsModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,t,n,i,o){"use strict";return t.extend({url:"user",idAttribute:"id",defaults:{user:"",firstname:"",lastname:"",email:"",platform:"",platformName:"",role:"",agreement:"",active:null,supportMode:null,legal:null,processes:null,apps:null,remove:!0,deny:!1},setup:function(e,t){return this.get("email")&&this.set("email",this.get("email").toLowerCase()),this._parent(e,t)},getUserFullName:function(t){var n=this.escape("firstname")?e.String.ucfirst(this.escape("firstname")):"",i=this.escape("lastname")?e.String.ucfirst(this.escape("lastname")):"",o="";return""===n&&(n=this.escape("firstName")?e.String.ucfirst(this.escape("firstName")):""),""===i&&(i=this.escape("lastName")?e.String.ucfirst(this.escape("lastName")):""),""!==n.trim()&&""!==i.trim()?o=n.trim()+" "+i.trim():this.escape("email")&&""!==this.escape("email").trim()?o=this.escape("email").trim():this.escape("id")&&""!==this.escape("id").trim()&&(o=this.escape("id").trim()),t&&this.get("login")&&this.escape("login").length&&this.get("active")?o=o+" - "+this.escape("login").toUpperCase():t&&this.escape("id").length&&this.get("active")&&(o=o+" - "+this.escape("id").toUpperCase()),o},getCityFullName:function(){return e.String.capitalize(this.get("city")?this.get("city").toLowerCase():"")},getCountryFullName:function(){return this.get("country")||""},getCityAndCountryFullName:function(){var t=this.getCityFullName(),n=this.getCountryFullName();return t&&n?e.String.format(e.i18n("{0}, {1}"),t,n):n||t},getUserId:function(){return this.get("id")||this.get("id")||this.get("email").toLowerCase()},getUserUid:function(){return this.get("uid")||this.getUserId()},getUser2FactorAuthentication:function(){return!0===this.get("passport2Factor")?'<span class="green">'+e.i18n("Active")+"</span>":!1===this.get("passport2Factor")?'<span class="orange">'+e.i18n("Not Active")+"</span>":void 0},getUserLastConnection:function(){return"<span>"+this.get("lastConnexion")+"</span>"},getProfile:function(t,o){var s;return t&&""!==o&&e.is(o)?s=e.String.format("{0}/api/media/streammediasprite/idList/{1}?{2}",o,this.getSpriteItem(),this.get("cacheBuster")?""+this.get("cacheBuster"):this.get("agreement")):(s=i.isCheckedAgreement(this.get("agreement"))?"default-profile-contractor.png":"default-profile.png",s=n.getWebappsAssetUrl("PlatformManagement","")+s),s},getSpriteItem:function(){return(""===this.get("firstname")?this.get("email"):this.get("id"))+":7:6"},isDeny:function(){return"2"===this.get("role")},isContractor:function(){return i.isCheckedAgreement(this.get("agreement"))},isCasual:function(){return this.get("casual")>0},isRoleOnly:function(){return this.get("granted")&&!this.get("licensed")},removeLicense:function(t,n,i){o.deleteLicensesUser(e.merge({params:{user:this.get("id"),userUid:this.getUserUid(),licenses:n.canCrossCompany()?JSON.stringify([{id:t.get("uid"),licensed:t.get("licensed"),restricted:t.get("restricted")}]):JSON.stringify([{id:t.get("uid")}]),type:t.getType(),platform:n.getId()}},{callbacks:i}))},addLicense:function(e,t,n,i){o.createLicensesUser({user:this.get("id"),userUid:this.getUserUid(),licenses:JSON.stringify(e),type:t,platform:n.getId()},i)},updateLicense:function(e,t,n,i){o.updateLicensesUser({user:this.get("id"),userUid:this.getUserUid(),licenses:JSON.stringify(e),type:t,platform:n.getId()},i)},addBusinessExperience:function(e,t,n){o.createBusinessExperienceUser({users:this.get("id"),businessExperiences:e,platform:t.getId()},n)},removeBusinessExperience:function(t,n,i){o.deleteBusinessExperienceUser(e.merge({params:{users:this.get("id"),businessExperiences:t.get("uuid"),platform:n.getId()}},{callbacks:i}))}})}),define("DS/PlatformManagement/Modal/FullScreenModal",["UWA/Core","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/PlatformManagement/Utils","DS/UIKIT/Scroller","UWA/Class/View"],function(e,t,n,i,o,s){"use strict";var a=function(t){return e.is(t,"string")&&!/<[\s\S]*>/i.test(t)};return t.extend({init:function(t){return t.className=e.String.format(i.getPlatformManagementWrapperClassName("modal-scrollable big-modal {0}"),t.className||""),a(t.header)&&(t.header=e.String.format("<h4>{0}</h4>",t.header)),this._parent(t)},setHeader:function(t){return a(t)&&(t=e.String.format("<h4>{0}</h4>",t)),this._parent(t)},setBody:function(t){return t instanceof s&&(t=t.getContent()),this._parent(new o({element:e.createElement("div",{class:"scrollable-body",styles:{height:"100%"},html:t})}))},_isMasked:function(){return this.masked},mask:function(){this._isMasked()||(n.mask(this.getBody()),this.masked=!0)},unmask:function(){this._isMasked()&&n.unmask(this.getBody()),this.masked=null}})}),define("DS/PlatformManagement/Views/HeaderList",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Controls/Input/Text","DS/UIKIT/Iconbar"],function(e,t,n,i){"use strict";return t.extend({tagName:"pm-header-list",setup:function(e){return this._parent(e),e.collection&&this.listenTo(e.collection,{onSync:this._onCollectionUpdate.bind(this)}),this},render:function(){return this.container.setContent(this._buildContent()),this},_getFontIconElement:function(e){return this.container.getElement("#"+e+" .fonticon")},_getIconElement:function(e){return this.container.getElement("#"+e)},removeFontIcon:function(e,t){var n=this._getFontIconElement(e);return n&&n.removeClassName(t),this},addFontIcon:function(e,t){var n=this._getFontIconElement(e);return n&&n.addClassName(t),this},updateIconTooltip:function(e,t){return this.iconBar.getItem(e).tooltip.elements.body.setText(t),this},toggleFontIcon:function(e,t){var n=this._getFontIconElement(e);return n&&n.toggleClassName(t),this},activateIcon:function(e){var t=this._getIconElement(e);return t&&t.addClassName("item-active"),this},deactivateIcon:function(e){var t=this._getIconElement(e);return t&&t.removeClassName("item-active"),this},_buildContent:function(){return[this.options.searchLog?{}:this._buildLabel(),this._buildSearchAndIcons()]},_buildLabel:function(){var t=this.options;return this.elements.label=e.createElement("h5",{tag:"h5",text:e.String.format(t.label,t.count?t.count:this.collection.getMaxLimit())}),{class:"label-wrapper",html:[{tag:"i",class:"fonticon fonticon-"+t.icon},this.elements.label]}},_buildSearchAndIcons:function(){var e=[];return this.options.searchLabel&&e.push(this._buildSearch()),!0===this.options.isSearchOpen&&e[0].elements.container.addClassName("input-search-open"),this.options.iconBarConfig&&e.push(this._buildIcons()),{class:"search-icons-wrapper",html:e}},_buildSearch:function(){var e=this,t=e.container;return new n({isCollapsable:!0,minChar:2,attributes:{placeholder:this.options.searchLabel,value:this.collection.getQuery()||"",events:{keyup:function(){e.dispatchEvent("search",[this.value.trim()]),t.getElement(".fonticon-search").addClassName("activate")},clickSearch:function(){t.getElement(".input-search-center").addClassName("search-member-mobile"),!0===e.options.searchLog&&sessionStorage.setItem("logRefresh","false")}}}})},_buildIcons:function(){return this.iconBar=new i(this.options.iconBarConfig),this.iconBar},_onCollectionUpdate:function(){this.elements.label&&this.elements.label.setText(e.String.format(this.options.label,this.collection.getMaxLimit()))}})}),define("DS/PlatformManagement/Modal/PrereqError",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/ProcessModel","DS/UIKIT/Input/Button","DS/PlatformManagement/Utils"],function(e,t,n,i,o,s,a){"use strict";return t.extend({defaultOptions:{prereq:[],onCancel:function(){},onRemovedRequired:function(){}},needed:!1,disableOKButton:!1,clickOkPressed:!1,requiredByOption:0,requiredByAnd:0,init:function(t){var i=this;i._parent(t),this.modal=new n({closable:!0,className:a.getPlatformManagementWrapperClassName(""),header:"",body:"",footer:"",events:{onHide:function(){i.options.onCancel(i.asRemovedRequired),this.destroy(),a.manageSupportOfMultiModal()}}}),this.elements.container=this.modal;var o=!1;i.options.model.isTPA()||(i.options.selectedCollection.forEach(function(t){i.requiredByOption=0;var n=!1;t.get("prereq")&&(t.get("prereq")&&!t.get("prereq").empty&&"and"===t.get("prereq").type?t.get("prereq").process.forEach(function(e){i.options.model.get("uid")===e.uid&&(i.options.prereq.push(t),i.requiredByAnd++)}):t.get("prereq")&&!t.get("prereq").empty&&"or"===t.get("prereq").type&&(t.get("prereq").process.forEach(function(e){i.options.model.get("uid")===e.uid&&(n=!0)}),t.get("prereq").process.forEach(function(t){n&&(i.options.selectedCollection.get(t.uid)?(i.requiredByOption++,e.log("--- "+t.uid+": granted")):e.log("--- "+t.uid+": no granted"))}),i.requiredByOption<=1&&n&&(o=!0,t.get("prereq").process.forEach(function(n){i.options.model.get("uid")===n.uid&&(e.log("-OR "+t.get("uid")),i.options.prereq.push(t))}))))}),i.options.prereq.length>0&&(o||i.requiredByAnd>0)&&(i.needed=!0))},_findRequiredRoles:function(e,t,n){if(n.push(e.get("uid")),e._hasPrereq())for(var i=e.get("prereq").process,s=0;s<i.length;s++){var a=new o(i[s]);if(a.get("uid")===t)return a;var l=this._findRequiredRoles(a,t,n);if(l)return l}return!1},_removeRequired:function(){var e=this,t=this.options.selectedCollection,n=this.options.model.get("uid"),i=[];return t.forEach(function(t){var o=[];e._findRequiredRoles(t,n,o)&&o.forEach(function(e){i.push(e)})}),i.push(n),t.remove(i),i},isNeeded:function(){return this.needed},show:function(){this.modal.setHeader(this.getTitle()),this.modal.setBody(this.getContent()),this.modal.setFooter(this.getButtons()),this.modal.inject(document.body).show()},getTitle:function(){return"<h4>"+(this.options.model.get("option")?e.i18n("This option is required by"):e.i18n("This role is required by"))+"</h4>"},getContent:function(){var t=this,n=[];return this.options.prereq.forEach(function(e){n.push(t.getContentItem(e))}),[e.createElement("table",{class:"table",html:n}),{class:"text-error text-right",text:e.i18n("You need to remove required roles first")}]},getContentItem:function(e){return{tag:"tr",html:[{tag:"td",html:new i({className:"primary",type:"checkbox",name:"prereq-licenses[]",value:e.get("uid"),label:e.get("name"),checked:!1,disabled:!0})}]}},getButtons:function(){var t=this,n=[];return this.options.removeRequired&&n.push(new s({value:e.i18n("Remove required roles"),className:"default",events:{onClick:function(){t.asRemovedRequired=!0,t.options.onRemovedRequired(t._removeRequired()),t.destroy()}}})),n.push(new s({value:e.i18n("Cancel"),className:"default",events:{onClick:function(){t.modal.hide()}}})),n}})}),define("DS/PlatformManagement/Collection/MemberCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/MemberDetailsModel"],function(e,t,n){"use strict";return t.extend({url:"user",model:n,sync:function(e,t,n){return this._parent(e,t,n)},parse:function(e){return this.setMaxLimit(e.count),e.tag&&this.setTags(e.tag),e.data||e.users},setTags:function(e){this.tags=e},getTags:function(){return this.tags}})}),define("DS/PlatformManagement/Model/PlatformModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils"],function(e,t,n){"use strict";return t.extend({url:"platform",getId:function(){return this.get("id")},canCrossCompany:function(){return this.get("crossCompany")},canCrossCompanyExtended:function(){return this.get("crossCompanyExtended")},getCrossCompanyRoles:function(){return this.get("crossCompanyRoles")||[]},isOnPremise:function(){var e=this.get("isOnPremise");return void 0===e&&this.get("id")&&(e=this.get("id").toLowerCase()==="OnPremise".toLowerCase()),e},hasError:function(){return n.isBetaModeActivated("subscription-error")||this.get("subscriptionError")},isPlatform:function(){return!0===this.get("platform")},isVPC:function(){return!0===this.get("vpc")}})}),define("DS/PlatformManagement/Model/AppModel",["UWA/Core","DS/PlatformManagement/Model/ProcessModel"],function(e,t){"use strict";return t.extend({url:"app/custom"})}),define("DS/PlatformManagement/Collection/AppsCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/AppModel"],function(e,t,n){"use strict";return t.extend({url:"app/custom",model:n,parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Collection/UserRoleCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(e,t,n){"use strict";return t.extend({url:"user/roles",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data||e.roles}})}),define("DS/PlatformManagement/Model/BusinessExperienceModel",["UWA/Core","DS/PlatformManagement/Model/ProcessModel","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,t,n,i,o,s){"use strict";var a;return t.extend({setup:function(e){this._parent(e),a=o.getWidget().widgetDomain&&o.getWidget().widgetDomain.indexOf("?")>-1?o.getWidget().widgetDomain.split("?")[0]:o.getWidget().widgetDomain,this.collection&&!0===this.collection.updateModel&&this.updateModel()},getUserId:function(){return this.get("id")||this.get("id")||this.get("email").toLowerCase()},isDeny:function(){return"2"===this.get("role")},get3DDashboardUrlAssetTemplateUrl:function(t,n,i,o){return a&&""!==a?a+e.String.format("/public/api/business-experiences/{0}/{1}/assets/{2}?platform={3}",t,n,i,o):""},updateModel:function(e){var t=this,n=t.collection.platform.getId(),i=a+"public/api/business-experiences/"+t.get("id")+"/"+t.get("version")+"?platform="+n;t.set("url",i),t.url=i,t.fetch({onComplete:function(e){e.get("valueDescription")&&e.set("descriptionShort",e.get("valueDescription")),e.get("thumbnail")&&e.set("logo",t.get3DDashboardUrlAssetTemplateUrl(e.get("id"),e.get("version"),e.get("thumbnail"),n))}})},getIcon:function(){return this.get("logo")||o.getAsset("thumb_TALENT.jpg")}})}),define("DS/PlatformManagement/Collection/BusinessExperienceCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/i3DXCompassCore/RequestOptions","DS/PlatformManagement/Model/BusinessExperienceModel"],function(e,t,n,i){"use strict";return t.extend({url:"/admin/v1/model/BusinessExperienceDefinition",model:i,parse:function(e,t){return this.setBEMaxLimit(e.total),this._requestOptions&&this._requestOptions.responseHeaders&&(this.csrf=this._requestOptions.responseHeaders["x-ds-csrftoken"]),e.items},getMaxLimit:function(){return this.length}})}),define("DS/PlatformManagement/Model/OldMembersModel",["UWA/Core","DS/PlatformManagement/Model/MemberDetailsModel"],function(e,t){"use strict";return t.extend({url:"user/anonymized",isAnonymised:function(){return!0===this.get("anonymised")}})}),define("DS/PlatformManagement/Model/I18nModel",["DS/i3DXCompassCore/Model/i3DXCompassModel","DS/i3DXCompassCore/CacheManager","DS/PlatformManagement/Utils"],function(e,t,n){"use strict";return e.extend({setup:function(e){this._parent(e,{cache:-1}),this.url=this.formatUrl(UWA.String.format("assets/lang/{0}.json",n.getLang())).replace("resources/AppsMngt","webapps/PlatformManagement")}})}),define("DS/PlatformManagement/Model/ImportModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Collection/PaginatedCollection"],function(e,t,n){"use strict";return t.extend({url:"massivesynchro",_users:null,_status:null,canRetry:function(){return 0!==this.get("status")&&4!==this.get("status")&&3!==this.get("status")},inProgress:function(){return 3===this.get("status")},fileUploadError:function(){return 4===this.get("status")},setup:function(){var e=this;this._parent.apply(this,arguments),this._users=new n([],{url:this.url,data:{offset:0,limit:25}}),this._status=new n,this._users.setMaxLimit(this.get("count")),this.addEvent("onChange:users",function(t,n){e._users.set(n)}),this.addEvent("onChange:count",function(t,n){e._users.setMaxLimit(n)}),this.addEvent("onChange:statuslist",function(t,n){e._status.set(n)})}})}),define("DS/PlatformManagement/Modal/FullScreenIdCardModal",["UWA/Core","DS/PlatformManagement/Modal/FullScreenModal"],function(e,t){"use strict";return t.extend({init:function(e){return e.className||(e.className=""),e.className="modal-id-card "+e.className,this._parent(e)}})}),define("DS/PlatformManagement/Views/LocationView",["UWA/Core","UWA/Class/View","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Select","DS/UIKIT/Form","DS/PlatformManagement/Controls/PlatformNotify"],function(e,t,n,i,o,s,a){"use strict";var l=[];return t.extend({tagName:"div",_className:"location-view",setup:function(e){this.options=e||{};var t=e.platform.get("locations"),n=e.model&&e.model.get("location");if(!e.platform)throw"A platform need to be set";return this.platform=e.platform,t.forEach(function(e){e.user&&delete e.user}),void 0!==n&&t.forEach(function(e){n===e.id&&!1===e.available&&(e.user=!0)}),t&&(l=t.filter(function(e){return e.user?!0===e.user:!0===e.available})),this._parent(e)},render:function(){return this.hasLocations()&&this.container.setContent(this._getTemplate()).addClassName(this._className+(this.options.layout?" "+this.options.layout:"")),this},hasLocations:function(){return l.length>1},getValue:function(){var e=this.hasLocations()?this.container.getElement("[name=location]"):null;return e?e.value:null},_getTemplate:function(){var t,i=this,o=[];return l.forEach(function(e,t){o.push({value:e.id,label:e.name,selected:i.model&&i.model.get("location")===e.id||0===t})}),t=new s({fields:[{attributes:{name:"location",id:"location-"+this.id},type:"select",label:this.options.text||e.i18n("User location"),placeholder:!1,options:o,helperText:e.i18n("Used to optimize performances"),events:{onChange:function(){i.model&&(n.mask(i.container),i.model.save({user:i.model.get("id"),location:i.getValue(),platform:i.options.platform.getId()},{patch:!0,onComplete:function(e,t){n.unmask(i.container),a.success(t.message)},onFailure:function(e,t){n.unmask(i.container),a.alert(t.message)}}))}}}]}),{tag:"span",class:"help-text-form",text:e.i18n("Used to optimize performances")},[t]}})}),define("DS/PlatformManagement/Collection/PlatformRoleCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(e,t,n){"use strict";return t.extend({url:"platform/share/roles",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Model/AllUsersBusinessExperienceModel",["UWA/Core","DS/PlatformManagement/Model/MemberDetailsModel","DS/WAFData/WAFData","DS/PlatformManagement/Utils/Data"],function(e,t,n,i){"use strict";return t.extend({getUserFullName:function(t){var n=this.escape("firstname")?e.String.ucfirst(this.escape("firstname")):"",i=this.escape("lastname")?e.String.ucfirst(this.escape("lastname")):"",o="";return""===n&&(n=this.escape("firstName")?e.String.ucfirst(this.escape("firstName")):""),""===i&&(i=this.escape("lastName")?e.String.ucfirst(this.escape("lastName")):""),""!==n.trim()&&""!==i.trim()?o=n.trim()+" "+i.trim():this.escape("email")&&""!==this.escape("email").trim()?o=this.escape("email").trim():this.escape("id")&&""!==this.escape("id").trim()&&(o=this.escape("id").trim()),t&&this.escape("id").length&&this.get("active")&&(o=o+" - "+this.escape("id").toUpperCase()),o},addBusinessExperienceToCompass:function(e,t,n){i.createBusinessExperienceUsertoCompass({users:this.get("id"),businessExperiences:e,platform:t},n)},addBusinessExperience:function(t,i,o,s,a){var l=e.String.format("{0}/{1}/users?tenant={2}",t,o,s.getId());n.authenticatedRequest(l,this.buildRequestOptions("POST",i,a))},buildRequestOptions:function(e,t,n){return{method:e,type:"json",headers:{Accept:"application/json","Content-Type":"application/json","x-ds-csrftoken":this.options.csrf},data:t&&JSON.stringify(t),onComplete:n.onComplete,onFailure:n.onFailure}},removeBusinessExperience:function(t,i,o,s){var a=e.String.format("{0}/{1}/users/{2}?tenant={3}",t,i.get("id"),this.get("id"),o.getId());n.authenticatedRequest(a,this.buildRequestOptions("DELETE",null,s))},removeBusinessExperienceToCompass:function(t,n,o){i.deleteBusinessExperienceUsertoCompass(e.merge({params:{users:this.get("id"),businessExperiences:t,platform:n}},{callbacks:o}))}})}),define("DS/PlatformManagement/Collection/OldMembersCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/OldMembersModel"],function(e,t,n){"use strict";return t.extend({url:"user/deleted",model:n,parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Collection/NotificationCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/NotificationModel"],function(e,t,n){"use strict";return t.extend({url:"role/request",options:{data:{query:null,limit:7,offset:null}},model:n,parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Views/UserRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/PreferencesModel","DS/UIKIT/Tooltip","DS/UIKIT/DropdownMenu","UWA/Event"],function(e,t,n,i,o,s,a,l){"use strict";return t.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){return this.firstRender=!0,this.listenTo(this.model,{onChange:this.render}),this.container.setAttribute("data-type","user"),this.container.setAttribute("data-id",this.model.get("id")),this.container.setAttribute("data-cross-company",!this.model.get("licensed")),this.container.setAttribute("data-casual",this.model.get("casual")),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this._injectPresence(),this},getRoleLabel:function(){var t;if(!this.model.isDeny()&&this.model.isContractor())t={id:"-1",name:e.i18n("External")};else{var n=this.model.get("role");t=e.Array.detect(this.options.roles,function(e){return e.id===n})}return t&&t.name||""},createImage:function(){var e;return this.firstRender&&""!==this.options.getSwymUrl()&&o.shouldLoadPicture()?(e=n.getAsset("s.gif"),this.firstRender=!1):e=this.model.getProfile(o.shouldLoadPicture(),this.options.getSwymUrl()),e},_onClick:function(e){var t=this.getContent(),n=!t.hasClassName("selected");l.stop(e),t.toggleClassName("selected",n),this.toggleSelect.setCheck(n),this.options.onSelect.call(this,t,this.model),!0===n?this.options.selectedCollection.add(this.model):this.options.selectedCollection.remove(this.model)},getPendingText:function(){var t=null;return this.model.get("active")||(t={tag:"span",text:" "+e.i18n("(Pending)")}),t},createContent:function(){var e=this.model,t=e.getCityFullName(),o=e.getCountryFullName(),s=!1;if(0!==this.options.selectedCollection.length)for(var a=0;a<this.options.selectedCollection._models.length;a++){if(this.options.selectedCollection._models[a].getUserId()===e.get("id")){s=!0,this.container.addClassName("selected");break}s=!1,this.container.hasClassName("selected")&&this.container.removeClassName("selected")}return this.toggleSelect=new i({className:"primary inline small-device",type:"checkbox",name:"users[]",value:e.get("id"),checked:s,id:e.get("id"),label:""}),[{tag:"td",html:[this.toggleSelect,{class:"img-wrapper-member",html:{tag:"img",styles:{height:"100%"},src:this.createImage()}},!1===this.model.get("licensed")?{tag:"i",class:"fonticon fonticon-key"}:null]},this._buildFirstNameColumn(),this._buildLastNameColumn(),{tag:"td",class:"text-ellipsis hidden-xs user-row-view-rights",html:[{tag:"span",class:!this.model.isDeny()&&this.model.isContractor()?n.getRoleColor("3",!0):n.getRoleColor(e.get("role"),!0),text:this.getRoleLabel()},this.getPendingText(),this.getFooterText()]},{tag:"td",class:"text-ellipsis hidden-xs",text:e.get("email")},{tag:"td",class:"text-ellipsis hidden-xs hidden-sm",text:t},{tag:"td",class:"text-ellipsis hidden-xs hidden-sm",text:o},{tag:"td",html:this._buildAction()}]},_buildFirstNameColumn:function(){var t=this.model,n=t.get("firstname")||t.get("lastname"),i={tag:"td",colspan:n?1:2,class:"text-ellipsis"};return n?i.text=t.get("firstname")?e.String.ucfirst(t.get("firstname")):"":i.html={tag:"span",class:"visible-xs",html:{class:"text-ellipsis",text:t.get("email")}},i},_buildLastNameColumn:function(){var t=this.model;return t.get("firstname")||t.get("lastname")?{tag:"td",class:"text-ellipsis",html:t.get("lastname")?{tag:"span",text:e.String.ucfirst(t.get("lastname"))}:""}:null},_injectPresence:function(){var t=this,i=this.model,o=e.createElement("div",{class:"presence-wrapper"});o.inject(this.container.getElement(".img-wrapper-member")),n.isBetaModeActivated("RTPresence")&&n.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(e){new e({login:i.get("id"),button:!1,username:i.getUserFullName(),tenant:t.options.platform,content:o})})},getFooterText:function(){return this.model.isCasual()?{tag:"span",class:"contractor-text",text:" "+e.String.format(e.i18n("(Casual usage)"),this.model.get("casual"))}:null},_buildAction:function(){var t,n=this,i=this.model;return 1===i.actions.length?t=i.actions.map(function(t){var i=e.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:t.icon}},events:{click:function(e){l.stop(e),n.options.onActionClick(t,n,e)}}});return new s({position:"bottom",target:i,body:t.title}),i}):(t=e.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:"fonticon fonticon-down-open"}},events:{click:function(e){l.stop(e)}}}),new a({target:t,items:i.actions.map(function(e){return{text:e.title,icon:e.icon,handler:function(t){n.options.onActionClick(e,n,t)}}})})),t}})}),define("DS/PlatformManagement/Utils/ImageUploader",["UWA/Core","UWA/Class","UWA/Class/Events","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify"],function(e,t,n,i,o,s,a){"use strict";var l=["png","jpeg","jpg","gif","svg"];return t.extend(n,{defaultSrc:null,actions:[],className:"image-uploader",elements:{},init:function(t){var n=this;this.defaultSrc=t.defaultSrc,this.src=t.src,t.className&&(this.className=t.className),t.disabled&&(this.disabled=t.disabled),this.actions=[{id:"upload",title:e.String.format(e.i18n("Upload, {0}"),this._getAllowedExtension()),handler:function(){n.openFile()}},{id:"trash",title:e.i18n("Delete"),handler:function(){n.setValue(n.defaultSrc),n.container.getElement(".input-file-hidden").setContent(n.buildUploadIcon()),n._hideTrashAction(),n.dispatchEvent("onHideTrashAction")}}],this.width=t.width||64,this.height=t.height||64,this.imgWidth=t.imgWidth||120,this.imgHeight=t.imgHeight||120},_hideTrashAction:function(){this.container&&(this.container.getElements(".actions")[0]&&this.container.getElements(".actions")[0].setStyle("height",this.height),this.container.getElements(".actions")[1]&&this.container.getElements(".actions")[1].addClassName("hidden"))},_showTrashAction:function(){this.container&&(this.container.getElements(".actions")[0]&&this.container.getElements(".actions")[0].setStyle("height",this.height/this.actions.length),this.container.getElements(".actions")[1]&&this.container.getElements(".actions")[1].removeClassName("hidden"))},_manageFiles:function(e){var t,n=this,o=this.container.getElement(".preview-icon"),r=o.getParent("div"),c=new FileReader,m="";e.length>0&&(m=this._isFile(e)?e[0].name:e,t=s.getFileExtension(m),l.indexOf(t)>-1?(i.mask(r,""),this._isFile(e)?(c.readAsDataURL(e[0]),c.onload=function(e){n._manageImage(e.target.result,o,r)}):n._manageImage(m,o,r)):a.alert(n._getAllowedExtension()))},_getAllowedExtension:function(){return e.String.format(e.i18n("Allowed extensions are .{0}"),l.join(", ."))},_isFile:function(e){return e[0]&&e[0].name},_manageImage:function(t,n,o){var l=this;setTimeout(function(){var r=new Image;0!==t.indexOf("data:")&&(r.crossOrigin="Anonymous"),r.onload=function(){var e,t,a=document.createElement("canvas");a.width=r.width,a.height=r.height,a.getContext("2d").drawImage(r,0,0),((e=r.width>r.height?l.imgWidth/r.width:l.imgHeight/r.height)<0||e>1)&&(e=1),t=s.downScaleCanvas(a,e),n.src=t.toDataURL(),l.imageIsValid=!0,l.dispatchEvent("onChange",n.src),l._showTrashAction(),l.dispatchEvent("onShowTrashAction"),i.unmask(o,"")},r.onerror=function(){i.unmask(o,""),a.alert(e.i18n("The selected file is not a valid Image"))},r.src=t},100)},onChange:function(){},_buildActions:function(){var e=this,t=[];return this.actions.forEach(function(n,i){t.push(e._buildAction(n,i))}),t},_buildAction:function(t,n){var i=this,s=e.createElement("div",{class:"actions",styles:{top:this.height/this.actions.length*n,height:this.height/this.actions.length,width:this.width},html:{class:e.String.format("fonticon fonticon-{0} pointer action-icon",t.id)},events:{click:function(){t.handler(),i.container.removeClassName("hover")}}});return t.title&&new o({target:s,body:t.title,position:"right"}),s},_getSrc:function(){return this.src||this.defaultSrc},render:function(){var t=this,n=this.buildUploadIcon(),i=[];return this.disabled||i.push(this._buildActions()),i.push({tag:"img",src:this._getSrc(),class:"preview-icon"+(this.disabled?"":" pointer"),events:this.disabled?{}:{click:function(){n.click()},error:function(){this.setAttribute("src",t._getSrc())}}}),i.push({class:"hidden input-file-hidden",html:n}),this.container=e.createElement("div",{styles:{width:this.width,height:this.height},class:this.className,events:this.disabled?{}:{mouseenter:function(){this.addClassName("hover")},mouseleave:function(){this.removeClassName("hover")},touchstart:function(e){return!!this.hasClassName("hover")||(this.addClassName("hover"),e.preventDefault(),e.stopPropagation(),!1)},dragover:function(e){e.preventDefault()},drop:function(e){e.preventDefault(),t._manageFiles(e.dataTransfer.getData("URL")||e.dataTransfer.files)}},html:i}),this._getSrc()===this.defaultSrc&&(this._hideTrashAction(),this.dispatchEvent("onHideTrashAction")),this.container},openFile:function(){this.elements.input.click()},setValue:function(e){this.container&&(this.container.getElement(".preview-icon").src=""===e?this.defaultSrc:e)},getBase64Value:function(){return this.container.getElement(".preview-icon").src.replace(":443/","/")===this.defaultSrc.replace(":443/","/")?"":this.container.getElement(".preview-icon").src},setDisabled:function(e){this.disabled=e},buildUploadIcon:function(){var t=this;return this.elements.input=e.createElement("input",{type:"file",class:"hidden",events:{change:function(){t._manageFiles(this.files)}}}),this.elements.input}})}),define("DS/PlatformManagement/Utils/TaggerManager",["UWA/Core","UWA/Class","DS/TagNavigatorProxy/TagNavigatorProxy","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/TagModel"],function(e,t,n,i,o){"use strict";return t.singleton({model:new o,memberList:null,filterApply:!0,onFilteringTagClicked:!1,navigatePendingInvitationsValue:null,fetchedOnce:!1,callbacks:[],setup:function(e,t){return t&&(this.platformId=t.get("id"),this.platform=t),e&&(this.taggerProxy=n.createProxy({widgetId:e.id,filteringMode:"WithFilteringServices",proxyDisplayName:"PlatformManagement-"+e.id,tenant:this.platformId,events:{addFilterSubjectsListener:this._addFilterSubjectsListener.bind(this),filterToApplyPendingInv:function(){var e=this;e.taggerProxy.getCurrentFilter();(!0===this.filterApply&&null===this.navigatePendingInvitationsValue||!0!==this.filterApply&&!1===this.navigatePendingInvitationsValue)&&(this.callbacks.push(function(){e.taggerProxy.setLocalFilter({"ds6w:what":[{disptext:"Pending",field:["owner"],object:"status-1",type:"string"}]},!0),e.taggerProxy.activate(),e.filterApply=!0}),this.fetchedOnce&&this._activateCallbacks())}.bind(this),filterToApplyAdministratorsMembersTab:function(){var e=this;e.taggerProxy.getCurrentFilter();e.callbacks.push(function(){e.taggerProxy.setLocalFilter({"ds6w:what":[{disptext:!0===e.memberList.withAdministrators?"Administrator":!0===e.memberList.withMembers?"Member":!0===e.memberList.withExternals?"External":"",field:["owner"],object:!0===e.memberList.withAdministrators?"roles-1":!0===e.memberList.withMembers?"roles-0":!0===e.memberList.withExternals?"agreements-1":"",type:"string"}]},!0),e.taggerProxy.activate()}),e.fetchedOnce&&e._activateCallbacks()}.bind(this)}})),this},fetch:function(e,t,n,i){var o=this;return this.listRoles=e,this.memberList=t,this.locations=n,this.filters=i,this.taggerProxy&&this.model.fetch({data:{platform:this.platformId},onComplete:function(){o.memberList.setOption("countUsers",o.model.get("total")),o.fetchedOnce=!0,o._buildTags(),o._activateCallbacks()}}),this},_buildTags:function(){var t=this.taggerProxy,n=t.getCurrentFilter(),i=!1;n&&e.is(n.allfilters,"object")&&(i=Object.keys(n.allfilters).length>0),!t||!n||i&&this.setSubjectsTagsDoneOnce||(this.setSubjectsTagsDoneOnce=!0,t.setSubjectsTags(this._getTags()))},_activateCallbacks:function(){this.callbacks.length>0&&(this.callbacks.forEach(function(e){setTimeout(e,100)}),this.callbacks=[])},_countMap:function(){var e=this.model;return{roles:{0:e.get("member"),1:e.get("admin"),2:e.get("denied")},status:{0:e.get("active"),1:e.get("pending")},agreements:{0:e.get("employee"),1:e.get("contractor")}}},_getTags:function(){var t=this,n={},i=this.model.get("locations"),o=this._countMap();return this.listRoles.roles.forEach(function(i){n=e.merge(n,t._buildTag(o.roles[i.id],i.name,e.i18n("User rights"),"role-"+i.id))}),this.listRoles.status.forEach(function(i){n=e.merge(n,t._buildTag(o.status[i.id],i.name,e.i18n("Status"),"status-"+i.id))}),this.listRoles.agreements.forEach(function(i){"0"!==i.id&&(n=e.merge(n,t._buildTag(o.agreements[i.id],i.name,e.i18n("Agreement"),"agreement-"+i.id)))}),i.forEach(function(i){n=e.merge(n,t._buildTag(i.count,i.tag,e.i18n("Locations"),"location-"+i.id))}),n},_buildTag:function(e,t,n,i){var o,s={};for(o=0;o<e;o++)s[i+"-"+o]=[{object:i,sixw:"ds6w:what",field:"owner",dispValue:t}];return s},_resetCollectionFilter:function(){this.memberList.collection.setParams({access:null,status:null,agreement:null,locations:null}),this.memberList.collection.setOffset(null)},navigatePendingInvitations:function(){this.taggerProxy.clearLocalFilter(),sessionStorage.getItem("refresh-tagger")&&"true"!==sessionStorage.getItem("refresh-pending")?(this.filterApply=!1,this.navigatePendingInvitationsValue=null,sessionStorage.removeItem("refresh-tagger"),sessionStorage.removeItem("refresh-pending")):(this.memberList.collection.setParams({access:null,status:"1",agreement:null,locations:null}),this.filterApply=!1,this.navigatePendingInvitationsValue=!1,sessionStorage.removeItem("refresh-tagger"),sessionStorage.removeItem("refresh-pending")),this.taggerProxy.options.events.filterToApplyPendingInv()},synchroFilterAdmin:function(){this.taggerProxy.clearLocalFilter(),this.memberList.collection.setParams({access:!0===this.memberList.withAdministrators?1:!0===this.memberList.withMembers?0:null,status:null,agreement:!0===this.memberList.withExternals?1:null,locations:null}),this.taggerProxy.options.events.filterToApplyAdministratorsMembersTab()},navigateGrantedRoles:function(){this.memberList.options.processList.collection.setParams({availabilityFilter:null,expireSoonFilter:null,withLicenses:null,grantedRolesFilter:!0}),this.memberList.options.processList.refresh(),this.memberList.options.processList.grantedRolesNavigation()},navigateCapacityAlmostReached:function(){this.memberList.options.processList.collection.setParams({availabilityFilter:!0,expireSoonFilter:null,withLicenses:null,grantedRolesFilter:null}),this.memberList.options.processList.refresh(),this.memberList.options.processList.capacityAlmostReachedNavigation()},navigateExpireSoon:function(){this.memberList.options.processList.collection.setParams({availabilityFilter:null,expireSoonFilter:!0,withLicenses:null,grantedRolesFilter:null}),this.memberList.options.processList.refresh(),this.memberList.options.processList.expireSoonNavigation()},_convertFilterToParams:function(t,n){var i,o,s=[],a=[],l=[],r=[];return e.is(t.allfilters)&&e.is(t.allfilters["ds6w:what"])&&t.allfilters["ds6w:what"].length>0&&!0==!n.withAdministrators&&!0==!n.withMembers&&!0==!n.withExternals?(t.allfilters["ds6w:what"].forEach(function(e){o=e.object,e.object.contains("role")?s.push(o.replace("role-","")):e.object.contains("status")?l.push(parseInt(o.replace("status-",""),10)):e.object.contains("agreement")?a.push(o.replace("agreement-","")):e.object.contains("location")&&r.push(o.replace("location-",""))}),(s.length>0||l.length>0||a.length>0||r.length>0)&&(i={access:s.join(",")||null,status:l.join(",")||null,agreement:a.join(",")||null,location:r.join(",")||null})):0===r.length&&(i={access:s.join(",")||null,status:l.join(",")||null,agreement:a.join(",")||null,location:null}),!0!==n.withAdministrators&&!0!==n.withMembers&&!0!==n.withExternals||(i={access:!0===n.withAdministrators?1:!0===n.withMembers?0:null,status:null,agreement:!0===n.withExternals?1:null,locations:null}),i},syncFilter:function(e){var t,n=this.taggerProxy&&this.taggerProxy.getCurrentFilter?this.taggerProxy.getCurrentFilter():"";this.memberList=e,n&&(t=this._convertFilterToParams(n,e),n.allfilters&&Object.keys(n.allfilters).length>0&&null===t?this.memberList.collection.setQuery(JSON.stringify(n.allfilters)):!1===this.memberList.filterMembersAvailable&&n.allfilters?(this.memberList._manageSynchroTaggerToFilterMembers(this.onFilteringTagClicked),this.memberList.collection.setParams(t||{})):this.memberList.collection.setParams(t||{}))},_addFilterSubjectsListener:function(t){var n;this._filter=t,null===this.navigatePendingInvitationsValue&&this.filterApply?this.navigatePendingInvitationsValue=!1:!1===this.navigatePendingInvitationsValue&&(this.filterApply=!1),!1===this.memberList.filterMembersAvailable&&(!0!==this.onFilteringTagClicked||e.is(t.allfilters["ds6w:what"])?!0===this.onFilteringTagClicked&&e.is(t.allfilters["ds6w:what"])&&1===t.allfilters["ds6w:what"].length||!1===this.onFilteringTagClicked?"Administrator"!==t.allfilters["ds6w:what"][0].disptext&&"External"!==t.allfilters["ds6w:what"][0].disptext&&"Member"!==t.allfilters["ds6w:what"][0].disptext?this.onFilteringTagClicked=!1:this.onFilteringTagClicked=!0:e.is(t.allfilters["ds6w:what"])&&t.allfilters["ds6w:what"].length>1?(this.onFilteringTagClicked=!1,this.memberList.withAdministrators=!1,this.memberList.withMembers=!1,this.memberList.withExternals=!1):this.onFilteringTagClicked=!1:(this.onFilteringTagClicked=!1,!0!==this.memberList.withAdministrators&&!0!==this.memberList.withMembers&&!0!==this.memberList.withExternals||(this.memberList.withAdministrators=!1,this.memberList.withMembers=!1,this.memberList.withExternals=!1))),this._resetCollectionFilter(),n=this._convertFilterToParams(t,this.memberList),t.allfilters&&Object.keys(t.allfilters).length>0&&null===n?this.memberList.collection.setQuery(JSON.stringify(t.allfilters)):!0===this.onFilteringTagClicked&&!1===this.memberList.withAdministrators&&!1===this.memberList.withMembers&&!1===this.memberList.withExternals?"1"===n.access?this.memberList.withAdministrators=!0:"0"===n.access?this.memberList.withMembers=!0:"1"===n.agreement&&(this.memberList.withExternals=!0):this.memberList.collection.setParams(n||{}),this.memberList.refresh()}})}),define("DS/PlatformManagement/Modal/ThirdPartyApps",["UWA/Core","UWA/Controls/Abstract","UWA/Controls/Input","UWA/Fx","UWA/Event","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/UIKIT/Form","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/ImageUploader","DS/i3DXCompassCore/RequestOptions","DS/i3DXCompassCore/Utils","DS/PlatformManagement/Views/HelperText","DS/WebappsUtils/WebappsUtils"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w){"use strict";return t.extend({id:p.getUUID(),defaultOptions:{appId:null,box:null},content:null,masked:!1,init:function(e){this._parent(e),e.model&&(this.model=e.model),this.buildContainer()},buildContainer:function(){var e=this;this.imageUploader=new f({disabled:!this.isEditable(),defaultSrc:w.getWebappsAssetUrl("i3DXCompass","images/3DExpPlatform_Default.png"),src:v.removeUselessPort(p.escape(this.model.get("icon")))}).addEvent("onShowTrashAction",function(){e.imageUploaderMobile.setValue(e.imageUploader.getBase64Value()),e.imageUploaderMobile._showTrashAction()}).addEvent("onHideTrashAction",function(){e.imageUploaderMobile.setValue(e.imageUploader.getBase64Value()),e.imageUploaderMobile._hideTrashAction()}),this.imageUploaderMobile=new f({disabled:!this.isEditable(),defaultSrc:w.getWebappsAssetUrl("i3DXCompass","images/3DExpPlatform_Default.png"),src:v.removeUselessPort(p.escape(this.model.get("icon")))}).addEvent("onShowTrashAction",function(){e.imageUploader.setValue(e.imageUploaderMobile.getBase64Value()),e.imageUploader._showTrashAction()}).addEvent("onHideTrashAction",function(){e.imageUploader.setValue(e.imageUploaderMobile.getBase64Value()),e.imageUploader._hideTrashAction()}),this.modal=new s({closable:!0,className:"third-party-apps-modal",header:this.getHeader(),body:{class:"empty-body"},footer:"",events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal,this.elements.container.inject(document.body,"top").show(),this.modal.mask(),this.model.fetch({data:{id:this.model.get("id"),ui:!0,platform:this.options.isEdit?this.options.platform.getId():""},onComplete:function(t,n){var i=n.ui;n.app&&(e.imageUploader.setDisabled(!1===n.app.editable),e.imageUploaderMobile.setDisabled(!1===n.app.editable)),t.set(n.app),t.unset("ui"),t.unset("app"),n.app?(e.editData=t.toJSON(),e.editionMode=!0):(e.editData=e.defaultData,e.editionMode=!1),e.elements.container.setBody(e.getContent(i)),e.elements.container.setFooter(e.getButtons(i)),e.modal.unmask(),e.updatePreview(e.editData)}})},isInEditionMode:function(){return e.is(this.model.get("id"))},isEditable:function(){return!1!==this.model.get("editable")},getHeader:function(){return this.isInEditionMode()?e.i18n("Edit Additional App"):e.i18n("Create Additional App")},getContent:function(t){return this.content=e.createElement("div",{html:[this.getForm(t),this.getPreview(t),{class:"clearfix"}]}),this.content},_showDeleteConfirmation:function(){var t=this,n=new d({className:"platform-management-confirm-modal",closable:!1}),i=this._getConfirmDeleteTitle();n.confirm(i,e.i18n("Confirmation"),function(e){e&&t._delete(),p.manageSupportOfMultiModal()})},_getConfirmDeleteTitle:function(){var t=p.getTextFromHtml(this.model.get("name"));return!0===this.model.get("granted")?e.String.format(e.i18n("Warning this Additional App is currently granted to members, are you sure you want to remove {0} Additional App?"),t):e.String.format(e.i18n("Are you sure you want to remove {0} Additional App?"),t)},_delete:function(){var t=this;this.modal.mask(),this.model.destroy({data:{id:this.model.get("id")},wait:!0,onComplete:function(e,n){t.modal.unmask(),t.elements.container.hide(),g.success(n.message),t.options.onDelete&&t.options.onDelete()},onFailure:function(){t.modal.unmask(),t.showMessages([e.String.format(e.i18n("Unable to remove {0}"),t.model.get("name"))],"error")}})},getButtons:function(){var t,n,i=[],o=this;return i.push(new m({className:"primary",value:this.isInEditionMode()?e.i18n("Save"):e.i18n("Create"),events:{onClick:function(){setTimeout(function(){o.validateForm.call(o,!0)},100)}}})),this.isInEditionMode()&&(t=new m({value:e.i18n("Remove"),disabled:!1===this.model.get("remove"),className:"error",events:{onClick:this._showDeleteConfirmation.bind(this)}}),n=e.createElement("div",{class:"tooltip-wrapper",html:t}),i.push(n),!1===this.model.get("remove")&&this.model.get("helpMessage")&&(this.tooltip=new u({position:"bottom",target:n,body:this.model.get("helpMessage")}))),i.push(new m({value:e.i18n("Cancel"),className:"default",events:{onClick:function(){o.elements.container.hide()}}})),i},launchInfosLabelFx:void 0,configUrlFx:void 0,tooltips:{},editData:{},quadrantData:{},defaultData:{displayname:"",icon:"",active:!0,private:!1,quadrant:"NORTH",tooltip:"",description:"",type:"Web"},controls:{platforms:[]},imageIsValid:!1,getDefault:function(t){return e.is(this.editData[t])?p.getTextFromHtml(this.editData[t]):""},getPreview:function(){var t=e.createElement("div",{tag:"div",class:"preview-title"});return this.tooltips.preview=new u({position:"bottom",target:t,body:""}),e.createElement("div",{class:"third-party-app-preview col-sm-4 col-md-3 col-md-offset-1",html:[{tag:"label",text:e.i18n("Preview")},{tag:"div",class:"panel-preview",html:[{tag:"div",class:"compass-preview",styles:{"margin-top":5,"margin-left":5},html:{tag:"div",class:"compass-preview compass-preview-on "+this.editData.quadrant.toLowerCase()}},{tag:"div",styles:{display:"none"},class:"compass-scroll-accordion-section-title has-icon",html:{class:"compass-scroll-accordion-section-title-wrapper",html:[{tag:"span",class:"compass-scroll-accordion-section-title-icon "+this.editData.quadrant.toLowerCase()},{tag:"span",class:"compass-scroll-accordion-section-title-text",text:""},{tag:"span",class:"compass-scroll-accordion-section-title-arrow fonticon fonticon-down-dir"}]}},{tag:"div",class:"preview-item",html:[this.imageUploader.render(),t]}]}]})},updatePreview:function(t){var n=t.name||t.displayname,i=t.quadrant,o=t.tooltip;this.content&&(e.is(n)&&this.content.getElement(".preview-title").setText(p.getTextFromHtml(n)),e.is(i)&&(i=i.id||i,this.content.getElement(".compass-scroll-accordion-section-title-icon")&&(this.content.getElement(".compass-scroll-accordion-section-title-icon").className="compass-scroll-accordion-section-title-icon "+i.toLowerCase()),this.content.getElement(".compass-preview-on")&&(this.content.getElement(".compass-preview-on").className="compass-preview compass-preview-on "+i.toLowerCase()),this.content.getElement(".compass-scroll-accordion-section-title-text").setText(this.quadrantData[i])),e.is(o)&&(""===o&&(o=this.content.getElement("[name=display-name]").value),this.tooltips.preview.setBody(p.escape(p.unescape(o)))))},getForm:function(t){var n,i,o=[],s=[],a=this.getDefault("typeId"),l=this;this.formWrapper=e.createElement("div",{class:"form-wrapper col-sm-8"}),Object.keys(t.type).forEach(function(e){o.push({label:t.type[e].name,value:t.type[e].id,selected:a===t.type[e].id})}),n=this.getDefault("quadrant"),Object.keys(t.quadrant).forEach(function(e){"PLAY"!==t.quadrant[e].id&&(s.push({label:t.quadrant[e].name,value:t.quadrant[e].id,selected:n===t.quadrant[e].id}),l.quadrantData[t.quadrant[e].id]=t.quadrant[e].name,l.defaultData.quadrant.id===t.quadrant[e].id&&(l.defaultData.quadrantId=s.length-1))}),new h({fields:[{type:"text",label:e.i18n("Short Name"),className:"short-name",value:this.getDefault("name"),disabled:!this.isEditable(),maxlength:45,id:"display-name"+this.id,name:"display-name",required:!0,helperText:e.i18n("Appears in the Compass"),errorText:" ",events:{focus:this._removeError,keyup:function(){l.updatePreview({displayname:this.value})}}},{type:"text",label:e.i18n("Long Name"),className:"long-name",value:this.getDefault("tooltip"),disabled:!this.isEditable(),name:"long-name",id:"long-name-"+this.id,maxlength:255,helperText:e.i18n("Appears in the tooltip"),errorText:" ",events:{focus:this._removeError,keyup:function(){l.updatePreview({tooltip:this.value})}}},{type:"select",label:e.i18n("Compass Quadrant"),className:"compass-quadrant-wrapper",options:s,disabled:!this.isEditable(),id:"quadrant-"+this.id,name:"quadrant",placeholder:!1,events:{onChange:function(){l.updatePreview({quadrant:this.getValue()[0]})}}},{type:"select",label:e.i18n("Type"),placeholder:!1,options:o,attributes:{id:"type-"+this.id,name:"type"},disabled:this.editionMode||!this.isEditable(),events:{onChange:function(){var e=this.getValue()[0].toLowerCase();l._manageFields(e)}}}]}).inject(this.formWrapper),this.controls.public=new c({type:"checkbox",name:"public",checked:!this.getDefault("private"),label:e.i18n("Available to all members"),className:"primary"}),i=[{type:"text",className:"launchinfos-label",label:e.i18n("URL"),required:!0,helperText:" ",errorText:" ",value:this.getDefault("launchinfos"),disabled:!this.isEditable(),id:"launch-infos-"+this.id,name:"launch-infos",events:{focus:this._removeError}},{type:"text",className:"configurl-wrapper",label:e.i18n("Configuration file URL"),value:this.getDefault("config"),disabled:!this.isEditable(),id:"config-url-"+this.id,name:"config-url",events:{focus:this._removeError}},{type:"text",className:"exe-wrapper",label:e.i18n("Executable"),required:!0,helperText:e.i18n("File must be located within the code/bin_trusted, code/clr_trusted or code/command_trusted directory of a client installation"),value:this.getDefault("exe"),disabled:!this.isEditable(),placeholder:"3DExperience (.exe, .bat, .sh)",id:"exe-"+this.id,name:"exe",events:{focus:this._removeError}},{type:"text",className:"form-group error-wrapper",label:e.i18n("Custom Error Message"),value:this.getDefault("error"),disabled:!this.isEditable(),maxlength:45,helperText:e.i18n("Used when the executable file is not found"),id:"error-"+this.id,name:"error",events:{focus:this._removeError}}];new h({fields:i}).inject(this.formWrapper);return this.formWrapper.getElement(".compass-quadrant-wrapper").getParent().addClassName("hidden"),this.formWrapper.getElement(".exe-wrapper").getParent().addClassName("hidden"),this.formWrapper.getElement(".error-wrapper").getParent().addClassName("hidden"),this.formWrapper.getElement(".configurl-wrapper").getParent().addClassName("hidden"),e.createElement("div",{html:[{tag:"div",html:this.controls.public}]}).inject(this.formWrapper),this._manageFields(a.toLowerCase()),"Web"===o[0].label&&window.innerHeight>600?document.querySelector(".modal-content").setStyle("height","80%"):document.querySelector(".modal-content").setStyle("height","100%"),this.formWrapper},_buildFx:function(){var e=this;this.launchInfosLabelFx={newText:"",fx:new i(this.formWrapper.getElement(".launchinfos-label"),{duration:200,unit:"",events:{onComplete:function(){var t=this.element;0===t.getStyle("opacity")&&(t.setContent(e.launchInfosLabelFx.newText),this.start({opacity:[0,1]}))}}}),start:function(e){e!==this.newText&&(this.newText=e,this.fx.start({opacity:[1,0]}))}},this.configUrlFx={fx:new i(this.formWrapper.getElement(".configurl-wrapper"),{duration:200,unit:"",events:{onComplete:function(){var e=this.element,t=e.getElement("input");0===e.getStyle("opacity")&&(e.hide(),t.value="")}}}),show:function(){var e=this.fx.element;"none"===e.getStyle("display")&&(e.show(),this.fx.start({opacity:[0,1]}))},hide:function(){"block"===this.fx.element.getStyle("display")&&this.fx.start({opacity:[1,0]})}}},_manageFields:function(t){this.launchInfosLabelFx,this.configUrlFx;var n=this.formWrapper.getElement(".exe-wrapper").getParent(),i=this.formWrapper.getElement(".error-wrapper").getParent(),o=this.formWrapper.getElement(".launchinfos-label").getParent(),s=this.formWrapper.getElement(".configurl-wrapper").getParent(),a=document.querySelector(".modal-content");switch(n.removeClassName("hidden"),i.removeClassName("hidden"),s.removeClassName("hidden"),t){case"web":o.getElement("label").childNodes[0].textContent=e.i18n("URL"),s.addClassName("hidden"),n.addClassName("hidden"),i.addClassName("hidden"),o.getElement(".form-control-helper-text").textContent=" ",window.innerHeight>600&&a.setStyle("height","80%");break;case"widget":s.removeClassName("hidden"),o.getElement("label").childNodes[0].textContent=e.i18n("Source code URL"),n.addClassName("hidden"),i.addClassName("hidden"),o.getElement(".form-control-helper-text").textContent="",window.innerHeight>600&&a.setStyle("height","80%");break;case"native":s.addClassName("hidden"),o.getElement("label").childNodes[0].textContent=e.i18n("ID"),n.removeClassName("hidden"),i.removeClassName("hidden"),o.getElement(".form-control-helper-text").textContent=e.i18n('Mandatory if "Executable" field is equal to "3DExperience"'),window.innerHeight>600&&a.setStyle("height","100%");break;case"":n.addClassName("hidden"),i.addClassName("hidden"),s.addClassName("hidden")}},_removeError:function(){var e=this.elements?this.elements.container:this,t=this.content;e.hasClassName("uwa-checkbox")&&e.hasClassName("error")?t.getElements(".platform-checkboxes .uwa-checkbox").forEach(function(e){e.removeClassName("error")}):e.removeClassName("error")},validateForm:function(t){var n=this.content,i=n.getElement("[name=exe]").value,o=n.getElement("[name=error]").value,s={id:this.editData.id,type:n.getElement("[name=type]").value,quadrant:n.getElement("[name=quadrant]").value,platforms:this.options.platform.getId(),displayname:n.getElement("[name=display-name]").value.replace(/^\s+|\s+$/g,""),tooltip:n.getElement("[name=long-name]").value.replace(/^\s+|\s+$/g,""),description:"",icon:this.imageUploader.getBase64Value(),launchinfos:n.getElement("[name=launch-infos]").value,config:n.getElement("[name=config-url]").value,visibility:n.getElement("[name=public]").checked?"Public":"Private"};if(0!==i.length&&(s.exe=i),0!==o.length&&(s.error=o),this.modal.mask(),n.getElement("[name=display-name]").removeClassName("error"),n.getElement("[name=display-name]").getParent().removeClassName("has-error"),n.getElement("[name=long-name]").removeClassName("error"),n.getElement("[name=long-name]").getParent().removeClassName("has-error"),n.getElement("[name=launch-infos]").removeClassName("error"),n.getElement("[name=launch-infos]").getParent().removeClassName("has-error"),0===s.displayname.length){var a=n.getElement("[name=display-name]").getParent();n.getElement("[name=display-name]").addClassName("error"),a.addClassName("has-error"),a.getElement(".form-control-error-text").textContent=e.i18n("This field is required.")}else if(s.displayname.length<3){a=n.getElement("[name=display-name]").getParent();n.getElement("[name=display-name]").addClassName("error"),a.addClassName("has-error"),a.getElement(".form-control-error-text").textContent=e.i18n("Minimum 3 characters.")}if(s.tooltip.length>0&&s.tooltip.length<3){var l=this.formWrapper.getElement(".long-name").getParent();n.getElement("[name=long-name]").addClassName("error"),l.addClassName("has-error"),l.getElement(".form-control-error-text").textContent=e.i18n("Minimum 3 characters.")}if("Native"===s.type||p.isUrl(s.launchinfos))"Native"!==s.type||s.exe&&"3DExperience.exe"!==s.exe&&"3DExperience"!==s.exe||0!==s.launchinfos.length||(r.getElement(".form-control-error-text").textContent=e.i18n("This field is required, if Executable is 3DExperience."),n.getElement("[name=launch-infos]").addClassName("error"),r.addClassName("has-error"));else{var r=this.formWrapper.getElement(".launchinfos-label").getParent();r.getElement(".form-control-error-text").textContent=e.i18n("Must be a valid URL."),n.getElement("[name=launch-infos]").addClassName("error"),r.addClassName("has-error")}if(0!==n.getElements(".error").length)return this.modal.unmask(),this.formWrapper;this.submitForm(s,t)},clearMessages:function(){var e=this.content.getElement(".messages");e&&(e.empty(),e.fx.start({height:[e.getSize().height,0]}))},showMessages:function(t,n){var o,s,a=this.content,l=a.getElement(".messages");l?l.empty():(l=e.createElement("div",{styles:{height:0,overflow:"hidden"}}).inject(a.getElement(".form-wrapper"),"top")).fx=new i(l,{duration:200,unit:"px"}),l.className="messages",l.addClassName(n),o=e.createElement("ul"),t.forEach(function(t){e.createElement("li",{html:t}).inject(o)}),o.inject(l),s=t.length>0?o.getElement("li").getSize().height:0,l.fx.start({height:[l.getSize().height,s*t.length]})},submitForm:function(t,n){var i=this;i.modal.mask(),this.model.save(t,{patch:!0,onComplete:function(e,o){i.modal.unmask(),n?(i.elements.container.hide(),g.success(o.message)):i.showMessages([o.message],"success"),t.id?(t.private="Public"!==t.visibility,t.name=p.escape(t.displayname),t.tooltip=p.escape(t.tooltip),i.model.set(t)):i.options.onAdded&&i.options.onAdded()},onFailure:function(n){i.modal.unmask(),n&&n.message?i.showMessages([n.message],"error"):i.showMessages([e.String.format(e.i18n("Unable to save {0}"),t.displayname)],"error")}})}})}),define("DS/PlatformManagement/Collection/UsersBusinessExperienceCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/UsersBusinessExperienceModel","DS/PlatformManagement/Model/AllUsersBusinessExperienceModel"],function(e,t,n,i){"use strict";return t.extend({url:"/admin/v1/model/BusinessExperienceDefinition/",model:i,parse:function(e){return this.setBEMaxLimit(e.total),e.items},getMaxLimit:function(){return this.total}})}),define("DS/PlatformManagement/Model/LogsModel",["UWA/Core","DS/PlatformManagement/Model/ProcessModel","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t,n){"use strict";return n.extend({defaults:{logsMaxPerPage:"25",logsSort:"date",logsSortDirection:"desc"}})}),define("DS/PlatformManagement/Modal/CustomRole",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/W3DXComponents/IdCard","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Form","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/ImageUploader","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Views/HelperText","DS/PlatformManagement/Views/NoSearchResultView"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S){"use strict";var x=t.extend({tagName:"div",className:"facet-add",imageUploader:null,emptyView:null,setup:function(e){if(this.options=e||{},!e.platform)throw new Error("A platform need to be set");return this.platform=e.platform,this.elements={},this._parent(e)},getTemplate:function(){var t=this;new y({className:"description"}).renderHtml(this.titleDescription(2048,0));return this.imageUploader=new g({defaultSrc:w.getWebappsAssetUrl("i3DXCompass",e.String.format("v3.1/images/role/DEFAULT_CUSTOM_Role.svg")),src:h.escape(this.model.get("icon"))}),[{class:"custom-role-name",html:[new u({className:"custom-role-name-form",fields:[{type:"text",label:e.i18n("Name"),required:!0,helperText:e.i18n("Appears in the Compass"),errorText:" ",id:"name"+this.cid,name:"name",maxlength:45,value:h.getTextFromHtml(this.model.get("name"))||""}]}),{class:"form-group col-sm-6",html:[{tag:"label",text:e.i18n("Role icon")},this.imageUploader.render()]}]},{html:[new u({fields:[{type:"text",label:e.i18n("Description"),required:!0,required:!0,helperText:this.titleDescription(2048,0),errorText:" ",id:"description"+this.cid,name:"description",value:this._getDescriptionValue(),maxlength:2048,multiline:!0,rows:8,events:{onKeyDown:function(){setTimeout(function(){var e=t.container.getElement("[name=description]").value.length;t.container.getElements(".form-control-helper-text")[1].setContent(t.titleDescription(2048,e))},0)}}}]})]},this.buildAppsSkeleton()]},_getDescriptionValue:function(){var e=h.getTextFromHtml(this.model.get("description"));return e&&(e=e.replace(/<br>/g,"\n")),e||""},_getValues:function(){var e=this.getContent(),t=[];return this.grantedCollection.forEach(function(e){t.push(e.get("id"))}),{id:this.model.get("id"),name:e.getElement("[name=name]").value,description:e.getElement("[name=description]").value,icon:this.imageUploader.getBase64Value(),applications:t.join(","),platform:this.platform.get("id")}},_removeError:function(){this.getParent(".form-group").removeClassName("has-error")},_addError:function(){this.getParent(".form-group").addClassName("has-error")},_getErrors:function(t){var n=this._getValues(),i=this.getContent();return""===n.name?(i.getElement("[name=name]").getParent().getElement(".form-control-error-text").textContent=e.i18n("This field is required."),i.getElement("[name=name]").getParent().addClassName("has-error"),i.getElement("[name=name]").addClassName("error")):n.name.length<3?(i.getElement("[name=name]").getParent().getElement(".form-control-error-text").textContent=e.i18n("Minimum 3 characters."),i.getElement("[name=name]").getParent().addClassName("has-error"),i.getElement("[name=name]").addClassName("error")):(i.getElement("[name=name]").getParent().removeClassName("has-error"),i.getElement("[name=name]").removeClassName("error")),""===n.description?(i.getElement("[name=description]").getParent().getElement(".form-control-error-text").textContent=e.i18n("This field is required."),i.getElement("[name=description]").getParent().addClassName("has-error"),i.getElement("[name=description]").addClassName("error")):n.description.length<3?(i.getElement("[name=description]").getParent().getElement(".form-control-error-text").textContent=e.i18n("Minimum 3 characters."),i.getElement("[name=description]").getParent().addClassName("has-error"),i.getElement("[name=description]").addClassName("error")):(i.getElement("[name=description]").getParent().removeClassName("has-error"),i.getElement("[name=description]").removeClassName("error")),""===n.applications?i.getElement(".apps-error-text").removeClassName("hidden"):i.getElement(".apps-error-text").addClassName("hidden"),[]},buildAppsSkeleton:function(){return this.fullCollection=new p,this.collection=this.fullCollection,this.elements.appsContent=e.createElement("div",{html:[this.buildSearch(),{class:"wrapper"}]}),this.grantedCollection=new p,this.model.get("applications")&&this.grantedCollection.set(this.model.get("applications")),this.fullCollection.setLimit(f.get("processesMaxPerPage")),this.fullCollection.setSortDirection(f.get("processesSortDirection")),this.fullCollection.setPlatform(this.platform.getId()),this.filterViewAll(),this.elements.appsContent},titleDescription:function(t,n){return e.String.format(e.i18n("Max. {0} characters; {1} characters left"),t,t-n)},getTable:function(){return[{tag:"table",class:"table table-hover table-select-process",styles:{"margin-bottom":"0px"},html:[{tag:"tbody",html:this.getRows()}]},{tag:"span",class:"apps-error-text hidden",text:e.i18n("You need to select at least one application")},this.buildPager()]},getRows:function(){var e=[],t=this;return this.collection.forEach(function(n){e.push(t.getRow(n))}),e},getRow:function(t){var n=this;return{tag:"tr",class:"tr-"+this.getRowIdentifier(t),html:[{tag:"td",html:new m({className:"primary",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(t),id:this.getRowIdentifier(t),label:h.getTextFromHtml(t.get("name"))||h.getTextFromHtml(t.get("title")),checked:e.is(this.grantedCollection.findWhere({uid:t.get("uid")})),disabled:!1,events:{onClick:function(){this.isChecked()?n.grantedCollection.add(t):n.grantedCollection.remove(t)}}})},{tag:"td",class:"text-right status",html:this._getInformation(t)}]}},_getInformation:function(t){return!1===t.get("private")?e.String.format(e.i18n("Type: {0}, Available to all members"),t.getDisplayType()):e.String.format(e.i18n("Type: {0}"),t.getDisplayType())},getRowIdentifier:function(e){return e.get("uid")},buildSearch:function(){var t=this;return{tag:"div",styles:{"text-align":"center","margin-top":5,"margin-bottom":15},html:[new v({attributes:{placeholder:e.i18n("Search Additional Apps"),value:this.collection.getQuery()||"",events:{keyup:function(){t.mask(),t.collection.setQuery(this.value.trim()),t.collection.setOffset(0),t.collection.reset(),t.collection.fetch({onComplete:function(){t.unmask(),t.filterViewAll()}})}}}}),{class:"clearfix"}]}},updateWrapper:function(){var e=this.collection.size()>0?this.getTable():this.buildEmptyView();this.elements.appsContent.getElement(".wrapper").setContent(e)},buildEmptyView:function(){return this.collection.isQueryEmpty()?this.emptyView=new b({fonticon:"role",text:e.i18n("No Custom Role found")}).render():this.emptyView=new S,this.emptyView},filterGrantedOnly:function(){this.collection=this.grantedCollection,this.updateWrapper()},filterViewAll:function(){var e=this;this.mask(),this.collection=this.fullCollection,this.collection.fetch({onComplete:function(){e.unmask(),e.updateWrapper()}})},mask:function(){l.mask(this.elements.appsContent)},unmask:function(){l.unmask(this.elements.appsContent)},buildFilter:function(){var t=this.elements;return t.filterGrantedOnly=new r({value:e.i18n("View granted only"),className:"default",events:{onClick:this.filterGrantedOnly.bind(this)}}),t.filterViewAll=new r({value:e.i18n("View all"),className:"default",active:!0,events:{onClick:this.filterViewAll.bind(this)}}),{class:"pull-right filter-group",styles:{"margin-top":0},html:[new d({type:"radio",buttons:[t.filterGrantedOnly,t.filterViewAll]})]}},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?new i({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:7,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.collection.fetch({onComplete:function(){e.unmask(),e.updateWrapper()}})}}}):null},render:function(){return this.container.setContent(this.getTemplate()),this}});return n.extend({content:null,modal:null,init:function(e){this.model=e.model,this.platform=e.platform,this._parent(e),this.modal=new s({closable:!0,header:this._getHeader(),body:"",footer:this.getButtons(),events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal},show:function(){var e=this;return this.view=new x({model:this.model,platform:this.platform}),this.model.get("id")?(this.mask(),this.model.fetch({data:{rolePlatform:this.model.get("platform"),platform:this.model.get("platform"),id:this.model.get("id"),offset:null,limit:null,sort_direction:null},onComplete:function(){e.unmask(),e.modal.setBody(e.view.render())}})):e.modal.setBody(e.view.render()),this.modal.inject(document.body,"top").show(),this},_getHeader:function(){return this._isInEditionMode()?e.i18n("Edit Custom Role"):e.i18n("Create Custom Role")},_save:function(){var t=this,n=this.view._getValues();this.view._getErrors(),0===t.elements.container.getContent().getElements(".error").length&&t.elements.container.getContent().getElement(".apps-error-text").hasClassName("hidden")&&(t.mask(),this.model.save(e.merge(n,{platform:this.model.get("platform")}),{patch:!0,onComplete:function(e,n){t.unmask(),t.elements.container.hide(),C.success(n.message),t.options.onAdded&&t.options.onAdded()},onFailure:function(e,n){t.unmask(),C.alert(n.message)}}))},_isInEditionMode:function(){return e.is(this.model.get("id"))},_showDeleteConfirmation:function(){var t=this,n=new a({className:"platform-management-confirm-modal",closable:!1}),i=this._getConfirmDeleteTitle();n.confirm(i,e.i18n("Confirmation"),function(e){e&&t._delete(),h.manageSupportOfMultiModal()})},_getConfirmDeleteTitle:function(){var t=h.getTextFromHtml(this.model.get("name"));return!0===this.model.get("granted")?e.String.format(e.i18n("Warning this role is currently granted to members, are you sure you want to remove {0} Role?"),t):e.String.format(e.i18n("Are you sure you want to remove {0} Role?"),t)},_delete:function(){var t=this;this.mask(),this.model.destroy({data:{id:t.model.get("id"),limit:null,offset:null,sort_direction:null},wait:!0,onComplete:function(e,n){t.unmask(),t.elements.container.hide(),C.success(n.message),t.options.onDelete&&t.options.onDelete()},onFailure:function(){t.unmask(),C.alert(e.String.format(e.i18n("Unable to remove {0}"),t.model.get("name")))}})},getButtons:function(){var t=[],n=this;return t.push(new r({className:"primary",value:this._isInEditionMode()?e.i18n("Save"):e.i18n("Create"),events:{onClick:this._save.bind(this)}})),this._isInEditionMode()&&t.push(new r({value:e.i18n("Remove"),className:"error",events:{onClick:this._showDeleteConfirmation.bind(this)}})),t.push(new r({className:"default",value:e.i18n("Cancel"),events:{onClick:function(){n.modal.hide()}}})),t},getBody:function(){return this.modal.getBody()},mask:function(){this.loader||(l.mask(this.getBody()),this.loader=!0)},unmask:function(){this.loader&&l.unmask(this.getBody()),this.loader=null}})}),define("DS/PlatformManagement/Model/GroupModel",["UWA/Core","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,t,n,i,o){"use strict";return t.extend({url:"group",membersCollection:null,rowViewExtended:!1,getGroupId:function(){return this.get("uuid")},removeLicense:function(t,n,i){o.deleteLicensesGroup(e.merge({params:{group:this.get("uuid"),label:this.get("label"),licenses:n.canCrossCompany()?JSON.stringify([{id:t.get("uid"),licensed:t.get("licensed"),restricted:t.get("restricted")}]):JSON.stringify([{id:t.get("uid")}]),platform:n.getId(),type:t.getType()}},{callbacks:i}))},addLicense:function(e,t,n,i){o.createLicensesGroup({group:this.get("uuid"),label:this.get("label"),licenses:JSON.stringify(e),type:t,platform:n.getId()},i)},updateLicense:function(e,t,n,i){o.updateLicensesGroup({group:this.get("uuid"),label:this.get("label"),licenses:JSON.stringify(e),type:t,platform:n.getId()},i)},isMembersRowViewExtended:function(){return this.rowViewExtended},setRowViewExtended:function(e){this.rowViewExtended=e},setMembersCollection:function(e){this.membersCollection=e},getMembersCollection:function(){return this.membersCollection}})}),define("DS/PlatformManagement/Collection/GroupCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/GroupModel"],function(e,t,n){"use strict";return t.extend({url:"group",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data||e.roles}})}),define("DS/PlatformManagement/Collection/UserTpaCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(e,t,n){"use strict";return t.extend({url:"user/apps",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Collection/LogsCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/LogsModel"],function(e,t,n){"use strict";return t.extend({url:"platform/api/v1/audit",model:n,parse:function(e){return this.setMaxLimit(e.count),e.events}})}),define("DS/PlatformManagement/Modal/SubscriptionErrorModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/MemberDetailsModel"],function(e,t,n,i,o,s,a,l,r,c){"use strict";var m=r.extend({url:"subscriptions",model:c,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),this.id=e.id,this.name=e.name,this.errorCount=e.errorCount,this.stop=e.stop,e.data}}),d=t.extend({tagName:"div",className:"",imageUploader:null,emptyView:null,setup:function(e){if(this.options=e||{},!e.platform)throw new Error("A platform need to be set");return this.platform=e.platform,this.onClick=e.onClick,this.elements={},this._parent(e)},_createTemplate:function(){return[this._createDescription(),this._getTable()]},_createDescription:function(){return{class:"bs-callout bs-callout-warning",html:[{text:e.String.format(e.i18n("{0} annual subscription of {1} will not be renewed on {2}"),this.collection.errorCount,this.collection.name,this.collection.stop)},{text:e.String.format(e.i18n("Please select and confirm the {0} members whose subscription will not be renewed"),this.collection.errorCount)}]}},_getTable:function(){return[{tag:"table",class:"table table-hover",html:[{tag:"tbody",html:this._getRows()}]},this._createPager()]},_getRows:function(){var e=[],t=this;return this.collection.forEach(function(n){e.push(t._getRow(n))}),e},_getRow:function(e){var t=e.get("id");return{tag:"tr",class:"tr-"+t,html:[{tag:"td",html:new l({className:"primary",type:"checkbox",name:"subscriptions[]",value:t,id:t,label:e.getUserFullName(),events:{onClick:this.onClick.bind(this)}})}]}},mask:function(){s.mask(this.elements.appsContent)},unmask:function(){s.unmask(this.elements.appsContent)},_createPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?new i({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:7,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.collection.fetch({onComplete:function(){}})}}}):null},getSelected:function(){return this.container.getElements("input:checked")},render:function(){return this.container.setContent(this._createTemplate()),this}});return n.extend({content:null,modal:null,init:function(t){this.platform=t.platform,this._parent(t),this.modal=new o({closable:!1,header:e.i18n("Subscription modification"),body:"",footer:this.getButtons(),events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal},show:function(){var e=this,t=new m;return this.view=new d({collection:t,platform:this.platform,onClick:function(){e.view.getSelected().length>=t.errorCount?e._buttonConfirm.setDisabled(!1):e._buttonConfirm.setDisabled(!0)}}),this.modal.mask(),t.fetch({data:{platform:this.platform.get("id")},onComplete:function(){e.modal.unmask(),e.modal.setBody(e.view.render())},onFailure:function(){e.modal.unmask()}}),this.modal.inject(document.body,"top").show(),this},_save:function(){new c({id:"_"}).destroy({data:{user:getSelectedUser().join(","),platform:that.platform.getId()},wait:!0,onComplete:function(e,t){PlatformNotify.success(t.message),that.memberList.refresh()},onFailure:function(e,t){t.message&&PlatformNotify.warn(t.message),that.memberList.refresh()}})},getButtons:function(){return this._buttonConfirm=new a({className:"primary",disabled:!0,value:e.i18n("Confirm"),events:{onClick:this._save.bind(this)}}),this._buttonConfirm}})}),define("DS/PlatformManagement/Views/UserView",["UWA/Core","DS/W3DXComponents/Views/Item/TileView","DS/UIKIT/Tooltip","DS/PlatformManagement/Utils","UWA/Event"],function(e,t,n,i){"use strict";return t.extend({tagName:"div",name:"platform-management",extendedEvents:!1,getFooterText:function(){var t=null,n=this.model;return n.isCasual()&&(t=e.i18n("(Casual usage)").format(n.get("casual"))),null!==t?{tag:"div",class:"contractor-text",text:t}:null},getPendingText:function(){var t=null;return this.model.get("active")||(t={tag:"span",text:" "+e.i18n("(Pending)")}),t},getRoleLabel:function(){var t;if(!this.model.isDeny()&&this.model.isContractor())t={id:"-1",name:e.i18n("External")};else{var n=this.model.get("role");t=e.Array.detect(this.options.roles,function(e){return e.id===n})}return t&&t.name||""},render:function(){var e=this.model;if(this._parent(),0!==this.options.selectedCollection.length)for(var t=0;t<this.options.selectedCollection._models.length;t++){if(this.options.selectedCollection._models[t].getUserId()===e.get("id")){this.container.addClassName("selected");break}this.container.hasClassName("selected")&&this.container.removeClassName("selected")}return this.container.getElement(".tile-content").setContent([{tag:"span",class:!this.model.isDeny()&&this.model.isContractor()?i.getRoleColor("3",!0):i.getRoleColor(e.get("role"),!0),text:this.getRoleLabel()},this.getPendingText(),this.getFooterText()]),this.container.addClassName("user-box grid"),this.container.setAttribute("data-id",e.get("id")),this.container.setAttribute("data-casual",e.get("casual")),this.container.setAttribute("data-type","user"),this.container.setAttribute("data-cross-company",!e.get("licensed")),this.extendedEvents=this._initExtendedEvents(),this._injectPresence(),this},destroy:function(){return this.container&&this.container.getElement(".tile-sub-container")&&this.container.getElement(".tile-sub-container").removeEvent("click"),this._parent()},_injectPresence:function(){var t=this,n=this.model,o=e.createElement("div",{styles:{position:"absolute",bottom:-5,right:-3}});o.inject(this.container.getElement(".platform-management-header")),i.isBetaModeActivated("RTPresence")&&i.getParentModule("DS/RTPresenceAPI/RTPresenceAPI",function(e){new e({login:n.get("id"),button:!1,username:n.getUserFullName(),tenant:t.options.platform,content:o})})},_initExtendedEvents:function(){var e=this;return this.container.getElement(".tile-sub-container").addEvent("click",function(t){e._isActionElement(t.target)||e.container.hasClassName("disabled")||(e.isSelected()?(e.unSelect(),e.options.selectedCollection.remove(e.model)):(e.select(),e.options.selectedCollection.add(e.model)),e.options.onSelect&&e.options.onSelect(e.getContent(),e.model))}),!0},_isActionElement:function(e){return e.getParent(".actions-inline-container")||e.hasClassName("actions-inline-container")}})}),define("DS/PlatformManagement/Views/ConfigureNetworkInstallation",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Tooltip","DS/PlatformManagement/Utils","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/UsageTracker","DS/UIKIT/Form","DS/UIKIT/Input/ButtonGroup","DS/i3DXCompass/Tools"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h){"use strict";var g=["windows","linux","mac"],p=function(){var e=navigator.userAgent.toLowerCase(),t="unknown";return e.indexOf("windows")>-1?t=e.indexOf("windows nt 10")>-1?"windows10":"windows":e.match(/(ipad|iphone|ipod)/g)?t="ios":e.indexOf("mac")>-1?t="macos":e.indexOf("android")>-1?t="android":e.indexOf("linux")>-1&&(t="linux"),t},f=l.extend({url:"media",idAttribute:"description",model:r,parse:function(e){var t=[],n=[];return e.result.forEach(function(e){var n=e.description;t[n]?e.codeLevels.forEach(function(i){i.parentName=e.name,t[n].codeLevels.push(i)}):(e.codeLevels.forEach(function(t){t.parentName=e.name}),t[n]=e)}),Object.keys(t).forEach(function(e){var i=t[e];i.codeLevels.sort(function(e,t){return e.type<t.type?1:e.type>t.type?-1:0}),n.push(i)}),n}}),C=t.extend({tagName:"div",className:"download-installation form-section",setup:function(e){return this.platform=e.platform,this.forms=[],e},render:function(){var t=this,n=e.createElement("div");return this.forms=[],t.container.setContent([{tag:"h4",text:e.i18n("Download Installation Files")},this.buildContentInstallation(),n,this._buildNetworkSection("windows"),this._buildNetworkSection("linux")]),i.mask(n),this.collection.fetch({data:{platform:this.platform.get("id")},onComplete:function(){i.unmask(n),n.setContent(t._getTemplate())},onFailure:function(){i.unmask(n),n.setContent(t._getFailTemplate())}}),this},_buildNetworkSection:function(t){var n=new d({fields:[{type:"text",label:e.i18n("Network path"),helperText:e.i18n("Please note that users must have Read/Write access to this folder"),errorText:"windows"===t?e.i18n("Network path setting must be a valid UNC folder"):e.i18n("Network path setting must be a valid network folder"),name:"windows"===t?"folder":"folderLinux",value:("windows"===t?this.platform.get("folder"):this.platform.get("folderLinux"))||""}]});return this.forms.push(n),this.platform.isOnPremise()||!this.platform.isPlatform()?null:{html:[{tag:"h4",class:"os-"+t,text:e.i18n("Network installation files storage")},{class:"form-section os-"+t,html:[{class:"information",html:[{html:a.i18n("If your platform has multiple users, use this field to minimize the download time for installation files. Each time a user installs an app, the 3DEXPERIENCE platform looks for the needed files in this folder and use them if found. Files that are not found in the folder will be downloaded and added to the folder for future use.")},{tag:"br"},{text:"windows"===t?e.i18n("Enter a network folder UNC in the format \\\\ComputerName\\SharedFolder"):e.i18n("Enter a network folder in the format /mnt/SharedFolder")}]},n]}]}},_getTemplate:function(){var t=this,n=[];return t.collection.forEach(function(e){e.get("codeLevels").forEach(function(e){var i=g.find(function(t){return e.parentName.toLowerCase().indexOf(t.toLowerCase())>-1});-1===n.indexOf(i)&&n.push(i),p().indexOf(i.toLowerCase())>-1&&t.container.addClassName("filter-os-"+i)})}),[n.length>1?{tag:"button-os-filter",html:new u({type:"radio",buttons:n.map(function(t){return{"data-id":t,value:e.String.capitalize(t),active:p().indexOf(t.toLowerCase())>-1}}),events:{onClick:function(e,n){g.forEach(function(e){t.container.removeClassName("filter-os-"+e)}),t.container.addClassName("filter-os-"+n.options["data-id"])}}})}:null,{class:"information",html:[{text:e.i18n("You can use the files to install native apps on users' computers. This is especially useful if users do not have the access rights to install new software themselves.")}]},{html:this._getFilesTemplate()}]},buildContentInstallation:function(){var t=new n({className:"primary",type:"switch",name:"lockInstallationUpdate",value:"",label:e.i18n("Lock access to install app updates for all members"),checked:!0===this.platform.get("lockInstallationUpdate"),disabled:!0===this.platform.get("lockInstallation")});return this.platform.isPlatform()&&!this.platform.isOnPremise()?{html:[{tag:"h5",text:e.i18n("Options")},{class:"form-group",html:new n({className:"primary",type:"switch",name:"lockInstallation",value:"",label:e.i18n("Lock access to install apps for all members"),checked:!0===this.platform.get("lockInstallation"),events:{onClick:function(){this.isChecked()&&t.setCheck(this.isChecked()),t.setDisabled(this.isChecked())}}})},{class:"form-group",html:new n({className:"primary",type:"switch",name:"contentInstallation",value:"",label:e.i18n("Lock access to install optional content for all members"),checked:!1===this.platform.get("contentInstallation")})},{class:"form-group",html:t},{class:"form-group",html:new n({className:"primary",type:"switch",name:"lockUninstallation",value:"",label:e.i18n("Lock access to uninstall apps for all members"),checked:!0===this.platform.get("lockUninstallation")})}]}:null},_getDescription:function(t){return{Desktop:e.i18n("3DEXPERIENCE Natives Apps Processes Online Installation - Cloud"),DESKTOP_Cloud:e.i18n("3DEXPERIENCE Native Apps installation"),Drive:e.i18n("3DEXPERIENCE Drive for Windows installation"),xCAD_Connectors:e.i18n("Collaborative Designer for X-CAD")}[this._getStack(t)]||t.get("description")},_getStack:function(e){return e.get("codeLevels")&&e.get("codeLevels").length>0&&e.get("codeLevels")[0].stack},_bytesFormat:function(e){var t,n,i,o="",s=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];for(i=0;i<=s.length;i++)if(t=Math.pow(1e3,i),n=Math.pow(1e3,i+1),e>=t&&e<n){o+=s[i],t>0&&(e/=t);break}return Math.round(10*e)/10+o},_formatSize:function(e){return this._bytesFormat(e/1024*1e9)},_getFilesTemplate:function(){var t,n=this,i=[],a=[],l=[];return this.collection.forEach(function(r,c){var d=[];a=[{tag:"h5",text:n._getDescription(r)}],r.get("codeLevels").forEach(function(i){l=[];var r="os-"+g.find(function(e){return i.parentName.toLowerCase().indexOf(e.toLowerCase())>-1});d.push(r),i.volumes.forEach(function(t,o){l.push({text:e.String.format(e.i18n("Download - {0} ({1})"),o+1+"/"+i.volumes.length,n._formatSize(t.size)),"data-link":t.url})}),a.push({class:"level "+r,html:[{tag:"h6",class:"col-sm-8 col-xs-8",html:{tag:"ul",styles:{"list-style-type":"disc"},html:{tag:"li",text:("FULL"===i.type?e.i18n("Full"):e.i18n("Delta"))+": "+i.longName+("CODE"!==i.mediaType?" ("+i.mediaType+")":"")}}},t=new o({dropdown:l.length>1?{items:l}:null,attributes:{"data-link":i.volumes[0].url},className:"default pull-left",icon:"download",value:window.innerWidth<768?"":e.String.format(e.i18n("Download ({0})"),n._formatSize(i.volumes[0].size)),events:{onDropdownClick:function(e,t){m.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"downloadMedia",persDim:{pd1:n.platform.get("id"),pd2:i.shortName,pd3:i.longName,pd4:i.type,pd5:i.stack}}),window.open(t["data-link"])},onClick:l.length>1?function(){}:function(){m.compassInc({eventCategory:"X3DOPMR_AP",eventAction:"downloadMedia",persDim:{pd1:n.platform.get("id"),pd2:i.shortName,pd3:i.longName,pd4:i.type,pd5:i.stack}}),window.open(this.getContent().getAttribute("data-link"))}}}),{class:"clearfix"}]}),window.innerWidth<768&&new s({position:"left",trigger:"click touch",target:t.elements.icon,body:e.String.format(e.i18n("Download ({0})"),n._formatSize(i.volumes[0].size))})}),c!==n.collection.size()-1&&a.push({tag:"hr",styles:{"border-top":"1px solid #e2e4e3"}}),i.push({tag:"media",class:d.join(" "),html:a})}),i},_getFailTemplate:function(){return[{class:"text-center",html:[{styles:{margin:10},html:a.i18n("The 3DEXPERIENCE Download Platform cannot be reached")},new o({value:e.i18n("Retry"),className:"default",events:{onClick:this.render.bind(this)}})]}]}});return t.extend({tagName:"div",className:"facet-scrollable facet-config",model:null,detailElement:null,enableToggle:null,platformFolder:null,callbacks:2,setup:function(e){return this.platform=e.platform,this.listenTo(this.platform,{onChange:this.render.bind(this)}),e},render:function(){return this.container.setContent(this.getTemplate()),this.dispatchEvent("onResize"),this},save:function(){var t=this,n={},i=!1;if(n.id=this.platform.get("id"),this.getFormElement("folder")&&(n.folder=this.getFormElement("folder").value),this.getFormElement("folderLinux")&&(n.folderLinux=this.getFormElement("folderLinux").value),this.getFormElement("nativeAppsScriptBeforeLaunch")&&(n.nativeAppsScriptBeforeLaunch=this.getFormElement("nativeAppsScriptBeforeLaunch").value),this.getFormElement("nativeAppsScriptBeforeInstallation")&&(n.nativeAppsScriptBeforeInstallation=this.getFormElement("nativeAppsScriptBeforeInstallation").value),this.getFormElement("nativeAppsScriptAfterInstallation")&&(n.nativeAppsScriptAfterInstallation=this.getFormElement("nativeAppsScriptAfterInstallation").value),this.getFormElement("catEnv")&&(n.catEnv=this.getFormElement("catEnv").value),this.getFormElement("nativeAppsScriptBeforeLaunchLinux")&&(n.nativeAppsScriptBeforeLaunchLinux=this.getFormElement("nativeAppsScriptBeforeLaunchLinux").value),this.getFormElement("nativeAppsScriptBeforeInstallationLinux")&&(n.nativeAppsScriptBeforeInstallationLinux=this.getFormElement("nativeAppsScriptBeforeInstallationLinux").value),this.getFormElement("nativeAppsScriptAfterInstallationLinux")&&(n.nativeAppsScriptAfterInstallationLinux=this.getFormElement("nativeAppsScriptAfterInstallationLinux").value),this.getFormElement("catEnvLinux")&&(n.catEnvLinux=this.getFormElement("catEnvLinux").value),this.getFormElement("launcherUrl")&&(n.launcherUrl=this.getFormElement("launcherUrl").value),this.getFormElement("documentationUrl")&&(n.documentationUrl=this.getFormElement("documentationUrl").value),this.getFormElement("contentInstallation")&&(n.contentInstallation=!this.getFormElement("contentInstallation").checked),this.getFormElement("lockUninstallation")&&(n.lockUninstallation=this.getFormElement("lockUninstallation").checked),this.getFormElement("lockInstallation")&&(n.lockInstallation=this.getFormElement("lockInstallation").checked),this.getFormElement("lockInstallationUpdate")&&(n.lockInstallationUpdate=this.getFormElement("lockInstallationUpdate").checked),t.mask(),this.validateFormInputWithJavascriptFunction("folder",a.isUNC)||(i=!0),this.validateFormInputWithJavascriptFunction("folderLinux",a.isValidPathLinux)||(i=!0),this.validateFormInputWithJavascriptFunction("nativeAppsScriptBeforeLaunch",a.isValidScript)||(i=!0),this.validateFormInputWithJavascriptFunction("nativeAppsScriptBeforeLaunchLinux",a.isValidScriptLinux)||(i=!0),this.validateFormInputWithJavascriptFunction("nativeAppsScriptBeforeInstallation",a.isValidScript)||(i=!0),this.validateFormInputWithJavascriptFunction("nativeAppsScriptBeforeInstallationLinux",a.isValidScriptLinux)||(i=!0),this.validateFormInputWithJavascriptFunction("nativeAppsScriptAfterInstallation",a.isValidScript)||(i=!0),this.validateFormInputWithJavascriptFunction("nativeAppsScriptAfterInstallationLinux",a.isValidScriptLinux)||(i=!0),this.validateFormInputWithJavascriptFunction("catEnv",a.isValidFilePathTxt)||(i=!0,this.getRightErrorMessageWindows(n.catEnv)),this.validateFormInputWithJavascriptFunction("catEnvLinux",a.isValidFilePathTxtLinux)||(i=!0,this.getRightErrorMessageLinux(n.catEnvLinux)),this.validateFormInputWithJavascriptFunction("documentationUrl",a.isHttpsUrl)||(i=!0),this.validateFormInputWithJavascriptFunction("launcherUrl",a.isHttpsUrl)||(i=!0),i)t.unmask();else{var o=this.platform.get("documentationUrl")||"";this.container.getElements(".form-control").forEach(function(e){e.hasClassName("error")&&e.removeClassName("error")}),this.platform.save(n,{patch:!0,onComplete:function(n){t.unmask(),void 0!==n.documentationUrl&&n.documentationUrl!==o?c.success(e.i18n("Settings have been saved, 3DEXPERIENCE User Assistance setting may need a browser's refresh to be applied")):c.success(e.i18n("Settings have been saved"))},onFailure:function(e,n){t.unmask(),n.message&&c.warn(n.message)}})}},getFormElement:function(e){return this.container.getElement('[name="'+e+'"]')},getRightErrorMessageWindows:function(t){this.container.getElement('[name="catEnv"]').addClassName("error"),this.container.getElement('[name="catEnv"]').getParent().addClassName("has-error"),t.endsWith(".txt")?this.container.getElements(".form-control-error-text")[1].setText(e.i18n("Native Apps Environment Configuration File must be a valid path")):this.container.getElements(".form-control-error-text")[1].setText(e.i18n("Native Apps Environment Configuration File extension must be .txt"))},getRightErrorMessageLinux:function(t){this.container.getElement('[name="catEnvLinux"]').addClassName("error"),this.container.getElement('[name="catEnvLinux"]').getParent().addClassName("has-error"),t.endsWith(".txt")?this.container.getElements(".form-control-error-text")[5].setText(e.i18n("Native Apps Environment Configuration File must be a valid path")):this.container.getElements(".form-control-error-text")[5].setText(e.i18n("Native Apps Environment Configuration File extension must be .txt"))},validateFormInputWithJavascriptFunction:function(e,t){var n=this.forms.detect(function(t){return t.getField(e)}),i=!0;if(n){var o=n.getField(e);o&&(o.value&&""!==o.value&&(i=t(o.value)),o.getParent(".form-group").toggleClassName("has-error",!i))}return i},getTemplate:function(){var t,n=this,i=new C({platform:this.platform,collection:new f});return this.forms=[],t=[this.platform.isOnPremise()||!this.platform.isPlatform()?null:i.render(),this._buildLauncherConfigurationSection(),this._buildDocumentationSection(),this._buildNativeApplicationSection(),{class:"footer",html:[new o({value:e.i18n("Cancel"),className:"pull-right default",events:{onClick:n.render.bind(n)}}),new o({value:e.i18n("Save"),className:"pull-right primary",events:{onClick:this.save.bind(this)}}),{class:"clearfix"}]},{html:[{tag:"br"}]}],i&&i.forms&&i.forms.forEach(function(e){n.forms.push(e)}),t},_buildLauncherConfigurationSection:function(){var t=new d({fields:[{type:"text",label:e.i18n("URL"),placeholder:"http://127.0.0.1",helperText:e.i18n("Please note that this setting will override 3DEXPERIENCE platform default's"),errorText:e.i18n("3DEXPERIENCE launcher setting must be a valid secure url"),name:"launcherUrl",value:this.platform.get("launcherUrl")||""}]});return this.forms.push(t),this.platform.isOnPremise()?{html:[{tag:"h4",text:e.i18n("3DEXPERIENCE launcher setting")},t]}:null},_buildDocumentationSection:function(){var t=new d({fields:[{type:"text",label:e.i18n("URL"),placeholder:"https://help.3ds.com",helperText:e.i18n("Please note that this setting will override 3DEXPERIENCE platform default's"),errorText:e.i18n("3DEXPERIENCE User Assistance setting must be a valid secure url"),name:"documentationUrl",value:this.platform.get("documentationUrl")||""}]});return this.forms.push(t),this.platform.isOnPremise()||this.platform.isVPC()?{html:[{tag:"h4",text:e.i18n("3DEXPERIENCE User Assistance setting")},t]}:null},_buildForm:function(t){var n="windows"===t?"catEnv":"catEnvLinux",i="windows"===t?"nativeAppsScriptBeforeLaunch":"nativeAppsScriptBeforeLaunchLinux",o="windows"===t?"nativeAppsScriptBeforeInstallation":"nativeAppsScriptBeforeInstallationLinux",s="windows"===t?"nativeAppsScriptAfterInstallation":"nativeAppsScriptAfterInstallationLinux",a=[{type:"text",label:e.i18n("Environment Configuration File"),placeholder:e.i18n("Default installation configuration path location"),helperText:e.i18n("Please note that the user must have read access to this folder"),errorText:e.i18n("Native Apps Environment Configuration File must be a valid path"),name:n,value:this.platform.get(n)||""}];return this.platform.isOnPremise()||(a.push({type:"text",label:e.i18n("Script to execute before launch"),placeholder:"windows"===t?e.i18n("Example: before_launch.bat"):e.i18n("Example: before_launch.bat").replace(".bat",".sh"),helperText:e.i18n("File must be located within the 'CustomerScripts' directory of the 3DExperience Launcher installation"),errorText:e.i18n("Native Applications script must be a valid filename"),name:i,value:this.platform.get(i)||""}),a.push({type:"text",label:e.i18n("Script to execute before installation / update"),placeholder:"windows"===t?e.i18n("Example: before_installation.bat"):e.i18n("Example: before_installation.bat").replace(".bat",".sh"),helperText:e.i18n("File must be located within the 'CustomerScripts' directory of the 3DExperience Launcher installation"),errorText:e.i18n("Native Applications script must be a valid filename"),name:o,value:this.platform.get(o)||""}),a.push({type:"text",label:e.i18n("Script to execute after installation / update"),placeholder:"windows"===t?e.i18n("Example: after_installation.bat"):e.i18n("Example: after_installation.bat").replace(".bat",".sh"),helperText:e.i18n("File must be located within the 'CustomerScripts' directory of the 3DExperience Launcher installation"),errorText:e.i18n("Native Applications script must be a valid filename"),name:s,value:this.platform.get(s)||""})),new d({className:"os-"+t,fields:a})},_buildNativeApplicationSection:function(){var t=this._buildForm("windows"),n=this._buildForm("linux"),i=["windows","linux"],o="windows";return this.forms.push(t),this.forms.push(n),i.forEach(function(e){p().indexOf(e.toLowerCase())>-1&&(o=e)}),{tag:"parameters",class:"filter-os-"+o,html:[{tag:"h4",text:e.i18n("Apps Parameters")},{tag:"button-os-filter",html:new u({type:"radio",buttons:i.map(function(t){return{"data-id":t,value:e.String.capitalize(t),active:p().indexOf(t.toLowerCase())>-1}}),events:{onClick:function(e,t){this.getContent().getParent("parameters").removeClassName("filter-os-windows").removeClassName("filter-os-linux").addClassName("filter-os-"+t.options["data-id"])}}})},t,n]}},getBody:function(){return this.content||(this.content=this.container),this.content},mask:function(){this.isMasked()||(i.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(i.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Views/CreditAndTokenRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event"],function(e,t,n,i,o,s,a){"use strict";return t.extend({tagName:"tr",className:"credits-tokens",setup:function(){return this.firstRender=!0,this.listenTo(this.model,{onChange:this.render}),this.container.setAttribute("data-id",this.model.get("id")),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this},createContent:function(){var e=this.model,t=this.options.getTileSubtitle?this.options.getTileSubtitle(e):null;return[{tag:"td",styles:{"text-align":"center"},html:[{class:"img-wrapper",html:{tag:"i",class:this.options.icon}}]},{tag:"td",html:[{tag:"span",text:n.getTextFromHtml(e.get("name")+" ("+e.get("trigram")+")")},t?{tag:"span",html:" "+t}:null]},{class:"center",tag:"td",html:this._getUsed()},{class:"center",tag:"td",text:e.get("expire")}]},_getUsed:function(){var t="",n=this.model;return t+=e.String.format("{0}/{1}",n.get("total")-n.get("free"),n.get("total"))}})}),define("DS/PlatformManagement/Utils/Ajax",["UWA/Core","UWA/Class","UWA/Data","DS/PlatformManagement/Controls/PlatformNotify","UWA/Class/Options","DS/PlatformManagement/Utils","UWA/Storage","DS/WAFData/WAFData","UWA/Storage/Adapter/Dom"],function(e,t,n,i,o,s,a,l){"use strict";return t.extend(o,{defaultOptions:{url:"",callbacks:{},params:{}},init:function(e){this.setOptions(e)},request:function(t,n,o,a){var r,c,m={Accept:"application/json","Accept-Language":s.getLang()},d="passport",u=function(t){"function"==typeof o.onFailure?o.onFailure.apply(this,arguments):(e.log("ERROR"),e.log(t))};return a=a||"GET",null===(n=e.merge({os:s.detectOs()},n)).proxy?d=null:n.proxy&&(d=n.proxy),r=n,"POST"!==a&&"PUT"!==a&&"DELETE"!==a||(m["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8"),m["X-Utc-Offset"]=s.getTimezoneOffset(),"passport"===(c={timeout:15e3,method:a,type:n.responseType||"json",headers:m,proxy:d,data:r,cache:-1,onComplete:function(t){var n;t.code&&"0"!==t.code&&"2"!==t.code||t.error?(n=t.message&&""!==t.message?t.message:t.error&&t.error.type?t.error.type:t.error?t.error:t,t.error&&"java.net.SocketTimeoutException: Read timed out"===t.error.status&&i.warn(e.i18n("Action is still pending... Please wait a few seconds and refresh your widget")),"function"==typeof o.onFailure?o.onFailure(t):i.alert(n)):"function"==typeof o.onComplete&&o.onComplete(t)},onFailure:u,onTimeout:function(t){i.warn(e.i18n("Action is still pending... Please wait a few seconds and refresh your widget")),u(t)}}).proxy?l.authenticatedRequest(t,c):l.request(t,c)},get:function(){return this.request(this.options.url,this.options.params,this.options.callbacks,"GET")},post:function(){return this.request(this.options.url,this.options.params,this.options.callbacks,"POST")},put:function(){this.request(this.options.url,this.options.params,this.options.callbacks,"PUT")},doDelete:function(){return this.request(this.options.url,this.options.params,this.options.callbacks,"DELETE")},create:function(){return this.post()},update:function(){return this.put()}})}),define("DS/PlatformManagement/Model/UserGroupModel",["UWA/Core","DS/PlatformManagement/Model/MemberDetailsModel","DS/WebappsUtils/WebappsUtils","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data"],function(e,t,n,i,o){"use strict";return t.extend({addLicense:function(e,t,n,i,s){var a=t.canCrossCompany()?[{id:e.get("uid"),licensed:i.get("licensed"),restricted:i.get("restricted")}]:[{id:e.get("uid")}];o.createLicensesGroup({group:n.get("uuid"),label:n.get("label"),licenses:JSON.stringify(a),type:e.getType(),users:i.getUserId(),platform:t.getId()},s)},updateLicense:function(e,t,n,i,s){o.updateLicensesGroup({group:n.get("uuid"),label:n.get("label"),licenses:JSON.stringify(e.getId()),users:i,type:e.getType(),platform:t.getId()},s)}})}),define("DS/PlatformManagement/Views/StepsView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Views/StepView"],function(e,t,n){"use strict";return t.extend({tagName:"div",className:"create-steps-view-container",render:function(){var e=this,t=[],i=(this.collection.size(),this.options.stepNumber),o=void 0===i?0:i-1;this.collection.forEach(function(i,s){var a;a=new n({model:i,stepIndex:o,index:s}).render(),e._refreshModel(o,s,i,a),t.push(a)});var s=[{tag:"div",class:"ariane-line-container",html:[{tag:"div",class:"ariane-line"},{tag:"div",class:"ariane-line-progress"}]},t];return this.container.setContent(s),this},_refreshModel:function(e,t,n,i){var o=this.getContent().getElements(".step-label");e===t?(n.set("active",!0),n.unset("validated"),0!==o.length&&o[t].addClassName("blue-label")):e>t?(n.unset("active"),n.set("validated",!0),0!==o.length&&o[t].addClassName("blue-label")):(n.unset("validated"),n.unset("active"),0!==o.length&&o[t].removeClassName("blue-label")),void 0===i&&this._setProgressLine()},_setIconIndicator:function(e,t){var n=this.getContent().getElements(".nav-item-icon-indicator");null!==n&&(e===this.collection.length&&t===e-1?n[t].setStyle("visibility","visible"):n[t].setStyle("visibility",e===t?"visible":"hidden"))},_setProgressLine:function(){var e=100/this.collection.length,t=this.getContent().getElement(".ariane-line-progress"),n=this.getContent().getElements(".validated"),i=this.getContent().getElements(".active"),o=this.collection.length;if(n.length===o.length-1&&1===i.length)t.setStyle("width","100%");else if(0===n.length&&1===i.length)t.setStyle("width",e+"%");else if(0!==n.length&&n.length!==o.length-1){var s=e*(n.length+i.length)+"%";t.setStyle("width",s)}},setStep:function(e){var t=this,n=void 0===e?0:e-1;return this.collection.forEach(function(e,i){t._refreshModel(n,i,e),t._setIconIndicator(n,i)}),this}})}),define("DS/PlatformManagement/Views/OldMembersView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Utils","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/OldMembersCollection","DS/PlatformManagement/Model/OldMembersModel","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Loader","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformAPI/PlatformAPI","UWA/Event","DS/UIKIT/SuperModal","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/UIKIT/Touch","DS/UIKIT/Input/Toggle","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/PlatformManagement/Controls/ButtonFab","DS/PlatformManagement/Views/UserRowView","DS/PlatformManagement/Utils/SpriteManager","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D){"use strict";return t.extend({forceRefreshView:!1,selectedCollection:new s,touchPagerEvent:null,nbSelected:0,nbDeleted:0,noPage:1,lastCollection:null,setup:function(e){this.collection=new s,this.buildContainer()},render:function(){this.collection.getMaxLimit()>0||this.forceRefreshView?(this.lastCollection=new s(this.collection.toJSON()),this.lastCollection.setLimit(this.collection.options.data.limit),this.lastCollection.setSortDirection(this.collection.options.data.sort_direction),this.lastCollection.setSortField(this.collection.options.data.sort),this.lastCollection.setPlatform(this.collection.options.data.platform),this.getBody().setContent(this.buildContent())):0===this.collection.getMaxLimit()&&this.collection.isQueryEmpty()?(this.getBody().setContent(this.buildContent()),this.elements.container.setContent(this.buildNoResultSearch())):(this.collection.setQuery(null),this.setTitle(e.i18n("No result found")),this.collection=this.lastCollection),this.unmask(),this.forceRefreshView=!1,this.options.onRefresh&&this.options.onRefresh()},buildNoResultSearch:function(){return[(new P).render()]},search:function(e){this.collection.setOffset(0),this.collection.setQuery(e),this.refresh()},refresh:function(e){this.setOptions(e),this.nbSelected=0,this.nbDeleted=0,e&&e.params&&this.collection.setParams(e.params),this.isRefresh=!0,this.buildContainer()},getSwymUrl:function(){return""!==this.options.platform.get("swym")?this.profileUrl=this.options.platform.get("swym"):!this.profileUrl&&this.options.platform.collection?this.profileUrl=this.options.platform.collection.at(0).get("swym"):this.profileUrl="",this.profileUrl},buildContainer:function(){var t=this;this.elements.container||(this.elements.container=e.createElement("div",{class:"member-list-wrapper"}),t.elements.container.setContent({class:"empty-body"})),this.mask(),this.options.platform&&null!==this.options.platform&&o.fetch({onComplete:function(){t.collection.setLimit(o.get("membersMaxPerPage")),t.collection.setSortDirection(o.get("membersSortDirection")),t.collection.setSortField(o.get("membersSortField")),t.collection.setPlatform(t.options.platform.get("id")),t.collection.fetch({onComplete:function(){t.render()},onFailure:function(){t.render()}})}})},buildContent:function(){var e=[];return e.push(this.buildHeaderList()),e.push({class:"pm-grid-container layout-table",html:[this.createTableView(),this.buildPager()]}),this.initTouchPager(),e},createTableView:function(){var t=this,n=new y({url:t.getSwymUrl()}),i=this.collection.map(function(e){return n.addItem(e.getSpriteItem()),t.getRow(e)});return this.isRefresh=!1,""!==t.getSwymUrl()&&o.shouldLoadPicture()&&i.forEach(function(e,t){n.spritifyElement(e.getElement("img"),t)}),[{tag:"table",class:"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:e.i18n("First Name")},{tag:"td",text:e.i18n("Last Name")},{tag:"td",text:e.i18n("E-mail")},{tag:"td",text:e.i18n("Removed by")},{tag:"td",text:e.i18n("Removed on")},{tag:"td",text:e.i18n("Pseudonymised")}]},{tag:"tbody",html:i}]}]},getPseudonymised:function(t){var n,i=this;return t.isAnonymised()?n={tag:"span",text:e.i18n("Yes"),styles:{color:"#57B847","text-align":"center"}}:(n=e.createElement("span",{class:"fonticon fonticon-eye-off",styles:{cursor:"pointer","text-align":"center"},events:{click:function(e){i.showAnonimizeModal("Pseudonymised",t)}}}),new h({target:n,position:"bottom",body:e.i18n("Pseudonymise Member")})),n},getRow:function(t){var n=this,i=t.get("id"),o=(t.isAnonymised(),!1);if(0!==this.selectedCollection.length&&!1===this.isRefresh)for(var s=0;s<this.selectedCollection._models.length;s++){if(this.selectedCollection._models[s].getUserId()===t.get("id")){o=!0,this.container.addClassName("selected");break}o=!1,this.container.hasClassName("selected")&&this.container.removeClassName("selected")}var a=new f({className:"primary inline",type:"checkbox",name:"subscriptions[]",value:i,id:i,label:"",checked:o});return e.createElement("tr",{class:"tr-"+i,"data-type":"user",html:[{tag:"td",html:[a,{class:"img-wrapper",styles:{"vertical-align":"middle"},html:{tag:"img",styles:{height:"100%",float:"right"},src:this.createImage(t)}}]},{tag:"td",class:"text-ellipsis",html:t.get("firstname")},{tag:"td",class:"text-ellipsis",html:t.get("lastname")},{tag:"td",class:"text-ellipsis",html:t.get("email")},{tag:"td",class:"text-ellipsis",html:t.get("deletedBy"),styles:{color:"#EA4F37"}},{tag:"td",class:"text-ellipsis",html:t.get("deletedOn"),styles:{color:"#EA4F37"}},{tag:"td",class:"status",html:this.getPseudonymised(t),styles:{"text-align":"center"}}],styles:{cursor:"pointer"},events:{click:function(e){if(d.stop(e),!e.target.hasClassName("fonticon-eye-off")){var i=!a.isChecked();a.setCheck(i),!0===i?n.selectedCollection.add(t):n.selectedCollection.remove(t),n.initChecked()}}}})},setTitle:function(t){this.getBody().getElement("h5")&&this.getBody().getElement("h5").setText(e.String.format(e.i18n("Removed members | {0}"),t))},buildTitle:function(t){return{tag:"h5",html:[{tag:"i",class:"fonticon fonticon-users-delete"},{tag:"span",text:e.String.format(e.i18n("Removed members | {0}"),t)}]}},initTouchPager:function(){var e,t=this;!this.touchPagerEvent&&t.pager&&(this.touchPagerEvent=!0,(e=new p(t.getBody())).on("swipeleft",function(){t.collection.hasNext()&&(t.collection.setOffset(t.collection.getNextOffset()),t.pager.setOffset(t.collection.getOffset()))}),e.on("swiperight",function(){t.collection.hasPrevious()&&(t.collection.setOffset(t.collection.getPreviousOffset()),t.pager.setOffset(t.collection.getOffset()))}))},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?this.pager=new n({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.collection.fetch({onComplete:function(){e.render()}})}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(g.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(g.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked},setStatus:function(e,t){var n=e?this.getContent().getElement(".tr-"+i.escapeDomSelector(e.get("id"))+" .status"):this.getBody();return n&&n.setContent(t),!0},setLoadingStatus:function(e){var t=e?new v({visible:!0}):new r;this.setStatus(e,t)},resetStatus:function(t){var n;t.isAnonymised()&&(n={tag:"span",text:e.i18n("Yes"),styles:{color:"#57B847","text-align":"center"}},this.setStatus(t,n))},createImage:function(e){var t;return""!==this.getSwymUrl()&&o.shouldLoadPicture()?(t=i.getAsset("s.gif"),this.firstRender=!1):t=e.getProfile(o.shouldLoadPicture(),this.getSwymUrl()),t},showAnonimizeModal:function(t,n){var i,o=this,s=new u({closable:!1,className:"modal-no-warper platform-management-confirm-modal"}),a=!n,l=!a&&n.get("id"),r=a?[]:[l],m=a?[]:[n.cid],d=!!a&&o.elements.container.getElements('[data-type="user"] input');t="Pseudonymised"!==t&&"Deleted"!==t?"Pseudonymised":t,d&&(d.forEach(function(e){e.checked&&"Deleted"!==t&&!o.collection.get(e.id).isAnonymised()?(r.push(e.id),m.push(o.collection.get(e.id))):e.checked&&"Deleted"===t&&o.collection.get(e.id).isAnonymised()&&(r.push(e.id),m.push(o.collection.get(e.id)))}),r[0]&&(n=o.collection.get(r[0]))),i="Pseudonymised"===t?a&&this.nbSelected>1?e.String.format(e.i18n("Are you sure you want to pseudonymise these members: {0}? Once executed, this action is irreversible."),m.map(function(e){return e.get("firstname")+" "+e.get("lastname")}).join(", ")):e.String.format(e.i18n("Are you sure you want to pseudonymise {0} {1}? Once executed, this action is irreversible."),n.get("firstname"),n.get("lastname")):a&&this.nbDeleted>1?e.String.format(e.i18n("Are you sure you want to delete these members: {0}? Once executed, this action is irreversible."),m.map(function(e){return e.get("firstname")+" "+e.get("lastname")}).join(", ")):e.String.format(e.i18n("Are you sure you want to delete {0} {1}? Once executed, this action is irreversible."),n.get("firstname"),n.get("lastname")),s.confirm(i,e.i18n("Confirmation"),function(e){if(e){for(var i=0;i<r.length;i++)n=o.collection.get(r[i]),o.setLoadingStatus(n);"Pseudonymised"===t?n.save({users:JSON.stringify(r)},{patch:!0,onComplete:function(e,t){for(var i=0;i<r.length;i++)(n=o.collection.get(r[i])).set("anonymised",!0),o.resetStatus(n);o.initChecked(),c.success(t.message),o.refresh()},onFailure:function(e,t){o.unmask(),c.alert(t.message),o.initChecked(),o.refresh()}}):"Deleted"===t&&n.destroy({data:{id:o.options.platform.get("id"),users:JSON.stringify(r)},wait:!0,onComplete:function(e,t){c.success(t.message),o.initChecked(),o.refresh()},onFailure:function(e,t){o.unmask(),c.alert(t.message),o.initChecked(),o.refresh()}})}else o.unmask()})},getModelUserSelected:function(e){var t=!1,n="Deleted"===e,i=this;return(n&&1===this.nbDeleted||!n&&1===this.nbSelected)&&this.elements.container.getElements('[data-type="user"] input').forEach(function(e,o){if(!t&&e.checked){if(n&&i.collection.get(e.id).isAnonymised())return t=i.collection.get(e.id),!0;if(!n&&!i.collection.get(e.id).isAnonymised())return t=i.collection.get(e.id),!0}}),t},buildHeaderList:function(){return this.headerList=new D({icon:"users-delete",label:e.i18n("Removed members | {0}"),collection:this.collection,searchLabel:e.i18n("Search Members"),isSearchOpen:""!==this.collection.getQuery()&&null!==this.collection.getQuery(),iconbarRefresh:!1,iconBarConfig:{items:[{fonticon:"mouse-pointer-check",text:e.i18n("Manage Selection"),name:"manage-selection-legal",content:{type:"dropdownmenu",options:{items:this.buildItemManageSelection(),events:{onClick:this._manageSelection.bind(this)}}}}]},events:{search:this.search.bind(this)}}),this.headerList.render()},buildItemManageSelection:function(){return this.nbSelected>0&&this.nbDeleted>0?[{action:"select-all",fonticon:"files-check",text:e.i18n("Select all")},{action:"deselect-all",fonticon:"files-times",text:e.i18n("Unselect all")},{action:"anonymised-all-members",fonticon:"eye-off",className:"selected",text:e.i18n("Pseudonymise Selected Members")},{action:"delete-all-members",fonticon:"users-times",className:"selected",text:e.i18n("Delete Selected Members")}]:this.nbSelected>=1&&this.nbDeleted<1?[{action:"select-all",fonticon:"files-check",text:e.i18n("Select all")},{action:"deselect-all",fonticon:"files-times",text:e.i18n("Unselect all")},{action:"anonymised-all-members",fonticon:"eye-off",className:"selected",text:e.i18n("Pseudonymise Selected Members")}]:this.nbDeleted>=1&&this.nbSelected<1?[{action:"select-all",fonticon:"files-check",text:e.i18n("Select all")},{action:"deselect-all",fonticon:"files-times",text:e.i18n("Unselect all")},{action:"delete-all-members",fonticon:"users-times",className:"selected",text:e.i18n("Delete Selected Members")}]:[{action:"select-all",fonticon:"files-check",text:e.i18n("Select all")},{action:"deselect-all",fonticon:"files-times",text:e.i18n("Unselect all")}]},_manageSelection:function(e,t){if("select-all"===t.action||"deselect-all"===t.action)this._manageSelectionFilter(e,t);else if("anonymised-all-members"===t.action){var n=this.getModelUserSelected("Pseudonymised");this.showAnonimizeModal("Pseudonymised",n)}else if("delete-all-members"===t.action){n=this.getModelUserSelected("Deleted");this.showAnonimizeModal("Deleted",n)}},_manageSelectionFilter:function(e,t){var n=this,i=n.elements.container.getElements('[data-type="user"] input:not([disabled])'),o=n.collection._models;n.getContent().getElement(".iconBarDeleteMembers");t.hasClassName("selected")&&t.elements.container.removeClassName("selected"),"select-all"===t.action?(n.headerList.removeFontIcon(t.className,"fonticon-mouse-pointer-check").addFontIcon(t.className,"fonticon-files-check").activateIcon(t.className),i&&(i.forEach(function(e,t){e.checked||(e.checked=!0)}),o.forEach(function(e){n.selectedCollection.add(e)},n))):(n.headerList.removeFontIcon(t.className,"fonticon-files-check").addFontIcon(t.className,"fonticon-mouse-pointer-check").deactivateIcon(t.className),n.elements.container.getElements('[data-type="user"].selected').invoke("removeClassName","selected"),i&&(i.forEach(function(e,t){e.checked&&(e.checked=!1)}),o.forEach(function(e){n.selectedCollection.remove(e)},n)))},showDeleteUser:function(){this.render()},initChecked:function(){var e=this;e.nbDeleted=0,e.nbSelected=0,this.elements.container.getElements('[data-type="user"] input').forEach(function(t,n){if(t.checked){var i=e.collection.get(t.id);i&&(i.isAnonymised()?e.nbDeleted++:e.nbSelected++)}}),this.showDeleteUser()}})}),define("DS/PlatformManagement/Collection/CompaniesCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection"],function(e,t){"use strict";return t.extend({url:"companies",parse:function(e){return e.data}})}),define("DS/PlatformManagement/Collection/UserGroupCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/UserGroupModel"],function(e,t,n){"use strict";return t.extend({url:"group/members",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data||e.roles}})}),define("DS/PlatformManagement/Views/FacetOldMembersView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/OldMembersCollection","DS/PlatformManagement/Model/OldMembersModel","DS/PlatformManagement/Views/OldMembersView","DS/UIKIT/SuperModal","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Loader","DS/PlatformManagement/Controls/PlatformNotify","UWA/Event","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/ButtonFab"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h){"use strict";return t.extend({tagName:"div",className:"Data-Privacy-Wrapper",setup:function(e){return e.platform&&(this.platform=e.platform),e.taggerProxy&&(this.taggerProxy=e.taggerProxy),e},render:function(){return this.oldMemberslist=new a({platform:this.platform,offset:0,page:1}),this.container.setContent([this.oldMemberslist.getContent()]),this}})}),define("DS/PlatformManagement/Controls/Tags",["UWA/Core","UWA/Controls/Abstract","UWA/Event","DS/UIKIT/Input/Text","DS/UIKIT/Touch","DS/UIKIT/Spinner","DS/PlatformManagement/Utils"],function(e,t,n,i,o,s,a){"use strict";return t.extend({defaultOptions:{text:null,onChange:function(){},onDestroy:function(){}},init:function(e){this._parent(e),this.buildContainer()},destroy:function(){this.options.onDestroy(),this._parent()},processChange:function(t,n){if(e.is(n.getParent("div"))){var i=-1===this.getSelected().indexOf(t);this.options.validator(t)&&i?(this.options.text=t,n.getParent("div").removeClassName("has-error"),this.getContent().setContent(this.setReadInput()),this.asyncCheck()):(n.focus(),e.log(n),n.getParent("div").hasClassName("has-error")||n.getParent("div").addClassName("has-error"),console.log("value",t),console.log("old Value",this.oldValue),t!==this.oldValue&&(this.options.onError(),this.oldValue=t))}},setEditInput:function(){var t=this;this.input=new i({value:this.options.text,attributes:{type:"email",styles:{width:t.getContent().getSize().width},events:{keyup:function(e){e.preventDefault(),e.stopPropagation(),13===e.keyCode&&t.processChange(this.value,this)},blur:function(n){var i=this;n.preventDefault(),n.stopPropagation(),e.is(i)&&setTimeout(function(){t.processChange(i.value,i)},100)}}}}),this.getContent().setContent(this.input),this.input.focus()},getButton:function(){var t=this;return this.button||(this.button=e.createElement("button",{class:"btn btn-default",html:{tag:"span",class:"fonticon fonticon-cancel"},events:{click:function(e){this.getElement(".fonticon").hasClassName("fonticon-cancel")&&(t.destroy(),n.stop(e))}}})),{tag:"span",class:"input-group-btn",html:this.button}},getInputText:function(){var t=this;return this.inputText=e.createElement("span",{class:"form-control",text:this.options.text,events:a.isTouchActivate()?null:{dblclick:function(){t.setEditInput()}}}),a.isTouchActivate()&&(this.touch=new o(this.inputText).on("press",function(e){e.preventDefault(),n.stopPropagation(e),t.setEditInput()})),this.inputText},setReadInput:function(){return e.createElement("div",{class:"input-group",html:[this.getInputText(),this.getButton()]})},buildContainer:function(){this.elements.container=e.createElement("div",{class:"uwa-input-tags uwa-input",html:this.setReadInput()})},setLoading:function(e){var t=this.button.getElement(".fonticon");e?(t.removeClassName("fonticon-cancel"),this.button.addClassName("is-loading"),new s({visible:!0}).inject(t)):(this.button.removeClassName("is-loading"),t.addClassName("fonticon-cancel"),t.setContent(""))},setError:function(e){var t=this.inputText.getParent("div");e?t.hasClassName("has-error")||t.addClassName("has-error"):t.removeClassName("has-error"),this.options.onChange()},asyncCheck:function(){var e=this;this.options.validatorAsync&&(this.setLoading(!0),this.options.syncInputSize(),this.options.validatorAsync(this.inputText.getText(),{onComplete:function(){e.getContent().setContent(e.setReadInput()),e.setLoading(),e.setError(!1),e.options.syncInputSize()},onFailure:function(){e.setLoading(),e.setError(!0),e.options.syncInputSize()}}))},getSelected:function(){var e=[];return this.elements.container.getParent().getElements(".uwa-input-tags span.form-control").forEach(function(t){e.push(t.getHTML())}),e}})}),define("DS/PlatformManagement/Modal/PlatformInformationModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Class/Collection","UWA/Class/Model","UWA/Controls/Input","UWA/Event","DS/UIKIT/Modal","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Form","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Scroller","DS/UIKIT/Input/File","DS/UIKIT/DropdownMenu","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/IdCard","DS/PlatformManagement/Utils","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Views/FacetOldMembersView","DS/PlatformManagement/Controls/PlatformNotify","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils/FCSManager","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Views/DiskView","DS/PlatformManagement/UsageTracker","DS/PlatformManagement/Views/HelperText"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M,k,I,T,A){"use strict";var U,L=E.extend({url:"platform/legal",idAttribute:"platform",defaults:{dp:"",tos:"",legalInfos:"",defaultLegalLanguage:"",legalMessages:"",notifyCookies:!1,defaultCookiesLanguage:"",cookiesMessages:"",cookies:"",cookiesValidity:12},getJsonValue:function(e){var t=this.get(e),n={};try{n=JSON.parse(t)}catch(e){}return n}}),N=n.extend({defaultOptions:{maxLength:400},init:function(e){this._parent(e),this.elements={}},getContent:function(){return this.buildSkeleton(),this._parent()},buildId:function(e){return this.options.type+"-"+e},buildSkeleton:function(){var t,n,i,o,s,l,r,c,m,u,g,f=this,C=this.options.maxLength,b=this.options.data,w=b.messages,y=b.defaultLanguage,S=U.getSupportedLanguages(),x=[],P=[],D=this.elements;function E(){c.setValue(c.getValue().replace(/\n|\r/g,""))}for(t in S)S.hasOwnProperty(t)&&(i=(n=S[t]).localizedName+" ("+n.staticName+")",t===y,x.push({value:t,label:i,selectable:!0}),P.push({text:t.toUpperCase(),id:this.buildId(t),lang:t,selectable:!0,selected:"en"===t}));this.messageTextLanguage=y,(l=new p({placeholder:!1,options:x,id:this.buildId("language"),className:"default-language-group",events:{onChange:function(){f.showLanguage(this.getValue())}}})).elements.handle.addClassName("select-handle-language"),l.elements.input.setStyles({width:"93%"}),l.elements.dropdown.setStyles({width:"93%"}),s=new d({value:e.i18n("Language (EN)"),icon:"expand-down right"}),o=new v({target:s.getContent(),multiselect:!0,renderTo:document.querySelector(".legal-notice"),items:P,events:{onClick:function(e){f.showLanguage(e.target.innerText,e.target)}}}),r=e.createElement("span",{text:e.String.format(e.i18n("Max. {0} characters; {1} characters left"),C,C-(w[y]||"").length)}),m=e.createElement("div",{class:"default-language-group",html:[{class:"label-group",html:[{tag:"label",html:e.i18n("Message"),for:this.buildId("message")},s]}]}),u=new h({fields:[{type:"select",label:e.i18n("Default language"),className:"select-default-language",helperText:e.i18n("Used if message is not available in other languages"),placeholder:!1,options:x,id:this.buildId("language"),events:{onChange:function(){f.showLanguage(this.getValue())}}}]}),g=new h({fields:[{className:"default-language-group",helperText:e.String.format(e.i18n("Max. {0} characters; {1} characters left"),C,C-(w[y]||"").length),errorText:e.i18n("The message for the default language can't be empty when a file is uploaded."),multiline:!0,rows:4,maxlength:C,value:w[y]||"",id:this.buildId("message"),events:{onKeyDown:function(e){setTimeout(function(){var t=a.whichKey(e),n=f.elements.container.getElement("textarea").value;"return"!==t&&"shift+return"!==t||e.preventDefault(),f.updateMessageCharInfo(n)},0)},onChange:function(e){var t=f.elements.container.getElement("textarea").value;f.updateMessageCharInfo(t)},onDrop:function(){setTimeout(function(){E(),f.updateMessageCharInfo()},0)},onPaste:function(){setTimeout(function(){E(),f.updateMessageCharInfo()},0)}}}]}),D.container=e.createElement("div",{class:"message-form",html:[u,m,g]}),D.messageFormGroup=m,D.defaultLanguageSelect=l,D.defaultLanguageForm=u,D.languageDropdownButton=o,D.messageCharInfo=r,D.defaultLanguageForm=u,D.textareaMessage=g},updateMessageCharInfo:function(t){var n=this.options.maxLength,i=this.elements;"string"!==e.typeOf(t)&&(t=this.elements.container.getElement("textarea").value.trim()),i.container.getElements(".form-control-helper-text")[1].setText(e.String.format(e.i18n("Max. {0} characters; {1} characters left"),n,n-t.length))},getValues:function(){var e=this.options.data.messages,t=this.elements;return e[this.messageTextLanguage]=this.elements.container.getElement("textarea").value.trim(),{defaultLanguage:t.defaultLanguageSelect.getValue()[0],messages:e}},showLanguage:function(t,n){var i=this.buildId(t),o=(this.elements.textareaMessage,this.options.data.messages),s=this.elements.languageDropdownButton;e.Array.detect(s.items,function(e){return e.id===i});o[this.messageTextLanguage]=this.elements.container.getElement("textarea").value.trim(),this.messageTextLanguage=t,this.elements.container.getElement("textarea").value=o[t]||"",this.elements.container.getElement(".btn-with-icon").childNodes[1].data="Language ("+t+")",this.updateMessageCharInfo(o[t])},messageError:function(){this.elements.messageFormGroup.addClassName("has-error")},removeMessageError:function(){this.elements.messageFormGroup.removeClassName("has-error")}}),_=t.extend({id:"v-"+S.getUUID(),tagName:"div",className:"facet-scrollable legal-notice",getTemplate:function(){return[this.buildInformationPanel(),this.buildPlatformLegal(this.model),{class:"text-helper",text:e.i18n("* If you upload a file for Terms of Use or Privacy Policy Statement you have to complete the message. It will be displayed in a pop-up at the users first login to ask them to read and approve those documents.")},this.buildCookies(),{tag:"h4",text:e.i18n("Footer")},{html:this.elements.displayFooterToggle},{class:"footer",html:[new d({value:e.i18n("Cancel"),className:"pull-right default",events:{onClick:this.render.bind(this)}}),new d({value:e.i18n("Save"),className:"pull-right primary",events:{onClick:this.save.bind(this)}}),{class:"clearfix"}]}]},setup:function(e){var t=e.platform.get("id");return this.model=new L({platform:t},{data:{platform:t}}),this.elements={},this.legalInput=[],this._parent(e)},buildPlatformLegal:function(t){return e.createElement("div",{id:"platform-details-"+t.get("platform"),html:[{class:"tos",html:this.buildPlatformLegalDetails(t,"tos")},{class:"dp",html:this.buildPlatformLegalDetails(t,"dp")},{class:"legalInfos",html:this.buildPlatformLegalDetails(t,"legalInfos")}]})},getNames:function(t){var n={fileName:this.model.get(t)};switch(t){case"tos":n.label=e.i18n("Terms of Use");break;case"dp":n.label=e.i18n("Privacy Policy Statement");break;case"legalInfos":n.label=e.i18n("Legal Information");break;case"cookies":n.label=e.i18n("Cookie Document")}return n},buildPlatformLegalDetails:function(t,n){var i,o,s,a,l=e.createElement("form",{class:"form-wrapper",id:"platform-details-"+t.get("platform")+"-"+n,action:"#",method:"POST",enctype:"multipart/form-data",target:"uploadFrame"+this.id}),c=this,m=this.getNames(n),u=m.fileName;i={type:n,hasReadyToDownload:!1,hasDownload:!1,downloadError:!1,currentForm:l,uploadF:function(){c.mask(),M.fetchTicket({data:{envid:t.get("platform"),type:n},onComplete:function(e,t){l.getElement("[name=__fcs__jobTicket]").setAttribute("value",t.fcsJobTicket),l.getElement("[name=file_0_name]").setAttribute("value",l.getElement("[name=file_"+n+"]").value),l.setAttribute("action",t.fcsUrl),l.setAttribute("target","uploadFrame"+c.id),c.uploadInProgress=!0,c.model.set(n,""),c.model.set(n,S.getFileName(l.getElement("[name=file_"+n+"]").value)),l.setAttribute("enctype","multipart/form-data"),l.submit()},onFailure:function(){c.unmask()}})}};for(var h=0;h<=this.legalInput.length;h++){if(h===this.legalInput.length){this.legalInput.push(i);break}if(this.legalInput[h].type===n){this.legalInput[h]=i;break}}return o=new d({value:e.i18n("View"),className:"info",events:{onClick:function(){c.mask(),u=c.model.get(n),M.fetchCheckoutTicket({data:{envid:t.get("platform"),file:u},onComplete:function(e,t){c.unmask(),M.downloadFile(u,t)},onFailure:function(){c.unmask()}})}}}),s=new d({value:e.i18n("Remove"),className:"error ",events:{onClick:function(){var i=l.getElement("input[type=text]").placeholder;new r({className:"platform-management-confirm-modal",closable:!0,okButtonText:e.i18n("Remove")}).confirm(e.String.format(e.i18n("Are you sure you want to remove {0}?"),i),e.i18n("Remove Terms of Use document"),function(e){e&&(c.mask(),x.removeFile({envid:t.get("platform"),type:n},{onComplete:function(e){c.unmask(),D.success(e.message),c.model.set(n,""),c.refresh()},onFailure:function(){c.unmask()}})),S.manageSupportOfMultiModal()})}}}),a=this.buildInputFile(n,i),e.createElement("div",{class:"line",html:[{tag:"div",html:[{tag:"input",type:"hidden",value:x.getUrl("faillurePage"),name:"__fcs__failurePage",id:"__fcs__failurePage"},{tag:"input",type:"hidden",value:x.getUrl("eServiceError"),name:"__fcs__jobTicket",id:"__fcs__jobTicket"},{tag:"input",type:"hidden",value:"",name:"file_0_name",id:"file_0_name"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"}]},{class:"section file row",html:[{class:"col-sm-3",html:{tag:"p",class:"form-control-static",text:m.label}},{class:"col-sm-5",html:{class:"input-wrapper",html:a}},{class:"col-sm-4",html:[o,s]}]}]}).inject(l),""===u&&(o.getContent().addClassName("hidden"),s.getContent().addClassName("hidden")),l},buildInputFile:function(t,n){var i=this;return new C({attributes:{name:"file_"+t},placeholder:e.is(i.model.get(t))&&""!==i.model.get(t)?i.model.get(t):"",buttonBefore:!1,events:{onChange:function(){var o=this.elements.input,s=o.value,a=S.getFileExtension(s),l=o.getParent(".input-wrapper");""===s||"pdf"!==a&&"doc"!==a&&"docx"!==a?""!==s?(n.hasReadyToDownload=!1,D.alert(e.i18n("File formats supported are : pdf, doc, and docx.")),l.setContent(i.buildInputFile(t,n)),l.addClassName("has-error")):n.hasReadyToDownload=!1:(n.hasReadyToDownload=!0,l.hasClassName("has-error")&&l.removeClassName("has-error")),i.poolUsageTracker({type:t})}}})},refresh:function(e){void 0===this.model.changedAttributes().tos&&"tos"!==e||this.getBody().getElement(".tos").setContent(this.buildPlatformLegalDetails(this.model,"tos")),void 0===this.model.changedAttributes().dp&&"dp"!==e||this.getBody().getElement(".dp").setContent(this.buildPlatformLegalDetails(this.model,"dp")),void 0===this.model.changedAttributes().legalInfos&&"legalInfos"!==e||this.getBody().getElement(".legalInfos").setContent(this.buildPlatformLegalDetails(this.model,"legalInfos")),void 0===this.model.changedAttributes().cookies&&"cookies"!==e||this.getBody().getElement(".cookies").setContent(this.buildPlatformLegalDetails(this.model,"cookies"))},resetLegalInput:function(){},sendNotifLegalInput:function(t){for(var n=0;n<t.length;n++)!t[n].values&&t[n].hasDownload?(D.success(e.i18n("File has been uploaded")),this.refresh(t[n].type)):!t[n].values&&t[n].downloadError&&(D.alert(e.String.format(e.i18n("File can't be uploaded {0}"),this.getNames(t[n].type).fileName)),t[n].currentForm.getElement(".input-wrapper").addClassName("has-error"))},manageSave:function(){for(var e;void 0===this.legalInput[0].values&&(!1===this.legalInput[0].hasReadyToDownload||!0===this.legalInput[0].hasDownload||!0===this.legalInput[0].downloadError);)this.legalInput.splice(this.legalInput.length,0,this.legalInput.splice(0,1)[0]);this.legalInput[0].values?(this.legalInput.splice(this.legalInput.length,0,this.legalInput.splice(0,1)[0]),e=this.legalInput.slice(0),this.sendNotifLegalInput(e),this.saveLegal(e[e.length-1].values)):this.legalInput[0].uploadF()},buildInformationPanel:function(){var t=this,n=this.model,i={tag:"h4",text:e.i18n("Legal Notice")},o=e.createElement("div",{class:"information",html:S.i18n("The 3DEXPERIENCE platform provided by Dassault Systèmes is a space under the Customer's sole responsibility. Therefore, Customer's is sole responsible and liable for the access to and the use of this platform. As such, it belongs to Customer to regulate the use of this platform by users, and in particular to set up terms of use and data privacy policy related to the platform, in accordance with the agreement concluded with Dassault Systèmes for the use of the platform.")+" "+S.i18n("Therefore you have to fill the acceptance message and upload at least one document to activate the 'Legal Notice feature'.")}),s=e.createElement("iframe",{id:"uploadFrame"+this.id,name:"uploadFrame"+this.id,src:S.getAsset("s.gif"),events:{load:function(e){t.uploadInProgress?(t.uploadInProgress=!1,setTimeout(function(){t.unmask(),M.fetchCheckoutTicket({data:{envid:t.model.get("platform"),file:t.legalInput[0].currentForm[2]?t.legalInput[0].currentForm[2].value:""},onComplete:function(e,n){t.legalInput[0].hasDownload=!0,t.manageSave()},onFailure:function(e){t.legalInput[0].downloadError=!0,t.manageSave()}})},300)):t.unmask()}}}),a=e.createElement("div",{class:"text-helper",text:e.i18n("Allowed extensions are .pdf,.doc,.docx")}),l=this.elements.legalMessageForm=new N({type:"pm-legal",data:{messages:n.getJsonValue("legalMessages"),defaultLanguage:n.get("defaultLegalLanguage")||S.getLang()}});return this.elements.displayFooterToggle=new c({type:"switch",value:e.i18n("Display Legal Notice & Cookies Warning in footer"),className:"primary display-footer",checked:n.get("footerDisplay")}),[i,o,l,a,s]},buildCookies:function(){var t,n,i,o,s,a=this.elements,l=this.model,r=[];for(a.notifyCookiesToggle=t=new c({type:"switch",value:e.i18n("Notify users about cookie usage"),className:"primary notify-cookies",checked:l.get("notifyCookies")}),a.cookieMessageForm=s=new N({type:"pm-cookies",data:{messages:l.getJsonValue("cookiesMessages"),defaultLanguage:l.get("defaultCookiesLanguage")||S.getLang()}}),a.cookieUploadForm=n=e.createElement("div",{html:[{class:"text-helper",text:e.i18n("Allowed extensions are .pdf,.doc,.docx")},{class:"cookies",html:this.buildPlatformLegalDetails(l,"cookies")}]}),o=12;o>0;o--)r.unshift({value:o,label:e.String.format(1===o?e.i18n("{0} month"):e.i18n("{0} months"),o),selected:o===l.get("cookiesValidity")});return a.validitySelect=i=new p({placeholder:!1,options:r,id:"cookies-validity",className:"form-group"}),i.elements.handle.addClassName("select-handle-validity"),i.elements.input.setStyles({width:"93%"}),i.elements.dropdown.setStyles({width:"93%"}),e.createElement("div",{id:"platform-cookies-"+l.get("platform"),class:"platform-cookies",html:[{tag:"h4",text:e.i18n("Cookie Warning")},t,{class:"information",html:S.i18n("This option allows you to inform users of your 3DEXPERIENCE platform about the use of cookies in your applications. The notification message can be defined below in several languages. A document may also be associated with it.")},s,{class:"form-group cookies-validity dropup",html:[{tag:"label",html:e.i18n("Period of validity"),for:"cookies-validity"},{class:"row",html:{class:"col-sm-6 col-md-3",html:i}}]},n]})},render:function(){var e=this;return this.model.isFetched()?this.container.setContent(e.getTemplate()):(this.mask(),this.model.fetch({onComplete:function(){S.getParentModule("DS/UWPClientCode/I18n",function(t){U=t,e.container.setContent(e.getTemplate()),e.unmask(),e.dispatchEvent("onRendered")})}})),this},save:function(){sessionStorage.setItem("logRefresh","true");var e,t,n=this.elements,i=this.model,o=n.cookieMessageForm,s=o.getValues(),a=n.legalMessageForm,l=a.getValues(),r=this.legalInput,c=!1,m=!0,d=-1,u=0;for(t in this.getElements("textarea")[1].getParent().removeClassName("has-error"),this.getElements("textarea")[0].getParent().removeClassName("has-error"),e={notifyCookies:n.notifyCookiesToggle.isChecked(),defaultCookiesLanguage:s.defaultLanguage,cookiesMessages:s.messages,cookiesValidity:parseInt(n.validitySelect.getValue()[0],10),footerDisplay:n.displayFooterToggle.isChecked(),defaultLegalLanguage:l.defaultLanguage,legalMessages:l.messages},r.forEach(function(e){!0===e.hasReadyToDownload&&(c=!0)}),e.notifyCookies&&""===this.getElements("textarea")[1].value&&(o.showLanguage(e.defaultCookiesLanguage),this.getElements("textarea")[1].getParent().addClassName("has-error"),this.getElements("textarea")[1].focus(),m=!1),(!0===c||i.get("dp")||i.get("tos")||i.get("legalInfos"))&&""===this.getElements("textarea")[0].value&&(a.showLanguage(e.defaultLegalLanguage),this.getElements("textarea")[0].getParent().addClassName("has-error"),this.getElements("textarea")[0].focus(),m=!1),r)m&&r.hasOwnProperty(t)&&r[t].hasReadyToDownload&&(m=this.validateFileUpload(r[t].type),-1===d&&(d=parseInt(t)));if(m&&-1!==d&&r.length){for(r[r.length-1]&&!r[r.length-1].values?r.push({values:e}):r[r.length-1].values=e;u!==d;)this.legalInput.splice(this.legalInput.length,0,this.legalInput.splice(0,1)[0]),u++;r[0].uploadF()}else m&&this.saveLegal(e)},getFirstInputValideToDowload:function(){var e,t=this.elements.inputFiles;for(e in t)if(t.hasOwnProperty(e)&&t[e].hasReadyToDownload)return t[e];return null},validateFileUpload:function(e){var t,n;return this.getElements("textarea")[0].removeClassName("has-error"),"tos"===e||"dp"===e||"legalInfos"===e?n=this.elements.legalMessageForm:"cookies"===e&&(n=this.elements.cookieMessageForm),!(n&&!(t=n.getValues()).messages[t.defaultLanguage])||(this.getElements("textarea")[0].addClassName("has-error"),n.showLanguage(t.defaultLanguage),!1)},getBody:function(){return this.content||(this.content=this.container),this.content},mask:function(){this.isMasked()||(m.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(m.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked},saveLegal:function(t){var n=this;this.mask(),"string"!=typeof t.legalMessages&&(t.legalMessages=JSON.stringify(t.legalMessages)),"string"!=typeof t.cookiesMessages&&(t.cookiesMessages=JSON.stringify(t.cookiesMessages)),this.model.save(t,{onComplete:function(){n.unmask(),D.success(e.i18n("Settings have been saved"))},onFailure:function(){n.unmask()}})},poolUsageTracker:function(e){e.pageTitle?T.trackPageView({pageTitle:e.pageTitle,appId:"LEGAL",tenant:this.options.platform&&this.options.platform.get?this.options.platform.get("id"):""}):"legalInfos"===e.type?T.uploadLegalFile({tenant:this.options.platform&&this.options.platform.get?this.options.platform.get("id"):""}):"tos"===e.type?T.uploadTOS({tenant:this.options.platform&&this.options.platform.get?this.options.platform.get("id"):""}):"cookies"===e.type?T.uploadCookie({tenant:this.options.platform&&this.options.platform.get?this.options.platform.get("id"):""}):"dp"===e.type&&T.UploadPrivacyPolicy({tenant:this.options.platform&&this.options.platform.get?this.options.platform.get("id"):""})}});t.extend({tagName:"div",className:"facet-scrollable information-general",platformFolder:null,callback:0,setup:function(e){return e.platform&&(this.platform=e.platform),this._parent(e)},buildPlatformEditor:function(){var t=this.platform;return[{class:"row",html:{class:"form-group col-sm-12",html:[{for:"display-name",tag:"label",class:"control-label",text:e.i18n("Name")},new g({id:"display-name",value:t.get("name"),name:"display-name",attributes:{maxlength:45,events:{blur:function(t){var n=this;t.preventDefault(),t.stopPropagation(),e.is(n)&&setTimeout(function(){n.value.length<3?(n.focus(),n.getParent("div").hasClassName("has-error")||(n.getParent("div").addClassName("has-error"),D.alert(e.i18n("Name should have a minimum of 3 characters")))):n.getParent("div").removeClassName("has-error")},100)}}},disabled:!t.get("platform")})]}},{class:"row",html:{class:"form-group col-sm-12",html:[{tag:"label",class:"control-label",text:e.i18n("ID")},{tag:"p",class:"form-control-static",text:t.get("id")}]}}]},getTemplate:function(){return[{tag:"h4",text:e.i18n("Platform Information")},{tag:"div",html:this.buildPlatformEditor()},this.platform.isOnPremise()?null:{tag:"h4",text:e.i18n("Disk usage")},this.platform.isOnPremise()?null:new I({platform:this.platform}).render(),{class:"clearfix"},this.getButtons(),{class:"clearfix"}]},onComplete:function(){this.unmask(),D.success(e.i18n("Settings have been saved")),this.dispatchEvent("onSaved")},save:function(){var e=this,t=this.getBody().getElement("[name=display-name]").value;if(t.length>=3&&t.length<=45&&t!==this.platform.get("name"))this.mask(),this.platform.save({id:this.platform.get("id"),name:t},{patch:!0,onComplete:e.onComplete.bind(e),onFailure:function(){e.unmask()}});else{if(t!==e.platform.get("name"))return;this.onComplete()}},getButtons:function(){return{class:"footer",html:[new d({value:e.i18n("Cancel"),className:"pull-right default",events:{onClick:this.render.bind(this)}}),new d({value:e.i18n("Save"),className:"primary pull-right",events:{onClick:this.save.bind(this)}})]}},render:function(){return this.container.setContent(this.getTemplate()),this},getBody:function(){return this.content||(this.content=this.container),this.content},mask:function(){this.isMasked()||(m.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(m.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}});return n.extend({content:null,init:function(e){this.platform=e.platform,this.cache={},this._parent(e)},getHeader:function(){var t=this;return new y({model:t.options.platform,actions:[],facets:function(){return[{text:e.i18n("Setup Legal Policy"),icon:"cog",handler:function(){t.getBody().setContent(t.getFacet(1)),t.poolUsageTracker({pageTitle:"legal"})}},{text:e.i18n("Manage Data Privacy"),icon:"eye-cog",handler:function(){t.getBody().setContent(t.getFacet(2)),t.poolUsageTracker({pageTitle:"data_privacy"})}}]}})},getFacet:function(t){var n=this.cache[t];if(this.content.setAttribute("data-view","facet-"+t),!e.is(n)){switch(t){case 1:this.cache[t]=new k({useInfiniteScroll:!1,usePullToRefresh:!1,view:new _({platform:this.options.platform})}).render();break;case 2:this.cache[t]=new k({useInfiniteScroll:!1,usePullToRefresh:!1,view:new P({platform:this.options.platform,taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache[2]}.bind(this)})}).render()}n=this.cache[t]}return n},getTitle:function(){return"<h3>"+e.i18n("Platform Information")+"</h3>"},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.loader||(m.mask(this.getBody()),this.loader=!0)},unmask:function(){this.loader&&m.unmask(this.getBody()),this.loader=null},poolUsageTracker:function(e){e.pageTitle?T.trackPageView({pageTitle:e.pageTitle,appId:"LEGAL",tenant:this.platform&&this.platform.get?this.platform.get("id"):""}):"legalInfos"===e.type?T.uploadLegalFile({tenant:this.options.platform&&this.options.platform.get?this.platform.get("id"):""}):"tos"===e.type?T.uploadTOS({tenant:this.options.platform&&this.options.platform.get?this.platform.get("id"):""}):"cookies"===e.type?T.uploadCookie({tenant:this.options.platform&&this.options.platform.get?this.platform.get("id"):""}):"dp"===e.type&&T.UploadPrivacyPolicy({tenant:this.options.platform&&this.options.platform.get?this.platform.get("id"):""})}})}),define("DS/PlatformManagement/Widgets/PlatformInformation",["UWA/Core","UWA/Class","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/PlatformManagement/Modal/PlatformInformationModal","DS/PlatformManagement/Model/PlatformModel","DS/PlatformManagementComponents/Collection/Platform","DS/PlatformManagement/Utils","DS/PlatformManagement/Model/I18nModel","DS/i3DXCompassCore/RequestOptions","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/UsageTracker","DS/i3DXCompassCore/Csrf"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h){"use strict";var g;return t.extend({widget:null,init:function(e){return g=e.widget,this.collection=null,this._parent(e)},onBeforeLoad:function(){g.body.addClassName("platform-information"),g.body.addClassName("platform-management-2"),g.setMetas({helpPath:"PlatformManagementLegal/assets/help"}),l.setLang(g.lang),l.setWidget(g);var t=this,n=l.getLang();c.setupLanguage(n),h.getTokenCSRF(),"en"!==n?(new r).fetch({onComplete:function(n,i){e.i18n(i),t.initPreferences()},onFailure:function(){t.initPreferences()}}):t.initPreferences()},initPreferences:function(){var t=this;t.collection=new a({includeWu:!1,lang:l.getLang()}),n.mask(g.body),m.getUser({onComplete:function(o){var a=o.platforms;a&&a.length>0&&(a=a.filter(function(e){return"admin"===e.role})),m.getPlatformServices({onComplete:function(o){var l=[];a.forEach(function(e){var t=o.detect(function(t){return t.platformId===e.id});t&&l.push({id:t.platformId,displayName:t.displayName})}),t.collection.set(l);var r=[];if(!e.is(t.getCurrentPlatform()))return new i({visible:!0,messages:[{message:e.i18n("You have no access to this resource"),className:"error"}]}).inject(g.body.getElement("div")),void n.unmask(g.body);t.collection.forEach(function(e){r.push({label:e.get("name"),value:e.get("id"),id:e.get("id")})}),t.collection.size()>1&&g.addPreference({type:"list",id:"x3dPlatformId",name:"x3dPlatformId",label:e.i18n("3DExperience platform"),defaultValue:g.getValue("x3dPlatformId"),onchange:"onLoad",options:r}),t.platform=new s(t.collection.get(t.getCurrentPlatformId())?t.collection.get(t.getCurrentPlatformId()).toJSON():[]),t.platform.fetch({data:{id:t.getCurrentPlatformId()},onComplete:t.onLoad.bind(t)})}})}})},getCurrentPlatform:function(){var e,t=g.getValue("x3dPlatformId");return t&&""!==t&&(e=this.collection.get(t)),e},getCurrentPlatformId:function(){return this.getCurrentPlatform().get("id")},onLoad:function(){var e=new o({platform:this.platform}),t=e.getHeader();this.platformInformation=e,n.unmask(g.body),g.setBody([t,{class:"id-card-content"}]),e.content=g.getElement(".id-card-content"),t.selectFacet(0),u.trackPageView({pageTitle:"legal",appId:"LEGAL",tenant:this.platform.get("id")}),g.setTitle(""),g.body.getElement(".id-card-content").setStyle("height","calc(100% - 55px)")},onSearch:function(e){e&&(e=e.toLowerCase()),this.platformInformation.getFacet(2).view.oldMemberslist.search(e)},onResetSearch:function(){this.collection&&this.onSearch(null)},onRefresh:function(){this.initPreferences()},onResize:function(){},onViewChange:function(){}})}),define("DS/PlatformManagement/Controls/Input/Tagger",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Input/Text","DS/PlatformManagement/Controls/Tags","DS/PlatformManagement/Utils"],function(e,t,n,i,o){"use strict";return t.extend({defaultOptions:{validator:function(e){return e.length>0},onSuccess:function(){},onError:function(){},onLimitError:function(){},onDuplicateError:function(){},placeholder:"",limit:null,onChange:function(){}},isFirst:!0,init:function(e){var t=this;t._parent(e),this.buildContainer(),setTimeout(function(){t.elements.input.focus()},1)},buildContainer:function(){this.elements.container=e.createElement("div",{html:[{class:"tags-input-wrapper",html:[{class:"tag-wrapper"},{class:"tag-input-wrapper",html:this.buildInput()}]},{class:"clearfix"}]})},buildInput:function(){var e=this;return this.elements.input=new n({className:"pull-right",attributes:{type:"email",placeholder:this.options.placeholder,autofocus:this.options.focus||null,events:{keydown:function(t){9===t.keyCode&&e.paste(!1,!0)},keyup:function(t){17!==t.keyCode&&(13===t.keyCode||188===t.keyCode?e.paste(!1,!0):e.paste(!0,!0))},drop:function(){e.paste(!1,!0)},paste:function(){e.paste(!1,!0)},blur:function(){e.paste(!1,!1)}}}}),this.elements.input},paste:function(e,t){var n=this;setTimeout(function(){var i,o,s,a=n.elements.input.getValue(),l=a,r=n.elements.container.getElement(".tags-input-wrapper"),c=n.elements.container.getElement(".tag-input-wrapper"),m=!0;(e&&a.indexOf(";")>-1||!e)&&((i=a.split(";")).forEach(function(e,t){""!==e&&(n.options.validator(e)&&null!==n.options.limit&&n.getSelected().length<n.options.limit?(-1===n.getSelected().indexOf(e)?((o=n.buildTag(e)).inject(r),o.asyncCheck(),m=!1,s=t+1===i.length?"":";",a=a.replace(e+s,"")):-1!==n.getSelected().indexOf(e)&&(c.addClassName("has-error-duplicate"),m=!0),n.options.validator(e)&&n.getSelected().length===n.options.limit&&(c.hasClassName("has-error")||(c.addClassName("has-error"),c.addClassName("has-error-limit"),m=!0))):m=!0)}),a!==l&&(n.elements.input.setValue(a),n.syncInputSize(),t&&setTimeout(function(){n.elements.input.focus()},1)),m&&n.validate())},0)},buildTag:function(e){var t=this;return new i({text:e,onDestroy:function(){setTimeout(function(){t.syncInputSize(),t.validate()},10)},onChange:function(){t.syncInputSize(),t.validate()},onError:function(){t.syncInputSize(),t.options.onError()},syncInputSize:t.syncInputSize.bind(this),validator:t.options.validator,validatorAsync:t.options.validatorAsync})},validate:function(){var e=this;setTimeout(function(){var t=e.elements.container.getElement(".tag-input-wrapper");t&&(""!==e.elements.input.getValue()||0!==e.getContent().getElements(".uwa-input-split.has-error").length?(t.hasClassName("has-error")||t.addClassName("has-error"),t.hasClassName("has-error-limit")&&e.getSelected().length===e.options.limit?e.options.onLimitError():t.hasClassName("has-error-duplicate")?(t.removeClassName("has-error"),e.options.onDuplicateError()):t.hasClassName("has-error")&&(t.removeClassName("has-error-limit"),e.options.onError())):(t.removeClassName("has-error"),t.removeClassName("has-error-duplicate"),t.removeClassName("second-time"),e.options.onSuccess()))},10)},syncInputSize:function(){var e=0,t=this,n=t.elements.container.getSize().width,i=n,o=[];t.elements.container.getElements(".uwa-input-tags").forEach(function(e){e.inject(t.elements.container.getElement(".tags-input-wrapper"))}),t.elements.container.getElements(".uwa-input-tags").forEach(function(i){e+=i.getDimensions().outerWidth,t.isFirst&&(e+=5),o.push(i),e>n-200&&(o.forEach(function(e){t.elements.container.getElement(".tag-wrapper").grab(e)}),o=[],e=0)}),t.isFirst&&(t.isFirst=!1),n-e>200&&(i=n-e),e>0?t.elements.container.getElement("input").setStyle("width",i-5):t.elements.container.getElement("input").setStyle("width","100%"),t.options.onChange()},getSelected:function(){var e=[];return this.elements.container.getElements(".uwa-input-tags span.form-control").forEach(function(t){e.push(t.getHTML())}),e}})}),define("DS/PlatformManagement/Views/UserGroupsRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Controls/Loader","UWA/Event"],function(e,t,n,i,o,s,a,l,r,c,m){"use strict";return t.extend({tagName:"tr",masked:!1,domEvents:{click:"_onClick"},setup:function(){return this.listenTo(this.model,{onChange:this.render}),this.container.addClassName(this.options.parentClassName||""),this.container.setAttribute("data-id",this.model.get("id")),this.container.setAttribute("data-type","user-groups"),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this},_onClick:function(e){var t=this.getContent(),n=!t.hasClassName("selected"),i=this;this.toggleSelect.isDisabled()||(m.stop(e),i.setLoadingStatus(this.model),t.toggleClassName("selected",n),this.toggleSelect.setDisabled(!0),this.toggleSelect.setCheck(n),this.model.addLicense(this.options.role,this.options.platform,this.options.groupModel,this.model,{patch:!0,onComplete:function(e){r.success(e.message),i.resetStatus()},onFailure:function(e,t){r.alert(e.message),i.toggleSelect.setDisabled(!1),i.toggleSelect.setCheck(!1),i.resetStatus()}}))},getLabel:function(){var t=this.model.getUserFullName();return this.model.isDeny()?t+=e.i18n(" (No Access)"):this.model.isCasual()&&(t+=e.i18n(" (Casual usage)")),t},createContent:function(){var t=this.model;return this.toggleSelect=new i({className:"primary inline height",type:"checkbox",name:"users[]",value:t.get("id"),id:t.get("id"),label:this.getLabel(),checked:!!t.get("granted"),disabled:!this.options.role.hasFree()||t.get("granted")||!this.options.groupModel.get("granted")||t.get("disabled")}),this.toggleSelect&&this.toggleSelect.getContent().getElement("label").setStyles({"margin-bottom":"0px"}),[{tag:"td",styles:{"padding-left":23,"margin-bottom":"0px","min-height":"20px"},html:[this.toggleSelect]},{tag:"td",class:this.options.role.hasFree()||t.get("granted")?"text-right status":"text-error status",text:this.options.role.hasFree()||t.get("granted")?"":e.i18n("You have not enough role")}]},refreshModel:function(){this.model.fetch({data:{rolePlatform:this.model.get("platform"),platform:this.platform.get("id"),id:this.model.get("id")}})},getBody:function(){return this.content||(this.content=this.getContent()),this.content},isMasked:function(){return this.masked},mask:function(){this.isMasked()||(a.mask(this.getBody()),this.masked=!0)},setStatus:function(e,t){var n=this.getBody().getElement("td:nth-child(2n)");return n&&n.setContent(t),!0},setLoadingStatus:function(e){var t=e?new l({visible:!0}):new c;this.setStatus(e,t)},resetStatus:function(e){this.setStatus(e,void 0)},unmask:function(){this.isMasked()&&(a.unmask(this.getBody()),this.masked=!1)}})}),define("DS/PlatformManagement/Model/CreditAndTokenModel",["UWA/Core","DS/PlatformManagement/Model/ProcessModel"],function(e,t){"use strict";return t.extend({})}),define("DS/PlatformManagement/Views/ProcessRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event"],function(e,t,n,i,o,s,a){"use strict";return t.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){return this.firstRender=!0,this.listenTo(this.model,{onChange:this.render}),this.container.setAttribute("data-type","process"),this.container.setAttribute("data-id",this.model.get("uid")),this.model.isCustom()||this.container.setAttribute("data-casual",this.model.get("casual")),this.container.setAttribute("data-free",this.model.get("free")),this.model.isSelfExp()&&this.container.setAttribute("data-trial",""),this.container.setAttribute("data-cross-company",this.model.canCrossCompany()),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this},_onClick:function(e){var t=this.getContent(),n=!t.hasClassName("selected");event.stopPropagation(),t.toggleClassName("selected",n),this.toggleSelect.setCheck(n),this.options.onSelect.call(this,t,this.model),!0===n?this.options.selectedCollection.add(this.model):this.options.selectedCollection.remove(this.model)},createContent:function(){var e=this.model,t=this.options.getTileSubtitle?this.options.getTileSubtitle(e):null,o=!1;if(0!==this.options.selectedCollection.length)for(var s=0;s<this.options.selectedCollection._models.length;s++){if(this.options.selectedCollection._models[s].get("id")===e.get("id")){o=!0,this.container.addClassName("selected");break}o=!1,this.container.hasClassName("selected")&&this.container.removeClassName("selected")}return this.toggleSelect=new i({className:"primary inline",type:"checkbox",name:"users[]",value:e.get("uid"),checked:o,id:e.get("id"),label:""}),[{tag:"td",html:[this.toggleSelect,{class:"img-wrapper",html:{tag:"img","data-percent":e.getPercent(),src:e.getIcon()}}]},{tag:"td",class:"text-ellipsis",html:[{tag:"span",text:n.getTextFromHtml(e.get("name"))},t?{tag:"span",html:" "+t}:null]},{class:"center apps",tag:"td",text:e.get("apps")},{class:"center",tag:"td",html:this._getUsed()},{class:"center",tag:"td",text:e.get("expire")},{class:"center",tag:"td",html:this._buildAction()}]},_getUsed:function(){var t="",n=this.model;return n.isSelfExp()?t=e.i18n("{0}").format(n.get("used")):n.isCustom()||(t+=e.i18n("{0}/{1}").format(n.get("total")-n.get("free"),n.get("total"))),t},_buildAction:function(){var t,n=this,i=this.model;return 1===i.actions.length?t=i.actions.map(function(t){var i=e.createElement("div",{tag:"div",class:"action-container single-action",styles:{"padding-left":"15px"},html:{class:"action-icon-wrapper",html:{tag:"i",class:t.icon}},events:{click:function(e){a.stop(e),n.options.onActionClick(t,n,e)}}});return new s({position:"bottom",target:i,body:t.title}),i}):(t=e.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:"fonticon fonticon-down-open"}},events:{click:function(e){a.stop(e)}}}),new o({target:t,items:i.actions.map(function(e){return{text:e.title,icon:e.icon,handler:function(t){n.options.onActionClick(e,n,t)}}})})),t}})}),define("DS/PlatformManagement/Collection/CreditAndTokenCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/CreditAndTokenModel"],function(e,t,n){"use strict";return t.extend({url:"credits",model:n,parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/CreditAndTokenList",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/Mask","DS/UIKIT/Touch","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/CreditAndTokenView","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/CreditAndTokenCollection","DS/PlatformManagement/Views/CreditAndTokenRowView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h){"use strict";return t.extend({collection:new r,touchPagerEvent:null,setup:function(e){var t=this._parent(e);return this.buildContainer(),t},search:function(e){this.collection.setOffset(0),this.collection.setQuery(e),""===e&&this.getContent().getElement(".fonticon-search").removeClassName("activate"),this.refresh()},updateLayout:function(){this.getBody().getElement(".pm-grid-container").setContent(this._buildListContent())},refresh:function(e){this.setOptions(e),e&&e.params&&this.collection.setParams(e.params),this.buildContainer()},setTitle:function(t){this.getBody().getElement("h5 span")&&this.getBody().getElement("h5 span").setText(e.String.format(e.i18n("Credits & Tokens | {0}"),t))},getPersistedData:function(t){var n=this,i=!1;i&&n.options.onRefresh&&n.options.onRefresh(),t&&l.scrollToElement(".creditAndToken-list-wrapper"),n.unmask(),this.collection.fetch({onComplete:function(){n.collection.getMaxLimit()>0?(n.elements.container.removeClassName("hidden"),n.elements.container.setContent(n.buildContent()),i=!0,n.lastResult=n.collection.toJSON()):null!==n.collection.getQuery()&&(n.elements.container.removeClassName("hidden"),n.collection.setQuery(null),n.setTitle(e.i18n(n.collection.length)),n.elements.container.getElement(".pm-grid-container").setContent(n.buildNoResultSearch()))}})},buildNoResultSearch:function(){return[(new u).render()]},buildContainer:function(){var t=this;this.getBody()||(this.elements.container=e.createElement("div",{class:"creditAndToken-list-wrapper hidden"}),this.getBody().setContent({class:"empty-body"})),this.mask(),this.options.platform&&null!==this.options.platform&&s.fetch({onComplete:function(){t.collection.setLimit(s.get("processesMaxPerPage")),t.collection.setSortDirection(s.get("processesSortDirection")),t.collection.setPlatform(t.options.platform.getId()),t.getPersistedData()}})},buildContent:function(){var t=[];return t.push({class:"divider"}),this.headerList=new h({icon:"tokens",label:e.i18n("Credits & Tokens | {0}"),collection:this.collection,searchLabel:e.i18n("Search Credits & Tokens"),isSearchOpen:""!==this.collection.getQuery()&&null!==this.collection.getQuery(),events:{search:this.search.bind(this)}}),t.push(this.headerList.render()),t.push({class:"pm-grid-container "+(s.isGridLayout()?"layout-grid":"layout-table"),html:this._buildListContent()}),this.initTouchPager(),t},_buildListContent:function(){return[s.isGridLayout()?this.buildTiles():this.createTableView(),0===this.collection.getMaxLimit()?new d({fonticon:"tokens",text:e.i18n("No credits & tokens available")}).render():null,this.buildPager()]},_hasTPA:function(){return e.is(l.getWidget().getElement(".tp-apps"))},createTableView:function(){return[{tag:"table",class:"table",html:[{tag:"thead",html:[{tag:"td",styles:{width:"10%"}},{tag:"td",styles:{width:"50%"},text:e.i18n("Name")},{class:"center",tag:"td",text:e.i18n("Used")},{class:"center",tag:"td",text:e.i18n("Expire")}]},{tag:"tbody",html:this.collection.map(function(e){return new c({icon:"fonticon fonticon-tokens",model:e}).render()})}]}]},buildTiles:function(){var e=[],t=this;return this.collection.forEach(function(n){e.push(t.buildTile(n))}),e},getAppsText:function(t){var n=t.get("apps");return e.is(n)&&n<=1?e.String.format(e.i18n("{0} app"),n):e.String.format(e.i18n("{0} apps"),n)},buildTile:function(e){var t;return(t=new a({lazyLoading:!1,model:e,mapping:{title:function(){return this.model.get("name")+" ("+this.model.get("trigram")+")"},content:function(){return e.getTileContent(e)}}})).render(),t.container.getElement(".platform-management-header").setContent({tag:"i",class:"tile-header-icon fonticon fonticon-tokens"}),t},initTouchPager:function(){var e,t=this;!this.touchPagerEvent&&t.pager&&(this.touchPagerEvent=!0,(e=new o(t.getBody())).on("swipeleft",function(){t.collection.hasNext()&&(t.collection.setOffset(t.collection.getNextOffset()),t.pager.setOffset(t.collection.getOffset()))}),e.on("swiperight",function(){t.collection.hasPrevious()&&(t.collection.setOffset(t.collection.getPreviousOffset()),t.pager.setOffset(t.collection.getOffset()))}))},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?this.pager=new n({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.getPersistedData(!0)}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(i.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(i.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Modal/ConfirmSwitchToggle",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Collection/ProcessCollection","DS/UIKIT/Input/Button","DS/PlatformManagement/Utils"],function(e,t,n,i,o,s,a){"use strict";return t.extend({roleImpacted:[],needed:!1,disableOKButton:!1,clickOkPressed:!1,init:function(e){var t,i,o=this,s=e.model;o._parent(e),this.modalConfirmSwitchToggle=new n({closable:!0,className:a.getPlatformManagementWrapperClassName("")+" confirm-switch-toggle",header:"",body:"",footer:"",events:{onHide:function(){o.clickOkPressed||o.options.onCancel(),o.modalConfirmSwitchToggle.destroy()}}}),o.options.selectedCollection.size()>0?(s.isWA()&&s.canCrossCompany()?(t=s.get("licensed"),s.get("restricted"),this.roleImpacted=o.options.selectedCollection.filter(function(e){return e.isWA()&&e.canCrossCompany()&&!e.isCustom()&&e.get("licensed")!==t})):s.isWU()&&(i=e.mandatoryPrereqWACCNotGranted.findWhere({withLicenses:!1}))&&!1===i.get("licensed")&&(this.roleImpacted=o.options.selectedCollection.filter(function(e){return e.isWA()&&e.canCrossCompany()&&!e.isCustom()&&!1!==e.get("licensed")})),this.roleImpacted&&this.roleImpacted.length>0?o.needed=!0:o.needed=!1):o.needed=!1},isNeeded:function(){return this.needed},show:function(){this.modalConfirmSwitchToggle.setHeader(this.getTitle()),this.modalConfirmSwitchToggle.setBody(this.getContent()),this.modalConfirmSwitchToggle.setFooter(this.getButtons()),this.modalConfirmSwitchToggle.inject(document.body).show()},getTitle:function(){return"<h4>"+(this.options.model.get("licensed")?this.options.selectedCollection.size()>1?e.i18n("Assigning this role will automatically assign the following Licenses"):e.i18n("Assigning this role will automatically assign the following License"):this.options.selectedCollection.size()>1?e.i18n("Assigning this role will automatically unassign the following Licenses"):e.i18n("Assigning this role will automatically unassign the following License"))+"</h4>"},getContent:function(){var t=this,n=[];return this.roleImpacted.forEach(function(e){n.push(t.getContentItem(e))}),[e.createElement("table",{class:"table",html:n})]},getContentItem:function(t){return{tag:"tr",html:[{tag:"td",html:new i({className:"primary",type:"checkbox",name:"prereq-licenses[]",value:t.get("uid"),label:t.get("name"),checked:!0,disabled:!0})},{tag:"td",class:"confirm-switch-toggle-status",html:t.get("licensed")?e.i18n("1 license will be unassigned"):e.i18n("1 license will be assigned")}]}},getButtons:function(){var t=this,n=[];return n.push(new s({value:e.i18n("Ok"),className:"primary",events:{onClick:function(){t.needed=!1,this.clickOkPressed=!0,t.modalConfirmSwitchToggle.hide(),t.options.onConfirm(t.options.mandatoryPrereq)}}})),n.push(new s({value:e.i18n("Cancel"),className:"default",events:{onClick:function(){t.modalConfirmSwitchToggle.hide(),t.options.onCancel()}}})),n}})}),define("DS/PlatformManagement/Modal/Prereq",["UWA/Core","UWA/Controls/Abstract","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/ProcessModel","DS/UIKIT/Input/Button","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/ConfirmSwitchToggle","DS/PlatformAPI/PlatformAPI","DS/UIKIT/Tooltip","UWA/Event"],function(e,t,n,i,o,s,a,l,r,c,m,d){"use strict";return t.extend({defaultOptions:{prereq:[],onConfirm:function(){},onCancel:function(){},number:1,type:"and"},needed:!1,neededConfirmSwitchToggle:!1,mandatoryPrereqWACCNotGranted:!1,disableOKButton:!1,clickOkPressed:!1,content:null,neededPrereq:null,prereqOptionsMissing:!0,prereqView:null,init:function(e){var t,i=this,o=e.model;this._parent(e),this.model=o,this.selectMode=e.selectMode,o.isTPA()||(this.modal=new n({closable:!0,header:"",className:l.getPlatformManagementWrapperClassName("prereq-needed"),body:"",footer:"",events:{onHide:function(){i.clickOkPressed||i.options.onCancel(),this.destroy(),l.manageSupportOfMultiModal()}}}),this._asPrereq(o)&&"or"===o.get("prereq").type&&1===o.get("prereq").process.length&&(o.get("prereq").type="and"),this._asPrereq(o)&&(i.options.prereq=o.get("prereq").process.filter(function(e){return"and"!==o.get("prereq").type||!i.options.selectedCollection.get(e.uid)}),"or"===o.get("prereq").type&&(i.prereqOptionsMissing=o.get("prereq").process.filter(function(e){return!i.options.selectedCollection.get(e.uid)}),i.prereqOptionsMissing=i.prereqOptionsMissing.length>0,i.hasOneNeededPrereq=o.get("prereq").process.find(function(e){return i.options.selectedCollection.get(e.uid)}))),!i.options.disabledConfirmSwitchToggleModal&&e.platform&&e.platform.canCrossCompany()&&(this.hasMandatoryPrereqWACCNotGranted()||o.isWA()&&o.canCrossCompany())&&!o.isCustom()&&(t=i.getMandatoryPrereq(),i.confirmSwitchToggleModal=new r({selectedCollection:i.options.selectedCollection,model:o,onCancel:function(){i.confirmSwitchToggleModal.destroy(),i.options.onCancel()},onConfirm:function(){i.confirmSwitchToggleModal.destroy(),i.options.onConfirm(t)},mandatoryPrereq:t,mandatoryPrereqWACCNotGranted:this.mandatoryPrereqWACCNotGranted}),i.neededConfirmSwitchToggle=i.confirmSwitchToggleModal.isNeeded()),i.options.prereq.length>0&&(i.needed=!0,"or"===o.get("prereq").type&&(this.disableOKButton=!0,this.options.okButton&&i.prereqOptionsMissing&&this.options.okButton.setDisabled(i.disableOKButton))),o.get("prereq")&&"or"===o.get("prereq").type&&i.hasOneNeededPrereq&&(i.needed=!1,this.disableOKButton=!1,this.options.okButton&&this.options.okButton.setDisabled(i.disableOKButton))),this.elements.container=this.modal},getMandatoryPrereq:function(){var e=new a,t=this.model;return this._asPrereq(t)&&"and"===t.get("prereq").type&&this._manageSubPrereq(t,e),this.prereqOptionsMissing||this._asPrereq(t)&&"or"===t.get("prereq").type&&this._manageSubPrereq(t,e),e},hasMandatoryPrereqWACCNotGranted:function(){var e=this,t=this.getMandatoryPrereq();return this.mandatoryPrereqWACCNotGranted=new a(t.filter(function(t){return!t.get("granted")&&e.options.platform.getCrossCompanyRoles().indexOf(t.get("trigram"))>-1})),this.mandatoryPrereqWACCNotGranted.length>0},isNeeded:function(){return this.needed||this.neededConfirmSwitchToggle},showConfirmSwitchToggle:function(){this.confirmSwitchToggleModal.show()},confirm:function(){!1===this.needed&&!0===this.neededConfirmSwitchToggle?this.showConfirmSwitchToggle():(this.prereqView=!0,this.modal.setHeader("<h4>"+this.getTitle()+"</h4>"),this.modal.setBody(this.getContent()),this.modal.setFooter(this.getButtons()),this.modal.inject(document.body).show(),this.manageDefaultSelection())},_manageButtonActivation:function(){var t,n=!1;"or"===this.model.get("prereq").type?(t=this.getContent().getElements('tr[data-level="0"] input'),n=e.Array.detect(t,function(e){return!0===e.checked})):n=(t=this.getContent().getElements("tr input")).every(function(e){return!0===e.checked}),this.options.okButton&&this.options.okButton.setDisabled(!n)},manageDefaultSelection:function(){var e=this;"or"===this.model.get("prereq").type&&(this.options.selectedCollection.forEach(function(t){var n,i=[];e.getContent().getElement('[value="'+t.get("uid")+'"]')&&(i=e.getContent().getElements('[data-prereq="'+t.get("uid")+'"] input'),e.getContent().getElement('[value="'+t.get("uid")+'"]:not(:disabled)')&&(e.getContent().getElement('[value="'+t.get("uid")+'"]:not(:disabled)').checked=!0,i.forEach(function(e){e.checked=!0}))),n=e.elements.container.getBody().getElements("[name=prereq-licenses\\[\\]]:checked"),e.model.get("prereq")&&"or"===e.model.get("prereq").type&&(e.disableOKButton=n.length>0,e.options.okButton&&e.options.okButton.setDisabled(e.disableOKButton))}),0===this.options.selectedCollection.size()&&(e.disableOKButton=!0,e.options.okButton&&e.options.okButton.setDisabled(e.disableOKButton))),this._manageButtonActivation()},getTitle:function(){var t=this.model.get("option")?e.i18n("Granting this option will also grant"):e.i18n("Granting this role will also grant");return"and"===this.model.get("prereq").type?t:e.i18n("You need to select at least one of these roles")},getContentOld:function(){var t=this,n=[];return t.content||(this.options.prereq=new a(this.options.prereq),this.options.prereq.forEach(function(i){var o,s=!1;t._asPrereq(i)&&(o=t.getOptionsDetail(i,"or"===t.model.get("prereq").type),s=e.Array.detect(o.getElements("tr[data-free]"),function(e){return"false"===e.getAttribute("data-free")})),n.push(t.getContentItem(i,t.model.get("prereq").type,null,0,!!s)),o&&n.push(o)}),t.content=e.createElement("table",{class:"table",html:n})),t.content},getContent:function(){var t=this,n=[];return t.content||(this.options.prereq=new a(this.options.prereq),this.options.prereq.forEach(function(i){var o=[],s=!1;t._asPrereq(i)&&(t._manageSubPrereq(i,t.options.prereq,o,"or"===t.model.get("prereq").type),e.Array.detect(o,function(e){return"and"===e.getAttribute("data-type")})&&(s=e.Array.detect(o,function(e){var n=t.options.selectedCollection.get(e.getElement("input").value);return"false"===e.getAttribute("data-free")&&!n}))),n.push(t.getContentItem(i,t.model.get("prereq").type,null,0,!!s)),o&&n.push(o)}),t.content=e.createElement("table",{class:"table",html:n})),t.content},_asPrereq:function(e){return e.get("prereq")&&e.get("prereq").process&&e.get("prereq").process.length>0},_isChecked:function(e,t,n){return this.options.selectedCollection.get(e.get("uid"))||e.hasFree(this.options.number)&&"and"===t&&!n},_isDisabled:function(e,t,n){var i=this.options.selectedCollection.get(e.get("uid"));return!!this.options.selectedCollection.isGroupRoles&&i||i||"and"===t||(e.get("free")<this.options.number||n)&&(0!==e.get("total")&&!1===e.get("withLicenses")||e.get("total")>0)},getContentItem:function(t,n,o,s,a){var l=this,r=this._isChecked(t,n,o);s||(s=0),r/*!model.hasFree() && type === 'and'*/||(this.disableOKButton=!0,this.options.okButton&&this.options.okButton.setDisabled(l.disableOKButton),this.modal.getContent().addClassName("big-modal"));var c=new i({className:"primary float",type:"checkbox",name:"prereq-licenses[]",value:t.get("uid"),label:t.get("name"),checked:r,disabled:!!this._isDisabled(t,n,a)}),m=e.createElement("tr",{class:this.options.selectedCollection.get(t.get("uid"))?"hidden":"","data-level":s,"data-free":t.get("free")>=this.options.number,"data-type":n,styles:{"border-bottom":"1px solid #D1D4D4"},html:[{tag:"td",class:"display-screen",styles:{"padding-left":15*s+8,width:"auto"},html:{tag:"div",class:"box-display-screen",html:[c]}},{tag:"td",class:"text-right",html:this.getInformation(t)}],events:{click:function(t){if(!t.target.hasClassName("role-details")){if(c.isDisabled())return void d.stop(t);var n=!c.isChecked();if(c.setCheck(n),"or"===this.getAttribute("data-type")){l._checkAllSubRow(this,c.isChecked(),s);var i,o=parseInt(this.getAttribute("data-level"),10),a=this;if(1===o&&(a=l._getFirstLevel(this),i=this.getParent().getElement('tr[data-level="1"][data-type="or"] input:checked')||this),a){var r=i||a.nextElementSibling;r&&"or"===r.getAttribute("data-type")&&parseInt(r.getAttribute("data-level"),10)<parseInt(a.getAttribute("data-level"),10)?r.getElement('[data-type="or"][data-level="1"] input:checked')?(l.disableOKButton=!1,l.options.okButton&&l.options.okButton.setDisabled(!1)):(l.disableOKButton=!0,l.options.okButton&&l.options.okButton.setDisabled(!0)):r&&"or"===r.getAttribute("data-type")&&r.getElement('[data-type="or"][data-level="1"]')&&!r.getElement('[data-type="or"][data-level="1"] input:checked')?(l.disableOKButton=!0,l.options.okButton&&l.options.okButton.setDisabled(!0)):(l.disableOKButton=!1,l.options.okButton&&l.options.okButton.setDisabled(!1))}else l.content.getElement('[data-level="'+o+'"] input:checked')?e.log("Still have on prereq"):(l.disableOKButton=!0,l.options.okButton&&l.options.okButton.setDisabled(!0))}d.stop(t)}}}});return this.dispatchEvent("detailsRoleDisplay",{elem:m,model:t}),m},_getFirstLevel:function(e){var t=e.previousSibling;return t&&0===parseInt(t.getAttribute("data-level"),10)||!t?t||e:this._getFirstLevel(t)},_checkAllSubRow:function(e,t,n){var i=e.nextElementSibling;i&&parseInt(i.getAttribute("data-level"),10)>n&&(i.getElement("input").checked=t,this._checkAllSubRow(i,t,n))},_manageSubPrereq:function(e,t,n,i,s){var a=this;s||(s=0),this._asPrereq(e)&&(s++,e.get("prereq").process.forEach(function(l){var r=new o(l);n&&n.push(a.getContentItem(r,e.get("prereq").type,i,s)),t.add(r),a._manageSubPrereq(r,t,n,i,s)}))},getOptionsDetail:function(t,n){var i=[];return this._manageSubPrereq(t,this.options.prereq,i,n),e.createElement("tr",{html:[{tag:"td",colspan:2,styles:{padding:0},html:e.createElement("table",{class:"table role-option-prereq","data-prereq":t.get("uid"),html:i})}]})},getInformation:function(t){var n,i=this.options.selectedCollection.get(t.get("uid")),o=100*(t.get("total")-t.get("free"))/t.get("total"),s="",a="";i?n=this.selectMode?e.createElement("span",{text:e.i18n("Already selected:")+" "}):e.createElement("span",{text:e.i18n("Already granted:")+" "}):0===t.get("total")&&!1===t.get("withLicenses")?a=e.createElement("span",{text:e.i18n("No license associated")+" "}):t.hasFree()||(n=e.createElement("span",{text:e.i18n("No more role available")+" "})),0===t.get("total")&&!1===t.get("withLicenses")?n=e.createElement("span",{text:e.i18n("")}):s=t.get("total")?e.createElement("span",{class:o<25?"fonticon fonticon-progress-3":o<50||o<75?"fonticon fonticon-progress-2":o>75?"fonticon fonticon-progress-1":"",styles:{"font-size":"20px"}}):"";var r=e.createElement("div",{class:0===t.get("total")&&!1===t.get("withLicenses")||!t.hasFree()&&!i?"text-error":"",html:[n,s,a]});return""!==s&&(new m({position:"bottom",target:s,body:e.String.format(e.i18n("Used: {0}/{1}"),t.get("total")-t.get("free"),t.get("total"))}),l.addUsedColor(s,o)),a&&new m({position:"bottom",target:a,body:e.i18n("No license associated")}),r},getButtons:function(){var t=this;return t.options.okButton=new s({value:e.i18n("Ok"),className:"primary",disabled:this.disableOKButton,events:{onClick:function(){var e=t.elements.container.getBody().getElements("[name=prereq-licenses\\[\\]]:checked"),n=new a;e.forEach(function(e){var i=e.value,o=t.options.selectedCollection.get(i);n.add(o||t.options.prereq.get(i))}),t.neededConfirmSwitchToggle?(t.confirmSwitchToggleModal.options.onConfirm=function(e){t.clickOkPressed=!0,t.model.get("prereq")&&"or"===t.model.get("prereq").type?t.options.onConfirm(n):t.options.onConfirm(t.getMandatoryPrereq()),t.modal.hide()},t.confirmSwitchToggleModal.show()):(t.clickOkPressed=!0,t.model.get("prereq")&&"or"===t.model.get("prereq").type?t.options.onConfirm(n):t.options.onConfirm(t.getMandatoryPrereq()),t.modal.hide())}}}),[t.options.okButton,new s({value:e.i18n("Cancel"),className:"default",events:{onClick:function(){t.model.set("cancelButton",!0),t.modal.hide()}}})]}})}),define("DS/PlatformManagement/Views/GrantTable",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Collection/UserRoleCollection","DS/PlatformManagement/Collection/BusinessExperienceCollection","DS/PlatformManagement/Collection/UsersBusinessExperienceCollection","DS/PlatformManagement/Model/BusinessExperienceModel","DS/PlatformManagement/Model/ProcessModel","UWA/Event","DS/PlatformManagement/Views/NoSearchResultView"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x){"use strict";return t.extend({tagName:"div",collection:null,content:null,masked:!1,emptyView:null,hideTableWithoutLicences:1,hideTableWithLicences:0,IFWLock:!1,licensedToggle:null,setup:function(t){var n=this,i=t.fullCollectionWithOutLicenses?3:2,o=function(){n.content||n.render(),n.updateWrapper()},s=function(t){--i>0&&2!==n._activeFilter&&(n.grantedCollection.size()>0||!e.is(n.fullCollection)&&n.grantedCollection.isFetched())?(i=0,n.options.noFilter||o()):e.is(n.fullCollection)&&n.fullCollection.isFetched()&&n.grantedCollection.isFetched()&&2===n._activeFilter?o():0===i&&(n.grantedCollection&&n.grantedCollection.size()>0?n.collection=n.grantedCollection:n.fullCollection&&(n.collection=n.fullCollection),o()),t&&n.model.set("nbUsed",n.grantedCollection.getMaxLimit())};return!0===this.options.isBE&&!1===this.options.detailsBE?(this.options.fullCollection.url=this.options.fullCollection.url+"/"+t.platform.getId(),this.options.grantedCollection.url=this.options.grantedCollection.url+"/"+t.platform.getId()):!0===this.options.isBE&&!0===this.options.detailsBE&&(this.options.fullCollection.url=this.options.fullCollection.url+"/"+t.platform.getId()+"/"+this.model.get("id"),this.options.grantedCollection.url=this.options.urlGranted+"/"+this.model.get("id")+"/users"),t.grantedCollection&&(this.grantedCollection=t.grantedCollection,!0===n.model.get("detailUsersActive")&&(t.platform.canCrossCompany()?this.grantedCollection.setLimit(6):this.grantedCollection.setLimit(10))),t.fullCollection?(this.fullCollection=t.fullCollection,!0===n.model.get("detailUsersActive")&&(t.platform.canCrossCompany()?this.fullCollection.setLimit(6):this.fullCollection.setLimit(10))):n.options.noFilter=!0,t.platform&&(t.platform.canCrossCompany()||d.isBetaModeActivated("crossCompanyOnPremise")&&t.platform.isOnPremise())&&t.fullCollectionWithOutLicenses&&(this.fullCollectionWithOutLicenses=t.fullCollectionWithOutLicenses),this.listenTo(this.model,{"onChange:role":this.updateWrapper}),t.platform&&(this.platform=t.platform),this.forceGrantedCollectionRefresh=!1,this.forceFullCollectionRefresh=!1,this.forceFullCollectionWithOutLicensesRefresh=!1,n.collection=n.grantedCollection,this.fullCollectionWithOutLicenses&&this.fullCollectionWithOutLicenses.fetch({onComplete:function(){s()},onFailure:function(){s()}}),this.fullCollection?this.fullCollection.fetch({onComplete:function(){s()},onFailure:function(e,t){u.alert(t.message||e),s()}}):s(),this.grantedCollection.fetch({onComplete:function(){s(!0)},onFailure:function(){s()}}),t},_cleanTooltips:function(){this.tooltips&&this.tooltips.length>0&&this.tooltips.invoke("destroy"),this.tooltips=[]},render:function(){var e=this;return this.container.setContent([this.buildSearch(),{class:"wrapper"}]),setTimeout(function(){e.container.getElement("input").focus()},500),this.mask(),this},updateWrapper:function(){var e;this._cleanTooltips(),!this.collection.isFetched()||!0===this.collection.isInProgress()||this.loading?(this.mask(),!1!==this.collection.isInProgress()||this.loading||(e=this.buildEmptyView())):e=this.fullCollectionWithOutLicenses&&(this.fullCollectionWithOutLicenses.size()>0||this.collection.size()>0)&&this.collection===this.fullCollection?this.getTableWithWithoutLicense():this.collection.size()>0?this.getTable():this.buildEmptyView(),this.elements&&this.elements.filterViewAll&&this.elements.filterGrantedOnly&&(this.collection&&this.collection===this.grantedCollection?(this.elements.filterGrantedOnly.setClassName("default active"),this.elements.filterViewAll.setClassName("default")):(this.elements.filterViewAll.setClassName("default active"),this.elements.filterGrantedOnly.setClassName("default"))),e&&(this.unmask(),this.getBody().setContent(e))},getTable:function(){return[{tag:"table",class:"table table-hover table-select-process",html:[{tag:"tbody",html:this.getRows()}]},this.buildPager()]},getTableWithWithoutLicense:function(){var t=this,n=this.buildPager(),i=this.buildPager(this.fullCollectionWithOutLicenses),o=function(e,t){var n=e.target.getParent("table").getElement("tbody"),i=e.target.getParent("table").getElement(".fonticon");null===i?(n.show(),t&&t.show()):i.hasClassName("fonticon-down-dir")?(n.hide(),t&&t.hide(),i.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")):(n.show(),t&&t.show(),i.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir"))};return[[{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",styles:this.model.isCasual()?null:{cursor:"pointer"},html:[{tag:"th",colspan:2,text:this.options.titleTableCollection?this.options.titleTableCollection:e.i18n("Available")},{tag:"th",html:[this.model.isCasual()?null:{tag:"span",class:this.hideTableWithLicences?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{float:"right","font-size":"14px",cursor:"pointer"},events:{click:function(i){o(i,n),t.hideTableWithLicences=t.hideTableWithLicences?0:1,e.Event.stopPropagation(i)}}}]}],events:{click:function(e){o(e,n),t.hideTableWithLicences=t.hideTableWithLicences?0:1}}}},{tag:"tbody",styles:{display:this.hideTableWithLicences?"none":""},html:this.getRows()}]},n?this.hideTableWithLicences?n.hide():n.show():""],!this.model.isCasual()&&this.fullCollectionWithOutLicenses.length>0?[{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",styles:{cursor:"pointer"},html:[{tag:"th",colspan:2,text:this.options.titleTableCollectionWithOutLicenses},{tag:"td",html:[{tag:"span",class:this.hideTableWithoutLicences?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{float:"right","font-size":"14px",cursor:"pointer"},events:{click:function(n){o(n,i),t.hideTableWithoutLicences=t.hideTableWithoutLicences?0:1,e.Event.stopPropagation(n)}}}]}],events:{click:function(e){o(e,i),t.hideTableWithoutLicences=t.hideTableWithoutLicences?0:1}}}},{tag:"tbody",styles:{display:this.hideTableWithoutLicences?"none":""},html:this.getRows(this.fullCollectionWithOutLicenses)}]},i?this.hideTableWithoutLicences?i.hide():i.show():""]:null]},buildPager:function(e){var t,i=this,o=this.collection;return e&&(o=e),(t=o.getMaxLimit())>o.getLimit()?new n({limit:o.getLimit(),offset:o.getOffset(),type:1,pageLinks:7,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(e){i.mask(),o.setOffset(e),o.fetch({onComplete:function(){i.updateWrapper()}})}}}):null},getRows:function(e){var t=[],n=this,i=this.collection;return e&&(i=e),i.forEach(function(e){t.push(n.getRow(e))}),t},getRowIdentifier:function(e){return e.get("uid")||e.get("uuid")},isCheckboxDisabled:function(e,t){return!!e.get("groups")||e.isDisabled(t.isDeny())},isChecked:function(e){return e.get("granted")||!0===e.get("granted")||e.isTPA()&&!1===e.get("private")},getRow:function(t){var n=this,i=100*(t.get("total")-t.get("free"))/t.get("total"),s=t.get("helpMessage"),a=this.getRoleModel(t),l=t.get("expireLong")||t.get("expire")||a.get("expireLong"),r=!0,m=new o({className:"primary height",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(t),id:this.getRowIdentifier(t),label:d.getTextFromHtml(this.getLabel(t)),checked:this.isChecked(t),disabled:this.isCheckboxDisabled(t,this.model)}),u=e.createElement("div",{class:"tooltip-wrapper",html:m}),h=t.get("groups")&&"IFW"!==this.model.get("id")&&"IFW"!==t.get("id")?this.getGroupsSpan(t):"",g="",p="",f="",C="";if(void 0!==t.canCrossCompany&&(t.canCrossCompany()||t.isWU()))r=t.get("granted")?!0===t.get("licensed"):!(t.isWUWithouLicenseFree()||!t.get("withLicenses"))&&this.model.get("licensed");!0===n.model.get("detailUsersActive")&&!1===n.model.get("active")&&!0===t.get("granted")?g=e.createElement("i",{class:"fonticon fonticon-hourglass "}):!0===n.model.get("detailRolesActive")&&!1===t.get("active")?g=e.createElement("i",{class:"fonticon fonticon-hourglass "}):!0===this.options.isBE&&!1===t.get("active")&&(g=e.createElement("i",{class:"fonticon fonticon-hourglass "})),(this.model.get("active")||t.get("active")&&!1!==t.get("withLicenses"))&&(!0===n.model.get("detailUsersActive")&&!1===n.model.get("appsActive")?!0===t.get("crossCompany")?!0===t.get("locked")&&!0===t.get("remove")?p="":!0===t.get("locked")&&!1===t.get("remove")&&(p=e.createElement("i",{class:"fonticon fonticon-lock"})):!1===t.get("locked")&&!1===t.get("remove")||!0===t.get("locked")&&(p=e.createElement("i",{class:"fonticon fonticon-lock"})):!0===n.model.get("detailRolesActive")&&!1===n.model.get("appsActive")&&(void 0===t.get("helpMessage")||!1!==t.get("remove")&&!0!==t.get("locked")||(p=e.createElement("i",{class:"fonticon fonticon-lock"})))),(this.model.get("active")||t.get("active"))&&(!0!==n.model.get("detailUsersActive")&&!0!==n.model.get("detailRolesActive")||!0!==t.get("granted")&&!0!==this.model.get("granted")||!t.get("startLong")&&!t.get("start")||(f=e.createElement("i",{class:"fonticon fonticon-calendar-ok"}))),(this.model.get("active")||t.get("active")&&!0===t.get("granted")||!0===this.model.get("granted"))&&l&&!0===t.get("licensed")&&(C=e.createElement("i",{class:"fonticon fonticon-calendar-clock"}));var v=t.get("total")?e.createElement("span",{class:i<25?"fonticon fonticon-progress-3":i<50||i<75?"fonticon fonticon-progress-2":i>75?"fonticon fonticon-progress-1":""}):"";if(!0===n.model.get("detailUsersActive")&&!0===this.model.get("active")){if(!t.isTPA()&&!t.isCustom()&&!1===t.get("available")&&this.grantedCollection.size()===this.collection.size())var b=e.createElement("i",{class:"fonticon fonticon-calendar-clock availability"})}else!0===n.model.get("detailRolesActive")&&!0===t.get("active")&&(this.model.get("withLicenses")||0!==this.model.get("free")||!1!==this.model.get("available")||(b=e.createElement("i",{class:"fonticon fonticon-calendar-clock availability"})));var w=e.createElement("tr",{class:"tr-"+this.getRowIdentifier(t),styles:{"border-bottom":"1px solid #D1D4D4"},html:[{tag:"td",class:"toggle-role-name",styles:{width:"50%"},html:[u,h]},{tag:"td",class:this.platform.canCrossCompany()&&!a.isTPA()&&!a.isCustom()&&r?"":!this.platform.canCrossCompany()||a.isTPA()||a.isCustom()||r?"text-right status":"withoutLicenses",html:!this.platform.canCrossCompany()||a.isTPA()||a.isCustom()||!0!=!this.options.isBE?!0===n.model.get("appsActive")?this.getInformation(t):"":this._createCrossCompany(t,this.isChecked(t))},!0!==n.model.get("detailUsersActive")||!1!==n.model.get("appsActive")||this.platform.canCrossCompany()?"":{tag:"td"},!0===n.model.get("detailRolesActive")||!0===n.model.get("detailUsersActive")&&!1===n.model.get("appsActive")?{tag:"td",html:{tag:"div",class:"iconsDiv",styles:{float:"right",display:"flex","font-size":"20px"},html:[g,p,f,C,v,b]}}:""],events:{click:function(e){if(!m.isDisabled()&&!e.target.getParent(".toggle-switch")&&!e.target.getParent(".iconsDiv")){var i=!m.isChecked();m.setCheck(i),n.onToggleClick(m,t),S.stop(e)}},onRemoveAllGrantedRole:function(){n.dispatchEvent("onRemoveAllGrantedRole")},onRemoveAllGrantedBusinessExperiences:function(){n.dispatchEvent("onRemoveAllGrantedBusinessExperiences")}}});return d.isMobileDevice()||(g&&this.tooltips.push(new c({position:"bottom",target:g,body:e.String.format(e.i18n("Pending user"))})),p&&s&&""!==s&&this.tooltips.push(new c({position:"bottom",target:p,body:s})),f&&this.tooltips.push(new c({position:"bottom",target:f,body:e.String.format(e.i18n("Granted on {0}"),t.get("startLong")||t.get("start"))})),C&&this.tooltips.push(new c({position:"bottom",target:C,body:(n.model.get("detailRolesActive")||n.model.get("detailUsersActive"),e.String.format(e.i18n("Expiring on {0}"),l))})),v&&""!==v&&this.tooltips.push(new c({position:"bottom",target:v,body:e.String.format(e.i18n("Used: {0}/{1}"),t.get("total")-t.get("free"),t.get("total"))})),b&&this.tooltips.push(new c({position:"bottom",target:b,body:this.platform.canCrossCompany()&&!t.get("withLicenses")?e.String.format(e.i18n("No license associated for this role")):e.String.format(e.i18n("No license available for this role"))}))),d.isMobileDevice()&&(g&&this.tooltips.push(new c({position:"bottom",trigger:"click touch",target:g,body:e.String.format(e.i18n("Pending user"))})),p&&s&&""!==s&&this.tooltips.push(new c({position:"bottom",trigger:"click touch",target:p,body:s})),f&&this.tooltips.push(new c({position:"bottom",trigger:"click touch",target:f,body:n.model.get("detailRolesActive")||!0===n.model.get("detailUsersActive")?!0===this.options.isBE?e.i18n("Granted"):e.String.format(e.i18n("Granted on {0}"),t.get("startLong")||t.get("start")):""})),C&&this.tooltips.push(new c({position:"bottom",trigger:"click touch",target:C,body:(n.model.get("detailRolesActive")||n.model.get("detailUsersActive"),e.String.format(e.i18n("Expiring on {0}"),l))})),v&&""!==v&&this.tooltips.push(new c({position:"bottom",trigger:"click touch",target:v,body:e.String.format(e.i18n("Used: {0}/{1}"),t.get("total")-t.get("free"),t.get("total"))}))),d.addUsedColor(v,i),m&&m.getContent().getElement("label").setStyles({"margin-bottom":"0px"}),w},_createCrossCompany:function(t,n){var i,s=this,a=this,l=this.getUserModel(t),r=this.getRoleModel(t),c=!0,m=!0;return(t.canCrossCompany()||t.isWU())&&(m=t.get("granted")?!0===t.get("licensed"):!(t.isWUWithouLicenseFree()||!t.get("withLicenses"))&&r.get("licensed"),t.set("licensed",m),c=!0===t.get("restricted")),i=t.get("withLicenses")?new o({className:"primary"+(m?"":" hidden"),type:"switch",name:"restricted[]",checked:c,disabled:!t.canCrossCompany()||t.isWU(),value:t.get("uid"),label:e.i18n("Restrict Usage to this Platform"),events:{onClick:function(e){var i=this;t.set("restricted",this.isChecked()),n&&(s.mask(),i.setDisabled(!0),l.updateLicense([{id:r.get("uid"),licensed:r.get("licensed"),restricted:r.get("restricted")}],t.getType(),s.platform,{patch:!0,onComplete:function(e){u.success(e.message),a.setUpdatedStatus(t),i.setDisabled(!1),a.invalidCache(),s.refreshModel(),s.collection.reset(),s.collection.fetch({onComplete:function(){s.unmask(),s.updateWrapper()}})},onFailure:function(e){u.alert(e.message),s.refresh()}}))}}}):null,s.licensedToggle=new o({className:"primary",type:"switch",name:"licensed[]",checked:!!t.get("withLicenses")&&m,disabled:t.isWUWithouLicenseFree()||-1!==this.platform.getCrossCompanyRoles().indexOf(t.get("id"))&&this.isIFWLock()||!t.get("withLicenses")||t.get("locked")||t.isAssignDisabled(m)||!t.canCrossCompany()&&!t.isWU(),value:t.get("uid"),label:"",events:{onClick:function(e){var o=this;t.set("licensed",this.isChecked()),i.getContent().toggleClassName("hidden",!this.isChecked()),n&&(s.mask(),o.setDisabled(!0),l.updateLicense([{id:r.get("uid"),licensed:r.get("licensed"),restricted:r.get("restricted")}],t.getType(),s.platform,{patch:!0,onComplete:function(e){u.success(e.message),a.setUpdatedStatus(t),o.setDisabled(!1),a.invalidCache(),s.refreshModel(),s.collection.reset(),s.collection.fetch({onComplete:function(){s.unmask(),s.updateWrapper()}})},onFailure:function(e){u.alert(e.message),s.refresh()}}))}}}),s.licensedToggle.getContent().getElement("label").setContent([{tag:"span",text:e.i18n("Assign License")}]),[s.licensedToggle,i]},getLabel:function(t){var n=null;return t.isOption()&&t.isSelfExp()?n=e.i18n("(Trial, Option)"):t.isSelfExp()?n=e.i18n("(Trial)"):t.isOption()&&(n=e.i18n("(Option)")),!0===this.options.isBE?t.get("title"):n?t.get("name")+" "+n:t.get("name")},getInformation:function(t){var n="";return t.getDisplayType()&&(n=e.String.format(e.i18n("Type: {0}"),t.getDisplayType())),{tag:"span",html:this.platform.canCrossCompany()&&!t.isTPA()&&""!==n?" - "+n:n}},setStatus:function(e,t){var n=this.getContent().getElement(".tr-"+d.escapeDomSelector(this.getRowIdentifier(e))+" .status");return n&&n.setContent(t),!0},resetStatus:function(e){this.setStatus(e,this.getInformation(e))},setLoadingStatus:function(e){this.setStatus(e,new a({visible:!0}))},setUpdatedStatus:function(t){var n='<span class="text-success">'+e.i18n("Updated")+"</span>";this.setStatus(t,n)},setGrantedStatus:function(t){var n='<span class="text-success">'+e.i18n("Granted")+"</span>";this.setStatus(t,n)},setRemovedStatus:function(t){var n='<span class="text-error">'+e.i18n("Removed")+"</span>";this.setStatus(t,n)},buildSearch:function(){var e=this,t=new m({attributes:{placeholder:e.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:function(){var t=0;e.mask(),e.collection.setQuery(this.value.trim()),e.collection.setOffset(0),e.collection.reset(),e.fullCollectionWithOutLicenses&&(e.fullCollectionWithOutLicenses.setQuery(this.value),e.fullCollectionWithOutLicenses.setOffset(0),e.fullCollectionWithOutLicenses.reset(),e.fullCollectionWithOutLicenses.fetch({onComplete:function(){1===t?e.updateWrapper():t=2}})),e.collection.fetch({onComplete:function(){e.fullCollectionWithOutLicenses&&2!==t?t=1:e.updateWrapper()}})}}}});return{tag:"div",styles:{"text-align":"center","margin-top":5,"margin-bottom":15},html:[this.options.noFilter?null:this.buildFilter(),{class:"input-search-center-wrapper",html:t},{class:"clearfix"}]}},buildEmptyView:function(){return this.collection.isQueryEmpty()?this.emptyView=new f({fonticon:this.businessExperience?"presentation-slide-play":this.options.emptyView.icon,text:this.options.emptyView&&this.options.emptyView.text}):this.emptyView=new x,this.emptyView.render()},isFullCollectionFresh:function(){return this.collection.getQuery()===this.fullCollection.getQuery()&&!1===this.forceFullCollectionRefresh},isFullCollectionWithOutLicensesFresh:function(){return this.collection.getQuery()===this.fullCollectionWithOutLicenses.getQuery()&&!1===this.forceFullCollectionWithOutLicenses},isGrantedCollectionFresh:function(){return this.collection.getQuery()===this.grantedCollection.getQuery()&&!1===this.forceGrantedCollectionRefresh},isIFWLock:function(){return this.grantedCollection.find(function(e){return"IFW"===e.get("id")&&!0===e.get("locked")})&&(this.IFWLock=!0),this.IFWLock},invalidCache:function(){this.forceGrantedCollectionRefresh=!0,this.forceFullCollectionRefresh=!0,this.forceFullCollectionWithOutLicenses=!0},invalidCacheAndReload:function(){var e=this;this.invalidCache(),this.refreshModel(),this.collection.reset(),this.collection.fetch({onComplete:function(){e.unmask(),e.updateWrapper()}})},filterGrantedOnly:function(){var e=this;this._activeFilter=1,e.elements.filterGrantedOnly.setClassName("default active"),e.elements.filterViewAll.setClassName("default"),this.isGrantedCollectionFresh()||this.collection.isInProgress()||this.loading?(e.collection=e.grantedCollection,this.updateWrapper()):(this.mask(),this.grantedCollection.setQuery(e.collection.getQuery()),this.grantedCollection.reset(),this.grantedCollection.fetch({onComplete:function(){e.updateWrapper(),e.forceGrantedCollectionRefresh=!1}}),e.collection=e.grantedCollection)},filterViewAll:function(){var e=this;this._activeFilter=2,e.elements.filterGrantedOnly.setClassName("default active"),e.elements.filterViewAll.setClassName("default"),this.isFullCollectionFresh()||this.collection.isInProgress()||this.loading?(e.collection=e.fullCollection,this.updateWrapper()):(this.mask(),this.fullCollection.setQuery(e.collection.getQuery()),this.fullCollection.reset(),this.fullCollection.fetch({onComplete:function(){e.updateWrapper(),e.forceFullCollectionRefresh=!1}}),e.collection=e.fullCollection)},buildFilter:function(){var t=this.elements;return t.filterGrantedOnly=new l({value:this.options.filterGrantedOnlyText?this.options.filterGrantedOnlyText:e.i18n("View granted only"),className:"default",events:{onClick:this.filterGrantedOnly.bind(this)}}),t.filterViewAll=new l({value:this.options.filterViewAllText?this.options.filterViewAllText:e.i18n("View all"),className:"default",events:{onClick:this.filterViewAll.bind(this)}}),{class:"pull-left filter-group",styles:{"margin-top":0},html:[new r({buttons:[t.filterGrantedOnly,t.filterViewAll]})]}},getUserModel:function(){return this.model},getRoleModel:function(e){return e},onToggleClick:function(t,n){var i=this,o=null,s=this.getUserModel(n),a=this.getRoleModel(n),l=this.options.isBE,r=new C([],{data:{platform:this.platform.getId(),user:s.getUserId(),casual:s.get("casual"),granted:!0}}).setLimit(null),c=new b([],{data:{platform:this.platform.getId(),users:s.getUserId(),businessExperiences:this.model.get("id")}}),m=(new b([],{data:{platform:this.platform.getId(),userId:s.getUserId(),beId:this.model.get("id")}}),function(o){a.hasFree()?i.onCreateLicensesOrBusinessExperienceUser(s,a,n,i,o,t):(u.warn(e.i18n("You have not enough role")),t.uncheck())}),d=function(r){var c;t.isChecked()?(o=new h({platform:i.platform,selectedCollection:r,model:a,onConfirm:function(e){m(e)},onCancel:function(){i.unmask(),t.uncheck(),t.setDisabled(!1),i.resetStatus(n)}})).isNeeded()?o.confirm():!0===l?!0===l?i.onCreateLicensesOrBusinessExperienceUser(s,a,n,i,c,t):(u.warn(e.i18n("You have no business experience")),t.uncheck()):m(o.getMandatoryPrereq()):(o=new g({selectedCollection:r,model:a,onCancel:function(){i.unmask(),t.check(),t.setDisabled(!1),i.resetStatus(n)}})).isNeeded()?o.show():(s.isDeny()&&t.setDisabled(),i.showDeleteConfirmation(s,a,n,i,t))};i.setLoadingStatus(n),t.setDisabled(!0),!0===this.options.isBE?d(c):this.needToFetchToGrant(a)?(t.isChecked()||i.mask(),r.fetch({onComplete:d})):d(i.grantedCollection)},onCreateLicensesOrBusinessExperienceUser:function(t,n,i,o,s,a){var l=this,r=this.options.isBE,c=(n.get("uuid")?n.get("uuid"):n.get("id"),l.options.urlGranted),m=r?this.model.get("id")||n.get("id"):"",h=r?{id:t.get("id"),uuid:t.get("uuid")?t.get("uuid"):t.get("id")}:"",g=l.platform.canCrossCompany()||d.isBetaModeActivated("crossCompanyOnPremise")&&l.platform.isOnPremise()?[{id:n.get("uid"),licensed:!(!1===this.options.withLicenses||l.fullCollectionWithOutLicenses&&l.fullCollectionWithOutLicenses.get(n.get("uid")))&&i.get("licensed"),restricted:!!(!1===this.options.withLicenses||l.fullCollectionWithOutLicenses&&l.fullCollectionWithOutLicenses.get(n.get("uid")))||i.get("restricted")}]:[{id:n.get("uid")}];if(void 0!==s&&(s.forEach(function(e){if(l.platform.canCrossCompany()){var t={id:e.get("uid")};!0!==e.get("granted")&&l.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1&&l.platform.getCrossCompanyRoles().indexOf(i.get("trigram"))>-1?(t.licensed=!(!1===l.options.withLicenses||l.fullCollectionWithOutLicenses&&l.fullCollectionWithOutLicenses.get(n.get("uid")))&&i.get("licensed"),t.restricted=!!(!1===l.options.withLicenses||l.fullCollectionWithOutLicenses&&l.fullCollectionWithOutLicenses.get(n.get("uid")))||i.get("restricted")):!0!==e.get("granted")&&(l.platform.getCrossCompanyRoles().indexOf(i.get("trigram"))>-1&&l.fullCollectionWithOutLicenses&&l.fullCollectionWithOutLicenses.get(i.get("uid"))||!1===e.get("withLicenses"))&&(t.licensed=!1,t.restricted=!0),g.push(t)}else g.push({id:e.get("uid")})}),s.size()>0)){var p=!1;s.forEach(function(e){for(var t=l.getBody().getElement(d.escapeDomSelector("#"+e.get("uid"))),n=0;n<l.grantedCollection._models.length;n++)e.id===l.grantedCollection._models[n].id&&(p=!0);!1===p&&(o.setLoadingStatus(e),t&&(l.getBody().getElement(d.escapeDomSelector("#"+e.get("uid"))).checked=!0))})}l.platform.canCrossCompany()&&l.mask(),this.loading=!0,!0===r?t.addBusinessExperience(c,h,m,l.platform,{patch:!0,onComplete:function(t){var s=l.getUserModel(i),r=n.get("id"),c=l.platform.getId();s.addBusinessExperienceToCompass(r,c,{patch:!0,onComplete:function(t){u.success(e.i18n("New Business Experience has been granted.")),l.unmask(),o.setGrantedStatus(i),a.setDisabled(!1),o.invalidCache(),l.loading=!1},onFailure:function(t,n){u.alert(e.i18n("An error occurred while retrieving the data")),l.unmask(),a.setDisabled(!1),o.invalidCache(),l.loading=!1}})},onFailure:function(t,n){u.alert(e.i18n("An error occurred while retrieving the data")),l.unmask(),a.setDisabled(!1),o.invalidCache(),l.loading=!1}}):t.addLicense(g,n.getType(),l.platform,{patch:!0,onComplete:function(e){var t=0;if(u.success(e.message),o.setGrantedStatus(i),s.size()>0){var n=!1;s.forEach(function(e){for(var t=0;t<l.grantedCollection._models.length;t++)e.id===l.grantedCollection._models[t].id&&(n=!0);!1===n&&o.setGrantedStatus(e)})}a.setDisabled(!1),o.invalidCache(),l.refreshModel(),l.loading=!1,l.platform.canCrossCompany()&&(l.unmask(),l.collection.reset(),l.collection.fetch({onComplete:function(){l.fullCollectionWithOutLicenses&&2!==t?t=1:l.updateWrapper()}}),l.fullCollectionWithOutLicenses&&(l.fullCollectionWithOutLicenses.reset(),l.fullCollectionWithOutLicenses.fetch({onComplete:function(){1===t?l.updateWrapper():t=2}}))),l.model.set("nbUsed",l.model.get("nbUsed")+1)},onFailure:function(e,t){u.alert(e.message),l.unmask(),a.setDisabled(!1),o.invalidCache(),l.refreshModel(),l.loading=!1}})},showDeleteConfirmation:function(t,n,o,s,a){var l=this,r=new i({className:"platform-management-confirm-modal",closable:!1}),c=this.getConfirmDeleteTitle(o);r.confirm(c,e.i18n("Confirmation"),function(e){e?l.confirmDelete(t,n,o,s,a):(a.check(),a.setDisabled(!1),l.resetStatus(o),l.unmask()),d.manageSupportOfMultiModal()})},getConfirmDeleteTitle:function(t){var n=d.getTextFromHtml(t.get("name"))||d.getTextFromHtml(t.get("title"));return t.isTPA()?!0===this.businessExperience?e.String.format(e.i18n("Are you sure you want to remove {0} Business Experience ?"),n):e.String.format(e.i18n("Are you sure you want to remove {0} App?"),n):t.isOption()?e.String.format(e.i18n("Are you sure you want to remove {0} Option?"),n):e.String.format(e.i18n("Are you sure you want to remove {0} Role?"),n)},confirmDelete:function(t,n,i,o,s){var a=this;o.setLoadingStatus(i),s.setDisabled(!0),this.loading=!0,!0===this.options.isBE?t.removeBusinessExperience(a.options.urlGranted,n,a.platform,{onComplete:function(t){var l=a.getUserModel(i),r=n.get("id"),c=a.platform.getId();l.removeBusinessExperienceToCompass(r,c,{patch:!0,onComplete:function(t){a.unmask(),s.uncheck(),a.grantedCollection.remove(i),o.invalidCache(),a.loading=!1,a.platform.isPlatform()||0!==a.grantedCollection.length||a.grantedCollection.hasNext()?0===a.grantedCollection.length&&a.grantedCollection.hasNext()&&a.refresh():a.dispatchEvent("onRemoveAllGrantedBusinessExperiences"),setTimeout(function(){u.success(t&&t.message||e.i18n("Business Experience has been removed.")),o.setRemovedStatus(i),a.dispatchEvent("onUnGrantRole")},1e3)},onFailure:function(e,t){u.alert("An error occurred while retrieving the data"),a.refresh(),a.loading=!1}})},onFailure:function(e){u.alert("An error occurred while retrieving the data"),a.refresh(),a.loading=!1}}):t.removeLicense(n,a.platform,{onComplete:function(e){var t=0;a.unmask(),s.uncheck(),a.grantedCollection.remove(i),(n.isTPA()||n.isCustom())&&s.setDisabled(!1),o.invalidCache(),a.refreshModel(),a.loading=!1,a.platform.canCrossCompany()&&(a.unmask(),a.collection.reset(),a.collection.fetch({onComplete:function(){a.fullCollectionWithOutLicenses&&2!==t?t=1:a.updateWrapper()}}),a.fullCollectionWithOutLicenses&&(a.fullCollectionWithOutLicenses.reset(),a.fullCollectionWithOutLicenses.fetch({onComplete:function(){1===t?a.updateWrapper():t=2}}))),a.platform.isPlatform()||0!==a.grantedCollection.length||a.grantedCollection.hasNext()?0===a.grantedCollection.length&&a.grantedCollection.hasNext()&&a.refresh():a.dispatchEvent("onRemoveAllGrantedRole"),a.model.set("nbUsed",a.model.get("nbUsed")-1),setTimeout(function(){u.success(e.message),o.setRemovedStatus(i),a.dispatchEvent("onUnGrantRole")},1e3)},onFailure:function(e){u.alert(e.message),a.refresh(),a.loading=!1}})},refresh:function(){var e=this,t=0;this.unmask(),this.collection.reset(),this.collection.fetch({onComplete:function(){e.fullCollectionWithOutLicenses&&2!==t?t=1:e.updateWrapper()}}),e.fullCollectionWithOutLicenses&&(e.fullCollectionWithOutLicenses.reset(),e.fullCollectionWithOutLicenses.fetch({onComplete:function(){1===t?e.updateWrapper():t=2}}))},refreshModel:function(){this.model.fetch({data:{rolePlatform:this.model.get("platform"),platform:this.platform.get("id"),id:!0===this.businessExperience?this.model.get("uuid"):this.model.get("id")}})},needToFetchToGrant:function(e){return!e.isTPA()&&!e.isSelfExp()&&!e.isCustom()&&(this.grantedCollection.hasNext()||null!==this.grantedCollection.getQuery()&&""!==this.grantedCollection.getQuery())},getBody:function(){return this.content||(this.content=this.container.getElement(".wrapper")),this.content},mask:function(){this.isMasked()||(s.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(s.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked},onDestroy:function(){this._cleanTooltips()},getGroupsSpan:function(t){var n=t.get("groups"),i=n.split(","),o=i.length,s=i[0].length>20?i[0].substring(0,20)+"...":i[0],a=1===o?e.i18n("Granted through group: {0}").format(s):e.i18n("Granted through groups: {0}").format(n.replace(",","</br>")),l=e.createElement("i",{class:"fonticon fonticon-users-group ",styles:{"margin-left":"10px"}});return this.tooltips.push(new c({position:"bottom",target:l,body:a})),l}})}),define("DS/PlatformManagement/Views/GrantUserTable",["UWA/Core","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/PlatformManagement/Views/GrantTable"],function(e,t,n,i,o){"use strict";return o.extend({getRowIdentifier:function(e){return e.get("id")},needToFetchToGrant:function(){return!0},isCheckboxDisabled:function(e,t){return e.get("groups")?e.get("granted"):t.isSelfExp()?!1===e.get("granted")||!(!0===e.get("remove")&&""===e.get("expire")):!this.model.get("subtitle")&&""!==this.model.get("subtitle")&&(e.isDeny()?e.isDeny()&&!1===e.get("remove")||!e.get("granted"):!t.isCustom()&&(t.isTPA()?!1===t.get("private"):!1===t.get("withLicenses")&&!1===e.get("granted")&&!1===e.get("remove")||(!1===e.get("granted")&&!t.hasFree()||e.get("granted")&&(!1===e.get("remove")||!0===t.get("isPlatform")))))},getLabel:function(e){return e.getUserFullName()},getRoleModel:function(){return this.model},getUserModel:function(e){return e},isChecked:function(e){return e.get("granted")},getInformation:function(t){var n="",i="";return this.model.isSelfExp()?""!==t.get("expire")?n=e.i18n("Expires on {0}").format(t.get("expireLong")||t.get("expire")):(n=e.i18n("Trial Expired"),i="text-error"):this.model.isTPA()||!t.get("start")||this.model.get("detailRolesActive")||(n=e.i18n("Granted on {0}").format(t.get("startLong")||t.get("start"))),[{tag:"span",class:i,text:n}]},getConfirmDeleteTitle:function(t){return e.i18n("Are you sure you want to remove {0}?").format(t.getUserFullName())},_createCrossCompany:function(t){return t.isRoleOnly&&t.isRoleOnly()?[{tag:"span",class:"groups-list text-center status",text:e.i18n("Role granted without license")}]:t.isTPA&&t.isTPA()||t.isCustom&&t.isCustom()?void 0:this.getInformation(t)}})}),define("DS/PlatformManagement/Collection/AllUsersBusinessExperienceCollection",["UWA/Core","UWA/Class/Collection","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/AllUsersBusinessExperienceModel","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Utils/Ajax"],function(e,t,n,i,o,s){"use strict";return n.extend({url:"api/v1/business-experience",model:i,parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Views/SelectAppsView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Controls/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","UWA/Event"],function(e,t,n,i,o,s,a,l,r,c,m,d,u){"use strict";return t.extend({tagName:"div",hideTableWithoutLicences:1,hideTableWithLicences:0,statRoleCrossCompany:{licensed:!0,restricted:!0,trigram:""},setup:function(e){if(e.collectionSelected&&(this.collectionSelected=e.collectionSelected),!e.platform)throw new Error("platform is mandatory");return this.platform=e.platform,e.disabledCrossCompany&&(this.disabledCrossCompany=e.disabledCrossCompany),this._disabledRoles=[],this.preSelectedRoleDone=!1,e},render:function(){return this._managePreselection(),this.filterData(),this.subView?!this.collection.isFetched()||this.options.collectionWithOutLicenses&&!this.options.collectionWithOutLicenses.isFetched()||(this.collectionFull||(this.collectionFull=new d,this.collectionFull.add(this.collection.toJSON()),this.options.collectionWithOutLicenses&&(this.collectionWithOutLicensesFull=new d,this.collectionWithOutLicensesFull.add(this.options.collectionWithOutLicenses.toJSON())),this.collectionSelected&&(this._managePreselection(),this.collectionSelected.size()>0&&this.filterData())),this.subView.setContent(this.buildSubView()),this.unmask()):(this.container.setContent(this.buildAppSkeleton()),this.mask()),this.options.setNextDisabled&&this._manageNextButton(),window.innerWidth>768&&(this.getContent().getElement(".fonticon-search").setStyle("top","83%"),this.getContent().getElement(".fonticon-cancel-squared").setStyle("top","83%")),this},_manageNextButton:function(){(this.options.tagger?this.options.tagger.getSelected().length:1)&&this.collectionSelected.size()>0?this.options.setNextDisabled(!1):this.options.setNextDisabled(!0)},_managePreselection:function(){var e,t,n=this.options.tagger?this.options.tagger.getSelected().length:1,i=this.platform.canCrossCompany()&&!this.disabledCrossCompany;this.collectionSelected&&this.collectionFull&&!this.preSelectedRoleDone&&(1===(e=this.collectionFull.filter(function(e){var t=!!i||e.get("free")>=n;return!0===e.get("isPlatform")&&t})).length&&(t=e[0],this.collectionSelected.add(t),this._disabledRoles.push(t.get("trigram"))),this.preSelectedRoleDone=!0)},getMaxFreeRole:function(){var e=null;return this.collectionSelected&&this.collectionSelected.forEach(function(t){e=e?Math.min(e,t.get("free")):t.get("free")}),e},buildAppSkeleton:function(){return[this.buildSearch(),this.buildSubView()]},buildSubView:function(){return this.subView=e.createElement("div",{styles:{position:"relative"},class:"wrapper",html:[this.collectionSelected&&this.collectionSelected.size()>0?this.buildSelectedTable():{class:"text-center",text:this.options.emptyText||""},this.collection&&this.collection.size()>0?this.options.collectionWithOutLicenses?this.buildWithoutLicensesTable(this.collection):this.buildTable():null,(this.platform.canCrossCompany()&&!this.disabledCrossCompany||l.isBetaModeActivated("crossCompanyOnPremise")&&this.platform.isOnPremise())&&this.options.collectionWithOutLicenses?this.buildWithoutLicensesTable(this.options.collectionWithOutLicenses):null]}),this.subView},buildSelectedTable:function(){return{tag:"table",class:"table table-hover table-select-process table-selection",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:e.i18n("Selected")}]}},{tag:"tbody",html:this.buildSelectedRows()}]}},buildSelectedRows:function(){var e=[],t=this;return this.collectionSelected.forEach(function(n){e.push(t.buildRow(n))}),e},buildTable:function(){return{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:this.options.titleTableCollection?this.options.titleTableCollection:e.i18n("Available")}]}},{tag:"tbody",html:this.buildRows()}]}},buildWithoutLicensesTable:function(t){var n=this,i=t===this.options.collectionWithOutLicenses,o=i?this.hideTableWithoutLicences:this.hideTableWithLicences,s=function(e){var t=e.target.getParent("table").getElement("tbody"),n=e.target.getParent("table").getElement(".fonticon");n.hasClassName("fonticon-down-dir")?(t.hide(),n.removeClassName("fonticon-down-dir").addClassName("fonticon-right-dir")):(t.show(),n.removeClassName("fonticon-right-dir").addClassName("fonticon-down-dir"))};return{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",styles:{display:i&&0===this.options.collectionWithOutLicenses.length?"none":""},html:{tag:"tr",html:[{tag:"th",text:i?this.options.titleTableCollectionWithOutLicenses:this.options.titleTableCollection},{tag:"th",html:0===this.collection.options.data.casual?[{tag:"span",class:o?"fonticon fonticon-right-dir":"fonticon fonticon-down-dir",styles:{float:"right","font-size":"14px",cursor:"pointer"},events:{click:function(t){s(t),i?n.hideTableWithoutLicences=n.hideTableWithoutLicences?0:1:n.hideTableWithLicences=n.hideTableWithLicences?0:1,e.Event.stopPropagation(t)}}}]:null}],events:{click:function(t){t.target.getParent("table").getElement(".fonticon")&&(s(t),i?n.hideTableWithoutLicences=n.hideTableWithoutLicences?0:1:n.hideTableWithLicences=n.hideTableWithLicences?0:1),e.Event.stopPropagation(t)}}}},{tag:"tbody",styles:{display:o?"none":""},html:this.buildRows(t)}]}},buildRows:function(e){var t=[],n=this,i=this.collection;return e&&(i=e),i.forEach(function(e){t.push(n.buildRow(e,"other"))}),t},buildRow:function(t){var n=this,i=function(i){var o,s=null,a=0;n.options.tagger&&(a=n.options.tagger.getSelected().length),i.isChecked()?t.hasFree()||t.isTPA()||t.isCustom()?(o=new c({selectedCollection:n.collectionSelected,model:t,number:a,disabledConformSwitchToggleModal:!0,onConfirm:function(e){e.forEach(function(e){(s=(n.platform.canCrossCompany()||l.isBetaModeActivated("crossCompanyOnPremise")&&n.platform.isOnPremise())&&!n.disabledCrossCompany&&n.collectionWithOutLicensesFull&&n.collectionWithOutLicensesFull.get(e.get("uid"))?n.collectionWithOutLicensesFull.get(e.get("uid")):n.collectionFull.get(e.get("uid")))&&(n.collectionSelected.add(s),n.collection.remove(void 0))}),n.collectionSelected.add(t),(n.platform.canCrossCompany()||n.platform.isOnPremise())&&!n.disabledCrossCompany&&n.options.collectionWithOutLicenses&&n.options.collectionWithOutLicenses.remove(t.id)?n.options.collectionWithOutLicenses.set(n.options.collectionWithOutLicenses.sortBy("name")):(n.collection.remove(t.id),n.collection.set(n.collection.sortBy("name"))),n.collectionSelected.set(n.collectionSelected.sortBy("name")),n.render(),n._manageCrossCompanySelection()},onCancel:function(){i.uncheck()}})).isNeeded()?o.confirm():(n.collectionSelected.add(t),(n.platform.canCrossCompany()||l.isBetaModeActivated("crossCompanyOnPremise")&&n.platform.isOnPremise())&&!n.disabledCrossCompany&&n.options.collectionWithOutLicenses&&n.options.collectionWithOutLicenses.remove(t.id)?n.options.collectionWithOutLicenses.set(n.options.collectionWithOutLicenses.sortBy("name")):(n.collection.remove(t.id),n.collection.set(n.collection.sortBy("name"))),n.collectionSelected.set(n.collectionSelected.sortBy("name")),n.render(),n._manageCrossCompanySelection()):r.warn(e.i18n("You have not enough role")):(o=new m({model:t,selectedCollection:n.collectionSelected,onCancel:function(){i.check()}})).isNeeded()?o.show():(n.collectionSelected.remove(t.id),n.collectionSelected.set(n.collectionSelected.sortBy("name")),(n.platform.canCrossCompany()||l.isBetaModeActivated("crossCompanyOnPremise")&&n.platform.isOnPremise())&&!n.disabledCrossCompany&&n.options.collectionWithOutLicenses&&!t.get("withLicenses")?(n.options.collectionWithOutLicenses.add(t),n.options.collectionWithOutLicenses.set(n.options.collectionWithOutLicenses.sortBy("name"))):(n.collection.add(t),n.collection.set(n.collection.sortBy("name"))),n.render(),n._updateCrossCompanyRoles("remove","","",t),n._manageCrossCompanySelection())},s=n.collectionSelected.contains(t);t.isTPA()&&!1===t.get("private")&&(s=!0);var a=new o({"data-free":t.get("free"),className:"primary",type:"checkbox",name:"licenses[]",value:t.get("uid"),id:t.get("uid"),label:!0===t.get("option")?l.getTextFromHtml(t.get("name"))+" "+e.i18n("(Option)"):l.getTextFromHtml(t.get("name")),checked:s,disabled:function(){var e=!1,i=null;return n.options.tagger&&(i=n.options.tagger.getSelected().length),this._disabledRoles.indexOf(t.get("trigram"))>-1&&(e=!0),n.options.isBatchInvite&&t.set("crossCompany",!1),(!t.canCrossCompany()||n.disabledCrossCompany||n.options.isBatchInvite)&&t.isDisabled(!1,i)&&(e=!0),e}.call(this)});return e.createElement("tr",{html:[{tag:"td",styles:{"vertical-align":"middle"},html:a},{tag:"td",class:!n.platform.canCrossCompany()||n.disabledCrossCompany||t.isTPA()||t.isCustom()||!s?"text-right":"",html:!n.platform.canCrossCompany()||n.disabledCrossCompany||t.isTPA()||t.isCustom()||!s?this._getInformation(t):this._createCrossCompany(t)}],events:{click:function(e){if(!a.isDisabled()&&!e.target.getParent(".toggle-switch")){var t=!a.isChecked();a.setCheck(t),i(a),u.stop(e)}}}})},_getInformation:function(t,n){var i,o,a,r=100*(t.get("total")-t.get("free"))/t.get("total"),c="",m="";return t.isTPA()?c=e.String.format(e.i18n("Type: {0}"),t.getDisplayType()):!t.isCustom()&&t.get("free")<(this.options.tagger?this.options.tagger.getSelected().length:1)?(this.platform.canCrossCompany()&&!this.disabledCrossCompany?t.get("withLicenses")?c=e.String.format(e.i18n("Not enough licenses available ({0} remaining)"),t.get("free")):o=e.createElement("span",{class:"fonticon fonticon-calendar-clock availability"}):c=e.String.format(e.i18n("Not enough roles available ({0} remaining)"),t.get("free")),m="text-error"):t.isCustom()||(i=t.get("total")?e.createElement("span",{styles:{"font-size":"20px","padding-left":"5px"},class:r<25?"fonticon fonticon-progress-3":r<50||r<75?"fonticon fonticon-progress-2":r>75?"fonticon fonticon-progress-1":""}):""),a=e.createElement("span",{class:m,html:[n&&""!==c?" - "+c:i||o]}),i&&(new s({position:"bottom",target:i,body:e.String.format(e.i18n("Used: {0}/{1}"),t.get("total")-t.get("free"),t.get("total"))}),l.addUsedColor(i,r)),o&&new s({position:"bottom",target:o,body:e.i18n("No license associated")}),a},_updateCrossCompanyRoles:function(t,n,i,o){var s,a=this;a._isCrossCompanyRoleDisabled()||o&&a.platform.getCrossCompanyRoles().indexOf(o.get("trigram"))>-1&&("update"===t?(a.statRoleCrossCompany.trigram=o.get("trigram"),a.statRoleCrossCompany[n]=i):"remove"===t&&(a.statRoleCrossCompany.trigram="",a.platform.getCrossCompanyRoles().forEach(function(t){e.is(a.collectionSelected.findWhere({trigram:t}))&&(s=a.collectionSelected.findWhere({trigram:t}),a.statRoleCrossCompany.trigram=s.get("trigram"),a.statRoleCrossCompany.licensed=s.get("licensed"),a.statRoleCrossCompany.restricted=s.get("restricted"))})))},_manageCrossCompanySelection:function(t){var n,i=this,o=this.container.getElements(".table-selection tbody tr"),s=this.collectionSelected.find(function(e){return e.isWA()&&!e.canCrossCompany()});this._isCrossCompanyRoleDisabled()?e.is(s)&&o.forEach(function(e){var t=e.getElement("[name=licensed\\[\\]]"),n=e.getElement("[name=restricted\\[\\]]"),o=i.collectionSelected.find(function(e){return t&&e.get("trigram")===t.getAttribute("data-trigram")});o&&o.isWA()&&!o.canCrossCompany()&&t&&n&&(t.checked=o.get("licensed"),t.disabled=!0,n.checked=o.get("restricted"),n.getParent().toggleClassName("hidden",!1))}):(n=t&&i.platform.getCrossCompanyRoles().indexOf(t.get("trigram"))>-1?t:i.statRoleCrossCompany.trigram?this.collectionSelected.find(function(e){return e.get("trigram")===i.statRoleCrossCompany.trigram}):this.collectionSelected.find(function(e){return i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1}),o.forEach(function(e){var t=e.getElement("[name=licensed\\[\\]]"),o=e.getElement("[name=restricted\\[\\]]");if(n&&t&&o){var s=i.collectionSelected.find(function(e){return e.get("trigram")===t.getAttribute("data-trigram")});i.platform.getCrossCompanyRoles().indexOf(t.getAttribute("data-trigram"))>-1?(t.checked=n.get("licensed"),t.disabled=!1,o.checked=n.get("restricted"),o.getParent().toggleClassName("hidden",!n.get("licensed")),s.set("licensed",n.get("licensed")),s.set("restricted",n.get("restricted"))):o.getParent().toggleClassName("hidden",!t.checked)}}))},_isCrossCompanyRoleDisabled:function(){var e,t=this;return t.options.tagger&&(e=t.options.tagger.getSelected().length),!!this.collectionSelected.find(function(n){return t.platform.getCrossCompanyRoles().indexOf(n.get("trigram"))>-1&&n.isAssignDisabled(void 0,e)})},_createCrossCompany:function(t){t.isWUWithouLicenseFree()&&t.set("licensed",!1);var n=this,i=t.isWUWithouLicenseFree()||!t.get("withLicenses")||(this.platform.getCrossCompanyRoles().indexOf(t.get("trigram"))>-1||!t.isTPA()&&!t.isCustom()&&!t.canCrossCompany())&&this._isCrossCompanyRoleDisabled(),s=!i&&!t.isDisabled(!1,n.options.tagger?n.options.tagger.getSelected().length:null)&&(!e.is(t.get("licensed"))||t.get("licensed")),a=new o({className:"primary",type:"switch",name:"licensed[]",attributes:{"data-trigram":t.get("trigram")},checked:s,value:t.get("uid"),disabled:i||!t.canCrossCompany()||t.isDisabled(!1,n.options.tagger?n.options.tagger.getSelected().length:null),label:"",events:{onClick:function(){t.set("licensed",this.isChecked()),n._updateCrossCompanyRoles("update","licensed",this.isChecked(),t),n._manageCrossCompanySelection(t)}}}),l=t.get("withLicenses")?new o({className:"primary"+(s?" ":" hidden"),type:"switch",name:"restricted[]",attributes:{"data-trigram":t.get("trigram")},checked:!e.is(t.get("restricted"))||t.get("restricted"),value:t.get("uid"),label:e.i18n("Restrict Usage to this Platform"),disabled:!t.canCrossCompany()||t.isWU(),events:{onClick:function(){t.set("restricted",this.isChecked()),n._updateCrossCompanyRoles("update","restricted",this.isChecked(),t),n._manageCrossCompanySelection(t)}}}):null;return a.getContent().getElement("label").setContent([{tag:"span",text:e.i18n("Assign License"),styles:{"vertical-align":"top"}},{tag:"td",styles:{display:"inline"},html:this._getInformation(t,!0)}]),[a,l]},filterData:function(){var e=this;e.collectionSelected.forEach(function(t){t&&e.collection.remove(t.id)})},_fetchSearch:function(e){var t=this,n=0;this.mask(),this.collection.setQuery(e),this.collection.setOffset(0),this.collection.reset(),this.collection.fetch({onComplete:function(){t.options.collectionWithOutLicenses&&2!==n?n=1:(t.render(),t._manageCrossCompanySelection())}}),(this.platform.canCrossCompany()&&!this.disabledCrossCompany||l.isBetaModeActivated("crossCompanyOnPremise")&&t.platform.isOnPremise())&&this.options.collectionWithOutLicenses&&(this.options.collectionWithOutLicenses.setQuery(e),this.options.collectionWithOutLicenses.setOffset(0),this.options.collectionWithOutLicenses.reset(),this.options.collectionWithOutLicenses.fetch({onComplete:function(){1===n?(t.render(),t._manageCrossCompanySelection()):n=2}}))},_search:function(e){var t,n=this;(!this.options.collectionWithOutLicenses||this.disabledCrossCompany)&&this.collection.isFetched()||this.options.collectionWithOutLicenses&&this.options.collectionWithOutLicenses.isFetched()&&this.collection.isFetched()?this._fetchSearch(e):(t=function(){n.collection.removeEvent("onAdd",t),setTimeout(function(){n._fetchSearch(e)},100)},this.collection.addEvent("onAdd",t))},buildSearch:function(){var e=this;return new i({attributes:{placeholder:this.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:function(){e._search.call(e,this.value.trim())}}}})},getBody:function(){return this.content||(this.content=this.container.getElement(".wrapper")),this.content},mask:function(){this.isMasked()||(a.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(a.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Collection/SelfExperienceCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(e,t,n){"use strict";return t.extend({url:"user/selfexp",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data||e.roles}})}),define("DS/PlatformManagement/Modal/MemberDetails2",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/W3DXComponents/IdCard","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Modal/FullScreenIdCardModal","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Text","DS/UIKIT/Form","DS/UIKIT/Tooltip","DS/UIKIT/Input/Select","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Collection/UserRoleCollection","DS/PlatformManagement/Collection/UserTpaCollection","DS/PlatformManagement/Collection/BusinessExperienceCollection","DS/PlatformManagement/Views/GrantTable","DS/PlatformManagementComponents/Model/Platform","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Model/LegalNoticeModel","DS/PlatformManagement/Collection/SelfExperienceCollection","DS/UIKIT/Input/Button","DS/PlatformManagement/Views/LocationView","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Model/UserRightModel","DS/UIKIT/DropdownMenu","DS/PlatformManagement/Model/InvitationModel","DS/PlatformManagement/UsageTracker"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M,k,I,T,A,U,L,N,_,F){"use strict";var R=p.getUser().login,O=t.extend({tagName:"div",className:"facet-roles",tooltipLicense:null,setup:function(e){return this.options=e||{},this.tpa=e.tpa,e.platform&&(this.platform=e.platform),this.collection=new C,this._parent(e)},render:function(t){var n=this,i=this.platform.canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&this.platform.isOnPremise()?new S([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),userUid:this.model.getUserUid(),casual:this.model.get("casual"),withLicenses:!1}}):null;return this.model.set("detailUsersActive",!0),this.model.set("appsActive",!1),this.model.set("detailRolesActive",!1),this.container.setContent(new D({fullCollection:new S([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),userUid:this.model.getUserUid(),casual:this.model.get("casual"),withLicenses:!0}}),fullCollectionWithOutLicenses:i,grantedCollection:new S([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),userUid:this.model.getUserUid(),casual:this.model.get("casual"),granted:!0}}),titleTableCollection:this.platform.canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&this.platform.isOnPremise()?e.i18n("Available roles with licenses"):null,titleTableCollectionWithOutLicenses:this.platform.canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&this.platform.isOnPremise()?e.i18n("Available roles without any license"):null,platform:this.platform,model:this.model,searchPlaceholder:e.i18n("Search Roles"),filterViewAllText:e.i18n("View all"),filterGrantedOnlyText:e.i18n("View roles granted"),emptyView:{icon:"role",text:e.i18n("No Roles found")},events:{onRemoveAllGrantedRole:function(){n.dispatchEvent("onRemoveAllGrantedRole")},onRemoveAllGrantedBusinessExperiences:function(){n.dispatchEvent("onRemoveAllGrantedBusinessExperiences")}}}).render()),F.openMemberDetail({tenant:this.platform.getId()}),this}}),W=t.extend({tagName:"div",className:"action-replace-me",setup:function(e){return e.platform&&(this.platform=e.platform),e.mask&&(this.mask=e.mask),e.unmask&&(this.unmask=e.unmask),this._parent(e)},render:function(){var t=this,n=new T({value:e.i18n("Replace Me"),disabled:!this.canBeReplaced(),className:"warning",events:{onClick:function(){t._getReplaceModal().inject(document.body).show()}}}),i=e.createElement("div",{class:"tooltip-wrapper",html:n});return n.isDisabled()&&(this.tooltip=new h({position:"bottom",target:i,body:e.i18n("Available if you are connected to this platform for more than 30 days, have only 1 platform and don't have casual license")})),this.container.setContent([i,{tag:"span",text:this._getHelpText()}]),this},mask:function(){},unmask:function(){},canBeReplaced:function(){return e.is(this.model.get("replace"))&&this.model.get("replace").enable},_validateFields:function(){var t=this._getReplaceModal().getBody().getElement(".form-group"),n=!1;return e.String.isEmail(this._getEmailValue())?t.removeClassName("has-error"):(t.addClassName("has-error"),n=!0),!n},_getReplaceModal:function(){var t=this;return this.modal||(this.modal=new l({closable:!0,className:"replace-me",header:e.i18n("Replace Me"),body:"",footer:[new T({value:e.i18n("Replace Me"),className:"warning",events:{onClick:function(){t._validateFields()&&t._showConfirmModal()}}}),new T({className:"default",value:e.i18n("Cancel"),events:{onClick:function(){t.modal.hide()}}})],events:{onHide:function(){this.destroy(),t.modal=null}}}),this.modal.setBody([{class:"bs-callout bs-callout-warning",html:[{tag:"h4",text:e.i18n("Caution")},{text:e.i18n("The person you invite to replace you as the Administrator will take ownership of your license and become the Administrator of the 3DEXPERIENCE platform. You will no longer have access to the 3DEXPERIENCE platform once the person clicks the link to accept.")}]},{class:"row",html:[{class:"form-group col-sm-12",html:[{tag:"label",for:"email-"+this.cid,text:e.i18n("Send Administrator invitation to")},new d({id:"email-"+this.cid,name:"email",placeholder:e.i18n("Enter email"),attributes:{type:"email",events:{blur:this._validateFields.bind(this)}}}),{class:"error-text",text:e.i18n("Must be a valid email")}]}]},{class:"row",html:[{class:"form-group col-sm-12",html:[{tag:"label",for:"message-"+this.cid,text:e.i18n("Personalized message")},new d({id:"message-"+this.cid,name:"message",attributes:{maxlength:255},multiline:!0,rows:4})]}]}])),this.modal},_getHelpText:function(){var t=this.model.get("replace")&&this.model.get("replace").user,n=this.model.get("email"),i=e.i18n("Invite someone to replace you as the Administrator of this platform");return e.is(t)&&""!==t&&!this.model.has("message")?i=e.String.format(e.i18n("Waiting for {0} to accept the invitation to replace you as Administrator. Click Replace Me to resend the invitation or invite someone else to replace you"),t):""!==n&&this.model.has("message")&&(i=e.String.format(e.i18n("Waiting for {0} to accept the invitation to replace you as Administrator. Click Replace Me to resend the invitation or invite someone else to replace you"),n)),i},_showConfirmModal:function(){var t=this,n=e.String.format(e.i18n("Are you sure you want to be replaced by {0}?"),this._getEmailValue());new r({className:"platform-management-confirm-modal",closable:!1}).confirm(n,e.i18n("Confirmation"),function(e){e&&t._confirm(),f.manageSupportOfMultiModal()})},_getEmailValue:function(){return this.modal.getBody().getElement("[name=email]").value},_getDescriptionValue:function(){return this.modal.getBody().getElement("[name=message]").value},_confirm:function(){var t=this;this.mask(),this.model.save({user:p.getUser().login,email:this._getEmailValue(),platform:this.platform.getId(),text:this._getDescriptionValue()},{patch:!0,onComplete:function(e,n){t.render(),t.unmask(),b.success(n.message)},onFailure:function(){t.unmask(),b.alert(e.i18n("Unable to be replaced"))}}),this._getReplaceModal().hide()}}),V=t.extend({currentUserId:p.getUser().login,tagName:"div",_className:"facet-settings",modelLegal:null,setup:function(e){e.platform&&(this.platform=e.platform),this.listenTo(this.model,{"onChange:remove":this.render,"onChange:deny":this.render,"onChange:role":this.render}),this.onDelete=e.onDelete},render:function(){return null===this.modelLegal&&(this.modelLegal=new k(this.model.get("legal"))),this.container.setContent(this.getTemplate()).addClassName(this._className),this.container.getElements(".member-catenv").forEach(function(e){e.getElement(".form-group").setStyles({width:"100%"}),e.getElement(".form-footer").setStyles({color:"#3D3D3D","margin-top":"22px","margin-left":"15px"}),e.getElement(".save-button").setStyles({border:"1px solid #b4b6ba"})}),this},buildStatus:function(t,n){return t&&n?{tag:"i",class:"fonticon fonticon-check color-green"}:t?{tag:"i",class:"fonticon fonticon-cancel color-red"}:e.i18n("None")},buildLegal:function(){var t=null;return this.modelLegal.hasLegal()&&(t=[{tag:"h5",text:e.i18n("Legal Notice")},{class:"table",tag:"table",html:[{tag:"thead",html:[{tag:"th",text:e.i18n("Terms of Use"),class:"text-center"},{tag:"th",text:e.i18n("Privacy Policy"),class:"text-center"},{tag:"th",text:e.i18n("Cookie Warning"),class:"text-center"}]},{tag:"tbody",html:{tag:"tr",class:"odd",html:[{tag:"td",class:"text-center",html:this.buildStatus(this.modelLegal.get("statusTOS"),this.modelLegal.get("acceptedTOS"))},{tag:"td",class:"text-center",html:this.buildStatus(this.modelLegal.get("statusDP"),this.modelLegal.get("acceptedDP"))},{tag:"td",class:"text-center",html:this.buildStatus(this.modelLegal.get("statusCookies"),this.modelLegal.get("acceptedCookies"))}]}}]}]),t},mask:function(){this.loader||(c.mask(this.getContent()),this.loader=!0)},unmask:function(){this.loader&&c.unmask(this.getContent()),this.loader=null},getTemplate:function(){var t=this,n=new W({model:this.model,platform:this.platform,mask:this.mask.bind(this),unmask:this.unmask.bind(this)}),i=[],o=new u({grid:"9 3",className:"member-details-location location-view member-catenv",fields:[{type:"text",label:e.i18n("Native Apps Environment Configuration File For Windows"),placeholder:e.i18n("Default installation configuration path location"),helperText:e.i18n("Please note that the user must have read access to this folder"),errorText:e.i18n("Native Apps Environment Configuration File must be a valid path"),name:"KEY_CATENV",value:t.model.get("catEnv")||""}],buttons:[{type:"none",className:"save-button",value:e.i18n("Save"),events:{onClick:function(){var e=t.container.getElement("[name=KEY_CATENV]"),n=t.container.getElement("[name=KEY_CATENV]").value;f.isValidFilePathTxt(n)||""===n?(t.container.getElement("[name=KEY_CATENV]").hasClassName("error")&&(t.container.getElement("[name=KEY_CATENV]").removeClassName("error"),t.container.getElement("[name=KEY_CATENV]").getParent().removeClassName("has-error")),t.mask(),t.model.save({user:t.model.get("id"),userUid:t.model.getUserUid(),catenv:n,platform:t.platform.getId()},{patch:!0,onComplete:function(e,i){t.model.set("catEnv",n),t.unmask(),b.success(i.message)},onFailure:function(e,n){t.unmask(),n.message?b.alert(n.message):b.alert(n)}})):t.getRightErrorMessage(e,n)}}}]}),s=new u({grid:"9 3",className:"member-details-location location-view member-catenv",fields:[{type:"text",label:e.i18n("Native Apps Environment Configuration File For Linux"),placeholder:e.i18n("Default installation configuration path location"),helperText:e.i18n("Please note that the user must have read access to this folder"),errorText:e.i18n("Native Apps Environment Configuration File must be a valid path"),name:"KEY_CATENVLINUX",value:t.model.get("catEnvLinux")||""}],buttons:[{type:"none",className:"save-button",value:e.i18n("Save"),events:{onClick:function(){var e=t.container.getElement("[name=KEY_CATENVLINUX]"),n=t.container.getElement("[name=KEY_CATENVLINUX]").value;f.isValidFilePathTxtLinux(n)||""===n?(t.container.getElement("[name=KEY_CATENVLINUX]").hasClassName("error")&&(t.container.getElement("[name=KEY_CATENVLINUX]").removeClassName("error"),t.container.getElement("[name=KEY_CATENVLINUX]").getParent().removeClassName("has-error")),t.mask(),t.model.save({user:t.model.get("id"),userUid:t.model.getUserUid(),catenvLinux:n,platform:t.platform.getId()},{patch:!0,onComplete:function(e,i){t.model.set("catEnvLinux",n),t.unmask(),b.success(i.message)},onFailure:function(e,n){t.unmask(),n.message?b.alert(n.message):b.alert(n)}})):t.getRightErrorMessage(e,n)}}}]});return i.push({tag:"h4",text:e.i18n("Actions"),class:"h4-modal h4-settings"}),t.options.cantChangeRole||i.push({class:"member-details-location location-view user-right",html:this._buildUserRightsSelect()}),i.push({html:this.buildLegal()}),(!this.isCurrentUser()||this.isCurrentUser()&&this.model.get("replace"))&&i.push({tag:"h5",text:e.i18n("User actions"),class:"settings-subtitles"}),this.platform.isPlatform()&&!this.isCurrentUser()&&i.push({class:"action-invitation",html:this.buildInvitation()}),this.model.isCasual()&&i.push({class:"action-switch-casual",html:this.buildSwitchCasual()}),this.isCurrentUser()||(i.push({class:"action-remove-access",html:this.buildRemoveAccess()}),i.push({class:"action-delete",html:this.buildRemove()})),this.isCurrentUser()&&this.model.get("replace")&&i.push(n.render()),i.push(this.options.locationsView),i.push(o),i.push(s),i.push({tag:"h4",text:e.i18n("Options"),class:"h4-modal h4-settings"}),i.push({html:this.buildSupportMode()}),this.platform.isPlatform()&&!this.platform.isOnPremise()&&i.push({html:this.buildContentInstallation()}),i},getRightErrorMessage:function(t,n){"KEY_CATENV"===t.attributes.name.value?(this.container.getElement("[name=KEY_CATENV]").addClassName("error"),this.container.getElement("[name=KEY_CATENV]").getParent().addClassName("has-error"),n.endsWith(".txt")?this.container.getElement(".form-control-error-text").setText(e.i18n("Native Apps Environment Configuration File must be a valid path")):this.container.getElement(".form-control-error-text").setText(e.i18n("Native Apps Environment Configuration File extension must be .txt"))):"KEY_CATENVLINUX"===t.attributes.name.value&&(this.container.getElement("[name=KEY_CATENVLINUX]").addClassName("error"),this.container.getElement("[name=KEY_CATENVLINUX]").getParent().addClassName("has-error"),n.endsWith(".txt")?this.container.getElements(".form-control-error-text")[1].setText(e.i18n("Native Apps Environment Configuration File must be a valid path")):this.container.getElements(".form-control-error-text")[1].setText(e.i18n("Native Apps Environment Configuration File extension must be .txt")))},_buildUserRightsSelect:function(){var t,n,i,o=this,s=o.options.roles,a=[];return s.forEach(function(e){"2"!==e.id&&a.push({value:e.id,label:e.name,selected:!o.model.isContractor()&&o.model.get("role")===e.id})}),a.push({value:"-1",label:e.i18n("External"),selected:!!o.model.isContractor(),disabled:!!o.options.cantChangeRole}),i=new g({attributes:{name:"user-rights"},placeholder:!1,options:o.model.isDeny()?"":a,events:{onChange:function(){t=this.getContent().getElement("[name=user-rights]").value,n="0",o.mask(),"-1"!==t?n=f.getAgreementValue(!1):(t="0",n=f.getAgreementValue(!0)),o.model.save({user:o.model.get("id"),userUid:o.model.getUserUid(),role:t,agreement:n,platform:o.options.platform.getId(),cacheBuster:o.model.get("agreement")},{patch:!0,onComplete:function(e,t){setTimeout(function(){o.model.unset("cacheBuster")},300),b.success(t.message),o.model.fetch({data:{id:o.model.getUserId(),platform:o.options.platform.getId()}}),o.getTemplate(),o.unmask()},onFailure:function(e,t){o.unmask(),b.alert(t.message)}})}}}),[{tag:"h5",html:e.i18n("User right"),class:"settings-subtitles"},i]},buildInvitation:function(){var t=new T({value:e.i18n("Send invitation"),className:"default btn-align",disabled:this.model.isDeny(),events:{onClick:this.sendInvitation.bind(this)}}),n=e.createElement("div",{class:"tooltip-wrapper",html:t});return t.isDisabled()&&(this.tooltip=new h({position:"bottom",target:n,body:f.i18n("User has no access to this 3DExperience platform (change his right before)")})),[n,{tag:"span",html:f.i18n("Send invitation by email to the user to access the 3DEXPERIENCE platform")}]},buildRemove:function(){var t=this,n=new T({value:e.i18n("Remove user"),disabled:!this.canRemove(),className:"error btn-align",events:{onClick:function(){var n=t.model.getUserFullName(),i=new r({className:"platform-management-confirm-modal",closable:!1}),o=e.String.format(e.i18n("Are you sure you want to remove {0}?"),n);i.confirm(o,e.i18n("Confirmation"),function(i){i&&(t.mask(),t.model.destroy({data:{user:t.model.getUserId(),userUid:t.model.getUserUid(),platform:t.options.platform.getId()},wait:!0,onComplete:function(i,o){var s=o.message||e.String.format(e.i18n("{0} has been removed"),n);b.success(s),t.onDelete()},onFailure:function(i,o){o&&o.message?(t.unmask(),b.alert(o.message),t.onDelete()):(t.unmask(),b.alert(e.String.format(e.i18n("Unable to remove {0}"),n)))}})),f.manageSupportOfMultiModal()})}}}),i=e.createElement("div",{class:"tooltip-wrapper",html:n});return n.isDisabled()&&(this.tooltip=new h({position:"bottom",target:i,body:e.i18n("This action will be available when user will have no roles")})),[i,{tag:"span",html:f.i18n("Remove user from 3DEXPERIENCE platform, the user will still be associated with his content")}]},buildSwitchCasual:function(){var t=this,n=new T({className:"primary",disabled:!0!==this.model.get("switchCasual"),value:e.i18n("Switch to Unlimited Usage"),events:{onClick:function(){var n=e.i18n("Do you confirm the switch to Unlimited usage for this User ?")+" "+e.i18n("Please note that this operation cannot be undone.");new r({className:"platform-management-confirm-modal",closable:!1}).confirm(n,e.i18n("Confirmation"),function(e){e&&(t.mask(),t.model.save({user:t.model.get("id"),userUid:t.model.getUserUid(),casual:0,platform:t.options.platform.getId()},{patch:!0,onComplete:function(e,n){t.model.set({casual:0}),b.success(n.message),t.model.fetch({data:{id:t.model.getUserId(),platform:t.options.platform.getId()},onComplete:function(){t.unmask(),t.render()},onFailure:function(){t.unmask()}})},onFailure:function(e,n){t.unmask(),b.alert(n.message)}})),f.manageSupportOfMultiModal()})}}}),i=e.createElement("div",{class:"tooltip-wrapper",html:n});return n.isDisabled()&&(this.tooltip=new h({position:"bottom",target:i,body:e.i18n("Only available if all user roles are available in unlimited usage")})),[i,{tag:"span",text:e.String.format(e.i18n("Switch from Casual usage ({0}h per month) to unlimited usage"),this.model.get("casual"))}]},buildSupportMode:function(){var t=this;return{class:"form-group",html:new m({className:"primary",type:"switch",name:"supportMode",value:"",label:e.i18n("Enable Apps logs for Dassault Systèmes support"),checked:t.model.get("supportMode"),events:{onClick:function(){var e=this;t.mask(),w.setSupportMode({params:{user:t.model.get("id"),userUid:t.model.getUserUid(),enable:this.isChecked()},callbacks:{onComplete:function(e){var n=e.message;b.success(n),t.unmask()},onFailure:function(){e.uncheck(),t.unmask()}}})}}})}},buildContentInstallation:function(){var t,n=this,i="contentInstallation";return t=e.createElement("div",{class:"form-group installation",html:new m({className:"primary",type:"switch",name:i,value:"",label:e.i18n("Enable Optional Content Installation access"),checked:!!n.platform.get(i)||!0===n.model.get(i),disabled:n.platform.get(i),events:{onClick:function(){var e=this,t=this.isChecked();n.mask(),n.model.save({user:n.model.get("id"),userUid:n.model.getUserUid(),contentInstallation:t,platform:n.platform.getId()},{patch:!0,onComplete:function(e,i){n.model.set("contentInstallation",t),n.unmask(),b.success(i.message)},onFailure:function(t,i){n.unmask(),e.uncheck(),b.alert(i.message)}})}}})}),n.platform.get(i)&&new h({position:"left",target:t,body:e.i18n("Already unlocked for all members")}),t},buildRemoveAccess:function(){var t=this,n=new T({value:e.i18n("Remove access"),className:"error btn-align",disabled:!this.canRemoveAccess(),events:{onClick:function(){var n=t.model.getUserFullName(),i=new r({className:"platform-management-confirm-modal",closable:!1}),o=e.String.format(e.i18n(" Are you sure you want to remove platform access for {0}?"),n);i.confirm(o,e.i18n("Confirmation"),function(e){e&&(t.mask(),t.model.save({user:t.model.get("id"),userUid:t.model.getUserUid(),role:"2",platform:t.options.platform.getId()},{patch:!0,onComplete:function(e,n){t.model.set({role:"2"}),t.render(),b.success(n.message),t.model.fetch({data:{id:t.model.getUserId(),platform:t.options.platform.getId()},onComplete:function(){t.unmask()},onFailure:function(){t.unmask()}})},onFailure:function(e,n){t.unmask(),b.alert(n)}})),f.manageSupportOfMultiModal()})}}}),i=e.createElement("div",{class:"tooltip-wrapper",html:n});return n.isDisabled()&&(this.tooltip=new h({position:"bottom",target:i,body:f.i18n("Only available if the user can't be removed or if user has already no access to this 3DExperience platform")})),[i,{tag:"span",html:f.i18n("Remove access to the 3DEXPERIENCE platform, user will not be allowed to connect")}]},sendInvitation:function(){var e=this,t=new _;this.mask(),t.save({platform:e.platform.getId(),email:this.model.get("email"),casual:this.model.get("casual")},{onComplete:function(t,n){e.unmask(),b.success(n.message)},onFailure:function(t,n){e.unmask(),b.alert(n.message)}})},canRemove:function(){return this.model.get("remove")&&!this.isCurrentUser()},isCurrentUser:function(){return this.currentUserId===this.model.get("id")},canRemoveAccess:function(){return this.model.get("deny")&&!this.isCurrentUser()&&"2"!==this.model.get("role")&&this.model.get("active")}}),B=t.extend({tagName:"div",className:"facet-tpa",setup:function(e){if(this.options=e||{},!this.options.platform)throw new Error("A platform need to be set");return this.platform=this.options.platform,this._parent(e)},render:function(){return this.container.setContent(this.buildAppsSkeleton()),this},buildAppsSkeleton:function(t){return this.model.set("appsActive",!0),new D({fullCollection:new x([],{data:{platform:this.platform.getId(),userUid:this.model.getUserUid(),user:this.model.getUserId()}}),grantedCollection:new x([],{data:{platform:this.platform.getId(),userUid:this.model.getUserUid(),user:this.model.getUserId(),granted:!0}}),platform:this.platform,model:this.model,searchPlaceholder:e.i18n("Search Additional Apps"),emptyView:{icon:"app",text:e.i18n("No Additional Apps found")}}).render()}}),G=t.extend({tagName:"div",className:"facet-selfexp",setup:function(e){if(this.options=e||{},!this.options.platform)throw new Error("A platform need to be set");return this.platform=this.options.platform,this._parent(e)},render:function(){return this.container.setContent(this.getTemplate()),this},getTemplate:function(t){return this.model.set("detailUsersActive",!0),new D({grantedCollection:new I([],{data:{platform:this.platform.getId(),user:this.model.getUserId(),userUid:this.model.getUserUid(),granted:!0}}),platform:this.platform,searchPlaceholder:e.i18n("Search Suggested Role"),title:e.i18n("Suggested Role"),emptyView:{icon:"role",text:e.i18n("No Suggested Role found")},model:this.model}).render()}});return n.extend({content:null,cache:null,locationsView:null,init:function(e){var t=this;this.platform=e.platform,this.model=e.model,this.locationsView=new A({model:this.model,platform:this.platform,className:"member-details-location"}),this.cache={},this._parent(e),this.modal=new a({closable:!0,header:this.model.getUserFullName(),className:"modal-member",body:"",footer:"",events:{onHide:function(){t.idCard&&t.idCard.destroy(),this.destroy()}}}),this.elements.container=this.modal},hasTPA:function(){return this.options.tpa||e.is(f.getWidget().getElement(".tp-apps"))},buildHeader:function(){var t=this,n=[{text:e.i18n("Roles"),icon:"role",handler:function(){t.modal.setBody(t.getFacet(0))}}];return this.hasTPA()&&n.push({text:e.i18n("Additional Apps"),icon:"app",handler:function(){t.modal.setBody(t.getFacet(1))}}),this.model.get("selfexp")&&n.push({text:e.i18n("Suggested Role"),icon:"pmt fonticon-pmt-selfexp",handler:function(){t.modal.setBody(t.getFacet(3))}}),n.push({text:e.i18n("Settings"),icon:"cog",handler:function(){t.modal.setBody(t.getFacet(4))}}),new o({model:this.model,thumbnailUrl:function(){return this.getProfile(U.shouldLoadPicture(),t.platform.get("swym"))},attributesMapping:{title:function(){return this.getUserFullName(!0)+(!1===this.get("licensed")?'<i class="fonticon fonticon-key"></i>':"")},ownerName:function(){return'<div class="owner-name-color">'+this.getCityAndCountryFullName()+"</div>"},description:function(){var n="<a>"+this.get("email")+"</a>";return n+=t.getPendingText(),this._attributes.hasOwnProperty("passport2Factor")&&this._attributes.hasOwnProperty("lastConnexion")?n+='<div class="authentication">'+e.i18n("2-Factor Authentication: ")+this.getUser2FactorAuthentication()+" / "+e.i18n("Last connection: ")+this.getUserLastConnection()+"</div>":this._attributes.hasOwnProperty("passport2Factor")&&!this._attributes.hasOwnProperty("lastConnexion")?n+='<div class="authentication">'+e.i18n("2-Factor Authentication: ")+this.getUser2FactorAuthentication()+"</div>":!this._attributes.hasOwnProperty("passport2Factor")&&this._attributes.hasOwnProperty("lastConnexion")&&(n+='<div class="authentication">'+e.i18n("Last connection: ")+this.getUserLastConnection()+"</div>"),n+='<div class="js-select-role"></div>',this.isCasual()&&this.isContractor()?n+='<div class="bright-orange">'+t.getConsumptionText(this.get("casual"),this.get("consumption")||0)+"</div>":this.isCasual()&&(n+='<div class="bright-orange">'+t.getConsumptionText(this.get("casual"),this.get("consumption")||0)+"</div>"),setTimeout(t.updateSelectRole.bind(t),10),n}},actions:[],facets:function(){return n}})},getConsumptionText:function(t,n){var i="",o=60*t-n,s=Math.floor(o/60),a=o%60;return s>0&&0===a?i=s>1?e.String.format(e.i18n("Casual usage ({0}h/month): {1} hours remaining"),t,s):e.String.format(e.i18n("Casual usage ({0}h/month): {1} hour remaining"),t,s):s>0?s>1&&a>1?i=e.String.format(e.i18n("Casual usage ({0}h/month): {1} hours and {2} minutes remaining"),t,s,a):1===s&&a<=1?i=e.String.format(e.i18n("Casual usage ({0}h/month): {1} hour and {2} minute remaining"),t,s,a):s>1&&a<=1?i=e.String.format(e.i18n("Casual usage ({0}h/month): {1} hours and {2} minute remaining"),t,s,a):1===s&&a>1&&(i=e.String.format(e.i18n("Casual usage ({0}h/month): {1} hour and {2} minutes remaining"),t,s,a)):i=a>1?e.String.format(e.i18n("Casual usage ({0}h/month): {1} minutes remaining"),t,a):e.String.format(e.i18n("Casual usage ({0}h/month): {1} minute remaining"),t,a),i},getDropdown:function(){var t=this,n=[];return this.roles.forEach(function(e){"2"===e.id||t.model.get("role")===e.id&&!t.model.isContractor()||n.push({"data-id":e.id,value:e.id,text:e.name,label:e.name,selected:t.model.get("role")===e.id})}),t.model.isContractor()&&!this.model.isDeny()||n.push({"data-id":"-1",value:"-1",text:e.i18n("External"),label:e.i18n("External"),selected:"-1"===t.model.get("role")}),n},getRoleLabel:function(){var t;if(!this.model.isDeny()&&this.model.isContractor())t={id:"-1",name:e.i18n("External")};else{var n=this.model.get("role");t=e.Array.detect(this.roles,function(e){return e.id===n})}return t&&t.name||""},isCurrentUser:function(){return R===this.model.get("id")},updateSelectRole:function(){this.modal.getHeader().getElement(".description-section .js-select-role").setContent(this.buildSelectRole())},cantChangeRole:function(){return this.isCurrentUser()||!this.platform.isPlatform()},buildSelectRole:function(){var t=this,n=e.createElement("a",{class:!this.model.isDeny()&&this.model.isContractor()?f.getRoleColor("3",!0):f.getRoleColor(this.model.get("role"),!0),html:this.getRoleLabel()+(this.cantChangeRole()?"":'<span class="caret"></span>')});return this.cantChangeRole()||new N({target:n,items:t.cantChangeRole()?null:t.getDropdown(),events:{onClick:function(e,n){var i=n["data-id"],o="0";t.modal.mask(),"-1"!==i?o=f.getAgreementValue(!1):(i="0",o=f.getAgreementValue(!0)),t.model.save({user:t.model.get("id"),userUid:t.model.getUserUid(),role:i,agreement:o,platform:t.options.platform.getId(),cacheBuster:t.model.get("agreement")},{patch:!0,onComplete:function(e,n){setTimeout(function(){t.model.unset("cacheBuster")},500),b.success(n.message),t.model.fetch({data:{id:t.model.getUserId(),platform:t.options.platform.getId()}}),t.modal.unmask()},onFailure:function(e,n){t.modal.unmask(),b.alert(n)}})}}}),n},getFacet:function(t){var n=this.cache[t];if(e.is(n))switch(t){case 0:!0===this.model.get("appsActive")&&this.model.set("appsActive",!1);break;case 1:!1===this.model.get("appsActive")&&this.model.set("appsActive",!0)}else{switch(t){case 0:this.model.set("appsActive",!1),this.cache[t]=new O({model:this.model,platform:this.platform,events:{onRemoveAllGrantedRole:function(){this.options.memberList&&(this.options.memberList.forceRefreshView=!0,this.options.memberList.refresh()),this.hide()}.bind(this)}}).render();break;case 4:this.cache[t]=new V({platform:this.platform,model:this.model,roles:this.roles,getRole:this.getRoleLabel(),getOptionsUserRights:this.getDropdown(),cantChangeRole:this.cantChangeRole(),locationsView:this.locationsView?this.locationsView.render():null,onDelete:function(){this.options.memberList&&(this.options.memberList.forceRefreshView=!0,this.options.memberList.refresh(),this.options.processList.refresh()),this.hide()}.bind(this)}).render();break;case 1:this.cache[t]=new B({model:this.model,platform:this.platform}).render();break;case 3:this.cache[t]=new G({model:this.model,platform:this.platform}).render()}n=this.cache[t]}return n},getPendingText:function(){var t="";return this.model.get("active")||(t=this.model.get("invited")?"<span> "+e.i18n("(Pending since ")+this.model.get("invited")+")</span>":"<span> "+e.i18n("(Pending)")+"</span>"),t},show:function(){var t=this,n=3,i=function(){0===--n&&(t.idCard=t.buildHeader(),t.modal.setHeader(t.idCard),!1===t.model.get("licensed")&&new h({position:"top",target:t.elements.container.getHeader().getElement(".fonticon-key"),body:e.i18n("User has been invited to the platform without his own license and can access the platform with shared license.")}),t.idCard.selectFacet(0),t.modal.unmask())};return t.modal.mask(),this.modal.getFooter().addClassName("hidden"),this.modal.inject(document.body,"top").show(),(new L).fetch({onComplete:function(e,n){t.roles=n.roles,t.agreements=n.agreements,i()}}),this.model.fetch({data:{platform:this.platform.getId(),id:this.model.getUserId(),uid:this.model.getUserUid()},onComplete:function(){i()}}),U.fetch({onComplete:function(){i()}}),this}})}),define("DS/PlatformManagement/Views/SelectBusinessExperiencesView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/PlatformManagement/Controls/Input/Text","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","DS/UIKIT/Mask","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/BusinessExperienceCollection","UWA/Event"],function(e,t,n,i,o,s,a,l,r,c,m,d,u){"use strict";return t.extend({tagName:"div",setup:function(e){if(e.collectionSelected&&(this.collectionSelected=e.collectionSelected),!e.platform)throw new Error("platform is mandatory");return this.platform=e.platform,this.collection.url=this.collection.url+"/"+e.platform.getId(),e},render:function(){return this.filterData(),this.subView?this.collection.isFetched()&&(this.subView.setContent(this.buildSubView()),this.unmask()):(this.container.setContent(this.buildBusinessExperiencesSkeleton()),this.mask()),this.options.setNextDisabled&&this.options.setNextDisabled(!1),this},buildBusinessExperiencesSkeleton:function(){return[this.buildSearch(),this.buildSubView()]},buildSubView:function(){return this.subView=e.createElement("div",{styles:{position:"relative"},class:"wrapper",html:[this.collectionSelected&&this.collectionSelected.size()>0?this.buildSelectedTable():{class:"text-center",text:this.options.emptyText||""},this.collection&&this.collection.size()>0?this.buildTable():null]}),this.subView},buildSelectedTable:function(){return{tag:"table",class:"table table-hover table-select-process table-selection",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:e.i18n("Selected")}]}},{tag:"tbody",html:this.buildSelectedRows()}]}},buildSelectedRows:function(){var e=[],t=this;return this.collectionSelected.forEach(function(n){e.push(t.buildRow(n))}),e},buildTable:function(){return{tag:"table",class:"table table-hover table-select-process",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",colspan:2,text:this.options.titleTableCollection?this.options.titleTableCollection:e.i18n("Available")}]}},{tag:"tbody",html:this.buildRows()}]}},buildRows:function(e){var t=[],n=this,i=this.collection;return e&&(i=e),i.forEach(function(e){t.push(n.buildRow(e,"other"))}),t},buildRow:function(t){var n=this,i=n.collectionSelected.contains(t);t.isTPA()&&!1===t.get("private")&&(i=!0);var s=new o({"data-free":t.get("free"),className:"primary",type:"checkbox",name:"businessExperiences[]",value:t.get("uuid"),id:t.get("id"),label:t.get("title"),checked:i});return e.createElement("tr",{html:[{tag:"td",styles:{"vertical-align":"middle"},html:s}],events:{click:function(i){var o;if(!s.isDisabled()&&!i.target.getParent(".toggle-switch")){var a=!s.isChecked();s.setCheck(a),o=s,n.options.tagger&&n.options.tagger.getSelected().length,o.isChecked()?(n.collectionSelected.add(t),n.collection.remove(t.uuid),n.render()):r.warn(e.i18n("You have not enough role")),u.stop(i)}}}})},filterData:function(){var e=this;e.collectionSelected.forEach(function(t){t&&e.collection.remove(t)})},_fetchSearch:function(e){var t=this;this.mask(),this.collection.setQuery(e),this.collection.setOffset(0),this.collection.reset(),this.collection.fetch({onComplete:function(){t.render()}})},_search:function(e){var t,n=this;this.collection.isFetched()?this._fetchSearch(e):(t=function(){n.collection.removeEvent("onAdd",t),setTimeout(function(){n._fetchSearch(e)},100)},this.collection.addEvent("onAdd",t))},buildSearch:function(){var e=this;return new i({attributes:{placeholder:this.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:function(){e._search.call(e,this.value.trim())}}}})},getBody:function(){return this.content||(this.content=this.container.getElement(".wrapper")),this.content},mask:function(){this.isMasked()||(a.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(a.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Modal/InviteMember",["UWA/Core","UWA/Controls/Abstract","UWA/Controls/Input","DS/UIKIT/Mask","DS/UIKIT/Tooltip","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Input/File","DS/UIKIT/Autocomplete","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Tagger","DS/PlatformManagement/Utils","DS/PlatformManagement/Views/SelectAppsView","DS/PlatformManagement/Views/SelectBusinessExperiencesView","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Collection/BusinessExperienceCollection","DS/PlatformManagement/Model/ImportModel","DS/PlatformManagement/Views/LocationView","DS/PlatformManagement/Model/PlatformModel","DS/PlatformManagement/Model/UserRightModel","DS/PlatformManagement/Views/StepsView","UWA/Class/Model","UWA/Class/Collection","DS/PlatformManagement/UsageTracker","DS/PlatformManagement/Collection/CompaniesCollection","DS/PlatformManagement/Views/HelperText"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M,k,I,T,A,U){"use strict";var L,N,_=null,F=[!1,!1];return t.extend({defaultOptions:{platform:null,onAdded:function(){}},casualType:{casual:0},mode:0,step:0,viewStep2Casual:null,viewStep3Casual:null,viewStep4Casual:null,id:f.getUUID(),selectedLicenses:[],nextButtonDisabled:!0,locationsView:null,init:function(e){this._parent(e),e.mode&&(this.mode=e.mode),this.platform=e.platform,this.inviteInProgress=!1,this.uploadInProgress=!1,this.casualHasRole={},this.buildContainer(),T.inviteMember({tenant:this.platform&&this.platform.get?this.platform.get("id"):""})},buildContainer:function(){var t=this,n=new b([]),i=4,o=function(){0===--i&&(t.viewStep1=t.buildContent(),t.modal.unmask(),t.elements.container.setBody(t._getTemplate(t.viewStep1)),t.dispatchEvent("onRendered"))};this.modal=new s({closable:!0,className:"invite-member",header:this.getModalTitle(),body:{class:"empty-body"},footer:"",events:{onHide:function(){L=null,_=null,F[0]=!1,this.destroy()}}}),this.elements.container=this.modal,this.elements.container.inject(document.body,"top").show(),this.modal.mask(),t.elements.container.setFooter(t.getButtons()),(new E).fetch({onComplete:function(e,n){t.roles=n.roles,t.agreements=n.agreements,o()}}),t.platform.fetch({data:{id:this.platform.get("id"),availability:!0},onComplete:function(i){t.data=i.toJSON();var s=[];if(t.locationsView=new P({text:e.i18n("User location"),platform:t.platform,layout:"invite"}),t.platform&&t.platform.get("availability")){var a=t.platform.get("availability");a.forEach(function(e){40===e.casual&&s.push(e)}),s.length===a.length&&(t.casualType.casual=40,t.casualHasRole[t.casualType.casual]=!0,t.hasCasualRolesOnly=!0,n.fetch({data:{selfexp:!1,platform:t.platform.get("id"),casual:40,limit:1,apps:!1},onComplete:function(e){t.casualHasRole[t.casualType.casual]=e.length>0,t.manageButtonNextText(t.casualHasRole[t.casualType.casual]),o()}}))}o()}}),n.fetch({data:{selfexp:!1,platform:t.platform.get("id"),casual:0,limit:1,apps:!1},onComplete:function(e){t.hasCasualRolesOnly||!0!=!t.hasCasualRolesOnly?t.hasCasualRolesOnly=!1:t.casualHasRole[t.casualType.casual]=e.length>0,t.manageButtonNextText(t.casualHasRole[t.casualType.casual]),o()}}),f.getParentModule("DS/UWPClientCode/I18n",function(e){N=e,o()})},_canCrossCompany:function(){return 0===this.mode&&this.platform.canCrossCompany()},createStepView:function(e,t){this.needSecondStep()?(this.step=2===t?3:3===t?3:0===this.step?1:3,this.elements.container.setFooter(this.getButtons()),1===this.step&&!0!==this.checkStepOne()?(this.viewStep2=this.buildContent(),this.elements.container.setBody(this._getTemplate(this.viewStep2))):t&&0===t||!0===this.nextButtonDisabled&&0===e?(this.step=0,this.elements.container.setFooter(this.getButtons()),this.viewStep1=this.buildContent(),this.elements.container.setBody(this._getTemplate(this.viewStep1))):(this.viewStep4=this.buildContent(),this.elements.container.setBody(this._getTemplate(this.viewStep4))),this.dispatchEvent("onNextViewRendered")):this.onClickInvite()},createPreviousStepViewClick:function(e,t){this.step=t===e-1?e-1:t===e-2?e-2:t===e-3?e-3:"",this.nextButtonDisabled=!1,this.elements.container.setFooter(this.getButtons()),0===this.step?this.elements.container.setBody(this._getTemplate(this.viewStep1)):1===this.step?this.elements.container.setBody(this._getTemplate(this.viewStep2)):this.elements.container.setBody(this._getTemplate(this.viewStep4))},buildContent:function(){var t,n,i,o,s=N.getSupportedLanguages(),r=[],m=(new U).render(0===this.mode?e.i18n("If multiple separate by ';'"):""),u=this,C=this.buildCasual(),v=new I([{id:1,label:"Members"},{id:2,label:"Roles"}]);if(this.platform.isPlatform()&&v.add({id:4,label:"Additional Apps"}),this.stepsView?this.stepsView.setStep(this.step+1):(this.stepsView=new M({collection:v,stepNumber:this.step+1}).render(),this.stepsView.getElements(".step").forEach(function(e){e.addEvent("click",function(){var e=u.step,t="Members"===this.getElementsByClassName("step-number")[0].getText()?0:"Roles"===this.getElementsByClassName("step-number")[0].getText()?1:"Additional Apps"===this.getElementsByClassName("step-number")[0].getText()?3:2;u.stepsView.container.getElements(".step")[2];0===e&&!1!==u.nextButtonDisabled||(t===e-1||t===e-2||t===e-3?u.createPreviousStepViewClick(e,t):!1!==u.nextButtonDisabled||t!==e+1&&t!==e+2&&t!==e+3||u.createStepView(e,t))})})),0===this.step){for(n in s)s.hasOwnProperty(n)&&(o=(i=s[n]).localizedName+" ("+i.staticName+")",r.push({value:n,label:o,selected:n===f.getLang()}));0===this.mode?this.elements.tagger=new p({placeholder:e.i18n("Enter email"),limit:this._getMinAvailability(),focus:!0,validator:function(e){return f.isEmail(e)},onError:function(){var t=0!==u.casualType.free||u._canCrossCompany()?e.i18n("Your Email is not valid"):e.i18n("No more roles available"),n=u.elements.tagger.elements.container.getElement(".tag-input-wrapper");!n.hasClassName("second-time")&&n.hasClassName("has-error")&&(u.errorInterval||(setTimeout(function(){!0===u.elements.container.isVisible&&h.alert(t)},200),u.errorInterval=!0,setTimeout(function(){u.errorInterval=null},2e3))),F[0]=!1,u.checkStepOne()},onLimitError:function(){var t=10<u.casualType.free?e.i18n("The number of invitations is limited to ten. If you need to invite more than ten people, use the batch invitation available in the Import Members tab."):e.i18n("No more roles available");u._getMinAvailability()<10&&u._getMinAvailability()<u.casualType.free&&(t=e.String.format(e.i18n("You can't add more than {0} emails because of selected roles"),u._getMinAvailability())),u.errorInterval||(h.warn(t),h.notifier.options.autoHide=!1,u.errorInterval=!0,setTimeout(function(){u.errorInterval=null},2e3)),F[0]=!1,u.checkStepOne()},onDuplicateError:function(){var t=e.i18n("This email already exists"),n=u.elements.tagger.elements.container.getElement(".has-error-duplicate");n.hasClassName("second-time")?u.isVisible=!0:(h.alert(t),n.addClassName("second-time"),u.isVisible=!0),F[0]=!1,u.checkStepOne(),u.setNextDisabled(!0)},onSuccess:function(){var e=u.elements.tagger.getSelected().length;null===u.elements.tagger.elements.container.getElement(".has-error")&&(e>0&&!0===u.platform.get("platform")||e>0&&!1===u.platform.get("platform"))?(F[0]=!0,u.checkStepOne()):(F[0]=!1,u.checkStepOne())},validatorAsync:function(t,n){var i=new y;F[0]=!1,u.checkStepOne(),i.setLimit(15),i.setOffset(0),i.setQuery(t),i.setPlatform(u.platform.get("id")),i.fetch({onComplete:function(){var o=i.find(function(e){return e.get("email").toLowerCase()===t.toLowerCase()});e.is(o)?(h.alert(e.i18n("You cannot invite a user already on the platform")),F[0]=!1,u.checkStepOne(),n.onFailure()):n.onComplete()},onFailure:function(){n.onFailure()}})},onChange:function(){var e=u.elements.tagger.getSelected().length;"none"!==u.platform&&(u.updateAvailability(),u.updateNewMember()),e&&(F[0]=!1,u.checkStepOne())}}):(this.elements.iframe=e.createElement("iframe",{class:"hidden",id:"uploadFrame"+this.id,name:"uploadFrame"+this.id,src:g.getUrl("resources")+"s.gif",events:{load:function(){u.uploadInProgress?(u.uploadInProgress=!1,setTimeout(function(){u.modal.unmask(),h.success(e.i18n("Import has been created")),u.options.onAdded&&u.options.onAdded(),u.hide()},300)):u.modal.unmask()}}}),this.elements.form=e.createElement("form",{class:"form-wrapper",action:"#",method:"POST",enctype:"multipart/form-data",target:"uploadFrame"+this.id,html:[{tag:"input",type:"hidden",name:"__fcs__jobTicket",id:"__fcs__jobTicket"},new d({showResetButton:!1,className:"input-file",attributes:{name:"file_import"},buttonBefore:!1,events:{onChange:function(){var t=this.elements.input,n=this.getValue(),i=f.getFileExtension(n),o=t.getParent(".form-group");""!==n&&"csv"===i?(o.removeClassName("has-error"),F[0]=!0,u.setNextDisabled(!1)):""!==n?(u.setNextDisabled(!0),o.addClassName("has-error"),h.alert(e.i18n("Wrong file type. Please select a correct csv file.")),this.setValue()):(o.removeClassName("has-error"),u.setNextDisabled(!0))}}}),{tag:"a",target:"_blank",href:f.getAsset("data/import-sample.csv"),html:new c({value:e.i18n("Download sample"),icon:"download",events:{onClick:function(){e.Utils.Client.Engine.ie&&window.open(f.getAsset("data/import-sample.csv"))}}})},{tag:"input",type:"hidden",value:g.getUrl("faillurePageImport"),name:"__fcs__failurePage",id:"__fcs__failurePage"},{tag:"input",type:"hidden",value:"false",name:"attachment",id:"attachment"},{tag:"input",type:"hidden",value:"",name:"file_0_name",id:"file_0_name"}]})),t=e.createElement("div",{html:[{class:"row",html:{class:"form-group col-sm-12",html:[this.elements.newmember,{tag:"label",class:"control-label",html:0===this.mode?e.i18n("User email"):e.i18n("Select a file to import")},0===this.mode?{class:"wrapper",html:this.elements.tagger}:[this.elements.form],m]}},0===this.mode?{class:"row",html:[this.displayCompany()?this.buildCompany():this.buildPlatform()]}:{class:"row",html:this.buildCompany()},0===this.mode?this.displayCompany()?{class:"row",html:[this.buildPlatform()]}:{styles:{width:"40%"},html:this.buildCompany()}:null,{styles:{clear:"both"}},{class:"row",html:C},this.locationsView.hasLocations()?{class:"row",html:{class:"form-group col-sm-6",html:this.locationsView.render()}}:null,{class:"row",html:{class:"form-group col-sm-6",html:[{tag:"label",for:"language-"+this.id,text:e.i18n("Invitation Email language")},new l({attributes:{id:"language-"+this.id,name:"language"},placeholder:!1,options:r,className:"select-language"})]}},{class:"row",html:{class:"form-group col-sm-12",html:[{tag:"label",for:"text-"+this.id,text:e.i18n("Personalized message")},new a({multiline:!0,attributes:{id:"text-"+this.id,name:"text",rows:8}})]}}]})}else 1===this.step?u.viewStep2&&u.viewStep2Casual===u.casualType.casual?(t=L.render(),L._manageNextButton()):(u.viewStep2Casual=u.casualType.casual,t=e.createElement("div",{html:[this.stepsView,u.buildLicensesSkeleton()]}),u.viewStep2=t):u.viewStep4&&u.viewStep4Casual===u.casualType.casual?(t=u.viewStep4,L._manageNextButton()):(u.viewStep4Casual=u.casualType.casual,t=e.createElement("div",{html:[this.stepsView,u.options.hasApp?u.buildAppsSkeleton():null]}),u.viewStep4=t);return t},updateAvailability:function(){this.elements.tagger.options.limit=this._getMinAvailability()},updateNewMember:function(){(this.getContent().getBody().getElement(".pull-right")?this.getContent().getBody().getElement(".pull-right"):this.elements.newmember).setText(this.getNewMemberText())},_getMinAvailability:function(){var e,t=10;return this._canCrossCompany()||(L?(e=L.getMaxFreeRole())&&(t=Math.min(e,t)):t=Math.min(this.casualType.free,t)),Math.min(10,t)},getNewMemberText:function(){var t=this.elements.tagger?this.elements.tagger.getSelected().length:0;return 0===t||1===t?"#"+t+e.i18n(" new member"):t>1?"# "+t+e.i18n(" new members"):void 0},buildCasual:function(){var t,n=this.data.availability,i=[],o=this;return n.forEach(function(t){e.is(o.casualType.free)||o.casualType.casual!==t.casual||(o.casualType=t),i.detect(function(e){return e.value===""+t.casual})||i.push({value:""+t.casual,label:0===t.casual?e.i18n("Unlimited"):e.String.format(e.i18n("Casual {0}h/month"),t.casual),selected:o.casualType.casual===t.casual})}),this.elements.newmember=e.createElement("span",{class:"pull-right"+(1===o.mode?" hidden":""),text:this.getNewMemberText()}),t=new l({attributes:{name:"casual",id:"casual-"+this.id},placeholder:!1,options:i,events:{onChange:function(){var t=parseInt(this.getValue()[0],10),i=new b([]);o.casualType=e.Array.detect(n,function(e){return e.casual===t}),o.options.hasApp||(e.is(o.casualHasRole[o.casualType.casual])?o.manageButtonNextText(o.casualHasRole[o.casualType.casual]):(o.modal.mask(),i.fetch({data:{limit:1,platform:o.platform.get("id"),casual:o.casualType.casual,selfexp:!1,apps:!1},onComplete:function(e){o.modal.unmask(),o.casualHasRole[o.casualType.casual]=e.length>0,o.manageButtonNextText(o.casualHasRole[o.casualType.casual])}}))),o.updateAvailability(),o.updateNewMember()}}}),[{class:i.length>1?"form-group col-sm-6":"form-group col-sm-6 hidden",html:[{tag:"label",for:"casual-"+this.id,text:e.i18n("Usage Type")},t]}]},displayCompany:function(){var e,t=this.data.companies||[];return t.length>1?(e=!0,F[1]=!0,_=t[0].id):(e=!1,1===t.length?(_=t[0].id,F[1]=!0):(_=null,F[1]=!0)),e},buildCompany:function(){var t=this,n=this.data.companies,i=this.elements.company,o={name:"default",items:[]};n.forEach(function(e,t){t<5&&o.items.push({label:e.name,value:e.id})});var s=new A,a={name:"remoteDataset",remoteSearchEngine:function(e,t){var n,i=this;return new Promise(function(o,a){s.fetch({data:{query:t},onComplete:function(t,s){(n={}).dataset=e,n.matchingItems=t&&e.dataParser&&e.dataParser.call(i,e,s),o(n)},onFailure:function(t){t.type="error",t.dataset=e,a(t)},onTimeout:function(t){t.type="timeout",t.dataset=e,a(t)}})})},dataParser:function(e,t){var n=[],i=[],o=this;return t.forEach(function(t){t.Error&&e.onError.call(o,n,""),t&&i.push({label:t.displayName,value:t.name})}),i}};return(i=new u({className:"company",maxSuggestsToDisplay:5,placeholder:"Search a company ...",minLengthBeforeSearch:3,typeDelayBeforeSearch:700,showSuggestsOnFocus:!0,events:{onKeyUp:function(){var e=i.elements.input.value;if(t.autocompleteReset(),0===e.length)i.getDataset("remoteDataset")&&(i.removeDataset(0),i.addDataset(o),i.getSuggestions(e,!1));else if(e.length>2&&!i.getDataset("remoteDataset")){var n=i.elements.input.value;i.removeDataset(0),i.elements.input.value=n,i.addDataset(a)}},onSelect:function(e){_=e.value,F[1]=!0,t.checkStepOne()},onUnselect:function(){var e=i.elements.input.value;t.autocompleteReset(),i.getDataset("remoteDataset")&&(i.removeDataset(0),i.addDataset(o)),setTimeout(function(){e="",i.getSuggestions(e,!1)},200)}}})).elements.input.addEventListener("drop",function(){t.autocompleteReset(),setTimeout(function(){t.autocompleteCheckDataset(o,a,i)},200)}),i.elements.input.addEventListener("paste",function(){t.autocompleteReset(),setTimeout(function(){t.autocompleteCheckDataset(o,a,i)},200)}),i.elements.input.addEventListener("change",function(){t.autocompleteReset(),setTimeout(function(){var e=i.elements.input.value;0===e.length&&(i.getDataset("remoteDataset")&&(i.removeDataset(0),i.addDataset(o)),i.getSuggestions(e,!1))},200)}),i.addDataset(o),i.toggleSelect(o.items[0],!0),{class:this.displayCompany()?"form-group col-sm-6":"form-group col-sm-6 hidden",html:[{tag:"label",for:"company-"+this.id,text:e.i18n("Company")},i]}},autocompleteReset:function(){_=null,F[1]=!1,this.checkStepOne()},autocompleteCheckDataset:function(e,t,n){var i=n.elements.input.value;0===i.length?(n.getDataset("remoteDataset")&&(n.removeDataset(0),n.addDataset(e)),n.getSuggestions(i,!1)):i.length>2&&(n.getDataset("remoteDataset")||(n.removeDataset(0),n.addDataset(t)),n.getSuggestions(i,!1))},buildRoles:function(){var t,n=this.roles.length,i=[];for(t=0;t<n;t++)"2"!==this.roles[t].id&&i.push({value:this.roles[t].id,label:this.roles[t].name});return i.push({value:"-1",label:e.i18n("External")}),this.elements.roles=new l({attributes:{name:"role",id:"role-"+this.id},placeholder:!1,options:i,events:{onChange:function(){}}}),this.elements.roles},buildSelectAgreement:function(){var t,n=this,i=[],o=this.agreements.length;for(t=0;t<o;t++)"-1"!==this.agreements[t].id&&i.push({value:this.agreements[t].id,label:this.agreements[t].name});return this.selectAgreement=new r({type:"checkbox",name:"agreement",value:"",label:e.i18n("External"),className:"primary",events:{onClick:function(){n.elements.roles.setDisabled(this.isChecked())}}}),this.selectAgreement},getModalTitle:function(){var t=e.i18n("Invite members");return!1===this.platform.get("platform")&&(t=e.i18n("Grant Roles")),t},buildPlatform:function(){return{class:"form-group col-sm-6"+(this.platform.isPlatform()?"":" hidden"),html:[{tag:"label",for:"role-"+this.id,text:e.i18n("User right")},this.buildRoles()]}},buildLicensesSkeleton:function(){var t=this,n=0,i=new b([],{data:{platform:this.platform.get("id"),casual:this.casualType.casual,selfexp:!1,apps:!1,withLicenses:!0}}),o=new b([],{data:{platform:this.platform.get("id"),casual:this.casualType.casual,selfexp:!1,apps:!1,withLicenses:!1}}),s=new b,a=new C({disabledCrossCompany:!t._canCrossCompany(),isBatchInvite:1===t.mode,collection:i,titleTableCollection:t._canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&t.platform.isOnPremise()&&t._canCrossCompany()?e.i18n("Available roles with licenses"):null,collectionWithOutLicenses:t._canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&t.platform.isOnPremise()&&0===t.mode?o:null,titleTableCollectionWithOutLicenses:t._canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&t.platform.isOnPremise()&&0===t.mode?e.i18n("Available roles without any license"):null,collectionSelected:s,searchPlaceholder:e.i18n("Search Roles"),tagger:this.elements.tagger,platform:this.platform,setNextDisabled:this.setNextDisabled.bind(this)});e.createElement("span",{class:"fonticon fonticon-down-dir",styles:{opacity:"1"}});return L=a,i.setLimit(999),i.fetch({onComplete:function(){/*!that.platform.canCrossCompanyExtended() ||*/t._canCrossCompany()&&2!==n?n=1:a.render()}}),(t._canCrossCompany()||f.isBetaModeActivated("crossCompanyOnPremise")&&t.platform.isOnPremise()&&0===t.mode)&&(o.setLimit(999),o.fetch({onComplete:function(){1===n?a.render():n=2}})),[a.render(),{class:"clearfix"}]},buildAppsSkeleton:function(){var t=new w([],{data:{platform:this.platform.get("id")}}),n=new w,i=new C({collection:t,platform:this.platform,collectionSelected:n,searchPlaceholder:e.i18n("Search Additional Apps")});e.createElement("span",{class:"fonticon fonticon-down-dir",styles:{opacity:"1"}});return t.setLimit(999),t.fetch({onComplete:function(){i.render()}}),[i.render(),{class:"clearfix"}]},onClickInvite:function(){var e=this,t=[],n=this.viewStep2.getElements(".table-selection tbody tr"),i=e.elements.container.getBody().getElements(".table-selection tbody tr");if(!1===this.inviteInProgress&&!1===this.uploadInProgress)if(this.inviteInProgress=!0,i.forEach(function(e){n.push(e)}),n.forEach(function(n){var i=n.getElement("[name=licenses\\[\\]]:checked"),o=n.getElement("[name=licensed\\[\\]]"),s=n.getElement("[name=restricted\\[\\]]");e._canCrossCompany()&&null!==o?t.push({id:i.value,licensed:o&&o.checked,restricted:!(!o||!1!==o.checked)||s&&s.checked}):t.push({id:i.value})}),e.modal.mask(),0===e.mode&&e.elements.tagger.getSelected().length>0&&(!0===e.platform.get("platform")||!1===e.platform.get("platform")&&t.length>0)){var o=e.viewStep1.getElement("[name=role]").value,s="0";"-1"!==o?s="0":(o="0",s="1"),g.platformInvite({platform:e.platform.get("id"),emails:e.elements.tagger.getSelected().join(","),role:o,agreement:s,language:e.viewStep1.getElement("[name=language]").value,text:e.viewStep1.getElement("[name=text]").value,licenses:JSON.stringify(t),company:_,casual:e.casualType.casual,location:this.locationsView.getValue()},{onComplete:function(t){e.inviteInProgress=!1,h.success(t.message),e.options.onAdded(),e.hide()},onFailure:function(t){e.inviteInProgress=!1,h.warn(t.message),e.hide()}})}else 1===e.mode&&(new x).save({platform:e.platform.get("id"),language:e.viewStep1.getElement("[name=language]").value,text:e.viewStep1.getElement("[name=text]").value,licenses:JSON.stringify(t),company:_,casual:e.casualType.casual,location:this.locationsView.getValue()},{patch:!0,onComplete:function(t){e.inviteInProgress=!1,e.uploadInProgress=!0,e.elements.form.inject(e.elements.container.elements.body),e.elements.iframe.inject(e.elements.container.elements.body),e.elements.form.addClassName("hidden"),e.elements.form.getElement("[name=__fcs__jobTicket]").setAttribute("value",t.get("fcsJobTicket")),e.elements.form.getElement("[name=file_0_name]").setAttribute("value",e.elements.form.getElement("[name=file_import]").value),e.elements.form.setAttribute("action",t.get("fcsUrl")),e.elements.form.setAttribute("target","uploadFrame"+e.id),e.elements.form.setAttribute("enctype","multipart/form-data"),e.elements.form.submit()},onFailure:function(){e.hide()}})},needSecondStep:function(){return!0===this.casualHasRole[this.casualType.casual]||this.options.hasApp||this.options.hasBE},manageButtonNextText:function(){this.nextButton.setValue(this.getButtonNextText())},getInviteText:function(){return this.platform.isPlatform()?e.i18n("Invite"):e.i18n("Grant")},getButtonNextText:function(){return this.needSecondStep()?e.i18n("Next"):this.getInviteText()},getButtons:function(){var t=this,n=[];return 3!==this.step&&2!==this.step&&1!==this.step||(n.push(new c({value:e.i18n("Back"),className:"default pull-left",events:{onClick:function(){t.step=3===t.step?t.step-2:t.step-1,t.nextButtonDisabled=!1,t.elements.container.setFooter(t.getButtons()),0===t.step?t.elements.container.setBody(t._getTemplate(t.viewStep1)):1===t.step?t.elements.container.setBody(t._getTemplate(t.viewStep2)):t.elements.container.setBody(t._getTemplate(t.viewStep3))}}})),this.stepsView.container.getElements(".step")[this.step-1].addClassName("mouse-cursor")),3===this.step?(this.nextButton=new c({value:this.getInviteText(),className:"primary",disabled:!1===t.platform.get("platform"),events:{onClick:this.onClickInvite.bind(this)}}),n.push(e.createElement("span",{class:"tooltip-wrapper",html:this.nextButton}))):(this.nextButton=new c({value:this.getButtonNextText(),className:"primary",disabled:t.nextButtonDisabled,events:{onClick:function(){this.createStepView()}.bind(this)}}),n.push(e.createElement("div",{class:"tooltip-wrapper",html:this.nextButton}))),n.push(new c({className:"default",value:e.i18n("Cancel"),events:{onClick:function(){t.elements.container.hide()}}})),t.elements.container.buttons=n,n},_getTemplate:function(e){return this.stepsView.setStep(this.step+1),[this.stepsView,e]},_removeCursor:function(e){e&&e.hasClassName("mouse-cursor")&&e.removeClassName("mouse-cursor")},checkStepOne:function(){var e=!0;return!1===F[0]||!1===F[1]?(this.setNextDisabled(e),e):((_||0===this.data.companies.length)&&(e=!1),this.setNextDisabled(e),e)},setNextDisabled:function(t){var n,i,s=1===this.step||2===this.step?1:0;this.nextButton.setDisabled(t),this.step>=3?(n=this.stepsView.container.getElements(".step")[this.step])||(n=this.stepsView.container.getElements(".step")[this.step-1]):(n=this.stepsView.container.getElements(".step")[this.step+1],i=this.stepsView.container.getElements(".step")[this.step+2]),t?(this._removeCursor(n),this._removeCursor(i)):n.addClassName("mouse-cursor"),t||this.dispatchEvent("onNextAvailable"),this.tooltip&&(this.tooltip.destroy(),this.tooltip=null),t&&(this.tooltip=new o({position:"top",target:this.elements.container.buttons[s],body:1===this.step?e.i18n("You need to select a least one role"):e.i18n("You need to add a least one email and a company")})),this.nextButtonDisabled=t,0!==this.getContent().getBody().getElements(".nav-item-icon-indicator").length&&(t&&"visibility: visible;"===this.getContent().getBody().getElements(".nav-item-icon-indicator")[0].getAttribute("style")&&this.stepsView.container.getElements(".step")[1].setStyle({"pointer-events":"none !important"}),t&&"visibility: visible;"===this.getContent().getBody().getElements(".nav-item-icon-indicator")[1].getAttribute("style")&&this.stepsView.container.getElements(".step")[2].setStyle({"pointer-events":"none !important"}))}})}),define("DS/PlatformManagement/Collection/GroupRoleCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/ProcessModel"],function(e,t,n){"use strict";return t.extend({url:"group/roles",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data||e.roles},isGroupRoles:function(){return!0}})}),define("DS/PlatformManagement/Modal/ImportReport",["UWA/Core","UWA/Controls/Abstract","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/UIKIT/Mask","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ListView","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Collection/PaginatedCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Modal/InviteMember","DS/PlatformManagement/Model/ImportModel","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Utils/FCSManager","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/UsageTracker","DS/PlatformManagement/Views/NoSearchResultView"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D){"use strict";var E=d.extend({url:"massivesynchro",model:b,_status:new d,options:{data:{query:null,limit:7,offset:null}},setup:function(){this._parent.apply(this,arguments),this.addEvent("reset",function(e,t){t.previousModels.forEach(function(e){e.trigger("remove")})})},parse:function(e){return this._status.set(e.statuslist),this.setMaxLimit(e.count),e.data}}),M=n.extend({tagName:"div",className:"skeleton-detail facet-scrollable",setup:function(){this.collection=this.model._users,this.collection.setOffset(0),this.collection.setQuery(null)},render:function(){var e=this,t=this.collection;return this.mask(),this.model.fileUploadError()?e.container.setContent(new f({fonticon:"upload",text:"An error occurred on the file upload process."}).render()):this.model.fetch({data:{synchro:this.model.get("id"),platform:null,offset:t.getOffset(),limit:t.getLimit(),query:t.getQuery()},onComplete:function(){e.subView?e.subView.setContent(e.buildSubView()):(e.container.setContent(e.getTemplate()),e.subView.addClassName("ImportReport-View")),e.unmask()}}),this},getTemplate:function(){return this.subView=e.createElement("div",{html:this.buildSubView()}),[this.buildSearch(),this.subView]},buildSubView:function(){return 0===this.collection.getMaxLimit()?this.buildEmptyView():[this.buildTable(),this.buildPager()]},buildEmptyView:function(){return(new D).render()},buildTable:function(){return{tag:"table",class:"table",html:[{tag:"thead",html:{tag:"tr",html:[{tag:"th",text:e.i18n("Email")},{tag:"th",class:"text-center",text:e.i18n("Status")},{tag:"th",text:e.i18n("Comment")},{tag:"th",text:e.i18n("Action")}]}},{tag:"tbody",html:this.buildRows()}]}},buildRows:function(){var e=this,t=[];return this.collection.forEach(function(n){t.push(e.buildRow(n))}),t},retryUser:function(e){var t=this;t.mask(),h.startImport({params:{synchro:this.model.get("id"),user:e.get("id")},callbacks:{onComplete:function(){t.render()},onFailure:function(){t.unmask()}}})},buildRow:function(e){var t=this;return{tag:"tr",html:[{tag:"td",text:e.get("id")},{tag:"td",class:"text-center",html:this.buildStatus(e.get("status"))},{tag:"td",html:e.get("comment")},{tag:"td",html:[0===e.get("status")?null:{tag:"i",class:"fonticon fonticon-arrows-ccw pointer",events:{click:function(){t.retryUser(e)}}}]}]}},buildStatus:function(e){return{tag:"span",class:"report-status-"+e,text:this.model._status.get(e).get("name")}},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return this.collection.getMaxLimit()>e.collection.getLimit()?new i({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:8,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.collection.setOffset(t),e.render()}}}):null},buildSearch:function(){var t=this;return[{html:new p({attributes:{placeholder:e.i18n("Search by email"),events:{keyup:function(){t.mask(),t.collection.setQuery(this.value.trim()),t.collection.setOffset(0),t.render()}}}})},{class:"clearfix"}]},getBody:function(){return this.content||(this.content=this.container),this.content},mask:function(){this.isMasked()||(a.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(a.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}}),k=n.extend({tagName:"div",render:function(){return this.container.setContent(new S({useInfiniteScroll:!1,usePullToRefresh:!1,view:new M({model:this.model})}).render()),this}});return t.extend({defaultOptions:{platform:null,onSaved:function(){}},uploadFrameId:null,callback:0,emptyView:null,init:function(t){this._parent(t),this.uploadFrameId="uploadFrame"+g.getUUID(),this.modal=new s({closable:!0,header:this.getTitle(),className:g.getPlatformManagementWrapperClassName("big-modal platform-import"),body:"",footer:"",events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal;var n=this;x.subscribe("com.ds.compass:massiveSynchroFinished",function(){var t=n.skeleton,i=t.getCurrentPanelIndex(),o=t.getViewAt(i).collection;o&&(n.skeletonCollection=o),n.skeletonCollection&&(n.skeletonCollection.reset(),n.skeletonCollection.fetch({data:{offset:0},onComplete:function(){n._manageEmptyView(o),m.success(e.i18n("Import is complete"))}})),t.refresh(),x.publish("PlatformManagement.refresh",g.getWidget().id)})},_manageEmptyView:function(t){t&&0!==t.size()?this.emptyView&&(this.emptyView.destroy(),this.emptyView=null):this.emptyView||(this.emptyView=new f({fonticon:"upload",text:e.i18n("No import available")}).render(),this.emptyView.inject(this.skeleton.getContent().getElement(".grid-container"),"bottom"))},show:function(){return this.modal.setBody(this.getSkeleton().render()),this.modal.getFooter().addClassName("hidden"),this.modal.inject(document.body,"top").show(),this},_hasTPA:function(){return this.options.platform.hasOwnProperty("hasTPA")?!0===this.options.platform.get("hasTPA"):this.options.platform.set("hasTPA",!0)},buildAddTile:function(){var t=this;return new C({lazyLoading:!1,model:new u({fonticon:"fonticon fonticon-upload",title:e.i18n("Invite members"),action:function(){t.modal=new v({hasApp:t._hasTPA(),mode:1,platform:t.options.platform,onAdded:function(){var e=t.skeleton,n=e.getCurrentPanelIndex(),i=e.getViewAt(n).collection;i&&(t.skeletonCollection=i),t.skeletonCollection&&(t.skeletonCollection.reset(),t.skeletonCollection.fetch({data:{offset:0},onComplete:function(){t._manageEmptyView(i)}})),e.refresh(),x.publish("PlatformManagement.refresh",g.getWidget().id)}}),P.openBatchInviteMember({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""})}}),name:"platform-management"}).render()},render:function(){return e.createElement("div",{class:"facet-import",html:this.getSkeleton().render()})},getTitle:function(){return"<h3>"+e.i18n("Import report")+"</h3>"},getActions:function(t){var n=this,i=[];return t.canRetry()&&i.push({text:e.i18n("Restart"),icon:"arrows-ccw",handler:function(){n.retryImport(t,this)}}),t.inProgress()||i.push({text:e.i18n("Delete"),icon:"trash",handler:function(){n.deleteImport(t,this)}}),t.fileUploadError()||i.push({text:e.i18n("Download import file"),icon:"download",handler:function(){n.getImportFile(this.model)}}),i},getSkeleton:function(){var t=this;return t.skeleton=new l({section:{collection:E,collectionOptions:{data:{platform:t.options.platform.getId()},actions:new c([])},fetchOptions:{onComplete:function(e){t._manageEmptyView(e)}},view:r,viewOptions:{emptyView:n.extend({tagName:"div",render:function(){return this}}),itemViewOptions:{mapping:{title:function(){return this.model.get("name")},subtitle:function(){var t=this.model.get("status");return 5===t?e.String.format(e.i18n("{0}, Count: {1}/{2}"),this.model.collection._status.get(t).get("name"),this.model.get("successcount"),this.model.get("count")):e.String.format(e.i18n("{0}, Count: {1}"),this.model.collection._status.get(t).get("name"),this.model.get("count"))},image:function(){return g.getAsset("request.png")},content:function(){var t;return t=new w(this.model.get("admin")),e.String.format(e.i18n("Owner:{0}"),t.getUserFullName())}},events:{onRender:function(){this.container.getElement(".tile-body .tile-subtitle").addClassName(t.getReportStatusClassName(this.model.get("status")))}}},autoFetch:!0,useInfiniteScroll:!0,usePullToRefresh:!0,events:{onRender:function(){t.buildAddTile().inject(this.container.getElement(".grid-container"),"top")},onPullToRefresh:function(){var e=this.scrollView;this.collection.reset(),this.collection.fetch({data:{offset:0},onComplete:function(n){e.endLoading(),t._manageEmptyView(n)},onFailure:function(){e.endLoading()}})},onInfiniteScroll:function(){var e=this.scrollView;this.collection.isInProgress()?e.endLoading():this.collection.hasNext()?(this.collection.setOffset(this.collection.getNextOffset()),this.collection.fetch({reset:!1,add:!0,remove:!1,onComplete:function(){e.endLoading()},onFailure:function(){e.endLoading()}})):this.collection.isFetched()&&e.useInfiniteScroll(!1)}}},idCardOptions:{attributesMapping:{title:function(){return this.get("name")}},actions:function(){return t.getActions(this)},facets:[{handler:l.getRendererHandler(k)}]}}},{root:"section",useRootChannelView:!1,height:"100%"}),t.skeleton},deleteImport:function(t){var n=this,i=t.collection;new o({className:"platform-management-confirm-modal",closable:!1}).confirm(e.i18n("Are you sure you want to remove this import?"),e.i18n("Confirmation"),function(o){o&&(n.mask(),t.destroy({wait:!0,data:{synchro:t.get("id"),platform:null},onComplete:function(){n.unmask(),n.skeletonNavigateToHome(),n._manageEmptyView(i)},onFailure:function(){n.unmask()}}),m.success(e.i18n("Your file has been deleted with success"))),g.manageSupportOfMultiModal()})},skeletonNavigateToHome:function(){this.skeleton.getContent().getElements(".skeleton-ctrl-back").forEach(function(t){e.Event.dispatchEvent(t,"click")})},retryImport:function(e,t){var n=this;n.mask(),h.startImport({params:{synchro:e.get("id")},callbacks:{onComplete:function(){t.render(),n.unmask()},onFailure:function(){n.unmask()}}})},buildStatus:function(e,t){return{tag:"span",class:this.getReportStatusClassName(e),text:t}},getReportStatusClassName:function(e){return"report-status-"+e},getImportFile:function(t){var n=this,i=e.createElement("iframe",{class:"hidden",id:this.uploadFrameId,name:this.uploadFrameId,src:g.getAsset("s.gif")});this.getBody().getElement("#"+this.uploadFrameId)||i.inject(this.getBody()),this.mask(),h.getImportFile({params:{synchro:t.get("id")},callbacks:{onFailure:function(){n.unmask()},onComplete:function(e){n.unmask(),y.downloadFile(t.get("filename"),e)}}})},getBody:function(){return this.skeleton.getContent()},mask:function(){this.loader||(a.mask(this.getBody().getElement(".skeleton-detail")),this.loader=!0)},unmask:function(){this.loader&&a.unmask(this.getBody().getElement(".skeleton-detail")),this.loader=null}})}),define("DS/PlatformManagement/Views/GrantGroupTable",["UWA/Core","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Collection/GroupCollection","DS/PlatformManagement/Collection/UserGroupCollection","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/GrantUserTable","DS/PlatformManagement/Views/UserGroupsRowView","DS/PlatformManagement/Collection/GroupRoleCollection","UWA/Event","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Tooltip","DS/PlatformManagement/UsageTracker"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C){"use strict";return m.extend({onCreateLicensesUser:function(e,t,n,i,o,l){var r=this,c=r.platform.canCrossCompany()?[{id:t.get("uid"),licensed:!(!1===this.options.withLicenses||r.fullCollectionWithOutLicenses&&r.fullCollectionWithOutLicenses.get(t.get("uid")))&&n.get("licensed"),restricted:n.get("restricted")}]:[{id:t.get("uid")}];o.forEach(function(e){if(r.platform.canCrossCompany()){var n={id:e.get("uid")};(r.fullCollectionWithOutLicenses&&r.fullCollectionWithOutLicenses.get(t.get("uid"))||!1===e.get("withLicenses"))&&(n.licensed=!1),c.push(n)}else c.push({id:e.get("uid")})}),o.size()>0&&o.forEach(function(e){var t=r.getBody().getElement(a.escapeDomSelector("#"+e.get("uid")));i.setLoadingStatus(e),t&&(r.getBody().getElement(a.escapeDomSelector("#"+e.get("uid"))).checked=!0)}),r.platform.canCrossCompany()&&r.mask(),e.addLicense(c,t.getType(),r.platform,{patch:!0,onComplete:function(e){var t=0;i.resetStatus(n),l.setDisabled(!1),i.invalidCache(),r.platform.canCrossCompany()&&(r.unmask(),r.collection.reset(),r.collection.fetch({onComplete:function(){r.fullCollectionWithOutLicenses&&2!==t?t=1:r.updateWrapper()}}),r.fullCollectionWithOutLicenses&&(r.fullCollectionWithOutLicenses.reset(),r.fullCollectionWithOutLicenses.fetch({onComplete:function(){1===t?r.updateWrapper():t=2}}))),r.model.set("nbUsed",r.model.get("nbUsed")+1),setTimeout(function(){s.success(e.message),r.refreshModel(),r.dispatchEvent("onGrantGroup")},1e3)},onFailure:function(t,o){l.setDisabled(!1),i.invalidCache(),r.platform.canCrossCompany()&&r.unmask(),2===t.code?(i.resetStatus(n),setTimeout(function(){s.alert(t.message),r.refreshModel(),r.dispatchEvent("onGrantGroup")},1e3)):(s.alert(t.message),r.resetStatus(e),l.setCheck(!1),r.refreshModel())}})},onToggleClick:function(e,t){var n=this,i=null,o=t,s=this.getRoleModel(t),a=new u([],{data:{platform:this.platform.getId(),group:o.getGroupId()}}).setLimit(null),c=function(i){n.onCreateLicensesUser(o,s,t,n,i,e)};n.setLoadingStatus(t),e.setDisabled(!0),e.isChecked()||n.mask(),a.fetch({onComplete:function(a){e.isChecked()?(i=new l({selectedCollection:a,model:s,disabledConformSwitchToggleModal:!0,onConfirm:function(e){c(e)},onCancel:function(){n.unmask(),e.uncheck(),e.setDisabled(!1),n.resetStatus(t)}})).isNeeded()?i.confirm():c(i.getMandatoryPrereq()):(i=new r({selectedCollection:a,model:s,onCancel:function(){n.unmask(),e.check(),e.setDisabled(!1),n.resetStatus(t)}})).isNeeded()?i.show():n.showDeleteConfirmation(o,s,t,n,e)}})},getRowIdentifier:function(e){return e.get("uuid")||e.get("id")},isCheckboxDisabled:function(e,t){return!1},getLabel:function(e){return e.get("label")},getRoleModel:function(){return this.model},isChecked:function(e){return e.get("granted")},updateRowUserGroup:function(t,n,i){var o=n.getElements("td")[1],s=n.getElement("label"),l=n.getElement("input");t?(l.setAttribute("disabled",!0),o.setContent(new p({visible:!0}))):i?(l.checked!==i.get("granted")&&(l.checked=i.get("granted")),i.isDeny()?a.getTextFromHtml(i.getUserFullName())+e.i18n(" (No Access)")!==s.textContent&&(s.textContent=a.getTextFromHtml(i.getUserFullName())+e.i18n(" (No Access)")):((i.isCasual()?a.getTextFromHtml(i.getUserFullName())+e.i18n(" (Casual usage)"):a.getTextFromHtml(i.getUserFullName()))!==s.textContent&&(s.textContent=i.isCasual()?a.getTextFromHtml(i.getUserFullName())+e.i18n(" (Casual usage)"):a.getTextFromHtml(i.getUserFullName())),i.get("grantedGroup")&&i.isCasual()&&!i.get("granted")&&l.removeAttribute("disabled")),this.getRoleModel().hasFree()||i.get("granted")?o.setContent(""):(o.hasClassName("text-error")||(o.className="text-error status"),o.setContent(e.i18n("You have not enough role")))):(s&&s.indexOf&&s.indexOf(e.i18n(" (No Access)"))?l.setAttribute("disabled",!0):l.checked?s&&s.indexOf&&s.indexOf(e.i18n(" (Casual usage)"))&&l.removeAttribute("disabled"):l.removeAttribute("disabled"),o.hasClassName("text-error")?o.setContent(e.i18n("You have not enough role")):o.setContent(""))},getUserGroupRows:function(e){return this.getContent().getElement('tr[class*="'+this.getRowIdentifier(e)+'"][data-id]')?this.getContent().getElements('tr[class*="'+this.getRowIdentifier(e)+'"][data-id]'):[]},getInformation:function(t){var n=this,i="",o="";return this.tooltips[t.getGroupId()]&&this.tooltips[t.getGroupId()].length>0&&this.tooltips[t.getGroupId()].forEach(function(e){e.destroy()}),this.tooltips[t.getGroupId()]=[],t.get("countUsers")>0&&(i=e.createElement("span",{class:t.isMembersRowViewExtended()?"pointer fonticon fonticon-up-dir user-group-icons":"pointer fonticon fonticon-down-dir user-group-icon",events:{click:function(e){n.setLoadingStatus(t),0!==t.get("countUsers")&&(e.target.hasClassName("pointer fonticon fonticon-up-dir")?(t.setRowViewExtended(!1),e.target.removeClassName("pointer fonticon fonticon-up-dir"),e.target.addClassName("pointer fonticon fonticon-down-dir"),n.destroyUserGroupRows(t)):(t.setRowViewExtended(!0),e.target.removeClassName("pointer fonticon fonticon-down-dir"),e.target.addClassName("pointer fonticon fonticon-up-dir"),n.fetchUserGroupRows(t)),h.stop(e))}}}),this.tooltips[t.getGroupId()].push(new f({position:"bottom",target:i,body:t.isMembersRowViewExtended()?e.i18n("Collapse"):e.i18n("Expand")}))),t.isMembersRowViewExtended()&&(o=e.createElement("span",{class:"pointer fonticon fonticon-cw user-group-icons",events:{click:function(e){var i=n.getUserGroupRows(t);n.setLoadingStatus(t),i.length>0&&i.forEach(function(e,t){n.updateRowUserGroup(!0,e)}),n.fetchUserGroupRows(t),h.stop(e)}}}),this.tooltips[t.getGroupId()].push(new f({position:"bottom",target:o,body:e.i18n("Refresh")}))),{styles:t.isMembersRowViewExtended()?{"text-align":"initial","margin-right":"13px"}:{},html:[o,i]}},fetchUserGroupRows:function(t){var n=this,i=this.content.getElement('label[for="'+this.getRowIdentifier(t)+'"]');this.content.getElement('tr[class="tr-'+this.getRowIdentifier(t)+'"]');return new o([],{data:{platform:this.platform.getId(),group:t.get("uuid"),role:this.getRoleModel().get("id")}}).setSortDirection(c.get("membersSortDirection")).setSortField(c.get("membersSortField")).fetch({onComplete:function(o){if(t.setMembersCollection(o),o.count){var a,l,r=o.filter(function(e){return e.get("granted")});t.set("grantedUsers",r.length),t.set("countUsers",o.length),n.updateToggleLabel(t,i),o.forEach(function(e,i){n.getContent().getElement('tr[class*="'+n.getRowIdentifier(t)+'"][data-id="'+e.get("id")+'"]')?(e.set("grantedGroup",t.get("granted")),n.updateRowUserGroup(!1,n.getContent().getElement('tr[class*="'+n.getRowIdentifier(t)+'"][data-id="'+e.get("id")+'"]'),e)):(a=new d({role:n.getRoleModel(),model:e,parentClassName:n.getRowIdentifier(t),groupModel:t,platform:n.platform}).render(),n.getContent().getElement('tr[class*="'+n.getRowIdentifier(t)+'"]')&&(l?a.inject(n.getContent().getElement('tr[class*="'+n.getRowIdentifier(t)+'"][data-id="'+l+'"]'),"after"):a.inject(n.getContent().getElement('tr[class*="'+n.getRowIdentifier(t)+'"]'),"after"),l=e.get("id")))}),n.resetStatus(t)}else t.setRowViewExtended(!1),t.set("grantedUsers",0),t.set("countUsers",o.length),n.updateToggleLabel(t,i),n.resetStatus(t),s.warn(e.i18n("No users found")),n.getUserGroupRows(t).length>0&&n.destroyUserGroupRows(t)},onFailure:function(i,o){var a=n.getUserGroupRows(t);o.message?s.warn(o.message):o&&o.indexOf&&-1!==o.indexOf("504")?s.warn(e.i18n("Action is still pending... Please wait a few seconds and refresh your widget")):s.warn(o),a.length>0?(a.forEach(function(e){n.updateRowUserGroup(!1,e)}),t.setRowViewExtended(!0)):t.setRowViewExtended(!1),n.resetStatus(t)}}),!0},destroyUserGroupRows:function(e){return this.getUserGroupRows(e).forEach(function(e,t){e.destroy()}),this.resetStatus(e),!0},getConfirmDeleteTitle:function(t){return e.i18n("Are you sure you want to remove {0}?").format(t.get("label"))},_createCrossCompany:function(e,t){return""},updateToggleLabel:function(e,t){t.textContent=this.formatGroupLabel(e)},formatGroupLabel:function(t){var n=t.get("countUsers")>0?t.get("grantedUsers")<1?e.String.format(e.i18n(" ({0} members)"),t.get("countUsers")):e.String.format(e.i18n(" ({0} granted / {1} members)"),t.get("grantedUsers"),t.get("countUsers")):"";return a.getTextFromHtml((this.getLabel(t)||t.getGroupId())+n)},getRow:function(t){var i=this,o=[],s=new n({className:"primary height",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(t),id:this.getRowIdentifier(t),label:this.formatGroupLabel(t),checked:this.isChecked(t),disabled:this.isCheckboxDisabled(t,this.model)}),a=e.createElement("div",{class:"tooltip-wrapper",html:s}),l=e.createElement("tr",{class:"tr-"+this.getRowIdentifier(t)+" height",html:[{tag:"td",styles:{color:"#3D3D3D"},html:a},{tag:"td",class:"text-right status",html:this.getInformation(t)}],events:{click:function(e){if(!s.isDisabled()&&!e.target.getParent(".toggle-switch")){var n=!s.isChecked();s.isChecked()?C.grantWithGroup({tenant:i.platform.getId(),roleid:t.get("id"),roleName:t.get("name")}):C.unGrantWithGroup({tenant:i.platform.getId(),roleid:t.get("id"),roleName:t.get("name")}),s.setCheck(n),i.onToggleClick(s,t),h.stop(e)}},onRemoveAllGrantedRole:function(){i.dispatchEvent("onRemoveAllGrantedRole")}}});return this.isCheckboxDisabled(t,this.model)&&t.get("helpMessage")&&""!==t.get("helpMessage")&&this.tooltips.push(new f({position:"bottom",target:a,body:t.get("helpMessage")})),o.push(l),t.getMembersCollection&&t.getMembersCollection()&&t.getMembersCollection().forEach(function(e,n){o.push(new d({role:i.getRoleModel(),model:e,parentClassName:i.getRowIdentifier(t),groupModel:t,platform:i.platform}).render())}),s&&s.getContent().getElement("label").setStyles({"margin-bottom":"0px"}),o},updateDisplayGrantedMember:function(e){return""}})}),define("DS/PlatformManagement/Modal/RoleDetails",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/W3DXComponents/IdCard","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Modal/FullScreenIdCardModal","DS/UIKIT/SuperModal","DS/UIKIT/Mask","DS/i3DXCompass/Controls/IframeLoader","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Collection/BusinessExperienceCollection","DS/PlatformManagement/Collection/UsersBusinessExperienceCollection","DS/PlatformManagement/Collection/AllUsersBusinessExperienceCollection","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Views/GrantUserTable","DS/PlatformManagement/Views/GrantGroupTable","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/GroupCollection","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/PlatformManagement/UsageTracker","DS/UIKIT/Carousel","DS/WebappsUtils/WebappsUtils"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M){"use strict";var k=!1,I=t.extend({tagName:"div",_className:"facet-about",_allowfullscreen:function(){var e=window.top.document.getElementById("frame-"+m.getWidget().id);e&&e.setAttribute("allowfullscreen",!0)},render:function(){var t,n=this;return this.mask(),this._allowfullscreen(),P.getPortolioRole(this.model.get("id"),function(i){i&&i.description?(n.model.set("description",i.description),n.model.set("descriptionMedias",i.descriptionMedias),n.model.set("tagLine",i.tagLine),t=n._buildDescription()):t=new c({src:n.model.get("description"),text:n.model.isOption()?e.i18n("No additional information for this option"):e.i18n("No additional information for this role")}),n.container.setContent(t).addClassName(n._className),n.unmask()}),this},_buildTagLine:function(){var e=this.model&&this.model.get("tagLine");return this.hideDescription||!e?null:{class:"portfolio-tagline",html:e}},stopVideo:function(){this.container.getElements(".portfolio-description video").forEach(function(e){e.pause()})},_buildDescription:function(){var t=this,n=this.model&&this.model.get("description");if(n){var i=[{tag:"div",html:[this._buildTagLine(),n]}];this.model.get("descriptionMedias").sort(function(e,t){return e.indexOf(".mp4")>-1?-1:1}),this.model.get("descriptionMedias").sort(function(e,t){return e.indexOf(".mp4")>-1?-1:e<t?0:1}),this.model.get("descriptionMedias").length>1?i.push({tag:"div",html:new E({autoPlay:!1,infinite:!1,animation:"fade",arrows:!1,slides:e.createElement("div",{html:this.model.get("descriptionMedias").map(function(e,n){return t._buildMedia(e,n)})}),slideSelector:"> video, > img",events:{onSlide:this.stopVideo.bind(this)}})}):i.push(this.model.get("descriptionMedias").map(t._buildMedia)),n={class:"portfolio-description",html:i}}return this.hideDescription?null:n},_buildMedia:function(e,t){var n;return e.indexOf(".mp4")>-1?n={tag:"video",autoplay:!0,playsinline:!0,muted:!0,controls:!0,disablepictureinpicture:!0,controlslist:"nodownload",html:[{tag:"source",src:e,type:"video/mp4"},{tag:"source",src:e.replace(".mp4",".webm"),type:"video/webm"}],events:{contextmenu:function(e){e.preventDefault()}}}:(n={tag:"img"}).src=e,n},mask:function(){this.loader||(r.mask(this.getContent()),this.loader=!0)},unmask:function(){this.loader&&r.unmask(this.getContent()),this.loader=null}}),T=t.extend({tagName:"div",_className:"facet-apps",render:function(){var e=this;return this.model.isFetched()?this.container.setContent(this.getTemplate()).addClassName(this._className):(this.mask(),this.model.fetch({data:{platform:this.model.get("platform")||this.options.platform,role:this.model.get("id")},onComplete:function(){P.getServiceUrl({platformId:e.platform.get("id"),serviceName:"usersgroup",onComplete:function(t){t&&(k=!0),e.container.setContent(e.getTemplate()).addClassName(e._className),e.unmask()},onFailure:function(){e.container.setContent(e.getTemplate()).addClassName(e._className),e.unmask()}})},onFailure:function(){e.unmask()}})),D.openRoleDetail({tenant:e.platform&&e.platform.get?e.platform.get("id"):"",roleId:this.model.get("id"),roleName:this.model.get("name")}),this},getTemplate:function(){var t=this,n=[];return this.model.get("applications")&&(this.model.get("applications").sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),this.model.get("applications").forEach(function(e){n.push(t.getAppView(e))})),[{tag:"h5",text:e.String.format(e.i18n("{0} Apps are available with this role"),this.model.get("apps"))},n]},getAppView:function(e){return{class:"apps-item","data-id":e.id,html:[{tag:"img",src:e.icon},{text:e.title,title:e.title}]}},mask:function(){this.loader||(r.mask(this.getContent()),this.loader=!0)},unmask:function(){this.loader&&r.unmask(this.getContent()),this.loader=null}});return n.extend({content:null,cache:null,idCard:null,init:function(e){var t=this;this.isTpa=e.isTpa,this.cache={},this.model=e.model,this.platform=e.platform,this.withLicenses=e.withLicenses,t._parent(e),this.allUsersModelBE=new f,this.modal=new a({closable:!0,header:this.idCard,body:"",footer:"",events:{onHide:function(){t.idCard&&t.idCard.destroy(),this.destroy()}}}),this.elements.container=this.modal},getDescription:function(){var t="";return this.model.isCustom()?t="":this.model.isTPA()?t+="<div>"+e.String.format(e.i18n("Type: {0}"),this.model.getDisplayType())+"</div>":this.model.isSelfExp()?(t+='<div class="bright-orange">'+e.i18n("Trial")+"</div>",t+="<div>"+e.String.format(e.i18n("Used: {0}"),this.model.get("used"))+"</div>"):(this.model.isCasual()&&this.model.isOption()?t+='<div class="bright-orange">'+e.i18n("Option, Casual usage")+"</div>":this.model.isCasual()?t+='<div class="bright-orange">'+e.i18n("Casual usage")+"</div>":this.model.isOption()&&(t+='<div class="bright-orange">'+e.i18n("Option")+"</div>"),this.model.get("total")?t+="<div>"+e.String.format(e.i18n("Used: {0}/{1}"),this.model.get("total")-this.model.get("free"),this.model.get("total"))+"</div>":t+="<div>"+e.String.format(e.i18n("Used: {0}"),this.model.get("nbUsed"))+"</div>"),this.model.get("expireLong")&&(t+="<div>"+e.String.format(e.i18n("Expiration date: {0}"),this.model.get("expireLong"))+"</div>"),t},isBusinessExperience:function(){return!0===this.options.isBE},buildHeader:function(){var t=this;return new o({model:this.model,thumbnailUrl:function(){return t.isBusinessExperience()?null:this.getIcon()},attributesMapping:{title:function(){var e;return e=this.isTPA()||this.isCustom()?this.get("name"):t.isBusinessExperience()?this.get("title"):(e=this.get("name")||this.get("title"))?e+" - "+this.get("trigram"):this.get("trigram")},ownerName:function(){var e="";return t.isBusinessExperience()?e+='<div class="subtitle-details-business">'+t.model.get("subtitle")+"</div>":e="",e},description:function(){return t.isBusinessExperience()?"":t.getDescription()}},actions:[],facets:function(){var n=[{text:e.i18n("Members"),icon:"users",handler:function(){t.modal.mask(),S.fetch({onComplete:function(){t.modal.setBody(t.getFacet(0)),t.modal.unmask()}})}}];return k&&"IFW"!==this.get("id")&&!t.model.isCasual()&&(t.isTpa||t.model.isTPA()||this.get("withLicenses"))&&n.push({text:e.i18n("Groups"),icon:"users-group",handler:function(){t.modal.setBody(t.getFacet(3))}}),t.model.isTPA()||t.isBusinessExperience()||(n.push({text:e.i18n("Additional Apps"),icon:"app",handler:function(){t.modal.setBody(t.getFacet(1))}}),n.push({text:e.i18n("About"),icon:"doc-text",handler:function(){t.modal.setBody(t.getFacet(2))}}),t.model.get("id")),n}})},getFacet:function(n){var i=this,o=this.cache[n];if(!e.is(o)){switch(n){case 0:if(this.model.get("detailTpaActive")?this.model.set("detailRolesActive",!1):this.model.set("detailRolesActive",!0),this.model.set("appsActive",!1),!this.isBusinessExperience()){this.cache[n]=new w({withLicenses:this.withLicenses,fullCollection:this.model.isSelfExp()?null:new d([],{data:{withLicenses:this.model.get("withLicenses"),role:this.model.get("id"),platform:this.platform.get("id"),casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(S.get("membersSortDirection")).setSortField(S.get("membersSortField")),grantedCollection:new d([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),granted:!0,casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(S.get("membersSortDirection")).setSortField(S.get("membersSortField")),platform:this.platform,model:this.model,searchPlaceholder:e.i18n("Search user"),filterViewAllText:e.i18n("View all"),filterGrantedOnlyText:e.i18n("View users granted"),emptyView:{icon:"users",text:e.i18n("No user found")}}).render();break}if(this.isBusinessExperience()){this.cache[n]=new w({urlGranted:this.options.urlGranted,isBE:!0,detailsBE:!0,fullCollection:this.model.isSelfExp()?null:new g([],{csrf:this.options.csrf,data:{beId:this.model.get("id"),platform:this.platform.get("id"),limit:10}}).setSortDirection(S.get("membersSortDirection")).setSortField(S.get("membersSortField")),grantedCollection:new h([],{csrf:this.options.csrf,data:{beId:this.model.get("id"),tenant:this.platform.get("id"),limit:10}}).setSortDirection(S.get("membersSortDirection")).setSortField(S.get("membersSortField")),platform:this.platform,model:this.model,searchPlaceholder:e.i18n("Search user"),filterViewAllText:e.i18n("View all"),filterGrantedOnlyText:e.i18n("View users granted"),emptyView:{icon:"users",text:e.i18n("No user found")}}).render();break}case 3:this.cache[n]=new y({withLicenses:this.withLicenses,fullCollection:this.model.isSelfExp()?null:new x([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(S.get("membersSortDirection")).setSortField(S.get("membersSortField")),grantedCollection:new x([],{data:{role:this.model.get("id"),platform:this.platform.get("id"),granted:!0,casual:this.model.isTPA()?null:this.model.get("casual"),limit:10}}).setSortDirection(S.get("membersSortDirection")).setSortField(S.get("membersSortField")),platform:this.platform,model:this.model,searchPlaceholder:e.i18n("Search group"),filterViewAllText:e.i18n("View all"),filterGrantedOnlyText:e.i18n("View groups granted"),emptyView:{icon:"users-group",text:e.i18n("No group found")},events:{onUnGrantRole:function(){var e=i.cache[0];e&&e.invalidCacheAndReload()},onGrantGroup:function(){var e=i.cache[0];e&&e.invalidCacheAndReload()}}}).render();break;case 1:this.cache[n]=new T({model:this.model,platform:this.platform}).render();break;case 2:this.cache[n]=new I({model:this.model}).render();break;case 3:this.cache[n]=(new t).render(),new(void 0)({container:this.cache[n].container,platform:this.platform.getId(),product:this.model.get("id")}).show()}o=this.cache[n]}return o},show:function(e){var t=this;return this.isBusinessExperience()?t._renderTemplate():(this.model.fetch({data:{platform:this.platform.getId(),id:this.model.get("id"),rolePlatform:e||this.model.get("platform")||this.model.get("uid").split(":"+this.model.get("id"))[0]}}),P.getServiceUrl({platformId:t.platform.get("id"),serviceName:"usersgroup",onComplete:function(e){e&&(k=!0),t._renderTemplate()},onFailure:function(){t._renderTemplate()}})),this},_renderTemplate:function(){var e=this;e.idCard=e.buildHeader(),e.modal.setHeader(e.idCard),e.modal.getHeader().getElement(".thumbnail-section")&&e.modal.getHeader().getElement(".thumbnail-section").setAttribute("data-percent",e.model.getPercent()),e.idCard.selectFacet(0),e.modal.getFooter().addClassName("hidden"),e.modal.inject(document.body,"top").show()}})}),define("DS/PlatformManagement/Views/GrantTable2",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/SuperModal","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Spinner","DS/UIKIT/Input/Button","DS/UIKIT/Input/ButtonGroup","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Views/EmptyView","UWA/Event","DS/PlatformManagement/Views/NoSearchResultView"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v){"use strict";return t.extend({tagName:"div",collection:null,content:null,masked:!1,emptyView:null,setup:function(t){var n=this,i=2,o=function(){n.content||n.render(),n.updateWrapper()},s=function(){i--,2!==n._activeFilter&&(n.grantedCollection.size()>0||!e.is(n.fullCollection)&&n.grantedCollection.isFetched())?(n.collection=n.grantedCollection,i=0,n.options.noFilter||(o(),n.elements.filterGrantedOnly.setActive(),n.elements.filterViewAll.setActive(!1))):e.is(n.fullCollection)&&(n.collection=n.fullCollection),0!==i&&2!==n._activeFilter||o()};return t.grantedCollection&&(this.grantedCollection=t.grantedCollection),t.fullCollection?this.fullCollection=t.fullCollection:n.options.noFilter=!0,t.platform&&(this.platform=t.platform),this.toGrantCollection=new p,this.toRemoveCollection=new p,this.toUpdateCollection=new p,this.forceGrantedCollectionRefresh=!1,this.forceFullCollectionRefresh=!1,n.collection=n.grantedCollection,this.fullCollection?this.fullCollection.fetch({onComplete:function(){s()},onFailure:function(){}}):s(),this.grantedCollection.fetch({onComplete:function(){s()},onFailure:function(){}}),t},render:function(){return this.container.setContent([this.buildSearch(),{styles:{"margin-bottom":15},text:e.i18n("New members will be granted the following roles:")},{class:"wrapper"}]),this.mask(),this},updateWrapper:function(){var e;this.collection.isFetched()?e=this.collection.size()>0?this.getTable():this.buildEmptyView():this.mask(),this.elements&&this.elements.filterViewAll&&this.elements.filterGrantedOnly&&(this.collection&&this.collection===this.grantedCollection?(this.elements.filterGrantedOnly.setClassName("default active"),this.elements.filterViewAll.setClassName("default")):(this.elements.filterViewAll.setClassName("default active"),this.elements.filterGrantedOnly.setClassName("default"))),e&&(this.unmask(),this.getBody().setContent(e))},getTable:function(){var e=this;return[{tag:"table",class:"table table-hover table-select-process",html:[{tag:"tbody",html:this.collection.map(function(t){return e.getRow(t)})}]},this.buildPager()]},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?new n({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:7,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.collection.fetch({onComplete:function(){e.updateWrapper()}})}}}):null},getRowIdentifier:function(e){return e.get("uid")},getRow:function(t){var n=this,i=this.toRemoveCollection.findWhere({uid:t.get("uid")})||this.toGrantCollection.findWhere({uid:t.get("uid")})||this.toUpdateCollection.findWhere({uid:t.get("uid")})||this.grantedCollection.findWhere({uid:t.get("uid")}),s=new o({className:"primary",type:"checkbox",name:"licenses[]",value:this.getRowIdentifier(t),id:this.getRowIdentifier(t),label:d.getTextFromHtml(this.getLabel(t)),checked:i?i.get("granted"):!!i,disabled:!1===t.get("remove")}),a=e.createElement("div",{class:"tooltip-wrapper",html:s});return e.createElement("tr",{class:"tr-"+this.getRowIdentifier(t),"data-id":this.getRowIdentifier(t),html:[{tag:"td",styles:{color:"#3D3D3D"},html:a},{tag:"td",class:!this.platform.canCrossCompany()||t.isTPA()||t.isCustom()?"text-right":"",html:!this.platform.canCrossCompany()||t.isTPA()||t.isCustom()?this.getInformation(t):this._createCrossCompany(t,i)}],events:{click:function(e){if(!s.isDisabled()&&!e.target.getParent(".toggle-switch")){var i=!s.isChecked();s.setCheck(i),t.set("granted",i),n.onToggleClick(s,t),C.stop(e)}}}})},_createCrossCompany:function(t,n){var i,s=this,a=!(!1===t.get("licensed")),l=t.get("restricted");t.canCrossCompany()&&n&&(a=n.get("licensed"),l=n.get("restricted"));var r,c=new o({className:"primary"+(a?"":" hidden"),type:"switch",name:"restricted[]",checked:l,disabled:!t.canCrossCompany()||t.isWU(),value:t.get("uid"),label:e.i18n("Restrict Usage to this Platform"),events:{onClick:function(e){t.set("restricted",this.isChecked());var n=e.target.getParent("tr").getElement('[id="'+t.get("uid")+'"]').checked;!n&&s.grantedCollection.get(t)?(s.toRemoveCollection.add(t),s.toRemoveCollection.get(t).unset("crossCompanyDeseable"),s._manageCrossCompanySelection(t)):n&&s.grantedCollection.get(t)?(s.toUpdateCollection.add(t),s.toGrantCollection.remove(t),s.toRemoveCollection.remove(t),s._manageCrossCompanySelection(t)):n&&(s.toGrantCollection.add(t),s._manageCrossCompanySelection(t))}}});return r=n&&(!1===n.get("crossCompanyDeseable")||!0===n.get("crossCompanyDeseable"))||!1===t.get("crossCompanyDeseable")||!0===t.get("crossCompanyDeseable")?n?n.get("crossCompanyDeseable"):t.get("crossCompanyDeseable"):!t.canCrossCompany(),(i=new o({className:"primary",type:"switch",name:"licensed[]",checked:a,disabled:r,value:t.get("uid"),attributes:{"data-trigram":t.get("trigram")},label:"",events:{onClick:function(e){var n=e.target.getParent("tr").getElement('[id="'+t.get("uid")+'"]').checked;t.set("licensed",this.isChecked()),t.set("granted",n),this.isChecked()?c.getContent().removeClassName("hidden"):c.getContent().addClassName("hidden"),!n&&s.grantedCollection.get(t)?(s.toRemoveCollection.add(t),s.toRemoveCollection.get(t).unset("crossCompanyDeseable"),s._manageCrossCompanySelection(t)):n&&s.grantedCollection.get(t)?(s.toUpdateCollection.add(t),s.toGrantCollection.remove(t),s.toRemoveCollection.remove(t),s._manageCrossCompanySelection(t)):n&&(s.toGrantCollection.add(t),s._manageCrossCompanySelection(t))}}})).getContent().getElement("label").setContent([{tag:"span",text:e.i18n("Assign License")},{tag:"span",html:this.getInformation(t)}]),[i,c]},_manageCrossCompanySelection:function(t){var n,i=this,o=this.container.getElements(".table-select-process tbody tr"),s=this.getCurrentCollection().find(function(e){return e.isWA()&&!e.canCrossCompany()});this._isCrossCompanyRoleDisabled()?e.is(s)&&o.forEach(function(e){var t=e.getElement("[name=licensed\\[\\]]"),n=e.getElement("[name=restricted\\[\\]]"),o=i.getCurrentCollection().find(function(e){return t&&e.get("trigram")===t.getAttribute("data-trigram")});o&&o.isWA()&&!o.canCrossCompany()&&t&&n&&(t.checked=o.get("licensed"),t.disabled=!0,n.checked=o.get("restricted"),n.getParent().toggleClassName("hidden",!1))}):(n=t&&t.get("granted")&&i.platform.getCrossCompanyRoles().indexOf(t.get("trigram"))>-1?t:this.grantedCollection.find(function(e){return i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1}),o.forEach(function(e){var t=e.getElement("[name=licensed\\[\\]]"),o=e.getElement("[name=restricted\\[\\]]");n&&t&&o&&(i.getCurrentCollection().find(function(e){return e.get("trigram")===t.getAttribute("data-trigram")})&&(i.platform.getCrossCompanyRoles().indexOf(t.getAttribute("data-trigram"))>-1?(t.checked=n.get("licensed"),t.disabled=!1,o.checked=n.get("restricted"),o.getParent().toggleClassName("hidden",!n.get("licensed"))):o.getParent().toggleClassName("hidden",!t.checked)))})),i._updateCrossCompanyGrantedRoles(t,n,s)},_updateCrossCompanyGrantedRoles:function(e,t,n){var i=this;i.grantedCollection&&i.grantedCollection.length>0&&(t||(t=i.grantedCollection.find(function(e){return i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1&&!i.toRemoveCollection.get(e)})),n||(n=this.grantedCollection.find(function(e){return e.isWA()&&!e.canCrossCompany()&&-1===i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))&&!i.toRemoveCollection.get(e)}))),i.toGrantCollection&&i.toGrantCollection.length>0&&(t||(t=i.toGrantCollection.find(function(e){return i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1})),n||(n=this.toGrantCollection.find(function(e){return e.isWA()&&!e.canCrossCompany()&&-1===i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))}))),i.toUpdateCollection&&i.toUpdateCollection.length>0&&(t||(t=i.toUpdateCollection.find(function(e){return i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))>-1})),n||(n=this.toUpdateCollection.find(function(e){return e.isWA()&&!e.canCrossCompany()&&-1===i.platform.getCrossCompanyRoles().indexOf(e.get("trigram"))}))),i.grantedCollection.forEach(function(e){t&&i.platform.getCrossCompanyRoles().indexOf(e.get("id"))>-1&&(e.get("licensed")!==t.get("licensed")||i.toUpdateCollection.get(e.get("id"))&&!1!==i.toUpdateCollection.get(e).get("crossCompanyDeseable"))&&(e.set("licensed",t.get("licensed")),e.set("crossCompanyDeseable",!1),i.toUpdateCollection.get(e)||i.toUpdateCollection.add(e))}),i.toGrantCollection.forEach(function(e){t&&i.platform.getCrossCompanyRoles().indexOf(e.get("id"))>-1&&(e.set("licensed",t.get("licensed")),e.set("restricted",t.get("restricted")),e.set("crossCompanyDeseable",!1))}),i.toUpdateCollection.forEach(function(e){t&&i.platform.getCrossCompanyRoles().indexOf(e.get("id"))>-1&&(e.set("licensed",t.get("licensed")),e.set("crossCompanyDeseable",!1))})},_isCrossCompanyRoleDisabled:function(){var e,t=this;return t.options.tagger&&(e=t.options.tagger.getSelected().length),!!this.getCurrentCollection().find(function(n){return t.platform.getCrossCompanyRoles().indexOf(n.get("trigram"))>-1&&n.isAssignDisabled(void 0,e)})},getLabel:function(t){var n=null;return t.isOption()&&t.isSelfExp()?n=e.i18n("(Trial, Option)"):t.isSelfExp()?n=e.i18n("(Trial)"):t.isOption()&&(n=e.i18n("(Option)")),n?t.get("name")+" "+n:t.get("name")},getInformation:function(t){var n,i,o="",s=100*(t.get("total")-t.get("free"))/t.get("total");return t.get("casual")>0?o="":t.isSelfExp()?o=e.i18n("Expires on {0}").format(t.get("expireLong")||t.get("expire")):t.get("start")?o=e.i18n("Granted on {0}").format(t.get("startLong")||t.get("start")):t.getDisplayType()?o=e.i18n("Type: {0}").format(t.getDisplayType()):t.isCustom()||(n=t.get("total")?e.createElement("span",{class:s<25?"fonticon fonticon-progress-3":s<50||s<75?"fonticon fonticon-progress-2":s>75?"fonticon fonticon-progress-1":""}):""),i=e.createElement("span",{class:"",styles:{"font-size":"20px"},html:[this.platform.canCrossCompany()&&!t.isTPA()&&""!==o?" - "+o:n]}),n&&(new c({position:"bottom",target:n,body:e.String.format(e.i18n("Used: {0}/{1}"),t.get("total")-t.get("free"),t.get("total"))}),d.addUsedColor(n,s)),i},setStatus:function(e,t){var n=this.getContent().getElement(".tr-"+d.escapeDomSelector(this.getRowIdentifier(e))+" .status");return n&&n.setContent(t),!0},resetStatus:function(e){this.setStatus(e,"")},setLoadingStatus:function(e){this.setStatus(e,new a({visible:!0}))},setUpdatedStatus:function(t){var n='<span class="text-success">'+e.i18n("Updated")+"</span>";this.setStatus(t,n)},setGrantedStatus:function(t){var n='<span class="text-success">'+e.i18n("Granted")+"</span>";this.setStatus(t,n)},setRemovedStatus:function(t){var n='<span class="text-error">'+e.i18n("Removed")+"</span>";this.setStatus(t,n)},buildSearch:function(){var e=this,t=new m({attributes:{placeholder:e.options.searchPlaceholder,value:this.collection.getQuery()||"",events:{keyup:function(){e.mask(),e.collection.setQuery(this.value.trim()),e.collection.setOffset(0),e.collection.reset(),e.collection.fetch({onComplete:function(){e.updateWrapper()}})}}}});return{tag:"div",styles:{"text-align":"center","margin-top":5,"margin-bottom":15},html:[this.options.noFilter?null:this.buildFilter(),{class:"input-search-center-wrapper",html:t},{class:"clearfix"}]}},buildEmptyView:function(){return this.collection.isQueryEmpty()?this.emptyView=new f({fonticon:this.options.emptyView.icon,text:this.options.emptyView.text}):this.emptyView=new v,this.emptyView.render(),this.emptyView},isFullCollectionFresh:function(){return this.collection.getQuery()===this.fullCollection.getQuery()&&!1===this.forceFullCollectionRefresh},isGrantedCollectionFresh:function(){return this.collection.getQuery()===this.grantedCollection.getQuery()&&!1===this.forceGrantedCollectionRefresh},invalidCache:function(){this.forceGrantedCollectionRefresh=!0,this.forceFullCollectionRefresh=!0},filterGrantedOnly:function(){var e=this;this._activeFilter=1,e.elements.filterGrantedOnly.setClassName("default active"),e.elements.filterViewAll.setClassName("default"),this.isGrantedCollectionFresh()?(e.collection=e.grantedCollection,this.updateWrapper()):(this.mask(),this.grantedCollection.setQuery(e.collection.getQuery()),this.grantedCollection.reset(),this.grantedCollection.fetch({onComplete:function(){e.updateWrapper()}}),e.collection=e.grantedCollection,this.forceGrantedCollectionRefresh=!1)},filterViewAll:function(){var e=this;this._activeFilter=2,e.elements.filterGrantedOnly.setClassName("default"),e.elements.filterViewAll.setClassName("default active"),this.isFullCollectionFresh()?(e.collection=e.fullCollection,this.updateWrapper()):(this.mask(),this.fullCollection.setQuery(e.collection.getQuery()),this.fullCollection.reset(),this.fullCollection.fetch({onComplete:function(){e.updateWrapper()}}),e.collection=e.fullCollection,this.forceFullCollectionRefresh=!1)},buildFilter:function(){var t=this.elements;return t.filterGrantedOnly=new l({value:this.options.filterGrantedOnlyText?this.options.filterGrantedOnlyText:e.i18n("View selected only"),className:"default",events:{onClick:this.filterGrantedOnly.bind(this)}}),t.filterViewAll=new l({value:this.options.filterViewAllText?this.options.filterViewAllText:e.i18n("View all"),className:"default",events:{onClick:this.filterViewAll.bind(this)}}),{class:"pull-left filter-group",styles:{"margin-top":0},html:[new r({buttons:[t.filterGrantedOnly,t.filterViewAll]})]}},getSelectedCollection:function(){var e=this.platform.canCrossCompany();return{add:this.toGrantCollection.map(function(t){return e&&!t.isCustom()?{uid:t.get("uid"),licensed:t.get("licensed"),restricted:t.get("restricted")}:{uid:t.get("uid"),licensed:!0,restricted:!0}}),update:this.toUpdateCollection.map(function(t){return e&&!t.isCustom()?{uid:t.get("uid"),licensed:t.get("licensed"),restricted:t.get("restricted")}:{uid:t.get("uid"),licensed:!0,restricted:!0}}),remove:this.toRemoveCollection.map(function(t){return e&&!t.isCustom()?{uid:t.get("uid"),licensed:t.get("licensed"),restricted:t.get("restricted")}:{uid:t.get("uid"),licensed:!0,restricted:!0}})}},getCurrentCollection:function(){var e=new p(this.grantedCollection.toJSON());return e.add(this.toGrantCollection.toJSON()),this.toRemoveCollection.forEach(function(t){e.remove(t.get("uid"))}),e},onToggleClick:function(t,n){var i,o=this;this.grantedCollection.hasPagination(),t.isChecked()?n.hasFree()||n.isTPA()||n.isCustom()?(i=new h({selectedCollection:this.getCurrentCollection(),platform:o.platform,model:n,number:0,onConfirm:function(e){e.forEach(function(e){!e||o.toUpdateCollection.get(e)||o.grantedCollection.get(e)||o.toGrantCollection.get(e)?e&&o.grantedCollection.get(e)&&!o.toUpdateCollection.get(e)&&(e.set("granted",!0),o.toUpdateCollection.add(e)):(e.set("granted",!0),o.toGrantCollection.add(e)),o.toRemoveCollection.remove(e)}),o.toGrantCollection.add(n),o.toRemoveCollection.remove(n),o._manageCrossCompanySelection(n),o.updateWrapper()},onCancel:function(){t.uncheck()}})).isNeeded()?i.confirm():(o.toUpdateCollection.get(n)||o.grantedCollection.get(n)||o.toGrantCollection.get(n)?(o.toUpdateCollection.add(n),o.toRemoveCollection.remove(n),o.toGrantCollection.remove(n)):(o.toGrantCollection.add(n),o.toRemoveCollection.remove(n)),o._manageCrossCompanySelection(n),o.updateWrapper()):u.warn(e.i18n("You have not enough role")):(i=new g({model:n,selectedCollection:this.getCurrentCollection(),onCancel:function(){t.check()}})).isNeeded()?i.show():(this.toGrantCollection.remove(n),this.toUpdateCollection.remove(n),this.grantedCollection.findWhere({uid:n.get("uid")})&&(this.toRemoveCollection.add(n),this.toRemoveCollection.get(n).unset("crossCompanyDeseable")),o._manageCrossCompanySelection(n),o.updateWrapper())},getBody:function(){return this.content||(this.content=this.container.getElement(".wrapper")),this.content},mask:function(){this.isMasked()||(s.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(s.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Modal/ShareRolesModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","UWA/Controls/Pager","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/GrantTable2","DS/PlatformManagementComponents/Model/Platform","DS/UIKIT/Input/Button","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Collection/PlatformRoleCollection","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C){"use strict";var v=t.extend({tagName:"div",className:"facet-roles",setup:function(e){return this.options=e||{},e.platform&&(this.platform=e.platform),this._parent(e)},render:function(){return this.grantView=new d({fullCollection:new f([],{data:{platform:this.platform.get("id")}}),grantedCollection:new f([],{data:{platform:this.platform.get("id"),granted:!0}}),withoutLicensesCollection:new f([],{data:{platform:this.platform.get("id"),withLicenses:!1}}),platform:this.platform,searchPlaceholder:e.i18n("Search Roles"),filterViewAllText:e.i18n("View all"),filterGrantedOnlyText:e.i18n("View selected roles only"),emptyView:{icon:"role",text:e.i18n("No Roles found")}}),this.container.setContent(this.grantView.render()),this}});return n.extend({content:null,cache:null,locationsView:null,init:function(t){var n=this,i=C.extend({url:"platform/share/roles"});this.platform=t.platform,this.model=new i,this.view=new v({platform:n.platform}),this._parent(t),this.modal=new o({closable:!0,header:"",body:"",footer:[new h({value:e.i18n("Save"),className:"primary",events:{onClick:function(){n.model.save({id:n.platform.get("id"),shareRoles:JSON.stringify(n.view.grantView.getSelectedCollection())},{patch:!0,onComplete:function(){n.modal.unmask(),r.success(e.i18n("Settings have been saved")),n.modal.hide()},onFailure:function(){n.modal.unmask()}})}}}),new h({className:"default",value:e.i18n("Cancel"),events:{onClick:function(){n.modal.hide()}}})],events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal},show:function(){var t=this;return t.modal.mask(),this.modal.inject(document.body,"top").show(),g.fetch({onComplete:function(){t.modal.setHeader(e.i18n("Default roles to assign")),t.modal.setBody(t.view.render()),t.modal.unmask()}}),this}})}),define("DS/PlatformManagement/Views/BusinessExperienceRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/Tooltip","UWA/Event"],function(e,t,n,i,o,s){"use strict";return t.extend({tagName:"tr",setup:function(){return this.listenTo(this.model,{onChange:this.render}),this.model.updateModel=!0,this.container.setAttribute("data-type","business-experience"),this.container.setAttribute("data-id",this.model.get("uid")),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this},_onClick:function(e){var t=this.getContent(),n=!t.hasClassName("selected");s.stop(e),t.toggleClassName("selected",n),this.toggleSelect.setCheck(n),this.options.onSelect.call(this,t,this.model)},createContent:function(){var t=this,n=e.createElement("i",{class:"fonticon fonticon-info"}),i=this.model;return[{tag:"td",styles:{width:"80%"},html:[{tag:"span",text:this.model.get("title")}]},{class:"center",tag:"td",html:{tag:"span",html:n,styles:{cursor:"pointer"}},events:{click:function(e){s.stop(e),t.options.displayInfoBusinessExperience(i)}}}]}})}),define("DS/PlatformManagement/BusinessExperienceList",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/Mask","DS/UIKIT/Touch","DS/UIKIT/Tooltip","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Modal/RoleDetails","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/BusinessExperienceView","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/BusinessExperienceCollection","DS/PlatformManagement/Views/BusinessExperienceRowView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/EmptyView","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v){"use strict";return t.extend({collection:new d,touchPagerEvent:null,setup:function(e){var t=this._parent(e),n=this;return p.getServicesByPlatform({platforms:[e.platform.get("id")],services:["businessexperience"],config:{url:f.getApplicationConfiguration("app.urls.registry")}}).then(function(t){var i="";t&&t[0]&&t[0].services[0]&&(i=t[0].services[0].url+"/resources/BusinessExperienceAccess/admin/v1/model/BusinessExperienceDefinition",e.platform.set("businessexperience",i),e.toGrantBECollection.url=i,n.getPersistedData())},function(e){console.log(e)}),this.buildContainer(),t},search:function(e){this.options.toGrantBECollection.setOffset(0),this.options.toGrantBECollection.setQuery(e),""===e&&this.getContent().getElement(".fonticon-search").removeClassName("activate"),this.refresh()},updateLayout:function(){this.getBody().hasClassName("hidden")||this.getBody().getElement(".pm-grid-container").setContent(this._buildListContent())},refresh:function(e){this.setOptions(e),e&&e.params&&this.options.toGrantBECollection.setParams(e.params),this.buildContainer()},setTitle:function(t){this.getBody().getElement("h5 span")&&this.getBody().getElement("h5 span").setText(e.String.format(e.i18n("Business Experiences | {0}"),t))},getPersistedData:function(t){var n=this,i=!1;i&&n.options.onRefresh&&n.options.onRefresh(),t&&m.scrollToElement(".businessExperience-list-wrapper"),n.unmask(),void 0!==n.options.platform.get("businessexperience")&&n.options.toGrantBECollection.fetch({onComplete:function(t,o){n.csrf=t.csrf,n.options.toGrantBECollection.getMaxLimit()>0?(n.elements.container.removeClassName("hidden"),n.elements.container.setContent(n.buildContent()),i=!0,n.lastResult=n.options.toGrantBECollection.toJSON()):null!==n.options.toGrantBECollection.getQuery()&&(n.elements.container.removeClassName("hidden"),n.options.toGrantBECollection.setQuery(null),n.setTitle(e.i18n(n.options.toGrantBECollection.length)),n.elements.container.getElement(".pm-grid-container").setContent(n.buildNoResultSearch()))}})},buildNoResultSearch:function(){return[(new C).render()]},buildContainer:function(){var t=this;this.getBody()||(this.elements.container=e.createElement("div",{class:"businessExperience-list-wrapper hidden"}),this.getBody().setContent({class:"empty-body"})),this.mask(),this.options.platform&&null!==this.options.platform&&r.fetch({onComplete:function(){t.options.toGrantBECollection.setLimit(r.get("processesMaxPerPage")),t.options.toGrantBECollection.setTenant(t.options.platform.getId()),t.getPersistedData()}})},buildContent:function(){var t=[];return t.push({class:"divider"}),this.headerList=new v({icon:"presentation-slide-play",label:e.i18n("Business Experiences | {0}"),collection:this.options.toGrantBECollection,searchLabel:e.i18n("Search Business Experiences"),isSearchOpen:""!==this.options.toGrantBECollection.getQuery()&&null!==this.options.toGrantBECollection.getQuery(),events:{search:this.search.bind(this)}}),t.push(this.headerList.render()),t.push({class:"pm-grid-container "+(r.isGridLayout()?"layout-grid":"layout-table"),html:this._buildListContent()}),this.initTouchPager(),t},_buildListContent:function(){return[r.isGridLayout()?this.buildTiles():this.createTableView(),0===this.options.toGrantBECollection.getMaxLimit()?new g({fonticon:"presentation-slide-play",text:e.i18n("No business experience available")}).render():null,this.buildPager()]},buildTiles:function(){var e=[],t=this;return this.options.toGrantBECollection.forEach(function(n){e.push(t.buildTile(n))}),e},buildTile:function(t){var n=this;return t.actions=new a([{id:"info",title:e.i18n("Details"),icon:"fonticon fonticon-info"}]),new c({lazyLoading:!1,model:t,mapping:{title:function(){return this.model.get("title")},subtitle:function(){return this.model.get("subtitle")}},events:{onActionClick:function(e,i,o){var s=i.model.get("id");switch(o.stopPropagation(),s){case"info":n.displayInfoBusinessExperience(t)}}}}).render()},displayInfoBusinessExperience:function(e){new l({urlGranted:this.options.toGrantBECollection.url,model:e,detailsBE:!0,isBE:!0,csrf:this.csrf,platform:this.options.platform}).show()},createTableView:function(){var t=this,n=this.options.toGrantBECollection.map(function(e){return new u({model:e,displayInfoBusinessExperience:t.displayInfoBusinessExperience.bind(t)}).render()});return[{tag:"table",class:"table",html:[{tag:"thead",html:[{tag:"td",styles:{width:"10%"}},{tag:"td",styles:{width:"70%"},text:e.i18n("Name")},{class:"center",tag:"td",text:e.i18n("Details")}]},{tag:"tbody",html:n}]}]},initTouchPager:function(){var e,t=this;!this.touchPagerEvent&&t.pager&&(this.touchPagerEvent=!0,(e=new o(t.getBody())).on("swipeleft",function(){t.options.toGrantBECollection.hasNext()&&(t.options.toGrantBECollection.setOffset(t.options.toGrantBECollection.getNextOffset()),t.pager.setOffset(t.options.toGrantBECollection.getOffset()))}),e.on("swiperight",function(){t.options.toGrantBECollection.hasPrevious()&&(t.options.toGrantBECollection.setOffset(t.options.toGrantBECollection.getPreviousOffset()),t.pager.setOffset(t.options.toGrantBECollection.getOffset()))}))},buildPager:function(){var e=this,t=this.options.toGrantBECollection.getMaxLimit();return t>e.options.toGrantBECollection.getLimit()?this.pager=new n({limit:e.options.toGrantBECollection.getLimit(),offset:e.options.toGrantBECollection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.options.toGrantBECollection.setOffset(t),e.getPersistedData(!0)}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(i.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(i.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/ProcessList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/UIKIT/Touch","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Iconbar","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/UsageTracker","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/ProcessView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Model/ExportRoleModel","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Modal/RoleDetails","DS/PlatformManagement/Modal/CustomRole","DS/PlatformManagement/Views/ProcessRowView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Utils/FCSManager","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M,k,I,T){"use strict";return t.extend({withLicenses:!0,withoutLicenses:!1,grantedRoles:!1,nearlyFull:!1,expireSoon:!1,selectedCollection:new y,collection:new y,touchPagerEvent:null,tooltipExportRoles:null,exportRolesIcon:null,setup:function(t){var n=this;this.buildContainer(),h.subscribe("com.ds.compass:onExportRolesFinished",function(t){var i=n.options.platform.get("exportRolesInfos");n.exportRolesIcon=n.content.getChildren()[1].getElement(".in-progress-export");var o=n.exportRolesIcon.getParent().getAttribute("id");n.headerList.removeFontIcon(o,"fonticon-export").removeFontIcon(o,"in-progress-export").addFontIcon(o,"fonticon-download"),i.state="EOK",n.headerList.updateIconTooltip(o,e.i18n("Export finished. Click to download.")),i.fileName=t[0].fileName,i.lastModified=t[0].lastModified,k.success(e.i18n("Extraction is complete, please click the download button"))})},updateLayout:function(){this.getBody().getElement(".pm-grid-container").setContent(this._buildListContent()),this.elements.container.getElement(".invite")&&this.elements.container.getElement(".invite").setStyles({"margin-bottom":"5px"})},search:function(e){this.collection.setOffset(0),this.collection.setQuery(e),this.options.toGrantCollection.reset(),""===e&&this.getContent().getElement(".fonticon-search").removeClassName("activate"),this.refresh()},refresh:function(e){this.setOptions(e),e&&e.params&&(this.collection.setParams(e.params),this.collection.setParams({availabilityFilter:!1})),this.buildContainer()},setTitle:function(t){this.getBody().getElement("h5 span")&&this.getBody().getElement("h5 span").setText(e.String.format(e.i18n("Roles | {0}"),t))},getPersistedData:function(t){var n=this,i=!1;this.collection.setParams({withLicenses:this.withLicenses}),this.collection.fetch({onComplete:function(){n.collection.getMaxLimit()>0||n.nearlyFull||n.expireSoon||n.grantedRoles?(n.elements.container.setContent(n.buildContent()),i=!0,n.lastResult=n.collection.toJSON()):null===n.collection.getQuery()?(n.elements.container.setContent(n.buildContent()),n.lastResult=n.collection.toJSON()):(n.collection.setQuery(null),n.setTitle(e.i18n(n.collection.length)),n.elements.container.getElement(".pm-grid-container").setContent(n.buildNoResultSearch())),i&&n.options.onRefresh&&n.options.onRefresh(),-1!==window.parent.location.hash.indexOf("granted-roles")&&w.scrollToElementInIframe(".process-list-wrapper"),n.unmask()}})},buildNoResultSearch:function(){var t=this;return[new I({buttonConfig:{id:"create-custom",value:e.i18n("Create Custom Role"),icon:"role-plus",className:"btn-noresult primary",events:{onClick:function(){new x({model:new v,platform:t.options.platform,onAdded:function(){t.refresh()}}).show(),g.createCustomRole({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""})}}}}).render()]},buildContainer:function(){var t=this;this.getBody()||(this.elements.container=e.createElement("div",{class:"process-list-wrapper",id:"process-id"}),this.getBody().setContent({class:"empty-body"})),this.mask(),this.options.platform&&null!==this.options.platform&&p.fetch({onComplete:function(){t.collection.setLimit(p.get("processesMaxPerPage")),t.collection.setSortDirection(p.get("processesSortDirection")),t.collection.setPlatform(t.options.platform.getId()),-1!==window.parent.location.hash.indexOf("capacity-almost-reached")&&t.collection.setParams({availabilityFilter:!0}),t.getPersistedData()}})},buildContent:function(){var t=[],n=this.options.platform.get("exportRolesInfos")&&this.options.platform.get("exportRolesInfos").state,i="export-roles-icon";return"EIP"===n&&(i+=" in-progress-export"),"EIP"!==n&&"EOK"!==n||(i+=" export-blue"),this.headerList=new T({icon:this._getRoleIcon(),label:this._getTitle(),collection:this.collection,searchLabel:e.i18n("Search Roles"),isSearchOpen:""!==this.collection.getQuery()&&null!==this.collection.getQuery(),iconBarConfig:{items:[{fonticon:"EOK"===n?"download "+i:"export "+i,text:this.exportRolesStatusTooltip(n),name:"export",handler:this._exportRolesProcess.bind(this)},{fonticon:this._getFilterIcon(),text:e.i18n("Filter roles"),name:"filter-roles",content:{type:"dropdownmenu",options:{items:this._buildFilterRolesItems(),events:{onClick:this._manageSelectionFilter.bind(this)}}}}]},events:{search:this.search.bind(this)}}),t.push({class:"divider"}),t.push(this.headerList.render()),t.push({class:"pm-grid-container "+(p.isGridLayout()?"layout-grid":"layout-table"),html:this._buildListContent()}),this.initTouchPager(),t},exportRolesStatusTooltip:function(t){var n;switch(t){case"EIP":n=e.i18n("Export in progress");break;case"EOK":n=e.i18n("Export finished. Click to download.");break;default:n=e.i18n("Export Roles")}return n},_buildListContent:function(){var t=null;return 0===this.collection.getMaxLimit()&&(this.withoutLicenses?t=e.i18n("No roles without licenses available"):this.nearlyFull?t=e.i18n("No roles with capacity almost reached available"):this.grantedRoles?t=e.i18n("No granted roles available"):this.expireSoon&&(t=e.i18n("No roles expiring soon available"))),[p.isGridLayout()?this.buildTiles():this.createTableView(),t?new M({fonticon:this._getRoleIcon(),text:t}).render():null,this.buildPager()]},_hasTPA:function(){return e.is(w.getWidget().getElement(".tp-apps"))},buildAddTile:function(){var t=this,i=new C({id:"create-custom",lazyLoading:!1,model:new n({fonticon:"fonticon fonticon-role-plus",title:e.i18n("Create Custom Role"),action:function(){this.hasClassName("disabled")||(new x({model:new v,platform:t.options.platform,onAdded:function(){t.refresh()}}).show(),g.createCustomRole({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""}))}})});return i.render(),this._hasTPA()&&!0===this.withLicenses?i.getContent().removeClassName("hidden"):i.getContent().addClassName("hidden"),i},_createAction:function(t){var n=[];return t.isCustom()&&n.push({id:"edit",title:e.i18n("Edit"),icon:"fonticon fonticon-pencil"}),n.push({id:"info",title:e.i18n("Details"),icon:"fonticon fonticon-info"}),n},createTableView:function(){var t=this,n=this.collection.map(function(e){return e.actions=t._createAction(e),e.addEvent("onChange",function(){e.actions=this._createAction(e)},t),new P({model:e,selectedCollection:t.selectedCollection,getTileSubtitle:t.getTileSubtitle.bind(t),onSelect:t.options.onSelect,onActionClick:function(n,i,o){var s=n.id;switch(o.stopPropagation(),s){case"info":t.openDetailModal(e);break;case"edit":t.openEditModal(e,i)}}}).render()});if(0!==this.collection.count)return[new s({id:"create-custom",value:e.i18n("Create Custom Role"),icon:"role-plus",className:this._hasTPA()?"primary invite":"primary hidden",events:{onClick:function(){new x({model:new v,platform:t.options.platform,onAdded:function(){t.refresh()}}).show(),g.createCustomRole({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""})}}}),{tag:"table",class:"table",html:[{tag:"thead",html:[{tag:"td",class:"thumbnail"},{tag:"td",text:e.i18n("Name"),class:"name"},{class:"center apps",tag:"td",text:e.i18n("Included Apps")},{class:"center used",tag:"td",text:e.i18n("Used")},{class:"center expire",tag:"td",text:e.i18n("Expire")},{class:"center details",tag:"td",text:e.i18n("Details")}]},{tag:"tbody",html:n}]}];console.log("add tile & table not displayed")},buildTiles:function(){var e=[],t=this;return 0!==this.collection.count&&e.push(t.buildAddTile()),this.collection.forEach(function(n){e.push(t.buildTile(n))}),e},getAppsText:function(t){var n=t.get("apps");return e.is(n)&&n<=1?e.String.format(e.i18n("{0} app"),n):e.String.format(e.i18n("{0} apps"),n)},getTileSubtitle:function(t){var n=null;return t.isOption()&&t.isCasual()?n=e.i18n("Option, Casual usage"):t.isOption()&&t.isSelfExp()?n=e.i18n("Option, Trial"):t.isOption()?n=e.i18n("Option"):t.isCasual()?n=e.i18n("Casual usage"):t.isSelfExp()&&(n=e.i18n("Trial")),n?'<span class="contractor-text">'+n+"</span>":null},buildTile:function(e){var t,n=this;return e.actions=new u(this._createAction(e)),e.addEvent("onChange",function(){e.actions=new u(this._createAction(e))},this),(t=new f({lazyLoading:!1,model:e,selectedCollection:n.selectedCollection,onSelect:n.options.onSelect,mapping:{title:function(){return this.model.get("name")},subtitle:function(){return n.getTileSubtitle(this.model)},image:function(){return this.model.getIcon()},icon:function(){return null},content:function(){return e.getTileContent(e,n.withLicenses)}},events:{onActionClick:function(i,o,s){switch(s.stopPropagation(),o.model.get("id")){case"info":n.openDetailModal(e);break;case"edit":n.openEditModal(e,t)}}}})).render()},capacityAlmostReachedNavigation:function(){this.nearlyFull=!0},expireSoonNavigation:function(){this.expireSoon=!0},grantedRolesNavigation:function(e){this.grantedRoles=!0,e&&w.scrollToElement(".process-list-wrapper")},openDetailModal:function(e){new S({model:e,isBE:!1,platform:this.options.platform,withLicenses:this.withLicenses}).show()},openEditModal:function(e,t){var n=this;new x({model:e,platform:this.options.platform,onDelete:function(){t.destroy(),n.refresh()}}).show()},initTouchPager:function(){var e,t=this;!this.touchPagerEvent&&t.pager&&(this.touchPagerEvent=!0,(e=new r(t.getBody())).on("swipeleft",function(){t.collection.hasNext()&&(t.collection.setOffset(t.collection.getNextOffset()),t.pager.setOffset(t.collection.getOffset()))}),e.on("swiperight",function(){t.collection.hasPrevious()&&(t.collection.setOffset(t.collection.getPreviousOffset()),t.pager.setOffset(t.collection.getOffset()))}))},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?this.pager=new i({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.getPersistedData(!0)}}}):this.pager=null,this.pager},_getRoleIcon:function(){var e="role";return this.grantedRoles?e="role-ok":this.nearlyFull?e="shield-2":this.expireSoon&&(e="role-clock"),e},_getFilterIcon:function(){return!this.withLicenses||this.nearlyFull||this.expireSoon||this.grantedRoles?"filter withLicenses":"filter"},_getTitle:function(){var t=e.i18n("Roles | {0}");return this.grantedRoles?t=e.i18n("Granted Roles | {0}"):this.nearlyFull?t=e.i18n("Roles capacity almost reached | {0}"):this.expireSoon?t=e.i18n("Roles expiring soon | {0}"):this.withoutLicenses&&(t=e.i18n("Roles without any licenses | {0}")),t},_manageSelectionFilter:function(e,t){"select-nearly-full"!==t.action?(window.parent.location.hash=window.parent.location.hash.replace("/capacity-almost-reached","").replace("/granted-roles","").replace("/roles-expire-soon",""),this.nearlyFull=!1,this.collection.setParams({availabilityFilter:!1})):(this.nearlyFull=!0,this.collection.setParams({availabilityFilter:!0})),"select-expire-soon"!==t.action?(this.expireSoon=!1,this.collection.setParams({expireSoonFilter:!1})):(this.expireSoon=!0,this.collection.setParams({expireSoonFilter:!0})),"select-granted-roles"!==t.action?(this.grantedRoles=!1,this.collection.setParams({grantedRolesFilter:!1})):(this.grantedRoles=!0,this.collection.setParams({grantedRolesFilter:!0})),"select-without"!==t.action?this.withoutLicenses=!1:this.withoutLicenses=!0,"select-all"===t.action||"select-granted-roles"===t.action||"select-expire-soon"===t.action||"select-nearly-full"===t.action?this.withLicenses=!0:this.withLicenses=!1,this.collection.setOffset(0),this.buildContainer()},_buildFilterRolesItems:function(){var t=[{fonticon:"role-key",text:e.i18n("Roles with licenses"),action:"select-all",selectable:!0,selected:this.withLicenses}];return this.options.platform.canCrossCompany()&&t.push({fonticon:"role",text:e.i18n("Roles without any license"),action:"select-without",selectable:!0,selected:this.withoutLicenses}),t.push({fonticon:"role-ok",text:e.i18n("Granted Roles"),action:"select-granted-roles",selectable:!0,selected:this.grantedRoles}),t.push({fonticon:"shield-2 ",text:e.i18n("Roles capacity almost reached"),action:"select-nearly-full",selectable:!0,selected:this.nearlyFull}),t.push({fonticon:"role-clock",text:e.i18n("Roles expiring soon"),action:"select-expire-soon",selectable:!0,selected:this.expireSoon}),t},_exportRolesProcess:function(){var t,n=this,i=n.options.platform,o=i.getId();if(n.exportRolesIcon=n.content.getElement(".export-roles-icon"),g.exportRoles({tenant:o}),"EIP"!==(t=i.get("exportRolesInfos").state))if("EOK"!==t){var a=new s({class:"exportDownloadIt",icon:"download",events:{onClick:function(){n.downloadExportFile(i,c)}}}),r=e.createElement("div",{html:[{tag:"p",text:e.String.format(e.i18n("This operation generates a file containing the list of roles as well as the associated members. Action will be executed in background and could take some time depending on the volume to be exported."))},{tag:"ul",class:"modal-bullets",html:[{tag:"li",text:e.String.format(e.i18n("Name of platform: {0}"),i.get("name")||i.get("displayName"))}]},i.get("exportRolesInfos").fileName?{html:[{tag:"span",class:"exportDownloadDate",text:e.String.format(e.i18n("Last export file was generated on {0}."),i.get("exportRolesInfos").lastModified)},a]}:{}]}),c=new l({closable:!0,visible:!0,events:{onHide:function(){c.destroy()}},header:"<h4>"+e.String.format(e.i18n("Export roles"))+"</h4>",body:r,footer:[e.createElement("button",{class:"btn btn-primary",text:e.i18n("Export"),events:{click:function(){var t=n.exportRolesIcon.getParent().getAttribute("id");(new b).save({platform:o},{patch:!0,onComplete:function(o,s){n.exportRolesIcon.addClassName("roles"),n.exportRolesIcon.getParent().addClassName("item-active"),n.headerList.addFontIcon(t,"in-progress-export").addFontIcon(t,"export-blue"),i.get("exportRolesInfos").state="EIP",n.headerList.updateIconTooltip(t,e.i18n("Export in progress.")),k.info(e.i18n("Export in progress."))},onFailure:function(i,o){n.headerList.updateIconTooltip(t,e.i18n("The export failed, please try again.")),k.alert(o.message)}}),c.hide()}}}),e.createElement("button",{class:"btn btn-default",text:e.i18n("Cancel"),events:{click:function(){c.hide()}}})]}).inject(document.body);new m({target:a.elements.container,body:e.i18n("Export roles")})}else new b({id:1}).save({platform:o},{patch:!0,onComplete:function(t,o){var s=n.content.getChildren()[1].getElement(".fonticon-download").getParent().attributes;n.downloadExportFile(i,c),n.headerList.removeFontIcon(s.id.value,"export-blue").removeFontIcon(s.id.value,"fonticon-download"),n.headerList.addFontIcon(s.id.value,"fonticon-export"),i.get("exportRolesInfos").state="",n.headerList.updateIconTooltip(s.id.value,e.i18n("Export roles"))},onFailure:function(e,t){k.alert(t.message)}})},downloadExportFile:function(t,n){var i=t.get("exportRolesInfos").fileName;i&&""!==i&&E.fetchCheckoutTicket({data:{envid:t.getId(),file:i},onComplete:function(e,t){E.downloadFile(i,t),n&&n.hide()},onFailure:function(t,n){k.alert(e.i18n("Unable to download this csv file."))}})},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(o.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(o.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Modal/Notifications",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Model/ProcessModel","DS/UIKIT/Input/Button","DS/UIKIT/Mask","DS/W3DXComponents/Skeleton","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Views/Layout/ListView","DS/PlatformManagement/Collection/NotificationCollection","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/MemberDetails2","DS/PlatformManagement/Modal/RoleDetails","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Views/EmptyView","DS/UIKIT/Tooltip","DS/PlatformManagement/Collection/UserRoleCollection","DS/PlatformManagement/UsageTracker","DS/UIKIT/DropdownMenu","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M){"use strict";var k=0,I=function(){},T=t.extend({masked:!1,tagName:"div",className:"generic-detail facet-scrollable",styles:{"margin-top":10},selectedCollection:new v([]),render:function(){var e=this,t=2,n=function(){0===--t&&(l.unmask(e.container),e._render())};l.mask(this.container),!0!==this.model.get("disabled")?(this.selectedCollection=new S([],{data:{platform:this.options.platform,user:this.model.get("user").id,casual:this.model.get("user").casual,granted:!0,limit:1e3}}),this.model.fetch({data:{id:this.model.get("id"),platform:this.options.platform,sort_direction:"asc"},onComplete:n}),this.selectedCollection.fetch({onComplete:n})):(l.unmask(e.container),e._render())},_render:function(){var t=this,n=this,i=new s(this.model.toJSON()),l=new p(this.model.get("user")),r=new p(this.model.get("manager")),c=this.model.get("role").prereq.process.length>1?this.model.get("role").prereq.process:"",m=(this.selectedCollection._models,new a({value:e.i18n("Accept"),className:"primary",disabled:!0===this.model.get("disabled")||0===this.model.get("role").free,attributes:{styles:{"margin-right":5}},events:{onClick:function(){var e,i=n.getElements("[name=prereq-licenses\\[\\]]:checked");t.mask(),e=i.map(function(e){return{id:e.value,licensed:!0,restricted:!0}}),n.model.save({status:"accepted",id:n.model.get("id"),licenses:JSON.stringify(e)},{patch:!0,onComplete:function(e,i){t.unmask(),b.success(i.message),n.render()},onFailure:function(e,n){t.unmask(),n.message&&b.alert(n.message)}})}}}));"string"!=typeof c&&c.sort(function(e,t){return e.name.localeCompare(t.name,void 0,{sensitivity:"base"})});var d=new u({platform:t.platform,selectedCollection:this.selectedCollection,model:new s(this.model.get("role")),okButton:0===this.model.get("role").free?null:m,events:{detailsRoleDisplay:function(e){e.elem.getElement(".box-display-screen").addContent(this.createIconRole(e.model))}.bind(this)}}),g=this.container;return"new"===this.model.get("status")&&n.model.save({status:"read",id:n.model.get("id")},{patch:!0,onComplete:function(){I(k-=1)}}),this.content=e.createElement("div",{class:"generic-content",styles:{"padding-left":15},html:[!0===this.model.get("disabled")?{class:"bs-callout bs-callout-warning",html:[{tag:"h4",text:e.i18n("Information")},{text:e.is(this.model.get("message"))?this.model.get("message"):e.i18n("This user is not available on this platform, you can not accept this request.")}]}:null,{html:[{tag:"div",class:"underline-user-name",text:e.String.format(e.i18n("{0}"),l.getUserFullName()+this.getContractorText(l)),events:{click:function(e){new h({model:l,platform:widget.options.platform,tpa:!0}).show()}}},{tag:"div",text:" "+t.getRequestInformation(l)}]},{tag:"table",class:"table",styles:{"margin-top":10},html:{tag:"tbody",html:{tag:"tr",html:[{tag:"td",styles:{width:"90%"},class:"display-screen",html:{tag:"div",class:"box-display-screen",html:new o({className:"primary display-screen-role",type:"checkbox",name:"prereq-licenses[]",value:i.get("uid"),label:i.get("role").name,checked:new s(i.get("role")).hasFree(),disabled:!0})}},i.get("selfexp")?null:{tag:"td",class:"text-right",html:t.getInformation(i)}]}}},d.isNeeded()?{tag:"div",text:d.getTitle()+":"}:null,d.isNeeded()?d.getContent():null,"new"===this.model.get("status")||"read"===this.model.get("status")?{class:"text-right",html:[m,new a({value:e.i18n("Refuse"),className:"error",disabled:!0===this.model.get("disabled"),events:{onClick:function(){t.mask(),n.model.save({status:"refused",id:n.model.get("id")},{patch:!0,onComplete:function(e,i){t.unmask(),b.success(i.message),n.render()},onFailure:function(){t.unmask()}})}}})]}:{styles:{position:"relative",margin:0,width:"100%"},class:"accepted"===this.model.get("status")?"alert-message alert-success":"alert-message alert-warning",text:t.getStatusText("accepted"===this.model.get("status"),r,n)}]}),g.setContent(this.content),d.dispatchEvent("detailsRoleDisplay",{elem:g,model:i}),d.isNeeded()&&d.manageDefaultSelection(),this},createIconRole:function(t,n){var i=this,o=e.createElement("span",{class:"fonticon fonticon-info role-details role-prereq",events:{click:function(e){i.displayRoleDetails(t)}}});if(!n)return[o,new y({position:"bottom",target:o,body:e.i18n("Details")})]},displayRoleDetails:function(e){var t,n,i;e.get("role")?(i=e.get("role").id,n=new s(e.get("role"))):(i=e.get("id"),n=e),e.get("uid")&&(t=e.get("uid").split(":"+i)[0]),new g({model:n,platform:widget.options.platform,isTpa:!0,isBE:!1}).show(t)},getRequestInformation:function(t){return this.model.get("selfexp")?e.i18n("has requested to experience the role:"):e.i18n("has requested the role:")},getContractorText:function(t){var n="";return t.isCasual()&&t.isContractor()?n=e.String.format(e.i18n("(External, Casual usage)"),t.get("casual")):t.isContractor()?n=e.i18n("(External)"):t.isCasual()&&(n=e.String.format(e.i18n("(Casual usage)"),t.get("casual"))),""!==n?" "+n:n},getStatusText:function(t,n,i){var o=e.String.format(e.i18n("{0} accepted this request on {1}."),n.getUserFullName(),i.model.get("modified")),s=e.String.format(e.i18n("{0} refused this request on {1}."),n.getUserFullName(),i.model.get("modified"));return t?o:s},getInformation:function(t){var n=t.get("role").free<=0?100:100*(t.get("role").total-t.get("role").free)/t.get("role").total,i=e.createElement("span",{styles:{"font-size":"20px"},class:"fonticon fonticon-calendar-clock availability"}),o=t.get("role").total?e.createElement("span",{styles:{"font-size":"20px"},class:n<25?"fonticon fonticon-progress-3":n<50||n<75?"fonticon fonticon-progress-2":n>75?"fonticon fonticon-progress-1":""}):"",s=e.createElement("div",{class:t.get("role").free<=0?"text-error":"",html:[t.get("role").free<=0?i:"",o]});return o&&""!==o&&(new y({position:"bottom",target:o,body:e.String.format(e.i18n("Used: {0}/{1}"),t.get("role").total-t.get("role").free,t.get("role").total)}),C.addUsedColor(o,n)),i&&""!==i&&new y({position:"bottom",target:i,body:e.String.format(e.i18n("No license available for this role"))}),s},mask:function(){this.isMasked()||(l.mask(this.container),this.masked=!0)},unmask:function(){this.isMasked()&&(l.unmask(this.container),this.masked=!1)},isMasked:function(){return this.masked}}),A=t.extend({tagName:"div",render:function(){return this.container.setContent(new c({useInfiniteScroll:!1,usePullToRefresh:!1,view:new T({model:this.model,platform:this.model.options.data.platform})}).render()),this}});return n.extend({defaultOptions:{},content:null,unread:0,pendingRequests:!1,init:function(e){this._parent(e),e._updateNotificationBadge&&(I=e._updateNotificationBadge),this.modal=new i({closable:!0,header:this.getTitle(),className:C.getPlatformManagementWrapperClassName("big-modal"),body:"",footer:"",events:{onHide:function(){this.destroy()}}}),this.elements.container=this.modal},confirm:function(){return this.modal.setBody(this.getContent()),this.modal.getFooter().addClassName("hidden"),this.modal.inject(document.body,"top").show(),this},getTitle:function(){return"<h3>"+e.i18n("Requests")+"</h3>"},getContent:function(){return this.content=e.createElement("div",{html:[this.getRequestTemplate(),this.getSkeleton().render()]}),sessionStorage.removeItem("pending-requests"),this.content},getListViewThumbnail:function(e){return C.getAsset("notification_"+(e.get("selfexp")?"selfexp":"role")+"_80x60-"+e.get("status")+".png")},getSkeleton:function(){var n=this;return n.skeleton=new r({notification:{fetchOptions:{onComplete:function(t,i){k=i.unread,0===t.count&&(null===t.query||void 0===t.query?n.skeleton.getContent().setContent(new w({fonticon:"role",text:e.i18n("No Roles requests found")}).render()):n.skeleton.getContent().setContent(n.buildNoResultSearch())),t&&(n.skeletonCollection=t),I(k)}},collection:d,collectionOptions:{data:{platform:n.options.platform.getId(),filterbystatus:"true"===sessionStorage.getItem("pending-requests")?"pending":""}},view:m,viewOptions:{emptyView:t.extend({tagName:"div",render:function(){return this}}),itemViewOptions:{mapping:{"data-id":function(){this.container.setAttribute("data-id",this.model.get("role").id)},title:function(){return e.String.format(this.model.get("selfexp")?e.i18n("{0} experience request"):e.i18n("{0} request"),this.model.get("role").name)},subtitle:function(){return new p(this.model.get("user")).getUserFullName()+" - "+this.model.get("created")},image:function(){return n.getListViewThumbnail(this.model)},icon:function(){return null},content:function(){return'<div class="owner-name-color">'+new p(this.model.get("user")).getCityAndCountryFullName()+"</div>"}}},autoFetch:!0,useInfiniteScroll:!0,usePullToRefresh:!0,events:{onPullToRefresh:function(){var e=this.scrollView;this.collection.fetch({reset:!0,data:{offset:0,filterbystatus:"true"===sessionStorage.getItem("pending-requests")?"pending":""},onComplete:function(){e.endLoading()},onFailure:function(){e.endLoading()}})},onInfiniteScroll:function(){var e=this.scrollView;this.collection.isInProgress()?e.endLoading():this.collection.hasNext()?(this.collection.setOffset(this.collection.getNextOffset()),this.collection.fetch({reset:!1,add:!0,remove:!1,data:"true"===sessionStorage.getItem("pending-requests")?{filterbystatus:"pending"}:{},onComplete:function(){e.endLoading()},onFailure:function(){e.endLoading()}})):this.collection.isFetched()&&e.useInfiniteScroll(!1)}}},idCardOptions:{attributesMapping:{title:function(){return e.String.format(this.get("selfexp")?e.i18n("{0} experience request"):e.i18n("{0} request"),this.get("role").name)},date:function(){return this.get("created")}},actions:[],facets:[{handler:r.getRendererHandler(A)}]}}},{root:"notification",useRootChannelView:!1,height:"100%"}),n.skeleton},buildNoResultSearch:function(){return[(new E).render()]},getBody:function(){return this.content||(this.content=this.skeleton.getContent()),this.content},save:function(t){var n={};n.id=this.options.platform.get("id"),n.roleRequest=t.target.checked,this.options.platform.save(n,{patch:!0,onComplete:function(){b.success(e.i18n("Settings have been saved"))},onFailure:function(e,t){t.message&&b.alert(t.message)}})},save2:function(t){var n={};n.id=this.options.platform.get("id"),n.roleRequestWU=t.target.checked,this.options.platform.save(n,{patch:!0,onComplete:function(){b.success(e.i18n("Settings have been saved"))},onFailure:function(e,t){t.message&&b.alert(t.message)}})},getFormElement:function(e){return this.getContent().getElement('[name="'+e+'"]')},getRequestTemplate:function(){var t=this;return{class:"form-section",styles:{"margin-left":"14px","margin-top":"25px"},html:[{tag:"h4",text:e.i18n("Requests from members")},new o({className:"primary",type:"switch",name:"roleRequest",value:!0,label:!0===this.options.platform.get("roleRequestWUActivation")?e.i18n("Allow platform members to request roles containing Web Apps"):e.i18n("Allow platform members to request new roles"),checked:!0===this.options.platform.get("roleRequest"),events:{onClick:function(e){t.save(e),!0!==t.options.platform.get("roleRequestWUActivation")?x.activeCrossCompany({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""}):!0!==this.options.platform.get("roleRequestWUActivation")&&x.desableCrossCompany({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""})}}}),e.is(this.options.platform.get("roleRequestWUActivation"))&&!0===this.options.platform.get("roleRequestWUActivation")?new o({className:"primary",type:"switch",name:"roleRequestWU",value:!0,label:e.i18n("Allow Platform Members to request Roles containing Native Apps"),checked:!0===this.options.platform.get("roleRequestWU"),events:{onClick:this.save2.bind(this)}}):null,{tag:"br"},this.buildSearchFilter(),{tag:"h4",class:"h4-role-request",html:[{text:e.i18n("Roles requests")}]}]}},_onClickFilter:function(){var e={},t=this.skeleton.getCollectionAt(0).options.data;for(var n in t.offset=0,this.dropdownMenu.getSelectedItems().forEach(function(t){var n=t["filter-key"],i=t["filter-value"];n&&(e[n]||(e[n]=[]),e[n].push(i))}),this.dropdownMenu.options.items.filter(function(e){return e["filter-key"]}).map(function(e){return e["filter-key"]}).forEach(function(e){t[e]=void 0}),e)e.hasOwnProperty(n)&&(t[n]=e[n].join(","));this.dropdownMenu.options.target.firstChild.toggleClassName("fonticon-activated",Object.keys(e).length),this.fetchAndRefreshSkeleton(t)},_onSearch:function(e){var t=this.skeleton.getCollectionAt(0).options.data;t.query=void 0,t.offset=0,e&&""!==e&&(t.query=e),this.fetchAndRefreshSkeleton(t)},fetchAndRefreshSkeleton:function(e){var t=this,n=this.skeleton,i=n.getCurrentPanelIndex(),o=n.getViewAt(i),s=o.collection;o.scrollView&&l.mask(o.scrollView.getContent()),s?this.skeletonCollection=s:s=this.skeletonCollection,s&&(s.reset(),s.fetch({data:e,onComplete:function(){o.scrollView&&l.unmask(o.scrollView.getContent()),n.render(),n.getContent().getElement(".skeleton-ctrl-back")&&n.getContent().getElement(".skeleton-ctrl-back").click(),t._manageEmptyView(s)}})),n.refresh()},_manageEmptyView:function(e){if(e&&0!==e.size())this.emptyView&&(this.emptyView.destroy(),this.emptyView=null);else if(!this.emptyView){var t=this.skeleton.getContent().getElement(".grid-container");t&&(this.emptyView=(new E).render(),this.emptyView.inject(t,"bottom"))}},buildSearchFilter:function(){var t=this,n=new D({isCollapsable:!0,tooltip:!0,minChar:2,attributes:{placeholder:e.i18n("Search by requester or by role"),value:"",events:{keyup:function(){t._onSearch(this.value.trim())},clickSearch:function(){t.content.getElement(".h4-role-request").addClassName("h4-with-platform-management-toolbar-open"),t.content.getElement(".input-search-wrapper input").addClassName("responsive")}}}}),i=e.createElement("div",{class:"icon-wrapper",html:{tag:"i",class:"true"===sessionStorage.getItem("pending-requests")?"pointer fonticon fonticon-filter fonticon-activated":"pointer fonticon fonticon-filter"}});return this.dropdownMenu=new P({target:i,items:[{text:e.i18n("All"),fonticon:"role",selectable:!0,selected:"true"!==sessionStorage.getItem("pending-requests")},{text:e.i18n("Accepted"),fonticon:"role-ok","filter-key":"filterbystatus","filter-value":"accepted",selectable:!0},{text:e.i18n("Pending"),fonticon:"role-clock","filter-key":"filterbystatus","filter-value":"pending",selectable:!0,selected:"true"===sessionStorage.getItem("pending-requests")},{text:e.i18n("Refused"),fonticon:"role-delete","filter-key":"filterbystatus","filter-value":"refused",selectable:!0}],events:{onClick:this._onClickFilter.bind(this)}}),this.tooltip=new y({position:"top",target:i.getElement(".fonticon-filter"),body:e.i18n("Filter Roles requests")}),{class:"platform-management-toolbar",html:[i,{html:n}]}}})}),define("DS/PlatformManagement/Collection/MemberLocationCollection",["UWA/Core","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Model/PlatformModel"],function(e,t,n){"use strict";return t.extend({url:"platform/location",model:n,setup:function(e,t){return this.setLimit(6),this._parent(e,t)},parse:function(e){return this.setMaxLimit(e.count),e.data}})}),define("DS/PlatformManagement/Views/AppsRowView",["UWA/Core","UWA/Class/View","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event"],function(e,t,n,i,o,s,a){"use strict";return t.extend({tagName:"tr",domEvents:{click:"_onClick"},setup:function(){return this.listenTo(this.model,{onChange:this.render}),this.model.get("private")||this.container.setAttribute("data-public","true"),this.container.setAttribute("data-id",this.model.get("uid")),this.container.setAttribute("data-type","process"),this.container.addClassName("tp-apps"),this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this},_onClick:function(e){var t=this.getContent(),n=!t.hasClassName("selected");a.stop(e),t.toggleClassName("selected",n),this.toggleSelect.setCheck(n),this.options.onSelect.call(this,t,this.model)},createContent:function(){var e=this.model;return this.toggleSelect=new i({className:"primary inline",type:"checkbox",name:"users[]",value:e.get("id"),id:e.get("id"),label:""}),[{tag:"td",html:[this.toggleSelect,{class:"img-wrapper",html:{tag:"img",src:e.getIcon()}}]},{tag:"td",text:n.getTextFromHtml(e.get("name"))},{tag:"td",text:e.getDisplayType()},{tag:"td",html:this._buildAction()}]},_buildAction:function(){var t,n=this,i=this.model;return 1===i.actions.length?t=i.actions.map(function(t){var i=e.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:t.icon}},events:{click:function(e){a.stop(e),n.options.onActionClick(t,n,e)}}});return new s({position:"bottom",target:i,body:t.title}),i}):(t=e.createElement("div",{tag:"div",class:"action-container single-action",html:{class:"action-icon-wrapper",html:{tag:"i",class:"fonticon fonticon-down-open"}},events:{click:function(e){a.stop(e)}}}),new o({target:t,renderTo:document.querySelector(".apps-list-wrapper"),items:i.actions.map(function(e){return{text:e.title,icon:e.icon,handler:function(t){n.options.onActionClick(e,n,t)}}})})),t}})}),define("DS/PlatformManagement/Modal/MemberLocationModal",["UWA/Core","UWA/Class/View","UWA/Controls/Abstract","DS/PlatformManagement/Modal/FullScreenModal","DS/UIKIT/Mask","DS/UIKIT/Input/Toggle","DS/PlatformManagement/Utils","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagementComponents/Model/Platform","DS/UIKIT/Input/Button","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Collection/ProcessCollection","DS/PlatformManagement/Collection/PlatformRoleCollection","DS/PlatformManagement/Collection/MemberLocationCollection","DS/i3DXCompassCore/Model/i3DXCompassModel"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f){"use strict";return t.extend({tagName:"div",className:"facet-location",init:function(e){var t=f.extend({url:"platform/location"});this.platform=e.platform,this.model=new t,this.collection=new p},setup:function(e){return this.options=e||{},e.platform&&(this.platform=e.platform),this._parent(e)},render:function(){var t,n=this,o=this.platform.get("locations"),s=[],a=new i({closable:!0,visible:!0,events:{onHide:function(){a.destroy()}},header:'<h4 class="location-title">'+e.String.format(e.i18n("Member’s platform locations"))+"</h4>",body:e.createElement("div",{styles:{"padding-right":"15px","padding-left":"15px"},html:[{tag:"p",class:"location",text:e.String.format(e.i18n("Select available member's location:"))},{tag:"table",class:"table table-hover table-bordered table-select-process table-location",html:[{tag:"tbody",html:n.getRows()}]}]}),footer:[e.createElement("button",{class:"btn btn-primary",text:e.i18n("Save"),events:{click:function(){o.forEach(function(e){""!==e.id&&e.hasOwnProperty("selected")&&!0===e.selected&&s.push(e.id)}),t=s.join(","),n.model.save({id:n.platform.get("id"),administeredLocationList:t},{patch:!0,onComplete:function(){l.success(e.i18n("Settings have been saved"));var t=n.platform.get("locations");t.forEach(function(e){e.available=-1!==s.indexOf(e.id),""===e.id&&(e.available=!0)}),n.platform.set("locations",t)},onFailure:function(){}}),a.hide()}}}),e.createElement("button",{class:"btn btn-default",text:e.i18n("Cancel"),events:{click:function(){a.hide()}}})]}).inject(document.body)},getRows:function(){var e=[],t=this;return this.platform.get("locations").forEach(function(n){e.push(t.getRow(n))}),e},getRow:function(t){var n=this.platform.get("administrateLocationListEnabled"),i=(this.platform.get("locations"),t.id),o=t.name,a=t.available,l=t.selected,r=(t=t,new s({className:"primary height toggle-location",type:"checkbox",name:"location",disabled:""===i,label:o,id:i,checked:!0===n?a:l})),c=e.createElement("div",{class:"tooltip-wrapper",html:r});return e.createElement("tr",{class:"row-location",styles:{color:"#3D3D3D"},html:[{tag:"td",html:[c]}],events:{click:function(e){if(!r.isDisabled()&&!e.target.getParent(".toggle-switch")){var n=!r.isChecked();r.setCheck(n),t.selected=n}}}})}})}),define("DS/PlatformManagement/AppsList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Touch","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/DropdownMenu","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/AppsView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Modal/RoleDetails","DS/PlatformManagement/Modal/ThirdPartyApps","DS/PlatformManagement/Utils","DS/PlatformManagement/Collection/AppsCollection","DS/PlatformManagement/Model/AppModel","DS/PlatformManagement/Views/AppsRowView","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/UsageTracker","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y){"use strict";return t.extend({defaultOptions:{},content:null,masked:!1,collection:new p,setup:function(e){var t=this._parent(e);return this.buildContainer(),t},search:function(e){this.collection.setOffset(0),this.collection.setQuery(e),this.refresh()},refresh:function(e){this.setOptions(e),e&&e.params&&this.collection.setParams(e.params),this.buildContainer()},_manageCustomRoleDisplay:function(e){var t=g.getWidget().getElement("#create-custom");t&&(e?t.removeClassName("hidden"):t.addClassName("hidden"))},createTableView:function(){var t=this,n=this.collection.map(function(e){return e.actions=t._createAction(e),e.addEvent("onChange",function(){e.actions=this._createAction(e)},t),new C({model:e,onSelect:t.options.onSelect,onActionClick:function(n,i,o){var s=n.id;switch(o.stopPropagation(),s){case"info":t.openDetailModal(e);break;case"edit":t.openEditModal(e,i)}}}).render()});return[new a({value:e.i18n("Create Additional App"),icon:"box-plus",className:"primary invite",events:{onClick:function(){t.action=new h({platform:t.options.platform,model:new f,onAdded:function(){t.refresh()}}),b.createCustomApp({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""})}}}),n.length>0?{tag:"table",class:"table",html:[{tag:"thead",html:[{tag:"td"},{tag:"td",text:e.i18n("Name")},{tag:"td",text:e.i18n("Type")},{tag:"td",text:e.i18n("Details")}]},{tag:"tbody",html:n}]}:null]},getPersistedData:function(t){var n=this;this.collection.fetch({onComplete:function(){null===n.collection.getQuery()&&n.options.platform.set("hasTPA",n.collection.getMaxLimit()>0),n.collection.getMaxLimit()>0?(n.getBody().removeClassName("hidden"),n.getBody().setContent(n.buildContent()),n._manageCustomRoleDisplay(!0)):null===n.collection.getQuery()?(n.getBody().removeClassName("hidden"),n.getBody().setContent(n.buildContent()),n._manageCustomRoleDisplay(!1)):(n.collection.setQuery(null),n.setTitle(e.i18n(n.collection.length)),n.elements.container.getElement(".pm-grid-container").setContent(n.buildNoResultSearch())),t&&g.scrollToElement(".apps-list-wrapper"),n.options.onRefresh&&n.options.onRefresh(),n.unmask()}})},buildNoResultSearch:function(){var t=this;return[new w({buttonConfig:{value:e.i18n("Create Additional App"),icon:"box-plus",className:"btn-noresult primary",events:{onClick:function(){t.action=new h({platform:t.options.platform,model:new f,onAdded:function(){t.refresh()}}),b.createCustomApp({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""})}}}}).render()]},buildContainer:function(){var t=this;this.getBody()||(this.elements.container=e.createElement("div",{class:"process-list-wrapper apps-list-wrapper hidden"})),this.mask(),this.options.platform&&null!==this.options.platform&&this.options.platform.isPlatform()&&c.fetch({onComplete:function(){t.collection.setLimit(c.get("processesMaxPerPage")),t.collection.setSortDirection(c.get("processesSortDirection")),t.collection.setPlatform(t.options.platform.getId()),t.getPersistedData()}})},setTitle:function(t){this.getBody().getElement("h5 span")&&this.getBody().getElement("h5 span").setText(e.String.format(e.i18n("Additional Apps | {0}"),t))},updateLayout:function(){this.getBody().getElement(".pm-grid-container").setContent(this._buildListContent()),this.elements.container.getElement(".invite")&&this.elements.container.getElement(".invite").setStyles({"margin-bottom":"5px"})},buildContent:function(){var t=[];return t.push({class:"divider"}),this.headerList=new y({icon:"app",label:e.i18n("Additional Apps | {0}"),collection:this.collection,searchLabel:e.i18n("Search Additional Apps"),isSearchOpen:""!==this.collection.getQuery()&&null!==this.collection.getQuery(),events:{search:this.search.bind(this)}}),t.push(this.headerList.render()),t.push({class:"pm-grid-container "+(c.isGridLayout()?"layout-grid":"layout-table"),html:this._buildListContent()}),this.initTouchPager(),t},_buildListContent:function(){return[c.isGridLayout()?this.buildTiles():this.createTableView(),this.buildPager()]},buildAddTile:function(){var t=this;return new d({lazyLoading:!1,model:new n({fonticon:"fonticon fonticon-app-add",title:e.i18n("Create Additional App"),action:function(){this.hasClassName("disabled")||(t.action=new h({platform:t.options.platform,model:new f,onAdded:function(){t.refresh()}}),b.createCustomApp({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):""}))}})}).render()},buildTiles:function(){var e,t=[],n=this;return!0===this.options.platform.get("platform")&&t.push(n.buildAddTile()),this.collection.forEach(function(i){e=n.buildTile(i),t.push(e)}),t},_createAction:function(t){var n=[{id:"edit",title:e.i18n("Edit"),icon:"fonticon fonticon-pencil"}];return t.get("private")&&n.push({id:"info",title:e.i18n("Details"),icon:"fonticon fonticon-info"}),n},buildTile:function(t){var n,i=this;return t.actions=this._createAction(t),t.actions=new r([t.get("private")?{id:"open",icon:"fonticon fonticon-open-down"}:{id:"edit",icon:"fonticon fonticon-pencil"}]),t.addEvent("onChange",function(){t.actions=new r([t.get("private")?{id:"open",icon:"fonticon fonticon-open-down"}:{id:"edit",icon:"fonticon fonticon-pencil"}])},this),(n=new m({lazyLoading:!1,model:t,mapping:{title:function(){return this.model.get("name")},subtitle:function(){return e.String.format(e.i18n("Type: {0}"),this.model.getDisplayType())},image:function(){return t.getIcon()},icon:function(){return null}},onSelect:i.options.onSelect,events:{onActionClick:function(o,s,a){a.stopPropagation();t.actions.get("id");if("open"===t.actions._models[0]._attributes.id)new l({target:n.getContent().getElement(".fonticon-open-down"),renderTo:document.querySelector(".apps-list-wrapper"),items:[{text:e.i18n("Edit"),fonticon:"pencil",selectable:!0,action:"select-edit"},t.get("private")?{text:e.i18n("Details"),fonticon:"info",selectable:!0,action:"select-details"}:{}],events:{onClick:function(e,o){"select-edit"===o.action?i.openEditModal(t,n):"select-details"===o.action&&i.openDetailModal(t)}}}).show();else"edit"===t.actions._models[0]._attributes.id&&i.openEditModal(t,n)}}})).render()},openDetailModal:function(e){e.set("detailTpaActive",!0),new u({model:e,isApp:!0,isBE:!1,platform:this.options.platform}).show()},openEditModal:function(e,t){var n=this;this.modal=new h({model:e,appId:e.get("id"),platform:this.options.platform,isEdit:!0,onDelete:function(){t.destroy(),n.refresh()}})},touchPagerEvent:null,initTouchPager:function(){var e,t=this;!this.touchPagerEvent&&t.pager&&(this.touchPagerEvent=!0,(e=new o(t.getBody())).on("swipeleft",function(){t.collection.hasNext()&&(t.collection.setOffset(t.collection.getNextOffset()),t.pager.setOffset(t.collection.getOffset()))}),e.on("swiperight",function(){t.collection.hasPrevious()&&(t.collection.setOffset(t.collection.getPreviousOffset()),t.pager.setOffset(t.collection.getOffset()))}))},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?this.pager=new i({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.getPersistedData(!0)}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(s.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(s.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Views/ConfigureMembersInvitations",["UWA/Core","UWA/Class/View","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/PlatformManagement/Utils","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/ShareRolesModal","DS/PlatformManagement/Modal/MemberLocationModal","DS/UIKIT/Tooltip"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p){"use strict";var f="administrateLocationListEnabled";return t.extend({tagName:"div",className:"facet-scrollable facet-config",model:null,detailElement:null,enableToggle:null,platformFolder:null,callbacks:2,setup:function(e){return this.platform=e.platform,this.listenTo(this.platform,{onChange:this.render.bind(this)}),e},render:function(){return this.container.setContent(this.getTemplate()),this.dispatchEvent("onResize"),this},save:function(){console.log("beginning of save");var t=this,n={};n.id=this.platform.get("id"),this.getFormElement("crossCompany")&&(n.crossCompany=this.getFormElement("crossCompany").checked),this.getFormElement("shareEnabled")&&this.getFormElement("shareValidation")&&(n.shareEnabled=this.getFormElement("shareEnabled").checked,n.shareValidation=this.container.getElement('[name="shareValidation"]:checked').value),this.getFormElement("autoRemoveExpiredRole")&&(n.autoRemoveExpiredRole=this.getFormElement("autoRemoveExpiredRole").checked),this.getFormElement(f)&&(n[f]=this.getFormElement(f).checked),console.log("Data below"),console.log(n),t.mask(),this.platform.save(n,{patch:!0,onComplete:function(){t.unmask(),u.success(e.i18n("Settings have been saved"))},onFailure:function(e,n){t.unmask(),n.message&&u.warn(n.message)}})},getFormElement:function(e){return this.container.getElement('[name="'+e+'"]')},getTemplate:function(){return this.platform.isOnPremise()?null:this._createCrossCompanyTemplate()},buildExpirationView:function(){var t=e.createElement("span",{class:"expiration fonticon fonticon-info "});return new p({position:"bottom",target:t,trigger:this._getTriggerActionResponsive(),body:e.i18n("Ungrant all roles which license expired when members try to connect to the platform")}),[{tag:"h4",class:"expiration-title",text:e.i18n("Licenses Expiration")},{class:"form-group form-group-with-information-icon",html:[new n({className:"primary inline expiration-toggle",type:"switch",name:"autoRemoveExpiredRole",value:"",label:e.i18n("Automatically ungrant expired roles from members or groups"),checked:!0===this.platform.get("autoRemoveExpiredRole"),events:{onClick:this.save.bind(this)}}),t]}]},_getTriggerActionResponsive:function(){return window.innerWidth<768?"click touch":"hover focus"},_createCrossCompanyTemplate:function(){var t="",i=this.platform.get("locations"),o=e.is(this.platform.get("crossCompanyDisabled"))?this.platform.get("crossCompanyDisabled"):!0===this.platform.get("crossCompany"),s=this.platform.get("features")&&!1!==this.platform.get("features").crossCompany?e.createElement("span",{html:new n({className:"primary inline crossCompany-toggle",type:"switch",name:"crossCompany",value:!0,label:e.i18n("Allow administrators to grant roles without assigning automatically the associated license"),checked:!0===this.platform.get("crossCompany"),disabled:o,events:{onClick:this.save.bind(this)}})}):null,a=e.createElement("span",{class:"crossCompany fonticon fonticon-info "});return o&&s&&(t=e.i18n("Once activated, this option can be deactivated only if it is not currently used: all users must have all licenses assigned, with restricted usage for platform licenses.")),!o&&s&&(t=e.i18n("Members can work on this platform with a license they have already been granted on another platform.")),new p({position:"bottom",target:a,trigger:this._getTriggerActionResponsive(),body:t}),{html:[this.buildExpirationView(),{tag:"br"},s?{html:[{tag:"h4",class:"crossCompany-title",text:e.i18n("Invitations from administrators"),styles:{"margin-top":0}},s?{class:"form-group form-group-with-information-icon",html:[s,a],styles:{"margin-bottom":10}}:null]}:null,s?{tag:"br"}:null,{html:this.platform.get("share")?this._createShareInviteMember():null},{tag:"br"},i&&i.length>1?{html:this._createRestrictedLocation()}:{}]}},_createShareInviteMember:function(){var t=this,i=e.createElement("span",{class:"share-invite fonticon fonticon-info "}),o=function(e){return!1!==e.get("shareEnabled")&&(!0===e.get("shareEnabled")||!0===e.get("share").enabled)};return new p({position:"bottom",trigger:this._getTriggerActionResponsive(),target:i,body:e.i18n("Authorize automatic invitation of external users when sharing content")}),[{tag:"h4",class:"share-title",text:e.i18n("Invitations from members")},{class:"container-members-invitations",html:[{class:"form-group form-group-without-information-icon",html:[new n({className:"primary inline share-toggle",type:"switch",name:"shareEnabled",value:!0,label:e.i18n("Allow platform members to invite external users (for instance when sharing content)."),checked:o(this.platform),events:{onClick:this.save.bind(t)}}),{tag:"span",class:"span-select-link",html:{tag:"a",class:"manage-share-link",html:e.i18n("(select default roles to assign)")},events:{click:function(e){e.stopPropagation(),new h({platform:t.platform}).show()}}},{class:"information-icon",html:[i]}]}]},{class:"share-wrapper"+(o(this.platform)," hidden"),html:[{class:"share-validation",html:[new n({name:"shareValidation",value:!0,className:"primary",label:e.i18n("With admin validation"),checked:!1,disabled:!0}),new n({name:"shareValidation",value:!1,className:"primary",label:e.i18n("Without admin validation"),checked:!0,disabled:!0})]}]}]},_createRestrictedLocation:function(){var t=this,i=e.createElement("span",{class:"location fonticon fonticon-info "});return new p({position:"bottom",trigger:this._getTriggerActionResponsive(),target:i,body:e.i18n("This option optimizes the 3DEXPERIENCE data access performance for the user's geographic location.")}),[{tag:"h4",class:"location-title",text:e.i18n("Member’s platform locations")},{class:"container-members-invitations",html:[{class:"form-group form-group-without-information-icon",html:[new n({className:"primary inline location-toggle",type:"switch",name:f,value:!0,label:e.i18n("Allow administrators to manage member’s platform locations."),checked:!0===this.platform.get(f),events:{onClick:this.save.bind(t)}}),{tag:"span",class:"span-select-link",html:{tag:"a",class:"manage-share-link location",html:e.i18n("(select location)")},events:{click:function(e){return e.stopPropagation(),new g({platform:t.platform}).render()}}},{class:"information-icon",html:[i]}]}]}]},getBody:function(){return this.content||(this.content=this.container),this.content},mask:function(){this.isMasked()||(i.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(i.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Views/LogsView",["UWA/Core","UWA/Class/View","UWA/Controls/Pager","DS/UIKIT/Input/Toggle","DS/UIKIT/Mask","DS/UIKIT/Input/Text","DS/UIKIT/Input/Select","DS/UIKIT/Input/Button","DS/UIKIT/Touch","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/W3DXComponents/Collections/ActionsCollection","DS/W3DXComponents/Views/Layout/ScrollView","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Utils","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/Collection/LogsCollection","DS/i3DXCompassCore/Model/i3DXCompassModel","DS/PlatformManagement/Model/LogsModel","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Modal/ShareRolesModal","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Views/LogsRowView","DS/PlatformManagement/Views/NoSearchResultView","DS/PlatformManagement/Views/HeaderList"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E){"use strict";return t.extend({withLicenses:!0,configuration:!1,legal:!1,membersRoles:!1,today:!1,yesterday:!1,thisWeek:!1,lastWeek:!1,thisMonth:!1,lastMonth:!1,touchPagerEvent:null,setup:function(e){var t=this._parent(e);e.platform&&(this.platform=e.platform),sessionStorage.setItem("logRefresh","true"),this.collection=new v,this.collection.setLimit(h.get("membersMaxPerPage")),this.collection.setOffset(0);var n,i,o=g.getWidget().options;return o&&(n=o.sortDirectionLog,i=o.sortFieldLog),this.collection.setSortDirectionLog(n),this.collection.setSortFieldLog(i),t},search:function(e){this.collection.setOffset(0),this.collection.setQuery(e),o.mask(this.container),this.collection.fetch({onComplete:this.getPersistedData.bind(this),data:{platform:this.platform.get("id")}})},refresh:function(e){this.setOptions(e),e&&e.params&&this.collection.setParams(e.params);var t=g.getWidget().options;t.sortDirectionLog,t.sortFieldLog;t.sortDirectionLog&&t.sortFieldLog&&(delete t.sortDirectionLog,delete t.sortFieldLog),this.buildContent()},render:function(){var t=this;return this.container=e.createElement("div",{class:"logs-list-wrapper"}),o.mask(t.container),t.collection.fetch({data:{platform:t.platform.get("id")},onComplete:function(){o.unmask(t.container),t.refreshContent()},onFailure:function(){o.unmask(t.container),t.refreshContent()}}),sessionStorage.setItem("logRefresh","false"),this},getAdministratorTdTooltip:function(){this.container.getElements(".td-administrator").forEach(function(e){e.getChildren()[0].getSize().width>300&&new m({position:"top",target:e,body:e.getText()})})},refreshContent:function(){this.container.setContent(this.buildContent()),this.getAdministratorTdTooltip(),this.tooltipSort()},getPersistedData:function(){var e=this;if(o.unmask(e.container),e.collection.getMaxLimit()>0)e.refreshContent(),setTimeout(function(){e.container.getElement("input").focus()},100);else if(e.collection.isQueryEmpty())e.refreshContent();else{if(0===e.collection.size)return(new D).render();e.refreshContent()}},buildContent:function(){var e=[];return e.push(this.buildHeaderList()),e.push(this.buildTable()),e.push(this.buildPager()),e},buildHeaderList:function(){return this.headerList=new E({collection:this.collection,searchLabel:e.i18n("Search logs by keyword"),searchLog:!0,isSearchOpen:""!==this.collection.getQuery()&&null!==this.collection.getQuery(),iconBarConfig:{items:[{fonticon:"filter"+(!this.withLicenses||this.configuration||this.legal||this.membersRoles||this.today||this.yesterday||this.thisweek||this.lastWeek||this.thisMonth||this.lastMonth?" item-active":""),text:e.i18n("Filter logs"),name:"filter-logs",content:{type:"dropdownmenu",options:{multiSelect:!0,items:this._buildFilterLogsItems(),events:{onClick:this._manageSelectionFilter.bind(this)}}}}]},events:{search:this.search.bind(this)}}),this.headerList.render()},_buildFilterLogsItems:function(){var t=[{text:e.i18n("Category"),className:"header",selectable:!0}];return t.push({text:e.i18n("Configuration"),action:"select-configuration",selectable:!0,selected:this.configuration}),t.push({text:e.i18n("Legal"),action:"select-legal",selectable:!0,selected:this.legal}),t.push({text:e.i18n("Members & Roles"),action:"select-members-roles",selectable:!0,selected:this.membersRoles}),t.push({className:"divider"}),t.push({text:e.i18n("Date range"),className:"header",selectable:!0}),t.push({text:e.i18n("Today"),action:"select-today",selectable:!0,selected:this.today}),t.push({text:e.i18n("Yesterday"),action:"select-yesterday",selectable:!0,selected:this.yesterday}),t.push({text:e.i18n("This week"),action:"select-this-week",selectable:!0,selected:this.thisWeek}),t.push({text:e.i18n("Last week"),action:"select-last-week",selectable:!0,selected:this.lastWeek}),t.push({text:e.i18n("This month"),action:"select-this-month",selectable:!0,selected:this.thisMonth}),t.push({text:e.i18n("Last month"),action:"select-last-month",selectable:!0,selected:this.lastMonth}),t},tooltipSort:function(){var t=this.getContent().getElements(".fonticon-sort-column.sort-cursor");t&&t.forEach(function(t){new m({position:"top",target:t,body:t.hasClassName("fonticon-expand-down")?e.i18n("Descending Order"):t.hasClassName("fonticon-expand-up")?e.i18n("Ascending Order"):""})})},_manageSelectionFilter:function(e,t){var n=this,i=this.collection.options.data.category,s=this.collection.options.data.date,a=[],l=[];if(sessionStorage.setItem("logRefresh","false"),void 0===i&&void 0===s||(a.push(i),l.push(s),i.includes(",")&&(a=i.split(",")),s.includes(",")&&(l=s.split(",")),a.indexOf("")>-1&&a.splice(a.indexOf(""),1),l.indexOf("")>-1&&l.splice(l.indexOf(""),1)),"select-configuration"!==t.action)a.indexOf("configuration")>-1?this.configuration=!0:this.configuration=!1;else if("select-configuration"===t.action)if(a.indexOf("configuration")>-1){var r=a.indexOf("configuration");a.splice(r,1),this.configuration=!1}else a.push("configuration"),this.configuration=!0;if("select-legal"!==t.action)a.indexOf("legal")>-1?this.legal=!0:this.legal=!1;else if("select-legal"===t.action)if(a.indexOf("legal")>-1){r=a.indexOf("legal");a.splice(r,1),this.legal=!1}else a.push("legal"),this.legal=!0;if("select-members-roles"!==t.action)a.indexOf("memberroles")>-1?this.membersRoles=!0:this.membersRoles=!1;else if("select-members-roles"===t.action)if(a.indexOf("memberroles")>-1){r=a.indexOf("memberroles");a.splice(r,1),this.membersRoles=!1}else a.push("memberroles"),this.membersRoles=!0;if("select-today"!==t.action)l.indexOf("today")>-1?this.today=!0:this.today=!1;else if("select-today"===t.action)if(l.indexOf("today")>-1){r=l.indexOf("today");l.splice(r,1),this.today=!1}else l.push("today"),this.today=!0;if("select-yesterday"!==t.action)l.indexOf("yesterday")>-1?this.yesterday=!0:this.yesterday=!1;else if("select-yesterday"===t.action)if(l.indexOf("yesterday")>-1){r=l.indexOf("yesterday");l.splice(r,1),this.yesterday=!1}else l.push("yesterday"),this.yesterday=!0;if("select-this-week"!==t.action)l.indexOf("thisWeek")>-1?this.thisWeek=!0:this.thisWeek=!1;else if("select-this-week"===t.action)if(l.indexOf("thisWeek")>-1){r=l.indexOf("thisWeek");l.splice(r,1),this.thisWeek=!1}else l.push("thisWeek"),this.thisWeek=!0;if("select-last-week"!==t.action)l.indexOf("lastWeek")>-1?this.lastWeek=!0:this.lastWeek=!1;else if("select-last-week"===t.action)if(l.indexOf("lastWeek")>-1){r=l.indexOf("lastWeek");l.splice(r,1),this.lastWeek=!1}else l.push("lastWeek"),this.lastWeek=!0;if("select-this-month"!==t.action)l.indexOf("thisMonth")>-1?this.thisMonth=!0:this.thisMonth=!1;else if("select-this-month"===t.action)if(l.indexOf("thisMonth")>-1){r=l.indexOf("thisMonth");l.splice(r,1),this.thisMonth=!1}else l.push("thisMonth"),this.thisMonth=!0;if("select-last-month"!==t.action)l.indexOf("lastMonth")>-1?this.lastMonth=!0:this.lastMonth=!1;else if("select-last-month"===t.action)if(l.indexOf("lastMonth")>-1){r=l.indexOf("lastMonth");l.splice(r,1),this.lastMonth=!1}else l.push("lastMonth"),this.lastMonth=!0;"select-category"===t.action||"select-legal"===t.action||"select-members-roles"===t.action||"select-today"===t.action||"select-yesterday"===t.action||"select-this-week"===t.action||"select-last-week"===t.action||t.action,this.withLicenses=!0;var c=a.join(","),m=l.join(",");(c||""===c)&&this.collection.setCategory(c),(m||""===m)&&this.collection.setDate(m),o.mask(n.container),this.collection.fetch({data:{platform:n.platform.get("id")},onComplete:function(){o.unmask(n.container),n.refreshContent()},onFailure:function(){o.unmask(n.container),n.refreshContent()}})},displaySort:function(e,t){var n=this,i=e.target,s=g.getWidget().options,a=this.collection.options.data.sort_direction_log,l=t.getElement("[data-action]").getAttribute("data-action");i.hasClassName("fonticon-expand-up")||t.children[1].hasClassName("fonticon-expand-up")?a="desc":(i.hasClassName("fonticon-expand-down")||t.children[1].hasClassName("fonticon-expand-down"))&&(a="asc"),s.sortFieldLog=l,s.sortDirectionLog=a,n.collection.setSortDirectionLog(a),n.collection.setSortFieldLog(l),o.mask(n.container),n.collection.fetch({data:{platform:n.platform.get("id")},onComplete:function(){o.unmask(n.container),n.refreshContent()},onFailure:function(){o.unmask(n.container),n.refreshContent()}})},sortColumn:function(e,t,n,i){var o="";return"datetime"===n?o="col-lg-2 col-md-2 col-sm-2 col-xs-3":"category"===n?o="col-lg-2 col-md-2 col-sm-2 col-xs-4":"admin"===n&&(o="col-lg-2 col-md-2 col-sm-2 col-xs-4"),{tag:"td",class:o,html:[{tag:"td",text:e,"data-action":n,class:"sort-cursor td-sort",events:{click:this.sortColumnsAction.bind(this)}},{tag:"i","data-action":i,class:"fonticon "+this.getSortFonticon(n,i)+" fonticon-sort-column sort-cursor float members",events:{click:this.sortColumnsAction.bind(this)}}]}},sortColumnsAction:function(e){var t=e.target,n=t;0===t.getElementsByTagName("td").length&&(n=t.getParent()),this.displaySort(e,n)},getSortFonticon:function(e,t,n){var i=g.getWidget().options,o=this.getContent().getElements(".td-sort");if(i)if(i.sortDirectionLog){var s;if(i.sortFieldLog!==e)for(s="datetime"===e?0:"admin"===e?1:"category"===e?2:0;s<o.length;s++){if(o[s].nextSibling.hasClassName("blue")&&o[s].nextSibling.removeClassName("blue"),o[s].nextSibling.hasClassName("fonticon-expand-down"))return"fonticon-expand-down";if(o[s].nextSibling.hasClassName("fonticon-expand-up"))return"fonticon-expand-up";if("admin"===e||"category"===e)return"fonticon-expand-up";if("datetime"===e)return o[1].nextElementSibling.hasClassName("blue")||o[2].nextElementSibling.hasClassName("blue")?"fonticon-expand-down date":"fonticon-expand-down blue date"}else if(i.sortFieldLog===e){if("desc"===i.sortDirectionLog)return"fonticon-expand-down blue";if("asc"===i.sortDirectionLog)return"fonticon-expand-up blue"}}else{if("admin"===e||"category"===e)return"fonticon-expand-up";if("datetime"===e)return"fonticon-expand-down blue date"}},buildTable:function(){var t=this.collection.map(function(e){return new P({model:e}).render()});return[{tag:"table",class:"table",html:[{tag:"thead",html:[g.isMobileDevice()?"":{tag:"td",styles:{width:"1px"}},this.sortColumn(e.i18n("Date / Time"),!1,"datetime","datetime"),this.sortColumn(e.i18n("Administrator"),!1,"admin","admin"),this.sortColumn(e.i18n("Category"),!1,"category","category"),{tag:"td",class:"col-lg-6 col-md-6 col-sm-6 col-xs-1",text:e.i18n("Message")}]},{tag:"tbody",html:t}]}]},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?this.pager=new n({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){o.mask(e.container),e.collection.setOffset(t),e.collection.fetch({onComplete:e.getPersistedData.bind(e),data:{platform:e.platform.get("id")}})}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content}})}),define("DS/PlatformManagement/Views/LogsRowView",["UWA/Core","UWA/Class/View","UWA/Utils","DS/i3DXCompassCore/Utils","DS/PlatformManagement/Utils","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","UWA/Event","DS/PlatformManagement/Views/LogsView"],function(e,t,n,i,o,s,a,l,r,c){"use strict";return t.extend({tagName:"tr",setup:function(){return this.firstRender=!0,this._parent.apply(this,arguments)},render:function(){return this.container.setContent(this.createContent()),this},getDate:function(){return this.model.get("date")},getTime:function(){return this.model.get("time")},getAdministrator:function(){return this.model.get("administrator")},getCategory:function(){var t=this.model.get("category");return"MEMBERS_AND_ROLES"===t?{tag:"td",html:[{class:"badge-default membersRoles",tag:"span",html:{class:"badge-content",tag:"span",text:e.i18n("Members & Roles")}}]}:"CONFIGURATION"===t?{tag:"td",html:[{class:"badge-warning configuration",tag:"span",html:{class:"badge-content",tag:"span",text:e.i18n("Configuration")}}]}:"LEGAL"===t?{tag:"td",html:[{class:"badge-primary legal",tag:"span",html:{class:"badge-content",tag:"span",text:e.i18n("Legal")}}]}:void 0},getMessage:function(){var t=this.model._attributes.messageContent,n=this.model.get("messageTemplate"),i=n.split(/\{[0-9]+\}/),o=[],s=n.split(":");if(n.indexOf("Administrator activates:")>-1||n.indexOf("Administrator deactivates:")>-1||n.indexOf("Administrator activates option:")>-1||n.indexOf("Administrator deactivates option:")>-1){var a=e.createElement("span",{text:s[0]+": "}),r=e.createElement("span",{html:{tag:"i",text:s[1]}});o.push(a),o.push(r)}else if(0!==t.length)for(var c=0;c<t.length;c++){var m=e.createElement("span",{text:i[c]}),d=e.createElement("span",{html:{tag:"i",text:t[c].text}});o.push(m),o.push(d),t.length<i.length&&c+1===t.length&&o.push(e.createElement("span",{text:i[c+1]})),t[c].tooltip&&new l({position:"top",target:d,body:t[c].tooltip})}else o.push(n);return o},createContent:function(){var t=e.createElement("span",{class:"fonticon fonticon-info visible-xs"});return o.isMobileDevice()?t&&new l({position:"left",trigger:"click touch",target:t,body:this.getMessage()}):t&&new l({position:"left",target:t,body:this.getMessage()}),[o.isMobileDevice()?"":{tag:"td"},{tag:"td",html:[{tag:"span",text:this.getDate()+" "},{tag:"span",text:" "+this.getTime()}]},{tag:"td",class:"td-administrator",html:[{tag:"span",text:this.getAdministrator()}]},this.getCategory(),{tag:"td",html:[{tag:"span",class:"hidden-xs",html:this.getMessage()},{tag:"span",html:t}]}]}})}),define("DS/PlatformManagement/Widgets/MembersRoles",["UWA/Core","UWA/Class","UWA/Class/Model","DS/UIKIT/Mask","DS/UIKIT/Alert","DS/W3DXComponents/IdCard","DS/W3DXComponents/Views/Layout/ScrollView","DS/W3DXComponents/Skeleton","DS/PlatformManagement/Model/PlatformModel","DS/PlatformManagementComponents/Collection/Platform","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/Notifications","DS/PlatformManagement/Modal/ImportReport","DS/PlatformManagement/Views/FacetMembers","DS/PlatformManagement/Views/ConfigureMembersInvitations","DS/PlatformManagement/Views/ConfigureNetworkInstallation","DS/PlatformManagement/Views/LogsView","DS/PlatformManagement/Modal/InviteMember","DS/PlatformManagement/Modal/CustomRole","DS/PlatformManagement/Modal/ThirdPartyApps","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Model/AppModel","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Utils/SearchManager","DS/PlatformManagement/Utils/TaggerManager","DS/PlatformManagement/Model/I18nModel","DS/PlatformManagement/Modal/SubscriptionErrorModal","DS/i3DXCompassCore/RequestOptions","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXCompassPlatformServices/i3DXCompassRegistryClient","DS/i3DXCompassServices/i3DXCompassServices","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassCore/Csrf","DS/PlatformManagement/CreditAndTokenList","DS/PlatformManagement/BusinessExperienceList","DS/i3DXCompassCore/Collection/i3DXCompassCollection","DS/PlatformManagement/Collection/NotificationCollection","DS/PlatformManagement/Collection/PaginatedCollection","DS/PlatformManagement/UsageTracker"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M,k,I,T,A,U,L,N,_,F,R,O,W){"use strict";var V,B=null,G=_.extend({url:"platform/list",model:r,parse:function(e){return e.platforms}}),q=new _([{key:"granted-roles",value:"facet-members"},{key:"/invite-grant-roles",value:"facet-members"},{key:"roles-expire-soon",value:"facet-members"},{key:"pending",value:"facet-members"},{key:"capacity-almost-reached",value:"facet-members"},{key:"/manage-requests",value:"facet-notification"},{key:"waiting-requests",value:"facet-notification"},{key:"/import-members",value:"facet-import"},{key:"/configure-members-invitations",value:"facet-configure-members-invitations"},{key:"/configure-apps-installation",value:"facet-configure-network-installation"},{key:"/logs",value:"facet-logs"}]);return t.extend({cache:null,toGrantCollection:null,_isInitialized:!1,platform:null,idCard:null,init:function(e){var t=this;return window.parent.location.hash=this.newLocationHash(""),V=e.widget,this.collection=null,this.invalidateCache(),V.addEvent("onUpdateValue",function(e,n){var i,o,s=t.collection._models,a=function(){var e=!1;return s.forEach(function(t){if(t.get("platform"))return e=t.get("id"),!0}),e};this.data&&this.data.advancedMode&&("x3dPlatformId"===e||"tenantPlatform"===e)&&n&&(i=n,o=!1,s.forEach(function(e){i!==e.get("id")||e.get("platform")||(o=!0)}),o)?B={x3dPlatformId:a(),tenantPlatform:n}:this.data&&"advancedMode"===e&&(B=this.data.advancedMode?{tenantPlatform:null}:{x3dPlatformId:a(),tenantPlatform:null})}),V.addEvent("endEdit",this.endEditfunction.bind(this)),A.subscribe("PlatformManagement.refresh",function(e){e!==V.id&&V.dispatchEvent("onLoad")}),A.subscribe("PlatformManagement.navigate",function(e){t.onViewChangeMaximised(),this.idCard.selectFacet(t.getSelectedFacetFromUrl()),this._activateFilter(e)}.bind(this)),this._parent(e)},_activateFilter:function(e){-1!==e.indexOf("pending")?(-1!==e.indexOf("dashboard")&&sessionStorage.setItem("refresh-tagger",!0),P.navigatePendingInvitations()):-1!==e.indexOf("capacity-almost-reached")?P.navigateCapacityAlmostReached():-1!==e.indexOf("granted-roles")?P.navigateGrantedRoles():-1!==e.indexOf("roles-expire-soon")&&P.navigateExpireSoon()},checkSessionStorage:function(){var e=window.parent.location.hash;this.onViewChangeMaximised(),this._activateFilter(e)},newLocationHash:function(e){var t,n=window.parent.location.hash,i=n.split("/tab:Members")[1],o=n.split("/tab:")[1];return void 0===i&&(o?""===o?i="/"+o.split("/")[1]:(t="/tab:"+o.split("/")[0],i=n.split(t)[1]):i=o),""===i?n=n.concat("/invite-grant-roles"):e&&(n=n.replace(i,e)),n},getSelectedFacetFromUrl:function(){var e=window.parent.location.hash,t=q.find(function(t){return-1!==e.indexOf(t.get("key"))}),n=0;return this.idCard.options.facets().forEach(function(e,i){t&&t.get("value")===e.id&&(n=i)}),n},invalidateCache:function(){this.cache=[]},onBeforeLoad:function(){var t,n=this;m.setWidget(V),m.setLang(V.lang),V.body.addClassName("members-roles"),V.body.addClassName("platform-management-2"),m.isLightweight()&&V.body.addClassName("lightweight"),t=m.getLang(),M.setupLanguage(t),U.getTokenCSRF(),w.fetch({onComplete:function(){"en"!==t?(new D).fetch({onComplete:function(t,i){e.i18n(i),n.initPreferences()},onFailure:function(){n.initPreferences()}}):n.initPreferences()}})},getPreferenceValue:function(t){return e.is(V.getValue(t))?V.getValue(t):w.get(t)},_isAdvancedMode:function(){return"true"===this.getPreferenceValue("advancedMode")||!0===this.getPreferenceValue("advancedMode")},initPreferences:function(){var e=this;i.mask(V.body),e.collection=new G({includeWu:this._isAdvancedMode(),lang:m.getLang()}),this._isAdvancedMode()?e.collection.fetch({onComplete:e.onPlatformFetch.bind(e)}):k.getUser({onComplete:function(t){var n=t.platforms;n&&n.length>0&&(n=n.filter(function(e){return"admin"===e.role})),k.getPlatformServices({onComplete:function(t){var i=[];n.forEach(function(e){var n=t.detect(function(t){return t.platformId===e.id});n&&i.push({id:n.platformId,displayName:n.displayName})}),e.collection.set(i),e.onPlatformFetch()}})}})},onPlatformFetch:function(){var t=this,n=[],s={},a=this.collection;if(!e.is(this.getCurrentPlatform()))return new o({visible:!0,messages:[{message:e.i18n("You have no access to this resource"),className:"error"}]}).inject(V.body.getElement("div")),void i.unmask(V.body);V.setTitle(""),m.setCurrentPlatform(this.getCurrentPlatform()),a.forEach(function(e){n.push({label:e.get("displayName")||e.get("name"),value:e.get("id"),id:e.get("id")})}),a.size()>1&&V.addPreference({type:V.getValue("tenantPlatform")?"hidden":"list",id:"x3dPlatformId",name:"x3dPlatformId",label:e.i18n("3DExperience platform"),defaultValue:V.getValue("tenantPlatform")||V.getValue("x3dPlatformId"),options:n}),V.getValue("tenantPlatform")&&V.addPreference({type:"list",id:"tenantPlatform",name:"tenantPlatform",label:e.i18n("3DExperience platform"),defaultValue:V.getValue("tenantPlatform"),options:n}),V.addPreference({type:"hidden",id:"displayMode",name:"displayMode",label:e.i18n("Display layout"),defaultValue:this.getPreferenceValue("displayMode")}),V.addPreference({type:"boolean",id:"membersDisplayPicture",name:"membersDisplayPicture",label:e.i18n("Display Picture"),defaultValue:this.getPreferenceValue("membersDisplayPicture")}),V.addPreference({type:"list",id:"membersSortField",name:"membersSortField",label:e.i18n("Sort by"),defaultValue:this.getPreferenceValue("membersSortField"),options:[{label:e.i18n("First Name"),value:"First Name"},{label:e.i18n("Last Name"),value:"Last Name"},{label:e.i18n("Email"),value:"Email Address"}]}),V.addPreference({type:"list",id:"membersSortDirection",name:"membersSortDirection",label:e.i18n("Sort Direction"),defaultValue:this.getPreferenceValue("membersSortDirection"),options:[{label:e.i18n("A=>Z"),value:"asc"},{label:e.i18n("Z=>A"),value:"desc"}]}),V.addPreference({type:"list",id:"membersMaxPerPage",name:"membersMaxPerPage",label:e.i18n("Number of results per page"),defaultValue:this.getPreferenceValue("membersMaxPerPage"),options:[{value:"10",label:"10",id:"10"},{value:"25",label:"25"},{value:"50",label:"50"}]}),V.addPreference({type:t.getCurrentPlatform().isOnPremise()?"hidden":"boolean",id:"advancedMode",name:"advancedMode",label:e.i18n("Allow granting roles without granting access to any platform"),defaultValue:this.getPreferenceValue("advancedMode")}),V.getPreferences().forEach(function(e){s[e.name]=e.value}),s.processesMaxPerPage=this.getPreferenceValue("membersMaxPerPage"),s.processesSortDirection=this.getPreferenceValue("membersSortDirection"),w.set(s),this._isAdvancedMode()?this.onLoad():T.getServiceUrl({platformId:t.platform.get("id"),serviceName:"3DSwym",onComplete:function(e){t.platform.set("swym",e),t.platform.fetch({data:{id:t.platform.get("id")},onComplete:t.onLoad.bind(t)})}})},getFacetMemberView:function(){return this.getFacet("facet-members").view},getFacetLogsView:function(){return this.getFacet("facet-logs").view},setTopBar:function(t){var n=this,i=function(){n.action&&n.action.elements&&n.action.elements.container&&n.action.elements.container.isVisible&&!n.action.elements.container.masked&&n.action.destroy()},o=n.getCurrentPlatform(),s=new t({label:e.i18n("Members"),onExecute:function(){i(),n.action=new C({platform:o,hasApp:!0,onAdded:function(){A.publish("PlatformManagement.refresh",V.id),n.getFacetMemberView().memberList.refresh()}})}}),a=new t({label:e.i18n("Custom Role"),onExecute:function(){i(),n.action=new v({model:new S,platform:o,hasApp:!0,onAdded:function(){A.publish("PlatformManagement.refresh",V.id),n.getFacetMemberView().processList.refresh()}}).show()}}),l=new t({label:e.i18n("Additional Apps"),onExecute:function(){i(),n.action=new b({platform:o,model:new y,onAdded:function(){A.publish("PlatformManagement.refresh",V.id),n.getFacetMemberView().appsList.refresh()}})}}),r=[];o.get("platform")&&(r.push(s),r.push(a),r.push(l)),n.topBarProxy.setContent({add:r,home:[]})},_initTopBar:function(){var e=this,t={id:V.id};require(["DS/TopBarProxy/TopBarProxy","DS/TopBarProxy/MenuItem"],function(n,i){e.topBarProxy=new n(t),e.setTopBar(i)})},_initSearch:function(){new x(V).register()},_initTagger:function(){P.setup(V,this.getCurrentPlatform())},onLoad:function(){if(this._isInitialized||(this._initTopBar(),this._initTagger(),this._initSearch(),this._isInitialized=!0),this.getCurrentPlatform().hasError())new E({platform:this.getCurrentPlatform()}).show();else{this.idCard=this.buildIdCard(),i.unmask(V.body),this.invalidateCache();var e=this.idCard.options.facets().map(function(e){return{class:"id-card-content","data-facet-id":e.id}});V.setBody([this.idCard,e]),this.idCard.selectFacet(this.getSelectedFacetFromUrl()),this._addNotificationBadge(this.getCurrentPlatform().get("unread")),V.setTitle("")}},_addNotificationBadge:function(t){var n=V.body.getElements(".facets-list .facet")[1];n&&(n.setStyle("position","relative"),e.createElement("div",{class:"badge-notification",html:{tag:"span",text:t,class:0!==t?"badge":"badge hidden",styles:{width:t>=10&&t<=99?"18px":t>99?"24px":"12px"}}}).inject(n))},_updateNotificationBadge:function(e){var t,n=V.body.getElements(".facets-list .facet")[1];n&&(t=n.getElement(".badge"))&&(e>0?(t.removeClassName("hidden"),t.setText(e),e>=10&&e<=99?t.setStyle("width","18px"):e>99&&t.setStyle("width","24px")):t.addClassName("hidden"))},onRefresh:function(){this.initPreferences()},onUpdateValue:function(e,t,n){console.log("onUpdateValue ==== "),console.log(e,t,n),this.data&&this.data.tenantPlatform&&"x3dPlatformId"===e&&t&&(this.data.tenantPlatform=t)},endEditfunction:function(){this.platform=null,B&&(m.getWidget().setValues(B),B=null)},onResize:function(){},getCurrentPlatform:function(){var e,t=V.getValue("tenantPlatform")&&""!==V.getValue("tenantPlatform")?V.getValue("tenantPlatform"):V.getValue("x3dPlatformId");return this.platform||(t&&""!==t&&(e=this.collection.get(t)),this.platform=e?new r(e.toJSON()):null),this.platform},getIdCardContent:function(t){var n=t||this.idCard._getFacet(this.idCard.getSelectedFacet()).id;return V.body.getElement(e.String.format('.id-card-content[data-facet-id="{0}"]',n))},buildIdCard:function(){var t=this;return new s({model:new n,actions:[],facets:function(){var n=[{id:"facet-members",text:e.i18n("Invite & Grant Roles"),icon:"users",handler:function(){t.selectedFacet="facet-members",t.contentAndLocationHash("facet-members","/invite-grant-roles"),t.poolUsageTracker({pageTitle:"members"})}}];return!0===t.getCurrentPlatform().get("platform")&&(n.push({id:"facet-notification",text:e.i18n("Manage Requests"),icon:"bell",handler:function(){t.selectedFacet="facet-notification",t._maskAndSwitchToFacet(),t.platform.fetch({data:{id:t.getCurrentPlatform().id},onComplete:function(){i.unmask(t.getIdCardContent("facet-notification")),t.contentAndLocationHash("facet-notification","/manage-requests","waiting-requests"),V.setOption("platform",t.getCurrentPlatform())}}),t.poolUsageTracker({pageTitle:"notification"})}}),n.push({id:"facet-import",text:e.i18n("Import Members"),icon:"upload",handler:function(){t.selectedFacet="facet-import",t.contentAndLocationHash("facet-import","/import-members"),t.poolUsageTracker({pageTitle:"import_members"})}})),m.isLightweight()||(t.getCurrentPlatform().isOnPremise()||!0!==t.getCurrentPlatform().get("platform")||n.push({id:"facet-configure-members-invitations",text:e.i18n("Configure Members Options"),icon:"user-cog",handler:function(){t.selectedFacet="facet-configure-members-invitations",t._maskAndSwitchToFacet(),t.platform.fetch({data:{id:t.getCurrentPlatform().id},onComplete:function(){i.unmask(t.getIdCardContent("facet-configure-members-invitations")),t.contentAndLocationHash("facet-configure-members-invitations","/configure-members-invitations")}}),t.poolUsageTracker({pageTitle:"configure_members_invitations"})}}),!0===t.getCurrentPlatform().get("platform")&&n.push({id:"facet-configure-network-installation",text:e.i18n("Configure Apps Installation"),icon:"cog",handler:function(){t.selectedFacet="facet-configure-network-installation",t._maskAndSwitchToFacet(),t.platform.fetch({data:{id:t.getCurrentPlatform().id},onComplete:function(){i.unmask(t.getIdCardContent("facet-configure-network-installation")),t.contentAndLocationHash("facet-configure-network-installation","/configure-apps-installation")}}),t.poolUsageTracker({pageTitle:"configure_network_installation"})}})),m.isLightweight()||!0===t.getCurrentPlatform().get("platform")&&n.push({id:"facet-logs",text:e.i18n("Logs"),icon:"doc-log",handler:function(){t.selectedFacet="facet-logs",t._maskAndSwitchToFacet(),i.unmask(t.getIdCardContent("facet-logs")),t.contentAndLocationHash("facet-logs","/logs")}}),n}})},poolUsageTracker:function(e){O.trackPageView({pageTitle:e.pageTitle,appId:"X3DOPMR_AP",tenant:this.platform&&this.platform.get?this.platform.get("id"):""})},_maskAndSwitchToFacet:function(){this._switchToFacet(),i.mask(this.getIdCardContent())},_switchToFacet:function(){V.body.getElements(".id-card-content").invoke("hide"),this.getIdCardContent().show()},contentAndLocationHash:function(e,t){console.log("facet",e),console.log("getSelectedFacet",this.idCard.getSelectedFacet()),this.getIdCardContent(e).setContent(this.getFacet(e)),-1===window.parent.location.hash.indexOf(t)&&(window.parent.location.hash=this.newLocationHash(t))},getFacet:function(t){var n,i=this.cache[t];if(this._switchToFacet(),e.is(i)&&"facet-notification"!==t)"facet-logs"===t&&(this.buildIdCard(),this.cache[t]=new a({useInfiniteScroll:!1,usePullToRefresh:!1,orientation:"vertical",view:new f({platform:this.platform,model:this.model,getScrollView:function(){return this.cache["facet-logs"]}.bind(this)})}).render(),i=this.cache[t],sessionStorage.removeItem("logRefresh"));else{switch(t){case"facet-members":this.cache[t]=new a({useInfiniteScroll:!1,usePullToRefresh:!1,orientation:"vertical",view:new h({platform:this.getCurrentPlatform(),taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache["facet-members"]}.bind(this),events:{onSwitchViewLayout:this.onSwitchViewLayout.bind(this)}})}).render(),this.checkSessionStorage();break;case"facet-notification":n=new d({platform:this.platform,_widgetHeight:"calc(100% - 200px)",_updateNotificationBadge:this._updateNotificationBadge.bind(this),collection:new R}),this.cache[t]=n.getContent();break;case"facet-import":this.cache[t]=new u({platform:this.getCurrentPlatform(),_widgetHeight:"calc(100% - 130px)"}).render();break;case"facet-configure-members-invitations":this.cache[t]=new a({useInfiniteScroll:!1,usePullToRefresh:!1,orientation:"vertical",view:new g({platform:this.platform,taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache["facet-configure-members-invitations"]}.bind(this)})}).render();break;case"facet-configure-network-installation":this.cache[t]=new a({useInfiniteScroll:!1,usePullToRefresh:!1,orientation:"vertical",view:new p({platform:this.platform,taggerProxy:this.taggerProxy,getScrollView:function(){return this.cache["facet-configure-network-installation"]}.bind(this)})}).render();break;case"facet-logs":this.cache[t]=new a({useInfiniteScroll:!1,usePullToRefresh:!1,orientation:"vertical",view:new f({platform:this.platform,model:this.model,getScrollView:function(){return this.cache["facet-logs"]}.bind(this)})}).render()}i=this.cache[t]}return i},onSwitchViewLayout:function(){this.getFacetMemberView().memberList.updateLayout(),this.getFacetMemberView().processList.updateLayout(),this.getFacetMemberView().businessExperienceList&&this.getFacetMemberView().businessExperienceList.updateLayout(),this.getFacetMemberView().appsList&&this.getFacetMemberView().appsList.updateLayout(),this.getFacetMemberView().creditAndTokenList&&this.getFacetMemberView().creditAndTokenList.updateLayout()},onSearch:function(e){e&&(e=e.toLowerCase()),this.getFacetMemberView().memberList.search(e),this.getFacetMemberView().processList.search(e),this.getFacetMemberView().businessExperienceList&&this.getFacetMemberView().businessExperienceList.search(e),this.getFacetMemberView().appsList&&this.getFacetMemberView().appsList.search(e),this.getFacetMemberView().creditAndTokenList&&this.getFacetMemberView().creditAndTokenList.search(e)},onResetSearch:function(){this.collection&&this.onSearch(null)},onViewChange:function(){},onViewChangeMaximised:function(){V.readOnly&&"maximized"!==(V._view||{}).type&&(V.requestView("maximized"),setTimeout(function(){"maximized"!==(V._view||{}).type&&V.requestView("maximized")},300))}})}),define("DS/PlatformManagement/MemberList",["UWA/Core","UWA/Class/View","UWA/Class/Model","UWA/Controls/Pager","DS/UIKIT/Touch","DS/UIKIT/Mask","DS/UIKIT/Input/Button","DS/UIKIT/SuperModal","DS/UIKIT/Modal","DS/i3DXCompass/Controls/IframeLoader","DS/UIKIT/Iconbar","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Input/Toggle","DS/W3DXComponents/Collections/ActionsCollection","DS/PlatformAPI/PlatformAPI","DS/PlatformManagement/Utils","DS/PlatformManagement/Model/PreferencesModel","DS/PlatformManagement/Views/UserView","DS/PlatformManagement/Views/TileAddView","DS/PlatformManagement/Modal/MemberDetails2","DS/PlatformManagement/Modal/InviteMember","DS/PlatformManagement/Collection/MemberCollection","DS/PlatformManagement/Utils/SpriteManager","DS/PlatformManagement/Utils/TaggerManager","DS/PlatformManagement/Model/UserRightModel","DS/PlatformManagement/Model/ExportModel","DS/PlatformManagement/Views/UserRowView","DS/PlatformManagement/Widgets/MembersRoles","DS/PlatformManagement/Controls/Input/Text","DS/PlatformManagement/Utils/FCSManager","DS/PlatformManagement/Controls/PlatformNotify","DS/PlatformManagement/Views/EmptyView","DS/PlatformManagement/UsageTracker","UWA/Event","DS/PlatformManagement/Views/HeaderList","DS/PlatformManagement/Views/NoSearchResultView"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P,D,E,M,k,I,T,A,U,L,N,_,F){"use strict";var R="desc";return t.extend({profileUrl:null,currentUserId:p.getUser().login,forceRefreshView:!1,touchPagerEvent:null,tooltipExport:null,selectedCollection:new S,tooltipSearch:null,exportIcon:null,withLicenses:!0,setup:function(t){var n=this;this._parent(t),this.collection=new S,this.filterMembersAvailable=!1,this.withAdministrators=!1,this.withExternals=!1,this.withMembers=!1,this.buildContainer(),p.subscribe("com.ds.compass:onExportFinished",function(t){var i=n.options.platform.get("exportInfos"),o=n.content.getChildren()[0].getElement(".fonticon-export"),s=o.getParent().attributes;o.removeClassName("fonticon-export").removeClassName("in-progress-export"),o.addClassName("fonticon-download"),i.state="EOK",n.headerList.updateIconTooltip(s.id.value,e.i18n("Export finished. Click to download.")),i.fileName=t[0].fileName,i.lastModified=t[0].lastModified,A.success(e.i18n("Extraction is complete, please click the download button"))})},search:function(e){this.collection.setOffset(0),this.collection.setQuery(e),""===e&&this.getContent().getElement(".fonticon-search").removeClassName("activate"),this.refresh()},refresh:function(e){this.setOptions(e),e&&e.params&&this.collection.setParams(e.params),this.buildContainer()},setTitle:function(t){this.getBody().getElement("h5 span")&&this.getBody().getElement("h5 span").setText(e.String.format(e.i18n("Members | {0}"),t))},render:function(){this.collection.length>0?this.getBody().setContent(this.buildContent()):null===this.collection.getQuery()||this.forceRefreshView?this.getBody().setContent(this.buildContent()):(this.collection.setQuery(null),this.setTitle(e.i18n(this.collection.length)),this.elements.container.getElement(".pm-grid-container").setContent(this.buildNoResultSearch())),this.unmask(),this.forceRefreshView=!1,this.tooltipSort(),this.options.onRefresh&&this.options.onRefresh()},buildNoResultSearch:function(){var t=this;return[new F({buttonConfig:{value:e.i18n("Invite members"),icon:"user-add",className:"btn-noresult primary",events:{onClick:function(){t.modal=new y({hasApp:f.getDocument().getElements(".platform-management-2 .tp-apps").length>0,platform:t.options.platform,onAdded:function(){t.refresh(),t.options.processList.refresh(),p.publish("PlatformManagement.refresh",f.getWidget().id)}})}}}}).render()]},updateLayout:function(){this.getBody().getElement(".pm-grid-container").setContent(this._buildListContent()),this.tooltipSort(),this.elements.container.getElement(".invite")&&this.elements.container.getElement(".invite").setStyles({"margin-bottom":"5px"})},getPersistedData:function(e){var t=this,n=0,i=t.options.platform._attributes.locations,o=P._filter?P._filter:"",s=function(){2===++n&&(P.fetch(t.listRoles,t,i,o),t.render(),e&&f.scrollToElementInIframe(".member-list-wrapper"))};(new D).fetch({onComplete:function(e,n){t.roles=n.roles,t.listRoles=n,s()}}),P.syncFilter(t),this.collection.fetch({onComplete:function(){s()},onFailure:function(){s()}})},tooltipSort:function(){var t=this.getContent().getElements(".fonticon-sort-column.sort-cursor");t&&t.forEach(function(t){new u({position:"top",target:t,body:t.hasClassName("fonticon-expand-down")?e.i18n("Descending Order"):t.hasClassName("fonticon-expand-up")?e.i18n("Ascending Order"):""})})},getSwymUrl:function(){return""!==this.options.platform.get("swym")?this.profileUrl=this.options.platform.get("swym"):!this.profileUrl&&this.options.platform.collection?this.profileUrl=this.options.platform.collection.at(0).get("swym"):this.profileUrl="",this.profileUrl},buildContainer:function(){var t=this;this.elements.container||(this.elements.container=e.createElement("div",{class:"member-list-wrapper"}),t.elements.container.setContent({class:"empty-body"})),this.mask(),this.options.platform&&null!==this.options.platform&&C.fetch({onComplete:function(){var e,n,i=f.getWidget().options;i&&(e=i.sortDirection,n=i.sortField),t.collection.setLimit(C.get("membersMaxPerPage")),t.collection.setSortDirection(e||C.get("membersSortDirection")),t.collection.setSortField(n||C.get("membersSortField")),t.collection.setPlatform(t.options.platform.getId()),t.getPersistedData(),!0===t.filterMembersAvailable&&(t.filterMembersAvailable=!1),!0===t.withLicenses&&t.withLicenses}})},buildTag:function(e,t,n,i){var o,s={};for(o=0;o<e;o++)s[i+"-"+o]=[{object:i,sixw:"ds6w:what",field:"owner",dispValue:t}];return s},buildContent:function(){var t=[],n=this.options.platform.get("exportInfos")&&this.options.platform.get("exportInfos").state,i="";return"EIP"===n&&(i+=" in-progress-export"),"EIP"!==n&&"EOK"!==n||(i+=" export-blue"),this.headerList=new _({icon:"users",label:this.withAdministrators?e.i18n("Administrators | {0}"):this.withExternals?e.i18n("Externals | {0}"):e.i18n("Members | {0}"),collection:this.collection,searchLabel:e.i18n("Search Members"),isSearchOpen:""!==this.collection.getQuery()&&null!==this.collection.getQuery(),iconBarConfig:{items:[{fonticon:"EOK"===n?"download "+i:"export "+i,text:this.exportStatusTooltip(n),name:"export-members",handler:this._exportProcess2.bind(this)},{fonticon:"filter"+(!this.withLicenses||this.withAdministrators||this.withExternals||this.withMembers?" item-active":""),text:e.i18n("Filter members"),name:"filter-members",content:{type:"dropdownmenu",options:{items:this._buildFilterMembersItems(),events:{onClick:this._manageSelectionFilterMembers.bind(this)}}}},{fonticon:"mouse-pointer-check",text:e.i18n("Manage Selection"),name:"manage-selection",className:"select-mode",content:{type:"dropdownmenu",options:{items:this.buildItemManageSelection(),events:{onClick:this._manageSelectionFilter.bind(this)}}}},{fonticon:C.isGridLayout()?"th-list-alt":"th-list",text:C.isGridLayout()?e.i18n("List View"):e.i18n("Tiles View"),name:"switch-view",handler:this._switchView2.bind(this)}]},events:{search:this.search.bind(this)}}),t.push(this.headerList.render()),t.push({class:"pm-grid-container "+(C.isGridLayout()?"layout-grid":"layout-table"),html:this._buildListContent()}),this.initTouchPager(),t},_buildListContent:function(){var t=null;return 0===this.collection.getMaxLimit()&&(this.withAdministrators?t=e.i18n("No administrators available"):this.withExternals?t=e.i18n("No externals available"):this.withMembers&&(t=e.i18n("No members available"))),[C.isGridLayout()?this.buildTiles():this.createTableView(),t?new U({fonticon:"users",text:t}).render():null,this.buildPager()]},buildAddTile:function(){var t=this;return new b({lazyLoading:!1,model:new n({fonticon:"fonticon fonticon-user-add fix-alignement",title:e.i18n("Invite members"),action:function(){t.modal=new y({hasApp:f.getDocument().getElements(".platform-management-2 .tp-apps").length>0,hasBE:f.getDocument().getElements(".platform-management-2 .be-box").length>0,platform:t.options.platform,onAdded:function(){t.refresh(),t.options.processList.refresh(),p.publish("PlatformManagement.refresh",f.getWidget().id)}})}}),name:"platform-management",mapping:{}}).render()},membersSortDirectionUpdate:function(e){var t=this.getContent().getElements(".fonticon-sort-column"),n=f.getWidget(),i=n.options;switch(e.getText()){case"Email":i.sortField="Email Address";break;case"Last Name":i.sortField="Last Name";break;case"First Name":i.sortField="First Name"}var o=i.sortField;i.sortDirection&&i.sortDirection===R?this.displaySort("asc",o,t,n):this.displaySort(R,o,t,n)},displaySort:function(e,t,n,i){f.getWidget().options.sortDirection=e,f.getWidget().options.sortField=t,n.forEach(function(e){e.removeClassName("fonticon-expand-up"),e.addClassName("fonticon-expand-down"),e.addClassName("blue")}),i.dispatchEvent("onRefresh")},sortColumn:function(e,t,n){return{tag:"td","data-action":n,class:t?"hidden-xs":"",html:[{tag:"td",class:t?"td-sort sort-cursor hidden-xs":"sort-cursor td-sort",text:e,events:{click:this.sortColumnsAction.bind(this)}},{tag:"i",class:"fonticon "+this.getSortFonticon(n)+" fonticon-sort-column sort-cursor members",events:{click:this.sortColumnsAction.bind(this)}}]}},sortColumnsAction:function(e){var t=e.target,n=t;0===t.getElementsByTagName("td").length&&(n=t.getParent()),this.membersSortDirectionUpdate(n)},getSortFonticon:function(e){return f.getWidget().options.sortDirection?f.getWidget().options.sortDirection===R&&f.getWidget().options.sortField===e?"fonticon-expand-down blue":f.getWidget().options.sortDirection===R?"fonticon-expand-down":"asc"===f.getWidget().options.sortDirection&&f.getWidget().options.sortField===e?"fonticon-expand-up blue":"asc"===f.getWidget().options.sortDirection?"fonticon-expand-up":void 0:"fonticon-expand-up"},createTableView:function(){var t=this,n=new x({url:t.getSwymUrl()}),i=this.collection.map(function(i){return n.addItem(i.getSpriteItem()),n.addCache(!0===i.isContractor()?1:0),i.actions=[{id:"info",title:e.i18n("Details"),icon:"fonticon fonticon-info"}],new M({model:i,selectedCollection:t.selectedCollection,platform:t.options.platform,roles:t.roles,getSwymUrl:t.getSwymUrl.bind(t),onSelect:t.options.onSelect,onActionClick:function(e,n,o){var s=e.id;switch(o.stopPropagation(),s){case"info":t.displayInfo(i,n)}}}).render()});return this.toggleSelect=new h({className:"primary inline small-device",type:"checkbox",name:"usersTotal[]",value:"",id:"",label:"",events:{onClick:function(e){var n=this.getContent().getParent().getParent(),i=!n.hasClassName("selected"),o=t.content.getElements('[data-type="user"] input');n.setAttribute("data-type","allUsers");t.content.getElement('[data-type="allUsers"] input');e.stopPropagation(),n.toggleClassName("selected",i),this.setCheck(i),o.forEach(function(e){!0===t.toggleSelect.elements.input.checked?(e.checked=!0,e.getParent().getParent().getParent().addClassName("selected")):!1===t.toggleSelect.elements.input.checked&&(e.checked=!1,e.getParent().getParent().getParent().removeClassName("selected"))}),t.options.onSelect.call(this,n)}}}),""!==t.getSwymUrl()&&C.shouldLoadPicture()&&i.forEach(function(e,t){n.spritifyElement(e.container.getElement("img"),t)}),[new a({value:e.i18n("Invite members"),icon:"user-add",className:"primary invite",events:{onClick:function(){t.modal=new y({hasApp:f.getDocument().getElements(".platform-management-2 .tp-apps").length>0,platform:t.options.platform,onAdded:function(){t.refresh(),t.options.processList.refresh(),p.publish("PlatformManagement.refresh",f.getWidget().id)}})}}}),{tag:"table",class:"table",html:[{tag:"thead",html:[{html:[this.toggleSelect],tag:"td",styles:{width:"85px"}},this.sortColumn(e.i18n("First Name"),!1,"First Name"),this.sortColumn(e.i18n("Last Name"),!1,"Last Name"),{tag:"td",class:"hidden-xs",text:e.i18n("User rights")},this.sortColumn(e.i18n("Email"),!0,"Email Address"),{tag:"td",class:"hidden-xs hidden-sm",text:e.i18n("City")},{tag:"td",class:"hidden-xs hidden-sm",text:e.i18n("Country")},{tag:"td",class:"details",text:e.i18n("Details")}]},{tag:"tbody",html:i}]}]},buildTiles:function(){var e=[],t=this,n=(t.elements.container.getElements('[data-type="user"].selected'),new x({url:t.getSwymUrl()}));return 0===this.collection.count&&null!==this.collection.getQuery()||e.push(t.buildAddTile()),this.collection.forEach(function(i){e.push(t.buildTile(i)),n.addItem(i.getSpriteItem()),n.addCache(!0===i.isContractor()?1:0)}),""!==t.getSwymUrl()&&C.shouldLoadPicture()&&e.forEach(function(e,t){0!==t&&n.spritifyElement(e.container.getElement(".tile-header img"),t-1)}),e},_switchView2:function(t,n){n||(n=t.target.getParent(".item")||t.target),C.setLayout(C.isGridLayout()?"table":"grid"),L.switchDisplayView({appId:"X3DOPMR_AP",viewType:C.isGridLayout()?"table":"grid",tenant:this.options.platform&&this.options.platform.get?this.options.platform.get("id"):""}),this.headerList.toggleFontIcon(n.id,"fonticon-th-list-alt").toggleFontIcon(n.id,"fonticon-th-list"),this.dispatchEvent("onSwitchViewLayout"),!0===C.isGridLayout()?this.headerList.updateIconTooltip(n.id,e.i18n("List View")):this.headerList.updateIconTooltip(n.id,e.i18n("Tiles View"))},_exportProcess2:function(){var t,n=this,i=n.options.platform,o=i.getId();if(L.exportMembers({tenant:o}),"EIP"!==(t=i.get("exportInfos").state))if("EOK"!==t)var s=new a({class:"exportDownloadIt",icon:"download",events:{onClick:function(){n.downloadExportFile(i,c)}}}),l=e.createElement("div",{html:[{tag:"p",text:e.String.format(e.i18n("This operation generate a file containing the list of members as well as their roles. Action will be executed in background and could take some time depending on the volume to be exported."))},{tag:"ul",class:"modal-bullets",html:[{tag:"li",text:e.String.format(e.i18n("Number of members: {0}"),n.collection.count)},{tag:"li",text:e.String.format(e.i18n("Name of platform: {0}"),i.get("name")||i.get("displayName"))}]},i.get("exportInfos").fileName?{html:[{tag:"span",class:"exportDownloadDate",text:e.String.format(e.i18n("Last export file was generated on {0}."),i.get("exportInfos").lastModified)},s]}:{}]}),c=new r({closable:!0,visible:!0,events:{onHide:function(){c.destroy()}},header:"<h4>"+e.String.format(e.i18n("Export members"))+"</h4>",body:l,footer:[e.createElement("button",{class:"btn btn-primary",text:e.i18n("Export"),events:{click:function(){var t=n.getContent().getElement(".fonticon-export"),s=t.getParent().getAttribute("id");(new E).save({platform:o},{patch:!0,onComplete:function(o,a){t.addClassName("users"),t.getParent().addClassName("item-active"),n.headerList.addFontIcon(s,"in-progress-export").addFontIcon(s,"export-blue"),i.get("exportInfos").state="EIP",n.headerList.updateIconTooltip(s,e.i18n("Export in progress.")),A.info(e.i18n("Export in progress."))},onFailure:function(t,i){n.headerList.updateIconTooltip(s,e.i18n("The export failed, please try again.")),A.alert(i.message)}}),c.hide()}}}),e.createElement("button",{class:"btn btn-default",text:e.i18n("Cancel"),events:{click:function(){c.hide()}}})]}).inject(document.body);else new E({id:1}).save({platform:o},{patch:!0,onComplete:function(t,o){var s=n.getContent().getElement(".fonticon-download").getParent().getAttribute("id");n.downloadExportFile(i,c),n.headerList.removeFontIcon(s,"fonticon-download").removeFontIcon(s,"export-blue").addFontIcon(s,"fonticon-export"),i.get("exportInfos").state="",n.headerList.updateIconTooltip(s,e.i18n("Export Members"))},onFailure:function(e,t){A.alert(t.message)}})},buildTile:function(t){var n,i=this,o=!0;return t.actions=new g([{id:"info",title:e.i18n("Details"),icon:"fonticon fonticon-info"}]),this.listenTo(t,{"onChange:licensed":function(){setTimeout(function(){i.options.manageCasualActivation()},1e3)}}),(n=new v({lazyLoading:!1,model:t,selectedCollection:i.selectedCollection,platform:i.options.platform,roles:this.roles,mapping:{title:function(){return this.model.getUserFullName()+(!1===this.model.get("licensed")?'<i class="fonticon fonticon-key"></i>':"")},subtitle:function(){return this.model.getCityAndCountryFullName()},image:function(){var e;return o&&""!==i.getSwymUrl()&&C.shouldLoadPicture()?(e=f.getAsset("s.gif"),o=!1):e=this.model.getProfile(C.shouldLoadPicture(),i.getSwymUrl()),e}},onSelect:i.options.onSelect,events:{onActionClick:function(e,o,s){var a=o.model.get("id");switch(s.stopPropagation(),a){case"info":i.displayInfo(t,n)}}}})).render()},displayInfo:function(e){new w({model:e,platform:this.options.platform,memberList:this,processList:this.options.processList,isBE:!0}).show()},hasMixedCasualType:function(){var e=this.getBody().getElement('.platform-management-container[data-casual]:not([data-casual="0"])'),t=this.getBody().getElement('.platform-management-container:not([data-casual="0"])');return null!==e&&null!==t},hasMixedCrossCompanyType:function(){var e=this.getBody().getElement('.platform-management-container[data-cross-company="true"]'),t=this.getBody().getElement('.platform-management-container[data-cross-company="false"]');return null!==e&&null!==t},_manageSelectionFilter:function(t,n){var i=this,o=i.elements.container.getElements('[data-type="user"] input'),s=i.collection._models;"select-all"===n.action?i.hasMixedCasualType()?new l({className:"platform-management-confirm-modal",closable:!0,renderTo:f.getDocument()}).confirm(e.i18n("You cannot select different types of casual member"),e.i18n("Information")):i.hasMixedCrossCompanyType()?new l({className:"platform-management-confirm-modal",closable:!0,renderTo:f.getDocument()}).alert(e.i18n("Different licenses cannot be selected"),e.i18n("Information")):(i.headerList.removeFontIcon(n.className,"fonticon-mouse-pointer-check").addFontIcon(n.className,"fonticon-files-check").activateIcon(n.className),i.elements.container.getElements('[data-type="user"]').invoke("addClassName","selected"),o&&(o.forEach(function(e){e.checked=!0}),s.forEach(function(e){i.selectedCollection.add(e)},i))):(i.headerList.removeFontIcon(n.className,"fonticon-files-check").addFontIcon(n.className,"fonticon-mouse-pointer-check").deactivateIcon(n.className),i.elements.container.getElements('[data-type="user"].selected').invoke("removeClassName","selected"),o&&(o.forEach(function(e){e.checked=!1}),s.forEach(function(e){i.selectedCollection.remove(e)},i)),i.options.manageCasualActivation()),i.options.onSelect()},buildItemManageSelection:function(){var t=[{action:"select-all",fonticon:"files-check",text:e.i18n("Select all")}];return t.push({action:"deselect-all",fonticon:"files-times",text:e.i18n("Unselect all")}),t},_buildFilterMembersItems:function(){var t=[{text:e.i18n("Administrator"),action:"select-administrators",selectable:!0,selected:this.withAdministrators}];return t.push({text:e.i18n("External"),action:"select-externals",selectable:!0,selected:this.withExternals}),t.push({text:e.i18n("Member"),action:"select-members",selectable:!0,selected:this.withMembers}),t},_manageSelectionFilterMembers:function(e,t){var n=this;this.filterMembersAvailable=!0,"select-administrators"===t.action?!0===this.withAdministrators?(this.collection.setParams({access:null,status:null,agreement:null,locations:null}),this.withAdministrators=!1):!1===this.withAdministrators&&(this.collection.setParams({access:1,status:null,agreement:null,locations:null}),this.withAdministrators=!0):this.withAdministrators=!1,"select-members"===t.action?!0===this.withMembers?(this.collection.setParams({access:null,status:null,agreement:null,locations:null}),this.withMembers=!1):!1===this.withMembers&&(this.collection.setParams({access:0,status:null,agreement:null,locations:null}),this.withMembers=!0):this.withMembers=!1,"select-externals"===t.action?!0===this.withExternals?(this.collection.setParams({access:null,status:null,agreement:null,locations:null}),this.withExternals=!1):!1===this.withExternals&&(this.collection.setParams({access:null,status:null,agreement:1,locations:null}),this.withExternals=!0):this.withExternals=!1,"select-members"===t.action||"select-externals"===t.action||"select-administrators"===t.action?this.withLicenses=!0:this.withLicenses=!1,P.synchroFilterAdmin(),s.mask(n.container),this.collection.fetch({data:{platform:n.options.platform.get("id")},onComplete:function(){s.unmask(n.container),n.refresh()},onFailure:function(){s.unmask(n.container),n.refresh()}})},_manageSynchroTaggerToFilterMembers:function(e){this.withLicenses=!e||!0!==e},downloadExportFile:function(t,n){var i=t.get("exportInfos").fileName;i&&""!==i&&T.fetchCheckoutTicket({data:{envid:t.getId(),file:i},onComplete:function(e,t){T.downloadFile(i,t),n&&n.hide()},onFailure:function(t,n){A.alert(e.i18n("Unable to download this csv file."))}})},exportStatusTooltip:function(t){var n;switch(t){case"EIP":n=e.i18n("Export in progress");break;case"EOK":n=e.i18n("Export finished. Click to download.");break;default:n=e.i18n("Export Members")}return n},initTouchPager:function(){var e,t=this;!this.touchPagerEvent&&t.pager&&(this.touchPagerEvent=!0,(e=new o(t.getBody())).on("swipeleft",function(){t.collection.hasNext()&&(t.collection.setOffset(t.collection.getNextOffset()),t.pager.setOffset(t.collection.getOffset()))}),e.on("swiperight",function(){t.collection.hasPrevious()&&(t.collection.setOffset(t.collection.getPreviousOffset()),t.pager.setOffset(t.collection.getOffset()))}))},buildPager:function(){var e=this,t=this.collection.getMaxLimit();return t>e.collection.getLimit()?this.pager=new i({limit:e.collection.getLimit(),offset:e.collection.getOffset(),type:1,pageLinks:10,max:t,showPageLinks:!0,length:t,events:{onOffsetChange:function(t){e.mask(),e.collection.setOffset(t),e.getPersistedData(!0)}}}):this.pager=null,this.pager},getBody:function(){return this.content||(this.content=this.elements.container),this.content},mask:function(){this.isMasked()||(s.mask(this.getBody()),this.masked=!0)},unmask:function(){this.isMasked()&&(s.unmask(this.getBody()),this.masked=!1)},isMasked:function(){return this.masked}})}),define("DS/PlatformManagement/Views/FacetMembers",["UWA/Core","UWA/Class/View","DS/PlatformManagement/MemberList","DS/PlatformManagement/ProcessList","DS/PlatformManagement/AppsList","DS/PlatformManagement/CreditAndTokenList","DS/PlatformManagement/BusinessExperienceList","DS/PlatformManagement/Utils","DS/PlatformManagement/Modal/Prereq","DS/PlatformManagement/Modal/PrereqError","DS/PlatformManagement/Collection/ProcessCollection","UWA/Controls/Drag","DS/UIKIT/SuperModal","DS/PlatformManagement/Model/ProcessModel","DS/PlatformManagement/Model/BusinessExperienceModel","DS/PlatformManagement/Collection/BusinessExperienceCollection","DS/PlatformManagement/Utils/Data","DS/PlatformManagement/Controls/Loader","DS/PlatformManagement/Controls/PlatformNotify","UWA/Event","DS/PlatformManagement/Utils/DragManager","DS/UIKIT/Tooltip","DS/PlatformManagement/Controls/ButtonFab","DS/PlatformManagement/Model/MemberDetailsModel","DS/PlatformManagement/UsageTracker"],function(e,t,n,i,o,s,a,l,r,c,m,d,u,h,g,p,f,C,v,b,w,y,S,x,P){"use strict";return t.extend({tagName:"div",grantBtn:null,className:"facet-members",toGrantCollection:new m,toGrantBECollection:new p,setup:function(e){return e.platform&&(this.platform=e.platform),e.taggerProxy&&(this.taggerProxy=e.taggerProxy),e},render:function(){var e=this;return this.processList=new i({toGrantCollection:e.toGrantCollection,onSelect:this.onSelectTile.bind(this),onRefresh:function(){e.manageButtonsState(),e.manageCasualActivation(),e.initDrag()}}),this.memberList=new n({processList:this.processList,onSelect:this.onSelectTile.bind(this),taggerProxy:this.taggerProxy,manageCasualActivation:this.manageCasualActivation.bind(this),onRefresh:function(){e.manageButtonsState(),e.manageCasualActivation(),e.initDrag()},events:{onSwitchViewLayout:function(){e.dispatchEvent("onSwitchViewLayout")}}}),this.creditAndTokenList=this.platform&&null!==this.platform&&this.platform.isPlatform()?new s({}):null,this.businessExperienceList=this.platform&&null!==this.platform&&this.platform.isPlatform()&&!this.platform.isOnPremise()?new a({platform:e.platform,toGrantBECollection:e.toGrantBECollection,onRefresh:function(){e.manageButtonsState()}}):null,this.appsList=new o({onSelect:this.onSelectTile.bind(this),onRefresh:function(){e.manageButtonsState(),e.initDrag()}}),this.memberList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform}),this.processList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform}),this.appsList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform}),this.creditAndTokenList&&this.creditAndTokenList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform}),this.businessExperienceList&&this.businessExperienceList.refresh({params:{platform:this.platform.getId(),offset:0},platform:this.platform}),this.container.setContent([this.memberList.getContent(),this.processList.getContent(),this.businessExperienceList&&this.businessExperienceList.getContent(),this.appsList.getContent(),this.creditAndTokenList&&this.creditAndTokenList.getContent()]),e.buttonFab||setTimeout(function(){var t=e.container.getParent(".scroller-root");e.buttonFab=new S({wrapper:t,action:e.onGrant.bind(e),events:{onActionClick:function(t){var n=function(){return e.memberList.getContent().getElements('[data-type="user"].selected').map(function(e){return(new C).inject(e),e.getAttribute("data-id")})};switch(t){default:e.onGrant();break;case"remove-people":P.removeUserWithPlusButton({tenant:e.options.platform&&e.options.platform.get?e.options.platform.get("id"):""}),new x({id:"_"}).destroy({data:{user:n().join(","),platform:e.platform.getId()},wait:!0,onComplete:function(t,n){v.success(n.message),e.memberList.forceRefreshView=!0,e.memberList.refresh(),e.processList.refresh()},onFailure:function(t,n){n.message&&v.warn(n.message),e.memberList.forceRefreshView=!0,e.memberList.refresh()}});break;case"remove-roles":P.removeGrantedRoleWithPlusButton({tenant:e.options.platform&&e.options.platform.get?e.options.platform.get("id"):""}),f.removeAllRoles({data:{user:n().join(","),platform:e.platform.getId()},callbacks:{onComplete:function(t){v.success(t.message),e.memberList.forceRefreshView=!0,e.memberList.refresh(),e.processList.refresh()},onFailure:function(t){t.message&&v.warn(t.message),e.memberList.forceRefreshView=!0,e.memberList.refresh()}}})}}}}).render(),e.buttonFab.inject(t)},200),this},_refreshViewAfterGranting:function(e,t){e&&(e.forEach(function(e){e.destroy()}),e=null),this._isIOS()&&this.memberList.unmask(),t?this.processList.refresh():this.processList.getContent().getElements(".process.selected").forEach(function(e){var t=e.getElement("input");e.removeClassName("selected"),t&&(t.checked=!1)}),this.toGrantCollection.reset(),this.toGrantBECollection.reset(),this.appsList.getContent().getElements(".tp-apps.selected").forEach(function(e){var t=e.getElement("input");e.removeClassName("selected"),t&&(t.checked=!1)}),this.memberList.getContent().getElements('[data-type="user"].selected').forEach(function(e){var t=e.getElement("input");e.removeClassName("selected"),t&&(t.checked=!1)}),this.manageButtonsState()},onGrant:function(){var e,t,n,i=this,o=[],s=[],a=[],l=!1,c=i.processList.collection;i.memberList.getContent().getElements('[data-type="user"].selected').forEach(function(t){o.push(t.getAttribute("data-id")),(e=new C).inject(t),s.push(e)}),i.processList.getContent().getElements('[data-type="process"].selected').forEach(function(o){(e=new C).inject(o),s.push(e),l=!0,i.toGrantCollection.get(o.getAttribute("data-id"))||(n=c.get(o.getAttribute("data-id")),i.toGrantCollection.add(n),t=new r({platform:i.platform,selectMode:!0,selectedCollection:i.toGrantCollection,model:n}),i.toGrantCollection.add(t.getMandatoryPrereq().toJSON()))}),i.appsList.getContent().getElements('[data-type="process"].selected').forEach(function(t){(e=new C).inject(t),s.push(e),i.toGrantCollection.add({uid:t.getAttribute("data-id")})}),i.toGrantCollection.forEach(function(e,t){return a.push(e.get("name"))}),P.multipleGrantWithPlusButton({tenant:i.options.platform&&i.options.platform.get?i.options.platform.get("id"):"",roleId:i.toGrantCollection.toJSONString(i.processList.withLicenses),roleName:a.toString()}),f.createLicensesUser({user:o.join(","),licenses:i.toGrantCollection.toJSONString(i.processList.withLicenses),platform:i.platform.getId()},{onComplete:function(e){v.success(e.message),i._refreshViewAfterGranting(s,l)},onFailure:function(e,t){(e.message||t.message)&&v.warn(e.message||t.message),i._refreshViewAfterGranting(s,l)}})},manageButtonsState:function(){var e=this.container,t=e.getElements('[data-type="user"].selected'),n=e.getElements('[data-type="process"].selected'),i=e.getElement('[data-action="select-mode"]'),o=e.getElement('[data-type="allUsers"].selected');this.buttonFab&&(t.length>0&&n.length>0?this.buttonFab.showSingle():[].length>0&&t.length>0?this.buttonFab.showSingle():t.length>0?this.buttonFab.showMultiple():o?this.buttonFab.showMultiple():this.buttonFab.hide()),i&&(t.length===this.memberList.collection.size()&&0!==this.memberList.collection.size()?i.removeClassName("fonticon-mouse-pointer-check").addClassName("fonticon-files-check").getParent("div").addClassName("item-active"):(i.removeClassName("fonticon-files-check").addClassName("fonticon-mouse-pointer-check"),0===t.length?i.getParent("div").removeClassName("item-active"):i.getParent("div").addClassName("item-active")))},_manageSelection:function(e,t){var n,i='[data-type]:not([data-trial]):not([data-free="0"])[data-casual]',o=e.getElements(i+".selected"),s=t.getElements(i+".selected");(o.length>0||s.length>0)&&(o.length>0&&(n=o[0].getAttribute("data-casual")),s.length>0&&(n=s[0].getAttribute("data-casual")),e.getElements(i+':not([data-casual="'+n+'"])').invoke("addClassName","disabled"),t.getElements(i+':not([data-casual="'+n+'"])').invoke("addClassName","disabled")),n&&0!==n?t.getElements('[data-free="0"][data-cross-company="true"]:not([data-casual="'+n+'"])').invoke("addClassName","disabled"):t.getElements('[data-free="0"][data-cross-company="true"]').invoke("removeClassName","disabled")},manageCasualActivation:function(){var e=this.container,t=e.getElement(".process-list-wrapper .pm-grid-container"),n=e.getElement(".member-list-wrapper .pm-grid-container");e.getElements('[data-type]:not([data-trial]):not([data-free="0"])[data-casual]').invoke("removeClassName","disabled"),n&&t&&this._manageSelection(n,t)},onSelectTile:function(e,t,n){var i=this.container,o=this,s=new u({className:"platform-management-confirm-modal",closable:!1}),a=!1;return e&&e.hasClassName("selected")?t instanceof h&&t&&((s=new r({platform:o.platform,selectMode:!0,selectedCollection:o.toGrantCollection,model:t,onConfirm:function(e){var n;e.forEach(function(e){(n=i.getElement(l.escapeDomSelector("[data-id="+e.get("uid")+"]")))&&o._select(n),o.toGrantCollection.add(e)}),o.toGrantCollection.add(t),o.manageCasualActivation(t.getCasual())},onCancel:function(){o._unselect(e),o.manageButtonsState(),o.manageCasualActivation(t.getCasual())}})).isNeeded()?(a=!0,s.confirm()):(o.toGrantCollection.add(t),o.toGrantBECollection.add(t),o.manageCasualActivation(t.getCasual()))):t&&t instanceof h&&e&&((s=new c({removeRequired:!0,selectedCollection:o.toGrantCollection,model:t,onRemovedRequired:function(e){e.forEach(function(e){var t=o.processList.getContent().getElement('[data-type="process"][data-id="'+e+'"].selected');t&&o._unselect(t)})},onCancel:function(n){n||o._select(e),o.manageCasualActivation(t.getCasual())}})).isNeeded()?(a=!0,s.show()):(o.toGrantCollection.remove(t.get("uid")),o.manageCasualActivation(t.getCasual()))),!t||t instanceof h?e&&"allUsers"===e.getAttribute("data-type")&&o.manageCasualActivation():o.manageCasualActivation(t.get("casual")),o.manageButtonsState(),n||o.initDrag(),a},_select:function(e){var t=e.getElement("input");e.addClassName("selected"),t&&(t.checked=!0)},_unselect:function(e){var t=e.getElement("input");e.removeClassName("selected"),t&&(t.checked=!1)},_isIOS:function(){return"ios"===l.detectOs()||"macos"===l.detectOs()},initDrag:function(){var e=this.container,t=this;this.dragMembers&&this.dragMembers.destroy(),this.dragProcesses&&this.dragProcesses.destroy(),this.dragBusinesses&&this.dragBusinesses.destroy(),e.getElements('.process-list-wrapper [data-type="process"]:not(.disabled):not(.tp-apps-public)').length>0&&e.getElements('.member-list-wrapper [data-type="user"]:not(.disabled)').length>0&&(this.dragMembers=new w({tileIdentifier:'[data-type="user"]',container:e,scrollView:this.options.getScrollView(),zonesIdentifier:'.process-list-wrapper [data-type="process"]:not(.disabled):not(.tp-apps-public)',wrapperSelector:".member-list-wrapper",cancelZoneLocationSelector:".member-list-wrapper .pm-grid-container",collection:this.memberList.collection,onSelect:this.onSelectTile.bind(this),initDrag:this.initDrag.bind(this),drop:function(n){var i,o,s=[],a=[],l=new m(t.processList.collection.toArray()).get(n.zone.getAttribute("data-id")),c=[],d=function(e){t.toGrantCollection.forEach(function(e,t){return c.push(e.get("name"))}),P.dragAndDropUserToRole({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):"",roleId:t.toGrantCollection.toJSONString(t.processList.withLicenses),roleName:c.toString()}),f.createLicensesUser({user:e.join(","),licenses:t.toGrantCollection.toJSONString(t.processList.withLicenses),platform:t.platform.getId()},{onComplete:function(e){v.success(e.message),t._refreshViewAfterGranting(a,!0)},onFailure:function(e,n){(e.message||n.message)&&v.warn(e.message||n.message),t._refreshViewAfterGranting(a,!0)}})};return t._isIOS()?(t.memberList.mask(),e.getElements('.member-list-wrapper [data-type="user"].selected').forEach(function(e){s.push(e.getAttribute("data-id"))})):e.getElements('.member-list-wrapper [data-type="user"].selected').forEach(function(e){s.push(e.getAttribute("data-id")),(i=new C).inject(e),a.push(i)}),(i=new C).inject(n.zone),a.push(i),l?(o=new r({platform:t.platform,selectMode:!0,selectedCollection:t.toGrantCollection,model:l,onConfirm:function(e){t.toGrantCollection.add(e.toJSON()),t.toGrantCollection.add(l),d(s)},onCancel:function(){t.memberList.unmask(),a.forEach(function(e){e.destroy()})}})).isNeeded()?o.confirm():(t.toGrantCollection.add(l),d(s)):(t.toGrantCollection.add({uid:n.zone.getAttribute("data-id")}),d(s)),!0}}).initDrag(),this.dragProcesses=new w({tileIdentifier:'[data-type="process"]:not(.disabled):not([data-public="true"])',container:e,scrollView:this.options.getScrollView(),zonesIdentifier:'.member-list-wrapper [data-type="user"]:not(.disabled)',wrapperSelector:".process-list-wrapper",cancelZoneLocationSelector:".member-list-wrapper .pm-grid-container",collection:this.processList.collection,onSelect:this.onSelectTile.bind(this),initDrag:this.initDrag.bind(this),drop:function(e){var n,i,o,s=[],a=[],l=!1,c=!1,d=new m(t.processList.collection.toArray()),u=[];return t.processList.getContent().getElements('[data-type="process"].selected').forEach(function(e){t._isIOS()||((n=new C).inject(e),a.push(n)),l=!0,t.toGrantCollection.get(e.getAttribute("data-id"))||(o=d.get(e.getAttribute("data-id")),t.toGrantCollection.add(o),i=new r({platform:t.platform,selectMode:!0,selectedCollection:t.toGrantCollection,model:o}),t.toGrantCollection.add(i.getMandatoryPrereq().toJSON()))}),t.appsList.getContent().getElements('[data-type="process"].selected').forEach(function(e){c=!0,t._isIOS()||((n=new C).inject(e),a.push(n)),t.toGrantCollection.add({uid:e.getAttribute("data-id")})}),t._isIOS()&&(l&&t.processList.mask(),c&&t.appsList.mask()),s.push(e.zone.getAttribute("data-id")),t._isIOS()?t.memberList.mask():((n=new C).inject(e.zone),a.push(n)),t.toGrantCollection.forEach(function(e,t){return u.push(e.get("name"))}),P.dragAndDropRoleToUser({tenant:t.options.platform&&t.options.platform.get?t.options.platform.get("id"):"",roleId:t.toGrantCollection.toJSONString(t.processList.withLicenses),roleName:u.toString()}),f.createLicensesUser({user:s.join(","),licenses:t.toGrantCollection.toJSONString(t.processList.withLicenses),platform:t.platform.getId()},{onComplete:function(e){v.success(e.message),t._refreshViewAfterGranting(a,l)},onFailure:function(e,n){(e.message||n.message)&&v.warn(e.message||n.message),t._refreshViewAfterGranting(a,l)}}),!0}}).initDrag())}})});