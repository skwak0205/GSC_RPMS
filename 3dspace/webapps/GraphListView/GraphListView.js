define("DS/GraphListView/GraphListViewNodeEdgeViewsTemplate",["UWA/Core","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/egraph/iact","DS/UIKIT/Tooltip","i18n!DS/GraphListView/assets/nls/ColumnsTitles","css!DS/GraphListView/styles/GraphListViewNodeEdgeViewsTemplate"],function(e,t,i,n,o,s,a){"use strict";var r;function d(){n.SVGEdgeView.call(this,"subway-edge-view")}function l(){n.HTMLNodeView.call(this)}return i.inherit(d,n.SVGEdgeView),d.prototype.onmodifyDisplay=function(e,t,i){n.SVGEdgeView.prototype.onmodifyDisplay.apply(this,arguments);var o,s=this.display.elt,a=e.cl1.c.node,r=e.cl2.c.node,d=r.__MASTER__.options.ancestors;if(d)var l=d.find(e=>e.custom_line_color);(o=l?l.custom_line_color:e.data.color)&&(s.style.stroke=o),e.selected?s.className.baseVal+=" selected":s.className.baseVal=s.className.baseVal.replace(/\selected\b/g,""),r.data.data.options.grid.minororder>0&&r.data.data.options.grid.secondaries||a.data.data.options.grid.minororder>0&&a.data.data.options.grid.secondaries&&Array.isArray(r.data.data.options.ancestors)&&r.data.data.options.ancestors.find(function(e){return"I"===e.semantic.toUpperCase()})?s.style.strokeDasharray="5,3":r.data.data.options.ancestors&&r.data.data.options.ancestors.find(function(e){return"SO"===e.semantic.toUpperCase()})&&(s.style.strokeDasharray="15,2,2,2,2,2")},i.inherit(l,n.HTMLNodeView),l.prototype.buildNodeElement=function(t){return r||(r=e.createElement("div",{class:"subway-node-view"})),e.extendElement(r.cloneNode(!0))},l.prototype.onmodifyDisplay=function(){n.HTMLNodeView.prototype.onmodifyDisplay.apply(this,arguments);var e=this.display.elt,t=arguments[0],i=t.actualWidth+4;if(t.selected?(e.style.borderRadius=i/2+"px",e.style.width=i+"px",e.style.height=i+"px",e.style.left=t.actualLeft-2+"px",e.style.top=t.actualTop-2+"px"):(i-=4,e.style.borderRadius=i/2+"px",e.style.width=i+"px",e.style.height=i+"px",e.style.left=t.actualLeft+"px",e.style.top=t.actualTop+"px"),e.style.background=t.data.color,t.data.data.options.ancestors){var o=t.data.data.options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()});o&&(e.style.webkitMaskImage="radial-gradient(circle farthest-side at center, transparent 49%, white 50%)",e.tooltip||(delete e.tooltip,e.tooltip=new s({target:e,body:void 0,offset:{x:10,y:14},position:"bottom"})),e.onmousedown=function(e){var i=t.data.data;i.options&&i.options.ancestors&&i.options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()})&&(t.isProcessingClick||(t.isProcessingClick=!0,i._modelEvents.publish({event:"_ENOXVersionExplorerLaunchFilterSpecification",data:i}),setTimeout(function(){t.isProcessingClick=!1},200)))},e.onmouseenter=function(t){if(e.style.webkitMaskImage="radial-gradient(circle farthest-side at center, transparent 20%, blue 50%)",e.tooltip)if(o.filterQuery&&o.filterQuery.filter){var i=o.filterQuery.filter.filterTitle?o.filterQuery.filter.filterTitle:a.colFilter;e.tooltip.getBody().setHTML(i),e.tooltip.getBody().show()}else e.tooltip.getBody().hide()},e.onmouseleave=function(t){e.style.webkitMaskImage="radial-gradient(circle farthest-side at center, transparent 49%, white 50%)"})}},l.size=function(){return 16},l.getBorderThickness=function(){return 4},{NodeView:l,EdgeView:d,EdgeGeometry:{radius:8,onupdate:function(e){var i,n,o,s,a,r,d,l,_,c=e.swapConnectors?e.cl2.c:e.cl1.c,h=e.swapConnectors?e.cl1.c:e.cl2.c,u=c.aleft,p=h.aleft,g=c.atop,m=h.atop,f=(e.cl1.c.node.height,c.anormx),v=c.anormy,w=h.anormx,E=h.anormy,C=4*(Math.SQRT2-1)/3,S=this.radius,I=S*C;!0===e.merge?u!==p?(n=s=u,d=_=m,a=(o=m-v*S)+v*I,r=(l=u-(w=(u-p)/Math.abs(u-p))*S)+w*I,i=[t.PathCmd.M,u,g,t.PathCmd.L,n,o,t.PathCmd.C,l,_,s,a,r,d,t.PathCmd.L,p,m]):i=[]:u===p?i=[t.PathCmd.M,u,g,t.PathCmd.L,p,m]:(a=o=g,l=r=p,s=(n=p-f*S)+f*I,n<u&&(n=u),d=(_=g-E*S)+E*I,i=[t.PathCmd.M,u,g,t.PathCmd.L,n,o,t.PathCmd.C,l,_,s,a,r,d,t.PathCmd.L,p,m]);e.set("path",i)}},branchDistance:function(){return 16}}}),define("DS/GraphListView/ColumnManagerBase",["UWA/Core","UWA/Class","DS/LifecycleDAGUtils/ArrayFunctions","DS/Controls/TooltipModel","i18n!DS/GraphListView/assets/nls/ColumnsTitles"],function(e,t,i,n,o){"use strict";return t.extend({_columns:void 0,init:function(t){this._columns=[{text:"",dataIndex:"bi_color",width:10,isSortable:!1,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:o.colGraph,dataIndex:"__GRAPH__",width:150,style:{overflow:"scroll"},isSortable:!0,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:"",dataIndex:"selection",type:"selection",width:40,isSortable:!1,isDraggable:!1,isEditable:!1,alwaysOn:!0},"function"==typeof t.onNodeDropdownMenu?{text:"",width:40,dataIndex:"__DROPDOWN__",isSortable:!1,isDraggable:!1,isEditable:!1,alwaysOn:!0,onCellRequest:function(i){if(!i.isHeader){i.cellView.getContent().setContent(e.createElement("div"),{html:'<span class="fonticon fonticon-2x fonticon-open-down"></span>',style:{width:"100%",height:"100%"},events:{mousedown:function(e){i.manager.options.selection.cells=!0,e.preventDefault(),e.stopPropagation(),i.manager.unsetActiveNode(),i.manager.setActiveNode(i.nodeModel),t.onNodeDropdownMenu({cellInfos:i,event:e}),setTimeout(function(){i.manager.options.selection.cells=!1},300)}}});var n=i.cellView.getContent();n.tooltipInfos&&(n.tooltipInfos.shortHelp=o.colMenu)}}}:{},{text:o.colIntent,dataIndex:"__Intent__",width:50,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!0,alwaysOn:!0},{text:o.colSpecification,dataIndex:"__Specification__",width:20,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!0,alwaysOn:!0},{text:o.colTitle,dataIndex:"tree",width:225,isSortable:!0,isDraggable:!1,isEditable:!1,alwaysOn:!0}],this._customColumnViews=[];var i=this._columns.findIndex(function(e){return!e.dataIndex});i>0&&this._columns.splice(i,1),this.filtersOn=!1},getColumns:function(){return this._columns.slice()},getCustomColumnView:function(){return this._customColumnViews},setDefaultColumns:function(t,i){if(!0===i)this._columns=t;else for(var n=t.length,o=0;o<n;o++){var s=this._columns.findIndex(function(e){return e.dataIndex===t[o].dataIndex});s>=0?this._columns[s]=e.extend(this._columns[s],t[o],!0):this._columns.push(t[o])}},addColumns:function(e){if(Array.isArray(e)&&e.length)for(var t=0,i=e.length;t<i;t++)this._columns.findIndex(function(i){return i.dataIndex===e[t].dataIndex})<0&&this._columns.push(this._customizeColumnView(e[t]))},hasFilterColumns:function(){return this.filtersOn},modifyFilterColumns:function(t){var i=this;i.filtersOn=t;var n=function(t){var n=i._columns.find(function(e){return e.dataIndex===t});n.versionExplorerController=i.versionExplorerController,"__Specification__"===t&&(!function(e){e.cellClickCB=function(t){if(t.view&&t.view._cellInfos&&t.view._cellInfos.nodeModel){var i=t.view._cellInfos.nodeModel;i.options&&i.options.ancestors&&i.options.ancestors.find(function(e){return"PS"===e.semantic.toUpperCase()})&&(e.isProcessingClick||(e.isProcessingClick=!0,e.versionExplorerController.publishEvent("_ENOXVersionExplorerLaunchFilterSpecification",i),setTimeout(function(){e.isProcessingClick=!1},200)))}}}(n),n.onCellRequest=function(t){if(!t.isHeader){var n=t.nodeModel;if(n.options&&n.options.ancestors){var s=n.options.ancestors.find(function(e){return e.hasExpand});if(s){var a=t.cellView.getContent();t.cellView.getContent().setContent(e.createElement("div"),{html:'<span class="fonticon fonticon-2x wux-ui-3ds-filter"></span>',style:{width:"100%",height:"100%"},events:{mousedown:function(e){},mouseenter:function(e){if(a.tooltipInfos){a.tooltipInfos.shortHelp="";var t=i.versionExplorerController.getFilterHashObject(s.filterid);t&&t.filterQuery&&t.filterQuery.filter&&(a.tooltipInfos.shortHelp=t.filterQuery.filterTitle?t.filterQuery.filterTitle:o.colFilter)}}}})}}}})};if(Array.isArray(this._columns))for(var s=1,a=0,r=this._columns.length;a<r&&s>0;a++)"__Intent__"===this._columns[a].dataIndex||"__Specification__"===this._columns[a].dataIndex&&(s--,this._columns[a].isHidden=!t,t&&n(this._columns[a].dataIndex))},_customizeColumnView:function(t){return t=e.extend({text:void 0,dataIndex:void 0,width:"auto",isSortable:!0,isDraggable:!1,isEditable:!1,isHidden:!1},t)},removeColumns:function(e){if(Array.isArray(e)&&e.length)for(var t=0,i=e.length;t<i;t++)this._columns.splice(this._columns.findIndex(function(i){return e[t]===i.dataIndex}),1)},empty:function(){this.removeColumns(this._columns.reduce(function(e,t,i,n){return t.alwaysOn||e.push(t.dataIndex),e},[]))},showColumns:function(e){for(var t=0,i=e.length;t<i;t++){var n=this._columns.find(function(i){return i.dataIndex===e[t]});n&&(n.isHidden=!1)}},hideColumns:function(e){for(var t=0,i=e.length;t<i;t++){var n=this._columns.find(function(i){return i.dataIndex===e[t]});n&&(n.isHidden=!0)}},arrangeColumns:function(e){for(var t={revision:"code",created:"creationDate",owner:"ownerName",maturity:"maturity_nls",project:"project_nls",policy:"policy_nls",organization:"organization_nls",type:"type_nls",reservedby:"reservedbyName"},i={},n=0,o=0;o<this._columns.length;o++)!0===this._columns[o].alwaysOn&&(i[this._columns[o].dataIndex]=n++);o=0;for(var s=e.length;o<s;o++){var a=void 0===t[e[o]]?e[o]:t[e[o]],r=this._columns.find(function(e){return e.dataIndex===a});r&&(i[r.dataIndex]=n++)}this._columns.sort(function(e,t){return 1==e.alwaysOn&&1==t.alwaysOn?i[e.dataIndex]-i[t.dataIndex]:1==e.alwaysOn&&1!=t.alwaysOn?-1:1!=e.alwaysOn&&1==t.alwaysOn?1:i[e.dataIndex]>=0&&i[t.dataIndex]>=0?i[e.dataIndex]-i[t.dataIndex]:i[e.dataIndex]>=0&&void 0===i[t.dataIndex]?1:void 0===i[e.dataIndex]&&i[t.dataIndex]>=0?-1:1})}})}),define("DS/GraphListView/SubwayGraph",["UWA/Core","DS/egraph/core","DS/egraph/utils","DS/egraph/views","DS/egraph/iact","DS/LifecycleDAGUtils/ArrayFunctions","DS/Utilities/Data","css!DS/egraph/views.css","css!DS/egraph/views_default.css"],function(e,t,i,n,o,s,a){"use strict";function r(e,i,n,o,s,a){function r(e,n){var o=new t.Connector;return o.multiset(["cstr","attach"],t.BorderCstr[n],["cstr","offset"],i/2),e.appendConnector(o),o}var d=new t.Node;return d.data={},d.data.color=s,d.views.main=new this.options.nodeView,d.multiset("left",n,"top",o,"width",i,"height",i),d.data.cTop=r(d,"TOP"),d.data.cBot=r(d,"BOTTOM"),d.data.cRight=r(d,"RIGHT"),d.data.cLeft=r(d,"LEFT"),d.data.parentEdges=[],d.data.childEdges=[],a&&(d.data.data=a,a.__SUBWAYGRAPHNODE__=d,d.__MASTER__=a),d.customPropertyFlags={color:t.PropertyFlag.VIEW},e.addNode(d),d}function d(e,i,n,o,s,a){var r;return(r=new t.Edge).set("geometry",this.options.edgeGeometry),r.views.main=new this.options.edgeView,r.data={color:a},e.addEdge(i,n,r),r.childNode=s,r.parentNode=o,s.data.parentEdges.push(r),o.data.childEdges.push(r),r.customPropertyFlags={color:t.PropertyFlag.VIEW},r}return{initGraph:function(){this._grMergeConnections=[],this._graph=new t.EGraph,this._graph.addView("main",new n.HTMLGraphView(this.options.graphContainer));new o.StateMachine(this._graph,void 0,{},this._graph.views.main)},_addNode:function(e,t,i,n){var o=this._graph;r.bind(this)(o,this.options.nodeSize,t,i,n||e.__BRANCH__.data.color,e)},_drawEdge:function(e,t,i){var n,o,s=this._graph,a=this._manager,r=t.__SUBWAYGRAPHNODE__,l=e.__SUBWAYGRAPHNODE__;if(r&&l){var _=a.getRowPosition(t.__LISTVIEWCOPY__._getRowID())>a.getRowPosition(e.__LISTVIEWCOPY__._getRowID());o=_?l.data.cBot:l.data.cTop,n=e.__BRANCH__===t.__BRANCH__?_?r.data.cTop:r.data.cBot:r.data.cRight;for(var c,h=!0,u=0,p=l.data.parentEdges,g=p.length;u<g;u++)if((c=p[u]).childNode===l&&c.parentNode===r){c.cl1.c===n&&c.cl2.c===o?h=!1:this._removeEdge(c);break}h?d.bind(this)(s,n,o,r,l,i||e.__BRANCH__.data.color):i&&i!==c.data.color&&c.multiset(["data","color"],i)}},_drawHiddenNodeMerge:function(e){var t=this._graph,i=e.parent,n=e.child;if(i.__SUBWAYGRAPHNODE__&&n.__SUBWAYGRAPHNODE__){var o=i.__SUBWAYGRAPHNODE__,s=n.__SUBWAYGRAPHNODE__,a=this._manager,l=this.options.paddingLeft+this._model.getBranchID(e.mergeHiddenNode.__BRANCH__)*this.options.branchDistance,_=(o.top+s.top)/2,c=this._grMergeConnections.find(function(t){return t.masterMerge===e}),h=c?(c.grHiddenBranchMergeNode.actualLeft!==l||c.grHiddenBranchMergeNode.actualTop!==_&&c.grHiddenBranchMergeNode.multiset("left",l,"top",_),c.grHiddenBranchMergeNode):r.bind(this)(t,this.options.nodeSize,l,_,"transparent",e.mergeHiddenNode),u=a.getRowPosition(i.__LISTVIEWCOPY__._getRowID())>a.getRowPosition(n.__LISTVIEWCOPY__._getRowID()),p=h.data[u?"cBot":"cTop"],g=h.data[u?"cTop":"cBot"];if(!c||c.edges[0].cl2.c!==p&&c.edges[1].cl2.c!==g){if(c)for(;c.edges.length;){var m=c.edges.pop();this._removeEdge(m)}var f=d.bind(this)(t,!0===e.mergeLeft?o.data.cLeft:o.data.cRight,p,o,h,i.__BRANCH__.data.color),v=d.bind(this)(t,u?s.data.cBot:s.data.cTop,g,s,h,i.__BRANCH__.data.color),w=d.bind(this)(t,h.data.cBot,h.data.cTop,h,h,i.__BRANCH__.data.color);v.swapConnectors=f.hiddenNodeMergeEdge=v.hiddenNodeMergeEdge=v.merge=w.hiddenNodeMergeEdge=!0,f.merge=f.swapConnectors=e.mergeLeft,c?c.edges=[f,v,w]:(h.data.mergeHiddenNode=e.mergeHiddenNode,this._grMergeConnections.push({grHiddenBranchMergeNode:h,grParent:o,grChild:s,edges:[f,v,w],masterMerge:e}))}}},_removeHiddenBranchMerge:function(e){this._removeNode(e.grHiddenBranchMergeNode)},_drawMergeEdge:function(e){var t,i=this._manager,n=e.parent,o=e.child,s=n.__SUBWAYGRAPHNODE__,a=o.__SUBWAYGRAPHNODE__;if(s&&a){var r,l=this._grMergeConnections.find(function(t){return t.masterMerge===e}),_=i.getRowPosition(s.__MASTER__.__LISTVIEWCOPY__._getRowID())>i.getRowPosition(a.__MASTER__.__LISTVIEWCOPY__._getRowID()),c=_?a.data.cBot:a.data.cTop;r=!0===e.mergeBetweenRoots?!0===e.mergeLeft?s.data.cLeft:s.data.cRight:n.__BRANCH__===o.__BRANCH__?_?s.data.cTop:s.data.cBot:r=_?s.data.cTop:s.data.cBot,(!l||l.edge.cl1.c!==r||l.edge.cl2.c!==c)&&(l&&this._removeMerge(l),(t=d.bind(this)(this._graph,r,c,s,a,e.custom_line_color||n.__BRANCH__.data.color)).merge=!(n.__BRANCH__===o.__BRANCH__),!0===e.mergeBetweenRoots&&(t.swapConnectors=e.mergeLeft),this._grMergeConnections.push({grParent:s,grChild:a,edge:t,masterMerge:e}))}},_removeEdge:function(e,t){var i;!t&&e.childNode&&(i=e.childNode.data.parentEdges.indexOf(e))>=0&&(e.childNode.data.parentEdges.splice(i,1),e.childNode=null),e.parentNode&&(i=e.parentNode.data.childEdges.indexOf(e))>=0&&(e.parentNode.data.childEdges.splice(i,1),e.parentNode=null),e.remove()},_removeMerge:function(e){this._grMergeConnections.splice(this._grMergeConnections.indexOf(e),1),e.grHiddenBranchMergeNode?this._removeHiddenBranchMerge(e):this._removeEdge(e.edge)},_removeNode:function(e){var t;if(e){for(;t=e.data.parentEdges.pop();){if(!0===t.hasOwnProperty("merge")&&!0!==t.hiddenNodeMergeEdge){var i=this._grMergeConnections.findIndex(function(e){return e.edge===t});i>=0&&this._grMergeConnections.splice(i,1)}this._removeEdge(t,!0)}t=e.data.childEdges.filter(function(e){return!0===e.hiddenNodeMergeEdge});for(var n=0;n<t.length;n++){var o=this._grMergeConnections.splice(this._grMergeConnections.find(function(e){return e.mergeHiddenNode&&e.edges.indexOf(t[n])>=0}),1);1===o.length&&this._removeHiddenBranchMerge(o[0])}e.remove()}},_clearGraph:function(){var e,t=this._graph;t.withLockedUpdate(function(){for(var i=t.edges.first;i;i=e)e=i.next,i.remove();for(var n=t.nodes.first;n;n=e)e=n.next,n.__MASTER__.__SUBWAYGRAPHNODE__=void 0,n.__MASTER__=void 0,n.remove()}),this._grMergeConnections=[]},_updateGraph:function(e){var t=Array.isArray(this._model._nodeList)&&this._model._nodeList.length?this._model._nodeList:this._model.getAllDescendants(),i=this._manager,n=i.options.defaultCellHeight,o=this._nodesRemoved,r=this;let d;for(;d=o.pop();)this._removeNode(d.__MASTER__.__SUBWAYGRAPHNODE__);let l=(n-this.options.nodeSize)/2;function _(){s.intersectionDifference(r._model._mergeConnections,r._grMergeConnections,function(e,t){return t.masterMerge===e})[1].difference.forEach(function(e){r._removeMerge(e)}),a.forEach(r._model._mergeConnections,function(e){r._graph.withLockedUpdate(function(){e.mergeHiddenNode?r._drawHiddenNodeMerge(e):r._drawMergeEdge(e)})},50,function(){r._updateGraphSelection()})}this._treeDoc._getTrueRoot().processDescendants({async:!0,onlyVisibleNodes:!0,processNode:function(e){if(e.nodeModel.__MASTER__){let t=e.nodeModel,n=t.__MASTER__,o=n.__SUBWAYGRAPHNODE__,s=t._getRowID(),a=i.getRowPosition(s),d=r._model.getBranchID(n.__BRANCH__),_=r.options.paddingLeft+(d&&d>=0?d:0)*r.options.branchDistance,c=a+l,h=n.options.grid.custom_node_color||n.__BRANCH__.data.color;r._graph.withLockedUpdate(function(){o?o.actualLeft!==_||o.actualTop!==c?o.multiset("left",_,"top",c):(n.options.grid.custom_node_color&&o.data.color!==n.options.grid.custom_node_color||!n.options.grid.custom_node_color&&o.data.color!==n.__BRANCH__.data.color)&&o.multiset(["data","color"],n.options.grid.custom_node_color||n.__BRANCH__.data.color):r._addNode(n,_,c,h)})}},onCompleteCB:function(){a.forEach(t,function(e){r._graph.withLockedUpdate(function(){let t;if(Array.isArray(e.options.ancestors)&&e.options.ancestors.length){let i=e.options.ancestors.find(function(e){return"I"!==e.semantic});t=i&&i.custom_line_color?i.custom_line_color:e.__BRANCH__.data.color}r._drawEdge(e,e.getParent(),t)})},50,_)}});var c=Math.max(this.options.paddingLeft+this._model._branchArray.length*this.options.branchDistance+this.options.nodeSize+this.options.paddingRight,this.options.minGraphColumnWidth),h=!isNaN(this.options.maxGraphColumnWidth)&&this.options.maxGraphColumnWidth>0?this.graphColumnWidth=Math.min(c,this.options.maxGraphColumnWidth):c;(isNaN(this._currentGraphColumnWidth)||this._currentGraphColumnWidth>0&&h!==this._currentGraphColumnWidth)&&(this._currentGraphColumnWidth=h,i.prepareUpdateView(),i.setColumnWidth("__GRAPH__",h),this.options.graphContainer.setStyle("width",h+"px"),this.options.graphContainer.getElement(".egraph_views_domroot").setStyle("width",c+"px"),i.pushUpdateView())},_updateGraphSelection:function(){var e=Array.isArray(this._model._nodeList)&&this._model._nodeList.length?this._model._nodeList:this._model.getAllDescendants(),t=this,i=this._model,n=(this._manager,this._treeDoc.getRoots(),this._graph);this.highlightNodesOnSelect&&this._graph.withLockedUpdate(function(){for(var o=0,s=e.length;o<s;o+=1)if(e[o].__SUBWAYGRAPHNODE__)if(i.getXSO().isIn(e[o])){var a=e[o].__SUBWAYGRAPHNODE__;n.addToSelection(a),t.options.highlightParentEdgesOnNodeSelect&&a.data.parentEdges.forEach(function(e){n.addToSelection(e)})}else if(n.isSelected(e[o].__SUBWAYGRAPHNODE__)){a=e[o].__SUBWAYGRAPHNODE__;n.removeFromSelection(a),t.options.highlightParentEdgesOnNodeSelect&&a.data.parentEdges.forEach(function(e){n.isSelected(e)&&n.removeFromSelection(e)})}})}}}),define("DS/GraphListView/GraphListView",["UWA/Core","UWA/Class","DS/GraphListView/ColumnManagerBase","DS/GraphListView/SubwayGraph","DS/LifecycleDAGModel/DAGDocumentModel","DS/Tree/Tree","DS/GraphListView/GraphListViewNodeEdgeViewsTemplate","DS/LifecycleDAGUtils/ArrayFunctions","DS/Tree/TreeNodeModel","css!DS/GraphListView/styles/GraphListView"],function(e,t,i,n,o,s,a,r,d){"use strict";return s.extend({init:function(t){var n=this;t=t||{},this._listViewModelEventTokens={},this._listViewManagerEventTokens={},this._masterModelEventTokens={},this._isActivated=!1,this._isPreparingColumns=0,(t=e.extend({apiVersion:2,useAsyncPreExpand:!0,enableTreeColumnEllipsisOverflow:!0,enableKeyboardNavigation:!0,resize:{columns:!0,rows:!1},show:{columnHeaders:!0,rowHeaders:!1},performances:{buildLinks:!1,preloadPool:!0,useRequestAnimationFrameRendering:!1},selection:{cells:!1},columnManager:new i(t),nodeView:a.NodeView,edgeView:a.EdgeView,edgeGeometry:a.EdgeGeometry,maxGraphColumnWidth:null,minGraphColumnWidth:70,paddingLeft:10,paddingRight:10,nodeSize:a.NodeView.size(),branchDistance:a.branchDistance(),ascending:!1,isEditable:!0,showScrollbarsOnHover:!0},t,!0)).columns=t.columnManager.getColumns(),t.columnManager._listView=this,this._parent(t);var s=t.container.getElement(".subway-listview-listcontainer");s&&s.remove(),this.inject(t.container),this._treeDoc=this.getDocument(),this._manager=this.getManager(),this._nodesRemoved=[];this.options.columnManager.getColumns();this.options.columnManager.getCustomColumnView().forEach(function(e){e.id&&e.buildContent&&n._manager.registerReusableCellContent(e)}),this.elements.container.addClassName("subway-listview-listcontainer");var r=this.elements.container.getElement(".wux-datagrid");r&&r.setStyle("height","inherit"),(r=this.elements.container.getElement(".wux-layouts-gridengine"))&&r.setStyle("height","inherit");var d=e.createElement("div",{class:"subway-graph-canvas"});if(this._manager.elements.poolContainerRel.appendChild(d),this.options.graphContainer=d,this.initGraph(),this._manager.onColumnWidthUpdate(function(e){0===e.columnID&&"number"==typeof e.width&&e.width!==n.graphColWidth&&(d.setStyle("width",e.width.toString()+"px"),n.graphColWidth=e.width)}),this._model=this.options.model||new o,!(this._model instanceof o))throw Error("SubwayListView=>ListView.SetModel: model must be instance of DAGDocumentModel")},_addEventListeners:function(){this._addEvent("LISTVIEWMODEL","select",this.onSelectListView.bind(this)),this._addEvent("LISTVIEWMODEL","unselect",this.onUnselectListView.bind(this)),this._addEvent("MASTER","prepareAddDelete",this.prepareUpdateView.bind(this)),this._addEvent("MASTER","pushAddDelete",this.pushUpdateViewAndUpdateGraph.bind(this)),this._addEvent("MASTER","cancelAddDelete",this.cancelUpdate.bind(this)),this._addEvent("MASTER","empty",this.empty.bind(this)),this._addEvent("MASTER","select",this.onSelectMaster.bind(this)),this._addEvent("MASTER","unselect",this.onUnselectMaster.bind(this)),this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this)),this._addEvent("LISTVIEWMANAGER","sort",this.onSort.bind(this)),this._addEvent("LISTVIEWMANAGER","dblClick",function(e){var t=e.nodeModel.__MASTER__;"function"==typeof this.options.onNodeDoubleClick&&this.options.onNodeDoubleClick(t)}.bind(this)),this._isActivated=!0},deactivate:function(){for(var e in this._listViewModelEventTokens)this._removeEvent("LISTVIEWMODEL",e);for(var e in this._masterModelEventTokens)this._removeEvent("MASTER",e);for(var e in this._listViewManagerEventTokens)this._removeEvent("LISTVIEWMANAGER",e);this._isActivated=!1},activate:function(){this.prepareUpdateView(),this.pushUpdateViewAndUpdateGraph(),this._addEventListeners()},getModel:function(){return this._model},empty:function(){this._treeDoc.empty(),this._clearGraph()},updateNodes:function(){var e=this._treeDoc,t=(this._manager,Array.isArray(this._model._nodeList)&&this._model._nodeList.length?this._model._nodeList:this._model.getAllDescendants());"function"==typeof this.options.nodeSortFunction&&t.sort(this.options.nodeSortFunction),this._treeDoc.prepareUpdate();
//!this._isActivated && this.prepareUpdateView();
for(var i,n=0,o=e.getAllDescendants(),s=o.length;n<s;n+=1)(!(i=o[n]).__MASTER__||t.indexOf(i.__MASTER__)<0)&&this._nodesRemoved.push(e.removeRoot(i));n=0,s=t.length;for(var a=t[n];n<s;a=t[n+=1]){a.__LISTVIEWCOPY__&&a.__LISTVIEWCOPY__.__MASTER__===a?a.__LISTVIEWCOPY__.refreshNodeData(a):this._addChild(a),!0!==a._isSelected||a.__LISTVIEWCOPY__.isSelected()?!a._isSelected&&a.__LISTVIEWCOPY__.isSelected()&&a.__LISTVIEWCOPY__.unselect():a.__LISTVIEWCOPY__.select();var r=a.getAttribute("__filter__");r!==a.__LISTVIEWCOPY__.getAttribute("__filter__")&&a.__LISTVIEWCOPY__.setAttribute("__filter__",r)}this._treeDoc.pushUpdate()},_addChild:function(e){var t,i=this._treeDoc;this._model._nodeList.indexOf(e)>=0&&!e.__LISTVIEWCOPY__&&(t=function(e){var t=e.clone();return t.__MASTER__=e,e.__LISTVIEWCOPY__=t,t}(e),i.addRoot(t))},addChildCallback:function(e){this._addChild(e.data.nodeModel)},_removeChild:function(e){var t=this._treeDoc;if(t.getRoots().length){var i=e.__LISTVIEWCOPY__,n=e.getAllDescendants();this._nodesRemoved.push(t.removeRoot(i));for(var o=0;o<n.length;o++)this._nodesRemoved.push(t.removeRoot(n[o].__LISTVIEWCOPY__))}},removeChildCallback:function(e){this._removeChild(e.data.nodeModel)},prepareUpdateView:function(e){this._manager.prepareUpdateView()},pushUpdateView:function(e){this._manager.pushUpdateView(),this._manager._giveFocus(!0)},pushUpdateViewAndUpdateGraph:function(e){this.updateNodes(),this.pushUpdateView(),this._updateGraph()},cancelUpdate:function(e){this._manager._preventNextUpdateView(),this._manager.pushUpdateView(),this._manager._unpreventNextUpdateView()},onSelectListView:function(e){var t=e.data.nodeModel.__MASTER__;this._model.getXSO().isIn(t)||t.select()},onUnselectListView:function(e){var t=e.data.nodeModel.__MASTER__;this._model.getXSO().isIn(t)&&t.unselect()},onSelectMaster:function(e){var t=e.data.nodeModel;t.__LISTVIEWCOPY__&&!this._treeDoc.getXSO().isIn(t.__LISTVIEWCOPY__)&&t.__LISTVIEWCOPY__.select()},onUnselectMaster:function(e){var t=e.data.nodeModel;this._treeDoc.getXSO().isIn(t.__LISTVIEWCOPY__)&&t.__LISTVIEWCOPY__.unselect()},_addEvent:function(e,t,i){switch(e){case"LISTVIEWMODEL":this._listViewModelEventTokens[t]=this._listViewModelEventTokens[t]||this._treeDoc.subscribe({event:t},i);break;case"LISTVIEWMANAGER":this._listViewManagerEventTokens[t]=this._listViewManagerEventTokens[t]||this._manager._modelEvents.subscribe({event:t},i);break;case"MASTER":this._masterModelEventTokens[t]=this._masterModelEventTokens[t]||this._model.subscribe({event:t},i)}},_removeEvent:function(e,t){switch(e){case"LISTVIEWMODEL":this._listViewModelEventTokens[t]&&this._treeDoc.unsubscribe(this._listViewModelEventTokens[t],this._listViewModelEventTokens[t]=void 0);break;case"LISTVIEWMANAGER":this._listViewManagerEventTokens[t]&&this._manager._modelEvents.unsubscribe(this._listViewManagerEventTokens[t],this._listViewManagerEventTokens[t]=void 0);break;case"MASTER":this._masterModelEventTokens[t]&&this._model.unsubscribe(this._masterModelEventTokens[t],this._masterModelEventTokens[t]=void 0)}},onMasterNodeAttributeChanged:function(e){var t;if(t=e.target.__LISTVIEWCOPY__){var i={};i[e.data.changedAttribute]=e.data.changedAttributeValue,"function"==typeof t.refreshNodeData?t.refreshNodeData(i):t.setAttribute(e.data.changedAttribute,e.data.changedAttributeValue),this._manager.updateRowView(t._getRowID())}},updateColumns:function(e){var t="boolean"!=typeof e||e,i=this.options.columnManager.getColumns();t&&this.loadColumns(i);for(var n=0,o=i.length;n<o;n++)this._manager[i[n].isHidden?"hideColumn":"showColumn"](i[n].dataIndex)},getColumnManager:function(){return this.options.columnManager},prepareUpdateColumns:function(){this._isPreparingColumns++,this.prepareUpdateView()},pushUpdateColumns:function(){this._isPreparingColumns--,0===this._isPreparingColumns?(this.updateColumns(),this.pushUpdateView()):this._isPreparingColumns<0&&this._isPreparingColumns},onSort:function(e){var t=this._manager;"string"==typeof this.options.graphSortingColumnID&&e.columnDataIndex===this.options.graphSortingColumnID||Array.isArray(this.options.graphSortingColumnID)&&this.options.graphSortingColumnID.indexOf(e.columnDataIndex)>=0?(this.options.ascending="asc"===e.sortOrder,this._updateGraph(),t.isColumnHidden("__GRAPH__")&&(t.elements.poolContainerRel.getElement(".subway-graph-canvas").show(),t.showColumn("__GRAPH__"))):!t.isColumnHidden("__GRAPH__")&&(t.hideColumn("__GRAPH__"),t.elements.poolContainerRel.getElement(".subway-graph-canvas").hide())},cleanup:function(){this.deactivate(),this.empty()},setFocus:function(e){e instanceof d&&this._manager._setActiveAndScrollToNode(e.__LISTVIEWCOPY__)},setRowHeight:function(e){var t=this._manager;if(!isNaN(e)&&e>0&&t.options.defaultCellHeight!==e){this.prepareUpdateView();var i=this._treeDoc.getRoots();t._invalidateLayout(),t._instance._hideRowInsertionMark();for(var n=0,o=i.length;n<o;n++){var s=i[n]._getRowID(),a=t.getRowHeight(s);t.setCellsContainerSize({height:t.getCellsContainerSize().height-a+e},!1),t._listOfRowsHeight[s]=e,t._modelEvents.publish({event:"/MANAGER/ROW/HEIGHT",data:{rowID:s,height:e}})}t._indexRowsPosition({fromRowID:0,async:!1}),t.options.defaultCellHeight=e,this.pushUpdateViewAndUpdateGraph()}}},n)});