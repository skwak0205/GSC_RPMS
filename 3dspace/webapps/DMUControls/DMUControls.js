define("DS/DMUControls/DMUCurrentPageWidget",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(e,t,n){"use strict";return t.extend({init:function(t){var i=t||{};if(i.frameWindow){this._parent(i);var o,a,l,s=this,r=0;this.setOffset=function(e){o&&r!==e&&(r=e,o.setStyle("left",e+20+"px"))},this.updateCurrentPage=function(e){a&&a.value!==e.toString()&&(a.value=e,l=e.toString())},this.enableCurrentPageEdition=function(){a&&o&&(a.focus(),a.select(),o.addClassName("focused"))},this.setVisibility=function(e){o&&o.setStyle("visibility",e?"visible":"hidden")},this.clean=function(){a&&a.removeEvents(),o&&i.frameWindow.getUIFrame().removeChild(o),n.removeEvent(o,"onPrimaryPointerClick",s.enableCurrentPageEdition),o=a=null},o=e.createElement("div",{id:"DMUCurrentPageWidget",class:"DMUCurrentPageMainDiv"}).inject(i.frameWindow.getUIFrame()),n.addEvent(o,"onPrimaryPointerClick",s.enableCurrentPageEdition);var d=e.createElement("div",{class:"DMUCurrentPageDiv"}).inject(o),c=i.maxValue.toString().length;(a=e.createElement("input",{id:"DMUCurrentPageWidgetInput",class:"DMUCurrentPageInput",maxlength:c,value:1,autocomplete:"off",styles:{width:c+window.devicePixelRatio+"ch"}}).inject(d)).onchange=function(){h(parseInt(a.value)),o.removeClassName("focused")},a.onkeyup=function(e){"Enter"===e.key&&(h(parseInt(a.value)),this.blur())},a.onblur=function(){o.removeClassName("focused")},a.onclick=function(){a.select(),o.addClassName("focused")},e.createElement("span",{text:"/",styles:{margin:"0px 5px"}}).inject(d),e.createElement("span",{text:i.maxValue}).inject(d)}function h(e){isNaN(e)||e<=0||e>i.maxValue?a.value=l:(l=e,i.onValueChanged&&i.onValueChanged(e))}}})}),define("DS/DMUControls/DMUHTMLBox",["UWA/Core","UWA/Controls/Abstract","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseExperience/EXPToolsVisualization","DS/SceneGraphNodes/CSS2DNode","DS/Visualization/ThreeJS_DS","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){let l;this._parent(t);let s=new e.Element("div",{class:"DMUHTMLBoxWidget",style:{whiteSpace:"pre-line"}}),r=new e.Element("div",{class:"DMUHTMLMainDiv"}).inject(s),d=e.createElement("p",{contenteditable:!1,class:"DMUHTMLBoxParagraph"}).inject(r);function c(e){e.stopPropagation()}d.addEventListener("contextmenu",c),t.onTextModifiedCB&&t.onTextModificationEndCB&&(s.addEventListener("input",t.onTextModifiedCB),s.addEventListener("paste",e=>{if(!e)return;e.preventDefault();let t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)}),s.addEventListener("keydown",e=>{e&&("Escape"!==e.key&&27!==e.keyCode&&("Enter"!==e.key&&13!==e.keyCode||e.shiftKey)||(e.preventDefault(),t.onTextModificationEndCB()))}));let h=new o({html:s,position:t.positionBreakPoint3D,name:t.title});function u(e,n){l=e.clone();let o=i.getWindowPositionFromPoint(t.viewer,l,t.window);if(h&&h.getElement()&&(h.setMatrix((new a.Matrix4).setPosition(l)),h.updatePosition(),"center"===n)){let e=function(e){let t,n;if(h&&h.getElement()){let e=h.getElement();t=e.offsetHeight||e.style.pixelHeight,n=e.offsetWidth||e.style.pixelWidth}return t&&n?{left:e.left+n/2,top:e.top+t/2}:void 0}(o);e&&e.left&&e.top&&h.setOffset(new a.Vector2((o.left-e.left)*window.devicePixelRatio,(o.top-e.top)*window.devicePixelRatio))}}s.parentNode&&s.parentNode.style&&(s.parentNode.style.border="solid 0px transparent"),h._getExcludeFromCSO=function(){return!0},h.css2DNode.primitive=!0,t.parentNode.addChild(h),this.remove=function(){d&&d.removeEventListener("contextmenu",c),s&&s.destroy(),t&&t.parentNode&&t.parentNode.removeChild(h),h=s=null},this.focusAndSelectText=function(){window.getSelection().removeAllRanges();let e=document.createRange();e.selectNodeContents(d),window.getSelection().addRange(e),d.focus()},this.getText=function(){let e=[],t=(d.innerText||"").split("\n");for(let n=0;n<t.length;n++)(t[n]||n!==t.length-1)&&(t[n]=t[n].replace("\r",""),e.push(t[n]));return e},this.update=function(t){if(t.lOwnerData){let n=new e.Element("div",{class:"DMUHTMLBox"});r.insertBefore(n,d),t.lOwnerData.leftBorder&&r.setStyle("border-left",t.lOwnerData.leftBorder);let i=e.createElement("img",{class:"DMUHTMLBoxImage"}).inject(n);t.lOwnerData.imgURL&&(i.src=t.lOwnerData.imgURL);let o=new e.Element("div",{class:"DMUHTMLImageBox"}).inject(n),a=e.createElement("div",{class:"DMUHTMLOwnerBox"}).inject(o);e.createElement("p",{class:"DMUHTMLBoxOwner",text:t.lOwnerData.owner[0]}).inject(a).setStyles({color:t.lOwnerData.ownerColor}),e.createElement("p",{class:"DMUHTMLBoxDate",text:t.lOwnerData.owner[1]}).inject(a).setStyles({color:t.lOwnerData.dateColor,fontSize:t.lOwnerData.dateFontSize}),e.createElement("p",{class:"DMUHTMLBoxStampParagraph",text:t.lOwnerData.content}).inject(o).setStyles({color:t.lOwnerData.stampColor,fontWeight:t.lOwnerData.stampFontStyle}),d.setStyle("margin-left","30px")}let i;if(t.textAlign&&(r.style.textAlign=t.textAlign),t.padding&&(r.style.padding=t.padding),t.sFontName&&(r.style.fontFamily=t.sFontName),t.iFontSize&&(r.style.fontSize=t.iFontSize),t.sFontStyle&&("bold"===t.sFontStyle?r.style.fontWeight=t.sFontStyle:r.style.fontStyle=t.sFontStyle),t.cFontColor&&(r.style.color=n.colorToHex(t.cFontColor)),void 0!==t.bIsFilled&&(t.bIsFilled?t.cFillStyleColor&&(r.style.background=n.hexToRgb(n.colorToHex(t.cFillStyleColor),t.fOpacity?t.fOpacity:1)):r.style.background="none"),void 0!==t.bHasBorder&&(t.bHasBorder?(s.style.borderStyle="solid",t.cLineStyleColor&&(s.style.borderColor=n.colorToHex(t.cLineStyleColor)),t.fLineStyleThickness&&(s.style.borderWidth=t.fLineStyleThickness)):s.style.border="none"),t.borderRadius&&(s.style.borderRadius=t.borderRadius,s.parentElement.style.borderRadius=t.borderRadius,r.style.borderRadius=t.borderRadius,r.parentElement.style.borderRadius=t.borderRadius),t.lineHeight&&(s.style.lineHeight=t.lineHeight,d.style.lineHeight=t.lineHeight),t.sTextContents)for(d.innerHTML="",i=0;i<t.sTextContents.length;i++)d.innerHTML+=t.sTextContents[i],i!==t.sTextContents.length-1&&(d.innerHTML+="<br>");void 0!==t.bEditable&&d.contenteditable!==t.bEditable&&d.setAttributes({contenteditable:t.bEditable}),void 0!==t.rotationAngle&&(s.parentElement.style.transform="rotate("+-t.rotationAngle+"rad)"),t.position&&u(t.position,t.anchorMode)}}})}),define("DS/DMUControls/EXPNotify",["UWA/Class","DS/CATWebUXComponents/CATWebUXNotification"],function(e,t){"use strict";return e.extend({init:function(e){var n=new t;void 0===e.autoHide&&(e.autoHide=!0),n.build(e),this.destroy=function(){n&&n.destroy(),n=null}}})}),define("DS/DMUControls/EXPNavBar",["UWA/Core","UWA/Class","DS/Controls/TabBar","css!DS/DMUControls/DMUControls.css"],function(e,t,n){"use strict";return t.extend({init:function(t){var i=t||{};if(i.frameWindow){var o;this._parent(i);var a,l={},s=i.offset?i.offset:0,r=i.activeTabIndex?i.activeTabIndex:i.tabs?i.tabs[0].id:null,d=!0,c=function(){if(o&&a){var e=i.frameWindow.getImmersiveFrame().getFreeZone().getSize();if(e.width){var t=a.getWidthWithoutScroll(),n=e.width-s,l=t+100>n?n:t+100;o.setStyles({"max-width":l-50+"px",width:l-50+"px"});var r=0,d=i.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea),c=d.getContainedWindows();if(c&&(1===c.length&&c[0].isAWindowGroup()&&c[0].getEmbeddedWindows().length||1===c.length&&!c[0].isAWindowGroup())){for(var h=c[0].getEmbeddedWindows?c[0].getEmbeddedWindows():c,u=!1,m=0;m<h.length;m++)h[m].visibleFlag&&(u=!0);if(u&&!d.collapseDockingZoneFlag){var g=d._collapserSize;r=d.dockingZoneSize+g}}else d.interactiveDockAreaVisibleFlag&&(r=d.dockingZoneSize);r+=(n-l)/2+s+25,o.setStyles({left:r+"px"})}}};this.setOffset=function(e){s!==e&&(s=e,c())},this.getOffset=function(){return s},this.setVisibleFlag=function(e){o.setStyles({display:e?"":"none"})},this.getVisibleFlag=function(){return""===o.style.display},this.setActiveNarBarItem=function(e){a&&(d=!1,a.value=[e],r=e,d=!0)},this.getActiveNarBarItem=function(){if(a)return a.value},this.clean=function(){a&&(a.displayStyle="normal",a.destroy()),o&&i.frameWindow.getUIFrame().removeChild(o),l.onFreeZoneResize&&i.frameWindow&&i.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",c),o=a=null,l={}};if((o=e.createElement("div",{class:"EXPNavBar"}).inject(i.frameWindow.getUIFrame())).setStyles({opacity:0}),(a=new n({displayStyle:["strip","strip-box"],showComboBoxFlag:!0}).inject(o)).addEventListener("change",function(e){d&&e.dsModel.value[0]&&e.dsModel.value[0]!==r&&(r=e.dsModel.value[0],i.onClickCB(r)),d=!0}),i.tabs&&i.tabs.length)for(var h=0;h<i.tabs.length;h++)a.add({value:i.tabs[h].id,label:i.tabs[h].label});l.onFreeZoneResize||(i.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",c),l.onFreeZoneResize=1),r&&this.setActiveNarBarItem(i.activeTabIndex),setTimeout(function(){o&&(c(),o.setStyles({opacity:1}))},50)}}})}),define("DS/DMUControls/EXPColorPicker",["UWA/Core","UWA/Class","DS/Controls/Gauge","DS/Visualization/ThreeJS_DS","DS/VisuEvents/EventsManager","DS/WebappsUtils/WebappsUtils","DS/CoreEvents/Events","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s){"use strict";return t.extend({init:function(t){var r,d,c=t||{};this._parent(c);var h,u,m,g,p,C,f,v,y,b,w=a.getWebappsAssetUrl("DMUBaseUI","images/"),x=!1,D=this,S=!0,E=!0,k={color:!0,opacity:!0},M=!0,P=[{r:0,g:0,b:0},{r:25,g:25,b:25},{r:61,g:61,b:61},{r:75,g:75,b:75},{r:100,g:100,b:100},{r:125,g:125,b:125},{r:150,g:150,b:150},{r:175,g:175,b:175},{r:190,g:190,b:190},{r:205,g:205,b:205},{r:230,g:230,b:230},{r:255,g:255,b:255}],B=[{r:109,g:40,b:40},{r:204,g:9,b:47},{r:143,g:76,b:0},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:71,g:119,b:56},{r:141,g:222,b:228},{r:54,g:142,b:196},{r:77,g:98,b:186},{r:0,g:37,b:150},{r:155,g:42,b:152}];function U(e){"boolean"==typeof e.color&&(k.color=e.color,f&&f.setStyles({display:e.color?"block":"none"}),(-1!==P.indexOf(b)&&M||-1!==B.indexOf(b)&&!M)&&m()),"boolean"==typeof e.opacity&&(k.opacity=e.opacity,v&&(v.setStyles({display:e.opacity?"block":"none"}),e.opacity&&y.getContent().hasClassName("EXPOpacitySliderDisableHover")?y.getContent().removeClassName("EXPOpacitySliderDisableHover"):e.opacity||y.getContent().addClassName("EXPOpacitySliderDisableHover")))}function I(e){for(var t=e.from[0].view;t;){if(t.className&&-1!==t.className.indexOf("EXPColorPicker"))return;t=t.parentNode}D.clean()}this.getContent=function(){return r},this.build=function(t){if(S=!1,D.clean(),S=!0,t.displayColorSlider||t.displayOpacitySlider){var _,F,R;if(r=e.createElement("div",{class:"EXPColorPicker"}),t.displayColorSlider&&function(t){var a;d=new e.createElement("div",{class:"EXPColorPickerColorSlider"}).inject(r);var l=-1,s=-1;if(t.defaultColor){for(var c=new i.Color,h=0;h<B.length;h++)if(c.setRGB(B[h].r/255,B[h].g/255,B[h].b/255),c.equals(t.defaultColor)){s=h,M=!0,b=B[h];break}if(-1===s)for(var u=0;u<P.length;u++)if(c.setRGB(P[u].r/255,P[u].g/255,P[u].b/255),c.equals(t.defaultColor)){l=u,M=!1,b=P[u];break}}else s=0,M=!0;var p=M?-1!==s?s:6:l;g=new e.Element("div",{class:"EXPColorPickerBWSwitch"}).inject(d);var v=new e.createElement("img").inject(g);v.src=w+(M?"I_SwitchBWPalette.png":"I_SwitchColorPalette.png");var y=new n({className:"EXPColorPickerColorGauge",minValue:0,maxValue:B.length-1,stepValue:1,value:p,graduationsLabel:!1,dynamicGaugeColor:!1,eventsList:[]}).inject(d);a=y.getContent(),y.elements.control.setStyles({height:"30px",margin:0}),(f=y._cursors[1]).setStyles({height:"30px",width:"20px","border-radius":"0px","border-width":"4px 3px","border-style":"solid","border-color":"rgb(240, 240, 240)",outline:"1px solid #adadad"}),f.setHTML(""),y._cursors[0].setStyles({backgroundColor:"none"}),a.setAttributes({id:M?"color_gauge":"bw_gauge"}),a.setStyles({backgroundImage:'url("'+w+(M?"ColorPalette.jpg":"BWPalette.jpg")+'")',position:"absolute","margin-top":"14px",left:"30px"});var x=function(e){var n=[];if("color_gauge"===a.id?n=B:"bw_gauge"===a.id&&(n=P),!isNaN(y.getValue())){var i=y.getValue();b=n[i],f.setHTML(""),f.setStyles({backgroundImage:"none",backgroundColor:"rgb("+n[i].r+","+n[i].g+","+n[i].b+")","-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"}),t.onColorChangedCB&&(p=i,e.sendCB&&t.onColorChangedCB({color:"rgb("+n[p].r+","+n[p].g+","+n[p].b+")"}))}};y.addEvent("change",function(){C&&C.hasClassName("EXPColorPickerResetButtonActiveState")&&C.removeClassName("EXPColorPickerResetButtonActiveState"),x({sendCB:!0}),U({color:!0,opacity:t.colorAndOpacityBinded})}),m=function(){M=!M,"color_gauge"===a.id?(a.style.backgroundImage='url("'+w+'BWPalette.jpg")',a.id="bw_gauge",v.src=w+"I_SwitchColorPalette.png"):"bw_gauge"===a.id&&(a.style.backgroundImage='url("'+w+'ColorPalette.jpg")',a.id="color_gauge",v.src=w+"I_SwitchBWPalette.png"),k.color&&(p=-1,x({sendCB:!0}))},o.addEvent(g,"onPrimaryPointerClick",m),U({color:null!==t.defaultColor,opacity:t.colorAndOpacityBinded&&null!==t.defaultColor}),x({sendCB:!1})}(t),t.displayOpacitySlider&&(_=t,R=new e.createElement("div",{class:"EXPColorPickerOpacitySlider"}).inject(r),F=0===_.defaultOpacity?0:_.defaultOpacity?_.defaultOpacity:1,(y=new n({className:"EXPColorPickerOpacityGauge",minValue:_.minOpacity?_.minOpacity:0,maxValue:_.maxOpacity?_.maxOpacity:1,stepValue:.1,value:F,graduationsLabel:!1,dynamicGaugeColor:!1,eventsList:[]}).inject(R)).getContent().setStyles({"margin-top":"5px",border:"none"}),y.elements.control.setStyles({height:"10px",top:"4px"}),v=y._cursors[1],U({opacity:null!==_.defaultOpacity,color:_.colorAndOpacityBinded&&null!==_.defaultOpacity}),y._cursors[1].setStyles({height:"20px",top:"-4px"}),y.addEvent("change",function(){C&&C.hasClassName("EXPColorPickerResetButtonActiveState")&&C.removeClassName("EXPColorPickerResetButtonActiveState"),U({opacity:!0,color:_.colorAndOpacityBinded}),_.onOpacityChangedCB&&_.onOpacityChangedCB({opacity:this.getValue()}),this._cursors[1].setStyles({"-webkit-transform":"translate3d(-50%,0,0)","-moz-transform":"translate3d(-50%,0,0)","-ms-transform":"translate3d(-50%,0,0)","-o-transform":"translate3d(-50%,0,0)",transform:"translate3d(-50%,0,0)"})})),t.displayResetButton&&function(t){(C=new e.createElement("div",{class:"EXPColorPickerResetButton"}).inject(d)).title=t.resetButtonLabel,t.defaultResetState&&(C.addClassName("EXPColorPickerResetButtonActiveState"),U({color:!1,opacity:!1})),new e.createElement("img",{class:"EXPColorPickerResetButtonIcon"}).inject(C).src=a.getWebappsAssetUrl("DMUControls","icons/22/")+"I_ResetButton.png",p=function(){C.hasClassName("EXPColorPickerResetButtonActiveState")||(t.onResetButtonPressedCB(),C.addClassName("EXPColorPickerResetButtonActiveState"),U({color:!1,opacity:!1}))},o.addEvent(C,"onPrimaryPointerClick",p)}(t),E=!1!==t.hideWithDistance,c.frameWindow){var T=c.frameWindow.getContextualUIManager().getContextualBar(),j=T.getPosition();if(j&&T||t.position&&t.position.x&&t.position.y){var N=t.displayColorSlider&&t.displayOpacitySlider?80:t.displayColorSlider?53:30,A=238;t.displayResetButton&&(A+=35);var L=t.position?0:T.elements.container.getDimensions().width/2-A/2,H=t.position?0:T.elements.container.getDimensions().height,W=t.position?t.position.x:j.x+L,O=t.position?t.position.y:j.y-H-N-5;O<0&&(O=j.y+5),(h=new e.Element("div",{class:"EXPContextualColorPicker",styles:{position:"absolute",top:O+"px",left:W+"px",width:A+"px",height:N+"px",opacity:1}}).inject(c.frameWindow.getUIFrame())).appendChild(r),u=l.subscribe({event:"/VISU/"},function(e){var t=e.eventType;if("@onViewpointBeginMove"===t)D.clean();else if("@onMoveEvent"===t&&E){var n=new i.Box2(new i.Vector2(W,O),new i.Vector2(W+A,O+N)).distanceToPoint(e.event.getCurrentPosition(c.frameWindow.getContent()));n>200?D.clean():h.setStyles({opacity:Math.min((200-n)/200,1)})}}),s.addEvent(document,"onLeftMouseDown",I),s.addEvent(document,"onTouch",I)}}x=!0}},this.getVisibleFlag=function(){return!c.frameWindow||x},this.setVisibleFlag=function(e){c.frameWindow&&h&&(!x&&e?h.inject(c.frameWindow.getUIFrame()):x&&!e&&c.frameWindow.getUIFrame().removeChild(h),x=e)},this.clean=function(){c.frameWindow&&h&&h.parentNode===c.frameWindow.getUIFrame()&&c.frameWindow.getUIFrame().removeChild(h),m&&g&&o.removeEvent(g,"onPrimaryPointerClick",m),p&&C&&o.removeEvent(C,"onPrimaryPointerClick",p),u&&l.unsubscribe(u),s.removeEvent(document,"onLeftMouseDown",I),s.removeEvent(document,"onTouch",I),r=h=u=g=m=p=C=null,S&&c.onDestroyCB&&c.onDestroyCB()}}})}),define("DS/DMUControls/DMUContextToolsMenu",["UWA/Class","UWA/Core","DS/Controls/Button","css!DS/DMUControls/DMUControls.css"],function(e,t,n){"use strict";return e.extend({init:function(e){var i,o,a=[],l=[],s=t.createElement("div",{id:"DMUContextToolsMenu",class:"DMUContextToolsMenu"}).inject(e.frameWindow.getUIFrame()),r=t.createElement("div",{id:"DMUContextToolsCmdsContainer",class:"DMUContextToolsCmdsContainer"}).inject(s);function d(){var t=0,n=0,i=0,a=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),l=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.BottomDockArea),r=e.frameWindow.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea),d=a.getContainedWindows(),c=l.getContainedWindows(),h=r.getContainedWindows();if(d&&d.length&&(d[0].isAWindowGroup()&&d[0].getEmbeddedWindows().length||!d[0].isAWindowGroup())){for(var u=d[0].getEmbeddedWindows?d[0].getEmbeddedWindows():d,m=!1,g=0;g<u.length;g++)u[g].visibleFlag&&(m=!0);t=m&&!a.collapseDockingZoneFlag?a.dockingZoneSize+a._collapserSize:a._collapserSize}else a.interactiveDockAreaVisibleFlag&&(t=a.dockingZoneSize+a._collapserSize);if(c&&c.length&&(c[0].isAWindowGroup()&&c[0].getEmbeddedWindows().length||!c[0].isAWindowGroup())){for(var p=c[0].getEmbeddedWindows?c[0].getEmbeddedWindows():c,C=!1,f=0;f<p.length;f++)p[f].visibleFlag&&(C=!0);n=C&&!l.collapseDockingZoneFlag?l.dockingZoneSize+l._collapserSize:l._collapserSize}else l.interactiveDockAreaVisibleFlag&&(n=l.dockingZoneSize+l._collapserSize);if(h&&h.length&&(h[0].isAWindowGroup()&&h[0].getEmbeddedWindows().length||!h[0].isAWindowGroup())){for(var v=h[0].getEmbeddedWindows?h[0].getEmbeddedWindows():h,y=!1,b=0;b<v.length;b++)v[b].visibleFlag&&(y=!0);i=y&&!r.collapseDockingZoneFlag?r.dockingZoneSize+r._collapserSize:r._collapserSize}else r.interactiveDockAreaVisibleFlag&&(i=r.dockingZoneSize+r._collapserSize);o&&o.setStyles({left:"calc("+i+"px + 10px)",bottom:"calc("+n+"px + 40px)"}),s&&(s.setStyles({right:t+"px",top:"50%",transform:"translateY(calc(-50% - "+.5*n+"px))"}),s.getPosition().y<=0&&s.setStyles({right:t+"px",top:"0px",transform:""}))}function c(e){if(a&&a.length)for(var t=0;t<a.length;t++)a[t].buttonDiv.removeClassName("DMUContextToolsSelectedCmd"),a[t].id!==e||a[t].isOneShot||a[t].buttonDiv.addClassName("DMUContextToolsSelectedCmd")}function h(e){if(l&&l.length)for(var t=0;t<l.length;t++)l[t].removeClassName("selected"),l[t].id===e&&l[t].addClassName("selected")}e.frameWindow.getImmersiveFrame().addEventListener("freeZoneResize",d),this.addButton=function(e){if(e&&e.label&&e.id&&e.icon&&e.onClickCB){var i=t.createElement("div",{id:e.id,title:e.label,class:"DMUContextToolsCmdButton"}).inject(r),o=new n({label:e.id,showLabelFlag:!1,icon:e.icon,displayStyle:"lite",onClick:function(t){c(t.dsModel.label),e.onClickCB({id:t.dsModel.label})}}).inject(i),l={id:e.id,type:e.type?e.type:"exclusive",button:o,buttonDiv:i,isOneShot:void 0!==e.isOneShot&&e.isOneShot};a.push(l),e.isSelected&&c(e.id),d()}},this.createCornerButton=function(n){(o=new t.Element("button",{id:n.id,class:"DMUContextToolsCornerButton",styles:{"background-image":"url("+n.disabledIcon+")"}}).inject(e.frameWindow.getUIFrame())).addEvent("click",function(e){var t=o.hasClassName("selected");t?(o.removeClassName("selected"),o.setStyles({"background-image":"url("+n.disabledIcon+")"})):(o.addClassName("selected"),o.setStyles({"background-image":"url("+n.enabledIcon+")"})),n.onClickCB({id:e.target.id,checked:!t})}),d()},this.addSeparator=function(){t.createElement("div",{id:"DMUContextToolsCmdSeparator",class:"DMUContextToolsCmdSeparator"}).inject(r)},this.createColorPalette=function(e){e&&e.length&&(i||(this.addSeparator(),i=t.createElement("div",{id:"DMUContextColorPalette",class:"DMUContextColorPalette"}).inject(s),e.forEach(function(e){var n=new t.Element("button",{id:e.id,class:"DMUContextColorPaletteButton",styles:{"background-color":e.color.getStyle()}});n.addEvent("click",function(t){h(t.target.id),e.onClickCB({id:t.target.id})}),n.inject(i),l.push(n),e.isSelected&&n.addClassName("selected")})),d())},this.setColor=function(e){i&&h(e)},this.isCornerButtonActive=function(){return!(!o||!o.hasClassName("selected"))},this.setVisibleFlag=function(e){e?(o&&o.show(),s&&s.show()):(o&&o.hide(),s&&s.hide())},this.destroy=function(){e.frameWindow.getImmersiveFrame().removeEventListener("freeZoneResize",d),a&&a.length&&(a.forEach(function(e){e.buttonDiv.remove(),e.button=null}),a=null),s&&(e.frameWindow.getUIFrame().removeChild(s),s.remove(),s=null),r&&(r.remove(),r=null),i&&(i.remove(),i=null),o&&(o.remove(),o=null)}}})}),define("DS/DMUControls/EXPFileBrowser",["UWA/Core","UWA/Controls/Abstract"],function(e,t){"use strict";return t.extend({init:function(t){this._parent(t);var n=null,i=new FileReader,o=!1,a=null;function l(){!o&&t.onErrorCB&&t.onErrorCB()}(n=new e.createElement("input",{id:"DMUFileSelector"}).inject(window.widget.body)).setAttribute("type","file"),n.setAttribute("accept","image/*"),n.setStyles({opacity:0}),n.onchange=function(){if(n){var e=n.files;if(!e||e&&!e.length)return void l();a=e[0].name,i.onload=function(){var e=new Image;e.src=i.result,e.name=a,e.onload=function(){o=!0,t.onFileLoadedCB({img:e,name:a})},e.onerror=l},setTimeout(l,5e3),i.readAsDataURL(e[0])}},this.openFileBrowser=function(){n.click()},this.cleanFileBrowser=function(){n&&n.parentNode===window.widget.body&&window.widget.body.removeChild(n),n=null}}})}),define("DS/DMUControls/DMUBaseSlider",["UWA/Core","UWA/Class","DS/Utilities/TouchUtils","DS/Controls/Slider","DS/Controls/Toggle","DS/Controls/ComboBox","DS/VisuEvents/EventsManager","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s){"use strict";return t.extend({init:function(t){if(!t)return;let r,d,c,h,u,m=0,g={},p=null,C=null;function f(){if(!r)return;let e=t.getImmersiveFrame().getFreeZone().getSize();if(e.width){let n=0,i=t.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.LeftDockArea),o=i.getContainedWindows();if(o&&(1===o.length&&o[0].isAWindowGroup()&&o[0].getEmbeddedWindows().length||1===o.length&&!o[0].isAWindowGroup())){let e=o[0].getEmbeddedWindows?o[0].getEmbeddedWindows():o,t=!1;for(let n=0;n<e.length;n++)e[n].visibleFlag&&(t=!0);if(t&&!i.collapseDockingZoneFlag){let e=i._collapserSize;n=i.dockingZoneSize+e}}else i.interactiveDockAreaVisibleFlag&&(n=i.dockingZoneSize);n+=e.width/2-m/2,r.setStyles({opacity:"1",left:n+"px",width:m+"px"})}}this.build=function(v){let y=v||{};if(isNaN(y.value))return;if(isNaN(y.minValue))return;if(isNaN(y.maxValue))return;if(isNaN(y.stepValue))return;(y.value<y.minValue||y.value>y.maxValue)&&(y.value=.5*(y.minValue+y.maxValue)),y.viewerCanvas&&(p=y.viewerCanvas),(r=new e.Element("div",{class:"DMUBaseTranslationSliderSpinnerContainer"}).inject(t.getUIFrame())).setStyles({opacity:"0"}),void 0!==y.leftButton&&(void 0!==y.leftButton.color?(c=e.createElement("div",{class:"DMUBaseSideButton",title:y.leftButton.title}).inject(r),n.getTouchMode()&&c.setStyles({width:"24px",height:"24px"}),c.style.background=y.leftButton.color,c.addEventListener("click",function(){C&&(C.value!==y.minValue?(u=C.value,C.value=y.minValue):u&&(C.value=u,u=void 0))})):void 0!==y.leftButton.icon&&(c=new e.createElement("img",{class:"DMUBaseSideButton",src:y.leftButton.iconPath,styles:{left:"0px"}}).inject(r)),m+=n.getTouchMode()?36:24);let b,w,x=e.createElement("div",{class:"DMUBaseTranslationSliderContainer",styles:{display:""}}).inject(r);if(C=new i({minValue:y.minValue,maxValue:y.maxValue,stepValue:y.stepValue,value:y.value}).inject(x),m+=220,C.addEventListener("change",function(){y.onChangeCB&&y.onChangeCB(C.value)}),void 0!==y.rightButton&&(void 0!==y.rightButton.color?(h=e.createElement("div",{class:"DMUBaseSideButton",title:y.rightButton.title}).inject(r),n.getTouchMode()&&h.setStyles({width:"24px",height:"24px"}),h.style.background=y.rightButton.color,h.addEventListener("click",function(){C&&(C.value!==y.maxValue?(u=C.value,C.value=y.maxValue):void 0!==u&&(C.value=u,u=void 0))})):void 0!==y.rightButton.icon&&(h=new e.createElement("img",{class:"DMUBaseSideButton",src:y.rightButton.iconPath}).inject(r)),m+=n.getTouchMode()?36:24),y.subMenuItems){let t,i;(w=new e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot",title:s.compareMenuIcon}).inject(r)).addClassName("DMUBaseViewMenuIcon"),n.getTouchMode()&&w.setStyles({"font-size":"24px"}),w.addEventListener("click",function(){w&&b&&(w.hasClassName("DMUBaseViewMenuIconOnClick")?(w.removeClassName("DMUBaseViewMenuIconOnClick"),b.setStyle("display","none")):(w.addClassName("DMUBaseViewMenuIconOnClick"),b.setStyle("display","")))}),m+=n.getTouchMode()?34:24,b=e.createElement("div",{class:"DMUBaseViewMenuContainer",styles:{display:"none"}}).inject(r),y.subMenuItems.forEach(function(e){"combo"===e.type?((i=new a({elementsList:e.elementList,enableSearchFlag:e.enableSearchFlag,value:e.value})).addEventListener("change",function(){e.callBack&&e.callBack(i.value)}),i.inject(b)):((t=new o({type:e.type,label:e.label,checkFlag:e.checkFlag})).addEventListener("buttonclick",function(){e.callBack&&e.callBack(t.checkFlag)}),t.inject(b))}),y.subMenuItems.length>=1&&b.setStyles({height:10+y.subMenuItems.length*(n.getTouchMode()?38:24)+"px"}),d=function(){w.hasClassName("DMUBaseViewMenuIconOnClick")&&(w.removeClassName("DMUBaseViewMenuIconOnClick"),b.setStyle("display","none"))},p&&l.addEvent(p,"onPrimaryPointerClick",d)}if(y.lastButton){let t=new e.createElement("div",{class:y.lastButton.iconClassName,title:y.lastButton.title}).inject(r);t.addClassName("DMUBaseViewMenuIcon"),n.getTouchMode()&&t.setStyles({"font-size":"24px"}),t.addEventListener("click",function(){y.lastButton.callBack(!0)}),m+=n.getTouchMode()?34:24}g.onFreeZoneResize||(t.getImmersiveFrame().addEventListener("freeZoneResize",f),g.onFreeZoneResize=1),setTimeout(function(){r&&f()},50)},this.update=function(e){e.value&&C&&(C.value=e.value),h&&(e.rightButton.color&&(h.style.background=e.rightButton.color),e.rightButton.title&&(h.title=e.rightButton.title)),c&&(e.leftButton.color&&(c.style.background=e.leftButton.color),e.leftButton.title&&(c.title=e.leftButton.title))},this.clean=function(){t&&r&&r.parentNode===t.getUIFrame()&&t.getUIFrame().removeChild(r),g.onFreeZoneResize&&t&&t.getImmersiveFrame().removeEventListener("freeZoneResize",f),p&&d&&l.removeEvent(p,"onPrimaryPointerClick",d),C=p=null,d=null,r=null,u=void 0,m=0}}})}),define("DS/DMUControls/EXPWindow",["UWA/Controls/Abstract","UWA/Controls/Drag","i18n!DS/DMUControls/assets/nls/DMUControls","WebappsUtils/WebappsUtils"],function(e,t,n,i){"use strict";return e.extend({defaultOptions:{body:null,height:"320",width:"320",title:"Window Title",position:{top:"50",left:"50"},fTopbarHeight:30,fManipulatorSize:10,fMarginAroundViewer:10,fResizeMinHeight:320,fResizeMinWidth:320,fCornerRoundRadius:4,bTopBarButtons:!0,bFullScreenOnDbclickTopbar:!0,bScaleManipulator:!0,bMoveManipulator:!0,bBoxShadow:!0,bBoldTitle:!1},init:function(e){this._domElements={_mainContainer:null,_topbarContainer:null,_topbarTitle:null,_topbarButtonContainer:null,_topbarTitleText:null,_Containerviewer:null,_viewer:null,_sizeControlLeft:null,_sizeControlRight:null,_sizeControlBottom:null,_sizeControlBottomLeft:null,_sizeControlBottomRight:null};var t=UWA.extend(this.defaultOptions,e);this._fullscreenObject={_bFullscreenIsEnable:!1,mainContainerPreFullscreenPosition:null,mainContainerPreFullscreenSize:null},this._dragEventParameters={mainContainerOriginalPosition:null,mainContainerOriginalSize:null},this._parent(t),this._createWindow()},setHTMLContent:function(e){e&&e.inject&&(e.inject(this._domElements._viewer),e.style.width="100%",e.style.height="100%")},setVisibility:function(e){var t=e?"block":"none";this._domElements._mainContainer.setStyle("display",t)},show:function(){this._domElements._mainContainer.setStyle("display","block")},noShow:function(){this._domElements._mainContainer.setStyle("display","none")},clear:function(){this._domElements._mainContainer.destroy()},isShow:function(){return!("none"===this._domElements._mainContainer.getStyle("display"))},setFullScreen:function(e,t){e?(this._fullscreenObject.mainContainerPreFullscreenPosition=this._domElements._mainContainer.getPosition(),this._fullscreenObject.mainContainerPreFullscreenSize=this._domElements._mainContainer.getSize(),this._domElements._mainContainer.setStyle("width",this.options.body.parentElement.getSize().width+"px"),this._domElements._mainContainer.setStyle("height",this.options.body.parentElement.getSize().height+"px"),this._domElements._mainContainer.setPosition({x:0,y:0}),this.options.bTopBarButtons&&(this._domElements._topBarMinimizeButton.setStyle("display","inline-block"),this._domElements._topBarMaximizeButton.setStyle("display","none")),this._fullscreenObject._bFullscreenIsEnable=!0):(this.options.bTopBarButtons&&(this._domElements._topBarMinimizeButton.setStyle("display","none"),this._domElements._topBarMaximizeButton.setStyle("display","inline-block")),t||(this._domElements._mainContainer.setStyle("width",this._fullscreenObject.mainContainerPreFullscreenSize.width+"px"),this._domElements._mainContainer.setStyle("height",this._fullscreenObject.mainContainerPreFullscreenSize.height+"px"),this._domElements._mainContainer.setPosition(this._fullscreenObject.mainContainerPreFullscreenPosition)),this._fullscreenObject._bFullscreenIsEnable=!1),this._updateSize()},isFullScreen:function(){return this._fullscreenObject._bFullscreenIsEnable},_createWindow:function(){this._createMainContainer(),this._createTopbarContainer(),this._createTopbarTitle(),this.options.bTopBarButtons&&this._createTopbarButtonContainer(),this._createViewerContainer(),this._createViewer(),this.options.bScaleManipulator&&this._createSizeControl(),this.setHTMLContent(this.options.HTMLContent)},_createUWADiv:function(e){return UWA.createElement("div",{styles:e})},_createUWATopButton:function(e,t,n){var i='<span title="'+t+'"><img src='+e+" ></span>";return UWA.createElement("button",{html:i,styles:{padding:"0",border:"0",backgroundColor:"#F0F0F0",display:"inline-block",verticalAlign:"middle",marginLeft:"5px",outlineStyle:"none"},events:{click:function(){n()}}})},_createMainContainer:function(){this._domElements._mainContainer=this._createUWADiv({position:"absolute",height:this.options.height,borderRadius:this.options.fCornerRoundRadius+"px",width:this.options.width,backgroundColor:"#F0F0F0",boxShadow:this.options.bBoxShadow?"0 1px 1px 0px rgba(26,25,25,0.24)":"none",top:this.options.position.top+"px",left:this.options.position.left+"px",overflow:"visible",border:"1px solid #D1D1D1"}),this._domElements._mainContainer.inject(this.options.body)},_createTopbarContainer:function(){this._domElements._topbarContainer=this._createUWADiv({position:"relative",height:this.options.fTopbarHeight+"px",width:"100%",cursor:"default",overflow:"hidden"}),this._domElements._topbarContainer.inject(this._domElements._mainContainer);var e=this;if(this.options.bFullScreenOnDbclickTopbar&&this._domElements._topbarContainer.addEvent("dblclick",function(){e.setFullScreen(!e.isFullScreen())}),this.options.bMoveManipulator){var n=new t({element:this._domElements._topbarContainer});n.move=function(){if(e.isFullScreen()){var t=e._domElements._mainContainer.getSize(),n=e._domElements._mainContainer.getPosition(),i=100*this.currentEvent.clientX/t.width*e._fullscreenObject.mainContainerPreFullscreenSize.width/100,o=this.currentEvent.clientX-i,a=n.y+this.currentDelta.y;e._domElements._mainContainer.setPosition({x:o,y:a}),e._startDrag(this,e),e.setFullScreen(!1)}var l=e._manipulatorComputeChecker(this,"drag");e._domElements._mainContainer.setPosition({x:l.position.x,y:l.position.y})},n.start=function(){e._startDrag(this,e)}}},_createTopbarTitle:function(){this._domElements._topbarTitle=this._createUWADiv({position:"absolute",height:"100%",lineHeight:this.options.fTopbarHeight+"px",width:"auto",overflow:"hidden"}),this._domElements._topbarTitle.className="topbarTitleEXPWin",this._domElements._topbarTitle.inject(this._domElements._topbarContainer),this._domElements._topbarTitleText=this._createUWADiv({display:"inline-block",verticalAlign:"middle",lineHeight:"normal",overflow:"hidden",marginLeft:this.options.fMarginAroundViewer+"px",fontFamily:"Open Sans,Segoe UI,Helvetica,Arial,sans-serif",whiteSpace:"nowrap",textOverflow:"ellipsis",fontSize:"13px",fontWeight:this.options.bBoldTitle?"bold":"normal"}),this._domElements._topbarTitleText.inject(this._domElements._topbarTitle),this._domElements._topbarTitleText.setText(this.options.title)},_createTopbarButtonContainer:function(){var e=this;this._domElements._topbarButtonContainer=this._createUWADiv({position:"absolute",height:"100%",width:100,right:0,textAlign:"right",lineHeight:this.options.fTopbarHeight+"px",marginRight:this.options.fMarginAroundViewer+"px",overflow:"hidden"}),this._domElements._topbarButtonContainer.inject(this._domElements._topbarContainer);var t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/maximize.png",o=n.maximize,a=function(){e.setFullScreen(!0)};this._domElements._topBarMaximizeButton=this._createUWATopButton(t,o,a),this._domElements._topBarMaximizeButton.inject(this._domElements._topbarButtonContainer),t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/minimize.png",o=n.minimize,a=function(){e.setFullScreen(!1)},this._domElements._topBarMinimizeButton=this._createUWATopButton(t,o,a),this._domElements._topBarMinimizeButton.setStyle("display","none"),this._domElements._topBarMinimizeButton.inject(this._domElements._topbarButtonContainer),t=i.getWebappsBaseUrl()+"DMUControls/assets/icons/cancel.png",o=n.close,a=function(){e.setVisibility(!1)},this._createUWATopButton(t,o,a).inject(this._domElements._topbarButtonContainer)},_createViewerContainer:function(){this._domElements._viewerContainer=this._createUWADiv({position:"relative",height:this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight,width:"100%",overflow:"hidden",paddingRight:this.options.fMarginAroundViewer+"px",paddingLeft:this.options.fMarginAroundViewer+"px",paddingBottom:this.options.fMarginAroundViewer+"px"}),this._domElements._viewerContainer.inject(this._domElements._mainContainer)},_createViewer:function(){this._domElements._viewer=this._createUWADiv({position:"relative",height:"100%",width:"100%",overflow:"hidden"}),this._domElements._viewer.inject(this._domElements._viewerContainer)},_manipulatorComputeChecker:function(e,t){var n={size:{width:null,height:null},position:{x:null,y:null}};if("left"===t){let t=this._dragEventParameters.mainContainerOriginalSize.width-e.currentDelta.x;if(t<this.options.fResizeMinWidth){var i=this._domElements._mainContainer.getPosition().x+this._domElements._mainContainer.getSize().width;n.size.width=this.options.fResizeMinWidth,n.position.x=i-this.options.fResizeMinWidth}else n.size.width=t,n.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+e.currentDelta.x}if("right"===t){let t=this._dragEventParameters.mainContainerOriginalSize.width+e.currentDelta.x;t<this.options.fResizeMinWidth?n.size.width=this.options.fResizeMinWidth:n.size.width=t}if("bottom"===t){var o=this._dragEventParameters.mainContainerOriginalSize.height+e.currentDelta.y;o<this.options.fResizeMinHeight?n.size.height=this.options.fResizeMinHeight:n.size.height=o}if(n.position.x<0){var a=this._dragEventParameters.mainContainerOriginalPosition.x+this._dragEventParameters.mainContainerOriginalSize.width;n.position.x=0,n.size.width=a}return this._domElements._mainContainer.getPosition().x+n.size.width>this.options.body.parentElement.getSize().width&&(n.size.width=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getPosition().x),this._domElements._mainContainer.getPosition().y+n.size.height>this.options.body.parentElement.getSize().height&&(n.size.height=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getPosition().y),"drag"===t&&(n.position.x=this._dragEventParameters.mainContainerOriginalPosition.x+e.currentDelta.x,n.position.y=this._dragEventParameters.mainContainerOriginalPosition.y+e.currentDelta.y,n.position.x+this._domElements._mainContainer.getSize().width>this.options.body.parentElement.getSize().width&&(n.position.x=this.options.body.parentElement.getSize().width-this._domElements._mainContainer.getSize().width),n.position.y+this._domElements._mainContainer.getSize().height>this.options.body.parentElement.getSize().height&&(n.position.y=this.options.body.parentElement.getSize().height-this._domElements._mainContainer.getSize().height),n.position.x<0&&(n.position.x=0),n.position.y<0&&(n.position.y=0)),n},_createSizeControl:function(){var e=this;this._domElements._sizeControlLeft=this._createUWADiv({position:"absolute",bottom:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden"}),this._domElements._sizeControlLeft.inject(this._domElements._mainContainer);var n=new t({element:this._domElements._sizeControlLeft});n.start=function(){e._startDrag(this,e)},n.move=function(){var t=e._manipulatorComputeChecker(this,"left");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e._domElements._mainContainer.setPosition({x:t.position.x,y:e._dragEventParameters.mainContainerOriginalPosition.y}),e.isFullScreen()&&e.setFullScreen(!1,!0)},this._domElements._sizeControlRight=this._createUWADiv({position:"absolute",bottom:0,right:0,height:"100%",width:this.options.fManipulatorSize+"px",cursor:"ew-resize",overflow:"hidden"}),this._domElements._sizeControlRight.inject(this._domElements._mainContainer);var i=new t({element:this._domElements._sizeControlRight});i.start=function(){e._startDrag(this,e)},i.move=function(){var t=e._manipulatorComputeChecker(this,"right");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0)},this._domElements._sizeControlBottom=this._createUWADiv({position:"absolute",left:0,bottom:0,height:this.options.fManipulatorSize+"px",width:"100%",cursor:"ns-resize",overflow:"hidden"}),this._domElements._sizeControlBottom.inject(this._domElements._mainContainer);var o=new t({element:this._domElements._sizeControlBottom});o.start=function(){e._startDrag(this,e)},o.move=function(){var t=e._manipulatorComputeChecker(this,"bottom");e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()},this._domElements._sizeControlBottomLeft=this._createUWADiv({position:"absolute",left:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nesw-resize",overflow:"hidden"}),this._domElements._sizeControlBottomLeft.inject(this._domElements._mainContainer);var a=new t({element:this._domElements._sizeControlBottomLeft});a.start=function(){e._startDrag(this,e)},a.move=function(){var t=e._manipulatorComputeChecker(this,"left");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),e._domElements._mainContainer.setPosition({x:t.position.x,y:e._dragEventParameters.mainContainerOriginalPosition.y}),t=e._manipulatorComputeChecker(this,"bottom"),e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()},this._domElements._sizeControlBottomRight=this._createUWADiv({position:"absolute",right:0,bottom:0,width:this.options.fManipulatorSize+"px",height:this.options.fManipulatorSize+"px",cursor:"nwse-resize",overflow:"hidden"}),this._domElements._sizeControlBottomRight.inject(this._domElements._mainContainer);var l=new t({element:this._domElements._sizeControlBottomRight});l.start=function(){e._startDrag(this,e)},l.move=function(){var t=e._manipulatorComputeChecker(this,"right");e._domElements._mainContainer.setStyle("width",t.size.width+"px"),t=e._manipulatorComputeChecker(this,"bottom"),e._domElements._mainContainer.setStyle("height",t.size.height+"px"),e.isFullScreen()&&e.setFullScreen(!1,!0),e._updateSize()}},_updateSize:function(){this._domElements._viewerContainer.setStyle("height",this._domElements._mainContainer.offsetHeight-this.options.fTopbarHeight+"px")},_startDrag:function(e,t){t._dragEventParameters.mainContainerOriginalPosition=t._domElements._mainContainer.getPosition(),t._dragEventParameters.mainContainerOriginalSize=t._domElements._mainContainer.getSize()}})}),define("DS/DMUControls/panels/DMUCustomColorPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Controls/ColorChooser","DS/Controls/Button","DS/WebappsUtils/WebappsUtils","DS/VisuEvents/EventsManager","DS/Core/ModelEvents","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s,r){"use strict";return t.extend({init:function(t){let d,c,h=t||{};this._parent(h);let u,m=new s,g=[],p=[];function C(e,t){return m.publish({event:e,data:t,context:this})}function f(e){if(e){let t=e.from[0].view.style.background;u=new n.Color(t.split(" ").join("")).getHexString()}u&&p.forEach(e=>{e.div.setStyles({outline:e.color===u?"4px #42a2da solid":""})})}function v(){for(;c.firstChild;)c.removeChild(c.firstChild);var t,n;g.forEach(e=>{l.removeEventFromToken(e)}),g.length=0;var i=new e.Element("div",{class:"DMUCustomColorContainer"}).inject(c);if(h.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),p.length>0)for(t=0;t<5;t++)p[t]&&(n=new e.Element("div",{class:"DMUCustomColorSquare"}).inject(i),h.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),n.style.background="#"+p[t].color,g.push(l.addEvent(n,"onPrimaryPointerClick",f)),p[t].div=n);if(p.length>5)for(i=new e.Element("div",{class:"DMUCustomColorContainer"}).inject(c),h.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),t=5;t<10;t++)p[t]&&(n=new e.Element("div",{class:"DMUCustomColorSquare"}).inject(i),h.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),n.style.background="#"+p[t].color,g.push(l.addEvent(n,"onPrimaryPointerClick",f)),p[t].div=n);f()}this.build=function(t){d=new e.Element("div",{class:"DMU3DCustomMainDiv"}),c=new e.Element("div",{class:"DMUCustomColorPalette"}).inject(d),h.touchMode&&c.setAttributeNode(document.createAttribute("touch-mode")),t.forEach(e=>{p.push({color:e})}),v();var n=new i({value:"ffffff"});n.getContent().setStyles({width:h.touchMode?"400px":"360px"});var l=new e.Element("div",{class:"DMUCustomPanelBtnDiv"}).inject(d);h.touchMode&&l.setAttributeNode(document.createAttribute("touch-mode"));var s=new o({icon:a.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRAddColor.png"}).inject(l);h.touchMode&&s.getContent().setStyles({width:"40px","min-width":"40px"});var m=new o({icon:a.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRRemoveColor.png",disabled:0===p.length}).inject(l);h.touchMode&&m.getContent().setStyles({width:"40px","min-width":"40px"});var g=new o({icon:a.getWebappsAssetUrl("DMUBaseUI","images/")+"I_DMRUpdateColor.png",disabled:0===p.length}).inject(l);h.touchMode&&g.getContent().setStyles({width:"40px","min-width":"40px"}),s.getContent().addClassName("DMUCustomSwitchColorButton"),s.addEventListener("click",function(){if(0===p.length&&(m.disabled=!1,g.disabled=!1),p.length<10){for(let e=0;e<p.length;e++)if(n.value===p[e].color)return;p.push({color:n.value}),null!==u&&(n.referenceValue=u),u=n.value,v(),10===p.length&&(s.disabled=!0)}}),m.getContent().addClassName("DMUCustomSwitchColorButton"),m.addEventListener("click",function(){if(1===p.length?(m.disabled=!0,g.disabled=!0):10===p.length&&(s.disabled=!1),p.length>0&&u)for(let e=0;e<p.length;e++)if(u===p[e].color)return p.splice(e,1),u=p.length&&p[e]?p[e].color:p[e-1]?p[e-1].color:null,void v()}),g.getContent().addClassName("DMUCustomSwitchColorButton"),g.addEventListener("click",function(){if(p.length>0&&u){for(let e=0;e<p.length;e++)if(n.value===p[e].color)return;for(let e=0;e<p.length;e++)if(u===p[e].color)return n.referenceValue=u,p[e].color=n.value,u=n.value,void v()}}),n.inject(d);var f=new e.Element("div",{class:"DMUCustomPanelBottomBtnDiv"}).inject(d),y=new o({label:r.grpPanelLabel.ok}).inject(f);y.getContent().addClassName("DMUCustomColorButton"),y.getContent().addEventListener("buttonclick",function(){C("onCustomColorPanelOk",{customColors:p.map(e=>e.color),selectedColor:u})});var b=new o({label:r.grpPanelLabel.cancel}).inject(f);return b.getContent().addClassName("DMUCustomColorButton"),b.getContent().addEventListener("buttonclick",function(){C("onCustomColorPanelCancel")}),d},this.setCurrentCustomColor=function(e){p.length>0&&p.forEach(t=>{new n.Color("#"+t.color).equals(e)&&(t.div.setStyles({outline:"4px #42a2da solid"}),u=t.color)})},this.clean=function(){g.forEach(e=>{l.removeEventFromToken(e)}),g.length=0,d=null},this.subscribe=function(e,t){if(e&&t)return m.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&m.unsubscribe(e)}}})}),define("DS/DMUControls/DMUPasteWithOptionsPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){var l=t||{};if(this._parent(l),l.frmWindow){var s,r,d=e.createElement("div",{class:"DMUPasteSpecialPanelMainDiv"});if(l.prefs&&l.prefs.overloadPasteSpecial){var c=new o({label:a.PasteSpecialPanel.graphicOverloads,value:"DMUPasteSpecial_OccGraphicProps",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_OccGraphicProps")}).inject(d),h=new o({label:a.PasteSpecialPanel.positionOverloads,value:"DMUPasteSpecial_OccPositions",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_OccPositions")}).inject(d);r=function(e){var t={},n=c.checkFlag;localStorage.setItem("DMUPasteSpecial_OccGraphicProps",n?"true":"false"),t.graphicProps=n,n=h.checkFlag,localStorage.setItem("DMUPasteSpecial_OccPositions",n?"true":"false"),t.positions=n,l&&l.cb&&l.cb(t,e),s.close?s.close():s.destroy()}}else{var u;l.prefs&&l.prefs.displayCameraPref&&(u=new o({label:a.PasteSpecialPanel.cameraLabel,value:"DMUPasteSpecial_Camera",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_Camera")}).inject(d));var m,g,p,C=new o({label:a.PasteSpecialPanel.formattingLabel,value:"DMUPasteSpecial_3DFormatting",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_3DFormatting")}).inject(d),f=new o({label:a.PasteSpecialPanel.markers3DLabel,value:"DMUPasteSpecial_3DMarkers",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_3DMarkers")}).inject(d),v=new o({label:a.PasteSpecialPanel.markers2DLabel,value:"DMUPasteSpecial_2DMarkers",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_2DMarkers")}).inject(d);l.prefs&&l.prefs.displayAssociateFormatPref&&(m=new o({label:a.PasteSpecialPanel.formatLabel,value:"DMUPasteSpecial_Format",type:"checkbox",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_Format")}).inject(d)),l.prefs&&l.prefs.displayAssociateFormatToSlidePref&&(g=new o({label:a.PasteSpecialPanel.associateFormatLabel,value:"DMUPasteSpecial_AssociateFormat",type:"switch",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_AssociateFormat")}).inject(d)).elements.container.setStyles({"text-align":"right","margin-top":"10px"}),l.prefs&&l.prefs.displayCreateNewSlidePref&&(p=new o({label:a.PasteSpecialPanel.createNewSlideLabel,value:"DMUPasteSpecial_CreateNewSlide",type:"switch",checkFlag:"false"!==localStorage.getItem("DMUPasteSpecial_CreateNewSlide")}).inject(d)).elements.container.setStyles({"text-align":"right","margin-top":"10px"}),r=function(e){var t,n={};u&&(t=u.checkFlag,localStorage.setItem("DMUPasteSpecial_Camera",t?"true":"false"),n.camera=t),t=C.checkFlag,localStorage.setItem("DMUPasteSpecial_3DFormatting",t?"true":"false"),n.formatting=t,t=f.checkFlag,localStorage.setItem("DMUPasteSpecial_3DMarkers",t?"true":"false"),n.markers3D=t,t=v.checkFlag,localStorage.setItem("DMUPasteSpecial_2DMarkers",t?"true":"false"),n.markers2D=t,m&&(t=m.checkFlag,localStorage.setItem("DMUPasteSpecial_Format",t?"true":"false"),n.format=t),g&&(t=g.checkFlag,localStorage.setItem("DMUPasteSpecial_AssociateFormat",t?"true":"false"),n.associateFormat=t),p&&(t=p.checkFlag,localStorage.setItem("DMUPasteSpecial_CreateNewSlide",t?"true":"false"),n.createNewSlide=t),l&&l.cb&&l.cb(n,e),s.close?s.close():s.destroy()}}var y={};y.Ok=new i({emphasize:"primary",onClick:function(){r(!1)}}),y.Abort=new i({label:a.warningPanel.cancelLabel,onClick:function(){s.close?s.close():s.destroy()}}),l.prefs&&l.prefs.applyButtonNls&&(y.Apply=new i({label:l.prefs.applyButtonNls,onClick:function(){r(!0)}})),s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.panelTitle?t.panelTitle:a.PasteSpecialPanel.pasteSpecialPanelTitle,content:d,immersiveFrame:l.frmWindow.getImmersiveFrame(),buttons:y})}}})}),define("DS/DMUControls/DMUWarningPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){if(this._parent(t),t&&t.frmWindow&&t.message){var l,s,r=e.createElement("div",{class:"DMUWarningPanelMainDiv"});e.createElement("span",{class:"DMUWarningPanelIcon fonticon fonticon-attention fonticon-3x"}).inject(r),e.createElement("p",{class:"DMUWarningPanelLabel"}).inject(r).innerHTML=t.message,t.checkboxMessage&&(l=new o({type:"checkbox",label:t.checkboxMessage,value:0,checkFlag:t.checked})).inject(r);var d={Ok:new i({emphasize:"primary",label:a.warningPanel.okLabel,onClick:function(){t.callbacks&&t.callbacks.onValidateCB&&t.callbacks.onValidateCB(l?l.checkFlag:null),s.close()}})};t.callbacks&&t.callbacks.onCancelCB&&(d.Cancel=new i({label:a.warningPanel.cancelLabel,onClick:function(){t.callbacks.onCancelCB(),s.close()}})),(s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.title?t.title:a.warningPanel.defaultTitle,content:r,immersiveFrame:t.frmWindow.getImmersiveFrame(),buttons:d})).addEventListener("close",function(){t.callbacks&&t.callbacks.onCloseCB&&t.callbacks.onCloseCB(),s=null}),this.destroy=function(){s&&s.close()}}}})}),define("DS/DMUControls/DMUInfoModalDiv",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/UIKIT/Spinner","DS/Controls/ProgressBar"],function(e,t,n,i,o){"use strict";return t.extend({init:function(){var t,a,l,s,r;function d(){var e=0;if(s){var t=s.getImmersiveFrame().getDockingElement(WUXDockAreaEnum.RightDockArea),n=t.getContainedWindows();if(n&&n.length&&(n[0].isAWindowGroup()&&n[0].getEmbeddedWindows().length||!n[0].isAWindowGroup())){for(var i=n[0].getEmbeddedWindows?n[0].getEmbeddedWindows():n,o=!1,a=0;a<i.length;a++)i[a].visibleFlag&&(o=!0);if(o&&!t.collapseDockingZoneFlag){var r=t._collapserSize;e=t.dockingZoneSize+r}}else t.interactiveDockAreaVisibleFlag&&(e=t.dockingZoneSize);e+=20,l&&l.setStyles({right:e+"px"})}}this._parent(),this.display=function(c){if(c&&c.frmWindow&&c.type&&!l){var h;if(s=c.frmWindow,l=e.createElement("div",{class:"DMUInfoDiv"}),"load"===c.type){if(h=e.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(l),a=new i({visible:!0}).inject(h),c.message)e.createElement("p",{class:"DMULoadingDivLabel"}).inject(l).setText(c.message)}else if("message"===c.type){e.createElement("p",{class:"DMUMessageDivLabel"}).inject(l).setText(c.message)}else if("save"===c.type)h=e.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(l),a=new o({infiniteFlag:!0,displayStyle:"lite",shape:"circular",height:25,emphasize:"info"}).inject(h),l.setStyles({top:"20px"});else if("error"===c.type)h=e.createElement("div",{class:"DMULoadingDivProgressBar"}).inject(l),a=new o({infiniteFlag:!0,displayStyle:"lite",shape:"circular",height:25,emphasize:"high-attention"}).inject(h),l.setStyles({top:"20px"});else if("button"===c.type){var u;h=e.createElement("button",{class:"DMULoadingDivProgressBarButton"}).inject(l),c.label&&(u=e.createElement("div",{text:c.label}).inject(l)).addClassName("DMULoadingDivProgressBarLabel"),c.onClick&&h.addEvent("click",c.onClick),h.addEvent("mouseenter",function(){h.addClassName("highlighted"),u&&u.addClassName("shown")}),h.addEvent("mouseleave",function(){h.removeClassName("highlighted"),u&&u.removeClassName("shown")})}c.modal?(h&&h.setStyles({position:"absolute",top:"calc(50 % - 13px)",left:"50px"}),l.addClassName("DMUModalBackgroundDiv"),(t=new n({modalFlag:!0,immersiveFrame:s.getImmersiveFrame()})).elements.container.setStyles({display:"none"}),t.elements.container.parentNode.appendChild(l),l.setStyles({top:"calc(50% - "+l.offsetHeight/2+"px)",left:"calc(50% - "+l.offsetWidth/2+"px)"})):(s.getImmersiveFrame().addEventListener("freeZoneResize",d),r=1,l.inject(s.getUIFrame()),d()),c.styles&&l.setStyles(c.styles)}},this.updateMessage=function(e){l.lastChild.setText(e)},this.destroy=function(){s&&r&&s.getImmersiveFrame().removeEventListener("freeZoneResize",d),a&&a.destroy(),t?t.close():s&&l&&s.getUIFrame().removeChild(l),t=l=a=null}}})}),define("DS/DMUControls/EXPSnapshotControl",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/UIKIT/Spinner","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a){"use strict";return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(n,i){t.call(navigator,e,n,i)}):Promise.reject(new Error("getUserMedia is not implemented"))}),t.extend({init:function(t){var l;this._parent(t);var s=e.createElement("div",{class:"EXPSnapshotControl"}),r=e.createElement("div",{class:"EXPSnapshotControlSpinnerDiv"}).inject(s),d=e.createElement("video",{class:"EXPSnapshotVideo"}).inject(s),c=e.createElement("div",{class:"EXPSnapshotControlSnapDiv",styles:{opacity:0}}).inject(s),h=new o({visible:!0}).inject(r),u=new Image,m=e.createElement("canvas"),g=[],p=300;function C(){for(var e=0;e<g.length;e++)for(var t=g[e].getTracks(),n=0;n<t.length;n++)t[n].stop();g.length=0,h&&h.destroy(),l&&l.destroy(),l=h=s=d=null}var f=new i({emphasize:"primary",label:a.snapshotValidate,onClick:function(){var e=u.width,n=u.height;e>p&&(n=p*n/e,e=p),n>p&&(e=p*e/n,n=p),t.onValidateSnapshotCB({img:u,width:e,height:n}),C()}}),v=new i({label:a.snapshotReset,onClick:function(){d.play(),c.removeClassName("EXPSnapshotAnimation"),f.elements.button.setStyles({display:"none"}),v.elements.button.setStyles({display:"none"}),y.elements.button.setStyles({display:""})}}),y=new i({label:a.captureSnapshot,onClick:function(){c.setStyles({width:d.videoWidth,height:d.videoHeight}),c.addClassName("EXPSnapshotAnimation"),d.pause(),m.width=d.videoWidth,m.height=d.videoHeight,m.getContext("2d").drawImage(d,0,0,d.videoWidth,d.videoHeight),u.src=m.toDataURL("image/png"),u.width=d.videoWidth,u.height=d.videoHeight,f.elements.button.setStyles({display:""}),v.elements.button.setStyles({display:""}),y.elements.button.setStyles({display:"none"})}});(l=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:a.snapshotTitle,content:s,immersiveFrame:t.immersiveFrame,buttons:{Abort:y,Ok:f,Apply:v}})).addEventListener("close",function(){C(),t.onCloseSnapshotCB&&t.onCloseSnapshotCB()}),y.disabled=!0,y.elements.button.setStyles({display:""}),f.elements.button.setStyles({display:"none"}),v.elements.button.setStyles({display:"none"});var b=navigator.mediaDevices.getUserMedia({video:{width:{min:50,max:640},height:{min:50,max:360}}});b.then(function(e){if(!e)return t.onErrorCB&&t.onErrorCB(),C();"srcObject"in d?d.srcObject=e:d.src=window.URL.createObjectURL(e),g.push(e),d.onloadedmetadata=function(){y.disabled=!1,s.removeChild(r),d.play()}}),b.catch(function(){t.onErrorCB&&t.onErrorCB(),C()})}})}),define("DS/DMUControls/panels/DMU3DComparePanel",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXPanel","DS/Controls/Button","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o){"use strict";return t.extend({init:function(t){var a,l,s,r,d;this._parent(t);var c=null,h=!0;this.buildPanel=function(t){this.clean(),c=t.displayType,a||(a=e.createElement("div",{id:"DMU3DCompareMainDiv"}));var m=e.createElement("div",{id:"panelcontent",class:"DMU3DCompareContainerDiv"}).inject(a),g=e.createElement("div",{id:"comparecontent",class:"DMU3DCompareCompareContentDiv"}).inject(m);if((s=u({leftLabel:o.dmuCompareNewLabel,color:t.newStyleColor,rightLabel:t.newStyleLabel||o.dmuCompareLoadingLabel})).inject(g),(r=u({leftLabel:o.dmuCompareOldLabel,color:t.oldStyleColor,rightLabel:t.oldStyleLabel||o.dmuCompareLoadingLabel})).inject(g),(d=u({leftLabel:o.dmuCompareCommonLabel,color:t.commonStyleColor,rightLabel:t.commonStyleLabel||null})).inject(g),"reduce"!==c){var p=e.createElement("div",{class:"DMU3DCompareButtonDiv"}).inject(m);new i({label:o.dmuCompareButtonLabel,emphasize:"secondary",onClick:function(){t.onClickCB&&t.onClickCB()}}).inject(p)}var C={id:"DMU3DComparePanel",className:"DMU3DComparePanel",title:t.title||o.dmuCompareTitle,icon:t.icon,immersiveFrame:t.immersiveFrame,content:a,closeButtonFlag:!1,minWidth:250,width:250,allowedDockAreas:WUXDockAreaEnum.RightDockArea|WUXDockAreaEnum.LeftDockArea,position:{at:"top right"}};return l=new n(C),this.displaying(h),a},this.clean=function(){if(a){for(;a.firstChild;)a.removeChild(a.firstChild);l&&l.clean(),a=l=null}},this.displaying=function(e){h=e,l&&l.setPanelVisibilityFlag(h)},this.updatePanel=function(e){a&&(e.firstLabel&&s&&(s.querySelector(".DMU3DCompareRightLabel").innerHTML=e.firstLabel),e.secondLabel&&r&&(r.querySelector(".DMU3DCompareRightLabel").innerHTML=e.secondLabel),e.thirdLabel&&r&&(d.querySelector(".DMU3DCompareRightLabel").innerHTML=e.secondLabel))};var u=function(t){var n=new e.Element("div",{class:"DMU3DCompareLine"});"reduce"!==c&&new e.Element("div",{class:"DMU3DCompareText DMU3DCompareLeftLabel",html:t.leftLabel}).inject(n),e.createElement("div",{class:"DMU3DCompareColorDot"}).inject(n).style.background=t.color;var i=new e.Element("div",{class:"DMU3DCompareText DMU3DCompareRightLabel",html:t.rightLabel});return i.inject(n),"reduce"===c&&i.setStyles({width:"calc(100% - 28px)"}),n}}})}),define("DS/DMUControls/EXPLevelSelector",["UWA/Class","DS/LevelSelector/LevelSelector","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n,i,o){"use strict";return e.extend({init:function(e){var a=this;if(e&&(!e||e.iFrameWindow)){this.clean=function(){var e=t._noAnim;t._noAnim=!0,t.destroyView(),t._noAnim=e};var l=function(t,i){for(var a=[],l=e.iGetPathElementCB(),s=[],r=l.externalPath.length,d=0;d<r;++d){var c=l.getLastElement(!0);e.iFilterNodeCB(l)&&(a.push({pathElement:l.clone(),name:c.name,internalLevel:r-d}),s.push(c)),l=l.getParentPath()}if(!i){var h=n.getContextViewer({viewer:e.iFrameWindow.getViewer()});h&&o.getName(s,function(e){for(var n=0;n<e.length;++n)a[n].name=e[n];t()},h,"")}return a},s=function(t){e.iOnLevelHoverCB&&e.iOnLevelHoverCB(t)},r=function(t){d(e.iGet3DPositionCB,e.iGet2DPositionCB,e.iGetDelta2DPosition),e.iOnLevelSelectCB(t)};d(e.iGet3DPositionCB,e.iGet2DPositionCB,e.iGetDelta2DPosition)}function d(n,o,d){var c=o?o():i.getWindowPositionFromPoint(e.iFrameWindow.getViewer(),n(),e.iFrameWindow),h=d?d():{left:0,top:0},u={positionX:c.left+h.left,positionY:c.top+h.top,uiFrame:e.iFrameWindow.getUIFrame(),getLevels:l,onHover:s,onSelect:r};a.clean(),t.createView(u)}}})}),define("DS/DMUControls/panels/DMUGraphicPropertiesPanel",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","DS/Visualization/ThreeJS_DS","DS/Controls/Tab","DS/Controls/ComboBox","DS/Controls/Label","DS/Controls/Slider","DS/Controls/SpinBox","DS/Controls/Button","DS/Controls/Toggle","DS/WebappsUtils/WebappsUtils","DS/Core/ModelEvents","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s,r,d,c,h,u,m){"use strict";return t.extend({init:function(t){var g=t||{};this._parent(g);var p,C,f,v,y=this,b=h.getWebappsAssetUrl("DMUBaseCtxCommands","icons/32/"),w=0,x=[],D=[],S={fill:[],line:[],text:[]},E=[],k={fill:{colors:[],currentColor:null},line:{colors:[],currentColor:null},text:{colors:[],currentColor:null}},M=[{r:255,g:255,b:255},{r:204,g:9,b:47},{r:255,g:138,b:46},{r:254,g:224,b:0},{r:87,g:184,b:71},{r:0,g:0,b:0},{r:155,g:42,b:152},{r:0,g:37,b:150},{r:54,g:142,b:196},{r:71,g:119,b:56}],P=new u;function B(e,t){return P.publish({event:e,data:t,context:this})}function U(){var e;e=x[w],k[e].colors.forEach(t=>{t.div.setStyles({outline:k[e].currentColor&&t.color.equals(k[e].currentColor)?"4px #42a2da solid":""})}),S[e].forEach(t=>{t.div.setStyles({outline:k[e].currentColor&&new i.Color("#"+t.color).equals(k[e].currentColor)?"4px #42a2da solid":""})})}function I(e){let t=e.from[0].view.style.backgroundColor,n=new i.Color(t.split(" ").join(""));k[x[w]].currentColor=n,U(),B("fill"===x[w]?"onFillColorChanged":"line"===x[w]?"onLineColorChanged":"onTextColorChanged",n.getHex())}function _(t){k[t].colors.length=0;var o,a,l,s=new e.Element("div",{class:"DMU3DColorPalette"}),r=new e.Element("div",{class:"DMU3DColorContainer"}).inject(s);for(g.touchMode&&r.setAttributeNode(document.createAttribute("touch-mode")),o=0;o<5;o++)l="rgb("+M[o].r+","+M[o].g+","+M[o].b+")",(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(r)).style.background=l,g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),D.push(n.addEvent(a,"onPrimaryPointerClick",I)),k[t].colors.push({color:(new i.Color).setRGB(M[o].r/255,M[o].g/255,M[o].b/255),div:a});for(r=new e.Element("div",{class:"DMU3DColorContainer"}).inject(s),g.touchMode&&r.setAttributeNode(document.createAttribute("touch-mode")),o=5;o<10;o++)l="rgb("+M[o].r+","+M[o].g+","+M[o].b+")",(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(r)).style.background=l,g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),D.push(n.addEvent(a,"onPrimaryPointerClick",I)),k[t].colors.push({color:(new i.Color).setRGB(M[o].r/255,M[o].g/255,M[o].b/255),div:a});return s}function F(){var e=new d({label:m.customPanelTitle,icon:h.getWebappsAssetUrl("DMUBaseUI","images/")+"I_SwitchColorPalette.png"});return e.getContent().addClassName("DMUAddCustomColorButton"),e.getContent().addEventListener("buttonclick",function(){B("onCustomColorPanelRequired",k[x[w]].currentColor)}),e}this.setCustomColors=function(t){if(0===t.length){var o="rgb("+M[1].r+","+M[1].g+","+M[1].b+")";let e=new i.Color(o.split(" ").join(""));B("fill"===x[w]?"onFillColorChanged":"line"===x[w]?"onLineColorChanged":"onTextColorChanged",e.getHex()),U()}S.fill=t?t.map(e=>({color:e})):[],S.line=t?t.map(e=>({color:e})):[],S.text=t?t.map(e=>({color:e})):[],E.forEach(t=>{!function(t){for(;t.div.firstChild;)t.div.removeChild(t.div.firstChild);let i,o,a;if(t.tokens.forEach(e=>{n.removeEventFromToken(e)}),t.tokens.length=0,S[t.tab].length>0)for(i=new e.Element("div",{class:"DMU3DColorContainer"}).inject(t.div),g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),o=0;o<5;o++)S[t.tab][o]&&(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(i),g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),a.style.background="#"+S[t.tab][o].color,t.tokens.push(n.addEvent(a,"onPrimaryPointerClick",I)),S[t.tab][o].div=a);if(S[t.tab].length>5)for(i=new e.Element("div",{class:"DMU3DColorContainer"}).inject(t.div),g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),o=5;o<10;o++)S[t.tab][o]&&(a=new e.Element("div",{class:"DMU3DColorSquare"}).inject(i),g.touchMode&&a.setAttributeNode(document.createAttribute("touch-mode")),a.style.background="#"+S[t.tab][o].color,t.tokens.push(n.addEvent(a,"onPrimaryPointerClick",I)),S[t.tab][o].div=a)}(t)})},this.setCurrentColor=function(e){let t=new i.Color("#"+e);k[x[w]].currentColor=t,B("fill"===x[w]?"onFillColorChanged":"line"===x[w]?"onLineColorChanged":"onTextColorChanged",t.getHex()),U()},this.update=function(e){e&&(void 0!==e.isFilled&&f?(f.checkFlag="boolean"!=typeof e.isFilled||e.isFilled,f.mixedState=null===e.isFilled):void 0!==e.hasBorder&&v&&(v.checkFlag="boolean"!=typeof e.hasBorder||e.hasBorder,v.mixedState=null===e.hasBorder))},this.build=function(t){return p||(p=e.createElement("div",{class:"DMUGraphicPropertyDiv"}),C=new o({displayStyle:["strip"],centeredFlag:!1}).inject(p)),void 0===t.values.isFilled&&void 0===t.values.fillColor&&void 0===t.values.fillOpacity||(C.add({label:m.grpPanelFillTab,icon:{iconName:"fonticon wux-ui-3ds-paint-can-fill",fontIconFamily:1},isSelected:!0,content:function(t){var n=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.fillColor){_("fill").inject(n),k.fill.currentColor=t.fillColor;let i=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(n);g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),E.push({tab:"fill",div:i,tokens:[]})}if(void 0!==t.fillOpacity){var i=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n),o=new s({value:"number"==typeof t.fillOpacity?100*(1-t.fillOpacity):null,minValue:0,maxValue:100,stepValue:1,displayStyle:"horizontal"}).inject(i);o.getContent().setStyles({width:"50%",display:"inline-block"});var a=new r({value:"number"==typeof t.fillOpacity?100*(1-t.fillOpacity):null,minValue:0,maxValue:100,decimals:0,stepValue:1,units:"%",pageStepValue:1}).inject(i);a.getContent().setStyles({width:"50%","min-width":"0px","vertical-align":"top"}),o.addEventListener("change",function(){a.value=o.value}),a.addEventListener("change",function(){o.value=a.value,B("onFillOpacityChanged",1-a.value/100)})}if(void 0!==t.isFilled){var l=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n);(f=new c({type:"checkbox",label:m.grpFillLabel,checkFlag:"boolean"!=typeof t.isFilled||t.isFilled,mixedState:null===t.isFilled}).inject(l)).getContent().setStyles({"margin-left":"10px"}),f.addEventListener("change",function(){B("onFilledPropertyChanged",f.checkFlag)})}return void 0!==t.fillColor&&F().inject(n),n}(t.values)}),x.push("fill")),void 0===t.values.hasBorder&&void 0===t.values.lineColor&&void 0===t.values.thickness&&void 0===t.values.pattern&&void 0===t.values.lineOpacity||(C.add({label:m.grpPanelLineTab,icon:{iconName:"fonticon wux-ui-3ds-brush",fontIconFamily:1},isSelected:!1,content:function(t){var n,i=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.lineColor){_("line").inject(i),k.line.currentColor=t.lineColor;let n=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(i);g.touchMode&&n.setAttributeNode(document.createAttribute("touch-mode")),E.push({tab:"line",div:n,tokens:[]})}if(void 0!==t.lineOpacity){var o=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i),d=new s({value:"number"==typeof t.lineOpacity?100*(1-t.lineOpacity):null,minValue:0,maxValue:100,stepValue:1,displayStyle:"horizontal"}).inject(o);d.getContent().setStyles({width:"50%",display:"inline-block"});var h=new r({value:"number"==typeof t.lineOpacity?100*(1-t.lineOpacity):null,minValue:0,maxValue:100,decimals:0,stepValue:1,units:"%",pageStepValue:1}).inject(o);h.getContent().setStyles({width:"50%","min-width":"0px","vertical-align":"top"}),d.addEventListener("change",function(){h.value=d.value}),h.addEventListener("change",function(){d.value=h.value,B("onLineOpacityChanged",1-h.value/100)})}if(void 0!==t.pattern){(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i)).setStyle("text-align","center"),new l({value:m.LineType}).inject(n).getContent().setStyles({"text-align":"left",background:"none"});var u=new a({elementsList:[{label:m.solid,icon:b+"I_DMULineType_1.png"},{label:m.dotted,icon:b+"I_DMULineType_2.png"},{label:m.dashed,icon:b+"I_DMULineType_3.png"},{label:m.dotDashed,icon:b+"I_DMULineType_4.png"},{label:m.phantom,icon:b+"I_DMULineType_5.png"},{label:m.smallDots,icon:b+"I_DMULineType_6.png"},{label:m.jisAxis,icon:b+"I_DMULineType_7.png"}],selectedIndex:"number"==typeof t.pattern?t.pattern-1:-1,enableSearchFlag:!1}).inject(n);u.addEventListener("change",function(){B("onLineTypeChanged",u.selectedIndex+1)})}if(void 0!==t.thickness){(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i)).setStyle("text-align","center"),new l({value:m.thickness}).inject(n).getContent().setStyles({"text-align":"left",background:"none"});var p=new a({elementsList:[{label:m.thickness1,icon:b+"I_DMULineThickness_1.png"},{label:m.thickness2,icon:b+"I_DMULineThickness_2.png"},{label:m.thickness3,icon:b+"I_DMULineThickness_3.png"},{label:m.thickness4,icon:b+"I_DMULineThickness_4.png"},{label:m.thickness5,icon:b+"I_DMULineThickness_5.png"},{label:m.thickness6,icon:b+"I_DMULineThickness_6.png"},{label:m.thickness7,icon:b+"I_DMULineThickness_7.png"},{label:m.thickness8,icon:b+"I_DMULineThickness_8.png"},{label:m.thickness9,icon:b+"I_DMULineThickness_16.png"},{label:m.thickness10,icon:b+"I_DMULineThickness_32.png"},{label:m.thickness11,icon:b+"I_DMULineThickness_64.png"}],selectedIndex:"number"==typeof t.thickness?t.thickness:-1,enableSearchFlag:!1}).inject(n);p.addEventListener("change",function(){B("onLineThicknessChanged",p.selectedIndex)})}return void 0!==t.hasBorder&&(n=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(i),(v=new c({type:"checkbox",label:m.grpBorderLabel,checkFlag:"boolean"!=typeof t.hasBorder||t.hasBorder,mixedState:null===t.hasBorder}).inject(n)).getContent().setStyles({"margin-left":"10px"}),v.addEventListener("change",function(){B("onHasBorderPropertyChanged",v.checkFlag)})),void 0!==t.lineColor&&F().inject(i),i}(t.values)}),x.push("line")),void 0===t.values.fontColor&&void 0===t.values.fontStyle&&void 0===t.values.fontSize||(C.add({label:m.grpPanelTextTab,icon:{iconName:"fonticon wux-ui-3ds-text",fontIconFamily:1},isSelected:!1,content:function(t){var n=new e.Element("div",{class:"GraphicTabContent"});if(void 0!==t.fontColor){_("text").inject(n),k.text.currentColor=t.fontColor;let i=new e.Element("div",{class:"DMUGraphicPropCustomColorPaletteDiv"}).inject(n);g.touchMode&&i.setAttributeNode(document.createAttribute("touch-mode")),E.push({tab:"text",div:i,tokens:[]})}var i=new e.Element("div",{class:"DMU3DSecondLayerDiv"}).inject(n);if(i.setStyle("text-align","center"),void 0!==t.fontSize){i.setStyles({"margin-bottom":"10px"});var o=new r({value:t.fontSize,minValue:0,decimals:1,stepValue:.5,units:"mm",pageStepValue:.5}).inject(i);o.getContent().setStyles({width:"100px","vertical-align":"middle"}),o.addEventListener("change",function(){B("onFontSizeChanged",o.value)})}if(void 0!==t.fontStyle){var a=new d({type:"check",checkFlag:t.fontStyle&&-1!==t.fontStyle.indexOf("bold"),icon:{iconName:"fonticon wux-ui-3ds-text-bold",fontIconFamily:1}}).inject(i);a.getContent().addClassName("FontButton"),g.touchMode&&a.getContent().setStyles({width:"40px","min-width":"40px"});var l=new d({type:"check",checkFlag:t.fontStyle&&-1!==t.fontStyle.indexOf("italic"),icon:{iconName:"fonticon wux-ui-3ds-text-italic",fontIconFamily:1}}).inject(i);l.getContent().addClassName("FontButton"),g.touchMode&&l.getContent().setStyles({width:"40px","min-width":"40px"}),a.addEventListener("click",function(){var e="normal";a.checkFlag&&l.checkFlag?e="bold italic":a.checkFlag&&!l.checkFlag?e="bold":!a.checkFlag&&l.checkFlag&&(e="italic"),B("onFontStyleChanged",e)}),l.addEventListener("click",function(){var e="normal";a.checkFlag&&l.checkFlag?e="bold italic":a.checkFlag&&!l.checkFlag?e="bold":!a.checkFlag&&l.checkFlag&&(e="italic"),B("onFontStyleChanged",e)})}return void 0!==t.fontColor&&F().inject(n),n}(t.values)}),x.push("text")),t.customColors.length&&y.setCustomColors(t.customColors),U(),C.addEventListener("change",function(e){e&&e.dsModel&&e.dsModel.value&&e.dsModel===C&&(w=e.dsModel.value[0],B("onActiveTabChanged",{activeTab:x[w]}),U())}),t.activeTab&&-1!==x.indexOf(t.activeTab)&&x.length>x.indexOf(t.activeTab)?(C.value=[x.indexOf(t.activeTab)],w=x.indexOf(t.activeTab)):(C.value=[0],w=0),p},this.clean=function(){D.forEach(e=>{n.removeEventFromToken(e)}),D.length=0,C&&C.destroy(),p=C=null},this.subscribe=function(e,t){if(e&&t)return P.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&P.unsubscribe(e)}}})}),define("DS/DMUControls/panels/DMUCommentsPanel",["require","exports","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/CATWebUXComponents/CATWebUXComment","DS/WebappsUtils/WebappsUtils","DS/VisuEvents/EventsManager","DS/Menu/ContextualMenu","UWA/Core","DS/CoreEvents/ModelEvents","DS/DMUBaseUI/DMUToolsUsers","DS/Controls/ComboBox","DS/Controls/LineEditor","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s,r,d,c,h,u,m,g){"use strict";class p{constructor(e){let t=[],n=d.createElement("div",{class:"DMUCommentsPanelMarkupCombo"}),i=d.createElement("div",{class:"DMUCommentsPanelMarkupCombo-user_color"}),o=d.createElement("div",{class:"DMUCommentsPanelMarkupCombo-label",text:g.commentsPanel.authorIn+":"}),a=d.createElement("div",{class:"DMUCommentsPanelMarkupCombo-combo"}),l=new u({enableSearchFlag:!1,placeholder:g.commentsPanel.noActiveMarkup,reachablePlaceholderFlag:!0});l.setProperties({getMainElementCustomization:function(){if(t&&t[l.selectedIndex])return{label:t[l.selectedIndex].name}}}),l.getContent().style.width="100%",a.appendChild(l.getContent());let c=d.createElement("div",{class:"DMUCommentsPanelMarkupCombo-ctx_menu"});c.appendChild(d.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot"}));let p=s.addEvent(c,"onPrimaryPointerClick",function(t){e.onContextMenuRequested&&e.onContextMenuRequested({id:l.value,event:t.from[0].event})});n.appendChild(o),n.appendChild(i),n.appendChild(a),n.appendChild(c);let C=r.addEventListener(n,{callback:t=>{e.onContextMenuRequested&&e.onContextMenuRequested({id:l.value,event:t.data.event})}});function f(){t&&l&&l.setProperties({elementsList:t.map(e=>({value:e.id,label:`${e.name} | ${e.ownerName||e.owner}`,description:e.ownerName||e.owner}))})}l.addEventListener("change",function(){l.value&&e.onCurrentMarkupChanged(l.value)}),this.addMarkup=(e=>{if(!t||t.some(t=>t.id===e.id))return;const n={id:e.id,name:e.name,owner:e.owner};n.owner&&h.getUserName(n.owner,e=>{n.ownerName=e,f()}),t.push(n),f()}),this.setVisibility=(e=>{e?n.setStyle("display",""):n.setStyle("display","none")}),this.startMarkupNameEdition=(n=>{if(!t)return;const i=t.findIndex(e=>e.id===n);if(-1!==i){let o=new m({placeholder:"Markup Name",requiredFlag:!0,value:t[i].name});const s=e=>{e&&t&&t[i]&&(t[i].name=e,f()),requestAnimationFrame(()=>{o.removeEvents(),o.remove(),l.show()})};l.hide(),o.inject(a),o.focus({}),o.addEventListener("change",function(){e.onMarkupRenamed(n,o.value),s(o.value)}),o.addEventListener("blur",function(){s()})}}),this.setCurrentMarkup=(e=>{if(l&&t){if(e){const n=t.find(t=>t.id===e);if(n&&n.owner){const e=h.getUserColor(n.owner);e&&(i.style.backgroundColor=e.getStyle()),i.title=n.ownerName||n.owner}}else i.style.backgroundColor="#B4B6BA",i.title=g.commentsPanel.noActiveMarkup;l.value=e||void 0}}),this.removeMarkup=(n=>{if(!t)return;const i=t.findIndex(e=>e.id===n);-1!==i&&(t.splice(i,1),f(),t.length&&e.onCurrentMarkupChanged(t[i%t.length].id))}),this.getContent=(()=>n),this.remove=(()=>{C&&r.removeEventListener(n,C),p&&s.removeEventFromToken(p),l.remove(),C=p=null,t=l=null})}}return class{constructor(){let e,t,r,u,m,C,f,v,y,b,w,x,D=this,S=!1,E=new Map,k=new Map,M=new c,P=[];function B({element:e,page:t,number:n}){return"-"+(n||(e?e.index:t||"externalComments"))}function U({element:e,page:t,containerId:n,notCreate:i}){if(n)return k.get(n);let o=B({element:e,page:t}),a=(e?e.index:t)||-1;-1===a&&(o="ErrorContainer");const l=k.get(o);if(l)return l;if(!i){let n=e?e.title:t?g.page+" "+t:g.commentsPanel.fileCommentsTitle,i={id:o,number:a,view:d.createElement("div",{id:`DMUCommentPanelContainer${o}`,text:n||"",class:"DMUCommentContainer"}),commentIds:[]};C.appendChild(i.view),k.set(o,i);const l=[...k.values()];return l.sort(function(e,t){return e.number>t.number?1:e.number<t.number?-1:0}),l.forEach(function(e){C.removeChild(e.view),C.appendChild(e.view)}),i}}function I(e,t){return M.publish({event:e,data:t,context:D})}function _(e){I("onCommentSelected",e)}function F(e){I("onCommentPreselected",e)}function R(e){I("onCommentEditionEnd",e)}function T(e){I("onCommentReply",e)}function j(e){I("onPanelScroll",e)}function N(e){e&&(e.commentIds.sort((e,t)=>{const n=E.get(e),i=E.get(t);if(n&&i){if(!n.pointedPosition)return-1;if(!i.pointedPosition)return 1;if(n.pointedPosition.y>i.pointedPosition.y)return-1;if(n.pointedPosition.y<i.pointedPosition.y)return 1}return 0}),e.commentIds.forEach(t=>{const n=E.get(t);n&&(e.view.removeChild(n.view.getCommentDiv()),e.view.appendChild(n.view.getCommentDiv()))}))}function A(e,t){e.owner.login&&(e.owner.name=e.owner.name||e.owner.login,h.getUserName(e.owner.login,function(n){e.owner.name!==n&&(e.owner.name=n,e.isReply&&y&&t?function(e,t){if(!e||!t||!E)return;const n=E.get(t);if(n){const t=n.replies.get(e.uuid);t&&(e.dateInMs&&(t.dateInMs=e.dateInMs,e.date=h.formatDate(e.dateInMs)),t.view.update(e))}}(e,t):D.updateComment(e))}),e.owner.color=h.getUserColor(e.owner.login).getStyle(),e.owner.imageUrl=h.getUserImageURL(e.owner.login))}function L(e){e&&(e.view.getSize().height>t.getInnerElement().getSize().height?e.view.hasClassName("repliesContracted")?e.view.hasClassName("allContracted")||e.view.addClassName("allContracted"):(e.view.addClassName("repliesContracted"),e.view.getSize().height>t.getInnerElement().getSize().height&&e.view.addClassName("allContracted")):e.view.hasClassName("allContracted")?(e.view.removeClassName("allContracted"),L(e)):e.view.hasClassName("repliesContracted")&&(e.view.removeClassName("repliesContracted"),L(e)))}function H(){if(C)if(E.size)w&&(x&&s.removeEventFromToken(x),w.remove(),w=x=null);else{if(w)for(;w.firstChild;)w.removeChild(w.firstChild);else w=d.createElement("div",{styles:{padding:10}}).inject(C);let e;w.hasClassName("DMUCreateCommentTitleDiv")&&w.removeClassName("DMUCreateCommentTitleDiv"),x&&(s.removeEventFromToken(x),x=null),S?(e=d.createElement("div",{class:"DMUBrowserNoElementsTitleTextDiv"}).inject(w)).innerText=g.commentsPanel.noCommentsTitle:(w.addClassName("DMUCreateCommentTitleDiv"),d.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus DMUEmptyMarkupPlusBtn"}).inject(w),(e=d.createElement("div",{class:"DMUBrowserCreateElementTextDiv"}).inject(w)).innerText=g.commentsPanel.createCommentTitle,x=s.addEvent(w,"onPrimaryPointerClick",function(){I("onNewCommentCreated",void 0)}))}}function W(e){S&&e&&-1===P.indexOf(e.uuid)&&(e.view.setDisplayFlag(!0),P.push(e.uuid),P.length===E.size&&P.forEach(function(e){const t=E.get(e);t&&t.view.setDisplayFlag(!0,!0)}))}this.buildPanel=function(n){D.cleanPanel(),e||(e=d.createElement("div",{id:"DMUCommentsPanelMainDiv"})),e.setStyles({height:"100%"});let a=d.createElement("div",{class:"DMUCommentsPanelSectionMainDiv"}).inject(e);return r=new o({draggable:!0,onDragStart:function(){return v||""},sectionLabel:n.panelTitle,cmdList:n.contextualCmdList,quickAccessBtnList:n.quickAccessBtnList}),a.appendChild(r.getContent()),y=n.allowReplies,C=d.createElement("div",{class:"DMUCommentsPanelMainContainer"}),(t=(new i).inject(a)).getInnerElement().setContent(C),t.getInnerElement().addEventListener("scroll",j),t.getContent().setStyle("flex",1),H(),e},this.addMarkup=function(e){r.closeContextualSectionHeader(),e.id&&(b||(b=new p({onCurrentMarkupChanged:e=>{I("onSetCurrentMarkup",e)},onMarkupRenamed:(e,t)=>{I("onMarkupRenamed",{id:e,title:t})},onContextMenuRequested:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event,i={x:t.pageX||t.screenX||0,y:t.pageY||t.screenY||0};I("onMarkupCtxMenuRequired",{id:e.id,position:new n.Vector2(i.x,i.y)})}}),r.getContent().appendChild(b.getContent()),b.setVisibility(!S)),b.addMarkup({id:e.id,name:e.title,owner:e.owner}))},this.removeMarkup=function(e){b&&b.removeMarkup(e)},this.editMarkupName=function(e){b&&b.startMarkupNameEdition(e)},this.setCurrentMarkup=function(e){b&&b.setCurrentMarkup(e)},this.setAllowReplies=(e=>{y=e}),this.addComment=function(e){if(!e||!E)return;A(e),e.date=h.formatDate(e.dateInMs);let t=new a({commentData:e,allowReplies:y,onClickCB:_,onReplyCB:T,onEditionEndCB:R,onEnterCB:F,onLeaveCB:F,onCtxMenuCB:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event;I("onCommentCtxMenuRequired",{target:e.target,shiftKeyPressed:e.event.shiftKey,ctrlKeyPressed:e.event.ctrlKey,position:new n.Vector2(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY)})}}),i=U({page:e.pointedPage,element:e.pointedElement});i&&(i.commentIds.push(e.uuid),i.view.appendChild(t.getCommentDiv()),E.set(e.uuid,{uuid:e.uuid,view:t,dateInMs:e.dateInMs,containerId:i.id,parentObject:e.parentObject,dmuObject:e.dmuObject,pointedPosition:e.pointedPosition,replies:new Map}),t.setCtxMenuAvailability(!S),e.pointedPosition&&N(i),e.replies&&e.replies.length&&e.replies.forEach(function(t){D.addReply(t,e.uuid)}),t.updateRepliesCount(e.replies&&e.replies.length?e.replies.length:0),L(i),H())},this.updateComment=function(e){if(!e||!E)return;const t=E.get(e.uuid);if(t){let n=U({page:e.pointedPage,element:e.pointedElement});A(e);let i=B({element:e.pointedElement,page:e.pointedPage});if(i&&i!==t.containerId&&(function(e,t,n){const i=U(t);if(i){i.view.removeChild(e.view.getCommentDiv()),0===i.view.childElementCount?(i.view.remove(),k.delete(i.id)):i.commentIds.splice(i.commentIds.indexOf(e.uuid),1);const t=U(n);t&&(t.commentIds.push(e.uuid),t.view.appendChild(e.view.getCommentDiv()))}}(t,{containerId:t.containerId},{page:e.pointedPage,element:e.pointedElement}),t.containerId=i,(n=U({page:e.pointedPage,element:e.pointedElement}))&&N(n)),!e.pointedPosition||t.pointedPosition&&e.pointedPosition.equals(t.pointedPosition)||(t.pointedPosition=e.pointedPosition,n&&N(n)),e.dateInMs&&(t.dateInMs=e.dateInMs),e.date=h.formatDate(t.dateInMs),e.highlightData?(t.view.setInformationIcon(l.getWebappsAssetUrl("DMUBaseUI","icons/32/")+"I_DMU_ReviewHighlight.png"),t.view.setIsDraggable(!0),t.view.setDragContent(e.highlightData)):(t.view.setInformationIcon(null),t.view.setIsDraggable(!1),t.view.setDragContent(null)),t.view.update(e),t.replies){let n=0;t.replies.forEach(t=>{e.replies&&(A(e.replies[n],e.uuid),e.replies[n].dateInMs&&(t.dateInMs=e.replies[n].dateInMs,e.replies[n].date=h.formatDate(e.replies[n].dateInMs)),t.view.update(e.replies[n])),n++})}n&&L(n)}},this.selectComment=function(e,n,i){if(!e)return;const o=E.get(e);o&&(o.view.updateDate(h.formatDate(o.dateInMs)),o.view.setInEdition(!0),o.replies.forEach(function(e){e.view.updateDate(h.formatDate(e.dateInMs))}),u||(u=[]),u.push(o.view),W(o),("number"==typeof n||i)&&(f&&clearTimeout(f),f=setTimeout(function(){if(t&&E&&o){let e=t.getInnerElement();if(e){let t=o.view.getCommentDiv();if(t){let o=e.scrollTop+t.getPosition().y;i?o-=e.offsetHeight/2-t.getSize().height/2:"number"==typeof n&&(o+=132-n),e.scrollTo({top:o,behavior:"smooth"})}}}f=null},100)))},this.preSelectComment=function(e){if(!e)return;const t=E.get(e);t&&(t.view.updateDate(h.formatDate(t.dateInMs)),t.view.setHovered(!0),t.replies.forEach(function(e){e.view.updateDate(h.formatDate(e.dateInMs))}),m||(m=[]),m.push(t.view))},this.removeComment=function(e){if(!e)return;const t=E.get(e);if(t){D.restoreCommentPreSelection(),D.restoreCommentSelection(),t.view.remove();let n=U({containerId:t.containerId});if(n){n.commentIds.splice(n.commentIds.indexOf(e),1),0===n.view.childElementCount?(n.view.remove(),k.delete(n.id)):L(n);const i=P.indexOf(t.uuid);-1!==i&&P.splice(i,1)}E.delete(e)}H()},this.addReply=function(e,t){if(!e)return;const i=E.get(t);if(i){A(e,t),e.date=h.formatDate(e.dateInMs);let o=new a({commentData:e,allowReplies:y,onClickCB:_,onEditionEndCB:R,onReplyCB:T,onCtxMenuCB:function(e){let t=e.event.touchFlag?e.event.touches[0]:e.event;I("onCommentCtxMenuRequired",{target:e.target,shiftKeyPressed:e.event.shiftKey,ctrlKeyPressed:e.event.ctrlKey,position:new n.Vector2(t.pageX?t.pageX:t.screenX,t.pageY?t.pageY:t.screenY)})}});i.view.getCommentDiv().appendChild(o.getCommentDiv()),i.replies.set(e.uuid,{uuid:e.uuid,dateInMs:e.dateInMs,view:o}),o.setCtxMenuAvailability(!S),i.view.updateRepliesCount(i.replies.size);const l=U({containerId:i.containerId});l&&L(l)}},this.selectReply=function(e,t){if(!e||!t)return;const n=E.get(t);if(n){const t=n.replies.get(e);t&&(n.view.updateDate(h.formatDate(n.dateInMs)),n.view.setInEdition(!0),t.view.updateDate(h.formatDate(t.dateInMs)),t.view.setInEdition(!0),u||(u=[]),u.push(t.view),u.push(n.view),W(n))}},this.removeReply=function(e,t){if(!e||!t)return;const n=E.get(t);if(n){const t=n.replies.get(e);if(t){D.restoreCommentPreSelection(),D.restoreCommentSelection(),t.view.remove(),n.replies.delete(e),n.view.updateRepliesCount(n.replies.size);const i=U({containerId:n.containerId});i&&L(i)}}},this.getDivPositionFrom=function(e,n,i){if(!e)return;const o=E.get(e);if(o){let e=t.getInnerElement(),a=o.view.getCommentDiv().getPosition(n);a.y+=30;let l=e.getPosition(n);return i&&(l.x+=e.getDimensions().width,a.x+=e.getDimensions().width),a.y<l.y?l:a.y>l.y+e.getDimensions().height-10?{x:l.x,y:l.y+e.getDimensions().height-10}:a}},this.scrollPanelToContainer=function(e){if(!e)return;let n=U({containerId:B({number:e}),notCreate:!0});n&&(f&&clearTimeout(f),f=setTimeout(function(){if(t&&n){let e=t.getInnerElement();e&&e.scrollTo({top:e.scrollTop+n.view.getPosition().y,behavior:"smooth"})}f=null},100))},this.updatePanelHeader=function(e){r&&e&&(e.quickAccessBtnList&&r.setQuickAccessCommands(e.quickAccessBtnList),e.contextualCmdList&&r.setSubMenuCommands(e.contextualCmdList),e.panelTitle&&r.setHeaderLabel(e.panelTitle),void 0!==e.headerDrag&&r.enableHeaderDrag(e.headerDrag),e.quickAccessBtnAvailability&&r.setQuickAccessCommandActiveFlag(e.quickAccessBtnAvailability.id,e.quickAccessBtnAvailability.flag))},this.setDragContent=function(e){v=e},this.setReadOnlyFlag=function(e){S!==e&&(S=e,E&&E.forEach(function(t){t.view.setCtxMenuAvailability(!e),t.replies.forEach(function(t){t.view.setCtxMenuAvailability(!e)})}),b&&b.setVisibility(!e),H())},this.resetCommentDisplayHistory=function(){P.forEach(function(e){const t=E.get(e);t&&t.view.setDisplayFlag(!1)}),P.length=0},this.enableContentEdition=function(e,t){const n=E.get(t||e);if(n)if(t){let t=n.replies.get(e);n.view.updateDate(h.formatDate(n.dateInMs)),n.view.setInEdition(!0),t&&(t.view.updateDate(h.formatDate(t.dateInMs)),t.view.setInEdition(!0),t.view.enableContentEdition()),u||(u=[]),u.push(n.view),W(n),t&&u.push(t.view)}else n.view.updateDate(h.formatDate(n.dateInMs)),n.view.setInEdition(!0),n.view.enableContentEdition(),W(n),u||(u=[]),u.push(n.view)},this.restoreCommentSelection=function(){u&&u.length&&(u.forEach(function(e){e.setInEdition(!1)}),u.length=0)},this.restoreCommentPreSelection=function(){m&&m.length&&(m.forEach(function(e){e.setHovered(!1)}),m.length=0)},this.setReviewVisuCheckFlag=function(e){r.closeContextualSectionHeader(),r.setAdditionalCheckBoxActiveFlag(2,e)},this.subscribe=function(e,t){if(e&&t)return M.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&M.unsubscribe(e)},this.cleanPanel=function(){if(D.restoreCommentPreSelection(),D.restoreCommentSelection(),k&&E.forEach(e=>e.view.remove()),k&&k.forEach(e=>e.view.remove()),e)for(;e.firstChild;)e.removeChild(e.firstChild);f&&clearTimeout(f),E.clear(),k.clear(),b&&b.remove(),H(),f=e=u=m=b=null},this.clear=function(){D.cleanPanel(),r&&r.clear(),t&&t.destroy(),x&&s.removeEventFromToken(x),w&&w.remove(),S=!1,M=r=t=w=null}}}}),define("DS/DMUControls/panels/DMUBookmarksPanel",["UWA/Core","UWA/Class","DS/Core/ModelEvents","UWA/Controls/ThemedScroller","DS/Utilities/TouchUtils","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/CATWebUXComponents/CATWebUXButtonExpander","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s){"use strict";return t.extend({init:function(){this._parent();var t,r,d,c,h,u,m=this,g=new n,p=o.getTouchMode()?18:14,C=o.getTouchMode()?16:12,f=function(e,t){return g.publish({event:e,data:t,context:this})};function v(e){u&&u!==e.div&&u.setHighlight(!1),u=e.div,e.div.setHighlight(!0),f("onBookmarkSelected",e)}function y(e){f("onBookmarkExpanded",e)}function b(e,t,n){if(e&&t){for(var i,o=0;o<e.length;o++)if(e[o].pointedPage<t)i=e[o];else{if(e[o].pointedPage!==t)break;if(!e[o].pointedPosition||e[o].pointedPosition.y>n)i=e[o];else{if(e[o].pointedPosition&&Math.abs(e[o].pointedPosition.y-n)<=1e-4)return e[o];if(e[o].pointedPosition&&e[o].pointedPosition.y<n)break}}return i}}function w(e){for(var t=h;t&&t.length;)t.forEach(function(t){t.view.setExpanded(e)}),t=t.reduce(function(e,t){return e.concat(t.items)},[]);y()}function x(e,t){return e?e.findIndex(function(e){return e.pointedId===t||x(e.items,t)>=0}):-1}this.buildPanel=function(n){m.cleanPanel(),t||(t=e.createElement("div",{id:"DMUBookmarksPanelMainDiv"})),t.setStyles({height:"100%"});var o=e.createElement("div",{class:"DMUBookmarksPanelSectionMainDiv"}).inject(t);o.setStyles({height:"100%"});var u=n.filter(function(e){return e.items.length});d=new a({draggable:!1,sectionLabel:s.bookmarksPanel.title,quickAccessBtnList:u.length?[{id:"ExpandAllButton",type:"toggle",initialFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-expand-all",alternativeFontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-collapse-all",title:s.bookmarksPanel.expandOrCollapseAll,cb:w}]:[]}),o.appendChild(d.getContent());return c=e.createElement("div",{id:"DMUBookmarksPanelMainContainer",styles:{"background-color":"white",padding:"5px"}}),(r=(new i).inject(o)).getInnerElement().setContent(c),r.getContent().setStyle("height","calc(100% - 40px)"),h||(h=[]),function e(t,n,i,o){if(t&&t.length&&n&&o){var a=Math.max(i,C);t.forEach(function(t){var i={onClickData:t,displayExpander:t.items&&t.items.length>0,icon:t.icon,title:t.title,bold:t.bold,italic:t.italic,fontSize:a,onClickCB:v,onExpandCB:y},s=new l(i),r={view:s,pointedPage:t.pointedPage,pointedPosition:t.pointedPosition,pointedId:t.pointedId,items:[]};o.push(r),n.appendChild(s.getMainDiv()),e(t.items,s.getContentDiv(),a-1,r.items)})}}(n,c,p,h),1===h.length&&h[0].view.setExpanded(!0),h.sort(function(e,t){return e.pointedPage<t.pointedPage?-1:e.pointedPage>t.pointedPage?1:e.pointedPosition?t.pointedPosition?e.pointedPosition.y>t.pointedPosition.y?-1:e.pointedPosition.y<t.pointedPosition.y?1:0:1:-1}),t},this.highlightBookmark=function(e){if(e){var t,n;if(e.pageNumber&&e.yCoordinate)for(n=b(h,e.pageNumber,e.yCoordinate);n&&(t=n,n.view.isExpanded()&&n.items.length);)n=b(n.items,e.pageNumber,e.yCoordinate);else if(e.elementId){var i=x(h,e.elementId);for(i>=0&&(n=h[i]);n&&i>=0&&(t=n,n.view.isExpanded()&&n.items.length);)(i=x(n.items,e.elementId))>=0&&(n=n.items[i])}t?(u&&u.setHighlight(!1),t.view.setHighlight(!0),u=t.view):u&&(u.setHighlight(!1),u=null)}},this.subscribe=function(e,t){if(e&&t)return g.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&g.unsubscribe(e)},this.cleanPanel=function(){if(t){for(u&&u.setHighlight(!1),h&&h.forEach(function(e){e.view.remove()});t.firstChild;)t.removeChild(t.firstChild);d&&d.clear(),r&&r.destroy(),h=g=d=r=t=u=null}}}})}),define("DS/DMUControls/DMUEditableExpander",["UWA/Core","DS/Controls/Expander","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Controls/Button","DS/Controls/Toggle","DS/Utilities/TouchUtils","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l){"use strict";return t.extend({init:function(t){var s=t||{};this._parent({header:s.name,body:s.content,icon:s.icon?s.icon.fonticonClass?s.icon.fonticonClass:s.icon:void 0,style:"styled"}),this.editableExpanderBody=this.elements.container.getElementsByClassName("wux-controls-expander-body")[0],this.editableExpanderBody.addClassName("editableExpanderBody");var r,d,c=this,h=!1,u=!1;this.type=s.type,this.getContent().setStyles({display:"inline-block","vertical-align":"top"}),this.allowDnD=s.allowDnD,this.onDragStart=s.onDragStart,this.expanderSelection=s.expanderSelection,this.expanderUnselect=s.expanderUnselect,this.onHighlightExpand=s.onHighlightExpand,this.onValidatedSelected=s.onValidatedSelected,this.elements.headerArrow.hide(),this.elements.icon&&(this.elements.icon.addClassName("editableExpanderStatusicon"),this.elements.icon.setStyles({color:s.icon.fonticonColor,"font-size":"14px"})),this.editableExpanderHeaderIcon=this.elements.icon,this.editableExpanderContainer=this.elements.container.getElementsByClassName("wux-controls-expander-container wux-controls-expander-styled")[0],this.editableExpanderContainer.addClassName("editableExpanderContainer"),this.editableExpanderHeader=this.elements.container.getElementsByClassName("wux-controls-expander-header")[0],this.editableExpanderHeader.addClassName("editableExpanderHeader"),this.elements.container.getElementsByClassName("wux-controls-expander-header-container")[0].addClassName("editableExpanderHeaderContainer"),this.editableExpanderHeaderTitle=this.elements.container.getElementsByClassName("headerTitle")[0],this.editableExpanderHeaderTitle.addClassName("editableExpanderHeaderTitle"),this.editableExpanderHeaderTitle.title=this.editableExpanderHeaderTitle.getText(),this.getSelectionFlag=function(){return u},this.setSelectionFlag=function(e){u=e},this.updateImpCheckHeaderIcon=function(e){"Check"===e.type&&(0===e.highlightNumber?this.sDiv.hide():this.sDiv.show(),this.sDiv.getElementsByClassName("sNb")[0].setText(e.highlightNumber))},this.updateReqHeaderIcon=function(e){"Check"===e.type&&(0===e.reqLength?this.fDiv.hide():this.fDiv.show(),this.fDiv.getElementsByClassName("fNb")[0].setText(e.reqLength))},this.updateIssueHeaderIcon=function(e){"Highlight"===e.type&&(0===e.issueLength?this.sDiv.hide():this.sDiv.show(),this.sDiv.getElementsByClassName("sNb")[0].setText(e.issueLength))},this.updateCAHeaderIcon=function(e){"Highlight"===e.type&&(0===e.caLength?this.fDiv.hide():this.fDiv.show(),this.fDiv.getElementsByClassName("fNb")[0].setText(e.caLength))},this.selectCheckBox=function(e){c.expandedFlag?(c.setSelectionFlag(!1),e&&c.onValidatedSelected(event,"unselect"),c.editableExpanderContainer.removeClassName("editableExpanderSelected"),c.editableExpanderHeader.removeClassName("validatedObjSelected"),c.getContent().getElementsByClassName("validRemoveButton").length&&c.getContent().getElementsByClassName("validRemoveButton")[0].hide(),c.checkBox&&c.checkBox.checkFlag&&(c.checkBox.checkFlag=!1),c.expandedFlag=!1):(c.setSelectionFlag(!0),c.editableExpanderContainer.addClassName("editableExpanderSelected"),c.editableExpanderHeader.removeClassName("editableExpanderHeader"),c.editableExpanderHeader.addClassName("validatedObjSelected"),c.checkBox&&!c.checkBox.checkFlag&&(c.checkBox.checkFlag=!0),c.getContent().getElementsByClassName("validRemoveButton").length&&c.getContent().getElementsByClassName("validRemoveButton")[0].show(),e&&c.onValidatedSelected(event,"select"),c.expandedFlag=!0)},this.select=function(e,t){if("Validated"===c.type&&!1===c.expandedFlag)c.setSelectionFlag(!0),c.editableExpanderHeader.addClassName("validatedObjSelected"),c.editableExpanderHeader.removeClassName("editableExpanderHeader"),c.editableExpanderContainer.addClassName("editableExpanderSelected"),c.checkBox&&!c.checkBox.checkFlag&&(c.checkBox.checkFlag=!0,c.checkBox.getContent().show()),c.getContent().getElementsByClassName("validRemoveButton").length&&c.getContent().getElementsByClassName("validRemoveButton")[0].show(),e&&c.onValidatedSelected(t,"select");else if("Validated"===c.type&&!0===c.expandedFlag)c.setSelectionFlag(!1),e&&c.onValidatedSelected(t,"unselect"),c.editableExpanderContainer.removeClassName("editableExpanderSelected"),c.editableExpanderHeader.removeClassName("validatedObjSelected"),c.getContent().getElementsByClassName("validRemoveButton").length&&c.getContent().getElementsByClassName("validRemoveButton")[0].hide(),c.checkBox&&(c.checkBox.checkFlag=!1);else if(c.editableExpanderContainer.hasClassName("editableExpanderSelected"))if(t.shiftKey)c.expanderSelection.onExpanderSelectedCB({id:c.expanderSelection.id,type:c.type,event:t,element:c});else{c.setSelectionFlag(!1),c.editableExpanderContainer.removeClassName("editableExpanderSelected"),c.checkBox&&(c.checkBox.checkFlag=!1),c.expanderUnselect.onExpanderUnselectCB({id:c.expanderSelection.id,type:c.type}),r=c.getContent().getElementsByClassName("editableImpCheckInfo");for(let e=0;e<r.length;e++)r[e].getElementsByClassName("impCheckRemoveButton")[0].hide();(d=c.getContent().getElementsByClassName("requirementRemoveButton")).length&&d[0].hide()}else{c.setSelectionFlag(!0);var n=!0;if(t.composedPath&&t.composedPath()&&t.composedPath().some(e=>e.hasClassName&&e.getParents().length&&e.hasClassName("editableHighlightThumbDiv"))&&(n=!1),n){c.checkBox&&(c.checkBox.checkFlag=!0,c.checkBox.getContent().show()),c.editableExpanderContainer.addClassName("editableExpanderSelected"),e&&c.expanderSelection.onExpanderSelectedCB({id:c.expanderSelection.id,type:c.type,event:t,element:c}),r=c.getContent().getElementsByClassName("editableImpCheckInfo");for(let e=0;e<r.length;e++){var i=r[e].getElementsByClassName("impCheckRemoveButton");i.length&&i[0].show()}(d=c.getContent().getElementsByClassName("requirementRemoveButton")).length&&d[0].show()}}},s.checkBox&&(this.checkBox=new a({type:"checkbox"}).inject(this.editableExpanderContainer),this.checkBox.getContent().addClassName("editableExpanderCheckBox"),"Validated"===this.type&&l.getTouchMode()?this.checkBox.getContent().setStyles({top:"22%"}):"Validated"===this.type?this.checkBox.getContent().setStyles({top:"3px"}):!1===this.expandedFlag?(this.checkBox.getContent().setStyles({top:"15%"}),l.getTouchMode()&&this.checkBox.getContent().setStyles({top:"22%"})):!0===this.expandedFlag&&l.getTouchMode()&&this.checkBox.getContent().setStyles({top:"9px"}),this.checkBox.getContent().hide(),this.checkBox.getContent().onclick=function(e){e.stopPropagation(),"Validated"===c.type?c.selectCheckBox(!0):c.select(!0,e)}),this.fDiv=e.createElement("div",{class:"fDiv"}).inject(this.editableExpanderHeader);var m=e.createElement("span",{class:"Highlight"===s.type?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-target"}).inject(this.fDiv);m.addClassName("fIcon");var g=e.createElement("div",{class:"fNb"}).inject(this.fDiv);this.fDiv.hide(),s.attachedObjs&&(g.setText(s.attachedObjs[0]),this.fDiv.show(),0===s.attachedObjs[0]&&(m.hide(),g.hide())),this.sDiv=e.createElement("div",{class:"sDiv"}).inject(this.editableExpanderHeader);var p=e.createElement("span",{class:"Highlight"===s.type?"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue":"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium"}).inject(this.sDiv);p.addClassName("sIcon");var C=e.createElement("div",{class:"sNb"}).inject(this.sDiv);s.attachedObjs&&(C.setText(s.attachedObjs[1]),this.sDiv.show(),0===s.attachedObjs[1]&&(p.hide(),C.hide())),this.elements.container.getElementsByClassName("wux-expander-icon-placeholder")[0].addClassName("editableExpanderIconPlaceholder"),l.getTouchMode()&&this.elements.container.getElementsByClassName("wux-expander-icon-placeholder")[0].setStyles({"padding-left":"38px"});var f=e.createElement("div",{class:"iconsDiv"});if(this.allowDnD){f.inject(this.getContent());var v=e.createElement("div",{class:"dragIconDiv"}).inject(f);v.draggable=!0,e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-drag-grip dndIcon"}).inject(v),this.elements.container.addEventListener("mouseenter",function(){var e=this.getElementsByClassName("dragIconDiv")[0];!0===this.dsModel.expandedFlag&&e&&e.show()}),this.elements.container.addEventListener("mouseleave",function(){var e=this.getElementsByClassName("dragIconDiv")[0];e&&e.hide()}),v.hide();var y=this.onDragStart;v.ondragstart=function(e){y(e)}}this.closeButton=new o({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"resize-small",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1}).inject(this.elements.headerContainer),this.closeButton.getContent().addClassName("expanderCloseButton"),this.closeButton.getContent().setStyles({"font-size":"9px"}),this.closeButton.hide(),this.closeButton.getContent().onclick=function(){h=!0},this.expanderSelection&&(this.editableExpanderContainer.onclick=function(e){h||(e.shiftKey||e.ctrlKey||e.target.hasClassName("normalCommentRepresentation")?e.stopPropagation():(n.empty(),i.empty()),c.select(!0,e)),h=!1}),this.editableExpanderContainer.onmouseenter=function(){c.checkBox&&c.checkBox.getContent().show()},this.editableExpanderContainer.onmouseleave=function(){c.checkBox&&!c.checkBox.checkFlag&&c.checkBox.getContent().hide()}},_expand:function(){if("Validated"!==this.type){if(this.closeButton.show(),this.fDiv&&this.fDiv.hide(),this.sDiv&&this.sDiv.hide(),this.getContent().getElementsByClassName("impCheckPlaceholder").length&&this.getContent().getElementsByClassName("impCheckPlaceholder")[0].show(),this.getContent().getElementsByClassName("caPlaceholder").length&&this.getContent().getElementsByClassName("caPlaceholder")[0].show(),this.getContent().getElementsByClassName("issuePlaceholder").length&&this.getContent().getElementsByClassName("issuePlaceholder")[0].show(),this.editableExpanderHeaderTitle.hide(),this.elements.header.addClassName("expandedHeader"),this.editableExpanderContainer.addClassName("editableExpanderExpContainer"),this.elements.icon.hide(),this.editableExpanderHeader.removeClassName("editableExpanderHeader"),this.onHighlightExpand){var e=this.getContent().getElementsByClassName("thumbnail");e.length>0?e[0].show():this.onHighlightExpand(this.getContent())}var t=this.elements.container.getElementsByClassName("dragIconDiv");if(t.length&&t[0].show(),this.checkBox)this.elements.container.getElementsByClassName("wux-expander-icon-placeholder")[0].setStyles({"padding-left":"0px"}),this.checkBox.getContent().setStyles({top:"7px"}),l.getTouchMode()&&this.checkBox.getContent().setStyles({top:"9px"});this._parent()}},_close:function(){if("Validated"!==this.type){if(this.closeButton&&this.editableExpanderHeaderTitle&&this.editableExpanderHeaderIcon&&this.editableExpanderContainer&&this.editableExpanderHeader&&this.elements.icon){this.fDiv&&(this.fDiv.show(),"0"===this.fDiv.getElementsByClassName("fNb")[0].getText()?(this.fDiv.getElementsByClassName("fNb")[0].hide(),this.fDiv.getElementsByClassName("fIcon")[0].hide()):(this.fDiv.getElementsByClassName("fNb")[0].show(),this.fDiv.getElementsByClassName("fIcon")[0].show())),this.sDiv&&(this.sDiv.show(),"0"===this.sDiv.getElementsByClassName("sNb")[0].getText()?(this.sDiv.getElementsByClassName("sNb")[0].hide(),this.sDiv.getElementsByClassName("sIcon")[0].hide()):(this.sDiv.getElementsByClassName("sNb")[0].show(),this.sDiv.getElementsByClassName("sIcon")[0].show())),this.getContent().getElementsByClassName("impCheckPlaceholder").length&&this.getContent().getElementsByClassName("impCheckPlaceholder")[0].hide(),this.getContent().getElementsByClassName("caPlaceholder").length&&this.getContent().getElementsByClassName("caPlaceholder")[0].hide(),this.getContent().getElementsByClassName("issuePlaceholder").length&&this.getContent().getElementsByClassName("issuePlaceholder")[0].hide(),this.getContent().getElementsByClassName("requirementRemoveButton").length&&this.getContent().getElementsByClassName("requirementRemoveButton")[0].hide();var e=this.getContent().getElementsByClassName("impCheckRemoveButton");for(let t=0;t<e.length;t++)e[t].hide();this.closeButton.hide(),this.editableExpanderHeaderTitle.show(),this.elements.icon.show(),this.editableExpanderContainer.removeClassName("editableExpanderExpContainer"),this.editableExpanderHeader.addClassName("editableExpanderHeader")}this.elements.header.removeClassName("expandedHeader");var t=this.getContent().getElementsByClassName("thumbnail");t.length>0&&t[0].hide();var n=this.elements.container.getElementsByClassName("dragIconDiv");if(n.length&&n[0].hide(),this.checkBox){var i=this.elements.container.getElementsByClassName("wux-expander-icon-placeholder")[0];i.setStyles({"padding-left":"28px"}),l.getTouchMode()&&i.setStyles({"padding-left":"38px"}),this.checkBox.getContent().setStyles({top:"15%"}),l.getTouchMode()&&this.checkBox.getContent().setStyles({top:"22%"})}this._parent()}}})}),define("DS/DMUControls/DMUCustomExpander",["require","exports","UWA/Core","DS/Controls/Toggle","DS/Controls/LineEditor","DS/Utilities/TouchUtils","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a){"use strict";return class{constructor(e){let t,l,s,r,d,c,h,u,m,g=e||{},p=this,C=a.getTouchMode(),f={},v=!1,y=!1,b=!1,w=!1,x=!0,D=!1,S=!0,E=!0,k=!1,M=!1,P=!1;function B(){if(P||!l||!m||!t||!r||!c||!h||!s||!u)return;C||y||(k||b?u.show():u.hide()),y&&(b=!1);let e=v&&l.firstChild;t.setStyles({outline:b?"2px solid #368ec4":e||k?"1px solid #c8c8c8":"","background-color":e||k?"rgba(40, 57, 106, 0.06)":"",height:e?"auto":"0px","grid-template-rows":e&&w?"28px calc(100% - 28px)":"18px calc(100% - 18px)"}),l.setStyles({opacity:e?1:0});let n=[],i=[],o=0;(f.icon||f.fontIcon)&&!w&&v&&n.push(25),!f.icon&&!f.fontIcon||v||n.push(25),l.firstChild&&D&&S?i.push(14):i.push(0),f.additionalDiv?v?i.push(30):i.push(50):i.push(0),n.forEach(e=>{o+=e}),i.forEach(e=>{o+=e});let a=n.length?n[0]+"px":"0px";a+=o?" calc(100% - "+o+"px)":"100%",i.length&&i.forEach(e=>{a+=" "+e+"px"}),r.setStyles({display:f.icon||f.fontIcon?"":"none"}),c.setStyles({display:l.firstChild&&D?"":"none"}),h.setStyles({display:f.additionalDiv&&S?"":"none"}),r.setStyles({display:E?"":"none"}),s.setStyles({"grid-template-columns":a,padding:v&&w?"0px 2px":"0px"})}this.build=(e=>{p.clear(),P=!0,f={icon:e.icon,fontIcon:e.fontIcon,fontIconColor:e.fontIconColor,label:e.label,additionalDiv:e.additionalDiv,body:e.body},(t=new n.Element("div",{class:"DMUCustomExpanderMainDiv"}))&&(t.dsModel=this,t.addEventListener("click",e=>{e.stopPropagation(),function(e){M?M=!1:(!x||e.shiftKey||e.ctrlKey||(v?p.collapse():p.expand()),p.setSelectedFlag(!0,e))}(e)}),C||(t.addEventListener("mouseenter",()=>{k=!0,B()}),t.addEventListener("mouseleave",()=>{k=!1,B()})),(u=new n.Element("div",{class:"DMUCustomExpanderCheckBox"}).inject(t))&&(m=new i({type:"checkbox",checkFlag:b}).inject(u))&&(m.getContent().addClassName("checkBox"),m.getContent().getChildren()[0].setStyles({"margin-bottom":"0px"}),m.addEventListener("buttonclick",function(e){e.stopPropagation(),M=!0,p.setSelectedFlag(!b,e)}),(l=new n.Element("div",{class:"DMUCustomExpanderBody"}).inject(t))&&(e.body&&l.appendChild(e.body),s=new n.Element("div",{class:"DMUCustomExpanderHeader"}).inject(t),r=new n.Element("div",{class:"DMUCustomExpHeaderIconContainer"}).inject(s),d=new n.Element("div",{class:"DMUCustomExpHeaderLabelContainer"}).inject(s),c=new n.Element("div",{class:"DMUCustomExpHeaderExpCollapseContainer"}).inject(s),new n.Element("div",{class:"DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds "+(v?"wux-ui-3ds-resize-small":"wux-ui-3ds-resize-full")}).inject(c),c&&c.addEventListener("click",e=>{e.stopPropagation(),v?this.collapse():this.expand()}),h=new n.Element("div",{class:"DMUCustomExpHeaderAddDivContainer"}).inject(s),p.setIcon({icon:e.icon,fontIcon:e.fontIcon,fontIconColor:e.fontIconColor}),p.setLabel(e.label),p.setAdditionalDiv(e.additionalDiv),P=!1,B())))}),this.getContent=(()=>t),this.setIcon=(e=>{if(r){for(f.icon=e?e.icon:"",f.fontIcon=e?e.fontIcon:"";r.firstChild;)r.removeChild(r.firstChild);if(f.icon)new n.Element("img",{class:"DMUCustomExpHeaderIcon",src:f.icon}).inject(r);else if(f.fontIcon){var t=new n.Element("div",{class:"DMUCustomExpHeaderFontIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds "+f.fontIcon}).inject(r);f.fontIconColor&&t.setStyles({color:f.fontIconColor})}B()}}),this.setLabel=(e=>{if(d){for(f.label=e;d.firstChild;)d.removeChild(d.firstChild);if(w&&!y){let t=new o({value:e,selectAllOnFocus:!0,displayClearFieldButtonFlag:!1}).inject(d);t.addEventListener("change",function(){f.label=t.value,g.onLabelChanged&&g.onLabelChanged({value:f.label,type:"name"})}),t.getContent().onclick=function(e){e.stopPropagation()},t.elements.inputField.setStyles({width:"111%"}),t.getContent().title=e}else{let t=new n.Element("p",{class:"DMUCustomExpHeaderLabel"}).inject(d);t.innerText=e,t.title=e}g.onLabelChanged&&g.onLabelChanged({value:f.label,type:"name"}),B()}}),this.setAdditionalDiv=(e=>{if(h){for(f.additionalDiv=e;h.firstChild;)h.removeChild(h.firstChild);e&&h.appendChild(e),B()}}),this.setAdditionalDivVisibleFlag=(e=>{S=e,B()}),this.setCheckBoxClickedFlag=(e=>{M=e,B()}),this.setExpandOrCollapseButtonVisibleFlag=(e=>{D=e,B()}),this.setLabelEditionFlag=(e=>{w=e,p.setLabel(f.label)}),this.setHeaderIconVisibleFlag=(e=>{E=e,B()}),this.expandOrCollapseAtClick=(e=>{x=e}),this.setSelectedFlag=((e,t)=>{e!==b&&(e!==b&&(b=e),m&&(m.checkFlag=b,B()),g.onSelectedFlagChanged&&g.onSelectedFlagChanged({state:b,event:t}))}),this.setReadOnly=(e=>{y!==e&&(y=e,B())}),this.expand=(()=>{v||(v=!0,g.onExpandOrCollapse&&g.onExpandOrCollapse({object:p,state:v}),B(),c&&c.setStyles({"grid-column":"3"}),c&&c.getElementsByClassName("DMUCustomExpHeaderExpIcon").length&&(c.getElementsByClassName("DMUCustomExpHeaderExpIcon")[0].className="DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-resize-small"))}),this.collapse=(()=>{v&&(v=!1,g.onExpandOrCollapse&&g.onExpandOrCollapse({object:p,state:v}),B(),c&&c.setStyles({"grid-column":"4"}),c&&c.getElementsByClassName("DMUCustomExpHeaderExpIcon").length&&(c.getElementsByClassName("DMUCustomExpHeaderExpIcon")[0].className="DMUCustomExpHeaderExpIcon wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-resize-full"))}),this.clear=(()=>{f={},t=m=l=void 0,M=k=!1}),this.isCheckBoxClicked=(()=>M),this.isSelected=(()=>b),this.isReadOnly=(()=>y),this.isExpanded=(()=>v)}}}),define("DS/DMUControls/DMUThumbnailChooser",["UWA/Core","UWA/Class","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/VisuEvents/EventsManager","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o){"use strict";var a=t.extend({init:function(t){var n,i,a=t||{};if(this._parent(a),this.inject=function(e){return n.inject(e),this},this.clear=function(){o.removeEvent(n,"onPrimaryPointerClick",i)},n=e.createElement("div",{class:"DMUAdditionalCommand"}),a.icon){var l=e.createElement("img",{src:a.icon}).inject(n);l.setStyles({width:"22px",height:"22px"}),l.ondragstart=function(){return!1}}i=function(){a.cb()};var s=e.createElement("p").inject(n);s.innerHTML=a.nls,s.title=a.nls,o.addEvent(n,"onPrimaryPointerClick",i)}});return t.extend({init:function(t){var o=t||{};this._parent(o);var l,s,r=this,d=[],c=[];this.build=function(t){var o;r.clean(),l=e.createElement("div",{class:"DMUThumbnailChooserMainDiv"}),(s=(new i).inject(l)).getContent().setStyle("height","100%");var h=e.createElement("div",{class:"DMUThumbnailScrollerContainer"});s.getInnerElement().setContent(h);var u=e.createElement("div",{class:"DMUThumbnailChooserMainContainer"}).inject(h);if(!t||!t.thumbnailData)return l;var m,g=function(e){for(o=0;o<d.length;o++)d[o].setDisplayFlag(d[o].getThumbnailID()===e.id);t.onThumbnailSelectedCB&&t.onThumbnailSelectedCB({id:e.id})};for(o=0;o<t.thumbnailData.length;o++)m=new n({id:t.thumbnailData[o].id,icon:t.thumbnailData[o].icon,width:208,height:121,title:t.thumbnailData[o].title,preview:t.thumbnailData[o].preview,displayFlag:t.thumbnailData[o].isSelected,clickCB:g}).inject(u),d.push(m);if(t.additionalCommands)for(o=0;o<t.additionalCommands.length;o++){var p=new a(t.additionalCommands[o]);p.inject(h),c.push(p)}return l.setStyles({width:r.getWidth()+"px",height:r.getHeight()+"px"}),l},this.getHeight=function(){var e=c?40*c.length:0;return d.length<=3?e+121:d.length<=6?e+242:e+363},this.getWidth=function(){return 1===d.length?208:2===d.length?416:624},this.getContent=function(){return l},this.clean=function(){for(var e=0;e<d.length;e++)d[e].clear();d.length=0,s&&s.destroy(),l=s=null}}})}),define("DS/DMUControls/panels/DMUDocumentPanel",["UWA/Core","DS/Windows/Dialog","DS/Controls/Button","DS/DataGridView/DataGridView","DS/Tree/TreeDocument","DS/Tree/TreeNodeModel","UWA/Class","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,a,l,s){"use strict";return l.extend({init:function(l){this._parent(l);let r,d=this;this.build=function(c,h,u){if(d.destroy(),l.immersiveFrame&&c&&c.data&&c.title){let d=new e.Element("div"),f=s.documentPanel?s.documentPanel:{};"delete"===c.mode&&new e.Element("div",{html:"<p>"+f.documentDelete+"</p><p>"+f.documentReroute+"</p>"}).inject(d);var m=new o;c.data.forEach(function(e){m.addRoot(new a({label:e.title,grid:e}))});var g=[{text:f.documentTitle,dataIndex:"tree"}];c.displayRevisions&&g.push({text:f.documentRevision,dataIndex:"revision"}),g=g.concat([{text:f.documentModificationDate,dataIndex:"modifiedDate"},{text:f.documentCreationDate,dataIndex:"creationDate"}]);var p=new i({identifier:"DMUDocumentPanelDataGrid",treeDocument:m,columns:g,rowSelection:"single",cellSelection:{defaultValue:"none"},rowDragEnabledFlag:!1,allowUnsafeHTMLContent:!1,cellDragEnabledFlag:!1,activateAllCellsRenderedEventFlag:!0,showRowBorderFlag:!0,placeholder:"",recId:"DMUDocumentPanelDataGrid",position:"relative"});if("delete"===c.mode){var C=e.createElement("div",{styles:{position:"relative",height:150,margin:"10px 0px"}});p.inject(C),C.inject(d)}else p.inject(d);let v=new n({label:f.okLabel,onClick:function(){var e=p.getTreeDocument().getSelectedNodes();if(e&&e.length){var t=e[0].options.grid.versions;h(e[0].options.grid.fileId,t),r&&r.destroy(),r=null}}}),y=new n({label:f.cancelLabel,onClick:function(){r&&r.close()}});(r=new t({identifier:"dialog",modalFlag:!0,title:c.title,content:d,height:200,width:650,position:{my:"center",at:"center"},resizableFlag:!0,immersiveFrame:l.immersiveFrame,buttons:{Ok:v,Cancel:y}})).addEventListener("close",function(){u&&u(),r&&r.destroy(),r=null})}},this.destroy=function(){r&&r.destroy(),r=null}}})}),define("DS/DMUControls/DMUOptionsPanel",["UWA/Core","UWA/Class","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Toggle","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){var l=t||{};if(this._parent(l),l.frmWindow&&l.options&&l.options.length&&l.cb){var s,r=e.createElement("div",{class:"DMUPasteSpecialPanelMainDiv"}),d=[];if(t.options&&t.options.length)for(var c=0;c<t.options.length;c++)d.push(new o({label:t.options[c].nls,value:t.options[c].id,type:"checkbox",checkFlag:t.options[c].value}).inject(r));var h={};h.Ok=new i({emphasize:"primary",onClick:function(){u(!1)}}),h.Abort=new i({label:a.cancelButton,onClick:function(){s.close?s.close():s.destroy()}}),l.prefs&&l.prefs.applyButtonNls&&(h.Apply=new i({onClick:function(){u(!0)}})),s=new n({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:t.panelTitle,content:r,immersiveFrame:l.frmWindow.getImmersiveFrame(),buttons:h})}function u(e){for(var t={},n=0;n<d.length;n++)t[d[n].value]=d[n].checkFlag;l&&l.cb&&l.cb(t,e),e||(s.close?s.close():s.destroy())}}})}),define("DS/DMUControls/panels/DMUSlidesPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","DS/Core/ModelEvents","DS/CATWebUXComponents/CATWebUXThumbnail","UWA/Controls/ThemedScroller","DS/Controls/Expander","DS/Utilities/TouchUtils","DS/WebappsUtils/WebappsUtils","DS/VisuEvents/EventsManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/Menu/ContextualMenu","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s,r,d,c,h,u){"use strict";let m,g,p=l.extend({init:function(t){let n=t||{};n.onMarkupCtxMenuCB&&(n.customHeader=e.createElement("div",{class:"DMUBrowserSectionMenuButton"}),n.customHeader.appendChild(e.createElement("div",{class:"wux-ui-3ds wux-ui-3ds-lg wux-ui-3ds-menu-dot"})),n.customHeader.addEventListener("click",function(e){e.stopPropagation(),t.onMarkupCtxMenuCB({id:t.id,event:e})})),this._parent(n);let i,o,a=!1,l=e.createElement("div",{class:"DMUBrowserSectionShadingCol"}),s=this,r=!1,c=[],m=!1,g=e.createElement("div",{class:"DMUBrowserSectionReplySection"}),p=e.createElement("div",{class:"DMUReplySubSectionHeaderDiv"}).inject(g);p.setStyle("padding-left","10px");let C=e.createElement("div",{class:"DMUReplySubSectionArrow wux-ui-3ds wux-ui-3ds-expand-right"}).inject(p),f=e.createElement("p",{class:"DMUReplySubSectionHeaderText"}).inject(p);f.setText(u.showMoreLabel);let v=d.addEvent(p,"onPrimaryPointerClick",function(){s.setReplySectionExpandedFlag(!m)});if(this.addChild=function(e,t){null!=t?s.body.insertBefore(e,s.body.children[t]):(e.inject(s.body),c.length&&(s.body.removeChild(g),s.body.appendChild(g)))},this.getChildIndex=function(e){return Array.prototype.indexOf.call(s.body.children,e)},this.removeChild=function(e){s.body.removeChild(e)},this.setNoDiv=function(e){e?(s.body.appendChild(e),o=e):s.body.contains(o)&&s.body.removeChild(o)},this.getContent=function(){return this.elements.container},this.setShadingColor=function(e){a=e,l.setStyle("background-color",a?"rgb(87, 184, 71)":"")},this.addReply=function(e){c.push(e),g.appendChild(e.getContent()),c.length&&s.body.appendChild(g),e.setVisibleFlag(m)},this.setReplySectionExpandedFlag=function(e){if(m!==e){m=e;for(let e=c.length-1;e>=0;e--)c[e].setVisibleFlag(m);f.setText(m?u.showLessLabel:u.showMoreLabel),m?(C.hasClassName("wux-ui-3ds-expand-right")&&C.removeClassName("wux-ui-3ds-expand-right"),C.addClassName("wux-ui-3ds-expand-down")):(C.hasClassName("wux-ui-3ds-expand-down")&&C.removeClassName("wux-ui-3ds-expand-down"),C.addClassName("wux-ui-3ds-expand-right"))}},this.getReplySectionExpandedFlag=function(){return m},this.removeReply=function(e){-1!==c.indexOf(e)&&c.splice(c.indexOf(e,1)),g.removeChild(e.getContent()),c.length||s.body.removeChild(g)},this.setActiveMarkup=function(e){r=e,s.elements.header.setStyles({color:!s.expandedFlag&&r?"#368ec4":""})},this.setCtxMenuVisibility=function(e){n.customHeader&&n.customHeader.setStyle("display",e?"":"none")},this.clear=function(){i&&h.removeEventListener(this.elements.header,i),d.removeEventFromToken(v),i=v=null},this.setTitle=function(e){s.header=e},this.body=e.createElement("div",{class:"DMUBrowserSectionThumbsMainContainer DMUSlidePanelMarkupDiv"}),this.elements.header.appendChild(l),this.style="simple",this.icon=n.icon,n.onMarkupCtxMenuCB&&(i=h.addEventListener(this.elements.header,{callback:function(e){n.onMarkupCtxMenuCB({id:n.id,event:e.data.event})}})),n.children&&n.children.length)for(let e=0;e<n.children.length;e++)s.addChild(n.children[e].getContent());this.getContent().addEventListener("expand",function(){s.elements.header.setStyle("color",""),l.setStyle("display","none")}),this.getContent().addEventListener("collapse",function(){r&&s.elements.header.setStyle("color","#368ec4"),l.setStyle("display","")}),this.getContent().addClassName("DMUMarkupExpander"),this.expand(),this.setTitle(n.name)}}),C=t.extend({init:function(t){let n=t||{};this._parent(n);let i,o,a,l,r,c,h,C,f,v,y,b=null,w=null,x=null,D=e.createElement("div",{class:"DMUBrowserNoSlidesTitleDiv"}),S=!1,E=this,k=[],M=e.createElement("div",{id:"DMUDraggableThumbnailDiv",class:"DMUDraggableThumbnailDiv"}),P=!1,B=!0,U=[],I=!!n.allowSlideReorder&&n.allowSlideReorder,_=!1===n.webMarkup;function F(e){(("Escape"===e.key||27===e.keyCode)&&"keydown"===e.type||"keyup"===e.type&&"Shift"===e.key)&&(c&&(c.setStyles({"padding-top":"","padding-bottom":""}),c=null),h=!0,j())}function R(e){(!e.shiftKey&&v||e.shiftKey&&!v)&&(y=!0,setTimeout(function(){y=!1},400))}function T(n){if(y)return void(y=!1);h=!1;let i=n.from[0].view.closest(".DMUSlideAndReplyMainDiv"),o=k.find(function(e){return e.getContent()===i});if(!o||o.isInEdition())return;document.addEventListener("keydown",F),document.addEventListener("keyup",F),o.isChecked()?k.forEach(function(e){e.isChecked()&&U.push(e)}):U.push(o);let a=o.getContent().getPosition(document.body),l=n.from[0].getCurrentPosition(document.body);C={x:a.x-l.x,y:a.y-l.y},U.forEach(function(e){let t=e.getContent(),n=t.getPosition(document.body),i=t.firstChild.cloneNode(!0);t.setStyle("display","none"),i.removeChild(i.firstElementChild),i.style.opacity=.8,i.style.left=n.x-l.x+"px",i.style.top=n.y-l.y+"px",i.style.position="absolute",i.classList.add("DMUAnimateDrag"),i.addEventListener("transitionend",function(){i.classList.remove("DMUAnimateDrag")},{once:!0}),M.appendChild(i)}),U.length>1&&e.createElement("div",{id:"DMUDragThumbnailCount",class:"DMUDragThumbnailCount",text:U.length}).inject(M),M.setStyle("transform",`translate(${l.x}px, ${l.y}px)`),document.body.appendChild(M),B=!0,t.onSlidesDragStart()}function j(){if(f&&(d.removeEvent(f,"onPrimaryPointerMoveUnique",N),d.removeEvent(f,"onPrimaryPointerUpUnique",j),f=null),U.length){for(document.removeEventListener("keydown",F),document.removeEventListener("keyup",F),document.body.contains(M)&&document.body.removeChild(M),M.setStyles({transform:""});M.children.length;)M.removeChild(M.firstElementChild);if(U.forEach(function(e){let t=e.getContent();t.setStyle("display",""),t.remove()}),c){let e;b?(e=b.getChildIndex(c),U.forEach(function(t,n){b.addChild(t.getContent(),(P?e:e+1)+n)})):(e=Array.prototype.indexOf.call(w.children,c),U.forEach(function(t,n){let i=t.getContent();P?w.insertBefore(i,c):w.insertBefore(i,w.children[e+n+1])})),k.sort(function(e,t){let n,i;return b?(n=b.getChildIndex(e.getContent()),i=b.getChildIndex(t.getContent())):(n=Array.prototype.indexOf.call(w.children,e.getContent()),i=Array.prototype.indexOf.call(w.children,t.getContent())),n<i?-1:n>i?1:0}),t.onSlidesDragEnd({orderedSlideIDs:k.map(function(e){return e.getID()})}),c.addClassName("noTransition"),c.setStyles({"padding-top":"","padding-bottom":""}),window.requestAnimationFrame(function(){c&&(c.removeClassName("noTransition"),c=null)})}else k.forEach(function(e,t){let n=e.getContent();if(b&&-1===b.getChildIndex(n))if(k[t-1]){let e=b.getChildIndex(k[t-1].getContent());b.addChild(n,e+1)}else b.addChild(n,0);else b||!w||w.contains(n)||(k[t-1]?w.insertBefore(n,k[t-1].getContent().nextSibling):w.insertBefore(n,w.children[1]))}),t.onSlidesDragEnd({});U.length=0,C=null}}function N(e){if(h&&"begin"!==e.state)return;let n=e.from[0].event;if(v&&n.shiftKey||!v&&!n.shiftKey)return;let i=n.composedPath();if("begin"===e.state)T(e);else if(i&&i.includes(w)){if(!U.length)return;B&&(B=!1,M.getChildren().forEach(function(e,t,n){let i=2*(n.length-t-1);e.style.left=i+C.x+"px",e.style.top=i+C.y+"px"}),f&&t.onSlidesDragStart({isTouch:s.getTouchMode()}));let n=e.from[0].getCurrentPosition(document.body);M.setStyle("transform",`translate(${n.x}px, ${n.y}px)`);let i=document.elementFromPoint(n.x,n.y),o=i&&i.hasClassName&&i.getParent?i.hasClassName("DMUSlideAndReplyMainDiv")?i:i.getParent(".DMUSlideAndReplyMainDiv"):null;if(o){let e=M.firstElementChild.offsetHeight;o.firstElementChild.getPosition(document.body,{y:"center"}).y>=n.y?c===o&&P||(c&&c.setStyles({"padding-top":"","padding-bottom":""}),(c=o).setStyles({"padding-top":e+"px"}),P=!0):(c!==o||P)&&(c&&c.setStyles({"padding-top":"","padding-bottom":""}),(c=o).setStyles({"padding-bottom":e+"px"}),P=!1)}else c&&(c.setStyles({"padding-top":"","padding-bottom":""}),c=null)}"end"===e.state&&j()}function A(e){v&&(f=e.gesture.view[0],T(e),d.addEvent(f,"onPrimaryPointerMoveUnique",N),d.addEvent(f,"onPrimaryPointerUpUnique",j))}if(this.enableDefaultReorder=function(e){v=e},n.displayInExpanders)n.noSlideDiv=D,b=new p(n),w=b.getContent();else if(w=e.createElement("div",{class:"DMUSlidePanelMarkupDiv DMUBrowserThumbsMainContainer"}),x=e.createElement("div",{class:"DMUBrowserThumbsTitleDiv"}).inject(w),a=e.createElement("div",{class:"DMUBrowserSectionShadingCol"}).inject(x),n.icon&&(r=e.createElement("img",{class:"DMUBrowserThumbsIcon",src:n.icon}).inject(x)),l=e.createElement("p",{class:"DMUBrowserThumbsTitle"}).inject(x),n.name||x.setStyle("display","none"),l.textContent=n.name,n.children&&n.children.length)for(let e=0;e<n.children.length;e++){k.push(n.children[e]);let t=k[e].getContent();i||!I||_||(s.getTouchMode()?d.addEvent(t,"onMediumHold",A):d.addEvent(t,"onPrimaryPointerDownUnique",L)),t.inject(w)}else D.inject(w);function L(e){if(!e.from[0].view.hasClassName("CATWebUXThumbnailFavoriteDiv")&&(e.from[0].event.shiftKey&&!v||!e.from[0].event.shiftKey&&v)){let t=!1,n=d.addEvent(e.from[0].view.getClosest(".DMUSlidePanelThumbMainContainer"),"onMouseMove",e=>{t?N(e):(T(e),t=!0)}),i=d.addEvent(document.body,"onPrimaryPointerUpUnique",()=>{d.removeEventFromToken(i),d.removeEventFromToken(n),t&&(j(),t=!1)})}}this.refreshNoSlideDiv=function(){for(;D.firstChild;)D.removeChild(D.firstChild);let a;o&&d.removeEventFromToken(o),D.hasClassName("DMUBrowserCreateElementTitleDiv")&&D.removeClassName("DMUBrowserCreateElementTitleDiv"),i||_?(a=e.createElement("div",{class:"DMUBrowserNoElementsTitleTextDiv"}).inject(D)).innerText=g||u.noSlidesTitle:(D.addClassName("DMUBrowserCreateElementTitleDiv"),e.createElement("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus DMUEmptyMarkupPlusBtn"}).inject(D),(a=e.createElement("div",{class:"DMUBrowserCreateElementTextDiv"}).inject(D)).innerText=m||u.createSlideTitle,o=d.addEvent(D,"onPrimaryPointerClick",function(){t.onNewSlideCreated(n.id)}))},this.setReadOnlyFlag=function(e){if(i!==e){i=e,E.setAllowSlideReorderFlag(n.allowSlideReorder&&!i&&!_),E.refreshNoSlideDiv(),b&&b.setCtxMenuVisibility(!i);for(let e=0;e<k.length;e++)k[e].setReadOnlyFlag(i)}},this.setAllowSlideReorderFlag=function(e){I!==e&&(I=e&&!i&&!_,k.forEach(function(e){I?s.getTouchMode()?d.addEvent(e.getContent(),"onMediumHold",A):(d.addEvent(e.getContent(),"onPrimaryPointerDownUnique",L),e.getContent().addEventListener("drop",R)):s.getTouchMode()?d.removeEvent(e.getContent(),"onMediumHold",A):(d.removeEvent(e.getContent(),"onPrimaryPointerDownUnique",L),e.getContent().removeEventListener("drop",R))}))},this.setExpandedFlag=function(e){b&&b.expandedFlag!==e&&(e?b.expand():b.close())};let H=!1;this.startTitleEdition=function(){if(b&&!i){let t=b.elements.header.children;for(let e=0;e<t.length;e++)t[e].style.display="none";let i=e.createElement("p",{class:"DMUMarkupEditableDiv",contenteditable:!0}).inject(b.elements.header);i.innerText=n.name,window.getSelection().removeAllRanges();let o=document.createRange();o.selectNodeContents(i),window.getSelection().addRange(o),i.focus(),H=!0;let a=function(e){if(H){H=!1,b.elements.header.removeChild(i);for(let e=0;e<t.length;e++)t[e].style.display="";e||(n.name=i.innerText,b.header=i.innerText,n.onMarkupRenamed(i.innerText))}};i.addEventListener("keyup",function(e){e.stopPropagation()}),i.addEventListener("click",function(e){e.stopPropagation()}),i.addEventListener("keydown",function(e){"Enter"!==e.key&&13!==e.keyCode&&"Escape"!==e.key&&27!==e.keyCode||a("Escape"===e.key||27===e.keyCode)}),i.addEventListener("blur",a)}},this.getExpandedFlag=function(){return Boolean(b&&b.expandedFlag)},this.getExpanderHeader=function(){return b?b.elements.header:null},this.getContent=function(){return w},this.addChild=function(e,t){if(null!=t&&t<k.length?k.splice(t,0,e):k.push(e),i||_||!I||(s.getTouchMode()?d.addEvent(e.getContent(),"onMediumHold",A):(d.addEvent(e.getContent(),"onPrimaryPointerDownUnique",L),e.getContent().addEventListener("drop",R))),b){let n;if(t>0){n=0;for(let e=0;e<t;e++)k[e]&&(n+=1,n+=k[e].getReplies().length)}b.addChild(e.getContent(),n),b.icon=void 0,b.setNoDiv(null)}else w.contains(D)&&w.removeChild(D),null!=t?w.insertBefore(e.getContent(),w.children[t+1]):e.getContent().inject(w),r&&(x.removeChild(r),r=null,l&&l.setStyles({"margin-left":"25px"}));e.setReadOnlyFlag(i)},this.removeChild=function(e){let t=k.indexOf(e);-1!==t&&(s.getTouchMode()?d.removeEvent(e.getContent(),"onMediumHold",A):(d.removeEvent(e.getContent(),"onPrimaryPointerDownUnique",L),e.getContent().removeEventListener("drop",R)),b?b.removeChild(e.getContent()):w.removeChild(e.getContent()),e.clear(),k.splice(t,1),k.length||(b?b.setNoDiv(D):D.inject(w)))},this.removeChildren=function(){for(let e=k.length-1;e>=0;e--)E.removeChild(k[e])},this.updateShadingColor=function(){let e,t=!1;if(k&&k.length){for(t=!0,e=0;e<k.length;e++)if(!k[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<k.length;e++)k[e].setDisplayFlag(!0,!0)}E.setShadingColor(t)},this.setShadingColor=function(e){b?b.setShadingColor(e):a&&a.setStyles({"background-color":e?"rgb(87, 184, 71)":"",top:"5px",left:"3px"})},this.setActiveMarkup=function(e){if(b&&b.setActiveMarkup(e),S=e,k)for(let e=0;e<k.length;e++)k[e].setReplyButtonActiveFlag(!n.readOnly&&S)},this.isActiveMarkup=function(){return S},this.setTitle=function(e){b&&b.setTitle(e)},this.clear=function(){for(let e=k.length-1;e>=0;e--)E.removeChild(k[e]);k.length=0,b&&b.clear(),b=null};let W=[];this.addReply=function(e){W.push(e),b&&b.addReply(e)},this.removeReply=function(e){if(b&&e&&e.id)for(let t=W.length-1;t>=0;t--)W[t].getThumbnailID()===e.id&&(b.removeReply(W[t]),W.splice(t,1))},this.removeReplies=function(e){if(b&&e&&e.replyID)for(let t=W.length-1;t>=0;t--)W[t].getParentID()===e.replyID&&(b.removeReply(W[t]),W.splice(t,1))},this.setReplySectionExpandedFlag=function(e){b&&b.setReplySectionExpandedFlag(e)},this.updateRepliesShadingColor=function(){let e,t=!1;if(W&&W.length){for(t=!0,e=0;e<W.length;e++)if(!W[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<W.length;e++)W[e].setDisplayFlag(!0,!0)}},this.getReplies=function(){return W},this.setReadOnlyFlag(Boolean(n.readOnly)),this.updateShadingColor(),this.refreshNoSlideDiv(),b?b.setNoDiv(D):D.inject(w)}}),f=o.extend({init:function(t){this._parent(t);let n,i,o,a,l=this,s=[],c=e.createElement("div",{class:"DMUSlideAndReplyMainDiv"}),h=!1,m="single",g=t.userName,p=t.showReplyButton,C=!0,f=!1===t.webMarkup,v=!0===t.readOnly;function y(){if(s.length){let e=0;for(let t=0;t<s.length;t++)e++,s[t].setThumbnailPrefix(l.getThumbnailPrefix()+e.toString()+".")}}function b(){let e,t="DMUReplySingleColRepLink"+(g?"_WithUserCred":""),i="DMUReplyMultiColRepLink"+(g?"_WithUserCred":""),o="DMUReplyMultiColAfterLink"+(g?"_WithUserCred":"");for(let n=s.length-1;n>=0;n--)e=s[n].getContent(),"multi"===m?(e.hasClassName("DMUReplySingleColRep")&&e.removeClassName("DMUReplySingleColRep"),e.hasClassName(t)&&e.removeClassName(t),e.hasClassName("DMUReplyMultiColRep")||e.addClassName("DMUReplyMultiColRep"),e.hasClassName(i)||e.addClassName(i),n<s.length-1&&!e.hasClassName(o)?e.addClassName(o):n===s.length-1&&e.hasClassName(o)&&e.removeClassName(o)):"single"===m&&(e.hasClassName("DMUReplyMultiColRep")&&e.removeClassName("DMUReplyMultiColRep"),e.hasClassName(i)&&e.removeClassName(i),e.hasClassName(o)&&e.removeClassName(o),e.hasClassName("DMUReplySingleColRep")||e.addClassName("DMUReplySingleColRep"),n<s.length-1&&!e.hasClassName(t)?e.addClassName(t):n===s.length-1&&e.hasClassName(t)&&e.removeClassName(t));n&&n.setStyles({"text-align":"single"===m?"left":"right"})}let w=this.getContent;this.getContent=function(){return c},this.getDate=function(){return t.creationDate},this.updateReplyButtonVisibility=function(){l.setReplyButtonVisibility(!v&&p&&C&&(!t.isReply||t.isReply&&!f)),s&&s.forEach(e=>{e.updateReplyButtonVisibility()})};let x=this.setThumbnailPrefix;this.setThumbnailPrefix=function(e){x(e),y()};let D=this.setThumbnailActiveFlag;function S(){let e="DMUSlideWithReplies"+(g?"_WithUserCred":"");"single"!==m&&h&&s.length?w().hasClassName(e)||w().addClassName(e):w().hasClassName(e)&&w().removeClassName(e)}function E(){s&&s.length&&s.sort(function(e,t){return e.getDate()-t.getDate()})}this.setThumbnailActiveFlag=function(e){D(e),s&&s.forEach(t=>{t.setThumbnailActiveFlag(e)})};let k=this.setReadOnlyFlag;this.setReadOnlyFlag=function(e){if(k(e||f),v=e,l.setCtxMenuAvailability(!v&&!f),l.setIsCheckableFlag(!v&&!f),l.updateReplyButtonVisibility(),s)for(let t=0;t<s.length;t++)s[t].setReadOnlyFlag(e)},this.allowReply=function(e){p=e,l.updateReplyButtonVisibility()},this.setReplyButtonActiveFlag=function(e){C=e,l.updateReplyButtonVisibility()};let M=this.setVisibleFlag;this.setVisibleFlag=function(e){M(e),c.setStyles({display:e?"":"none"});for(let t=0;t<s.length;t++)s[t].setVisibleFlag(e)},this.getID=function(){return t.id},this.getParentID=function(){return t.parentID},this.setReplySectionExpandedFlag=function(e){if(h!==e){h=e;for(let e=s.length-1;e>=0;e--)s[e].setVisibleFlag(h);i.setText(h?u.hideRepliesLabel:u.showRepliesLabel),h?(o.hasClassName("wux-ui-3ds-expand-right")&&o.removeClassName("wux-ui-3ds-expand-right"),o.addClassName("wux-ui-3ds-expand-down")):(o.hasClassName("wux-ui-3ds-expand-down")&&o.removeClassName("wux-ui-3ds-expand-down"),o.addClassName("wux-ui-3ds-expand-right")),S()}},this.getReplySectionExpandedFlag=function(){return h},this.addReply=function(t){s.push(t),1!==s.length||n||(n=e.createElement("div",{class:"DMUReplySubSectionHeaderDiv"}).inject(c),o=e.createElement("div",{class:"DMUReplySubSectionArrow wux-ui-3ds wux-ui-3ds-expand-right"}).inject(n),(i=e.createElement("p",{class:"DMUReplySubSectionHeaderText"}).inject(n)).setText(u.showRepliesLabel),a=d.addEvent(n,"onPrimaryPointerClick",function(){l.setReplySectionExpandedFlag(!h)}));let r=s.length>1?s[s.length-2].getContent():c;r.nextSibling?c.parentNode.insertBefore(t.getContent(),r.nextSibling):c.parentNode.appendChild(t.getContent()),t.setVisibleFlag(h),E(),b(),S(),y()},this.removeReplies=function(e){if(e&&e.replyID){for(let t=s.length-1;t>=0;t--)s[t].getParentID()===e.replyID&&(s[t].getContent().parentNode.removeChild(s[t].getContent()),s[t].clear(),s.splice(t,1));s.length||(a&&d.removeEventFromToken(a),n&&c.removeChild(n),n=null,h=!1),E(),S(),y()}},this.updateCreationDates=function(){t.creationDate&&l.updateUserCredentials({date:e.String.parseRelativeTime(t.creationDate.toString())}),s&&s.length&&s.forEach(e=>{e.updateCreationDates()})},this.removeReply=function(e){if(e&&e.id)for(let t=s.length-1;t>=0;t--)if(s[t].getThumbnailID()===e.id)return s[t].getContent().parentNode.removeChild(s[t].getContent()),s[t].clear(),s.splice(t,1),s.length||(a&&d.removeEventFromToken(a),c.removeChild(n),n=null,h=!1),E(),S(),y(),!0},this.updateRepliesShadingColor=function(){let e,t=!1;if(s&&s.length){for(t=!0,e=0;e<s.length;e++)if(!s[e].getDisplayFlag()){t=!1;break}if(t)for(e=0;e<s.length;e++)s[e].setDisplayFlag(!0,!0)}},this.updateRepliesPosition=function(){for(let e=s.length-1;e>=0;e--){let t=s[e];t.getContent().remove(),c.nextSibling?c.parentElement.insertBefore(t.getContent(),c.nextSibling):c.parentElement.appendChild(t.getContent())}y()};let P=this.setTitleAndIconSectionVisibleFlag;this.setTitleAndIconSectionVisibleFlag=function(e){P(e),s.forEach(t=>{t.setTitleAndIconSectionVisibleFlag(e)})},this.getReply=function(e){if(e&&e.id)for(let t=s.length-1;t>=0;t--)if(s[t].getThumbnailID()===e.id)return{reply:s[t],parent:l};return!1},this.getReplies=function(){return s},this.updateReply=function(e){if(e&&e.id&&e.info)for(let t=s.length-1;t>=0;t--)s[t].getThumbnailID()===e.id&&(e.info.name&&s[t].setThumbnailTexts({title:e.info.name}),e.info.img&&s[t].setPreview(e.info.img),void 0!==e.info.titleEditionAllowed&&s[t].allowTitleEdition(e.info.titleEditionAllowed),void 0!==e.info.checkFlag&&s[t].setCheckFlag(e.info.checkFlag,null,!1),Object.prototype.hasOwnProperty.call(e.info,"highlight")&&(s[t].setInformationIcon(e.info.highlight?r.getWebappsAssetUrl("DMUBaseUI","icons/32/")+"I_DMU_ReviewHighlight.png":""),e.info.highlight&&(s[t].setIsDraggable(!0),s[t].setFavoriteDivDragContent(e.info.highlight))))},this.clear=function(){for(let e=s.length-1;e>=0;e--)s[e].getContent().parentNode.removeChild(s[e].getContent()),s[e].clear(),s.splice(e,1);a&&d.removeEventFromToken(a)},this.setReplyRepresentation=function(e){m!==e&&(m=e,b(),S())},c.appendChild(w()),l.updateCreationDates(),l.allowReply(p),l.setReadOnlyFlag(Boolean(v))}});return t.extend({init:function(t){this._parent(t);let o,l,h,p,v,y,b,w,x,D,S,E,k=t||{},M=this,P=[],B=[],U=[],I=!1,_=!1,F=!!k.allowReplies&&k.allowReplies,R=!!k.allowSlideReorder&&k.allowSlideReorder,T=!!k.allowMarkupReorder&&k.allowMarkupReorder,j=!1,N=new i,A=-1,L=[],H=[],W=!1,O=e.createElement("div",{id:"DMUDraggableExpanderDiv",class:"DMUDraggableThumbnailDiv"});function V(e,t){return N.publish({event:e,data:t,context:M})}function z(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)j?P[t].markupSlides[e].setVisibleFlag(-1!==U.indexOf(P[t].markupSlides[e].getThumbnailID())):P[t].markupSlides[e].setVisibleFlag(!0);if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=n.length-1;e>=0;e--)j?n[e].setVisibleFlag(-1!==U.indexOf(n[e].getThumbnailID())):n[e].setVisibleFlag(!0)}}}function q(e){let t;for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++)if(P[n].markupSlides[t]){if(P[n].markupSlides[t].getThumbnailID()===e)return{section:P[n].section,thumbnail:P[n].markupSlides[t]};let i=P[n].markupSlides[t].getReply({id:e});if(i&&i.reply)return{section:P[n].section,thumbnail:i.reply,parent:i.parent}}if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(t=i.length-1;t>=0;t--)if(i[t].getThumbnailID()===e)return{section:P[n].section,thumbnail:i[t],parent:P[n].section.view}}}}function X(){let e,t=0;for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(e=0;e<P[n].markupSlides.length;e++)P[n].markupSlides[e]&&(t++,P[n].markupSlides[e].setThumbnailPrefix(t.toString()+"."));if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(e=0;e<i.length;e++)t++,i[e].setThumbnailPrefix(t.toString()+".")}}}function Z(e){V("onSlidePreselected",e)}function G(e){h.closeContextualSectionHeader();let t,n,i=e.isFromCheck?e.event.shiftKey:e.event.from[0].event.shiftKey,o=e.isFromCheck?!i:e.event.from[0].event.ctrlKey,a=e.id,l=0,s=null,r=0;for(t=0;t<P.length;t++)if(P[t].section){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++){if(P[t].markupSlides[n].getThumbnailID()===a){s=P[t].markupSlides[n];break}l++}if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=e.length-1;n>=0;n--){if(e[n].getThumbnailID()===a){s=e[n];break}l++}}if(s)break}if(I||!i&&!o)A=l,V("onSlideDisplayed",e);else{if(!s)return;if(i||(A=l),o)V("onSlideSelected",{id:a,checkFlag:e.isFromCheck?s.isChecked():!s.isChecked()});else if(i)if(-1===A)V("onSlideSelected",{id:a,checkFlag:e.isFromCheck?s.isChecked():!s.isChecked()}),A=l;else if(A===l)for(r=0,t=0;t<P.length;t++){if(P[t].section&&P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)V("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:r===l}),r++;if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=e.length-1;n>=0;n--)V("onSlideSelected",{id:e[n].getThumbnailID(),checkFlag:r===l}),r++}}else{let e=l>A?A:l,i=l>A?l:A;for(r=0,t=0;t<P.length;t++)if(P[t].section){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)r<e||r>i?V("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:!1}):r>=e&&r<=i&&V("onSlideSelected",{id:P[t].markupSlides[n].getThumbnailID(),checkFlag:!0}),r++;if(P[t].section.view&&P[t].section.view.getReplies()){let o=P[t].section.view.getReplies();for(n=o.length-1;n>=0;n--)r<e||r>i?V("onSlideSelected",{id:o[n].getThumbnailID(),checkFlag:!1}):r>=e&&r<=i&&V("onSlideSelected",{id:o[n].getThumbnailID(),checkFlag:!0}),r++}}}}}function K(e){V("onSlideNameChanged",e)}function Y(e){e.event?G({...e,isFromCheck:!0}):V("onSlideSelected",e)}function $(e){V("onSlideUpdateRequired",e)}function J(t,i,o){return new f({id:t.id,parentID:t.parentID,isReply:i,displayPrefix:!0,webMarkup:o,width:240,height:135,readOnly:I,displayTitleAndIcon:"boolean"==typeof _&&_,icon:t.icon,title:t.title?t.title:"",subtitle:t.parentSlideName?t.parentSlideName:"",allowCtxMenu:!I,isCheckable:!I&&(!0===o||void 0===o),informationIcon:t.dragContent?r.getWebappsAssetUrl("DMUBaseUI","icons/32/")+"I_DMU_ReviewHighlight.png":null,isDraggable:Boolean(t.dragContent),dragContent:t.dragContent,enableDrag:b,preview:t.img,userName:i?t.userName:null,userColor:i?t.userColor:null,userPic:i?t.userPic:null,defaultUserPic:i?t.defaultUserPic:null,creationDate:i?t.date:null,date:i&&t.date?e.String.parseRelativeTime(t.date.toString()):null,onEnterCB:Z,onLeaveCB:Z,clickCB:G,onTitleEditedCB:K,checkFlagChangedCB:Y,allowTitleEdition:t.titleEditionAllowed,onLabelContentClickCB:$,onCtxMenuCB:function(e){let t={id:e.id,openFromButton:e.openFromButton};t.shiftKeyPressed=e.event.shiftKey,t.ctrlKeyPressed=e.event.ctrlKey;let i=e.event,o=i.pageX?{x:i.pageX,y:i.pageY}:null;o||(o=i.screenX?{x:i.screenX,y:i.screenY}:null),!o&&i.type&&-1!==i.type.indexOf("touch")&&i.changedTouches&&i.changedTouches[0]&&((o=(i=i.changedTouches[0]).pageX?{x:i.pageX,y:i.pageY}:null)||(o=i.screenX?{x:i.screenX,y:i.screenY}:null)),o||(o={x:0,y:0}),t.position=new n.Vector2(o.x,o.y),setTimeout(function(){V("onSlideCtxMenuRequired",t)})},showReplyButton:F&&!I,onReplyCB:function(e){V("onSlideReplyCreated",e)}})}function Q(e){"Escape"!==e.key&&27!==e.keyCode||(x&&(x.setStyles({"padding-top":"","padding-bottom":""}),x=null),D=!0,te())}function ee(e){D=!1;let t=e.gesture.view[0];if(!(y=P.find(function(e){return e.section.view.getExpanderHeader()===t})))return;document.addEventListener("keydown",Q);let n=y.section.view.getContent(),i=n.getPosition(document.body);P.forEach(function(e){e.section.view.getExpandedFlag()&&(e.section.view.setExpandedFlag(!1),L.push(e.section.view))});let o=n.cloneNode(!0);n.setStyle("display","none");let a=e.from[0].getCurrentPosition(document.body);o.style.opacity=.8,o.style.left=i.x-a.x+"px",o.style.top=i.y-a.y+"px",o.style.position="absolute",O.appendChild(o),O.setStyle("transform",`translate(${a.x}px, ${a.y}px)`),document.body.appendChild(O)}function te(){if(E&&(d.removeEvent(E,"onPrimaryPointerMoveUnique",ne),d.removeEvent(E,"onPrimaryPointerUpUnique",te),E=null),y){for(document.removeEventListener("keydown",Q),document.body.contains(O)&&document.body.removeChild(O),O.setStyles({transform:""});O.children.length;)O.removeChild(O.firstElementChild);if(y.section.view.getContent().setStyle("display",""),y.section.view.getContent().remove(),x){if(y.section.view.getContent()!==x){let e=Array.prototype.indexOf.call(v.children,x);e>=0&&(v.insertBefore(y.section.view.getContent(),v.children[W?e:e+1]),P.sort(function(e,t){let n,i;return(n=Array.prototype.indexOf.call(v.children,e.section.view.getContent()))<(i=Array.prototype.indexOf.call(v.children,t.section.view.getContent()))?-1:n>i?1:0}),X(),V("onMarkupReordered",{orderedMarkupIDs:P.map(function(e){return e.section.id})}))}x.addClassName("noTransition"),x.setStyles({"padding-top":"","padding-bottom":""}),window.requestAnimationFrame(function(){x&&(x.removeClassName("noTransition"),x=null)})}else P.forEach(function(e,t){let n=e.section.view.getContent();v.contains(n)||(P[t-1]?v.insertBefore(n,P[t-1].section.view.getContent().nextSibling):v.insertBefore(n,v.children[0]))});y=null,window.requestAnimationFrame(()=>{L.forEach(function(e){e.setExpandedFlag(!0)}),L.length=0})}}function ne(e){if(D&&"begin"!==e.state)return;let t=e.from[0].event.composedPath();if("begin"===e.state)ee(e);else if(t&&t.includes(v)){if(!y)return;let t=e.from[0].getCurrentPosition(document.body);O.setStyle("transform",`translate(${t.x}px, ${t.y}px)`);let n=document.elementFromPoint(t.x,t.y),i=n&&n.hasClassName&&n.getParent?n.hasClassName("wux-controls-expander")?n:n.getParent(".wux-controls-abstract.wux-controls-expander-placeholder.wux-controls-expander.DMUMarkupExpander"):null;if(i){let e=O.firstElementChild.offsetHeight;i.getPosition(document.body,{y:"center"}).y>=t.y?x===i&&W||(x&&x.setStyles({"padding-top":"","padding-bottom":""}),(x=i).setStyles({"padding-top":e+"px"}),W=!0):(x!==i||W)&&(x&&x.setStyles({"padding-top":"","padding-bottom":""}),(x=i).setStyles({"padding-bottom":e+"px"}),W=!1)}else x&&(x.setStyles({"padding-top":"","padding-bottom":""}),x=null)}"end"===e.state&&te()}function ie(e){E=e.gesture.view[0],ee(e),d.addEvent(E,"onPrimaryPointerMoveUnique",ne),d.addEvent(E,"onPrimaryPointerUpUnique",te)}function oe(e,t){for(let n=0;n<P.length;n++)P[n].section.view&&P[n].section.view.setActiveMarkup(e===P[n].section.view?t:!t)}this.buildPanel=function(t){M.cleanPanel(),o||(o=e.createElement("div",{id:"DMUSlidePanelThumbMainDiv"})),o.setStyles({height:"100%"});let n=e.createElement("div",{class:"DMUSlidePanelSectionMainDiv"}).inject(o);n.setStyles({height:"100%"}),t.noSlideLabel&&(g=t.noSlideLabel),t.createSlideLabel&&(m=t.createSlideLabel),h=new c({draggable:!0,onDragStart:function(){return y||""},sectionLabel:t.panelTitle?t.panelTitle:u.dmuPanelTitle,cmdList:t.contextualCmdList,quickAccessBtnList:t.quickAccessBtnList,doubleClickCB:function(){V("onTopBarDoubleClick")}}),n.appendChild(h.getContent());return v=e.createElement("div",{class:"DMUSlidePanelThumbMainContainer"}),(l=(new a).inject(n)).getInnerElement().setContent(v),l.getContent().setStyle("height","calc(100% - 40px)"),window&&window.__karma__||(S=setInterval(function(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)P[t].markupSlides[e]&&P[t].markupSlides[e].updateCreationDates();if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=n.length-1;e>=0;e--)n[e].updateCreationDates()}}},6e4)),o},this.cleanPanel=function(){if(o){for(let e=0;e<P.length;e++)P[e].section?P[e].section.view.clear():P[e].clear();for(U.length=0,S&&clearInterval(S),S=null;o.firstChild;)o.removeChild(o.firstChild);P.splice(0,P.length),h&&h.clear(),p&&p.clear(),l&&l.destroy(),h=p=l=P=o=null}},this.setNoSlideLabel=function(e){g=e;for(let e=0;e<P.length;e++)P[e].section&&P[e].section.view.refreshNoSlideDiv()},this.setCreateSlideLabel=function(e){m=e;for(let e=0;e<P.length;e++)P[e].section&&P[e].section.view.refreshNoSlideDiv()},this.setDragContent=function(e){y=e},this.setSlideDragContent=function(e){let t=!1;if(P.length)for(let n=0;n<P.length;n++){let i=P[n].markupSlides;if(i&&i.length){for(let n=0;n<i.length;n++)if(e.parentSlideId){let o=i[n].getReplies();if(o){for(let n=0;n<o.length;n++)if(e.id===o[n].getID()){o[n].setSlideViewTransferDragContent(e.data),o[n].setIsDraggable(!0),t=!0;break}if(t)break}}else if(e.id===i[n].getID()){i[n].setSlideViewTransferDragContent(e.data),i[n].setIsDraggable(!0),t=!0;break}if(t)break}}},this.enableDragContent=function(e){if(b!==e&&(b=e,P.length))for(let t=0;t<P.length;t++){P[t].section.view.enableDefaultReorder(!e);let n=P[t].markupSlides;if(n)for(let t=0;t<n.length;t++){n[t].enableDragContent(e);let i=n[t].getReplies();if(i)for(let t=0;t<i.length;t++)i[t].enableDragContent(e)}}},this.getColumnMinimumWidth=function(){return P&&P.length&&"default"!==P[0].section.id?273:267},this.getColumnWidthStep=function(){return 240},this.resizePanel=function(e){w="single";let t,n=M.getColumnMinimumWidth()-M.getColumnWidthStep();w=e.width-n>=2*M.getColumnWidthStep()?"multi":"single";for(let e=0;e<P.length;e++){if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++)P[e].markupSlides[t]&&P[e].markupSlides[t].setReplyRepresentation(w);if(P[e].section.view&&P[e].section.view.getReplies()){let n=P[e].section.view.getReplies();for(t=n.length-1;t>=0;t--)n[t].setReplyRepresentation(w)}}},this.setPanelTitle=function(e){h&&h.setHeaderLabel(e)},this.switchFilterActivation=function(){j=!j,z()},this.getFilterActivationFlag=function(){return j},this.setListOfVisibleSlides=function(e){U=e&&e.length?e.slice():[],z()},this.allowReplies=function(e){let t;F=e;for(let e=0;e<P.length;e++)if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++){if(P[e].markupSlides[t]){P[e].markupSlides[t].allowReply(F);let n=P[e].markupSlides[t].getReplies();if(n&&n.length)for(let e=0;e<n.length;e++)n[e].allowReply(F)}if(P[e].section.view&&P[e].section.view.getReplies()){let t=P[e].section.view.getReplies();for(let e=t.length-1;e>=0;e--)t[e].allowReply(F)}}},this.setAllowMarkupReorderFlag=function(e){if(T!==e){T=e;for(let e=0;e<P.length;e++)T&&!I?s.getTouchMode()?d.addEvent(P[e].section.view.getExpanderHeader(),"onMediumHold",ie):d.addEvent(P[e].section.view.getExpanderHeader(),"onDrag",ne):s.getTouchMode()?d.removeEvent(P[e].section.view.getExpanderHeader(),"onMediumHold",ie):d.removeEvent(P[e].section.view.getExpanderHeader(),"onDrag",ne)}},this.setAllowSlideReorderFlag=function(e){if(R!==e){R=e;for(let e=0;e<P.length;e++)P[e].section.view.setAllowSlideReorderFlag(R&&!I)}},this.resetSlideDisplayHistory=function(){let e,t;for(let n=0;n<P.length;n++)if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++){if(P[n].markupSlides[t]){P[n].markupSlides[t].getDisplayFlag()&&(P[n].markupSlides[t].setDisplayFlag(!1),P[n].section.view&&P[n].section.view.updateShadingColor()),e=P[n].markupSlides[t].getReplies();for(let t=0;t<e.length;t++)e[t].getDisplayFlag()&&e[t].setDisplayFlag(!1)}if(P[n].section.view&&P[n].section.view.getReplies())for(let t=(e=P[n].section.view.getReplies()).length-1;t>=0;t--)e[t].getDisplayFlag()&&e[t].setDisplayFlag(!1)}},this.setReadOnlyFlag=function(e){A=-1,I=e,M.enableDragContent(e||b),h.closeContextualSectionHeader(),h.setQuickAccessCommandsVisibility(!I),M.setAllowMarkupReorderFlag(k.allowMarkupReorder&&!I),M.setAllowSlideReorderFlag(k.allowSlideReorder&&!I);for(let e=0;e<P.length;e++)if(P[e].section&&P[e].section.view&&P[e].section.view.setReadOnlyFlag(I),P[e].markupSlides)for(let t=0;t<P[e].markupSlides.length;t++){if(P[e].markupSlides[t]){P[e].markupSlides[t].setReadOnlyFlag(I);let n=P[e].markupSlides[t].getReplies();for(let e=0;e<n.length;e++)n[e].setReadOnlyFlag(I)}if(P[e].section.view&&P[e].section.view.getReplies()){let t=P[e].section.view.getReplies();for(let e=t.length-1;e>=0;e--)t[e].setReadOnlyFlag(I)}}},this.setPanelSubMenuCommands=function(e){h.closeContextualSectionHeader(),h.setSubMenuCommands(e)},this.setPanelQuickAccessCommands=function(e){h.closeContextualSectionHeader(),h.setQuickAccessCommands(e)};let ae=!0;function le(e){for(let t=P.length-1;t>=0;t--)if(P[t].section&&P[t].section.id===e)return e;for(let t=0;t<B.length;t++)if(B[t].id===e)return le(B[t].parentID)}this.getPanelActiveFlag=function(){return ae},this.setPanelActiveFlag=function(e){let t;e||M.removeSlideUpdateRequiredFlags(),ae=e,h.closeContextualSectionHeader(),h.setAdditionalCheckBoxActiveFlag(0,ae);for(let n=0;n<P.length;n++){if(P[n].markupSlides)for(t=0;t<P[n].markupSlides.length;t++)P[n].markupSlides[t]&&P[n].markupSlides[t].setThumbnailActiveFlag(e);if(P[n].section.view&&P[n].section.view.getReplies()){let i=P[n].section.view.getReplies();for(t=i.length-1;t>=0;t--)i[t].setThumbnailActiveFlag(e)}}},this.addMarkup=function(e){if(A=-1,h.closeContextualSectionHeader(),!e.id)return;let t=P.length,i=0;for(i=0;i<t;i++)if(P[i].section.id===e.id)return;let o={section:{name:e.title,id:e.id,webMarkup:e.webMarkup,view:new C({name:e.title,id:e.id,webMarkup:e.webMarkup,allowSlideReorder:R,displayInExpanders:"default"!==e.id,onNewSlideCreated:function(){V("onNewSlideCreated",e)},onSlidesDragStart:function(e){if(e)return V("onSlideDragStart",e);P.forEach(function(e){e!==o?e.section.view.getExpandedFlag()&&(e.section.view.setExpandedFlag(!1),L.push(e.section.view)):e.markupSlides.forEach(function(e){e.getReplySectionExpandedFlag()&&(e.setReplySectionExpandedFlag(!1),H.push(e))})})},onSlidesDragEnd:function(t){L.forEach(function(e){e.setExpandedFlag(!0)}),L.length=0,H.forEach(function(e){e.setReplySectionExpandedFlag(!0)}),H.length=0;let n=P.indexOf(o);n>=0&&(t&&t.orderedSlideIDs&&t.orderedSlideIDs.length?(t.orderedSlideIDs.forEach(function(e){let t=P[n].markupSlides.findIndex(t=>t.getID()===e),i=P[n].markupSlides.splice(t,1)[0];P[n].markupSlides.push(i)}),X(),P[n].markupSlides.forEach(function(e){e.updateRepliesPosition()}),V("onSlideReordered",Object.assign(t,{markupID:e.id}))):P[n].markupSlides.forEach(function(e){e.updateRepliesPosition()}))},onMarkupRenamed:function(t){V("onMarkupRenamed",{id:e.id,title:t})},onMarkupCtxMenuCB:function(e){let t=e.event,i=t.pageX?{x:t.pageX,y:t.pageY}:null;i||(i=t.screenX?{x:t.screenX,y:t.screenY}:null),!i&&t.type&&-1!==t.type.indexOf("touch")&&t.changedTouches&&t.changedTouches[0]&&((i=(t=t.changedTouches[0]).pageX?{x:t.pageX,y:t.pageY}:null)||(i=t.screenX?{x:t.screenX,y:t.screenY}:null)),i||(i={x:0,y:0}),V("onMarkupCtxMenuRequired",{id:e.id,position:new n.Vector2(i.x,i.y)})},readOnly:I})}};"default"!==e.id&&!I&&T&&(s.getTouchMode()?d.addEvent(o.section.view.getExpanderHeader(),"onMediumHold",ie):d.addEvent(o.section.view.getExpanderHeader(),"onDrag",ne)),P.push(o),P[0].section.view.title=e.title,P[0].section.view.id=e.id,o.section.view.enableDefaultReorder(!b),v.appendChild(P[t].section.view.getContent())},this.removeMarkup=function(e){let t;for(let n=P.length-1;n>=0;n--)if(P[n].section&&(P[n].section.id===e||P[n].section.parentID===e)){if(P[n].markupSlides)for(t=P[n].markupSlides.length-1;t>=0;t--)P[n].section.view.removeChild(P[n].markupSlides[t]);P[n].section.view.clear(),v.removeChild(P[n].section.view.getContent()),P.splice(n,1)}X()},this.updateMarkup=function(e,t){for(let n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===e)return void(t.name&&P[n].section.view.setTitle(t.name))},this.editMarkupName=function(e){let t;for(let n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===e){t=P[n].section.view;break}t&&t.startTitleEdition()},this.addReply=function(e){if(A=-1,h.closeContextualSectionHeader(),!e.id||!e.parentID)return;let t;for(t=0;t<B.length;t++)if(B[t].id===e.id)return;B.push(e)},this.removeReply=function(e){let t,n;for(n=B.length-1;n>=0;n--)if(B[n].id===e){t=B[n].parentID;break}if(t)for(n=P.length-1;n>=0;n--)if(P[n].section&&P[n].section.id===t){if(P[n].markupSlides)for(let t=P[n].markupSlides.length-1;t>=0;t--)P[n].markupSlides[t].removeReplies({replyID:e});P[n].section.view&&P[n].section.view.getReplies()&&P[n].section.view.removeReplies({replyID:e})}},this.addSlide=function(e){let t,n,i;if(A=-1,h.closeContextualSectionHeader(),P.length||M.addMarkup({id:"default"}),!e.parentID)for(t=0;t<P.length;t++){if(P[t].section.view&&P[t].section.view.isActiveMarkup()){e.parentID=P[t].section.id;break}t===P.length-1&&P[0].section.view&&(oe(P[0].section.view,!0),e.parentID=P[0].section.id)}for(t=0;t<P.length;t++)if(e.parentID===P[t].section.id){for(i=J(e,null,P[t].section.webMarkup),P[t].markupSlides?null!==e.index&&void 0!==e.index?P[t].markupSlides.splice(e.index,0,i):P[t].markupSlides.push(i):(P[t].section.view.removeChildren(),P[t].markupSlides=[i]),P[t].section.view.addChild(i,e.index),n=0;n<B.length;n++){if(le(B[n].parentID)===P[t].section.id&&B[n].pendingReplies&&B[n].pendingReplies.length)for(let e=B[n].pendingReplies.length-1;e>=0;e--){let o=!1,a=B[n].pendingReplies[e];a.parentSlideID?i.getID()===a.parentSlideID&&(i.addReply(a.thumbnail),o=!0):(P[t].section.view.addReply(a.thumbnail),o=!0),o&&B[n].pendingReplies.splice(e,1)}}break}if(!i){let o=le(e.parentID);for(t=0;t<B.length;t++)if(B[t].id===e.parentID){let a=!1;for(n=0;n<P.length;n++)if(o===P[n].section.id)if(e.parentSlideID){if(P[n].markupSlides)for(let o=0;o<P[n].markupSlides.length;o++)P[n].markupSlides[o].getID()===e.parentSlideID&&(i=J(e,!0,B[t].webMarkup),P[n].markupSlides[o].addReply(i),a=!0)}else e.parentSlideName=B[t].title,i=J(e,!0,B[t].webMarkup),P[n].section.view.addReply(i),a=!0;a||(B[t].pendingReplies||(B[t].pendingReplies=[]),e.parentSlideName=e.parentSlideID?"":B[t].title,i=J(e,!0,B[t].webMarkup),B[t].pendingReplies.push({thumbnail:i,parentSlideID:e.parentSlideID}));break}}for(X(),i&&i.setReplyRepresentation(w),t=0;t<P.length;t++)P[t].section.view.getContent().setStyles({"grid-template-columns":"repeat(auto-fit, "+M.getColumnWidthStep()+"px)"})},this.removeSlide=function(e){let t,n;for(A=-1,t=0;t<P.length;t++)if(P[t].section&&P[t].markupSlides&&P[t].markupSlides.length){for(n=0;n<P[t].markupSlides.length;n++){if(P[t].markupSlides[n].getThumbnailID()===e)return P[t].section.view.removeChild(P[t].markupSlides[n]),P[t].markupSlides[n].clear(),P[t].markupSlides.splice(n,1),void X();if(P[t].markupSlides[n].removeReply({id:e}))return}if(P[t].section.view.removeReply({id:e}))return}},this.updateSlide=function(e,t){let n=function(e){t.id&&e.setThumbnailID(t.id),t.name&&e.setThumbnailTexts({title:t.name}),t.img&&e.setPreview(t.img),void 0!==t.titleEditionAllowed&&e.allowTitleEdition(t.titleEditionAllowed),void 0!==t.checkFlag&&e.setCheckFlag(t.checkFlag,null,!0),Object.prototype.hasOwnProperty.call(t,"highlight")&&(e.setInformationIcon(t.highlight?r.getWebappsAssetUrl("DMUBaseUI","icons/32/")+"I_DMU_ReviewHighlight.png":""),t.highlight&&(e.setIsDraggable(!0),e.setFavoriteDivDragContent(t.highlight)))};for(let i=0;i<P.length;i++)if(P[i].section){if(P[i].markupSlides)for(let o=0;o<P[i].markupSlides.length;o++){if(P[i].markupSlides[o].getThumbnailID()===e)return void n(P[i].markupSlides[o]);if(P[i].markupSlides[o].getReply({id:e}))return void P[i].markupSlides[o].updateReply({id:e,info:t})}if(P[i].section.view&&P[i].section.view.getReplies()){let t=P[i].section.view.getReplies();for(let i=0;i<t.length;i++)if(t[i].getThumbnailID()===e)return void n(t[i])}}},this.setActiveSlide=function(e){h.closeContextualSectionHeader();let t=0,n=0,i=q(e);if(i){if(I)for(i.thumbnail.getDisplayFlag()||(i.thumbnail.setDisplayFlag(!0),i.parent?i.parent.updateRepliesShadingColor():i.section.view&&i.section.view.updateShadingColor()),t=0;t<P.length;t++){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)P[t].markupSlides[n].highlightThumbnail(P[t].markupSlides[n]===i.thumbnail);if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=0;n<e.length;n++)e[n].highlightThumbnail(e[n]===i.thumbnail)}}else for(t=0;t<P.length;t++){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++){P[t].markupSlides[n].setDisplayFlag(P[t].markupSlides[n]===i.thumbnail),P[t].markupSlides[n].highlightThumbnail(P[t].markupSlides[n]===i.thumbnail);let e=P[t].markupSlides[n].getReplies();for(let t=0;t<e.length;t++)e[t].setDisplayFlag(e[t]===i.thumbnail),e[t].highlightThumbnail(e[t]===i.thumbnail)}if(P[t].section.view&&P[t].section.view.getReplies()){let e=P[t].section.view.getReplies();for(n=0;n<e.length;n++)e[n].setDisplayFlag(e[n]===i.thumbnail),e[n].highlightThumbnail(e[n]===i.thumbnail)}}oe(i.section.view,!0),i.parent&&i.parent.setReplySectionExpandedFlag(!0)}else for(t=0;t<P.length;t++){if(P[t].markupSlides)for(n=0;n<P[t].markupSlides.length;n++)P[t].markupSlides[n].setDisplayFlag(P[t].markupSlides[n].getThumbnailID()===e),P[t].markupSlides[n].highlightThumbnail(P[t].markupSlides[n].getThumbnailID()===e);if(P[t].section.view&&P[t].section.view.getReplies()){let i=P[t].section.view.getReplies();for(n=0;n<i.length;n++)i[n].setDisplayFlag(i[n].getThumbnailID()===e),i[n].highlightThumbnail(i[n].getThumbnailID()===e)}}},this.setSlideTitleVisibleFlag=function(e){if(("boolean"==typeof e&&e)!==_){let t;_=e;for(let e=0;e<P.length;e++){if(P[e].markupSlides)for(t=0;t<P[e].markupSlides.length;t++)P[e].markupSlides[t]&&P[e].markupSlides[t].setTitleAndIconSectionVisibleFlag(_);if(P[e].section.view&&P[e].section.view.getReplies()){let n=P[e].section.view.getReplies();for(t=0;t<n.length;t++)n[t].setTitleAndIconSectionVisibleFlag(_)}}}},this.setSlideUpdateRequiredFlag=function(e,t){let n=q(e);n&&n.thumbnail&&n.thumbnail&&n.thumbnail.setThumbnailLabelClickableFlag(t,{title:u.updateSlideViewpoint,fontIcon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-refresh"})},this.removeSlideUpdateRequiredFlags=function(){let e;for(let t=0;t<P.length;t++){if(P[t].markupSlides)for(e=0;e<P[t].markupSlides.length;e++)if(P[t].markupSlides[e]){P[t].markupSlides[e].setThumbnailLabelClickableFlag(!1);let n=P[t].markupSlides[e].getReplies();for(let e=0;e<n.length;e++)n[e].setThumbnailLabelClickableFlag(!1)}if(P[t].section.view&&P[t].section.view.getReplies()){let n=P[t].section.view.getReplies();for(e=0;e<n.length;e++)n[e].setThumbnailLabelClickableFlag(!1)}}},this.setInProgress=((e,t)=>{let n=q(e);n&&n.thumbnail&&n.thumbnail&&(t?n.thumbnail.displayProgress():n.thumbnail.hideProgress())}),this.subscribe=function(e,t){if(e&&t)return N.subscribe({event:e},t)},this.unsubscribe=function(e){null!=e&&N.unsubscribe(e)}}})}),define("DS/DMUControls/EXPWindowWithBar",["DS/DMUControls/EXPWindow","WebappsUtils/WebappsUtils"],function(e,t){"use strict";return e.extend({defaultOptions:{fLeftPanelSize:40},init:function(e){var t=UWA.extend(this.defaultOptions,e);this._parent(t),this._createBar()},addButton:function(e){var t=this,n=UWA.createElement("div",{class:e.className,title:e.nls,styles:{position:"relative",background:"rgba(255,255,255,0.5)",opacity:"1",borderRadius:"50%",left:this.options.fMarginAroundViewer,height:"30px",width:"30px",marginTop:"7px",marginBottom:"7px",cursor:"pointer",lineHeight:"25px",textAlign:"center",border:"1px solid #727476"},events:{click:function(){e.callback(t)}}}).inject(this._domElements._actionButtonContainer);this._buildButtonIcon(e.url).inject(n)},setFullScreen:function(e,t){this._parent(e,t),e?(this._domElements._leftPanelMainContainer.setStyle("left",0),this._domElements._actionButtonContainer.setStyles({width:"130%",borderBottomRightRadius:"2pc",borderTopRightRadius:"2pc"})):(this._domElements._leftPanelMainContainer.setStyle("left",-this.options.fLeftPanelSize+"px"),this._domElements._actionButtonContainer.setStyles({width:"100%",borderBottomRightRadius:"0",borderTopRightRadius:"0"}))},_createBar:function(){this._createLeftButtonArrowOpenPanel(),this._createLeftButtonsCommandPanel(),this._createLeftPanelContainer(),this._createLeftButtonArrowClosePanel(),this._createLeftActionButtonContainer()},_createLeftButtonArrowOpenPanel:function(){var e=this,n=t.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigLeftArrow.png";this._domElements._leftPanelArrow=this._createUWADiv({position:"absolute",left:0,top:"50%",height:"20px",width:"20px",overflow:"hidden",backgroundImage:"url("+n+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",cursor:"pointer"}),this._domElements._leftPanelArrow.addEvent("click",function(t){e._domElements._leftPanelArrow.setStyle("display","none"),e._domElements._leftPanelMainContainer.setStyle("display","block"),UWA.Event.stop(t)}),this._domElements._leftPanelArrow.inject(this._domElements._mainContainer)},_createLeftButtonsCommandPanel:function(){this._domElements._leftPanelMainContainer=this._createUWADiv({position:"absolute",left:-this.options.fLeftPanelSize+"px",top:0,height:"100%",width:this.options.fLeftPanelSize+"px",overflow:"visible",paddingTop:this.options.fTopbarHeight+"px",lineHeight:this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px",textAlign:"center",display:"none"}),this._domElements._leftPanelMainContainer.inject(this._domElements._mainContainer)},_createLeftPanelContainer:function(){this._domElements._leftPanelContainer=this._createUWADiv({height:"auto",width:"100%",overflow:"visible",display:"inline-block",verticalAlign:"middle",lineHeight:"normal"}),this._domElements._leftPanelContainer.inject(this._domElements._leftPanelMainContainer)},_createLeftButtonArrowClosePanel:function(){var e=this,n=t.getWebappsBaseUrl()+"DMUControls/assets/icons/expanderBigRightArrow.png";this._domElements._leftPanelCloseArrow=this._createUWADiv({height:"20px",width:"100%",overflow:"hidden",backgroundImage:"url("+n+")",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center center",cursor:"pointer",position:"relative",right:-this.options.fMarginAroundViewer/2}),this._domElements._leftPanelCloseArrow.addEvent("click",function(t){e._domElements._leftPanelArrow.setStyle("display","block"),e._domElements._leftPanelMainContainer.setStyle("display","none"),UWA.Event.stop(t)}),this._domElements._leftPanelCloseArrow.inject(this._domElements._leftPanelContainer)},_createLeftActionButtonContainer:function(){this._domElements._actionButtonContainer=this._createUWADiv({height:"auto",width:"100%",backgroundColor:"#F0F0F0",overflow:"visible",borderTop:"1px solid #D1D1D1",borderBottom:"1px solid #D1D1D1",borderLeft:"1px solid #D1D1D1",borderTopLeftRadius:this.options.fCornerRoundRadius+"px",borderBottomLeftRadius:this.options.fCornerRoundRadius+"px",paddingTop:"10px",paddingBottom:"10px"}),this._domElements._actionButtonContainer.inject(this._domElements._leftPanelContainer)},_buildButtonIcon:function(e){var t=new UWA.Controls.Img({url:e});return t.elements.container.setStyles({height:"75%",width:"75%",display:"inline-block",verticalAlign:"middle",lineHeight:"normal"}),t},_updateSize:function(){this._domElements._leftPanelMainContainer.setStyle("lineHeight",this._domElements._mainContainer.getSize().height-this.options.fTopbarHeight+"px"),this._parent()}})}),define("DS/DMUControls/EXPSecondaryViewer",["DS/DMUControls/EXPWindowWithBar","DS/WebappsUtils/WebappsUtils","DS/Visualization/WebGLV6Viewer","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i){"use strict";return e.extend({init:function(e){this.options=e,this._addViewer(),this._parent(e),this._addDefaultButtons()},_addDefaultButtons:function(){for(var e=t.getWebappsAssetUrl("DMUControls","icons/32/"),n=[{className:"secondaryViewerPrintCmd",nls:i.print,url:e+"I_3DSHAREPROPrint.png",callback:function(e){e._printScreenshot(!0)}},{className:"secondaryViewerReframeCmd",nls:i.reframe,url:e+"I_3DSHAREPROReframe.png",callback:function(e){e.options.viewer.currentViewpoint.reframe()}}],o=0;o<n.length;o++)this.addButton(n[o])},_addViewer:function(){var e=new UWA.Element("div").inject(this.options.body,"top");e.setStyle("visibility","visible");var t={div:e,antiAliasing:!0,useShadowMap:!1,infinitePlane:!1,displayGrid:!1,ssao:!1,debugShadowLight:!1,debugBSphere:!1,debugBBox:!1,multiViewer:!0};this._viewerSecondary=new n(t),this._viewerSecondary.setPrePicking({activated:!0,displayHL:!0,gpu:!0,computeNormalDepth:!1,primitive:!1}),this.options.viewer=this._viewerSecondary,this.options.HTMLContent=e},_printScreenshot:function(){var e=this,t=this.options.viewer;if(t.print)t.print();else{this._iframe=new UWA.Element("iframe",{styles:{position:"fixed",top:"0",left:"-150%",width:"100%",height:"100%"}}).inject(document.body);var n,i=new UWA.Element("img",{src:this._getScreenShot(),styles:{"max-width":"100%","max-height":"100%"}}).inject(this._iframe.contentWindow.document.body);if(window.navigator.userAgent.indexOf("Firefox")>-1)this._doPrint();else e=this,n=setInterval(function(){if(i.offsetHeight){clearInterval(n);try{!1===e._iframe.contentWindow.document.execCommand("print",!1,null)&&e._iframe.contentWindow.print()}catch(t){e._iframe.contentWindow.print()}setTimeout(function(){document.body.removeChild(e._iframe)},6e4)}},100)}},_doPrint:function(){var e=this._iframe.contentWindow.document.body.innerHTML,t=window.open("","popup","width=750,height=800,toolbar = no, status = no,resizable =no,location=no");t.document.write(e),t.document.close(),t.focus(),t.print(),t.close(),document.body.removeChild(this._iframe),this._iframe=null},_getScreenShot:function(e,t){var n=this.options.viewer;n.save&&n.save();var i=n.currentViewpoint,o={data:null,width:n.SCREEN_WIDTH,height:n.SCREEN_HEIGHT},a=document.createElement("canvas");a.width=e||o.width,a.height=t||o.height,i.getControl().update(),n.renderToTarget(o,i);var l=a.getContext("2d"),s=l.getImageData(0,0,a.width,a.height);if(s.width===a.width){if(s.height===a.height){var r=(o.width-1)/(s.width-1),d=(o.height-1)/(s.height-1),c=o.data,h=s.data,u=function(e,t,n,i,o){return o?(t=i-t,n*Math.floor(t-1)+Math.floor(e)):n*Math.floor(t)+Math.floor(e)};if(1===r&&1===d){var m=s.height,g=s.width,p=4*g;for(let e=0;e<m;e++){let t=e*g*4,n=(m-e)*g*4;for(let e=p;e>0;e--)h[t+e]=c[n+e]}}else{var C=s.height,f=s.width;for(let e=0;e<C;e++)for(let t=0;t<f;t++){let n=4*u(t,e,s.width,s.height,!1),i=4*u(t,e,o.width,o.height,!0);h[n]=c[i],h[n+1]=c[i+1],h[n+2]=c[i+2],h[n+3]=c[i+3]}}return l.putImageData(s,0,0,0,0,a.width,a.height),a.toDataURL("image/png")}window.console.error("error")}else window.console.error("error")},getViewer:function(){return this._viewerSecondary}})}),define("DS/DMUControls/DMUReviewExpander",["UWA/Core","UWA/Class","DS/DMUControls/DMUEditableExpander","DS/Controls/Button","DS/Controls/LineEditor","DS/Controls/Editor","DS/Controls/ComboBox","DS/DMUControls/DMUCustomExpander","DS/Utilities/TouchUtils","i18n!DS/DMUControls/assets/nls/DMUControls"],function(e,t,n,i,o,a,l,s,r,d){"use strict";var c=0;return t.extend({init:function(t){var n=t||{};this._parent(n),c++;var o,h,u,m=this,g=!1,p=!1,C=n.objectData,f=n.icons,v=0,y=0,b=0,w=0;this.getContent=function(){return R.getContent()},this.getMainDiv=function(){return R},this.inject=function(e){return R.getContent().inject(e),m};var x=e.createElement("div",{id:"expanderView_"+c+"_"+C.id,class:"DMUReviewExpanderContainer"});this.destroy=function(){R.getContent().destroy()},this.expand=function(){R.expand()},this.collapse=function(){R.collapse()},this.setCheckComboValue=function(e){g=e},this.setHighlightComboValue=function(e){p=e},this.unselect=function(){R.setSelectedFlag(!1)},this.deactivatePlusButtons=function(){var e=R.getContent().getElementsByClassName("impCheckPlusButton");e.length&&(e[0].dsModel.checkFlag=!1);var t=R.getContent().getElementsByClassName("issuePlusButton");t.length&&(t[0].dsModel.checkFlag=!1);var n=R.getContent().getElementsByClassName("caPlusButton");n.length&&(n[0].dsModel.checkFlag=!1)},this.updateImpactedCheck=function(t){if("Highlight"===n.type){var i=n.checkIcons[t.checkInfos.status-1],o=t.checkInfos.name,a=t.checkInfos.id,l=_.getElementsByClassName("impCheckDiv")[0];l.show();var s=new e.Element("span",{class:i.fonticonClass}).inject(l);s.addClassName("objectIcon"),s.id=C.id+"_"+a,s.setStyles({color:i.fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:o,class:"check",id:C.id+"_"+a}).inject(l).title=o;var r=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(l);l.show(),r.addClassName("impCheckRemoveButton"),r.id=a,r.hide(),r.onclick=function(){n.onImpactedCheckRemoved(C.id,this.id)}}else{y+=1;var d=n.highlightIcons[t.highlightInfos.rating-1],c=t.highlightInfos.name,h=t.highlightInfos.id,u=_.getElementsByClassName("editableImpHighlightDiv")[0];u.show();var m=new e.Element("span",{class:d.fonticonClass,id:C.id+"_"+h}).inject(u);m.addClassName("impHighlightIcon"),m.setStyles({color:d.fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:c,class:"impHighlight",id:C.id+"_"+h}).inject(u).title=c}},this.removeImpactedCheck=function(e,t){if("Highlight"===n.type){var i=R.getContent().getElementsByClassName("impCheckDiv")[0],o=i.getElementsByClassName("check"),a=i.getElementsByClassName("objectIcon"),l=i.getElementsByClassName("impCheckRemoveButton");for(let t=0;t<o.length;t++)o[t].id.split("_")[0]===e&&o[t].destroy();for(let t=0;t<a.length;t++)a[t].id.split("_")[0]===e&&a[t].destroy();for(let e=0;e<l.length;e++)l[e].id===t&&l[e].destroy()}else{var s=R.getContent().getElementsByClassName("editableImpHighlightDiv"),r=s[0].getElementsByClassName("impHighlightIcon"),d=s[0].getElementsByClassName("impHighlight");for(let e=0;e<r.length;e++)r[e].id.split("_")[0]===t&&r[e].destroy();for(let e=0;e<d.length;e++)d[e].id.split("_")[0]===t&&d[e].destroy()}},this.updateImpactedCheckDisplay=function(e){var t;let i=R.getContent().getElementsByClassName("check"),o=R.getContent().getElementsByClassName("objectIcon");if(e.name)for(let n=0;n<i.length;n++)t=i[n].id.split("_")[1],e.id===t&&i[n].setText(e.name);if(e.status)for(let i=0;i<o.length;i++)if(t=o[i].id.split("_")[1],e.id===t){var a=o[i];a.removeClassName(o[i].className),a.addClassName("objectIcon "+n.checkIcons[e.status-1].fonticonClass),a.setStyles({color:n.checkIcons[e.status-1].fonticonColor})}},this.updateAssociatedHighlightsDisplay=function(e){var t;let i=R.getContent().getElementsByClassName("impHighlight"),o=R.getContent().getElementsByClassName("impHighlightIcon");if(e.name)for(let n=0;n<i.length;n++)t=i[n].id.split("_")[1],e.id===t&&i[n].setText(e.name);if(e.rating)for(let i=0;i<o.length;i++)if(t=o[i].id.split("_")[1],e.id===t){var a=o[i];a.removeClassName(o[i].className),a.addClassName("impHighlightIcon "+n.highlightIcons[e.rating-1].fonticonClass),a.setStyles({color:n.highlightIcons[e.rating-1].fonticonColor})}},this.addIssue=function(t,i){b+=1,C.issues.push(t);var o=R.getContent().getElementsByClassName("issueDiv")[0];o.show();var a=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue"}).inject(o);a.setStyles({color:"#77797C"}),a.addClassName("issueIcon"),new e.Element("div",{text:i,class:"issue"}).inject(o).onclick=function(){n.onAttachedObjClicked(t)},R.updateIssueHeaderIcon({type:"Highlight",issueLength:b})},this.addCA=function(t,i){w+=1,C.changeAction.push(t);var o=R.getContent().getElementsByClassName("changeActionDiv")[0];o.show(),new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(o).addClassName("caIcon"),new e.Element("div",{text:i,class:"ca"}).inject(o).onclick=function(){n.onAttachedObjClicked(t)},R.updateCAHeaderIcon({type:"Highlight",caLength:w})},this.addRequirement=function(t,i,o){v+=1,R.getContent().getElementsByClassName("requirementDropZone")[0].hide();var a=R.getContent().getElementsByClassName("checkExpanderBody")[0],l=new e.Element("div",{class:"requirementDiv"}).inject(a),s=new e.Element("span",{class:f[3].fonticonClass}).inject(l);s.addClassName("requirementIcon"),s.setStyles({color:f[3].fonticonColor});var r=new e.Element("div",{text:o,class:"requirement"});r.inject(l),r.onclick=function(){n.onAttachedObjClicked(i)};var d=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(l);d.addClassName("requirementRemoveButton"),d.id=t,d.hide(),d.onclick=function(){n.onRequirementRemove(this.id,i)}},this.removeRequirement=function(){v-=1;var e=R.getContent().getElementsByClassName("requirementDropZone")[0];e.show(),e.removeClassName("reqDropZoneDrag"),R.getContent().getElementsByClassName("requirementPlusIcon")[0].hide(),R.getContent().getElementsByClassName("infoReq")[0].show(),R.getContent().getElementsByClassName("requirementDiv")[0].destroy()},this.updatePreview=function(){var e=R.getContent(),t=e.getElementsByClassName("thumbnailDiv").length?e.getElementsByClassName("thumbnailDiv"):e.getElementsByClassName("editableHighlightThumbDiv");if(t[0].getElementsByClassName("DMUCommentMainDiv ").length)t[0].getElementsByClassName("lightCommentRepresentation")[0].isHidden()?(t[0].getElementsByClassName("lightCommentRepresentation")[0].show(),t[0].getElementsByClassName("normalCommentRepresentation")[0].hide()):(t[0].getElementsByClassName("lightCommentRepresentation")[0].hide(),t[0].getElementsByClassName("normalCommentRepresentation")[0].show());else{var n=e.getElementsByClassName("slideBlock").length?e.getElementsByClassName("slideBlock"):e.getElementsByClassName("editableHighlightSlideBlock");t[0].isHidden()&&"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?(t[0].show(),n[0].hide()):(t[0].hide(),n[0].show())}};var D=function(){if(C.description){var t=new e.Element("div",{text:C.description,class:"description"});t.inject(_),t.setStyles({"grid-column":"1/2 span"})}},S=function(){var e;"Check"===n.type?(e=C.status?C.status:-1,(h=new l({elementsList:[{labelItem:d.reviewPanel.checkStatusInProgress,iconItem:{iconClasses:f[0].fonticonClass+" checkUNDIconColor"},valueItem:0},{labelItem:d.reviewPanel.checkStatusPassed,iconItem:{iconClasses:f[1].fonticonClass+" checkOKIconColor"},valueItem:1},{labelItem:d.reviewPanel.checkStatusFailed,iconItem:{iconClasses:f[2].fonticonClass+" checkKOIconColor"},valueItem:2}],enableSearchFlag:!1,value:-1===e?2:e-1}).inject(_)).getContent().addClassName("statusCombo"),h.getContent().id=C.id,h.elements.iconPlaceholder.style.marginRight="11px",r.getTouchMode()&&h.getContent().setStyles({width:"87%","margin-left":"29px"}),h.addEventListener("change",function(){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0),g||n.onCheckAttributeChanged(this.id,"status",this.dsModel.value+1);var e=R.getContent().getElementsByClassName("DMUCustomExpHeaderFontIcon")[0];e.className=f[this.dsModel.value].fonticonClass+" DMUCustomExpHeaderFontIcon",e.setStyles({color:f[this.dsModel.value].fonticonColor,"font-size":"14px"}),g=!1})):(e=C.rating?C.rating:-1,(o=new l({elementsList:[{labelItem:d.reviewPanel.highlightRatingTBA,iconItem:{iconClasses:f[0].fonticonClass+" highlightTBAIconColor"},valueItem:0},{labelItem:d.reviewPanel.highlightRatingHigh,iconItem:{iconClasses:f[3].fonticonClass+" highlightHighIconColor"},valueItem:3},{labelItem:d.reviewPanel.highlightRatingMedium,iconItem:{iconClasses:f[2].fonticonClass+" highlightMediumIconColor"},valueItem:2},{labelItem:d.reviewPanel.highlightRatingLow,iconItem:{iconClasses:f[1].fonticonClass+" highlightLowIconColor"},valueItem:1},{labelItem:d.reviewPanel.highlightRatingProcessed,iconItem:{iconClasses:f[4].fonticonClass+" highlightProIconColor"},valueItem:4}],enableSearchFlag:!1,value:-1===e?2:e-1}).inject(_)).getContent().addClassName("highlightRatingCombo"),o.getContent().id=C.id,o.elements.iconPlaceholder.style.marginRight="11px",r.getTouchMode()&&o.getContent().setStyles({width:"87%","margin-left":"29px"}),o.addEventListener("change",function(){m.getMainDiv().isSelected()||m.getMainDiv().setSelectedFlag(!0),p||n.onHighlightAttributeChanged(this.id,"rating",this.dsModel.value+1);var e=R.getContent().getElementsByClassName("DMUCustomExpHeaderFontIcon")[0];e.className=f[this.dsModel.value].fonticonClass+" DMUCustomExpHeaderFontIcon",e.setStyles({color:f[this.dsModel.value].fonticonColor,"font-size":"14px"}),p=!1}))},E=function(){(u=new a({value:C.description?C.description:"",widthInCharNumber:33,nbRows:4,newLineMode:"shiftEnter",placeholder:"Check"===n.type?d.reviewPanel.writeCheckDescription:d.reviewPanel.writeHighlightDescription}).inject(_)).getContent().id=C.id,u.getContent().addClassName("Check"===n.type?"checkDescriptionEditor":"highlightDescriptionEditor"),u.elements.container.getChildren()[0].setStyles({width:"100%"}),r.getTouchMode()&&u.elements.container.getChildren()[0].setStyles({"margin-left":"29px","margin-top":"7px",width:"87%"}),u.addEventListener("change",function(){n.onCheckAttributeChanged?n.onCheckAttributeChanged(this.id,"description",this.dsModel.value):n.onHighlightAttributeChanged(this.id,"description",this.dsModel.value)})},k=function(){if(C.requirements&&C.requirements.length>0){var t=new e.Element("div",{class:"requirementDiv"}).inject(_);for(let a=0;a<C.requirements.length;a++){v+=1;var i=new e.Element("span",{class:f[3].fonticonClass}).inject(t);i.addClassName("requirementIcon"),i.setStyles({color:f[3].fonticonColor});var o=C.requirements[a].id;new e.Element("div",{id:o||C.requirements[a].getPlmID(),text:o||C.requirements[a].getPlmID(),class:"requirement"}).inject(t).onclick=function(){n.onAttachedObjClicked(this.id)}}}},M=function(){var t=new e.Element("div",{class:"editableHighlightThumbDiv"}).inject(_);if(r.getTouchMode()&&t.setStyles({"margin-top":"7px","margin-left":"26px"}),n.normalCommentRepresentation&&(n.normalCommentRepresentation.inject(t),n.normalCommentRepresentation.addClassName("normalCommentRepresentation")),n.lightCommentRepresentation)n.lightCommentRepresentation.inject(t),n.lightCommentRepresentation.addClassName("lightCommentRepresentation"),n.lightCommentRepresentation.hide();else{var i=new e.Element("div",{class:"editableHighlightSlideBlock"}).inject(_);new e.Element("span",{class:"slideIcon"}).inject(i),new e.Element("div",{class:"slide"}).inject(i),i.hide()}localStorage.setItem("DMUReviewPanel_SlideThumbnailGlobalView",!0)},P=function(){var t,i=n.impChecksInfos[C.id],o=new e.Element("div",{class:"impCheckDiv",id:C.id}).inject(_);if(o.hide(),"facet"===n.panelType&&o.setStyles({"grid-row":"3"}),i){o.show();for(let a=0;a<i.length;a++)(t=new e.Element("span",{class:n.checkIcons[i[a].status-1].fonticonClass}).inject(o)).addClassName("objectIcon"),t.id=C.id+"_"+i[a].id,t.setStyles({color:n.checkIcons[i[a].status-1].fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:i[a].name,class:"check",id:C.id+"_"+i[a].id}).inject(o).title=i[a].name}},B=function(){var t,i,o=n.impChecksInfos[C.id],a=new e.Element("div",{class:"editableImpHighlightDiv"}).inject(_);if(r.getTouchMode()&&a.setStyles({"margin-left":"30px"}),a.hide(),o){a.show(),"reviewApp"===n.panelType&&!n.editionMode&&n.readOnly&&_.setStyles({"grid-template-row":" 20px"});for(let l=0;l<o.length;l++)y+=1,(t=new e.Element("span",{class:n.highlightIcons[o[l].rating-1].fonticonClass,id:C.id+"_"+o[l].id}).inject(a)).addClassName("impHighlightIcon"),t.setStyles({color:n.highlightIcons[o[l].rating-1].fonticonColor}),i=o[l].name,new e.Element("div",{text:i,class:"impHighlight",id:C.id+"_"+o[l].id}).inject(a).title=o[l].name}},U=function(){var t,i=new e.Element("div",{class:"issueDiv"}).inject(_);if("facet"===n.panelType&&i.setStyles({"grid-row":"4"}),i.hide(),C.issues){i.show();for(let o=0;o<C.issues.length;o++)b+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue"}).inject(i)).setStyles({color:"#77797C"}),t.addClassName("issueIcon"),new e.Element("div",{id:C.issues[o].id,text:C.issues[o].name,class:"issue"}).inject(i).onclick=function(){n.onAttachedObjClicked(this.id)}}},I=function(){var t=new e.Element("div",{class:"changeActionDiv"}).inject(_);if("facet"===n.panelType&&t.setStyles({"grid-row":"5"}),t.hide(),C.changeAction){t.show();for(let i=0;i<C.changeAction.length;i++)w+=1,new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(t).addClassName("caIcon"),new e.Element("div",{id:C.changeAction[i].id,text:C.changeAction[i].name,class:"ca"}).inject(t).onclick=function(){n.onAttachedObjClicked(this.id)}}},_=new e.Element("div",{class:"Check"===n.type?"checkExpanderBody":"highlightExpanderBody"}).inject(x);"reviewApp"===n.panelType?n.editionMode&&!n.readOnly?("Check"===n.type&&(S(),E(),function(){var t=new e.Element("div",{class:"requirementDropZone"}).inject(_);new e.Element("div",{text:d.reviewPanel.reqDropZoneInfo,class:"infoReq"}).inject(t);var i=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus",id:C.id}).inject(t);if(i.addClassName("requirementPlusIcon"),i.hide(),r.getTouchMode()&&t.setStyles({"margin-left":"29px"}),t.ondrop=function(e){e.preventDefault(),e.stopPropagation();var t=JSON.parse(e.dataTransfer.getData("Text"));t.data&&t.data.items&&t.data.items.length>0&&"Requirement"===t.data.items[0].objectType&&n.onRequirementDrop(C.id,t.data.items[0].objectId,t.data.items[0].displayName)},t.ondragenter=function(e){e.preventDefault(),e.stopPropagation(),this.getElementsByClassName("requirementPlusIcon")[0].show(),this.getElementsByClassName("infoReq")[0].hide(),this.addClassName("reqDropZoneDrag")},t.ondragleave=function(){this.getElementsByClassName("requirementPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("reqDropZoneDrag")},t.ondragover=function(e){e.preventDefault(),e.stopPropagation()},t.ondragend=function(e){e.preventDefault(),e.stopPropagation()},C.requirements&&C.requirements.length>0){t.hide();var o=new e.Element("div",{class:"requirementDiv"}).inject(_);for(let t=0;t<C.requirements.length;t++){v+=1;var a=new e.Element("span",{class:f[3].fonticonClass}).inject(o);a.addClassName("requirementIcon"),a.setStyles({color:f[3].fonticonColor});var l=C.requirements[t].getPlmID(),s=C.requirements[t].getName();new e.Element("div",{id:l,text:s||l,class:"requirement"}).inject(o).onclick=function(){n.onAttachedObjClicked(this.id)};var c=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(o);c.addClassName("requirementRemoveButton"),c.id=C.id,c.hide(),c.onclick=function(){n.onRequirementRemove(this.id,C.requirements[0].getPlmID())}}}}(),B()),"Highlight"===n.type&&(S(),E(),M(),function(){new e.Element("div",{text:d.reviewPanel.impactedChecks,class:"impCheckTitle"}).inject(_);var t=new e.Element("div",{class:"impCheckPlaceholder"}).inject(_),o=new i({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(t);o.getContent().addClassName("impCheckPlusButton"),o.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),t.setStyles({"min-height":"12px"}),r.getTouchMode()&&t.setStyles({"margin-top":"-9px"}),o.getContent().addEventListener("change",function(){!0===this.dsModel.checkFlag?n.onSetImpactedCheckRequested(C.id):n.onSetImpactedCheckCanceled()});var a=new e.Element("div",{class:"impCheckDiv",id:C.id}).inject(_);a.hide();var l,s=n.impChecksInfos[C.id];if(s&&s.length){a.show();for(let t=0;t<s.length;t++){(l=new e.Element("span",{class:n.checkIcons[s[t].status-1].fonticonClass}).inject(a)).addClassName("objectIcon"),l.id=C.id+"_"+s[t].id,l.setStyles({color:n.checkIcons[s[t].status-1].fonticonColor,width:"fit-content",margin:"auto"}),new e.Element("div",{text:s[t].name,class:"check",id:C.id+"_"+s[t].id}).inject(a).title=s[t].name;var c=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove"}).inject(a);a.show(),c.addClassName("impCheckRemoveButton"),c.id=s[t].id,c.hide(),c.onclick=function(){n.onImpactedCheckRemoved(C.id,this.id)}}}else a.hide()}(),function(){var t;new e.Element("div",{text:d.reviewPanel.issues,class:"issueTitle"}).inject(_);var o=new e.Element("div",{class:"issuePlaceholder"}).inject(_),a=new i({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(o);a.getContent().id=C.id,a.getContent().addClassName("issuePlusButton"),a.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),o.setStyles({"min-height":"12px"}),a.getContent().onclick=function(e){R.isSelected()&&e.stopPropagation()},a.getContent().addEventListener("change",function(){!0===this.dsModel.checkFlag&&n.onAddIssueRequested(C.id,C.name)});var l=new e.Element("div",{class:"issueDiv",id:C.id}).inject(_);if(l.hide(),C.issues&&C.issues.length){l.show();for(let i=0;i<C.issues.length;i++)b+=1,(t=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue"}).inject(l)).setStyles({color:"#77797C"}),t.addClassName("issueIcon"),new e.Element("div",{id:C.issues[i].id,text:C.issues[i].name,class:"issue"}).inject(l).onclick=function(){n.onAttachedObjClicked(this.id)}}else l.hide()}(),"Document"!==n.contextType&&"Requirement"!==n.contextType&&"Requirement Specification"!==n.contextType&&function(){new e.Element("div",{text:d.reviewPanel.changeActions,class:"caTitle"}).inject(_);var t=new e.Element("div",{class:"caPlaceholder"}).inject(_),o=new i({displayStyle:"lite",label:"add Impacted Check Button",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.Font3DS},type:"check",showLabelFlag:!1}).inject(t);r.getTouchMode()&&t.setStyles({"margin-top":"-9px"}),o.getContent().id=C.id,o.getContent().addClassName("caPlusButton"),o.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"12px"}),t.setStyles({"min-height":"12px"}),o.getContent().onclick=function(e){R.isExpanded()&&e.stopPropagation()},o.getContent().addEventListener("change",function(){!0===this.dsModel.checkFlag&&n.onAddCARequested(C.id,C.name)});var a=new e.Element("div",{class:"changeActionDiv",id:C.id}).inject(_);if(a.hide(),C.changeAction&&C.changeAction.length){a.show();for(let t=0;t<C.changeAction.length;t++)w+=1,new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(a).addClassName("caIcon"),new e.Element("div",{id:C.changeAction[t].id,text:C.changeAction[t].name,class:"ca"}).inject(a).onclick=function(){n.onAttachedObjClicked(this.id)}}else a.hide()}())):(_.setStyles({"grid-template-rows":"auto"}),_.setStyles({"padding-left":"8px"}),"Check"===n.type&&(D(),k(),B()),"Highlight"===n.type&&(D(),M(),P(),U(),I())):"facet"===n.panelType&&(_.setStyles({"padding-top":"5px"}),S(),E(),"Check"===n.type&&(k(),B()),"Highlight"===n.type&&(P(),U(),I()));var F=function(){var t=new e.Element("div",{class:"additionalDivContainer"});if("Check"===n.type){if(v>0){var i=new e.Element("div",{class:"additionalDiv"}).inject(t);new e.Element("div",{text:v,class:"number"}).inject(i),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-target"}).inject(i)}if(y>0){var o=new e.Element("div",{class:"additionalDiv"}).inject(t);new e.Element("div",{text:y,class:"number"}).inject(o),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-level-medium"}).inject(o)}}else if("Highlight"===n.type){if(w>0){var a=new e.Element("div",{class:"additionalDiv"}).inject(t);new e.Element("div",{text:w,class:"number"}).inject(a),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-change"}).inject(a)}if(b>0){var l=new e.Element("div",{class:"additionalDiv"}).inject(t);new e.Element("div",{text:b,class:"number"}).inject(l),new e.Element("span",{class:"additionalDivIcon wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-issue"}).inject(l)}}else"Validated"===n.type&&(t=n.validRemoveButton);return t}(),R=new s({onLabelChanged:function(e){"Check"===n.type&&n.onCheckAttributeChanged(C.id,e.type,e.value),"Highlight"===n.type&&n.onHighlightAttributeChanged(C.id,e.type,e.value)},onExpandOrCollapse:"Check"===n.type?function(e){e.state?(e.object.setAdditionalDivVisibleFlag(!1),e.object.setExpandOrCollapseButtonVisibleFlag(!0),n.editionMode&&e.object.setHeaderIconVisibleFlag(!1),n.editionMode&&e.object.setLabelEditionFlag(!0),e.object.expandOrCollapseAtClick(!1)):(e.object.setExpandOrCollapseButtonVisibleFlag(!1),e.object.setHeaderIconVisibleFlag(!0),e.object.setAdditionalDivVisibleFlag(!0),e.object.setLabelEditionFlag(!1),e.object.expandOrCollapseAtClick(!0))}:function(e){e.state?(e.object.setAdditionalDivVisibleFlag(!1),e.object.setExpandOrCollapseButtonVisibleFlag(!0),n.editionMode&&e.object.setHeaderIconVisibleFlag(!1),n.editionMode&&e.object.setLabelEditionFlag(!0),e.object.expandOrCollapseAtClick(!1),"Highlight"===n.type&&n.onHighlightExpandCB&&n.onHighlightExpandCB({object:e.object.getContent(),id:C.id})):(e.object.setExpandOrCollapseButtonVisibleFlag(!1),e.object.setHeaderIconVisibleFlag(!0),e.object.setAdditionalDivVisibleFlag(!0),e.object.setLabelEditionFlag(!1),e.object.expandOrCollapseAtClick(!0))},onSelectedFlagChanged:function(e){e.state?("Validated"===n.type&&R.setAdditionalDivVisibleFlag(!0),n.onExpanderSelectedCB&&n.onExpanderSelectedCB({id:"Validated"===n.type||"Context"===n.type?m.getContent().id?parseInt(m.getContent().id):C.id:m.getContent().id,element:R,type:n.type,event:e.event})):("Validated"===n.type&&R.setAdditionalDivVisibleFlag(!1),n.onExpanderUnselectCB&&n.onExpanderUnselectCB({id:"Validated"===n.type||"Context"===n.type?m.getContent().id?parseInt(m.getContent().id):C.id:m.getContent().id,element:R,type:n.type}))}});R.build({fontIcon:"Check"===n.type?f[n.objectData.status-1].fonticonClass:"Highlight"===n.type?f[n.objectData.rating-1].fonticonClass:void 0,fontIconColor:"Check"===n.type?f[n.objectData.status-1].fonticonColor:"Highlight"===n.type?f[n.objectData.rating-1].fonticonColor:void 0,icon:"Validated"===n.type||"Context"===n.type?n.objectData.icon:void 0,label:n.objectData.name,additionalDiv:F,body:x}),R.setReadOnly(!1),"Validated"!==n.type&&"Context"!==n.type||R.expandOrCollapseAtClick(!1),n.editionMode||(R.setLabelEditionFlag(!1),R.setHeaderIconVisibleFlag(!0))}})}),define("DS/DMUControls/panels/DMUReviewPanel",["UWA/Core","UWA/Class","DS/Visualization/ThreeJS_DS","UWA/Controls/ThemedScroller","DS/DMUControls/DMUReviewExpander","DS/Controls/Expander","DS/Controls/Button","DS/Utilities/TouchUtils","DS/Windows/Dialog","DS/Core/ModelEvents","DS/DMUControls/EXPNotify","DS/VisuEvents/EventsManager","DS/DMUBaseExperience/DMUContextManager","DS/CATWebUXComponents/CATWebUXSectionHeader","DS/DMUBaseExperience/EXPToolsContext","DS/Controls/TooltipModel","DS/Menu/ContextualMenu","i18n!DS/DMUControls/assets/nls/DMUControls","css!DS/DMUControls/DMUControls.css"],function(e,t,n,i,o,a,l,s,r,d,c,h,u,m,g,p,C,f){"use strict";return t.extend({init:function(t){var h,v;this._parent(t);var y,b,w,x,D,S,E,k,M,P,B,U,I,_,F,R,T,j,N,A,L,H,W,O,V,z,q,X,Z,G,K,Y,$,J,Q,ee,te,ne,ie,oe=0,ae=[],le=new d,se=!1,re=[],de=[],ce=[],he=[],ue=[];let me,ge,pe,Ce=!1;function fe(e,t){ge&&(ge.destroy(),ge=null),ge=new c({body:v.getUIFrame(),type:e,message:t})}var ve=function(e,t){return le.publish({event:e,data:t,context:this})};this.subscribe=function(e,t){if(e&&t)return le.subscribe({event:e},t)},this.getColumnMinimumWidth=function(){return 273},this.getColumnWidthStep=function(){return 240},this.deactiveValidatedButton=function(){b.checkFlag=!1},this.setContextType=function(e){me=e},this.deactiveButtons=function(){for(let e=0;e<ae.length;e++)"Highlight"===ae[e].type&&ae[e].expander.deactivatePlusButtons()},this.editMarkupName=function(t){let n,i,o=O.getElementsByClassName("markupRect");for(let e=o.length-1;e>=0;e--)if(o[e].id===t){n=o[e].getElementsByClassName("markupName"),i=o[e];break}let a=!1;if(n&&i){n[0].setStyles({display:"none"});let o=e.createElement("p",{class:"DMUMarkupEditableDiv",contenteditable:!0}).inject(i);o.innerText=n[0].innerText,window.getSelection().removeAllRanges();let l=document.createRange();l.selectNodeContents(o),window.getSelection().addRange(l),o.focus(),a=!0;let s=function(e){a&&(a=!1,i.removeChild(o),e||(n[0].innerText=o.innerText,n[0].setStyles({display:"inline-block"}),ve("onMarkupRenamed",{id:t,title:o.innerText})))};o.addEventListener("keyup",function(e){e.stopPropagation()}),o.addEventListener("click",function(e){e.stopPropagation()}),o.addEventListener("keydown",function(e){"Enter"!==e.key&&13!==e.keyCode&&"Escape"!==e.key&&27!==e.keyCode||s("Escape"===e.key||27===e.keyCode)}),o.addEventListener("blur",s)}},this.expandAll=function(e){for(let t=0;t<ae.length;t++)("Checks"===e&&"Check"===ae[t].type||"Highlights"===e&&"Highlight"===ae[t].type)&&ae[t].expander.expand()},this.collapseAll=function(e){for(let t=0;t<ae.length;t++)("Checks"===e&&"Check"===ae[t].type||"Highlights"===e&&"Highlight"===ae[t].type)&&ae[t].expander.collapse()},this.setPanelReadOnlyFlag=function(e){_=e.editionMode,h=e.readOnly,N.destroy(),A.destroy(),L.destroy(),H.destroy();var t=localStorage.getItem("DMUReviewPanel_ContextExpandedFlags"),n=localStorage.getItem("DMUReviewPanel_validExpandedFlags"),i=localStorage.getItem("DMUReviewPanel_checkExpandedFlags"),o=localStorage.getItem("DMUReviewPanel_highlightExpandedFlags");(N=this.buildContext(t)).inject(O),(A=this.buildValidatedObjects(n)).inject(O),(L=this.buildChecks(i)).inject(O),(H=this.buildHighlights(o)).inject(O),ve("updateIconValidated")},this.setAddValidatedButtonVisibilityFlag=function(e){se=e},this.setDropZoneVisibilityFlag=function(e){Ce=e},this.removeRequirement=function(e){for(let t=0;t<ae.length;t++)ae[t].id===e.checkId&&ae[t].expander.removeRequirement()},this.addRequirement=function(e){for(let t=0;t<ae.length;t++)ae[t].id===e.checkId&&ae[t].expander.addRequirement(e.checkId,e.requirementId,e.requirementTitle);he[e.checkId].requirements||(he[e.checkId].requirements=[]),he[e.checkId].requirements.push(e.requirementId)},this.addIssue=function(e){ue[e.highlightId].issues.push(e.id);for(let t=0;t<ae.length;t++)ae[t].id===e.highlightId&&ae[t].expander.addIssue(e.id,e.name)},this.addCa=function(e){ue[e.highlightId].changeAction.push(e.id);for(let t=0;t<ae.length;t++)ae[t].id===e.highlightId&&ae[t].expander.addCA(e.id,e.name)},this.unsubscribe=function(e){null!=e&&le.unsubscribe(e)};var ye=function(t,n){var i=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:f.reviewPanel.removeRequirement,class:"warningMessage"}).inject(i);var o=new l({emphasize:"primary",label:f.reviewPanel.YesBtn?f.reviewPanel.YesBtn:"Yes",onClick:function(){ve("onRequirementRemoveRequested",{type:"ValidationRequirement",checkId:t,objectId:n}),z&&z.destroy()}});o.getContent().addClassName("confirmRemoveButton");var a=new l({label:f.reviewPanel.NoBtn?f.reviewPanel.NoBtn:"No",onClick:function(){z&&z.destroy()}});z=new r({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:f.reviewPanel.removeImpactedCheckTitle,resizableFlag:!0,immersiveFrame:v.getImmersiveFrame(),buttons:{Ok:o,Cancel:a},width:400,content:i})},be=function(t,n){var i=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:f.reviewPanel.removeImpactedCheck,class:"warningMessage"}).inject(i);var o=new l({emphasize:"primary",label:f.reviewPanel.YesBtn?f.reviewPanel.YesBtn:"Yes",onClick:function(){ve("onImpCheckRemoveRequested",{highlightId:t,checkId:n}),z&&z.destroy()}});o.getContent().addClassName("confirmRemoveButton");var a=new l({label:f.reviewPanel.NoBtn?f.reviewPanel.NoBtn:"No",onClick:function(){z&&z.destroy()}});z=new r({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:f.reviewPanel.removeImpactedCheckTitle,resizableFlag:!0,immersiveFrame:v.getImmersiveFrame(),buttons:{Ok:o,Cancel:a},width:400,content:i})};this._processValidatedObjDeletion=function(){let e=R.getElementsByClassName("dropValidatedObjZone");var t,n,i=!1;e.length&&Ce&&"Requirement"===me&&e[0]&&e[0].show();var o=A.getElementsByClassName("validatedObjectExpander");for(t=ae.length-1;t>=0;t--)"Validated"===ae[t].type&&(!1===ae[t].expander.getMainDiv().isSelected()?i||(ae[t].id-=7):(ae[t].expander.getMainDiv().getContent().destroy(),ae.splice(t,1),i=!0));for(oe=0,n=0;n<o.length;n++)o[n].id=oe,oe+=7;var a=A.getElementsByClassName("addValidatedButton");a.length>0&&a[0].show(),0===o.length&&A.getElementsByClassName("noValidatedDisplay")[0].show()},this.removeImpactedCheck=function(e){var t=e.highlightId,n=e.checkId;for(let e=0;e<ae.length;e++)ae[e].id===t&&ae[e].expander.removeImpactedCheck(t,n),ae[e].id===n&&ae[e].expander.removeImpactedCheck(t,n)},this.updateContextInformations=function(e){var t=J.getContent().getElementsByClassName("ctxPlaceholder")[0],n=new o({objectData:{name:e.name,icon:e.icon,id:-1},editionMode:_,readOnly:h,onExpanderSelectedCB:Ee,icons:X,type:"Context",panelType:"reviewApp",contextType:me}).inject(t);ae.push({expander:n,id:-1,index:ae.length,type:"Context"}),n.getContent().addClassName("contextObjectExpander"),n.getContent().id=-1,J.getContent().getElementsByClassName("noContextDisplay")[0].hide()},this.updateImpactedCheckDisplay=function(e){if("Highlight"===e.type){e.name&&(ue[e.id].name=e.name),e.rating&&(ue[e.id].rating=parseInt(e.rating)),e.description&&(ue[e.id].description=e.description);for(let t=0;t<ae.length;t++)"Check"===ae[t].type&&ae[t].expander.updateAssociatedHighlightsDisplay(e)}else if("Check"===e.type){e.name&&(he[e.id].name=e.name),e.status&&(he[e.id].status=e.status),e.description&&(he[e.id].description=e.description);for(let t=0;t<ae.length;t++)"Highlight"===ae[t].type&&ae[t].expander.updateImpactedCheckDisplay(e)}},this.updateImpactedCheck=function(e){var t=e.highlightId,n=e.checkId;ce[t]||(ce[t]=[]),ce[t].push({id:n,status:he[n].status,name:he[n].name}),ce[n]||(ce[n]=[]),ce[n].push({id:t,rating:ue[t].rating,name:ue[t].name});for(let e=0;e<ae.length;e++)ae[e].id!==t&&ae[e].id!==n||ae[e].expander.updateImpactedCheck({highlightInfos:ue[t],checkInfos:he[n],highlightNumber:ce[n].length})},this.unSelectAllExpanders=function(){for(let e=0;e<ae.length;e++)ae[e].expander.getMainDiv().setSelectedFlag(!1)},this.unSelectAllValidated=function(){},this.unSelectExpander=function(e){for(let t=0;t<ae.length;t++)ae[t].id===e&&ae[t].expander.getMainDiv().setSelectedFlag(!1)},this.updateHighlightDisplay=function(e){for(let t=0;t<e.length;t++)for(let n=0;n<ae.length;n++)"Check"===ae[n].type?ae[n].expander.removeImpactedCheck(e[t]):ae[n].id===e[t]&&(ae[n].expander.destroy(),we(e[t]));0===j.length&&H.getContent().getElementsByClassName("noHighlightDisplay")[0].show()};var we=function(e){var t,n=[];for(t=0;t<j.length;t++)j[t].id!==e?n[j[t].id]={name:j[t].name,id:j[t].id,description:j[t].description,issues:j[t].issues,changeAction:j[t].changeAction,rating:j[t].rating,associatedCheck:j.associatedCheck,expander:ue[j[t].id].expander}:(j.splice(t,1),t-=1);for(t=0;t<ae.length;t++)ae[t].id===e&&ae.splice(t,1);for(t=0;t<ae.length;t++)ae[t].index=t;ue=[],ue=n},xe=function(e){for(let t=0;t<j.length;t++)for(let n=0;n<j[t].associatedCheck.length;n++)if(j[t].associatedCheck[n]===e){j[t].associatedCheck.splice(n,1),ue[j[t].id].associatedCheck.splice(n,1);break}};this.updateCheckStatus=function(e,t){for(let i=0;i<ae.length;i++)if(ae[i].id===e){ae[i].expander.setCheckComboValue(!0);var n=ae[i].expander.getContent().getElementsByClassName("statusCombo");n.length&&(n[0].dsModel.value=t-1)}},this.updateHighlightSeverity=function(e,t){for(let i=0;i<ae.length;i++)if(ae[i].id===e){ae[i].expander.setHighlightComboValue(!0);var n=ae[i].expander.getContent().getElementsByClassName("highlightRatingCombo");n.length&&(n[0].dsModel.value=t-1)}},this.updateCheckDisplay=function(e){for(let t=0;t<e.length;t++){xe(e[t]);for(let n=0;n<ae.length;n++)"Highlight"===ae[n].type?ae[n].expander.removeImpactedCheck(e[t]):ae[n].id===e[t]&&ae[n].expander.destroy();De(e[t])}0===T.length&&L.getContent().getElementsByClassName("noCheckDisplay")[0].show()};var De=function(e){var t,n=[];for(t=0;t<T.length;t++)T[t].id!==e?n[T[t].id]={name:T[t].name,id:T[t].id,requirements:T[t].requirements,status:T[t].status,expander:he[T[t].id].expander}:(T.splice(t,1),t-=1);for(t=0;t<ae.length;t++)ae[t].id===e&&ae.splice(t,1);for(t=0;t<ae.length;t++)ae[t].index=t;he=[],he=n},Se=function(e){var t={},i=e.event?e.event:e;i.stopPropagation(),t.shiftKeyPressed=i.shiftKey,t.ctrlKeyPressed=i.ctrlKey;let o=i.pageX?{x:i.pageX,y:i.pageY}:null;o||(o=i.screenX?{x:i.screenX,y:i.screenY}:null),!o&&i.type&&-1!==i.type.indexOf("touch")&&i.changedTouches&&i.changedTouches[0]&&((o=(i=i.changedTouches[0]).pageX?{x:i.pageX,y:i.pageY}:null)||(o=i.screenX?{x:i.screenX,y:i.screenY}:null)),o||(o={x:0,y:0}),t.position=new n.Vector2(o.x,o.y),t.type=e.objectType?e.objectType:i.currentTarget.id,setTimeout(function(){ve("onExpanderCtxMenuRequired",t)})},Ee=function(e){var t,n=0;for(let t=0;t<ae.length;t++)e.id===ae[t].id?n=ae[t].index:!e.element.isCheckBoxClicked()&&e.element.isSelected()&&(!e.event||e.event.shiftKey||e.event.ctrlKey||ae[t].expander.getMainDiv().setSelectedFlag(!1));if("Check"===e.type||"Highlight"===e.type){var i=e.element.getContent().getElementsByClassName("impCheckRemoveButton");if(i.length)for(let e=0;e<i.length;e++)i[e].show();var o=e.element.getContent().getElementsByClassName("requirementRemoveButton");if(o.length)for(let t=0;t<o.length;t++)o[t].id===e.id&&o[t].show();t={event:e.event,element:e.element,index:n,expanders:ae},ve("onExpanderSelectionRequested",t)}else"Validated"===e.type?((t={}).event=e.event,t.element=e.element,t.validatedRects=de,ve("onValidatedSelected",t)):"Context"===e.type&&((t={}).event=e.event,t.element=e.element,t.validatedRects=de,ve("onContextSelected",t))},ke=function(e){var t=e.element.getContent().getElementsByClassName("impCheckRemoveButton");if(t.length)for(let e=0;e<t.length;e++)t[e].hide();var n=e.element.getContent().getElementsByClassName("requirementRemoveButton");if(n.length)for(let t=0;t<n.length;t++)n[t].id===e.id&&n[t].hide();var i={id:e.id,type:e.type,expanders:ae};ve("onExpanderUnselectRequested",i)},Me=function(e){Z(e)};this.highlightUpdatePreview=function(){for(var e=0;e<ae.length;e++)"Highlight"===ae[e].type&&ae[e].expander.updatePreview();"false"===localStorage.getItem("DMUReviewPanel_ThumbnailShowState")?localStorage.setItem("DMUReviewPanel_ThumbnailShowState",!0):localStorage.setItem("DMUReviewPanel_ThumbnailShowState",!1)},this.getImpactedChecksById=function(){for(var e=0;e<T.length;e++)he[T[e].id]=T[e];for(var t=0;t<j.length;t++){ue[j[t].id]=j[t];var n=j[t].associatedCheck;if(n)for(var i=0;i<n.length;i++)ce[j[t].id]||(ce[j[t].id]=[]),ce[n[i]]||(ce[n[i]]=[]),ce[j[t].id].push({id:n[i],status:he[n[i]].status,name:he[n[i]].name}),ce[n[i]].push({id:j[t].id,rating:j[t].rating,name:j[t].name})}},this.updateHeaderIcon=function(e,t){for(let n=0;n<ae.length;n++)ae[n].id===parseInt(e)&&ae[n].expander.getMainDiv().setIcon({icon:t})},this.updateHeaderLabel=function(e,t){for(let n=0;n<ae.length;n++)ae[n].id===parseInt(e)&&ae[n].expander.getMainDiv().setLabel(t)};var Pe=function(e,t,n){"name"===t&&ve("onCheckAttributeChanged",{objectId:e,name:n}),"status"===t&&ve("onCheckAttributeChanged",{objectId:e,status:n}),"description"===t&&ve("onCheckAttributeChanged",{objectId:e,description:n})},Be=function(e,t,n){"name"===t&&ve("onHighlightAttributeChanged",{objectId:e,name:n}),"rating"===t&&ve("onHighlightAttributeChanged",{objectId:e,rating:n}),"description"===t&&ve("onHighlightAttributeChanged",{objectId:e,description:n})},Ue=function(e,t,n){ve("onRequirementAddRequested",{checkId:e,requirementId:t,requirementTitle:n})},Ie=function(e){ve("onImpCheckRequested",{objectId:e})},_e=function(){ve("onImpCheckCancelCmd")},Fe=function(e,t){ve("onIssueAddRequested",{id:e,name:t})},Re=function(e,t){ve("onCaAddRequested",{id:e,name:t})};let Te=(t,n)=>{let i,o;if("check"===n)o=new e.Element("div",{text:f.reviewPanel.reqDropZoneInfo,class:"infoReq"}),i=new e.Element("div",{class:"dropCheckObjZone"}).inject(t),o.inject(i);else{switch(me){case"Requirement Specification":case"Requirement":o=new e.Element("div",{text:f.reviewPanel.reqDropZoneInfo,class:"infoReq"});break;case"DIFLayout":o=new e.Element("div",{text:f.reviewPanel.difSheetDropZoneInfo,class:"infoReq"});break;case"DesignSight":o=new e.Element("div",{text:f.reviewPanel.msrDropZoneInfo,class:"infoReq"});break;case null:o=new e.Element("div",{text:f.reviewPanel.noContextDropZoneInfo,class:"infoReq"})}i=new e.Element("div",{class:"dropValidatedObjZone"}).inject(t),o.inject(i)}let a=new e.Element("span",{class:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-plus"}).inject(i);"check"===n?a.addClassName("objPlusIcon checkObjPlusIcon"):a.addClassName("objPlusIcon validatedObjPlusIcon"),a.hide(),i.ondrop=function(e){let t=u.getReviewContext({viewer:v.getViewer()}).getValidation().getValidated().getPathElements(),i=[],o=[];t.length>0&&t.forEach(e=>{i.push(e.pathElement)}),this.getElementsByClassName("objPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("valDropZoneDrag"),e.preventDefault(),e.stopPropagation();let a=JSON.parse(e.dataTransfer.getData("Text"));if(a.data&&a.data.items&&a.data.items.length>0){let e=pe,t=[];if("check"===n){for(let e=0;e<a.data.items.length;e++)-1!==["Requirement","Requirement Specification","Chapter"].indexOf(a.data.items[e].objectType)?t.push(a.data.items[e]):fe("warning",f.reviewPanel.DropRequirementObjError);e.fireEvent("onRequirementDropped",t)}else{let t=me;for(let n=0;n<a.data.items.length;n++)"DIFLayout"===t&&"DIFSheet"!==a.data.items[n].objectType?fe("warning",f.reviewPanel.DropValidatedObjError):"Requirement Specification"!==t||["Requirement Specification","Requirement","Chapter"].includes(a.data.items[n].objectType)?"DesignSight"===t&&"VPMReference"!==a.data.items[n].objectType?fe("warning",f.reviewPanel.DropValidatedObjError):"Requirement"===t&&"Requirement"!==a.data.items[n].objectType?fe("warning",f.reviewPanel.DropRequirementValidatedObjError):["Requirement Specification","Requirement","Chapter"].includes(a.data.items[n].objectType)?new Promise(t=>{let n,i={};i.cb=(e=>{n=e}),e.fireEvent("onGetLoadedReqSpecInformations",i),t(n)}).then(l=>{-1!==l.indexOf(a.data.items[n].objectId)?new Promise((e,t)=>{i.forEach(e=>{e.includes(a.data.items[n].objectId)&&t()}),e()}).then(()=>{i.push([a.data.items[n].objectId]),o.push([a.data.items[n].objectId]),n===a.data.items.length-1&&e.fireEvent("onValidatedObjectDropped",{path:i,pathToAdd:o})},()=>{fe("warning",f.reviewPanel.ValidatedObjExist)}):["Requirement Specification","Requirement","Chapter"].includes(t)?fe("warning",f.reviewPanel.DropRequirementValidatedObjError):fe("warning",f.reviewPanel.DropValidatedObjError)}):"DIFSheet"===a.data.items[n].objectType?new Promise(t=>{let n,i={};i.cb=(e=>{n=e}),e.fireEvent("onGetLoadedSheetInformations",i),t(n)}).then(t=>{-1!==t.sheetIDList.indexOf(a.data.items[n].objectId)?new Promise((e,t)=>{i.forEach(e=>{e.includes(a.data.items[n].objectId)&&t()}),e()}).then(()=>{i.push([a.data.items[0].objectId]),o.push([a.data.items[n].objectId]),n===a.data.items.length-1&&e.fireEvent("onValidatedObjectDropped",{path:i,pathToAdd:o})},()=>{fe("warning",f.reviewPanel.ValidatedObjExist)}):fe("warning",f.reviewPanel.DropValidatedObjError)}):"VPMReference"===a.data.items[n].objectType&&new Promise((e,t)=>{i.forEach(e=>{e.includes(a.data.items[n].objectId)&&t()}),e()}).then(()=>{i.push([a.data.items[0].objectId]),o.push([a.data.items[n].objectId]),e.fireEvent("onValidatedObjectDropped",{path:i,pathToAdd:o})},()=>{fe("warning",f.reviewPanel.ValidatedObjExist)}):fe("warning",f.reviewPanel.DropValidatedObjError)}}},i.ondragenter=function(e){e.preventDefault(),e.stopPropagation(),this.getElementsByClassName("objPlusIcon")[0].show(),this.getElementsByClassName("infoReq")[0].hide(),this.addClassName("valDropZoneDrag")},i.ondragleave=function(){this.getElementsByClassName("objPlusIcon")[0].hide(),this.getElementsByClassName("infoReq")[0].show(),this.removeClassName("valDropZoneDrag")},i.ondragover=function(e){e.preventDefault(),e.stopPropagation()},i.ondragend=function(e){e.preventDefault(),e.stopPropagation()}};this.buildPanel=function(t){var n=localStorage.getItem("DMUReviewPanel_ContextExpandedFlags"),o=localStorage.getItem("DMUReviewPanel_validExpandedFlags"),a=localStorage.getItem("DMUReviewPanel_checkExpandedFlags"),l=localStorage.getItem("DMUReviewPanel_highlightExpandedFlags"),s=localStorage.getItem("DMUReviewPanel_markupExpandedFlags");F=t.validatedNames,T=t.checks,j=t.highlights,q=t.icons,X=t.highlightIcons,Z=t.onHighlightExpand,G=t.highlightDragContent,K=t.onAttachedObjClicked,Y=t.onAddValidatedClicked,h=t.readOnlyFlag,v=t.frmWindow,_=t.editionMode,me=t.contextType,pe=u.giveEventsController({viewer:v.getViewer()}),this.getImpactedChecksById(),B||(B=e.createElement("div",{class:"DMUContextMainDiv"})),B.setStyles({height:"98%"}),(I=new m({draggable:!0,height:60..toString()+"px",onDragStart:function(){return t.reviewDragContent||""},sectionLabel:t.panelTitle?t.panelTitle:f.dmuPanelTitle,cmdList:t.contextualCmdList,doubleClickCB:function(){ve("onPanelResized")}})).getContent().addClassName("reviewPanelSectionHeader"),B.appendChild(I.getContent()),I.getContent().setStyles({height:"75px","background-color":"#f1f1f1"}),this.buildMaturityStatus({maturity:t.maturity,status:t.status},I);var r=e.createElement("div",{class:"CATWebUXSectionHeaderCmdSectionPlaceholder"}).inject(I.getContent());return r.setStyles({position:"relative",width:"100%","margin-left":"auto","margin-right":"auto"}),e.createElement("div",{class:"CATWebUXSectionHeaderContextualCmdSection"}).inject(r).setStyles({"margin-top":"37px",top:"-32px",display:"auto","margin-left":"auto","margin-right":"auto"}),O=e.createElement("div",{class:"reviewContent"}),t.contextNames?(V=t.contextNames,(N=this.buildContext(n)).inject(O)):(N=this.buildContext(n)).inject(O),(A=this.buildValidatedObjects(o)).inject(O),(L=this.buildChecks(a)).inject(O),(H=this.buildHighlights(l)).inject(O),(W=this.buildMarkups(s)).inject(O),W.visibleFlag=!1,(U=(new i).inject(B)).getInnerElement().setContent(O),U.getContent().setStyle("height","calc(100% - 60px)"),B},this.updateReviewPanelContent=function(e){e.reviewNoContextMode?(N.setStyles({display:"none"}),A.setStyles({display:"none"}),H.visibleFlag=!1,W.visibleFlag=!0):(N.setStyles({display:"block"}),A.setStyles({display:"block"}),!e.rootType||"DIFLayout"!==e.rootType&&"Requirement Specification"!==e.rootType&&"DesignSight"!==e.rootType?A.querySelector(".dropValidatedObjZone").hide():A.querySelector(".addValidatedButton").hide(),H.visibleFlag=!0,W.visibleFlag=!1)},this.cleanPanel=function(){if(B){for(;B.firstChild;)B.removeChild(B.firstChild);I&&I.clear(),U&&U.destroy(),I=U=B=null,re=null}},this.buildContext=function(t,n){var i=new e.Element("div",{class:"contextObjDiv"}),l=new e.Element("div",{class:"contextObjects"}),s=new e.Element("div",{class:"ctxPlaceholder"});if(s.inject(l),V&&V.length){var r=new o({objectData:{name:"",icon:n,id:-1},editionMode:_,readOnly:h,onExpanderSelectedCB:Ee,onExpanderUnselectCB:ke,icons:X,type:"Context",panelType:"reviewApp",contextType:me}).inject(s);ae.push({expander:r,id:-1,index:ae.length,type:"Context"}),r.getContent().id=-1,r.getContent().addClassName("contextObjectExpander")}var d=new e.Element("div",{text:f.reviewPanel.noContext,class:"noContextDisplay"});return d.inject(l),V&&(V.length?d.hide():s.hide()),(J=new a({header:f.reviewPanel.contextExpanderTitle,body:l,style:"simple"})).inject(i),J.getContent().addClassName("contextObjExpander"),J.getContent().getElementsByClassName("wux-controls-expander-body")[0].addClassName("contextBody"),"true"===t&&J._expand(),J.getContent().addEventListener("expand",function(){localStorage.setItem("DMUReviewPanel_ContextExpandedFlags",!0)}),J.getContent().addEventListener("collapse",function(){localStorage.setItem("DMUReviewPanel_ContextExpandedFlags",!1)}),i},this.buildValidatedObjects=function(t){let n=u.getReviewContext({viewer:v.getViewer()});if(n.getValidation().getContext()){let e=n.getValidation().getContext().getJsonContextTypes()[0],t=g.getParentType(e)?g.getParentType(e):e;if(["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(t)){let e=n.getValidation().getValidated().getPathElements();e.length&&e.forEach(e=>{n.getValidation().addValidatedNode({docInfo:{validatedId:n.getValidation().getValidated().getPlmID(),validatedPaths:e.pathElement,validatedName:e.referenceName}})})}}var i=new e.Element("div",{class:"validObjDiv"});R=new e.Element("div",{class:"validObjects"}),(y=new e.Element("div",{class:"validatedObjects"}).inject(R)).setStyles({width:"231px"});var o=new a({header:f.reviewPanel.validatedObjectsExpanderTitle,body:R,style:"simple"});o.inject(i),o.getContent().addClassName("validObjExpander"),o.getContent().getElementsByClassName("wux-controls-expander-body")[0].addClassName("validBody"),"true"===t&&o._expand(),o.getContent().addEventListener("expand",function(){localStorage.setItem("DMUReviewPanel_validExpandedFlags",!0)}),o.getContent().addEventListener("collapse",function(){localStorage.setItem("DMUReviewPanel_validExpandedFlags",!1)});let r=new e.Element("div",{text:f.reviewPanel.noValidatedObject,class:"noValidatedDisplay"});r.inject(y);const d=["DIFLayout","Requirement Specification","Requirement","DesignSight"];if(d.includes(me)||!me){if(!h&&_){var c=new e.Element("div",{class:"validatedPlaceholder"});c.inject(y),Te(c,"validatedObject")}if(F.length>0){r.hide();for(var m=0;m<F.length;m++)this.addValidatedObject(F[m])}}if((!d.includes(me)||!me)&&((b=new l({displayStyle:"icon",label:f.reviewPanel.addValidatedObject,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS},type:"check"}).inject(R)).getContent().addClassName("addValidatedButton"),s.getTouchMode()&&(b.getContent().setStyles({"min-width":"0px",width:"205px","min-height":"45px"}),b.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"margin-left":"15px","margin-right":"15px"})),b.hide(),!h&&_&&(b.show(),se&&b.getContent().hide(),b.getContent().addEventListener("change",function(e){var t=e.dsModel;!0===t.checkFlag?Y(t.checkFlag):ve("onUpdateValidatedListCmdCancel")})),F.length>0)){r.hide();for(var p=0;p<F.length;p++)this.addValidatedObject(F[p])}return i},this.addValidatedObject=function(t,n){let i=R.getElementsByClassName("addValidatedButton");i.length&&se&&i[0]&&i[0].hide();let a=R.getElementsByClassName("dropValidatedObjZone");a.length&&!Ce&&"Requirement"===me&&a[0]&&a[0].hide();var d=y.getElementsByClassName("noValidatedDisplay");d.length&&(d[0].hide(),b&&b.getContent().setStyles({"margin-top":"13px"})),b&&!0===b.checkFlag&&(b.checkFlag=!1);let c=y.getElementsByClassName("dropValidatedObjZone")[0];var u,m=y.getElementsByClassName("validatedPlaceholder")[0];c&&m&&m.removeChild(c),m||(m=new e.Element("div",{class:"validatedPlaceholder"})),m.inject(y);var g=new l({displayStyle:"lite",label:"lite displayStyle",icon:{iconName:"remove",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1});g.getContent().addClassName("validRemoveButton"),g.getContent().id=oe,_&&(u=new e.Element("div",{class:"validRemovePlaceholder"}),-1===["Document","DIFSheet","Drawing"].indexOf(me)&&g.inject(u),s.getTouchMode()&&u.setStyles({width:"25px"})),c&&c.inject(m),g.getContent().onclick=function(t){t.preventDefault(),t.stopPropagation();var n=e.createElement("div",{class:"DMURemoveValidatedMainDiv"});new e.Element("div",{text:f.reviewPanel.removeValidatedObject,class:"warningMessage"}).inject(n);var i=new l({emphasize:"primary",label:f.reviewPanel.YesBtn?f.reviewPanel.YesBtn:"Yes",onClick:function(){ve("onValidatedRemove"),z&&z.destroy()}});i.getContent().addClassName("validatedRemoveButton");var o=new l({label:f.reviewPanel.NoBtn?f.reviewPanel.NoBtn:"No",onClick:function(){z&&z.destroy()}});z=new r({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:f.reviewPanel.removeValidatedObjectTitle,resizableFlag:!0,immersiveFrame:v.getImmersiveFrame(),buttons:{Ok:i,Cancel:o},width:400,content:n})};var p=new e.Element("div",{class:"flowContainer"}).inject(m),C=new o({objectData:{name:t,icon:n,id:oe},editionMode:_,readOnly:h,onExpanderSelectedCB:Ee,onExpanderUnselectCB:ke,validRemoveButton:u,icons:X,type:"Validated",panelType:"reviewApp"}).inject(p);return C.getContent().addClassName("validatedObjectExpander"),C.getContent().id=oe,de.push(C),ae.push({expander:C,id:oe,index:ae.length,type:"Validated"}),oe+=7,C.getMainDiv().setAdditionalDivVisibleFlag(!1),C},this.buildChecks=function(t){D=new e.Element("div",{class:"checkExpanderContent"}),S=new e.Element("div",{class:"checksExpanders"}).inject(D);var n=new e.Element("div",{text:f.reviewPanel.noCheck,class:"noCheckDisplay"});n.inject(S),T.length>0&&n.hide();for(var i=0;i<T.length;i++){he[T[i].id]||(he[T[i].id]={name:T[i].name,status:parseInt(T[i].status),description:T[i].description,id:T[i].id});var r=new e.Element("div",{class:"flowContainer"}).inject(S),d=new o({objectData:T[i],editionMode:_,readOnly:h,onCheckAttributeChanged:Pe,onRequirementDrop:Ue,onRequirementRemove:ye,onExpanderSelectedCB:Ee,onExpanderUnselectCB:ke,onAttachedObjClicked:K,icons:q,highlightIcons:X,impChecksInfos:ce,type:"Check",panelType:"reviewApp"}).inject(r);ae.push({expander:d,id:T[i].id,index:ae.length,type:"Check"}),d.getContent().id=T[i].id}(Q=new l({displayStyle:"lite",label:"checkContextualMenuIcon",icon:{iconName:"menu-dot",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1})).getContent().setStyles({"font-size":"11px","margin-right":"13px"}),Q.getContent().addClassName("checkMenuButton"),Q.getContent().id="Check",Q.getContent().onclick=Se;var c=new a({header:f.reviewPanel.checksExpanderTitle,body:D,style:"simple",customHeader:Q});c.getContent().addClassName("checksObjExpander");let u=C.addEventListener(c.elements.header,{callback:function(e){Se({event:e.data.event,objectType:"Check"})}}),m=c.destroy;if(c.destroy=(()=>{C.removeEventListener(c.elements.header,u),m.call(c)}),!h&&_){let t=new e.Element("div",{class:"checkDropPlaceholder"});Te(t,"check");let n=new l({displayStyle:"icon",icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS}}).inject(t);n.tooltipInfos=new p({title:f.reviewPanel.AddCheck,shortHelp:f.reviewPanel.AddNewCheck}),t.inject(D),n.getContent().addClassName("addCheckButton"),s.getTouchMode()&&(t.getElementsByClassName("addCheckButton")[0].setStyles({"min-height":"45px","min-width":"45px"}),t.getElementsByClassName("dropCheckObjZone")[0].setStyles({height:"45px"}),t.getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"line-height":"45px","margin-left":"15px","margin-right":"15px"})),n.getContent().addEventListener("buttonclick",function(){ve("onCheckCreationRequested")})}return"true"===t&&c._expand(),c.getContent().addEventListener("expand",function(){localStorage.setItem("DMUReviewPanel_checkExpandedFlags",!0)}),c.getContent().addEventListener("collapse",function(){localStorage.setItem("DMUReviewPanel_checkExpandedFlags",!1)}),c.getContent().getElementsByClassName("wux-controls-expander-body")[0].addClassName("checksBody"),c},this.addNewCheck=function(t){T.push({name:t.name,description:t.description,requirements:[],status:t.status,id:t.id}),he[t.id]={name:t.name,status:t.status,description:t.description,id:t.id},S.getElementsByClassName("noCheckDisplay")[0].hide();var n=new e.Element("div",{class:"flowContainer"}).inject(S),i=new o({objectData:t,editionMode:_,readOnly:h,onCheckAttributeChanged:Pe,onRequirementDrop:Ue,onRequirementRemove:ye,onExpanderSelectedCB:Ee,onExpanderUnselectCB:ke,onAttachedObjClicked:K,icons:q,highlightIcons:X,impChecksInfos:ce,type:"Check",panelType:"reviewApp"}).inject(n);ae.push({expander:i,id:t.id,index:ae.length,type:"Check"}),i.getContent().id=t.id,i.getMainDiv().setSelectedFlag(!0),i.getMainDiv().expand()},this.buildMarkups=function(t){M=new e.Element("div",{class:"markupExpanderContent"}),P=new e.Element("div",{class:"markupsExpanders"}).inject(M);var n=new e.Element("div",{text:f.reviewPanel.noMarkup,class:"noMarkupDisplay"});n.inject(P),re.length>0&&n.hide();var i=new a({header:f.reviewPanel.markupsExpanderTitle,body:M,style:"simple"});return i.getContent().addClassName("markupsObjExpander"),!h&&_&&((x=new l({label:f.reviewPanel.addMarkup,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS}}).inject(M)).getContent().addClassName("addCheckButton"),x.getContent().addEventListener("buttonclick",function(){ve("onMarkupCreationRequested")})),"true"===t&&i._expand(),i.getContent().addEventListener("expand",function(){localStorage.setItem("DMUReviewPanel_markupExpandedFlags",!0)}),i.getContent().addEventListener("collapse",function(){localStorage.setItem("DMUReviewPanel_markupExpandedFlags",!1)}),i.getContent().getElementsByClassName("wux-controls-expander-body")[0].addClassName("checksBody"),i},this.addNewMarkup=function(t){var i=M.getElementsByClassName("noMarkupDisplay");i.length&&(i[0].hide(),x&&x.getContent().setStyles({"margin-top":"0px"}));var o=new e.Element("div",{class:"markupPlaceholder"});o.inject(P);var a=new e.Element("div",{class:"markupRect",id:t.id});a.inject(o),new e.createElement("span",{class:"markupIcon wux-ui-3ds wux-ui-3ds-markup-review new-glyph"}).inject(a),new e.Element("div",{text:t.title,class:"markupName"}).inject(a);let l=C.addEventListener(a,{callback:function(e){let i={id:t.id,event:e.data.event},o=i.event.from?i.event.from[0].event:i.event,a=o.pageX?{x:o.pageX,y:o.pageY}:null;a||(a=o.screenX?{x:o.screenX,y:o.screenY}:null),!a&&o.type&&-1!==o.type.indexOf("touch")&&o.changedTouches&&o.changedTouches[0]&&((a=(o=o.changedTouches[0]).pageX?{x:o.pageX,y:o.pageY}:null)||(a=o.screenX?{x:o.screenX,y:o.screenY}:null)),a||(a={x:0,y:0}),i.position=new n.Vector2(a.x,a.y),ve("onMarkupCtxMenuRequired",i)}});re.push({title:t.title,content:t.content,id:t.id,ctxMenuToken:l})},this.removeMarkup=function(e){if(P&&W.visibleFlag&&e.dmuObject.getRepRef().getPlmID()){let t=document.getElementById(e.dmuObject.getRepRef().getPlmID()),n=re.find(t=>t.id===e.dmuObject.getRepRef().getPlmID());n&&t&&C.removeEventListener(t,n.ctxMenuToken),P.removeChild(t.getParent())}},this.buildHighlights=function(t){E=new e.Element("div",{class:"highlightExpanderContent"}),k=new e.Element("div",{class:"highlightsExpanders"}).inject(E);var n,i=new e.Element("div",{text:f.reviewPanel.noHighlight,class:"noHighlightDisplay"});for(i.inject(k),j.length&&i.hide(),n=0;n<j.length;n++){var r=new e.Element("div",{class:"flowContainer"}).inject(k),d=new o({objectData:j[n],editionMode:_,readOnly:h,onHighlightAttributeChanged:Be,onSetImpactedCheckRequested:Ie,onSetImpactedCheckCanceled:_e,onImpactedCheckRemoved:be,onHighlightExpandCB:Me,onExpanderSelectedCB:Ee,onExpanderUnselectCB:ke,onAddIssueRequested:Fe,onAddCARequested:Re,onAttachedObjClicked:K,icons:X,checkIcons:q,impChecksInfos:ce,dragParams:G,type:"Highlight",panelType:"reviewApp",contextType:me}).inject(r);ae.push({expander:d,id:j[n].id,index:ae.length,type:"Highlight"}),d.getContent().id=j[n].id}(ee=new l({displayStyle:"lite",label:"highlightContextualMenuIcon",icon:{iconName:"menu-dot",fontIconFamily:WUXManagedFontIcons.Font3DS},showLabelFlag:!1})).getContent().setStyles({"font-size":"11px","margin-right":"13px"}),ee.getContent().addClassName("highlightMenuButton"),ee.getContent().onclick=Se,ee.getContent().id="Highlight",($=new a({header:f.reviewPanel.highlightsExpanderTitle,body:E,style:"simple",customHeader:ee})).getContent().addClassName("highlightsObjExpander");let c=C.addEventListener($.elements.header,{callback:function(e){Se({event:e.data.event,objectType:"Highlight"})}}),u=$.destroy;$.destroy=(()=>{C.removeEventListener($.elements.header,c),u.call($)}),!h&&_&&((w=new l({displayStyle:"icon",label:f.reviewPanel.addHighlight,icon:{iconName:"plus",fontIconFamily:WUXManagedFontIcons.font3DS}}).inject(E)).getContent().addClassName("addHighlightButton"),s.getTouchMode()&&(w.getContent().setStyles({"min-width":"0px",width:"190px","min-height":"45px"}),w.getContent().getElementsByClassName("wux-button-icon-placeholder")[0].setStyles({"margin-left":"15px","margin-right":"15px"})),j.length&&w&&w.getContent().setStyles({"margin-top":"13px"}),w.getContent().addEventListener("buttonclick",function(){ve("onHighlightCreationRequested")})),"true"===t&&$._expand(),$.getContent().addEventListener("expand",function(){localStorage.setItem("DMUReviewPanel_highlightExpandedFlags",!0)}),$.getContent().addEventListener("collapse",function(){localStorage.setItem("DMUReviewPanel_highlightExpandedFlags",!1)});var m=$.getContent().getElementsByClassName("wux-controls-expander-body")[0];return m.addClassName("highlightsBody"),m.setStyles({overflow:"hidden"}),$},this.addNewHighlight=function(t){j.push({name:t.name,id:t.id,description:t.description,issues:t.issues,changeAction:t.changeAction,rating:t.rating,associatedCheck:t.associatedCheck?t.associatedCheck:[],type:"DMUValidationExposedPresentation"}),ue[t.id]={name:t.name,rating:t.rating,description:t.description,id:t.id,issues:[],changeAction:[]},k.getElementsByClassName("noHighlightDisplay")[0].hide(),w&&w.getContent().setStyles({"margin-top":"13px"});var n=new e.Element("div",{class:"flowContainer"}).inject(k),i=new o({objectData:t,editionMode:_,normalCommentRepresentation:t.normalComment?t.normalComment:void 0,lightCommentRepresentation:t.lightComment?t.lightComment:void 0,readOnly:h,onHighlightAttributeChanged:Be,onSetImpactedCheckRequested:Ie,onSetImpactedCheckCanceled:_e,onImpactedCheckRemoved:be,onHighlightExpandCB:Me,onExpanderSelectedCB:Ee,onExpanderUnselectCB:ke,onAddIssueRequested:Fe,onAddCARequested:Re,onAttachedObjClicked:K,icons:X,checkIcons:q,impChecksInfos:ce,dragParams:G,type:"Highlight",panelType:"reviewApp",contextType:me}).inject(n);ae.push({expander:i,id:t.id,index:ae.length,type:"Highlight"}),i.getContent().id=t.id,i.getMainDiv().setSelectedFlag(!0),i.getMainDiv().expand()},this.buildMaturityStatus=function(t,n){if(t.maturity&&t.status){var i=e.createElement("div",{class:"rps"}).inject(n.getContent());i.setStyles({display:"flex"});var o=e.createElement("div",{class:"rp-review-prop-sect"}).inject(i);o.setStyles({"min-width":"234px",display:"flex","text-overflow":"ellipsis","margin-left":"3px","margin-right":"3px","margin-top":"6px","align- items":"center"});var a,l=e.createElement("div",{class:"rp-mat-section"}).inject(o);l.setStyles({width:"auto",overflow:"hidden","padding-top":"2px","padding-bottom":"2px",display:"flex",position:"relative"}),e.createElement("p",{class:"rp-ms-text"}).inject(l).setText(f.reviewPanel.maturity+":"),a=h?"rp-ms-cell-notclickable":"rp-ms-cell-clickable";var s=e.createElement("div",{class:a}).inject(l);(ne=e.createElement("p",{class:"rp-ms-box"}).inject(s)).addClassName("rp-maturity-"+t.maturity.toString()),f.reviewPanel&&f.reviewPanel.maturityValue&&ne.setText(f.reviewPanel.maturityValue[t.maturity]);var r=e.createElement("p",{class:"rp-ms-separator"}).inject(o);r.setStyles({width:"auto",position:"relative","padding-left":"5px","padding-right":"3px","padding-top":"2px","padding-bottom":"2px",margin:"0"}),r.setText("|");var d=e.createElement("div",{class:"rp-status-section"}).inject(o);d.setStyles({width:"auto",overflow:"hidden","padding-top":"2px","padding-bottom":"2px",display:"flex",position:"relative"}),e.createElement("p",{class:"rp-ms-text"}).inject(d).setText(f.reviewPanel.status+":");var c=e.createElement("div",{class:a}).inject(d);(te=e.createElement("p",{class:"rp-ms-box"}).inject(c)).addClassName("rp-status-"+t.status.toString()),f.reviewPanel&&f.reviewPanel.statusValue&&te.setText(f.reviewPanel.statusValue[t.status]);var u=e.createElement("div",{class:"rp-status-warning-section"}).inject(i);u.setStyles({width:"auto",display:"flex",position:"relative"}),ie=e.createElement("p",{class:"wux-button-icon-fi wux-ui-genereatedicon-fi wux-ui-fa wux-ui-fa-warning wux-ui-fa-lg rp-ms-text"}).inject(u),ne.onclick=function(){h||ve("onReviewMaturityChangeRequest")},te.onclick=function(){h||ve("onReviewStatusChangeRequest")}}},this.updateMaturityStatus=function(e){e.status&&te.classList.forEach(function(t){"rp-ms-box"!==t&&(te.removeClassName(t),te.addClassName("rp-status-"+e.status.toString()),f.reviewPanel&&f.reviewPanel.statusValue&&te.setText(f.reviewPanel.statusValue[e.status]))}),e.maturity&&ne.classList.forEach(function(t){"rp-ms-box"!==t&&(ne.removeClassName(t),ne.addClassName("rp-maturity-"+e.maturity.toString()),f.reviewPanel&&f.reviewPanel.maturityValue&&ne.setText(f.reviewPanel.maturityValue[e.maturity]))})},this.updateValidationStatusWarning=function(e){ie&&("noWarning"===e?ie.setStyle("display","none"):"warningProgress"===e?ie.setStyles({color:"rgb(119,121,124",display:"block"}):"warningFailed"===e?ie.setStyles({color:"rgb(232,123,0)",display:"block"}):"warningPassed"===e&&ie.setStyles({color:"rgb(232,123,0)",display:"block"}),f.reviewPanel&&f.reviewPanel.valStatusWarning&&(ie.title=f.reviewPanel.valStatusWarning[e]))}}})});