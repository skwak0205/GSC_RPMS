define("DS/ENOXViewFilter/js/ENOXViewFilter",["UWA/Controls/Abstract","UWA/Class/View","DS/Core/ModelEvents","DS/UIKIT/Input/Toggle","DS/UIKIT/DropdownMenu","DS/UIKIT/Autocomplete","DS/UIKIT/Scroller","DS/UIKIT/Badge","DS/ResizeSensor/js/ResizeSensor","UWA/Class/Events","i18n!DS/ENOXViewFilter/assets/nls/ENOXViewFilter","css!DS/ENOXViewFilter/css/ENOXViewFilter.css"],function(e,t,a,i,s,n,r,c,h,o,l){"use strict";return e.extend({init:function(e){var t=this;this.options=e?UWA.clone(e,!1):{};var i={enableCache:!1,allowMultipleSearch:!1,parentContainer:document.body};UWA.merge(this.options,i),this.data={searchValue:""},this.options.enableCache&&(this.data.savedAttributes=[]),this.modelEvent=new a,this.modelEvent.subscribe({event:"onSaveInCache"},function(e){if("array"==UWA.typeOf(e.searchValue))for(var a,i=0;i<e.searchValue.length;i++)t.isSaved(e,i)||(a||(a=t.getAttributeContainer(e.attrObj)),t.saveSearch(e.searchValue[i],e.attrObj,a));else t.isSaved(e)||e.searchValue.length>0&&t.saveSearch(e.searchValue,e.attrObj,null);t.publishSearch()}),UWA.is(this.options.onSearch,"function")&&t.modelEvent.subscribe({event:"OnSearchValueChange"},t.options.onSearch),this._parent(),this.render()},render:function(){var e=this;this.container=UWA.createElement("div",{class:"searchContainer"}).inject(this.options.parentContainer),this.defaultContainer=UWA.createElement("div",{class:"defaultContainer"}).inject(this.container),this.options.typeFilter&&(this.checksContainer=UWA.createElement("div",{class:"checksContainer"}).inject(this.container),this.createCheckbox()),this.textboxContainer=UWA.createElement("div",{class:"textboxContainer"}).inject(this.defaultContainer),this.createSearchBox(),this.options.attributeFilter&&(this.attributeContainer=UWA.createElement("span",{class:"fonticon fonticon-xx fonticon-menu attributeContainer"}).inject(this.defaultContainer),this.createAttributeFilter()),this.savedAttrContainer=UWA.createElement("div",{class:"selectedAttrContainer",styles:{"min-height":"20px","max-height":"75px",padding:"2px","margin-top":"5px",height:"60px"}}).inject(this.textboxContainer),this.savedAttrContainer.hide(),this.selectedAttrContainer=UWA.createElement("div",{class:"selectedAttrContainer"}),this.savedAttrContainer.setContent(this.selectedAttrContainer),this.savedSearchScroll=new r({element:this.savedAttrContainer}).inject(this.textboxContainer),this.resizeSearch(),new h(this.container,function(){e.resizeSearch()})},resizeSearch:function(){var e=this.attributeContainer?this.attributeContainer.offsetWidth:0,t=this.checksContainer?this.checksContainer.offsetWidth:0;if(this.container.getParent()){var a=this.container.getParent().offsetWidth-t,i=a-e;a>0&&(this.defaultContainer.setStyle("width",a+"px"),this.textboxContainer.setStyle("width",i+"px"))}},createSearchBox:function(){var e=this,t="";this.currentSearchItems=[],this.searchTextBox=new n({placeholder:l.search,noResultsMessage:"",events:{onKeyUp:function(i){"Enter"==i.key?e.publishSaveInCache():i.target.value.length>0?e.addInput(i,a):e.removeInput(i,t,a),t=i.target.value.trim(),e.publishSearch()}}}).inject(this.textboxContainer),this.searchTextBox.elements.inputContainer.addClassName("search-input");var a=this.searchTextBox.elements.clear.addEvent("click",function(t){e.resetInput(this)});this.searchTextBox.elements.clear.addClassName("clearSpan"),this.searchClearButton=a},setText:function(e){if("string"===UWA.typeOf(e))this.data.searchValue="",(a=document.createEvent("KeyboardEvent")).initEvent("keyup",!0,!0),this.searchTextBox.elements.input.value=e,this.searchTextBox.elements.input.dispatchEvent(a);else if("array"===UWA.typeOf(e)){this.data.searchValue=[];for(var t=0;t<e.length;t++){this.searchTextBox.elements.input.value=e[t]+";";var a=new KeyboardEvent("keyup",{key:";"});this.searchTextBox.elements.input.dispatchEvent(a)}}},addInput:function(e,t){var a=this,i=e.target.value.trim();if(t.show(),this.data.searchValue=i,this.options.allowMultipleSearch){var s=this.getToken(i);if(this.data.searchValue=JSON.parse(JSON.stringify(this.currentSearchItems)),s||this.data.searchValue.push(i),";"==e.key&&";"!==s&&""!==s){e.currentTarget.addClassName("search-autocomplete-input"),this.searchTextBox.resetInput();new c({content:s,className:"default search-badge",selectable:!0,closable:!0,events:{onClose:function(e,t){a.removeToken(e.currentTarget),t.destroy(),a.publishSearch()}}}).inject(e.currentTarget.getParent());t.hide(),this.currentPosition++,this.getSearchBoxPlaceholder()}}},removeInput:function(e,t,a){if(!this.options.allowMultipleSearch||0!=t.length||""==this.data.searchValue&&0==this.data.searchValue.length)this.resetInput(a);else if("Backspace"==e.key){var i=e.target.parentElement.childNodes;this.removeToken(i[i.length-1]),i[i.length-1].remove()}},getToken:function(e){var t=[];return e.contains(";")&&""!==(t=e.split(";"))[0]&&";"!==t[0]&&this.currentSearchItems.push(t[0]),t[0]},removeToken:function(e){var t;t=e.hasClassName("fonticon-cancel")?e.previousSibling.outerText:e.getText();var a=this.currentSearchItems.indexOf(t);this.currentSearchItems.splice(a,1),this.data.searchValue.splice(a,1)},reset:function(){this.searchTextBox.resetInput();var e=this.textboxContainer.getElementsByClassName("search-badge"),t=e.length;if(e)for(var a=0;a<t;a++)e[0].remove();this.getSearchBoxPlaceholder(),this.data.searchValue="",this.currentSearchItems=[],this.publishSearch()},resetInput:function(e){0==this.currentSearchItems.length?this.data.searchValue="":this.data.searchValue=JSON.parse(JSON.stringify(this.currentSearchItems)),this.searchTextBox.resetInput(),e.hide(),this.searchClearButton.hide(),this.getSearchBoxPlaceholder(),this.publishSearch()},createAttributeFilter:function(){var e=this;this.attrDD=new s({target:e.attributeContainer,items:[],events:{onClick:function(t,a){e.getSearchBoxPlaceholder(),e.data.searchAttribute=a.id,e.publishSearch()}}}),this.options.attributeFilter.forEach(function(t){e.attrDD.addItem({id:t.id,selectable:!0,selected:!!t.selected&&t.selected,text:t.text})}),this.data.searchAttribute=this.attrDD.getSelectedItems()?this.attrDD.getSelectedItems()[0].id:"",this.getSearchBoxPlaceholder()},getSearchBoxPlaceholder:function(){var e,t=l.search;this.attrDD&&(e=this.attrDD.getSelectedItems()?this.attrDD.getSelectedItems()[0]:void 0),e&&e.text&&(t=t+" ("+e.text+")"),this.searchTextBox.elements.input.placeholder=t},publishSearch:function(){this.modelEvent.publish({event:"OnSearchValueChange",data:this.data,context:this})},createCheckbox:function(){var e=this.options.typeFilter,t=[],a=this;this.data.typeFilter={},this.checkBoxActualIdInputIdMap={};for(var s=0;s<e.length;s++)t[s]=new i({type:"checkbox",className:"primary toggle-viewSearch",label:e[s].text,checked:!!e[s].selected&&e[s].selected,events:{onClick:function(e){var t=a.checkBoxActualIdInputIdMap[e.target.id];a.data.typeFilter[t]=e.target.checked,a.publishSearch()}}}).inject(this.checksContainer),this.checkBoxActualIdInputIdMap[t[s].options.id]=e[s].id,this.data.typeFilter[e[s].id]=t[s].options.checked;return t},publishSaveInCache:function(){if(this.options.enableCache){var e={id:""};this.attrDD&&(e=this.attrDD.getSelectedItems()?this.attrDD.getSelectedItems()[0]:""),this.modelEvent.publish({event:"onSaveInCache",data:{searchValue:this.data.searchValue,searchAttribute:e.id,attrObj:e}})}},isSaved:function(e,t){for(var a=this.data.savedAttributes,i=e.searchAttribute,s=e.searchValue[t],n=0;n<a.length;n++)if(a[n].attribute==i)if(this.options.allowMultipleSearch){if(-1!=a[n].value.indexOf(s.toLowerCase()))return!0}else if(a[n].value.toString().toLowerCase()==s.toLowerCase())return!0;return!1},getAttributeContainer:function(e){var t=this,a=UWA.createElement("div",{class:"itemContainer"}).inject(this.selectedAttrContainer),i=UWA.createElement("div",{class:"itemContainer"}).inject(a),s=UWA.createElement("div",{id:"cid"+(this.data.savedAttributes.length+1),class:"search-saved-container"}).inject(i);if(null!=e.text)UWA.createElement("div",{text:"("+e.text+")",class:"search-saved-text"}).inject(i);return this.data.savedAttributes.push({value:[],attribute:e.id}),UWA.createElement("span",{class:"fonticon fonticon-xx fonticon-cancel clearSpan clearSelectionSpan"}).inject(a).addEvents({click:function(e){var a=Array.prototype.indexOf.call(t.selectedAttrContainer.childNodes,s.parentElement.parentElement);t.data.savedAttributes.splice(a,1),e.currentTarget.parentElement.remove(),t.setScrollbarHeight(),t.publishSearch()}}),s},saveSearch:function(e,t,a){var i=this;if(this.options.allowMultipleSearch){this.data.savedAttributes[this.data.savedAttributes.length-1].value.push(e);new c({content:e,className:"default search-badge saved-badge",selectable:!0,closable:!0,events:{onClose:function(e,t){if(i.removeSavedSearch(t,a),0==a.children.length){var s=Array.prototype.indexOf.call(i.selectedAttrContainer.getChildren(),a.parentElement.parentElement);i.data.savedAttributes.splice(s,1),a.getParent().parentElement.remove(),i.setScrollbarHeight()}i.publishSearch()}}}).inject(a);this.savedSearchScroll.scrollToElement(a)}else{e=e+(t.text?" ("+t.text+")":"");var s=UWA.createElement("div",{class:"itemContainer"}).inject(this.selectedAttrContainer);UWA.createElement("span",{text:e,class:"itemSelectionSpan",styles:{display:"flex","margin-top":"5px","margin-left":"5px",width:"100%",margin:"2px !important","flex-wrap":"nowrap","flex-shrink":"inherit","text-align":"left"}}).inject(s),UWA.createElement("span",{class:"fonticon fonticon-xx fonticon-cancel clearSpan clearSelectionSpan"}).inject(s);this.savedSearchScroll.scrollToElement(s),t&&t.id&&""!=t.id?this.data.savedAttributes.push({value:e,attribute:t.id}):this.data.savedAttributes.push({value:e}),this.selectedAttrContainer.getChildren().forEach(function(e){e.lastChild.addEvents({click:function(e){i.removeSavedSearch(e.currentTarget.parentElement,i.selectedAttrContainer),i.publishSearch()}})})}this.savedAttrContainer.show(),this.setScrollbarHeight()},removeSavedSearch:function(e,t){for(var a=t.getChildren(),i=0;i<a.length;i++){if((e.options?e.options.content:e.getText())==a[i].getText())if(this.options.allowMultipleSearch){var s=Array.prototype.indexOf.call(this.selectedAttrContainer.childNodes,t.parentElement.parentElement);this.data.savedAttributes[s].value.splice(i,1)}else this.data.savedAttributes.splice(i,1)}e.remove(),this.setScrollbarHeight()},setScrollbarHeight:function(){var e=30*this.data.savedAttributes.length+"px";this.savedAttrContainer.setStyles({height:e}),"0px"==e&&this.savedAttrContainer.hide()}})}),define("DS/ENOXViewFilter/js/ENOXBasicFilter",["DS/Core/ModelEvents","DS/Handlebars/Handlebars","DS/UIKIT/Autocomplete","text!DS/ENOXViewFilter/html/ENOXBasicFilter.html","i18n!DS/ENOXViewFilter/assets/nls/ENOXViewFilter","css!DS/ENOXViewFilter/css/ENOXBasicFilter.css","css!DS/UIKIT/UIKIT.css"],function(e,t,a,i,s,n,r){"use strict";var c=t.compile(i),h=function(e){this._init(e)};return h.prototype._init=function(t){this._options=t?UWA.clone(t,!1):{};UWA.merge(this._options,{multiselect:!1,enableCache:!0}),this._modelEvents=t.modelEvents?t.modelEvents:new e,this.data={searchValue:[]},this._initDivs(),this._subscribeEvents(),this._render()},h.prototype._initDivs=function(){this._container=document.createElement("div"),this._container.innerHTML=c(this._options),this._container=this._container.querySelector(".enox-basic-filter-container"),this._autocomplteWrapper=this._container.querySelector(".enox-basic-filter-autocomplete-wrapper")},h.prototype._subscribeEvents=function(){var e=this;this._modelEvents.subscribe({event:"enox-basic-filter-reset-search"},function(){e._resetSearch()})},h.prototype.inject=function(e){e.appendChild(this._container)},h.prototype._render=function(){var e=this;if(this.searchTextBox=new a({placeholder:s.search,noResultsMessage:"",allowFreeInput:!0,showSuggestsOnFocus:this._options.enableCache,events:{onKeyUp:function(t){var a,i=t.target.value;e._nextKeyToProcess=!0,i.length%2==0&&(a=!0),e._debounce(function(){var a=t.target.value;e._nextKeyToProcess=!1,e.data.searchValue=[],a.length>0&&(e.data.searchValue.push(a),"Enter"==t.key&&e._options.enableCache&&e._updateDataset(a)),e._modelEvents.publish({event:"enox-basic-filter-search-value",data:e.data}),console.log(e.data)},200,a)}}}).inject(this._autocomplteWrapper),this.searchTextBox.elements.inputContainer.addClassName("enox-basic-filter-search-input"),this.searchTextBox.elements.clear.title=s.clear,!this._options.multiselect)this.searchTextBox.elements.clear.addEvent("click",function(t){e._resetSearch(!0)});this.searchTextBox.addDataset({name:"filter-dataset",items:[]})},h.prototype._resetSearch=function(e){this.data.searchValue&&this.data.searchValue.length>0&&(this.data.searchValue=[],this.searchTextBox.reset(e),this._modelEvents.publish({event:"enox-basic-filter-search-value",data:this.data}))},h.prototype.setText=function(e){if("string"===UWA.typeOf(e))this.data.searchValue="",(a=document.createEvent("KeyboardEvent")).initEvent("keyup",!0,!0),this.searchTextBox.elements.input.value=e,this.searchTextBox.elements.input.dispatchEvent(a);else if("array"===UWA.typeOf(e)){this.data.searchValue=[];for(var t=0;t<e.length;t++){this.searchTextBox.elements.input.value=e[t]+";";var a=new KeyboardEvent("keyup",{key:";"});this.searchTextBox.elements.input.dispatchEvent(a)}}},h.prototype._debounce=function(e,t,a){var i,s=this,n=a&&!i;clearTimeout(i),setTimeout(function(){i=null,!a&&s._nextKeyToProcess&&e()},t),n&&e()},h.prototype._updateDataset=function(e){var t=this.searchTextBox.getDataset("filter-dataset");this.searchTextBox.getItemByLabel(e)||this.searchTextBox.addItems({value:e},t)},h});