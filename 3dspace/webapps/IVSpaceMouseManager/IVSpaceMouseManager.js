!function(){"use strict";var e=[{name:"SpaceMouseLibrary",path:"DS/VENWebSpaceMouseSDK/",file:"3dconnexion.min"}];e.forEach(function(e){"undefined"!=typeof widget&&void 0!==widget.uwaUrl||(e.path=e.path.replace(/^DS\//,"")),e.path=require.toUrl(e.path).replace(/\?(.*)/,"")});var t=e.reduce(function(e,t){return e[t.name]=t.path+t.file,e},{});require.config({paths:t,shim:{SpaceMouseLibrary:{exports:"SpaceMouseLibrary"}}})}(),define("DS/IVSpaceMouseManager/SpaceMouseEventHandler",["UWA/Core","UWA/Class","DS/VisuEvents/EventsManager","DS/Visualization/TrackballControls","DS/Visualization/ThreeJS_DS","DS/Visualization/Viewpoint","DS/Visualization/SceneGraphFactory","DS/Selection/HSOManager","DS/Mesh/Mesh","DS/SceneGraphNodes/BillBoardNode3D","DS/WebappsUtils/WebappsUtils","SpaceMouseLibrary"],function(e,t,i,o,n,a,r,s,c,u,l){"use strict";var h=_3Dconnexion,d=null,p=t.singleton({create:function(e){this.appName=e.appName,this.frameWindow=e.frameWindow,this.immersiveFrame=e.immersiveFrame,this.viewer=e.viewer,this.viewPoint=e.viewer.currentViewpoint,this.window=window,this.control=this.viewPoint.control,this.name=e.name,this.cmdNodes={};var t=0;h&&(this.spacemouse=new h(this),t=this.spacemouse.connect()),t||console.log("Cannot connect to 3Dconnexion NL-Proxy"),d=this},onMouseMove:function(e){var t=e.gesture.getEvents();if(null!==t){var i=t[0].getCurrentPosition(d.viewer.canvas);this.mousePosition=d.viewer.getMousePosition(i)}},onConnect:function(){this.look={origin:new n.Vector3,direction:new n.Vector3,aperture:.01,selection:!1},this.pivotNode=null,this.createPivotNode(),this.alwaysOnMouseMoveCb=this.alwaysOnMouseMove.bind(this),void 0===i._isInit&&i.init();var e=this.viewer.canvas;i.addEvent(e,"onMouseMove",this.onMouseMove),this.spacemouse.create3dmouse(this.window,this.appName)},on3dmouseCreated:function(){var e=new h.ActionTree,t=new h.ImageCache,i=this,o=e.push(new h.ActionSet("Default","Default commands"));this.getApplicationCommands(o,t),t.onload=function(){i.spacemouse.update3dcontroller({images:t.images})},this.spacemouse.update3dcontroller({commands:{activeSet:"Default",tree:e}}),this.spacemouse.focus()},onDisconnect:function(e){0},getCoordinateSystem:function(){return[0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1]},getConstructionPlane:function(){var e=new n.Vector3(0,0,0);e.applyMatrix4(this.control.camera.matrixWorld);var t=new n.Vector3(0,1,0);this.control.camera.matrixWorld.extractBasis(new n.Vector3,t,new n.Vector3);var i=t.dot(e);return[t.x,t.y,t.z,-i]},getFov:function(){var e=2*Math.atan(Math.tan2(this.control.camera.fov*Math.PI,360)*Math.sqrt(1+this.control.camera.aspect*this.control.camera.aspect));return e},getFrontView:function(){return[0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1]},getLookAt:function(){var e=new n.Ray(this.look.origin,this.look.direction),t=this.viewer.internalSceneGraph.getUserRoot(),i=this.viewer.castRay(e,t);if(i.length>0)for(var o=0,a=i.length;o<a;++o)if(!0===i[o].object.visible){if(i[o].pathElement.getLastElement(!0)===this.rectNode)continue;return i[o].point.toArray()}return null},getModelExtents:function(){var e=this.viewer.getSceneBoundingBox("visibleSpace");return e&&!e.empty()?[e.min.x,e.min.y,e.min.z,e.max.x,e.max.y,e.max.z]:[0,0,0,0,0,0]},getPerspective:function(){return this.viewPoint.getProjectionType()===a.PERSPECTIVE},getSelectionEmpty:function(){return!(s.get().length>0)},getSelectionExtents:function(){var e=s.get();if(e.length>0){var t=new n.Box3;return e.forEach(function(e){var i=e.pathElement.getBoundingSphere();i&&t.union(i.getBoundingBox())}),[t.min.x,t.min.y,t.min.z,t.max.x,t.max.y,t.max.z]}return null},getPivotPosition:function(){var e=this.viewer.getSceneBoundingBox("visibleSpace");return e?e.center().toArray():NULL},setPivotPosition:function(e){if(this.pivotPosition=new n.Vector3(e[0],e[1],e[2]),this.pivotNode){var t=new n.Matrix4;t.setPosition(this.pivotPosition),this.pivotNode.setMatrix(t),this.pivotNode.cbChange(),this.viewer.render()}},setPivotVisible:function(e){this.visible=e,this.pivotNode&&(e?(this.pivotPosition&&this.viewer.getRootNode().addChild(this.pivotNode),this.viewer.render()):(this.viewer.getRootNode().removeChild(this.pivotNode),this.viewer.render()))},getPointerPosition:function(){return this.mousePosition.clone().toArray()},getViewRotatable:function(){return!0},getViewExtents:function(){return[this.control.camera.left,this.control.camera.bottom,-this.control.camera.far,this.control.camera.right,this.control.camera.top,-this.control.camera.near]},getViewFrustum:function(){var e=Math.tan(this.control.camera.fov*Math.PI/360),t=-this.control.camera.near*e,i=t*this.control.camera.aspect;return[i,-i,t,-t,this.control.camera.near,this.control.camera.far]},getViewMatrix:function(){var e=[];return this.control.camera.matrixWorld.flattenToArray(e),e},setLookFrom:function(e){this.look.origin.set(e[0],e[1],e[2])},setLookDirection:function(e){this.look.direction.set(e[0],e[1],e[2])},setLookAperture:function(e){this.look.aperture=e},setSelectionOnly:function(e){this.look.selection=e},setViewExtents:function(e){var t=e[4]-e[1];this.distanceToTarget=t/(2*Math.tan(Math.PI*this.control.camera.fov/360)),this.viewPoint.moveTo({distanceToTarget:this.distanceToTarget})},setViewMatrix:function(e){var t=new n.Matrix4;t.setFromArray(e);var i=this.control.camera.quaternion.clone(),o=this.control.camera.position.clone(),a=new n.Vector3;t.decompose(o,i,a),this.viewPoint.moveTo({eyePosition:o,orientation:i})},setFov:function(e){this.control.camera.fov=180*e/Math.PI,this.control.update()},onStartMotion:function(){},onStopMotion:function(){},alwaysOnMouseMove:function(e){var t=e.gesture.getEvents();if(null!==t){var i=t[0].getCurrentPosition(this.viewer.canvas);this.mousePosition=this.viewer.getMousePosition(i)}},createPivotNode:function(){if(this.viewer){this.pivotNode=r.createFixedSizeNode();var e=this.getPivotIconNode();if(e){var t={viewpoint:this.viewPoint,position:new n.Vector3,name:"SpaceMouse Center",type:"Spherical"};this.rectNode=e;var i=new u(t);i.addChild(e),i.setMatrix(new n.Matrix4),i.setPickable(c.NODRAWHL),i.setNoZ(!0),i.notAllowedInPathElement=!0,this.pivotNode.addChild(i),this.pivotNode.notAllowedInPathElement=!0}}},getPivotIconNode:function(){var e=n.ImageUtils.loadTexture(l.getWebappsAssetUrl("IVSpaceMouseManager","icons/3dx_pivot.png"));if(e){e.flipY=!1;var t=new n.MeshPhongMaterial({map:e,side:n.DoubleSide,alphaTest:.05,transparent:!0});t.force=!0;var i={width:10,height:10,fill:!0,fillColor:null,noEdge:!0,material:t},o=r.createRectangleNode(i);return o.setMatrix(new n.Matrix4),o.setShadow(!1),o.setFrustumCulled(!1),o.setPickable(c.NODRAWHL),o.setNoZ(!0),o.excludeFromCSO(!0),o.excludeFromHighlight(!0,!0),o.notAllowedInPathElement=!0,o.exludeFromBounding(!0),o}return null},getApplicationCommands:function(e,t){var i=this;if(appConfig&&appConfig.UIModel){var o={};appConfig.UIModel.categories&&appConfig.UIModel.categories.forEach(function(t){var i=new h.Category(t.identifier,t.internationalization.title);i&&(o[t.identifier]=i,e.push(i))});var n=[];appConfig.UIModel.handlerList&&(n=appConfig.UIModel.handlerList);var a=function(e){var t=n.find(function(t){return t.identifier===e});return t?o[t.category]:void 0};appConfig.handlers&&(appConfig.handlers.default&&appConfig.handlers.default.forEach(function(e){var o=a(e.identifier);o&&i.createCommandNode(o,t,e.identifier,e.internationalization.title,e.internationalization.shortHelp,e.icon.uri,!1,void 0)}),appConfig.handlers.check&&appConfig.handlers.check.forEach(function(e){var o=a(e.identifier);o&&i.createCommandNode(o,t,e.identifier,e.check.internationalization.title,e.check.internationalization.shortHelp,e.check.icon.uri,!0)}),appConfig.radioGroup&&appConfig.radioGroup.items.forEach(function(e){var o=e.identifier,n=a(o);n&&e.items.forEach(function(e){i.createCommandNode(n,t,e.identifier,e.check.internationalization.title,e.check.internationalization.shortHelp,e.check.icon.uri,!0,o)})}))}},setActiveCommand:function(e){if(e){var t=this.cmdNodes[e];if(t&&t.check)if(t.radioGroup);else SWXWAfrUtils.getCheckState(e)}},createCommandNode:function(e,t,i,o,n,a,r,s){var c=new h.Action(i,o,n);if(c.check=r,c.radioGroup=s,e.push(c),this.cmdNodes[i]=c,a){var u=a.indexOf("/"),d=l.getWebappsAssetUrl(a.substring(0,u),"icons"+a.substring(u));t.push(this.fromURL(d,i))}},fromURL:function(t,i){var o=new h.ImageItem;Object.defineProperties(o,{id:{value:i||"",writable:!0,enumerable:!0},type:{value:h.SiImageType_t.e_image,enumerable:!0},index:{value:0,writable:!0,enumerable:!0},buffer:{value:null,writable:!0},data:{get:function(){return this.buffer},set:function(e){o.buffer=e,o.onload()},enumerable:!0},status:{value:100,writable:!0},onload:{value:function(){},writable:!0}});var n={timeout:15e3,method:"GET",type:"arraybuffer",onComplete:function(e){e&&(o.status=200,o.data=h.ImageItem.base64FromArrayBuffer(e))}};return e.Data.request(t,n),o}});return e.namespace("DS/IVSpaceMouseManager/SpaceMouseEventHandler",p)}),define("DS/IVSpaceMouseManager/SpaceMouseManager",["UWA/Core","UWA/Class","DS/IVSpaceMouseManager/SpaceMouseEventHandler"],function(e,t,i){"use strict";var o=t.singleton({create:function(){},attachSpaceMouseToViewer:function(e){try{i.create(e)}catch(e){console.warn("Space Mouse Failed to Attach")}}});return e.namespace("IVSpaceMouseManager/SpaceMouseManager",o)});