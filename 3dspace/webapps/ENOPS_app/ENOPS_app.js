/*!  COPYRIGHT DASSAULT SYSTEMES 2015   */
function ENOPS_app(e){"use strict";var t=!0;function i(e){return"string"==typeof e?JSON.parse(e):null}var n=function(e){return UWA.is(e,"string")&&(e=e.replace(/"label":"((\\"|[^"])*)",/gi,"")),e},o=function(e){var t=!1;return UWA.is(e,"boolean")?t=e:UWA.is(e,"string")&&(t="true"===e.toLowerCase()),t},s={v1:{ap_custo:"ap_custo",ap_custoParams:"ap_custoParams",ap_struct:"xsceneStoredObjects"}},a={widget:null,pad_app:null,setting_names:s.v1,xnav_component_opts:{x3dAppId:null,widget:null,active_view:null,action_bar_opts:null,configuration:{toolbarActivated:!1,toolbarOpts:{definition:"ENOPS_app/assets/configuration/pseToolbar.json"},dynamicCtxActivated:!1,ctxMenuOpts:{definition:"ENOPS_app/assets/configuration/pseCtxMenu.json"},commands:{definition:"ENOPS_app/assets/configuration/pseCmds.json"}},layout:{title_update:!0,view_customization:null,store_roots_in_pref:!0,slidder:!1,root_panel:!0,padshell:!1,withWelcomePanel:!0},settings:null,insert_replace:!0,authorize_setStructure:!0,authorizeChangeControl:!1,amd_custo:{}},configuration:void 0,subscriptions:[],init:function(e){this.pcsPrefix=widget.id+"_"+widget.title,window.top.performance.mark(this.pcsPrefix+"_init"),window.top.performance.measure(this.pcsPrefix+"_call_init","enops_app_load_html",this.pcsPrefix+"_init"),e.odt_settings&&(this._odt_settings=e.odt_settings),this.flags={},this.widget=e.widget,this.configuration=e.configuration,this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this))},onRefresh:function(){let e=this;this.flags.onPlatformIdChange?(delete this.flags.onPlatformIdChange,this._waitingRefresh&&this._waitingRefresh.then(function(t){t&&t.skipRefresh||e.pad_app.refresh()})):this.pad_app.refresh()},onLoad:function(){var e=this;window.top.performance.mark(this.pcsPrefix+"_onload"),window.top.performance.measure(this.pcsPrefix+"_call_onload",this.pcsPrefix+"_init",this.pcsPrefix+"_onload"),this.widget.setValue("tenantAware",!0),require(["DS/PADUtils/Configuration","DS/PADServices/utils/GlobalUtils","text!DS/ENOPS_app/assets/ProductStructureConf.json","css!DS/ENOPS_app/ENOPS_app.css"],function(i,a,r,l){var d=JSON.parse(r);i.mergeConfig(d),e.configuration&&i.mergeConfig(e.configuration),t=i.getConfig("activateWP"),require(["DS/PADUtils/PADWSAccess","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/PADServices/utils/AttributesMgt","UWA/Core","DS/PADUtils/PADSession","DS/PADServices/utils/WaitingPromise","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/ZipUtils","DS/WebUAUtils/WebUAUtils","text!DS/ENOPS_app/assets/enops_settings.json"],function(r,l,c,u,p,g,m,v,f,h,_,P){if(window.top.performance.mark(e.pcsPrefix+"_require_infra_padutils"),window.top.performance.measure(e.pcsPrefix+"_require_infra",e.pcsPrefix+"_onload",e.pcsPrefix+"_require_infra_padutils"),!e.widget.getValue("x3dSharedId")&&!e.widget.getValue("x3dAppId")){e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOPAD_appId"})}_.setAppid("ENOPSTE_AP");var w=JSON.parse(P);e._odt_settings&&(w.padsettings=UWA.extend(w.padsettings,e._odt_settings,!0)),l.setApp(w.padsettings,"enops",!0),c.addSharedSettings(e.widget,["x3dPlatformId","showWelcomePanel","autoreload","pad_security_ctx","useIndexAccleration","synthesisModeOnInstance"]),e.widget.mergePreferences(l.getWidgetPreferences()),e.widget.addEvent("endEdit",l.updateWidgetPreferences.bind(l)),e.widget.addEvent("onPlatformIdChange",function(t){e.flags.onPlatformIdChange=!0,e._waitingRefresh=new v}),f.subscribe({event:"ENXApp/tenantDialog/complete"},function(t){e._waitingRefresh&&e._waitingRefresh.resolve(t)}),e.widget.addEvent("onChangeControlUpdate",function(t,i){var n="bottom-right";n=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):l.getSetting("changeControlPosition");var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");if(!1===i){try{o.hide()}catch(e){console.log(e)}e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n})}else{try{o.show()}catch(e){console.log(e)}e.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})}e.widget.dispatchEvent("onEdit")}),l.updateWidgetPreferences(),!0===l.getSetting("activateFUN078214")&&e.widget.addEvent("onSearch",e.onSearch.bind(e));var A=e._initializePADComponent_v2.bind(e);if(e.setting_names=s.v1,null===e.pad_app){var S=e.xnav_component_opts;S.x3dAppId=e.widget.getValue("x3dAppId"),S.widget=e.widget,S.lang=e.widget.lang,S.active_view=e.widget.getValue("default_view")?e.widget.getValue("default_view"):"treelistview",S.settings=w,!0===u.isCloud()&&(S.settings.action_bar.standard=S.settings.action_bar.standardCloud,S.settings.action_bar.touch=S.settings.action_bar.touchCloud),!1===t&&(S.settings.action_bar.standard.file=S.settings.action_bar.standard.file.replace(".xml","_NO_WP.xml"),S.settings.action_bar.touch.file=S.settings.action_bar.touch.file.replace(".xml","_NO_WP.xml")),S.layout.root_panel=!1,S.layout.padshell=!0,S.layout.propertiesFacet=l.getSetting("propertiesFacet"),!0===l.getSetting("activateDropInviteWithFilter")&&(S.layout.drop_invite="inviteWithFilter"),!0===l.getSetting("authorizeChangeControl")&&(S.authorizeChangeControl=!0,void 0!==e.widget.getValue("changeControlActivation")&&l.setSetting("changeControlActivation",e.widget.getBool("changeControlActivation"))),!0===l.getSetting("activateDGV")&&(S.layout.amdTreeView="datagridview",S.amd_custo.DataGridView="DS/ENOPAD_v2/views/PADDataGridView","treelistview"===S.active_view&&(S.active_view="datagridview")),!0===l.getSetting("activateTXO")&&!0===i.getConfig("WSAccessV2")&&p.updateAttributesList(d.columnsCusto),S.configuration.toolbarActivated=!0===o(a.getURLParameter("activateToolbar")),S.configuration.dynamicCtxActivated=!0!==o(a.getURLParameter("NoCtxEvo"))&&!0!==l.getSetting("FUN103639-NoCtxEvo");var D,b,C=e.widget.getValue(e.setting_names.ap_custoParams);C&&p.updateSelectedParams(JSON.parse(C)),e._migrate_settings();var x=l.getSetting("resetCustomization");if(!x){"null"===(D=e.widget.getValue(e.setting_names.ap_custo))&&(D=null);try{D=h.jsonUnzip(D),(D=n(D))&&(b=JSON.parse(D))}catch(e){x=!0}}x||D&&"{"!==D.charAt(0)&&!1===D.startsWith("ZIP:")?(localStorage.removeItem("PADTreeListDefinition."+S.x3dAppId+"_"+widget.getValue("x3dPlatformId")),A(S)):b?(S.layout.view_customization=b,A(S)):u.app_initialization(function(t){t&&t.success?r.getMyAppsTemplate({preference_name:S.x3dAppId+"-"+u.getPlatformId(),onComplete:function(e){var t=null;try{e.length>0&&(e.startsWith("ZIP:")&&(e=h.jsonUnzip(e)),"{"===(e=n(e)).charAt(0)&&(t=JSON.parse(e)).selectedExtensions&&t.selectedTypes&&(p.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),delete t.selectedExtensions,delete t.selectedTypes))}catch(e){}S.layout.view_customization=t,A(S)},onFailure:function(e){A(S)}}):e._initialize_failure()})}})});try{require(["DS/MSFDocumentManagement/WidgetIntegration"],function(e){widget.MSFDocumentClient=e,widget.MSFDocumentClient.ConnectWidgetWithMSF()})}catch(e){console.log(e)}},onDestroy:function(){this.pad_app.destroy(),this.pad_app=null;for(var e=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents(),t=0;t<this.subscriptions.length;t++){var i=this.subscriptions[t];e.unsubscribe(i)}for(this.welcome.destroy(),this.welcome=null;this.elements.mainBody.firstChild;)this.elements.mainBody.removeChild(this.elements.mainBody.firstChild);this.elements.mainBody.parentNode&&this.elements.mainBody.parentNode.removeChild(this.elements.mainBody),delete this.elements.mainBody,require("DS/PADUtils/PADSharedSettings").destroy()},_migrate_settings:function(){var e=this.widget.getValue("ap_root_pids"),t=this.widget.getValue("ap__root_pids_detached"),n=this.widget.getValue("ap_struct"),o=i(e),s=i(t),a=i(n),r=!1,l={products:{},filters:{}};if(a)for(var d=Object.keys(a),c=0;c<d.length;c++){var u=d[c];if(!l.products[u]){l.products[u]={};a[u];r=!0}}if(o)for(var p=0;p<o.length;p++){var g=o[p];s&&-1!==s.indexOf(g)&&(l.id2detach||(l.id2detach=[]),l.id2detach.push(g)),l.products[g]={},r=!0}r&&this.widget.setValue("xsceneStoredObjects",JSON.stringify(l)),this.widget.deleteValue("ap_root_pids"),this.widget.deleteValue("ap__root_pids_detached"),this.widget.deleteValue("ap_struct"),this.widget.deleteValue("saved_filter_ids")},_initializePADComponent_v2:function(e){var i=this;window.top.performance.mark(i.pcsPrefix+"_require_padcomponent_before"),require(["DS/PADServices/views/ENXWelcomePanel","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/GlobalUtils","DS/PADUtils/Configuration","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADProbes","DS/PADUtils/PADSettingsMgt","DS/PADServices/views/private/AppStructure","i18n!DS/ENOPS_app/assets/nls/ENOPS_app","DS/PADServices/utils/Storage","i18n!DS/PADServices/assets/nls/PADServices","DS/UIKIT/Mask"],function(n,s,a,r,l,d,c,u,p,g,m,v){u.setWidget(i.widget),l.app_initialization(function(){i._buildDOM(),v.mask(i.elements.mainBody,m.welcomePanel.appLoading);var l=s.getModelEvents(),d=i.widget.getValue(i.setting_names.ap_struct);"null"===d&&(d=null),a.getURLParameter("cleanSetting")===i.setting_names.ap_struct?(i.widget.deleteValue(i.setting_names.ap_struct),d={products:{},filters:{}}):d=UWA.is(d,"string")?JSON.parse(d):{products:{},filters:{}};var u=c.getSetting("pad_security_ctx");u?a.setSecurityContext(u):c.addEvent("onPad_security_ctx",function(e){a.setSecurityContext(e)});var g=o(widget.getValue("showWelcomePanel")),f=o(widget.getValue("autoreload"))||!1===t,h=i.widget.getValue("X3DContentId"),_=null!=h,P=void 0,w={modelEvents:l,storedObjects:d,readOnlyApp:r.getConfig("readOnlyApp"),wpActivated:t,autoreload:f,structKey:"xsceneStoredObjects"},A=n.getDefaultActivities();w.defaultActionId=A.defaultActionId,A.activities.push({section:{id:"newActivitySection",title:m.welcomePanel.newActivity,actions:[{id:"ActionBar_NewProductCmd",title:p.newProduct,icon:"3dproduct-add"},{id:"ActionBar_NewPartCmd",title:p.newPart,icon:"3dpart-add"},{id:"ActionBar_NewDrawingCmd",title:p.newDrawing,icon:"drawing-add"}]}}),i.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/action/ActionBar_NewProductCmd"},i._launchCmd.bind(i))),i.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/action/ActionBar_NewPartCmd"},i._launchCmd.bind(i))),i.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/action/ActionBar_NewDrawingCmd"},i._launchCmd.bind(i))),w.activities=A.activities,i.welcome=new n(w),i.welcome.initialize().then(function(){if(!0===g){!1!==f||_||(v.unmask(i.elements.mainBody),i._setActiveView(i.activeBody,i.welcome));var e=require("DS/PADServices/views/private/AppStructure");let n=e.retrieveData("xsceneStoredObjects");var t=e.buildReloadList(n);f&&!1===t.hasLoad&&(v.unmask(i.elements.mainBody),i._setActiveView(i.activeBody,i.welcome))}}),f&&(P=d),require(["DS/ENOPAD_v2/PADComponent","DS/PADUtils/PADSettingsMgt"],function(t,n){var o=[],s=[],r=new Promise(function(e){Promise.all(s).then(function(){if(!0!==n.getSetting("removeCfgColumns")){require(["DS/CfgWebAppEffectivityUX/scripts/CfgEffectivityColumns"],function(t){t.isAdditionalColumnsAvailable(function(i){!0===i&&o.push(t),e()}),r.name="Add "+t.getName()},function(){e()})}else e()})});s.push(r);var l=new Promise(function(e){Promise.all(s).then(function(){if(!0!==n.getSetting("removeCfgColumns")){require(["DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationRevisionColumn"],function(t){t.isAdditionalColumnsAvailable(function(i){!0===i&&o.push(t),e()}),l.name="Add "+t.getName()},function(){e()})}else e()})});s.push(l);var d=new Promise(function(e){Promise.all(s).then(function(){if(!0!==n.getSetting("removeCfgColumns")){require(["DS/CfgWebAppEffectivityUX/scripts/CfgConfigurationContextColumn"],function(t){t.isAdditionalColumnsAvailable(function(i){!0===i&&o.push(t),e()}),d.name="Add "+t.getName()},function(){e()})}else e()})});s.push(d),function(e,t,i,n){let o=new Promise(function(o,s){Promise.all(e).then(function(){n()?require([i],function(e){e.isAdditionalColumnsAvailable(function(i){!0===i&&t.push(e),o()})},function(){o()}):o()})});o.name="Add "+i,e.push(o)}(s,o,"DS/CfgWebAppEffectivityUX/scripts/CfgProductConfigurationColumn",function(){return!0!==n.getSetting("removeCfgColumns")});var c=new Promise(function(r){Promise.all(s).then(function(){!function(o){window.top.performance.mark(i.pcsPrefix+"_require_padcomponent_done"),window.top.performance.measure(i.pcsPrefix+"_require_padcomponent",i.pcsPrefix+"_require_padcomponent_before",i.pcsPrefix+"_require_padcomponent_done");var s=i._retrieveinitializationOpts(),r=UWA.extend(e,s);P&&(r.objects2Load=P),o.length&&(r.additionalColumnsModules=o),"false"!==a.getURLParameter("expandV2PS")&&(n.getSetting("expandV2PS")||"true"===a.getURLParameter("expandV2PS"))&&(r.amd_custo.TreeDocument="DS/ENOPAD_v2/models/PADTreeDocumentRedirector"),i.xnav_component=new t(r)}(o),r()})});c.name="Launch real initialization",s.push(c);var u=new Promise(function(e){Promise.all(s).then(function(){if(!0===n.getSetting("Activate_relationsColumns")){require(["DS/ENORIPE_RelationsColumns/RelationsColumns"],function(t){t.isAdditionalColumnsAvailable(function(i){!0===i&&(o.push(t),t.setPreferenceProxy()),e()}),u.name="Add "+t.getName()},function(){e()})}else e()})});s.push(u);var p=new Promise(function(e){if(n.getSetting("activateXCADSyncStatus")){require(["DS/ENOXCADSynchroStatus/AdditionalColumns"],function(t){p.name=t.getName(),t.isAdditionalColumnsAvailable(function(i){i&&o.push(t),e()})},function(){e()})}else e()});s.push(p);var g=new Promise(function(e){if(n.getSetting("activateDOStatus")){require(["DS/ENODOGridColumn/AdditionalColumns"],function(t){g.name=t.getName(),t.isAdditionalColumnsAvailable(function(i){i&&o.push(t),e()})},function(){e()})}else e()});s.push(g)})})})},_initialize_failure:function(){var e=this;require(["css!DS/ENXNav/ENXNav","DS/ENXNav/views/xNavInitError","i18n!DS/ENXNav/assets/nls/ENXNav.json"],function(t,i,n){e.elements||e._buildDOM();var o=e.elements.fakeContainer=UWA.createElement("div",{class:"xnav_component"}),s=new i({msg:n.initialization_error});o.setContent(s),e._setActiveView("failure",e.elements.fakeContainer),e.widget.dispatchEvent("onENOPADReady",e)})},_processContentID:function(e){var t=this,i=t.widget.getValue("X3DContentId"),n=UWA.is(i,"string")?JSON.parse(i):i;n.source&&["ENOTASK_AP","ENOTASP_AP"].includes(n.source)&&n.data&&n.data.items.length>0&&n.data.items[0].path&&n.data.items[0].objectId&&delete n.data.items[0].path,require(["DS/PADUtils/PADTypesMgt","DS/PADUtils/PADUtilsServices","DS/ENXNav/utils/xNavKindProcessor"],function(i,o,s){i.retrieveAuthorizedObjects({version:"2.0",X3DContentId:n,callback:function(i){var n=i.authorized_objects[0].envId;o.updatePlatformId(n),s.loadKinds(t.xnav_component,i,"fromx3dContentId",!1,e&&e.callback?e.callback:void 0),t.widget.deleteValue("X3DContentId")}})})},_retrieveinitializationOpts:function(){var e=this;return{events:{onReady:function(i){if(require("DS/UIKIT/Mask").unmask(e.elements.mainBody),window.top.performance.mark(e.pcsPrefix+"_padcomponent_onready"),window.top.performance.measure(e.pcsPrefix+"_padcomponent_ready",e.pcsPrefix+"_require_padcomponent_done",e.pcsPrefix+"_padcomponent_onready"),i.error)return e._setActiveView("app",e.xnav_component),void e.widget.dispatchEvent("onENOPADReady",e);e.pad_app=this;var n=e.widget.getValue("X3DContentId"),s=require("DS/PADServices/utils/GlobalModelEvents");function a(){var t=e.widget.getPreference("dnd"),i=t?t.value:"MOVE";e.pad_app.setDnDBehavior(i)}function r(){var t=!1;void 0!==e.widget.getPreference("confirmationDialog")&&(t=e.widget.getBool("confirmationDialog")),e.pad_app.setConfirmdDialog(t)}UWA.is(n)&&e._processContentID({callback:function(){e.xnav_component.getRoots().length>0&&s.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})}}),a(),r(),e.widget.addEvent("onViewChange",e.pad_app.onResize.bind(e.pad_app)),e.widget.addEvent("onResize",e.pad_app.onResize.bind(e.pad_app)),e.pad_app.addEvent("onToggleView",function(t){e.widget.setValue("default_view",t)});var l=s.getModelEvents();if(e.subscriptions.push(l.subscribe({event:"ENXViews/Views/showInWidgetBody"},function(i){i.html?(i.title&&widget.setTitle(i.title),e._setActiveView(i.idView,i.html)):!0===i.restore&&(widget.setTitle(e.xnav_component.getWidgetTitle()),"welcome"===e.previousBody?!0===t?e._setActiveView("welcome",e.welcome):e._setActiveView("app",e.xnav_component):"app"!==e.previousBody&&"app"!==i.idView||e._setActiveView("app",e.xnav_component))})),e.widget.addEvent("endEdit",a),e.widget.addEvent("endEdit",r),require("DS/PADUtils/PADSharedSettings").resetDebounceFlags(),e.xnav_component.addEvent("onToggleView",function(t){e.widget.setValue("default_view",t)}),!1===t&&i&&i.addInView&&e._setActiveView("app",e.xnav_component),i&&!0===i.error&&e._initialize_failure(),!0===t){if(e.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/openContent"},function(i){switch(e._setActiveView("app",e.xnav_component),i.mode){case"welcome":if(e.welcome._currentLoadRequest){if(UWA.equals(e.welcome._currentLoadRequest,i))return void e.welcome.setCurrentLoadRequest(null)}else e.welcome.setCurrentLoadRequest(i);e.xnav_component.openStoredObjects(i).then(function(){e.welcome.setCurrentLoadRequest(null)});break;case"drop":e.xnav_component.openDroppedObjects(i).then(function(i){if(i&&i.error){require("DS/PADUtils/PADSettingsMgt").getSetting("welcomeonempty")&&!0===t&&e._setActiveView("welcome",e.welcome)}});break;default:console.error("Unknown mode")}})),e.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/removeFromStored"},function(t){if(t.item2remove){var i=t.item2remove,n=[],o=e.widget.getValue(e.setting_names.ap_struct);if("null"===o&&(o=null),UWA.is(o,"string")){o=JSON.parse(o);var s,a,r=i.length,l=!1;for(s=0;s<r;s++){if(o.products&&o.products.hasOwnProperty(i[s]))(u=e.xnav_component.options.model.searchRootById(i[s]))&&n.push(i[s]),delete o.products[i[s]],l=!0;if(o.filters){var d=Object.getOwnPropertyNames(o.filters);for(a=d.length-1;a>=0;a--){var c,u;if(o.filters[d[a]].associatedProduct===i[s]?c=i[s]:d[a]===i[s]&&(c=o.filters[d[a]].associatedProduct),c)(u=e.xnav_component.options.model.searchRootById(c))&&(e.xnav_component.options.model.removeRoot(u),n.push(d[a])),delete o.filters[d[a]],l=!0}}}if(l&&widget.setValue(e.setting_names.ap_struct,JSON.stringify(o)),n.length){var p=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();p.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"deleteRoots",removeIds:n}}),p.publish({event:"ENXViews/WelcomePanel/removeFromView",data:{item2remove:n}})}}}})),e.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/activate"},function(t){l.publish({event:"ENXViews/WelcomePanel/refreshView"}),"fromHome"===t&&(e.welcome.fromHome=!0),e._setActiveView("welcome",e.welcome)})),e.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/closeLandingPage"},function(){e._setActiveView("app",e.xnav_component)})),e.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/unselectAllInModel"},function(){e.xnav_component.getPADTreeDocument().unselectAll()})),e.subscriptions.push(l.subscribe({event:"ENXViews/WelcomePanel/removeFromView"},function(t){var i=t.item2remove,n=i?i.length:0,o=e.xnav_component.getPADTreeDocument();o.withTransactionUpdate(function(){for(var e=0;e<n;e++){var t=o.searchRootById(i[e]);t&&o.removeRoot(t)}})})),e.appReady=!0,l.publish({event:"ENXViews/WelcomePanel/appReady"}),e.launchActions&&e.launchActions.length){for(var d=0;d<e.launchActions.length;d++)e._launchAction(e.launchActions[d]);e.launchActions=[]}}else e._setActiveView("app",e.xnav_component);window.top.performance.mark(e.pcsPrefix+"_app_load_complete"),window.top.performance.measure(e.pcsPrefix+"_app_load_completed","enops_app_load_html",e.pcsPrefix+"_app_load_complete"),e.widget.dispatchEvent("onENOPADReady",e),!1===o(widget.getValue("showWelcomePanel"))&&e._setActiveView("app",e.xnav_component),s.publish({event:"ENXViews/WelcomePanel/loadData"})},onAddPaths:function(e){var t=require("DS/PADServices/views/private/AppStructure"),i=t.retrieveData("xsceneStoredObjects");t.addProductPath(i,e.addedPaths),t.addOpenProduct(i,e.addedPaths),t.persistData("xsceneStoredObjects",i);var n=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();n.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"products",addedPaths:e.addedPaths}}),n.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})},onAddFilters:function(i){var n=require("DS/PADServices/views/private/AppStructure"),o=n.retrieveData("xsceneStoredObjects");if(t){for(var s={filters:{}},a=0;a<i.filterIds.length;a++)n.addFilter(o,i.filterIds[a],i.rootIds[a]),n.addOpenFilter(o,[i.filterIds[a]]),s.filters[i.filterIds[a]]={associatedProduct:i.rootIds[a],filterName:i.filterNames[a]};var r=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();r.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"filters",addedFilters:s}}),r.publish({event:"ENXViews/WelcomePanel/closeLandingPage"})}else for(a=0;a<i.rootIds.length;a++)void 0===o.products[i.rootIds[a]]&&(o.products[i.rootIds[a]]={});widget.setValue(e.setting_names.ap_struct,JSON.stringify(o))},onDeleteRoots:function(e){var t=JSON.parse(e),i=require("DS/PADServices/views/private/AppStructure"),n=i.retrieveData("xsceneStoredObjects"),o=i.removeOpen(n,t);i.persistData("xsceneStoredObjects",n);var s=require("DS/PADServices/utils/GlobalModelEvents");s.publish({event:"ENXViews/WelcomePanel/openedObject",data:{kind:"removeFromView",removedFromViewIds:o}}),s.publish({event:"ENXViews/Model/remove"})},onEmptyView:function(){},onCustoViewChange:function(t,i){var n=require("DS/PADServices/utils/ZipUtils").jsonZip(JSON.stringify(t));if(e.widget.setValue(e.setting_names.ap_custo,n),i&&e.widget.setValue(e.setting_names.ap_custoParams,JSON.stringify(i)),e.pad_app&&e.pad_app.options){var o=e.pad_app.options.views.datagridview;o&&(o.columnOrdering=!0)}},onSaveAsTemplate:function(t){t&&t.selectedExtensions&&t.selectedTypes&&e.widget.setValue(e.setting_names.ap_custoParams,JSON.stringify({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}));var i=require("DS/PADServices/utils/ZipUtils").jsonZip(JSON.stringify(t));e.widget.setValue(e.setting_names.ap_custo,i),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess"],function(e,t){t.saveMyAppsTemplate({preference_name:widget.getValue("x3dAppId")+"-"+e.getPlatformId(),value:i,onComplete:function(e){},onFailure:function(e){}})})},onAuthoringCtxAvailable:function(t){var i=require("DS/PADUtils/PADSettingsMgt"),n=require("DS/PADUtils/PADCommandProxy");e.debouncePrefSynchro=!1,e._proxy=n.create({events:{onPreferenceModification:function(t,n){"changeControlActivation"===t.name&&(e.debouncePrefSynchro=!0,i.setSetting(t.name,t.value,!0))}}}),e.widget.addEvent("endEdit",function(t){if(t&&!1===t.submitted){var n="bottom-right";n=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):i.getSetting("changeControlPosition");var o=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");!1===e.widget.getBool("changeControlActivation")?(o.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n})):(o.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]}))}});var o=i.getSetting("changeControlActivation");o=void 0!==e.widget.getValue("changeControlActivation")?e.widget.getBool("changeControlActivation"):t.isAuthoringContextVisible;var s="bottom-right";s=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):i.getSetting("changeControlPosition");var a=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");a.setPosition(s),e.widget.addPreference({name:"changeControlActivation",defaultValue:o,type:"boolean",label:"changeControlActivation_label",onchange:"onChangeControlUpdate"}),!0===o?(a.show(),e.widget.addPreference({name:"changeControlPosition",defaultValue:s,type:"list",label:"changeControlPosition_label",options:[{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"},{label:"top-right_label",value:"top-right"}]})):(a.hide(),e.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:s})),i.addEvent("onChangeControlActivation",e._onChangeControlActivation.bind(e)),a.addEvent&&a.addEvent("onAuthoringCtxVisible",function(t){i.setSetting("changeControlActivation",t.showAuthoringContext,!0),e._onChangeControlActivation(t.showAuthoringContext)}),i.addEvent("onChangeControlPosition",function(e){require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext").setPosition(e),sessionStorage.setItem("changeControlPosition",e)})},onTenantChange:function(t){e.welcome.tenantChange(),require(["DS/PADUtils/PADUtilsServices","DS/PADUtils/PADWSAccess","DS/PADServices/utils/AttributesMgtV2","DS/PADServices/utils/ZipUtils"],function(i,n,o,s){n.getMyAppsTemplate({preference_name:e.widget.getValue("x3dAppId")+"-"+i.getPlatformId(),onComplete:function(e){var i=null;e.length>0&&(e=s.jsonUnzip(e),(i=JSON.parse(e)).selectedExtensions&&i.selectedTypes&&(o.updateSelectedParams({selectedExtensions:i.selectedExtensions,selectedTypes:i.selectedTypes}),delete i.selectedExtensions,delete i.selectedTypes)),t.updateTreeView(i)},onFailure:function(e){t.updateTreeView()}})})}}}},onSearch:function(e){this.xnav_component&&this.xnav_component.onSearch({query:e})},_onChangeControlActivation:function(e){var t=require("DS/PADUtils/PADSettingsMgt"),i=require("DS/CfgAuthoringContextUX/scripts/CfgAuthoringContext");this.debouncePrefSynchro?this.debouncePrefSynchro=!1:this._proxy.preferenceModification({name:"changeControlActivation",value:e});var n="bottom-right";n=sessionStorage.getItem("changeControlPosition")?sessionStorage.getItem("changeControlPosition"):t.getSetting("changeControlPosition"),i.setPosition(n),!0===e?(i.show(),this.widget.addPreference({name:"changeControlPosition",defaultValue:n,type:"list",label:"changeControlPosition_label",options:[{label:"top-right_label",value:"top-right"},{label:"top-left_label",value:"top-left"},{label:"bottom-right_label",value:"bottom-right"},{label:"bottom-left_label",value:"bottom-left"}]})):(i.hide(),this.widget.addPreference({name:"changeControlPosition",type:"hidden",defaultValue:n}))},_buildDOM:function(){if(!this.elements){this.elements={};var e=this.elements.mainBody=UWA.createElement("div");this.elements.mainBody.classList.add("pse-root"),this.elements.mainBody.classList.add("enx-appMainBody"),this.elements.mainBody.style.position="absolute",this.elements.mainBody.style.height="100%",this.elements.mainBody.style.width="100%",self.widget.setBody(e)}},_setActiveView:function(e,t){var i;(this.initDiv||(this.initDiv={}),void 0===e&&(e="default-"+Date.now()),this.previousBody=this.activeBody,this.activeBody=e,!0!==this.initDiv[e])&&(this.elements[e]||(this.elements[e]=document.createElement("div"),this.elements[e].classList.add("pse-"+e),this.elements[e].classList.add("pse-div"),this.elements.mainBody.appendChild(this.elements[e])),"function"==typeof t.render?(i=t.render(),this.initDiv[e]=!0):i=t,this.elements[e].appendChild(i));this._showActiveView(e)},_showActiveView:function(e){for(var t=Object.keys(this.elements),i=0;i<t.length;i++)e===t[i]?this.elements[t[i]].classList.remove("pse-hidden"):"mainBody"!==t[i]&&this.elements[t[i]].classList.add("pse-hidden");window.dispatchEvent(new Event("resize"))},_launchCmd:function(e){var t=require("DS/PADServices/utils/GlobalModelEvents").getModelEvents();!0===this.appReady?this._launchAction({commandHdr:e.id}):(t.publish({event:"ENXViews/WelcomePanel/maskWP"}),this.launchActions||(this.launchActions=[]),this.launchActions.push({commandHdr:e.id}))},_launchAction:function(e){if(void 0!==e.AMD)require([e.AMD],function(t){t.executeAction(e)});else{require("DS/PADServices/utils/GlobalModelEvents").getModelEvents().publish({event:"ENXViews/WelcomePanel/setAction",data:"previousContent"});var t=this;require(["DS/ApplicationFrame/CommandsManager"],function(i){var n=i.getCommand(e.commandHdr);n&&(t.xnav_component.getPADTreeDocument().unselectAll(),n.begin())})}}};return a.init(e),a}