define("DS/AfrUndoRedoUI/Private_UndoStep",["DS/Core/Events","DS/CoreUtilities/ErrorManagement"],function(e,t){"use strict";var n=0,r=t.getErrorManager();function i(t){if(void 0===t)throw new Error("publishUndoExecuted expect an undo step as input");e.publish({event:"UNDO_"+t.getId()+"/EXECUTED",data:t})}function o(t){if(void 0===t)throw new Error("publishRedoExecuted expect an undo step as input");e.publish({event:"REDO_"+t.getId()+"/EXECUTED",data:t})}var d=function(e){if(void 0===e||void 0===e.undoTitle||"string"!=typeof e.undoTitle)throw new Error("PrivateUndoStep constructor : expects an object parameters as an input with a property named undoTitle {string} on it.");if(void 0!==e.undoAction&&"function"!=typeof e.undoAction)throw new Error("PrivateUndoStep constructor : parameters.undoAction if specified must be a function.");if(void 0===e.undoAction&&void 0!==e.undoData)throw new Error("PrivateUndoStep constructor : parameters.undoData specified but parameters.undoAction undefined.");if(void 0!==e.doAction&&"function"!=typeof e.doAction)throw new Error("PrivateUndoStep constructor : parameters.doAction if specified must be a function.");if(void 0===e.doAction&&void 0!==e.doData)throw new Error("PrivateUndoStep constructor : parameters.doData specified but parameters.doAction undefined.");this._private=Object.create(null),this._private._id=n++,this._private._undoTitle=e.undoTitle,this._private._exclusivity=!1,this._private._redoEnabled=!0,this._private._undoAction=void 0,this._private._undoData=void 0,this._private._doAction=void 0,this._private._doData=void 0,this._private._serverUndoStepId=e.serverUndoStepId>=0?e.serverUndoStepId:void 0,this._private._serverExclusivity=!0===e.serverExclusivity,this._private._groupedUndos=[],this._private._groupedUndosTokens=[],this._private._serverUndoToken=void 0,this._private._pendingGroupedUndosIds=[],this._private._undoEventSent=!1,this._private._redoEventSent=!1,this._private._undoAction=e.undoAction,this._private._undoData=e.undoData,this._private._doAction=e.doAction,this._private._doData=e.doData,!1===e.redoEnabled&&(this._private._redoEnabled=!1),!0===e.exclusivity&&(this._private._exclusivity=!0)};return d.prototype._reset=function(){this._private._undoAction=void 0,this._private._undoData=void 0,this._private._doAction=void 0,this._private._doData=void 0,this._private._serverUndoStepId=void 0,this._private._serverExclusivity=!1},d.prototype.getId=function(){return this._private._id},d.prototype.getUndoTitle=function(){return this._private._undoTitle},d.prototype.setExclusivity=function(e){if(void 0===e||"boolean"!=typeof e)throw new Error("privateUndoStep.setExclusivity expects an input parameter exclusivity of type boolean.");this._private._exclusivity=e},d.prototype.getExclusivity=function(){return this._private._exclusivity},d.prototype.setRedoEnabled=function(e){if(void 0===e||"boolean"!=typeof e)throw new Error("privateUndoStep.setRedoEnabled expects an input redoEnabled of type boolean.");this._private._redoEnabled=e},d.prototype.getRedoEnabled=function(){return this._private._redoEnabled},d.prototype.getServerUndoStepId=function(){return this._private._serverUndoStepId},d.prototype.getServerExclusivity=function(){return this._private._serverExclusivity},d.prototype._addGroupedUndo=function(e){if(void 0===e||!(e instanceof d))throw new Error("privateUndoStep.addGroupedUndo expects an input parameter of type number (Id of the undo step to group to.");if(e._private._groupedUndos.indexOf(this)>=0)throw new Error("privateUndoStep.addGroupedUndo cannot group a step into one of its own groupedStep");return this._private._groupedUndos.unshift(e),t.createReturnObject(r.SUCCEEDED,{description:"privateUndoStep.addGroupedUndo was executed as expected."})},d.prototype.hasGroupedUndoSteps=function(){return this._private._groupedUndos.length>0},d.prototype.hasGroupedStepWithPropertyValue=function(e){for(var t=0;t<this._private._groupedUndos.length;t++)if(this._private._groupedUndos[t]&&e.propertyGetter(this._private._groupedUndos[t],e.propertyValue)||this._private._groupedUndos[t].hasGroupedStepWithPropertyValue(e))return!0;return!1},d.prototype._executeUndo=function(){var t=!0,n=this,r=this._private._groupedUndos.length-1;for(this._private._undoEventSent=!1,void 0!==this._private._serverUndoStepId&&this._private._serverUndoStepId>=0&&(this._private._serverUndoToken=e.subscribe({event:"UNDO_SERVER_"+this._private._serverUndoStepId+"/EXECUTED"},function(){void 0!==this._private._serverUndoToken&&(e.unsubscribe(this._private._serverUndoToken),this._private._serverUndoToken=void 0),0===this._private._groupedUndosTokens.length&&r<0&&(this._private._undoEventSent=!0,i(n))}.bind(this))),this._private._undoAction&&this._private._undoAction.call(this,this._private._undoData),r=this._private._groupedUndos.length-1;r>=0;r--)this._private._groupedUndos[r]?(this._private._pendingGroupedUndosIds.push(this._private._groupedUndos[r].getId()),this._private._groupedUndosTokens.push(this._private._groupedUndos[r]._onUndoExecuted(function(t){var o=this._private._pendingGroupedUndosIds.indexOf(t.getId());e.unsubscribe(this._private._groupedUndosTokens[o]),this._private._groupedUndosTokens.splice(o,1),this._private._pendingGroupedUndosIds.splice(o,1),0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&r<0&&(this._private._undoEventSent=!0,i(n))}.bind(this))),t=this._private._groupedUndos[r]._executeUndo()):t=!1;return 0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&!1===this._private._undoEventSent&&i(n),t},d.prototype._executeRedo=function(){var t=!0,n=this,r=0;for(this._private._redoEventSent=!1,void 0!==this._private._serverUndoStepId&&this._private._serverUndoStepId>=0&&(this._private._serverUndoToken=e.subscribe({event:"REDO_SERVER_"+this._private._serverUndoStepId+"/EXECUTED"},function(){void 0!==this._private._serverUndoToken&&(e.unsubscribe(this._private._serverUndoToken),this._private._serverUndoToken=void 0),0===this._private._groupedUndosTokens.length&&r>=this._private._groupedUndos.length&&(this._private._redoEventSent=!0,o(n))}.bind(this))),r=0;r<this._private._groupedUndos.length;r++)this._private._groupedUndos[r]?(this._private._pendingGroupedUndosIds.push(this._private._groupedUndos[r].getId()),this._private._groupedUndosTokens.push(this._private._groupedUndos[r]._onRedoExecuted(function(t){var i=this._private._pendingGroupedUndosIds.indexOf(t.getId());e.unsubscribe(this._private._groupedUndosTokens[i]),this._private._groupedUndosTokens.splice(i,1),this._private._pendingGroupedUndosIds.splice(i,1),0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&r>=this._private._groupedUndos.length&&(this._private._redoEventSent=!0,o(n))}.bind(this))),t=this._private._groupedUndos[r]._executeRedo()):t=!1;return this._private._doAction&&this._private._doAction.call(this,this._private._doData),0===this._private._groupedUndosTokens.length&&void 0===this._private._serverUndoToken&&!1===this._private._redoEventSent&&o(n),t},d.prototype._onUndoExecuted=function(t){return e.subscribe({event:"UNDO_"+this._private._id+"/EXECUTED"},t)},d.prototype._onRedoExecuted=function(t){return e.subscribe({event:"REDO_"+this._private._id+"/EXECUTED"},t)},d.prototype.removeCallback=function(t){e.unsubscribe(t)},d}),define("DS/AfrUndoRedoUI/Private_GenericStack",["DS/Core/Events","DS/AfrUndoRedoUI/Private_UndoStep","DS/CoreUtilities/ErrorManagement"],function(e,t,n){"use strict";var r=[n.generateReturnValue("MISSING_STEP",!1),n.generateReturnValue("NO_STEPS_TO_GROUP",!1)],i=n.getErrorManager(r,{merge:!0});function o(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStackFilled expect the stack Id for which to sent the event");return e+"_FILLED"}function d(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStackEmptied expect the stack Id for which to sent the event");return e+"_EMPTIED"}function a(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStepPushedIntoStack expect the stack Id for which to sent the event");return"STEP_PUSHED_IN_"+e}function s(e){if(void 0===e||"string"!=typeof e)throw new Error("getEventWhenStepPopedOutOfStack expect the stack Id for which to sent the event");return"STEP_REMOVED_FROM_"+e}function p(t){e.publish({event:d(t)})}var u=function(t){if(this._private=Object.create(null),this._private._stack=[],this._private._capacity=10,this._private._name="",this._private.removeStepAt=function(t){if(void 0===t||"number"!=typeof t||t<0||t>=this._stack.length)throw new Error("genericStack._private.removeStepAt expected a number (betwwen 0 and this._stack.lenght) as an input parameter");var n=this._stack.splice(t,1);if(n&&n[0])return function(t,n){if(void 0===n||"string"!=typeof n)throw new Error("sendStepRemovedFromStack expect the step UndoTitle pushed into the stack");e.publish({event:s(t),data:n})}(this._name,n[0].getUndoTitle()),0===this._stack.length&&p(this._name),n[0]},!t)throw new Error("genericStack constructor: method expects options (an object)  as input parameter.");if(!t.ID||"string"!=typeof t.ID)throw new Error("genericStack constructor: method expects options.ID (a string) as input parameter.");if(this._private._name=t.ID,void 0!==t.capacity){if(!("number"==typeof t.capacity&&t.capacity>=0))throw new Error("genericStack constructor: if options.capacity is set, it must be a number >= 0.");this._private._capacity=t.capacity}};return u.prototype.getName=function(){return this._private._name},u.prototype.getSize=function(){return this._private._stack.length},u.prototype.getCapacity=function(){return this._private._capacity},u.prototype.setCapacity=function(e){if(void 0===e||"number"!=typeof e||e<0)throw new Error("genericStack.setCapacity: method expects the undo stack capacity (a number >= 0) to set as input parameter.");for(this._private._capacity=e;this._private._stack.length>e;)this._private.removeStepAt(0);return n.createReturnObject(i.SUCCEEDED,{description:""})},u.prototype.pushStep=function(r){if(void 0===r)throw new Error("genericStack pushStep: method expects the step as input parameter.");if(!(r instanceof t))throw new Error("genericStack pushStep: method expects the step of type PrivateUndoStep as input parameter.");var d;return this._private._stack.length===this._private._capacity&&this._private.removeStepAt(0),this._private._stack.push(r),function(t,n){if(void 0===n||"string"!=typeof n)throw new Error("sendStepPushedIntoStack expect the step UndoTitle pushed into the stack");e.publish({event:a(t),data:n})}(this.getName(),r.getUndoTitle()),1===this.getSize()&&(d=this.getName(),e.publish({event:o(d)})),n.createReturnObject(i.SUCCEEDED,{description:"Step added in stack"})},u.prototype.popStep=function(){if(0!==this.getSize())return this._private.removeStepAt(this._private._stack.length-1)},u.prototype.flush=function(){this._private._stack=[],p(this.getName())},u.prototype.getLastStepId=function(){return this._private._stack.length>0?this._private._stack[this._private._stack.length-1].getId():-1},u.prototype.getLastStepUndoTitle=function(){return this._private._stack.length>0?this._private._stack[this._private._stack.length-1].getUndoTitle():void 0},u.prototype.findStepIdx=function(e){var t=-1;if(void 0===e||e<-1||"number"!=typeof e)throw new Error("genericStack findStepIdx: method expects the Step identifier (a number >= 0) as input parameter.");for(t=this._private._stack.length-1;t>=0;t--)if(this._private._stack[t].getId()===e)return t;return-1},u.prototype.findStepIdFromPropertyValue=function(e){var t=-1;if(void 0===e||void 0===e.propertyGetter||void 0===e.propertyValue||"function"!=typeof e.propertyGetter)throw new Error("findStepIdFromPropertyValue expects a property named propertyGetter (function) and another named propertyValue on parameters.");for(t=this._private._stack.length-1;t>=0;t--)if(e.propertyGetter(this._private._stack[t],e.propertyValue)||this._private._stack[t].hasGroupedStepWithPropertyValue(e))return this._private._stack[t].getId();return-1},u.prototype.removeStepWithId=function(e){if(void 0===e||"number"!=typeof e||e<0)throw new Error("genericStack.removeStepWithId: method expects the step Id of type nummber >= 0 as input parameter.");var t=this.findStepIdx(e);return t<0?n.createReturnObject(i.MISSING_STEP,{description:"genericStack.removeStepWithId: step with Id:"+e+", not found."}):(this._private.removeStepAt(t),n.createReturnObject(i.SUCCEEDED,{description:"genericStack.removeStepWithId: step with Id : "+e+", was successfully removed."}))},u.prototype.removeStepsFromId=function(e){if(void 0===e||"number"!=typeof e||e<0)throw new Error("genericStack.removeStepsFromId: method expects the step Id from which to remove step of type nummber >= 0 as input parameter.");var t=this.findStepIdx(e);if(t<0)return n.createReturnObject(i.MISSING_STEP,{description:"genericStack.removeStepsFromId: step with Id:"+e+", not found."});for(var r=0;r<=t;r++)this._private.removeStepAt(0);return n.createReturnObject(i.SUCCEEDED,{description:"genericStack.removeUndoWithId: step with Id : "+e+", was successfully removed."})},u.prototype.groupSteps=function(e,t){if(void 0===e||void 0===t)throw new Error("genericStack.groupSteps: method expects iFromId and iToId, the 2 server step server Id to group as input parameters.");if("number"!=typeof e||"number"!=typeof t)throw new Error("genericStack.groupSteps: method expects iFromId and iToId, the 2 server step server Id to group as input parameters to be of numbers.");if(t>e)throw new Error("genericStack.groupSteps: index of step with iFromId:"+e+"< index of step with iToId:"+t+".");var r=this.findStepIdx(e);if(-1===r)return n.createReturnObject(i.MISSING_STEP,{description:"genericStack.groupSteps: step with iFromId:"+e+", not found."});if(0===r)return n.createReturnObject(i.NO_STEPS_TO_GROUP,{description:"genericStack.groupSteps: no steps to group between iFromId:"+e+" and iToId:"+t+"."});for(var o,d,a=this._private._stack[r],s=e-1;s>=t;)(o=this.findStepIdx(s))>-1&&(d=this._private._stack[o])&&(a._addGroupedUndo(d),this._private.removeStepAt(o)),s--;return n.createReturnObject(i.SUCCEEDED,{description:"genericStack.groupSteps: server steps from Id : "+e+" to Id : "+t+" were grouped."})},u.prototype.onStackFilled=function(t){return e.subscribe({event:o(this.getName())},t)},u.prototype.onStackEmptied=function(t){return e.subscribe({event:d(this.getName())},t)},u.prototype.onStepPushedIntoStack=function(t){return e.subscribe({event:a(this.getName())},t)},u.prototype.onStepRemovedFromStack=function(t){return e.subscribe({event:s(this.getName())},t)},u.prototype.removeCallback=function(t){e.unsubscribe(t)},u}),define("DS/AfrUndoRedoUI/Private_UndoRedoManager",["DS/Core/Core","UWA/Class","DS/Core/Events","DS/AfrUndoRedoUI/Private_GenericStack","DS/AfrUndoRedoUI/Private_UndoStep","DS/ApplicationFrame/CommandsManager","DS/CoreUtilities/ErrorManagement"],function(e,t,n,r,i,o,d){"use strict";var a,s=[d.generateReturnValue("MISSING_UNDO_STEP",!1),d.generateReturnValue("WRONG_UNDO_STEP_ORDER",!1),d.generateReturnValue("NO_UNDO_STEPS_TO_GROUP",!1),d.generateReturnValue("UNDO_STEP_CREATION_FAILED",!1),d.generateReturnValue("FAIL",!1)],p=d.getErrorManager(s,{merge:!0}),u=function(t){d.getDebugMode()&&(d.getDebugMode()?(e.enableWUXConsole(),a=WUX.getWUXConsole()?WUX.getWUXConsole():console):a=console,a.log(t))},c=t.singleton({init:function(){c._parent(),this._private=Object.create(null),this._private._undoStack=new r({ID:"AfrUndoStack"}),this._private._redoStack=new r({ID:"AfrRedoStack"}),this._private._endAllEventToken=void 0,this._private._undoExecutedToken=[],this._private._undoExecutedId=[],this._private._redoExecutedToken=[],this._private._redoExecutedId=[],this._private._undosPending=[],this._private._lastUndoStepId=-1,this._private._lastUndoStepIdSaved=-1,this._private._cleanEndAllEventToken=function(){void 0!==this._endAllEventToken&&(n.unsubscribe(this._endAllEventToken),this._endAllEventToken=void 0)},this._private._executeUndoPending=function(){if(this._undosPending.length<=0||void 0===this._undosPending[this._undosPending.length-1])return d.createReturnObject(p.MISSING_UNDO_STEP,{description:"_executeUndoPending: No undo Pending"});var e=this._undosPending.pop();e&&(u("Undo action: "+e.getUndoTitle()),this._undoExecutedId.push(e.getId()),this._undoExecutedToken.push(e._onUndoExecuted(function(e){if(!e)return d.createReturnObject(p.FAILED,{description:"_onUndoExecuted Callback: No undo step corresponding to undo event."});var t=this._undoExecutedId.indexOf(e.getId());t>=0&&(void 0!==this._undoExecutedToken[t]&&n.unsubscribe(this._undoExecutedToken[t]),this._undoExecutedId.splice(t,1),this._undoExecutedToken.splice(t,1)),!1!==e.getRedoEnabled()&&this._redoStack.pushStep(e),c.displayStacksSize(),n.publish({event:"UNDO_"+e.getId()+"/ENDED",data:e.getUndoTitle()})}.bind(this))),e._executeUndo())},this._private.displayStacksSize=function(){u("Undo  : "+this._undoStack.getSize()+" | Redo : "+this._redoStack.getSize())}},createUndoStep:function(e){if(void 0===e||void 0===e.undoTitle||"string"!=typeof e.undoTitle||void 0===e.undoAction||"function"!=typeof e.undoAction)throw new Error("PrivateUndoRedoManager.createUndoStep expects an input object parameters with at least parameters.undoTitle {string} and parameters.undoAction {function} specified.");var t=null,n=null;this._private._executionContext?n=this._private._executionContext.getComponent("AFR_CommandsManager")._private._runningCmd._private._command._instance:(t=o._getCurrent(),n=o.getCommand(t));n&&n._previousUndoId===this._private._lastUndoStepId?(e.redoEnabled=!1,e.exclusivity=!0):(e.redoEnabled=!0,e.exclusivity=!1);var r=new i(e);return r?(this.registerAction(r),d.createReturnObject(p.SUCCEEDED,"PrivateUndoRedoManager.createUndoStep as succeeded, undo step created and add to undo stack.")):d.createReturnObject(p.UNDO_STEP_CREATION_FAILED,"PrivateUndoRedoManager.createUndoStep as failed, undo step couldn't be created correctly.")},registerAction:function(e){if(void 0===e||!(e instanceof i))throw new Error("PrivateUndoRedoManager.registerAction expects a PrivateUndoStep instance as input.");var t=null,n=null;this._private._executionContext?n=this._private._executionContext.getComponent("AFR_CommandsManager")._private._runningCmd._private._command._instance:(t=o._getCurrent(),n=o.getCommand(t));if(n&&(n._dirtyUndoStack=!0),this._private._lastUndoStepId=e.getId(),this._private._undoStack.pushStep(e),this._private._executionContext){var r=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent");r&&(this._private._redoStack.getSize()>0?r.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"}):r.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_ONLY"}))}return this._private._redoStack.flush(),d.createReturnObject(p.SUCCEEDED,{description:"Undo step "})},startConcatenateUS:function(){var e=null,t=null,n=null,r=null;this._private._executionContext?(r=(n=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd._private._command._instance,e=n._private._defaultCommand):(t=o._getCurrent(),e=o._getDefaultCommand(),r=o.getCommand(t)),this._private._lastUndoStepIdSaved=t!=e?r._previousUndoId:this._private._lastUndoStepId},stopConcatenateUS:function(e){if(-1!==this._private._lastUndoStepIdSaved){var t=null,n=null,r=null,i=null;this._private._executionContext?((i=(r=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd._private._command._instance)&&(n=i.getId()),t=r._private._defaultCommand):(n=o._getCurrent(),t=o._getDefaultCommand(),i=o.getCommand(n)),i.askForUndoGroupingAtEnd(e),n==t&&(r?r.endAll(!0):o.endAll(void 0,!0))}},discardConcatenateUS:function(){this._private._lastUndoStepIdSaved=-1},_stopConcatenateUS:function(e){var t=this._private._undoStack.getLastStepId();if(this._private._lastUndoStepIdSaved>-1&&this._private._lastUndoStepIdSaved<t){var n=new i({undoTitle:e,exclusivity:!0,redoEnabled:!0});this.registerAction(n);var r=this._private._undoStack.groupSteps(n.getId(),this._private._lastUndoStepIdSaved+1);if(!d.hasSucceeded(r)){var o=this._private._undoStack.removeStepWithId(this._private._undoStack.getLastStepId());d.hasSucceeded(o)||d.logResult(o)}}},getLastCreatedUndoStepId:function(){return this._private._lastUndoStepId},flushStacks:function(){this._private._undoStack.flush(),this._private._redoStack.flush(),u("Undo and redo stacks have been emptied"),this.displayStacksSize()},undo:function(){var e,t=d.createReturnObject(p.SUCCEEDED,{description:""}),r=this._private._undoStack.getSize();if(r>0){this._private._executionContext&&(e=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent"))&&(r>1?e.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"}):e.publish({mode:"WAFR_UNDO_REDO",value:"REDO_ONLY"}));var i=this._private._undoStack.popStep();if(void 0!==i){this._private._undosPending.push(i);var a=null,s=null,u=null;if(this._private._executionContext?s=(u=this._private._executionContext.getComponent("AFR_CommandsManager"))._private._runningCmd._private._command._instance:(a=o._getCurrent(),s=o.getCommand(a)),s&&s._previousUndoId+1>=i.getId()&&!0===i.getRedoEnabled()&&(i.setExclusivity(!0),s._previousUndoId+1===i.getId()&&i.setRedoEnabled(!1)),i.getExclusivity()&&s&&!1===s.isCanceled()){if(!1===i.getRedoEnabled()){this._private._undoStack.pushStep(i);var c=i.getId();this._private._endAllEventToken=n.subscribe({event:"COMMAND_MANAGER/ALL_CMD_ENDED"},function(){this._private._cleanEndAllEventToken(),n.publish({event:"UNDO_"+c+"/ENDED"})}.bind(this)),i=void 0,this._private._undosPending.pop()}else this._private._endAllEventToken=n.subscribe({event:"COMMAND_MANAGER/ALL_CMD_ENDED"},function(){this._private._cleanEndAllEventToken(),this._private._executeUndoPending()}.bind(this));u?u.endAll(!1):o.endAll(void 0)}else this._private._executeUndoPending()}else t=d.createReturnObject(p.EMPTY_STACK,{description:"undo: The undo stack is empty. Nothing to undo"})}else t=d.createReturnObject(p.EMPTY_STACK,{description:"undo: The undo stack is empty. Nothing to undo"});return t},onUndoExecuted:function(e,t){return void 0===e||e<0?void 0:n.subscribe({event:"UNDO_"+e+"/ENDED"},t)},redo:function(e){var t,r=d.createReturnObject(p.SUCCEEDED,{description:""}),i=this._private._redoStack.getSize();this._private._executionContext&&(t=this._private._executionContext.getComponent("AFR_AvailabilityModesComponent"))&&(1===i?t.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_ONLY"}):i>1&&t.publish({mode:"WAFR_UNDO_REDO",value:"UNDO_REDO"}));var o=this._private._redoStack.popStep();return o?(u("Redo action: "+o.getUndoTitle()),this._private._redoExecutedId.push(o.getId()),this._private._redoExecutedToken.push(o._onRedoExecuted(function(e){if(!e)return d.createReturnObject(p.FAILED,{description:"redo Callback: No undo step corresponding to undo event."});var t=this._private._redoExecutedId.indexOf(e.getId());t>=0&&(void 0!==this._private._redoExecutedToken[t]&&n.unsubscribe(this._private._redoExecutedToken[t]),this._private._redoExecutedId.splice(t,1),this._private._redoExecutedToken.splice(t,1)),this._private._undoStack.pushStep(e),c.displayStacksSize(),n.publish({event:"REDO_"+e.getId()+"/ENDED",data:e.getUndoTitle()})}.bind(this))),r=o._executeRedo()):r=d.createReturnObject(p.EMPTY_STACK,{description:"redo: The redo stack is empty. Nothing to redo"}),r},onRedoExecuted:function(e,t){return void 0===e||e<0?void 0:n.subscribe({event:"REDO_"+e+"/ENDED"},t)},displayStacksSize:function(){this._private.displayStacksSize()},getUndoRedoErrorManager:function(){return p}});return c}),define("DS/AfrUndoRedoUI/UndoCmd",["UWA/Core","DS/Core/Events","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager"],function(e,t,n,r,i){"use strict";return n.extend({_token:void 0,_disableWhenPossible:function(){this.isRunning()?this._disbaleOnNextEnd=!0:this.disable()},init:function(e){console.log("init"),e?(e.ID="Undo",e.mode="undefined",e.isAsynchronous="true",this._parent(e)):this._parent({ID:"Undo",mode:"undefined",isAsynchronous:"true"}),e&&e.executionContext&&(this._exeCtx=e.executionContext),this.disable(),this._token=void 0,this._disbaleOnNextEnd=!1,i._private._undoStack.onStackEmptied(this._disableWhenPossible.bind(this)),i._private._undoStack.onStackFilled(this.enable.bind(this))},beginExecute:function(){console.log("begin");var e=!1,n=null;if(this.isNewInfraActivated&&this._exeCtx){var o=this._exeCtx.getComponent("AFR_CommandsManager");o&&"WAFRRedoCmd"==o.getRunningCommand()&&(e=!0)}else(n=r.getCommand("Redo"))&&n.isRunning()&&(e=!0);if(0===i._private._undoStack.getSize()||e)this.end();else{var d=this;this._token=i.onUndoExecuted(i._private._undoStack.getLastStepId(),function(){t.unsubscribe(d._token),d._token=void 0,d.end()}),i.undo()}this.isNewInfraActivated()&&this.endExecute()},endExecute:function(){console.log("undo"),this._disbaleOnNextEnd&&(this._disbaleOnNextEnd=!1,this.disable()),this.done()}})}),define("DS/AfrUndoRedoUI/RedoCmd",["UWA/Core","DS/Core/Events","DS/ApplicationFrame/Command","DS/ApplicationFrame/CommandsManager","DS/AfrUndoRedoUI/Private_UndoRedoManager"],function(e,t,n,r,i){"use strict";return n.extend({_token:void 0,_disableWhenPossible:function(){this.isRunning()?this._disbaleOnNextEnd=!0:this.disable()},init:function(e){e?(e.ID="Redo",e.mode="undefined",e.isAsynchronous="true",this._parent(e)):this._parent({ID:"Redo",mode:"undefined",isAsynchronous:"true"}),e&&e.executionContext&&(this._exeCtx=e.executionContext),this._token=void 0,this.disable(),this._disbaleOnNextEnd=!1,i._private._redoStack.onStackEmptied(this._disableWhenPossible.bind(this)),i._private._redoStack.onStackFilled(this.enable.bind(this))},beginExecute:function(){var e=!1,n=null;if(this.isNewInfraActivated&&this._exeCtx){var o=this._exeCtx.getComponent("AFR_CommandsManager");o&&"WAFRUndoCmd"==o.getRunningCommand()&&(e=!0)}else(n=r.getCommand("Undo"))&&n.isRunning()&&(e=!0);if(0===i._private._redoStack.getSize()||e)this.end();else{var d=this;this._token=i.onRedoExecuted(i._private._redoStack.getLastStepId(),function(){t.unsubscribe(d._token),d._token=void 0,d.end()}),i.redo()}this.isNewInfraActivated()&&this.endExecute()},endExecute:function(){this._disbaleOnNextEnd&&(this._disbaleOnNextEnd=!1,this.disable()),this.done()},destroy:function(){this.isNewInfraActivated&&this.endExecute(),this.done()}})});var reqPrivate_AfrCSController="DS/AfrCS/Private_AfrCSController";define("DS/AfrUndoRedoUI/Private_UndoRedoCSServices",["DS/Core/Core","DS/Core/Events","DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoStep",reqPrivate_AfrCSController,"DS/ApplicationFrame/CommandsManager","DS/CSICommandBinder/CSICommandBinder","DS/CoreUtilities/ErrorManagement"],function(e,t,n,r,i,o,d,a){"use strict";var s,p=function(){a.getDebugMode()?(e.enableWUXConsole(),s=WUX.getWUXConsole()?WUX.getWUXConsole():console):s=console},u=n.getUndoRedoErrorManager(),c=function(e){var n=e.readInt32("serverUndoStepId");t.publish({event:"UNDO_SERVER_"+n+"/EXECUTED",data:void 0})},v=function(e){var n=e.readInt32("serverUndoStepId");t.publish({event:"REDO_SERVER_"+n+"/EXECUTED",data:void 0})},_=function(e,t){if(void 0===e)throw new Error("PrivateUndoRedoCSServices.isUndoStepServerId : Expects the server undo step server as input parameter.");if(!(e instanceof r))throw new Error("PrivateUndoRedoCSServices.isUndoStepServerId: Expects the server undo step server as input parameter.");return e.getServerUndoStepId()===t},h=function(e,t){if(void 0===e)throw new Error("PrivateUndoRedoCSServices.isOlderUndoStepServerThan : Expects the server undo step server as input parameter.");if(!(e instanceof r))throw new Error("PrivateUndoRedoCSServices.isOlderUndoStepServerThan: Expects the server undo step server as input parameter.");return e.getServerUndoStepId()<t},S={registerServerAction:function(e){var t=!1;e&&e.exclusiveUndo&&(t=!0);var i=new r({exclusivity:t,serverExclusivity:e.serverExclusivity,undoTitle:e.undoTitle,serverUndoStepId:e.serverUndoStepId,undoAction:function(e){var t=this.getRedoEnabled();e&&!t||S.sendUndoRequest({undoStep:this,redoEnabled:t})},undoData:e.serverExclusivity,doAction:function(){S.sendRedoRequest()}});return n.registerAction(i)},removeUndoWithServerId:function(e){var t=S.findUndoStepIdFromServerId(e);if(t>=0)return n._private._undoStack.removeStepWithId(t),a.createReturnObject(u.SUCCEEDED,{description:"PrivateUndoRedoCSServices.removeUndoWithServerId: server undo step with server Id : "+e+", was successfully removed."})},findUndoStepIdFromServerId:function(e){var t=-1;if(void 0===e)throw new Error("PrivateUndoRedoCSServices.findUndoStepIdFromServerId: method expects the server undo step server Id as input parameter.");if("number"!=typeof e)throw new Error("PrivateUndoRedoCSServices.findUndoStepIdFromServerId: method expects the server undo step server Id of type nummber as input parameter.");return(t=n._private._undoStack.findStepIdFromPropertyValue({propertyGetter:_,propertyValue:e}))<0&&a.createReturnObject(u.MISSING_UNDO_STEP,{description:"PrivateUndoRedoCSServices.findUndoStepIdFromServerId: server undo step with server Id:"+e+", not found."}),t},findFirstUndoStepServerOlderThan:function(e){var t=-1;if(void 0===e)throw new Error("PrivateUndoRedoCSServices.findFirstUndoStepServerOlderThan: method expects the server undo step server Id as input parameter.");if("number"!=typeof e)throw new Error("PrivateUndoRedoCSServices.findFirstUndoStepServerOlderThan: method expects the server undo step server Id of type nummber as input parameter.");return(t=n._private._undoStack.findStepIdFromPropertyValue({propertyGetter:h,propertyValue:e}))<0&&a.createReturnObject(u.MISSING_UNDO_STEP,{description:"PrivateUndoRedoCSServices.findFirstUndoStepServerOlderThan: server undo step with server Id:"+e+", not found."}),t},sendUndoRequest:function(e){var t={operation:"AfrUndoOperation"};void 0!==e&&void 0!==e.redoEnabled&&(void 0===t.inputs&&(t.inputs=new d.Parameters),t.inputs.writeBool("keepRedo",e.redoEnabled)),t.callbackArgs=e,i.callInternalService(t),a.getDebugMode()&&(p(),s.log("Undo operation call on server"))},sendRedoRequest:function(){i.callInternalService({operation:"AfrRedoOperation"}),a.getDebugMode()&&(p(),s.log("Redo operation call on server"))},getUndoServerCallback:function(){return c},getRedoServerCallback:function(){return v},flushUndoRedoStacks:function(){i.callInternalService({operation:"AfrFlushUndoRedoStacksOperation"}),n.flushStacks()},flushStacks:function(){n.flushStacks()},removeStepsFromServerId:function(e){n._private._undoStack.removeStepsFromId(e)},groupServerSteps:function(e,t){n._private._undoStack.groupSteps(e,t)},setServerUndoRedoStacksCapacity:function(e){if(i.isServerConnected()){if(void 0===e||"number"!=typeof e||e<0)throw new Error("PrivateUndoRedoCSServices.setUndoRedoStackCapacity: method expects the stacks capacity (a number >= 0) to set as input parameter.");var t=new d.Parameters;t.writeInt32("stacksSize",e);var n={operation:"AfrChangeUndoRedoStacksSizeOperation",inputs:t};i.callInternalService(n)}},updateAvailability:function(){var e=n._private._undoStack.getSize(),t=n._private._redoStack.getSize(),r=o.getCommand("Undo"),i=o.getCommand("Redo");r&&i&&(0==e&&0==t?(r.isEnabled()&&r.disable(),i.isEnabled()&&i.disable()):e>0&&0==t?(i.isEnabled()&&i.disable(),r.isEnabled()||r.enable()):t>0&&0==e&&(r.isEnabled()&&r.disable(),i.isEnabled()||i.enable()))}};return S}),define("DS/AfrUndoRedoUI/FlushUndoRedoStacksCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/AfrUndoRedoUI/Private_UndoRedoCSServices"],function(e,t,n){"use strict";return t.extend({init:function(){this._parent({ID:"FlushUndoRedoStacksCmd",mode:"undefined"})},beginExecute:function(){n.flushUndoRedoStacks()}})}),define("DS/AfrUndoRedoUI/UndoRedoServices",["DS/AfrUndoRedoUI/Private_UndoRedoManager","DS/AfrUndoRedoUI/Private_UndoRedoCSServices","DS/CoreUtilities/ErrorManagement"],function(e,t,n){"use strict";var r=n.getErrorManager();return{createUndoStep:function(t){var n;return void 0!==t.exclusivity&&(n=r.createReturnObject(r.WRONG_PARAMETERS,"UndoRedoServices.createUndoStep do not support parameters.exclusivity as a valid input parameter."),r.logResult(n)),void 0!==t.redoEnabled&&(n=r.createReturnObject(r.WRONG_PARAMETERS,"UndoRedoServices.redoEnabled do not support parameters.exclusivity as a valid input parameter."),r.logResult(n)),e.createUndoStep(t)},setUndoRedoStacksCapacity:function(n){e._private._undoStack.setCapacity(n),e._private._redoStack.setCapacity(n),t.setServerUndoRedoStacksCapacity(n)},getUndoRedoStackCapacity:function(){return e._private._undoStack.getCapacity()},startConcatenateUS:function(){return e.startConcatenateUS()},stopConcatenateUS:function(t){return e.stopConcatenateUS(t)}}});