define("DS/BusinessMethodDummyWdg/Views/AppTile",["UWA/Element","UWA/Class/View","DS/UIKIT/Mask"],function(e,t,n){"use strict";const i=top.require("DS/Dashboard/Utils"),s=top.require("DS/Dashboard/CompassManager"),r=top.require("DS/Dashboard/PublicAPI"),a=window.dsDefaultWebappsBaseUrl||"";return t.extend({className:"app-tile",tagName:"div",appId:"",name:"",brand:"",setup:function(e){this.appId=e.appId,this.name=e.name,this.brand=e.brand},destroy:function(){this._parent.apply(this,arguments)},render:function(){var t=this.container,n=this.elements,i=this.getAppName();return n.appIcon=new e("div",{class:"icon"}),n.appIconWrapper=new e("div",{class:"icon-wrapper"}),t.addContent([{tag:"div",class:"icon-ctn",html:[n.appIcon,n.appIconWrapper]},{tag:"div",class:"name",text:i}]),this.showLoading(),this._fetchCompassServiceUrl().then(this._renderAppIcon.bind(this)).finally(this.hideLoading.bind(this)),this},getAppName:function(){return this.name||""},getAppId:function(){return this.appId||""},getBrand:function(){return this.brand||""},showLoading:function(){n.mask(this.container)},hideLoading:function(){n.unmask(this.container)},_renderAppIcon:function(e){var t,n,s=e.compassServiceUrl,r=this.getAppId(),o=this.getBrand(),u=this.elements;t=i.buildPath(s,"widget/images/MyApps",r+"_AppIcon.png"),n=i.buildPath(a,"i3DXCompass/assets/v3.1/images/app/Appicon_backgound_r2021x_sprite.png"),u.appIcon.setStyles({"background-image":`url(${t})`}),u.appIconWrapper.addClassName(`is-${o.toUpperCase()}`).setStyles({"background-image":`url(${n})`})},_fetchCompassServiceUrl:function(){return s.getServiceUrl({serviceName:"3DCompass",platformId:r._getGlobalPlatformId()}).then(function(e){if(!e||"string"!=typeof e)throw new Error("3DCompass service url is empty.");return{compassServiceUrl:e}})}})}),define("DS/BusinessMethodDummyWdg/RequireConfigurator",[],function(){"use strict";const e=top.require("DS/Dashboard/Utils"),t=top.require("DS/Dashboard/CompassManager"),n=top.require("DS/Dashboard/PublicAPI");var i={updateConfig:function(t){return i._fetchServicesUrls(t).then(function(t){var n=t.bustCachePath,s=Promise.resolve();return n&&(s=i._fetchCacheBust({serviceUrl:t.serviceUrl,path:n,key:"v"})),s.then(function(n){var i={},s={};t.modules.forEach(n=>{i[n.dsPath]=e.buildPath(n.serviceUrl||t.serviceUrl,n.fsPath)}),s.paths=i,n&&(s.urlArgs=n),require.config(s)})})},_fetchServicesUrls:function(e){var i={};return(e.modules||[]).forEach(function(e){var t=e.serviceName;t&&(i[t]=e)}),t.getPlatformServices({platformId:n._getGlobalPlatformId()}).then(function(t){return Object.keys(i).forEach(function(e){var n=t[e];n&&(i[e].serviceUrl=n)}),e.serviceUrl=t[e.serviceName],e})},_fetchCacheBust:function(t){return i._fetchFileContent(e.buildPath(t.serviceUrl,t.path)).then(function(e){return"v="+(e=(e||"").trim())})},_fetchFileContent:function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.open("GET",e),i.onload=function(){this.status>=200&&this.status<300?t(i.response):n(new Error({status:this.status,statusText:i.statusText}))},i.onerror=function(){n(new Error({status:this.status,statusText:i.statusText}))},i.send()})}};return i}),define("DS/BusinessMethodDummyWdg/BusinessMethodDummy",["UWA/Class/View","DS/UIKIT/Mask","DS/BusinessMethodDummyWdg/RequireConfigurator","DS/BusinessMethodDummyWdg/Views/AppTile","css!DS/BusinessMethodDummyWdg/BusinessMethodDummyWdg.css"],function(e,t,n,i){"use strict";const s=top.require("DS/Dashboard/CompassManager");return e.extend({className:"bm-dummy",tagName:"div",widget:null,APP_CONFIG:void 0,_configInstance:null,_fetchAppNamePromise:null,setup:function(e){this.widget=e.widget,this._fetchAppNamePromise=this.fetchAppName(),this._initAppConfig(),this.widget.setMetas({brand:this.getBrand()}),this.widget.addEvents({onLoad:this._onLoad.bind(this)})},destroy:function(){this._configInstance&&(this._configInstance.destroy&&this._configInstance.destroy(),this._configInstance=null),this.widget=null,this._fetchAppNamePromise=null,this._parent.apply(this,arguments)},render:function(){var e=this,t=e.container,n=e.elements,i=e.widget,s=e.getAppName();return i.body.empty(),(s?Promise.resolve(s):e._fetchAppNamePromise).then(function(s){n.appTile=e.createAppTile(),n.appTile.render().inject(t),t.setAttribute("title",s),t.inject(i.body)}),e},getAppName:function(){return this.widget.getValue("appName")||""},fetchAppName:function(){var e=this,t=e.getAppName();return t?Promise.resolve(t):new Promise(function(t,n){s.getAppInfo({appId:e.getAppId(),onComplete:function(n){var i=n.title||"";e.widget.setValue("appName",i),t(i)},onFailure:n})})},getAppId:function(){return this.widget.getValue("id")||""},getBrand:function(){return this.widget.getValue("brand")||""},getTitle:function(){return this.widget.getValue("title")||""},getBEData:function(){return JSON.parse(this.widget.getValue("beData")||"{}")},setBEData:function(e){this.widget.setValue("beData",JSON.stringify(e||{}))},getBEId:function(){return this.widget.getValue("beId")||""},getBMId:function(){return this.widget.getValue("reference")||""},getPlatformId:function(){return top.require("DS/Dashboard/PublicAPI")._getGlobalPlatformId()},showLoading:function(){t.mask(this.widget.body)},hideLoading:function(){t.unmask(this.widget.body)},hasConfig:function(){return!!this.getConfig()},getConfig:function(){return this.APP_CONFIG},createAppTile:function(){return new i({appId:this.getAppId(),name:this.getAppName(),brand:this.getBrand()})},_initWidgetTitle:function(){var e=this.widget,t=this.getAppName();window.top.UWA.Widgets.instances.forEach(function(n){n.id===e.id&&(n.environment.wp.originalTitle=t)}),e.setTitle(this.getTitle())},_initAppConfig:function(){var e=this.widget.getValue("APP_CONFIG")||"";this.APP_CONFIG=e?JSON.parse(e):void 0},_onLoad:function(){var e=this,t=Promise.resolve();return e._fetchAppNamePromise.then(function(){e._initWidgetTitle()}),e.hasConfig()?t=e._loadConfig():e.render(),t},_loadConfig:function(){var e=this;const t=e.getConfig();return e.showLoading(),n.updateConfig(t).then(function(){return new Promise(function(n,i){var s=(t.modules.find(function(e){return e.starter})||{}).starter;if(!s)throw new Error("No starter module found!");require([s],function(t){e.hideLoading(),e._configInstance=new t({widget:e.widget,parent:e}),n()},function(t){var n=e.widget.body;e.hideLoading(),n.empty().addClassName("error"),n.textContent='Fail to require starter module: "'+s+'" - '+t,console.error("Fail to require starter module: ",t),i(t)})})})}})});