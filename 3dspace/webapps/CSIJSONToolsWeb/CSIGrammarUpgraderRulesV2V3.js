"undefined"==typeof define&&(define=function(e){RulesV2V3=e(),define=void 0}),define("DS/CSIJSONToolsWeb/CSIGrammarUpgraderRulesV2V3",["DS/CSIJSONToolsWeb/CSIGrammarUpgraderJsonField","DS/CSIJSONToolsWeb/CSIGrammarUpgraderPropertiesParser"],function(e,r){"use strict";const n={parser_:void 0,grammarVersion:function(){const r=Math.min(3,this.parser_.getCurrentFileMaxGrammarVersion());return new e("grammarVersion",{grammarVersion:r})},implementation:function(r){const n=r.getValue();if(this.parser_.isFunctionFile()||this.parser_.isCommandFile()){const t={};if(n.hasOwnProperty("library"))return t.implementation={name:"library",version:2,settings:{library:n.library}},new e("implementation",t);if(n.hasOwnProperty("javaClassPath"))return t.implementation={name:"java",version:1,settings:{javaClassPath:n.javaClassPath}},new e("implementation",t);if(n.hasOwnProperty("name")&&n.hasOwnProperty("version")&&n.hasOwnProperty("settings"))return r}else if(this.parser_.isTypeFile()||this.parser_.isPoolFile()){const r={implementation:{}};return n.hasOwnProperty("library")&&(r.implementation.library=n.library,r.implementation.version=2),n.hasOwnProperty("jsModule")&&(r.implementation.jsModule=n.jsModule),n.hasOwnProperty("javaClassPath")&&(r.implementation.javaClassPath=n.javaClassPath,r.implementation.version=2),new e("implementation",r)}console.warn('GrammarUpdater : bad "implementation" in V2 '+JSON.stringify(n))},onCall:function(r){const n=r.getValue(),t={onCall:{}};return this.parser_.parseObject(n,t.onCall,this.parser_.ParsingOrder.signature,2),new e("onCall",t)},signature:function(n,t){const a=n.getValue(),i={};if(i[t]={},a.hasOwnProperty("parameters")){const e=r.parseV2(a.parameters).upgradeV2();e.length>0&&(i[t].parameters=e)}else a.hasOwnProperty("type")&&(i[t].type=a.type,a.hasOwnProperty("desc")&&(i[t].desc=a.desc));return new e(t,i)},in:function(e){return this.signature(e,"in")},out:function(e){return this.signature(e,"out")},answers:function(e){return this.signature(e,"answers")},definition:function(n){const t=n.getValue(),a={};return t instanceof Array?(a.definition=r.parseV2(t).upgradeV2(),new e("definition",a)):n},progress:function(e){return this.signature(e,"progress")},throwError:function(e){return this.signature(e,"throwError")},importCommandsFromPool:function(r){const n=r.getValue(),t={imports:[]};if(n instanceof Array)for(let e=0;e<n.length;++e)t.imports.push({pool:n[e]});return new e("imports",t)}};return n});