"undefined"==typeof define&&(define=function(e){RulesV1V2=e(),define=void 0}),define("DS/CSIJSONToolsWeb/CSIGrammarUpgraderRulesV1V2",["DS/CSIJSONToolsWeb/CSIGrammarUpgraderJsonField","DS/CSIJSONToolsWeb/CSIGrammarUpgraderPropertiesParser"],function(e,n){"use strict";const r={parser_:void 0,grammarVersion:function(){const n=Math.min(2,this.parser_.getCurrentFileMaxGrammarVersion());return new e("grammarVersion",{grammarVersion:n})},languageLibrary:function(n){const r=n.getField(),t=n.getValue(),i={};return this.parser_.isFunctionFile()||this.parser_.isCommandFile()?(i.implementation={library:t},this.implementation(new e("implementation",i))):this.parser_.isTypeFile()||this.parser_.isPoolFile()?(i.implementation={},i.implementation[r]=t,i.implementation.version=2,new e("implementation",i)):void console.warn('GrammarUpdater : bad "implementation" in V1 of '+JSON.stringify(t))},library:function(e){return this.parser_.isCustomImplFile()?e:r.languageLibrary(e)},javaClassPath:function(e){return r.languageLibrary(e)},implementation:function(n){const r=n.getValue(),t={};if(this.parser_.isFunctionFile()||this.parser_.isCommandFile()){if(r.hasOwnProperty("library"))return t.implementation={name:"library",version:2,settings:{library:r.library}},new e("implementation",t);if(r.hasOwnProperty("javaClassPath"))return t.implementation={name:"java",version:1,settings:{javaClassPath:r.javaClassPath}},new e("implementation",t)}else if(this.parser_.isTypeFile()||this.parser_.isPoolFile()){if(r.hasOwnProperty("library"))return t.implementation={library:"library",version:2},new e("implementation",t);if(r.hasOwnProperty("javaClassPath")){var i=void 0!==r.version?r.version:1;return t.implementation={javaClassPath:r.javaClassPath,version:i},new e("implementation",t)}}console.warn('GrammarUpdater : could not read "library" from "implementation"')},onCommand:function(n,r){const t=n.getValue(),i={};return i[r]={},this.parser_.parseObject(t,i[r],this.parser_.ParsingOrder.signature,1),new e(r,i)},onCall:function(e){return this.onCommand(e,"onCall")},onBeginParameters:function(e){return this.onCommand(e,"onBeginParameters")},onCommandParameters:function(e){return this.onCommand(e,"onCommandParameters")},onEndParameters:function(e){return this.onCommand(e,"onEndParameters")},signature:function(r,t){const i=r.getValue(),a={};if(a[t]={},"string"==typeof i)"none"!==i&&(a[t].type=i);else if("object"==typeof i){const e=n.parseV1(i).upgradeV2();e.length>0&&(a[t].parameters=e)}return i.hasOwnProperty("type")&&(a[t].type=i.type,i.hasOwnProperty("desc")&&(a[t].desc=i.desc)),new e(t,a)},definition:function(r){const t=r.getValue(),i={};return t instanceof Object&&!(t instanceof Array)?(i.definition=n.parseV1(t).upgradeV2(),new e("definition",i)):r},in:function(e){return this.signature(e,"in")},answers:function(e){return this.signature(e,"answers")},out:function(e){return this.signature(e,"out")},importCommandsFromPool:function(n){const r=n.getValue(),t={imports:[]};if(r instanceof Array)for(let e=0;e<r.length;++e)t.imports.push({pool:r[e]});return new e("imports",t)}};return r});