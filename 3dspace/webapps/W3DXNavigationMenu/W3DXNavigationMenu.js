define("DS/W3DXNavigationMenu/NavigationMenu",["UWA/Core","UWA/String","UWA/Event","UWA/Element","UWA/Utils/Client","DS/UIKIT/DropdownMenu","DS/UIKIT/Tooltip","DS/UIKIT/Scroller","i18n!DS/W3DXNavigationMenu/assets/nls/NavigationMenuDefault","css!W3DXNavigationMenu/W3DXNavigationMenu"],function(e,t,n,a,i,o,c,s,l){"use strict";var m,r,d,u=null,p={},f={scrollMode:!1,itemActions:{share:{name:"share",text:"Share",fonticon:"forward"},rename:{name:"rename",text:"Rename",fonticon:"rss"},duplicate:{name:"duplicate",text:"Duplicate",fonticon:"copy"},manage:{name:"manage",text:"Manage",fonticon:"cog"},delete:{name:"delete",text:"Delete",fonticon:"trash"}},events:{onClick:function(e){var t,a=m.options.itemActions,i=n.getElement(e);i.hasClassName("item-action-cnt")||(i=i.getParent()),i&&(t=i.className.split(" ")[1]),t&&u&&a[t]&&a[t].callback&&a[t].callback(u)},onShow:function(){var e=this,t=e.getItem("items-cnt");document.querySelector(".item.search .item-search-cnt > input").focus(),e.options.target.addClassName("active"),t&&k(t,e),window.requestAnimationFrame(function(){d=function(){e.hide()},a.addEvent.call(document.body,"click",d),e.updatePosition()})},onHide:function(){this.options.target.removeClassName("active"),a.removeEvent.call(document.body,"click",d)}},itemTemplate:function(e){var t='<span class="item-text">'+e.name+"</span>";return e.fonticon&&(t+='<span class="item-icon fonticon fonticon-'+e.fonticon+'"></span>'),'<li class="item object d-'+e.modelId+" selectable"+(e.active?' selected"':'"')+">"+t+"</li>"},kb:!1,className:"ifwe-header-dd",renderTo:document.body,offset:{x:0,y:0},position:"bottom right",bound:!1},g=45;function h(e){var t,n=m.getBody();(t=n.getElement(".selected"))&&t.removeClassName("selected"),(t=n.getElement("."+e))&&(-1===t.className.indexOf("d-")&&(t=t.getParent().getParent()),t.addClassName("selected"))}function v(){m.getBody().getElement(".item-action").hide()}function y(e){m.getBody().getElement(".item-action").show(),e&&function(e){var t=m.getBody().getElement(".item-action");Object.keys(m.options.itemActions).map(function(e){t.getElement("."+e).hide()}),e.forEach(function(e){t.getElement("."+e).show()})}(e)}function b(e,t){m.getBody();(u=e)?y(t):v()}function E(e){var n=[],a="";return Object.keys(e).map(function(i){var o,c,s=e[i];c="",(o=s).fonticon&&(c+='<span class="item-icon fonticon fonticon-'+o.fonticon+'"></span>'),a=c+='<span class="item-action-cnt '+o.name+' item-text">'+t.escapeHTML(o.text)+"</span>",n.push({template:a,handler:function(e){s.callback&&s.callback(),h(s.name)},className:"global-actions-cnt selectable "+s.name,_type:"action"})}),n}function N(e,t,n){t||(t=f.itemTemplate);var a="";return r=[],e?(e.forEach(function(e){r.push(e),a+=t(e)}),{template:a+='<li class="item object nodb" style="display: none;"><span class="item-icon fonticon fonticon-info"></span><span class="item-text">'+(p.NoObjectFound?p.NoObjectFound:l.NoObjectFound)+"</span> </li>",id:"items-cnt",className:"items-cnt",_type:n}):{className:"loading-cnt",template:'<span class="item-text">'+l.Loading+"</span>"}}function S(t,a){var i=a.elements.container,o=e.extendElement(i.querySelector(".item.search")),c=e.extendElement(i.querySelector(".item.search input")),s=e.extendElement(i.querySelector(".item.search .item-search-clear"));t.elements.container.addEvent("click",function(e){var t,a=n.getElement(e);a.hasClassName("item")||(a=a.getParent()),(t=a.getAttribute("class").match(/d-([\w|\-]{1,})/i))&&t[1]&&u!==t[1]&&(this.options.target.removeClassName("active"),b(t[1]),h("d-"+u),this.dispatchEvent("onObjectSelect",u))}.bind(a)),o.addEvent("click",function(t){var a=m.elements.container;e.extendElement(a.querySelector(".item.search input")).focus(),n.stopPropagation(t)}.bind(a)),c.addEvent("click",n.stopPropagation),c.addEvent("keyup",function(e,t,n){var a,i,o,c=0;function s(){c=(new Date).getTime(),i=null,o=e.apply(n,a)}return function(){var l=(new Date).getTime(),m=t-(l-c);return n=n||this,a=arguments,m<=0?(clearTimeout(i),i=null,c=l,o=e.apply(n,a)):i||(i=setTimeout(s,m)),o}}(A.bind(null,c,t,a),500)),s.addEvent("click",function(e){n.stopPropagation(e),c.value="",A(c,t,a),c.focus()})}function A(e,t,n){e.value?a.addClassName.call(e.parentElement,"input-active"):a.removeClassName.call(e.parentElement,"input-active"),function(e,t,n){var a="",i="",o="";r.forEach(function(t){o=".d-"+t.modelId+",",t.name.toLowerCase().indexOf(e.trim().toLowerCase().escapeHTML())<0?a+=o:i+=o}),a=a.replace(/,$/,""),i=i.replace(/,$/,""),window.requestAnimationFrame(function(){var e=t.elements.container,o=i?e.getElements(i):[],c=e.getElement(".nodb");Array.prototype.forEach.call(a?e.getElements(a):[],function(e){e.setStyle("display","none")}),Array.prototype.forEach.call(o,function(e){e.setStyle("display","")}),i?c.setStyle("display","none"):c.setStyle("display",""),x(t,n,{itemNumber:o.length})})}(e.value,t,n)}function x(t,n,a){a||(a={});var i,o=t.elements,c=n.elements,s=o.scroller,l=Math.max(e.is(a.itemNumber)?a.itemNumber:o.container.querySelectorAll(".object").length-1,1);s&&(i=c.container.getPosition(document.body).y+c.container.getSize().height-o.container.getSize().height,s.elements.container.setStyles({height:g*l+2,"max-height":"calc(100vh - "+i+"px)"}))}function k(e,t){var n=e.elements,a=n.scroller;a||(n.scroller=a=new s({element:n.container,scrollbarsMargin:0}),x(e,t),i.Engine.firefox&&(a.elements.container.setStyle("display","block"),a.elements.content.setStyles({"padding-right":0,right:-21})),S(e,t))}return{create:function(n){n.nls&&(p=n.nls),n.target=n.menu||n.target;var a,i={target:n.target,itemActions:n.itemActions,globalActions:n.globalActions,addCallback:n.addCallback,items:n.items,itemTemplate:n.itemTemplate,type:n.type,position:"bottom left"},s=[];return e.createElement("div",{class:"fonticon fonticon-down-open item-actions-holder "}).inject(n.menu||n.target.getElement(".topbar-app-menu")),new c({position:"bottom",target:n.target,body:p.tooltipMenu?p.tooltipMenu:l.tooltipMenu,offset:{x:0,y:0}}),s.push(function(e){e||(e=f.itemActions);var n="";return Object.keys(e).map(function(a){var i=e[a];n+='<span class="item-action-cnt '+i.name+'"><div class="item-action-icon fonticon fonticon-'+i.fonticon+'"></div> <div class="item-action-name">'+(i.text||t.escapeHTML(t.capitalize(i.name)))+"</div></span>"}),{className:"item-action",template:n,_type:"action"}}(n.itemActions)),n.globalActions&&(s.push({className:"divider"}),s.push(E(n.globalActions))),n.addCallback&&s.push((a=n.addCallback,{template:'<div class="item-add-cnt"><span class="item-icon fonticon fonticon-plus"></span><span class="item-text">'+(p.AddItem?p.AddItem+"...":l.AddItem)+"</span></div>",handler:a,className:"add",_type:"action"})),s.push({className:"divider"}),s.push({template:'<span class="item-icon fonticon fonticon-search"></span><div class="item-search-cnt"><span class="item-search-clear fonticon fonticon-cancel-circled"></span><input type="text" class="form-control" placeholder="'+(p.Search?p.Search:l.Search)+'"> </div>',handler:null,className:"search",_type:"action"}),s.push({className:"divider"}),s.push(N(n.items,n.itemTemplate,n.type)),i.items=s,m=new o(e.merge(i,f)),v(),n.target.addEvent("click",function(e){var t=m.getItem("items-cnt");e.isVisible?e.hide():(e.show(),t&&x(t,e))}.bind(null,m)),m},setCurrentSelectedObject:function(e,t){b(e,t),e&&h("d-"+e)},selectCurrentItem:h,showItemActions:y,hideItemActions:v,setItems:function(e){var t;m.addItem(N(e)),t=m.getItem("items-cnt"),m.getBody().getElement(".loading-cnt").hide(),k(t,m)},destroy:function(){m&&m.destroy(),r.length=0,m=null}}});