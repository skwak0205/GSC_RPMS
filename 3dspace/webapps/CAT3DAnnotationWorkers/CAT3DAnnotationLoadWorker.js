!function(e){"use strict";var n=!1;e.onmessage=function(a){require(["DS/EasySax/EasySax","DS/Formats/CGRFile"],function(t,s){n=!0;var r,i,l,o,d,p,g,h=a.data.xmlData,u=a.data.loadingIndex,c=a.data.ctxTypes&&a.data.ctxTypes.length?a.data.ctxTypes:null,m=0,f=!0;function b(e){return e?parseFloat(e.replace?e.replace(",","."):e):void 0}function x(e){var n=e;return-1!==n.indexOf("&amp;")&&(n=n.replace(/&amp;/g,"&")),-1!==n.indexOf("&gt;")&&(n=n.replace(/&gt;/g,">")),-1!==n.indexOf("&lt;")&&(n=n.replace(/&lt;/g,"<")),-1!==n.indexOf("&quot;")&&(n=n.replace(/&quot;/g,'"')),-1!==n.indexOf("&#xD;&#xA;")&&(n=n.replace(/&#xD;&#xA;/g,"&#xA;")),-1!==n.indexOf("&#xD;")&&(n=n.replace(/&#xD;/g,"&#xA;")),n}var y=function(e,n,a){for(var t=[],s=e.split(" "),r=0;r<s.length;r++)if(" "!==s[r]&&""!==s[r]){var i=a?s[r]:b(s[r]);void 0!==i&&(!n||n&&-1===t.indexOf(i))&&t.push(i)}return t};var k,T=function(e){var n=e.attributes;if(delete e.attributes,n){var a=e.type;1===e.type&&function(e,n){var a=n.indexOf("#x&amp;",0);-1!==a?e.Text=n.substring(0,a):n.length&&(e.Text=n)}(e,n),30===e.type&&function(e,n){var a="#x&amp;",t=0,s=n.indexOf(a,t);if(-1!==s){for(e.NOAText=n.substring(t,s),t=s+a.length;-1!==s;)-1!==(s=n.indexOf(a,t))&&(t=s+a.length);a=";",-1!==(s=n.indexOf(a,t))&&(e.NOAType=n.substring(s+1,n.length))}}(e,n),n=function(e,n){var a,t,s,r,i,l=0,o={};if(1===e.type||2===e.type||30===e.type){-1!==(a=n.indexOf("#x&amp;",l))&&(l=a+"#x&amp;".length),-1!==(a=n.indexOf("#x&amp;",l))&&(i=n.substring(0,a),s=n.substring(l,a),o.hiddenText=s||void 0,l=a+"#x&amp;".length),a=n.indexOf("#x&amp;",l);for(var d=[];-1!==a;)i||(i=n.substring(0,a)),(s=n.substring(l,a))&&(30===e.type?-1===s.indexOf(";",0)&&d.push({address:s}):d.push({address:s})),l=a+"#x&amp;".length,a=n.indexOf("#x&amp;",l);-1===a&&0!==l&&(i||(i=n.substring(0,l)),(s=n.substring(l,n.length))&&30===e.type?-1===s.indexOf(";",0)&&d.push({address:s}):s&&d.push({address:s})),d.length&&(o.urls=d)}else{var p=[],g="";if(-1!==(a=n.indexOf("#x&amp;$)"))){if(i||(i=n.substring(0,a)),(t=n.split("amp;$)")).length){var h=t[1].split("#x&amp;");if(g=h[0],h.length>1)for(r=1;r<h.length;r++)p.push({address:h[r]})}}else if(-1!==(a=n.indexOf("#x&amp;"))&&(i||(i=n.substring(0,a)),(t=n.split("#x&amp;")).length>1))for(r=1;r<t.length;r++)p.push({address:t[r]});(g||p&&p.length)&&(o={urls:p.length>0?p:void 0,hiddenText:""!==g?g:void 0})}if(e.hyperlinksData&&e.hyperlinksData.length)return i||n;if((o.hiddenText||o.urls&&o.urls.length)&&(e.hyperlinksData=[],o.hiddenText&&e.hyperlinksData.push({type:-1,text:o.hiddenText}),o.urls&&o.urls.length))for(r=0;r<o.urls.length;r++)e.hyperlinksData.push({type:0,address:o.urls[r].address});return i||n}(e,n),0!==a&&1!==a&&2!==a&&30!==a&&(12===a||13===a||14===a||15===a||37===a||38===a||34===a?function(e,n){var a,t=0,s="^";if(-1!==(a=n.indexOf(s,t))&&(t=a+s.length,-1!==(a=n.indexOf(s,t))&&(t=a+s.length,-1!==(a=n.indexOf(s,t))&&(t=a+s.length),-1!==(a=n.indexOf(s,t))&&(t=a+s.length))),s=";",e.dimensionLimits={min:null,max:null},a=n.indexOf(s,t),e.dimensionLimits.min=b(n.substring(t,a)),t=a+s.length,a=n.indexOf(s,t),e.dimensionLimits.max=b(n.substring(t,a)),t=a+s.length,-1!==(a=n.indexOf(s,t)))e.nominalValue=n.substring(t,a),t=a+s.length,s="!",-1!==(a=n.indexOf(s,t))?e.tabLimit=n.substring(t,-1!==a?a:n.length):(a=n.indexOf("#x&amp;",t),e.tabLimit=n.substring(t,-1!==a?a:n.length));else if(s="#",-1!==(a=n.indexOf(s,t))&&-1===n.indexOf("#x&amp;",t)){a=n.indexOf(s,t),e.nominalValue=n.substring(t,a),t=a+s.length;var r={};if(-1!==(a=n.indexOf(s,t))?(r.name=n.substring(t,a),t=a+s.length,s=";",-1===(a=n.indexOf(s,t))&&(a=n.length)):(s="#x&amp;$)",-1!==(a=n.indexOf(s,t))?r.name=n.substring(t,a):(s=";",r.name=n.substring(t,a)),t=a+s.length),r.name){var i=n.substring(t,a);a=i.indexOf("!",0),r.variation=i&&-1!==a?i.substring(0,a):i,e.genTol=r}}else s="!",-1!==(a=n.indexOf(s,t))?(e.nominalValue=n.substring(t,a),t=a+s.length,s="#x&amp;$)"):s="#x&amp;$)"}(e,n):5===a||6===a||33===a?function(e,n){var a,t,s="^",r=0,i=[];if(5===e.type){-1!==(a=n.indexOf(s,r))&&(r=a+s.length),-1!==(a=n.indexOf(s,r))&&(r=a+s.length),s=";";for(var l=n.indexOf(s,r);-1!==l;)r=l+s.length,(t=-1!==(l=n.indexOf(s,r))?parseInt(n.substring(r,l),10):parseInt(n.substring(r,n.length),10))&&i.push(t)}else 6===e.type&&(-1!==(a=n.indexOf(s,r))&&(r=a+s.length,-1!==(a=n.indexOf(s,r))&&(r=a+s.length,-1!==(a=n.indexOf(s,r))&&(r=a+s.length))),s="#x&amp;$)",(t=-1!==(a=n.indexOf(s,r))?parseInt(n.substring(r,a),10):parseInt(n.substring(r,n.length),10))&&i.push(t));i.length&&(e.datumTargets=i)}(e,n):7!==a&&8!==a&&9!==a&&10!==a&&11!==a&&17!==a&&18!==a&&19!==a&&20!==a&&21!==a&&22!==a&&23!==a&&24!==a&&25!==a&&26!==a&&27!==a&&28!==a||function(e,n){var a="^",t=0,s=n.indexOf(a,t);if(a="@#",-1!==(s=n.indexOf(a,0))){var r=n.split(a);r.length&&(0!==s&&r.splice(0,1),e.toleranceZoneValue=b(r[10]))}if(a=";",-1!==(s=n.indexOf("!",t))){var i,l,o=n.indexOf(":",t);t=s+a.length,s=n.indexOf(a,t),i=b(n.substring(t,s)),t=s+a.length,s=n.indexOf(a,t),l=b(-1!==o?n.substring(t,o):-1!==(s=n.indexOf("#x&amp;$)",t))?n.substring(t,s):n.substring(t,n.length)),e.toleranceUnitBasis={val1:i,val2:l}}}(e,n),function(e,n){var a=[],t=n.indexOf(":");if(-1!==t){var s=n.substring(t+":".length,n.length).split(":");if(s.length)for(var r=0;r<s.length;r++){var i=parseInt(s[r],10);null!=i&&a.push(i)}}0!==a.length&&(e.associatedBasicDims=a)}(e,n))}},C=function(e){return r.openSceneGraph(new Uint8Array(function(e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var a=new ArrayBuffer(e.length/4*3);return function(e,a){var t,s,r,i,l,o,d,p=n.indexOf(e.charAt(e.length-1)),g=n.indexOf(e.charAt(e.length-2)),h=e.length/4*3;64===p&&h--,64===g&&h--;var u=0,c=0;for(t=a?new Uint8Array(a):new Uint8Array(h),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),u=0;u<h;u+=3)s=n.indexOf(e.charAt(c++))<<2|(l=n.indexOf(e.charAt(c++)))>>4,r=(15&l)<<4|(o=n.indexOf(e.charAt(c++)))>>2,i=(3&o)<<6|(d=n.indexOf(e.charAt(c++))),t[u]=s,64!==o&&(t[u+1]=r),64!==d&&(t[u+2]=i)}(e,a),a}(e)),function(){},{processText:f,withBlankingRep:!0})},v=function(a){n&&(a.done&&(a.hasTesseletedTextReps=!d||o,h=null,u=null,n=!1,f=!1,r=null,i=null,l=null,c=null,o=null,d=null,m=0),a&&(a.processText=f),e.postMessage(a))},O=function(){v({done:!0,loadingIndex:u,loadingPartiallyFailed:!0})},A=function(e,a){if(n){var t,s=a();if(!1!==s)switch(p=!1,e){case"Functional_Tolerancing_Annotation":s.Version&&(g=b(s.Version)),l.push({name:e,node:{}});break;case"AnnotationSet":m++;var r={nodeXMLtype:e,version:g};s.ContextType&&(r.contextType=b(s.ContextType)),s.Standard&&(r.standard=s.Standard),c&&-1===c.indexOf(r.contextType)?v({node:r,done:!0,loadingIndex:u,loadingCancelled:!0,annotSetID:m}):l.push({name:e,node:r});break;case"RootTTRSs":case"RefFrame":l.push({name:e,node:{nodeXMLtype:e}});break;case"TPSView":var i={nodeXMLtype:e};s.Version&&(i.version=b(s.Version)),l.push({name:e,node:i});break;case"TPS":d=!0;var h={nodeXMLtype:e};s.Att&&(h.attributes=s.Att),s.Ref&&(h.ref=b(s.Ref)),s.Val&&(h.val=b(s.Val)),s.Def&&(h.def=b(s.Def)),l.push({name:e,node:h});break;case"TPSCap":var f={nodeXMLtype:e};l.push({name:e,node:f}),s.Att&&(f.attributes=s.Att),"1"===s.ActVieSt&&s.ActVie&&(f.view=b(s.ActVie)),s.RepMngt&&(f.RepMngt=b(s.RepMngt)),s.InstMngt&&(f.InstMngt=b(s.InstMngt)),s.ClipPla&&(f.ClipPla=b(s.ClipPla)),s.FavCtxMngt&&(f.FavCtxMngt=b(s.FavCtxMngt)),s.Version&&(f.version=b(s.Version)),s.FeatureVersion&&(f.FeatureVersion=b(s.FeatureVersion));break;case"TPSCG":var k={nodeXMLtype:e};l.push({name:e,node:k}),s.Att&&(k.attributes=s.Att);break;case"TPSAttribute":var T={nodeXMLtype:e};if(l.push({name:e,node:T}),s.Categ&&(T.category=s.Categ),s.AttrType){var C=s.AttrType.split(".");C&&2===C.length?T.attrType=parseFloat(C[1]):T.attrType=parseFloat(s.AttrType)}break;case"TPSAttributes":var A={nodeXMLtype:e};l.push({name:e,node:A}),s.Categ&&(A.category=s.Categ);break;case"Rep":"2"===s.Type?l.push({name:"Rep2D",node:l[l.length-1].node}):"3"===s.Type?l.push({name:"Rep",node:l[l.length-1].node}):"4"===s.Type&&l.push({name:"CappingRep",node:l[l.length-1].node});break;case"SurfaceNormalRep":l.push({name:"SurfaceNormalRep",node:l[l.length-1].node});break;case"Buf":"Rep"===l[l.length-1].name&&l.push({name:e,node:l[l.length-1].node});break;case"AlternativeTextBuf":"Rep"===l[l.length-1].name&&(o=!0,l.push({name:e,node:l[l.length-1].node}));break;case"TPSId":s.Name&&(l[l.length-1].node.name=x(s.Name)),s.Att&&(l[l.length-1].node.attributes=s.Att),s.Uuid&&(l[l.length-1].node.uuid=s.Uuid);break;case"TPSLoc":s.Status&&(l[l.length-1].node.status=b(s.Status)),s.Id&&(l[l.length-1].node.tpsID=b(s.Id)),s.Type&&(l[l.length-1].node.type=b(s.Type));break;case"Standard":l[l.length-1].node.standards||(l[l.length-1].node.standards=[]);var S={};s.Title&&(S.title=x(s.Title)),s.Year&&(S.year=x(s.Year)),s.Code&&(S.code=x(s.Code)),l[l.length-1].node.standards.push(S);break;case"DefaultSpec":l[l.length-1].node.standardNorms||(l[l.length-1].node.standardNorms=[]);var I={};s.Type&&(I.type=x(s.Type)),s.SubType&&(I.subtype=x(s.SubType)),s.Code&&(I.code=x(s.Code)),s.Year&&(I.year=x(s.Year)),l[l.length-1].node.standardNorms.push(I);break;case"Symbol":var R,D=l[l.length-1].node.standardNorms;D[D.length-1].symbols||(D[D.length-1].symbols=[]),s.Name&&(R=s.Name),l[l.length-1].node.standardNorms[l[l.length-1].node.standardNorms.length-1].symbols.push(R);break;case"Value":p=!0;break;case"Hyperlink":l[l.length-1].node.hyperlinksData||(l[l.length-1].node.hyperlinksData=[]);var P={};s.AnchorText&&(P.anchorText=s.AnchorText),s.Address&&(P.address=s.Address),s.Type&&(P.type=b(s.Type)),s.AddressRelId&&(P.addressRelId=s.AddressRelId),l[l.length-1].node.hyperlinksData.push(P);break;case"HiddenText":l[l.length-1].node.hyperlinksData||(l[l.length-1].node.hyperlinksData=[]);var V={type:-1};s.Text&&(V.text=x(s.Text)),l[l.length-1].node.hyperlinksData.push(V);break;case"Failure":l[l.length-1].node.failureModes||(l[l.length-1].node.failureModes=[]);var M={};null!==s.Criticity&&void 0!==s.Criticity&&(M.crit=s.Criticity),l[l.length-1].node.failureModes.push(M);break;case"Description":case"TPSs":case"Thumbnail":case"Datum":case"Views":case"Caps":case"CGs":l.push({name:e,node:l[l.length-1].node});break;case"VisibleCG":t="0"===s.Cut?"UncutCGs":e,l[l.length-1].node[t]||(l[l.length-1].node[t]=[]),l.push({name:e,node:l[l.length-1].node,Uncut:"0"===s.Cut});break;case"HiddenBodyInst":case"VisibleBodyInst":l.push({name:e,node:l[l.length-1].node});break;case"VisibleCompRelId":t="0"===s.Cut?"UncutCompRelId":e,l[l.length-1].node[t]||(l[l.length-1].node[t]=[]),l.push({name:e,node:l[l.length-1].node,Uncut:"0"===s.Cut});break;case"VisibleCompXmlId":t="0"===s.Cut?"UncutCompXmlId":e,l[l.length-1].node[t]||(l[l.length-1].node[t]=[]),l[l.length-1].node[t].push([]),l.push({name:e,node:l[l.length-1].node,Uncut:"0"===s.Cut});break;case"Cam":l[l.length-1].node.camera={},l[l.length-1].node.camera.angle=b(s.Angle),l[l.length-1].node.camera.mode=s.Mode,l[l.length-1].node.camera.type=s.Type,l[l.length-1].node.camera.zoom=b(s.Zoom),s.Nature&&(l[l.length-1].node.camera.nature=s.Nature),l.push({name:e,node:l[l.length-1].node});break;case"Po":case"Di":case"Ze":case"Ta":l.push({name:e,node:l[l.length-1].node});break;case"Math":l[l.length-1].node.planeInfos={},l.push({name:e,node:l[l.length-1].node});break;case"Or":case"No":l.push({name:e,node:l[l.length-1].node});break;case"MultiClipping":l[l.length-1].node.multiClipping={},l[l.length-1].node.multiClipping.inverted=b(s.Inverted),l.push({name:e,node:l[l.length-1].node});break;case"CircularClipping":l[l.length-1].node.clipping2D={type:"circular"},l.push({name:e,node:l[l.length-1].node});break;case"PolygonalClipping":l[l.length-1].node.clipping2D={type:"polygonal",points:[]},l.push({name:e,node:l[l.length-1].node});break;case"Center":case"Radius":case"SketchOrigin":case"SketchNormal":case"Point":l.push({name:e,node:l[l.length-1].node});break;case"PointsDef":l[l.length-1].node.multiClipping.pointsDef=[],l.push({name:e,node:l[l.length-1].node});break;case"ReframeArea":l[l.length-1].node.reframeArea={cornerX:b(s.CornerX),cornerY:b(s.CornerY),width:b(s.Width),length:b(s.Length)};break;case"SCSRestrictedArea":l[l.length-1].node.scsReframeArea={upperLimit:null,lowerLimit:null};break;case"UpperLimit":case"LowerLimit":l.push({name:e,node:l[l.length-1].node});break;case"TTRS":"RootTTRSs"===l[l.length-1].name?l.push({name:e,node:{nodeXMLtype:e}}):l.push({name:e,node:l[l.length-1].node});break;case"ReferencedCGs":case"GeoP":case"TRep":case"Grou":case"OccId":l.push({name:e,node:l[l.length-1].node});break;case"AttrLink":var F={};s.Name&&(F.name=s.Name),s.Uuids&&(F.uuids=y(s.Uuids,!0,!0)),l[l.length-1].node.pointedFeatureUuids||(l[l.length-1].node.pointedFeatureUuids=[]),l[l.length-1].node.pointedFeatureUuids.push(F);break;case"Param":l[l.length-1].node.params||(l[l.length-1].node.params=[]);var N={};s.Name&&(N.Name=s.Name),s.Magnitude&&(N.Magnitude=s.Magnitude),s.Value&&(N.Value="String"===N.Magnitude?x(s.Value):s.Value),s.Hidden&&(N.Hidden=s.Hidden),l[l.length-1].node.params.push(N),l.push({name:e,node:l[l.length-1].node});break;case"AuxFeatIndicator":l[l.length-1].node.auxiliaryFeatures={annotations:[],cgs:[]},l.push({name:e,node:l[l.length-1].node});break;case"OrientationPlaneDF":case"OrientationPlaneAngleTED":case"IntersectionPlaneDF":case"CollectionPlaneDF":case"OrientationPlaneAngleCG":l.push({name:e,node:l[l.length-1].node})}else O()}},S=function(e,a){if(n)if(p){var t=l[l.length-1].node.standardNorms;if(t){t[t.length-1].symbols||(t[t.length-1].symbols=[]);var s=x(a(e));t[t.length-1].symbols.push(s)}}else if(l.length){var r,i,o,d,g=l[l.length-1].name,h=l[l.length-2]?l[l.length-2].name:null,u=l[l.length-1].node;switch(g){case"Buf":(r=C(a(e)))&&r.reps&&(u.reps||(u.reps=[]),u.reps.push(r));break;case"AlternativeTextBuf":f=!1,(r=C(a(e)))&&r.reps&&(u.reps||(u.reps=[]),u.reps.push(r));break;case"Rep2D":break;case"CappingRep":(r=C(a(e)))&&r.reps&&(u.cappingRep=r);break;case"SurfaceNormalRep":(r=C(a(e)))&&r.reps&&(u.surfaceNormalRep=r);break;case"Thumbnail":var c=a(e);c&&(u.thumbnail=c);break;case"Caps":case"CGs":(i=y(a(e),!0)).length&&(u[g]=i);break;case"VisibleCG":var m=y(a(e),!0);1===m.length&&l[l.length-1].Uncut&&u.UncutCGs.push(m[0]);break;case"TPSs":(i=y(a(e),!0)).length&&(u[g]=i);break;case"UpperLimit":i=y(a(e),!0),u.scsReframeArea&&i.length&&(u.scsReframeArea.upperLimit=i);break;case"LowerLimit":i=y(a(e),!0),u.scsReframeArea&&i.length&&(u.scsReframeArea.lowerLimit=i);break;case"HiddenBodyInst":case"VisibleBodyInst":(o=y(a(e),!0)).length&&(u[g]||(u[g]=[]),u[g].push(o));break;case"VisibleCompRelId":var k=y(a(e),!0,!0);1===k.length&&(l[l.length-1].Uncut?u.UncutCompRelId.push(k[0]):u[g].push(k[0]));break;case"OccId":var T=y(a(e),!0,!0);1===T.length&&(!l[l.length-2].Uncut&&u.VisibleCompXmlId?u.VisibleCompXmlId[u.VisibleCompXmlId.length-1].push(T[0].split("#")[1]):u.UncutCompXmlId&&u.UncutCompXmlId[u.UncutCompXmlId.length-1].push(T[0].split("#")[1]));break;case"Po":u.camera&&(d=y(a(e),!1),u.camera.position={x:d[0],y:d[1],z:d[2]});break;case"Di":u.camera?(d=y(a(e),!1),u.camera.direction={x:d[0],y:d[1],z:d[2]}):u.planeInfos&&(d=y(a(e),!1),u.planeInfos.direction={x:d[0],y:d[1],z:d[2]});break;case"Ze":u.camera&&(d=y(a(e),!1),u.camera.zenith={x:d[0],y:d[1],z:d[2]});break;case"Ta":u.camera&&(d=y(a(e),!1),u.camera.target={x:d[0],y:d[1],z:d[2]});break;case"Or":u.planeInfos&&(d=y(a(e),!1),u.planeInfos.origin={x:d[0],y:d[1],z:d[2]});break;case"No":u.planeInfos&&(d=y(a(e),!1),u.planeInfos.normal={x:d[0],y:d[1],z:d[2]});break;case"Views":(i=y(a(e),!0)).length&&"MultiClipping"===h?u.multiClipping.views=i:i.length&&(u[g]=i);break;case"Point":"PointsDef"===h?(d=y(a(e),!1))&&3===d.length&&u.multiClipping.pointsDef.push({x:d[0],y:d[1],z:d[2]}):"PolygonalClipping"===h&&(d=y(a(e),!1))&&2===d.length&&u.clipping2D.points.push({x:d[0],y:d[1]});break;case"Center":"CircularClipping"===h&&(d=y(a(e),!1))&&2===d.length&&(u.clipping2D.center={x:d[0],y:d[1]});break;case"Radius":"CircularClipping"===h&&(u.clipping2D.radius=b(a(e)));break;case"SketchNormal":case"SketchOrigin":"MultiClipping"===h&&(d=y(a(e),!1))&&(u.multiClipping[g]={x:d[0],y:d[1],z:d[2]});break;case"TTRS":"TPSCG"!==h&&"TPS"!==h&&"TPSAttribute"!==h||(u.ttrs=y(a(e),!0));break;case"ReferencedCGs":"TTRS"!==h&&"TPS"!==h&&"TPSAttribute"!==h||(u.referencedCGs=y(a(e),!0));break;case"TRep":u.trep=y(a(e),!0);break;case"GeoP":var v=y(a(e),!1);v.length&&(u[g]||(u[g]=[]),u[g].push(v));break;case"Datum":u.datums=y(a(e),!0);break;case"Grou":u.grou=y(a(e),!0);break;case"Param":u.params=a(e);break;case"Description":if(u.failureModes&&u.failureModes.length){var O=u.failureModes[u.failureModes.length-1];O.descriptions||(O.descriptions=[]),O.descriptions.push(x(a(e)))}break;case"OrientationPlaneDF":case"OrientationPlaneAngleTED":case"IntersectionPlaneDF":case"CollectionPlaneDF":i=y(a(e),!0),u.auxiliaryFeatures&&i&&i.length&&(u.auxiliaryFeatures.annotations=u.auxiliaryFeatures.annotations.concat(i));break;case"OrientationPlaneAngleCG":i=y(a(e),!0),u.auxiliaryFeatures&&i&&i.length&&(u.auxiliaryFeatures.cgs=u.auxiliaryFeatures.cgs.concat(i))}}},I=function(e){if(n&&l.length){var a=l[l.length-1].name,t=l[l.length-2]?l[l.length-2].name:null,s=l[l.length-1].node;if(a===e)switch(e){case"TPS":case"TPSView":case"TPSCap":case"TPSCG":T(s),v({node:s,done:!1,loadingIndex:u,annotSetID:m}),l.pop();break;case"TPSAttribute":"TPSAttribute"===t||"TPSAttributes"===t?(l[l.length-2].node.childrenAttr||(l[l.length-2].node.childrenAttr=[]),l[l.length-2].node.childrenAttr.push(s)):v({node:s,done:!1,loadingIndex:u,annotSetID:m}),l.pop();break;case"TPSAttributes":case"RefFrame":v({node:s,done:!1,loadingIndex:u,annotSetID:m}),l.pop();break;case"TTRS":"RootTTRSs"===t&&v({node:s,done:!1,loadingIndex:u,annotSetID:m}),l.pop();break;case"AnnotationSet":T(s),v({node:s,done:!1,loadingIndex:u,annotSetID:m}),l.pop();break;case"Functional_Tolerancing_Annotation":l.pop(),v({node:s,done:!0,loadingIndex:u}),n=!1;break;default:l.pop()}else"CappingRep"!==a&&"Rep2D"!==a||"Rep"!==e||l.pop()}};k=h,l=[],i||(i=new t),r||(r=new s(void 0,void 0,void 0,!0)),i.on("startNode",A),i.on("textNode",S),i.on("endNode",I),i.on("error",O),i.parse(k)})}}(this);