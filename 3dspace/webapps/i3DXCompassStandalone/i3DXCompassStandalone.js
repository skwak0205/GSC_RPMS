require(["UWA/Core","UWA/Utils","DS/i3DXCompass/i3DXCompass","DS/i3DXCompassServices/i3DXCompassPubSub","DS/i3DXCompass/Feature","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(o,e,s,a,n,i){"use strict";var t,r=o.extendElement(document.querySelector(".column-left")),l=null,d=null,c={},p=!1,u=function(){return"undefined"!=typeof compassRichWithCef&&compassRichWithCef},m=function(){return window.ds&&"MOBILE"===window.ds.env};a.subscribe("initializeCompassStandalone",function(o){b(o)}),window.location.hash&&window.location.hash.substring(1,window.location.hash.length).split("/").forEach(function(o){var e=o.split(":");c[e[0]]=e[1]}),r.addClassName("compass-standalone"),c.userId||r.addClassName("compass-standalone-public"),c.emulateMobile&&(p=!0),window.addEventListener("hashchange",function(){u()?(window.location.hash.substring(1,window.location.hash.length).split("/").forEach(function(o){var e=o.split(":");c[e[0]]=e[1]}),(n.getExtraWhereUsedRoles()||c.processes)&&n.getExtraWhereUsedRoles()!==c.processes?window.location.reload():s._private._loadQuadrant(c.quadrant)):window.location.reload()},!1),u()?o.extendElement(document.querySelector("body")).addClassName("compassRichWithCef"):o.extendElement(document.querySelector("body")).addClassName("compass-standalone-v3"),c.quadrant&&s._private._setQuadrant(c.quadrant);var w="",f="";if(m())l=e.buildUrl(window.location.href.replace(window.location.hash,""),"../../"),l+="enovia/";else if("dsrtv:"===window.location.protocol)l=window.location.href.replace(window.location.hash,"");else{l=e.buildUrl(window.location.href.replace(window.location.hash,""),"../../"),w=e.buildUrl(window.location,"assets/PassportStub"),f=e.buildUrl(l,"resources/AppsMngt/user/proxyticket");var h=l+"common/emxCrossDomainProxy.jsp",v=l+"common/emxDownloadPlatform.jsp";o.Data.proxies.ajax=v,o.Data.proxies.passport=h}var g=o.Utils.getQueryString(window.location.href,"addinmode");g&&(t={value:g}),c.links&&"false"!==c.links&&(d="V2",document.querySelector("body").addClassName("support-quick-link-fix-mobile-app"));var b=function(e){c.processes&&n.setExtraWhereUsedRoles(c.processes),!c.platform&&u()&&(c.platform="OnPremise",console.warn("Legacy usage of the compass, Platform is MANDATORY")),s.initialize({proxy:"passport",compassTarget:"compass-container",appsTarget:"my-apps-container",closable:!(!u()&&!m()),version:d,addinMode:t,platform:c.platform||null,myAppsBaseUrl:e&&e.myAppsBaseUrl||l,passportUrl:e&&e.passportUrl||w,userId:c.userId,proxyTicketUrl:e&&e.myAppsBaseUrl||f,launchOnSameDomain:function(e){return o.log(e+" is on same domain"),window.open(e,"_blank"),!0},lang:c.lang||"en",onOpen:function(){r.addClassName("opened")},onClose:function(){u()||r.removeClassName("opened")},enableWidgetDrag:function(){},onRoleChange:function(e,s){o.log("role change"),o.log(e+":"+s)}}),window.ds&&"MOBILE"===window.ds.env&&a.subscribe("private.viewIsReady",function(o){s.showAccordion()})};"dsrtv:"===window.location.protocol?b():window.ds&&"MOBILE"===window.ds.env||(p&&(window.ds={env:"MOBILE"}),i.getServiceUrl({config:{lang:c.lang||"en",userId:c.userId,myAppsBaseUrl:l},serviceName:"3dpassportnta",onComplete:function(o){b({passportUrl:o&&o[0]&&o[0].url.replace("/cas","")})}})),a.subscribe("compassEvent",function(o){s.showAccordion()})});