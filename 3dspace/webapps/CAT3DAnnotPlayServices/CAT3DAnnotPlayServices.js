define("DS/CAT3DAnnotPlayServices/CAT3DAnnotPlayServices",["DS/Selection/CSOManager","DS/CATWebUXPreferences/CATWebUXPreferencesManager","DS/CATWebUXPreferences/CATWebUXPreferencesUtils","DS/CATWebUXSelectionManager/CATWebUXSelectionManager","DS/CAT3DAnnotationUtils/CAT3DAnnotationStorageController"],function(e,t,n,r,i){"use strict";return{getContextualCommandList:function({ctxViewer:t,getSelectedAnnotationsVisibilityFlag:n}){let r,i=[];if(!t)return i;let o=e.get(),a=t.getRootBagPath();const l=e.get().map(e=>{if(a.isAParentOf(e.pathElement)||e.pathElement.getLastElement(!0).getAnnotationClassType)return e.pathElement}).filter(e=>{if(e)return e});if(0===l.length)return i;let c=!1,s=!1;for(r=0;r<l.length;r++){if(!c){let e="function"==typeof n&&n();if(!0===e||!1===e||void 0===e){let t;t=1===o.length&&(o[0].pathElement.getLastElement(!0).getAnnotationClassType&&"tpsAnnotationSet"===o[0].pathElement.getLastElement(!0).getAnnotationClassType()||!o[0].pathElement.getLastElement(!0).getAnnotationClassType)?e?"CAT3DAnnotationSetHideHdr":"CAT3DAnnotationSetShowHdr":e?"CAT3DAnnotationHideHdr":"CAT3DAnnotationShowHdr",i.push({line:1,name:e?"CAT3DAnnotationHideStr":"CAT3DAnnotationShowStr",hdr_list:[t]}),c=!0}}let e=l[r].getParentPath(),t=l[r].getLastElement(!0);(t.getAnnotationClassType&&"tpsAnnotationSet"!==t.getAnnotationClassType()||!t.getAnnotationClassType)&&1===l.length&&(s||e&&"RootBag"!==e.getLastElement(!0).name&&(i.push({line:1,name:"CAT3DAnnotationLevelSelectorStr",hdr_list:["CAT3DAnnotationLevelSelectorHdr"]}),s=!0))}return{cmdList:i}},initSelAndPrefMgrs:function({ctxViewer:e}){let o=r.getSelectionManager({context:e});o.setActiveState(!0);let a,l=t.getPreferenceManager({context:e.getFrameWindow()}),c={};if(l){l.setUnitsPreferencesDisplayFlag(!0),l.setDisplayPreferencesDisplayFlag(!0),l.set3DSelectionPreferencesDisplayFlag(!0);let t=i.getPreferenceDefinitions({attributePrefs:!1});a=t[0].id,l.addPreferences(t),c.CATWebUXPreferences_GravitationalEffects=l.subscribe("CATWebUXPreferences_GravitationalEffects",function(t){e&&e.getViewer()&&e.getViewer().currentViewpoint&&e.getViewer().currentViewpoint.control&&(e.getViewer().currentViewpoint.getControl().setRotationRolling(!t),e.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!t))}),c.CATWebUXPreferences_ProjectionType=l.subscribe("CATWebUXPreferences_ProjectionType",function(t){e&&e.getViewer()&&e.getViewer().currentViewpoint&&e.getViewer().currentViewpoint.setProjectionType(t)}),c.CATWebUXPreferences_Select3DGeometry=l.subscribe("CATWebUXPreferences_Select3DGeometry",function(e){o&&o.setPicking(e?0:1)}),c.CATWebUXPreferences_SelectParentReferenceOr3DShape=l.subscribe("CATWebUXPreferences_SelectParentReferenceOr3DShape",function(e){o&&o.selectParentReference("select3DShape"!==e)});let r=n.getPreference("CATWebUXPreferences_GravitationalEffects","boolean");e&&e.getViewer()&&"boolean"==typeof r&&(e.getViewer().currentViewpoint.getControl().setRotationRolling(!r),e.getViewer().currentViewpoint.getControl().setRollingForTouchAvailable(!r));let s=n.getPreference("CATWebUXPreferences_ProjectionType","int");e&&e.getViewer()&&(0===s||1===s)&&e.getViewer().currentViewpoint.setProjectionType(s);let g=n.getPreference("CATWebUXPreferences_Select3DGeometry","boolean");o&&"boolean"==typeof g&&o.setPicking(g?0:1);let f=n.getPreference("CATWebUXPreferences_SelectParentReferenceOr3DShape","string");o&&o.selectParentReference("select3DShape"!==f)}return{selMgr:o,prefMgr:l,prefID:a,tokenPrefMgr:c}},cleanSelAndPrefMgrs:function({ctxViewer:e,selMgr:n,prefMgr:i,prefID:o,tokenPrefMgr:a}){if(e){if(i&&a){i&&i.removePreferences([o]);let n=Object.keys(a);for(let e=0;e<n.length;e++)i.unsubscribe(a[n[e]]);t.unreferencePreferenceManager({context:e.getFrameWindow()})}n&&r.unreferenceSelectionManager({context:e})}}}});