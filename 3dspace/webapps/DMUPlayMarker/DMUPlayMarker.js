define("DS/DMUPlayMarker/DMUMarker2DSpline",["DS/DMUPlayMarker/DMUMarker2D","DS/DMUPlayMarker/DMUMarker2DSplineNode3D","DS/DMUPlayMarker/DMUMarker2DPoint","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";var a=[{name:"oPoints",type:"objectDefinition",JSONname:"Properties2DMultiPoint.Points"}];return e.extend({init:function(e,s){this._parent(e,s),this.addParameters(a),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker2DSpline");var l=this,d=[],p=new n;this.getPoints=function(e){var t;if(e||!d.length){var n=l.getAttribute("oPoints");for(t=0;t<d.length;t++)d[t].remove();for(d.length=0,t=0;t<n.length;t++){var o=r.getReviewContext({viewer:l._viewer}),a=new i(l._viewer,o.getCurrentSessionMarkup());p.fillObjectAttributes(a,n[t]),d.push(a)}}return d},this.setNode(new t({frmWindow:this._frmWindow,getType:this.getType,getPoints:l.getPoints})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var c=this.refreshNode;this.refreshNode=function(){l.getNode()&&!s.isImporting()&&(l.getNode().update({name:l.getAttribute("sName"),isVisible:l.getAttribute("bVisible"),windowAnchor:l.getAttribute("sWindowAnchor"),isPositionProportional:l.getAttribute("bProportionalPosition"),points:l.getAttribute("oPoints"),rotationAngle:"number"==typeof l.getAttribute("fScreenRotationAngle")?l.getAttribute("fScreenRotationAngle"):l.getAttribute("fRotationAngle"),graphicProperties:{lineStyle:{thickness:o.getLineThickness(l.getAttribute("fLineStyleThicknessIndex"))||l.getAttribute("fLineStyleThickness"),pattern:l.getAttribute("sLineStylePattern"),color:l.getAttribute("cLineStyleColor"),opacity:l.getAttribute("fLineStyleOpacity")}}}),c())},this.getMaximumProportionalWidth=function(){var e=0;if(l.getAttribute("bProportionalPosition"))for(var t,i=l.getPoints(),r=0;r<i.length;r++)t=i[r].getAttribute("vPosition"),Math.abs(t.x)>e&&(e=Math.abs(t.x));return e}}})}),define("DS/DMUPlayMarker/DMUMarker2DSplineNode3D",["DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUNode2D","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D"],function(e,t,i,r,n,o){"use strict";return t.extend({init:function(t){var a=t||{};this._parent(a);var s,l,d=this,p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},c=new n({type:"Spherical"});this.addChild(c),c.setPickParent(!0);var h=new o({ratio:1});c.addChild(h),h.setPickParent(!0),this.removeDMUNode3DOverload=function(){d=h=s=null},this.updateScreenPosition=function(){l&&d.setMatrix((new e.Matrix4).setPosition(d.get3DPositionFromScreenCoordinates({coords:l,width:p.fullWidthPx,anchor:"center",windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional})))},this.update=function(t){var n;if(d){if(JSON.stringify(t)!==JSON.stringify(p)||p.isPositionProportional&&(p.screenWidth!==d.getViewer().SCREEN_WIDTH||p.screenHeight!==d.getViewer().SCREEN_HEIGHT)){var o=p.graphicProperties&&p.graphicProperties.lineStyle?JSON.stringify(p.graphicProperties.lineStyle):"";(p=d.mergeParams(p,t)).screenWidth=d.getViewer().SCREEN_WIDTH,p.screenHeight=d.getViewer().SCREEN_HEIGHT,d.setName(p.name);var c,u=a.getPoints(!0),g=[];for(l=new e.Vector2,n=0;n<u.length;n++)(c=u[n].getAttribute("vPosition"))&&(g.push(c),l.x+=c.x,l.y+=c.y);g.length&&l.multiplyScalar(1/g.length),s&&JSON.stringify(p.graphicProperties.lineStyle)===o||(s=i.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:p.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),h.removeChildren();var P,f=[],S=[];if(g.length>1){var y=p.isPositionProportional?d.convertCoordsInPixels({coords:l,windowAnchor:p.windowAnchor,fitOnX:!0}):l.clone();for(n=0;n<g.length;n++)P=g[n].clone(),p.isPositionProportional&&(P=d.convertCoordsInPixels({coords:P,proportionalPosition:p.isPositionProportional,windowAnchor:p.windowAnchor,fitOnX:!0})),P.sub(y),S.push(P);for(S=new e.SplineCurve(S).getPoints(150),n=0;n<S.length;n++)f.push(new e.Vector3(S[n].x,-S[n].y,0));var m,D,M=new e.Matrix4;p.rotationAngle&&(M=M.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),p.rotationAngle))),f.forEach(function(e){e.applyMatrix4(M),void 0===m?(m=e.x,D=e.x):(m=Math.max(m,e.x),D=Math.min(e.x,D))}),p.fullWidthPx=m-D;var b=r.createLineNode({points:f,material:s});b.setShadow(!1),b.setPickParent(!0),h.addChild(b)}d.setVisibility(p.isVisible)}d.updateScreenPosition()}},this.onViewerEventCB=function(e){d&&"onSwapVisibleSpace"===e.eventType&&p&&d.setVisibility(p.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DPictureNode3D",["DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode2D","DS/Visualization/ThreeJS_DS","DS/DMUMarkerVisu/DMUMarkerVisuPictureShapeNode","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry"],function(e,t,i,r,n,o,a){"use strict";return t.extend({init:function(t){var s=t||{};this._parent(s);var l=this,d={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p=new r({window:s.frmWindow,data:{isPicture:!0,mkvShape:s.mkvShape,graphicProperties:{padding:0}}});this.addChild(p),p.setPickParent(!0);var c=new e;function h(t,r,p,h){if(!d.hasALeader)return c.setVisibility(!1),void c.setVisibilityFree(!0);if(c.setVisibility(!0),c.setVisibilityFree(!1),0===l.getViewer().getVisibleSpace()&&!1===d.isVisible||1===l.getViewer().getVisibleSpace()&&!0===d.isVisible){var u=0;switch(d.leaderEndType){case"Arrow":u=1;break;case"Bubble":u=2;break;case"Cross":u=4;break;case"Square":u=3}if(p.offsetWidth>0&&p.offsetHeight>0){var g=t.clone(),P={offsetWidth:p.width/window.devicePixelRatio,offsetHeight:p.height/window.devicePixelRatio,rotationAngle:h};if("topleft"===d.anchorMode){var f=o.getViewerPositionFromPoint(l.getViewer(),g);if(!isNaN(f.left)&&!isNaN(f.top)){var S=new i.Vector2(f.left+P.offsetWidth/2,f.top+P.offsetHeight/2),y=o.getLineFromWindowPosition(l.getViewer(),S.x,S.y),m=o.getViewpointInfo(l.getViewer().currentViewpoint),D=a.computeLinePlaneDistance(y.position.toArray(),y.direction.toArray(),t.toArray(),m.sight.toArray());g=new i.Vector3(D.aPosition[0],D.aPosition[1],D.aPosition[2])}}var M,b,A=r;if(void 0!==A&&A.length){var v=c.getChildren().filter(function(e){return!e.isManipulator});if(A.length<v.length)for(var x=v.length-1;x>=A.length;x--)c.removeChild(v[x]);for(var w=0;w<A.length;w++){b=l.get3DPositionFromScreenCoordinates({coords:A[w],windowAnchor:d.windowAnchor,proportionalPosition:d.isPositionProportional}),(M=v[w])||((M=new e("DMUMarkerLeaderNode")).setPickParent(!0),c.addChild(M));let t={width:d.leaderAttachWidthRatio,height:d.leaderAttachLengthRatio},i=n.modifyLeaderNode(l.getViewer(),M,!0,g,b,t,d.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,d.graphicProperties.leaderStyle.color,d.graphicProperties.leaderStyle.pattern,u,P,s.frmWindow);M.setVisibility(i)}}}}}this.addChild(c),c.setPickParent(!0),this.linkManipulatorToNode(p.getBackNode()),this.getRepNode=function(){return{leader:c,box:p.getLabelNode()}},this.getLabelDimensions=function(){var e=p.getDimensions();return e.position=d.position,e},this.updateRepresentation=function(e,t){p.setTransformation({scaleMatrix:(new i.Matrix4).makeScale(d.imageWidth?e.imgWidth/d.imageWidth:1,d.imageHeight?e.imgHeight/d.imageHeight:1,1),rotationAngle:e.rotationAngle}),p.setMatrix((new i.Matrix4).setPosition(e.position));var r=e.leaderPoints.map(function(e){var t=o.getViewerPositionFromPoint(l.getViewer(),e);return new i.Vector2(t.left,t.top)});h(e.position,r,{width:e.width,height:e.height,offsetWidth:e.imgWidth,offsetHeight:e.imgHeight},e.rotationAngle),p.setGhostMode(t)},this.getLabelParams=function(){var e=p.getDimensions();return{leaderPoints:d.pointingPoints.map(function(e){return l.get3DPositionFromScreenCoordinates({coords:e,windowAnchor:d.windowAnchor,proportionalPosition:d.isPositionProportional})}),position:d.position,rotationAngle:d.boxRotationAngle?d.boxRotationAngle:0,anchorMode:d.anchorMode,width:e.width,height:e.height,imgWidth:d.imageWidth,imgHeight:d.imageHeight}};var u=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){u(),p&&p.remove(),l=c=p=null},this.getPixelFontSize=function(){var e=d.graphicProperties.fontStyle.fontSize;return!e&&d.graphicProperties.fontStyle.pxheight&&(e=o.convertPixelToModel({sizeInPixels:d.graphicProperties.fontStyle.pxheight,viewer:l.getViewer()})),o.convertModelToPixels({sizeInMM:e,viewer:l.getViewer()})},this.updateScreenPosition=function(){d&&d.breakPoint2D&&(d.position=l.get3DPositionFromScreenCoordinates({coords:d.breakPoint2D.clone(),anchor:d.anchorMode,windowAnchor:d.windowAnchor,width:p.getDimensions().width,proportionalPosition:d.isPositionProportional}),p.setMatrix((new i.Matrix4).setPosition(d.position)),h(d.position,d.pointingPoints,p.getDimensions(),d.boxRotationAngle))},this.update=function(e){if(l){d.graphicProperties.fontStyle.height=void 0,e.graphicProperties.fontStyle.height=void 0,d=d?l.mergeParams(d,e):e,l.setName(d.name);var t=l.getRepManipulator();t&&t.deactivate(),d.isPositionProportional&&(d.graphicProperties.padding=0,d.imageWidth=l.convertProportionalCoordInPixels(d.imageWidth,!0),d.imageHeight=l.convertProportionalCoordInPixels(d.imageHeight,!0)),d.graphicProperties.fontStyle.height=l.getPixelFontSize(),p.modify(d),l.updateScreenPosition(),t&&t.activate(),l.setVisibility(d.isVisible),l.getViewer().render()}},this.onViewerEventCB=function(e){l&&"onSwapVisibleSpace"===e.eventType&&d&&(l.setVisibility(d.isVisible),h(d.position,d.pointingPoints,p.getDimensions(),d.boxRotationAngle))}}})}),define("DS/DMUPlayMarker/DMUMarker2DRectangleNode3D",["DS/DMUBaseExperience/EXPToolsMaterial","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUNode2D","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D"],function(e,t,i,r,n,o){"use strict";return r.extend({init:function(r){this._parent(r);var a=this,s={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},l=new o({type:"Spherical"});l.setPickParent(!0),this.addChild(l);var d,p,c=new t({ratio:1});l.addChild(c),c.setPickParent(!0),this.updateScreenPosition=function(){s&&s.position&&a.setMatrix((new i.Matrix4).setPosition(a.get3DPositionFromScreenCoordinates({coords:s.position,width:s.widthPx,anchor:s.anchor,windowAnchor:s.windowAnchor,proportionalPosition:s.isPositionProportional})))},this.update=function(t){if(a){if(!s||JSON.stringify(t)!==JSON.stringify(s)||s.isPositionProportional&&(s.screenWidth!==a.getViewer().SCREEN_WIDTH||s.screenHeight!==a.getViewer().SCREEN_HEIGHT)){var r=s&&s.graphicProperties&&s.graphicProperties.fillStyle?JSON.stringify(s.graphicProperties.fillStyle):"",o=s&&s.graphicProperties&&s.graphicProperties.lineStyle?JSON.stringify(s.graphicProperties.lineStyle):"";s=s?a.mergeParams(s,t):t,a.setName(s.name),s.screenWidth=a.getViewer().SCREEN_WIDTH,s.screenHeight=a.getViewer().SCREEN_HEIGHT,s.isPositionProportional?(s.widthPx=a.convertProportionalCoordInPixels(s.width,!0),s.heightPx=a.convertProportionalCoordInPixels(s.height,!0)):(s.widthPx=s.width,s.heightPx=s.height),c.removeChildren(),p&&JSON.stringify(s.graphicProperties.fillStyle)===r||(p=e.createBasicMaterial({color:s.graphicProperties.fillStyle.color,opacity:s.graphicProperties.fillStyle.opacity})),d&&JSON.stringify(s.graphicProperties.lineStyle)===o||(d=e.createLineMaterial({color:s.graphicProperties.lineStyle.color,opacity:s.graphicProperties.lineStyle.opacity,lineWidth:s.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:s.graphicProperties.lineStyle.pattern}));var l,h=new i.Matrix4;s.rotationAngle&&h.makeRotationAxis(new i.Vector3(0,0,1),s.rotationAngle),h.multiply((new i.Matrix4).makeTranslation(-s.widthPx/2,-s.heightPx/2,0)),s.isFilled&&((l=n.createRectangleNode({width:s.widthPx,height:s.heightPx,fill:!0,material:p})).setShadow(!1),l.setPickParent(!0),l.setMatrix(h),c.addChild(l)),s.hasBorder&&((l=n.createRectangleNode({width:s.widthPx,height:s.heightPx,fill:!1,material:d})).setShadow(!1),l.setPickParent(!0),l.setMatrix(h),c.addChild(l)),a.setVisibility(s.isVisible)}a.updateScreenPosition()}},this.removeDMUNode3DOverload=function(){l=a=c=null},this.onViewerEventCB=function(e){a&&"onSwapVisibleSpace"===e.eventType&&s&&a.setVisibility(s.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarkerTools",["UWA/Core","DS/WebappsUtils/WebappsUtils","DS/DMUBaseExperience/DMUContextManager","DS/Visualization/ThreeJS_DS","DS/PADUtils/PADSettingsMgt"],function(e,t,i,r,n){"use strict";var o={getArrowSpecs:function(e,t,i,n,o){var a=(1-i)*t,s=e/2,l=0,d=null!=n?n:.5,p=[],c=[];"beginSide"===o?(p[l++]=0,p[l++]=0,p[l++]=0,p[l++]=a,p[l++]=-s-e*d,p[l++]=0,p[l++]=a,p[l++]=-s,p[l++]=0,p[l++]=t,p[l++]=-s,p[l++]=0,p[l++]=t,p[l++]=s,p[l++]=0,p[l++]=a,p[l++]=s,p[l++]=0,p[l++]=a,p[l++]=s+e*d,p[l++]=0):"bothSide"===o&&(p[l++]=0,p[l++]=0,p[l++]=0,p[l++]=a,p[l++]=-s-e*d,p[l++]=0,p[l++]=a,p[l++]=-s,p[l++]=0,p[l++]=t-a,p[l++]=-s,p[l++]=0,p[l++]=t-a,p[l++]=-s-e*d,p[l++]=0,p[l++]=t,p[l++]=0,p[l++]=0,p[l++]=t-a,p[l++]=s+e*d,p[l++]=0,p[l++]=t-a,p[l++]=s,p[l++]=0,p[l++]=a,p[l++]=s,p[l++]=0,p[l++]=a,p[l++]=s+e*d,p[l++]=0);var h=[];l=0,h[l++]=0,h[l++]=0,h[l++]=1;var u=[];l=0,"beginSide"===o?(u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),c.push(0),c.push(3),c.push(4),c.push(0),c.push(4),c.push(5),c.push(0),c.push(5),c.push(6)):"bothSide"===o&&(u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,u[l++]=1,c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),c.push(3),c.push(4),c.push(5),c.push(3),c.push(6),c.push(5),c.push(3),c.push(7),c.push(8),c.push(0),c.push(8),c.push(3),c.push(0),c.push(8),c.push(9));var g=[];l=0;for(var P=0;P<p.length/3;P++)g.push(new r.Vector3(p[3*P],p[3*P+1],p[3*P+2]));return g.push(new r.Vector3(p[0],p[1],p[2])),{bufferPosition:p,bufferNormal:h,bufferUV:u,bufferIndex:c,coordinates:g}},getBentArrowSpecs:function(e,t,i,n,o,a,s){var l,d,p,c=[],h=[],u=0,g=e/2;"beginSide"===s?(c[u++]=0,c[u++]=0,c[u++]=0,c[u++]=g,c[u++]=-(1-o)*i,c[u++]=0,c[u++]=g-a*n,c[u++]=-(1-o)*i,c[u++]=0,c[u++]=g-a*n,c[u++]=-i,c[u++]=0,c[u++]=-n+g,c[u++]=-i,c[u++]=0,c[u++]=-n+g,c[u++]=-i+t,c[u++]=0,c[u++]=a*n-g,c[u++]=-i+t,c[u++]=0,c[u++]=a*n-g,c[u++]=-(1-o)*i,c[u++]=0,c[u++]=-g,c[u++]=-(1-o)*i,c[u++]=0):"bothSide"===s&&(l=(1-o-a)*i,d=(1-o-a)*n,c[u++]=0,c[u++]=0,c[u++]=0,c[u++]=g,c[u++]=-l,c[u++]=0,c[u++]=g-a*n,c[u++]=-l,c[u++]=0,c[u++]=g-a*n,c[u++]=a*i-i,c[u++]=0,c[u++]=-n+g+d,c[u++]=a*i-i,c[u++]=0,c[u++]=-n+g+d,c[u++]=-i,c[u++]=0,c[u++]=-n+g,c[u++]=t/2-i,c[u++]=0,c[u++]=-n+g+d,c[u++]=-i+t,c[u++]=0,c[u++]=-n+g+d,c[u++]=-i+t-a*i,c[u++]=0,c[u++]=a*n-g,c[u++]=-i+t-a*i,c[u++]=0,c[u++]=a*n-g,c[u++]=-l,c[u++]=0,c[u++]=-g,c[u++]=-l,c[u++]=0);var P=n/2-g,f=i/2;for(p=0;p<c.length/3;p++)c[3*p]+=P,c[3*p+1]+=f;var S=[];u=0,S[u++]=0,S[u++]=0,S[u++]=1;var y=[];u=0,"beginSide"===s?(y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,h.push(0),h.push(1),h.push(8),h.push(2),h.push(6),h.push(7),h.push(2),h.push(3),h.push(6),h.push(3),h.push(5),h.push(6),h.push(3),h.push(4),h.push(5)):"bothSide"===s&&(y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,y[u++]=1,h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),h.push(3),h.push(4),h.push(8),h.push(4),h.push(5),h.push(6),h.push(4),h.push(6),h.push(7),h.push(3),h.push(8),h.push(9),h.push(0),h.push(3),h.push(9),h.push(0),h.push(9),h.push(10),h.push(0),h.push(10),h.push(11));var m=[];for(u=0,p=0;p<c.length/3;p++)m.push(new r.Vector3(c[3*p],c[3*p+1],c[3*p+2]));return m.push(new r.Vector3(c[0],c[1],c[2])),{bufferPosition:c,bufferNormal:S,bufferUV:y,bufferIndex:h,coordinates:m}},getEllipseSpecs:function(e,t,i){var n,o,a=new r.Vector3;i>0&&(n=Math.round(2*Math.PI/Math.acos(1-1/(e/i))),o=Math.round(2*Math.PI/Math.acos(1-1/(t/i)))),(isNaN(n)||n<0)&&(n=20),(isNaN(o)||o<0)&&(o=20);var s=n>o?n:o,l=[],d=[],p=[],c=0;d[c++]=a.x,d[c++]=a.y,d[c++]=a.z;var h=[];h[0]=1;for(var u=0;u<=s;u++){var g=new r.Vector3(e*Math.cos(Math.PI*u/(s/2)),-t*Math.sin(Math.PI*u/(s/2)),0);l.push(g),h[c]=1,d[c++]=g.x,d[c++]=g.y,d[c++]=g.z}for(var P=0;P<d.length/3;P++)p.push(0),p.push(P),p.push(P+1);p.push(0),p.push(d.length/3-1),p.push(1);var f=[],S=0;return f[S++]=0,f[S++]=0,f[S++]=1,{bufferPosition:d,bufferNormal:f,bufferUV:h,bufferIndex:p,coordinates:l}},solveHyperlink:function(e,t){if(e){if(e.urls&&e.urls.length)for(var r=0;r<e.urls.length;r++)-1!==e.urls[r].indexOf("http")&&window.open(e.urls[r]);if(e.ids&&e.ids.length){var o=i.getContextViewer({viewer:t});o&&o.getController().getAttributes({ids:e.ids,attributes:["ds6w:type","ds6w:label"],callbacks:{onComplete:function(t){require(["DS/PADUtils/PADUtilsServices","DS/TransientWidget/TransientWidget"],function(i,r){for(var o,a=[],s=0;s<e.ids.length;s++)t[e.ids[s]]["ds6w:type"]&&(o={protocol:"3DXContent",version:"0.1",source:"X3DCSMA_AP",data:{items:[{envId:i.getPlatformId(),serviceId:"3DSpace",objectId:e.ids[s],objectType:t[e.ids[s]]["ds6w:type"],contextId:n.getSetting("pad_security_ctx")}]}},a.push({id:"X3DPLAW_AP",title:t[e.ids[s]]["ds6w:label"],data:{x3dSharedId:widget.getValue("x3dSharedId"),x3dPlatformId:widget.getValue("x3dPlatformId"),X3DContentId:JSON.stringify(o)}}));1===a.length?r.showWidget(a[0].id,a[0].title,a[0].data):a.length>1&&r.showWidget(a)})},onFailure:function(){}}})}}},getHyperlinkIcon:function(e){return t.getWebappsAssetUrl("DMUPlayMarker","icons/32/")+(e&&e.urls&&e.urls.length?"I_WebMarkerHyperlink_url_Old.png":"I_WebMarkerHyperlink_default_Old.png")},createHyperlinkDiv:function(t){var i;if(t&&t.urls&&t.urls.length){var r;i=e.createElement("div");for(var n=0;n<t.urls.length;n++)-1!==t.urls[n].indexOf("http")?((r=e.createElement("a",{styles:{margin:"2px",padding:0}}).inject(i)).href=t.urls[n],e.createElement("br").inject(i)):r=e.createElement("p",{styles:{margin:"2px",padding:0,userSelect:"text"}}).inject(i),r.innerHTML=t.urls[n]}return i},getPointedReferencesVisibilityStates:function(e,t){var r=[];if(!t||!e)return r;var n=Array.isArray(t)?t:[t];if(n.length){var o=e.getSceneGraphOverrideSetManager(),a=i.getReviewContext({viewer:e});if(a&&a.getCurrentSessionMarkup()){var s=a.getCurrentSessionMarkup().getAttribute("oLinksManager");if(s&&o)for(var l=0;l<n.length;l++)if("null"!==n[l]){var d=s.getOccurrencePathElement(n[l]);d&&!1!==o.getCurrentVisibility(d)?r.push(!0):r.push(!1)}else r.push(!0)}}return r},is3DMarkerDisplayed:function(e,t,i){var r=o.getPointedReferencesVisibilityStates(e,t);return 0===r.length||!i&&-1!==r.indexOf(!0)||i&&-1===r.indexOf(!1)},compareAndMergeParams:function(e){var t=!1,i=function(e,t){if(Array.isArray(e)&&Array.isArray(t)){if("object"!=typeof e[0])return e.toString()===t.toString();if(e.length===t.length){for(var r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1;return!0}return!1}var n=e&&t&&e.equals?e.equals(t):void 0;return void 0===n?e===t:n};if("object"!=typeof e.paramA&&"object"!=typeof e.paramB)return i(e.paramA,e.paramB);if("object"==typeof e.paramA&&"object"==typeof e.paramB){t=!0,e.mergedKeys||(e.mergedKeys=[]);var r=Object.keys(e.paramB),n=Object.keys(e.paramA).slice();r.forEach(function(e){n.includes(e)||n.push(e)}),n.forEach(function(r){if(!e.paramA[r]||!e.paramB[r]||Array.isArray(e.paramA[r])||Array.isArray(e.paramB[r])||e.paramB[r].clone||"object"!=typeof e.paramA[r]&&"object"!=typeof e.paramB[r])i(e.paramA[r],e.paramB[r])||(t=!1,e.merge&&(e.paramA[r]=null!=(a=e.paramB[r])?Array.isArray(a)?a.slice():a.clone?a.clone():a:a,e.mergedKeys.push(r)));else{var n={paramA:e.paramA[r],paramB:e.paramB[r],merge:e.merge,mergedKeys:e.mergedKeys};o.compareAndMergeParams(n)||(t=!1,e.merge&&e.mergedKeys.push(r))}var a})}return t},getControlPoints:function(e,t){for(var i,r,n,o,a=0,s=0,l=[],d=1;d<e.length;d++){var p=(i=e[0],r=e[e.length-1],n=e[d],o=void 0,o=r.clone().sub(i).normalize(),i.clone().sub(n).sub(o.multiplyScalar(i.clone().sub(n).dot(o))).length());p>a&&(a=p,s=d)}if(a>t){var c=this.getControlPoints(e.slice(0,s+1),t),h=this.getControlPoints(e.slice(s+1,e.length),t);c.pop(),l=c.concat(h)}else l.push(e[0]),l.push(e[e.length-1]);return l}};return o}),define("DS/DMUPlayMarker/DMUMarker2DCircleNode3D",["DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D"],function(e,t,i,r,n,o){"use strict";return o.extend({init:function(o){this._parent(o);var a,s,l=this,d={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},p=new e({type:"Spherical"});this.addChild(p),p.setPickParent(!0);var c=new i({ratio:1});p.addChild(c),c.setPickParent(!0),this.removeDMUNode3DOverload=function(){l=a=s=p=c=null},this.updateScreenPosition=function(){d&&l.setMatrix((new t.Matrix4).setPosition(l.get3DPositionFromScreenCoordinates({coords:d.center,width:2*d.radiusPx,anchor:"center",windowAnchor:d.windowAnchor,proportionalPosition:d.isPositionProportional})))},this.update=function(e){if(l){if(JSON.stringify(e)!==JSON.stringify(d)||d.isPositionProportional&&(d.screenWidth!==l.getViewer().SCREEN_WIDTH||d.screenHeight!==l.getViewer().SCREEN_HEIGHT)){var i=d.graphicProperties&&d.graphicProperties.fillStyle?JSON.stringify(d.graphicProperties.fillStyle):"",o=d.graphicProperties&&d.graphicProperties.lineStyle?JSON.stringify(d.graphicProperties.lineStyle):"";d=l.mergeParams(d,e),l.setName(d.name),d.screenWidth=l.getViewer().SCREEN_WIDTH,d.screenHeight=l.getViewer().SCREEN_HEIGHT,d.isPositionProportional?d.radiusPx=l.convertProportionalCoordInPixels(d.radius,!0):d.radiusPx=d.radius,c.removeChildren();var p,h=Math.round(2*Math.PI/Math.acos(1-1/d.radiusPx));if((isNaN(h)||h<0)&&(h=20),d.isFilled&&(a&&JSON.stringify(d.graphicProperties.fillStyle)===i||(a=n.createBasicMaterial({color:d.graphicProperties.fillStyle.color,opacity:d.graphicProperties.fillStyle.opacity})),(p=r.createCircleNode({radius:d.radiusPx,fill:!0,segments:h,startAngle:0,endAngle:2*Math.PI,material:a})).setShadow(!1),p.setPickParent(!0),c.addChild(p)),d.hasBorder){s&&JSON.stringify(d.graphicProperties.lineStyle)===o||(s=n.createLineMaterial({color:d.graphicProperties.lineStyle.color,opacity:d.graphicProperties.lineStyle.opacity,lineWidth:d.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:d.graphicProperties.lineStyle.pattern}));for(var u=[],g=0;g<=h;g++)u.push(new t.Vector3(d.radiusPx*Math.cos(Math.PI*g/(h/2)),d.radiusPx*Math.sin(Math.PI*g/(h/2)),0));(p=r.createLineNode({points:u,material:s})).setShadow(!1),p.setPickParent(!0),c.addChild(p)}l.setVisibility(d.isVisible)}l.updateScreenPosition()}},this.onViewerEventCB=function(e){l&&"onSwapVisibleSpace"===e.eventType&&d&&l.setVisibility(d.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DPointNode3D",["DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode2D"],function(e,t,i){"use strict";return i.extend({init:function(i){this._parent(i);var r=this,n=new t;this.addChild(n),this.removeDMUNode3DOverload=function(){r=n=null},this.update=function(t){r&&(t.name&&r.setName(t.name),t.position&&n.setMatrix((new e.Matrix4).setPosition(r.get3DPositionFromScreenCoordinates({coords:t.position,windowAnchor:t.windowAnchor,proportionalPosition:t.isPositionProportional}))))}}})}),define("DS/DMUPlayMarker/DMUMarker3DPointNode3D",["require","exports","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/DMUBaseUI/DMUNode3D"],function(e,t,i,r,n){"use strict";return class extends n{constructor(e){super(e||{});let t=this,n=new r;this.addChild(n),n.setPickParent(!0),this.removeDMUNode3DOverload=function(){n=null},this.update=function(e){t&&(e&&e.name&&t.setName(e.name),e&&e.position&&n.setMatrix((new i.Matrix4).setPosition(e.position)))}}}}),define("DS/DMUPlayMarker/DMUMarker2DPolylineNode3D",["DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUNode2D","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/SceneGraphNodes/ArrowNode"],function(e,t,i,r,n,o,a){"use strict";return t.extend({init:function(t){var s=t||{};this._parent(s);var l,d,p=this,c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},h=new n({type:"Spherical"});this.addChild(h),h.setPickParent(!0);var u=new o({ratio:1});function g(e,t,r){var n=c.graphicProperties.lineStyle.thickness;u.addChild(new a({arrowWidth:n,viewpoint:p.getViewer().currentViewpoint,arrowDashType:i.getDashType(c.graphicProperties.lineStyle.pattern),arrowScale:2,color:c.graphicProperties.lineStyle.color,head:1,headLength:r*Math.max(n,3),initialPoint:e.clone(),finalPoint:t.clone()}))}h.addChild(u),u.setPickParent(!0),this.removeDMUNode3DOverload=function(){p=u=l=null},this.updateScreenPosition=function(){c&&d&&p.setMatrix((new e.Matrix4).setPosition(p.get3DPositionFromScreenCoordinates({coords:d,width:c.fullWidthPx,anchor:"center",windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional})))},this.update=function(t){if(p){var n;if(JSON.stringify(t)!==JSON.stringify(c)||c.isPositionProportional&&(c.screenWidth!==p.getViewer().SCREEN_WIDTH||c.screenHeight!==p.getViewer().SCREEN_HEIGHT)){var o=c.graphicProperties&&c.graphicProperties.lineStyle?JSON.stringify(c.graphicProperties.lineStyle):"";c=p.mergeParams(c,t),p.setName(c.name),c.screenWidth=p.getViewer().SCREEN_WIDTH,c.screenHeight=p.getViewer().SCREEN_HEIGHT;var a,h=s.getPoints(!0),P=[];for(d=new e.Vector2,n=0;n<h.length;n++)(a=h[n].getAttribute("vPosition"))&&(P.push(a),d.x+=a.x,d.y+=a.y);P.length&&d.multiplyScalar(1/P.length),l&&JSON.stringify(c.graphicProperties.lineStyle)===o||(l=i.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:c.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),u.removeChildren();var f,S=[];if(P.length>1){var y=c.isPositionProportional?p.convertCoordsInPixels({coords:d,windowAnchor:c.windowAnchor,fitOnX:!0}):d.clone();for(n=0;n<P.length;n++)f=P[n].clone(),c.isPositionProportional&&(f=p.convertCoordsInPixels({coords:f,windowAnchor:c.windowAnchor,fitOnX:!0})),f.sub(y),S.push(new e.Vector3(f.x,-f.y,0));var m=1===h[0].getAttribute("iPointType"),D=1===h[h.length-1].getAttribute("iPointType");m&&g(S[1],S[0],h[0].getAttribute("iSize")),D&&g(S[S.length-2],S[S.length-1],h[h.length-1].getAttribute("iSize"));var M,b,A=new e.Matrix4;if(c.rotationAngle&&(A=A.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),c.rotationAngle))),S.forEach(function(e){e.applyMatrix4(A),void 0===M?(M=e.x,b=e.x):(M=Math.max(M,e.x),b=Math.min(e.x,b))}),c.fullWidthPx=M-b,m&&S.splice(0,1),D&&S.splice(S.length-1,1),S.length){var v=r.createLineNode({points:S,material:l});v.setShadow(!1),v.setPickParent(!0),u.addChild(v)}}p.setVisibility(c.isVisible)}p.updateScreenPosition()}},this.onViewerEventCB=function(e){p&&"onSwapVisibleSpace"===e.eventType&&c&&p.setVisibility(c.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarkerShapeGrid",["UWA/Class","UWA/Core","DS/DMUMarkerVisu/DMUMarkerVisuGrid","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUToolsUsers"],function(e,t,i,r,n){"use strict";return e.extend({init:function(e){this._parent();var o,a=this;this.getMarkUpGrid=function(){return o||(o=new i),o},this.buildTextGrid=function(i,r){var n,o=1,s=1,l=e,d=l.getType();"DMUMarker3DText"===d||"DMUMarker2DText"===d||"DMUMarker3DHyperlink"===d||"DMUMarker2DHyperlink"===d?(l.getImageToDisplay&&l.getImageToDisplay()&&s++,n=l.getAttribute("sTextContents")):"DMUMarker3DPicture"!==d&&"DMUMarker2DPicture"!==d||(n=l.getPictureLabel())&&n.length&&n[0]&&n[0].length&&o++;var p=a.getMarkUpGrid().getMarkUpCell(o-1,s-1);if(p){var c=p.getCellText();if(c){var h,u=l.getPixelFontSize(),g=l.getAttribute("sFontStyle"),P=l.getAttribute("sFontName");if(i){l.getAttribute("sRelatedObjectId")&&(r-=32);var f=t.createElement("canvas").getContext("2d"),S=g?g+" ":"";S+=u+"px "+l.getAttribute("sFontName"),f.font=S;var y="";h=[];for(var m=0;m<n.length;m++){if((y=n[m])&&f.measureText(" "+y+" ").width*window.devicePixelRatio>r){for(var D=y.length-4,M=y;D>=2&&f.measureText(" "+M+" ").width*window.devicePixelRatio>r;)M=y.substring(0,D)+"...",D--;y=M}h.push(y)}}n&&c.setTextContent(n),h&&c.setTextToDisplay(h),c.setFontSize(u),c.setFontName(P),c.setFontStyle(g)}}},this.buildGrid=function(i){var o,s,l,d=a.getMarkUpGrid();if(d){var p,c,h=1,u=1,g=null,P=e,f=P.getAttribute("bProportionalPosition"),S=P.getNode().getProportionalFactor?P.getNode().getProportionalFactor(!0):1;if(P){var y=P.getType();if("DMUMarker3DText"===y||"DMUMarker2DText"===y||"DMUMarker3DHyperlink"===y||"DMUMarker2DHyperlink"===y){if((g=P.getImageToDisplay?P.getImageToDisplay():null)&&u++,d.setNbofRows(h),d.setNbofColumns(u),g&&(p=d.getMarkUpCell(0,0))){let e=t.createElement("img");p.setCellImage(e),"string"==typeof g&&0!==g.indexOf("data:")?n.getImage(g,function(t,i){i||(e.src=t)}):e.src=g,o=P.getAttribute("fImageWidth"),s=P.getAttribute("fImageHeight"),o&&s?P.getAttribute("vLeaderBreakPoint3D")?(o=r.convertModelToPixels({sizeInMM:o,viewer:P._viewer})*window.devicePixelRatio,s=r.convertModelToPixels({sizeInMM:s,viewer:P._viewer})*window.devicePixelRatio):f&&(o*=S,s*=S):(o=40,s=40),p.setCellWd(o),p.setCellHt(s)}a.buildTextGrid()}else if("DMUMarker3DPicture"===y||"DMUMarker2DPicture"===y){g=P.getImageToDisplay();var m=P.getPictureLabel();m&&m.length&&m[0]&&m[0].length&&h++;var D=0;d.setNbofRows(h),d.setNbofColumns(u),g&&(p=d.getMarkUpCell(0,0))&&(g=t.createElement("img",{src:g}),p.setCellImage(g),D=P.getAttribute("fImageWidth"),s=P.getAttribute("fImageHeight"),D&&s?P.getAttribute("vLeaderBreakPoint3D")?(D=r.convertModelToPixels({sizeInMM:D,viewer:P._viewer})*window.devicePixelRatio,s=r.convertModelToPixels({sizeInMM:s,viewer:P._viewer})*window.devicePixelRatio):f&&(D*=S,s*=S):(D=g.naturalWidth,s=g.naturalHeight),D||(D=300),s||(s=300),p.setCellWd(D),p.setCellHt(s)),a.buildTextGrid(2===h,D)}else if("DMUMarker3DStamp"===y){d.setNbofRowsAndColumns(3,2),g=t.createElement("img"),n.getImage(n.getUserImageURL(n.getUserLogin()),function(e,t){t||(g.src=e)}),(p=d.getMarkUpCell(0,0))&&(p.setCellImage(g),p.setCellWd(30*window.devicePixelRatio),p.setCellHt(30*window.devicePixelRatio));var M=P.getPixelFontSize(),b=d.getMarkUpCell(0,1);b&&(l=b.getCellText())&&(l.setTextContent(i),l.setFontSize(M),l.setFontName("sans-serif"),l.setFontStyle("normal"));var A=d.getMarkUpCell(1,1);A&&(l=A.getCellText())&&(l.setTextContent(P.getAttribute("sTextContents")),l.setFontSize(M),l.setFontName("sans-serif"),l.setFontStyle("bold"));var v=d.getMarkUpCell(2,1);v&&(l=v.getCellText())&&(l.setTextContent(P.getAttribute("lTextComment")),l.setFontSize(M),l.setFontName(P.getAttribute("sFontName")),l.setFontStyle(P.getAttribute("sFontStyle"))),c=[{row:0,column:1}]}}d.updateGrid(c)}}}})}),define("DS/DMUPlayMarker/DMUMarkerServices",["DS/WAFData/WAFData","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/WebappsUtils/WebappsUtils","i18n!DS/DMUPlayMarker/assets/nls/DMUPlayMarker"],function(e,t,i,r,n){"use strict";return{getDataFromRelatedId:function(o){if(o.onComplete)switch(o.type){case"DMUMarker3DPicture":!function(r,n,o){var a=i.getSetting("pad_security_ctx"),s=t.get3DSpaceUrl()+"/cvservlet/fetch/v2?SecurityContext="+a+"&tenant="+t.getPlatformId(),l=n.predicates||[],d=n.files||[];if(l.length||d.length){var p={physicalid:[r],label:"DMUFetchForMarkerVisualization-"+t.getRequestLabel(),select_predicate:l,select_file:d};e.authenticatedRequest(s,{data:JSON.stringify(p),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","Accept-Language":i.getSetting("lang"),SecurityContext:a},timeout:6e4,onComplete:function(e){var t=e?JSON.parse(e):null,i=l.concat(d),r=(t&&t.results&&t.results[0]&&t.results[0].attributes?t.results[0].attributes:[]).filter(function(e){return i.indexOf(e.name)>=0});o(r)},onFailure:function(){o([])},onTimeout:function(){o([])}})}}(o.objectId,{predicates:["ds6w:label","ds6w:type"],files:["thumbnail_2d","preview_url","icon","type_icon_url"]},function(a){if(a){var s=a.find(function(e){return"ds6w:type"===e.name}),l=a.find(function(e){return"ds6w:label"===e.name}),d=0,p={label:l&&l.dispValue?l.dispValue:n.defaultSymbolLabel};p.draggableContent=JSON.stringify({protocol:"3DXContent",version:"1.1",data:{items:[{envId:t.getPlatformId(),serviceId:"3DSpace",contextId:i.getSetting("pad_security_ctx")?i.getSetting("pad_security_ctx"):void 0,objectId:o.objectId,objectType:s.value,displayType:s.dispValue,displayName:l.dispValue}]},source:window.widget&&window.widget.getValue("appId")?window.widget.getValue("appId"):"ENOR3D_AP",widgetId:window.widget?window.widget.id:void 0});var c=a.find(function(e){return"preview_url"===e.name});c&&c.value||(c={value:r.getWebappsAssetUrl("DMUPlayMarker","images")+"/Default_Symbol_Preview.png"}),d++;e.authenticatedRequest(c.value,{proxy:"none",type:"blob",timeout:18e4,onComplete:function(e){var t=new FileReader;t.onload=function(){var e=new Image;e.src=t.result,e.onload=function(){d--,p.image=e,0===d&&o.onComplete(p)}},t.readAsDataURL(e)},onFailure:function(){0===--d&&o.onComplete(p)},onTimeout:function(){0===--d&&o.onComplete(p)}});var h=a.find(function(e){return"type_icon_url"===e.name});if(h&&h.value){d++;e.authenticatedRequest(h.value,{proxy:"none",type:"blob",timeout:18e4,onComplete:function(e){var t=new FileReader;t.onload=function(){var e=new Image;e.src=t.result,e.onload=function(){d--,p.icon=e,0===d&&o.onComplete(p)}},t.readAsDataURL(e)},onFailure:function(){0===--d&&o.onComplete(p)},onTimeout:function(){0===--d&&o.onComplete(p)}})}}else o.onComplete()})}}}}),define("DS/DMUPlayMarker/DMUMarkerImport",["UWA/Class","DS/DMUPlayMarker/DMUMarkerServices"],function(e,t){"use strict";return e.extend({init:function(e){this.importData=function(t,i,r){t&&i&&e&&(i.fillObjectAttributes(e,t,r),i.registerForPostImport(e))},this.afterImport=function(){if(e){for(var i=e;i&&"DMUMarkup"!==i.getType();)i=i.getParent();if(e.getAttribute("sRelatedObjectId"))t.getDataFromRelatedId({type:e.getType(),objectId:e.getAttribute("sRelatedObjectId"),onComplete:function(t){t&&(e.setRelatedObjectData(t),e.fireEvent("onDMUObjectInitialized",{dmuObject:e,dmuCont:i}))}});else{if(e.getDMUComments){let t=e.getDMUComments();t&&t.forEach(t=>{t.importDeprecatedReplies(e)})}e.fireEvent("onDMUObjectInitialized",{dmuObject:e,dmuCont:i})}}}}})}),define("DS/DMUPlayMarker/DMUMarker2DTextNode3D",["UWA/Core","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUNode2D","DS/DMUMarkerVisu/DMUMarkerVisuTextShapeNode","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s,l){"use strict";return o.extend({init:function(o){var d=o||{};this._parent(d),this._getExcludeFromCSO=function(){return!0};var p=this,c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},h={},u={horizontalAlignement:"topLeft"};if(d.defaultGraphicProps)for(var g=Object.keys(d.defaultGraphicProps),P=0;P<g.length;P++)u[g[P]]=d.defaultGraphicProps[g[P]];var f=new a({window:d.frmWindow,data:{mkvShape:d.mkvShape,graphicProperties:u},onStartContentEditionCB:d.onStartContentEditionCB,onEndContentEditionCB:d.onEndContentEditionCB,onContentModifiedCB:d.onContentModifiedCB});this.addChild(f),f.setPickParent(!0);var S=new t;function y(e,o,a){if(!c.hasALeader)return S.setVisibility(!1),void S.setVisibilityFree(!0);if(S.setVisibility(!0),S.setVisibilityFree(!1),0===p.getViewer().getVisibleSpace()&&!1===c.isVisible||1===p.getViewer().getVisibleSpace()&&!0===c.isVisible){var l=0;switch(c.leaderEndType){case"Arrow":l=1;break;case"Bubble":l=2;break;case"Cross":l=4;break;case"Square":l=3}var h=f.getDimensions();if(h.offsetWidth>0&&h.offsetHeight>0){var u=e.clone(),g={offsetWidth:n.convertModelToPixels({sizeInMM:h.offsetWidth,viewer:p.getViewer()}),offsetHeight:n.convertModelToPixels({sizeInMM:h.offsetHeight,viewer:p.getViewer()}),rotationAngle:a};if(g.offsetWidth/=window.devicePixelRatio,g.offsetHeight/=window.devicePixelRatio,"topleft"===c.anchorMode){var P=n.getViewerPositionFromPoint(p.getViewer(),u);if(!isNaN(P.left)&&!isNaN(P.top)){var y=new i.Vector2(P.left+g.offsetWidth/2,P.top+g.offsetHeight/2),m=n.getLineFromWindowPosition(p.getViewer(),y.x,y.y),D=n.getViewpointInfo(p.getViewer().currentViewpoint),M=s.computeLinePlaneDistance(m.position.toArray(),m.direction.toArray(),e.toArray(),D.sight.toArray());u=new i.Vector3(M.aPosition[0],M.aPosition[1],M.aPosition[2])}}var b,A,v=o;if(void 0!==v&&v.length){var x=S.getChildren().filter(function(e){return!e.isManipulator});if(v.length<x.length)for(var w=x.length-1;w>=v.length;w--)S.removeChild(x[w]);for(var k=0;k<v.length;k++){A=p.get3DPositionFromScreenCoordinates({coords:v[k],windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional}),(b=x[k])||((b=new t("DMUMarkerLeaderNode")).setPickParent(!0),S.addChild(b));let e={width:c.leaderAttachWidthRatio,height:c.leaderAttachLengthRatio},i=r.modifyLeaderNode(p.getViewer(),b,!0,u,A,e,c.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,c.graphicProperties.leaderStyle.color,c.graphicProperties.leaderStyle.pattern,l,g,d.frmWindow);b.setVisibility(i)}}}}}this.addChild(S),S.setPickParent(!0),this.linkManipulatorToNode(f.getBackNode()),this.getRepNode=function(){return{leader:S,box:f.getLabelNode()}},this.startEdition=function(){f.startEdition(p)},this.getLabelDimensions=function(){var e=f.getDimensions();return e.position=c.position,e},this.updateRepresentation=function(e,t){f.setTransformation({rotationAngle:e.rotationAngle}),f.setMatrix((new i.Matrix4).setPosition(e.position));var r=e.leaderPoints.map(function(e){var t=n.getViewerPositionFromPoint(p.getViewer(),e);return new i.Vector2(t.left,t.top)});y(e.position,r,e.rotationAngle),f.setGhostMode(t)},this.getLabelParams=function(){var e=f.getDimensions();return{leaderPoints:c.pointingPoints.map(function(e){return p.get3DPositionFromScreenCoordinates({coords:e,windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional})}),anchorMode:c.anchorMode,position:c.position,rotationAngle:c.boxRotationAngle?c.boxRotationAngle:0,width:e.width,height:e.height}};var m=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){m(),f&&f.remove(),f=p=S=c=null};var D=e.createElement("canvas");D.width=1e3,D.height=300,this.getPixelFontSize=function(e){var t,i=e||c,r=p.getViewer().SCREEN_WIDTH,o=p.getViewer().SCREEN_HEIGHT;if(i.graphicProperties.fontStyle.pxheight&&(t=n.convertPixelToModel({sizeInPixels:i.graphicProperties.fontStyle.pxheight,viewer:p.getViewer()})),t||(t=i.graphicProperties.fontStyle.fontSize),!(i.tessRep&&i.tessRep.length||h.viewerWidth===r&&h.viewerHeight===o&&h.fontSize&&h.modelSize===t)&&(h.modelSize=t,h.viewerWidth=r,h.viewerHeight=o,h.fontSize=n.convertModelToPixels({sizeInMM:t,viewer:p.getViewer()}),i.isPositionProportional)){var a=p.convertPixelsInProportionalCoord(10),s=(i.boxHeight-a)/i.content.length;h.fontSize=Math.max(p.convertProportionalCoordInPixels(s,!0),1),i.boxWidth&&(h.fontSize=Math.max(function(e,t){for(var i=t,r=e.content,n=p.convertProportionalCoordInPixels(e.boxWidth,!0),o=D.getContext("2d"),a=0;10!==a;){o.clearRect(0,0,D.width,D.height);var s=e.graphicProperties.fontStyle.familyStyle||"",l=s?s+" ":"",d=e.graphicProperties.fontStyle.familyName||"sans-serif";l+=i*window.devicePixelRatio+"px ",l+=d,d.split(" ").length>1&&(d='"'+d+'"'),o.font=l;for(var c=0,h="",u=0;u<r.length;++u)h=r[u]?r[u]:"aA_{}",o.clearRect(0,0,D.width,D.height),o.fillText(h,0,D.height),c=Math.max(c,o.measureText(h).width);if(c<n)break;a++,i*=.98}return i}(i,h.fontSize),1))}return h.fontSize},this.updateScreenPosition=function(){if(c&&c.breakPoint2D){var e=f.getDimensions();c.position=p.get3DPositionFromScreenCoordinates({coords:c.breakPoint2D.clone(),width:e.width,anchor:c.anchorMode,windowAnchor:c.windowAnchor,proportionalPosition:c.isPositionProportional}),y(c.position,c.pointingPoints,c.boxRotationAngle),f.updatePosition(c)}},this.update=function(e){if(!p)return;c||(c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}}),e.graphicProperties.fontStyle.height=p.getPixelFontSize(e),e.devicePixelRatio=window.devicePixelRatio,e.markerImage&&!function(e){if(e.content&&e.content.length)for(var t=0;t<e.content.length;t++)if(e.content[t].length)return!0;return!1}(e)&&(e.graphicProperties.padding=0);var t=[];let i=c.position;c.position=void 0;var r={paramA:c,paramB:e,merge:!0,mergedKeys:t};if(l.compareAndMergeParams(r))c.position=i;else{var n=p.getRepManipulator();n&&n.deactivate(),p.setName(c.name),c.isPositionProportional&&(c.imageWidth=p.convertProportionalCoordInPixels(c.imageWidth,!0),c.imageHeight=p.convertProportionalCoordInPixels(c.imageHeight,!0),c.boxWidth=p.convertProportionalCoordInPixels(c.boxWidth,!0),c.boxHeight=p.convertProportionalCoordInPixels(c.boxHeight,!0)),f.modify(c),p.updateScreenPosition(),t.includes("content")||f.stopEdition(),n&&n.activate(),p.setVisibility(c.isVisible)}p.getViewer().render()},this.onViewerEventCB=function(e){p&&("@onViewpointChange"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType||(f.stopEdition(),"onSwapVisibleSpace"===e.eventType&&c&&(p.setVisibility(c.isVisible),y(c.position,c.pointingPoints,c.boxRotationAngle))))}}})}),define("DS/DMUPlayMarker/DMUCommentableObject",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUBaseUIControllers/DMUMarkupsController","DS/DMUPlayMarker/DMUMarkerImport","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPManagerSet","DS/Selection/CSOManager"],function(e,t,i,r,n,o){"use strict";var a=[{name:"fPointedPageNumber",type:"float",JSONname:"PropertiesCommentableObject.PointedPageNumber"},{name:"sPointedElementID",type:"string",JSONname:"PropertiesCommentableObject.PointedElementID"},{name:"lComments",type:"listObjects",JSONname:"PropertiesCommentableObject.Comments"}];return e.extend({init:function(e,s){this._parent(e,s),this.addParameters(a);var l,d,p=this,c=!1;this.initContextualBar=function(e){e&&(d=e),d&&!p.getContextualCommandList&&-1!==r.getAuthoringFeatureTypes().indexOf("Marker")&&require([d],function(e){var t=new e;p.getContextualCommandList=t.getContextualCommandList,p.getSharedContextualCommandList=t.getSharedContextualCommandList,p.getSharedHeaderTypes=t.getSharedHeaderTypes,p.getSharedContextualMenuCommandList=t.getSharedContextualMenuCommandList,p.getContextualMenuCommandList=t.getContextualMenuCommandList,t.applyStateToContextHdr&&(p.applyStateToContextHdr=t.applyStateToContextHdr),t.setCheckCmdHdrState&&(p.setCheckCmdHdrState=t.setCheckCmdHdrState),t.register({frmWindow:p._frmWindow});var i=1===o.get().length?o.get()[0].pathElement.clone():null;i&&i.getLastElement(!0).getDMUType&&i.getLastElement(!0)===p.getNode()&&(o.empty(),o.add({pathElement:i}))})},this.initAuthoringData=function(){p.initContextualBar()},this.removeAuthoringData=function(){d&&-1!==r.getAuthoringFeatureTypes().indexOf("Marker")&&require([d],function(e){var t=new e;p.getContextualCommandList=null,p.getSharedContextualCommandList=null,p.getSharedHeaderTypes=null,p.getSharedContextualMenuCommandList=null,p.getContextualMenuCommandList=null,p.applyStateToContextHdr=null,p.setCheckCmdHdrState=t.setCheckCmdHdrState,t.unregister({frmWindow:p._frmWindow})})};var h=new i(p);this.importData=h.importData,this.afterImport=h.afterImport,this.initAuthoringData();var u=t.getDMUMarkupsController({context:this._viewer,frmWindow:this._frmWindow});u&&u.registerMarker(this),this.addDMUComment=function(e,t){if(e&&e.getType&&"DMUComment"===e.getType()){var i=p.getAttribute("lComments")||[];"number"==typeof t?i.splice(t,0,e):i.push(e),p.setAttribute("lComments",i),e.getNode&&p.getNode().addChild(e.getNode()),p.fireEvent("onDMUObjectAddedInObject",{dmuObject:e,parentObject:p})}},this.getDMUComments=function(){return p.getAttribute("lComments")||[]},this.removeDMUComment=function(e){if(e&&e.getType&&"DMUComment"===e.getType()){var t=p.getAttribute("lComments");if(t&&t.length){var i=t.findIndex(function(t){return t.getAttribute("sUuid")===e.getAttribute("sUuid")});i>=0&&(t[i].getNode()&&p.getNode().removeChild(t[i].getNode()),t.splice(i,1),p.setAttribute("lComments",t),e.remove(),p.fireEvent("onDMUObjectRemovedFromObject",{dmuObject:e,parentObject:p}))}}},this.updatePointedElement=function(e){var t=n.getManager({name:"DMU2DSheetManager",context:p._frmWindow});if(t){var i=t.getPointedElemIDAtPosition(e);"number"==typeof i?i!==p.getAttribute("fPointedPageNumber")&&p.setAttribute("fPointedPageNumber",i):i&&i!==p.getAttribute("sPointedElementID")&&p.setAttribute("sPointedElementID",i)}},this.getPointedPosition=function(){if(l)return l.clone()},this.updatePointedPosition=function(e){l=e.clone()};var g=this.setInEdition;this.setInEdition=function(e){var t=p.getAttribute("lComments");t&&t.length&&t.forEach(function(t){t.setInEdition(e)}),g(e)};var P=this.refreshNode;this.refreshNode=function(){var e=p.getAttribute("lComments");e&&e.length&&e.forEach(function(e){e.setAlertFlag(c),e.refreshNode()}),P()};var f=this.setReadOnly;this.setReadOnly=function(e,t){for(var i=p.getDMUComments(),r=0;r<i.length;r++)i[r].setReadOnly(e,t);f(e,t)},this.hasAlertFlag=function(){return c},this.setAlertFlag=function(e){c=e}},remove:function(){var e=t.giveDMUMarkupsController({context:this._viewer});e&&e.unregisterMarker(this),t.unreferenceDMUMarkupsController({context:this._viewer}),this._parent()}})}),define("DS/DMUPlayMarker/DMUMarker3DPoint",["require","exports","DS/DMUPlayMarker/DMUMarkerImport","DS/DMUBaseReview/DMUOverloadableObject","DS/DMUPlayMarker/DMUMarker3DPointNode3D"],function(e,t,i,r,n){"use strict";let o=[{name:"iPointType",type:"int",JSONname:"PointType",defaultValue:0},{name:"iSize",type:"float",JSONname:"Size",defaultValue:1},{name:"vPosition",type:"Vector3",JSONname:"Point3D"},{name:"vRelativePosition",type:"Vector3",JSONname:"Point3DRelativePosition"}];return class extends r{constructor(e,t){super(e,t),this.addParameters(o),this.setAttribute("sType","Marker3DPoint");let r=this,a=new i(r);this.importData=a.importData,this.afterImport=a.afterImport,this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType}));let s=this.refreshNode;this.refreshNode=function(){r.getNode()&&!t.getParent().isImporting()&&(r.getNode().update({name:r.getAttribute("sName"),pointType:r.getAttribute("iPointType"),size:r.getAttribute("iSize"),position:r.getAttribute("vRelativePosition")||r.getAttribute("vPosition")}),s())},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vPosition"===e?r._parentGetAttribute(e).clone():r._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker",["DS/DMUPlayMarker/DMUCommentableObject","DS/Visualization/ThreeJS_DS","DS/DMUBaseExperience/EXPUtils"],function(e,t,i){"use strict";var r=[{name:"cFillStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.color",defaultValue:new t.Color("#ffffff")},{name:"cLineStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.color",defaultValue:new t.Color("#000000")},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"fLineStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thicknessIndex"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"fLineStyleOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.opacity",defaultValue:1},{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.GraphicProperties.visible",defaultValue:!0},{name:"bIsFilled",type:"bool",JSONname:"PropertiesMarkerBase.filled",defaultValue:!0},{name:"bHasBorder",type:"bool",JSONname:"PropertiesMarkerBase.border",defaultValue:!1},{name:"fOpacity",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.opacity",defaultValue:1},{name:"oGradient",type:"objectDefinition",JSONname:"PropertiesMarkerBase.GraphicProperties.FillStyle.gradient"},{name:"fRotationAngle",type:"float",JSONname:"PropertiesMarkerBase.RotationAngle"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(r)},onViewerEventCB:function(e){this.getNode()&&this.getNode().onViewerEventCB&&this.getNode().onViewerEventCB(e)},_checkUnderCertainCommand:function(){return i.checkIfCommandIsRunning(this._viewer)||this.isReadOnly()},setAttribute:function(e,t){"fLineStyleThicknessIndex"===e&&this._parent("fLineStyleThickness",null),this._parent(e,t)}})}),define("DS/DMUPlayMarker/DMUMarker3D",["DS/DMUPlayMarker/DMUMarker"],function(e){"use strict";return e.extend({init:function(e,t){this._parent(e,t),this.addParameters([{name:"lPointedReferences",type:"listStrings",JSONname:"Properties3DMarker.PointedReferences"}]);var i=this;this.getPointedReferences=function(){return i.getAttribute("lPointedReferences")},this.getPointedReference=function(e){let t=i.getAttribute("lPointedReferences");if(t)return t[e]}}})}),define("DS/DMUPlayMarker/DMUMarker2D",["DS/DMUPlayMarker/DMUMarker"],function(e){"use strict";var t=[{name:"sWindowAnchor",type:"String",JSONname:"PropertiesMarker2D.windowAnchor",defaultValue:"topLeft"},{name:"bProportionalPosition",type:"bool",JSONname:"PropertiesMarker2D.proportionalPosition"},{name:"fScreenRotationAngle",type:"float",JSONname:"PropertiesMarker2D.RotationAngle"}];return e.extend({init:function(e,i){this._parent(e,i),this.addParameters(t);var r=this;this.setMaximalProportionalZoneWidth=function(e){r.getNode()&&r.getNode().setMaximalProportionalZoneWidth(e)}}})}),define("DS/DMUPlayMarker/DMUMarker2DRectangle",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DRectangleNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"fWidth",type:"float",JSONname:"Properties2DRectangle.width",defaultValue:10},{name:"fHeight",type:"float",JSONname:"Properties2DRectangle.height",defaultValue:10},{name:"vPosition",type:"Vector2",JSONname:"Properties2DRectangle.position",defaultValue:new t.Vector2},{name:"sAnchor",type:"string",JSONname:"Properties2DRectangle.anchor",defaultValue:"center"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DRectangle");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),position:o.getAttribute("vPosition"),width:o.getAttribute("fWidth"),height:o.getAttribute("fHeight"),anchor:o.getAttribute("sAnchor"),windowAnchor:o.getAttribute("sWindowAnchor"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),rotationAngle:"number"==typeof o.getAttribute("fScreenRotationAngle")?o.getAttribute("fScreenRotationAngle"):o.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vPosition"),i=o.getAttribute("fWidth");"center"===o.getAttribute("sAnchor")&&(i/=2,t&&i&&Math.abs(t.x-i)>e&&(e=Math.abs(t.x-i))),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vPosition"===e?this._parent(e).clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker2DCircle",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DCircleNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"vCenter",type:"Vector2",JSONname:"Properties2DCircle.Center",defaultValue:new t.Vector2},{name:"fRadius",type:"float",JSONname:"Properties2DCircle.Radius",defaultValue:100}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DCircle");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),radius:o.getAttribute("fRadius"),center:o.getAttribute("vCenter"),windowAnchor:o.getAttribute("sWindowAnchor"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vCenter"),i=o.getAttribute("fRadius");t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?"fRadius"===e?t>0&&this._parent(e,t):this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vCenter"===e?this._parent("vCenter").clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker3DTextNode3D",["DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUBaseUI/DMUManipulableNode3D","DS/DMUMarkerVisu/DMUMarkerVisuTextShapeNode","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s){"use strict";return o.extend({init:function(o){var l=o||{};this._parent(l),this._getExcludeFromCSO=function(){return!0};var d,p=this,c=p.getViewer(),h=1;let u,g=!1,P=!1;var f={horizontalAlignement:"topLeft"};if(l.defaultGraphicProps)for(var S=Object.keys(l.defaultGraphicProps),y=0;y<S.length;y++)f[S[y]]=l.defaultGraphicProps[S[y]];var m=new a({window:l.frmWindow,data:{mkvShape:l.mkvShape,graphicProperties:f},onStartContentEditionCB:l.onStartContentEditionCB,onEndContentEditionCB:l.onEndContentEditionCB,onContentModifiedCB:l.onContentModifiedCB});this.addChild(m),m.setPickParent(!0);var D=new e;function M(){if(D&&d){let e=!g&&!P&&d.hasALeader;D.setVisibility(e),D.setVisibilityFree(!e)}}function b(o,a,p){if(M(),d.hasALeader){var h=0;switch(d.leaderEndType){case"Arrow":h=1;break;case"Bubble":h=2;break;case"Cross":h=4;break;case"Square":h=3}var u=m.getDimensions();if(u.offsetWidth>0&&u.offsetHeight>0){var g,P,f=o.clone(),S={offsetWidth:r.convertModelToPixels({sizeInMM:u.offsetWidth,viewer:c,coords:d.zoomMode?f:null}),offsetHeight:r.convertModelToPixels({sizeInMM:u.offsetHeight,viewer:c,coords:d.zoomMode?f:null}),rotationAngle:p};if(S.offsetWidth/=window.devicePixelRatio,S.offsetHeight/=window.devicePixelRatio,"topleft"===d.anchorMode)if(d.zoomMode){var y=c.currentViewpoint.getUpDirection().clone(),b=(new t.Vector3).crossVectors(c.currentViewpoint.getSightDirection(),y).setLength(u.offsetWidth/2);y.setLength(-u.offsetHeight/2),f.add(y),f.add(b)}else{var A=r.getViewerPositionFromPoint(c,f);if(A&&!isNaN(A.left)&&!isNaN(A.top)&&A.right-A.left!=0){var v=new t.Vector2(A.left+S.offsetWidth/2,A.top+S.offsetHeight/2),x=r.getLineFromWindowPosition(c,v.x,v.y),w=r.getViewpointInfo(c.currentViewpoint),k=n.computeLinePlaneDistance(x.position.toArray(),x.direction.toArray(),o.toArray(),w.sight.toArray());f=new t.Vector3(k.aPosition[0],k.aPosition[1],k.aPosition[2])}}if(a&&a.length){var N=[];if(1===c.getVisibleSpace()&&d.pointedReferences&&d.pointedReferences.length){var U=s.getPointedReferencesVisibilityStates(c,d.pointedReferences);for(P=U.length-1;P>=0;P--)U[P]&&a[P]&&N.push(a[P])}else N=a.slice();var C=D.getChildren();for(P=0;P<N.length;P++){(g=C[P])||((g=new e("DMUMarkerLeaderNode")).setPickParent(!0),D.addChild(g));let t={width:d.leaderAttachWidthRatio,height:d.leaderAttachLengthRatio},r=i.modifyLeaderNode(c,g,!0,f,N[P],t,d.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,d.graphicProperties.leaderStyle.color,d.graphicProperties.leaderStyle.pattern,h,S,l.frmWindow);g.setVisibility(r)}if(C=D.getChildren(),N.length<C.length)for(P=C.length-1;P>=N.length;P--)C[P].isManipulator||D.removeChild(C[P])}}}}this.addChild(D),D.setPickParent(!0),this.linkManipulatorToNode(m.getBackNode()),this.getRepNode=function(){return{leader:D,box:m.getLabelNode()}},this.hasTessellatedRepresentation=function(){return d&&d.tessRep&&d.tessRep.length},this.getLabelDimensions=function(){var e=m.getDimensions();return e.position=d.position,e},this.updateRepresentation=function(e,i){m.setTransformation({rotationAngle:e.rotationAngle}),m.setMatrix((new t.Matrix4).setPosition(e.position)),b(e.position,e.leaderPoints,e.rotationAngle),m.setGhostMode(i)},this.getLabelParams=function(){var e=m.getDimensions(),t={};return t.leaderPoints=d.pointingPoints.slice(),t.position=d.position,t.anchorMode=d.anchorMode,t.rotationAngle=d.boxRotationAngle?d.boxRotationAngle:0,t.width=e.width,t.height=e.height,t};var A=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){A(),u&&clearTimeout(u),u=null,m&&m.remove(),m=D=p=d=null},this.getPixelFontSize=function(e){var t,i=e||d;return i.graphicProperties.fontStyle.pxheight&&(t=r.convertPixelToModel({sizeInPixels:i.graphicProperties.fontStyle.pxheight,viewer:p.getViewer()})),t||(t=i.graphicProperties.fontStyle.fontSize),r.convertModelToPixels({sizeInMM:t,viewer:p.getViewer()})},this.startEdition=function(){m.startEdition(p)},this._updateVisibility=function(e,t){if(!d)return;void 0!==e&&(h=e);let i=d.pointedReferences;i&&i.length!==d.pointingPoints.length&&(i=d.pointedReferences.slice(0,d.pointingPoints.length));var r=d.isVisible&&s.is3DMarkerDisplayed(c,i)&&h>0;p.setVisibility(r),0!==h&&m.setOpacity(h),(0===c.getVisibleSpace()&&!r||1===c.getVisibleSpace()&&r)&&(t&&h<1?(g=!0,M()):(g=!1,b(d.position,d.pointingPoints,d.boxRotationAngle))),c.render()},this.update=function(e){if(p){d||(d={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}}),e.graphicProperties.fontStyle.height=p.getPixelFontSize(e),e.devicePixelRatio=window.devicePixelRatio,e.markerImage&&!function(e){if(e.content&&e.content.length)for(var t=0;t<e.content.length;t++)if(e.content[t].length)return!0;return!1}(e)&&(e.graphicProperties.padding=0);var t=[],i={paramA:d,paramB:e,merge:!0,mergedKeys:t};if(!s.compareAndMergeParams(i)){var r=p.getRepManipulator();r&&r.deactivate(),p.setName(d.name),m.modify(d),t.includes("content")||m.stopEdition(),r&&r.activate(),p._updateVisibility()}}};let v=function(){p&&p._updateVisibility(),u=null};this.onViewerEventCB=function(e){p&&e&&("onDMUSlideStartDisplay"!==e.eventType&&"onDMUSlideDisplayed"!==e.eventType||(P="onDMUSlideStartDisplay"===e.eventType,M()),d&&m&&(m.stopEdition(),("@onWindowResized"===e.eventType||"onSwapVisibleSpace"===e.eventType||d.pointedReferences&&("onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType))&&("@onWindowResized"===e.eventType||"onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType?u||(u=setTimeout(v)):p._updateVisibility())))}}})}),define("DS/DMUPlayMarker/DMUMarker3DText",["DS/DMUPlayMarker/DMUMarker3D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DTextNode3D","DS/DMUPlayMarker/DMUMarkerShapeGrid","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";var a=[{name:"sTextContents",type:"string",JSONname:"Properties3DText.TextContents",defaultValue:[""]},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties3DText.textGraphicRepresentation"},{name:"bHasALeader",type:"bool",JSONname:"Properties3DText.HasALeader",defaultValue:!0},{name:"sLeaderEndType",type:"string",JSONname:"Properties3DText.LeaderEndType",defaultValue:"None"},{name:"vLeaderBreakPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderBreakPoint3D",defaultValue:new t.Vector3},{name:"lLeaderPointingPoints",type:"ListVector3",JSONname:"Properties3DText.LeaderPointingPoints",defaultValue:[]},{name:"lLeaderRelativePointingPoints",type:"ListVector3",JSONname:"Properties3DText.LeaderRelativePointingPoints",defaultValue:null},{name:"fTextBoxLength",type:"float",JSONname:"Properties3DText.TextBoxLength"},{name:"fTextBoxWidth",type:"float",JSONname:"Properties3DText.TextBoxWidth"},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"Properties3DText.LeaderAttachWidthRatio"},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"Properties3DText.LeaderAttachLengthRatio"},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new t.Color("#000000")},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",defaultValue:new t.Color("#3d3d3d")},{name:"sAnchorMode",type:"string",JSONname:"Properties3DText.AnchorMode",defaultValue:"center"},{name:"fImageWidth",type:"float",JSONname:"Properties3DText.imgData.imgWidth"},{name:"fImageHeight",type:"float",JSONname:"Properties3DText.imgData.imgHeight"},{name:"sImageType",type:"string",JSONname:"Properties3DText.imgData.type"},{name:"sImageData",type:"string",JSONname:"Properties3DText.imgData.data"},{name:"bInvertH",type:"bool",JSONname:"Properties3DText.imgData.InvertH"},{name:"bInvertV",type:"bool",JSONname:"Properties3DText.imgData.InvertV"},{name:"fBorderRadius",type:"float",JSONname:"Properties3DText.BorderRadius",defaultValue:4},{name:"bZoomMode",type:"bool",JSONname:"Properties3DText.ZoomMode",defaultValue:!1},{name:"oHyperlinks",type:"objectDefinition",JSONname:"Properties3DText.hyperlink"},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties3DText.BoxRotationAngle"},{name:"vRelativePosition",type:"Vector3",JSONname:"Properties3DText.RelativePoint"},{name:"sPositionalReference",type:"string",JSONname:"Properties3DText.PositionalReference"},{name:"sImageSrc",type:"ImageURL",JSONname:"Properties3DText.imgData.imgSrc"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"},{name:"MarkerImg",type:"ImageURL",JSONname:"Properties3DText.MarkerImg",defaultValue:""},{name:"vLeaderPointingPoint3D",type:"Vector3",JSONname:"Properties3DText.LeaderPointingPoint3D"}];return e.extend({init:function(e,t,s){this._parent(e,t),this.addParameters(a),this.removeParameters(["fLineStyleOpacity"]);var l=s||{};this.setAttribute("sType",l.type?l.type:"Marker3DText");var d=this;this.getPixelFontSize=function(){if(d.getNode())return d.getNode().getPixelFontSize()},this.convertPixelToModelOnScreen=function(e){if(d.getNode())return d.getNode().convertPixelToModel({sizeinPixels:e})};var p=!1;this.setTextEditionFlag=function(e){(p=e)||d.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:d})},this.isTextEdited=function(){return p};var c={frmWindow:this._frmWindow,getType:this.getType,mkvShape:new r(this),onStartContentEditionCB:function(){d.setTextEditionFlag(!0)},onEndContentEditionCB:function(){d.setTextEditionFlag(!1)},onContentModifiedCB:l.onContentModifiedCB?l.onContentModifiedCB:function(e){if(e.text!==d.getAttribute("sTextContents")){var t,i=e.text,r=!0;for(t=0;t<i.length;t++)if(i[t]){r=!1;break}if(r)for(t=0;t<i.length;t++)i[t]=" ";d.setAttribute("sTextContents",i),d.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:d})}}};l.nodeParams&&Object.keys(l.nodeParams).forEach(function(e){c[e]=l.nodeParams[e]}),this.setNode(new(l.nodeClass?l.nodeClass:i)(c)),this.initContextualBar(l.ctxBar?l.ctxBar:"DS/DMUMarker/DMUMarkerTextContextualBar"),this.getImageToDisplay=function(){return d.getAttribute("sImageType")&&d.getAttribute("sImageData")?n.getImageDataUrl(d.getAttribute("sImageType"),d.getAttribute("sImageData")):d.getAttribute("sImageSrc")?d.getAttribute("sImageSrc"):d.getAttribute("MarkerImg")},this.getManipulationData=function(){return this.getNode().getLabelParams()},this.updateModel=function(e){for(var t=0;t<e.leaderPoints.length;t++)d.modifyLeaderPointingPoint(t,o.getRelativePosition(d,e.leaderPoints[t]));d.setAttributes([{name:"vLeaderBreakPoint3D",value:o.getRelativePosition(d,e.position)},{name:"fBoxRotationAngle",value:e.rotationAngle}])},this.startEdition=function(){!d.isReadOnly()&&d.isInEdition()&&d.getNode().startEdition&&d.getNode().startEdition()},this.isZoomMode=function(){return d.getAttribute("bZoomMode")},this.getPointingPoints=function(){let e=d.getAttribute("lLeaderRelativePointingPoints")||[];return d.getAttribute("lLeaderPointingPoints").map((t,i)=>o.getAbsolutePosition(d,e[i],t,d.getPointedReference(i)))};var h=this.refreshNode;this.refreshNode=function(){d.getNode()&&!t.isImporting()&&(d.getNode().update({name:d.getAttribute("sName"),pointedReferences:d.getAttribute("lPointedReferences"),isVisible:d.getAttribute("bVisible"),content:d.getAttribute("sTextContents"),tessRep:d.getAttribute("sTextGraphicRepresentation"),position:o.getAbsolutePosition(d,d.getAttribute("vRelativePosition"),d.getAttribute("vLeaderBreakPoint3D"),d.getAttribute("sPositionalReference")),pointingPoints:d.getPointingPoints(),anchorMode:d.getAttribute("sAnchorMode"),hasALeader:d.getAttribute("bHasALeader"),markerImage:d.getImageToDisplay(),imageWidth:d.getAttribute("fImageWidth"),imageHeight:d.getAttribute("fImageHeight"),boxWidth:d.getAttribute("fTextBoxWidth"),boxHeight:d.getAttribute("fTextBoxLength"),imageInvertH:d.getAttribute("bInvertH"),imageInvertV:d.getAttribute("bInvertV"),leaderEndType:d.getAttribute("sLeaderEndType"),isFilled:d.getAttribute("bIsFilled"),hasBorder:d.getAttribute("bHasBorder"),zoomMode:d.getAttribute("bZoomMode"),leaderAttachWidthRatio:d.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:d.getAttribute("fLeaderAttachLengthRatio"),hyperlinks:d.getAttribute("oHyperlinks"),boxRotationAngle:d.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:d.getAttribute("fBorderRadius"),fontStyle:{pxheight:d.getAttribute("iFontSize")*(4/3),fontSize:d.getAttribute("fFontSize"),familyName:d.getAttribute("sFontName"),familyStyle:d.getAttribute("sFontStyle"),color:d.getAttribute("cFontColor")},fillStyle:{color:d.getAttribute("cFillStyleColor"),opacity:d.getAttribute("fOpacity"),gradient:d.getAttribute("oGradient")},lineStyle:{thickness:o.getLineThickness(d.getAttribute("fLineStyleThicknessIndex"))||d.getAttribute("fLineStyleThickness"),pattern:d.getAttribute("sLineStylePattern"),color:d.getAttribute("cLineStyleColor")},leaderStyle:{thickness:o.getLineThickness(d.getAttribute("fLeaderStyleThicknessIndex"))||d.getAttribute("fLeaderStyleThickness"),pattern:d.getAttribute("sLeaderStylePattern"),color:d.getAttribute("cLeaderStyleColor")}}}),h())}},setAttribute:function(e,t){"sImageData"===e?(this._parent("MarkerImg",null),this._parent("sImageSrc",null)):"fFontSize"===e?this._parent("iFontSize",null):"vLeaderBreakPoint3D"===e?this.updatePointedPosition(t):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),this._parent(e,t)},getAttribute:function(e){var t;if("lLeaderPointingPoints"===e){var i=this._parent("lLeaderPointingPoints"),r=[];if(i&&i.length)for(t=0;t<i.length;t++)r.push(i[t].clone());else{var n=this._parent("vLeaderPointingPoint3D");n&&r.push(n.clone())}return r}return this._parent(e)},modifyLeaderPointingPoint:function(e,t){var i=this.getAttribute("lLeaderPointingPoints");e<i.length&&(i[e]=t),this.setAttribute("lLeaderPointingPoints",i)}})}),define("DS/DMUPlayMarker/DMUCommentAnnotationBase",["require","exports","DS/DMUPlayMarker/DMUCommentableObject"],function(e,t,i){"use strict";let r=[{name:"vPosition",type:"Vector3",JSONname:"PropertiesCommentBase.Position"}];return class extends i{constructor(e,t){super(e,t),this.addParameters(r);let i=this;this.initContextualBar("DS/DMUComment/DMUCommentContextualBar"),this.getOwner=function(){let e=i.getAttribute("lComments");if(e&&e.length)return e[0].getAttribute("sOwner")},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){"vPosition"===e&&i.updatePointedPosition(t),i._parentSetAttribute(e,t)}}}}),define("DS/DMUPlayMarker/DMUMarker2DText",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DTextNode3D","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerShapeGrid","DS/DMUBaseExperience/EXPUtils","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a){"use strict";var s=[{name:"sTextContents",type:"string",JSONname:"Properties2DText.TextContents",defaultValue:[""]},{name:"sTextGraphicRepresentation",type:"string",JSONname:"Properties2DText.textGraphicRepresentation"},{name:"bHasALeader",type:"bool",JSONname:"Properties2DText.HasALeader",defaultValue:!1},{name:"sLeaderEndType",type:"string",JSONname:"Properties2DText.LeaderEndType",defaultValue:"None"},{name:"vLeaderBreakPoint2D",type:"Vector2",JSONname:"Properties2DText.LeaderBreakPoint2D",defaultValue:new t.Vector2(0,0)},{name:"lLeaderPointingPoints",type:"ListVector2",JSONname:"Properties2DText.LeaderPointingPoints",defaultValue:[]},{name:"fTextBoxLength",type:"float",JSONname:"Properties2DText.TextBoxLength"},{name:"fTextBoxWidth",type:"float",JSONname:"Properties2DText.TextBoxWidth"},{name:"fLeaderAttachWidthRatio",type:"float",JSONname:"Properties2DText.LeaderAttachWidthRatio"},{name:"fLeaderAttachLengthRatio",type:"float",JSONname:"Properties2DText.LeaderAttachLengthRatio"},{name:"sAnchorMode",type:"string",JSONname:"Properties2DText.AnchorMode",defaultValue:"center"},{name:"sFontName",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyName",defaultValue:"sans-serif"},{name:"sFontStyle",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.familyStyle",defaultValue:"normal"},{name:"fFontSize",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.fontSize"},{name:"sLineStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.pattern",defaultValue:"1"},{name:"fLineStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LineStyle.thickness",defaultValue:1},{name:"sLeaderStylePattern",type:"string",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.pattern",defaultValue:"1"},{name:"fLeaderStyleThickness",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thickness",defaultValue:1},{name:"fLeaderStyleThicknessIndex",type:"float",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.thicknessIndex"},{name:"cLeaderStyleColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.LeaderStyle.color",defaultValue:new t.Color(4013373)},{name:"cFontColor",type:"Color",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.color",defaultValue:new t.Color(0)},{name:"fImageWidth",type:"float",JSONname:"Properties2DText.imgData.imgWidth"},{name:"fImageHeight",type:"float",JSONname:"Properties2DText.imgData.imgHeight"},{name:"sImageType",type:"string",JSONname:"Properties2DText.imgData.type"},{name:"sImageData",type:"string",JSONname:"Properties2DText.imgData.data"},{name:"bInvertH",type:"bool",JSONname:"Properties2DText.imgData.InvertH"},{name:"bInvertV",type:"bool",JSONname:"Properties2DText.imgData.InvertV"},{name:"fBorderRadius",type:"float",JSONname:"Properties2DText.BorderRadius",defaultValue:4},{name:"oHyperlinks",type:"objectDefinition",JSONname:"Properties2DText.hyperlink"},{name:"fBoxRotationAngle",type:"float",JSONname:"Properties2DText.BoxRotationAngle"},{name:"sImageSrc",type:"ImageURL",JSONname:"Properties2DText.imgData.imgSrc"},{name:"iFontSize",type:"int",JSONname:"PropertiesMarkerBase.GraphicProperties.FontStyle.height"},{name:"MarkerImg",type:"ImageURL",JSONname:"Properties2DText.MarkerImg"},{name:"vLeaderPointingPoint2D",type:"Vector2",JSONname:"Properties2DText.LeaderPointingPoint2D"}];return e.extend({init:function(e,l,d){this._parent(e,l),this.addParameters(s),this.removeParameters(["fLineStyleOpacity"]);var p=d||{};this.setAttribute("sType",p.type?p.type:"Marker2DText");var c=this;this.getPixelFontSize=function(){if(c.getNode())return c.getNode().getPixelFontSize()},this.convertPixelToModelOnScreen=function(e){if(c.getNode())return c.getNode().convertPixelToModel({sizeinPixels:e})};var h=!1;this.setTextEditionFlag=function(e){(h=e)||c.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:c})},this.isTextEdited=function(){return h};var u={frmWindow:this._frmWindow,getType:this.getType,mkvShape:new n(this),onStartContentEditionCB:function(){c.setTextEditionFlag(!0)},onEndContentEditionCB:function(){c.setTextEditionFlag(!1)},onContentModifiedCB:function(e){if(e.text!==c.getAttribute("sTextContents")){var t,i=e.text,r=!0;for(t=0;t<i.length;t++)if(i[t]){r=!1;break}if(r)for(t=0;t<i.length;t++)i[t]=" ";c.setAttribute("sTextContents",i),c.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:c})}}};p.nodeParams&&Object.keys(p.nodeParams).forEach(function(e){u[e]=p.nodeParams[e]}),this.setNode(new(p.nodeClass?p.nodeClass:i)(u)),this.initContextualBar(p.ctxBar?p.ctxBar:"DS/DMUMarker/DMUMarkerTextContextualBar"),this.getManipulationData=function(){return this.getNode().getLabelParams()},this.getImageToDisplay=function(){return c.getAttribute("sImageType")&&c.getAttribute("sImageData")?o.getImageDataUrl(c.getAttribute("sImageType"),c.getAttribute("sImageData")):c.getAttribute("sImageSrc")?c.getAttribute("sImageSrc"):c.getAttribute("MarkerImg")},this.updateModel=function(e){for(var i,n=0;n<e.leaderPoints.length;n++)i=r.getViewerPositionFromPoint(c.getViewer(),e.leaderPoints[n]),c.modifyLeaderPointingPoint(n,new t.Vector2(i.left,i.top));i=r.getViewerPositionFromPoint(c.getViewer(),e.position),c.setAttributes([{name:"vLeaderBreakPoint2D",value:new t.Vector2(i.left,i.top)},{name:"fBoxRotationAngle",value:e.rotationAngle}])},this.startEdition=function(){!c.isReadOnly()&&c.isInEdition()&&c.getNode().startEdition&&c.getNode().startEdition()},this.getMaximumProportionalWidth=function(){var e=0;if(c.getAttribute("bProportionalPosition")){var t=c.getAttribute("vLeaderBreakPoint2D"),i=c.getAttribute("fTextBoxWidth");if("center"===c.getAttribute("sAnchorMode")&&(i/=2,t&&i&&Math.abs(t.x-i)>e&&(e=Math.abs(t.x-i))),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i),c.getAttribute("bHasALeader")&&(t=c.getAttribute("lLeaderPointingPoints"))&&t.length)for(var r=0;r<t.length;r++)Math.abs(t[r].x)>e&&(e=Math.abs(t[r].x))}return e};var g=this.refreshNode;this.refreshNode=function(){c.getNode()&&!l.isImporting()&&(c.getNode().update({name:c.getAttribute("sName"),isVisible:c.getAttribute("bVisible"),content:c.getAttribute("sTextContents"),tessRep:c.getAttribute("sTextGraphicRepresentation"),breakPoint2D:c.getAttribute("vLeaderBreakPoint2D"),pointingPoints:c.getAttribute("lLeaderPointingPoints"),inEdition:c.isInEdition(),windowAnchor:c.getAttribute("sWindowAnchor"),hasALeader:c.getAttribute("bHasALeader"),leaderEndType:c.getAttribute("sLeaderEndType"),isFilled:c.getAttribute("bIsFilled"),hasBorder:c.getAttribute("bHasBorder"),anchorMode:c.getAttribute("sAnchorMode"),isPositionProportional:c.getAttribute("bProportionalPosition"),leaderAttachWidthRatio:c.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:c.getAttribute("fLeaderAttachLengthRatio"),hyperlinks:c.getAttribute("oHyperlinks"),markerImage:c.getImageToDisplay(),imageWidth:c.getAttribute("fImageWidth"),imageHeight:c.getAttribute("fImageHeight"),boxHeight:c.getAttribute("fTextBoxLength"),boxWidth:c.getAttribute("fTextBoxWidth"),imageInvertH:c.getAttribute("bInvertH"),imageInvertV:c.getAttribute("bInvertV"),boxRotationAngle:c.getAttribute("fBoxRotationAngle"),graphicProperties:{borderRadius:c.getAttribute("fBorderRadius"),fontStyle:{pxheight:c.getAttribute("iFontSize")*(4/3),fontSize:c.getAttribute("fFontSize"),familyName:c.getAttribute("sFontName"),familyStyle:c.getAttribute("sFontStyle"),color:c.getAttribute("cFontColor")},fillStyle:{color:c.getAttribute("cFillStyleColor"),opacity:c.getAttribute("fOpacity"),gradient:c.getAttribute("oGradient")},lineStyle:{thickness:a.getLineThickness(c.getAttribute("fLineStyleThicknessIndex"))||c.getAttribute("fLineStyleThickness"),pattern:c.getAttribute("sLineStylePattern"),color:c.getAttribute("cLineStyleColor")},leaderStyle:{thickness:a.getLineThickness(c.getAttribute("fLeaderStyleThicknessIndex"))||c.getAttribute("fLeaderStyleThickness"),pattern:c.getAttribute("sLeaderStylePattern"),color:c.getAttribute("cLeaderStyleColor")}}}),g())},this.modifyLeaderPointingPoint=function(e,t){var i=c.getAttribute("lLeaderPointingPoints");e<i.length&&(i[e]=t),c.setAttribute("lLeaderPointingPoints",i)}},setAttribute:function(e,t){"sImageData"===e?(this._parent("MarkerImg",null),this._parent("sImageSrc",null)):"fFontSize"===e?this._parent("iFontSize",null):"fLeaderStyleThicknessIndex"===e&&this._parent("fLeaderStyleThickness",null),this._parent(e,t)},getAttribute:function(e){var t;if("lLeaderPointingPoints"===e){var i=this._parent("lLeaderPointingPoints"),r=[];if(i&&i.length)for(t=0;t<i.length;t++)r.push(i[t].clone());else{var n=this._parent("vLeaderPointingPoint2D");n&&r.push(n.clone())}return r}return"vLeaderBreakPoint2D"===e?this._parent(e).clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker2DPicture",["DS/DMUPlayMarker/DMUMarker2DText","DS/DMUPlayMarker/DMUMarker2DPictureNode3D","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"bShortDisplay",type:"bool",JSONname:"Properties2DPicture.Shortdisplay",defaultValue:!1},{name:"fCreationDate",type:"float",JSONname:"Properties2DPicture.CreationDate",defaultValue:null}];return e.extend({init:function(e,o){this._parent(e,o,{type:"Marker2DPicture",ctxBar:"DS/DMUMarker/DMUMarkerPictureContextualBar",nodeClass:t}),this.addParameters(n);var a=this,s=this.updateModel;this.updateModel=function(e){s(e),a.setAttributes([{name:"fImageWidth",value:e.imgWidth},{name:"fImageHeight",value:e.imgHeight}])},this.getPictureLabel=function(){if(a.getAttribute("bShortDisplay"))return[];var e=a.getAttribute("sTextContents")[0]||"";return a.getAttribute("fCreationDate")&&(e+=" | "+i.formatDate(a.getAttribute("fCreationDate"))),[e]};var l=this.refreshNode;this.refreshNode=function(){a.getNode()&&!o.isImporting()&&(a.getNode().update({name:a.getAttribute("sName"),content:a.getAttribute("bShortDisplay")?[]:a.getAttribute("sTextContents"),isVisible:a.getAttribute("bVisible"),hasALeader:a.getAttribute("bHasALeader"),leaderEndType:a.getAttribute("sLeaderEndType"),breakPoint2D:a.getAttribute("vLeaderBreakPoint2D"),pointingPoints:a.getAttribute("lLeaderPointingPoints"),inEdition:a.isInEdition(),isFilled:a.getAttribute("bIsFilled"),hasBorder:a.getAttribute("bHasBorder"),imageWidth:a.getAttribute("fImageWidth"),imageHeight:a.getAttribute("fImageHeight"),imageInvertH:a.getAttribute("bInvertH"),imageInvertV:a.getAttribute("bInvertV"),markerImage:a.getImageToDisplay(),shortDisplay:a.getAttribute("bShortDisplay")||!a.getPictureLabel()[0],windowAnchor:a.getAttribute("sWindowAnchor"),anchorMode:a.getAttribute("sAnchorMode"),isPositionProportional:a.getAttribute("bProportionalPosition"),leaderAttachWidthRatio:a.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:a.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:a.getAttribute("fBoxRotationAngle"),creationDate:a.getAttribute("fCreationDate"),graphicProperties:{borderRadius:a.getAttribute("fBorderRadius"),fontStyle:{pxheight:a.getAttribute("iFontSize")*(4/3),fontSize:a.getAttribute("fFontSize"),familyName:a.getAttribute("sFontName"),familyStyle:a.getAttribute("sFontStyle"),color:a.getAttribute("cFontColor")},fillStyle:{color:a.getAttribute("cFillStyleColor"),opacity:a.getAttribute("fOpacity"),gradient:a.getAttribute("oGradient")},lineStyle:{thickness:r.getLineThickness(a.getAttribute("fLineStyleThicknessIndex"))||a.getAttribute("fLineStyleThickness"),pattern:a.getAttribute("sLineStylePattern"),color:a.getAttribute("cLineStyleColor")},leaderStyle:{thickness:r.getLineThickness(a.getAttribute("fLeaderStyleThicknessIndex"))||a.getAttribute("fLeaderStyleThickness"),pattern:a.getAttribute("sLeaderStylePattern"),color:a.getAttribute("cLeaderStyleColor")}}}),l())}},getMaximumProportionalWidth:function(){var e=this._parent();if(this.getAttribute("bProportionalPosition")){var t=this.getAttribute("vLeaderBreakPoint2D"),i=this.getAttribute("fImageWidth");"center"===this.getAttribute("sAnchorMode")&&(i/=2),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e},setAttribute:function(e,t){"fTextBoxWidth"===e?(this._parent("fTextBoxWidth",null),this._parent("fImageWidth",t)):"fTextBoxLength"===e?(this._parent("fTextBoxLength",null),this._parent("fImageHeight",t)):this._parent(e,t)},getAttribute:function(e){var t=this._parent(e);return"fImageWidth"===e?null==t&&(t=this._parent("fTextBoxWidth")):"fImageHeight"===e&&null==t&&(t=this._parent("fTextBoxLength")),t}})}),define("DS/DMUPlayMarker/DMUMarker3DArrowNode3D",["require","exports","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l){"use strict";return class extends l{constructor(e){super(e);let t,l,d,p,c,h,u=this,g=u.getViewer(),P=new i({type:"Cylindrical"}),f=1;this.addChild(P),P.setPickParent(!0);let S=new n;P.addChild(S),S.setPickParent(!0),S.setMatrix(new r.Matrix4(0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1)),this.linkManipulatorToNode(S),this.getRepNode=function(){return P},this.updateRepresentation=function(e,i){if(!c)return;let n=e.endingPoint.clone().sub(e.pointingPoint),a=s.getArrowSpecs(e.width,n.length(),e.shaftRatio,c.headRatio,c.style);if(S.removeChildren(),c.isFilled){a.material=t;let e=o.createSimpleMeshNode(a);e.setShadow(!1),e.setPickParent(!0),S.addChild(e)}if(c.hasBorder){let e=o.createLineNode({points:a.coordinates,material:l});e.setShadow(!1),e.setPickParent(!0),S.addChild(e)}P.setConstraintAxis(n.clone()),u.setMatrix((new r.Matrix4).setPosition(e.pointingPoint)),t&&l&&(t.setOpacity((c.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),l.setOpacity((c.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))},this.getArrowParams=function(){return c?{pointingPoint:c.firstPoint,endingPoint:c.secondPoint,width:c.width,shaftRatio:c.shaftRatio,pointedPage:c.pointedPage}:{}};let y=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){y(),h&&clearTimeout(h),h=null,l&&l.dispose(),t&&t.dispose(),t=l=P=S=c=null},this._updateVisibility=function(e){if(!c)return;void 0!==e&&(f=e);let t=s.is3DMarkerDisplayed(g,c.pointedReferences,!0);u.setVisibility(f>0&&c.isVisible&&t),g.render()},this.getArrowSpecs=function(){return d},this.update=function(e){if(!u)return;c||(c={graphicProperties:{fillStyle:{},lineStyle:{}}});let i=!1,n=[],h={paramA:c,paramB:e,merge:!0,mergedKeys:n},g=this.getRepManipulator();if(g&&g.deactivate(),!s.compareAndMergeParams(h)){if(u.setName(c.name),(!d||n.includes("secondPoint")||n.includes("firstPoint")||n.includes("width")||n.includes("shaftRatio")||n.includes("headRatio")||n.includes("style"))&&(i=!0,p=c.secondPoint.clone().sub(c.firstPoint),d=s.getArrowSpecs(c.width,p.length(),c.shaftRatio,c.headRatio,c.style)),t?n.includes("fillStyle")&&(t.color=c.graphicProperties.fillStyle.color,t.setOpacity(c.graphicProperties.fillStyle.opacity)):(i=!0,t=a.createBasicMaterial({color:c.graphicProperties.fillStyle.color,opacity:c.graphicProperties.fillStyle.opacity})),l?n.includes("lineStyle")&&(l.color=c.graphicProperties.lineStyle.color,l.setOpacity(c.graphicProperties.lineStyle.opacity),l.setLineWidth((c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),l.setDashPatternType(a.getDashType(c.graphicProperties.lineStyle.pattern))):(i=!0,l=a.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:(c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),(n.includes("isFilled")||n.includes("hasBorder"))&&(i=!0),i){if(S.removeChildren(),c.isFilled){d.material=t;let e=o.createSimpleMeshNode(d);e.setShadow(!1),e.setPickParent(!0),S.addChild(e)}if(c.hasBorder){let e=o.createLineNode({points:d.coordinates,material:l});e.setShadow(!1),e.setPickParent(!0),S.addChild(e)}}P.setConstraintAxis(p.clone()),u.setMatrix((new r.Matrix4).setPosition(c.firstPoint)),u._updateVisibility()}g&&g.activate()};let m=function(){u&&u._updateVisibility(),h=null};this.onViewerEventCB=function(e){u&&c&&(h||!c.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(h=setTimeout(m)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DArrow",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DArrowNode3D"],function(e,t,i,r,n,o){"use strict";let a=[{name:"vFirstPoint",type:"Vector3",JSONname:"Properties3DArrow.FirstPoint",defaultValue:new i.Vector3},{name:"vSecondPoint",type:"Vector3",JSONname:"Properties3DArrow.SecondPoint",defaultValue:new i.Vector3(10,0,0)},{name:"vFirstPointRelativePosition",type:"Vector3",JSONname:"Properties3DArrow.FirstPointRelativePosition",defaultValue:null},{name:"vSecondPointRelativePosition",type:"Vector3",JSONname:"Properties3DArrow.SecondPointRelativePosition",defaultValue:null},{name:"fWidth",type:"float",JSONname:"Properties3DArrow.Width",defaultValue:1},{name:"sStyle",type:"string",JSONname:"Properties3DArrow.Style",defaultValue:"beginSide"},{name:"fShaftRatio",type:"float",JSONname:"Properties3DArrow.ShaftRatio",defaultValue:.8},{name:"fHeadRatio",type:"float",JSONname:"Properties3DArrow.HeadRatio",defaultValue:.5}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DArrow");let i=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getArrowParams()},this.updateModel=function(e){i.updatePointedElement(e.pointingPoint),i.setAttributes([{name:"fWidth",value:e.width},{name:"vFirstPoint",value:n.getRelativePosition(i,e.pointingPoint)},{name:"vSecondPoint",value:n.getRelativePosition(i,e.endingPoint)},{name:"fShaftRatio",value:e.shaftRatio}])};let r=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),firstPoint:n.getAbsolutePosition(i,i.getAttribute("vFirstPointRelativePosition"),i.getAttribute("vFirstPoint"),i.getPointedReference(0)),secondPoint:n.getAbsolutePosition(i,i.getAttribute("vSecondPointRelativePosition"),i.getAttribute("vSecondPoint"),i.getPointedReference(1)),width:i.getAttribute("fWidth"),style:i.getAttribute("sStyle"),shaftRatio:i.getAttribute("fShaftRatio"),headRatio:i.getAttribute("fHeadRatio"),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:i.getAttribute("bHasBorder"),pointedPage:i.getAttribute("fPointedPageNumber"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:n.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"),color:i.getAttribute("cLineStyleColor"),opacity:i.getAttribute("fLineStyleOpacity")}}}),r())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"vFirstPoint"===e&&i.updatePointedPosition(t):i.setAttribute("bHasBorder",!0):i.setAttribute("bIsFilled",!0),i._parentSetAttribute(e,t)},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vFirstPoint"===e||"vSecondPoint"===e?i._parentGetAttribute(e).clone():i._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker2DEllipseNode3D",["DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a){"use strict";return o.extend({init:function(o){this._parent(o);var s,l,d=this,p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},c=new e({type:"Spherical"});this.addChild(c),c.setPickParent(!0);var h=new i({ratio:1});c.addChild(h),h.setPickParent(!0),this.removeDMUNode3DOverload=function(){d=s=l=c=h=null},this.updateScreenPosition=function(){p&&d.setMatrix((new t.Matrix4).setPosition(d.get3DPositionFromScreenCoordinates({coords:p.center,width:2*Math.max(p.xAxisLengthPx,p.yAxisLengthPx),anchor:"center",windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional})))},this.update=function(e){if(d){if(JSON.stringify(e)!==JSON.stringify(p)||p.isPositionProportional&&(p.screenWidth!==d.getViewer().SCREEN_WIDTH||p.screenHeight!==d.getViewer().SCREEN_HEIGHT)){var i=p.graphicProperties&&p.graphicProperties.fillStyle?JSON.stringify(p.graphicProperties.fillStyle):"",o=p.graphicProperties&&p.graphicProperties.lineStyle?JSON.stringify(p.graphicProperties.lineStyle):"";p=d.mergeParams(p,e),d.setName(p.name),p.screenWidth=d.getViewer().SCREEN_WIDTH,p.screenHeight=d.getViewer().SCREEN_HEIGHT,p.isPositionProportional?(p.xAxisLengthPx=d.convertProportionalCoordInPixels(p.xAxisLength,!0),p.yAxisLengthPx=d.convertProportionalCoordInPixels(p.yAxisLength,!0),p.CenterPx=d.convertCoordsInPixels({coords:p.center,windowAnchor:p.windowAnchor,fitOnX:!0})):(p.xAxisLengthPx=p.xAxisLength,p.yAxisLengthPx=p.yAxisLength,p.CenterPx=p.center),h.removeChildren();var c=new t.Matrix4;p.rotationAngle&&c.makeRotationAxis(new t.Vector3(0,0,1),p.rotationAngle);var u,g=a.getEllipseSpecs(p.xAxisLengthPx,p.yAxisLengthPx,1);p.isFilled&&(s&&JSON.stringify(p.graphicProperties.fillStyle)===i||(s=n.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})),g.material=s,(u=r.createSimpleMeshNode(g)).setShadow(!1),u.setPickParent(!0),u.setMatrix(c),h.addChild(u)),p.hasBorder&&(l&&JSON.stringify(p.graphicProperties.lineStyle)===o||(l=n.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:p.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),(u=r.createLineNode({points:g.coordinates,material:l})).setShadow(!1),u.setPickParent(!0),u.setMatrix(c),h.addChild(u)),d.setVisibility(p.isVisible)}d.updateScreenPosition()}},this.onViewerEventCB=function(e){d&&"onSwapVisibleSpace"===e.eventType&&p&&d.setVisibility(p.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DEllipse",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DEllipseNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"vCenter",type:"Vector2",JSONname:"Properties2DEllipse.center",defaultValue:new t.Vector2},{name:"fxAxisLength",type:"float",JSONname:"Properties2DEllipse.xAxisLength",defaultValue:100},{name:"fyAxisLength",type:"float",JSONname:"Properties2DEllipse.yAxisLength",defaultValue:100}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DEllipse");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),xAxisLength:o.getAttribute("fxAxisLength"),yAxisLength:o.getAttribute("fyAxisLength"),center:o.getAttribute("vCenter"),windowAnchor:o.getAttribute("sWindowAnchor"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),rotationAngle:"number"==typeof o.getAttribute("fScreenRotationAngle")?o.getAttribute("fScreenRotationAngle"):o.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vCenter"),i=o.getAttribute("fxAxisLength")/2;t&&i&&Math.abs(t.x-i)>e&&(e=Math.abs(t.x-i)),t&&i&&Math.abs(t.x)+i>e&&(e=Math.abs(t.x)+i)}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?"fxAxisLength"===e||"fyAxisLength"===e?t>0&&this._parent(e,t):this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vCenter"===e?this._parent("vCenter").clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker3DPictureNode3D",["DS/Visualization/Node3D","DS/DMUBaseUI/DMUManipulableNode3D","DS/Visualization/ThreeJS_DS","DS/DMUMarkerVisu/DMUMarkerVisuPictureShapeNode","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s){"use strict";return t.extend({init:function(t){var l=t||{};this._parent(l);var d=this,p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},c=d.getViewer(),h=1;let u,g=!1,P=!1;var f=new r({window:l.frmWindow,data:{isPicture:!0,mkvShape:l.mkvShape,graphicProperties:{padding:0}},onDragStart:function(e){e&&e.dataTransfer&&e.dataTransfer.setData("text",p.draggableContent||"")}});this.addChild(f),f.setPickParent(!0);var S=new e;function y(){if(S&&p){let e=!g&&!P&&p.hasALeader;S.setVisibility(e),S.setVisibilityFree(!e)}}function m(t,r,d,h){if(y(),p.hasALeader&&(0===c.getVisibleSpace()&&!1===p.isVisible||1===c.getVisibleSpace()&&!0===p.isVisible)){var u=0;switch(p.leaderEndType){case"Arrow":u=1;break;case"Bubble":u=2;break;case"Cross":u=4;break;case"Square":u=3}if(d.offsetWidth>0&&d.offsetWidth>0){var g,P,f=t.clone(),m={offsetWidth:d.width/window.devicePixelRatio,offsetHeight:d.height/window.devicePixelRatio,rotationAngle:h};if("topleft"===p.anchorMode)if(p.zoomMode){var D=c.currentViewpoint.getUpDirection().clone(),M=(new i.Vector3).crossVectors(c.currentViewpoint.getSightDirection(),D).setLength(d.offsetWidth/2);D.setLength(-d.offsetHeight/2),f.add(D),f.add(M)}else{var b=o.getViewerPositionFromPoint(c,f);if(b&&!isNaN(b.left)&&!isNaN(b.top)){var A=new i.Vector2(b.left+m.offsetWidth/2,b.top+m.offsetHeight/2),v=o.getLineFromWindowPosition(c,A.x,A.y),x=o.getViewpointInfo(c.currentViewpoint),w=a.computeLinePlaneDistance(v.position.toArray(),v.direction.toArray(),p.position.toArray(),x.sight.toArray());f=new i.Vector3(w.aPosition[0],w.aPosition[1],w.aPosition[2])}}if(r&&r.length){var k=[];if(1===c.getVisibleSpace()&&p.pointedReferences&&p.pointedReferences.length){var N=s.getPointedReferencesVisibilityStates(c,p.pointedReferences);for(P=N.length-1;P>=0;P--)N[P]&&r[P]&&k.push(r[P])}else k=r.slice();var U=S.getChildren();for(P=0;P<k.length;P++){(g=U[P])||((g=new e("DMUMarkerLeaderNode")).setPickParent(!0),S.addChild(g));let t={width:p.leaderAttachWidthRatio,height:p.leaderAttachLengthRatio},i=n.modifyLeaderNode(c,g,!0,f,k[P],t,p.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,p.graphicProperties.leaderStyle.color,p.graphicProperties.leaderStyle.pattern,u,m,l.frmWindow);g.setVisibility(i)}if(U=S.getChildren(),k.length<U.length)for(P=U.length-1;P>=k.length;P--)U[P].isManipulator||S.removeChild(U[P])}}}}this.addChild(S),S.setPickParent(!0),this.linkManipulatorToNode(f.getBackNode()),this.getRepNode=function(){return{leader:S,box:f.getLabelNode()}},this.hasTessellatedRepresentation=function(){return p&&p.tessRep&&p.tessRep.length},this.getLabelDimensions=function(){var e=f.getDimensions();return e.position=p.position,e},this.updateRepresentation=function(e,t){var r=o.convertPixelToModel({sizeInPixels:e.imgWidth,coords:p.zoomMode?e.position:null,viewer:c}),n=o.convertPixelToModel({sizeInPixels:e.imgHeight,coords:p.zoomMode?e.position:null,viewer:c});f.setTransformation({scaleMatrix:(new i.Matrix4).makeScale(p.imageWidth?r/p.imageWidth:1,p.imageHeight?n/p.imageHeight:1,1),rotationAngle:e.rotationAngle}),f.setMatrix((new i.Matrix4).setPosition(e.position)),m(e.position,e.leaderPoints,{width:e.width,height:e.height,offsetWidth:r,offsetHeight:n},e.rotationAngle),f.setGhostMode(t)},this.getLabelParams=function(){var e=f.getDimensions();return{leaderPoints:p.pointingPoints.slice(),position:p.position,rotationAngle:p.boxRotationAngle?p.boxRotationAngle:0,anchorMode:p.anchorMode,width:e.width,height:e.height,imgWidth:o.convertModelToPixels({sizeInMM:p.imageWidth,coords:p.zoomMode?p.position:null,viewer:c}),imgHeight:o.convertModelToPixels({sizeInMM:p.imageHeight,coords:p.zoomMode?p.position:null,viewer:c})}};var D=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){D(),u&&clearTimeout(u),u=null,f&&f.remove(),S=f=d=null},this.getPixelFontSize=function(){var e;return p.graphicProperties.fontStyle.pxheight&&(e=o.convertPixelToModel({sizeInPixels:p.graphicProperties.fontStyle.pxheight,viewer:c})),e||(e=p.graphicProperties.fontStyle.fontSize),o.convertModelToPixels({sizeInMM:e,viewer:c})},this._updateVisibility=function(e,t){if(!p)return;void 0!==e&&(h=e);let i=p.pointedReferences;i&&i.length!==p.pointingPoints.length&&(i=p.pointedReferences.slice(0,p.pointingPoints.length));var r=p.isVisible&&s.is3DMarkerDisplayed(c,i)&&h>0;d.setVisibility(r),0!==h&&f.setOpacity(h),(0===c.getVisibleSpace()&&!r||1===c.getVisibleSpace()&&r)&&(t&&h<1?(g=!0,y()):(g=!1,m(p.position,p.pointingPoints,f.getDimensions(),p.boxRotationAngle))),c.render()},this.update=function(e){if(d){p=p?d.mergeParams(p,e):e;var t=this.getRepManipulator();t&&t.deactivate(),d.setName(p.name),p.graphicProperties.fontStyle.height=d.getPixelFontSize(),f.modify(p),t&&t.activate(),d._updateVisibility()}};let M=function(){d&&d._updateVisibility(),u=null};this.onViewerEventCB=function(e){d&&e&&("onDMUSlideStartDisplay"!==e.eventType&&"onDMUSlideDisplayed"!==e.eventType||(P="onDMUSlideStartDisplay"===e.eventType,y()),p&&("@onWindowResized"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType&&"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||("@onWindowResized"===e.eventType||p.pointedReferences&&("onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType)?u||(u=setTimeout(M)):d._updateVisibility())))}}})}),define("DS/DMUPlayMarker/DMUMarker3DSplineNode3D",["require","exports","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l){"use strict";return class extends l{constructor(e){super(e);let t,l,d,p,c,h,u,g=this,P=g.getViewer(),f=1,S=new a({type:"Spherical"});S.setPickParent(!0),this.addChild(S);let y=new r;S.addChild(y),y.setPickParent(!0),this.linkManipulatorToNode(y),this.updateRepresentation=function(e,i){if(!t)return;let r=new n.Vector3(c?Math.abs(e.width)/c:1,p?Math.abs(e.height)/p:1,1),o=(new n.Matrix4).makeRotationZ(e.rotation).scale(r);y.setMatrix((new n.Matrix4).multiply(o)),g.setMatrix((new n.Matrix4).setPosition(e.position)),l&&l.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(i?.6:1))},this.getRepNode=function(){return S},this.getBoundingBoxDimensions=function(){return{position:h,height:p||0,width:c||0,rotation:t&&t.rotationAngle||0,pointedPage:t?t.pointedPage:void 0}};let m=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){m(),u&&clearTimeout(u),u=null,l&&l.dispose(),S=y=t=l=null,p=c=null},this._updateVisibility=function(e){if(!t)return;void 0!==e&&(f=e);let i=s.is3DMarkerDisplayed(P,t.pointedReferences);g.setVisibility(f>0&&t.isVisible&&i),P.render()},this.update=function(e){if(!g)return;t||(t={graphicProperties:{lineStyle:{}}});let r=!1,a=[],u={paramA:t,paramB:e,merge:!0,mergedKeys:a};if(!s.compareAndMergeParams(u)){let e=this.getRepManipulator();if(e&&e.deactivate(),g.setName(t.name),d&&!a.includes("points")||(r=!0,d=function(e,t){if(!e||!e.length||!t)return;let i=t.up,r=t.right,o=(new n.Vector3).crossVectors(r,i),a=[];e.forEach(function(e){a.push(new n.Vector3(e[0],e[1],e[2]))});let s=new n.SplineCurve3(a).getPoints(200),l=-1/0,d=1/0,u=-1/0,g=1/0,P=-1/0,f=1/0;s.forEach(function(e){l=Math.max(l,e.dot(r)),d=Math.min(d,e.dot(r)),u=Math.max(u,e.dot(i)),g=Math.min(g,e.dot(i)),P=Math.max(P,e.dot(o)),f=Math.min(f,e.dot(o))});let S=new n.Vector3(d,u,P),y=new n.Vector3(l,g,f);(h=(new n.Vector3).addVectors(S,y).multiplyScalar(.5)).applyMatrix4((new n.Matrix4).makeBasis(r,i,o)),p=u-g,c=l-d;let m=[];return s.forEach(function(e){let t=e.clone().sub(h);m.push(new n.Vector3(t.dot(r),t.dot(i),0))}),m}(t.points,t.projectionPlaneVectors)),l?a.includes("lineStyle")&&(l.color=t.graphicProperties.lineStyle.color,l.setOpacity(t.graphicProperties.lineStyle.opacity),l.setLineWidth((t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),l.setDashPatternType(i.getDashType(t.graphicProperties.lineStyle.pattern))):(r=!0,l=i.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:t.graphicProperties.lineStyle.opacity,lineWidth:(t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})),r&&d&&d.length>1){y.removeChildren();let e=o.createLineNode({points:d,material:l});e.setShadow(!1),e.setPickParent(!0),y.addChild(e)}(r||a.includes("rotationAngle"))&&y.setMatrix((new n.Matrix4).makeRotationZ(t.rotationAngle)),h&&g.setMatrix((new n.Matrix4).setPosition(h)),e&&e.activate(),g._updateVisibility()}};let D=function(){g&&g._updateVisibility(),u=null};this.onViewerEventCB=function(e){g&&t&&(u||!t.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(u=setTimeout(D)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DPolylineNode3D",["require","exports","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s){"use strict";return class extends s{constructor(e){super(e);let t,s,l,d=this,p=d.getViewer(),c=1,h=new r;this.addChild(h),h.setPickParent(!0);let u,g=new r;h.addChild(g),g.setPickParent(!0),this.linkManipulatorToNode(g),this.getRepNode=function(){return h},this.updateRepresentation=function(e,i){if(!t)return;g.removeChildren();let r=n.createLineNode({points:e,material:s});r.setShadow(!1),r.setPickParent(!0),g.addChild(r),s&&s.setOpacity((t.graphicProperties.lineStyle.opacity||0)*(i?.6:1))},this.getPointsPosition=function(){return l||[]};let P=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){P(),u&&clearTimeout(u),u=null,s&&s.dispose(),h=g=t=s=l=null},this._updateVisibility=function(e){if(!t)return;void 0!==e&&(c=e);let i=a.is3DMarkerDisplayed(p,t.pointedReferences);d.setVisibility(c>0&&t.isVisible&&i),p.render()},this.update=function(e){if(!d)return;t||(t={graphicProperties:{lineStyle:{}}});let r=!1,p=[],c={paramA:t,paramB:e,merge:!0,mergedKeys:p},h=this.getRepManipulator();if(h&&h.deactivate(),!a.compareAndMergeParams(c)){if(d.setName(t.name),s?p.includes("lineStyle")&&(s.color=t.graphicProperties.lineStyle.color,s.setOpacity(t.graphicProperties.lineStyle.opacity),s.setLineWidth((t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),s.setDashPatternType(o.getDashType(t.graphicProperties.lineStyle.pattern))):(r=!0,s=o.createLineMaterial({color:t.graphicProperties.lineStyle.color,opacity:t.graphicProperties.lineStyle.opacity,lineWidth:(t.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:t.graphicProperties.lineStyle.pattern})),!t.points||l&&!p.includes("points")||(r=!0,l=[],t.points.forEach(function(e){l&&l.push(new i.Vector3(e[0],e[1],e[2]))})),r&&l&&l.length>1){g.removeChildren();let e=n.createLineNode({points:l,material:s});e.setShadow(!1),e.setPickParent(!0),g.addChild(e)}d._updateVisibility()}h&&h.activate()};let f=function(){d&&d._updateVisibility(),u=null};this.onViewerEventCB=function(e){d&&t&&(u||!t.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(u=setTimeout(f)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DPicture",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarker3DPictureNode3D","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n){"use strict";var o=[{name:"bShortDisplay",type:"bool",JSONname:"Properties3DPicture.Shortdisplay",defaultValue:!1},{name:"fCreationDate",type:"float",JSONname:"Properties3DPicture.CreationDate",defaultValue:null},{name:"sRelatedObjectId",type:"string",JSONname:"Properties3DPicture.PointedObjectId",defaultValue:null}];return e.extend({init:function(e,a){this._parent(e,a,{type:"Marker3DPicture",ctxBar:"DS/DMUMarker/DMUMarkerPictureContextualBar",nodeClass:i}),this.addParameters(o);var s=this,l={},d=this.updateModel;this.updateModel=function(e){d(e);var i=s.getAttribute("bZoomMode");s.setAttributes([{name:"fImageWidth",value:t.convertPixelToModel({sizeInPixels:e.imgWidth,coords:i?e.position:null,viewer:s.getViewer()})},{name:"fImageHeight",value:t.convertPixelToModel({sizeInPixels:e.imgHeight,coords:i?e.position:null,viewer:s.getViewer()})}])},this.setRelatedObjectData=function(e){e&&(l.image=e.image&&e.image.src?e.image.src:"",l.label=e.label,l.icon=e.icon,l.draggableContent=e.draggableContent)},this.getPictureLabel=function(){if(s.getAttribute("bShortDisplay"))return[];var e=(s.getAttribute("sRelatedObjectId")?[l.label]:s.getAttribute("sTextContents")[0])||"";return s.getAttribute("fCreationDate")&&(e+=" | "+r.formatDate(s.getAttribute("fCreationDate"))),[e]};let p=this.getImageToDisplay;this.getImageToDisplay=function(){return s.getAttribute("sRelatedObjectId")?l.image:p()};var c=this.refreshNode;this.refreshNode=function(){s.getNode()&&!a.isImporting()&&s.getImageToDisplay()&&(s.getNode().update({name:s.getAttribute("sName"),pointedReferences:s.getAttribute("lPointedReferences"),content:s.getAttribute("bShortDisplay")||s.getAttribute("sRelatedObjectId")?[]:s.getAttribute("sTextContents"),isVisible:s.getAttribute("bVisible"),hasALeader:s.getAttribute("bHasALeader"),inEdition:s.isInEdition(),leaderEndType:s.getAttribute("sLeaderEndType"),position:n.getAbsolutePosition(s,s.getAttribute("vRelativePosition"),s.getAttribute("vLeaderBreakPoint3D"),s.getAttribute("sPositionalReference")),pointingPoints:s.getPointingPoints(),isFilled:s.getAttribute("bIsFilled"),hasBorder:s.getAttribute("bHasBorder"),imageWidth:s.getAttribute("fImageWidth"),imageHeight:s.getAttribute("fImageHeight"),imageInvertH:s.getAttribute("bInvertH"),imageInvertV:s.getAttribute("bInvertV"),markerImage:s.getImageToDisplay(),shortDisplay:s.getAttribute("bShortDisplay")||!s.getPictureLabel()[0],windowAnchor:s.getAttribute("sWindowAnchor"),anchorMode:s.getAttribute("sAnchorMode"),zoomMode:s.getAttribute("bZoomMode"),leaderAttachWidthRatio:s.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:s.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:s.getAttribute("fBoxRotationAngle"),pointedObjectId:s.getAttribute("sRelatedObjectId"),elementIconType:s.getAttribute("sRelatedObjectId")?l.icon:null,creationDate:s.getAttribute("fCreationDate"),draggableContent:l.draggableContent,graphicProperties:{borderRadius:s.getAttribute("fBorderRadius"),fontStyle:{pxheight:s.getAttribute("iFontSize")*(4/3),fontSize:s.getAttribute("fFontSize"),familyName:s.getAttribute("sFontName"),familyStyle:s.getAttribute("sFontStyle"),color:s.getAttribute("cFontColor")},fillStyle:{color:s.getAttribute("cFillStyleColor"),opacity:s.getAttribute("fOpacity"),gradient:s.getAttribute("oGradient")},lineStyle:{thickness:n.getLineThickness(s.getAttribute("fLineStyleThicknessIndex"))||s.getAttribute("fLineStyleThickness"),pattern:s.getAttribute("sLineStylePattern"),color:s.getAttribute("cLineStyleColor")},leaderStyle:{thickness:n.getLineThickness(s.getAttribute("fLeaderStyleThicknessIndex"))||s.getAttribute("fLeaderStyleThickness"),pattern:s.getAttribute("sLeaderStylePattern"),color:s.getAttribute("cLeaderStyleColor")}}}),c())}},setAttribute:function(e,t){this.getParent().isImporting()||"fTextBoxWidth"!==e?this.getParent().isImporting()||"fTextBoxLength"!==e?this._parent(e,t):(this._parent("fTextBoxLength",null),this._parent("fImageHeight",t)):(this._parent("fTextBoxWidth",null),this._parent("fImageWidth",t))},getAttribute:function(e){var i;return"fImageWidth"===e?null==(i=this._parent("fImageWidth"))&&(i=t.convertPixelToModel({sizeInPixels:this._parent("fTextBoxWidth"),viewer:this._viewer})):"fImageHeight"===e?null==(i=this._parent("fImageHeight"))&&(i=t.convertPixelToModel({sizeInPixels:this._parent("fTextBoxLength"),viewer:this._viewer})):i=this._parent(e),i}})}),define("DS/DMUPlayMarker/DMUMarker3DSpline",["require","exports","DS/DMUBaseExperience/EXPImportServices","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DSplineNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a,s){"use strict";let l=[{name:"oPoints",type:"listObjects",JSONname:"PropertiesMultiPoint.Points"}];return class extends n{constructor(e,t){super(e,t),this.addParameters(l),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker3DSpline");let n,d,p=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerLineContextualBar"),this._pointsImporter=new i,this.getPoints=function(){return p.getAttribute("oPoints")},this.getManipulationData=function(){return p.getNode().getBoundingBoxDimensions()},this.updateProjectionPlaneDefinition=function({up:e,right:t}){if(!n||n.equals(e)||d.equals(t))n=e.clone(),d=t.clone();else{let i=p.getNode().getBoundingBoxDimensions(),o=s.getRelativePosition(p,i.position),l=n.clone(),c=d.clone(),h=(new r.Vector3).crossVectors(c,l),u=(new r.Matrix4).makeBasis(c,l,h).setPosition(o),g=(new r.Matrix4).getInverse(u);n=e.clone(),d=t.clone();let P=(new r.Vector3).crossVectors(d,n),f=(new r.Matrix4).makeBasis(d,n,P).setPosition(o).clone().multiply(g);(p.getPoints()||[]).forEach(function(e){if(e instanceof a){let t=e.getAttribute("vPosition");t.applyMatrix4(f),e.setAttribute("vPosition",t)}})}p.refreshNode()},this.updateModel=function(e){let t=(new r.Vector3).crossVectors(d,n),i=p.getNode().getBoundingBoxDimensions(),o=(new r.Matrix4).makeRotationZ(s.getRelativeRotation(p,0)),l=new r.Vector3((Math.cos(s.getRelativeRotation(p,0))+Math.sin(s.getRelativeRotation(p,0)))*Math.abs(e.width/i.width),(Math.cos(s.getRelativeRotation(p,0))-Math.sin(s.getRelativeRotation(p,0)))*Math.abs(e.height/i.height),1).applyMatrix4(o),c=(new r.Matrix4).makeScale(l.x,l.y,l.z),h=(new r.Matrix4).makeBasis(d,n,t),u=(new r.Matrix4).multiplyMatrices(h,c),g=(new r.Matrix4).getInverse(h,!0);u.multiply(g);let P=p.getPoints()||[],f=s.getRelativePosition(p,i.position);p.updatePointedElement(e.position),p.updatePointedPosition(s.getRelativePosition(p,e.position));let S=(new r.Matrix4).getInverse(o);P.forEach(function(t){if(t instanceof a){let i=t.getAttribute("vPosition");i.sub(f),i.applyMatrix4(u),i.applyMatrix4(S),i.add(e.position),t.setAttribute("vPosition",s.getRelativePosition(p,i))}}),p.setAttribute("fRotationAngle",e.rotation)};let c=this.refreshNode;this.refreshNode=function(){p.getNode()&&!t.isImporting()&&n&&d&&(p.getNode().update({name:p.getAttribute("sName"),pointedReferences:p.getAttribute("lPointedReferences"),inEdition:p.isInEdition(),points:function(){let e=p.getPoints()||[],t=[];return e.forEach(function(e){e instanceof a&&t.push(s.getAbsolutePosition(p,null,e.getAttribute("vPosition")).toArray())}),t}(),projectionPlaneVectors:{up:n,right:d},rotationAngle:p.getAttribute("fRotationAngle")||0,pointedPage:p.getAttribute("fPointedPageNumber"),isVisible:p.getAttribute("bVisible")&&!p.hasAlertFlag(),graphicProperties:{lineStyle:{thickness:s.getLineThickness(p.getAttribute("fLineStyleThicknessIndex"))||p.getAttribute("fLineStyleThickness"),pattern:p.getAttribute("sLineStylePattern"),color:p.getAttribute("cLineStyleColor"),opacity:void 0===p.getAttribute("fLineStyleOpacity")?1:p.getAttribute("fLineStyleOpacity")}}}),c())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){if("oPoints"===e&&Array.isArray(t)&&t.length){let i=p.getPoints();i||(i=[]);let r=[];for(let e=0;e<t.length;e++)t[e]&&t[e].getType&&"DMUMarker3DPoint"===t[e].getType()?r.push({Point3D:t[e].getAttribute("vPosition").toArray()}):r.push(t[e]);for(let e=0;e<r.length;e++){if(i[e]&&i[e]instanceof a)p._pointsImporter.fillObjectAttributes(i[e],r[e]);else{let t=new a(p._viewer,p);p._pointsImporter.fillObjectAttributes(t,r[e]),i[e]=t}0===e&&p.updatePointedPosition(i[e].getAttribute("vPosition"))}p._parentSetAttribute(e,i)}else p._parentSetAttribute(e,t)}}}}),define("DS/DMUPlayMarker/DMUMarker3DEllipseNode3D",["require","exports","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l,d){"use strict";return class extends d{constructor(e){super(e);let t,d,p,c,h=this,u=h.getViewer(),g=1,P=new i({type:"Spherical"});this.addChild(P),P.setPickParent(!0);let f,S=new n;P.addChild(S),S.setPickParent(!0),this.linkManipulatorToNode(S),this.getRepNode=function(){return P},this.updateRepresentation=function(e,i){if(!c)return;let n=new r.Vector3(c.xAxisLength?Math.abs(e.width)/c.xAxisLength:1,c.yAxisLength?Math.abs(e.height)/c.yAxisLength:1,1),o=(new r.Matrix4).makeRotationZ(e.rotation).scale(n);S.setMatrix((new r.Matrix4).multiply(o)),h.setMatrix((new r.Matrix4).setPosition(e.position)),t&&d&&(t.setOpacity((c.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),d.setOpacity((c.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))},this.getBoundingBoxDimensions=function(){return c?{position:c.center,height:c.yAxisLength,width:c.xAxisLength,rotation:c.rotationAngle,lineWidth:c.hasBorder?c.graphicProperties.lineStyle.thickness:0,pointedPage:c.pointedPage}:{}};let y=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){y(),f&&clearTimeout(f),f=null,d&&d.dispose(),t&&t.dispose(),t=d=P=S=null},this._updateVisibility=function(e){if(!c)return;void 0!==e&&(g=e);let t=s.is3DMarkerDisplayed(u,c.pointedReferences);h.setVisibility(g>0&&c.isVisible&&t),u.render()},this.update=function(e){if(!h)return;c||(c={graphicProperties:{fillStyle:{},lineStyle:{}}});let i=!1,n=[],u={paramA:c,paramB:e,merge:!0,mergedKeys:n};if(!s.compareAndMergeParams(u)){let e=this.getRepManipulator();if(e&&e.deactivate(),h.setName(c.name),(!p||n.includes("center")||n.includes("xAxisLength")||n.includes("yAxisLength"))&&(i=!0,p=s.getEllipseSpecs((c.xAxisLength||0)/2,(c.yAxisLength||0)/2,l.getMMPerPixelRatio(h.getViewer(),c.center))),t?n.includes("fillStyle")&&(t.color=c.graphicProperties.fillStyle.color,t.setOpacity(c.graphicProperties.fillStyle.opacity)):(i=!0,t=a.createBasicMaterial({color:c.graphicProperties.fillStyle.color,opacity:c.graphicProperties.fillStyle.opacity})),d?n.includes("lineStyle")&&(d.color=c.graphicProperties.lineStyle.color,d.setOpacity(c.graphicProperties.lineStyle.opacity),d.setLineWidth((c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),d.setDashPatternType(a.getDashType(c.graphicProperties.lineStyle.pattern))):(i=!0,d=a.createLineMaterial({color:c.graphicProperties.lineStyle.color,opacity:c.graphicProperties.lineStyle.opacity,lineWidth:(c.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:c.graphicProperties.lineStyle.pattern})),(n.includes("isFilled")||n.includes("hasBorder"))&&(i=!0),i){if(S.removeChildren(),c.isFilled){p.material=t;let e=o.createSimpleMeshNode(p);e.setShadow(!1),e.setPickParent(!0),S.addChild(e)}if(c.hasBorder){let e=o.createLineNode({points:p.coordinates,material:d});e.setShadow(!1),e.setPickParent(!0),S.addChild(e)}}S.setMatrix((new r.Matrix4).makeRotationZ(c.rotationAngle)),h.setMatrix((new r.Matrix4).setPosition(c.center)),e&&e.activate(),h._updateVisibility()}};let m=function(){h&&h._updateVisibility(),f=null};this.onViewerEventCB=function(e){h&&c&&(f||!c.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(f=setTimeout(m)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DPolyline",["require","exports","DS/DMUBaseExperience/EXPImportServices","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DPolylineNode3D","DS/DMUPlayMarker/DMUMarker3DPoint","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o,a){"use strict";let s=[{name:"oPoints",type:"listObjects",JSONname:"PropertiesMultiPoint.Points"}];return class extends r{constructor(e,t){super(e,t),this.addParameters(s),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker3DPolyline");let r=this;this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerLineContextualBar"),this.getManipulationData=function(){return this.getNode().getPointsPosition()},this.updateModel=function(e){let t=[];for(let i=0;i<e.length;i++)0===i&&r.updatePointedElement(e[i]),t.push({Point3D:a.getRelativePosition(r,e[i]).toArray()});r.setAttribute("oPoints",t)},this._pointsImporter=new i,this.getPoints=function(){let e=r.getAttribute("oPoints")||[];return e&&e.length&&e[0]instanceof o?e:(r.setAttribute("oPoints",e),e)};let l=this.refreshNode;this.refreshNode=function(){this.getPoints().forEach(function(e){e.refreshNode()}),r.getNode()&&!t.isImporting()&&(r.getNode().update({name:r.getAttribute("sName"),pointedReferences:r.getAttribute("lPointedReferences"),inEdition:r.isInEdition(),points:function(){let e=r.getAttribute("oPoints")||[],t=[];return e.forEach(function(e,i){e instanceof o&&t.push(a.getAbsolutePosition(r,e.getAttribute("vRelativePosition"),e.getAttribute("vPosition"),r.getPointedReference(i)).toArray())}),t}(),pointedPage:r.getAttribute("fPointedPageNumber"),isVisible:r.getAttribute("bVisible")&&!r.hasAlertFlag(),graphicProperties:{lineStyle:{thickness:a.getLineThickness(r.getAttribute("fLineStyleThicknessIndex"))||r.getAttribute("fLineStyleThickness"),pattern:r.getAttribute("sLineStylePattern"),color:r.getAttribute("cLineStyleColor"),opacity:r.getAttribute("fLineStyleOpacity")}}}),l())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){if("oPoints"===e&&Array.isArray(t)&&t.length){let i=r.getAttribute("oPoints");i||(i=[]);let n=[];for(let e=0;e<t.length;e++){let i;i=0===e?"Begin":e===t.length-1?"End":void 0,t[e]&&t[e].getType&&"DMUMarker3DPoint"===t[e].getType()?n.push({Name:void 0===t[e].getAttribute("sName")?i:t[e].getAttribute("sName"),Point3D:t[e].getAttribute("vPosition").toArray()}):(n.push(t[e]),n[e].Name||(n[e].Name=i))}for(let e=0;e<n.length;e++){if(i[e]&&i[e]instanceof o)r._pointsImporter.fillObjectAttributes(i[e],n[e]);else{let t=new o(r._viewer,r);r._pointsImporter.fillObjectAttributes(t,n[e]),i[e]=t}0===e&&this.updatePointedPosition(i[e].getAttribute("vPosition"))}this._parentSetAttribute(e,i)}else this._parentSetAttribute(e,t)}}}}),define("DS/DMUPlayMarker/DMUCommentHighlightNode",["require","exports","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s){"use strict";return class extends s{constructor(e){super(e);let t,s,l=this,d=l.getViewer(),p=new i;p.setPickParent(!0),this.addChild(p),this.update=function(e){if(!l)return;t||(t={});let i={paramA:t,paramB:e,merge:!0,mergedKeys:[]};if(!o.compareAndMergeParams(i)){let e;if(l.setName(t.name),t.selection)if(s){let i=p.getChildren();for(let n=0;n<t.selection.length;n++)e=(new r.Matrix4).makeRotationZ(t.selection[n].rotationAngle),i[n].setMatrix((new r.Matrix4).setPosition(t.selection[n].position).multiply(e))}else{s=new r.MeshBasicMaterial({force:!0,side:r.FrontSide,transparent:!0,color:a.getUserColor(t.owner),opacity:t.isExternal?0:.3});for(let i=0;i<t.selection.length;i++){let o=n.createRectangleNode({width:t.selection[i].width,height:-t.selection[i].height,fill:!0,noEdge:!0,material:s});e=(new r.Matrix4).makeRotationZ(t.selection[i].rotationAngle),o.setShadow(!1),o.setPickParent(!0),o.setMatrix((new r.Matrix4).setPosition(t.selection[i].position).multiply(e)),p.addChild(o)}}!function(){if(!t)return;let e=o.is3DMarkerDisplayed(d);l.setVisibility(t.isVisible&&e),d.render()}()}};let c=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){s&&s.dispose(),l.removeChildren(),s=t=null,c()}}}}),define("DS/DMUPlayMarker/DMUCommentHighlight",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUCommentAnnotationBase","DS/DMUPlayMarker/DMUCommentHighlightNode","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";let a=[{name:"oSelection",type:"objectDefinition",JSONname:"PropertiesCommentHighlight.Selection"}];return class extends r{constructor(e,t,r){super(e,t),this.addParameters(a);let s=this,l=r;this.setAttribute("sType","CommentHighlight"),this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.isExternal=function(){return Boolean(l)},this.getSelection=function(){let e=s.getAttribute("oSelection"),t=[];if(e){let r=o.getAbsoluteRotation(s,0);e.forEach(function(e){e.rects.forEach(function(n){t.push({position:o.getAbsolutePosition(s,null,new i.Vector3(n.position.x,n.position.y,0),void 0,e.page||e.element),width:n.width,height:n.height,rotationAngle:r})})})}return t};let d=this.refreshNode;this.refreshNode=function(){if(s.getNode()&&(!t||!t.isImporting())){let e=s.getAttribute("vPosition");s.getNode().update({name:s.getAttribute("sName"),owner:s.getOwner(),pointedPage:s.getAttribute("fPointedPageNumber"),position:o.getAbsolutePosition(s,null,new i.Vector3(e.x,e.y,0)),selection:s.getSelection(),inEdition:s.isInEdition(),isVisible:!s.hasAlertFlag(),isExternal:s.isExternal()}),d()}}}}}),define("DS/DMUPlayMarker/DMUMarker3DEllipse",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUPlayMarker/DMUMarker3DEllipseNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";let a=[{name:"vCenter",type:"Vector3",JSONname:"Properties3DEllipse.Center",defaultValue:new i.Vector3},{name:"fxAxisLength",type:"float",JSONname:"Properties3DEllipse.xAxisLength",defaultValue:100},{name:"fyAxisLength",type:"float",JSONname:"Properties3DEllipse.yAxisLength",defaultValue:100}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DEllipse");let i=this;this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getBoundingBoxDimensions()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttributes([{name:"fxAxisLength",value:e.width},{name:"fyAxisLength",value:e.height},{name:"vCenter",value:o.getRelativePosition(i,e.position)},{name:"fRotationAngle",value:o.getRelativeRotation(i,e.rotation)}])};let r=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),xAxisLength:i.getAttribute("fxAxisLength"),yAxisLength:i.getAttribute("fyAxisLength"),rotationAngle:o.getAbsoluteRotation(i,i.getAttribute("fRotationAngle")||0),center:o.getAbsolutePosition(i,null,i.getAttribute("vCenter")),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:i.getAttribute("bHasBorder"),pointedPage:i.getAttribute("fPointedPageNumber"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:o.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"),color:i.getAttribute("cLineStyleColor"),opacity:i.getAttribute("fLineStyleOpacity")}}}),r())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"fxAxisLength"===e||"fyAxisLength"===e?t=Math.abs(t):"vCenter"===e&&i.updatePointedPosition(t):i.setAttribute("bHasBorder",!0):i.setAttribute("bIsFilled",!0),i._parentSetAttribute(e,t)},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vCenter"===e?i._parentGetAttribute("vCenter").clone():i._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker3DLine",["require","exports","DS/DMUPlayMarker/DMUMarker3DPolyline"],function(e,t,i){"use strict";return class extends i{constructor(e,t){super(e,t),this.setAttribute("sType","Marker3DLine")}}}),define("DS/DMUPlayMarker/DMUMarker2DArrowNode3D",["DS/Visualization/ThreeJS_DS","DS/SceneGraphNodes/BillBoardNode3D","DS/SceneGraphNodes/FixedSizeNode3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUBaseUI/DMUNode2D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a){"use strict";return o.extend({init:function(o){this._parent(o);var s,l,d=this,p={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}},c=new t({type:"Spherical"});this.addChild(c),c.setPickParent(!0);var h,u=new i({ratio:1});c.addChild(u),u.setPickParent(!0),this.removeDMUNode3DOverload=function(){d=s=c=u=null},this.updateScreenPosition=function(){p&&h&&d.setMatrix((new e.Matrix4).setPosition(d.get3DPositionFromScreenCoordinates({coords:h,width:p.fullWidthPx,anchor:"center",windowAnchor:p.windowAnchor,proportionalPosition:p.isPositionProportional})))},this.update=function(t){if(d){if(JSON.stringify(t)!==JSON.stringify(p)||p.isPositionProportional&&(p.screenWidth!==d.getViewer().SCREEN_WIDTH||p.screenHeight!==d.getViewer().SCREEN_HEIGHT)){var i=p.graphicProperties&&p.graphicProperties.fillStyle?JSON.stringify(p.graphicProperties.fillStyle):"",o=p.graphicProperties&&p.graphicProperties.lineStyle?JSON.stringify(p.graphicProperties.lineStyle):"";p=d.mergeParams(p,t),d.setName(p.name),p.screenWidth=d.getViewer().SCREEN_WIDTH,p.screenHeight=d.getViewer().SCREEN_HEIGHT,h=(new e.Vector2).copy(p.firstPoint).add(p.secondPoint).multiplyScalar(.5);var c=(new e.Vector2).copy(p.firstPoint),g=(new e.Vector2).copy(p.secondPoint),P=p.bentPoint?(new e.Vector2).copy(p.bentPoint):null;p.isPositionProportional?(p.firstPointPx=d.convertCoordsInPixels({coords:c,windowAnchor:p.windowAnchor,fitOnX:!0}),p.secondPointPx=d.convertCoordsInPixels({coords:g,windowAnchor:p.windowAnchor,fitOnX:!0}),p.widthPx=d.convertProportionalCoordInPixels(p.width,!0),P&&(p.bentPointPx=d.convertCoordsInPixels({coords:P,windowAnchor:p.windowAnchor,fitOnX:!0})),p.endwidth&&(p.endwidthPx=d.convertProportionalCoordInPixels(p.endwidth,!0))):(p.firstPointPx=c.clone(),p.secondPointPx=g.clone(),p.widthPx=p.width,P&&(p.bentPointPx=P.clone()),p.endwidth&&(p.endwidthPx=p.endwidth));var f=Math.max(p.firstPointPx.x,p.secondPointPx.x),S=Math.min(p.firstPointPx.x,p.secondPointPx.x);p.bentPointPx&&(f=Math.max(f,p.bentPointPx.x),S=Math.min(S,p.bentPointPx.x)),p.fullWidthPx=f-S+p.widthPx;var y,m,D,M=p.secondPointPx.clone().sub(p.firstPointPx.clone()),b=(new e.Matrix4).makeTranslation(-M.x/2,M.y/2,0);if(p.bentPointPx){var A=p.bentPointPx.clone().sub(p.firstPointPx.clone()).length()+p.endwidthPx/2,v=p.bentPointPx.clone().sub(p.secondPointPx.clone()).length()+p.widthPx/2;b.multiply((new e.Matrix4).makeTranslation(p.widthPx/2-v/2,-A/2,0)),p.rotationAngle&&b.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),p.rotationAngle)),m=a.getBentArrowSpecs(p.widthPx,p.endwidthPx,A,v,p.shaftRatio,p.headRatio,p.style)}else(y=Math.atan2(M.y,M.x))<0&&(y+=2*Math.PI),y=2*Math.PI-y,b.multiply((new e.Matrix4).makeRotationAxis(new e.Vector3(0,0,1),y)),m=a.getArrowSpecs(p.widthPx,M.length(),p.shaftRatio,p.headRatio,p.style);u.removeChildren(),p.isFilled&&(s&&JSON.stringify(p.graphicProperties.fillStyle)===i||(s=n.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})),m.material=s,(D=r.createSimpleMeshNode(m)).setShadow(!1),D.setPickParent(!0),D.setMatrix(b),u.addChild(D)),p.hasBorder&&(l&&JSON.stringify(p.graphicProperties.lineStyle)===o||(l=n.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:p.graphicProperties.lineStyle.thickness*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),(D=r.createLineNode({points:m.coordinates,material:l})).setShadow(!1),D.setPickParent(!0),D.setMatrix(b),u.addChild(D)),d.setVisibility(p.isVisible)}d.updateScreenPosition()}},this.onViewerEventCB=function(e){d&&"onSwapVisibleSpace"===e.eventType&&p&&d.setVisibility(p.isVisible)}}})}),define("DS/DMUPlayMarker/DMUMarker2DArrow",["DS/DMUPlayMarker/DMUMarker2D","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker2DArrowNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r){"use strict";var n=[{name:"vFirstPoint",type:"Vector2",JSONname:"Properties2DArrow.FirstPoint",defaultValue:new t.Vector2},{name:"vSecondPoint",type:"Vector2",JSONname:"Properties2DArrow.SecondPoint",defaultValue:new t.Vector2(10,0)},{name:"fWidth",type:"float",JSONname:"Properties2DArrow.Width",defaultValue:1},{name:"sStyle",type:"string",JSONname:"Properties2DArrow.Style",defaultValue:"beginSide"},{name:"fShaftRatio",type:"float",JSONname:"Properties2DArrow.ShaftRatio",defaultValue:.8},{name:"fHeadRatio",type:"float",JSONname:"Properties2DArrow.HeadRatio",defaultValue:.5},{name:"vBentPoint",type:"Vector2",JSONname:"Properties2DArrow.BentPoint"},{name:"fEndWidth",type:"float",JSONname:"Properties2DArrow.EndWidth"}];return e.extend({init:function(e,t){this._parent(e,t),this.addParameters(n),this.setAttribute("sType","Marker2DArrow");var o=this;this.setNode(new i({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var a=this.refreshNode;this.refreshNode=function(){o.getNode()&&!t.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),firstPoint:o.getAttribute("vFirstPoint"),secondPoint:o.getAttribute("vSecondPoint"),bentPoint:o.getAttribute("vBentPoint"),windowAnchor:o.getAttribute("sWindowAnchor"),width:o.getAttribute("fWidth"),endwidth:o.getAttribute("fEndWidth"),style:o.getAttribute("sStyle"),shaftRatio:o.getAttribute("fShaftRatio"),headRatio:o.getAttribute("fHeadRatio"),inEdition:o.isInEdition(),isVisible:o.getAttribute("bVisible"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),isPositionProportional:o.getAttribute("bProportionalPosition"),rotationAngle:"number"==typeof o.getAttribute("fScreenRotationAngle")?o.getAttribute("fScreenRotationAngle"):o.getAttribute("fRotationAngle"),graphicProperties:{fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity")},lineStyle:{pattern:o.getAttribute("sLineStylePattern"),thickness:r.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),color:o.getAttribute("cLineStyleColor"),opacity:o.getAttribute("fLineStyleOpacity")}}}),a())},this.getMaximumProportionalWidth=function(){var e=0;if(o.getAttribute("bProportionalPosition")){var t=o.getAttribute("vFirstPoint");t&&Math.abs(t.x)>e&&(e=Math.abs(t.x)),(t=o.getAttribute("vSecondPoint"))&&Math.abs(t.x)>e&&(e=Math.abs(t.x)),(t=o.getAttribute("vBentPoint"))&&Math.abs(t.x)>e&&(e=Math.abs(t.x))}return e}},setAttribute:function(e,t){!1!==t||"bHasBorder"!==e||this.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||this.getAttribute("bHasBorder")?this._parent(e,t):(this.setAttribute("bHasBorder",!0),this._parent(e,t)):(this.setAttribute("bIsFilled",!0),this._parent(e,t))},getAttribute:function(e){return"vFirstPoint"===e||"vSecondPoint"===e?this._parent(e).clone():this._parent(e)}})}),define("DS/DMUPlayMarker/DMUMarker3DRectangleNode3D",["require","exports","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/SceneGraphNodes/BillBoardNode3D","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l){"use strict";return class extends l{constructor(e){super(e);let t=this,l=1,d=new a({position:new n.Vector3,type:"Spherical"});d.setPickParent(!0),this.addChild(d);let p,c,h,u=t.getViewer(),g=new r;d.addChild(g),g.setPickParent(!0),this.linkManipulatorToNode(g),this.getRepNode=function(){return d},this.updateRepresentation=function(e,i){if(!p)return;let r=new n.Vector3(p.width?Math.abs(e.width)/p.width:1,p.height?Math.abs(e.height)/p.height:1,1),o=(new n.Matrix4).makeRotationZ(e.rotation).scale(r),a=new n.Vector3(-(p.width||0)/2,-(p.height||0)/2,0).applyMatrix4(o);g.setMatrix((new n.Matrix4).setPosition(a).multiply(o)),t.setMatrix((new n.Matrix4).setPosition(e.position)),c&&c.line&&(c.setOpacity((p.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),c.line.setOpacity((p.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))},this.getBoundingBoxDimensions=function(){return p?{position:p.position,height:p.height,width:p.width,rotation:p.rotationAngle,pointedPage:p.pointedPage}:{}};let P=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){P(),h&&clearTimeout(h),h=null,c&&c.dispose(),d=g=c=p=null},this._updateVisibility=function(e){if(!p)return;void 0!==e&&(l=e);let i=s.is3DMarkerDisplayed(u,p.pointedReferences);t.setVisibility(l>0&&p.isVisible&&i),u.render()},this.update=function(e){if(!t)return;p||(p={graphicProperties:{fillStyle:{},lineStyle:{}}});let r=!1,a=[],l={paramA:p,paramB:e,merge:!0,mergedKeys:a};if(!s.compareAndMergeParams(l)){let e=this.getRepManipulator();if(e&&e.deactivate(),t.setName(p.name),c?(a.includes("fillStyle")&&(c.color=p.graphicProperties.fillStyle.color,c.setOpacity(p.graphicProperties.fillStyle.opacity)),a.includes("lineStyle")&&(c.line.color=p.graphicProperties.lineStyle.color,c.line.setOpacity(p.graphicProperties.lineStyle.opacity),c.line.setLineWidth((p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),c.line.setDashPatternType(i.getDashType(p.graphicProperties.lineStyle.pattern)))):(r=!0,(c=i.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})).line=i.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:(p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),(a.includes("width")||a.includes("height")||a.includes("isFilled")||a.includes("hasBorder"))&&(r=!0),r){g.removeChildren();let e=o.createRectangleNode({width:p.width,height:p.height,fill:p.isFilled,noEdge:!p.hasBorder,material:c});e.setShadow(!1),e.setPickParent(!0),g.addChild(e)}if(a.includes("width")||a.includes("height")||a.includes("rotationAngle")){let e,t=(new n.Matrix4).makeRotationZ(p.rotationAngle);"center"===p.anchor?e=new n.Vector3(-(p.width||0)/2,-(p.height||0)/2,0).applyMatrix4(t):"topleft"===p.anchor&&(e=new n.Vector3(0,-(p.height||0),0).applyMatrix4(t)),g.setMatrix((new n.Matrix4).setPosition(e).multiply(t))}t.setMatrix((new n.Matrix4).setPosition(p.position)),e&&e.activate()}t._updateVisibility()};let f=function(){t._updateVisibility(),h=null};this.onViewerEventCB=function(e){t&&p&&(h||!p.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(h=setTimeout(f)))}}}}),define("DS/DMUPlayMarker/DMUMarker3DStampNode3D",["DS/Visualization/Node3D","DS/DMUBaseUI/DMUManipulableNode3D","DS/Visualization/ThreeJS_DS","DS/DMUBaseUI/DMUToolsLeader","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUMeasurable/DMUMathsInfiniteGeometry","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUMarkerVisu/DMUMarkerVisuStampShapeNode","DS/DMUBaseUI/DMUToolsUsers"],function(e,t,i,r,n,o,a,s,l){"use strict";return t.extend({init:function(t){var d=t||{};let p;this._parent(d),this._getExcludeFromCSO=function(){return!0};var c,h=this,u=h.getViewer(),g=1;let P=!1,f=!1;var S={horizontalAlignement:"topLeft"};if(d.defaultGraphicProps)for(var y=Object.keys(d.defaultGraphicProps),m=0;m<y.length;m++)S[y[m]]=d.defaultGraphicProps[y[m]];var D=new s({window:d.frmWindow,data:{mkvShape:d.mkvShape,graphicProperties:S},onStartContentEditionCB:d.onStartContentEditionCB,onEndContentEditionCB:d.onEndContentEditionCB,onContentModifiedCB:d.onContentModifiedCB});this.addChild(D),D.setPickParent(!0);var M=new e;function b(){if(M&&c){let e=!P&&!f&&c.hasALeader;M.setVisibility(e),M.setVisibilityFree(!e)}}function A(t,s,l){if(b(),c.hasALeader){var p=0;switch(c.leaderEndType){case"Arrow":p=1;break;case"Bubble":p=2;break;case"Cross":p=4;break;case"Square":p=3}var h=D.getDimensions();if(h.offsetWidth>0&&h.offsetHeight>0){var g,P,f=t.clone(),S={offsetWidth:n.convertModelToPixels({sizeInMM:h.offsetWidth,viewer:u,coords:c.zoomMode?f:null}),offsetHeight:n.convertModelToPixels({sizeInMM:h.offsetHeight,viewer:u,coords:c.zoomMode?f:null}),rotationAngle:l};if(S.offsetWidth/=window.devicePixelRatio,S.offsetHeight/=window.devicePixelRatio,"topleft"===c.anchorMode)if(c.zoomMode){var y=u.currentViewpoint.getUpDirection().clone(),m=(new i.Vector3).crossVectors(u.currentViewpoint.getSightDirection(),y).setLength(h.offsetWidth/2);y.setLength(-h.offsetHeight/2),f.add(y),f.add(m)}else{var A=n.getViewerPositionFromPoint(u,f);if(A&&!isNaN(A.left)&&!isNaN(A.top)&&A.right-A.left!=0){var v=new i.Vector2(A.left+S.offsetWidth/2,A.top+S.offsetHeight/2),x=n.getLineFromWindowPosition(u,v.x,v.y),w=n.getViewpointInfo(u.currentViewpoint),k=o.computeLinePlaneDistance(x.position.toArray(),x.direction.toArray(),t.toArray(),w.sight.toArray());f=new i.Vector3(k.aPosition[0],k.aPosition[1],k.aPosition[2])}}if(s&&s.length){var N=[];if(1===u.getVisibleSpace()&&c.pointedReferences&&c.pointedReferences.length){var U=a.getPointedReferencesVisibilityStates(u,c.pointedReferences);for(P=U.length-1;P>=0;P--)U[P]&&N.push(s[P])}else N=s.slice();var C=M.getChildren();for(P=0;P<N.length;P++){(g=C[P])||((g=new e("DMUMarkerLeaderNode")).setPickParent(!0),M.addChild(g));var T={width:c.leaderAttachWidthRatio,height:c.leaderAttachLengthRatio};r.modifyLeaderNode(u,g,!0,f,N[P],T,c.graphicProperties.leaderStyle.thickness*window.devicePixelRatio,c.graphicProperties.leaderStyle.color,c.graphicProperties.leaderStyle.pattern,p,S,d.frmWindow)}if(C=M.getChildren(),N.length<C.length)for(P=C.length-1;P>=N.length;P--)C[P].isManipulator||M.removeChild(C[P])}}}}this.addChild(M),M.setPickParent(!0),this.linkManipulatorToNode(D.getBackNode()),this.getRepNode=function(){return{leader:M,box:D.getLabelNode()}},this.hasTessellatedRepresentation=function(){return!1},this.getLabelDimensions=function(){var e=D.getDimensions();return e.position=c.position,e},this.updateRepresentation=function(e,t){D.setTransformation({rotationAngle:e.rotationAngle}),D.setMatrix((new i.Matrix4).setPosition(e.position)),A(e.position,e.leaderPoints,e.rotationAngle),D.setGhostMode(t)},this.getLabelParams=function(){var e=D.getDimensions(),t={};return t.leaderPoints=c.pointingPoints.slice(),t.position=c.position,t.anchorMode=c.anchorMode,t.rotationAngle=c.boxRotationAngle?c.boxRotationAngle:0,t.width=e.width,t.height=e.height,t};var v=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){v(),p&&clearTimeout(p),p=null,D&&D.remove(),D=M=h=c=null},this.getPixelFontSize=function(e){var t,i=e||c;return i.graphicProperties.fontStyle.pxheight&&(t=n.convertPixelToModel({sizeInPixels:i.graphicProperties.fontStyle.pxheight,viewer:h.getViewer()})),t||(t=i.graphicProperties.fontStyle.fontSize),n.convertModelToPixels({sizeInMM:t,viewer:h.getViewer()})},this.startEdition=function(){D.startEdition(h)},this._updateVisibility=function(e,t){if(c){void 0!==e&&(g=e);var i=c.isVisible&&a.is3DMarkerDisplayed(u,c.pointedReferences)&&g>0;h.setVisibility(i),0!==g&&D.setOpacity(g),(0===u.getVisibleSpace()&&!i||1===u.getVisibleSpace()&&i)&&(t&&g<1?(P=!0,b()):(P=!1,A(c.position,c.pointingPoints,c.boxRotationAngle))),u.render()}},this.update=function(e){if(h){c||(c={graphicProperties:{fontStyle:{},fillStyle:{},lineStyle:{}}}),e.graphicProperties.fontStyle.height=h.getPixelFontSize(e);var t=[],i={paramA:c,paramB:e,merge:!0,mergedKeys:t};if(!a.compareAndMergeParams(i)){var r=h.getRepManipulator();r&&r.deactivate(),h.setName(c.name),l.getUserName(c.owner,function(e){c.userDate=[e||c.owner,l.formatDate(c.creationDate)],D.modify(c)}),t.includes("textComment")||D.stopEdition(),r&&r.activate(),h._updateVisibility()}}};let x=function(){h&&h._updateVisibility(),p=null};this.onViewerEventCB=function(e){h&&e&&("onDMUSlideStartDisplay"!==e.eventType&&"onDMUSlideDisplayed"!==e.eventType||(f="onDMUSlideStartDisplay"===e.eventType,b()),!c||"@onViewpointChange"!==e.eventType&&"onSwapVisibleSpace"!==e.eventType&&"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(D.stopEdition(),("onSwapVisibleSpace"===e.eventType||"@onWindowResized"===e.eventType||c.pointedReferences&&("onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType))&&("@onWindowResized"===e.eventType||"onHideShow"===e.eventType||"onRepresentationLoaded"===e.eventType?p||(p=setTimeout(x)):h._updateVisibility())))}}})}),define("DS/DMUPlayMarker/DMUMarker3DStamp",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUPlayMarker/DMUMarker3DStampNode3D","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i){"use strict";var r=[{name:"sStampType",type:"string",JSONname:"Properties3DStamp.StampType"},{name:"sOwner",type:"string",JSONname:"Properties3DStamp.Owner"},{name:"lTextComment",type:"listStrings",JSONname:"Properties3DStamp.TextComment",defaultValue:[""]},{name:"fCreationDate",type:"float",JSONname:"Properties3DStamp.CreationDate"}];return e.extend({init:function(e,n){var o=this;this._parent(e,n,{type:"Marker3DStamp",nodeClass:t,onContentModifiedCB:function(e){if(e.text!==o.getAttribute("lTextComment")){e.text&&0!==e.text.length||(e.text=[""]);var t,i=e.text,r=!0;for(t=0;t<i.length;t++)if(i[t]){r=!1;break}if(r)for(t=0;t<i.length;t++)i[t]=" ";o.setAttribute("lTextComment",i),o.fireEvent("onDMUObjectVisuRefreshRequired",{dmuObject:o})}}}),this.addParameters(r),this.refreshNode=function(){o.getNode()&&!n.isImporting()&&o.getNode().update({stampType:o.getAttribute("sStampType"),owner:o.getAttribute("sOwner"),textComment:o.getAttribute("lTextComment"),creationDate:o.getAttribute("fCreationDate"),name:o.getAttribute("sName"),pointedReferences:o.getAttribute("lPointedReferences"),isVisible:o.getAttribute("bVisible"),content:o.getAttribute("sTextContents"),tessRep:o.getAttribute("sTextGraphicRepresentation"),position:i.getAbsolutePosition(o,o.getAttribute("vRelativePosition"),o.getAttribute("vLeaderBreakPoint3D"),o.getAttribute("sPositionalReference")),pointingPoints:o.getPointingPoints(),anchorMode:o.getAttribute("sAnchorMode"),hasALeader:o.getAttribute("bHasALeader"),markerImage:o.getImageToDisplay(),imageWidth:o.getAttribute("fImageWidth"),imageHeight:o.getAttribute("fImageHeight"),boxWidth:o.getAttribute("fTextBoxWidth"),boxHeight:o.getAttribute("fTextBoxLength"),leaderEndType:o.getAttribute("sLeaderEndType"),isFilled:o.getAttribute("bIsFilled"),hasBorder:o.getAttribute("bHasBorder"),leaderAttachWidthRatio:o.getAttribute("fLeaderAttachWidthRatio"),leaderAttachLengthRatio:o.getAttribute("fLeaderAttachLengthRatio"),boxRotationAngle:o.getAttribute("fBoxRotationAngle"),inEdition:o.isInEdition(),graphicProperties:{borderRadius:o.getAttribute("fBorderRadius"),fontStyle:{fontSize:o.getAttribute("fFontSize"),familyName:o.getAttribute("sFontName"),familyStyle:o.getAttribute("sFontStyle"),color:o.getAttribute("cFontColor")},fillStyle:{color:o.getAttribute("cFillStyleColor"),opacity:o.getAttribute("fOpacity"),gradient:o.getAttribute("oGradient")},lineStyle:{thickness:i.getLineThickness(o.getAttribute("fLineStyleThicknessIndex"))||o.getAttribute("fLineStyleThickness"),pattern:o.getAttribute("sLineStylePattern"),color:o.getAttribute("cLineStyleColor")},leaderStyle:{thickness:i.getLineThickness(o.getAttribute("fLeaderStyleThicknessIndex"))||o.getAttribute("fLeaderStyleThickness"),pattern:o.getAttribute("sLeaderStylePattern"),color:o.getAttribute("cLeaderStyleColor")}}})},this.setListOfReadOnlyAttributes(["cFillStyleColor","fOpacity","oGradient","fLineStyleThickness","fLineStyleThicknessIndex","fLeaderStyleThickness","fLeaderStyleThicknessIndex","sLeaderStylePattern","sLineStylePattern","cLineStyleColor","cLeaderStyleColor","bIsFilled","bHasBorder"])}})}),define("DS/DMUPlayMarker/DMUCommentPositionedNode",["require","exports","DS/DMUBaseExperience/EXPToolsMaterial","DS/Visualization/Node3D","DS/Visualization/ThreeJS_DS","DS/Visualization/SceneGraphFactory","DS/DMUPlayMarker/DMUMarkerTools","DS/WebappsUtils/WebappsUtils","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l,d){"use strict";return class extends d{constructor(e){super(e);let t,d,p,c,h=this,u=h.getViewer(),g=new r;g.setPickParent(!0),this.addChild(g),this.linkManipulatorToNode(g),this.getCommentParams=function(){return{position:t?t.position:null}},this.updateRepresentation=function(e){h.setMatrix((new n.Matrix4).setPosition(e.position))},this.update=function(e){if(!h)return;t||(t={});let r={paramA:t,paramB:e,merge:!0,mergedKeys:[]};if(!a.compareAndMergeParams(r)){h.setName(t.name);let e=this.getRepManipulator();if(e&&e.deactivate(),!d){let e;(c=n.ImageUtils.loadTexture(s.getWebappsAssetUrl("DMUPlayMarker","icons/32/")+"I_Comment.png")).needsUpdate=!0;let r=l.getUserColor(t.owner);d=i.createBasicMaterial({color:r});let a=6,h=5,u=function(e,t,i){let r=new n.Shape;return r.moveTo(-t/2,-i/2+e),r.lineTo(-t/2,i/2-e),e&&r.absarc(-t/2+e,i/2-e,e,Math.PI,.5*Math.PI,!0),r.lineTo(t/2-e,i/2),e&&r.absarc(t/2-e,i/2-e,e,.5*Math.PI,0,!0),r.lineTo(t/2,-i/2+e),e&&r.absarc(t/2-e,-i/2+e,e,2*Math.PI,1.5*Math.PI,!0),r.lineTo(-t/2+.45*t,-i/2),r.lineTo(-t/2+.1*t,-i/2-.3*i),e&&r.absarc(-t/2+e,-i/2+e,e,1.5*Math.PI,Math.PI,!0),r}(1,a,h);(e=o.createNodeFromTHREEMesh(new n.Mesh(new n.ShapeGeometry(u),d))).setShadow(!1),e.setPickParent(!0),e.setRenderDepth(1),g.addChild(e);let P=r.getHSL();P.s=1,P.l*=.5,p=i.createLineMaterial({color:r.clone().setHSL(P.h,P.s,P.l),lineWidth:2*window.devicePixelRatio,pattern:"1"});let f=u.getPoints(5).map(function(e){return new n.Vector3(e.x,e.y,0)}),S=o.createLineNode({points:f,material:p});S.setShadow(!1),S.setPickParent(!0),g.addChild(S);let y=o.createLineNode({points:[new n.Vector3(-a/2+.2*a,-h/2+.7*h),new n.Vector3(-a/2+.8*a,-h/2+.7*h)],material:p});y.setRenderDepth(0),y.setShadow(!1),y.setPickParent(!0),g.addChild(y);let m=o.createLineNode({points:[new n.Vector3(-a/2+.2*a,-h/2+.4*h),new n.Vector3(-a/2+.65*a,-h/2+.4*h)],material:p});m.setShadow(!1),m.setPickParent(!0),g.addChild(m)}h.setMatrix((new n.Matrix4).setPosition(t.position)),e&&e.activate(),function(){if(!t)return;let e=a.is3DMarkerDisplayed(u);h.setVisibility(t.isVisible&&e),u.render()}()}};let P=this.removeDMUNode3DOverload;this.removeDMUNode3DOverload=function(){c&&c.dispose(),d&&d.dispose(),h.removeChildren(),c=d=t=null,P()}}}}),define("DS/DMUPlayMarker/DMUCommentPositioned",["require","exports","DS/DMUPlayMarker/DMUCommentAnnotationBase","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUCommentPositionedNode"],function(e,t,i,r,n){"use strict";let o=[{name:"bVisible",type:"bool",JSONname:"PropertiesMarkerBase.GraphicProperties.visible",defaultValue:!0}];return class extends i{constructor(e,t){super(e,t),this.addParameters(o);let i=this;this.setAttribute("sType","CommentPositioned"),this.setNode(new n({frmWindow:this._frmWindow,getType:this.getType})),this.getManipulationData=function(){return this.getNode().getCommentParams()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttribute("vPosition",r.getRelativePosition(i,e.position))};let a=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),owner:i.getOwner(),pointedPage:i.getAttribute("fPointedPageNumber"),position:r.getAbsolutePosition(i,null,i.getAttribute("vPosition")),isVisible:!i.hasAlertFlag(),inEdition:i.isInEdition()}),a())}}}}),define("DS/DMUPlayMarker/DMUMarker3DCircleNode3D",["require","exports","DS/SceneGraphNodes/BillBoardNode3D","DS/Visualization/ThreeJS_DS","DS/Visualization/Node3D","DS/Visualization/SceneGraphFactory","DS/DMUBaseExperience/EXPToolsMaterial","DS/DMUPlayMarker/DMUMarkerTools","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUBaseUI/DMUManipulableNode3D"],function(e,t,i,r,n,o,a,s,l,d){"use strict";return class extends d{constructor(e){super(e);let t,d,p,c,h=this,u=h.getViewer(),g=1,P=new i({type:"Spherical"});this.addChild(P),P.setPickParent(!0);let f=new n;P.addChild(f),f.setPickParent(!0),this.linkManipulatorToNode(f),this.getRepNode=function(){return P},this.updateRepresentation=function(e,i){if(p){let n=p.radius?e.radius/p.radius:1,o=new r.Vector3(n,n,1);f.setMatrix((new r.Matrix4).scale(o)),h.setMatrix((new r.Matrix4).setPosition(e.position)),t&&t.line&&(t.setOpacity((p.graphicProperties.fillStyle.opacity||0)*(i?.6:1)),t.line.setOpacity((p.graphicProperties.lineStyle.opacity||0)*(i?.6:1)))}},this.getCircleParams=function(){return p?{position:p.center,radius:p.radius,pointedPage:p.pointedPage}:{}};let S=this.removeDMUNode3DOverload;function y(){if(!p)return;let e,t=l.getMMPerPixelRatio(u,p.center);return t>0&&(e=Math.round(2*Math.PI/Math.acos(1-1/((p.radius||0)/t))),(isNaN(e)||e<20)&&(e=20)),e}this.removeDMUNode3DOverload=function(){S(),c&&clearTimeout(c),c=null,t&&t.dispose(),t=P=p=f=null},this._updateVisibility=function(e){if(!p)return;void 0!==e&&(g=e);let t=s.is3DMarkerDisplayed(u,p.pointedReferences);h.setVisibility(g>0&&p.isVisible&&t),u.render()},this.update=function(e){if(!h)return;p||(p={graphicProperties:{fillStyle:{},lineStyle:{}}});let i=!1,n=[],l={paramA:p,paramB:e,merge:!0,mergedKeys:n};if(!s.compareAndMergeParams(l)||!d){let e=h.getRepManipulator();if(e&&e.deactivate(),h.setName(p.name),(!d||n.includes("center")||n.includes("radius"))&&(i=!0,d=y()),t?(n.includes("fillStyle")&&(i=!0,t.color=p.graphicProperties.fillStyle.color,t.setOpacity(p.graphicProperties.fillStyle.opacity)),n.includes("lineStyle")&&(i=!0,t.line.color=p.graphicProperties.lineStyle.color,t.line.setOpacity(p.graphicProperties.lineStyle.opacity),t.line.setLineWidth((p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio),t.line.setDashPatternType(a.getDashType(p.graphicProperties.lineStyle.pattern)))):(i=!0,(t=a.createBasicMaterial({color:p.graphicProperties.fillStyle.color,opacity:p.graphicProperties.fillStyle.opacity})).line=a.createLineMaterial({color:p.graphicProperties.lineStyle.color,opacity:p.graphicProperties.lineStyle.opacity,lineWidth:(p.graphicProperties.lineStyle.thickness||0)*window.devicePixelRatio,pattern:p.graphicProperties.lineStyle.pattern})),(n.includes("isFilled")||n.includes("hasBorder"))&&(i=!0),i){f.removeChildren();let e=o.createCircleNode({radius:p.radius,fill:p.isFilled,segments:d,noEdge:!p.hasBorder,startAngle:0,endAngle:2*Math.PI,material:t});e.setShadow(!1),e.setPickParent(!0),f.addChild(e),f.setMatrix(new r.Matrix4)}h.setMatrix((new r.Matrix4).setPosition(p.center)),e&&e.activate(),h._updateVisibility()}};let m=function(){h&&h._updateVisibility(),c=null};this.onViewerEventCB=function(e){h&&p&&("onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType&&"@onViewpointEndMove"!==e.eventType||("@onViewpointEndMove"===e.eventType&&h.isVisible()&&d!==y()?(c&&clearTimeout(c),c=null,d=null,h.update(p)):c||!p.pointedReferences||"onHideShow"!==e.eventType&&"onRepresentationLoaded"!==e.eventType||(c=setTimeout(m))))}}}}),define("DS/DMUPlayMarker/DMUMarker3DRectangle",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DRectangleNode3D"],function(e,t,i,r,n,o){"use strict";let a=[{name:"fWidth",type:"float",JSONname:"Properties3DRectangle.width",defaultValue:10},{name:"fHeight",type:"float",JSONname:"Properties3DRectangle.height",defaultValue:10},{name:"vPosition",type:"Vector3",JSONname:"Properties3DRectangle.position",defaultValue:new i.Vector3},{name:"vRelativePosition",type:"Vector3",JSONname:"Properties3DRectangle.RelativePosition",defaultValue:null},{name:"sAnchor",type:"string",JSONname:"Properties3DRectangle.anchor",defaultValue:"center"}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DRectangle");let i=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getBoundingBoxDimensions()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttributes([{name:"fWidth",value:e.width},{name:"fHeight",value:e.height},{name:"vPosition",value:n.getRelativePosition(i,e.position)},{name:"fRotationAngle",value:n.getRelativeRotation(i,e.rotation)}])};let r=this.refreshNode;this.refreshNode=function(){i.getNode()&&!t.isImporting()&&(i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),position:n.getAbsolutePosition(i,i.getAttribute("vRelativePosition"),i.getAttribute("vPosition"),i.getPointedReference(0)),rotationAngle:n.getAbsoluteRotation(i,i.getAttribute("fRotationAngle")||0),width:i.getAttribute("fWidth"),height:i.getAttribute("fHeight"),anchor:i.getAttribute("sAnchor"),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:i.getAttribute("bHasBorder"),pointedPage:i.getAttribute("fPointedPageNumber"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:n.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"),color:i.getAttribute("cLineStyleColor"),opacity:i.getAttribute("fLineStyleOpacity")}}}),r())},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"vPosition"===e&&i.updatePointedPosition(t):i.setAttribute("bHasBorder",!0):i.setAttribute("bIsFilled",!0),i._parentSetAttribute(e,t)},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"vPosition"===e?i._parentGetAttribute(e).clone():i._parentGetAttribute(e)}}}}),define("DS/DMUPlayMarker/DMUMarker3DCircle",["require","exports","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3D","DS/DMUBaseUIServices/DMUObjectsServices","DS/DMUPlayMarker/DMUMarker3DCircleNode3D"],function(e,t,i,r,n,o){"use strict";let a=[{name:"vCenter",type:"Vector3",JSONname:"Properties3DCircle.Center",defaultValue:new i.Vector3},{name:"vCenterRelativePosition",type:"Vector3",JSONname:"Properties3DCircle.CenterRelativePosition",defaultValue:null},{name:"fRadius",type:"float",JSONname:"Properties3DCircle.Radius",defaultValue:100}];return class extends r{constructor(e,t){super(e,t),this.addParameters(a),this.setAttribute("sType","Marker3DCircle");let i=this;this.setNode(new o({frmWindow:this._frmWindow,getType:this.getType})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar"),this.getManipulationData=function(){return this.getNode().getCircleParams()},this.updateModel=function(e){i.updatePointedElement(e.position),i.setAttributes([{name:"vCenter",value:n.getRelativePosition(i,e.position)},{name:"fRadius",value:e.radius}])};let r=this.refreshNode;this.refreshNode=function(){if(i.getNode()&&!t.isImporting()){let e=!i.getAttribute("bHasBorder")&&!i.getAttribute("bIsFilled")||i.getAttribute("bHasBorder"),t=i.getAttribute("bHasBorder")||i.getAttribute("bIsFilled")?i.getAttribute("cLineStyleColor"):i.getAttribute("cFillStyleColor"),o=i.getAttribute("bHasBorder")||i.getAttribute("bIsFilled")?n.getLineThickness(i.getAttribute("fLineStyleThicknessIndex"))||i.getAttribute("fLineStyleThickness"):5;i.getNode().update({name:i.getAttribute("sName"),pointedReferences:i.getAttribute("lPointedReferences"),radius:i.getAttribute("fRadius"),center:n.getAbsolutePosition(i,i.getAttribute("vCenterRelativePosition"),i.getAttribute("vCenter"),i.getPointedReference(0)),inEdition:i.isInEdition(),isVisible:i.getAttribute("bVisible")&&!i.hasAlertFlag(),isFilled:i.getAttribute("bIsFilled"),hasBorder:e,pointedPage:i.getAttribute("fPointedPageNumber"),pointedElement:i.getAttribute("sPointedElementID"),graphicProperties:{fillStyle:{color:i.getAttribute("cFillStyleColor"),opacity:i.getAttribute("fOpacity")},lineStyle:{pattern:i.getAttribute("sLineStylePattern"),thickness:o,color:t,opacity:i.getAttribute("fLineStyleOpacity")}}}),r()}},this._parentSetAttribute=this.setAttribute,this.setAttribute=function(e,t){i.getParent().isImporting()||!1!==t||"bHasBorder"!==e||i.getAttribute("bIsFilled")?i.getParent().isImporting()||!1!==t||"bIsFilled"!==e||i.getAttribute("bHasBorder")?"cLineStyleColor"!==e||i.getAttribute("bIsFilled")||i.getAttribute("bHasBorder")?"vCenter"===e?(i.updatePointedPosition(t),this._parentSetAttribute(e,t)):"fRadius"===e?t>0&&this._parentSetAttribute("fRadius",t):this._parentSetAttribute(e,t):this._parentSetAttribute("cFillStyleColor",t):(i.setAttribute("bHasBorder",!0),this._parentSetAttribute(e,t)):(i.setAttribute("bIsFilled",!0),this._parentSetAttribute(e,t))},this._parentGetAttribute=this.getAttribute,this.getAttribute=function(e){return"cLineStyleColor"!==e||this.getAttribute("bIsFilled")||this.getAttribute("bHasBorder")?"vCenter"===e?i._parentGetAttribute("vCenter").clone():i._parentGetAttribute(e):i._parentGetAttribute("cFillStyleColor")}}}}),define("DS/DMUPlayMarker/DMUMarkerFactory",["UWA/Utils","DS/Visualization/ThreeJS_DS","DS/DMUPlayMarker/DMUMarker3DSpline","DS/DMUPlayMarker/DMUMarker3DLine","DS/DMUPlayMarker/DMUMarker3DCircle","DS/DMUPlayMarker/DMUMarker3DEllipse","DS/DMUPlayMarker/DMUMarker3DRectangle","DS/DMUPlayMarker/DMUMarker3DPicture","DS/DMUBaseExperience/EXPToolsVisualization","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i,r,n,o,a,s,l,d){"use strict";var p,c=0;return{create3DMarker:function(h){if(!(h&&h.viewer&&h.shape&&h.shape.type&&h.parent))return;var u,g,P=h.viewer;let f,S=Boolean(h.pointedElement||h.pageNb);switch(S&&(f=new t.Vector3(0,0,0)),h.shape.type){case"circle":if(h.shape.data&&h.shape.data.centre&&h.getRelativePositionCB&&h.getRelativeRotationCB){var y=l.getNearPositionFrom2DCoordinates(new t.Vector2(h.shape.data.centre.x,h.shape.data.centre.y),P,f,S);g=l.getMMPerPixelRatio(P,y),(u=new n(P,h.parent)).setAttributes([{name:"sID",value:h.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.parent.computeNewName({object:u,prefix:"CircleMarker3D"})},{name:"vCenter",value:h.getRelativePositionCB(y)},{name:"fRadius",value:h.shape.data.radius*g},{name:"cLineStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"cFillStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==h.graphicProperties.lineStyleThicknessIndex?h.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"fOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"bIsFilled",value:void 0!==h.graphicProperties.isFilled&&h.graphicProperties.isFilled},{name:"bHasBorder",value:void 0===h.graphicProperties.hasBorder||h.graphicProperties.hasBorder},{name:"fPointedPageNumber",value:h.pageNb},{name:"sPointedElementID",value:h.pointedElement}])}break;case"square":case"rectangle":if(h.shape.data&&h.shape.data.vertices&&4===h.shape.data.vertices.length&&h.getRelativePositionCB&&h.getRelativeRotationCB){var m=h.shape.data.vertices[0].clone().sub(h.shape.data.vertices[3]).length(),D=h.shape.data.vertices[0].clone().sub(h.shape.data.vertices[1]).length(),M=h.shape.data.vertices[0].clone().sub(h.shape.data.vertices[3]).angle()*Math.sign(h.shape.data.vertices[0].y-h.shape.data.vertices[3].y);if(M%=Math.PI/2,Math.abs(M)>Math.PI/4){M-=Math.PI/2*Math.sign(M);var b=m;m=D,D=b}var A=l.getNearPositionFrom2DCoordinates(new t.Vector2((h.shape.data.vertices[0].x+h.shape.data.vertices[2].x)/2,(h.shape.data.vertices[0].y+h.shape.data.vertices[2].y)/2),P,f,S);g=l.getMMPerPixelRatio(P,A),(u=new a(P,h.parent)).setAttributes([{name:"sID",value:h.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.parent.computeNewName({object:u,prefix:"RectangleMarker3D"})},{name:"vPosition",value:h.getRelativePositionCB(A)},{name:"fWidth",value:m*g},{name:"fHeight",value:D*g},{name:"fRotationAngle",value:h.getRelativeRotationCB(M)},{name:"cLineStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"cFillStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==h.graphicProperties.lineStyleThicknessIndex?h.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"fOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"bIsFilled",value:void 0!==h.graphicProperties.isFilled&&h.graphicProperties.isFilled},{name:"bHasBorder",value:void 0===h.graphicProperties.hasBorder||h.graphicProperties.hasBorder},{name:"fPointedPageNumber",value:h.pageNb},{name:"sPointedElementID",value:h.pointedElement}])}break;case"ellipse":if(h.shape.data&&h.shape.data.centre&&h.getRelativePositionCB&&h.getRelativeRotationCB){var v=l.getNearPositionFrom2DCoordinates(new t.Vector2(h.shape.data.centre.x,h.shape.data.centre.y),P,f,S);g=l.getMMPerPixelRatio(P,v);var x=2*h.shape.data.radius1*g,w=2*h.shape.data.radius2*g,k=-h.shape.data.angle*Math.PI/180;if(Math.abs(k)>Math.PI/4){k%=Math.PI/2,k-=Math.PI/2*Math.sign(k);var N=x;x=w,w=N}(u=new o(P,h.parent)).setAttributes([{name:"sID",value:h.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.parent.computeNewName({object:u,prefix:"EllipseMarker3D"})},{name:"vCenter",value:h.getRelativePositionCB(v)},{name:"fxAxisLength",value:x},{name:"fyAxisLength",value:w},{name:"fRotationAngle",value:h.getRelativeRotationCB(k)},{name:"cLineStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"cFillStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==h.graphicProperties.lineStyleThicknessIndex?h.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"fOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"bIsFilled",value:void 0!==h.graphicProperties.isFilled&&h.graphicProperties.isFilled},{name:"bHasBorder",value:void 0===h.graphicProperties.hasBorder||h.graphicProperties.hasBorder},{name:"fPointedPageNumber",value:h.pageNb},{name:"sPointedElementID",value:h.pointedElement}])}break;case"picture":var U=h.shape.data.image?h.shape.data.image.width:300,C=h.shape.data.image?h.shape.data.image.height:300;U>300&&(C=300*C/U,U=300),C>300&&(U=300*U/C,C=300),U=Math.round(U),C=Math.round(C),p&&p.equals(h.shape.pointingPoint)?c++:(p=h.shape.pointingPoint.clone(),c=0);var T=h.shape.pointingPoint,V=l.getWindowPositionFromPoint(P,T,h.frameWindow),I=l.getDistanceFromPixel(P,T,U,h.frameWindow);V.right<U&&(I=-I);var R=l.getViewpointInfo(P.currentViewpoint),L=R.right.clone().multiplyScalar(I);T=h.shape.pointingPoint.clone().add(L),c&&(g=l.getMMPerPixelRatio(P,T),T.add(R.right.clone().multiplyScalar(20*c*g)).add(R.up.clone().multiplyScalar(20*-c*g))),(u=new s(P,h.parent)).setAttributes([{name:"sID",value:h.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.parent.computeNewName({object:u,prefix:"PictureMarker3D"})},{name:"lLeaderPointingPoints",value:[h.shape.pointingPoint]},{name:"bHasALeader",value:!0},{name:"sLeaderEndType",value:"Arrow"},{name:"bIsFilled",value:!0},{name:"bHasBorder",value:!1},{name:"fFontSize",value:3.5},{name:"fBorderRadius",value:4},{name:"bShortDisplay",value:!1},{name:"sRelatedObjectId",value:h.objectId},{name:"fCreationDate",value:h.date},{name:"vLeaderBreakPoint3D",value:T},{name:"fImageWidth",value:l.convertPixelToModel({sizeInPixels:U,viewer:P})},{name:"fImageHeight",value:l.convertPixelToModel({sizeInPixels:C,viewer:P})}]),u.setRelatedObjectData(h.shape.data);break;default:if(h.points&&h.points.length){var B=[],O=[];if(2===(B=d.getControlPoints(h.points,15)).length){var E,F,_,W;Math.abs(B[0].y-B[1].y)<l.convertModelToPixels({sizeInMM:5})&&(B[1].y=B[0].y);var H=(new t.Vector2).addVectors(B[0],B[1]).multiplyScalar(.5),J=l.getPickingInfo(P,B[0]),z=l.getPickingInfo(P,B[1]);J.paths&&J.paths.length&&z.paths&&z.paths.length?(E=J.point,F=z.point):(W=l.getPickingInfo(P,H),J.paths&&J.paths.length?(E=J.point,_=W.paths&&W.paths.length?W.point:J.point,F=l.getPositionFromIntersection(P,l.get3DPositionFromScreenCoordinates({coords:B[1],viewer:P}),_)):z.paths&&z.paths.length?(F=z.point,_=W.paths&&W.paths.length?W.point:z.point,E=l.getPositionFromIntersection(P,l.get3DPositionFromScreenCoordinates({coords:B[0],viewer:P}),_)):W.paths&&W.paths.length?(E=l.getPositionFromIntersection(P,l.get3DPositionFromScreenCoordinates({coords:B[0],viewer:P}),W.point),F=l.getPositionFromIntersection(P,l.get3DPositionFromScreenCoordinates({coords:B[1],viewer:P}),W.point)):(E=l.getNearPositionFrom2DCoordinates(B[0],P,f,S),F=l.getNearPositionFrom2DCoordinates(B[1],P,E))),O.push({Name:"Begin",PointType:0,Size:1,Point3D:h.getRelativePositionCB(E).toArray()}),O.push({Name:"End",PointType:0,Size:1,Point3D:h.getRelativePositionCB(F).toArray()}),(u=new r(P,h.parent)).setAttributes([{name:"sID",value:h.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.parent.computeNewName({object:u,prefix:"LineMarker3D"})},{name:"oPoints",value:O},{name:"cLineStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==h.graphicProperties.lineStyleThicknessIndex?h.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"fPointedPageNumber",value:h.pageNb},{name:"sPointedElementID",value:h.pointedElement}])}else{var G=-1/0,j=1/0,X=-1/0,q=1/0;B.forEach(function(e){G=Math.max(G,e.x),j=Math.min(j,e.x),X=Math.max(X,e.y),q=Math.min(q,e.y)});var K=new t.Vector2(j,X),Z=new t.Vector2(G,q),Q=(new t.Vector2).addVectors(K,Z).multiplyScalar(.5),Y=l.getNearPositionFrom2DCoordinates(Q,P,f,S);B.forEach(function(e){var t=l.get3DPositionFromScreenCoordinates({coords:e,viewer:P}),i=h.getRelativePositionCB(l.getPositionFromIntersection(P,t,Y));O.push({Point3D:i.toArray()})}),(u=new i(P,h.parent)).setAttributes([{name:"sID",value:h.parent.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sName",value:h.parent.computeNewName({object:u,prefix:"SplineMarker3D"})},{name:"oPoints",value:O},{name:"fRotationAngle",value:0},{name:"cLineStyleColor",value:h.graphicProperties.lineStyleColor?h.graphicProperties.lineStyleColor:new t.Color(13371695)},{name:"fLineStyleThicknessIndex",value:void 0!==h.graphicProperties.lineStyleThicknessIndex?h.graphicProperties.lineStyleThicknessIndex:3},{name:"fLineStyleOpacity",value:void 0!==h.graphicProperties.lineStyleOpacity?h.graphicProperties.lineStyleOpacity:1},{name:"fPointedPageNumber",value:h.pageNb},{name:"sPointedElementID",value:h.pointedElement}]);let r=l.getViewpointInfo(P.currentViewpoint);u.updateProjectionPlaneDefinition({up:r.up,right:r.right})}}}return u}}}),define("DS/DMUPlayMarker/DMUMarker3DHyperlinkNode3D",["DS/DMUPlayMarker/DMUMarker3DTextNode3D","DS/Mesh/MeshUtils","DS/DMUPlayMarker/DMUMarkerTools","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,i,r,n){"use strict";return e.extend({init:function(e){var o=e||{};o.defaultGraphicProps={padding:0},this._parent(o);var a,s=this;this.getTooltip=function(){return i.createHyperlinkDiv(o.getHyperlinks())},this.onClickCB=function(){s.getViewer().setCursor("auto"),i.solveHyperlink(o.getHyperlinks(),s.getViewer())},this.onBeginPreactivateCB=function(e){a||(a=n.buildPathElement(s.children[0])),r.add({pathElement:a,event:e.event.from[0]}),s.getViewer().setCursor("pointer")},this.onEndPreactivateCB=function(){a||(a=n.buildPathElement(s.children[0])),r.isIn({pathElement:a})&&r.remove({pathElement:a}),s.getViewer().setCursor("auto")};var l=this.update;this.update=function(e){l(e),s.setPickable(t.PICKABLE),s._getExcludeFromCSO=o.isReadOnly}}})}),define("DS/DMUPlayMarker/DMUMarker3DHyperlink",["DS/DMUPlayMarker/DMUMarker3DText","DS/DMUPlayMarker/DMUMarker3DHyperlinkNode3D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i){"use strict";return e.extend({init:function(e,r){var n=this;this._parent(e,r,{type:"Marker3DHyperlink",nodeClass:t,nodeParams:{getHyperlinks:function(){return n.getAttribute("oHyperlinks")},isReadOnly:function(){return n.isReadOnly()}}});let o=this.getImageToDisplay;this.getImageToDisplay=function(){return o()?o():i.getHyperlinkIcon(this.getAttribute("oHyperlinks"))}}})}),define("DS/DMUPlayMarker/DMUMarker2DPoint",["DS/DMUBaseReview/DMUOverloadableObject","DS/DMUPlayMarker/DMUMarker2DPointNode3D","DS/DMUPlayMarker/DMUMarkerImport"],function(e,t,i){"use strict";var r=[{name:"iPointType",type:"int",JSONname:"PointType"},{name:"iSize",type:"float",JSONname:"Size"},{name:"vPosition",type:"Vector2",JSONname:"Point2D"},{name:"vRelativePosition",type:"Vector2",JSONname:"RelativePos"}];return e.extend({init:function(e,n){this._parent(e,n),this.addParameters(r),this.setAttribute("sType","Marker2DPoint");var o=this,a=new i(o);this.importData=a.importData,this.afterImport=a.afterImport,this.setNode(new t({frmWindow:this._frmWindow,getType:this.getType}));var s=this.refreshNode;this.refreshNode=function(){o.getNode()&&!n.isImporting()&&(o.getNode().update({name:o.getAttribute("sName"),pointType:o.getAttribute("iPointType"),size:o.getAttribute("iSize"),position:o.getAttribute("vPosition"),relativePos:o.getAttribute("vRelativePosition"),windowAnchor:o.getAttribute("sWindowAnchor"),isPositionProportional:o.getAttribute("bProportionalPosition")}),s())}}})}),define("DS/DMUPlayMarker/DMUMarker2DHyperlinkNode3D",["DS/DMUPlayMarker/DMUMarker2DTextNode3D","DS/Mesh/MeshUtils","DS/DMUPlayMarker/DMUMarkerTools","DS/Selection/PSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,i,r,n){"use strict";return e.extend({init:function(e){var o=e||{};o.defaultGraphicProps={padding:0},this._parent(o);var a,s=this;this.getTooltip=function(){return i.createHyperlinkDiv(o.getHyperlinks())},this.onClickCB=function(){s.getViewer().setCursor("auto"),i.solveHyperlink(o.getHyperlinks(),s.getViewer())},this.onBeginPreactivateCB=function(e){a||(a=n.buildPathElement(s.children[0])),r.add({pathElement:a,event:e.event.from[0]}),s.getViewer().setCursor("pointer")},this.onEndPreactivateCB=function(){a||(a=n.buildPathElement(s.children[0])),r.isIn({pathElement:a})&&r.remove({pathElement:a}),s.getViewer().setCursor("auto")};var l=this.update;this.update=function(e){l(e),s.setPickable(t.PICKABLE),s._getExcludeFromCSO=o.isReadOnly}}})}),define("DS/DMUPlayMarker/DMUMarker2DHyperlink",["DS/DMUPlayMarker/DMUMarker2DText","DS/DMUPlayMarker/DMUMarker2DHyperlinkNode3D","DS/DMUPlayMarker/DMUMarkerTools"],function(e,t,i){"use strict";return e.extend({init:function(e,r){var n=this;this._parent(e,r,{type:"Marker2DHyperlink",nodeClass:t,nodeParams:{getHyperlinks:function(){return n.getAttribute("oHyperlinks")},isReadOnly:function(){return n.isReadOnly()}}});let o=this.getImageToDisplay;this.getImageToDisplay=function(){return o()?o():i.getHyperlinkIcon(n.getAttribute("oHyperlinks"))}}})}),define("DS/DMUPlayMarker/DMUMarker2DPolyline",["DS/DMUPlayMarker/DMUMarker2D","DS/DMUPlayMarker/DMUMarker2DPolylineNode3D","DS/DMUPlayMarker/DMUMarker2DPoint","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseExperience/EXPImportServices","DS/DMUBaseUIServices/DMUObjectsServices"],function(e,t,i,r,n,o){"use strict";var a=[{name:"oPoints",type:"objectDefinition",JSONname:"Properties2DMultiPoint.Points"}];return e.extend({init:function(e,s){this._parent(e,s),this.addParameters(a),this.removeParameters(["cFillStyleColor","bIsFilled","bHasBorder","fOpacity"]),this.setAttribute("sType","Marker2DPolyline");var l=this,d=[],p=new n;this.getPoints=function(e){var t;if(e||!d.length){var n=l.getAttribute("oPoints");for(t=0;t<d.length;t++)d[t].remove();for(d.length=0,t=0;t<n.length;t++){var o=r.getReviewContext({viewer:l._viewer}),a=new i(l.getViewer(),o.getCurrentSessionMarkup());p.fillObjectAttributes(a,n[t]),d.push(a)}}return d},this.setNode(new t({frmWindow:this._frmWindow,getType:this.getType,getPoints:this.getPoints})),this.initContextualBar("DS/DMUMarker/DMUMarkerContextualBar");var c=this.refreshNode;this.refreshNode=function(){l.getNode()&&!s.isImporting()&&(l.getNode().update({name:l.getAttribute("sName"),isVisible:l.getAttribute("bVisible"),windowAnchor:l.getAttribute("sWindowAnchor"),isPositionProportional:l.getAttribute("bProportionalPosition"),points:l.getAttribute("oPoints"),rotationAngle:"number"==typeof l.getAttribute("fScreenRotationAngle")?l.getAttribute("fScreenRotationAngle"):l.getAttribute("fRotationAngle"),graphicProperties:{lineStyle:{thickness:o.getLineThickness(l.getAttribute("fLineStyleThicknessIndex"))||l.getAttribute("fLineStyleThickness"),pattern:l.getAttribute("sLineStylePattern"),color:l.getAttribute("cLineStyleColor"),opacity:l.getAttribute("fLineStyleOpacity")}}}),c())},this.getMaximumProportionalWidth=function(){var e=0;if(l.getAttribute("bProportionalPosition"))for(var t,i=l.getPoints(),r=0;r<i.length;r++)t=i[r].getAttribute("vPosition"),Math.abs(t.x)>e&&(e=Math.abs(t.x));return e}}})}),define("DS/DMUPlayMarker/DMUMarker2DLine",["DS/DMUPlayMarker/DMUMarker2DPolyline"],function(e){"use strict";return e.extend({init:function(e,t){this._parent(e,t),this.setAttribute("sType","Marker2DLine")}})});