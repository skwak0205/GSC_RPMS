/*! -- Copyright 2014 Dassault Systemes. All rights reserved. */
define("DS/W3DSpace/EnoviaBootstrap",["UWA/Core","UWA/Class/Collection","UWA/Class/Listener","UWA/Utils","DS/PlatformAPI/PlatformAPI","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/WAFData/WAFData"],function(e,t,n,i,o,a,s){"use strict";var r,l,c,d,u,m,p=!1,g=!1;function h(){var t;t=s.authenticatedRequest,s.authenticatedRequest=function(n,i){var o,a,s,r,d;return l&&(o=l.getStorageWithUrl(n)),e.is(o)&&(n!==(r="url",(s=o)&&(d=s[r],e.is(d,"function")&&(d=d.call(s))),d)&&(i||(i={}),i.headers||(i.headers={}),i.headers["X-DS-CSRFTOKEN"]=c||""),n=n+(-1===n.indexOf("?")?"?":"&")+"tenant="+o.id),a=i.onComplete,i.onComplete=function(t,n,i){var o=Object.keys(n).filter(function(e,t){return-1!==e.search(/x-ds-csrftoken/i)});c=o.length>0?n[o[0]]:c,e.is(a,"function")&&a(t,n,i)},t(n,i)}}return e.merge(n,{start:function(t){p||(t.frameENOVIA&&(g=!0),t=t?e.clone(t,!1):{},l=t.collection,function(e){if(r)return r;var t="com.ds."+e.id;(r=new i.InterCom.Socket(t)).subscribeServer("com.ds.compass",window.parent)}(t),h(),u||a.getServiceUrl({serviceName:"3DSwym",onComplete:function(e){var t;if(u=e,d&&(t=d.id),t&&u)for(var n=0;n<u.length;n++)if(t===u[n].platformId){m=u[n].url;break}},onFailure:function(e){u=[]}}),p=!0)},onStorageChange:function(t,n){var i=t.get("csrf");d=t,e.is(i)?n.onComplete&&n.onComplete():d.fetch({onComplete:n.onComplete,onFailure:function(e,t){n.onFailure(t)}});var o=d.id;if(o&&u)for(var a=0;a<u.length;a++)if(o===u[a].platformId){m=u[a].url;break}},getCompassSocket:function(){if(p)return r},getSyncOptions:function(){return g?{}:{ajax:s.authenticatedRequest}},getStorages:function(){if(p)return l},getStorage:function(){if(p)return d},getSwymUrl:function(){if(m)return m}})}),define("DS/W3DSpace/Views/EditVisibilityView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","DS/UIKIT/Modal","UWA/Class/View","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,a,s,r,l,c){"use strict";return l.extend({name:"EditVisibility",tagName:"div",className:"create-cs-view",init:function(e){var t=UWA.clone(e,!1);["container","template","tagName","domEvents"].forEach(function(e){delete t[e]}),this._parent(t)},setup:function(){this.container.addClassName(this.getClassNames("-container")),this._initAlert(),this._initForm(),this._initListenKeyDown()},_initAlert:function(){var t={className:"create-alert",closable:!0,renderTo:document.body,autoHide:!0,visible:!0};this.elements.alertFailure=new s(e.extend({messageClassName:"error"},t))},_initForm:function(){var e,t,o,a,s,l,d,u=this,m=(this.options,this.elements),p=[{value:"PRIVATE",label:c.private+" - "+c.privateDetail,selected:this.model.get("visibility").value.toUpperCase()==="Private".toUpperCase(),disabled:"STANDARD"===this.model.get("family").name.toUpperCase()},{value:"PROTECTED",label:c.protected+" - "+c.protectedDetail,selected:this.model.get("visibility").value.toUpperCase()==="Protected".toUpperCase(),disabled:"STANDARD"===this.model.get("family").name.toUpperCase()},{value:"PUBLIC",label:c.public+" - "+c.publicDetail,selected:this.model.get("visibility").value.toUpperCase()==="Public".toUpperCase(),disabled:"STANDARD"===this.model.get("family").name.toUpperCase()}];e=[{type:"select",name:"visibility",label:c.visibility,nativeSelect:!1,placeholder:!1,options:p}],t=new n({fields:e,events:{onSubmit:function(){u.onEdit()},onInvalid:function(e){},onValid:function(){}}}),s=new i({value:c.edit,className:"warning",events:{onClick:this.dispatchAsEventListener("onEdit")}}),l=new i({value:c.cancel,events:{onClick:function(){u.dispatchEvent("onCancel")}}}),o=new i({value:c.edit,className:"primary",events:{onClick:function(){var e=u.model.get("visibility").value,t=u.elements.form.getValue("visibility"),n=u.model.get("title");if(e.toUpperCase()===t.toUpperCase())return u.dispatchEvent("onEdit");d=new r({closable:!0,header:c.replace(c.visibilityConfirmTitle),body:function(e,t,n){var i=["PRIVATE","PROTECTED","PUBLIC"],o=i.findIndex(t=>t===e.toUpperCase()),a=i.findIndex(e=>e===t.toUpperCase()),s=null;a>o?(s=c.replace(c.visibilityIncreaseConfirmMessage1,{name:n}),s+="<br><br><b>",s+=c.visibilityIncreaseConfirmMessage2+"</b>"):a<o&&(s=c.replace(c.visibilityReduceConfirmMessage1,{name:n}),s+="<br><br><b>",s+=c.visibilityReduceConfirmMessage2+"</b>");return s}(e,t,n),footer:[s,l]}),m.confirmModal=d,d.inject(document.body),d.show()}}}),a=new i({value:c.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}}),m.form=t,m.edit=o,m.cancel=a},getEditButton:function(){return this.elements.edit},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form.elements.container[0]},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this),document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(e){if(13===e.keyCode)this.submitEnabled()&&this.onEdit();else if(27===e.keyCode){var t=document.createEvent("Event");t.initEvent("click",!0,!1),this.elements.cancel.elements.content.dispatchEvent(t)}},submitEnabled:function(){return null===this.elements.edit.elements.content.getAttribute("disabled")},render:function(){var e=this.elements,t=e.form;e.edit,e.cancel;return this.container.setContent([t,{tag:"div",class:"footer"}]),this},onEdit:function(){var t,n=this,i=this.options,o=(this.model,i.onComplete,i.onFailure);i.onFailure=function(t,i,a){n.model.collection.remove(t),e.is(o)&&o.apply(void 0,arguments)},t={visibility:{value:this.elements.form.getValue("visibility")}},this.model.save(t,{onComplete:i.onComplete,onFailure:i.onFailuren})}})}),define("DS/W3DSpace/Views/ModalDisplaySecurityContexts",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/UIKIT/Alert","DS/UIKIT/Input/Button","DS/UIKIT/Scroller","UWA/Class/Promise","DS/WAFData/WAFData","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,a,s,r,l){"use strict";return t.extend({init:function(t){t=e.clone(t||{},!1),this._parent(t),this.getCredentials()},createModal:function(t){var s,r,c,d="",u=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}),m=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"primary"}),p=e.createElement("div",{class:"credentials-container"});if(t.length>100){var g=this.options.model.get("login");u.add({message:l.replace(l.credentialsWarning,{login:g,credentials:t.length})})}if(0===t.length){g=this.options.model.get("login");m.add({message:l.replace(l.credentialsListEmpty,{login:g})})}else{for(var h=0;h<t.length;h++)d=t[h].project.name+"●"+t[h].company.name+"●"+t[h].role.name,c=e.createElement("li",{html:d}),p.addContent(c);r=new o({value:l.close,events:{onClick:function(){s.destroy()}}});new a({element:p});s=this.elements.modal=new n({closable:!0,header:l.credentialsList,body:p,footer:r}).inject(document.body),this.elements.modal.show()}},getCredentials:function(){var e=this.options.model.get("login"),t=this,n=this.options.model.collection.url;return n=n+"/"+e+"/credentials",new s(function(e,i){r.authenticatedRequest(n,Object.assign({method:"GET",type:"json",headers:{"Content-Type":"application/json"},onComplete:function(){return e(t.createModal(arguments[0]))},onFailure:function(){return i(arguments)}}))})}})}),define("DS/W3DSpace/Views/ManageMembers",["UWA/Class/View","UWA/Core","UWA/Controls/Abstract","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/i3DXPnOMultiOrg/OrgOperatorController"],function(e,t,n,i,o){"use strict";return n.extend({managememberClick:function(e){var n,a=e.config,s=e.model.model,r=s.get("owner"),l=document.createElement("div");l.classList.add("multiOrg"),l.classList.add("multiOrg--visible"),widget.body.appendChild(l),i.getUser({onComplete:function(e){n=e}}),e.config.user=n,s.drive=e.config,s.drive.set("user",n),s.set("owners",r);s.permissions=function(e,n,i){return new(0,e._Permissions)(n||[],t.merge({parentInode:s,auth:s._auth},i))}(a),s.permissions,window.selectedcollabSpace=s,window.orgOperatorController=new o({container:l,tenantId:e.config.id,currentUser:n.id,collabSpace:s.id,collabSpaceTitle:s.get("title"),securityContext:this.getNominalContexts(e.model.model),owner:this.isOwner(e.model.model).isOwner,ownerRestricted:this.isOwner(e.model.model).isOwnerRestricted,mainOwner:s.get("owner").login,roles:e.config.get("availableRoles"),onAddUsers:function(){(function(e){require(["DS/W3DSpaceComponents/Views/shareCollaborativeSpace"],function(t){t(e)})}).call(this,window.selectedcollabSpace)},onCloseView:function(){document.querySelector(".multiOrg").destroy(),widget.removeEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)}),orgOperatorController.destroy(),orgOperatorController=null}}),widget.addEvents({onLoad:orgOperatorController.load.bind(orgOperatorController),onRefresh:orgOperatorController.refresh.bind(orgOperatorController),onDestroy:orgOperatorController.destroy.bind(orgOperatorController)})},getNominalContexts:function(e){var t,n,i=e.get("contexts");if(i.length>1){for(t=0;t<i.length&&"VPLMProjectAdministrator"!==(n=i[t]).role&&"3DSRestrictedOwner"!==n.role;t++);return n.name}return i},isOwner:function(e){e.get("contexts");return!0,{isOwner:!0,isOwnerRestricted:void 0}}})}),define("DS/W3DSpace/Models/CSMember",["UWA/Class/Model","UWA/String"],function(e,t){"use strict";return e.extend({idAttribute:"physicalid",defaults:{type:"",id:"",role:{}},getActionIds:function(){return this.get("actions")||[]},isUser:function(){return"Person"===this.get("type")},isGroup:function(){return"Group"===this.get("type")},isPending:function(){return this.get("id")===this.get("email")},isActionAllowed:function(e){return-1!==this.getActionIds().indexOf(e)}})}),define("DS/W3DSpace/Utils/Metrics",["DS/Usage/TrackerAPI"],function(e){"use strict";return{trackAction:function(t){if(!t.model)throw new Error("A model is mandatory to track an action.");var n=t.model,i=t.tenant,o=n.drive?n.drive.get("title"):"3DEXPERIENCE",a=t.appContext||"",s={pd1:o,pd3:a,pd6:"collabspace"};!function(t){var n=t.tenantID||"",i=t.eventDimensions||{};e.trackPageEvent({eventCategory:t.eventCategory,eventAction:t.eventAction,eventLabel:t.eventLabel,eventValue:t.eventValue,appID:"X3DOPCS_AP",tenant:n,persDim:i})}({tenantID:i,eventAction:t.eventAction,eventDimensions:s})}}}),define("DS/W3DSpace/Collections/CSMembers",["UWA/String","UWA/Core","DS/WebAppsFoundations/Collections/PageableCollection","UWA/Class/Collection","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Models/CSMember"],function(e,t,n,i,o,a){"use strict";function s(e,n){var i;return e&&(i=e[n],t.is(i,"function")&&(i=i.call(e))),i}return i.extend({model:a,state:{firstPage:0,currentPage:0,pageSize:20,lastPage:0,type:"",role:"",title:""},queryParams:{currentPage:"page",pageSize:"limit"},url:function(){return"/admin/collabspaces/"+this._parentInode.get("name")+"/allmembers"},init:function(e,t){var n=(t=t||{}).parentInode;if(!n||!n.id)throw new Error("You must specify a valid parentInode options");return this._parentInode=n,this._parent.apply(this,arguments)},setup:function(e,t){var n=t.parentInode;this._parentInode=n;var i=o.getStorage().get("url")+"/resources/enocsmrest";this.url=i+Object.getPrototypeOf(this).url.call(this)},fetch:function(e){s(this,"url");e=e?t.clone(e,!1):{},t.extend(e,o.getSyncOptions(),!0);var n=Object.keys(this.queryParams).reduce(function(e,t){},{});return e.data=Object.assign({withactions:!0,sort:"atitle"},e.data,n),this._parent.call(this,e)},create:function(e,n){s(this,"url");return n=n?t.clone(n,!1):{},t.extend(n,o.getSyncOptions(),!0),this._parent(e,n)}})}),define("DS/W3DSpace/Views/ModalEditVisibility",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/W3DSpace/Views/EditVisibilityView","DS/UIKIT/Alert","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){var s,r,l,c,d,u,m=this,p=new o({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"});t=e.clone(t||{},!1),this._parent(t),s=e.clone(t.events||{},!1),r=t.onComplete,l=t.onFailure,c=s.onCancel,u=function(){document.removeEventListener("keydown",d.onKeyDown),d.destroy(),m.destroy()},s.onCancel=function(){u(),e.is(c)&&c.apply(this,arguments)},t.events=s,t.onComplete=function(){u(),e.is(r)&&r.apply(void 0,arguments),p.add({message:a.successEditVisibility})},t.onFailure=function(){u(),e.is(l)&&l.apply(void 0,arguments)},d=new i(t),this.elements.modal=new n({closable:!0,header:a.editVisibility,form:d,body:d.render(),footer:[d.getEditButton(),d.getCancelButton()]})},show:function(){var e=this.elements.modal;e.inject(document.body),e.show(),e.options.form.getFormFirstInput().focus()}})}),define("DS/W3DSpace/Models/AdminCollabSpaceModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n){"use strict";return t.extend({idAttribute:"name",sync:function(t,i,o){return e.extend(o,e.extend(n.getSyncOptions(),{attrs:JSON.stringify(i.toJSON(o))},!0),!0),delete o.data,this._parent.apply(this,arguments)},parse:function(t){return!e.is(t.description)&&(t.description=""),t}})}),define("DS/W3DSpace/Models/AdminPeopleModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n){"use strict";return t.extend({idAttribute:"login",sync:function(t,i,o){return e.extend(o,e.extend(n.getSyncOptions(),{attrs:JSON.stringify(i.toJSON(o))},!0),!0),delete o.data,this._parent.apply(this,arguments)}})}),define("DS/W3DSpace/Models/CollabStorageModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/Collections/CSMembers","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n,i){"use strict";return t.extend({name:"collabstorage",_Permissions:n,defaults:{csrf:null,isInnovation:!1,displayName:"",url:""},url:function(){return this.get("url")+"/resources/enocsmrest/session"},fetch:function(t){var n,o,a;o="url",(n=this)&&(a=n[o],e.is(a,"function")&&(a=a.call(n)));return t=t?e.clone(t,!1):{},e.extend(t,i.getSyncOptions(),!0),this._parent.call(this,t)},parse:function(t){var n=e.clone(t);return n.csrf=t.csrftoken,delete n.csrftoken,n.isInnovation=t.isinnovation,delete n.isinnovation,n}})}),define("DS/W3DSpace/Collections/AdminCollabSpacesCollection",["UWA/Core","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/Models/AdminCollabSpaceModel","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n,i,o){"use strict";return n.extend({name:"collabspaces",defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"csTotal"}},model:i,url:function(){return"/admin/"+this.name},setup:function(e,n){var i=n._modelKey,a=o.getStorage().get("url")+"/resources/enocsmrest";i&&i instanceof t&&(this._modelKey=i,this.url=a+Object.getPrototypeOf(this).url.call(this)),widget&&this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})},sync:function(t,n,i){e.extend(i,o.getSyncOptions(),!0),this._parent.apply(this,arguments)},fetch:function(e){if(this.currentSearchUrl&&(e.url=this.currentSearchUrl),null===this.state.totalRecords||void 0!==e.to)return this._parent.call(this,e)},parseResponseForStateUpdate:function(e,t,n,i){return{totalRecords:e.csTotal}},parseRecords:function(e){return e.items},onSearch:function(t){if(t){var n=(e.is(this.url,"function")?this.url():this.url)+"?filter="+t;n!==this.currentSearchUrl&&(this.currentSearchUrl=n,this.dispatchEvent("onSearch"))}},onResetSearch:function(){this.currentSearchUrl=null,this.dispatchEvent("onSearchReset")}})}),define("DS/W3DSpace/Collections/AdminPeopleCollection",["UWA/Core","UWA/Class/Model","DS/WebAppsFoundations/Collections/PageableCollection","DS/W3DSpace/Models/AdminPeopleModel","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n,i,o){"use strict";return n.extend({name:"peoples",defaultOptions:{mode:"data",state:{firstPage:0,currentPage:0,pageSize:25},queryParams:{currentPage:"page",pageSize:"limit",totalRecords:"total"}},model:i,url:function(){return"/admin/"+this.name},setup:function(e,n){var i=n._modelKey;i&&i instanceof t&&(this._modelKey=i,this.url=i.url()+Object.getPrototypeOf(this).url.call(this)),widget&&this.listenTo(widget,{onSearch:this.onSearch,onResetSearch:this.onResetSearch})},sync:function(t,n,i){e.extend(i,o.getSyncOptions(),!0),this._parent.apply(this,arguments)},fetch:function(e){return this.currentSearchUrl&&(e.url=this.currentSearchUrl),this._parent.call(this,e)},parseResponseForStateUpdate:function(e,t,n,i){return{totalRecords:e.total}},parseRecords:function(e,t){return e.peoples},onSearch:function(t){if(t){var n=(e.is(this.url,"function")?this.url():this.url)+"?filter="+t;n!==this.currentSearchUrl&&(this.currentSearchUrl=n,this.dispatchEvent("onSearch"))}},onResetSearch:function(){this.currentSearchUrl=null,this.dispatchEvent("onSearchReset")}})}),define("DS/W3DSpace/Collections/CollabStorageCollection",["UWA/Core","UWA/Utils","UWA/Class/Collection","DS/PlatformAPI/PlatformAPI","DS/W3DSpace/Models/CollabStorageModel","DS/i3DXCompassServices/i3DXCompassServices"],function(e,t,n,i,o,a){"use strict";return n.extend({name:"collabstorages",model:o,fetch:function(e){var t=this;a.getPlatformServices({onComplete:function(n){Object.keys(n).map(function(e){n[e]["3DSpace"]&&t.add({id:n[e].platformId,displayName:n[e].displayName,url:n[e]["3DSpace"]})}),e&&e.onComplete&&e.onComplete(t)},onFailure:function(t){e&&e.onFailure&&e.onFailure(t)}})},getStorageWithUrl:function(n,i){i=e.clone(i||{},!1);var o,a=t.parseUrl(n).domain;if(o=function(n){var i,o,s;return t.parseUrl((i=n,o="url",i&&(s=i[o],e.is(s,"function")&&(s=s.call(i))),s)).domain===a},e.is(a))return this.find(o)}})}),define("DS/W3DSpace/Models/InvitationModel",["UWA/Core","UWA/Class/Model","DS/W3DSpace/EnoviaBootstrap"],function(e,t,n){"use strict";return t.extend({defaults:{addoncommonspace:!1,sendemail:!1,givecreationright:!1,managevisibility:!1,hasreaderrole:!1,haspublicreaderrole:!1},idAttribute:"addoncommonspace",sync:function(t,i,o){return o=o?e.clone(o,!1):{},e.extend(o,n.getSyncOptions(),!0),this._parent.apply(this,[t,i,o])},url:function(){return n.getStorage().get("url")+"/resources/enocsmrest/admin/config"}})}),define("DS/W3DSpace/Views/CreateCSView",["UWA/Core","UWA/Element","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/UIKIT/Input/Select","DS/UIKIT/Input/Text","DS/UIKIT/Alert","UWA/Class/View","DS/WAFData/WAFData","DS/W3DSpace/EnoviaBootstrap","DS/W3DXComponents/Views/Item/LabelManagerView","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DSpace/assets/nls/W3DSpace","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,a,s,r,l,c,d,u,m){"use strict";var p,g;return r.extend({name:"createCS",tagName:"div",className:"create-cs-view",init:function(e){var t=UWA.clone(e,!1);["container","template","tagName","domEvents"].forEach(function(e){delete t[e]}),this._parent(t)},setup:function(){this.container.addClassName(this.getClassNames("-container")),this._initAlert(),this._initForm(),this._initListenKeyDown()},_initAlert:function(){var t={className:"create-alert",closable:!0,renderTo:document.body,autoHide:!0,visible:!0};this.elements.alertFailure=new s(e.extend({messageClassName:"error"},t)),this.elements.alertSuccess=new s(e.extend({messageClassName:"success"},t))},_initForm:function(){var t,a,s,r,h,f=this,S=(this.options,this.elements),v=S.alertFailure;var C=new d({domEvents:{"click .supp-icon":function(){this.container.getElement("form").show(),this.onClickSuppCalled.apply(this,arguments)}},categories:[{id:"mainOwner",name:m.mainOwner}],labelFormat:"{fname} {lname}",suggestKey:"login",placeholder:u.getUser().firstName+" "+u.getUser().lastName+m.get("placeholderTxt"),getSuggestions:function(t,n,i){var o,a,s=new RegExp("/session");t&&(h&&h.cancel(),n[t]?i(n[t]):(o=(o=(o=c.getStorage().get("url")).split(s)[0])+"/resources/enocsmrest/admin/peoples?filter="+t+"&limit=10",a=e.extend({type:"json",onComplete:function(e){i(e.peoples)}},c.getSyncOptions()),h=l.authenticatedRequest(o,a)))}}),D=C.addObject;C.addObject=function(e,t,n,i,o){o.hide(),D.apply(this,arguments)},t=[{type:"text",name:"title",required:!0,label:m.title,maxlength:"32",placeholder:m.placeholderTitle,pattern:'^((?!<)(?!>)(?!/)(?!\\\\)(?!:)(?!\\?)(?!\\*)(?!")(?!\\|)(?!@)(?!#)(?!\\$)(?!%)(?!,)(?!\\.)(?!\\;)(?!\\[)(?!\\]).)*$'},{type:"text",name:"description",label:m.description,maxlength:"128",placeholder:m.placeholderDescription}],p=new o({name:"family",nativeSelect:!1,placeholder:!1,className:"form-item",options:[{value:"DESIGNTEAM",label:m.design+" - "+m.designDetail,selected:!0},{value:"STANDARDTEAM",label:m.standard+" - "+m.standardDetail,disabled:!1}],events:{onChange:function(e){f.onCheckValue(e)}}}),g=new o({name:"visibility",nativeSelect:!1,placeholder:!1,options:[{value:"PRIVATE",label:m.private+" - "+m.privateDetail,selected:!0,disabled:!1},{value:"PROTECTED",label:m.protected+" - "+m.protectedDetail,disabled:!1},{value:"PUBLIC",label:m.public+" - "+m.publicDetail,disabled:!1}]}),a=new n({fields:t,events:{onSubmit:function(){f.onCreate()},onInvalid:function(e){},onValid:function(){}}}),s=new i({value:m.create,className:"primary",events:{onClick:this.dispatchAsEventListener("onCreate")}}),r=new i({value:m.cancel,events:{onClick:this.dispatchAsEventListener("onCancel")}}),S.form=[C.render(),a];var b=document.createElement("span");b.innerHTML=m.family,b.className="form__message-label",S.form.push(b,p);var w=document.createElement("span");w.innerHTML=m.visibility,w.className="form__message-label",S.form.push(w,g),S.create=s,S.cancel=r},getCreateButton:function(){return this.elements.create},getCancelButton:function(){return this.elements.cancel},getFormFirstInput:function(){return this.elements.form[0].container},_initListenKeyDown:function(){this.onKeyDown=this.onKeyDown.bind(this),document.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(e){if(13===e.keyCode)this.submitEnabled()&&this.onCreate();else if(27===e.keyCode){var t=document.createEvent("Event");t.initEvent("click",!0,!1),this.elements.cancel.elements.content.dispatchEvent(t)}},submitEnabled:function(){return null===this.elements.create.elements.content.getAttribute("disabled")},render:function(){var e=this.elements,t=e.form;e.create,e.cancel;return this.container.setContent([t,{tag:"div",class:"footer"}]),this},onCheckValue:function(e){"DESIGNTEAM"===e.target.value?(g.enable(0),g.enable(1),g.enable(2),g.setValue(0)):(g.enable(2),g.disable(0),g.disable(1),g.setValue(2))},onCreate:function(){var t,n=this.options,i=this.collection,o=(n.onComplete,n.onFailure),a=this.elements.form[1].getValue("title"),s=this.elements.form[0].getJsonObjects()[0]?this.elements.form[0].getJsonObjects()[0].selection:u.getUser().login,r=this.elements.alertFailure;if(a=a.trim(),this.elements.form[1].validate()&&0!==a.length&&0!==s.length)n.onFailure=function(t){i.remove(t),e.is(o)&&o.apply(void 0,arguments)},t={title:a,description:this.elements.form[1].getValue("description"),family:{value:p.getValue()[0]},visibility:{value:g.getValue()[0]},owner:{login:s}},this.collection.create(t,{onComplete:n.onComplete,onFailure:n.onFailure});else if(""===a)r.add({message:m.errorEmptyTitle});else{r.add({message:m.replace(m.errorCharacterTitle,{tag1:" \\ \" # $ @ % * , ; ? < > [ ] | : . '"})})}}})}),define("DS/W3DSpace/Views/InvitationView",["UWA/Drivers/Alone","UWA/Core","UWA/Class/View","DS/UIKIT/Alert","DS/UIKIT/Input/Toggle","DS/UIKIT/Input/Button","DS/W3DSpace/Models/InvitationModel","DS/W3DSpace/EnoviaBootstrap","DS/UIKIT/Scroller","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,a,s,r,l,c){"use strict";var d=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),u=new i({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"});return n.extend({init:function(e){var t=this;this._parent(e),this.model=new s,this.model.fetch({onFailure:function(){d.add({message:c.errorFetch})},onComplete:function(){t.CreateForm()}})},CreateForm:function(){this.containerview;var e=c.addUsersToCS+"Common Space";this.containerview=this.container.addClassName(this.getClassNames("-container")),this.addUsersToCSToggle=new o({type:"switch",value:"addUsersToCS",checked:this.model.get("addoncommonspace"),label:e}),this.givecreationrightToggle=new o({type:"switch",value:"givecreationright",checked:this.model.get("givecreationright"),label:c.givecreationright}),this.giveCreationtoXappsToggle=new o({type:"switch",value:"giveCreationtoXapps",checked:this.model.get("personalspaceavailable"),label:c.giveCreationtoXapps}),this.readerRoleToggle=new o({type:"switch",value:"readerRole",checked:this.model.get("hasreaderrole"),label:c.reader}),this.publicReaderRoleToggle=new o({type:"switch",value:"publicReaderRole",checked:this.model.get("haspublicreaderrole"),label:c.publicReader}),this.manageVisibilityRight=new o({type:"switch",value:"manageVisibility",checked:this.model.get("managevisibility"),label:c.visibility}),this.restrictedRoles=new o({type:"switch",value:"restrictedRoles",checked:this.model.get("hasrestrictedroles"),label:c.restrictedRoles}),this.leaderOwner=new o({type:"switch",value:"leaderOwner",checked:this.model.get("mergeprojectroles"),label:c.associateLeaderOwner});t.createElement("div",{class:"deployment-container",html:[{tag:"h4",text:c.deployementSection},this.addUsersToCSToggle,this.givecreationrightToggle,this.giveCreationtoXappsToggle]}).inject(this.containerview),t.createElement("div",{class:"roles-container",html:[{tag:"h4",text:c.rolesAvailability},this.readerRoleToggle,this.publicReaderRoleToggle,this.restrictedRoles,this.leaderOwner]}).inject(this.containerview),t.createElement("div",{class:"visibility-container",html:[{tag:"h4",text:c.manageVisibility},this.manageVisibilityRight]}).inject(this.containerview),t.createElement("div",{class:"footer",html:[new a({value:c.cancel,className:"pull-right default",events:{onClick:this.dispatchAsEventListener("onCancel")}}),new a({value:c.save,className:"pull-right primary",events:{onClick:this.dispatchAsEventListener("onSave")}})]}).inject(this.containerview),new l({element:this.containerview});return this.containerview},onSave:function(){var e=this;e.model.save({addoncommonspace:e.addUsersToCSToggle.isChecked(),givecreationright:e.givecreationrightToggle.isChecked(),personalspaceavailable:e.giveCreationtoXappsToggle.isChecked(),haspublicreaderrole:e.publicReaderRoleToggle.isChecked(),hasreaderrole:e.readerRoleToggle.isChecked(),managevisibility:e.manageVisibilityRight.isChecked(),hasrestrictedroles:e.restrictedRoles.isChecked(),mergeprojectroles:e.leaderOwner.isChecked()},{onFailure:function(){e.onCancel(),d.add({message:c.errorSave})},onComplete:function(){u.add({message:c.successSave})}})},onCancel:function(){1==this.model.get("addoncommonspace")?this.addUsersToCSToggle.check():this.addUsersToCSToggle.uncheck(),1==this.model.get("givecreationright")?this.givecreationrightToggle.check():this.givecreationrightToggle.uncheck(),1==this.model.get("personalspaceavailable")?this.giveCreationtoXappsToggle.check():this.giveCreationtoXappsToggle.uncheck(),1==this.model.get("hasreaderrole")?this.readerRoleToggle.check():this.readerRoleToggle.uncheck(),1==this.model.get("haspublicreaderrole")?this.publicReaderRoleToggle.check():this.publicReaderRoleToggle.uncheck(),1==this.model.get("managevisibility")?this.manageVisibilityRight.check():this.manageVisibilityRight.uncheck(),1==this.model.get("hasrestrictedroles")?this.restrictedRoles.check():this.restrictedRoles.uncheck(),1==this.model.get("mergeprojectroles")?this.leaderOwner.check():this.leaderOwner.uncheck()}})}),define("DS/W3DSpace/Views/ModalCreateCS",["UWA/Core","UWA/Controls/Abstract","DS/UIKIT/Modal","DS/W3DSpace/Views/CreateCSView","DS/UIKIT/Alert","i18n!DS/W3DSpace/assets/nls/W3DSpace"],function(e,t,n,i,o,a){"use strict";return t.extend({init:function(t){var s,r,l,c,d,u,m=this,p={className:"create-alert",closable:!0,renderTo:document.body,autoHide:!0,visible:!0};t=e.clone(t||{},!1),this._parent(t),s=e.clone(t.events||{},!1),r=t.onComplete,l=t.onFailure,c=s.onCancel,this.elements.alertFailure,this.elements.alertSuccess,this.elements.alertWarning,u=function(){document.removeEventListener("keydown",d.onKeyDown),d.remove(),m.destroy()},s.onCancel=function(){u(),e.is(c)&&c.apply(this,arguments)},t.events=s,t.onComplete=function(t){u(),m.elements.alertSuccess=new o(e.extend({messageClassName:"success"},p)),m.elements.alertSuccess.add({message:a.replace(a.successCreate,{tag1:t.get("title")})}),e.is(r)&&r.apply(void 0,arguments)},t.onFailure=function(t){"The request has timedout after 25000ms"===arguments[1]?(u(),m.elements.alertWarning=new o(e.extend({messageClassName:"warning"},p)),m.elements.alertWarning.add({message:a.replace(a.CScreateTimeout,{tag1:t.get("title")})}),e.is(l)&&l.apply(void 0,arguments)):(u(),m.elements.alertFailure=new o(e.extend({messageClassName:"error"},p)),m.elements.alertFailure.add({message:a.replace(a.errorCreateCS,{tag1:t.get("name")})}),e.is(l)&&l.apply(void 0,arguments))},d=new i(t),this.elements.modal=new n({closable:!1,className:"modalCreateCS",header:a.createTitle,form:d,body:d.render(),footer:[d.getCreateButton(),d.getCancelButton()]})},show:function(){var e=this.elements.modal;e.inject(document.body),e.show(),e.options.form.getFormFirstInput().focus()}})}),define("DS/W3DSpace/Views/ModalChangeOwner",["UWA/Drivers/Alone","UWA/Controls/Abstract","UWA/Core","DS/WAFData/WAFData","UWA/Controls/Input","DS/UIKIT/Alert","DS/UIKIT/Modal","DS/UIKIT/Input/Button","DS/W3DSpace/EnoviaBootstrap","UWA/Class/Collection","DS/W3DXComponents/Views/Item/LabelManagerView","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter"],function(e,t,n,i,o,a,s,r,l,c,d,u){"use strict";var m=null,p=new a({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),g=new a({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}),h=new a({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"});return t.extend({init:function(e){this._parent(e),this.resetModal(),this.model=e.model,this._selectedOwner=null},showModal:function(){this.modal.inject(document.body),this.modal.show()},getBody:function(){this.labelManager=new d({domEvents:{"click .supp-icon":function(){this.container.getElement("form").show(),this.onClickSuppCalled.apply(this,arguments)}},categories:[{id:"mainOwner",name:u.labelMainOwner}],labelFormat:"{fname} {lname}",suggestKey:"login",placeholder:u.placeholderTxt,getSuggestions:function(e,t,o){var a,s,r=new RegExp("/session");e&&(m&&m.cancel(),t[e]?o(t[e]):(a=(a=(a=l.getStorage().get("url")).split(r)[0])+"/resources/enocsmrest/admin/peoples?filter="+e+"&limit=10",s=n.extend({type:"json",onComplete:function(e){o(e.peoples)}},l.getSyncOptions()),m=i.authenticatedRequest(a,s)))}});var e=this.labelManager.addObject;return this.labelManager.addObject=function(t,n,i,o,a){a.hide(),e.apply(this,arguments)},this.labelManager.render().getContent()},getFooter:function(){var e=this;return[new r({value:u.save,className:"primary",events:{onClick:function(){e.onSaveCalled()}}}),new r({value:u.cancel,className:"default",events:{onClick:function(){e.onCancelCalled()}}})]},onSaveCalled:function(){var e=this.labelManager.getJsonObjects()[0];if(e){var t=this.model,n=e.selection,i=t.get("owner");t.save({title:t.get("title"),owner:{login:n}},{onFailure:function(e){p.add({message:u.errorChangeOwner}),e.set("owner",i)},onComplete:function(){h.add({message:u.replace(u.successChangeOwner,{tag1:t.get("owner").name})})},onTimeout:function(){g.add({message:u.ChangeOwnerTimeout})}}),this.modal.destroy(),this.resetModal()}},onCancelCalled:function(){this.modal.destroy(),this.resetModal()},resetModal:function(){this.modal=new s({className:"changeowner",closable:!0,header:u.modalHeader,body:this.getBody(),footer:this.getFooter()})},onDestroy:function(){this.alert.destroy()}})}),define("DS/W3DSpace/SkeletonUtils/W3DSpaceControlCenterSkeletonOptions",["UWA/Core","DS/UIKIT/Alert","UWA/Class/Model","DS/W3DXComponents/ContentSet","DS/W3DXComponents/MemberSet","DS/W3DXComponents/Skeleton","DS/W3DSpace/Collections/AdminCollabSpacesCollection","DS/W3DSpace/Collections/AdminPeopleCollection","DS/W3DXComponents/Views/Layout/GridScrollView","DS/W3DXComponents/Views/Item/TileView","DS/W3DSpace/Views/ModalChangeOwner","DS/W3DSpace/Views/InvitationView","DS/UIKIT/Form","DS/UIKIT/Input/Button","DS/W3DSpace/Views/ModalCreateCS","DS/W3DSpace/Views/ModalDisplaySecurityContexts","DS/W3DSpace/Views/ManageMembers","DS/W3DSpace/Collections/CSMembers","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/Utils/Metrics","UWA/Core","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/W3DSpace/Views/ModalEditVisibility","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter"],function(e,t,n,i,o,a,s,r,l,c,d,u,m,p,g,h,f,S,v,C,D,b,w,y){"use strict";var W=new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),A=new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!0,messageClassName:"success"}),I=l.extend({onRender:function(){this._parent.apply(this,arguments)},setup:function(e){var t=this._externalEvents={onSearch:function(){this.reload()},onSearchReset:function(){this.reload()}};return this.collection&&this.listenTo(this.collection,t),this._parent.apply(this,arguments)},destroy:function(e){if(!this.isDestroyed)return this.collection&&this.stopListening(this.collection,this._externalEvents),this._parent.apply(this,arguments)},reload:function(){this.container.addClassName("loading");var e=this;e.collection.state.totalRecords=null;var t={reset:!0,type:"json",onComplete:function(){e.container.offsetParent&&(e.scrollView.elements.infinitearea.show(),e.scrollView.elements.infiniteareaLoader.hide(),e.scrollView.endLoading())},onFailure:function(){}};e.collection.getFirstPage(t)}}),U=I.extend({onRender:function(){var e=new p({value:y.createCS,icon:"fonticon fonticon-3x fonticon-logo-3dspace-add fix-alignement",className:"primary btn-ncs",events:{onClick:function(){T({eventAction:"createCS",model:this,tenant:this.options.config.selectedStorage.get("id")}),new g({collection:this.collection}).show()}.bind(this)}}),t=document.createElement("div"),n=document.createElement("div");t.classList.add("tile-container"),t.classList.add("with-actions"),n.classList.add("tile-sub-container"),t.appendChild(n),n.appendChild(e.getContent()),this.scrollView.view.container.setHTML(t),this._parent.apply(this,arguments)}});function T(e){return C.trackAction(Object.assign(e,{model:e.model}))}function E(){var t=this,n=this.collection,i={onComplete:function(){t.container.offsetParent&&(t.scrollView.elements.infinitearea.show(),t.scrollView.elements.infiniteareaLoader.hide(),t.scrollView.endLoading())},onFailure:function(){W.add({message:y.errorFetch})}};null===n.state.totalRecords?n.getFirstPage(i):n.hasNextPage()?n.getNextPage(e.extend(i,{remove:!1,reset:!1})):(t.scrollView.elements.infinitearea.show(),t.scrollView.elements.infiniteareaLoader.hide())}return{getRootIdCardOptions:function(e){return{root:"admincollabspaces",rootIdCardOptions:{model:new(n.extend({urlRoot:function(){return e.selectedStorage.get("url")+"/resources/enocsmrest"}})),facets:[{name:"admincollabspaces",text:y.manageCollabSpaces,icon:"doc-text",handler:a.getRendererHandler("admincollabspaces")},{name:"adminmembers",text:y.managePermissions,icon:"users",handler:a.getRendererHandler("adminmembers")},{name:"invitation",text:y.invitation,icon:"cog",handler:a.getRendererHandler(u)}]}}},getInfos:function(e){return e},getRendererMap:function(e){return{adminmembers:{collection:r,fetchMode:"never",view:I,viewOptions:{className:"members-facet",selectionMode:!1,useInfiniteScroll:!0,usePullToRefresh:!0,itemView:c,itemViewOptions:{mapping:{title:function(){return this.model.get("name")},image:function(){return this.model.get("picture").split("redirect=")[1]},subtitle:function(){return this.model.get("createcs")?'<div class="allowed">'+y.allowed+"</div>":y.notAllowed},content:"email"},contextualActions:function(){var e=[];return e.push({text:y.credentials,fonticon:"fonticon fonticon-info",handler:function(e){new h({model:e.model})}}),this.get("createcs")?this.get("isadmin")||e.push({text:y.denyCreation,fonticon:"block",handler:function(e){e.model.save({login:e.model.get("login"),createcs:!1},{onFailure:function(e){W.add({message:y.errorDenyCreation}),e.set("createcs",!0)},onComplete:function(){A.add({message:y.successDenyCreation})}})}}):e.push({text:y.allowCreation,fonticon:"pencil",handler:function(e){e.model.save({login:e.model.get("login"),createcs:!0},{onFailure:function(e){W.add({message:y.errorAllowCreation}),e.set("createcs",!1)},onComplete:function(){A.add({message:y.successAllowCreation})}})}}),e}},events:{onInfiniteScroll:E}}},admincollabspaces:{className:"loading",collection:s,fecthMode:"never",view:U,viewOptions:{selectionMode:!1,config:e,useInfiniteScroll:!0,usePullToRefresh:!0,itemView:c,itemViewOptions:{mapping:{title:"title",subtitle:"owner.name",image:"thumbnail",content:function(){var e,t;return e=this.model.get("visibility").name?this.model.get("visibility").name:this.model.get("visibility").value,(t=this.model.get("description"))&&(e+="<br/>"+t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),e}},contextualActions:function(){var t=[],n=this.get("actions");if(n)for(var i=0;i<n.length;i++)"edit.visibility"===n[i]&&t.push({text:y.editVisibility,fonticon:"pencil",handler:function(t){var n=e.selectedStorage;T({eventAction:"editVisibility",model:t.model,tenant:n.get("id")}),new w({model:t.model}).show()}}),"edit.owner"===n[i]&&t.push({text:y.changeOwner,fonticon:"fonticon fonticon-user-key",handler:function(t){var n=e.selectedStorage;T({eventAction:"editOwner",model:t.model,tenant:n.get("id")}),new d({model:t.model}).showModal()}}),"add.members"===n[i]&&t.push({text:y.manageMembers,fonticon:"fonticon fonticon-user-cog fonticon-clickable",handler:function(t){var n=e.selectedStorage,i=t.model;b.getPlatformServices({platformId:n.id,onComplete:function(e){e&&(i._auth={platformId:n.id,platform:{id:e.platformId,displayName:e.displayName,url:e["3DDrive"],urlSwym:e["3DSwym"],url3DSpace:e["3DSpace"],urlUsersGroup:e.usersgroup,urls3DSearch:e["3DSearch"],urlDrivesHub:e.driveshub,urlDashboard:e["3DDashboard"],urlDfcs:e.distributedfilestore,urlPassport:e["3DPassport"]},getStorage:function(){return{id:e.platformId,displayName:e.displayName,url:e["3DDrive"],urlSwym:e["3DSwym"],url3DSpace:e["3DSpace"],urlUsersGroup:e.usersgroup,urls3DSearch:e["3DSearch"],urlDrivesHub:e.driveshub,urlDashboard:e["3DDashboard"],urlDfcs:e.distributedfilestore,urlPassport:e["3DPassport"]}}})}}),T({eventAction:"manageMembers",model:t,tenant:n.get("id")}),(new f).managememberClick({model:t,config:e.selectedStorage})}});return t}},events:{onInfiniteScroll:E}}}}}}}),define("DS/W3DSpace/W3DSpaceControlCenter",["UWA/Core","DS/UIKIT/Alert","DS/W3DSpace/Collections/CollabStorageCollection","DS/W3DXComponents/Skeleton","DS/W3DSpace/EnoviaBootstrap","DS/W3DSpace/SkeletonUtils/W3DSpaceControlCenterSkeletonOptions","DS/PlatformAPI/PlatformAPI","i18n!DS/W3DSpace/assets/nls/W3DSpaceControlCenter","css!DS/W3DSpace/W3DSpace.css"],function(e,t,n,i,o,a,s,r){"use strict";var l,c,d,u,m,p=!1,g=!1;function h(){c&&c.destroy(),o.getStorage().get("isadmin")?(c=new i(a.getRendererMap({selectedStorage:m}),a.getRootIdCardOptions({selectedStorage:m}))).render().inject(widget.body.getElement("#controlcenter-widget-content")):l.add({message:r.errorAdminRights,className:"error"})}function f(e,n){if(e){var i,o={type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[],onchange:"onStorageChange"},a=widget.getValue("collab-storage");if(""===a){var c=widget.getValue("x3dPlatformId");if(c){if(!(i=e.get(c)))return void new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"warning"}).add({message:r.replace(r.undefinedStorage,{tag1:widget.getValue("x3dPlatformId")})});widget.setValue("collab-storage",i.id),widget.setValue("tenantAware",!0)}else i=e.at(0)}else i=e.get(a);return e.forEach(function(e){var t,n;n=e.get("displayName").unescapeHTML(),t=e.get("id"),o.options.push({label:n,value:t})}),1===e.length&&i&&(o.type="hidden"),widget.addPreference(o),g&&(widget.dispatchEvent("onEdit",["refreshPrefs"]),i||(i=e.at(0))),i?(widget.setTitle(i.get("displayName")),widget.setValue("x3dPlatformId",i.get("id")),d.onStorageChange("collab-storage",i.id,n)):l.add({message:r.updatePreference,className:"warning"}),s.subscribe("PlatformManagement.renamePlatformName",function(e){widget.setTitle(e),i.set("displayName",e)}),m=i,i}}return d={onLoad:function(){o.start({id:widget.id,collection:u}),widget.setBody([{tag:"div",id:"controlcenter-widget-content"}]),l=new t({className:"csg-alert",closable:!0,renderTo:document.body,visible:!0,autoHide:!1,messageClassName:"error"}),u.fetch({onComplete:function(e,t,n){f.call(void 0,e,h)},onFailure:function(e){l.add({message:r.errorFetchStorages,className:"error"})}})},onRefresh:function(){f.call(void 0,u,h)},onEdit:function(e){if(g=!0,"refreshPrefs"!==e){widget.addPreference({type:"list",name:"collab-storage",label:"3DEXPERIENCE Platform",options:[{label:"Loading",value:""}],onchange:"onStorageChange"}),widget.dispatchEvent("onEdit",["refreshPrefs"]),u.fetch({onComplete:function(e,t,n){f.call(void 0,e)}})}},endEdit:function(e){g=!1},onStorageChange:function(e,t,n){var i=u.get(t),a={onComplete:n,onFailure:function(e){l.add({message:e&&e.error&&e.error.message?e.error.message:r.errorFetch,className:"error"})}};o.onStorageChange(i,a)}},function(){if(!p){if(!widget)throw new Error("W3DSpace must be executed in a widget environement");u=new n,p=!0}}(),d});