define("DS/W3DXTimeline/Timeline",["UWA/Core","UWA/Class/View","i18n!DS/W3DXTimeline/assets/nls/feed","css!W3DXTimeline/W3DXTimeline.css"],function(e,t,i){"use strict";UWA.log("Timeline - Add");var s=t.extend({tagName:"div",className:"w3dxtimeline",setup:function(e){this._createContent()},_createContent:function(){this.model.get("url");var e=this.model.get("text"),t=this.model.get("img"),i=this.model.get("pictureSize"),s=this.model.get("user").login;i||(i="48px"),this.setContainer({tag:"div",class:"TL-item-view",html:[{tag:"div",class:"TL-picture-view",html:[{tag:"img",src:t,height:i,width:i,"data-login":s}]},{tag:"div",class:"TL-text-view",html:[{tag:"span",html:decodeURIComponent(encodeURIComponent(e))}]}]})}}),n=t.extend({tagName:"div",className:"w3dxtimeline",defaultOptions:{title:""},setup:function(e){this.listOfItems={},this.title=e.title?e.title:this.options.title,this.setContainer({tag:"div",class:"TL-section",html:[{tag:"div",Class:"TL-section-name",text:this.title},{tag:"div",class:"TL-section-list-item",html:[{tag:"div",class:"TL-section-item"}]}]})},add:function(e,t,i){var s=this.container.getElement(".TL-section-item"),n=new Date(e.model.get("date")).strftime("%H:%M"),a=e.model.get("removeTime"),o=e.model.get("removeCircle"),l=e.model.get("pictureSize"),r=UWA.createElement("div",{class:"TL-item",html:[{tag:"div",class:"TL-time-item",html:[{tag:"div",class:"TL-time-item-txt",text:n}]},{tag:"div",class:"TL-section-line",html:[{tag:"div",class:"TL-cirlce-item",html:[{tag:"div",class:"TL-time-item-cirlce"}]}]},{tag:"div",class:"TL-content-view",styles:{width:"100%"},html:e.container}]});if(l){var c=parseInt(l.replace("px","")),m=r.getElement(".TL-time-item-cirlce"),d=r.getElement(".TL-time-item-txt");m&&(m.style["margin-top"]=c/2+"px"),d&&(d.style["margin-top"]=c/2-2+"px")}a&&r.getElement(".TL-time-item").destroy(),o&&r.getElement(".TL-section-line").destroy();var h=!1;if(i)r.inject(s,"top"),h=!0;else for(var f in this.listOfItems){if(new Date("2016-01-01T"+f+":00.000Z")<new Date("2016-01-01T"+n+":00.000Z")){r.inject(this.listOfItems[f].textView,"before"),h=!0;break}}h||r.inject(s),this.listOfItems[n]={textView:r};var g=r.clientHeight+2;if(new UWA.Fx(r,{duration:400,transition:"backOut",events:{onComplete:function(){r.style.height="auto"}}}).start({height:["0px",g+"px"]}),!o){m=r.getElement(".TL-time-item-cirlce"),d=r.getElement(".TL-time-item-txt");var v=r.getElement(".TL-cirlce-item");t[e.id]={alert:e,timeView:d,circleView:m,textView:r};var u=this;if(e.model.get("starredState")){var p=v.getElement(".fonticon");1===v.children.length&&(p=UWA.createElement("div",{class:"fonticon fonticon-favorite-on",styles:{color:"rgb(54, 142, 196)","font-size":"16px","margin-top":"18px","margin-left":"-8px"}}).inject(v)),p.style.display="block",m.style.display="none",e.model.get("readState")?(p.removeClassName("fonticon-favorite-on"),p.addClassName("fonticon-favorite-off")):(p.removeClassName("fonticon-favorite-off"),p.addClassName("fonticon-favorite-on"))}else e.model.get("readState")?(m.style.background="",d.style.opacity="0.6"):m.style.background="#368ec4";e.model.addEvent("read",function(e){var i=v.getElement(".fonticon");t[e.id].alert.model.get("starredState")?e.read?(i.removeClassName("fonticon-favorite-on"),i.addClassName("fonticon-favorite-off")):(i.removeClassName("fonticon-favorite-off"),i.addClassName("fonticon-favorite-on")):e.read?"0.6"==d.style.opacity?e.flag=!0:(e.flag=!1,m.style.background="",d.style.opacity="0.6"):(m.style.background="#368ec4",d.style.opacity="1"),this.dispatchEvent("readCenter",e)}),e.model.addEvent("delete",function(e){r.destroy(),u.container.getElement(".TL-item")||u.container.destroy(),this.dispatchEvent("deleteCenter",e)}),e.model.addEvent("unsubscribe",function(e){m.style.background="",d.style.opacity="0.6",this.dispatchEvent("unsubscribeCenter",e)}),e.model.addEvent("deleteView",function(e){r.destroy()}),e.model.addEvent("unreadMerge",function(e){m.style.background="#368ec4",d.style.opacity="1"}),e.model.addEvent("starred",function(e){var i=t[e.id].alert.model.get("readState");if(e.starred){if(1===v.children.length)s=UWA.createElement("div",{class:"fonticon fonticon-favorite-on",styles:{color:"rgb(54, 142, 196)","font-size":"16px","margin-top":"18px","margin-left":"-8px"}}).inject(v);if(!s)s=v.getElement(".fonticon");s.style.display="block",m.style.display="none",i?(s.removeClassName("fonticon-favorite-on"),s.addClassName("fonticon-favorite-off")):(s.removeClassName("fonticon-favorite-off"),s.addClassName("fonticon-favorite-on"))}else{var s=v.getElement(".fonticon");i?(s.style.display="none",m.style.display="block",m.style.background="",m.style.border="2px solid #368ec4"):(s.style.display="none",m.style.display="block",m.style.background="#368ec4",m.style.border="2px solid #368ec4")}this.dispatchEvent("starredCenter",e)})}},inject:function(e,t){this.container.inject(e,t)}});return t.extend({tagName:"div",className:"TL-main-view",defaultOptions:{itemView:s,language:"en",pictureSize:"48px",removeTime:!1,removeCircle:!1},setup:function(e){var t=this;this.isInject=!1,this.section={},this.alertlist=[],this.itemView=e.itemView?e.itemView:this.options.itemView,this.language=e.language?e.language:this.options.language,this.pictureSize=e.pictureSize?e.pictureSize:this.options.pictureSize,this.removeTime=e.removeTime?e.removeTime:this.options.removeTime,this.removeCircle=e.removeCircle?e.removeCircle:this.options.removeCircle,this.listenTo(this.collection,"onAdd",this.add),this.listenTo(this.collection,"onAfterPageChange",this.onAfterPageChange),this.addEvent("updatePicture",function(e){t.alertlist[e.notifID]&&t.alertlist[e.notifID].alert&&t.alertlist[e.notifID].alert.dispatchEvent("updatePicture",[{src:e.src}])})},onAfterPageChange:function(e,t){UWA.log("Timeline - onAfterPageChange")},markAll:function(e){for(var t in this.alertlist)this.alertlist[t]&&this.alertlist[t].alert&&(this.alertlist[t].alert.setReadstate(e.read),this.alertlist[t].alert.mergeList&&this.alertlist[t].alert.mergeList.forEach(function(t){t.setReadstate(e.read)},this),e.read?(this.alertlist[t].circleView.style.background="",this.alertlist[t].timeView.style.opacity="0.6"):(this.alertlist[t].circleView.style.background="rgb(54, 142, 196)",this.alertlist[t].timeView.style.opacity="1"))},getSectionName:function(e){var t=new Date,s=void 0,n=t.getDate(),a=e.getDate(),o=t.strftime("%Y-%m-%d"),l=e.strftime("%Y-%m-%d"),r=t.strftime("%m"),c=e.strftime("%m"),m=t.strftime("%Y"),d=e.strftime("%Y");if(o===l&&(s=i.today||"today"),n===a+1&&r===c&&m===d&&(s=i.yesterday||"yesterday"),!s){var h=this.language;h||(h=window.navigator.language);e.toLocaleString(h,{month:"short"}),e.strftime("%d");s=e.toLocaleString(h,{weekday:"short",year:"numeric",month:"short",day:"2-digit"})}return s},add:function(e,t){if(this.isInject&&""!=e.get("text").trim()){UWA.log("Timeline - Add");var i=e.get("date");e.get("pictureSize")||e.set("pictureSize",this.pictureSize),e.get("removeTime")||e.set("removeTime",this.removeTime),e.get("removeCircle")||e.set("removeCircle",this.removeCircle);var s=new Date(i),n=this.getSectionName(s);if(n&&(this.section[n]||this.buildSection({sectionName:n,date:s},t),this.section[n])){var a=new this.itemView({model:e});this.section[n].section.add(a,this.alertlist,t)}}},buildSection:function(e,t){var i=new n({title:e.sectionName.toUpperCase()}),s=!1;for(var a in this.section)if(this.section[a].date<e.date){t?i.inject(this.container,"top"):i.inject(this.section[a].section,"before"),s=!0;break}if(!s){if(this.removeTime)i.container.getElement(".TL-section-name").style["margin-left"]="0px";i.inject(this.container)}this.section[e.sectionName]={section:i,date:e.date}},inject:function(e){this.isInject=!0,this.container.inject(e);for(var t=0;t<this.collection.size();t++)this.add(this.collection.at(t))},deleteView:function(e){this.alertlist[e.id].textView.destroy(),this.container.getElement(".TL-item")||this.container.destroy(),delete this.alertlist[e.id]}})});