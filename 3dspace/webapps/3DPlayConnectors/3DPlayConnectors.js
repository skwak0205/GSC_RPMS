define("DS/3DPlayConnectors/3DPlayInputPreProcessor",["UWA/Core","DS/WebUtils/StringUtils","DS/WebSystem/Environment","DS/3DPlaySupport/ExperiencesList","DS/3DPlaySupport/SupportList","DS/WebUtils/ProbesManager","DS/3DPlaySupport/XCADSpatialSupportedFormats","DS/WebUtils/Tracker"],function(e,t,r,n,i,o,s,a){"use strict";return function(){var n="",l=function(e,r,u){var c={error:{NLS_ID:"BadUrl"}};if(Array.isArray(e)||"function"==typeof e||null==e)u(c,r);else{if("string"==typeof e?((c={}).filename=e,c.provider="FILE"):"object"==typeof e&&"object"==typeof e.asset?(c={},c=e.asset):"object"==typeof e&&"string"==typeof e.asset?((c={}).filename=e.asset,c.provider="FILE"):c=e||c,c.provider=(c.provider||"FILE").toUpperCase(),"FILE"===c.provider){if(void 0===c.filename||null===c.filename)c.error={NLS_ID:"BadUrl"};else if(void 0!==c.format&&null!==c.format&&"string"==typeof c.format)c.mimetype=c.format.toLowerCase();else{var d=t.getExtension(c.filename);c.mimetype=""===d?"3dxml":d.toLowerCase(),!s[c.mimetype]&&c.url&&(c.serverurl="",c.filename=c.url)}c.format=c.mimetype,c.type=c.mimetype}else if("BUFFER"===c.provider)(void 0===c.dataFormat||null===c.dataFormat||""===c.dataFormat||"string"!=typeof c.dataFormat&&"svg"!=typeof c.dataFormat)&&(c=null),c.type=c.dataFormat;else if("EV6"===c.provider||"3DSPACE"===c.provider||"GEOVIA"===c.provider||"EV5"===c.provider){if(void 0===c.physicalid||null===c.physicalid||""===c.physicalid||"string"!=typeof c.physicalid||void 0===c.serverurl||null===c.serverurl||""===c.serverurl||"string"!=typeof c.serverurl)void 0!==c.physicalid&&null!==c.physicalid&&""!==c.physicalid&&"string"==typeof c.physicalid||a.trackPageEvent("errors","initialization","physicalid"),void 0!==c.serverurl&&null!==c.serverurl&&""!==c.serverurl&&"string"==typeof c.serverurl||a.trackPageEvent("errors","initialization","serverurl"),c.error={NLS_ID:"BadUrl"};else if(void 0===c.dtype||null===c.dtype||""===c.dtype||"string"!=typeof c.dtype){var D={};D[c.dtype]=1,a.trackPageEvent("errors","initialization","DeFaUltDtYpE",0,D),c.dtype="DeFaUltDtYpE"}c.type=c.dtype}var v=c._3DPlayDatas&&c._3DPlayDatas.externalDrive||"DROPBOX"===c.provider||"GOOGLE"===c.provider||"ONEDRIVE"===c.provider||c.filename&&c.filename.includes("driveshub")&&c.filename.includes("drive/v1/")||c.requestsOptions&&c.requestsOptions.authentication&&c.requestsOptions.authentication.Adapter&&c.requestsOptions.authentication.Adapter.options&&c.requestsOptions.authentication.Adapter.options.provider;null!=v&&(c._3DPlayDatas=c._3DPlayDatas||{},c._3DPlayDatas.externalDrive=v),c.type=c.type||c.dataFormat||c.dtype,n===c.provider+"-"+c.type?u(c,r):function(e,t,r,s){var a,l;if(null!==e&&(null===e.error||void 0===e.error)){var u=function(n){var u=function(n){if(e&&e.tenant&&(n.tenant=e.tenant),void 0!==e._3DPlayDatas&&null!==e._3DPlayDatas&&(n._3DPlayDatas=e._3DPlayDatas),n){var i,o,a,l=null;e&&(l=e.originalAsset||e,i=e.swymAttr,o=e.swymServerToken,a=e.driveAttr),n.asset?(n.asset.originalAsset=l,i&&(n.asset.swymAttr=i),o&&(n.asset.swymServerToken=o),a&&(n.asset.driveAttr=a)):(n.originalAsset=l,i&&(n.swymAttr=i),o&&(n.swymServerToken=o),a&&(n.driveAttr=a))}r(n,t,s)},c=function(r){e.error=r,s(e,t)};"string"==typeof n?require([n],o.createFunctionProbe("Connector_Require",function(t){(n=i[a][l].connector=new t).open(e,o.createFunctionProbe("Connector_Finished",u),c)}),function(){c({NLS_ID:"Preproc_REQUIRE_FAIL"})}):n.open(e,o.createFunctionProbe("Connector_Finished",u),c)},c=i[e.provider];if(c){if(a=e.provider,c.connector)return void u(c.connector);if(c.resolveParenting)return void c.resolveParenting(e,function(r){if(null!=r&&null!==c[r]&&void 0!==c[r]){var n=c[l=r].connector;if(n)return void u(n)}s(e,t)});l=e.type;var d=c[l]?c[l].connector:void 0;if(d)return n=e.provider+"-"+e.type,void u(d)}}s(e,t)}(c,r,l,u)}},u=function(e,t){var r=[null];if(null!=e){Array.isArray(e)?e.length>0&&(r=e):(r=new Array).push(e);for(var n=0,i=function(e,i){r[i]=e,++n===r.length&&t(r)},o=0;o<r.length;o++)l(r[o],o,i)}else t(r)};this.run=function(t,i){var o={asset:null};r.isSet("3DPlay.Debug")&&console.log("3DPlay.Debug:3DPlayInputPreProcessor.run",t);var s=window.localStorage["3DPlay.OverrideSettings"];if(void 0!==s){console.warn("!! 3DPlay OverrideSetting variable environment Active"),console.warn("Current inputs :"+JSON.stringify(t));try{(s=JSON.parse(s))&&(console.warn("Found inputs :"+JSON.stringify(s)),t=e.extend(t,s.input,!0))}catch(e){console.error("Override failed : JSON.parse error"+e)}console.warn("Resulting inputs :"+JSON.stringify(t))}if(null!=t&&!1===e.equals({},t)&&(!Array.isArray(t)||t.length>0))if("object"==typeof t&&!0===t.preProcessed)o=t;else{var a=function(e){n="",1===e.length?o.asset=e[0]:o.asset=e,o.preProcessed=!0,i(o)};if("object"!=typeof t||!(t.asset||t.experience||t.usage))return void u(t,a);if(o=t,void 0!==t.asset&&null!==t.asset&&!1===e.equals({},t.asset)&&(!Array.isArray(t.asset)||t.asset.length>0))return void(Array.isArray(t.asset)?u(t.asset,a):l(t.asset,0,a));o.asset=null}o.preProcessed=!0,i(o)}}}),define("DS/3DPlayConnectors/CAT3DPlayConnector",["UWA/Class"],function(e){"use strict";return e.extend({init:function(e){this._parent(e)},getName:function(){return this.name||"Connector"},open:function(e,t,r){console.warn("Use of abstract connector.");try{t(e)}catch(e){console.log(e),r()}}})}),define("DS/3DPlayConnectors/ErrorManagement",["DS/3DPlay/3DPlay","i18n!DS/3DPlay/assets/nls/3DPlay"],function(e,t){"use strict";var r={"Cannot display document as multiple files are attached.":"Document_Multiple","Cannot display document as no files are attached.":"Document_No_File","An error occurred while downloading the file.":"Error_Downloading"},n=function(i,o){if(!o)return!1;if(i&&i.NLS_ID)return i.NLS_File_JS?require([i.NLS_File_JS],function(t){e.displayFatalError({ctx:o,msg:t[i.NLS_ID],error:i.NLS_ID})}):e.displayFatalError({ctx:o,msg:t[i.NLS_ID],error:i.NLS_ID}),!0;if("string"==typeof i){var s=r[i];if(s)return n({NLS_ID:s},o)}return console.error("Unknown error format or error"),!1};return n}),define("DS/3DPlayConnectors/SVGConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WebSystem/Settings","DS/WebUtils/Network"],function(e,t,r){"use strict";var n,i;return e.extend({init:function(e){this._parent(e)},open:function(e,t,o){n=t,i=function(e){o(e)},function(e){var t=e.filename||e.url,o={method:"GET",authentication:"passport",proxy:"none",timeout:72e5,requestsOptions:{proxy:"none"},onComplete:function(e){n({data:e,dataFormat:"svg",provider:"BUFFER"})},onCancel:function(e){console.log("Error: "+e),i({NLS_ID:"LoadingDocumentError"})},onFailure:function(e){console.log("Error: "+e),i({NLS_ID:"LoadingDocumentError"})}};r.handleRequest(t,o)}(e)}})}),define("DS/3DPlayConnectors/OneDriveConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,r){"use strict";return e.extend({init:function(e){this._parent(e),this.xOneDriveId=null,this.currentDataTitle=null,this.xOneDriveParentUri1="/drive/v1/onedrive/contents/",this.xOneDriveParentUri2="/stream?xrequestedwith=xmlhttprequest",this.monoFileUri=null,this.assemblyUri=null,this.onFailCB=null,this.connectorsOnSuccessCB=null},open:function(e,t,r){var n=this;this.rawAsset=e,this.xOneDriveId=e.physicalid,this.onFailCB=r,this.connectorsOnSuccessCB=t,this._startOneDriveBusinessExpand(e,e.serverurl||!1,function(e){n._returnNewOneDriveAsset(e,t)})},_setOneDriveWSUri:function(e,t){var r=t[0].url,n=e.physicalid;this.metaDataWsUri=r+this.xOneDriveParentUri1+n,this.monoFileUri=r+this.xOneDriveParentUri1+n+this.xOneDriveParentUri2,this.assemblyUri=this.monoFileUri},_getOneDriveServiceURL:function(e,t){var n=this;r.getServiceUrl({serviceName:"driveshub",platformId:e,onComplete:function(e){t(e)},onFailure:function(){n.onFailCB("Error in  OneDriveConnector._getOneDriveServiceURL")}})},_startOneDriveBusinessExpand:function(e,t,r){var n=this;t&&UWA.is(t[0].url,"string")?(this._setOneDriveWSUri(e,t),this._getPartMetaData(r)):this._getOneDriveServiceURL("",function(t){UWA.is(t),n._startOneDriveBusinessExpand(e,t,r)})},_getPartMetaData:function(){var e=this,r=this.metaDataWsUri;t.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(t){e.currentDataTitle=t.title,e._returnNewOneDriveAsset(t)},onFailure:function(t){-1!==t.message.indexOf("404")?e.onFailCB({NLS_ID:"LoadingDocument404"}):e.onFailCB({NLS_ID:"LoadingError_LOAD"})}})},_returnNewOneDriveAsset:function(e){var t=this.monoFileUri,r=e.extension,n={provider:"FILE",filename:t,format:r,type:r,url:t,mimetype:r,requestsOptions:{proxy:"none",method:"GET",authentication:"passport"}};this.connectorsOnSuccessCB(n)}})}),define("DS/3DPlayConnectors/DropboxConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,r){"use strict";return e.extend({init:function(e){this._parent(e),this.xDropboxId=null,this.currentDataTitle=null,this.xDropboxParentUri1="/drive/v1/dropbox/contents/",this.xDropboxParentUri2="/stream?xrequestedwith=xmlhttprequest",this.monoFileUri=null,this.assemblyUri=null,this.onFailCB=null,this.connectorsOnSuccessCB=null},open:function(e,t,r){var n=this;this.rawAsset=e,this.xDropboxId=e.physicalid,this.onFailCB=r,this.connectorsOnSuccessCB=t,this._startDropboxBusinessExpand(e,e.serverurl||!1,function(e){n._returnNewDropboxAsset(e,t)})},_setDropboxWSUri:function(e,t){var r=t[0].url,n=e.physicalid;this.metaDataWsUri=r+this.xDropboxParentUri1+n,this.monoFileUri=r+this.xDropboxParentUri1+n+this.xDropboxParentUri2,this.assemblyUri=this.monoFileUri},_getDropboxServiceURL:function(e,t){var n=this;r.getServiceUrl({serviceName:"driveshub",platformId:e,onComplete:function(e){t(e)},onFailure:function(){n.onFailCB("Error in  thatDropboxConnector._getDropBoxServiceURL")}})},_startDropboxBusinessExpand:function(e,t,r){var n=this;t&&UWA.is(t[0].url,"string")?(this._setDropboxWSUri(e,t),this._getPartMetaData(r)):this._getDropboxServiceURL("",function(t){UWA.is(t),n._startDropboxBusinessExpand(e,t,r)})},_getPartMetaData:function(){var e=this,r=this.metaDataWsUri;t.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(t){e.currentDataTitle=t.title,e._returnNewDropboxAsset(t)},onFailure:function(t){-1!==t.message.indexOf("404")?e.onFailCB({NLS_ID:"LoadingDocument404"}):e.onFailCB({NLS_ID:"LoadingError_LOAD"})}})},_returnNewDropboxAsset:function(e){var t=this.monoFileUri,r=e.extension,n={provider:"FILE",filename:t,format:r,type:r,url:t,mimetype:r,requestsOptions:{proxy:"none",method:"GET",authentication:"passport"}};this.connectorsOnSuccessCB(n)}})}),define("DS/3DPlayConnectors/3DSwymConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WAFData/WAFData","DS/i3DXCompassServices/i3DXCompassServices"],function(e,t,r){"use strict";return e.extend({init:function(e){this.name="3DSwymConnector",this._parent(e),this.x3DSwymMediaId=null,this.x3DSwymURI=null,this.x3DSwymServerToken=null,this.x3DSwymServerTokenUrl="/api/index/tk",this.x3DSwymGetMediaUrl="/api/media/get",this.inConnectorMode=!0,this.onFailCB=null},open:function(e,t,r){if(e&&e.objectId){var n=e.objectId.lastIndexOf(":");this.x3DSwymMediaId=n>-1?e.objectId.substring(n+1):e.objectId}this.onFailCB=r,e.serverurl&&UWA.is(e.serverurl,"string")?(this.x3DSwymURI=e.serverurl,this._getCSRFToken(this.x3DSwymURI,t)):this._get3DSwymServiceURL(e.envId,t)},_get3DSwymServiceURL:function(e,t){var n=this;r.getServiceUrl({serviceName:"3DSwym",platformId:e,onComplete:function(e){n.x3DSwymURI=e,n._getCSRFToken(n.x3DSwymURI,t)},onFailure:function(){n.onFailCB("Unable to retrieve 3DSwym Service URL")}})},_getCSRFToken:function(e,r){var n=e+this.x3DSwymServerTokenUrl,i=this;t.authenticatedRequest(n,{method:"GET",type:"json",onComplete:function(e){if(e&&e.result&&e.result.ServerToken){e.result.ServerToken;i.x3DSwymServerToken=e.result.ServerToken,i._getMediaInfosAndStreamUri(r)}else console.error("Services Reach, but Error in return "),i.onFailCB("Unable to retrieve 3DSwym Service URL")},onFailure:function(e){console.error("Service unReach",e)}})},_getMediaInfosAndStreamUri:function(e){var r=this,n=this.x3DSwymURI+this.x3DSwymGetMediaUrl,i=r.x3DSwymMediaId;t.authenticatedRequest(n,{method:"POST",type:"json",data:JSON.stringify({request_id:"0",params:{id_media:i}}),headers:{"Content-Type":"application/json","X-DS-SWYM-CSRFTOKEN":r.x3DSwymServerToken},onComplete:function(t){if(t.errorcode||""==t.errorcode)console.error(t.errorcode,t.errormsg),r.onFailCB("Unable to get Meta Data for this model");else{var n=t.result;r.inConnectorMode?e(r.returnSwymNewAsset(n)):e(n)}},onFailure:function(e){r.onFailCB("Unable to get Meta Data for this model")}})},get3DSwymMetaData:function(e,t,r){this.onFailCB=r,this.inConnectorMode=!1;var n=e.data.items[0];this.x3DSwymMediaId=n.objectId,this._get3DSwymServiceURL(n.envId,t)},returnSwymTransientUrl:function(e){var t=e.play;return t.hasOwnProperty("3d_streams")&&Array.isArray(t["3d_streams"])?t["3d_streams"][0].transient_url:t.download_original_url.transient_url_as_attachment},returnSwymAssetInfo:function(e,t){var r,n,i=e.play;if(i){if(i.hasOwnProperty("best_streams")){var o=i.best_streams;if(o){var s=i[o];if(Array.isArray(s)&&s.length>0){var a=i[o][0];a&&(r=a.format,n=a.transient_url)}}}if(null==n){var l=i.download_original_url;l&&(r=l.format)&&(n=l.transient_url_as_attachment)}if(n)return t.format=r,t.filename=n,t.swymAttr=e,t.swymServerToken=this.x3DSwymServerToken,"3dxml"===r&&(t.type=t.format=t.mimetype="XMLV43"),t}},returnSwymNewAsset:function(e){return this.returnSwymAssetInfo(e,{provider:"FILE",requestsOptions:{authentication:"passport",proxy:"none"}})}})}),define("DS/3DPlayConnectors/DrawingConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WAFData/WAFData","DS/WebUtils/3DPlayState","DS/WebSystem/Environment","DS/WebUtils/WebServices"],function(e,t,r,n,i){"use strict";var o,s,a=function(e){if(e){var r={type:"text",timeout:72e5,cache:3600,onComplete:function(e){o({asset:{data:e,dataFormat:"xcaddrawing",provider:"BUFFER"}})},onCancel:function(e){console.log("ERROR: WAFData request cancelled while loading SVG file."),s({NLS_ID:"LoadingError_LOAD_ENTRY"})},onFailure:function(e){console.log("ERROR: WAFData request failed while loading SVG file."),s({NLS_ID:"LoadingError_LOAD_ENTRY"})}};UWA.merge(r,{method:"POST",authentication:"passport",proxy:"none"});t.handleRequest(e,r)}else console.log("Invalid URL."),s({NLS_ID:"BadUrl"})},l=function(e,r){n.isSet("3DPlay.downloadDrawingStream")&&t.authenticatedRequest(e,{method:"GET",headers:{"Content-Type":"application/json"},onComplete:function(e){var t=new Blob([e]),n=URL.createObjectURL(t),i=document.createElement("a");i.download="DrawingStream."+r,i.innerHTML="Download File",i.href=n,i.onclick=function(e){document.body.removeChild(e.target)},i.style.display="none",document.body.appendChild(i),i.click()}})},u=function(e){var i={label:"3DPlay_"+Date.now(),physicalid:[e.physicalid],select_file:["svg","udl"],select_predicate:["ds6w:cadMaster","ds6w:type"]},u=e.contextid?e.contextid:e.contextId?e.contextId:"preferred";n.get("PreferredCredentials")&&(u=n.get("PreferredCredentials"));var c=e.serverurl+"/cvservlet/fetch/v2?SecurityContext="+u,d={headers:{"Content-Type":"application/json"},method:"POST",type:"json",onComplete:function(t){var r=function(e){var t,r=UWA.is(e,"string")?JSON.parse(e):e;if(1==r.results.length&&r.results[0]){var n=r.results[0].attributes;if(n)for(var i=0;i<n.length;++i)if("udl"==n[i].name){t=n[i].value;break}}return t}(t),i=function(e){var t=!1,r=UWA.is(e,"string")?JSON.parse(e):e;if(1==r.results.length&&r.results[0]){var n=r.results[0].attributes;if(n)for(var i=0;i<n.length;++i)if("ds6w:cadMaster"==n[i].name){if(console.log("ds6w:cadMaster - "+n[i].value),"3DEXPERIENCE"!=n[i].value&&null!=n[i].value){t=!0;break}break}}return t}(t);if(r&&i||!i&&r&&!n.isSet("CAT_DFT_GENERATE_SVG_AND_UDL"))o({asset:{data:r,dataFormat:"udl",provider:"BUFFER"}}),l(r,"udl");else if(i)!function(e){var t=null,r=UWA.is(e,"string")?JSON.parse(e):e;if(1!==r.results.length)return console.log("ERROR: Incorrect data received for service."),void s({NLS_ID:"LoadingError_LOAD_ENTRY"});if(r.results[0]){for(var n=!1,i=r.results[0].attributes,u=0;u<i.length;u++)if("svg"===i[u].name){n=!0,void 0!==i[u].value&&null!==i[u].value&&""!==i[u].value?(t=i[u].value,a(t),l(t,"svg")):o({asset:{data:null,dataFormat:"svg",provider:"BUFFER"}});break}!1===n&&(console.log("ERROR: SVG attribute not available."),o({asset:{data:null,dataFormat:"svg",provider:"BUFFER"}}))}}(t);else{var u=JSON.parse(JSON.stringify(e));u.backup_type=e.type,u.backup_dtype=e.dtype,u.type="V6Drawing",u.dtype="V6Drawing",o({asset:u})}},onCancel:function(e){console.log("ERROR: WAFData request failed while opening Drawing."),s({NLS_ID:"LoadingError_LOAD_ENTRY"})},onFailure:function(e){console.log("ERROR: WAFData request failed while opening Drawing."),s({NLS_ID:"LoadingError_LOAD_ENTRY"})}};r.isWebinWin()&&(d.authentication=e.requiredAuth),d.data=JSON.stringify(i),t.authenticatedRequest(c,d)};return e.extend({init:function(e){this._parent(e)},open:function(e,t,r){var a=this;this.preventDoubleCallBack=!1,o=t,s=function(e){a.preventDoubleCallBack||(a.preventDoubleCallBack=!0,r(e))},n.get("PreferredCredentials")||window.__karma__?u(e):i.getSecurityContext(e.tenant).then(function(t){n.set("PreferredCredentials",t),u(e)})}})}),define("DS/3DPlayConnectors/GoogleConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices"],function(e,t,r){"use strict";return e.extend({init:function(e){this._parent(e),this.xGoogleId=null,this.currentDataTitle=null,this.xGoogleParentUri1="/drive/v1/google/contents/",this.xGoogleParentUri2="/stream?xrequestedwith=xmlhttprequest",this.monoFileUri=null,this.assemblyUri=null,this.onFailCB=null,this.connectorsOnSuccessCB=null},open:function(e,t,r){var n=this;this.rawAsset=e,this.xGoogleId=e.physicalid,this.onFailCB=r,this.connectorsOnSuccessCB=t,this._startGoogleBusinessExpand(e,e.serverurl||!1,function(e){n._returnNewGoogleAsset(e,t)})},_setGoogleWSUri:function(e,t){var r=t[0].url,n=e.physicalid;this.metaDataWsUri=r+this.xGoogleParentUri1+n,this.monoFileUri=r+this.xGoogleParentUri1+n+this.xGoogleParentUri2,this.assemblyUri=this.monoFileUri},_getGoogleServiceURL:function(e,t){var n=this;r.getServiceUrl({serviceName:"driveshub",platformId:e,onComplete:function(e){t(e)},onFailure:function(){n.onFailCB("Error in  thatGoogleConnector._getGoogleServiceURL")}})},_startGoogleBusinessExpand:function(e,t,r){var n=this;t&&UWA.is(t[0].url,"string")?(this._setGoogleWSUri(e,t),this._getPartMetaData(r)):this._getGoogleServiceURL("",function(t){UWA.is(t),n._startGoogleBusinessExpand(e,t,r)})},_getPartMetaData:function(){var e=this,r=this.metaDataWsUri;t.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(t){e.currentDataTitle=t.title,e._returnNewGoogleAsset(t)},onFailure:function(t){-1!==t.message.indexOf("404")?e.onFailCB({NLS_ID:"LoadingDocument404"}):e.onFailCB({NLS_ID:"LoadingError_LOAD"})}})},_returnNewGoogleAsset:function(e){var t=this.monoFileUri,r=e.extension,n={provider:"FILE",filename:t,format:r,type:r,url:t,mimetype:r,requestsOptions:{proxy:"none",method:"GET",authentication:"passport"}};this.connectorsOnSuccessCB(n)}})}),define("DS/3DPlayConnectors/3DDriveConnector",["DS/3DPlayConnectors/CAT3DPlayConnector","DS/WAFData/WAFData","DS/i3DXCompassPlatformServices/i3DXCompassPlatformServices","DS/CoreEvents/Events","DS/WebUtils/Tracker"],function(e,t,r,n,i){"use strict";return e.extend({init:function(e){this.name="3DDriveConnector",this._parent(e),this.x3DDriveId=null,this.currentDataTitle=null,this.x3DDriveParentUri1="/resources/3ddrive/v1/bos/",this.x3DDriveParentUri2="/fileurl?tenant=",this.monoFileUri=null,this.assemblyUri=null,this.onFailCB=null,this.connectorsOnSuccessCB=null},open:function(e,t,r){var n=this;this.rawAsset=e,this.x3DDriveId=e.physicalid,this.x3DriveTenantId=e.tenant,this.onFailCB=r,this.connectorsOnSuccessCB=t,e.fileFormat?this._returnNew3DDriveAsset({filename:e.filename,extension:e.fileFormat,url:e.url},null,null):this._start3DDriveBusinessExpand(e,e.serverurl||!1,function(e){n._returnNew3DDriveAsset(e,t)})},_set3DDriveWSUri:function(e,t){var r=t,n=e.physicalid,i=e.tenant;this.metaDataWsUri=r+this.x3DDriveParentUri1+n+"?tenant="+i,this.monoFileUri=r+this.x3DDriveParentUri1+n+this.x3DDriveParentUri2+i,this.assemblyUri=this.monoFileUri+"&expand=true",this.serviceUri=r},_get3DDriveServiceURL:function(e,t){var n=this;r.getServiceUrl({serviceName:"3DDrive",platformId:e,onComplete:t,onFailure:function(){n.onFailCB("Error in  3DDriveConnector._get3DDriveServiceURL")}})},_start3DDriveBusinessExpand:function(e,t,r){var n=this;t&&UWA.is(t,"string")?(this._set3DDriveWSUri(e,t),this._getPartMetaData(r)):this._get3DDriveServiceURL(e.tenant,function(t){UWA.is(t),n._start3DDriveBusinessExpand(e,t,r)})},_getRealAssetUri:function(e){var r=this,n=this.monoFileUri,o=null,s=e.extension.toLowerCase();"catproduct"!==s&&"gml"!==s&&"stpx"!==s&&"stpxz"!==s||(n+="&expand=true",o="catproduct"===s?"CATProduct":e.extension),t.authenticatedRequest(n,{method:"GET",type:"json",onComplete:function(t){r._returnNew3DDriveAsset(t,o,e)},onFailure:function(e,t,n){var o={NLS_ID:"LoadingError_LOAD"};if(t&&t.error&&t.error.errorCode){var a={};a[t.error.errorCode]=1,i.trackPageEvent("errors","3DDrive",s,0,a),["mainNotIndexed","linkInfoMissing"].indexOf(t.error.errorCode)>-1&&(console.error("3DDrive error",t.error.errorCode,":",t.error.message,":",(t.error.failingFiles||[]).join(",")),o={NLS_ID:"assembly_Not8indexed_FAIL"})}r.onFailCB(o)}})},_getPartMetaData:function(){var e=this,r=this.metaDataWsUri;t.authenticatedRequest(r,{method:"GET",type:"json",onComplete:function(t){e.currentDataTitle=t.title,e._getRealAssetUri(t),n.publish({event:"Model.changeTitle",data:t.title})},onFailure:function(t){var r="LoadingError_LOAD";-1!==t.message.indexOf("404")&&(r="LoadingDocument404"),e.onFailCB({NLS_ID:r});var n={};n[r]=1,i.trackPageEvent("errors","3DDrive","connector",0,n)}})},_returnNew3DDriveAsset:function(e,t,r){var n=e.url,i=e.extension,o={provider:"FILE",filename:e.filename||"",format:i,type:i,serverurl:n,url:n,mimetype:i,requestsOptions:{proxy:"none",method:"GET"},serviceURL:this.serviceUri,driveAttr:r};null!==t&&(o.format=o.type=t,o.filename=this.currentDataTitle+".zip",o.mimetype=t),this.connectorsOnSuccessCB(o)}})});