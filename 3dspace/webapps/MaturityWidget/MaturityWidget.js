define("DS/MaturityWidget/MaturityConfirmationDialogFilter",["UWA/Promise","DS/LifecycleServices/Utils","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i){"use strict";function n(){}return n.prototype={showConfirmationDialog:function(n,o){if(null!=o&&o.hasOwnProperty("maturityWidget")&&!(void 0===o.maturityWidget||null===o.maturityWidget||o.maturityWidget.displayWorkflowGraph&&o.maturityWidget.model.isConfirmationDialogEnabled)){for(var s=[],a=0;a<n.length;a++)s[n[a].physicalid]="";return t.resolve(s)}return new t(function(t,s){var a=[],r=document.getElementById("sampleFilterId");r&&(r.parentNode.removeChild(r),r=void 0);for(var l=e.htmlFromString("<div id='sampleFilterId' class='lcm-confirmation-dialog-filter-transition'><div class='lcm-filter-title'>"+i.maturityConfirmationDialogTitle+"</div><div class='lcm-filter-msg'></div><div class='lcm-filter-buttons'><button class='lcm-filter-ok-button lcm-transition-confirm-button-base'>"+i.okButton+"</button><button class='lcm-filter-cancel-button lcm-transition-confirm-button-base'>"+i.cancelButton+"</button></div></div>"),c=(l.querySelector(".lcm-filter-transition"),l.querySelector(".lcm-filter-ok-button")),h=l.querySelector(".lcm-filter-cancel-button"),d=l.querySelector(".lcm-filter-msg"),u=0;u<n.length;u++){var p=o.maturityWidget.model.getStateUserNameFromStateSystemName(n[u].physicalid,n[u].tostate);d.innerHTML+=p}["mousedown","touchstart"].forEach(function(e){c.addEventListener(e,function(e){var i=document.getElementById("sampleFilterId");if(i){for(var o=0;o<n.length;o++)a[n[o].physicalid]="";i.style.display="none",t(a)}e.stopPropagation()}),h.addEventListener(e,function(e){var i=document.getElementById("sampleFilterId");i&&(i.style.display="none",t(a)),e.stopPropagation()})}),o.maturityWidget.elements.container.appendChild(l)})}},new n}),define("DS/MaturityWidget/MultiselUI",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","DS/LifecycleServices/LifecycleObjectList","DS/LifecycleServices/LifecycleServicesSettings","DS/UIKIT/Input/Select","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","text!DS/LifecycleWidget/assets/MaturityStatePriority.json"],function(t,e,i,n,o,s,a){"use strict";return e.extend({isPromotePayload:!0,create:function(t,e,o,a){var r=this;this.model=t,this.maturityWidget=o,this.setTitle=a,n.app_initialization(function(){});var l=this.model.getObjects();this.container=UWA.createElement("div",{class:"lcm-maturity-container lcm-maturity-container-multisel lcm-maturity-table-container"}),this.container.inject(e);var c=this.promotion={},h={},d=[];if(this._prepareAndSort(l,c,h,d),this.maturityTable=UWA.createElement("table",{class:"MaturityTable"}),this.commandSpan=UWA.createElement("tr",{class:"MaturityCommandSpan"}).inject(this.maturityTable),this.tableSpan=UWA.createElement("tr",{class:"MaturityTableSpan"}).inject(this.maturityTable),this.maturityTable.inject(this.container),d.length>0){var u=document.createElement("p");u.textContent=s.changeMaturityTo,u.style.display="inline",this.maturityChangeDiv=UWA.createElement("div",{class:"maturity-change-txt"}),this.maturityChangeDiv.appendChild(u),this.commandSpan.appendChild(this.maturityChangeDiv)}if(d.length>=1)this._createStateSelCombo(c,h,d);else{if(1!==d.length){var p=UWA.createElement("p",{text:s.noAvailTransition,class:"maturity-info-msg"});return this.commandSpan.appendChild(p),!1}var m=d[0];this.toState=m;var f=document.createElement("p");f.textContent=h[m].stateUserName,f.style.display="inline",this.maturityTargetDiv=UWA.createElement("div",{class:"maturity-target-txt"}),this.maturityTargetDiv.appendChild(f),this.commandSpan.appendChild(this.maturityTargetDiv)}var y=document.createElement("p");y.textContent=s.stateQ,y.style.display="inline",this.maturityStateDiv=UWA.createElement("div",{class:"maturity-state-txt"}),this.maturityStateDiv.appendChild(y),this.commandSpan.appendChild(this.maturityStateDiv),this.objectListDiv=UWA.createElement("div",{class:"maturity-objectList"}),this.objectsList=new i({className:"objectlist-Revise",showTypeColumn:!0,showRevisionColumn:!0,showMaturityColumn:!0}),this.objectsList.inject(this.objectListDiv),this.tableSpan.appendChild(this.objectListDiv),this.objectListDiv.hide(),this.objectsList.objectsTable.resizeTable(),this.objectsList.objectsTable.addEvent("onPointingEvent",function(t){"dblclick"==t.type&&r._onDoubleClickLine(t.cellPosition.line)});var g=this._getUpdatedObjectsForState(c,this.toState);return this._updateObjectListUI(c,g),this.onPanelResize(),!0},getPromotePayload:function(){var t=this,e=this.toState,i=[];this.promotion[e].forEach(function(n){if(!n.excludeFromPromote&&!n.isDemote&&t.model.getApplyTransition(n.phid)){var o=t.model.getAttribute(n.phid,"type"),s=t.model.getAttribute(n.phid,"revision"),a=t.model.getAttribute(n.phid,"policy"),r=t.model.getAttribute(n.phid,"name"),l=t.model.getAttribute(n.phid,"coretype"),c=t.model.getAttribute(n.phid,"interfaceHash"),h=t.model.getAttribute(n.phid,"cadMaster"),d="",u=t.model.getAttribute(n.phid,"signatures");if(u.hasOwnProperty([n.fromstate])){var p=u[n.fromstate];if(p.hasOwnProperty([e])){var m=Object.keys(p[e]);m.length>0&&"undefined"!=m[0]&&(d=m[0])}}i.push({physicalid:n.phid,tostate:e,fromstate:n.fromstate,type:o,revision:s,policy:a,name:r,coretype:l,interfaceHash:c,signature:d,cadMaster:h})}});var n={};return n.data=i,n},getDemotePayload:function(){var t=this,e=this.toState,i=[];this.promotion[e].forEach(function(n){if(!n.excludeFromPromote&&n.isDemote&&t.model.getApplyTransition(n.phid)){var o=t.model.getAttribute(n.phid,"type"),s=t.model.getAttribute(n.phid,"revision"),a=t.model.getAttribute(n.phid,"policy"),r=t.model.getAttribute(n.phid,"name"),l=t.model.getAttribute(n.phid,"coretype"),c=t.model.getAttribute(n.phid,"interfaceHash");i.push({physicalid:n.phid,tostate:e,fromstate:n.fromstate,type:o,revision:s,policy:a,name:r,coretype:l,interfaceHash:c})}});var n={};return n.data=i,n},onPanelResize:function(){if(void 0!==this.objectsList&&null!==this.objectsList&&void 0!==this.objectsList.objectsTable&&null!==this.objectsList.objectsTable){this.objectsList.objectsTable.resizeTable();var t=document.querySelectorAll("div.lcm-maturity-content");if(null!=t&&t.length>0){var e=t[0].getSize(),i=document.querySelectorAll('div.DivSSTableBody.objectlist-ReviseBody[data-rec-id="dataRecSSTable2"] div.no-native-scrollbars.scroller-content');if(null!=i&&i.length>0)for(var n=0;n<i.length;n++){var o=e.height-80;o>0&&(i[0].style.height=o+"px")}}}},_updateOKButton:function(){var t=this.getPromotePayload(),e=this.getDemotePayload();t.data.length>0||e.data.length>0?this.maturityWidget.updateOKButton(!0):this.maturityWidget.updateOKButton(!1)},_onDoubleClickLine:function(t){var e=t.Id;if(this._isTransitionApplicable(e)){var i=!this.model.getApplyTransition(e);this.model.setApplyTransition(e,i);var o=this.model.getCurrentTenantFromObject(this.model.objects[e]),s=n.get3DSpaceBaseUrl(o),a=this._getApplicablePromoteIcon(s,i);t.Symbol.src=a,this._updateOKButton()}},_getApplicablePromoteIcon:function(t,e){return e?t+"/webapps/LifecycleWidget/assets/icons/16/I_ApplyPromote.png":t+"/webapps/LifecycleWidget/assets/icons/16/I_NotApplyPromote.png"},_createObjectForList:function(t){var e=this.model.getApplyTransition(t),i=this._isTransitionApplicable(t),o=UWA.createElement("img",{src:this.model.getAttribute(t,"imageUrl")}),s=this.model.getAttribute(t,"displayName");"string"!=typeof s?s=this.model.getAttribute(t,"name"):0==s.trim().length&&(s=this.model.getAttribute(t,"name"));var a=UWA.createElement("div",{text:s}),r=UWA.createElement("div",{class:"TitleDiv"});a.setStyles({display:"inline-block","padding-left":"6px"}),r.appendChild(o),r.appendChild(a);var l=null,c=this.model.getCurrentTenantFromObject(this.model.objects[t]),h=n.get3DSpaceBaseUrl(c);return l=h+"/webapps/LifecycleWidget/assets/icons/16/I_NotAvailablePromote.png",i&&(l=this._getApplicablePromoteIcon(h,e)),{physicalid:t,name:r,revision:this.model.getAttribute(t,"revision"),type:this.model.getAttribute(t,"typeDisplayName"),current:this.model.getAttribute(t,"currentStateUserName"),imageUrl:l,policy:this.model.getAttribute(t,"policy")}},_isTransitionApplicable:function(t){for(var e=this.promotion[this.toState],i=0;i<e.length;i++){if(e[i].phid==t)return!0}return!1},_getUpdatedObjectsForState:function(t,e){var i,n=this,o=[],s=new Set,a=this.toState;return this.maturityWidget.initialSelection.forEach(function(t){s.add(t.physicalid)}),s.forEach(function(t){var e=n._createObjectForList(t);o.push(e)}),t[this.toState]&&t[this.toState].forEach(function(t){var e=t.phid,o=n.model.objects[e];if(o.hasOwnProperty("coretype")&&"Entity"==o.coretype){var s=this.model.maturityGraphs[o.policy];void 0!==s.states&&null!==s.states&&s.hasOwnProperty("states")&&(i=s.states);t.fromstate;for(var r in i){var l=i[r];if(null!=l&&l.hasOwnProperty("info")){var c=l.info;if(null!=c&&c.hasOwnProperty("stateUserName")&&c.hasOwnProperty("visuorder")&&c.stateSysName==t.fromstate){i[a].info.visuorder<c.visuorder?t.isDemote=!0:t.isDemote=!1;break}}}}},this),o},_createStateSelCombo:function(t,e,i){var n=this,s=new o({value:0,className:"small",placeholder:!1}),a=!0;i.forEach(function(t){var i={};!0===a&&(n.toState=t,i.value=t,i.selected="true"),a=!1,i.value=t,i.label=e[t].stateUserName,s.add(i)});s.addEvent("onChange",function(){var e=this.getSelection(!0);if(e.length>0){n.toState=e[0].value;var i=n._getUpdatedObjectsForState(t,n.toState);n._updateObjectListUI(t,i)}});var r=UWA.createElement("div",{class:"maturity-Combo-Container-div"});s.inject(r),this.commandSpan.appendChild(r)},_updateObjectListUI:function(t,e){null!==this.objectsList&&(this.objectsList.setObjects(e),this.maturityWidget.options.isWebInWin?this.setTitle(t[this.toState].length+" "+s.Objects):this.setTitle(s.maturity+" - "+t[this.toState].length+" "+s.Objects),this.objectListDiv.show(),this._updateOKButton())},_prepareAndSort:function(t,e,i,n){var o=JSON.parse(a),s=[];for(var r in t){var l=t[r].current,c=this.model.getPolicy(t[r].policy),h=JSON.parse(JSON.stringify(c.maturityGraph.transitions)),d=c.maturityGraph.states,u=t[r].current;if("Entity"==t[r].coretype)for(var p=h.length,m=0;m<p;m++)"Obsolete"!=h[m].sourceState&&"Obsolete"!=h[m].targetState&&h.push({targetState:h[m].sourceState,sourceState:h[m].targetState,signatures:h[m].signatures});var f=t[r].excludeFromPromote;h.forEach(function(t){if(t.sourceState===l){var a=t.targetState;d.forEach(function(t){t.stateSysName===a&&(i[a]={},i[a].stateUserName=t.stateUserName)});var c={phid:r,excludeFromPromote:f,fromstate:u};if(-1===n.indexOf(a)){var h=0;o.hasOwnProperty(a)&&(h=o[a].priority),s.push({name:a,priority:h}),n.push(a),e[a]=[c]}else-1===e[a].findIndex(function(t){return t.phid==c.phid})&&e[a].push(c)}}),s.sort(function(t,e){return t.name==e.name?0:t.priority>e.priority?1:t.priority<e.priority?-1:0}),n.length=0,s.forEach(function(t){n.push(t.name)})}}})}),define("DS/MaturityWidget/SampleFiltersAndActions",["UWA/Promise","DS/LifecycleServices/Utils"],function(t,e){"use strict";function i(){}return i.prototype={changeMaturityFilterSample2:function(t,e){return e.sampleStyle=2,i.prototype.changeMaturityFilterSample1(t,e)},changeMaturityFilterSample3:function(t,e){return e.sampleStyle=3,i.prototype.changeMaturityFilterSample1(t,e)},changeMaturityFilterSample1:function(i,n){return new t(function(t,o){var s=[],a=document.getElementById("sampleFilterId");a&&(a.parentNode.removeChild(a),a=void 0);var r="<div id='sampleFilterId' class='lcm-filter-transition'>";2===n.sampleStyle?r="<div id='sampleFilterId' class='lcm-filter-transition2'>":3===n.sampleStyle&&(r="<div id='sampleFilterId' class='lcm-filter-transition3'>");for(var l=e.htmlFromString(r+"<div class='lcm-filter-title'>Promotion Confirmation</div><div class='lcm-filter-msg'></div><div class='lcm-filter-buttons'><button class='lcm-filter-cancel-button lcm-transition-confirm-button-base'>Cancel</button><button class='lcm-filter-ok-button lcm-transition-confirm-button-base'>OK</button></div></div>"),c=(l.querySelector(".lcm-filter-transition"),l.querySelector(".lcm-filter-ok-button")),h=l.querySelector(".lcm-filter-cancel-button"),d=l.querySelector(".lcm-filter-msg"),u=0;u<i.length;u++)d.innerHTML+=i[u].name+" "+i[u].revision+"<br />";["mousedown","touchstart"].forEach(function(e){c.addEventListener(e,function(e){var n=document.getElementById("sampleFilterId");if(n){for(var o=0;o<i.length;o++)s[i[o].physicalid]="";n.style.display="none",t(s)}e.stopPropagation()}),h.addEventListener(e,function(e){var i=document.getElementById("sampleFilterId");i&&(i.style.display="none",t(s)),e.stopPropagation()})}),n.maturityGraphContainer.appendChild(l)})},changeMaturityActionSample1:function(t,e){if(e.maturityWidget){for(var i="",n=0;n<t.length;n++)i+=t[n].physicalid+" ";e.maturityWidget._showNotification("info","Promotion confirmation post actions successfuly fired for objects "+i)}}},new i}),define("DS/MaturityWidget/MaturityModel",["UWA/Controls/Abstract","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i){"use strict";return t.extend({isSingleIRPCAssembly:!1,isWebInWin:!1,init:function(){this.clear()},clear:function(){this.maturityGraphs={},this.objects={},this.policies={}},getAttribute:function(t,e){return void 0!==this.objects[t]?this.objects[t][e]:void 0},getAttributes:function(t){return this.objects[t]},setAttributes:function(t,e){this.objects[t]=e},setAttribute:function(t,e,i){void 0!==this.objects[t]&&(this.objects[t][e]=i)},setObjects:function(t){for(var e=0;e<t.length;e++)this.objects[t[e].physicalid]={},this.originalPid=t[e].physicalid,void 0!==t[e].serviceurl&&t[e].serviceurl&&(this.serviceurl=t[e].serviceurl)},setChangeAction:function(t){this.changeAction=t},getChangeActionId:function(){var t=null;return void 0!==this.changeAction&&null!==this.changeAction&&this.changeAction.hasOwnProperty("id")&&(t=this.changeAction.id),t},getApplyTransition:function(t){return this.getAttribute(t,"applyTransition")},setApplyTransition:function(t,e){this.setAttribute(t,"applyTransition",e)},getObjects:function(){return this.objects},changeCurrentObjectState:function(t,e){var i=this.objects[t];if(i)if(i.current=e,i.maturityGraph)i.maturityGraph.states&&i.maturityGraph.states.forEach(function(t){t.stateSysName===e?(t.isCurrent=!0,i.currentStateUserName=t.stateUserName):t.isCurrent=!1});else if(this.getMaturityGraph(i.policy)){var n=this.getMaturityGraph(i.policy).states[e];n&&(i.currentStateUserName=n.info.stateUserName)}},getStateUserNameFromStateSystemName:function(t,e){var i=null,n=this.objects[t];if(!n)return i;if(!n.maturityGraph&&this.getMaturityGraph(n.policy)){var o=this.getMaturityGraph(n.policy).states[e];o&&(i=o.info.stateUserName)}return i},setMaturityGraph:function(t){if(this.clear(),0==t.data.policies.length){console.log("ERROR: No policies in json");var n={};n.errorMsg=i.maturityGraphFailed,n.type="error",that.dispatchEvent("onError",n)}else{this.policies=t.data.policies,this.isConfirmationDialogEnabled=t.data.isConfirmationDialogEnabled;for(var o=!1,s=0;s<t.data.objects.length;s++){var a=t.data.objects[s].physicalid,r=t.data.objects[s];for(var l in this.objects[a]=r,this.objects[a].signatures={},this.objects[a].routes={},this.objects[a].applyTransition=!0,this.objects[a].interfaceHash=[],r.InterfaceList)this.objects[a].interfaceHash[l]=l;if(void 0!==this.objects[a].isSingleIRPCAssembly&&null!==this.objects[a].isSingleIRPCAssembly&&this.objects[a].hasOwnProperty("isSingleIRPCAssembly")&&(o=o||this.objects[a].isSingleIRPCAssembly),this.objects[a].hasOwnProperty("imageUrl")&&void 0!==this.objects[a].imageUrl&&null!==this.objects[a].imageUrl){var c=this.objects[a].imageUrl,h=this.getCurrentTenantFromObject(this.objects[a]);if(c.startsWith("/")){var d=e.get3DSpaceBaseUrl(h);this.objects[a].imageUrl=d+c}}this.objects[a].excludeFromPromote=null!=r.isAggregateRep&&r.isAggregateRep,this.objects[a].excludeFromPromote||null!=r.usage&&"3DPart"==r.usage&&null!=r.isOnceInstantiable&&r.isOnceInstantiable&&(this.objects[a].excludeFromPromote=!0);var u=0;for(u=0;u<this.policies.length&&this.policies[u].name!==r.policy;u++);var p=this.policies[u].maturityGraph.transitions,m=this.policies[u].maturityGraph.states;this.actionnames={};for(var f=0;f<m.length;f++)!0===m[f].isCurrent&&this.setAttribute(a,"current",m[f].stateSysName),this.actionnames[m[f].stateSysName]={},this.objects[a].signatures[m[f].stateSysName]={},this.objects[a].routes[m[f].stateSysName]={};for(var y=0;y<p.length;y++){var g=p[y].sourceState,v=p[y].targetState,b=p[y].signatures;this.objects[a].routes[g][v]=p[y].hasRoute;for(var S={},C=0;C<b.length;C++)S[b[C].name]=b[C],b[C].username.includes("emxFramework")?this.actionnames[g][v]=b[C].name:this.actionnames[g][v]=b[C].username;this.objects[a].signatures[g][v]=S}var A=r.policy;if(void 0===this.maturityGraphs[A]){var I={};for(C=0;C<m.length;C++){var _=m[C].stateSysName,P=m[C].activeColor,x=m[C].inactiveColor,w=m[C].tooltip,E={connectors_out:{},connectors_in:{},info:{},actionnames:{},activecolor:{},inactivecolor:{},tooltip:{}};for(y=0;y<p.length;y++){g=p[y].sourceState,v=p[y].targetState,b=p[y].signatures;g===_&&(E.connectors_out[v]={}),v===_&&(E.connectors_in[g]={})}E.info=m[C],E.actionnames=this.actionnames,E.activecolor=P,E.inactivecolor=x,E.tooltip=w,I[_]=E}var D=0;for(C=0;C<m.length;C++){void 0!==I[_=m[C].stateSysName]&&(I[_].info.visuorder=D,D++)}this.maturityGraphs[A]={},this.maturityGraphs[A].states=I,this.maturityGraphs[A].infos={};var T=this.objects[a].coretype,M=this.objects[a].isOnceInstantiable;this.maturityGraphs[A].infos.isPromoteAuthorized=!1,this.maturityGraphs[A].infos.isDemoteAuthorized=!1,"Entity"===T&&(this.maturityGraphs[A].infos.isDemoteAuthorized=!0),("Entity"===T||"Reference"===T&&!M||"Reference"===T&&void 0!==r.usage&&null!==r.usage&&("DraftingRepresentation"===r.usage||"Kinematics"===r.usage))&&(this.maturityGraphs[A].infos.isPromoteAuthorized=!0)}else if(!this.maturityGraphs[A].infos.isPromoteAuthorized){T=this.objects[a].coretype,M=this.objects[a].isOnceInstantiable;("Entity"===T||"Reference"===T&&!M)&&(this.maturityGraphs[A].infos.isPromoteAuthorized=!0)}}this.isSingleIRPCAssembly=o}},getMaturityGraph:function(t){return this.maturityGraphs[t]},getCurrentTenantFromObject:function(t){var i=window.widget.getValue("x3dPlatformId");return(null==i||i.trim().length<1)&&(i=e.getTenant()),t&&t.hasOwnProperty("tenant")?t.tenant:i},getPolicy:function(t){for(var e=0;e<this.policies.length;e++)if(this.policies[e].name===t)return this.policies[e]},getAllStates:function(){var t=[];for(var e in this.maturityGraphs)if(this.maturityGraphs.hasOwnProperty(e)){var i=this.getMaturityGraph(e);for(var n in i.states)i.states.hasOwnProperty(n)&&t.push(n)}return t}})}),define("DS/MaturityWidget/MaturityGraph",["UWA/Controls/Abstract","DS/LifecycleCmd/Dictionary","DS/LifecycleControls/AdaptiveLayout","DS/LifecycleServices/Utils","DS/UIKIT/Mask","DS/UIKIT/Tooltip","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i,n,o,s,a){"use strict";return t.extend({pendingUpdate:!1,create:function(t,e){this.pendingTransition=!1,this.MainContainer=t,this._injectHTML(t,e),this._setupAdaptiveUI(t)},destroy:function(){null!=this&&(void 0!==this.adaptiveLayout&&null!==this.adaptiveLayout&&(this.adaptiveLayout.stop(),this.adaptiveLayout=null),void 0!==this.SVG_container&&null!==this.SVG_container&&(this.SVG_container.destroy(),this.SVG_container=null),void 0!==this.state_container&&null!==this.state_container&&(this.state_container.destroy(),this.state_container=null),this.paths=[],this.stateToElement=null)},updateGraph:function(t){this._updateStateElements(t),this.pendingUpdate||(this.pendingUpdate=!0,this._deleteConnectors(),this._createConnectors(t),this.paths.forEach(function(t){""!=t.path.id&&t.path.classList.add("fade-in")}),this.adaptiveLayout.restart(["active-path","inactive-path"]),this._drawConnectors(),this.pendingUpdate=!1)},onStartTransition:function(t){this.svgDoc1=document.getElementsByClassName("textclass"),o.unmask(this.MainContainer.getParent());for(var e=0;e<this.svgDoc1.length;e++){this.svgDoc1[e].style.pointerEvents="none"}this.pendingTransition=!0,this._enableStateElements(!1);var i=this.stateToElement.find(t);i&&(this.changeToMasked=i.element,this.changeToMasked.addClassName("lcm-state-pulse"),o.mask(this.changeToMasked,"")),this._animatePath(t,!1)},onEndTransition:function(t){this.pendingTransition=!1,this.changeToMasked&&(this.changeToMasked.removeClassName("lcm-state-pulse"),o.unmask(this.changeToMasked),this.changeToMasked=null),this._animatePath(t,!0),this._enableStateElements(!0);for(var e=0;e<this.svgDoc1.length;e++){this.svgDoc1[e].style.pointerEvents="auto"}},_onStyleChanged:function(t,e){this.currentConnectorMargins=this.connectorMargins.find(t),this._drawConnectors(),this.changeToMasked&&(o.unmask(this.changeToMasked),o.mask(this.changeToMasked,"")),this._enableStateTooltips(!0)},_setupAdaptiveConnectorMargins:function(){this.connectorMargins=new e,this.connectorMargins.add("lcm-state",{height:16,padding:18,connectorSize:20}),this.connectorMargins.add("lcm-state-m",{height:14,padding:3,connectorSize:10}),this.connectorMargins.add("lcm-state-s",{height:8,padding:0,connectorSize:4}),this.connectorMargins.add("lcm-state-hidden",{height:0,padding:0,connectorSize:0})},_setupAdaptiveUI:function(t){this._setupAdaptiveConnectorMargins(),this.parentContainer=t;var e=this._calcWidth(this.state_container,"lcm-state","lcm-state-connector",this.numStates),n=(this._calcWidth(this.state_container,"lcm-state-m","lcm-state-connector-m",this.numStates),this._calcWidth(this.state_container,"lcm-state-s","lcm-state-connector-s",this.numStates)),o=this._calcHeight(this.state_container,"lcm-state"),s=(this._calcHeight(this.state_container,"lcm-state-m"),this._calcHeight(this.state_container,"lcm-state-s"));o+=2*this.connectorMargins.find("lcm-state").height,this.connectorMargins.find("lcm-state-m").height;s+=2*this.connectorMargins.find("lcm-state-s").height;var a="max-width:"+e+";max-height:"+o;var r=e+10+"px";t.setStyles({height:"122px",width:r});var l=document.getElementsByClassName("lcm-maturity-content")[0].getParent(),c=document.getElementsByClassName("lcm-state-current");-1==navigator.userAgent.indexOf("Firefox")&&-1==navigator.userAgent.indexOf("MSIE")&&-1==navigator.userAgent.indexOf("rv:")&&null!=l&&"lifecycle-content maturity"!=l.className&&c[0].scrollIntoViewIfNeeded({behavior:"smooth",block:"nearest",inline:"start"});var h=this;this.adaptiveLayout=new i("lcm-state",t).onSizeChanged(function(t,e){t||h._drawConnectors(),h.confirmationUI.isVisible&&h.confirmationUI.position()}).onStyleChanged(function(t,e){h._onStyleChanged(t,e)}).start()},_injectHTML:function(t,e){this._createContainers(t),this._createStateElements(e),this._createTransitionConfirmationUI(t),this._createSVGCanvas(),this._createSVGEndArrows(),this._createConnectors(e)},_calcWidth:function(t,e,i,n){var o=function(t,e){var i=document.createElement("div");i.className=e,t.appendChild(i);var n=window.getComputedStyle(i),o=parseInt(n.marginLeft,10)+parseInt(n.marginRight,10)+i.getBoundingClientRect().width;return t.removeChild(i),o};return o(t,e)*n+o(t,i)*(n-1)+8*n},_calcHeight:function(t,e){var i=document.createElement("div");i.className=e,t.appendChild(i);var n=window.getComputedStyle(i),o=parseInt(n.marginTop,10)+parseInt(n.marginBottom,10)+i.getBoundingClientRect().height;t.removeChild(i);var s=this.connectorMargins.find(e);return s&&s.height&&(o+=s.height),o},_createContainers:function(t){for(var e=document.getElementsByClassName("lcm-svg-container");e.length>0;)e[0].remove();for(var i=document.getElementsByClassName("lcm-state-container");i.length>0;)i[0].remove();this.SVG_container=UWA.createElement("div",{class:"lcm-svg-container"}),this.state_container=UWA.createElement("div",{class:"lcm-state-container"}),this.SVG_container.inject(t),this.state_container.inject(t)},_getStateClass:function(t,e){if(t.info.isCurrent)return"lcm-state-current";if(t.isDisabled)return"lcm-state-unreachable";if(t.isDemote)return"lcm-state-transitionable";for(var i in t.connectors_in)if(i===e)return"lcm-state-transitionable";return"lcm-state-unreachable"},_getCurrentState:function(t){for(var e in t)if(t[e].info.isCurrent)return e;return""},_animatePath:function(t,e){if(!this._isIE11()){var i='path[*|to="'+t+'"]',n=this.SVGCanvas.querySelector(i);if(n){var o=UWA.extendElement(n);if(e)o.removeAttribute("style","stroke-width"),o.removeClassName("animate-path");else{if(o.hasClassName("animate-path"))return;var s=getComputedStyle(o).strokeWidth,a=parseFloat(s)+1;o.setAttribute("style","stroke-width:"+a+"px"),o.removeClassName("fade-in"),o.addClassName("animate-path")}this._patchIEPathBug(o)}}},_getTransitionConfirmText:function(t,e){return e[t].isDemote?a.demoteTo+e[t].info.stateUserName+"?":e[t].isPromote?a.promoteTo+e[t].info.stateUserName+"?":a.changeMaturityTo+e[t].info.stateUserName+"?"},_setStateColor:function(t){this.stateColor={},this.transitionColor="","Draft"===t||"Prepare"===t||"PRIVATE"===t||"Prepare"===t||"Create"===t?(this.stateColor=" private",this.transitionColor="#9B2C98"):"In Work"===t||"IN_WORK"===t||"In Work"===t||"Assign"===t?(this.stateColor=" inwork",this.transitionColor="#007DA3"):"In Approval"===t||"FROZEN"===t||"In Approval"===t||"Active"===t?(this.stateColor=" frozen",this.transitionColor="#018308"):"Completed"===t||"RELEASED"===t||"Complete"===t||"Closed"===t||"OBSOLETE"===t?(this.stateColor=" released",this.transitionColor="#757575"):"Approved"===t||"Review"===t?(this.stateColor=" approved",this.transitionColor="#E03400"):this.stateColor=""},_createStateElements:function(t){this.stateToElement=new e;var i=this._getCurrentState(t),n=!0,o=0;for(var a in t){var r=this._getStateClass(t[a],i);this._setStateColor(a);var l="",c=UWA.createElement("span",{class:"lcm-state-text",html:t[a].info.stateUserName});if("lcm-state-current"===r||n?(t[a].activecolor.includes("emxFramework")?l="#757575":"#FFFFFF"===(l=t[a].activecolor)&&(c.style.color="black"),"lcm-state-current"===r&&(n=!1)):t[a].inactivecolor.includes("emxFramework")?l="#BABABA":"#FFFFFF"===(l=t[a].inactivecolor)&&(c.style.color="gray"),0!==o)UWA.createElement("div",{class:"lcm-state-connector"}).inject(this.state_container);var h=UWA.createElement("div",{class:"lcm-state-base lcm-state "+r+" lcm-"+this.stateColor.trim(),styles:{backgroundColor:l}});"#FFFFFF"===l&&(h.style.border="lcm-state-current"===r?"2px solid black":"1px solid #B4B6BA"),c.inject(h),h.inject(this.state_container);this._getTransitionConfirmText(a,t);var d="";d=t[a].tooltip.includes("emxFramework")?t[a].info.stateUserName:t[a].tooltip;var u=new s({target:h,body:d,position:"bottom"});u.elements.container.style.display="none",u.elements.container.style.zIndex=99999,this.stateToElement.add(a,{element:h,tooltip:u,order:o++,numConnectors:{right:0,left:0,top:0,bottom:0}})}this.numStates=o},_updateStateElements:function(t){var e=this,i=this._getCurrentState(t),n=!0;this._forEachStateElement(function(o,s){o.removeClassName("lcm-state-unreachable"),o.removeClassName("lcm-state-transitionable"),o.removeClassName("lcm-state-current");var a=e._getStateClass(t[s],i);o.addClassName(a);var r="";"lcm-state-current"===a||n?(t[s].activecolor.includes("emxFramework")?r="#757575":"#FFFFFF"===(r=t[s].activecolor)&&(void 0!==o.children[0]&&(o.children[0].style.color="black"),o.style.border="2px solid black"),"lcm-state-current"===a&&(n=!1)):r=t[s].inactivecolor.includes("emxFramework")?"#BABABA":t[s].inactivecolor,o.confirmText=e._getTransitionConfirmText(s,t),o.action=t[s].action,o.setStyle("backgroundColor",r)})},_enableStateTooltips:function(t){var e=this;this._forEachStateElement(function(i,n){var o=e.stateToElement.find(n);o&&(o.tooltip.elements.container.style.display=t?"":"none")})},_enableStateElements:function(t){this._forEachStateElement(function(e){e.disabled=!t,e.setAttribute("data-disabled",(!t).toString()),t?e.hasClassName("lcm-state-disabled")&&e.removeClassName("lcm-state-disabled"):e.hasClassName("lcm-state-transitionable")&&e.addClassName("lcm-state-disabled")})},_forEachStateElement:function(t){var e=this;void 0!==this.stateToElement&&null!==this.stateToElement&&this.stateToElement.each(function(i){var n=e.stateToElement.find(i).element;t(n,i)})},_createTransitionConfirmationUI:function(t){var e=this,i=function(){},n=this._injectTransitionConfirmationUI(t,function(){i()},function(){e.confirmationUI.isVisible=!1}),o=n.querySelector(".lcm-transition-confirm-button"),s=n.querySelector(".lcm-confirm-msg");this.confirmationUI={isVisible:!1,show:function(t,e,a){i=a,n.style.display="inline-block",o.focus(),s.innerText=e,this.currentEl=t,this.position(),this.isVisible=!0},hide:function(){this.currentEl=null,n.style.display="inline-block",this.isVisible=!1},position:function(){this.currentEl&&(n.style.left=this.currentEl.offsetLeft-0+"px",n.style.top=this.currentEl.offsetTop-1+"px")}}},_injectTransitionConfirmationUI:function(t,e,i){var o=n.htmlFromString("<div class='lcm-confirm-transition'><div class='lcm-confirm-msg'></div><button class='lcm-transition-confirm-button lcm-transition-confirm-button-base'>"+a.maturityConfirmTransition+"</button></div>"),s=o.querySelector(".lcm-confirm-transition"),r=o.querySelector(".lcm-transition-confirm-button");return["mousedown","touchstart"].forEach(function(t){r.addEventListener(t,function(t){"inline-block"===s.style.display&&(t.stopPropagation(),s.style.display="none",e())})}),r.addEventListener("blur",function(){s.style.display="none","function"==typeof i&&i()}),t.appendChild(o),s},_deleteConnectors:function(){var t=this;this.paths.forEach(function(e){var i=e.path.parentNode;i&&(""!=e.path.id&&i.removeChild(t.text[e.path.id]),i.removeChild(e.path))}),this.paths=[];t=this;this.stateToElement.each(function(e){t.stateToElement.find(e).numConnectors={right:0,left:0,top:0,bottom:0}})},_createSVGEndArrows:function(){this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-active")),this.SVGCanvas.appendChild(this._createSVGEndArrow("arrow-inactive"))},_createConnectors:function(t){var e=this;this.Mask=o,this.paths=[],this.text={},this.tspan1={};var i,n=this,s=function(t,e){t.addEventListener("mouseover",function(){"true"!==t.getAttribute("data-disabled")&&n._animatePath(e,!1)}),t.addEventListener("mouseout",function(){n.pendingTransition||n._animatePath(e,!0)})},r=function(t,i,n,s){t.confirmText=i,t.action=n,t.filter=s;var a=function(){},r=function(){};a=n,r=s,t.addEventListener("click",function(){"true"!==t.getAttribute("data-disabled")&&(o.mask(e.MainContainer.getParent()),r().then(function(t){var i=!1;for(var n in t){i=!0;break}i?a(t):o.unmask(e.MainContainer.getParent())}))})};for(var l in t){var c=t[l],h={},d=0,u=0,p=0,m={};for(var f in c.connectors_out){var y;h[(y=t[f]).info.visuorder]={},h[y.info.visuorder]=f,y.info.visuorder<c.info.visuorder?(m[y.info.visuorder]="bottom",d++):y.info.visuorder>c.info.visuorder+1&&(m[y.info.visuorder]="top",u++)}if(c.info.isCurrent&&void 0!==i)c.connectors_out[i]={},console.log(c.connectors_out),h[(y=t[i]).info.visuorder]={},h[y.info.visuorder]=i,y.info.visuorder<c.info.visuorder?(m[y.info.visuorder]="bottom",d++):y.info.visuorder>c.info.visuorder+1&&(m[y.info.visuorder]="top",u++);for(var g in this.totTop=u,this.totBot=d,h){f=h[g];var v=this._createSVGEl("path");this.SVGCanvas.appendChild(v);var b=this._createSVGEl("tspan");if(c.info.isCurrent){n._setStateColor(f),t[f].activecolor.includes("emxFramework")?this.transitionColor="#757575":this.transitionColor=t[f].activecolor,v.setAttribute("marker-end","url(#arrow-active)"),v.setAttribute("class","active-path"),v.setAttribute("id",f),v.setAttributeNS("state","to",c.isDemote?l:f);var S=this._createSVGEl("text"),C=this._createSVGEl("tspan");b.setAttribute("font-weight","bold"),"#FFFFFF"===this.transitionColor?(b.setAttribute("stroke","gray"),b.setAttribute("stroke-opacity","50%"),b.setAttribute("stroke-width","0.5%"),b.setAttribute("fill","none")):(b.setAttribute("stroke",this.transitionColor),b.setAttribute("stroke-width","0.5%"),b.setAttribute("fill","none")),c.info.visuorder>t[f].info.visuorder?(S.appendChild(C),S.appendChild(b)):(S.appendChild(b),S.appendChild(C)),"function"==typeof t[f].action&&(void 0!==c.actionnames[l][f]?C.textContent=c.actionnames[l][f]+" ":C.textContent=a.setTo+" "+t[f].info.stateUserName+" "),this.SVGCanvas.appendChild(S),this.text[f]=S,this.tspan1[f]=b;var A=this._getTransitionConfirmText(l,t);s(S,f),"function"==typeof t[f].action&&"function"==typeof t[f].action&&"function"==typeof t[f].filter&&r(S,A,t[f].action,t[f].filter)}else c.isDemote?(n._setStateColor(l),i=l,v.setAttribute("marker-end","url(#arrow-inactive)"),v.setAttribute("class","inactive-path")):this.stateToElement.find(f).order===this.stateToElement.find(l).order+1?(v.setAttribute("marker-end","url(#arrow-inactive)"),v.setAttribute("class","inactive-path")):(v.setAttribute("marker-end","url(#arrow-hidden)"),v.setAttribute("class","hidden-path"));var I,_,P=c.connectors_in.hasOwnProperty(f),x=this.stateToElement.find(f).order-this.stateToElement.find(l).order;if(1===x?(I="right",_="left"):-1===x?P?(I="bottom",_="bottom"):(I="left",_="right"):x>1?(I="top",_="top"):x<-1&&(I="bottom",_="bottom"),"function"==typeof t[f].action&&(c.info.visuorder>t[f].info.visuorder?b.textContent="« ":c.isDemote?b.textContent="« ":b.textContent="» "),"top"===_){var w=u,E=++this.stateToElement.find(f).numConnectors[_];u--,p++}else if("bottom"===_){w=d,E=++this.stateToElement.find(f).numConnectors[_];this.space=d,d--}else w=++this.stateToElement.find(l).numConnectors[I],E=++this.stateToElement.find(f).numConnectors[_];this.paths.push({path:v,from:l,fromConnectOrder:w,to:f,toConnectOrder:E,opts:{connectFrom:I,connectTo:_,numConn:w,topHeight:p,totTop:this.totTop,totBot:this.totBot}})}}},_drawConnectors:function(){if(this.currentConnectorMargins){var t={ptsTop:[],ptsBottom:[],height:this.currentConnectorMargins.height,padding:this.currentConnectorMargins.padding,calcHeight:function(t,e,i){var n=0,o=this.normalizePt(t);return"top"===e?(n=this.numIntersects(o,this.ptsTop),this.ptsTop.push(o)):"bottom"===e&&(n=this.numIntersects(o,this.ptsBottom),this.ptsBottom.push(o)),this.height+this.padding*n+i*i*i*n},numIntersects:function(t,e){var i=0,n=function(t,e){return t<e.p2&&t>e.p1};return e.forEach(function(e){n(t.p1,e)?i=1:n(t.p2,e)?i=1:n(e.p1,t)?i=1:n(e.p2,t)&&(i=1)}),i},normalizePt:function(t){return{p1:Math.min(t.p1,t.p2),p2:Math.max(t.p1,t.p2)}}};this.paths.forEach(function(e){var i=this.stateToElement.find(e.from),n=i.element,o=this.stateToElement.find(e.to),s=o.element,a={fromConnectorOrder:e.fromConnectOrder,toConnectorOrder:e.toConnectOrder,numConnectorsFrom:i.numConnectors[e.opts.connectFrom],numConnectorsTo:o.numConnectors[e.opts.connectTo],connectorSize:this.currentConnectorMargins.connectorSize,heightCalc:t},r={};UWA.extend(r,e.opts),UWA.extend(r,a),(""!=e.path.id||"bottom"!=r.connectTo&&"top"!=r.connectTo)&&this._drawLine(e.path,n,s,r)},this);for(var e=document.getElementsByClassName("active-path"),i=0,n=0;n<e.length;n++){var o=e[n].getBoundingClientRect().height;o>i&&(i=o)}var s=2*i+80+5+"px";this.parentContainer.setStyles({height:s})}},_drawLine:function(t,e,i,n){var o=function(t,e,i){var n=function(t,e,i){return 1===i.numConnectors?t+e/2:t+(e-i.numConnectors*i.size)/2+i.size/2+i.size*(i.connectOrder-1)},o={x:0,y:0},s=t.getBoundingClientRect(),a=s.right-s.left,r=s.bottom-s.top,l=t.offsetLeft,c=t.offsetTop;return"right"===e?(o.x=l+a,o.y=n(c,r,i)):"top"===e?(i.p2?o.x=l+a/2:o.x=l+a/(i.totTop+1)*i.numConn-i.numConn,o.y=c):"bottom"===e?(i.p2?o.x=l+a/2:o.x=l+a/(i.totBot+1)*i.numConn-i.numConn,o.y=c+r):"left"===e&&(o.x=l,o.y=n(c,r,i)),o},s=function(t,e){return t+" "+e.x+" "+e.y+" "},a=o(e,n.connectFrom,{connectOrder:n.fromConnectorOrder,numConnectors:n.numConnectorsFrom,size:n.connectorSize,totTop:n.totTop,totBot:n.totBot,numConn:n.numConn,p2:!1}),r=s("M",a),l=o(i,n.connectTo,{connectOrder:n.toConnectorOrder,numConnectors:n.numConnectorsTo,size:n.connectorSize,totTop:n.totTop,totBot:n.totBot,numConn:n.numConn,p2:!0}),c=s("L",l),h="";if("bottom"===n.connectTo||"top"===n.connectTo){var d=this.currentConnectorMargins.height*n.topHeight+5*n.topHeight;"bottom"===n.connectTo&&(d=this.currentConnectorMargins.height*n.numConn+5*n.numConn);var u={};u.x=a.x,u.y=a.y+("top"===n.connectTo?-d:d);var p=s("L",u),m={};m.x=l.x,m.y=l.y+("top"===n.connectTo?-d:d);var f=s("L",m);if(""!=t.id){if(this.text[t.id].setAttribute("class","textclass"),this.text[t.id].setAttribute("font-family","Arial"),e.hasClassName("lcm-state")?(this.text[t.id].setAttribute("font-size","12"),this.tspan1[t.id].setAttribute("font-size","22")):e.hasClassName("lcm-state-m")?(this.text[t.id].setAttribute("font-size","9"),this.tspan1[t.id].setAttribute("font-size","16")):(this.text[t.id].setAttribute("font-size","6"),this.tspan1[t.id].setAttribute("font-size","14")),this.text[t.id].setAttribute("fill","#368ec4"),"top"===n.connectTo){var y=u.x>m.x?m.x:u.x;this.text[t.id].setAttribute("text-anchor","start")}else{y=u.x>m.x?u.x:m.x;this.text[t.id].setAttribute("text-anchor","end")}this.text[t.id].setAttribute("x",y),this.text[t.id].setAttribute("y",m.y+("top"===n.connectTo?-5:15))}h=r+p+f+c}else{var g={x:0,y:0},v="";if(a.y!==l.y&&a.x!==l.x&&(g.x=a.x,g.y=l.y),0!==g.x&&(v=s("L",g)),""!=t.id){d=n.heightCalc.calcHeight({p1:a.x,p2:l.x},n.connectTo);this.text[t.id].setAttribute("class","textclass fade-in"),this.text[t.id].setAttribute("font-family","Arial"),e.hasClassName("lcm-state")?(this.text[t.id].setAttribute("font-size","12"),this.tspan1[t.id].setAttribute("font-size","22")):e.hasClassName("lcm-state-m")?(this.text[t.id].setAttribute("font-size","9"),this.tspan1[t.id].setAttribute("font-size","16")):(this.text[t.id].setAttribute("font-size","6"),this.tspan1[t.id].setAttribute("font-size","14")),this.text[t.id].setAttribute("fill","#368ec4");y=l.x;this.text[t.id].setAttribute("text-anchor","start"),this.text[t.id].setAttribute("x",y),this.text[t.id].setAttribute("y",l.y+40)}h=r+v+c}t.setAttribute("d",h),this._patchIEPathBug(t)},_isIE11:function(){return this._browserCheck=this._browserCheck||{isIE11:/Trident\/7\./.test(navigator.userAgent)},this._browserCheck.isIE11},_patchIEPathBug:function(t){if(this._isIE11()){var e=t.parentNode;e.removeChild(t),e.appendChild(t)}},_createSVGEl:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},_createSVGEndArrow:function(t){var e=this._createSVGEl("marker"),i=this._createSVGEl("defs"),n=this._createSVGEl("path");return e.appendChild(n),i.appendChild(e),e.setAttribute("id",t),e.setAttribute("markerWidth","10"),e.setAttribute("markerHeight","8"),e.setAttribute("refX","9"),e.setAttribute("refY","4"),e.setAttribute("orient","auto"),n.setAttribute("d","M 3 1 L 10 4 L 3 7"),n.setAttribute("class",t),i},_createSVGCanvas:function(){var t=this._createSVGEl("svg");t.setAttribute("id","svgCanvas"),t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("xmlns:state","http://www.lc.com/state"),UWA.extendElement(t).inject(this.SVG_container),this.SVGCanvas=t}})}),define("DS/MaturityWidget/MaturityTransitionFilters",["UWA/Promise"],function(t){"use strict";function e(){var t=[],e=[],i=[];e=[];t.VPMReference=[],t.Drawing=[],t.SoftwareLogicalItem=[],t.SemiconductorLogicalItem=[],t.MaturityAllTypes=[],e.VPMReference=[],e.Drawing=[],e.SoftwareLogicalItem=[],e.SemiconductorLogicalItem=[],e.MaturityAllTypes=[],require(["DS/MaturityWidget/MaturityConfirmationDialogFilter"],function(e){i["MaturityConfirmation.showConfirmationDialog"]=e.showConfirmationDialog,t.MaturityAllTypes.push("MaturityConfirmation.showConfirmationDialog")},function(){});var n="DS/ENOXSoftwareExt/Lifecycle/MaturityFilters";require([n],function(e){i["ENOSoftExt.PromoteDynamicSelector"]=e.PromoteDynamicSelector,t.SoftwareLogicalItem.push("ENOSoftExt.PromoteDynamicSelector"),t.VPMReference.push("ENOSoftExt.PromoteDynamicSelector")},function(){});n="DS/ENOXSemiExt/Lifecycle/MaturityFilters";require([n],function(e){i["ENOSemiExt.PromoteDynamicSelector"]=e.PromoteDynamicSelector,t.SemiconductorLogicalItem.push("ENOSemiExt.PromoteDynamicSelector")},function(){}),this.typeFilterKeys=t,this.typeActionKeys=e,this.filterMap=i,this.actionMap=[],this.interfaceMap=[]}return e.prototype={fetchTypeFilterKeys:function(t,e){var i=[];if("MaturityAllTypes"in this.typeFilterKeys)for(var n=this.typeFilterKeys.MaturityAllTypes,o=0;o<n.length;o++)if(n[o]in this.interfaceMap){var s=this.interfaceMap[n[o]];for(var a in e)if(a in s){i.push(n[o]);break}}else i.push(n[o]);if(t in this.typeFilterKeys)for(n=this.typeFilterKeys[t],o=0;o<n.length;o++)if(n[o]in this.interfaceMap){s=this.interfaceMap[n[o]];for(var a in e)if(a in s){i.push(n[o]);break}}else i.push(n[o]);return i.length>0?i:["default"]},fetchTypeFilter:function(e){return e in this.filterMap?this.filterMap[e]:function(e,i){return new t(function(t,i){for(var n=[],o=0;o<e.length;o++)n[e[o].physicalid]="";t(n)})}},fetchTypeActionKeys:function(t,e){if(t in this.typeActionKeys){for(var i=this.typeActionKeys[t],n=[],o=0;o<i.length;o++)if(i[o]in this.interfaceMap){var s=this.interfaceMap[i[o]];for(var a in e)if(a in s){n.push(i[o]);break}}else n.push(i[o]);if(n.length>0)return n}return["default"]},fetchActionFilter:function(t){return t in this.actionMap?this.actionMap[t]:null}},new e}),define("DS/MaturityWidget/MaturityController",["UWA/Controls/Abstract","UWA/Class/Promise","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityModel","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","DS/WAFData/WAFData","DS/LifecycleServices/AssemblyJson","DS/LifecycleCmd/AssemblySelectionUtil","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls","i18n!DS/LifecycleServices/assets/nls/LifecycleServicesNls","DS/ReportingPanel/ReportingPanel"],function(t,e,i,n,o,s,a,r,l,c,h,d){"use strict";return t.extend({tenant:null,init:function(t){this._context=t;this.model=new n,this.policy="VPLM_SMB_Definition",this.tenant=null,this.selectedItems={},this.isPromoteDeomoteBothServiceUsed=!1,this.dataForReportingPanel=[],this.counterforPromoteDemote=0,this.initialSelections={},this.includeStructureFlag=!1,this.statusNls=c.get("MATURITY_Status"),this.titleNls=c.get("MATURITY_Title"),this.typeNls=c.get("MATURITY_Sum_Type"),this.revisionNls=c.get("MATURITY_Revision"),this.orgNls=c.get("MATURITY_Sum_Org"),this.collabNls=c.get("MATURITY_Sum_Collab"),this.completionNls=c.get("MATURITY_Result"),this.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:this.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:this.titleNls,dataIndex:this.titleNls},{text:this.typeNls,dataIndex:this.typeNls},{text:this.revisionNls,dataIndex:this.revisionNls},{text:this.orgNls,dataIndex:this.orgNls},{text:this.collabNls,dataIndex:this.collabNls},{text:this.completionNls,dataIndex:this.completionNls}]},initGraph:function(t,e){var i=this;i.initialSelections=t,o.getSecurityContextPromise(this.tenant,this._context).then(function(n){null==n&&i.dispatchEvent("onError",{errorMsg:c.ErrorSecurityContextEmpty}),i.securityContext=n,i._getMaturityGraph(t,null,e,n,!0)})},promote:function(t){var e=this;o.getSecurityContextPromise(this.tenant,this._context).then(function(i){e._changeMaturity("promote",t,i)})},demote:function(t){var e=this;o.getSecurityContextPromise(this.tenant,this._context).then(function(i){e._changeMaturity("demote",t,i)})},expandStructure:function(t,e,i,n){var s=this;o.getSecurityContextPromise(this.tenant,this._context).then(function(o){s._getExpandedAssembly(o,t,e,i,n)})},_getExpandedAssembly:function(t,e,i,n,o){var l={intent:"explore_2D",debug:!0,roots:[{id:e}],level:"-1",source:"cstorage",authored:i},h=s.get3DSpaceWSUrl(this.tenant,"/resources/enopad/lwc/expand",null),d=this;a.authenticatedRequest(h,{method:"POST",headers:s.getHeaders(encodeURIComponent(t)),timeout:36e5,data:JSON.stringify(l),type:"json",onComplete:function(s){s.results&&0==s.results.length&&!i&&(console.log("expandStructure: No data in results, retrying with authored (non-index)"),d._getExpandedAssembly(t,e,!0,n,o));var a=r.convertFromExpandFormat(s),l=d._parseAssembly(a,t);d._getMaturityGraph({data:l},n,o,t,!1)},onFailure:function(s){if(console.error("expandStructure: onFailure -> "+s),i)throw LifecycleWidgetNls.timeout;console.log("expandStructure: Failure with index request, retrying with authored (non-index)"),d._getExpandedAssembly(t,e,!0,n,o),"function"==typeof o&&o()},onTimeout:function(){var t={};t.errorMsg=c.connectionTimeout,t.type="warning",d.dispatchEvent("onError",t)}})},_parseAssembly:function(t,e){var i=null;if(null!=t&&t.hasOwnProperty("nodes")){var n=t.nodes;i=(new l).getSelection(e,n)}return i},_getMaturityGraph:function(t,e,i,n,r){var l,d=this;this.selectionSize="",null!=t&&t.hasOwnProperty("data")&&t.data instanceof Array&&(this.selectionSize=t.data.length);var u=s.getHeaders(encodeURIComponent(n));if(u["X-Requested-With"]="XMLHttpRequest",void 0!==this.model.serviceurl&&this.model.serviceurl){var p=this.model.serviceurl+"getStateGraph";l=p+(p.indexOf("?")<0?"?":"&")+"tenant="+d.tenant,void 0!==this.multiservicSecurityContext&&this.multiservicSecurityContext&&(u.SecurityContext=this.multiservicSecurityContext)}else l=s.get3DSpaceWSUrl(d.tenant,"/resources/lifecycle/maturity/getStateGraph",null);var m=function(t){"function"==typeof i&&i(t)};a.authenticatedRequest(l,{method:"POST",type:"json",headers:u,timeout:36e5,data:JSON.stringify(t),onComplete:function(t){console.log("MaturityInfos: COMPLETED"),console.log(t);var i,n=t.status,o=n.code;n.hasOwnProperty("errorMsg")?null!==n.errorMsg?m(n.errorMsg):0===o&&(d.selectedItems.data=t.data.objects,d.model.setMaturityGraph(t),r?d.dispatchEvent("onGraphInfoChanged"):(i=t,"function"==typeof e&&e(i))):(d.model.clear(),m(c.maturityGraphFailed))},onFailure:function(t,e){console.log("attributes:Failure..."+t);var i=t;if(t instanceof Error&&(i=t.message),i.endsWith('return ResponseCode with value "504".')){var n=h.replace(h.getStateGraphSelection,{numberOfSelectedItems:d.selectionSize})+"."+h.getStateGraphSelectionTimeout,s={};s.errorMsg=n,s.type="warning",s.sticky=!0,d.dispatchEvent("onError",s)}else m(o.parseWebServiceError(t,e))},onTimeout:function(){var t={};t.errorMsg=h.maturityTimeoutInfo,t.type="info",t.sticky=!0,d.dispatchEvent("onError",t)}})},_changeMaturity:function(t,e,i){var n,r=this,l="null",u=s.getHeaders(encodeURIComponent(i));if(u["X-Requested-With"]="XMLHttpRequest",void 0!==this.model.serviceurl&&this.model.serviceurl){var p=this.model.serviceurl+t;n=p+(p.indexOf("?")<0?"?":"&")+"tenant="+r.tenant,void 0!==this.multiservicSecurityContext&&this.multiservicSecurityContext&&(u.SecurityContext=this.multiservicSecurityContext)}else n=s.get3DSpaceWSUrl(r.tenant,"/resources/lifecycle/maturity/"+t,null);var m=r.model.getChangeActionId();return m&&m.trim().length>0&&(u["DS-Change-Authoring-Context"]="pid:"+m),e.notificationTimeout=3600,console.log(t+":"),console.log(e),r.dataToSend=e,a.authenticatedRequest(n,{method:"POST",type:"json",headers:u,timeout:36e5,data:JSON.stringify(e),onComplete:function(e){console.log(t+": COMPLETED"),console.log(e),l=e;e.data=[];for(var i=e.results,n={data:[]},o=0;o<i.length;o++){var s=r.model.getAttribute(i[o].physicalid,"current");void 0===s&&(s=i[o].current);var a=i[o].current,h=null;i[o].hasOwnProperty("cestamp")&&(h=i[o].cestamp);var u=null;i[o].hasOwnProperty("modified")&&(u=i[o].modified),r.model.setAttribute(i[o].physicalid,"current",i[o].current),r.model.setAttribute(i[o].physicalid,"cestamp",h),r.model.setAttribute(i[o].physicalid,"modified",u);var p={physicalid:i[o].physicalid,tostate:a,fromstate:s};n.data.push(p),e.data.push(p)}if(r.model.isWebInWin)r.dispatchEvent("onStateChanged",e);else{if(r.includeStructureFlag){if("success"==e.status)return n.dontshowsuccess=!1,void r.dispatchEvent("onStateChanged",n);if("failure"==e.status){n.dontshowsuccess=!0;for(o=0;o<r.selectedItems.data.length;o++)if(r.selectedItems.data[o].physicalid===r.initialSelections.data[0].physicalid&&e.report[0].hasOwnProperty("error")){var m=e.report[0].error;m.contains("\n")&&(m=m.replaceAll("\n"," ")).contains("1500168")&&(m=m.replaceAll("1500168",""));var f=M(r.selectedItems.data[o],"Failed",m);return r.dataForReportingPanel.push(f),d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),void r.dispatchEvent("onStateChanged",n)}}}var y={};if(r.counterforPromoteDemote=r.counterforPromoteDemote+1,"failure"===e.status){var g=e.report,v=g.length,b=[],S="";1==v&&((S=g[0].error).contains("1500168")||S.contains("all requirements not satisfied"))&&(S=c.get("MATURITY_FAIL_PERMISSION"));var C=[],A=[],I=!1,_="";for(o=0;o<r.selectedItems.data.length;o++)for(var P=0;P<g.length;P++){var x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type;r.selectedItems.data[o].physicalid===g[P].physicalids[0]&&0==x&&(_=r.selectedItems.data[o].displayName)}for(o=0;o<r.selectedItems.data.length;o++){I=!1;for(P=0;P<g.length;P++){C=[];x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type;if(r.selectedItems.data[o].physicalid===g[P].physicalids[0]&&0==x){((S=g[P].error).contains("1500168")||S.contains("all requirements not satisfied"))&&(S=c.get("MATURITY_FAIL_PERMISSION")),C=M(r.selectedItems.data[o],"Failed",S),_=null!=r.selectedItems.data[o].displayName?r.selectedItems.data[o].displayName:r.selectedItems.data[o].name,A.push(C),r.dataForReportingPanel.push(C),console.log("1:  "+C),I=!0;for(var w=0;w<r.dataToSend.data.length;w++)r.dataToSend.data[w].physicalid===g[P].physicalids[0]&&r.dataToSend.data.splice(w,1)}}if(0==I)for(var E=0;E<n.data.length;E++){C=[];x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type;if(r.selectedItems.data[o].physicalid===n.data[E].physicalid&&0==x){C=n.data[E].fromstate==n.data[E].tostate&&n.data[E].fromstate==r.selectedItems.data[o].current?M(r.selectedItems.data[o],"Failed",""==_&&""!=S?c.get("MaturityFailedDependencyDoc"):c.get("MaturityFailedDependency{0}").format(_)):M(r.selectedItems.data[o],"Success",c.get("MaturitySuccess")),A.push(C),r.dataForReportingPanel.push(C),console.log("31:  "+C),I=!0;for(w=0;w<r.dataToSend.data.length;w++)r.dataToSend.data[w].physicalid===n.data[E].physicalid&&r.dataToSend.data.splice(w,1)}}if(0==I){for(P=0;P<r.dataToSend.data.length;P++){C=[];x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type;if(r.selectedItems.data[o].physicalid===r.dataToSend.data[P].physicalid&&0==x){C=M(r.selectedItems.data[o],"Failed",""==_&&""!=S?c.get("MATURITY_FAIL_PERMISSION"):c.get("MaturityFailedDependency{0}").format(_)),A.push(C);for(w=0;w<r.dataForReportingPanel.length;w++)if(r.dataForReportingPanel[w][0]===C[0]){r.dataForReportingPanel.splice(w,1);break}r.dataForReportingPanel.push(C),console.log("11:  "+C),I=!0}}if(0==I)if(2==r.counterforPromoteDemote&&r.isPromoteDeomoteBothServiceUsed||0==r.isPromoteDeomoteBothServiceUsed)if(0==(x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type)){var D=!0;if(0==r.isPromoteDeomoteBothServiceUsed)D=!0;else if(2==r.counterforPromoteDemote&&r.isPromoteDeomoteBothServiceUsed){var T=!1;for(P=0;P<r.dataForReportingPanel.length;P++)if(r.dataForReportingPanel[P][0]===r.selectedItems.data[o].physicalid){T=!0;break}D=0==T}D&&(C=M(r.selectedItems.data[o],"Failed",""==_&&""!=S?c.get("MATURITY_FAIL_PERMISSION"):c.get("MaturityFailed")),r.dataForReportingPanel.push(C),A.push(C),console.log("2:  "+C))}}}n.dontshowsuccess=!1,r.selectedItems.data[0].hasOwnProperty("isODT")||(r.cols.length>9&&(r.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:r.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:r.titleNls,dataIndex:r.titleNls},{text:r.typeNls,dataIndex:r.typeNls},{text:r.revisionNls,dataIndex:r.revisionNls},{text:r.orgNls,dataIndex:r.orgNls},{text:r.collabNls,dataIndex:r.collabNls},{text:r.completionNls,dataIndex:r.completionNls}]),r.isPromoteDeomoteBothServiceUsed?2==r.counterforPromoteDemote&&(W(r.dataForReportingPanel)&&(n.dontshowsuccess=!0),d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),r.dataForReportingPanel=[]):"promote"===t&&!1===r.isPromoteDeomoteBothServiceUsed?W(r.dataForReportingPanel)&&(n.dontshowsuccess=!0,d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),r.dataForReportingPanel=[]):"demote"===t&&!1===r.isPromoteDeomoteBothServiceUsed&&W(r.dataForReportingPanel)&&(n.dontshowsuccess=!0,d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),r.dataForReportingPanel=[]));for(o=0;o<v&&o<10;o++)r.model.objects[g[o].physicalids]&&r.model.objects[g[o].physicalids].displayName&&!g[o].error.contains(r.model.objects[g[o].physicalids].displayName)?b.push(r.model.objects[g[o].physicalids].displayName+": "+g[o].error+" "+c.maturityFailure):b.push(g[o].error+"\n\n"+c.maturityFailure);v>10&&b.push(c.replace(c.maturityAdditionalErrorMessage,{maxErrors:10..toString(),lineBreak:"\n",numErrors:(v-10).toString()})+"\n\n"+c.maturityFailure),y.errorMsg=b,y.type="error",y.dontshowsuccess=!0,r.dispatchEvent("onError",y),n.data.length>0&&r.dispatchEvent("onStateChanged",n)}else if(n.data.length>0){for(C=[],A=[],I=!1,o=0;o<r.selectedItems.data.length;o++){I=!1;for(P=0;P<n.data.length;P++){C=[];x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type;if(r.selectedItems.data[o].physicalid===n.data[P].physicalid&&0==x){C=M(r.selectedItems.data[o],"Success",c.get("MaturitySuccess")),A.push(C);for(w=0;w<r.dataForReportingPanel.length;w++)if(r.dataForReportingPanel[w][0]===C[0]){r.dataForReportingPanel.splice(w,1);break}r.dataForReportingPanel.push(C),console.log("3:  "+C),I=!0;for(w=0;w<r.dataToSend.data.length;w++)r.dataToSend.data[w].physicalid===n.data[P].physicalid&&r.dataToSend.data.splice(w,1)}}if(0==I)if(2==r.counterforPromoteDemote&&r.isPromoteDeomoteBothServiceUsed||0==r.isPromoteDeomoteBothServiceUsed)if(0==(x=1==r.selectedItems.data[o].isOnceInstantiable&&"3DShape"==r.selectedItems.data[o].type)){D=!0;if(0==r.isPromoteDeomoteBothServiceUsed)D=!0;else if(2==r.counterforPromoteDemote&&r.isPromoteDeomoteBothServiceUsed){for(T=!1,P=0;P<r.dataForReportingPanel.length;P++)if(r.dataForReportingPanel[P][0]===r.selectedItems.data[o].physicalid){T=!0;break}D=0==T}D&&(C=M(r.selectedItems.data[o],"Failed",c.get("MaturityFailed")),A.push(C),r.dataForReportingPanel.push(C),console.log("4:  "+C))}}n.dontshowsuccess=!1,r.selectedItems.data[0].hasOwnProperty("isODT")||(r.cols.length>9&&(r.cols=[{text:"ID",dataIndex:"ID",isHidden:!0},{text:"StatusToolTipColumn",dataIndex:"statusTooltip",isHidden:!0,tooltipColumn:"Status"},{text:r.statusNls,dataIndex:"Status",typeRepresentation:"icon"},{text:r.titleNls,dataIndex:r.titleNls},{text:r.typeNls,dataIndex:r.typeNls},{text:r.revisionNls,dataIndex:r.revisionNls},{text:r.orgNls,dataIndex:r.orgNls},{text:r.collabNls,dataIndex:r.collabNls},{text:r.completionNls,dataIndex:r.completionNls}]),r.isPromoteDeomoteBothServiceUsed?2==r.counterforPromoteDemote&&W(r.dataForReportingPanel)&&(n.dontshowsuccess=!0,d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),r.dataForReportingPanel=[]):"promote"===t&&!1===r.isPromoteDeomoteBothServiceUsed?W(r.dataForReportingPanel)&&(n.dontshowsuccess=!0,d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),r.dataForReportingPanel=[]):"demote"===t&&!1===r.isPromoteDeomoteBothServiceUsed&&W(r.dataForReportingPanel)&&(n.dontshowsuccess=!0,d.launchReportingPanel(r.dataForReportingPanel,r.cols,null),r.dataForReportingPanel=[])),r.dispatchEvent("onStateChanged",n)}}function M(t,e,i){var n=[];return n.push(t.physicalid),"Failed"===e?n.push(c.get("MATURITY_FAIL_STATUS")):"Success"===e&&n.push(c.get("MaturitySuccess")),n.push(e),null!=t.displayName||null!=t.displayName?n.push(t.displayName):n.push(t.name),n.push(t.typeDisplayName),n.push(t.revision),null==t.organizationTitle||null==t.organizationTitle||""==t.organizationTitle?n.push(t.organization):n.push(t.organizationTitle),null==t.projectTitle||null==t.projectTitle||""==t.projectTitle?n.push(t.project):n.push(t.projectTitle),n.push(i),n}function W(t){for(var e=!1,i=0;i<t.length;i++)if("Failed"==t[i][2]){e=!0;break}return e}},onFailure:function(e,i){console.log(t+":Failure..."+e);var n=o._parseWebServiceError(e,i,!0,"Maturity");void 0!==n&&void 0!==n&&n.hasOwnProperty("message")?(n.errorMsg=n.message,n.type="error",n.hasOwnProperty("isNotificationInfo")&&n.isNotificationInfo&&(n.type="info",n.sticky=!0)):n.errorMsg=o.parseWebServiceError(e,i,!0),r.dispatchEvent("onError",n)},onTimeout:function(){console.log(t+": A connection timeout occured.");var e={};e.errorMsg=h.maturityTimeoutInfo,e.type="info",e.sticky=!0,r.dispatchEvent("onError",e)}}),l},getGraphInfo:function(){return this.model.getGraphInfo()},getStateInfos:function(t){return this.model.getStateInfos(t)},setTenant:function(t){this.tenant=t}})}),define("DS/MaturityWidget/MaturityWidget",["css!DS/MaturityWidget/MaturityWidget","UWA/Controls/Abstract","UWA/Promise","DS/Controls/Toggle","DS/PlatformAPI/PlatformAPI","DS/MaturityWidget/MaturityController","DS/MaturityWidget/MaturityModel","DS/MaturityWidget/MaturityGraph","DS/MaturityWidget/MultiselUI","DS/MaturityWidget/MaturityTransitionFilters","DS/LifecycleControls/CommandDialog","DS/LifecycleServices/Utils","DS/LifecycleCmd/MessageMediator","DS/LifecycleControls/ProgressDialog","DS/LifecycleServices/LifecycleAlert","DS/LifecycleServices/UUIDGenerator","DS/LifecycleServices/LifecycleServices","DS/LifecycleServices/LifecycleServicesSettings","i18n!DS/LifecycleWidget/assets/nls/LifecycleWidgetNls"],function(t,e,i,n,o,s,a,r,l,c,h,d,u,p,m,f,y,g,v){"use strict";var b=!0;return e.extend({displayWorkflowGraph:!0,hostedInDialog:!1,context:null,uuid:null,maskDelay:3e3,onKeyDownHandler:null,multiSelUITitle:null,sizePrefKey:"maturityDlgSize",isWebInWin:!1,canPromoteOrDemote:!0,numInitSelection:0,isEmbeddedUI:!1,PADSession:null,hasRequestedPADSession:!1,initialSelection:null,isMultipleSelection:!1,sizebeforeadvanced:null,init:function(t){this.uuid=f.create();var e=t||{type:""};this._parent(e),this.elements.content=UWA.createElement("div",{class:"lcm-maturity-content"}),this.elements.container=this.elements.content,this.maturityGraphContainer=UWA.createElement("div",{class:"lcm-maturity-container"}),this.maturityGraphContainer.inject(this.elements.content,"top"),void 0!==e.context&&null!=e.context&&(this.context=e.context),void 0!==e.isWebInWin&&null!=e.isWebInWin&&(this.isWebInWin=e.isWebInWin);var i=null;e&&e.hasOwnProperty("externalSettings")&&e.externalSettings&&(i=e.externalSettings),g.app_initialization(function(){},i),this.controller=new s(this.context),this.controller.multiservicSecurityContext=e.securitycontext,this.model=this.controller.model,this.model.isWebInWin=this.isWebInWin,this._setupEventSubscriptions()},_setupEventSubscriptions:function(){var t=this;o.subscribe("Lifecycle.Modification",function(e){t._externalRefresh(JSON.parse(e))}),this.addEvent("onPostInject",function(){t.isEmbeddedUI=!0});var e=this.controller;e.addEvent("onStateChanged",function(e){document.body.style.cursor="default";var i=[],n=[];for(var o in e.data.forEach(function(e){var o=t.model.getAttribute(e.physicalid,"type"),s=t.model.getAttribute(e.physicalid,"revision"),a=t.model.getAttribute(e.physicalid,"policy"),r=t.model.getAttribute(e.physicalid,"name"),l=t.model.getAttribute(e.physicalid,"coretype"),h=t.model.getAttribute(e.physicalid,"interfaceHash"),d=t.model.getAttribute(e.physicalid,"cestamp"),u=t.model.getAttribute(e.physicalid,"current"),p=t.model.getAttribute(e.physicalid,"modified"),m={physicalid:e.physicalid,tostate:e.tostate,fromstate:e.fromstate,type:o,revision:s,policy:a,name:r,coretype:l,interfaceHash:h},f={physicalid:e.physicalid,type:o,name:r,coretype:l,cestamp:d,current:u,modified:p};n.push(f);for(var y=c.fetchTypeActionKeys(o,h),g=0;g<y.length;g++){var v=y[g];v in i||(i[v]=[]),i[v].push(m)}}),i){var s=i[o],a=function(){};if(null!==(a=c.fetchActionFilter(o)))a(s,{maturityWidget:t,securityContext:t.controller.securityContext,maturityGraphContainer:t.maturityGraphContainer})}if(t.isWebInWin&&t.options.webInWinHelper&&(e.dontshowsuccess=!0,t.options.webInWinHelper.fireWintopMaturityCompletedCommandWithArgs(t.options.webToWinComSocket,e,t.options.OnCompletedFireCommand),t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)),t.options.wintop&&t.options.webInWinHelper){var r;if(e.dontshowsuccess=!0,t.options.webToWinComSocket)null!=n&&n.length>0&&(r=t.options.webInWinHelper.createMaturityJSONArray(n)),t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:"warning",message:v.maturitySuccess}},"lf_web_in_win"),t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onMaturityModification",notif_parameters:r},"lf_web_in_win");t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)}if(e.hasOwnProperty("dontshowsuccess")&&0==e.dontshowsuccess&&this._showNotification("success",v.maturitySuccess),this.maturityGraph&&this.displayWorkflowGraph&&e.hasOwnProperty("data")&&e.data.length>0&&(this.maturityGraph.onEndTransition(e.data[0].tostate),b=!0,this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())),e.hasOwnProperty("data")&&e.data.length>0&&this.newStateInaccessible(e.data)){if(this.context.refresh&&"lifecycle"!=this.context.app)try{this.context.refresh()}catch(t){console.error(t)}var l={created:[],deleted:[],modified:[]};l.context=this,e.data.forEach(function(t){var e={physicalid:t.physicalid,operation:"Promote"};l.deleted.push(e)}),u.dispatchEvent("onModification",l),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}else{if(e.hasOwnProperty("data")&&e.data.length>0&&this._refresh(e.data),e.hasOwnProperty("data")&&e.data.length>0&&this.displayWorkflowGraph){var h;for(h=0;h<e.data.length;h++){var d=this.model.getAttribute(e.data[h].physicalid,"isAggregateRep");if(this.model.getAttribute(e.data[h].physicalid,"policy")&&!d)break}h==e.data.length&&(h=0);var p=this.model.getAttribute(e.data[h].physicalid,"policy"),m=e.data[h].tostate;this._updateGraph(p,m)}this.isEmbeddedUI||(this.dialog&&this.dialog.destroy(),this._onComplete()),t.dispatchEvent("onMaturityTransitionEnd",e)}},this),e.addEvent("onError",function(e){if(document.body.style.cursor="default",t.options.wintop){var i="";if(e&&e.hasOwnProperty("errorMsg"))if(Array.isArray(e.errorMsg))for(const t of e.errorMsg)i+=t;else i=e.errorMsg;var n=v.maturityFailure;i.trim().length>0&&(n=i),t.options.webToWinComSocket&&t.options.webToWinComSocket.dispatchEvent("onDispatchToWin",{notif_name:"onDisplayErrorMessage",notif_parameters:{severity:"warning",message:n}},"lf_web_in_win"),t.options.webInWinHelper.closePanel(t.options.webToWinComSocket)}else{if(null!=e&&e.hasOwnProperty("type"))var o=e.type;e.hasOwnProperty("dontshowsuccess")||this.displayError(e,o)}this._closeDialog(),this.maturityGraph&&(this.maturityGraph.onEndTransition(),b=!0,this.dialog&&(this.dialog.updateUI(),this.dialog._disableOK(),this.dialog.destroy())),this.isEmbeddedUI?this._refreshGraph():this._onComplete()},this),e.addEvent("onGraphInfoChanged",function(){this._postInitGraph(),this._buildGraph()},this),this.model=this.controller.model},executeCmd:function(t,e,i){this.addEvent("onReady",function(t){this._showCommandUI(t.displayWorkflowGraph,t.policy)},this),this.addEvent("onComplete",function(){i()}),this.context=e.context,this.controller._context=this.context,this.hostedInDialog=!0,this.setObjects(t),this.isWebInWin?e.context.options&&e.context.options.hasOwnProperty("change")&&this.model.setChangeAction(e.context.options.change):this.options.wintop?e.context.options&&e.context.options.hasOwnProperty("ChangeActionId")&&this.model.setChangeAction({id:e.context.options.ChangeActionId}):e&&e.hasOwnProperty("change")&&this.model.setChangeAction(e.change)},getUUID:function(){return this.uuid},onResize:function(){this.isWebInWin&&this.dialog},setWidgetSize:function(t){this.floatingDlg._maximize(),this.floatingDlg.centerIt(),this.options.wintop?this.floatingDlg.setNewBodySize(t):this.isWebInWin&&this.floatingDlg.setNewSize(t),this.elements.content.setStyle("width",t.width+"px")},_onOk:function(){this.onOkClicked&&this.onOkClicked(this),this._onComplete()},_onComplete:function(){this.dispatchEvent("onComplete"),this.maturityGraph&&this.maturityGraph.destroy(),this.onKeyDownHandler&&(document.onkeydown=this.onKeyDownHandler),this.refreshSub&&(this.refreshSub.unsubscribe(),this.refreshSub=null)},_showCommandUI:function(t,e){var i=this;this.displayWorkflowGraph=t;var n=t,o=this,s=new h,a=!0,r=!0;this.isWebInWin&&(a=!1),this.options.wintop&&(r=!1);var l=s.create(this.elements.content,{title:v.maturity,className:"ENO_Maturity",closeButton:a,maximizable:!1,resizable:r,buttonStyle:n?s.buttonStyle.cancel:s.buttonStyle.okCancel,enableCmd:function(){return this.canPromoteOrDemote},onOk:function(){o._saveDlgSize(),s._disableUI(),o._onOk()},onClose:function(){o._saveDlgSize(),o._onComplete(),o._closeDialog(),i.isWebInWin||i.options.wintop?i.options.webInWinHelper&&i.options.webInWinHelper.closePanel(i.options.webToWinComSocket):i.dispatchEvent("onMaturityCanceled")},onCloseOverride:function(){1==b&&(s._disableUI(),s._onCloseHandler.apply(this._fnContext),s.destroy())},events:{onResizeFloating:function(t){void 0!==o.multiSelUI&&null!==o.multiSelUI&&o.multiSelUI.onPanelResize()}}},this);if(l.inject(widget.body),this.isWebInWin||this.options.wintop)l._maximize();else{var c=this._loadSize(),d=c.width,u=c.height;d<650&&(d=650),u<305&&(u=305);var p=this.displayWorkflowGraph?500:600,m=this.displayWorkflowGraph?250:400;l.setNewSize({width:d,height:u})}setTimeout(function(){if(i.isWebInWin||i.options.wintop){i.floatingDlg._maximize(),i.floatingDlg.centerIt(),i.floatingDlg.setMinSize({width:"100%",height:"100%"});var t=i.floatingDlg.getModalBodySize();t.height=t.maxHeight,t.width=t.maxWidth,i.floatingDlg.setNewBodySize(t),i.elements.content.setStyle("width",t.width+"px")}else l.setMinSize(p,m)},10),this.dialog=s,this.floatingDlg=l,t?(this._createSingleObjectGraphUI(this.model.getMaturityGraph(e)),s.setTitle(this._getCurrentObjectTitleRevision()),this.dialog._cancelButton&&this.dialog._disableOK()):(this.maturityGraphContainer.addClassName("lcm-maturity-container-multisel"),this._createMultiSelectionUI(this.maturityGraphContainer)),this.isWebInWin&&this.options.webInWinHelper?this.options.webInWinHelper.fireWintopCommand(i.options.webToWinComSocket,null,i.options.OnViewReadyFireCommand):i.dispatchEvent("onMaturityUIReady")},_getCurrentObjectTitleRevision:function(){var t=v.maturity,e=this.model.getObjects();if(null!=e){Object.keys(e);var i=e[this.model.originalPid];null!=i&&i.hasOwnProperty("name")&&(t=this.isWebInWin?i.name:t+" - "+i.name,i.hasOwnProperty("revision")&&null!=i.revision&&(t=t+" "+i.revision))}return t},_saveDlgSize:function(){if(this.floatingDlg){var t=this.floatingDlg.getModalBodySize();t.height=this.floatingDlg.getContainerHeight(),t.hasOwnProperty("width")&&t.width>0&&(t.width=t.width+2),this._storeSize(t)}},_loadSize:function(){var t=widget.getValue(this.sizePrefKey);return t?JSON.parse(t):{width:820,height:260}},_storeSize:function(t){widget.getValue(this.sizePrefKey)||widget.addPreference({name:this.sizePrefKey,type:"hidden",defaultValue:"{}"}),widget.setValue(this.sizePrefKey,JSON.stringify(t))},_installCloseOnEscapePatch:function(){var t=this;this.onKeyDownHandler=document.onkeydown,document.onkeydown=function(e){("key"in(e=e||window.event)?"Escape"==e.key||"Esc"==e.key:27==e.keyCode)&&(t._closeDialog(),t.isEmbeddedUI||t._onComplete())}},_externalRefresh:function(t){if(this.displayWorkflowGraph&&UWA.is(t.Refresh,"object")&&UWA.is(t.Refresh.modified,"array")&&this.getUUID()!==t.OriginID&&1==t.Refresh.modified.length){var e=t.Refresh.modified[0];if("Promote"===e.operation){var i=this.model.getObjects()[e.physicalid];null!=i&&i.current!==e.state&&(this.model.changeCurrentObjectState(e.physicalid,e.state),this._updateGraph(e.policy,e.state))}}},_refresh:function(t){var e=this.model,i={created:[],deleted:[],modified:[]};i.context=this,t.forEach(function(t){var n={physicalid:t.physicalid,operation:"Promote",state:t.tostate,policy:e.getAttribute(t.physicalid,"policy")};i.modified.push(n)}),u.dispatchEvent("onModification",i)},_closeDialog:function(){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),this.dialog&&this.dialog.destroy()},newStateInaccessible:function(t){return null===t[0].tostate||void 0===t[0].tostate},setTitle:function(t){this.dialog&&this.dialog.setTitle(t)},_postInitGraph:function(){this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null);this.model.getObjects()},_addIncludeChildrenCheckbox:function(){var t=this;if(null==this.includeChildrenCheckbox){this.optionDlg=document.createElement("div"),this.optionDlg.className="lifecycle-options",this.elements.content.appendChild(this.optionDlg);var e=v.includeDescendants;this.includeChildrenCheckbox=new n({type:"checkbox",label:e}).inject(this.optionDlg)}this.includeChildrenCheckbox.addEventListener("change",function(e){if(e&&e.hasOwnProperty("dsModel")){var i=e.dsModel.checkFlag;t.isWebInWin&&t.options.webInWinHelper?i?t.options.webInWinHelper.fireWintopCommand(t.options.webToWinComSocket,null,t.options.OnIncludeChildrenFireCommand):t.options.webInWinHelper.fireWintopCommand(t.options.webToWinComSocket,null,t.options.OnExcludeChildrenFireCommand):t.dispatchEvent("onIncludeChildrenChanged",{includeChildren:i})}}),this.model.isSingleIRPCAssembly?this.includeChildrenCheckbox.show():null!=this.includeChildrenCheckbox&&this.includeChildrenCheckbox.hide()},getPADSessionPromise:function(){var t=this;return new UWA.Class.Promise(function(e,i){require(["DS/PADUtils/PADSession"],function(i){t.hasRequestedPADSession=!0,t.PADSession=i,e(t.PADSession)},function(i){t.hasRequestedPADSession=!0,t.PADSession=null,e(t.PADSession)})})},_getPADSession:function(){return this.hasRequestedPADSession?UWA.Class.Promise.resolve(this.PADSession):this.getPADSessionPromise()},empty:function(){this.maturityGraph&&this.maturityGraph.destroy(),this.model.clear()},_showNotification:function(t,e,i){var n=this;Array.isArray(e)||"string"!=typeof e||(e=[e]),Array.isArray(e)&&e.length&&e.forEach(function(e){var o={eventID:t,msg:e.split?e.split("\n").join("<br>"):e,sticky:i};null!=n.context&&"function"==typeof n.context.displayNotification?n.context.displayNotification(o):m.displayNotification(o)})},displayError:function(t,e){var i=t;t.hasOwnProperty("errorMsg")&&(i=null!==t.errorMsg?t.errorMsg:t),void 0===e&&t.hasOwnProperty("type")?e=t.type:void 0===e&&(e="warning");var n=!1;null!=t&&t.hasOwnProperty("sticky")&&(n=t.sticky),this._showNotification(e,i,n)},_getFilteredObjects:function(){return this.model.getObjects(function(t){return!t.isOnceInstantiable})},_isObjectsAlreadyLoaded:function(t){var e=!1,i=d.toMaturityArray(this._getFilteredObjects());return 0!==i.length&&(i=i[0],null!=t&&0!==t.length&&(Array.isArray(t)&&t.forEach(function(t){t.hasOwnProperty("physicalid")&&i.hasOwnProperty("physicalid")&&t.hasOwnProperty("current")&&i.hasOwnProperty("current")&&t.physicalid==i.physicalid&&t.current==i.current&&(e=!0)}),e))},setObject:function(t){return this.setObjects([t])},setObjects:function(t){if(this._isObjectsAlreadyLoaded(t))return!1;if(this.numInitSelection=t.length,this.initialSelection=t,this.isEmbeddedUI&&this.empty(),0===t.length)throw v.noObject;var e={};e.data=t;var i=t[0];if(""===i.physicalid)throw v.epmtyPhysicalId;if(this.isWebInWin)this.controller.setTenant(this.options.tenant);else if(null!=i&&i.hasOwnProperty("tenant")&&void 0!==i.tenant&&null!==i.tenant&&i.tenant.trim().length>0)this.controller.setTenant(i.tenant);else if(this.options&&this.options.hasOwnProperty("externalSettings")&&void 0!==this.options.externalSettings&&null!==this.options.externalSettings&&Array.isArray(this.options.externalSettings)&&this.options.externalSettings.length>0){var n=this.options.externalSettings[0];n&&n.hasOwnProperty("platformId")&&this.controller.setTenant(this.options.externalSettings[0].platformId)}this.model.setObjects(t),this.progressDialog&&(this.progressDialog.close(),this.progressDialog=null),this.progressDialog=new p,this.progressDialog.showDelay(document.body,v.maturityGraphInit,3e3);var o=this;return this.controller.initGraph(e,function(t){o._postInitGraph(),o.displayError(t),o._onComplete()}),!0},_createPromotePayload:function(t,e){var i=[];for(var n in e)i.push({physicalid:n,tostate:t,fromstate:e[n].current,type:e[n].type,revision:e[n].revision,policy:e[n].policy,name:e[n].name,coretype:e[n].coretype,interfaceHash:e[n].interfaceHash});var o={};return o.data=i,o},_createGraphStates:function(t,e){var n=this,o=this._getFilteredObjects(),s=UWA.clone(t.states),a=o[this.model.originalPid].current,r=d.toArray(s[a].connectors_in);r.contains=function(t){return this.find(function(e){return e===t})};var l=function(t,e){for(var i={data:[]},n=0;n<t.data.length;n++)e.hasOwnProperty(t.data[n].physicalid)&&i.data.push(t.data[n]);this._promote(i)},c=function(t){return new i(function(e,i){n._filter(t).then(function(t){e(t)})})},h=function(t){this._promote(t)},u=function(t){this._demote(t)};for(var p in s){var m=!1,f=!1,y=!1,g=this._createPromotePayload(p,o);s[p].filter=c.bind(this,g),t.infos.isDemoteAuthorized&&r.contains(p)&&"RELEASED"!=s[p].info.stateSysName.toUpperCase()?(s[p].action=u.bind(this,g),m=!0):t.infos.isDemoteAuthorized?(s[p].action=h.bind(this,g),f=!0):t.infos.isPromoteAuthorized&&(s[p].action=l.bind(this,g),y=!0),s[p].isDemote=m,s[p].isPromote=f,s[p].isDisabled=!(f||m||y),s[p].info.isCurrent=p===a}if(e)for(var v in s)s[v].info.isCurrent=v===e;return s},_buildGraph:function(){var t=[],e=[],i=this.model.getObjects(),n=!0,o=0,s=null;for(var a in i){void 0!==i[a].isAggregateRep&&0!=i[a].isAggregateRep||o++,"Reference"!==i[a].coretype&&(s=!0);var r=i[a].policy;-1===t.indexOf(r)&&t.push(r);var l=i[a].current;-1===e.indexOf(l)&&e.push(l)}var c=v.multipleSelection;if(!0===s){var h=null;for(var d in t)null==h&&(h=this.model.getPolicy(t[d]).maturityGraph.states.length),h!=this.model.getPolicy(r).maturityGraph.states.length&&(n=!1,c=v.multipleSelectionNotSimilar)}o>this.numInitSelection&&!this.isEmbeddedUI&&this._showNotification("info",v.maturityAddedAggReps);var u=i[this.initialSelection[0].physicalid].policy,p={displayWorkflowGraph:!0,policy:u};if(1===o||this.isEmbeddedUI&&o>0)this.hostedInDialog?this.dispatchEvent("onReady",p):this._createSingleObjectGraphUI(this.model.getMaturityGraph(u));else if(!0===n&&o>=1)p.displayWorkflowGraph=!1,this.dispatchEvent("onReady",p);else if(o>=1){var m={};m.errorMsg=c,this.displayError(m,"primary"),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}this.dispatchEvent("buildGraphComplete")},updateOKButton:function(t){this.canPromoteOrDemote=t,this.dialog.updateUI()},_createMultiSelectionUI:function(t){var e=this;this.multiSelUI=new l,this.multiSelUI.create(this.model,t,this,function(t){e.multiSelUITitle=t,e.setTitle(t)})?this.onOkClicked=function(t){e.model.isWebInWin?e.options.webInWinHelper.fireWintopCommand(e.options.webToWinComSocket,null,e.options.OnOkFireCommand):e.dispatchEvent("onMaturityTransitionStart");for(var i=this.multiSelUI.getPromotePayload(),n=this.multiSelUI.getDemotePayload(),o={data:[]},s=0;s<i.data.length;s++)o.data.push(i.data[s]);for(s=0;s<n.data.length;s++)o.data.push(n.data[s]);e._filter(o).then(function(o){var s=!1;for(var a in o){s=!0;break}if(s){for(var r={data:[]},l=0;l<i.data.length;l++)o.hasOwnProperty(i.data[l].physicalid)&&r.data.push(i.data[l]);var c={data:[]};for(l=0;l<n.data.length;l++)o.hasOwnProperty(n.data[l].physicalid)&&c.data.push(n.data[l]);r.data.length>0&&c.data.length>0?t.controller.isPromoteDeomoteBothServiceUsed=!0:t.controller.isPromoteDeomoteBothServiceUsed=!1,document.body.style.cursor="progress",r.data.length>0&&t.controller.promote(r),c.data.length>0&&t.controller.demote(c)}else e.updateOKButton(!0)})}:(this.canPromoteOrDemote=!1,this.dialog.updateUI())},_objectHasWorkflow:function(t){var e,i=0;for(e in t.states)t.states.hasOwnProperty(e)&&i++;return 0!=i},_createSingleObjectGraphUI:function(t){if(this._objectHasWorkflow(t)){void 0!==this.maturityGraph&&null!==this.maturityGraph&&this.maturityGraph.destroy(),this.maturityGraph=new r;var e=this._createGraphStates(t);this.maturityGraph.create(this.maturityGraphContainer,e)}else{var i={};i.errorMsg=v.noMaturityGraph,this.displayError(i,"primary"),this._closeDialog(),this.isEmbeddedUI||this._onComplete()}this._addIncludeChildrenCheckbox()},_updatePendingOperationUI:function(t){this.maturityGraph&&(this.dialog&&this.dialog._disableUI(),b=!1,this.maturityGraph.onStartTransition(t),this.options.webInWinHelper?this.options.webInWinHelper.fireWintopCommand(this.options.webToWinComSocket,null,this.options.OnOkFireCommand):this.dispatchEvent("onMaturityTransitionStart"))},_refreshGraph:function(){if(this.displayWorkflowGraph){var t=this._getFilteredObjects();for(var e in t){var i=t[e].policy,n=t[e].current;this._updateGraph(i,n)}}},_preparePromoteData:function(t,e,i){var n=this.model.originalPid;this.includeChildrenCheckbox.checkFlag?(this.controller.includeStructureFlag=!0,widget&&y.isInPSEditorWidget(widget)?this._getPADSession().then(function(t){var o=!0;t&&(o=t.determineAuthoredFlag()),this.controller.expandStructure(n,o,e,i)}.bind(this)):this.controller.expandStructure(n,!0,e,i)):e()},_filter:function(t){var e=this;return new i(function(n,o){if(0==t.data.length){for(var s=[],a=0;a<t.data.length;a++)s[t.data[a].physicalid]="";n(s)}else{var r=[];for(a=0;a<t.data.length;a++)for(var l=c.fetchTypeFilterKeys(t.data[a].type,t.data[a].interfaceHash),h=0;h<l.length;h++){var d=l[h];d in r||(r[d]=[]);var u=t.data[a];r[d].push(u)}var p=[];for(var m in r){(u=r[m]).filterKey=m,p.push(u)}var f={maturityWidget:e,securityContext:e.controller.securityContext,maturityGraphContainer:e.maturityGraphContainer},y=i.deferred();s=[];e.filterRecurse(p,0,f,y,s,[]),y.promise.then(function(t){n(t)})}})},filterRecurse:function(t,e,n,o,s,a){for(var r=this,l=t[e],h=l.filterKey,d=[],u=0;u<l.length;u++){l[u].physicalid in a||d.push(l[u])}var p=function(){};return p=c.fetchTypeFilter(h),new i(function(t,e){p(d,n).then(function(e){t(e)})}).then(function(i){e++;for(var l=0;l<d.length;l++){(c=d[l].physicalid)in i||(a[c]="")}for(var c in a)c in s&&delete s[c];for(var c in i)s[c]=i[c];if(e<t.length)r.filterRecurse(t,e,n,o,s,a);else o.resolve(s)})},_promote:function(t){var e=this;e._preparePromoteData(t,function(){var i=t.data[0].tostate,n={data:[]};for(var o in e.model.objects){var s=e.model.objects[o];if(s.current==i)s.displayName+"<br>";else if(i in s.routes[s.current]){if(!s.excludeFromPromote){var a="",r=e.model.getAttribute(s.physicalid,"signatures");if(r.hasOwnProperty([s.current])){var l=r[s.current];if(l.hasOwnProperty([i])){var c=Object.keys(l[i]);c.length>0&&"undefined"!=c[0]&&(a=c[0])}}n.data.push({physicalid:s.physicalid,tostate:i,fromstate:s.current,type:s.type,revision:s.revision,policy:s.policy,name:s.name,coretype:s.coretype,signature:a,cadMaster:s.cadMaster})}}else s.displayName+"<br>"}e._updatePendingOperationUI(n.data[0].tostate),e.controller.promote(n)},function(t){e.displayError(t,"primary")})},_demote:function(t){var e=this;e._preparePromoteData(t,function(){var i=t.data[0].tostate,n={data:[]};for(var o in e.model.objects){var s=e.model.objects[o];s.current==i?s.displayName+"<br>":s.excludeFromPromote||n.data.push({physicalid:s.physicalid,tostate:i,fromstate:s.current})}e._updatePendingOperationUI(n.data[0].tostate),e.controller.demote(n)},function(t){e.displayError(t,"primary")})},_updateGraph:function(t,e){if("#DENIED!"!=e){var i=this.model.getMaturityGraph(t),n=this._createGraphStates(i,e);this.maturityGraph.updateGraph(n)}}})});