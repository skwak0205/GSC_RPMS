define("DS/DMUReviewPersistence/DMUReviewMaturityChangeCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting"],function(e,t,n,i){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,a=this,r=e.frameWindow||this.getFrameWindow();this.beginExecute=function(){var e=n.getReviewContext({viewer:r.getViewer()}).getValidation();if(e){var o=n.getEventsController({viewer:r.getViewer()});require(["DS/MaturityWidget/MaturityWidget"].concat([]),function(n){t&&t.dialog&&t.dialog.destroy(),(t=new n({externalSettings:i.getOption("platform_services")})).addEvent("onMaturityCanceled",function(){a.end()}),t.addEvent("onMaturityTransitionEnd",function(t){if(t&&t.data&&t.data.length>0){for(var n=0;n<t.data.length;n++)if(t.data[n]&&t.data[n].physicalid===e.getPlmID()&&t.data[n].tostate){e.setCurrentState(t.data[n].tostate),o&&o.fireEvent("onReviewObjectAttributesModified",{object:e,attr:[{currentState:t.data[n].tostate}]});break}a.end()}else a.end()}),i.getServerContext({onComplete:function(n){t.executeCmd([{physicalid:e.getPlmID(),tenant:i.getTenant()}],{context:{getSecurityContext:()=>({SecurityContext:n})}},()=>{})},onFailure:function(){}})})}else a.end()},this.endExecute=function(){t=null}}})}),define("DS/DMUReviewPersistence/EXPValHighlightContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUValidationExposedPresentation")||-1!==t.indexOf("DMUValidationCheck"))){var n=[];return e[0].getParent().isReadOnly()||(n=this.getContextualMenuCommandList()),n}return[]},getContextualMenuCommandList:function(){return[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/EXPValHighlightsContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e,a){var r=[],o=i.get();if(e&&e.length&&e.forEach(function(e){-1===r.indexOf(e.getType())&&r.push(e.getType())}),1===r.length&&-1!==r.indexOf("Highlights")){var l=[];e[0].isReadOnly()||l.unshift({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),-1!==r.indexOf("Highlights")&&l.unshift({line:1,name:"DMUHideShowThumbnailStr",hdr_list:["DMUHideShowThumbnailHdr"]}),l.unshift({line:1,name:"DMUExpandAllStr",hdr_list:["DMUExpandAllHdr"]}),l.unshift({line:1,name:"DMUCollapseAllStr",hdr_list:["DMUCollapseAllHdr"]});var s=n.getReviewContext({viewer:a});if(!s)return;var d=n.getContextViewer({reviewContext:s});if(!d)return;var c=t.getCommand("DMUDeleteHdr",d.getCommandContext());if(c&&c.enable(),1===o.length&&c)c.disable();else for(let e=0;e<o.length;e++)o[e].pathElement.getLastElement().getDMUType&&"DMUValidationCheck"!==o[e].pathElement.getLastElement().getDMUType()||c&&c.disable();return l}return[]},getContextualMenuCommandList:function(){return[]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices",["UWA/Utils","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUReviewContextInitializer","DS/DMUPlayMarkup/DMUMarkup","DS/DMUBaseWebValidation/EXPValMarkup","DS/DMUBaseWebValidation/EXPValValidation","DS/DMUBaseWebValidation/EXPValContext","DS/DMUBaseWebValidation/EXPValValidated","DS/DMUBaseWebValidation/EXPValCheck","DS/DMUBaseWebValidation/EXPValHighlight","DS/DMUBaseReview/DMULinksManager","DS/DMUBaseUIServices/DMUSlidePreferences","DS/DMUBaseExperience/DMUModelServices","DS/DMUBaseExperience/EXPUtils","DS/DMUValidationPersistence/DMUValidationPersistenceServices","DS/DMUPlaySlide/DMUSlide","DS/DMUBaseUI/DMUToolsUsers","DS/DMUBaseUIControllers/DMUApplicativeContextManager","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUBaseUIControllers/DMUSlidesController","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Visualization/Node3D","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h,f,D,C,w,M,x,S){"use strict";var I=0,U=async function(n){if(!(n&&n.mkpData&&n.validation&&n.reviewCtx&&n.ctxViewer))return;var r=n.ctxViewer.getViewer(),o=n.ctxViewer.getFrameWindow(),l=new a(n.ctxViewer.getViewer(),n.validation);n.validation.addMarkup(l);var s={children:[],id:n.mkpData.pId,instanceId:n.mkpData.markupRefInst.pId,name:n.mkpData.name,type:"Markup",treeOrder:"4.3333",webMarkup:"true",owner:n.mkpData.owner};l.setFromJson(s);var d={children:[],id:n.mkpData.markupRepRef.pId,instanceId:n.mkpData.markupRepInst.pId,name:"Review "+n.mkpData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:n.mkpData.markupRepRef.owner};l.addChild(d);var g=t.getReviewContext({context:n.ctxViewer}).getTransientReviewBag(),m=null,p={entities:null,occurrences:null};g&&(m=g.getAttribute("oLinksManager")),m&&m.exportLinksManagerData(p),g=new i(n.ctxViewer.getViewer(),n.reviewCtx);let D=l.getChildren();if(D&&D.length&&(D[0].setMarkupContent(g),g.setMarkupOwner(D[0]),m=new c(n.ctxViewer.getViewer(),g),n.validation.setCurrentMarkup(D[0]),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:D[0]})),(p.entities&&p.entities.length>0||p.occurrences&&p.occurrences.length>0)&&m.importLinksManagerData(p),g.setAttributes([{name:"oLinksManager",value:m},{name:"sName",value:n.mkpData.markupName}]),u.setSlidePreferences({context:o,preferences:{panelTitle:n.validation.getName()}}),"false"!==localStorage.getItem("DMUCreateFirstSlide")&&n.ctxViewer.getRootBagPath().getChildrenPathes().length){var M=new v(n.ctxViewer.getViewer(),n.reviewCtx.getCurrentSessionMarkup());M.setAttributes([{name:"sID",value:g.computeNewID()},{name:"sUuid",value:e.getUUID()},{name:"sOwner",value:h.getUserLogin()},{name:"fCreationDate",value:Date.now()}]),M.updateEnvironmentOverload({target:n.reviewCtx.getEnvironment(),state:n.reviewCtx.getEnvironment().getEnvironmentInfo()}),g.addSlide(M);var x=null,I=f.giveDMUApplicativeContextManager({context:t.getContextViewer({viewer:r})});if(I)for(var U,b,R=I?I.getApplicativeControllers():[],y=0;y<R.length;y++){b=R[y].getApplicativeContainerID();var k=I.getVerifiedApplicativeContainerState(b);k&&(M.setSlideApplicativeContext(b,k),null,(U=R[y].getCurrentAppContainerStateTitle())&&(x?x+=" - ":x="",x+=U)),M.setSlideApplicativeContext(b,k)}x&&!x.length&&(x=null),M.setAttribute("sName",g.computeNewName({object:M,prefix:x||S.createReview.slideTitle,noSuffixIfPossible:null!==x,separator:null!==x?"parenthesis":null})),n.validation.fireEvent("onDMUObjectInitialized",{dmuObject:M}),n.validation.updateVisibleMarkups(),await C.copyTransientMarkersAndOverloads(g,M,n.ctxViewer,n.duplicatedEntity,n.hiddenElts);var E=w.giveDMUSlidesController({context:o});E&&E.setActiveSlide(M,{duration:0})}return{sessionMarkup:g,markup:l}},b=function(e){var n=t.getEventsController({viewer:e.iCtxViewer.getViewer()});"add"===e.mode?e.highlight.addAssociatedCheck(e.check.getPlmID()):"remove"===e.mode&&e.highlight.removeAssociatedCheck(e.check.getPlmID()),n.fireEvent("onUpdateImpactedChecksList",{highlight:e.highlight,check:e.check,mode:e.mode})},R=function(e){var n=t.getReviewContext({context:e.iCtxViewer}),i=new s(e.iCtxViewer.getViewer(),n.getValidation());i.setFromJson({type:e.type,name:e.name,id:e.id,state:e.state,description:e.description,owner:e.owner,children:""!==e.requirementDocId?[{id:e.requirementDocId,type:"Requirement",name:e.requirementName}]:[]}),n.getValidation().addCheck(i),n.getValidation().fireEvent("onDMUObjectInitialized",{dmuObject:i})},y={createReview:function(e){if(!e||!e._ctxViewer)return;var i=e._ctxViewer,a=i.getViewer(),s=t.getReviewContext({context:i});s||(s=n.createReviewContext({context:i}));let d=void 0!==e._rootData?e._rootData.valueItem:void 0;p.createReviewInDataBase({viewer:i,reviewName:e._reviewName,parentID:d,reviewDescription:e._reviewDescription?e._reviewDescription:"",createMarkup:e._createMarkup,markupName:e._markupName,markupDescription:e._markupDescription,contextAsValidated:e._contextAsValidated,serviceID:d&&i.getController().getRootStats(d)&&i.getController().getRootStats(d).serviceId?i.getController().getRootStats(d).serviceId:"",onReviewCreationCompleted:async function(n){let d=t.getEventsController({viewer:i.getViewer()}),c=D.getLoadingContextController({context:i});if(!i.getRootBagPath().getChildrenPathes().length){d&&d.fireEvent("reviewNoContextModeOn");let e=d.addEvent("onLoadedReviewContext",t=>{d.removeEvent(e),["DXF","DWG","PDF"].some(e=>{e===t.rootType&&(s.getValidation().getMarkups().length||new Promise(function(e){let t;y.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(n){t=n.listNames[0].title,e(t)},ononGenerateNameFailed:function(){t=S.createReviewMarkup.defaultMarkupName,e(t)}})}).then(function(e){y.createReviewMarkup({ctxViewer:i,validation:s.getValidation(),mkpName:e,duplicatedEntity:[],hiddenElts:[],onMarkupCreationCompleted:function(e){d&&d.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup})},onMarkupCreationFailed:function(){}})}))})}),t=i.subscribe({event:"onRootAdded"},function(e){let n;if(e.path)"Document"===(n=M.getNodeType(e.path.getLastElement(!0)))&&(n=c.getLoadMarkupCtxType);else{let e=i.getRootBagPath().externalPath[0].path.getChildrenPathes().length,t=i.getRootBagPath().externalPath[0].path.getChildrenPathes()[e-1];n=M.getNodeType(t.getLastElement(!0))}d.fireEvent("reviewNoContextModeOff",{rootType:n}),i.unsubscribe(t)})}if(n){let d,m;c&&(d=c.getTempObjectInformations(),m=c.getLoadedR2VInformations());var u={contextId:e._rootData?e._rootData.valueItem:null,reviewId:n.pId,valCtxId:n.Context?n.Context.pId:null,validatedID:n.Validated.pId,validatedPath:n.Validated.path?n.Validated.path:void 0,reviewName:n.validationName,modifiable:!0,editionMode:e._editionMode,reviewDescription:n.description?n.description:"",status:n.status,currentState:n.currentState,reviewType:"DMUValidationValidation",owner:n.owner,tempObjectInfo:d,loadedR2VInfo:m},g=function(e,n,i,a){var s=new r(e,i);s.setFromJson({id:n.reviewId,name:n.reviewName,status:n.status,currentState:n.currentState,type:n.reviewType,owner:n.owner}),i.setValidation(s),i.setReviewCtxInformation(n),s.setNode(new x("DMUReviewBag"));let d=D.giveLoadingContextController({context:t.getContextViewer({viewer:e})});if(d&&["PDF","Requirement","Requirement Specification"].includes(d.getLoadMarkupCtxType())&&s.enableMultipleMarkupVisibility(!0),n.valCtxId){var c=new o(e,s);c.setFromJson({id:n.valCtxId,type:"DMUValidationContext"}),a&&c.addJsonContext({id:a.valueItem,name:a.labelItem,type:a.type}),s.setContext(c)}var u=new l(e,s);if(u.setFromJson({id:n.validatedID,type:"ValValidated"}),s.setValidated(u),n.validatedPath)if("R2V_FeatureState"===i.getValidation().getContext().getJsonContextTypes()[0])n.loadedR2VInfo.forEach(e=>{e.id===n.validatedPath&&(i.getValidation().getValidated().addPathElement({instanceName:e.info[0]["ds6w:label"],referenceName:e.info[0]["ds6w:label"],PathElements:[n.validatedPath]}),s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode}))});else{var g=t.getContextViewer({viewer:e}).getController(),m=[n.validatedPath];g.getAttributes({ids:m,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:function(e){i.getValidation().getValidated().addPathElement({instanceName:e[n.validatedPath]["ds6w:label"],referenceName:e[n.validatedPath]["ds6w:label"],PathElements:[n.validatedPath]}),s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode})},onFailure:function(){i.getValidation().getValidated().addPathElement({instanceName:n.tempObjectInfo.title,referenceName:n.tempObjectInfo.title,PathElements:[n.validatedPath]}),s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode})}}})}else s.fireEvent("onDMUObjectInitialized",{dmuObject:s,editionMode:n.editionMode});return s}(a,u,s,e._rootData);e._createMarkup?n.markup?(await U({mkpData:n.markup,validation:g,reviewCtx:s,ctxViewer:i,duplicatedEntity:e._dmuEltsDuplicated,hiddenElts:e.hiddenElts}),e.onReviewCreationComplete({validation:g})):e.onReviewCreationFailed():e.onReviewCreationComplete()}else e.onReviewCreationFailed()},onReviewCreationFailed:e.onReviewCreationFailed})},updateValidatedObjectsList:function(e){p.saveValidatedObject({validatedObjects:e.validatedObjects,validatedId:e.validatedId,onSaveValidatedObjectsCompleted:function(){!function(e){var n=e.ctxViewer,i=t.getContextViewer({viewer:n}).getController();const a=t.getReviewContext({viewer:e.ctxViewer});var r=[e.instanceIds,e.referenceIds];const o=n=>{var i=t.getEventsController({viewer:e.ctxViewer}),r=[],o=[];let l=null,s=a.getValidation().getContext()?a.getValidation().getContext().getJsonContextTypes()[0]:null;if(s&&(l=s.parentType?s.parentType:s.type?s.type:s),"remove"===e.updateMode){for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().removePathElement(e.validatedToAdd[t],e.fullPathRefs[t]);i.fireEvent("onValidatedSaved",e),["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(l)&&a.getValidation().removeValidatedNode(e.referenceIds[0])}else{for(let t=0;t<e.validatedToAdd.length;t++)a.getValidation().getValidated().addPathElement({instanceName:n[e.instanceIds[t]]["ds6w:label"],referenceName:n[e.referenceIds[t]]["ds6w:label"],PathElements:e.validatedToAdd[t]}),r.push(n[e.referenceIds[t]].type_icon_url),o.push(n[e.instanceIds[t]]["ds6w:label"]),["Requirement Specification","Requirement","Document","DesignSight","R2V_FeatureState"].includes(l)&&a.getValidation().addValidatedNode({docInfo:{validatedId:e.validatedId,validatedPaths:e.validatedToAdd[t],validatedName:n[e.validatedToAdd[t]]["ds6w:label"]}});e.onReviewCtxUpdateOrDropValidated?i.fireEvent("onReviewCtxUpdateOrDropValidated",{validatedId:e.validatedId,validatedNames:o,validatedPaths:e.validatedToAdd,validatedIcons:r}):i.fireEvent("onDMUValidatedCreated",{validatedId:e.validatedId,validatedNames:o,validatedPaths:e.validatedToAdd,validatedIcons:r})}};if(a)if("R2V_FeatureState"===a.getValidation().getContext().getJsonContextTypes()[0]){const e=D.getLoadingContextController({context:t.getContextViewer({viewer:n})}).getLoadedR2VInformations(),i=e[0].id,a=e[0].info[0].icon;o({[i]:{"ds6w:label":e[0].info[0]["ds6w:label"],"ds6w:type":"R2V_FeatureState",physicalid:i,type_icon_url:a}})}else i.getAttributes({ids:r,attributes:["ds6w:label","type_icon_url"],callbacks:{onComplete:o,onFailure:function(){return null}}})}(e)},onSaveValidatedObjectsFailed:e.onSaveValidatedObjectsFailed})},addCheck:function(e){p.addCheck({validationId:e.validation.getPlmID(),requirementDocId:e.requirementDocId,checkName:e.checkName,description:e.description,checkState:e.checkState,onCheckCreationCompleted:function(t){R({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:e.requirementName,requirementDocId:e.requirementDocId,iCtxViewer:e.iCtxViewer})},onCheckCreationFailed:e.onCheckCreationFailed})},addChecks:function(e){p.addChecks({listObjects:e.checkList,onCheckCreationCompleted:function(t){t.checkObjects&&t.checkObjects.forEach(t=>{R({type:"DMUValidationCheck",name:t.name,id:t.pId,state:t.checkState,description:t.description,owner:t.owner,requirementName:t.name,requirementDocId:t.requirementDocId,iCtxViewer:e.iCtxViewer})})},onCheckCreationFailed:e.onCheckCreationFailed})},setCheckRequirement:function(e){p.setCheckRequirement({checkId:e.checkId,requirementId:e.requirementId,removeReq:e.removeReq,onSetCheckRequirementComplete:function(){e.onSetCheckRequirementComplete(e)},onSetCheckRequirementFailed:e.onSetCheckRequirementFailed})},setImpactedCheck:function(e){p.setImpactedCheck({checkId:e.check.getPlmID(),highlightId:e.highlight.getPlmID(),onSetImpactedCheckComplete:function(){e.mode="add",b(e),e.onSetImpactedCheckComplete()},onSetImpactedCheckFailed:e.onSetImpactedCheckFailed})},removeImpactedCheck:function(e){p.removeImpactedCheck({checkId:e.check.getPlmID(),highlightId:e.highlight.getPlmID(),onRemoveImpactedCheckComplete:function(){e.mode="remove",b(e),e.onRemoveImpactedCheckComplete()},onRemoveImpactedCheckFailed:e.onRemoveImpactedCheckFailed})},updateSessionCheckAttributes:function(e){p.updateAttributes({objectsToModify:[{sObjectId:e.objectId,sListOfAttributesToModify:e.attributesList}],onAttributesSaveCompleted:function(n){n.modifiedObjects&&1===n.modifiedObjects.length?(n.modifiedObjects[0].iCtxViewer=e.ctxViewer,function(e){var n,i=t.getReviewContext({context:e.iCtxViewer}).getValidation().getChecks();for(n=0;n<i.length;n++)i[n].getPlmID()===e.pId&&(e.iCheckState&&i[n].setStatus(e.iCheckState),e.sDescription&&i[n].setDescription(e.sDescription),e.sName&&i[n].setName(e.sName))}(n.modifiedObjects[0]),e.onSaveCompleted()):e.onSaveFailed()},onAttributesSaveFailed:e.onSaveFailed})},addHighlight:function(e){var t=[];e.markupRepRef&&(e.markupRepRef.getParent&&e.markupRepRef.getParent()&&e.markupRepRef.getParent().getInstancePlmID&&t.push(e.markupRepRef.getParent().getInstancePlmID()),e.markupRepRef.getInstancePlmID&&(t.push(e.markupRepRef.getInstancePlmID()),t.push(e.markupRepRef.getPlmID()))),p.addHighlight({validationId:e.validation.getPlmID(),markupRepRefPathIds:t,slideId:e.slide.getAttribute("sUuid"),highlightName:e.highlightName,description:e.description,onHighlightCreationCompleted:function(t){!function(e){if(e&&e.validation&&e.iCtxViewer&&e.highlightData){var t=new d(e.iCtxViewer.getViewer(),e.validation);t.setFromJson({type:"DMUValidationExposedPresentation",name:e.highlightData.name,id:e.highlightData.pId,slideId:e.highlightData.slideId,repRefMarkupId:e.highlightData.markupRepRefId,description:e.highlightData.description,rating:e.highlightData.presentationRating,associatedCheck:[],owner:e.highlightData.owner}),e.validation.addHighlight(t),e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:t,slideObject:e.slideObj})}}({iCtxViewer:e.iCtxViewer,validation:e.validation,highlightData:t,slideObj:e.slide}),e.onHighlightCreationCompleted()},onHighlightCreationFailed:e.onHighlightCreationFailed})},addReply:function(e){var n=t.getContextViewer({viewer:e.viewer}),a=t.getReviewContext({context:n});p.addReply({markupRefId:e.markupRef.getPlmID(),name:e.name,description:e.description,onReplyCreationCompleted:function(t){var r=function(e){if(!(e&&e.validation&&e.replyData&&e.viewer&&e.markupRef&&e.reviewCtx))return;var t,n={children:[],id:e.replyData.pId,instanceId:e.replyData.markupRefInst.pId,name:e.replyData.name,type:"Reply",treeOrder:"4.3333",webMarkup:"true",owner:e.replyData.owner};e.markupRef.addChild(n);let a=e.markupRef.getChildren();var r=a&&a.length?a[a.length-1]:null;if(r){var o={children:[],id:e.replyData.markupRepRef.pId,instanceId:e.replyData.markupRepInst.pId,name:"Review "+e.replyData.name,type:"ReviewMarkup",treeOrder:"4.3334",webMarkup:"true",owner:e.replyData.owner};r.addChild(o);var l=(a=r.getChildren())&&a.length?a[0]:null;if(l){let n=null,a=null,o={entities:null,occurrences:null};(a=e.reviewCtx.getCurrentSessionMarkup())&&"DMUMarkup"===a.getType()&&(n=a.getAttribute("oLinksManager")),n&&n.exportLinksManagerData(o),a=new i(e.viewer,e.reviewCtx),l.setMarkupContent(a),a.setMarkupOwner(l),n=new c(e.viewer,a),(o.entities&&o.entities.length>0||o.occurrences&&o.occurrences.length>0)&&n.importLinksManagerData(o),a.setAttributes([{name:"oLinksManager",value:n},{name:"sName",value:e.replyData.name}]),t={replyRef:r,replyRepRef:l}}}return t}({ctxViewer:n,replyData:t,markupRef:e.markupRef,reviewCtx:a,validation:e.validation,viewer:e.viewer});e.validation.fireEvent("onDMUObjectInitialized",{dmuObject:r.replyRepRef}),e.onReplyCreationCompleted(r)},onReplyCreationFailed:e.onReplyCreationFailed})},deleteObject:function(e){p.deleteObject({objectIds:e.objectIds,onObjectDeletionCompleted:function(){var n=e.ctxViewer,i=[],a=[],r=t.getReviewContext({context:n}),o=t.getEventsController({viewer:n.getViewer()});if("validationObject"===e.type)for(let t=0;t<e.objectIds.length;t++){var l=r.getValidation().getChecks(),s=r.getValidation().getHighlights();for(let n=0;n<l.length;n++)l[n].getPlmID()===e.objectIds[t]&&(a.push(e.objectIds[t]),r.getValidation().removeCheck(e.objectIds[t]));for(let n=0;n<s.length;n++)s[n].getPlmID()===e.objectIds[t]&&(i.push(e.objectIds[t]),r.getValidation().removeHighlight(e.objectIds[t]))}i.length&&o.fireEvent("onDMUHighlightRemoveRequested",i),a.length?o.fireEvent("onDMUCheckRemoveRequested",a):"Markup"===e.type&&r.getValidation().removeMarkup(e.objectId),e.onDeleteCompleted&&e.onDeleteCompleted()},onObjectDeletionFailed:e.onDeleteFailed})},createReviewMarkup:function(e){if(e.ctxViewer&&e.validation){var i=t.getReviewContext({context:e.ctxViewer});i||(i=n.createReviewContext({context:e.ctxViewer})),p.addMarkup({mkpName:e.mkpName,validationId:e.validation.getPlmID(),onMarkupCreationCompleted:async function(t){let n=await U({mkpData:t,validation:e.validation,reviewCtx:i,ctxViewer:e.ctxViewer,duplicatedEntity:e.duplicatedEntity,hiddenElts:e.hiddenElts});e.onMarkupCreationCompleted&&e.onMarkupCreationCompleted(n)},onMarkupCreationFailed:e.onMarkupCreationFailed})}},saveReviewMarkup:function(e){e&&e.frmWindow&&m.isPersistenceAllowed({onPersistenceAllowed:async function(){var n=function(){I--};I++;var i=0,a=null,r=t.getReviewContext({viewer:e.frmWindow.getViewer()});let o=r?r.getValidation():null,l=o?o.getRepRef(e.markupRepRefId):null,s=l?l.getMarkupContent():null;if(s)if(s.isDirty()){var d;if(i=1,!e.superType||"SIMItfSimulation"!==e.superType&&"Document"!==e.superType){d={Version:"1.0",Model:[]};let e=await g.getObjectDefinition(s);d.Model.push(e)}else{d={Version:"1.0",Contexts:[],Model:[]};let t=await g.getObjectDefinition(s);d.Model.push(t),d.Contexts.push({superType:e.superType,documentType:e.documentType,listData:e.listData,loadingInfos:e.loadingInfos,documentVersionInfos:e.documentVersionInfos})}a=JSON.stringify(d)}else i=2;1===i&&a?p.saveReviewMarkup({markupRepRefId:e.markupRepRefId,jsonContent:a,onSaveReviewMarkupCompleted:function(){s.setDirtyFlag(!1),e.onSaveCompleted(),n()},onSaveReviewMarkupFailed:function(t){e.onSaveFailed(t),n()}}):(e.onSaveFailed&&e.onSaveFailed(2===i?"NoSaveNeeded":"error"),n())},onPersistenceNotAllowed:function(){e.onSaveFailed&&e.onSaveFailed("error")}})},updateAttributes:function(e){var n=[];e.objectsToModify&&e.objectsToModify.length>0&&e.objectsToModify.forEach(function(e){var t=e.objectId;t||(t=e.object.getPlmID()),n.push({sObjectId:t,sListOfAttributesToModify:e.attributesList})}),p.updateAttributes({objectsToModify:n,onAttributesSaveCompleted:function(n){!function(e){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()})),e.objects&&e.updateInfos&&e.updateInfos.length>0&&e.updateInfos.forEach(function(t){for(var i,a=[],r=0;r<e.objects.length;r++)if(e.objects[r]&&e.objects[r].object&&e.objects[r].object.getPlmID()===t.pId){i=e.objects[r].object;break}i&&(t.sValidationState?(i.setStatus(t.sValidationState),a.push({sValidationState:t.sValidationState})):t.sAlias&&(i.setName(t.sAlias),a.push({sAlias:t.sAlias})),n&&n.fireEvent("onReviewObjectAttributesModified",{object:i,attr:a}))})}({objects:e.objectsToModify,ctxViewer:e.ctxViewer,updateInfos:n.modifiedObjects}),e.onAttributesSaveCompleted(n)},onAttributesSaveFailed:e.onSaveFailed})},updateReviewContext:function(e){p.updateReviewContext({validationId:e.validation.getPlmID(),contextId:e.contextId,serviceID:e.ctxViewer.getController().getRootStats(e.contextId)&&e.ctxViewer.getController().getRootStats(e.contextId).serviceId?e.ctxViewer.getController().getRootStats(e.contextId).serviceId:"",onUpdateReviewContextCompleted:function(n){!function(e){if(e&&e.updateInfos&&e.validation&&e.root){var n;e.ctxViewer&&e.ctxViewer.getViewer&&(n=t.getEventsController({viewer:e.ctxViewer.getViewer()}));var i=e.validation.getContext();!i&&e.updateInfos.Context&&((i=new o(e.ctxViewer,e.validation)).setFromJson({id:e.updateInfos.Context.pId,type:"DMUValidationContext"}),e.validation.setContext(i)),i&&(i.addJsonContext({id:e.updateInfos.rootContextId,name:e.root.label,type:e.root.type}),n&&n.fireEvent("onReviewCtxLoaded",{name:e.root.label,icon:e.root.icon,id:e.contextId}))}}({validation:e.validation,root:e.rootData,updateInfos:n,contextId:e.contextId,ctxViewer:e.ctxViewer}),e.onUpdateReviewContextCompleted()},onUpdateReviewContextFailed:e.onUpdateReviewContextFailed})},generateName:function(e){p.generateName({sListTypeName:e.sListTypeName,onGenerateNameCompleted:e.onGenerateNameCompleted,ononGenerateNameFailed:e.ononGenerateNameFailed})},isProcessing:function(){return I>0}};return y}),define("DS/DMUReviewPersistence/DMUReviewPersistence",[],function(){}),define("DS/DMUReviewPersistence/EXPValCheckContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter"],function(e){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e){var t=[];if(e&&e.length&&e.forEach(function(e){-1===t.indexOf(e.getType())&&t.push(e.getType())}),1===t.length&&(-1!==t.indexOf("DMUValidationExposedPresentation")||-1!==t.indexOf("DMUValidationCheck"))){var n=[];return e[0].getParent().isReadOnly()||(n=this.getContextualMenuCommandList()),n}return[]},getContextualMenuCommandList:function(){return[{line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUReviewGenerateTICCmd",["DS/DMUBaseExperience/DMUContextManager","DS/ApplicationFrame/FrameWindowsManager","DS/CATWebUXTIC/CATWebUXTICCmdAdapt","UWA/Core","DS/Windows/Dialog","DS/Controls/Button","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","DS/Selection/CSOManager","DS/DMUMeasurable/DMUToolsSceneGraph"],function(e,t,n,i,a,r,o,l,s){"use strict";return n.extend({init:function(n){var d=e.getContextViewer({viewer:t.getFrameWindow(n.context).getViewer()});n.pad3DViewer=d,this._parent(n);var c=this;function u(){var e=[];return l.get().forEach(function(t){for(var n=0;t.pathElement,n<t.pathElement.getLength();n++){var i=t.pathElement.getElement(n);i&&"function"==typeof i.getDMUType&&"DMUValidationExposedPresentation"===i.getDMUType()&&e.push(i)}}),e}function g(t){return new Promise(function(n){var g=e.getReviewContext({context:d}),m={reportedAgainst:[],contexts:[],assignees:[],attachments:[]},p=g.getValidation();if(p){if(!p.getPlmID())return void t.onFailure("No Review is available");m.onComplete=function(t){e.getEventsController({viewer:d.getViewer()}).fireEvent("onTICCreationComplete",t)},m.onCancel=function(){e.getEventsController({viewer:d.getViewer()}).fireEvent("onTICCreationCancel")};var v=function(e){var t=[];if(l.get().forEach(function(e){var n=e.pathElement;if(n){for(;n&&!s.isReference(n.getLastElement());)n=n.getParentPath();if(n){var i=n.getLastElement(),a=s.getNodeID(i);t||(t=[]),-1===t.indexOf(a)&&t.push(a)}}}),!t.length)for(var n=e.getValidated().getPathElements(),i=0;i<n.length;i++)n[i]&&n[i].pathElement.length&&t.push(n[i].pathElement[n[i].pathElement.length-1]);return t}(p),h={ids:p.getContext().getJsonContextIDs(),type:p.getContext().getJsonContextTypes()[0]};c.getContext(h).then(e=>{if(e){m.reportedAgainst=0===v.length?e:v,m.contexts=e;var l=[];m.reportedAgainst.length&&(l=m.reportedAgainst.slice()),l.push(p.getPlmID()),function(e){return new Promise(function(t){d.getController().getAttributes({ids:e,attributes:["owner","ds6w:description"],callbacks:{onComplete:e=>t(e),onFailure:()=>t}})})}(l).then(function(e){m.title=function(e){var t=u();return t.length>0?t[0].getOwner().getName():e.getName()}(p),m.attachments=function(e){var t=[],n=u();if(n.length>0)for(var i=0;i<n.length;i++)t.push(n[i].getOwner().getPlmID());else t.push(e.getPlmID());return t}(p);var l=u();l.length>0&&l[0].getOwner()&&l[0].getOwner().getDescription?(m.description=l[0].getOwner().getDescription(),m.description||(m.description=p.getContext().getJsonContextNames()[0])):(e&&e[p.getPlmID()]&&(m.description=e[p.getPlmID()]["ds6w:description"]),m.description||(m.description=p.getContext().getJsonContextNames()[0]));for(var s=0;s<m.reportedAgainst.length;s++)e&&e[m.reportedAgainst[s]].owner&&-1===m.assignees.indexOf(e[m.reportedAgainst[s]].owner)&&m.assignees.push(e[m.reportedAgainst[s]].owner);if(p.getHighlights().length)if(l.length)n(m);else{var c=i.createElement("div"),g="Issue"===t.cmdType?o.issueOnReview:o.caOnReview;i.createElement("label",{text:g,styles:{"margin-bottom":"0px",padding:"10px 0px"}}).inject(c);var v=new a({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:"Issue"===t.cmdType?o.issueTitle:o.caTitle,immersiveFrame:d.getFrameWindow().getImmersiveFrame(),content:c,closeButtonFlag:!0,buttons:{Ok:new r({label:o.yes,onClick:function(){v.destroy(),n(m)}}),Cancel:new r({label:o.no,emphasize:"primary",onClick:function(){v.destroy(),n()}})}});v.addEventListener("close",function(){v.destroy(),n()})}else n(m)})}})}})}this.getParameters=function(e){g(e).then(function(t){t?e.onComplete(t):e.onCancel()})},this._destroy=function(){var e=Object.getPrototypeOf(this);e._destroy&&e._destroy.apply(this,arguments)}}})}),define("DS/DMUReviewPersistence/EXPValChecksContextualBar",["DS/DMUBaseUI/DMUContextualBarAdapter","DS/ApplicationFrame/CommandsManager","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager"],function(e,t,n,i){"use strict";return e.extend({getSharedContextualMenuCommandList:function(e,a){var r=[],o=i.get();if(e&&e.length&&e.forEach(function(e){-1===r.indexOf(e.getType())&&r.push(e.getType())}),1===r.length&&-1!==r.indexOf("Checks")){var l=[];e[0].isReadOnly()||l.unshift({line:1,name:"DMUDeleteStr",hdr_list:["DMUDeleteHdr"]}),l.unshift({line:1,name:"DMUExpandAllStr",hdr_list:["DMUExpandAllHdr"]}),l.unshift({line:1,name:"DMUCollapseAllStr",hdr_list:["DMUCollapseAllHdr"]});var s=n.getReviewContext({viewer:a});if(!s)return;var d=n.getContextViewer({reviewContext:s});if(!d)return;var c=t.getCommand("DMUDeleteHdr",d.getCommandContext());if(c&&c.enable(),1===o.length&&c)c.disable();else for(let e=0;e<o.length;e++)o[e].pathElement.getLastElement().getDMUType&&"DMUValidationExposedPresentation"!==o[e].pathElement.getLastElement().getDMUType()||c&&c.disable();return l}return[]},getContextualMenuCommandList:function(){return[]},register:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})},unregister:function(e){this._parent({frmWindow:e.frmWindow,contextualMenu:{type:e.type,module:"DMUBaseCtxCommands",workbenchName:"DMUBaseCtxCommands"}})}})}),define("DS/DMUReviewPersistence/DMUReviewStatusChangeCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/CATWebUXCVS/CATWebUXCVSComponent","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,n=this,s=null,d=e.frameWindow||this.getFrameWindow();this.beginExecute=function(){var e=a.getReviewContext({viewer:d.getViewer()}).getValidation(),c=function(){(t=new o).build({type:"error",autoHide:!0,message:l.valStateChange.error,body:d.getUIFrame()}),n.end()};r.getServerContext({onComplete:function(t){s=new i({title:e.getName(),physicalId:e.getPlmID(),current:e.getStatus(),parent:d.getImmersiveFrame(),platformSettings:r.getOption("platform_services"),tenant:r.getTenant(),securityContext:{getSecurityContext:()=>({SecurityContext:t})},onChangeValidationStateCompleted:function(t){if(t){var i=[];e.setStatus(t.sValidationState),i.push({sValidationState:t.sValidationState});var r=a.getEventsController({viewer:d.getViewer()});r&&r.fireEvent("onReviewObjectAttributesModified",{object:e,attr:i}),n.end()}else c()},onChangeValidationStateClose:function(){n.end()},onChangeValidationStateFailure:function(){c()}})},onFailure:function(){c()}})},this.endExecute=function(){t&&t.destroy(),s&&s.clean()}}})}),define("DS/DMUReviewPersistence/DMUSetImpactedCheckCmd",["DS/ApplicationFrame/Command","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/CATWebUXComponents/CATWebUXNotification","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o=e.frameWindow||this.getFrameWindow(),l=o.getViewer(),s=null,d=this,c=null,u=null,g=null;this.beginExecute=function(){(u=new a).build({body:o.getUIFrame(),type:"info",notificationType:"HelpNotification",message:r.setImpactedCheck.selectCheck}),s=n.onAdd(function(){var e=n.get();if(e.length>0){var s=e[e.length-1].pathElement.getLastElement();s.getDMUType&&s.getOwner&&"DMUValidationCheck"===s.getDMUType()&&function(e){var n=t.getContextViewer({viewer:l}),s=c.getAssociatedCheck();for(let i=0;i<s.length;i++)if(s[i]===e.getPlmID())return(g=new a).build({type:"error",autoHide:!0,message:r.setImpactedCheck.duplicateError,body:o.getUIFrame()}),t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpCheckFailed"),void d.cancelExecute();i.setImpactedCheck({iCtxViewer:n,check:e,highlight:c,onSetImpactedCheckComplete:function(){d.end()},onSetImpactedCheckFailed:function(){(g=new a).build({type:"error",autoHide:!0,message:r.setImpactedCheck.error,body:o.getUIFrame()}),t.getEventsController({viewer:n.getViewer()}).fireEvent("onImpCheckFailed"),d.end()}})}(s.getOwner())}})},this.cancelExecute=function(){this.end()},this.endExecute=function(){n.unsubscribe(s),u&&u.destroy(),g&&g.destroy()},this.setHighlightObject=function(e){c=e}}})}),define("DS/DMUReviewPersistence/DMUCreateReviewMarkupCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Controls/LineEditor","DS/Controls/Editor","DS/Windows/Dialog","DS/Controls/Button","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUPersistence/DMUAuthPersistenceUtils","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],function(e,t,n,i,a,r,o,l,s,d,c,u,g){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var m,p,v,h,f,D,C,w,M=this,x=t.frameWindow||this.getFrameWindow(),S=x.getViewer();let I=[],U=[];function b(e){v&&c.createReviewMarkup({ctxViewer:v,validation:e.val,mkpName:D,duplicatedEntity:I,hiddenElts:U,onMarkupCreationCompleted:function(e){w&&(w.destroy(),w=null);let t=i.giveEventsController({viewer:S});t&&t.fireEvent("onDMUMarkupCreationSucceeded",{dmuObject:e.sessionMarkup}),M.end()},onMarkupCreationFailed:function(e){!function(){p||(p=new n),p.build({type:"error",autoHide:!0,message:g.createReviewMarkup.errorMessage,body:x.getUIFrame()});var e=i.giveEventsController({viewer:S});e&&e.fireEvent("onDMUMarkupCreationFailed"),M.end()}()}})}i.setAuthoringFeatureTypes("Markup"),this.beginExecute=function(){new Promise(function(e){c.generateName({sListTypeName:[{sTypeName:"DMUValidationReviewReference"}],onGenerateNameCompleted:function(t){D=t.listNames[0].title,e(D)},ononGenerateNameFailed:function(){D=g.createReviewMarkup.defaultMarkupName,e(D)}})}).then(function(t){if(D=t,v=i.getContextViewer({viewer:S})){var n=i.getReviewContext({context:v});if(n){var c=function(){m&&m.destroy(),async function(){(w=new d).display({modal:!0,frmWindow:x,type:"load",message:g.createReviewMarkup.loadingMessage}),U.length=0;let e="",t=n.getReviewCtxInformation();if(t&&t.contextId&&(e=t.contextId),"false"!==localStorage.getItem("DMUCreateFirstSlide")){let t=await u.getTransientMarkersAndOverloads(n,v,e);U=t.overloads,I=t.markers}b({val:n.getValidation()})}()};if("false"!==localStorage.getItem("DMUDisplayMarkupCreationDialog")){var p,R,y,k=e.createElement("div",{class:"DMUCreateMarkupPanelMainDiv"}),E=function(){var t=""===h.value;p.disabled=t,p.disabled||(D=h.value,C=f.value),R.innerHTML="",y.innerHTML="";var n=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});n.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),t&&n.inject(R),R.setStyle("display",""!==R.innerHTML?"":"none"),y.setStyle("display",""!==y.innerHTML?"":"none")},V=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(k),P=e.createElement("div").inject(V),F=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(P);F.setStyles({marginRight:"5px"}),(R=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(P)).setStyles({color:"#E87B00",display:"none","font-weight":"bold","font-style":"italic"}),F.innerHTML=g.createReviewMarkup.nameLabel,(h=new a({placeholder:g.createReviewMarkup.namePlaceholder,value:D,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(V)).elements.container.setStyles({width:"100%"}),h.elements.container.childNodes[0].setStyles({width:"100%"}),h.addEventListener("change",E);var T=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(k),A=e.createElement("div").inject(T),N=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(A);(y=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(A)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),N.innerHTML=g.createReviewMarkup.descriptionLabel,(f=new r({nbRows:5,newLineMode:"shiftEnter",placeholder:g.createReviewMarkup.descriptionPlaceholder,value:C,selectAllOnFocus:!0,autoCommitFlag:!0}).inject(T)).elements.container.setStyles({width:"100%"}),f.elements.container.childNodes[0].setStyles({width:"100%"}),f.addEventListener("change",E),(p=new l({emphasize:"primary",label:g.createReviewMarkup.createMarkupButton,onClick:c})).getContent().addClassName("reviewMarkupCreationButton");var L=new l({label:g.createReviewMarkup.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:S});e&&e.fireEvent("onDMUMarkupCreationCancelled"),M.end()}});(m=new o({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:g.createReviewMarkup.panelTitle,resizableFlag:!0,immersiveFrame:x.getImmersiveFrame(),position:s.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:p,Cancel:L},width:400,content:k})).addEventListener("close",function(){M.end()})}else c()}else M.end()}else M.end()})};var R=this.endExecute;this.endExecute=function(){D=null,C=null,w&&(w.destroy(),w=null),p&&p.destroy(),m&&m.destroy(),p=m=null,h=f=void 0,D=C=void 0,R()},this.setDefaultInfo=function(e){D=e.title,C=e.description}}})}),define("DS/DMUReviewPersistence/DMUUpdateValidatedListCmd",["DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/Selection/HSOManager","DS/Visualization/PathElement","DS/DMUMeasurable/DMUToolsSceneGraph","DS/CATWebUXComponents/CATWebUXNotifBar","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s,d,c){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0;var u,g,m,p=null,v=null,h=this;this._parent(e);var f=e.frameWindow||this.getFrameWindow();this.contextIsAPart=function(){var e=n.getReviewContext({viewer:f.getViewer()}),t=n.getContextViewer({viewer:f.getViewer()}).getController(),i=!0;let a=e.getValidation().getContext().getJsonContextTypes()[0];if("VPMReference"!==(d.getParentType(a)?d.getParentType(a):a))i=!1;else{var o=e.getValidation().getContext().getJsonContexts()[0].id,l=[],s=t.getNode({id:o});l.push(s);var c=new r(l);if(i=c,c.externalPath.length)for(var u=c.externalPath[0].getChildren(),g=0;g<u.length;g++)u[g].userData&&"VPMInstance"===u[g].userData.type&&(i=!1)}return i},this.getLastInstance=function(e){return e.getLength()>1?o.isInstance(e.getLastElement(!0))&&!o.isRepInstance(e.getLastElement(!0))?e.clone():this.getLastInstance(e.getParentPath()):new r},this._createNewValidated=function(e){var i=n.getEventsController({viewer:f.getViewer()}),a=n.getReviewContext({viewer:f.getViewer()}),r=a.getValidation().getValidated().getPathElements(),o=e.validatedPath,l=[],s=[];let d=this.options.arguments[0].Value;var u=function(e){var t=[];if(e)if(e.length>1)for(var n=1;n<e.length-1;)t.push(e[n]),n+=2;else 1===e.length&&t.push(e[0]);return t},g=-1;for(let n=0;n<r.length;n++){for(let a=0;a<e.validatedPath.length;a++)if(e.refFullPath[a].equals(r[n].pathElement)||e.validatedPath[a].equals(r[n].pathElement)){if("add"===d)return i.fireEvent("onDMUValidatedCreated",null),m||(m=new t),void m.build({type:"information",autoHide:!0,message:c.updateValidatedListCmd.ValidatedExist,body:f.getUIFrame()});g=n}g!==n?l.push(u(r[n].pathElement)):r.length&&r[n]&&s.push(r[n].instanceName?r[n].instanceName:void 0),g=-1}if("add"===d)for(let e=0;e<o.length;e++)l.push(u(o[e]));return{validatedObjects:l,validatedId:a.getValidation().getValidated().getPlmID()?a.getValidation().getValidated().getPlmID():null,instanceNames:s}},this.beginExecute=function(){g=f.getViewer();var e=[],t=h.contextIsAPart(),m=[],D=[],C=[],w=[],M=[],x=function(){let l,c=i.get(),u=n.getReviewContext({viewer:f.getViewer()}),p=u.getValidation().getContext().getJsonContextTypes()[0],v=d.getParentType(p)?d.getParentType(p):p;if("Requirement Specification"===v||"Requirement"===v||"DIFLayout"===v||"DesignSight"===v){let e=u.getValidation().getValidated().getPathElements(),t=[];e.length>0&&e.forEach(e=>{t.push(e.pathElement)}),c[0].pathElement.getLastElement().getDocInfo?(w.push(c[0].pathElement.getLastElement().getDocInfo().validatedPaths[0]),M.push(c[0].pathElement.getLastElement().getDocInfo().validatedPaths[0]),t.forEach((e,n)=>{e[0]===c[0].pathElement.getLastElement().getDocInfo().validatedPaths[0]&&t.splice(n)})):(w.push(c[0].pathElement.getLastElement().getModelIdentification()),M.push(c[0].pathElement.getLastElement().getModelIdentification()),t.forEach((e,n)=>{e[0]===c[0].pathElement.getLastElement().getModelIdentification()&&(D.push(e),t.splice(n))})),l={validatedObjects:t,validatedId:u.getValidation().getValidated().getPlmID(),instanceNames:""},c[0].pathElement.getLastElement().getDocInfo&&(D=c[0].pathElement.getLastElement().getDocInfo().validatedPaths,m.push(c[0].pathElement.getLastElement().getDocInfo().validatedPaths))}else{let s=h.options.arguments[0].Value;if(c.length>0&&"RootBag"===c[0].pathElement.externalPath[0].name&&"remove"===s&&c[0].pathElement.externalPath.shift(),c.length>0)for(let n=0;n<c.length;n++){if(c[n].pathElement&&m.push(o.getIdPath(c[n].pathElement)),t&&t.externalPath&&t.externalPath.length)e.push(t);else{e.push(function(e){var t=null;if(e){t=new r;for(var n=1;n<e.getLength();n++){var i=e.getElement(n);if(o.isRepInstance(i))break;t.addElement(i)}}return t}(c[n].pathElement))}e[n].externalPath&&D.push(o.getIdPath(e[n])),C.push(o.getLastReference(e[n]).getLastElement()),w.push(C[n]?C[n].getModelIdentification():D[n][0]),h.getLastInstance(e[n]).getLastElement()?M.push(h.getLastInstance(e[n]).getLastElement().getModelIdentification()):M.push(w[n])}if(D.length&&D[0].length&&m.length&&m[0].length)l=h._createNewValidated({validatedPath:D,refFullPath:m});else{var x=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),x.fireEvent("onValidatedObjCancelRequested"),h.endExecute()}}var S=h.options.arguments[0].Value;l&&s.updateValidatedObjectsList({fullPathRefs:m,validatedObjects:l.validatedObjects,validatedId:l.validatedId,validatedToAdd:D,referenceIds:w,instanceIds:M,instanceNames:l.instanceNames,updateMode:S,ctxViewer:g,onSaveValidatedObjectsFailed:function(){}}),h.end()};let S=c.updateValidatedListCmd.SelectMsg?c.updateValidatedListCmd.SelectMsg:"Select the Validated Object(s) to add",I=c.updateValidatedListCmd.OkBtn?c.updateValidatedListCmd.OkBtn:"OK",U=c.updateValidatedListCmd.CancelBtn?c.updateValidatedListCmd.CancelBtn:"OK";(u=new l({className:"R3VAddValidatedCmdDlg"}).inject(f.getUIFrame())).add({msgType:"primary",message:S,closable:!1,buttons:[{className:"primary",label:I,onClick:x},{className:"default",label:U,onClick:function(){var e=n.getEventsController({viewer:f.getViewer()});i.empty(),a.empty(),e.fireEvent("onValidatedObjCancelRequested"),h.end()}}]}),0===i.get().length&&(u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0),"add"===this.options.arguments[0].Value?(p=i.onAdd(function(){u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!1,u.show()}),v=i.onRemove(function(){0===i.get().length&&(u.elements.container.getElementsByClassName("btn btn-sm btn-primary")[0].disabled=!0)})):x()},this.endExecute=function(){i.unsubscribe(p),i.unsubscribe(v),u&&u.destroy()}}})}),define("DS/DMUReviewPersistence/DMUAddCheckCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUReadPersistence/DMUReviewPersistenceServicesSetting","DS/DMUMeasurable/DMUToolsSceneGraph","DS/DMUControls/DMUInfoModalDiv","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o,l,s){"use strict";return t.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var t,a,r=this,o=e.frameWindow||this.getFrameWindow(),d=o.getViewer();this._createNewCheck=function(e){var c=i.getReviewContext({viewer:o.getViewer()});t=i.giveEventsController({viewer:d}),l.addCheck({iCtxViewer:i.getContextViewer({viewer:d}),validation:c.getValidation(),requirementDocId:"",checkName:e||"",description:"",checkState:1,onSaveCheckFailed:function(){a||(a=new n),a.build({type:"error",autoHide:!0,message:s.createCheck.errorMessage,body:o.getUIFrame()}),t&&t.fireEvent("onCheckCreationFailed"),r.end()}}),r.end()},this.beginExecute=function(){r._createNewCheck()}}})}),define("DS/DMUReviewPersistence/DMUCreateReviewCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Controls/ComboBox","DS/Controls/LineEditor","DS/Controls/Editor","DS/DMUMeasurable/DMUToolsSceneGraph","DS/Windows/Dialog","DS/Controls/Button","DS/Controls/Tab","DS/Utilities/TouchUtils","DS/DMUControls/DMUInfoModalDiv","DS/Visualization/PathElement","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","DS/DMUReadPersistence/DMULoadingContextController","DS/DMUPersistence/DMUAuthPersistenceUtils","DS/DMUPersistence/DMUAuthPersistenceServices","DS/DMUBaseExperience/EXPToolsContext","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence","css!DS/DMUReviewPersistence/DMUReviewPersistence.css"],function(e,t,n,i,a,r,o,l,s,d,c,u,g,m,p,v,h,f,D,C){"use strict";return t.extend({init:function(t){t.mode="shared",t.repeatMode=!1,t.isAsynchronous=!0,this._parent(t);var w,M,x,S,I,U,b,R,y,k=this,E="DMUDesignValidation"===t.arguments[0].Value,V=t.frameWindow||this.getFrameWindow(),P=V.getViewer(),F=[],T=[],A=[],N=[];let L=null;function O(e){var t;M||(M=new n),t="errorShape"===e?C.createReview.errorShape:C.createReview.errorMessage,M.build({type:"error",autoHide:!0,message:t,body:V.getUIFrame()});let a=i.giveEventsController({viewer:P});a&&a.fireEvent("onDMUReviewCreationFailed"),k.end()}function j(e){var t="",n=i.getContextViewer({viewer:P}).getController();return F.forEach(function(i){if(i.valueItem===e){switch(D.getParentType(i.type)?D.getParentType(i.type):i.type){case"ENOStrRefinementSpecification":t="NGFilter";break;case"Requirement":t="Requirement";break;case"Requirement Specification":t="Requirement Specification";break;case"Document":t="Document";break;case"Drawing":t="Drawing";break;case"SIMItfSimulation":t="ITF";break;case"PLMPIMMetricReference":t="ISR";break;case"DIFSheet":t="DIFSheet";break;case"DesignSight":t="DesignSight";break;case"R2V_FeatureState":t="R2V_FeatureState";break;default:var a=[],r=n.getNode({id:e});a.push(r);var o=new m(a);if(l.isRepReference(o.getLastElement(!0)))t="RepRef";else if(l.isReference(o.getLastElement(!0))){t="Product";var s=o.externalPath[0].getChildren();if(s.length>0){t="Part";for(let e=0;e<s.length;e++)if(!l.isRepInstance(s[e])){t="Product";break}}}}}}),t}function B(){let e=i.giveEventsController({viewer:P}),n=i.getReviewContext({context:x});if(n&&n.getValidation()?i.removeReviewContext({viewer:P}):n&&n.removeInternalDataModel(),e.fireEvent("onDMURemoveSessionReview"),!x)return;var a=S?S.value:F.length?F[0].valueItem:void 0,r=null;S?F.forEach(function(e){e.valueItem===S.value&&(r=e)}):r=F[0]?F[0]:void 0;var o="false";let s;a&&(s=j(a),["Part","Document","Requirement","DIFSheet","Drawing","R2V_FeatureState"].includes(s)&&(o="true"));var d="Document"===s?"true":localStorage.getItem("DMUAutomaticMarkupCreationDialog");d=d?"true"===d:"DMUDesignValidation"!==t.arguments[0].Value,p.createReview({_ctxViewer:x,_reviewName:I,_rootData:r,_reviewDescription:b,_createMarkup:d,_markupName:U,_markupDescription:R,_contextAsValidated:o,_parentID:a,_dmuEltsDuplicated:A,hiddenElts:N,_editionMode:E,onReviewCreationComplete:function(){if("R2V_FeatureState"===s&&x.toggleSOITimelinesUsability(!1),y&&(y.destroy(),y=null),e&&e.fireEvent("onDMUReviewCreationSucceeded"),"ITF"===s||"ISR"===s){n=i.getReviewContext({context:x});let e=x.getRootBagPath().getChildrenPathes(),t=l.getNodeID(e[0].getLastElement(!0)),a="add";p.updateValidatedObjectsList({fullPathRefs:[[t]],validatedObjects:[[t]],validatedId:n.getValidation().getValidated().getPlmID()?n.getValidation().getValidated().getPlmID():null,validatedToAdd:[[t]],referenceIds:[t],instanceIds:[t],instanceNames:[],updateMode:a,ctxViewer:x.getViewer(),onReviewCtxUpdateOrDropValidated:!0,onSaveValidatedObjectsFailed:function(){}})}k.end()},onReviewCreationFailed:O})}function _(){var n,l="false"!==localStorage.getItem("DMUDisplayReviewCreationDialog"),m=localStorage.getItem("DMUAutomaticMarkupCreationDialog"),v=(m=m?"true"===m:"DMUDesignValidation"!==t.arguments[0].Value)?[{sTypeName:"DMUValidationValidation"},{sTypeName:"DMUValidationReviewReference"}]:[{sTypeName:"DMUValidationValidation"}];I||new Promise(function(e){p.generateName({sListTypeName:v,onGenerateNameCompleted:function(t){I=t.listNames[0].title,m&&(U=t.listNames[1].title),e()},ononGenerateNameFailed:function(){I=T.length?C.createReview.defaultReviewName+"_"+T[0]:C.createReview.defaultReviewName,e()}})}).then(function(){var t,v=i.getReviewContext({context:x}),f=function(){w&&w.destroy(),async function(){(y=new g).display({modal:!0,frmWindow:V,type:"load",message:C.createReview.loadingMessage});var e=S?S.value:F.length?F[0].valueItem:void 0;if(m&&"false"!==localStorage.getItem("DMUCreateFirstSlide")){let t=await h.getTransientMarkersAndOverloads(v,x,e);N=t.overloads,A=t.markers}if(v)if(v.getValidation()){var t=v?v.getValidation():null,n=t?t.getCurrentMarkup():null;n?p.saveReviewMarkup({markupRepRefId:n.getRepRef().getPlmID(),frmWindow:V,onSaveCompleted:B,onSaveFailed:e=>{"NoSaveNeeded"===e&&B()}}):B()}else B();else B()}()},D=function(i,l){var s,d,c,u,g,p,h;F.length>1&&"review"===l&&(g=m?e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i):e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(i),e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(g).innerText=C.createReviewMarkup.multipleRootsLabel,S=new a({elementsList:F,selectedIndex:0,enableSearchFlag:!0,actionOnClickFlag:!1}).inject(g),m?g.setStyles({paddingTop:"10px",paddingBottom:"0px"}):g.setStyles({paddingBottom:"10px"}),S.elements.container.setStyles({width:"100%"}),S.elements.container.setStyles({width:"calc(100% - 3px)"}));var f,D=function(){var i,a="review"===l;i=a?""===s.value:""===d.value,t.disabled=i,t.disabled||(a?(I=s.value,b=c.value):(U=d.value,R=u.value)),p.innerHTML="",h.innerHTML="";var r=e.createElement("span",{class:"wux-ui-genereatedicon-fi wux-ui-3ds wux-ui-3ds-required wux-ui-3ds-lg"});r.setStyles({color:"#E87B00",display:"inline-block","font-weight":"bold"}),i?(r.inject(p),n&&(n.tabBar.buttonGroup.getButton(n.value[0]).icon={iconName:"required",fontIconFamily:WUXManagedFontIcons.Font3DS},n.tabBar.buttonGroup.getButton(n.value[0]).elements.button.getChildren()[0].getChildren()[0].setStyles({color:"#E87B00","font-weight":"bold"}))):n&&(n.tabBar.buttonGroup.getButton(n.value[0]).icon={iconName:"doc",fontIconFamily:WUXManagedFontIcons.Font3DS}),p.setStyle("display",""!==p.innerHTML?"":"none"),h.setStyle("display",""!==h.innerHTML?"":"none")},w=function(e){var t=new r({placeholder:C.createReview.namePlaceholder,value:e,selectAllOnFocus:!0,autoCommitFlag:!0});return t.elements.container.setStyles({width:"100%"}),t.elements.container.childNodes[0].setStyles({width:"100%"}),t._myInput.maxLength=100,t.addEventListener("change",D),t},M=function(e){var t=new o({nbRows:5,newLineMode:"shiftEnter",placeholder:C.createReview.descriptionPlaceholder,value:e,selectAllOnFocus:!0,autoCommitFlag:!0});return t.elements.container.setStyles({width:"100%"}),t.elements.container.childNodes[0].setStyles({width:"100%"}),t.addEventListener("change",D),t};m?(f=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i)).setStyles({paddingTop:"10px"}):f=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection NoMarkupCreate"}).inject(i);var x=e.createElement("div").inject(f),y=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(x);y.setStyles({marginRight:"5px"}),(p=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(x)).setStyles({color:"#E87B00",display:"none","font-weight":"bold","font-style":"italic"}),y.innerHTML=C.createReview.nameLabel,"review"===l?(s=w(I)).inject(f):(d=w(U)).inject(f);var k=e.createElement("div",{class:"DMUCreateMarkupPanelLineEditorSection"}).inject(i),E=e.createElement("div").inject(k),V=e.createElement("div",{class:"DMUCreateMarkupPanelLabel"}).inject(E);if((h=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(E)).setStyles({color:"red",display:"none","font-weight":"normal","font-style":"italic"}),V.innerHTML=C.createReview.descriptionLabel,"review"===l?(c=M(b)).inject(k):(u=M(R)).inject(k),v&&v.getValidation()){var P=e.createElement("p",{class:"DMUCreateMarkupPanelLabel"}).inject(i);P.innerHTML=C.createReview.warningMessage,P.setStyles({color:"#e87b00","font-weight":"normal","font-style":"italic",margin:"0","margin-top":"10px"})}};if(l||F.length>1||v&&v.getCurrentSessionMarkup()){var M=e.createElement("div",{class:"DMUCreateReviewPanelMainDiv"});if(m){var E=e.createElement("div",{class:"DMUCreateReviewTab"}).inject(M);(n=new c({displayStyle:"strip"})).inject(E);var T=e.createElement("div",{class:"DMUCreateReviewPanelReviewTab"}),L=e.createElement("div",{class:"DMUCreateMarkupPanelReviewTab"});D(T,"review"),D(L,"markup"),n.add({label:C.createReview.labelReview,content:T,icon:{iconName:"review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),n.add({label:C.createReview.labelMarkup,content:L,icon:{iconName:"markup-review",fontIconFamily:WUXManagedFontIcons.Font3DS}}),n.value=[0],n.tabBar.centeredFlag=!1}else D(M,"review");(t=new d({emphasize:"primary",label:C.createReview.createreviewButton,onClick:f})).getContent().addClassName("reviewCreationButton");var O=new d({label:C.createReview.cancelButton,onClick:function(){var e=i.giveEventsController({viewer:P});e&&e.fireEvent("onDMUMarkupCreationCancelled"),k.end()}});w=new s({modalFlag:!0,ensureHeightDefinitionOnHierarchy:!0,title:C.createReview.panelTitle,resizableFlag:!0,immersiveFrame:V.getImmersiveFrame(),position:u.getTouchMode()?{my:"center bottom"}:void 0,buttons:{Ok:t,Cancel:O},width:400,content:M}),v&&v.getValidation()&&(t.emphasize="medium-attention",t.icon={iconName:"warning",fontIconFamily:WUXManagedFontIcons.font3DS}),w.addEventListener("close",function(){k.end()})}else f()})}i.setAuthoringFeatureTypes("Check"),i.setAuthoringFeatureTypes("Highlight"),this.beginExecute=function(){var e;if(x=i.getContextViewer({viewer:P})){var t=f.getPossibleRootContexts(x),n=[];for(e=0;e<t.length;e++){var a=x.getController().isFiltered(l.getNodeID(t[e].getLastElement(!0)));if(x.getApplicativeData&&x.getApplicativeData().getLoadedItfData&&x.getApplicativeData().getLoadedItfData().data.length){x.getApplicativeData().getLoadedItfData().data.forEach(function(e){n.push({rootID:e.isrID,type:"ISR"})});break}if(a.filterId)n.push({rootID:a.filterId,type:"ENOStrRefinementSpecification"});else if(""!==l.getNodeID(t[e].getLastElement(!0))){const i=l.getNodeID(t[e].getLastElement(!0));n.push({rootID:l.getNodeID(t[e].getLastElement(!0)),type:x.getController().getRootStats(i)&&"r2vsurvey"===x.getController().getRootStats(i).serviceId?"R2V_FeatureState":l.getNodeType(t[e].getLastElement(!0))})}}n.length?new Promise(function(e){var t=0;n.forEach(function(i){if("R2V_FeatureState"===i.type){L||(L=v.getLoadingContextController({context:x})),L.getLoadedR2VInformations().forEach(a=>{a.id===i.rootID&&(t++,F.push({labelItem:a.info[0]["ds6w:label"],iconItem:a.info[0].icon,valueItem:i.rootID,type:i.type}),t===n.length&&e())})}else x.getController().getAttributes({ids:[i.rootID],attributes:["ds6w:label","ds6wg:revision","type_icon_url","ds6w:type"],callbacks:{onComplete:function(n){var a,r,o,l;(t++,n[i.rootID]&&(r=n[i.rootID].type_icon_url,a=n[i.rootID]["ds6w:label"],l=n[i.rootID]["ds6w:type"],o=D.getParentType(n[i.rootID]["ds6w:type"])?D.getParentType(n[i.rootID]["ds6w:type"]):l,n[i.rootID]["ds6wg:revision"]&&(a+=" "+n[i.rootID]["ds6wg:revision"]),T.push(a),F.push({labelItem:a,iconItem:r,valueItem:i.rootID,type:o})),i)?"RepRef"===j(i.rootID)?O("errorShape"):e():O()},onFailure:function(){t++;[{type:"ENOStrRefinementSpecification",label:"Filter"},{type:"Document",label:"Document"},{type:"SIMItfSimulation",label:"Iterference Simulation"},{type:"PLMPIMMetricReference",label:"Iterference Metric"},{type:"DesignSight",label:"Physics Simulation"},{type:"Requirement",label:"Requirement"},{type:"Requirement Specification",label:"Requirement Specification"},{type:"R2V_FeatureState",label:"R2V_FeatureState"}].some(n=>{if(i.type===n.type)return T.push(n.label),F.push({labelItem:n.label+t,valueItem:i.rootID,type:i.type}),e(),!0})}}})})}).then(function(){_()}):_()}else k.end()};var W=this.endExecute;this.endExecute=function(){I=null,b=null,R=null,L=null,y&&(y.destroy(),y=null),F=[],T=[],M&&M.destroy(),w&&w.destroy(),M=w=null,S=void 0,I=b=R=void 0,W()}}})}),define("DS/DMUReviewPersistence/DMUAddHighlightCmd",["DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/DMUBaseUIControllers/DMUCommentsController","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r,o){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var l,s,d=this,c=e.frameWindow||this.getFrameWindow(),u=c.getViewer(),g=null,m=null;function p(){s||(s=new t),s.build({type:"error",autoHide:!0,message:o.createHighlight.errorMessage,body:c.getUIFrame()}),l&&l.fireEvent("onHighlightCreationFailed"),d.end()}this._createNewHighlight=function(e,t,i){var a=n.getReviewContext({viewer:c.getViewer()}).getValidation();e&&e.getParent()?(l=n.giveEventsController({viewer:u}),r.addHighlight({iCtxViewer:n.getContextViewer({viewer:u}),validation:a,markupRepRef:t,slide:e,onHighlightCreationCompleted:function(){d.end()},onHighlightCreationFailed:function(){p(),d.end()}})):(!1===i&&p(),d.end())},this.beginExecute=function(){var e,r=n.getReviewContext({viewer:c.getViewer()}).getValidation();if(r.getCurrentMarkup()){var l=null,s="ReviewMarkup"===r.getCurrentMarkup().getValType()?r.getCurrentMarkup():r.getCurrentMarkup().getRepRef(),u=i.giveDMUCommentsController({context:c});u?(e=a.get()).length&&"DMUComment"===e[0].pathElement.getLastElement().getDMUType()?((l=u.getDMUObjectFromPathElement(e[0].pathElement))&&l.getParent&&l.getParent()&&l.getParent().getMarkupOwner&&(s=l.getParent().getMarkupOwner()),d._createNewHighlight(l,s,!0)):((m=new t).build({body:c.getUIFrame(),type:"info",notificationType:"HelpNotification",message:o.createHighlight.selectHighlight}),g=a.onAdd(function(){(e=a.get()).length>0&&(l=u.getDMUObjectFromPathElement(e[0].pathElement)),d._createNewHighlight(l,s,!0)})):(l=s.getMarkupContent().getSlides().length>0?s.getMarkupContent().getCurrentSlide():null,d._createNewHighlight(l,s,!1))}else p(),d.end()},this.cancelExecute=function(){this.end()},this.endExecute=function(){a.unsubscribe(g),m&&m.destroy()}}})}),define("DS/DMUReviewPersistence/DMUReviewDeleteCmd",["DS/ApplicationFrame/Command","DS/CATWebUXComponents/CATWebUXNotification","DS/DMUBaseExperience/DMUContextManager","DS/Selection/CSOManager","DS/DMUReviewPersistence/DMUAuthReviewPersistenceServices","i18n!DS/DMUReviewPersistence/assets/nls/DMUReviewPersistence"],function(e,t,n,i,a,r){"use strict";return e.extend({init:function(e){e.mode="shared",e.repeatMode=!1,e.isAsynchronous=!0,this._parent(e);var o,l=this,s=e.frameWindow||this.getFrameWindow(),d=s.getViewer();function c(){o||(o=new t),o.build({type:"error",autoHide:!0,message:r.createCheck.errorMessage,body:s.getUIFrame()});var e=n.giveEventsController({viewer:d});e&&e.fireEvent("onCheckDeletionFailed"),l.end()}this.beginExecute=function(){var e=i.get(),t=n.getContextViewer({viewer:d}),r=e[0].pathElement.getLastElement().getOwner(),o=r.getPlmID(),s=r.getType();a.deleteObject({ctxViewer:t,objectId:o,type:s,onSaveFailed:c}),l.end()}}})});