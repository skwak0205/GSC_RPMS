function LibraryEditor(e){"use strict";var t={leftPanelState:!0,isWelcomePanelCollapsed:!1},i={rightPanelState:!1,size:300},r={widget:null,filterFromWin:null,libraryContent_Cont:null,libraryContentController:null,libraryTree_div:null,libraryTreeDoc_div:null,libraryTree_Cont:null,libraryIdCard_div:null,libraryIdCard_Cont:null,core:null,widthToHideLeftPanel:300,_actionbar:null,libraryTree_W_NotLinked:!1,css_view_class:"windowed",_mouseEventsManager:{unlockMouseMove:!1,draggingXSlider:null,mouseStartXSlider:null,initialMouseStartXSlider:null,dragginDirection:null,cancelDragging:!1,spanPosition:null,widthLeftDiv:null,widthRightDiv:null,widthLeftDivSave:null,widthRightDivSave:null,widthGlobalDiv:null,newWidthGlobalDiv:null},init:function(e){var r=this;require(["DS/LibraryEditor/utils/LibraryEditorUtil"],function(e){var r=e.getLeftPanelStatus(),n=e.getRightPanelStatus();Promise.all([r,n]).then(function(e){t=e[0],i=e[1]})}),require(["DS/PADUtils/PADSettingsMgt"],function(e){e.setSetting("columnParametrization",!0),e.setSetting("activateTXO",!0)}),require(["DS/IPClassifyUtil/IPClassifyUtility"],function(e){e.isCustomizedEnv(),e.initURLSAsync().then(function(){r.migratePreferences()})}),this.widget=e.widget,this.dataForActiveClassODT=e.dataForActiveClassODT,e.filter?this.filterFromWin=e.filter:this.filterFromWin=null,e.defaultSelectionPath&&(this.widget.defaultSelectionPathFromWin="root,LibrarySection_AllLibraries,"+e.defaultSelectionPath),this.widget.addEvent("onLoad",this.onLoad.bind(this)),this.widget.addEvent("onRefresh",this.onRefresh.bind(this)),this.widget.addEvent("onDestroy",this.onDestroy.bind(this)),this.widget.addEvent("onResize",this.onResize.bind(this)),this.widget.changeInPreference={};var n={},a={};this.widget.addEvent("onEdit",function(){r.widget.preferences.forEach(function(e){"hidden"!==e.type&&(n[e.name]=r.widget.getValue(e.name))})}),this.widget.addEvent("endEdit",function(e){!(!e||!e.submitted&&!e.needRefresh)&&(r.widget.changeInPreference={},Object.keys(n).forEach(function(e){a[e]=r.widget.getValue(e),n[e]!==a[e]&&(r.widget.changeInPreference[e]=a[e])}))})},onRefresh:function(e){var t=this;require(["DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADSettingsMgt","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility"],function(i,r,n,a,o,s){var l=[];l.push(s.initURLSAsync()),t.widget.changeInPreference.x3dPlatformId&&(t.widget.changeInPreference={}),Promise.all(l).then(function(){var a=s.isIndexedMode();if(o.getContent().updateFilterBI(a),o.getContent().updateComputedColumns(),t.libraryContent_Cont.addEvent("onCompleteRefreshNodes",function(e){this.removeEvent("onCompleteRefreshNodes"),r.displayNotification({message:n.msg_info_refresh,className:"primary"})}),e&&UWA.is(e.authored.deleted,"array")){var l=i.getCurrentLibrary();l.getID()===e.authored.deleted[0]&&l.getParent().select(!0)}o.getTreeCont().refreshLibraryTree(),o.getContent().refreshLibraryContent()})})},setCtxMenu:function(e,t,i){this.libraryContentController&&this.libraryContentController.webInWinCtxMenu(e,t)},insertSelectedSearchObjs:function(e){var t=e[0].split(",");require(["DS/ApplicationFrame/CommandsManager"],function(e){if(e)try{e.getCommand("AddExistingContent")._processInsertOperation(t)}catch(e){console.error("Error trying to execute command","AddExistingContent",e)}})},showMessage:function(e,t){require(["DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(i,r){i.displayNotification({message:r.get(e),className:t})})},onWebInWinFilterChange:function(e){this.libraryContentController&&this.libraryContentController.onWebInWinFilterChange(e)},onWebInWinTaggerVisChange:function(e){},onClearSelection:function(){require(["DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e){e.getContent().getView().getPADTreeDocument().getXSO().empty()})},onDestroy:function(){},onResize:function(){var e=this;setTimeout(function(){e.libraryGlobal_div&&e.libraryIdCard_Cont&&0!==e.libraryGlobal_div.clientWidth&&e.libraryIdCard_Cont.updateDisplayPath()},500)},preferenceIsNotSet:function(e){return void 0===widget.getValue(e)||null===widget.getValue(e)},migratePreferences:function(){return new Promise(function(e){require(["text!DS/LibraryEditor/assets/libraryVersion.json","DS/LibraryEditor/utils/LibraryMigration","DS/IPClassifyUtil/IPClassifyPreference"],function(t,i,r){let n=JSON.parse(t);var a=[];let o=new Promise(function(e){r.get("LibraryFavPrefVersion",function(t){!t||!t.version||t.version<n.LibraryFavPrefVersion?i.migrateFavPreferences(null,n.LibraryFavPrefVersion).then(function(){e()}):e()},!1)});a.push(o);let s=new Promise(function(e){r.get("LibraryTreeStrcutPrefVersion",function(t){!t||!t.version||t.version<n.LibraryTreeStrcuturePrefVersion?i.migrateTreeStructurePreferences(null,n.LibraryTreeStrcuturePrefVersion).then(function(){e()}):e()})});a.push(s),Promise.all(a).then(function(){e()})})})},onLoad:function(){this.probeHeader=this.widget.id+"_"+this.widget.getTitle()+"_",window.top.performance.mark("onLoad_begin"),window.top.performance.measure(this.probeHeader+"createToOnLoad","createWidget_begin","onLoad_begin");var e=this;require(["DS/PADUtils/Configuration","text!DS/LibraryEditor/assets/LibraryEditorConf.json","DS/PADServices/utils/AttributesMgt"],function(t,i,r){var n=JSON.parse(i);t.mergeConfig(n),r.updateAttributesList(n.columnsCusto),require(["UWA/Core","DS/PADUtils/PADCommandProxy","DS/PADUtils/PADSettingsMgt","DS/PADUtils/PADSharedSettings","DS/PADUtils/PADUtilsServices","DS/IPClassifyUX/LibraryContent","DS/LibraryEditor/dataProvider/LibraryContentDataProvider","DS/IPClassifyUX/LibraryIdCardCont","DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider","DS/IPClassifyUX/LibraryTree","DS/LibraryEditor/dataProvider/LibraryTreeDataProvider","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/dataProvider/LibraryCSODataProvider","DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider","DS/LibraryEditor/dataProvider/LibraryCommandsIconBarProvider","DS/LibraryEditor/ActionBar/LibraryActionBar","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/UIKIT/Mask","DS/LibraryEditor/utils/LibraryEditorKeyboardListener","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyUtility","DS/PADUtils/PADProbes","DS/LibraryEditor/utils/FilterUtils","DS/IPClassifyUXUtil/CredentialsView","text!DS/LibraryEditor/assets/library_settings.json","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/PADUtils/PADContext"],function(t,i,n,a,o,s,l,d,c,u,m,y,f,p,g,b,v,h,C,_,L,S,E,w,D,A,x,P,I,T,N){var U=e.filterFromWin;U?UWA.is(U,"string")?x.setUQLFilter(U):x.setFilters(U):x.resetEndItemFilter(),window.top.performance.mark("loadRequire_end"),window.top.performance.measure(e.probeHeader+"loadRequire","createWidget_begin","loadRequire_end"),widget.setValue("tenantAware",!0),n.addEventOnce("onNoSecurityContext",function(e){if(!0!==e){L._isSecurityCTXInitialized=!1,widget.setBody(" ");var t=UWA.createElement("div",{text:v.get("authentication_error")});t.set("styles",{position:"absolute",top:"40%",bottom:"30%",left:"30%",right:"30%"}),t.inject(widget.body)}}),n.addEvent("onPad_security_ctx",function(e){L.getContent()&&L.getContent().getView()&&L.getContent().getView().options&&L.getContent().getView().options.model&&L.getContent().getView().options.model.getModelEvents()&&L.getContent().getView().options.model.getModelEvents().publish({event:"titleRecalc",data:y.getCurrentLibrary()._options.label})}),widget.addPreference({name:"pad_security_ctx",type:"hidden"});var R=JSON.parse(I);n.setApp(R.padsettings,"enopad",!0),n.setSetting("activate_padprobes",!0),n.setSetting("add_objects_when_select",!1),A.initialize({padid:widget.id,padtitle:widget.getTitle()}),a.addSharedSettings(widget,["x3dPlatformId"]),widget.setValue("editProperties_readOnly",!1),widget&&widget.lang&&n.setSetting("lang",widget.lang),e.widget.addEvent("endEdit",n.updateWidgetPreferences.bind(n)),n.updateWidgetPreferences(),e.updateSecurityPreference();var O=e;if(O.options={},O.addEvent=(()=>{}),O.checkOnCommand=!1,N.set(O),T.addModeIntervalPreferences({refreshView:function(){require(["DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e){e.getTreeCont().refreshLibraryTree(),e.getContent().refreshLibraryContent()})},updateTaggerAndComputeColumns:function(e){require(["DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO"],function(t,i){t.getContent().updateComputedColumns(),"Library"===(i.getCurrentLibrary()&&i.getCurrentLibrary().getType())&&t.getContent().updateFilterBI(e)})}}),e.widget.getValue("x3dSharedId")||e.widget.getValue("x3dAppId")||e.widget.addPreference({name:"x3dAppId",type:"hidden",defaultValue:"ENOFOL3_AP"}),e.widget.getValue("x3dSharedId")||e.widget.addPreference({name:"x3dSharedId",type:"hidden",defaultValue:"LibraryEditor_"+o.getWidgetId()}),P.render(),null===e.libraryTree_Cont||void 0===e.libraryTree_Cont){e.core=t,e.widget.body.empty(),e._buildSkeleton();e.widget.addEvent("endEdit",function(){e.widget.getPreferences().forEach(function(t){var i="boolean"===t.type&&UWA.is(t.value,"string")?e.convertToBool(t.value):t.value;e.widget.setValue(t.name,i)})}),e.libraryGlobal_div=e.widget.body.container,e.libraryTreeDoc_div=e.widget.body.right_side_div,e.libraryIdCard_div=e.widget.body.top_right_side_div,e.libraryContent_div=e.widget.body.bottom_right_side_div;var F=e._initializeLibraryEditorComponent.bind(e);if(null===e.libraryContent_Cont){var M={x3dAppId:e.widget.getValue("x3dAppId"),lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),layout:{view_customization:null,css_view_class:e.css_view_class,store_roots_in_pref:!0,padshell:!0},authorize_setStructure:!0,settings:R};e.widget.getValue("LibraryCusto_treelistview_v1")?(M.layout.view_customization=JSON.parse(D.jsonUnzip(e.widget.getValue("LibraryCusto_treelistview_v1"))),M.layout&&M.layout.view_customization&&Array.isArray(M.layout.view_customization.selectedExtensions)&&Array.isArray(M.layout.view_customization.selectedTypes)&&r.updateSelectedParams({selectedExtensions:M.layout.view_customization.selectedExtensions,selectedTypes:M.layout.view_customization.selectedTypes}),F(M)):o.app_initialization(function(){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService"],function(t){t.getUserPreferences({name:e.widget.getValue("x3dAppId")+"_Library_v1",onComplete:function(e){var t=null;e&&e.length>0&&(t=JSON.parse(JSON.stringify(D.jsonUnzip(e)))),M.layout.view_customization=t,M.layout&&M.layout.view_customization&&Array.isArray(M.layout.view_customization.selectedExtensions)&&Array.isArray(M.layout.view_customization.selectedTypes)&&r.updateSelectedParams({selectedExtensions:M.layout.view_customization.selectedExtensions,selectedTypes:M.layout.view_customization.selectedTypes}),F(M)},onFailure:function(e){F(M)}})})}),e.getSelectedNodes=function(){return y.getSelectedNodes()},e.getCurrentLibrary=function(){var e=w.getCurrentSecurityContextAndLibraryData(!0);return JSON.stringify(e)},e.getSecurityContext=function(){return{SecurityContext:n.getSetting("pad_security_ctx"),tenant:widget.getValue("pad_tenant")}},e.beginBlockingTransaction=function(t){S.mask(e.libraryContent_div,t)},e.endBlockingTransaction=function(){S.unmask(e.libraryContent_div)},e.author=function(e){},e.displayNotification=function(e){_.displayNotification({message:e.msg,className:e.eventID})},e.getPADTreeDocument=function(){return L.getContent().getView()?L.getContent().getView().getPADTreeDocument():null},e.toggleView=function(e){UWA.is(L.getContent().getView().toggleView(e))&&L.getContent().getView().toggleView(e)},e.getPADTreeListView=function(){return L.getContent().getView().getPADTreeListView()},e.getContent=function(){return L.getContent()}}}})})},_slidderMoveEndCallback:function(){this.libraryIdCard_Cont&&this.libraryIdCard_Cont.updateDisplayPath()},_buildSkeleton:function(){if(!this.core.is(this.widget.body.container)){this.widget.body.container=UWA.createElement("div",{class:"LibraryEditor_global_container"}).inject(this.widget.body,"top"),this.widget.body.right_side_div=UWA.createElement("div",{class:"LibraryEditor_right_side_div"}).inject(this.widget.body.container),this.widget.body.top_right_side_div=UWA.createElement("div",{class:"LibraryEditor_top_right_side_div"}).inject(this.widget.body.right_side_div),this.widget.body.bottom_right_side_div=UWA.createElement("div",{class:"LibraryEditor_bottom_right_side_div"}).inject(this.widget.body.right_side_div);var e=UWA.createElement("div",{class:"LibraryEditor_containerTools"});require(["DS/PADServices/utils/GlobalModelEvents"],function(t){t.getModelEvents().subscribe({event:"IPClassifyColumnCusto/Views/showInWidgetBody"},function(t){t.html?(e.empty(),t.html.inject(e),e.inject(widget.body)):!0===t.restore&&e.remove()})})}},convertToBool:function(e){return"true"===e.toLowerCase()},_initializeLibraryEditorComponent:function(e){var r=this,n=require("DS/IPClassifyUX/LibraryTree"),a=require("DS/LibraryEditor/dataProvider/LibraryTreeDataProvider"),o=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),s=require("DS/IPClassifyUX/LibraryIdCardCont"),l=require("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider"),d=require("DS/IPClassifyUX/LibraryContent"),c=require("DS/LibraryEditor/dataProvider/LibraryContentDataProvider"),u=require("DS/LibraryEditor/utils/LibraryEditorKeyboardListener"),m=require("DS/PADUtils/PADUtilsServices"),y=require("DS/LibraryEditor/dataProvider/LibraryCSODataProvider"),f=require("DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider"),p=(require("DS/LibraryEditor/dataProvider/LibraryCommandsIconBarProvider"),require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor")),g=require("DS/LibraryEditor/service/LibraryTypeService"),b=(require("DS/LibraryEditor/utils/LibraryEditorUtil"),require("DS/PADServices/utils/GlobalModelEvents")),v=require("DS/IPClassifyUtil/IPClassifyCommunication"),h=require("DS/WidgetServices/WidgetServices");m.app_initialization(function(){m.getSecurityContext(function(C){C&&""!==C.securityContext&&C.securityContextList.length>0&&(null===r.libraryTree_Cont&&m.app_initialization(function(){var u=new n({lang:r.widget.lang?r.widget.lang:r.widget.getValue("lang"),css_view_class:r.css_view_class,dataProvider:a,CSOProvider:y,DnDProvider:f,LibraryTypeService:g,events:{onReady:function(){if(o.setTreeCont(this),r.libraryTree_Cont=this._libraryTreeView,null!==r.libraryTree_Cont)r.libraryTree_Cont.setOption("_libraryContentView",this._libraryTreeView);else{if(!0===r.libraryTree_W_NotLinked)throw"LibraryTree are not linked !!!";r.libraryTree_W_NotLinked=!0}var n=r._retrieveinitializationOpts(),a=UWA.extend(e,n);a.placeholderData={},a.placeholderData.multiplePlaceholders=!1,a.placeholderData.placeholders={},a.placeholderData.placeholders.addExistingCI={},a.placeholderData.placeholders.addExistingCI.labelNLS=p.placeholder_msg,a.placeholderData.placeholders.addExistingCI.commandNLS=p.placeholder_CMD1,a.placeholderData.placeholders.addExistingCI.command="AddExistingContent",a.leftTriptychElem=r.libraryTree_Cont.elements.container,a.dataProvider=c,a.CSOProvider=y,a.DnDProvider=f,a.thumbnailAttributeDelayed=!0,r.migrateContentPreferences(e.layout.view_customization).then(function(){r.libraryContentController=new d(a),o.setContent(r.libraryContentController),null===r.libraryIdCard_Cont&&(r.libraryIdCard_Cont=new s({lang:r.widget.lang?r.widget.lang:r.widget.getValue("lang"),css_view_class:r.css_view_class,parentDiv:r.libraryIdCard_div,leftState:t,rightState:i,modelEvents:b.getModelEvents(),libraryCSODataProvider:y,libraryDataProvider:l,events:{onReady:function(){r.libraryIdCard_Cont=this,r.libraryIdCard_Cont.render().inject(r.libraryIdCard_div)}}})),r.widget.dispatchEvent("onLibraryEditorReady"),h.isWebInWinEnvironment()&&v.publish("onLibraryEditorReady","")})}}});o.setTreeCont(u)}),r._keyboardListener||(r._keyboardListener=new u,r._keyboardListener.startObservingKeyboard()),r.libraryIdCard_Cont.getView().buildIconBar())})})},migrateContentPreferences:function(e){return new Promise(function(t){e?require(["text!DS/LibraryEditor/assets/libraryVersion.json"],function(i){var r=JSON.parse(i).LibraryContentViewVersion;r!==e.version?require(["DS/LibraryEditor/utils/LibraryMigration"],function(i){i.migrateContentPreferences(e,r).then(function(){t()})}):t()}):t()})},updateSecurityPreference:function(){window.library&&require(["DS/PADUtils/PADSettingsMgt"],function(e){var t="ctx::"+window.library.params.securityContext;e.setSetting("pad_security_ctx",t)})},_retrieveinitializationOpts:function(){var e=this;return{renderTo:e.libraryContent_div,events:{onActionBarReadyToBuild:function(){var r=require("DS/IPClassifyUX/LibraryIdCardCont");window.DEBUG_ActionBar_Require=!0,window.DEBUG_ActionBar_CmdInstantiation=!0,window.DEBUG_ActionBar_Xml=!0,window.DEBUG_ActionBar_ProcessCommandHeader=!0,window.DEBUG_ActionBar_Init=!0,e.elements=this.elements,e.options=this.options,e.togglePanel=this.togglePanel,null===e.libraryIdCard_Cont&&(e.libraryIdCard_Cont=new r({lang:e.widget.lang?e.widget.lang:e.widget.getValue("lang"),css_view_class:e.css_view_class,parentDiv:e.libraryIdCard_div,leftState:t,rightState:i,modelEvents:GlobalModelEvents.getModelEvents(),libraryCSODataProvider:LibraryCSODataProvider,libraryDataProvider:LibraryIdCardDataProvider,events:{onReady:function(){e.libraryIdCard_Cont=this,e.libraryIdCard_Cont.render().inject(e.libraryIdCard_div)}}}))},onReady:function(){e.libraryContent_Cont=this,e.addEvent=e.libraryContent_Cont.addEvent.bind(e.libraryContent_Cont),e.libraryContent_Cont.dropInvitContainer&&(e.libraryContent_Cont._dropInvitContainer=e.libraryContent_Cont.dropInvitContainer),e.libraryContent_Cont.options.renderTo&&(e.libraryContent_Cont._dropInvitContainer.hide(),e.libraryContent_Cont.render().inject(e.libraryContent_Cont.options.renderTo));require("DS/PADUtils/PADSettingsMgt");e.updateSecurityPreference(),require(["DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyCommunication","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e,t,i){e.isNatifEnvironnement()&&i.getContent().getView().getPADTreeDocument().getXSO().onChange(function(){var r=i.getContent().getView().getPADTreeDocument().getXSO().get(),n=[];r.forEach(function(t){if(e.isWebInWinEnvironment()){var i={};i.id=t.getID(),i.type=t._options.type,n.push(i)}else n.push(t.getID())}),t.publish("onObjectSelected",n)})});var t=e.widget.getValue("X3DContentId");if(t){var i=UWA.is(t,"string")?JSON.parse(t):t;if(i.data.items.length>0){var r=i.data.items[0].objectId;e.widget.setValue("X3DContentId","");var n=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),a=require("DS/IPClassifyUtil/IPClassifyAlert");n.getTreeCont().expandTreeAndSelectLibrary({libraryToFindAndSelect:{id:r},onFailure:function(e){a.displayNotification({message:e instanceof Error?e.message:e,className:"error"})},isInvisible:!0})}}},onCustoViewChange:function(t){require(["DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/AttributesMgtV2"],function(i,r){try{t.selectedTypes=r.getSelectedTypes(),t.selectedExtensions=r.getSelectedExtensions()}catch(e){}e.widget.setValue("LibraryCusto_treelistview_v1",i.jsonZip(JSON.stringify(t)))})},onSaveAsTemplate:function(t){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/AttributesMgtV2"],function(i,r,n){try{t.selectedTypes=n.getSelectedTypes(),t.selectedExtensions=n.getSelectedExtensions()}catch(e){}e.widget.setValue("LibraryCusto_treelistview_v1",r.jsonZip(JSON.stringify(t))),i.saveUserPreferences({name:e.widget.getValue("x3dAppId")+"_Library_v1",value:r.jsonZip(JSON.stringify(t)),onComplete:function(e){console.log("Saved as template")},onFailure:function(e){console.warn("Cannot save customization template")}})})},onSwitchView:function(){require("DS/LibraryEditor/ActionBar/LibraryCommandManager").updateCommands()},onToggleView:function(){require("DS/LibraryEditor/ActionBar/LibraryCommandManager").updateCommands()}}}}};return r.init(e),r}define("DS/LibraryEditor/service/LibraryServices",["DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,i,r,n){"use strict";return{AddContent:function(i){if(!UWA.is(i.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(i.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(i.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");if(i.IDs.length>0){var r,n=i.library,a=(r=n||e.getCurrentLibrary())?r.id||r.getID():"";a&&a.length?t.addcontent({pid:a,IDs:i.IDs,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var r=t.error;console.log("AddContent WebService Err : "+r),r.length>200&&(r=null),i.callbacks.onFailure(r)}else i.callbacks.onComplete(e)},onFailure:i.callbacks.onFailure}):i.callbacks.onFailure(i)}else i.callbacks.onFailure(i)},RemoveContent:function(i){if(!UWA.is(i.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(i.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(i.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");if(i.IDs.length>0){var r,n=i.library,a=(r=n||e.getCurrentLibrary())?r.id||r.getID():"";a&&a.length?t.removecontent({pid:a,IDs:i.IDs,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var r=t.error;console.log("Remove WebService Err : "+r),r.length>200&&(r=null),i.callbacks.onFailure(r)}else i.callbacks.onComplete(e)},onFailure:i.callbacks.onFailure}):i.callbacks.onFailure(i)}else i.callbacks.onFailure(i)},getLatestRevision:function(e){if(!UWA.is(e.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(e.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(e.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var i=e.objectsToTreat;t.getLatestRevision({objectsToTreat:i,onComplete:function(t){var i=t?JSON.parse(t):void 0;if(i&&i.error){var n=i.error;console.log("getLatestRevision WebService Err : "+n),n.length>200&&(n=null),i.information&&r.displayNotification({message:i.information,className:"primary"}),e.callbacks.onFailure(n)}else e.callbacks.onComplete(t)},onFailure:e.callbacks.onFailure})},replaceContent:function(i){if(!UWA.is(i.callbacks,"object"))throw new Error("No callbacks function defined");if(!UWA.is(i.callbacks.onComplete,"function"))throw new Error("No onComplete callback function defined");if(!UWA.is(i.callbacks.onFailure,"function"))throw new Error("No onFailure callback function defined");var r=i.IDsRemoved.length;if(r===i.IDsAdded.length&&r>0){var n=e.getCurrentLibrary(),a=n?n.id||n.getID():"";a&&a.length?t.replaceContent({pid:a,IDsRemoved:i.IDsRemoved,IDsAdded:i.IDsAdded,onComplete:function(e){var t=e?JSON.parse(e):void 0;if(t&&t.error){var r=t.error;console.log("ReplaceContent WebService Err : "+r),r.length>200&&(r=null),i.callbacks.onFailure(r)}else i.callbacks.onComplete(e)},onFailure:i.callbacks.onFailure}):i.callbacks.onFailure(i)}else i.callbacks.onFailure(i)}}}),define("DS/LibraryEditor/commands/ActionBar_AddExistingContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/IPClassifyUtil/IPClassifyCommunication","UWA/Utils/InterCom"],function(e,t,i,r,n,a){"use strict";return t.extend({labelTopBar:e.i18n("Add Content"),isInsert:!0,data:{},_modalChooser:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/views/PADModalChooser","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/PADUtils/PADUtilsServices"],function(e,t,i,r,n,a,o){});var t=this;widget.addEvent("onRefresh",function(){UWA.is(t._modalChooser)&&(t._modalChooser.close(),t._modalChooser=null)})},beginExecute:function(){this._buildCellSkeleton()},initialize:function(){this.socketName="search_socket_"+(new Date).getTime(),this.socket=new a.Socket(this.socketName,{dispatchRetryInterval:5}),this.socket.subscribeServer("SearchComServer"),this.listener=this.selected.bind(this),this.socket.addListener("Selected_Objects_search",this.listener);var e=this.option_s();return this.socket.dispatchEvent("RegisterContext",e),this},selected:function(e){var t,i,r=[];if(this.callback){for(t=0,i=e.length;t<i;t++)r.push(e[t]);this.callback(r)}},option_s:function(e,t,i,r,n,a,o){var s=require("DS/LibraryEditor/utils/Library_CSO")._currentLibrary.id,l={};return l.title=e,l.mode="furtive",l.app_socket_id=this.socketName,null!==widget&&void 0!==widget?l.widget_id=widget.id:l.widget_id="",l.default_with_precond=!0,l.show_precond=!0,l.idcard_activated=!1,l.multiSel=n,l.role=i,l.precond="",l.specific_source_parameter={"3dspace":{additional_query:"NOT (interface:"+s+")"}},t&&(t=t.split(",")).forEach(function(e,t){0!==t&&(l.precond+=" OR "),l.precond+=e}),o&&o.length>0&&(l.columns=o),l},activate:function(e,t,i,r,a,o,s,l){var d=this.option_s(e,t,i,r,a,s,l);this.callback=o,!0===widget.getValue("noCompass")?n.publish("SelectFromSearch",d.specific_source_parameter["3dspace"].additional_query+" AND NOT (flattenedtaxonomies:(types/Libraries)) AND NOT (flattenedtaxonomies:(types/Classification))"):this.socket.dispatchEvent("InContextSearch",d)},launchSearch:function(e){e.additionalQuery="",this.initialize(),this.activate("Add Existing Item",e.allowedTypes,e.role||"",e.criteria,e.bMultiSel,function(e){this._objects_selected(e)},e.additionalQuery,e.selectable)},execute:function(){var e=this,t=require("DS/LibraryEditor/utils/Library_CSO"),i=require("DS/IPClassifyUtil/IPClassifyAlert"),r=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),n="";t.getCurrentLibrary()&&(n=t.getCurrentLibrary().getID()),n.length?(UWA.is(this._modalChooser)&&this._modalChooser.close(),setTimeout(function(){e.launchSearch({allowedTypes:"",role:"",criteria:"",additionalQuery:"",bMultiSel:!0,dg:e})})):i.displayNotification({message:r.msg_warning_nocurrentlibrary,className:"warning"})},_objects_selected:function(e){var t=require("DS/PADUtils/PADUtilsServices").getPlatformId(),i=[],r=!1;e.forEach(function(e){var n=e.resourceid,a=e.sourceid,o=null;if(a){var s=a.split(":");s.length>0&&(o=s[1])}o&&o!==t?r=!0:i.push(n)}),!0===r?IPClassifyAlert.displayNotification({message:Nls.msg_warning_addnotsupported_from_different_tenant,className:"warning"}):this._processInsertOperation(i)},_processInsertOperation:function(t){var i=require("DS/LibraryEditor/utils/Library_CSO"),n=require("DS/IPClassifyUtil/IPClassifyAlert"),a=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),o=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),s=require("DS/LibraryEditor/commands/LibraryCommands"),l=require("DS/LibraryEditor/service/LibraryServices"),d=i.getCurrentLibrary();t.length>0&&(s._startProgressBar(a.AddExisting_content_loading),l.AddContent({IDs:t,callbacks:{onComplete:function(i){s._offProgressBar();var l="",c=!1,u=(t.length,l=a.replace(a.add_in_class,{libraryname:d.options.label}));if(i){var m,y,f=JSON.parse(i),p=f.totalCount,g=f.failedCount,b=f.alreadyExistCount;g>0?(b>0?g==b?p==g?l=a.all_in_class:p>g&&(l=a.replace(a.few_added_few_exist,{OK:p-g,exist:b}),c=!0):g>b&&(p==g?l=a.replace(a.few_exist_few_failed,{exist:b,KO:g-b}):p>g&&(l=a.replace(a.few_added_few_exist,{OK:p-g,exist:b}),c=!0,y=a.replace(a.few_failed,{KO:g-b}),m="error")):g==p?l=a.all_failed:g<p&&(l=a.replace(a.few_added,{OK:p-g}),c=!0,y=a.replace(a.few_failed,{KO:g}),m="error"),l&&(l=u+": "+l)):(l=a.replace(a.msg_info_Addinlibrary,{number:p,libraryname:d.options.label}),c=!0),1==c?(r.setAuthoringMode("authoring",l),e.is(o.getContent())&&o.getContent().loadContentAndSelect(d),y&&n.displayNotification({message:u+": "+y,className:m})):n.displayNotification({message:l,className:"error"})}},onFailure:function(e){s._offProgressBar(),n.displayNotification({message:e?a.msg_error_Addinlibrary+"<br>"+e:a.msg_error_Addinlibrary,className:"error"})}}}))},_buildCellSkeleton:function(){var t=require("DS/LibraryEditor/utils/LibraryEditorcontrol");e.is(t.getContent()._libraryContentView.elements.container)||(t.getContent().elements.container=e.createElement("span",{class:"fonticon fonticon-1x fonticon-search",title:"Find in Context"}))},endExecute:function(){}})}),define("DS/LibraryEditor/commands/ActionBar_ExpandNCmd",["UWA/Core","DS/ApplicationFrame/Command"],function(e,t){"use strict";return t.extend({labelTopBar:e.i18n("Expand N levels"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/IPClassifyUtil/IPClassifyAlert","DS/PADUtils/views/PADLevelSel","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,i,r){})},beginExecute:function(){},execute:function(){var e=require("DS/IPClassifyUtil/IPClassifyAlert"),t=require("DS/PADUtils/views/PADLevelSel"),i=require("DS/LibraryEditor/utils/Library_CSO"),r=require("i18n!DS/LibraryEditor/assets/nls/LibraryEditor"),n=null;null===(n=i.getCurrentLibrary())?e.displayNotification({message:r.msg_warning_noselection,className:"warning"}):new t({css_style:"",events:{onApply:function(e){n.expandNLevels({numberOfLevelsToExpand:parseInt(e),initialLevel:n.getNodeDepth()})}}})},endExecute:function(){}})}),define("DS/LibraryEditor/utils/FilterUtils",["UWA/Class"],function(e){"use strict";return e.singleton({init:function(e){this.libraryFilter='flattenedtaxonomies:"types/General Library"',this.classFilter=["General Class"],this.classTreeFilter='flattenedtaxonomies:"types/General Class"',this.endItemFilter=null,this.excludeBOTypesFromContentView=["Document Family","Part Family"]},setUQLFilter:function(e){this.endItemFilter=e},setFilters:function(e){for(var t,i=0;i<e.length;i++){var r,n,a=null,o=null;try{if((r=(a=e[i]).values)&&r.length>0){for(var s=0;s<r.length;s++)o=o&&null!=o?o+' OR "'+r[s]+'"':'"'+r[s]+'"';n="("+a.name+": ("+o+"))",t=t?t+" AND "+n:n}}catch(t){console.warn("Failed to decode","",e[i],t)}}this.endItemFilter=t},resetLibraryFilter:function(){this.libraryFilter=null},resetClassFilter:function(){this.classFilter=null},resetEndItemFilter:function(){this.endItemFilter=null}})}),define("DS/LibraryEditor/service/LibraryTypeService",["UWA/Controls/Abstract","text!DS/PADUtils/assets/PADOpenCommandsSettings.json"],function(e,t){return e.singleton({TYPE_ROOT_LIBRARY_1:"General Library",TYPE_ROOT_LIBRARY_2:"Part Library",TYPE_ROOT_LIBRARY_3:"RootLibrary",TYPE_LIBRARY_1:"General Class",TYPE_LIBRARY_2:"Library",TYPE_LIBRARIES_SECTION:"LibrarySection_AllLibraries",TYPE_FAVORITES_SECTION:"LibrarySection_favorite",TYPE_CONTENT:"Content",openTypes:[],getOpenAvailableForTypes:function(e){if(0==this.openTypes.length&&e){var i=JSON.parse(t);i["openInCAD_"+e+"_supported_types"]&&(this.openTypes=i["openInCAD_"+e+"_supported_types"])}return this.openTypes},init:function(){},isRootLibrary:function(e){return e===this.TYPE_ROOT_LIBRARY_1||e===this.TYPE_ROOT_LIBRARY_2||e===this.TYPE_ROOT_LIBRARY_3},isLibrary:function(e){return e===this.TYPE_LIBRARY_1||e===this.TYPE_LIBRARY_2},isContent:function(e){return e===this.TYPE_CONTENT},inFamilyLibrary:function(e){return this.isRootLibrary(e)||this.isLibrary(e)},isSection:function(e){return e===this.TYPE_LIBRARIES_SECTION||e===this.TYPE_FAVORITES_SECTION},getPlmTypeFromContentDetails:function(e){if(e&&!(e.length<1)){for(var t,i,r,n,a="Content",o=0,s=e.length;o<s;++o)if("flattenedtaxonomies"===e[o].name){if("types/Classification"===e[o].value?t=!0:"types/General Class"===e[o].value?i=!0:"types/Libraries"===e[o].value?r=!0:"types/General Library"===e[o].value&&(n=!0),"types/Classification"===e[o].value[0]&&"types/General Class"===e[o].value[1]){a="Library";break}if("types/Libraries"===e[o].value[0]&&"types/General Library"===e[o].value[1]){a="RootLibrary";break}}return t&&i&&(a="Library"),r&&n&&(a="RootLibrary"),a}},getPLMTypeOfLibraryTreeNode:function(e){var t="";if(e){var i=e.plmType;t="Library"==i?"General Class":"RootLibrary"==i?"General Library":i}return t}})}),define("DS/LibraryEditor/utils/LibraryEditorcontrol",["UWA/Controls/Abstract"],function(e){return e.singleton({_Content:null,_TreeCont:null,_IdCardCont:null,_widgetOptions:{},getContent:function(){return this._Content},setContent:function(e){this._Content=e},getTreeCont:function(){return this._TreeCont},setTreeCont:function(e){this._TreeCont=e},getIdCardCont:function(){return this._IdCardCont},setIdCardCont:function(e){this._IdCardCont=e},setWidgetOptions:function(e){this._widgetOptions=e},getWidgetOptions:function(){return this._widgetOptions}})}),define("DS/LibraryEditor/LibraryWebInWin",["UWA/Widget","DS/i3DXCompass/Data","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyUtility","DS/PADServices/utils/WidgetProxy","UWA/Drivers/Alone"],function(e,t,i,r,n){var a=window.library.params;window.widget=new e,console.log("Inside LibraryWebInWin"),widget.setValue("noCompass",!0);var o=r.getTenantId();o&&(widget.setValue("x3dPlatformId",o),i.setSetting("x3dPlatformId",o),n.setValue("x3dPlatformId",o)),widget.body=UWA.createElement("div",{class:"libraryEditor",styles:{height:"100%",width:"100%"}}),t.initialize({myAppsBaseUrl:a.myAppsUrl,userId:a.userId,passportUrl:"",proxyTicketUrl:""}),document.body.innerHTML="",widget.body.inject(document.body,"top"),window.top.performance.mark("createWidget_begin");var s=new LibraryEditor({widget:widget,filter:window.library.filter||window.library.UQLFilter,defaultSelectionPath:a.defaultSelectionPath,contextID:a.contextID});return widget.dispatchEvent("onLoad"),widget.dispatchEvent("onRefresh"),widget.dispatchEvent("onDestroy"),widget.dispatchEvent("onResize"),s}),define("DS/LibraryEditor/utils/LibrarySearch",["UWA/Class","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","text!DS/LibraryEditor/assets/library_exclude_columns.json"],function(e,t,i){"use strict";return e.singleton({init:function(e){this._parent(e),this._predicateToHeaderMap=null,this._dynamicHeaderMap=[],this._dynamicMapSorted=!1,this._searchInfo=null,this._predAttrMap=new Map,this._attrPredicateMap=new Map,this._defaultPredicates=["ds6w:label","physicalid","mxid"],this._authModePredicates=["ds6w:label","physicalid","mxid","ds6w:description","ds6w:modified","ds6w:created","ds6w:responsible","ds6wg:revision","ds6w:type","ds6w:identifier","ds6w:status","ds6w:reservedBy"],this._authPersonAttributes=["ds6w:reservedby","ds6w:responsible"];this._searchInfo={with_indexing_date:!0,select_predicate:this._defaultPredicates.slice(0),select_file:["icon","thumbnail_2d"],order_field:"ds6w:modified",order_by:"desc",nresults:25}},getAuthModeNoSortColumns:function(e,t){var i=[],r=this;return Array.isArray(e)&&e.forEach(function(e){var n=e.ds6w||e.dataIndex;if(-1==r._authModePredicates.indexOf(n)){var a=e.attrDBName;a&&1==a.length?t&&i.push(e):t?(e.sortableFlag=!1,i.push(e)):i.push(n)}else t&&("ds6w:description"===e.ds6w&&(e.sortableFlag=!1),i.push(e))}),i},getOrderFiledForAuthMode:function(e){return-1==this._authModePredicates.indexOf(e)&&this._predAttrMap.get(e)?this._predAttrMap.get(e)[0]||"ds6w:modified":e},getSearchInfo:function(e,t){var i=Object.assign({},this._searchInfo);return!0===e?i.select_predicate=this._authModePredicates:t&&(i.select_predicate=this._authModePredicates.concat(this.getAuthAttributes())),i},filterExcludeListColumns:function(e){var t=[],r=JSON.parse(i);if(r){r=r.columnToExclude;for(var n=0;n<e.length;++n)-1==r.indexOf(e[n].dataIndex)&&t.push(e[n])}return t},getAuthAttributes:function(){var e=Array.from(this._predAttrMap.values());return e=e.filter(function(e){return null!=e}),[].concat.apply([],e)},setPredicates:function(e,t){var r=this,n=JSON.parse(i),a=[];n&&(a=n.predicateToExclude,n=n.columnToExclude),Array.isArray(e)&&e.forEach(function(e){if(e){var t=e.ds6w;t||(t=e.dataIndex),"tree"===t||e.isDynamic||-1===r._searchInfo.select_predicate.indexOf(t)&&-1===n.indexOf(t)&&-1===a.indexOf(t)&&r._searchInfo.select_predicate.push(t);var i=e.attrDBName;if(i)for(var o in r._predAttrMap.set(t,i),i)r._attrPredicateMap.set(i[o],t)}})},removeAllPredicates:function(){this._searchInfo.select_predicate=[],this._predAttrMap=new Map,this._attrPredicateMap=new Map,this._searchInfo.select_predicate=this._searchInfo.select_predicate.concat(this._defaultPredicates)},removePredicates:function(e){for(var t=[],i=[],r=0;r<e.length;++r){i.push(e[r].dataIndex),this._predAttrMap.delete(e[r].dataIndex);var n=e[r].attrDBName||[];for(var a in n)this._attrPredicateMap.delete(n[a])}this._searchInfo.select_predicate.forEach(function(e){-1===i.indexOf(e)&&t.push(e)}),this._searchInfo.select_predicate=t},getPersonPredicatesForAuth:function(){return this._authPersonAttributes},setAttrNameToPredMapping:function(e){this._attrNameToPredMapping||(this._attrNameToPredMapping={}),this._attrNameToPredMapping&&e&&(this._attrNameToPredMapping[e.key]=e.value)},getAttrNameToPredMapping:function(){return this._attrNameToPredMapping||(this._attrNameToPredMapping={}),this._attrPredicateMap.forEach((e,t)=>{this._attrNameToPredMapping[t]=e}),this._attrNameToPredMapping},resetAttrNameToPredMapping:function(){this._attrNameToPredMapping=null},setPredicateUnitMapping:function(e){UWA.extend(this.getPredicateUnitMapping(),e,!0)},getPredicateUnitMapping:function(){return this._predicateUnitMapping||(this._predicateUnitMapping={}),this._predicateUnitMapping},initPredicateToHeaderMap:function(e){if(!this._predicateToHeaderMap){this._predicateToHeaderMap=[];for(var t=0;t<e.length;t++){var i=e[t],r=i.text?i.text.toLowerCase():null;if(r&&i.ds6w){var n={header:r,predicate:i.ds6w};this._predicateToHeaderMap.push(n)}}}},addToPredicateHeaderMap:function(e){for(var t=0;t<e.length;++t){var i=e[t],r=i.text?i.text.toLowerCase():null;if(r&&i.ds6w){var n={header:r,predicate:i.ds6w};this._predicateToHeaderMap.push(n)}}},removeFromPredicateHeaderMap:function(e){this._predicateToHeaderMap=this._predicateToHeaderMap.filter(function(e){for(var t=0;t<this.length;++t)if(this[t].ds6w==e.predicate)return!1;return!0},e)},addToDynamicHeaderMap:function(e){var t=e.text?e.text.toLowerCase():null;if(t&&e.dataIndex){var i={toolTip:e.text,header:t,dataIndex:e.dataIndex,dbAttribute:e.dbAttribute};this._dynamicHeaderMap.push(i)}},resetDynamicHeaderMap:function(){this._dynamicHeaderMap=[],this._dynamicMapSorted=!1},getDynamicHeaderMap:function(){return this._dynamicHeaderMap},convertSearchQueryToFederated:function(e){for(var t=e.split(""),i="",r="",n=0;n<t.length;n++)if(i+=t[n],":"==t[n]||"="==t[n]||">"==t[n]||"<"==t[n]){r=r.concat(this.replaceHeader(i));var a=e.substring(n+1).trim();if(a.startsWith("=")&&(r=r.concat("="),a=a.substring(1).trim()),a.startsWith('"')){r=r.concat('"');var o=(a=a.substring(1)).indexOf('"'),s=a.substring(0,o),l=s.trim().split(" ");if(2==l.length&&this._nlsUnitData&&this._nlsUnitData[l[1]]&&this._nlsUnitData[l[1]].factor){var d=l[0]*this._nlsUnitData[l[1]].factor+parseFloat(this._nlsUnitData[l[1]].offset);r=r.concat(d),this._nlsUnitData=null}else r=r.concat(s);r=r.concat('"'),a=a.substring(o+1)}else if(a.startsWith("(")){r=r.concat("(");var o=(a=a.substring(1)).indexOf(")");r=r.concat(a.substring(0,o+1)),a=a.substring(o+1)}-1!=(o=a.indexOf(" "))?(r=r.concat(a.substring(0,o+1)),a=a.substring(o+1),r=r.concat(this.convertSearchQueryToFederated(a))):r=r.concat(a);break}return""===r?e:r},replaceHeader:function(e){var t=e,i=this._predicateToHeaderMap;this._dynamicMapSorted||(this._dynamicHeaderMap=this._dynamicHeaderMap.sort(function(e,t){return t.header.length-e.header.length}),this._dynamicMapSorted=!0),i=i.concat(this._dynamicHeaderMap);for(var r=0;r<i.length;r++){var n=i[r].header,a=i[r].predicate?i[r].predicate:i[r].dataIndex,o=e.toLowerCase().indexOf(n);if(-1!=o){t=(t=(t=(t="").concat(e.substring(0,o))).concat("["+a+"]")).concat(e.substring(o+n.length)),this._predicateUnitMapping[a]&&(this._nlsUnitData=this._predicateUnitMapping[a].nlsToUnits);break}}return t}})}),define("DS/LibraryEditor/service/LibraryEditorWebService",["UWA/Core","DS/WAFData/WAFData","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADSettingsMgt","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/utils/FilterUtils","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,i,r,n,a,o){"use strict";function s(e){return UWA.is(e,"array")?e.toString():e}return{_pageCount:50,content:function(e){var t={};UWA.extend(t,e);var i=a.endItemFilter,r=!1;i&&null!=i?("Library"==t.selectedType&&(r=!0),i=" AND ("+i+")"):i="";var o="";if(t.searchQuery)t.isSearchWithin=!0,e.isExactSearch?(o=n.convertSearchQueryToFederated(e.searchQuery),o="classification: "+e.mxid+' AND NOT (flattenedtaxonomies: ("types/Part Family" OR "types/Document Family"))'+i+" AND ("+o+")"):o="*"+e.searchQuery+"* AND classification: "+e.mxid+' AND NOT (flattenedtaxonomies: ("types/Part Family" OR "types/Document Family"))'+i;else if(r)o='flattenedtaxonomies:"types/General Class" OR ('+a.endItemFilter+")",t.isExpand=!0;else{o=function(e,t,i){if(t&&t.length>0){var r="";!0===i&&(r="NOT");for(var n=0,a=t.length;n<a;++n)e=e?e+" AND "+r+'(type == "'+t[n]+'" )':r+'( type == "'+t[n]+'" )'}return e}(o,a.excludeBOTypesFromContentView,!0),t.isExpand=!0}"Library"==t.selectedType&&(t.dynamicattrs=t.dynamicattributes),t.searchPageCount=this._pageCount,this._performSearchQuery(t,o,"content")},roots:function(e){var t='flattenedtaxonomies:"types/Libraries"',i=a.libraryFilter;i&&null!=i&&(t=i),!0!==e.fetchAll&&(e.searchPageCount=this._pageCount),e.searchQuery&&(t=t+" AND "+e.searchQuery),this._performSearchQuery(e,t,"roots")},favourites:function(e){this._performFetchQuery(e,"favourites")},libraries:function(e){var t={};UWA.extend(t,e),t.expand_iter="1",e.isExpandAll&&(t.expand_iter="-1");var i=a.classTreeFilter;t.filter=i,this._performExpandQuery(t,"libraries")},addcontent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.addcontent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/addItemsV2";if(t.headers={"content-type":"application/json"},t.IDs){var r=t.IDs,n=[];r.forEach(function(e){n.push({id:e})}),t.data={objectId:n},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"addContent")},replaceContent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.replaceContent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/replaceByRevision";t.headers={"content-type":"application/json"},t.IDsRemoved&&t.IDsAdded&&(t.data={IDsRemoved:s(t.IDsRemoved),IDsAdded:s(t.IDsAdded)},t.data=UWA.Json.encode(t.data)),t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"replaceContent")},getLatestRevision:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getLatestRevision");var i=o.get3DSpaceUrl()+"/resources/v1/dslc/getlastversions?validIntents=E&";t.headers={"content-type":"application/json"};var r=t.objectsToTreat;r&&(t.data=r),t.data=UWA.Json.encode(t.data),t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"getLatestRevision")},removecontent:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.removecontent");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.pid+"/removeClassifiedItems";if(t.headers={"content-type":"application/json"},t.IDs){var r=[];t.IDs.forEach(function(e){r.push({id:e})}),t.data={objectId:r},t.data=UWA.Json.encode(t.data)}t.method="POST",t.timeout=12e4,this._executeRequest(i,t,"removeContent")},getLibraryPathLength:function(e){e.fetchClassification=!0,this._performFetchQuery(e,"getLibraryPathLength")},getLibraryPath:function(e){var t={};UWA.extend(t,e);for(var i={},r=t.depth,n=1;n<=r;n++)i["GET_PARENT_"+n+"_LIBRARY"]=[{id:2,iter:n}];t.patterns=i,this._performNavigateQuery(t,"getLibraryPath")},_performNavigateQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var i=r.getSetting("pad_security_ctx"),s=o.get3DSpaceUrl()+"/cvservlet/navigate";s+="?SecurityContext="+i;var l=widget.lang?widget.lang:widget.getValue("lang"),d=[];d.push(e.pid),t.payload={},t.payload.input_physical_ids=d;var c=a.classFilter;c&&null!=c&&"RootLibrary"==e.selectedType?t.payload.primitives=[{navigate_to_rel:{id:1,filter:{bo_type:c}},navigate_from_rel:{id:2}}]:t.payload.primitives=[{navigate_to_rel:{id:1},navigate_from_rel:{id:2}}],t.payload.patterns=t.patterns;var u=n.getSearchInfo(!0).select_predicate;if(u=u.concat(["flattenedtaxonomies"]),e.dynamicattrs&&e.dynamicattrs.length>0){var m=u.concat(e.dynamicattrs);t.payload.attributes=m}else t.payload.attributes=u;t.payload.version=3;var y=new Date;return t.payload.label=("LibraryWidgetNavigate_"+y.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":l},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(s,t,"searchInLibrary")},_performExpandQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var i=r.getSetting("pad_security_ctx"),a=o.get3DSpaceUrl()+"/cvservlet/expand";a+="?SecurityContext="+i,a+="&tenant="+o.getTenantId();var s=widget.lang?widget.lang:widget.getValue("lang"),l=n.getSearchInfo(!0).select_predicate;l=l.concat(["flattenedtaxonomies"]);var d=["svg","bi_color"],c=l.filter(function(e){return d.indexOf(e)<0});if(t.payload={},t.payload.expand_iter=e.expand_iter,t.children&&t.children.length>0){var u=[];u.push(e.pid);for(var m=0;m<t.children.length;++m)u.push(t.children[m]);t.payload.multi_root_physicalid=u}else t.payload.root_physicalid=e.pid;if(t.filter&&(t.payload["q.iterative_filter_query_bo"]=e.filter),e.dynamicattrs&&e.dynamicattrs.length>0){var y=c.concat(e.dynamicattrs);t.payload.select_bo=y}else t.payload.select_bo=c;t.payload.compute_select_bo=["icon","thumbnail_2d"];var f=new Date;return t.payload.label=("LibraryWidgetExpand_"+f.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.payload.max_count_path="10000",t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(a,t,"Expand")},_performFetchQuery:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var t={};UWA.extend(t,e);var i=r.getSetting("pad_security_ctx"),a=o.get3DSpaceUrl()+"/cvservlet/fetch/v2";a+="?SecurityContext="+i;var s=widget.lang?widget.lang:widget.getValue("lang"),l=n.getSearchInfo(!1,e.isAuthoringMode).select_predicate;l=l.concat(["flattenedtaxonomies"]),t.payload={},e.dynamicAttrs&&e.dynamicAttrs.length>0&&(t.payload.classification_attribute=e.dynamicAttrs,e.dynamicAttrs.forEach(function(e){-1===l.indexOf(e)&&l.push(e)}));var d=["svg","bi_color"],c=l.filter(function(e){return d.indexOf(e)<0});!0===e.fetchClassification&&c.push("classification"),t.payload.physicalid=t.ids,t.payload.select_predicate=c,!0===e.isAuthoringMode&&(a=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/classifiedItem/getContentDetails",t.payload.person_predicate=n.getPersonPredicatesForAuth(),t.payload.compute_select_bo=["icon","thumbnail_2d"]);var u=new Date;return t.payload.label=("LibraryWidgetFetch_"+u.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),t.method="POST",t.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s},t.type="json",t.data=UWA.Json.encode(t.payload),this._executeRequest(a,t,"Fetch")},_performSearchQuery:function(e,t){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.content");var i={};UWA.extend(i,e);var a=o.get3DSearchUrl()+"/search",s=widget.lang?widget.lang:widget.getValue("lang");i.payload=Object.assign({},n.getSearchInfo(!1,e.isAuthoringMode));var l=i.payload.select_predicate;!0===e.isAuthoringMode&&(a=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/Search/search",i.payload.person_predicate=n.getPersonPredicatesForAuth(),i.payload.root_physicalid=e.pid),l=l.concat(["flattenedtaxonomies"]),e.dynamicattributes&&e.dynamicattributes.length>0&&(l=l.concat(e.dynamicattributes)),i.payload.select_predicate=l;var d=new Date,c=Math.random();c.toString(36);var u=c.toString(36).substr(2,9);return i.payload.label=("LibraryWidgetSearch_"+u+"_"+d.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-"),i.payload.locale=s,i.payload.query=t,i.payload.tenant=o.getTenantId(),i.payload.next_start=e.next_start,i.payload.start=e.start,i.method="POST",i.headers={Accept:"application/json","content-type":"application/json","Accept-Language":s},i.type="json",e.order_field&&(e.isAuthoringMode?i.payload.order_field=n.getOrderFiledForAuthMode(e.order_field):i.payload.order_field=e.order_field,i.payload.order_by=e.order_by),e.searchPageCount&&(i.payload.nresults=e.searchPageCount),!0===e.fetchAll&&(i.payload.nresults=1e3),e.isAuthoringMode||(i.payload.source=["3dspace"],i.payload.login={"3dspace":{SecurityContext:r.getSetting("pad_security_ctx")}},e.isExpand?i.payload.specific_source_parameter={"3dspace":{search_in_context:{expand:{root_physicalid:e.pid,expand_iter:"1",type_filter_rel:["Subclass","Classified Item"]}},option:{with_Idx_Search:!0}}}:e.isSearchWithin&&(i.payload.specific_source_parameter={"3dspace":{option:{with_Idx_Search:!0}}}),e.filters&&(i.payload.refine=e.filters)),i.data=UWA.Json.encode(i.payload),i.securityContextRequired=!1,this._executeRequest(a,i,"searchInLibrary")},_executeRequest:function(e,n,a){var o=Math.round(1e3*Math.random()).toString(),s=widget.id+"_"+widget.getTitle()+"_";window.top.performance.mark("libraryRequest_begin"+o);var l={};if(UWA.extend(l,n),!l.payload&&e.indexOf("cvservlet")>-1){l.payload={};var d=new Date;l.payload.label=("LibraryWidgetExecute_"+d.getTime()).replace(new RegExp(" ","g"),"_").replace(new RegExp(",","g"),"").replace(new RegExp("/","g"),"-")}UWA.is(l.onTimeout,"function")||(l.onTimeout=function(){var e={type:"timeout",toString:function(){return i.msg_InfoAction_Timeout}};l.onFailure(e)},l.onComplete=function(e){window.top.performance.mark("libraryRequest_end"+o);var t=window.top.performance.getEntriesByName("libraryRequest_begin"+o);t&&1===t.length&&(window.top.performance.measure(s+"_Request"+a,"libraryRequest_begin"+o,"libraryRequest_end"+o),window.top.performance.clearMarks("libraryRequest_end"+o),window.top.performance.clearMarks("libraryRequest_begin"+o)),n.onComplete(e)});var c={Accept:"application/json","Accept-Language":widget.lang?widget.lang:widget.getValue("lang")};return!1!==l.securityContextRequired&&(c.SecurityContext=r.getSetting("pad_security_ctx")),n.headers?l.headers=UWA.extend(c,n.headers):l.headers=c,t.authenticatedRequest(e,l)},getClassificationAttributes:function(e){var t=e;if(!UWA.is(t,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.getClassificationAttributes");var i=o.get3DSpaceUrl()+"/resources/IPClassificationReuse/class/"+t.classid+"/getclassificationattributes";return t.method="GET",this._executeRequest(i,t,"getClassificationAttributes")},getDimensionsInfos:function(e){return this._executeRequest(o.get3DSpaceUrl()+"/resources/dictionary/dimensions",e,"getDimensionsInfos")},convertDimensionUnits:function(e){if(!UWA.is(e,"object"))throw new Error("Invalid inputs for LibraryEditorWebService.convertDimensionUnits");var t=o.get3DSpaceUrl()+"/resources/dictionary/dimensions/convertValues",i={};return UWA.extend(i,e),i.payload=e.data,i.method="POST",i.headers={Accept:"application/json","content-type":"application/json"},i.data=UWA.Json.encode(i.payload),this._executeRequest(t,i,"convertToPreferedUnit")}}}),define("DS/LibraryEditor/utils/LibraryEditorDataConversion",["DS/WebappsUtils/WebappsUtils","DS/LibraryEditor/service/LibraryTypeService","DS/PADServices/utils/AttributesMgt","DS/LibraryEditor/utils/LibrarySearch"],function(e,t,i,r){var n=function(e){var t=e.toLowerCase(),r=null;i.getAvailableColumns()&&(r=i.getAvailableColumns());var n=i.getTreeColumn(),a=null;return Array.isArray(r)&&r.every(function(e){return"tree"===e&&(e=n),t==e.toLowerCase()&&(a=e),null===a}),a=a||e},a={convertToExaleadDataFormatFederated:function(e){var t={children:null},i=e.attributes,a=r.getAttrNameToPredMapping(),o=r.getPredicateUnitMapping(),s={"ds6w:type":"type","ds6w:label":"label"},l={},d={};for(var c in i.forEach(function(e){if("resourceid"==e.name||"physicalid"==e.name)t.physicalid=e.value,t.resourceid=e.value;else if("mxid"==e.name)t.mxid=e.value;else if("type_icon_url"===e.name)t.icons=[e.value];else if("preview_url"===e.name)t.thumbnail=e.value;else if(e.name.endsWith("inputunit")){if((u=e.name.substring(0,e.name.length-9)).startsWith("attribute["))u=u.substring(0,u.length-1);else(m=o.generatedPredicates)&&m[u]&&(u=m[u]);var i=d[n(u)];a[g=u]&&(g=a[u]);var r=o[u],c=e.value;r&&r[e.value]&&(c=r[e.value]),i?(d[n(u)]=i+" "+c,d[g]=i+" "+c):(d[n(u)]=c,d[g]=c)}else if(e.name.endsWith("inputvalue")){var u,m;if((u=e.name.substring(0,e.name.length-10)).startsWith("attribute["))u=u.substring(0,u.length-1);else(m=o.generatedPredicates)&&m[u]&&(u=m[u]);i=d[n(u)];a[g=u]&&(g=a[u]);c=e.value;i?(d[n(u)]=c+" "+i,d[g]=c+" "+i):(d[n(u)]=c,d[g]=c)}else if(e.name.startsWith("ds6w")){var y=e.name.split("/");if("ds6w:type"===(g=y[y.length-1])&&(C=e.value,["CATIA Embedded Component","CATPart","CATProduct","CATProcess","CATDrawing","CATAnalysis","CATShape"].indexOf(C)>=0)?t.children=[]:"ds6w:created"===g&&(t.created=e.value),(c=e.object?e.object:e.dispValue)&&"boolean"!==e.type||(c=e.value),a[g]&&(g=a[g]),l[g]){c=[c];var f=l[g];Array.isArray(f)||(f=[f]),c=c.concat(f)}l[g]=c,l[e.name]=c;var p=s[g];p&&(t[p]=c,"ds6w:type"===g&&e.value&&(t[p]=e.value))}else if(e.value&&e.value.length>0){var g=e.name;a[g]&&(g=a[g]);var b=l[n(e.name)]||l[g];if(b)if(Array.isArray(b))b.push(e.value);else{var v=[b,e.value];l[n(e.name)]=v,l[g]=v}else{var h=e.value;-1!=h.indexOf(",")&&(h=h.split(",")),l[n(e.name)]=h,l[g]=h}}var C}),e.id||(e.id=t.resourceid),o)if(l[c+"_mksvalue"]=l[c],d[c])l[c]=d[c];else if(l[c]&&o[c]){var u=l[c];if(Array.isArray(u)){var m=[];u.forEach(function(e){if(e){var t=+e;t=t.toString().indexOf(".")>-1?t:t+".0",m.push(t)}}),l[c]=m+" "+o[c].defaultUnit}else{var y=+u;y=y.toString().indexOf(".")>-1?y:y+".0",l[c]=y+" "+o[c].defaultUnit}}return t.grid=l,t.padgrid={"ds6w:leaf":"False","ds6w:root":"True"},t},convertExpandToSearchFormat:function(e,t){var i=[];return t.forEach(function(t){var r=!1;t.attributes&&t.attributes.forEach(function(t){"physicalid"===t.name&&t.value!=e&&(r=!0)}),r&&i.push(t)}),i},convertNavigateToSearchFormat:function(e){var t=[],i=e[0].outputs.GET_CONTENT;return i&&i.forEach(function(e){var i=[];for(var r in e)i.push({name:r,value:e[r]});t.push({attributes:i})}),t},convertNavigateToFlatFormat:function(e,t){var i=[];if(t.length<=0)return i;for(var r=t[0],n=r.input_object,a=r.outputs,o=e,s=0;o>0;o--){var l=a["GET_PARENT_"+o+"_LIBRARY"];l&&((l=l[0]).level=s++,i.push(l))}return i.push(n),i},getLibraryDepth:function(e){var t=e.results[0].attributes,i=[];return t.forEach(function(e){"classification"===e.name&&i.push(e.value)}),i.length+1},getPathsAndObjectsFromExpand:function(e){if(e&&!(e.length<=0)){for(var t=[],i={},r={},n={},o=0,s=e.length;o<s;++o){var l=e[o];if(l.attributes){for(var d,c,u=!0,m=0,y=l.attributes.length;m<y;++m){if("physicalid"===l.attributes[m].name){u=!1,c=l.attributes[m].value;break}"did"===l.attributes[m].name&&(d=l.attributes[m].value)}u||(i[c]=l,r[d]=c)}else if(l.path)t.push(l.path);else if(l.icon__default_thumbnail_2d)for(var f=0;f<l.icon__default_thumbnail_2d.length;f++)for(var p=l.icon__default_thumbnail_2d[f].did,g=0;g<p.length;g++){var b=[];b.push(l.icon__default_thumbnail_2d[f].icon),b.push(l.icon__default_thumbnail_2d[f].thumbnail_2d),n[p[g]]=b}}for(var v in i)for(var h,C=i[v],_=0;_<C.attributes.length;_++)if("did"===C.attributes[_].name){h=C.attributes[_].value,C.attributes.push({name:"icons",value:n[h]});break}for(var L in i){var S=i[L],E=a.convertToExaleadDataFormatFederated(S);i[L]=E}var w=[];for(o=0;o<t.length;++o){var D=t[o],A=[];for(m=0;m<D.length;m+=2)A.push(r[D[m]]);w.push(A)}return{paths:w,objects:i}}}};return a}),define("DS/LibraryEditor/utils/Library_CSO",["DS/Selection/XSO","DS/Logger/Logger","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/service/LibraryEditorWebService","DS/IPClassifyUX/IPClassifyUXEvents","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/PADUtils/PADProbes"],function(e,t,i,r,n,a,o){"use strict";var s=e.singleton({name:"library_cso",_logger:null,_currentLibrary:null,init:function(e){var i={areEquals:function(e,t){return e===t}};UWA.extend(i,e),this._parent(i),this._logger=t.getLogger(s);var r=this;this.onPostAdd(function(e){var t="CONTENT";UWA.is(e,"array")&&(e=e[0]),e&&UWA.is(e.getID,"function")&&e.getID()==r.getCurrentLibraryID()&&(t="TREE"),UWA.is(e)&&n.notifyLibrarySelected({context:t,selectedNode:e})})},addInLibraryCSO:function(e,t){if(!UWA.is(e))throw new Error("No libraryNode specified");if(!UWA.is(t))throw new Error("No context specified");var s=o.createProbe("library_addInLibraryCSO");if("TREE"==(t=t.toUpperCase())){var l=this;this.empty(!1);var d=this._currentLibrary;this._currentLibrary=e;var c=function(e,t){n.notifyCurrentLibraryChange({previousNode:e,currentNode:t}),l.add(t),s.end()};this._currentLibraryPath=[{id:e.id,type:i.getPLMTypeOfLibraryTreeNode(e),label:e.getLabel(),mxid:e.options.mxid}];var u=!1;if(i.inFamilyLibrary(e.plmType)){if(e.isVisible&&e.isVisible()&&e.getPath){var m=e.getPath();if(Array.isArray(m)&&m.length>=2&&m[0]&&"LibrarySection_AllLibraries"===m[0].plmType){this._currentLibraryPath=[];for(var y=1;y<m.length;y++){var f=m[y];this._currentLibraryPath.push({id:f.id,type:i.getPLMTypeOfLibraryTreeNode(f),label:f.getLabel()})}u=!0}}}else u=!0;u?c(d,e):r.getLibraryPathLength({ids:[e.id],onComplete:function(t){!t.results&&t.error&&(l._logger.warn("Unable to retrieve LibraryPath using Index/Search"),c(d,l._currentLibrary));var i=a.getLibraryDepth(t);if(1===i){var n={};n.id=e.id,n.type=e.plmType,n.label=e.options.label,l._currentLibrary&&n.id==l._currentLibrary.id?(l._currentLibraryPath=[],l._currentLibraryPath.push({id:n.id,type:n.type,label:n.label}),c(d,l._currentLibrary)):l._logger.log("LibraryPath returned by Index do not corresponds to the current Library")}else if(i>1){var o=i-1;r.getLibraryPath({depth:o,pid:e.id,onComplete:function(e){var t=a.convertNavigateToFlatFormat(o,e.result);l._currentLibrary&&t[i-1].physicalid==l._currentLibrary.id&&(l._currentLibraryPath=[],t.forEach(function(e){l._currentLibraryPath.push({id:e.physicalid,type:e["ds6w:type"],label:e["ds6w:label"]})}),c(d,l._currentLibrary))},onFailure:function(e){l._logger.warn("Unable to retrieve LibraryPath using Index/Navigate"),c(d,l._currentLibrary)}})}},onFailure:function(e){l._logger.warn("Unable to retrieve LibraryPathLength using Index/Search"),c(d,l._currentLibrary)}})}else{this.empty(!1);var p=null;0===(p="array"==UWA.typeOf(e)?e:[e]).length?(this.add(this._currentLibrary),s.end()):(this.add(p),s.end())}},removeFromLibraryCSO:function(e){if(!UWA.is(e))throw new Error("No libraryNode specified");this.remove(e),0===this.getSelectedNodes().length&&e!=this._currentLibrary&&this.add(this._currentLibrary)},removeAllFromLibraryCSO:function(){this.empty(!0)},getCurrentLibrary:function(){return this._currentLibrary},getCurrentLibraryID:function(){var e=null;return this._currentLibrary&&this._currentLibrary.getID&&(e=this._currentLibrary.getID()),e},getCurrentLibraryPath:function(){var e=[];return this._currentLibraryPath&&this._currentLibraryPath.forEach(function(t){e.push({id:t.id,type:t.type,label:t.label})}),e},getSelectedNodes:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t)}),e},getSelectedNodesID:function(){var e=[];return this.get()&&this.get().forEach(function(t){e.push(t.getID())}),e}});return s}),define("DS/LibraryEditor/commands/ActionBar_AddToFavoritesCmd",["UWA/Core","DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService"],function(e,t,i,r,n,a){"use strict";return t.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(t){this._parent(t,{});var o=this;i.onChange(function(){o._adaptStateToCurrentLibrary()}),this.onStateChange(function(){if(o.getState()){if(t=i.getCurrentLibrary()){s=t.getID(),l=t.getType(),d=t.options.label;if(s&&a.inFamilyLibrary(l))if(e.is(n.getTreeCont()))0==n.getTreeCont().isLibraryAmongFavoriteLibraries(s)&&n.getTreeCont().addFavorite({id:s,name:d})}o.labelTopBar=r.label_ActionBar_RemoveFromFavorites}else{var t;if(t=i.getCurrentLibrary()){var s=t.getID(),l=t.getType(),d=t.options.label;if(s&&a.inFamilyLibrary(l))if(e.is(n.getTreeCont()))if(1==n.getTreeCont().isLibraryAmongFavoriteLibraries(s))!1===n.getTreeCont().removeFavorite({id:s,name:d})&&o.setState(!0,!1)}o.labelTopBar=r.label_ActionBar_AddToFavorites}})},_adaptStateToCurrentLibrary:function(){var t=i.getCurrentLibrary();if(t&&t.getID){var r=t.getID();if(e.is(n.getTreeCont())){var a=!1;n.getTreeCont().isLibraryAmongFavoriteLibraries(r)&&(a=!0),this.setState(a,!1)}}}})}),define("DS/LibraryEditor/commands/ActionBar_ReplaceByRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/ENOXVersionExplorerController/VersionExplorerController","DS/ENOXVersionExplorerUtils/VersionExplorerSettings","DS/ENOXVersionExplorerUtils/VersionExplorerEnums","DS/ENOXVersionExplorerViews/VersionExplorerModal","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/service/LibraryServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUX/utils/IPClassifyModeManager"],function(e,t,i,r,n,a,o,s,l,d,c,u,m,y){"use strict";return t.extend({labelTopBar:e.i18n("Replace By Revision"),isInsert:!0,_selectedNodes:null,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e=null;if(1==(e=null===this._selectedNodes?r.getSelectedNodes():this._selectedNodes).length){var t=this.validPhysicalIDtobeReplaced=e[0].getID();this._launchVersionExplorer(t),this.end()}else c.displayNotification({message:m.msg_warning_replaceByRevision_MultiObject,className:"warning"})},endExecute:function(){this._selectedNodes=null},_launchVersionExplorer:function(t){var i=this,r=e.createElement("div",{class:"revisionUpdate-dialog-versionexplorer"}).inject(document.body);this._myVersionExplorer=new o({versionGraphContainer:null,selectionMode:l.SELECTION_MODES.SINGLE_SELECT_ONLY,widget:widget}),this._myVersionExplorer.disableDrag(),this._myVersionExplorer.showDialog({x:100,y:100},r,!0),s.loadUserSettingsPromise({displayMode:l.DISPLAY_MODES.SUBWAY_VIEW,displayLegend:!0},!0),this._myVersionExplorer.publishEvent("ENOXVersionExplorerLoadVersionModel",{id:i.validPhysicalIDtobeReplaced,tenantId:n.getPlatformId()?n.getPlatformId():"",securityContext:a.getSetting("pad_security_ctx"),onComplete:function(){},dataModelType:l.DATA_MODEL_TYPES.MODEL_HISTORY}),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalOK",this._onVersionExplorerModalOK.bind(this,t),!1),this._myVersionExplorer.subscribeEvent("ENOXVersionExplorerModalCancel",this._onVersionExplorerModalCancel.bind(this,t),!1),this._dlgVersionExplorer=d._dlg,d._dlg&&d._dlg.rightButtons&&d._dlg.rightButtons.addEventListener("click",this._onVersionExplorerModalCancel.bind(this,t)),this._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0,this._myVersionExplorer.subscribeEvent("select",function(e){i._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!1}),this._myVersionExplorer.subscribeEvent("unselect",function(e){i._dlgVersionExplorer.getFooter().getChildren()[0].disabled=!0})},_onVersionExplorerModalCancel:function(e){this._myVersionExplorer.unsubscribeAll()},_onVersionExplorerModalOK:function(t){var i=require("DS/LibraryEditor/commands/LibraryCommands"),n=require("DS/LibraryEditor/utils/LibraryEditorcontrol");this._myVersionExplorer.unsubscribeAll();var a=this._myVersionExplorer.getSelectedNodes().shift().getAttribute("id"),o=r.getCurrentLibrary();if(a!==this.validPhysicalIDtobeReplaced){i._startProgressBar(m.ReplaceByRevision_content_loading);var s=[],l=[];s.push(this.validPhysicalIDtobeReplaced),l.push(a),u.replaceContent({IDsRemoved:s,IDsAdded:l,callbacks:{onComplete:function(t){i._offProgressBar();var r="",a=l.length;if(t){var s=JSON.parse(t);r=s.information?" ("+s.information+")":r}y.setAuthoringMode("authoring",m.replace(m.msg_info_Replaceinlibrary,{number:a,libraryname:o.options.label})+r),e.is(n.getContent())&&n.getContent().loadContentAndSelect(o)},onFailure:function(e){i._offProgressBar(),function(e,t,i){var r=t;!UWA.is(i)||i instanceof Error||(r+="<br>"+i),c.displayNotification({message:r,className:"error"})}(0,m.msg_error_ReplaceByRevision,e)}}})}else c.displayNotification({message:m.msg_warning_replaceByRevision_sameObject,className:"warning"})},_getVersionExploreforODT:function(){return this._myVersionExplorer?this._myVersionExplorer:null},setNode:function(e){this._selectedNodes=[e]}})}),define("DS/LibraryEditor/dataProvider/LibraryCSODataProvider",["UWA/Class","DS/LibraryEditor/utils/Library_CSO"],function(e,t){"use strict";return e.singleton({getCurrentObject:function(){return t.getCurrentLibrary()},getCurrentObjectPath:function(){return t.getCurrentLibraryPath()},addInCSO:function(e,i){t.addInLibraryCSO(e,i)},getSelectedNodes:function(){return t.getSelectedNodes()},getSelectedNodesID:function(){return t.getSelectedNodesID()}})}),define("DS/LibraryEditor/commands/ActionBar_ReplaceByLatestRevision",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADUtilsServices","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/service/LibraryServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/IPClassifyUX/utils/IPClassifyModeManager"],function(e,t,i,r,n,a,o,s,l,d){"use strict";var c=[];function u(e,t,i){var r=t;!UWA.is(i)||i instanceof Error||(r+="<br>"+i),o.displayNotification({message:r,className:"error"})}return t.extend({labelTopBar:e.i18n("Replace By Latest Revision"),isInsert:!0,init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},execute:function(){var e={},t=[],i=r.getSelectedNodes(),n=i.length;i&&i.length<101?(i.forEach(function(e){var i={id:e.id};t.push(i)}),e={lastVersionRequests:t},s.getLatestRevision({objectsToTreat:e,callbacks:this._treatLatestRevision(n,i)})):o.displayNotification({message:l.msg_warning_replaceByLatestRevision_NotMorethan100Objects,className:"warning"}),this.end()},_treatLatestRevision:function(t,i){return{onComplete:function(t){var n=[],a=[],m=JSON.parse(t);m.lastVersionRequests.length>0&&m.lastVersionRequests.forEach(function(e){if(e.islast){var t=i.find(function(t){return t.id===e.id}),r={};r[t.options.label+" "+t.options.grid["ds6wg:revision"]]="isLatestRevision",c.push(r)}else n.push(e.id),a.push(e.candidates[0])});var y=n.length,f=require("DS/LibraryEditor/utils/LibraryEditorcontrol"),p=require("DS/LibraryEditor/commands/LibraryCommands"),g=r.getCurrentLibrary();if(y>0){n.length;p._startProgressBar(l.ReplaceByRevision_content_loading),s.replaceContent({IDsRemoved:n,IDsAdded:a,callbacks:{onComplete:function(t){p._offProgressBar();var i="",r=n.length;if(t){var a=JSON.parse(t);i=a.information?" ("+a.information+")":i}var o=l.replace(l.msg_warning_replaceByLatestRevision_MultiObject_AlreadyLatest,{number:c.length}),s=l.replace(l.msg_info_ReplaceByLatestRevision,{number:r,libraryname:g.options.label}),u=c.length?s+"\n"+o+i:s+i;d.setAuthoringMode("authoring",u),e.is(f.getContent())&&f.getContent().loadContentAndSelect(g)},onFailure:function(e){p._offProgressBar(),u(0,l.msg_error_ReplaceBylatestRevision,e)}}})}else o.displayNotification({message:l.msg_warning_replaceByLatestRevision_sameObject,className:"warning"})},onFailure:function(e){LibraryCommands._offProgressBar(),u(0,l.msg_error_ReplaceBylatestRevision,e)}}},endExecute:function(){c=[]}})}),define("DS/LibraryEditor/utils/LibraryEditorUtil",["UWA/Utils","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/PADUtils/PADSettingsMgt","DS/IPClassifyUtil/IPClassifyPreference"],function(e,t,i,r,n,a,o,s,l){var d={nameRules:{notAllowedChars:["/",'"',"#","$","@","%","*",",","?","\\","<",">","[","]","|",":"],maxLength:127},shouldBeEditable:function(e){return!1},onNodeModelUpdate:function(e){var t=e.data.nodeModel;if(i.inFamilyLibrary(t.plmType)){var o=t._lastUpdateTime?t._lastUpdateTime:0,s=Date.now()-o;if(t._lastUpdateTime=Date.now(),console.log("lastUpdateTime : "+o+", elapsedTime : "+s),!(0!==o&&s<300))if(t._resetting)t._resetting=!1;else{var l=t.getID(),c=t.options.label,u=t.options.oldLabel;if(void 0===u&&(u=""),c!==u){c&&c.trim&&(c=c.trim());var m=!0;c.length>d.nameRules.maxLength&&(r.displayNotification({message:n.replace(n.get("msg_error_name_maxlength"),{name:c,maxLength:d.nameRules.maxLength}),className:"error"}),m=!1),0==c.trim().length&&(r.displayNotification({message:n.get("msg_error_name_empty"),className:"error"}),m=!1);for(var y=d.nameRules.notAllowedChars,f=0;f<y.length;f++){var p=y[f];if(-1!=c.indexOf(p)){r.displayNotification({message:n.replace(n.get("msg_error_name_badchars"),{name:c,badChars:d.nameRules.notAllowedChars.join(", ")}),className:"error"}),m=!1;break}}if(m){if(t.isFavorite&&UWA.is(a.getTreeCont())){var g={id:l,name:u};a.getTreeCont().renameFavorite(g,c,t)}}else t.withTransactionUpdate(function(){this.setLabel(u)})}}}},getCurrentSecurityContextAndLibraryData:function(e){var t=o.getCurrentLibrary(),r=s.getSetting("pad_security_ctx"),n=widget.getValue("pad_tenant"),a={From:"LibraryEditor",LibraryID:null,LibraryType:null,IsInDeletedItems:!1,Timestamp:Date.now(),Tenant:n,SecurityContext:r};return t&&(i.inFamilyLibrary(t.plmType)||e)&&(a.LibraryID=t.getID(),a.LibraryType=t.getType()),a},sortColumn:function(e,t){var r=i.inFamilyLibrary(e.plmType),n=i.inFamilyLibrary(t.plmType);return r&&!n?-1:!r&&n?1:0},_repeatMode:0,getRepeatMode:function(){return this._repeatMode},setRepeatMode:function(e){this._repeatMode=e?1:0},setContentViewPreference:function(e,t){return new Promise(function(i){require(["DS/IPClassifyUtil/service/IPClassifyUtilWebService","DS/IPClassifyUtil/IPClassifyUtility"],function(r,n){widget.setValue("LibraryCusto_treelistview_v1",n.jsonZip(JSON.stringify(e))),t?r.saveUserPreferences({name:self.widget.getValue("x3dAppId")+"_Library_v1",value:n.jsonZip(JSON.stringify(e)),onComplete:function(e){i()},onFailure:function(e){i()}}):i()})})},getClassAttrPos:function(){return new Promise(function(e){l.get("LibraryEditor_v1_ClassAttrsToLeft",function(t){t&&t.hasOwnProperty("dynamicAttributesTop")?e(t.dynamicAttributesTop):l.get("LibraryEditor_v1_ClassAttrsToLeft",function(t){t&&t.hasOwnProperty("dynamicAttributesTop")?e(t.dynamicAttributesTop):e(!1)},!1)},!0)})},setClassAttrPos:function(e,t){var i={dynamicAttributesTop:e};l.set("LibraryEditor_v1_ClassAttrsToLeft",i),t||l.set("LibraryEditor_v1_ClassAttrsToLeft",i,!t)},setLeftPanelStatus:function(e){l.set("lib_view_status",{leftPanelState:e},!0,!1)},setRightPanelStatus:function(e){l.set("lib_view_status",{rightPanelState:e},!0,!1)},getLeftPanelStatus:function(){return new Promise(function(e){l.get("lib_view_status",function(t){t&&t.hasOwnProperty("leftPanelState")?e(t.leftPanelState):e({leftPanelState:!0,isWelcomePanelCollapsed:!1})},!0)})},getRightPanelStatus:function(){return new Promise(function(e){l.get("lib_view_status",function(t){t&&t.hasOwnProperty("rightPanelState")?e(t.rightPanelState):e({rightPanelState:!1,size:250})},!0)})}};return d}),define("DS/LibraryEditor/commands/ActionBar_RepeatModeCmd",["DS/ApplicationFrame/CommandCheckHeader","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,i,r){"use strict";return e.extend({labelTopBar:r.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{}),this.onStateChange(function(){var e=this.getState();t.setRepeatMode(e);var n=r.msg_info_repeatModeDisabled;e&&(n=r.msg_info_repeatModeEnabled),i.displayNotification({message:n,className:"primary"})})}})}),define("DS/LibraryEditor/commands/ActionBar_ColumnVisibilityCmd",["DS/ApplicationFrame/Command","DS/PADUtils/PADContext","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/WidgetServices/WidgetServices","DS/LibraryEditor/utils/LibrarySearch","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/library_exclude_columns.json","DS/LibraryEditor/utils/LibraryEditorUtil"],function(e,t,i,r,n,a,o,s){"use strict";var l=JSON.parse(o).columnToExclude;return e.extend({labelTopBar:i.label_ActionBar_AddToFavorites,isInsert:!0,datas:{},init:function(e){this._parent(e,{});var i=t.get();UWA.is(i.addEvent,"function")&&i.addEvent("onToggleView",this._check_if_treeview.bind(this))},execute:function(){var e=this;s.getClassAttrPos().then(function(o){require(["DS/IPClassifyColumnCusto/IPClassifyColumnCusto","DS/PADServices/utils/GlobalModelEvents","DS/PADServices/utils/AttributesMgtV2"],function(l,d,c){var u=t.get(),m=u.options.views?u.options.views.datagridview:void 0;if(m){for(var y=d.getModelEvents(),f=[],p=m.options.dgvLayout.getOrderedColumnsIndexes(),g=0;g<p.length;++g){var b=m.options.dgv.getColumnOrGroup(p[g]);f.push(b)}var v=m.options.viewMode,h=m.options.dgvLayout.rowsHeader,C=c.getDefaultTypesAndExtensions();m.columnOrdering=!0,e.columnCusto=new l({modelEvents:y,viewMode:v,appColumns:f,baseInstanceTypes:[],selectedTypes:c.getSelectedTypes(),selectedExtensions:c.getSelectedExtensions(),defaultTypes:C.defaultTypes,defaultExtensions:C.defaultExtensions,fetchTypesFromDictionary:!1,withDgv:!0,dgvInfo:m,rowHeaderActivated:h,manageAttrFromInstance:!1,dbOnlyAttributes:!0,showNonDBAttributesAsWell:!0,addValueInAuthoringColumn:!r.isNatifEnvironnement(),preMappedAttriForAuthoring:{"ds6w:description":!0,"ds6w:label":!0,"ds6w:type":!0,"ds6w:responsible":!0,"ds6w:reservedBy":!0},enableDynamicAttributesPos:!0,dynamicAttrCheckBoxName:i.dynamicAttrCheckBoxName,dynamicAttrCheckBoxValue:o});var _=[];_.push(y.subscribe({event:"IPClassifyColumnCusto/AttributesCustomization/columnModification"},function(t){switch(t.what){case"addRemoveColumns":if(t.removedColumns&&m.removeColumnCB(t.removedColumns),t.addedColumns){var i=e._filterExcludeColumns(t.addedColumns),r=i.filter(function(e){return m.options.dgv.getColumnOrGroup(e.dataIndex)});m&&r.length>0&&m.changeDBAttributeCB(r),(i=i.filter(function(e){return!m.options.dgv.getColumnOrGroup(e.dataIndex)}))&&i.length>0&&(a.isIndexedMode()||(i=n.getAuthModeNoSortColumns(i,!0)),m.addColumnCB(i))}break;case"visibilityColumn":m.changeVisibilityCB(t.modifiedColumn,t.visibilityFlag);break;case"moveColumn":if(t.move2perform){var o=m.options.dgvLayout.getVisibleOrderedLeafColumns();if(o&&o.length>0){var l=t.move2perform.fromIndex?t.move2perform.fromIndex:o[m.options.dgvLayout.getColumnIndex(t.move2perform.fromID)].dataIndex,d=t.move2perform.toIndex?t.move2perform.toIndex:o[m.options.dgvLayout.getColumnIndex(t.move2perform.toID)].dataIndex;m.options.dgvLayout.moveColumn(l,d,{isUserInteraction:!0}),m.columnOrdering=!0}}void 0!==t.dynamicAttributesTop&&s.setClassAttrPos(t.dynamicAttributesTop,!0);break;case"changeTitle":m.changeTitleCB(t.modifiedColumn,t.newTitle);break;case"pinChange":m.changePinCB(t.modifiedColumn,t.pin);break;case"rowsHeaderModification":m.changeDgvLayout({rowsHeader:t.rowsHeader});break;case"changeViewMode":m.compactMode(t);break;case"close":t.selectedExtensions&&t.selectedTypes&&c.updateSelectedParams({selectedExtensions:t.selectedExtensions,selectedTypes:t.selectedTypes}),m.saveCustoView(t.applyOnlyToThisApp),void 0!==t.dynamicAttributesTop&&s.setClassAttrPos(t.dynamicAttributesTop,t.applyOnlyToThisApp),_.forEach(function(e){y.unsubscribe(e)});break;case"reset":c.resetSelectedParams(),m.options.dgvLayout.deleteDataGridViewPreferences(),m.reset(t.parameters),s.setClassAttrPos(!1,!0),_.forEach(function(e){y.unsubscribe(e)});break;default:console.warn("Unknown column modification kind:"+t.what)}}))}})})},_filterExcludeColumns:function(e){var t=[];return e.forEach(function(e){-1===l.indexOf(e.dataIndex)&&t.push(e)}),t},_check_if_treeview:function(){"datagridview"===t.get().getPADTreeDocument().options.active_view?this.enable():this.disable()},_getColumnCusto:function(){return this.columnCusto}})}),define("DS/LibraryEditor/utils/LibraryMigration",["DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyNav/views/customize_views/_xNavDGVUtils","DS/IPClassifyUtil/IPClassifyPreference","DS/IPClassifyUtil/IPClassifyUtility"],function(e,t,i,r){return{migrateContentPreferences:function(i,r){var n=[];if((!i.version||i.version<1)&&r>=1){var a=new Promise(function(n){i.columnsOptimized?(new t).buildColumns("datagridview").then(function(t){for(var a=t.columns,o=0;o<a.length;++o){var s=a[o].dataIndex;if("ds6w:status"===s){for(var l=!1,d=0;d<i.columnsOptimized.length;++d)if(i.columnsOptimized[d].dataIndex===s){l=!0;break}if(!l){var c=a[o];c.visibleFlag=!1,i.columnsOptimized.push(c)}}}i.version=r,e.setContentViewPreference(i,!0).then(function(){n()})}):n()});n.push(a)}return Promise.all(n)},migrateFavPreferences:function(e,t){return new Promise(function(e){1==t?i.get("ipcFavoriteList_v1",function(n){i.set(r.getTenantAwarePreferenceName("ipcFavoriteList_v1"),n,!1,!1),i.set("LibraryFavPrefVersion",{version:t},!1),e()},!1):e()})},migrateTreeStructurePreferences:function(e,t){return new Promise(function(e){1==t?i.get("ipcTreeStrucure_v1",function(n){i.set(r.getTenantAwarePreferenceName("ipcTreeStrucure_v1"),n),i.get("ipcTreeSelectedNode_v1",function(n){i.set(r.getTenantAwarePreferenceName("ipcTreeSelectedNode_v1"),n),i.set("LibraryTreeStrcutPrefVersion",{version:t}),e()})}):e()})}}}),define("DS/LibraryEditor/utils/LibraryCommandManager",["DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService","DS/WidgetServices/WidgetServices"],function(e,t,i,r){"use strict";var n=["CreateSnapshotHdr"],a={ColumnVisibility:{enable:{view:"datagridview"}}},o={enableAllCommands:function(i){var r,a=e.getCommands();for(r in a)if(this.checkCommandCond(r,i)){var o=e.getCommand(r,t.getContent().getView());UWA.is(o)&&n.indexOf(r)<0&&(i?o.enable():"ListSnapshotsHdr"!==r&&o.disable())}},enableFavoriteCommands:function(t){var i=e.getCommandCheckHeader("AddToFavorites");i&&t?i.enable():i&&i.disable()},ItemSelected:function(e,n,a){function s(e){r.isNatifEnvironnement()||(e?d.push("AddExistingContent"):c.push("AddExistingContent"))}function l(e){r.isNatifEnvironnement()||(e?d.push("RemoveContent"):c.push("RemoveContent"))}var d=[],c=[];if("TREE"===n)i.inFamilyLibrary(e.plmType)?(o.enableAllCommands(!0),o.enableFavoriteCommands(!0),c.push("SelectSiblings"),"RootLibrary"===e.plmType&&s(!1)):"LibrarySection_favorite"==e.plmType?(o.enableAllCommands(!1),o.enableFavoriteCommands(!1),d.push("treeview","tileview","thumbnailview","ExpandAll","ExpandN","CollapseAll","ColumnVisibility","SelectAll","SelectInversion"),s(!1)):"LibrarySection_AllLibraries"==e.plmType?(o.enableAllCommands(!1),o.enableFavoriteCommands(!1),d.push("treeview","tileview","thumbnailview","ExpandAll","ExpandN","CollapseAll","ColumnVisibility","SelectAll","SelectInversion"),s(!1)):(o.enableAllCommands(!1),o.enableFavoriteCommands(!1)),l(!1);else if("CONTENT"===n){var u=a.plmType,m=t.getContent().getView().getSelectedNodes();if(o.enableFavoriteCommands(!0),i.inFamilyLibrary(u)&&"Busy"===e.plmType)o.enableAllCommands(!1);else if(i.inFamilyLibrary(u))o.enableAllCommands(!0),c.push("ExpandAll","ExpandN","CollapseAll"),"RootLibrary"!==e.plmType&&"Library"!==e.plmType||l(!1);else if("LibrarySection_AllLibraries"==u){if(o.enableAllCommands(!0),1===m.length)m[0].plmType||m[0].getType();c.push("ExpandAll","ExpandN","CollapseAll"),l(!1)}else"LibrarySection_favorite"==u?(o.enableAllCommands(!1),d.push("treeview","tileview","thumbnailview","ExpandAll","ExpandN","CollapseAll","SelectAll","SelectInversion","SelectSiblings")):o.enableAllCommands(!1);s(!1)}this._switchCommands(d,!0),this._switchCommands(c,!1)},getCommand:function(i){return e.getCommand(i,t.getContent().getView())},checkCommandCond:function(e,i){var r=!0;if(a[e]){var n=a[e];i&&n.enable&&n.enable.view&&n.enable.view!=t.getContent().getView().getActiveView()&&(r=!1)}return r},_switchCommands:function(e,t){for(var i=0;i<e.length;++i)if(this.checkCommandCond(e[i],t)){var r=this.getCommand(e[i]);try{t?r.enable():r.disable()}catch(r){console.error("Error "+(t?"enabling":"disabling"),e[i],r)}}}};return o}),define("DS/LibraryEditor/ActionBar/LibraryActionBar",["UWA/Core","UWA/Controls/Abstract","UWA/Class/Events","UWA/Class/Options","DS/Logger/Logger","DS/LibraryEditor/utils/LibraryCommandManager","DS/ApplicationFrame/CommandsManager","DS/ApplicationFrame/ActionBar","DS/Core/ModelEvents","DS/LibraryEditor/utils/Library_CSO","DS/RuntimeView/NLSManager","DS/PADUtils/PADContext","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/PADUtils/PADProbes","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/IPClassifyUXEvents"],function(e,t,i,r,n,a,o,s,l,d,c,u,m,y,f,p,g){"use strict";var b=t.extend(r,i,{name:"library_actionbar",_logger:null,_actionBar:null,_language:"en",_context:null,_isReady:!1,_modelEvents:null,init:function(e){this._probeLoadElmt=y.createProbe("loadActionBar");var t=this;e.language&&(this._language=widget.lang?widget.lang:widget.getValue("lang")),e.context?this._context=e.context:this._context=this,this._modelEvents=new l,this._parent(e),this._logger=n.getLogger(b),this.onLoad(e),this.getOption("renderTo")&&this.render().inject(this.getOption("renderTo")),this.onReady(function(){t.syncState(),g.onLibrarySelected(function(e){var t=d.getCurrentLibrary();a.ItemSelected(e.selectedNode,e.context,t)}),g.onContentSearchChange(function(){var e=d.getCurrentLibrary();e&&a.ItemSelected(e,"TREE",e)}),d.onEmpty(function(){a.enableAllCommands(!1)}),UWA.is(e.events)&&UWA.is(e.events.onActionBarReady,"function")&&e.events.onActionBarReady(),t._probeLoadElmt.end()})},render:function(){return this},loadActionBar:function(e){this._actionBar.loadModel(e)},destroy:function(){this._logger.log("destroy"),this._actionBar&&(delete this._actionBar,this._actionBar=null),this._parent()},onLoad:function(t){var i=this;i._context.options=i._context.options||{},UWA.extend(i._context.options,{custo_view_title:m.name_Widget_Title}),i._context.getFolderXSO=function(){return d},u.set(i._context);if(!e.is(this.elements.container)){c.DEFAULT_LANGUAGE=widget.lang?widget.lang:widget.getValue("lang"),this.elements.container=UWA.createElement("div",{class:this.getClassNames()});var r="";r=f.isNatifEnvironnement()?f.isWebInWinEnvironment()?"ENOLibraryPowerByWebInWin.xml":"ENOLibraryCustoWebInWin.xml":p.isCustomizedEnv()?"ENOLibraryCusto.xml":"ENOLibrary.xml";var n="LibraryEditor";t.dataForActiveClassODT&&t.dataForActiveClassODT.ActionBarCommandsXML&&t.dataForActiveClassODT.ModuleForCommandsXML&&(r=t.dataForActiveClassODT.ActionBarCommandsXML,n=t.dataForActiveClassODT.ModuleForCommandsXML),this._actionBar=new s({context:null,file:r,module:n,language:widget.lang?widget.lang:widget.getValue("lang")});var a=this._actionBar.onActionBarReady(function(){i._actionBar._modelEvents.unsubscribe(a),i._isReady=!0,i._modelEvents.publish({event:"READY",context:i})})}},onReady:function(e){return this._modelEvents.subscribe({event:"READY"},e)},syncState:function(){var e=d.getCurrentLibrary(),t=d.get();if(e&&t&&t.length>0){var i="CONTENT";e.getID()==t[0].getID()&&(i="TREE"),a.ItemSelected(t[0],i,e)}else a.enableAllCommands(!1)}});return b}),define("DS/LibraryEditor/ActionBar/LibraryCommandManager",["UWA/Class","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUX/IPClassifyUXEvents","DS/IPClassifyUXUtil/ActionBar/IPCommandManager","DS/PADServices/utils/GlobalModelEvents"],function(e,t,i,r,n,a,o,s){"use strict";var l={};return e.singleton(o,{noSizeToFit:["libraryLocation"],initialize:function(){a.onLibrarySelected(()=>{this.updateCommands()}),n.onEmpty(()=>{this.enableAllCommands(!1)}),t.onCommandStart(e=>{var t=l[e.getId()];t&&!0===t.author&&this.getModelEvents().publish({event:"switch_to_author"})});var e=new Promise(e=>{require(["text!DS/LibraryEditor/assets/afr/LibraryEditor.json"],e)});return new Promise(t=>{e.then(e=>{var i={};if(e)for(var r in(i=JSON.parse(e)).headers){i.headers[r].ID=r}l=i.Rules,t(i)})})},revaluateContentValue:function(e,t){if(!0===e.CONTENT)return!0;if(!t.checkWhiteClick&&!t.isFavoriteNode&&t.isCtxMenu&&!1===e.CONTENT.ctxMenu)return!1;var i=!0;return!0===e.CONTENT.Libraries?i=t.isLibrary||t.isRoot:!1===e.CONTENT.Libraries&&(i=!t.isLibrary&&!t.isRoot),!1!==i&&1==e.CONTENT.favCtxMenuOnly&&(i=t.isCtxMenu&&!t.isMultiSelect&&t.isFavoriteNode),!1!==i&&(!0===e.CONTENT.classifiedItem?i=t.isclassifiedItem:!1===e.CONTENT.classifiedItem&&(i=!1)),!1!==i&&1==t.isCtxMenu&&t.isFavoriteNode&&e.CONTENT&&!0===e.CONTENT.ctxFavOnMultiSel&&(i=!0),i},revaluateTreeValue:function(e,t){if(!0===e.TREE)return!0;if(!t.checkWhiteClick&&!t.isFavoriteNode&&t.isCtxMenu&&!1===e.TREE.ctxMenu)return!1;var i=!0;return!0===e.TREE.Sections?i=t.isSection:!1===e.TREE.Sections&&(i=!t.isSection),!1!==i&&(!0===e.TREE.RootLibraries?i=t.isRoot:!1===e.TREE.RootLibraries&&(i=!t.isRoot)),!1!==i&&(!0===e.TREE.Libraries?i=t.isLibrary||t.isRoot:!1===e.TREE.Libraries&&(i=!t.isLibrary&&!t.isRoot)),i},_manageSwitchOfCommands:function(e,t,n,a){var o=!1,s=n&&!!t&&0===t.length;e&&!s?o=e.isFavorite:t&&t.length>0&&(o=t[0].isFavorite);var d=!1,c=!1,u=!1,m=!1,y=!1,f=!1,p=!1;e&&(f="LibrarySection_favorite"==e.plmType,p="LibrarySection_AllLibraries"==e.plmType,m=r.isRootLibrary(e.plmType),y=r.isLibrary(e.plmType));var g=f||p,b=!1;t&&t.every(function(e){return d=d||r.isRootLibrary(e.plmType),c=c||r.isLibrary(e.plmType),b=b||"Busy"===e.plmType,u=r.isContent(e.plmType),!d||!c||!b});var v=!0;if((f||b||(p||!e)&&t&&0===t.length)&&(v=!1),n||this.enableAllCommands(v),!b){var h={},C=Object.keys(l);a&&(C=a);var _={};return _.isCtxMenu=n,_.isFavoriteNode=o,_.checkWhiteClick=s,C.forEach(r=>{var a=l[r];if(a){var f=t&&t.length>0,p=e&&(!f||void 0===a.CONTENT),b=!0;"object"==typeof a&&((b&&!1===a.TREE&&p||!1===a.CONTENT&&f)&&(b=!1),b&&s&&!0!==a.white_click&&(b=!1),b&&void 0!==a.multisel&&(b=!t||t.length<=1),b&&!1===a.NoSelection&&(b=t&&t.length>0),b&&a.views&&(b=a.views.indexOf(i.getContent().getView().getActiveView())>=0),b&&n&&o&&!0!==a.ctxFavorite&&(b=t&&t.length>1&&1==a.CONTENT.ctxFavOnMultiSel),b&&!1===a.CATIAV6&&(b=!0!==widget.getValue("noCompass")),b&&!1===a.NOT_WEBInWin&&(b=!0===widget.getValue("noCompass")),b&&a.TREE&&p&&(_.isSection=g,_.isRoot=m,_.isLibrary=y,p=this.revaluateTreeValue(a,_)),b&&a.CONTENT&&f&&(_.isRoot=d,_.isLibrary=c,_.isclassifiedItem=u,_.isMultiSelect=t&&t.length>1,f=this.revaluateContentValue(a,_)),b=b&&(!0===f||!0===p||null===f&&null===p)),h[r]=b,n||this._switchCommand(r,b,a.type),n||"openWith"!==r||this.getModelEvents().publish({event:"build_openwith",data:{visible:b,nodes:f?t:[e]}})}}),h}},enableAllCommands:function(e){var i=t.getCommands();for(var r in i){var n=t.getCommand(r);UWA.is(n)&&n.enable&&(e?this._switchCommand(r,!0):this._switchCommand(r,!1))}},getModelEvents:function(){return s.getModelEvents()},updateCommands:function(e,t){if(t||(t=n.getCurrentLibrary()),i.getContent().getView().getPADTreeDocument()){var r=i.getContent().getView().getPADTreeDocument().getSelectedNodes();r=r||(e?[e]:[]),this._parent(t,r)}}})}),define("DS/LibraryEditor/dataProvider/LibraryIdCardDataProvider",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/ActionBar/LibraryCommandManager","DS/LibraryEditor/service/LibraryTypeService"],function(e,t,i,r,n,a,o){"use strict";return e.singleton({getChildrenInfos:function(e){return new t(function(t){var a=i.getTreeCont()._getVisibleNodeById(e);if(a){var o=a.getChildren();t(o)}else r.libraries({pid:e,onComplete:function(i){var r=[];i.results?r=n.convertExpandToSearchFormat(e,i.results):i.result&&(r=n.convertNavigateToSearchFormat(i.result)),r.forEach(function(e){e.plmType=e.plmType||"Library"}),t(r)},onFailure:function(e){console.warn("WebService libraries Err : "+e),t([])}})})},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},getLibraryControl:function(){return i},getCommandManager:function(){return a},getLibraryTypeService:function(){return o}})}),define("DS/LibraryEditor/commands/LibraryCommands",["DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/utils/Library_CSO","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/WebappsUtils/WebappsUtils","DS/ApplicationFrame/CommandsManager","DS/PADUtils/views/PADProgressBar","DS/WidgetServices/WidgetServices","DS/IPClassifyUtil/OpenWithMenuBuilder","DS/IPClassifyUtil/IPClassifyUtility","text!DS/LibraryEditor/assets/LibraryProbesCommandMapping.json","DS/LibraryEditor/ActionBar/LibraryCommandManager"],function(e,t,i,r,n,a,o,s,l,d,c,u,m){"use strict";JSON.parse(u);return{_endProgressBarListener:function(){var e=this;n.getContent().getView().addEvent("onCompleteRefreshNodes",function(t){this.removeEvent("onCompleteRefreshNodes"),e._offProgressBar()})},_offProgressBar:function(){if(0===s._counter)return null;s.off()},_commonError:function(t,i,r){console.error(t,r);var n=i;!UWA.is(r)||r instanceof Error||(n+="<br>"+r),e.displayNotification({message:n,className:"error"})},_startProgressBar:function(e){1===s._counter&&s.off(),s.on(e)},_nbItemsNotNull:function(e){var t,i=e.length,r=0;for(t=0;t<i;++t)e&&r++;return r},RenameCmd:function(e,t){if("CONTENT"==t){var i=e.manager.layout.getColumnIndex("tree"),r=e.manager.layout.getCellsFromNodeModel(e.nodeModel)[i];(n=e.manager.getEditionManager(r)).onF2&&(e.manager.setActiveCell(r),n.onF2(r))}else{var n;i=e.manager.layout.getColumnIndex("tree"),r=e.manager.layout.getCellsFromNodeModel(e.nodeModel)[i];(n=e.manager.getEditionManager(r)).onF2&&(e.manager.setActiveCell(r),n.onF2(r))}},RemoveContentCmd:function(e,t){var i=o.getCommand("RemoveContent",n.getContent());i&&i.begin()},ExpandAllCmd:function(r,n){r.plmType;var a=[];"TREE"===n&&r?a.push(r):a=t.getSelectedNodes();var o=null;o=t.getCurrentLibrary(),a.length?a.forEach(function(e){null===e.options.children||e.expandAll()}):null===o?e.displayNotification({message:i.msg_warning_nocurrentlibrary,className:"warning"}):o.expandAll()},CollapseAllCmd:function(r,n){r.plmType;var a=[],o=t.getCurrentLibrary();"TREE"===n&&r?a.push(r):a=t.getSelectedNodes(),a.length?a.forEach(function(e){e.collapseAll()}):null===o?e.displayNotification({message:i.msg_warning_noselection,className:"warning"}):o.collapseAll()},EditPropertiesCmd:function(e,t){var i=o.getCommand("ActionBar_Attributes",n.getContent().getView());i&&i.begin()},RemoveFavoriteCmd:function(e,t){var i=e;if(console.log("  RemoveFavoriteCmd currentFavoriteTreeNode : ",i),i&&i.isFavorite){var r=i.getID(),a=i.options.label;console.log("  currentLibrary Id : ",r),r&&UWA.is(n.getTreeCont())&&n.getTreeCont().removeFavorite({id:r,name:a})}},AddExistingCmd:function(e,t){var i=o.getCommand("AddExistingContent",n.getContent());i&&i.begin()},OpenInCADCmd:function(e,t){var i=o.getCommand("OpenInCADHdr",n.getContent());i&&i.begin()},GetContextualMenu:function(e,i,r){var a,o=!!e.white_Click&&e.white_Click,s=r?n.getContent().getView().getPADTreeDocument().getSelectedNodes():[];if(void 0===(a=!0===o?a=t.getCurrentLibrary():s&&s.length>0?s:e.nodeModel)&&(a=e),a&&!Array.isArray(a)&&(a=[a]),!r)r={cellInfos:e,data:{event:{pageX:0,pageY:0}}};return m.getContextualMenu(a,"TREE"===i,r)},_checkTypeAvailability:function(e,i){if(i){var r=i.managedTypes;if(r){var n=null;if(n="TREE"===e?(n=t.getCurrentLibrary())?[n]:[]:t.getSelectedNodes())for(var a=!0,o=0;o<n.length;++o){var s=n[o];if(!(a=!(!s.options||!s.options.type)&&r.indexOf(s.options.type)>-1))return a}}}return!0},_addCtxCmd:function(e,t,i){var r=!0;l.isNatifEnvironnement()?0==i.nativeAvailability?r=!1:l.isWebInWinEnvironment()||0==i.v6Availability&&(r=!1):0==i.dashboardAvailability&&(r=!1),r&&(r=this._checkTypeAvailability(e,i)),r&&t.push(i)},_addCtxCmdAsync:function(e,t,i){var r=!0;if(l.isNatifEnvironnement()&&0==i.nativeAvailability&&(r=!1),r)r=this._checkTypeAvailability(e,i);return new Promise(function(e){r?i.addMenus(t).then(function(t){e(t)}):e(t)})},_addHiddenInput:function(e){var t=n.getContent().getView();UWA.createElement("a",{href:e,styles:{display:"hidden"}}).inject(t.elements.container).click()}}}),define("DS/LibraryEditor/commands/ActionBar_ExpandAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],function(e,t,i,r){"use strict";return t.extend({labelTopBar:e.i18n("Expand All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=r.getSelectedNodes();if(e.length){var t=e[0];i.ExpandAllCmd(t,"CONTENT")}else{var n=r.getCurrentLibrary();i.ExpandAllCmd(n,"TREE")}},endExecute:function(){}})}),define("DS/LibraryEditor/commands/ActionBar_RemoveContentCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","DS/LibraryEditor/commands/LibraryCommands","DS/WidgetServices/WidgetServices"],function(e,t,i,r,n,a){"use strict";return t.extend({labelTopBar:e.i18n("Remove Content"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1}),require(["DS/LibraryEditor/commands/LibraryCommands"],function(e){})},beginExecute:function(){},execute:function(){require(["DS/LibraryEditor/utils/Library_CSO","DS/IPClassifyUXUtil/IPClassifyConfirmation","DS/IPClassifyUtil/IPClassifyAlert","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(t,i,a,o,s,l,d){var c=t.getCurrentLibrary();c?i.launch({title:d.confirmation_remove_title,content:d.confirmation_remove_message},function(){c.getType();var i=t.getSelectedNodes();if(i.length>0){n._startProgressBar(d.Remove_content_loading);var u=o.getCommand("RemoveContent",l.getContent());u.disable();var m=[],y=null;i.forEach(function(t){null===y&&"noExpandState"!==t._expandState&&!0===widget.getBool("filtered-content")&&(y=!0),m.push(e.is(t.id)?t.id:t.options.resourceid)}),s.RemoveContent({IDs:m,callbacks:{onComplete:function(e){if(r.setAuthoringMode("authoring",d.replace(d.msg_info_objetremoved,{number:m.length,libraryname:c.options.label})),y||m.length>10)l.getContent().RefreshProductStructure=!0,l.getContent().loadContentAndSelect(c);else{for(var t=0;t<m.length;t++){var i=m[t];l.getContent()._libraryContentView.removeNodeInContent(i)}r.updateRefreshTime()}0===l.getContent()._libraryContentView.options.model.getAllDescendants().length&&l.getContent().getView()._addPlaceHolder(),n._offProgressBar()},onFailure:function(e){if(n._offProgressBar(),u.enable(),"string"==typeof e)n._commonError("RemoveContentCmd",d.msg_error_Removefromlibrary,e);else{var t=d.msg_error_Removefromlibrary+"<br>"+e.errorMsg+" "+d.msg_error_itemsNotRemoved+"<br>"+e.itemsNotRemoved;a.displayNotification({message:e?t:d.msg_error_Removefromlibrary,className:"error"}),e.itemsNotRemovedCount&&e.itemsNotRemovedCount<m.length&&(r.setAuthoringMode("authoring","none"),l.getContent().RefreshProductStructure=!0,l.getContent().loadContentAndSelect(c))}}}})}else a.displayNotification({message:d.msg_warning_nocontent,className:"warning"})}):a.displayNotification({message:d.msg_warning_nocurrentlibrary,className:"warning"})})},endExecute:function(){}})}),define("DS/LibraryEditor/commands/ActionBar_CollapseAllCmd",["UWA/Core","DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/Library_CSO"],function(e,t,i,r){"use strict";return t.extend({labelTopBar:e.i18n("Collase All"),isInsert:!0,datas:{},init:function(e){this._parent(e,{mode:"exclusive",isAsynchronous:!1})},beginExecute:function(){},execute:function(){var e=r.getSelectedNodes();if(e.length){var t=e[0];i.CollapseAllCmd(t,"CONTENT")}else{var n=r.getCurrentLibrary();i.CollapseAllCmd(n,"TREE")}},endExecute:function(){}})}),define("DS/LibraryEditor/dataProvider/LibraryDnDServiceProvider",["UWA/Class","DS/IPClassifyUtil/IPClassifyAlert","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/service/LibraryServices","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUX/utils/IPClassifyModeManager","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,i,r,n,a,o,s,l,d){"use strict";return e.singleton({shouldAcceptDrag:function(){var e=!0,t=a.getSelectedNodes();if(t.length>0){for(var i=0;i<t.length;++i)if("Content"!==t[i].plmType){e=!1;break}}else e=!1;return e},shouldAcceptDrop:function(e){var t=!1;return e||(e=a.getCurrentLibrary()),"RootLibrary"!==e.plmType&&o.inFamilyLibrary(e.plmType)&&(t=!0),t},addContentInObject:function(e,s,c,u){if(i._startProgressBar(d.Paste_content_loading),e&&e.plmType&&o.inFamilyLibrary(e.plmType)&&c){if(e.id===s)return i._offProgressBar(),void t.displayNotification({message:d.msg_error_MoveInSamelibrary,className:"error"});var m=c,y=m.length;if(y<1)return void console.log("  Error in LibraryDnDService.addContentInLibrary, lContentId list is empty");r.AddContent({IDs:m,library:e,callbacks:{onComplete:function(r){var o,s,c,u=!1,f=(m.length,o=d.replace(d.add_in_class,{libraryname:e.options.label}));if(r){var p=JSON.parse(r),g=p.totalCount,b=p.failedCount,v=p.alreadyExistCount;b>0?(v>0?b==v?g==b?o=d.all_in_class:g>b&&(o=d.replace(d.few_added_few_exist,{OK:g-b,exist:v}),u=!0):b>v&&(g==b?o=d.replace(d.few_exist_few_failed,{exist:v,KO:b-v}):g>b&&(o=d.replace(d.few_added_few_exist,{OK:g-b,exist:v}),u=!0,s=d.replace(d.few_failed,{KO:b-v}),c="error")):b==g?o=d.all_failed:b<g&&(o=d.replace(d.few_added,{OK:g-b}),u=!0,s=d.replace(d.few_failed,{KO:b}),c="error"),o&&(o=f+": "+o)):(o=d.replace(d.msg_info_Addinlibrary,{number:g,libraryname:e.options.label}),u=!0)}if(1==u){l.setAuthoringMode("authoring",o);var h=n.getContent(),C=a.getCurrentLibrary();if(h&&C&&C.id===e.id){i._endProgressBarListener();var _=h._libraryContentView.getPADTreeDocument();_&&_.keepExpandedState(),h.loadContentAndSelect(C,m[y-1]),h.getView().maskContentDiv(!1)}s&&t.displayNotification({message:f+": "+s,className:c})}else t.displayNotification({message:o,className:"error"})},onFailure:function(r){var o=n.getContent(),s=a.getCurrentLibrary();i._offProgressBar(),o&&s&&s.id===e.id&&o.getView().maskContentDiv(!1),t.displayNotification({message:r?d.msg_error_Addinlibrary+"<br>"+r:d.msg_error_Addinlibrary,className:"error"})}}}),i._offProgressBar()}else i._offProgressBar(),console.log("  Error in LibraryDnDService.addContentInLibrary, dropTarget_LibraryNodeModel is not a Library")},addClassesInLibrary:function(){t.displayNotification({message:d.msg_warning_dndnotsupported,className:"warning"})},getDroppedData:function(e){var t=[],i=[],r=[];if(e&&e.data&&e.data.items&&Array.isArray(e.data.items)){for(var n=0;n<e.data.items.length;n++){var a=e.data.items[n],s=a.objectId,l=a.objectType_Internal;if(l||(l=a.objectType),Array.isArray(l)){for(var d=l.length,c=d>0?l[d-1]:void 0,u=0;u<d;++u)if(o.inFamilyLibrary(l[u])){c=l[u];break}l=c}var m=a.displayName;m||(m=l),m||(m=s);var y={droppedItem_id:s,droppedItem_type:l,droppedItem_name:m,droppedSourceLibrary_id:a.libraryId,droppedItem_tenantId:a.envId};o.isRootLibrary(l)?t.push(y):o.isLibrary(l)?i.push(y):r.push(y)}var f={};return f.RootLibrary_itemList=t,f.Library_itemList=i,f.Content_itemList=r,f}},inFamilyLibrary:function(e){return o.inFamilyLibrary(e)}})}),define("DS/LibraryEditor/utils/LibraryEditorKeyboardListener",["UWA/Core","UWA/Class","UWA/Event","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/commands/LibraryCommands","DS/LibraryEditor/utils/LibraryCommandManager","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUX/events/IPClassifyEvents","DS/Logger/Logger"],function(e,t,i,r,n,a,o,s,l,d){var c=t.extend({name:"LibraryEditorKeyboardListener",init:function(e){this._parent(e),this._logger=d.getLogger(c),this._onKeyDown_binded=this._onKeyDown.bind(this)},startObservingKeyboard:function(){e.Element.addEvent.call(document,"keydown",this._onKeyDown_binded)},_onKeyDown:function(e){var t=this,n=i.whichKey(e);e.ODTENVKeyName&&(n=e.ODTENVKeyName);var d,c,u,m=function(){var e=document.activeElement;return!(!e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName)};switch(n){case"ctrl+a":d=n,c="SelectAll",(u=a.getCommand(c))&&u.isEnabled()?m()?t._logger.log("Info : '"+d+"' key pressed in INPUT field, no command launched"):(u.begin(),i.stop(e)):t._logger.log("Info : '"+d+"' key pressed, but command '"+c+"' is disabled");break;case"alt+return":l.notifyInfoExpand();break;case"ctrl+f":var y=r.getIdCardCont();y._isSearchAvailable()&&(y.switchSearch(!0),i.stop(e));break;case"f2":if(m())t._logger.log("Info : '"+n+"' key pressed in INPUT field, no command launched");else{var f=o.getSelectedNodes(),p=o.getCurrentLibrary();if(p.pathId&&!p.pathId.includes("LibrarySection_favorite"))break;if((Array.isArray(f)?f.length:0)>=1){var g=f[0];if(g&&s.inFamilyLibrary(g.plmType)&&r.getTreeCont().getView().isTreeNodeModelInstance(g))if(p.getID()==g.getID()){var b=r.getTreeCont();b&&b.switchLibraryTreeNodeLabelToWriteView&&b.switchLibraryTreeNodeLabelToWriteView(p)}else{var v=r.getContent();v&&v.switchLibraryTreeNodeLabelToWriteView&&v.switchLibraryTreeNodeLabelToWriteView(g)}else t._logger.log("Info : '"+n+"' key pressed but selected element is not a Library, no command launched")}else t._logger.log("Info : '"+n+"' key pressed when no element selected, no command launched")}}}});return c}),define("DS/LibraryEditor/dataProvider/LibraryTreeDataProvider",["UWA/Class","UWA/Class/Promise","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/commands/LibraryCommands","DS/WebappsUtils/WebappsUtils","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility","DS/IPClassifyUtil/IPClassifyAlert"],function(e,t,i,r,n,a,o,s,l,d,c,u){"use strict";var m={FAVORITES:"ipcFavoriteList_v1",getFavorites:function(){return c.getTenantAwarePreferenceName(this.FAVORITES)}};return e.singleton({expandObject:function(e){return new t(function(t,i){n.libraries({pid:e.pid,mxid:e.mxid,children:e.children,isExpandAll:e.isExpandAll,onComplete:function(i){i="string"==typeof i?JSON.parse(i):i;var r=a.getPathsAndObjectsFromExpand(i.results);if(null==r)t({paths:[],objects:[]});else if(r.paths&&r.paths.length<=0){var n=[];i.results&&(n=a.convertExpandToSearchFormat(e.pid,i.results));var o=[];for(var s in r.objects)r.objects.hasOwnProperty(s)&&s!==e.pid&&o.push(s);t({objects:function(e){var t=[];e&&e.length>0&&e.forEach(function(e){var i=a.convertToExaleadDataFormatFederated(e);i.icons=[{iconName:"library-class"}],i.plmType="Library",t.push(i)});return t}(n),childIds:o,paths:r.paths})}else{for(var s in r.objects)r.objects.hasOwnProperty(s)&&(r.objects[s].icons=[{iconName:"library-class"}],r.objects[s].plmType="Library");t({paths:r.paths,objects:r.objects})}},onFailure:function(e){i(e)}})})},getRootSectionContents:function(e){return new t(function(e,t){n.roots({fetchAll:!0,onComplete:function(t){var i=(t="string"==typeof t?JSON.parse(t):t).results?t.results:[],r=[],n=[];i.forEach(function(e){var t=a.convertToExaleadDataFormatFederated(e);t.icons=[{iconName:"library"}],t.plmType="RootLibrary",n.push(t),r.push(t.physicalid)}),e({objects:n,ids:r,infos:t.infos})},onFailure:function(e){t(e)}})})},getObjectPathLength:function(e){return new t(function(t,i){n.getLibraryPathLength({ids:e.ids,onComplete:function(e){if(e.results){var r=a.getLibraryDepth(e);t(r)}else u.displayNotification({message:l.msg_error_BOdeleted,className:"error"}),i()},onFailure:function(e){console.log("WebService getObjectPathLength Err : "+e),i(e)}})})},getObjectPath:function(e){return new t(function(t,i){n.getLibraryPath({depth:e.depth,pid:e.pid,onComplete:function(i){var r=a.convertNavigateToFlatFormat(e.depth,i.result);t(r)},onFailure:function(e){that._logger.log("WebService getObjectPath Err : "+e),i(e)}})})},getPreferenceSectionContents:function(e){return new t(function(t,r){n.favourites({ids:e.ids,onComplete:function(e){for(var r=(e="string"==typeof e?JSON.parse(e):e).results?e.results:[],n=[],o=0;o<r.length;++o){var s=i.getPlmTypeFromContentDetails(r[o].attributes),l=a.convertToExaleadDataFormatFederated(r[o]);l.plmType=s,"RootLibrary"===l.plmType?l.icons=[{iconName:"library"}]:l.icons=[{iconName:"library-class"}],n.push(l)}t(n)},onFailure:function(e){r(e)}})})},comparator:function(e,t){var i,r="LibrarySection_favorite"===e.getParent().plmType;if(r)return null;if(e.isRoot()&&t.isRoot()||r)return null;if("date"!==widget.getValue("sortMode"))return e.options.label.localeCompare(t.options.label);try{i=new Date(e.options.created)>new Date(t.options.created)?1:new Date(e.options.created)<new Date(t.options.created)?-1:0}catch(r){i=e.options.created<t.options.created?-1:1}finally{return i}},shouldBeEditable:function(e){return r.shouldBeEditable(e)},getContextualMenu:function(e){return!1===d.getWidgetOptions().enableTreeCtxMenu?[]:o.GetContextualMenu(e,"TREE")},onContentUpdate:function(e){return r.onNodeModelUpdate(e)},isValidType:function(e){return i.inFamilyLibrary(e)},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},isTreeNodeEditable:function(e){return!!(e&&e.nodeModel&&e.nodeModel.getParent())&&"LibrarySection_favorite"===e.nodeModel.getParent().plmType},isPreferenceSection:function(e){return"LibrarySection_favorite"==e},getSectionsData:function(){var e=[],t={};t.label=l.name_Section_FavoriteLibraries,t.icon=s.getWebappsAssetUrl("LibraryEditor","icons/libraryfavorites.png"),t.plmType="LibrarySection_favorite",e.push(t);var i={};return i.label=l.name_Section_AllLibraries,i.icon=s.getWebappsAssetUrl("LibraryEditor","icons/librarysectionall.png"),i.plmType="LibrarySection_AllLibraries",i.defaultSelectedSection=!0,e.push(i),e},getPreferenceSectionName:function(){return m.getFavorites()},getSecurityContextAndData:function(){return r.getCurrentSecurityContextAndLibraryData()},getObjectNotVisiblemessage:function(){return l.msg_error_NoVisibleRootLibrary},isDNDSupported:function(){return!1!==d.getWidgetOptions().enableDnd},isRoot:function(e){return!(!e||!e.flattenedtaxonomies||"types/Libraries"!==e.flattenedtaxonomies[0]||"types/General Library"!==e.flattenedtaxonomies[1])}})}),define("DS/LibraryEditor/commands/CtxCommands",["DS/ApplicationFrame/Command","DS/LibraryEditor/commands/LibraryCommands","DS/PADUtils/PADContext"],function(e,t,i){"use strict";return e.extend({execute:function(){var e=i.get().ctxInfo;switch(this.options.ID){case"RenameCmd":!function(e){var i=e.options.cellInfos,r=e.options.isTree;t.RenameCmd(i,r?"TREE":"CONTENT")}(e)}}})}),define("DS/LibraryEditor/utils/DimensionUtils",["UWA/Class","DS/LibraryEditor/service/LibraryEditorWebService"],function(e,t){"use strict";return e.singleton({init:function(e){},setUnitPreferedMe:function(e){this.unitPreferedMe=e},getUnitPreferedMe:function(e){return this.unitPreferedMe[e]},getDimensions:function(){var e=this;return new Promise(function(i){e._dimensions?i(e._dimensions):t.getDimensionsInfos({method:"GET",Accept:"application/json","content-type":"application/json",onComplete:function(t){try{t="string"==typeof t?JSON.parse(t):t;var r={};t.results.forEach(function(e){var t={};t.mksUnitDBName=e.MKSUnit;e.Units.forEach(function(e){t[e.Name]=e.NLSName,t.mksUnitDBName==e.Name&&(t.defaultUnit=e.NLSName)}),r[e.Name]=t}),e._dimensions=r,console.info("Dimensions Loaded ..."),i(e._dimensions)}catch(e){console.error("Unexpected error when fetching dimensions"),console.error(e),i(null)}},onFailure:function(e){console.error("Unable to get dimentions : "),console.error(e),i(null)}})})}})}),define("DS/LibraryEditor/dataProvider/LibraryContentDataProvider",["UWA/Class","UWA/Class/Promise","DS/PADUtils/PADProbes","DS/LibraryEditor/utils/LibraryEditorDataConversion","DS/LibraryEditor/service/LibraryEditorWebService","DS/LibraryEditor/service/LibraryTypeService","DS/IPClassifyUtil/IPClassifyPreference","DS/LibraryEditor/utils/LibraryEditorUtil","DS/LibraryEditor/utils/LibrarySearch","DS/LibraryEditor/commands/LibraryCommands","DS/IPClassifyUtil/IPClassifyAlert","i18n!DS/LibraryEditor/assets/nls/LibraryEditor","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/IPClassifyUtil/IPClassifyUtility","DS/LibraryEditor/utils/DimensionUtils","DS/LibraryEditor/utils/Library_CSO","DS/WidgetServices/WidgetServices"],function(e,t,i,r,n,a,o,s,l,d,c,u,m,y,f,p,g){"use strict";var b={FAVORITES:"ipcFavoriteList_v1",getFavorites:function(){return y.getTenantAwarePreferenceName(this.FAVORITES)}},v=e.singleton({getObjectsForRefresh:function(e,i){var a=this;return new t(function(t){var o=[],s=l.getPredicateUnitMapping();i.forEach(function(e){e.isDynamic?(-1===o.indexOf(e.dbAttribute)&&o.push(e.dbAttribute),s[e.dbAttribute]&&s[e.dbAttribute].fetchInputUnit&&(o.push(e.dbAttribute+".inputunit"),o.push(e.dbAttribute+".inputvalue"))):e.attrDBName&&e.attrDBName.length>0&&e.attrDBName.forEach(function(e){e.startsWith("attribute[")&&o.push(e)})}),n._performFetchQuery({ids:e,dynamicAttrs:o,isAuthoringMode:!0,onComplete:function(e){var n=[];e.results&&e.results.length>0&&e.results.forEach(function(e){n.push(r.convertToExaleadDataFormatFederated(e))}),a.getInputWSConvsionUnits(i,n,!0).then(function(e){var i=e.mapping,r=e.data;r.Data&&r.Data.length>0?a.convertToPreferdUnits(r).then(function(e){null!==e&&(e="string"==typeof e?JSON.parse(e):e,i.forEach(function(t){e.forEach(function(e){if(t.UnitFrom===e.UnitFrom&&t.UnitTo===e.UnitTo){var i=a.formatResult(t.isMultiVal,t.mksValue,e.ValuesToConvert,e.ConvertedValues);i.length>0&&(n[t.rowIdx].grid[t.dataIndex]=i.join(",")+" "+t.UnitTo_nls)}})})),t(n)}):t(n)})},onFailure:function(){console.error("Unable to update Content root node, Error in getting content Properties"),t(null)}})})},getObjectDynamicAttributes:function(e,r){var a=i.createProbe("probeFetchClassificationAttrs"),o=[],d=[],c=[],m=[],y={generatedPredicates:{}},f=[],p=[],b={};return new t(function(t,i){"RootLibrary"!==e.type?s.getClassAttrPos().then(function(s){n.getClassificationAttributes({classid:e.id,onComplete:function(e){var i=JSON.parse(e),n=i.attribute;if(n||(n=i.Attribute),n.length>0){for(var u=[],v=0,h=n.length;v<h;++v){var C=n[v].predicate,_=n[v].name,L=!1;if(o[v]=n[v].nls_label||_,C&&(d[v]=C),c[v]="attribute["+_+"]",f[v]=n[v].type,"real"==f[v]&&n[v].dimension||n[v].valuetype&&"multival"==n[v].valuetype?f[v]="string":"timestamp"==f[v]?f[v]="date":"real"==f[v]?f[v]="float":"TRUE"==n[v].multiline&&(f[v]="multiline"),p[v]=s?v:void 0,n[v].dimension){var S=n[v].manipulationUnit;if(S&&S.length>0)b["attribute["+_+"].manipulationUnit"]=S;else if(n[v].valuetype&&"multival"!=n[v].valuetype&&!g.isNatifEnvironnement()){if(r)m.push("attribute["+_+"].inputunit"),m.push("attribute["+_+"].inputvalue");else if(C)if(C.startsWith("ds6wg:"))m.push(C+"inputunit"),m.push(C+"inputvalue");else{var E="ds6wg:"+_.replace(new RegExp(" ","g"),"_");m.push(E+"inputunit"),m.push(E+"inputvalue"),y.generatedPredicates[E]=C}L=!0}C&&(y[C]=n[v].dimensionUnits),y["attribute["+_+"]"]=n[v].dimensionUnits,L&&(y["attribute["+_+"]"].fetchInputUnit=!0),b["attribute["+_+"].dimension"]=n[v].dimension.substring(n[v].dimension.indexOf("_")+1),u.push("attribute["+_+"]")}}b.attrsToConvert=u}l.resetAttrNameToPredMapping(),l.setPredicateUnitMapping(y),l.resetDynamicHeaderMap();for(v=0;v<c.length;++v)l.addToDynamicHeaderMap({text:o[v],dataIndex:d[v],dbAttribute:c[v]}),l.setAttrNameToPredMapping({key:c[v],value:d[v]});t({dynamicattributes:d,dynamicattributesForUIView:o,dynamicattributesName:c,unitPredicates:m,unitData:y,dynamicattributesType:f,dynamicattributesIndex:p,convUnitInfos:b}),a.end()},onFailure:function(){console.log(u.get("msg_classificationattributes_webservicefailed")),i(),a.end()}})}):t()})},getTooltipIfDynamicColumn:function(e,t){if(t&&t.isDynamic){e.dataIndex=t.dataIndex;for(var i=l.getDynamicHeaderMap(),r=0;r<i.length;r++)if(e.dataIndex==i[r].dataIndex)return i[r].toolTip}return null},getObjectContents:function(e){return new t(function(t,i){n.content({pid:e.pid,mxid:e.mxid,searchQuery:e.searchQuery,isExactSearch:e.isExactSearch,selectedType:e.selectedType,dynamicattributes:e.dynamicattributes,filters:e.filters,start:e.start,next_start:e.next_start,order_field:e.order_field,order_by:e.order_by,isAuthoringMode:e.isAuthoringMode,onComplete:function(i){if((i="string"==typeof i?JSON.parse(i):i).result)return n=r.convertNavigateToSearchFormat(i.result),void t({contents:o(n),infos:i.infos,facets:i.facets});var n=function(e,t){var i=[];null!=e&&e.forEach(function(e){var r=!1;e.attributes&&e.attributes.forEach(function(e){"physicalid"===e.name&&e.value!=t&&(r=!0)}),r&&i.push(e)});return i}(i.results,e.pid);function o(e){var t=[];return e.forEach(function(e){var i=r.convertToExaleadDataFormatFederated(e),n=e.attributes;i.plmType=a.getPlmTypeFromContentDetails(n),i.Documentlocked=e.Documentlocked,i.publishOnConnect=e.publishOnConnect,t.push(i)}),t}v.loadDimensions(e.attributesDimMap).then(function(){t({contents:o(n),infos:i.infos,facets:i.facets})})},onFailure:function(e,t){i({err:e,serverErr:t,msg:u.msg_error_contentnotavailable})}})})},getInputWSConvsionUnits:function(e,i,r){return new t(function(t){var n=[],a=[];f.getDimensions().then(function(o){for(var s=0;e&&s<e.length;++s){var l={},d=e[s];try{var c=o[d.convertInfos.dimension],u=c.mksUnitDBName,m=d.convertInfos.manipulationUnit;!m&&g.isNatifEnvironnement()&&(m=f.getUnitPreferedMe(d.convertInfos.dimension));var y=c[m];if(y&&y.length>0&&u!==m){var p=d.dataIndex,b=u+":"+m+":"+d.convertInfos.dimension;a[b]?l=a[b]:(l.UnitFrom=u,l.UnitTo=m,l.Dimension=d.convertInfos.dimension);for(var v=0;v<i.length;v++){var h=i[v],C=h.grid||h.options.grid;if(C[p+"_mksvalue"]&&C[p+"_mksvalue"].length>0&&("Content"===h.plmType||r)){var _=C[p+"_mksvalue"],L=Array.isArray(_)||_.indexOf(",")>-1;(L&&!Array.isArray(_)||!L)&&(_=_.trim().split(","));var S=_.join(";");try{var E=l.Values.split(";");_.forEach(function(e){-1==E.indexOf(e)&&E.push(e)}),l.Values=E.join(";")}catch(e){l.Values=S}l.Values&&l.Values.length>0&&(a[b]=l,n.push({modelId:h._id,rowIdx:r?v:h._getRowID(),dataIndex:d.dataIndex,mksValue:S,UnitFrom:u,UnitTo:m,UnitTo_nls:y,isMultiVal:L}))}}}}catch(e){}}var w={Data:[]};for(var D in a)w.Data.push(a[D]);t({mapping:n,data:w})})})},updateAttributesDelayedForUnits:function(e,t){if("OnSyncModel"===e.context||"OnScrollEnd"===e.context){var i=this;if(t){var r=t.layout.getLeafColumns(),n=e.collectionView;i.getInputWSConvsionUnits(r,n.model,!1).then(function(e){var t=e.mapping,r=e.data;r.Data&&r.Data.length>0&&i.convertToPreferdUnits(r).then(function(e){null!==e&&(e="string"==typeof e?JSON.parse(e):e,t.forEach(function(t){var r=n.model[t.rowIdx];e.forEach(function(e){if(t.modelId==r._id&&"Content"===r.plmType&&t.UnitFrom===e.UnitFrom&&t.UnitTo===e.UnitTo){var a=i.formatResult(t.isMultiVal,t.mksValue,e.ValuesToConvert,e.ConvertedValues);a.length>0&&(n.setNodeModelValue(r,t.dataIndex,a.join(",")+" "+t.UnitTo_nls),n.setNodeModelValue(r,t.dataIndex+"_mksvalue",void 0))}})}))})})}}},formatResult:function(e,t,i,r){var n=[],a=i.split(";"),o=r.split(";");if(e)for(var s=t.split(";"),l=0;l<s.length;l++){if((c=a.indexOf(s[l]))>-1){var d=+o[c];n.push(d.toString().indexOf(".")>-1?d:d+".0")}}else{var c;d=+o[c=a.indexOf(t)];n.push(d.toString().indexOf(".")>-1?d:d+".0")}return n},convertToPreferdUnits:function(e){return new t(function(t){n.convertDimensionUnits({data:e,onComplete:function(e){var i=(e="string"==typeof e?JSON.parse(e):e).Response?e.Response:[];t(i)},onFailure:function(e){console.error("Unable to convert dimentions units : "),console.error(e),t(null)}})})},getPaginatedSectionContents:function(e){return new t(function(t,i){n.roots({filters:e.filters,start:e.start,next_start:e.next_start,order_field:e.order_field,order_by:e.order_by,searchQuery:e.searchQuery,onComplete:function(e){var i=[];e.results&&e.results.forEach(function(e){var t=r.convertToExaleadDataFormatFederated(e),n=e.attributes;t.plmType=a.getPlmTypeFromContentDetails(n),t.Documentlocked=e.Documentlocked,t.publishOnConnect=e.publishOnConnect,i.push(t)}),t({results:i,infos:e.infos,facets:e.facets})},onFailure:function(){i()}})})},loadDimensions:function(e){return new t(function(t){f.getDimensions().then(function(i){if(null!=i){var r={},n=l.getPredicateUnitMapping();for(var a in e)if(i[e[a]]&&!n[a]){var o={};o[a]=i[e[a]],UWA.extend(r,o,!0)}l.setPredicateUnitMapping(r)}t()})})},getPreferenceSectionContents:function(e){return new t(function(t,i){n.favourites({ids:e.ids,onComplete:function(e){for(var i=(e="string"==typeof e?JSON.parse(e):e).results?e.results:[],n=[],o=0;o<i.length;++o){var s=a.getPlmTypeFromContentDetails(i[o].attributes),l=r.convertToExaleadDataFormatFederated(i[o]);l.plmType=s,n.push(l)}t(n)},onFailure:function(e){i(e)}})})},getContextualMenu:function(e,t,i,r){return!1===m.getWidgetOptions().enableCtxMenu?[]:d.GetContextualMenu(e,t,r)},comparator:function(e,t){return s.sortColumn(e,t)},getPreferenceSectionName:function(){return b.getFavorites()},isValidType:function(e){return a.inFamilyLibrary(e)},isValidTypeForPlaceholder:function(e){return!this.isSection(e)&&"RootLibrary"!==e},isSection:function(e){return"LibrarySection_favorite"==e||"LibrarySection_AllLibraries"==e},isPreferenceSection:function(e){return"LibrarySection_favorite"==e},toEnableTreeColumnEdit:function(e){return this.isPreferenceSection(e)},isPaginatedSection:function(e){return"LibrarySection_AllLibraries"==e},shouldBeEditable:function(e){return s.shouldBeEditable(e)},onContentUpdate:function(e){return s.onNodeModelUpdate(e)},getRepeatMode:function(){return s.getRepeatMode()},onAddColumn:function(e){l.filterExcludeListColumns(e).length>0&&(l.setPredicates(e),l.addToPredicateHeaderMap(e))},onRemoveColumn:function(e){l.removePredicates(e),l.removeFromPredicateHeaderMap(e)},onResetColumn:function(e,t){l.removeAllPredicates(),l.setPredicates(e,t)},setColumnNames:function(e,t){l.setPredicates(e,t)},initColumns:function(e){l.initPredicateToHeaderMap(e)},showContentPlaceholder:function(){return!0},isDNDSupported:function(){return!1!==m.getWidgetOptions().enableDnd},getAuthModeNoSortColumns:function(e){return l.getAuthModeNoSortColumns(e)},hasLibrarianRole:function(){return new t(function(e,t){e({readOnly:!0,isLeader:!0,isOwner:!1})})},getLibraryControl:function(){return m},getLibraryEditorUtil:function(){return s},getLibraryTypeService:function(){return a}});return v}),define("DS/LibraryEditor/commands/LibraryCommandsIconBar",["UWA/Core","UWA/Class/View","DS/UIKIT/Iconbar","DS/ApplicationFrame/CommandsManager","DS/LibraryEditor/service/LibraryTypeService","DS/LibraryEditor/utils/LibraryEditorcontrol","DS/LibraryEditor/utils/Library_CSO","DS/LibraryEditor/utils/LibraryEditorUtil","DS/IPClassifyUtil/IPClassifyAlert","DS/WidgetServices/WidgetServices","i18n!DS/LibraryEditor/assets/nls/LibraryEditor"],function(e,t,i,r,n,a,o,s,l,d,c){"use strict";var u="datagridview",m="tileview",y="thumbnailview",f="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tree-view-all",p="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-tree-view-all",g="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-view-small-tile",b="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-view-small-tile",v="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-view-small-thb",h="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-view-small-thb",C="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-down",_="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-down",L="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-down-cog",S="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-down-cog",E="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-up",w="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-tree-expand-up",D="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-cascade",A="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-cascade",x="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-cascade-wrong-2",P="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-cascade-wrong-2",I="fonticon fonticon-wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-cascade-wrong-1",T="wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-flow-cascade-wrong-1",N="fonticon fonticon-replace-by-revision wux-ui-3ds",U="fonticon fonticon-replace-by-latest-version wux-ui-3ds";return t.extend({name:"DS/LibraryEditor/commands/LibraryCommandsIconBar",_iconBar:null,repeatModestate:!1,disabledCommands:[],commandsList:{addExisting:{fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-insert",text:c.command_addExisting,name:"addExisting",handler:function(e,t){var i=r.getCommand("AddExistingContent",a.getContent());i&&i.begin()}},removeContent:{fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-remove",text:c.command_removeContent,name:"removeContent",handler:function(e,t){var i=r.getCommand("RemoveContent",a.getContent());i&&i.begin()}},addRemoveFavs:{fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-favorite-on",text:c.command_addRemoveFavs,name:"addRemoveFavorites",handler:function(t,i){var r=o.getCurrentLibrary(),s=r.getID(),l=r.getType(),d=r.options.label;0==a.getTreeCont().isLibraryAmongFavoriteLibraries(s)?r&&s&&n.inFamilyLibrary(l)&&e.is(a.getTreeCont())&&a.getTreeCont().addFavorite({id:s,name:d}):r&&s&&n.inFamilyLibrary(l)&&e.is(a.getTreeCont())&&a.getTreeCont().removeFavorite({id:s,name:d})}},properties:{fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attributes",text:c.command_properties,name:"properties",handler:function(e,t){var i=r.getCommand("ActionBar_Attributes",a.getContent());i&&i.begin()}},repeatCmd:{fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-play-loop",text:c.command_repeatCmd,name:"repeatCmd",handler:function(e,t){this.repeatModestate=!this.repeatModestate,s.setRepeatMode(this.repeatModestate);var i=c.msg_info_repeatModeDisabled;this.repeatModestate&&(i=c.msg_info_repeatModeEnabled),l.displayNotification({message:i,className:"primary"})}},customizeGridView:{fonticon:"wux-ui-3ds wux-ui-3ds-1x wux-ui-3ds-attributes-cog",text:c.command_customizeGridView,name:"customizeGridView",handler:function(e,t){var i=r.getCommand("ColumnVisibility",a.getContent());i&&i.begin()}}},setup:function(e){this._parent(e),this._iconBar=null},render:function(e,t,r){var n=this;return n._iconBar=new i({renderTo:n.container,items:[]}),n._iconBar.addItem({className:"divider"}),n._iconBar.addItem(n.commandsList.addExisting),n.addRevisionCommandsToList(),n._iconBar.addItem(n.commandsList.removeContent),n._iconBar.addItem(n.commandsList.addRemoveFavs),n._iconBar.addItem(n.commandsList.properties),n.addCommandsToList(),d.isNatifEnvironnement()&&(d.isWebInWinEnvironment()||n._iconBar.addItem(n.commandsList.repeatCmd)),n._iconBar.addItem(n.commandsList.customizeGridView),n._iconBar.addItem({className:"divider"}),n.updateCommandVisibilityInIconBar(e,t,r),n},addRevisionCommandsToList:function(){var e=this;e.commandsList.replaceByContent={fonticon:"replace-by-revision wux-ui-3ds",text:c.command_replaceByRevision,name:"replaceByContent",content:{type:"dropdownmenu",options:{multiSelect:!1,items:[{fonticon:"replace-by-revision wux-ui-3ds",text:c.command_replaceByRevision,name:"replaceByRevision",selectable:!0,selected:!0,handler:function(){var t=e._iconBar.getItem("replaceByContent");e.setReplaceByRevisionCmdsIcon(t,"replaceByRevision");var i=r.getCommand("ReplaceByRevision",a.getContent());i&&i.begin()}},{fonticon:"replace-by-latest-version wux-ui-3ds",text:c.command_replaceByLatestRevision,name:"replaceByLatestRevision",selectable:!0,selected:!1,handler:function(){var t=e._iconBar.getItem("replaceByContent");e.setReplaceByRevisionCmdsIcon(t,"replaceByLatestRevision");var i=r.getCommand("ReplaceByLatestRevision",a.getContent());i&&i.begin()}}]}}},e._iconBar.addItem(e.commandsList.replaceByContent)},addCommandsToList:function(){var e=this,t=a.getContent().getView().getActiveView(),i="",n="",o=null,s=null,l=null;t===u?(i=c.command_treeview,n=p,o=!0,s=!1,l=!1):t===m?(i=c.command_tileview,n=b,o=!1,s=!0,l=!1):t===y&&(i=c.command_thumbnail,n=h,o=!1,s=!1,l=!0),e.commandsList.switchViews={fonticon:n,text:i,name:"view",content:{type:"dropdownmenu",options:{multiSelect:!1,items:[{fonticon:p,text:c.command_treeview,name:"treeview",selectable:!0,selected:o,handler:function(){var t=e._iconBar.getItem("view");e.setViewCmdsIcon(t,"treeview");var i=r.getCommand("treeview",a.getContent());i&&i.begin(),e.enableCommands(["customizeGridView"])}},{fonticon:b,text:c.command_tileview,name:"tileview",selectable:!0,selected:s,handler:function(){var t=e._iconBar.getItem("view");e.setViewCmdsIcon(t,"tileview");var i=r.getCommand("tileview",a.getContent());i&&i.begin(),e.disableCommands(["customizeGridView"])}},{fonticon:h,text:c.command_thumbnail,name:"thumbnailview",selectable:!0,selected:l,handler:function(){var t=e._iconBar.getItem("view");e.setViewCmdsIcon(t,"thumbnailview");var i=r.getCommand("thumbnailview",a.getContent());i&&i.begin(),e.disableCommands(["customizeGridView"])}}]}}},e.commandsList.expandAndClps={fonticon:_,text:c.command_expandAll,name:"expandAndCollapse",content:{type:"dropdownmenu",options:{multiSelect:!1,items:[{fonticon:_,text:c.command_expandAll,name:"expandAll",selectable:!0,selected:!0,handler:function(){var t=e._iconBar.getItem("expandAndCollapse");e.setExpandClpsCmdsIcon(t,"expandAll");var i=r.getCommand("ExpandAll",a.getContent());i&&i.begin()}},{fonticon:S,text:c.command_expandNLevels,name:"expandNLevels",selectable:!0,selected:!1,handler:function(){var t=e._iconBar.getItem("expandAndCollapse");e.setExpandClpsCmdsIcon(t,"expandNLevels");var i=r.getCommand("ExpandN",a.getContent());i&&i.begin()}},{fonticon:w,text:c.command_collapseAll,name:"collapseAll",selectable:!0,selected:!1,handler:function(){var t=e._iconBar.getItem("expandAndCollapse");e.setExpandClpsCmdsIcon(t,"collapseAll");var i=r.getCommand("CollapseAll",a.getContent());i&&i.begin()}}]}}},e.commandsList.selectionCmd={fonticon:A,text:c.command_selectAllVisible,name:"selections",content:{type:"dropdownmenu",options:{multiSelect:!1,items:[{fonticon:A,text:c.command_selectAllVisible,name:"selectAllVisible",selectable:!0,selected:!0,handler:function(){var t=e._iconBar.getItem("selections");e.setSelectionCmdsIcon(t,"selectAllVisible");var i=r.getCommand("SelectAll",a.getContent());i&&i.begin()}},{fonticon:P,text:c.command_selectInversion,name:"selectInversion",selectable:!0,selected:!1,handler:function(){var t=e._iconBar.getItem("selections");e.setSelectionCmdsIcon(t,"selectInversion");var i=r.getCommand("SelectInversion",a.getContent());i&&i.begin()}},{fonticon:T,text:c.command_selectSiblings,name:"selectSiblings",selectable:!0,selected:!1,handler:function(){var t=e._iconBar.getItem("selections");e.setSelectionCmdsIcon(t,"selectSiblings");var i=r.getCommand("SelectSiblings",a.getContent());i&&i.begin()}}]}}},e._iconBar.addItem(e.commandsList.switchViews),e._iconBar.addItem(e.commandsList.expandAndClps),e._iconBar.addItem(e.commandsList.selectionCmd)},updateCommandVisibilityInIconBar:function(e,t,i){var r=this;function a(){r._iconBar.disableItem("addExisting"),r.disabledCommands.push("addExisting")}function s(){r._iconBar.disableItem("removeContent"),r.disabledCommands.push("removeContent")}if(r.enableCommands("All",["customizeGridView"]),void 0===e&&(e=o.getCurrentLibrary()),void 0===t&&(t="TREE"),void 0===i&&(i=o.getCurrentLibrary()),"TREE"===t)n.inFamilyLibrary(e.plmType)?"RootLibrary"===e.plmType?(a(),s(),r.disableCommands(["replaceByContent"])):"Library"===e.plmType&&(s(),r.disableCommands(["replaceByContent"])):"LibrarySection_favorite"!=e.plmType&&"LibrarySection_AllLibraries"!=e.plmType||(a(),s(),r.disableCommands(["addRemoveFavorites","properties"]),r.disableCommands(["replaceByContent"]));else if("CONTENT"===t){var l=i.plmType;n.inFamilyLibrary(l)?("RootLibrary"===e.plmType||"Library"===e.plmType?(s(),r.disableCommands(["replaceByContent"])):"LibraryFeaturePort"===e._options.type&&r.disableCommands(["replaceByContent"]),a(),r.disableCommands(["expandAndCollapse"])):"LibrarySection_AllLibraries"==l?(a(),s(),r.disableCommands(["replaceByContent"]),r.disableCommands(["addRemoveFavorites","expandAndCollapse"])):"LibrarySection_favorite"==l&&(a(),s(),r.disableCommands(["replaceByContent"]),r.disableCommands(["addRemoveFavorites"]))}r._iconBar.show()},setReplaceByRevisionCmdsIcon:function(e,t){var i=e.elements.icon,r=e.tooltip;"replaceByRevision"===t?(i.hasClassName(U)&&i.removeClassName(U).addClassName(N),e.fonticon="replace-by-revision wux-ui-3ds",e.text=c.command_replaceByRevision,r.setBody(c.command_replaceByRevision)):"replaceByLatestRevision"===t&&(i.hasClassName(N)&&i.removeClassName(N).addClassName(U),e.fonticon="replace-by-latest-version wux-ui-3ds",e.text=c.command_replaceByLatestRevision,r.setBody(c.command_replaceByLatestRevision))},setViewCmdsIcon:function(e,t){var i=e.elements.icon,r=e.tooltip;"treeview"===t?(i.hasClassName(g)?i.removeClassName(g).addClassName(f):i.hasClassName(v)&&i.removeClassName(v).addClassName(f),e.fonticon=p,e.text=c.command_treeview,r.setBody(c.command_treeview)):"tileview"===t?(i.hasClassName(f)?i.removeClassName(f).addClassName(g):i.hasClassName(v)&&i.removeClassName(v).addClassName(g),e.fonticon=b,e.text=c.command_tileview,r.setBody(c.command_tileview)):"thumbnailview"===t&&(i.hasClassName(f)?i.removeClassName(f).addClassName(v):i.hasClassName(g)&&i.removeClassName(g).addClassName(v),e.fonticon=h,e.text=c.command_thumbnail,r.setBody(c.command_thumbnail))},setExpandClpsCmdsIcon:function(e,t){var i=e.elements.icon,r=e.tooltip;"expandAll"===t?(i.hasClassName(L)?i.removeClassName(L).addClassName(C):i.hasClassName(E)&&i.removeClassName(E).addClassName(C),e.fonticon=_,e.text=c.command_expandAll,r.setBody(c.command_expandAll)):"expandNLevels"===t?(i.hasClassName(C)?i.removeClassName(C).addClassName(L):i.hasClassName(E)&&i.removeClassName(E).addClassName(L),e.fonticon=S,e.text=c.command_expandNLevels,r.setBody(c.command_expandNLevels)):"collapseAll"===t&&(i.hasClassName(C)?i.removeClassName(C).addClassName(E):i.hasClassName(L)&&i.removeClassName(L).addClassName(E),e.fonticon=w,e.text=c.command_collapseAll,r.setBody(c.command_collapseAll))},setSelectionCmdsIcon:function(e,t){var i=e.elements.icon,r=e.tooltip;"selectAllVisible"===t?(i.hasClassName(x)?i.removeClassName(x).addClassName(D):i.hasClassName(I)&&i.removeClassName(I).addClassName(D),e.fonticon=A,e.text=c.command_selectAllVisible,r.setBody(c.command_selectAllVisible)):"selectInversion"===t?(i.hasClassName(D)?i.removeClassName(D).addClassName(x):i.hasClassName(I)&&i.removeClassName(I).addClassName(x),e.fonticon=P,e.text=c.command_selectInversion,r.setBody(c.command_selectInversion)):"selectSiblings"===t&&(i.hasClassName(D)?i.removeClassName(D).addClassName(I):i.hasClassName(x)&&i.removeClassName(x).addClassName(I),e.fonticon=T,e.text=c.command_selectSiblings,r.setBody(c.command_selectSiblings))},enableCommands:function(e,t){var i=!1;t||(t=[]),e&&0!=e.length&&"All"!=e||(e=this.disabledCommands,i=!0);for(var r=0;r<e.length;++r)-1===t.indexOf(e[r])&&(this._iconBar.enableItem(e[r]),i||(this.disabledCommands=this.disabledCommands.filter(function(t){return t!==e[r]})));i&&(this.disabledCommands=t)},disableCommands:function(e){if(e&&0!=e.length)for(var t=0;t<e.length;++t)this._iconBar.disableItem(e[t]),-1==this.disabledCommands.indexOf(e[t])&&this.disabledCommands.push(e[t])}})}),define("DS/LibraryEditor/dataProvider/LibraryCommandsIconBarProvider",["UWA/Class","DS/LibraryEditor/commands/LibraryCommandsIconBar","DS/LibraryEditor/utils/LibraryEditorcontrol"],function(e,t,i){"use strict";return e.singleton({getCommandsIconBar:function(){return!1===i.getWidgetOptions().enableIconBarMenu?null:new(require("DS/LibraryEditor/commands/LibraryCommandsIconBar"))}})});