define("DS/CfgVersionGraphUX/scripts/CfgTreeNodeModel",["DS/LifecycleDAGModel/DAGNodeModelBase"],function(e){"use strict";var t=function(t,i,n,o,s,r,a,l,d,p){if(t)if(t instanceof e)for(var h in this.options={},t.options)"children"!==h&&(this.options[h]=t.options[h]);else this.options={id:t,versionType:r,name:i,label:n,children:[],revision:o,creationDate:p,grid:{range:d,revision:o,current:s,creationDate:p},data:{frozen:l}};else this.options={isEmpty:!0};e.call(this,this.options)};return(t.prototype=Object.create(e.prototype)).constructor=t,t.prototype.isLeaf=function(){return!0===this.options.grid.__isLeaf__},t.prototype.isActive=function(){return!0===this.options.grid.__isActive__},t.prototype.clone=function(){return new t(this)},t.prototype.sortFunction=function(e,t){return!t&&(t=e=this),e.options.grid.creationDate>t.options.grid.creationDate},t.prototype.getLastLeaf=function(){for(var e=this;e.hasChildren();e=e.getLastChild());return e},t.prototype._getID=function(){return this.isEmpty()?this._id:this.options.id},t.prototype.isEmpty=function(){return!0===this.options.isEmpty},t.prototype.refreshNodeData=function(t){for(var i in(t=t||{})instanceof e&&(t=t.options.grid),this.options.grid)if(!(i.startsWith("__")&&i.endsWith("__")||"object"==typeof t[i])){if("title"===i){var n=t.title||t.label;n&&this.options.label!==n&&this.setAttribute("title",this.options.label=n)}t[i]&&t[i]!==this.options.grid[i]&&this.setAttribute(i,t[i])}},t.prototype.getAttribute=function(e){return this.options.grid[e]},t}),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraphColumnManager",["DS/GraphListView/ColumnManagerBase","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS"],function(e,t){"use strict";return e.extend({init:function(e){this._parent(e),this.setDefaultColumns([{text:"",dataIndex:"bi_color",width:10,isSortable:!1,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:t.CFG_Label_Graph,dataIndex:"__GRAPH__",width:160,style:{overflow:"scroll"},isSortable:!0,isDraggable:!1,isEditable:!1,alwaysOn:!0},{text:"<span style='font-weight:bold' class='fonticon fonticon-infinity'/>",dataIndex:"range",width:35,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1},{text:t.CFG_Label_Title,dataIndex:"tree",width:140,isSortable:!1,isDraggable:!1,isEditable:!1,isHidden:!1},{text:t.CFG_Label_Revision,dataIndex:"revision",width:85,isSortable:!0,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_State,dataIndex:"current",width:85,isSortable:!1,isDraggable:!1,isEditable:!1},{text:t.CFG_Label_CreationDate,dataIndex:"creationDate",width:"auto",isSortable:!0,isDraggable:!1,isEditable:!1}],!0)}})}),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraphModelManager",["DS/CfgVersionGraphUX/scripts/CfgTreeNodeModel"],function(e){"use strict";return UWA.Class.extend({setModel:function(e){this._treeDocument=e,this._treeDocument.empty(),this._nodeArray=this._treeDocument._nodeList},createModel:function(t,i="asc"){this._treeDocument.prepareUpdate();for(var n=0;n<t.length;n++){var o=t[n].id,s=new Date(t[n].originated).toLocaleString(),r=t[n].name,a=t[n].revision,l=t[n].label,d=t[n].current,p=t[n].input,h=t[n].data.frozen,_=new e(o,r,l,a,d,p,!0,h,"",s);0===n?this._treeDocument.addChildNode(_,0,null,void 0,void 0,!0):t[n].parentid?this._treeDocument.addChildNode(_,0,this.getTreeNodeParent(t[n].parentid),void 0,void 0,!0):this._treeDocument.addChildNode(_,0,null,void 0,void 0,!0),t[n].children&&t[n].children.length>0&&this.addChild(t[n].children)}return this._treeDocument._isLoaded=!0,"asc"===i&&this._treeDocument._nodeList.reverse(),this._treeDocument.pushUpdate(),this._treeDocument},addChild:function(t){for(var i=0;i<t.length;i++){var n=this.getTreeNodeParent(t[i].parentid),o=t[i].id,s=new Date(t[i].originated).toLocaleString(),r=t[i].name,a=t[i].revision,l=t[i].label,d=t[i].current,p=t[i].input,h=t[i].data.frozen,_=new e(o,r,l,a,d,p,!0,h,"",s);"Derivation"===_.options.versionType?this._treeDocument.addChildNode(_,1,n,void 0,void 0,!0):this._treeDocument.addChildNode(_,0,n,void 0,void 0,!0),t[i].children&&t[i].children.length>0&&this.addChild(t[i].children),this._treeDocument.prepareAddDelete(),this._treeDocument.pushAddDelete()}},getTreeNodeParent:function(e){var t=null;if(this._treeDocument.getNodeByID){var i=this._treeDocument.getNodeByID(e);i&&(t=i)}else this._nodeArray.forEach(function(i){i.options.id==e&&(t=i)});return t}})}),define("DS/CfgVersionGraphUX/scripts/CfgVersionGraph",["UWA/Core","DS/UIKIT/Iconbar","DS/UIKIT/Spinner","DS/GraphListView/GraphListView","DS/CfgVersionGraphUX/scripts/CfgVersionGraphModelManager","DS/CfgVersionGraphUX/scripts/CfgVersionGraphColumnManager","DS/CfgBaseUX/scripts/CfgToggle","DS/CfgBaseUX/scripts/CfgData","DS/CfgEvolutionUX/CfgEvolutionUtils","DS/CfgBaseUX/scripts/CfgEffectivityExpressionContainer","i18n!DS/CfgVersionGraphUX/assets/nls/CfgVersionGraphNLS","css!DS/CfgVersionGraphUX/CfgVersionGraphUX.css"],function(e,t,i,n,o,s,r,a,l,d,p){"use strict";return n.extend({_options:void 0,CfgExpressionBox:!1,CfgExpressionBoxMaximized:!1,CfgSelectedNode:null,CfgSelectedModel:null,VersionGraphModelMgr:null,MainContainer:null,CfgToolbarContainer:null,VersionGraphContainer:null,ExpJson:{xml:"",json:[],iDescriptionTag:[]},IsExpressionModified:!1,getVersionGraph:function(){return this.MainContainer},get:function(){return this.ExpJson},init:function(n){var o=this;this.MainContainer=e.createElement("div",{class:"versionGraphMainContainer",styles:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}}),this.VersionGraphContainer=e.createElement("div",{class:"versionGraphContainer",html:'<div class="version-subway-canvas"></div>',styles:{width:"100%",border:"1px solid #D4D4D4",height:"calc(100% - 40px)",borderRadius:"5px"}}),this._options=e.extend({container:o.VersionGraphContainer.getElement(".version-subway-canvas"),columnManager:new s(n),allowUnsafeHTMLContent:!0,defaultCellHeight:48,enableListSelection:!1,highlightNodesOnSelect:!0,highlightParentEdgesOnNodeSelect:!0,graphSortingColumnID:["creationDate","revision"],selection:{canMultiSelect:!0,isDraggable:!1,unselectAllOnEmptyArea:!1,nodes:!n.isReadOnly},onDragStartCell:function(e,t){"__GRAPH__"===!t.dataIndex&&"function"==typeof fn?fn(e,t):e.preventDefault()}},n),this._parent(this._options),this._options.displayCompactMode=null!=this._options.displayCompactMode&&null!=this._options.displayCompactMode&&1==this._options.displayCompactMode,this._options.isReadOnly=null!=this._options.isReadOnly&&null!=this._options.isReadOnly&&1==this._options.isReadOnly,this.highlightNodesOnSelect=!0,this.graphSpinner=new i({className:"evolutionSpinner"}).inject(this._options.container),this.graphSpinner.spin(),this.CfgToolbarContainer=e.createElement("div",{class:"graphToolbarContainer"});var l={displayCompactMode:o._options.displayCompactMode,toggleID:"cfgInfiniteToggle",toggleLabel:p.Infinity_SelectionMode,toggleTooltip:p.Infinity_Tooltip,width:"auto"};this.infiniteToggle=new r(l),this.infiniteToggleContainer=this.infiniteToggle.render(),this.expressionToolbarContainer=e.createElement("div",{class:"expressionToolbarContainer"}),this.expressionToolbar=new t({renderTo:o.expressionToolbarContainer,items:[{className:"divider"},{fonticon:"book-open",text:p.CFG_Expression_View,handler:function(){!1===o.CfgExpressionBox?(o.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#42a2da"),o.CfgExpressionBox=!0,o.cfgExpressionViewObj.hideShowExpressionContainer()):(o.expressionToolbarContainer.getElement("span.fonticon-book-open").setStyle("color","#b4b6ba"),o.CfgExpressionBox=!1,o.cfgExpressionViewObj.hideShowExpressionContainer())}}]}),this.infiniteToggleContainer.inject(this.CfgToolbarContainer),this.expressionToolbarContainer.inject(this.CfgToolbarContainer),this._manager.onCellRequest(function(e){1==e.nodeModel._options.data.frozen?(e.view.addClassName("disablerow"),a._hasFrozenNodeInExpression=!0):e.view.removeClassName("disablerow")}),"FILTER"!=this._options.use&&this.infiniteToggle.setToggleState(!0),this.CfgExpressionBox=!0;e.createElement("div",{styles:{height:"100%"},html:[this.CfgToolbarContainer,this.VersionGraphContainer]}).inject(this.MainContainer),n={effArea:"",effExpHeaderTitle:p.CFG_Expression,viewContainer:o.MainContainer,defaultExpressionContainerHeight:70,inputData:"",displayCompactMode:this._options.displayCompactMode,minimizeTooltip:p.CFG_Minimize_EBox,maximizeTooltip:p.CFG_Max_EBox};this.cfgExpressionViewObj=new d(n),this.cfgExpressionViewObj.render(),this.applyCompactComfortableMode(),1==this._options.isReadOnly&&this.hideToolbarAndExpressionBox(),this.graphSpinner.show()},applyCompactComfortableMode:function(){1==this._options.displayCompactMode?(this._manager.touchMode=!1,this.CfgToolbarContainer.getElement(".divider").setStyles({height:"22px"}),this.CfgToolbarContainer.getElementsByClassName("fonticon-book-open")[0].setAttribute("style","font-size:16px !important;color:#42a2da;"),this.CfgToolbarContainer.getElement(".item").setStyles({height:"22px",marginLeft:"-10px"})):(this._manager.touchMode=!0,this.CfgToolbarContainer.getElement(".divider").setStyles({height:"26px"}),this.CfgToolbarContainer.getElement("span.fonticon-book-open").setStyles({fontSize:"22px",color:"#42a2da"}),this.CfgToolbarContainer.getElement(".item").setStyles({height:"32px",marginLeft:"-5px"}))},render:function(e,t="asc"){this.allNodesArray=e,this.sortOrder=t;var i=this;if(this.VersionGraphModelMgr=new o,this.VersionGraphModelMgr.setModel(this.getModel()),this.VersionGraphModelMgr.createModel(e,this.sortOrder),this.activate(!0),this.VersionGraphContainer.querySelector(".wux-tree-treelistview").setAttribute("style","height:100% !important;"),this._manager.forceMultiSelection(!0),null!=i._options.psJson&&i._options.psJson.length>0){var n="<span style='font-weight:bold' class='fonticon fonticon-infinity'/>";this._manager.prepareUpdateView(),i._model.getAllDescendants().forEach(function(e){if(null!=i._options.psJson)for(var t=i._options.psJson,o=t.length,s=0;s<o;s++){var r=t[s],a=r.start.isRoot;if(e.options.name==r.start.name&&e.options.revision==r.start.revision)if(1==a){e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}),e.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}))}),i.updateExpression(e);if(1==e.isRoot())for(var l=i._model.getAllDescendants(),d=l.length,p=0,h=0;h<d;h++){var _=l[h];a=_.isRoot();1==p&&1==a&&(_.select(),_.__LISTVIEWCOPY__.select(),_.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}),_.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.select(),e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}))}),i.updateExpression(_)),1==a&&e.options.name==_.options.name&&e.options.revision==_.options.revision&&(p=1)}if(0!=r.end.length)for(o=r.end.length,s=0;s<o;s++){var c=r.end[s];i._model.getAllDescendants().forEach(function(e){if(e.options.name==c.name&&e.options.revision==c.revision){e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),e.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}))}),i.updateExpression(e);if(1==e.isRoot())for(var t=i._model.getAllDescendants(),n=t.length,o=0,s=0;s<n;s++){var r=t[s],a=r.isRoot();1==o&&1==a&&(r.unselect(),r.__LISTVIEWCOPY__.unselect(),r.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),r.getAllDescendants().forEach(function(e){e.__LISTVIEWCOPY__&&(e.unselect(),e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}))}),i.updateExpression(r)),1==a&&e.options.name==r.options.name&&e.options.revision==r.options.revision&&(o=1)}"false"==c.IsExcluded||0==c.IsExcluded?(e.select(),e.__LISTVIEWCOPY__.select(),i.updateExpression(e)):(e.unselect(),e.__LISTVIEWCOPY__.unselect(),i.updateExpression(e))}})}}else e.select(),e.__LISTVIEWCOPY__.select(),i.updateExpression(e)}else{var g=tree.getManager().getDocument().getAllDescendants();g.length>0&&(g[g.length-1].select(),g[g.length-1].__LISTVIEWCOPY__.select(),i.updateExpression(g[g.length-1]))}}),i._manager.pushUpdateView(),this._updateGraphSelection()}else null!=i._options.displayexpression&&i._options.displayexpression.length>0&&i.cfgExpressionViewObj.updateExpression(i._options.displayexpression);this.graphSpinner.hide()},updateExpression:function(e){this.CfgSelectedNode=e.getTreeDocument().getXSO().get(),this.CfgSelectedModel=this._model,this.ExpJson=l.GetEvolutionExpressionAndJson(this.CfgSelectedModel),this.cfgExpressionViewObj.updateExpression(l.getEvolutionDisplayExpression(this._options.ModelLabel,this._options.mode,this.ExpJson))},onSelectListView:function(e){var t=e.data.nodeModel.__MASTER__;if(!this._model.getXSO().isIn(t)){var i=this,n="<span style='font-weight:bold' class='fonticon fonticon-infinity'/>";this._manager.prepareUpdateView(),t.select(),1==this.infiniteToggle.getToggleState()&&(t.__LISTVIEWCOPY__.updateOptions({grid:{range:n}}),i.graphSpinner.show(),t.getAllDescendants().forEach(function(e){i._model.getXSO().isIn(e)||e._isTrueRoot()||e.isEmpty()||0!=e.__LISTVIEWCOPY__.options.data.frozen||(e.select(),e.__LISTVIEWCOPY__&&(e.__LISTVIEWCOPY__.select(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:n}})))}),i.graphSpinner.hide()),this.IsExpressionModified=!0,this.updateExpression(t),this._manager.pushUpdateView(),this._updateGraphSelection()}},onUnselectListView:function(e){var t=e.data.nodeModel.__MASTER__;if(this._model.getXSO().isIn(t)){var i=this;this._manager.prepareUpdateView(),t.unselect(),1==this.infiniteToggle.getToggleState()?(t.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),i.graphSpinner.show(),t.getAllDescendants().forEach(function(e){!i._model.getXSO().isIn(e)||e._isTrueRoot()||e.isEmpty()||0!=e.__LISTVIEWCOPY__.options.data.frozen||(e.unselect(),e.__LISTVIEWCOPY__&&(e.__LISTVIEWCOPY__.unselect(),e.__LISTVIEWCOPY__.updateOptions({grid:{range:""}})))}),i.graphSpinner.hide()):t.__LISTVIEWCOPY__.updateOptions({grid:{range:""}}),this.IsExpressionModified=!0,this.updateExpression(t),this._manager.pushUpdateView(),this._updateGraphSelection()}},_addEventListeners:function(){this._addEvent("LISTVIEWMODEL","select",this.onSelectListView.bind(this)),this._addEvent("LISTVIEWMODEL","unselect",this.onUnselectListView.bind(this)),this._addEvent("MASTER","prepareAddDelete",this.prepareUpdateView.bind(this)),this._addEvent("MASTER","pushAddDelete",this.pushUpdateViewAndUpdateGraph.bind(this)),this._addEvent("MASTER","empty",this.empty.bind(this)),this._addEvent("MASTER","attributeChanged",this.onMasterNodeAttributeChanged.bind(this)),this._addEvent("MASTER","attributeChanged",this.onNodeAttributeChange.bind(this)),this._addEvent("LISTVIEWMANAGER","sort",this.onSort.bind(this)),this._addEvent("LISTVIEWMANAGER","dblClick",function(e){var t=e.nodeModel.__MASTER__;"function"==typeof this.options.onNodeDoubleClick&&this.options.onNodeDoubleClick(t)}.bind(this)),this._addEvent("LISTVIEWMANAGER","attributeChanged",this.onNodeAttributeChange.bind(this)),this._addEvent("LISTVIEWMANAGER","UPDATE_VIEW_COMPLETED",this.onUpdateViewComplete.bind(this)),this._isActivated=!0},onNodeAttributeChange:function(e){"__isActive__"===(e.data||e).changedAttribute&&this.onUpdateViewComplete()},onUpdateViewComplete:function(){for(var e,t=this._manager,i=0,n=this._treeDoc.getAllDescendants(),o=n.length;i<o;i+=1)t[(e=n[i]).isActive()?"addRowClass":"removeRowClass"](e._getRowID(),"version-explorer-subway-listview-active-version")},onSort:function(e){this._manager;"revision"===e.columnDataIndex||"creationDate"===e.columnDataIndex?(this.options.ascending="asc"===e.sortOrder,this._clearGraph(),this._updateGraph()):"__GRAPH__"===e.columnDataIndex&&(this.sortOrder="asc"===this.sortOrder?"desc":"asc",this.render(this.allNodesArray,this.sortOrder))},hideToolbarAndExpressionBox:function(){this.cfgExpressionViewObj.hideShowExpressionContainer(),this.CfgToolbarContainer.hide(),this.VersionGraphContainer.setStyles({height:"100%"})}})});